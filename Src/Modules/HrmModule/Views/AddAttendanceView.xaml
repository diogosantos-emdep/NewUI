<dxwui:WinUIDialogWindow x:Class="Emdep.Geos.Modules.Hrm.Views.AddAttendanceView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:Emdep.Geos.Modules.Hrm.Views"
             xmlns:dxwui="http://schemas.devexpress.com/winfx/2008/xaml/windowsui" 
             xmlns:dxe="http://schemas.devexpress.com/winfx/2008/xaml/editors"
             xmlns:dxmvvm="http://schemas.devexpress.com/winfx/2008/xaml/mvvm"
             xmlns:DataCommon="clr-namespace:Emdep.Geos.Data.Common.Hrm;assembly=Emdep.Geos.Data.Common"
             xmlns:HrmApplication="clr-namespace:Emdep.Geos.Modules.Hrm" 
             xmlns:UIConverter="clr-namespace:Emdep.Geos.UI.Converters;assembly=Emdep.Geos.UI.Converters"
             xmlns:Validation="clr-namespace:Emdep.Geos.UI.Validations;assembly=Emdep.Geos.UI.Validations"
             xmlns:GeosApplication="clr-namespace:Emdep.Geos.UI.Common;assembly=Emdep.Geos.UI.Common"
             xmlns:sys="clr-namespace:System;assembly=mscorlib"
             xmlns:i="http://schemas.microsoft.com/expression/2010/interactivity"
             xmlns:behaviors="clr-namespace:Emdep.Geos.UI.Behaviors;assembly=Emdep.Geos.UI.Common"
             mc:Ignorable="d" 
            
             Title="{Binding WindowHeader,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}" TitleStyle="{DynamicResource WinUIDialogWindowTitleStyle}"
             Style="{DynamicResource WinUIDialogWindowStyle}">

    <!--Sprint 42-HRM	M042-06-Add and Edit Attendance-sdesai-->

    <dxwui:WinUIDialogWindow.Resources>
        <UIConverter:DateFormatConverter x:Key="DateFormatConverter" />
        <sys:String x:Key="ShortDateTimeFormat">dd/MM/yyyy hh:mm tt</sys:String>
        <sys:String x:Key="ShortTimeFormat">hh:mm tt</sys:String>
        <sys:String x:Key="ShortDateFormat">dd/MM/yyyy</sys:String>
    </dxwui:WinUIDialogWindow.Resources>

    <dxwui:WinUIDialogWindow.InputBindings>
        <KeyBinding Key="Escape"  Command="{Binding AddAttendanceViewCancelButtonCommand}"/>
    </dxwui:WinUIDialogWindow.InputBindings>

    <Grid>

        <Grid.RowDefinitions>
            <RowDefinition Height="55"/>
            <RowDefinition Height="40"/>
            <RowDefinition Height="40"/>
            <RowDefinition Height="40"/>
            <RowDefinition Height="40"/>
            <RowDefinition Height="40"/>
            <RowDefinition Height="40"/>

        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="120"/>
            <ColumnDefinition Width="150"/>
            <ColumnDefinition Width="120"/>
        </Grid.ColumnDefinitions>


        <!--Employee-->
        <Label Grid.Row="0" Grid.Column="0" Content="{DynamicResource Employee}" Height="30" FontSize="16"
               HorizontalAlignment="Left" VerticalAlignment="Center" Margin="5,5,5,5"/>
        <dxe:ComboBoxEdit Style="{DynamicResource ComboBoxEditStyle}"  Grid.Column="1" 
                          Grid.Row="0" Grid.ColumnSpan="2" Height="30"  Margin="5,5,5,5" 
                          ItemsSource="{Binding EmployeeListFinal,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged }" 
                          IsEnabled="{Binding IsNew,UpdateSourceTrigger=PropertyChanged,Mode=TwoWay}" 
                          DisplayMember="FullName" ValueMember="IdEmployee"  IsTextEditable="False" ValidateOnTextInput="False"
                          AutoComplete="True" ImmediatePopup="True" IncrementalFiltering="True" >
            <dxe:ComboBoxEdit.SelectedIndex>

                <Binding Path="SelectedIndexForEmployee" ValidatesOnDataErrors="True" UpdateSourceTrigger="PropertyChanged" Mode="TwoWay">
                    <Binding.ValidationRules >
                        <Validation:AttendanceValidation FieldName="SelectedIndexForEmployee" ValidationStep="UpdatedValue" ValidatesOnTargetUpdated="True"/>
                    </Binding.ValidationRules>
                </Binding>
            </dxe:ComboBoxEdit.SelectedIndex>

            <dxmvvm:Interaction.Behaviors>
                <dxmvvm:EventToCommand EventName="SelectedIndexChanged"
                                       Command="{Binding DataContext.SelectedIndexChangedCommand, RelativeSource={RelativeSource AncestorType=dxwui:WinUIDialogWindow}}"
                                       PassEventArgsToCommand="True"/>
            </dxmvvm:Interaction.Behaviors>
        </dxe:ComboBoxEdit>

        <!--Shift-->
        <Label Grid.Row="1" Grid.Column="0" Content="{DynamicResource AttendanceShift}" Height="30" FontSize="16"
               HorizontalAlignment="Left" VerticalAlignment="Center" Margin="5,5,5,5"/>
        <dxe:ComboBoxEdit Style="{DynamicResource ComboBoxEditStyle}"  Grid.Column="1" 
                          Grid.Row="1" Grid.ColumnSpan="2" Height="30" Margin="5,5,5,5" 
                          ItemsSource="{Binding CompanyShifts, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                          DisplayMember="Name" ValueMember="IdCompanyShift"  IsTextEditable="False" ValidateOnTextInput="False"
                          AutoComplete="True" ImmediatePopup="True" IncrementalFiltering="True"
                          ApplyItemTemplateToSelectedItem="True">

            <dxe:ComboBoxEdit.ItemTemplate>
                <DataTemplate>
                    <StackPanel Orientation="Horizontal">
                        <TextBlock Margin="5 0">
                            <TextBlock.Style>
                                <Style>
                                    <Setter Property="TextBlock.Text" Value="{Binding ShiftTime}" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IdCompanyShift}" Value="0">
                                            <Setter Property="TextBlock.Text" Value="---" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                        <Image Margin="5 0" Height="16" Width="16" Source="{DynamicResource CoffeeCupImage}" 
                               VerticalAlignment="Center" HorizontalAlignment="Center">
                            <Image.Style>
                                <Style>
                                    <Setter Property="Image.Visibility" Value="Visible" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IdCompanyShift}" Value="0">
                                            <Setter Property="Image.Visibility" Value="Collapsed" />
                                        </DataTrigger>
                                    </Style.Triggers>

                                </Style>
                            </Image.Style>
                        </Image>
                        <TextBlock Margin="5 0">
                            <TextBlock.Style>
                                <Style>
                                    <Setter Property="TextBlock.Text" Value="{Binding BreakTime, StringFormat={}{0:hh}:{0:mm}}"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IdCompanyShift}" Value="0">
                                            <Setter Property="TextBlock.Text" Value="{x:Null}" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                        <!--<TextBlock>
                            <TextBlock.Style>
                                <Style>
                                    <Setter Property="TextBlock.Text" Value="M"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IdCompanyShift}" Value="0">
                                            <Setter Property="TextBlock.Text" Value="{x:Null}" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>-->
                    </StackPanel>
                </DataTemplate>
            </dxe:ComboBoxEdit.ItemTemplate>



            <dxe:ComboBoxEdit.ItemContainerStyle>
                <Style TargetType="dxe:ComboBoxEditItem">
                    <Setter Property="ToolTip">
                        <Setter.Value>
                            <TextBlock Text="{Binding Name}" HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Setter.Value>
                    </Setter>
                </Style>
            </dxe:ComboBoxEdit.ItemContainerStyle>

            <dxe:ComboBoxEdit.ToolTip>
                <TextBlock Text="{Binding SelectedCompanyShift.Name}" HorizontalAlignment="Center" VerticalAlignment="Center" />
                <!--<StackPanel Orientation="Horizontal">

                    <TextBlock Text="{Binding SelectedCompanyShift.ShiftTime}" VerticalAlignment="Center" />
                    <TextBlock Text=" "/>
                    <Image  Source="{DynamicResource CoffeeCupImage}" Width="22" Height="22"/>
                    <TextBlock Text=" "/>
                    <TextBlock VerticalAlignment="Center" >
                        <TextBlock.Text>
                            <MultiBinding StringFormat="{}{0:00}:{1:00}">
                                <Binding Path="SelectedCompanyShift.BreakTime.Minutes"/>
                                <Binding Path="SelectedCompanyShift.BreakTime.Seconds"/>
                            </MultiBinding>
                        </TextBlock.Text>
                    </TextBlock>
                </StackPanel>-->
            </dxe:ComboBoxEdit.ToolTip>

            <dxe:ComboBoxEdit.SelectedIndex>
                <Binding Path="SelectedIndexForCompanyShift" ValidatesOnDataErrors="True" UpdateSourceTrigger="PropertyChanged" Mode="TwoWay">
                    <Binding.ValidationRules >
                        <Validation:AttendanceValidation FieldName="SelectedIndexForCompanyShift" ValidationStep="UpdatedValue" ValidatesOnTargetUpdated="True"/>
                    </Binding.ValidationRules>
                </Binding>
            </dxe:ComboBoxEdit.SelectedIndex>

            <dxmvvm:Interaction.Behaviors>
                <dxmvvm:EventToCommand EventName="SelectedIndexChanged"
                                       Command="{Binding DataContext.SelectedIndexChangedForCompanyShiftCommand, RelativeSource={RelativeSource AncestorType=dxwui:WinUIDialogWindow}}"
                                       PassEventArgsToCommand="True"/>
            </dxmvvm:Interaction.Behaviors>
        </dxe:ComboBoxEdit>

        <!--Start Time-->
        <Label Content= "{DynamicResource AttendanceStartTime}" Grid.Row="2" Grid.Column="0" Grid.ColumnSpan="2" Margin="5 5 5 5" HorizontalAlignment="Left" Height="30" FontSize="16" />

        <dxe:DateEdit  Grid.Row="2" Grid.Column="1" Margin="5 5 5 5" HorizontalAlignment="Stretch" VerticalAlignment="Center" AllowNullInput="True"
                       IsReadOnly="{Binding Source={x:Static HrmApplication:HrmCommon.Instance}, Path=IsPermissionReadOnly,Mode=OneTime,UpdateSourceTrigger=PropertyChanged}">
            <dxe:DateEdit.EditValue>
                <Binding Path="StartDate" UpdateSourceTrigger="PropertyChanged" Mode="TwoWay"
                                                  ValidatesOnDataErrors="True">
                    <Binding.ValidationRules>
                        <Validation:AttendanceValidation FieldName="StartDate" ValidationStep="UpdatedValue" ValidatesOnTargetUpdated="True"/>
                    </Binding.ValidationRules>
                </Binding>
            </dxe:DateEdit.EditValue>

            <dxmvvm:Interaction.Behaviors>
                <dxmvvm:EventToCommand EventName="EditValueChanging" Command="{Binding DataContext.OnDateEditValueChangingCommand,RelativeSource={RelativeSource AncestorType=dxwui:WinUIDialogWindow}}" PassEventArgsToCommand="True"/>
            </dxmvvm:Interaction.Behaviors>
        </dxe:DateEdit>

        <!--<dxe:ComboBoxEdit Grid.Row="2" Grid.Column="2" Height="25" VerticalAlignment="Center" Margin="5,5,5,5"
                          ItemsSource="{Binding FromDates}"
                          MaskType="DateTimeAdvancingCaret" Mask="{Binding TimeEditMask,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}"
                          DisplayFormatString="{Binding TimeEditMask,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged }" HorizontalAlignment="Stretch"
                          IsReadOnly="{Binding Source={x:Static HrmApplication:HrmCommon.Instance}, Path=IsPermissionReadOnly,Mode=OneTime,UpdateSourceTrigger=PropertyChanged}">
            <dxe:ComboBoxEdit.ItemTemplate>
                <DataTemplate>
                    <TextBlock Text="{Binding Converter={StaticResource DateFormatConverter}}"/>
                </DataTemplate>
            </dxe:ComboBoxEdit.ItemTemplate>
            <dxe:ComboBoxEdit.SelectedItem>
                <Binding Path="DataContext.StartTime" RelativeSource="{RelativeSource AncestorType=dxwui:WinUIDialogWindow}" ValidatesOnDataErrors="True" UpdateSourceTrigger="PropertyChanged" Mode="TwoWay">
                    <Binding.ValidationRules>
                        <Validation:AttendanceValidation FieldName="StartTime" ValidationStep="UpdatedValue" ValidatesOnTargetUpdated="True"/>
                    </Binding.ValidationRules>
                </Binding>
            </dxe:ComboBoxEdit.SelectedItem>

            <dxmvvm:Interaction.Behaviors>
                <dxmvvm:EventToCommand EventName="SelectedIndexChanged" Command="{Binding DataContext.OnTimeEditValueChangingCommand,RelativeSource={RelativeSource AncestorType=dxwui:WinUIDialogWindow}}" PassEventArgsToCommand="True"/>
            </dxmvvm:Interaction.Behaviors>
        </dxe:ComboBoxEdit>-->

        <dxe:TextEdit Width="110" Mask="HH:mm" Margin="5"
                      Grid.Row="2" Grid.Column="2" Height="25" IsReadOnly="{Binding IsPermissionReadOnly, Mode=OneTime, Source={x:Static HrmApplication:HrmCommon.Instance}, UpdateSourceTrigger=PropertyChanged}"
                      MaskType="DateTimeAdvancingCaret" DisplayFormatString="HH:mm"  >
            <dxe:TextEdit.EditValue>
                <Binding Path="DataContext.StartTime" RelativeSource="{RelativeSource AncestorType=dxwui:WinUIDialogWindow}" ValidatesOnDataErrors="True" UpdateSourceTrigger="PropertyChanged" Mode="TwoWay">
                    <Binding.ValidationRules>
                        <Validation:EmployeeProfileValidation FieldName="StartTime" ValidationStep="UpdatedValue" ValidatesOnTargetUpdated="True"/>
                    </Binding.ValidationRules>
                </Binding>
            </dxe:TextEdit.EditValue>
            <dxmvvm:Interaction.Behaviors>
                <dxmvvm:EventToCommand EventName="EditValueChanging" Command="{Binding DataContext.OnTextEditValueChangingCommand,RelativeSource={RelativeSource AncestorType=dxwui:WinUIDialogWindow}}" PassEventArgsToCommand="True"/>
            </dxmvvm:Interaction.Behaviors>
        </dxe:TextEdit>


        <!--End Time-->
        <Label Content= "{DynamicResource AttendanceEndTime}" Grid.Row="3" Grid.Column="0"  HorizontalAlignment="Left" Margin="5 5 5 5" Height="30" FontSize="16" />

        <dxe:DateEdit Grid.Row="3" Grid.Column="1"  ValidateOnEnterKeyPressed="True" Margin="5 5 5 5" HorizontalAlignment="Stretch" VerticalAlignment="Center"
                     AllowNullInput="True" IsReadOnly="{Binding Source={x:Static HrmApplication:HrmCommon.Instance}, Path=IsPermissionReadOnly,Mode=OneTime,UpdateSourceTrigger=PropertyChanged}">
            <dxe:DateEdit.EditValue>
                <Binding Path="EndDate" UpdateSourceTrigger="PropertyChanged" Mode="TwoWay" ValidatesOnDataErrors="True">
                    <Binding.ValidationRules>
                        <Validation:AttendanceValidation FieldName="EndDate" ValidationStep="UpdatedValue" ValidatesOnTargetUpdated="True"/>
                    </Binding.ValidationRules>
                </Binding>
            </dxe:DateEdit.EditValue>
            <dxmvvm:Interaction.Behaviors>
                <dxmvvm:EventToCommand EventName="EditValueChanging" Command="{Binding DataContext.OnDateEditValueChangingCommand,RelativeSource={RelativeSource AncestorType=dxwui:WinUIDialogWindow}}" PassEventArgsToCommand="True"/>
            </dxmvvm:Interaction.Behaviors>

        </dxe:DateEdit>

        <!--<dxe:ComboBoxEdit Grid.Row="3" Grid.Column="2" Height="25" VerticalAlignment="Center" Margin="5,5,5,5"
                          ItemsSource="{Binding ToDates}" 
                          MaskType="DateTimeAdvancingCaret" Mask="{Binding TimeEditMask,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}"
                          DisplayFormatString="{Binding TimeEditMask,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged }" HorizontalAlignment="Stretch" 
                          IsReadOnly="{Binding Source={x:Static HrmApplication:HrmCommon.Instance}, Path=IsPermissionReadOnly,Mode=OneTime,UpdateSourceTrigger=PropertyChanged}">
            <dxe:ComboBoxEdit.ItemTemplate>
                <DataTemplate>
                    <TextBlock Text="{Binding Converter={StaticResource DateFormatConverter}}"/>
                </DataTemplate>
            </dxe:ComboBoxEdit.ItemTemplate>
            <dxe:ComboBoxEdit.SelectedItem>
                <Binding Path="DataContext.EndTime" RelativeSource="{RelativeSource AncestorType=dxwui:WinUIDialogWindow}" ValidatesOnDataErrors="True" UpdateSourceTrigger="PropertyChanged" Mode="TwoWay">
                    <Binding.ValidationRules>
                        <Validation:AttendanceValidation FieldName="EndTime" ValidationStep="UpdatedValue" ValidatesOnTargetUpdated="True"/>
                    </Binding.ValidationRules>
                </Binding>
            </dxe:ComboBoxEdit.SelectedItem>
            <dxmvvm:Interaction.Behaviors>
                <dxmvvm:EventToCommand EventName="SelectedIndexChanged" Command="{Binding DataContext.OnTimeEditValueChangingCommand,RelativeSource={RelativeSource AncestorType=dxwui:WinUIDialogWindow}}" PassEventArgsToCommand="True"/>
            </dxmvvm:Interaction.Behaviors>
        </dxe:ComboBoxEdit>-->

        <dxe:TextEdit Width="110" Mask="HH:mm" Margin="5"
                     Grid.Row="3" Grid.Column="2" Height="25" IsReadOnly="{Binding IsPermissionReadOnly, Mode=OneTime, Source={x:Static HrmApplication:HrmCommon.Instance}, UpdateSourceTrigger=PropertyChanged}"
                      MaskType="DateTimeAdvancingCaret" DisplayFormatString="HH:mm" >
            <dxe:TextEdit.EditValue>
                <Binding Path="DataContext.EndTime" RelativeSource="{RelativeSource AncestorType=dxwui:WinUIDialogWindow}" ValidatesOnDataErrors="True" UpdateSourceTrigger="PropertyChanged" Mode="TwoWay">
                    <Binding.ValidationRules>
                        <Validation:EmployeeProfileValidation FieldName="EndTime" ValidationStep="UpdatedValue" ValidatesOnTargetUpdated="True"/>
                    </Binding.ValidationRules>
                </Binding>
            </dxe:TextEdit.EditValue>
            <dxmvvm:Interaction.Behaviors>
                <dxmvvm:EventToCommand EventName="EditValueChanging" Command="{Binding DataContext.OnTextEditValueChangingCommand,RelativeSource={RelativeSource AncestorType=dxwui:WinUIDialogWindow}}" PassEventArgsToCommand="True"/>
            </dxmvvm:Interaction.Behaviors>
        </dxe:TextEdit>


        <Label Grid.Row="4" Grid.Column="0" Content="{DynamicResource Type}" Height="30" FontSize="16"
               HorizontalAlignment="Left" VerticalAlignment="Center" Margin="5,5,5,5"/>
        <!--<dxe:ComboBoxEdit Style="{DynamicResource ComboBoxEditStyle}" Grid.Column="1" Grid.Row="4" Grid.ColumnSpan="2"  Height="30"  Margin="5,5,5,5" HorizontalAlignment="Stretch"  
                          IsTextEditable="False" ValidateOnTextInput="False"
                          AutoComplete="True" ImmediatePopup="True" IncrementalFiltering="True"
                          IsReadOnly="{Binding Source={x:Static HrmApplication:HrmCommon.Instance}, Path=IsPermissionReadOnly,Mode=OneTime,UpdateSourceTrigger=PropertyChanged}">
           
        </dxe:ComboBoxEdit>-->

        <dxe:ComboBoxEdit Style="{DynamicResource ComboBoxEditStyle}"  Grid.Column="1" 
                          Grid.Row="4" Grid.ColumnSpan="2" Height="30"  Margin="5,5,5,5"                         
                          ItemsSource="{Binding Source={x:Static GeosApplication:GeosApplication.Instance}, Path=AttendanceTypeList}"
                          DisplayMember="Value" ValueMember="IdLookupValue"  IsTextEditable="False" ValidateOnTextInput="False"
                          AutoComplete="True" ImmediatePopup="True" IncrementalFiltering="True"
                          IsReadOnly="{Binding Source={x:Static HrmApplication:HrmCommon.Instance}, Path=IsPermissionReadOnly,Mode=OneTime,UpdateSourceTrigger=PropertyChanged}">
            <dxe:ComboBoxEdit.SelectedIndex>

                <Binding Path="SelectedIndexForAttendanceType" ValidatesOnDataErrors="True" UpdateSourceTrigger="PropertyChanged" Mode="TwoWay">
                    <Binding.ValidationRules >
                        <Validation:AttendanceValidation FieldName="SelectedIndexForAttendanceType" ValidationStep="UpdatedValue" ValidatesOnTargetUpdated="True"/>
                    </Binding.ValidationRules>
                </Binding>
            </dxe:ComboBoxEdit.SelectedIndex>
        </dxe:ComboBoxEdit>

        <StackPanel Orientation="Horizontal" Grid.Column="1" Grid.Row="5" Grid.ColumnSpan="2">
            <Button Content="{DynamicResource AttendanceViewAcceptButton}"
                Command="{Binding AddAttendanceViewAcceptButtonCommand}"
                   FontSize="16"
                    Height="30"
                    Width="100"
                    Margin="5,5,15,5"
                    Style="{DynamicResource Button16Style}"
                    VerticalAlignment="Bottom" 
                    IsEnabled="{Binding AddShiftEnabled}"/>
                    
                    <!--IsEnabled="{Binding Source={x:Static HrmApplication:HrmCommon.Instance}, Path=IsPermissionEnabled}"/>-->

            <Button Content="{DynamicResource AttendanceViewCancelButton}"
                Command="{Binding AddAttendanceViewCancelButtonCommand}" 
                   FontSize="16"
                    Height="30"
                    Width="100"
                    Margin="5,5,5,5"
                    Style="{DynamicResource Button16Style}"
                    VerticalAlignment="Bottom" />
        </StackPanel>
    </Grid>
    <i:Interaction.Triggers>
        <i:EventTrigger EventName="KeyDown">
            <behaviors:InvokeDelegateCommandAction Command="{Binding CommandTextInput}" CommandParameter="{Binding Path=InvokeParameter, RelativeSource={RelativeSource Self}}"/>
        </i:EventTrigger>
    </i:Interaction.Triggers>
</dxwui:WinUIDialogWindow> 
