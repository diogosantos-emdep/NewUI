<dxwui:WinUIDialogWindow x:Class="Emdep.Geos.Modules.Hrm.Views.AddEmployeeEquipmentView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:dxwui="http://schemas.devexpress.com/winfx/2008/xaml/windowsui" 
             xmlns:dxe="http://schemas.devexpress.com/winfx/2008/xaml/editors" 
             xmlns:dxg="http://schemas.devexpress.com/winfx/2008/xaml/grid"
             xmlns:dxlc="http://schemas.devexpress.com/winfx/2008/xaml/layoutcontrol"
             xmlns:Validation ="clr-namespace:Emdep.Geos.UI.Validations;assembly=Emdep.Geos.UI.Validations"
             xmlns:dxmvvm="http://schemas.devexpress.com/winfx/2008/xaml/mvvm"
             xmlns:local="clr-namespace:Emdep.Geos.Modules.Hrm.Views"
             mc:Ignorable="d" 
                           Style="{DynamicResource WinUIDialogWindowStyle}"
             Title="{Binding WindowHeader}"
             TitleStyle="{DynamicResource WinUIDialogWindowTitleStyle}"
             d:DesignHeight="300" d:DesignWidth="300">

    <dxwui:WinUIDialogWindow.Resources>
        <ControlTemplate x:Key="popupContentTemplate">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>
                <dxg:GridControl Grid.Row="0" x:Name="PART_GridControl" AutoExpandAllGroups="True">
                    <dxg:GridControl.Columns>
                        <dxg:GridColumn FieldName="CategoryType" Header="Category" FilterPopupMode="CheckedList" />
                        <dxg:GridColumn FieldName="EquipmentType" Header="Type" FilterPopupMode="CheckedList" />
                    </dxg:GridControl.Columns>
                    <dxg:GridControl.View>
                        <dxg:TableView Name="View"
                                       ShowGroupedColumns="True"
                                       AutoWidth="True"
                                       ShowSearchPanelMode="Always"
                                       SearchPanelHorizontalAlignment="Stretch"
                                       AllowPerPixelScrolling="True"
                                       SearchPanelAllowFilter="False"
                                       ScrollAnimationDuration="0"
                                       ShowAutoFilterRow="True"
                                       ShowTotalSummary="True"
                                       IsSynchronizedWithCurrentItem="False" >
                            <dxg:TableView.RowStyle>
                                <Style TargetType="{x:Type dxg:RowControl}">
                                    <Style.Triggers>
                                        <MultiDataTrigger>
                                            <MultiDataTrigger.Conditions>
                                                <!-- Condition 1: Check if Row.IsInActive is True -->
                                                <Condition Binding="{Binding Row.InUse}" Value="False" />
                                            </MultiDataTrigger.Conditions>
                                            <!-- Setters when all conditions are met -->
                                            <MultiDataTrigger.Setters>
                                                <Setter Property="Foreground" Value="Gray" />
                                                <Setter Property="IsEnabled" Value="False" />
                                            </MultiDataTrigger.Setters>
                                        </MultiDataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </dxg:TableView.RowStyle>

                        </dxg:TableView>
                    </dxg:GridControl.View>
                </dxg:GridControl>
            </Grid>

        </ControlTemplate>
    </dxwui:WinUIDialogWindow.Resources>

    <dxwui:WinUIDialogWindow.InputBindings>
        <KeyBinding Key="Escape"  Command="{Binding CancelButtonCommand}"/>
    </dxwui:WinUIDialogWindow.InputBindings>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="5"/>
            <RowDefinition Height="50"/>
        </Grid.RowDefinitions>

        <Grid Grid.Row="0" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="300"/>
            </Grid.ColumnDefinitions>

            <Grid.RowDefinitions>
                <RowDefinition Height="30"/>
                <RowDefinition Height="5"/>
                <RowDefinition Height="30"/>
                <RowDefinition Height="5"/>
                <RowDefinition Height="30"/>
                <RowDefinition Height="5"/>
                <RowDefinition Height="30"/>
                <RowDefinition Height="5"/>
                <RowDefinition Height="30"/>
                <RowDefinition Height="5"/>
                <RowDefinition Height="90"/>
            </Grid.RowDefinitions>

            <!--Equiment-->
            <TextBlock Grid.Row="0" Grid.Column="0" Text="{DynamicResource AddEquipmentAndToolsEquipmentHeader}" Style="{StaticResource TextBlock14Style}" VerticalAlignment="Center" />

            <dxg:LookUpEdit x:Name="searchLookUpEdit" Grid.Row="0" Grid.Column="2"
                 PopupHeight="500"
                 PopupWidth="750"
                 PopupMinHeight="100"
                 PopupMinWidth="100"
                 IsPopupAutoWidth="False"
                 FilterCondition="StartsWith"
                 FindButtonPlacement="Popup"
                 FindMode="Always"
                 PopupContentTemplate="{StaticResource popupContentTemplate}"
                 ItemsSource="{Binding EquipmentList, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                
                            AutoPopulateColumns="False"
                 DisplayMember="EquipmentType"
                 ValueMember="IdLookupValue"
                 ImmediatePopup="True"
                 AutoComplete="True">

                <dxg:LookUpEdit.StyleSettings>
                    <dxg:SearchLookUpEditStyleSettings />
                </dxg:LookUpEdit.StyleSettings>

                <dxg:LookUpEdit.SelectedItem>
                    <Binding Path="SelectedEquipment" ValidatesOnDataErrors="True" UpdateSourceTrigger="PropertyChanged" Mode="TwoWay">
                        <Binding.ValidationRules>
                            <Validation:AddEditEmployeeEquipmentValidation FieldName="SelectedEquipment" ValidationStep="UpdatedValue" ValidatesOnTargetUpdated="True"/>
                        </Binding.ValidationRules>
                    </Binding>
                </dxg:LookUpEdit.SelectedItem>

            </dxg:LookUpEdit>

            <!--SelectedItem="{Binding SelectedEquipment, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"-->
            <!--Mandatory-->
            <TextBlock Grid.Row="2" Grid.Column="0" Text="{DynamicResource AddEquipmentAndToolsMandatoryHeader}" Style="{StaticResource TextBlock14Style}" VerticalAlignment="Center" />

            <dxe:ToggleSwitch x:Name="chkInUse" Grid.Row="2" Grid.Column="2" Height="30" HorizontalAlignment="Left" VerticalAlignment="Center" ContentPlacement="Inside"
                                                       CheckedStateContent="Yes" UncheckedStateContent="No" ToggleSwitchWidth="50" ToggleSwitchHeight="30" IsThreeState="False"                                
                                               IsChecked="{Binding IsMandatory,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}">
            </dxe:ToggleSwitch>

            <!--Expected Duration-->

            <TextBlock  Grid.Column="0" Grid.Row="4" Text="{DynamicResource AddEditEquipmentAndToolsViewExpiryDateHeader}" Style="{StaticResource TextBlock14Style}" VerticalAlignment="Center" />

            <dxe:DateEdit Grid.Column="2" Grid.Row="4" Text="{Binding EndDate,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}" HorizontalAlignment="Stretch">
                    <dxe:DateEdit.EditValue>
                    <Binding Path="EndDate" UpdateSourceTrigger="PropertyChanged" Mode="TwoWay"
                                                 ValidatesOnDataErrors="True">
                            <Binding.ValidationRules>
                            <Validation:AddEditEmployeeEquipmentValidation FieldName="EndDate" ValidationStep="UpdatedValue" ValidatesOnTargetUpdated="True"/>
                            </Binding.ValidationRules>
                        </Binding>
                    </dxe:DateEdit.EditValue>
                    <dxmvvm:Interaction.Behaviors>
                        <dxmvvm:EventToCommand EventName="EditValueChanging" Command="{Binding DataContext.OnDateEditValueChangingCommand,RelativeSource={RelativeSource AncestorType=dxwui:WinUIDialogWindow}}" PassEventArgsToCommand="True"/>
                    </dxmvvm:Interaction.Behaviors>
                </dxe:DateEdit>
            



            <!--Attachment-->
            <TextBlock Grid.Row="6" Grid.Column="0" Text="{DynamicResource AddEquipmentAndToolsAttachmentHeader}" Style="{StaticResource TextBlock14Style}" VerticalAlignment="Center" />

            <!--Choose File-->
            <dxe:ComboBoxEdit Grid.Row="6" Grid.Column="2"
                          VerticalContentAlignment="Center"
                          ItemsSource="{Binding DataContext.EquipmentAndToolsAttachmentList,UpdateSourceTrigger=PropertyChanged, Mode=TwoWay,RelativeSource={RelativeSource AncestorType=dxwui:WinUIDialogWindow,Mode=FindAncestor}}"
                          ScrollViewer.VerticalScrollBarVisibility="Hidden"
                          DisplayMember="SavedFileName"
                          HorizontalAlignment="Stretch"
                          VerticalAlignment="Stretch"
                          AllowDefaultButton="False"
                          AutoComplete="True"
                          AllowDrop="True"
                         PreviewDragOver="ProductFileComboBoxEdit_PreviewDragOver"  PreviewDrop="ProductFileComboBoxEdit_PreviewDrop"
                          ImmediatePopup="True"
                          ValidateOnEnterKeyPressed="True" 
                          ValidateOnTextInput="True"
                          IsTextEditable="False" Style="{DynamicResource ComboBoxEditStyle}" 
                         >


                <dxe:ComboBoxEdit.StyleSettings>
                    <dxe:TokenComboBoxStyleSettings  NewTokenPosition="Far" EnableTokenWrapping="True"  />
                </dxe:ComboBoxEdit.StyleSettings>




                <dxe:ComboBoxEdit.SelectedItem>
                    <Binding Path="DataContext.AttachmentObjectList" RelativeSource="{RelativeSource AncestorType=dxwui:WinUIDialogWindow}" ValidatesOnDataErrors="True"  UpdateSourceTrigger="PropertyChanged" Mode="TwoWay">
                        <Binding.ValidationRules>
                            <Validation:AddEditEmployeeEquipmentValidation FieldName="AttachmentObjectList" ValidationStep="UpdatedValue" ValidatesOnTargetUpdated="True"/>
                        </Binding.ValidationRules>
                    </Binding>
                </dxe:ComboBoxEdit.SelectedItem>

            </dxe:ComboBoxEdit>


            <!--ChooseFile-->
            <Button Grid.Row="8" Grid.Column="2" Content="{DynamicResource ChooseFile}" Width="115" HorizontalAlignment="Right" Command="{Binding ChooseFileActionCommand}"/>


            <!--Remarks-->
            <TextBlock Grid.Row="10" Grid.Column="0" Text="{DynamicResource AddEquipmentAndToolsRemarksHeader}" Style="{StaticResource TextBlock14Style}" VerticalAlignment="Top" Margin="0,5,0,0" />
            <dxe:TextEdit Grid.Row="10" Grid.Column="2"  Text="{Binding EquipmentAndToolsRemarks,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}"  VerticalContentAlignment="Top" TextWrapping="Wrap" 
                      ScrollViewer.VerticalScrollBarVisibility="Auto" ScrollViewer.HorizontalScrollBarVisibility="Disabled" AcceptsReturn="True"/>


        </Grid>

        <Grid Grid.Row="2" ShowGridLines="False" Grid.Column="2" VerticalAlignment="Center" HorizontalAlignment="Stretch">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="50"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Button  HorizontalAlignment="Right"
                     Style="{DynamicResource Button16Style}"
                     VerticalAlignment="Top"
                     Content="{DynamicResource AddCatalogueAcceptButton}"
                     Command="{Binding AcceptFileActionCommand}"
                     Height="30"
                     Width="100" />

            <Button Grid.Row="10" Grid.Column="2"
                                                HorizontalAlignment="Left"
                                                Style="{DynamicResource Button16Style}"
                                                VerticalAlignment="Top"
                                                Content="{DynamicResource AddCatalogueCancelButton}"
                                                Command="{Binding CancelButtonCommand }"
                                                Height="30"
                                                Width="100" />
        </Grid>
    </Grid>
    </dxwui:WinUIDialogWindow>
