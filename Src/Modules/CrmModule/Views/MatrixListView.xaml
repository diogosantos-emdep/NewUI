<UserControl x:Class="Emdep.Geos.Modules.Crm.Views.MatrixListView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:Emdep.Geos.Modules.Crm.Views"
             xmlns:dxe="http://schemas.devexpress.com/winfx/2008/xaml/editors"
             xmlns:dxmvvm="http://schemas.devexpress.com/winfx/2008/xaml/mvvm"
             xmlns:GeosApplication="clr-namespace:Emdep.Geos.UI.Common;assembly=Emdep.Geos.UI.Common"
             xmlns:dxg="http://schemas.devexpress.com/winfx/2008/xaml/grid"
             xmlns:dxp="http://schemas.devexpress.com/winfx/2008/xaml/printing" 
             xmlns:UIHelper="clr-namespace:Emdep.Geos.UI.Helper;assembly=Emdep.Geos.UI.Helper"
             xmlns:dx="http://schemas.devexpress.com/winfx/2008/xaml/core" 
             xmlns:dxgt="http://schemas.devexpress.com/winfx/2008/xaml/grid/themekeys"             
             xmlns:dxwui="http://schemas.devexpress.com/winfx/2008/xaml/windowsui"
             xmlns:dxnav="http://schemas.devexpress.com/winfx/2008/xaml/navigation"
             xmlns:dxwuin="http://schemas.devexpress.com/winfx/2008/xaml/windowsui/navigation" 
             xmlns:UIConverter="clr-namespace:Emdep.Geos.UI.Converters;assembly=Emdep.Geos.UI.Converters" 
             mc:Ignorable="d" 
             d:DesignHeight="300" d:DesignWidth="300">
    <UserControl.Resources>

        <Style x:Key="HideButtonStyle" TargetType="{x:Type ToggleButton}">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type ToggleButton}">
                        <Border BorderThickness="0" Background="{TemplateBinding Background}">
                            <Grid>
                                <Image Stretch="None" VerticalAlignment="Center" HorizontalAlignment="Center"
                                   Source="/Emdep.Geos.Modules.Warehouse;component/Assets/Images/ArrowRight.png"
                                   Visibility="{TemplateBinding IsChecked, Converter={dxmvvm:BooleanToVisibilityConverter Inverse=True}}"/>
                                <Image Stretch="None" VerticalAlignment="Center" HorizontalAlignment="Center"
                                   Source="/Emdep.Geos.Modules.Warehouse;component/Assets/Images/ArrowLeft.png"
                                   Visibility="{TemplateBinding IsChecked, Converter={dxmvvm:BooleanToVisibilityConverter}}"/>
                            </Grid>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="LeftPanelTileItemStyle" TargetType="{x:Type dxnav:TileBarItem}">
            <Setter Property="Foreground" Value="{Binding ForeColor,Converter={UIConverter:ForegroundColorConverter}}"/>
            <Setter Property="BorderBrush" Value="#FFD6D6D6"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Background" Value="{Binding BackColor}"/>
            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
            <Setter Property="VerticalContentAlignment" Value="Stretch"/>
            <Setter Property="Height" Value="{Binding Height}"/>
            <Setter Property="Width" Value="{Binding Width}"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="SelectionPadding" Value="0" />
            <Setter Property="ContentTemplate" >
                <Setter.Value >
                    <DataTemplate >
                        <StackPanel Orientation="Vertical" HorizontalAlignment="Left" Width="195" Height="75"  >
                            <Label Content="{Binding EntitiesCount,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}" HorizontalContentAlignment="Right"   Margin="0,-5,8,0" VerticalContentAlignment="Top" FontSize="36" Visibility="{Binding EntitiesCountVisibility}"></Label>
                            <Label Content="{Binding Caption, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" HorizontalContentAlignment="Left" Margin="6,0,0,3" VerticalAlignment="Bottom" FontSize="15" ></Label>
                        </StackPanel>
                    </DataTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="BorderThickness" Value="5"/>
                    <Setter Property="BorderBrush" Value="{DynamicResource TileBarItemColorStyle}"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </UserControl.Resources>
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="55"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="335"/>
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <TextBlock Margin="5,0,0,0" Text="{DynamicResource CrmMainViewModelMatrix}" Grid.Row="0" Grid.Column="0"  Style="{DynamicResource TextBlock30Style}" FontWeight="Bold" />
        <Grid HorizontalAlignment="Right" Grid.Row="0" Grid.Column="1" Margin="0,5,0,0" >
            <Grid.RowDefinitions>
                <RowDefinition Height="AUTO"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="AUTO"/>
                <ColumnDefinition Width="150"/>
                <ColumnDefinition Width="AUTO"/>
                <ColumnDefinition Width="AUTO"/>
                <ColumnDefinition Width="AUTO"/>
                <ColumnDefinition Width="AUTO"/>

            </Grid.ColumnDefinitions>
            <!--AddMatrix-->
            <Button Content=" " Visibility="Visible" Grid.Row="0" Grid.Column="2" Height="40" Width="40" 
                    HorizontalAlignment="Right" Margin="0,0,5,5" 
                    Command="{Binding AddMatrixCommand }" CommandParameter="{Binding ElementName=QuotationMatrixTemplateTableView}" 
                    IsEnabled="{Binding IsAddMatrixEnable}">
                <Button.ToolTip>
                    <TextBlock Text="{DynamicResource AddMatrixViewHeader}"/>
                </Button.ToolTip>
                <Button.ContentTemplate>
                    <DataTemplate>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <Image Style="{DynamicResource AddButtonImageStyle}" Grid.Column="0" Height="24" Width="24" Margin="-10"/>
                        </Grid>
                    </DataTemplate>
                </Button.ContentTemplate>
            </Button>

            <!-- Refresh Grid-->
            <Button Visibility="Visible" Grid.Row="0" Grid.Column="3" Height="40" Width="40" HorizontalAlignment="Right"  Margin="0,0,5,5"
                     Command="{Binding RefreshButtonCommand}" CommandParameter="{Binding ElementName=QuotationMatrixTemplateTableView}">
                <Button.ToolTip>
                    <TextBlock Text="{DynamicResource RefreshMatrixActivities}"/>
                </Button.ToolTip>
                <Button.ContentTemplate>
                    <DataTemplate>
                        <Image Style="{DynamicResource RefreshButtonImageStyle}"  Height="24" Width="24" Margin="-10"/>
                    </DataTemplate>
                </Button.ContentTemplate>
            </Button>

            <!-- Print List-->
            <Button Visibility="Visible" Grid.Row="0" Grid.Column="4" Height="40" Width="40" HorizontalAlignment="Right"  Margin="0,0,5,5"
                    Command="{Binding PrintButtonCommand}" CommandParameter="{Binding ElementName=QuotationMatrixTemplateTableView}">
                <Button.ToolTip>
                    <TextBlock Text="{DynamicResource PrintMatrixActivities}"/>
                </Button.ToolTip>
                <Button.ContentTemplate>
                    <DataTemplate>
                        <Image Style="{DynamicResource PrinterButtonImageStyle}"  Height="24" Width="24" Margin="-10"/>
                    </DataTemplate>
                </Button.ContentTemplate>
            </Button>

            <!-- Export to excel -->
            <Button Content=" " Height="40" Width="40"  HorizontalAlignment="Right" Grid.Row="0" Grid.Column="5" Margin="0,0,5,5"
                    Command="{Binding ExportButtonCommand}" CommandParameter="{Binding ElementName=QuotationMatrixTemplateTableView}" >
                <Button.ToolTip>
                    <TextBlock Text="{DynamicResource ButtonExportToExcel}"/>
                </Button.ToolTip>
                <Button.ContentTemplate>
                    <DataTemplate>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <Image Style="{ DynamicResource ExcelExportButtonImageStyle}" Grid.Column="0" Height="24" Width="24" Margin="-10"/>
                        </Grid>
                    </DataTemplate>
                </Button.ContentTemplate>
            </Button>

        </Grid>


        <DockPanel Grid.Row="1" Grid.ColumnSpan="2" Margin="5,0,0,0">
            <dxwui:NavigationFrame   x:Name="Navigatedframe" AnimationType="None">
                <dxmvvm:Interaction.Behaviors>
                    <dxwuin:FrameNavigationService/>
                </dxmvvm:Interaction.Behaviors>
            </dxwui:NavigationFrame>

            <UIHelper:DpiResizingPanel DockPanel.Dock="Left">
                <dxnav:TileBar x:Name="tileBar" DockPanel.Dock="Left" HorizontalAlignment="Left"   VerticalAlignment="Stretch" Margin="-20 0 0 0"
                               Orientation="Vertical"
                               ItemSpacing="5"
                               SelectedItem="{Binding SelectedTileBarItem,UpdateSourceTrigger=PropertyChanged,Mode=TwoWay}"
                               ItemsSource="{Binding FilterStatusListOfTile ,Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                               ItemContainerStyle="{StaticResource LeftPanelTileItemStyle}"     
                               Visibility="{Binding ElementName=expandButton, Path=IsChecked, Converter={dxmvvm:BooleanToVisibilityConverter}}" >
                    <dxmvvm:Interaction.Behaviors>
                        <dxmvvm:EventToCommand Command="{Binding CommandFilterStatusTileClick}"  EventName="SelectionChanged" PassEventArgsToCommand="True"/>
                        <dxmvvm:EventToCommand Command="{Binding CommandTileBarClickDoubleClick}"  EventName="MouseDoubleClick" CommandParameter="{Binding ElementName=QuotationMatrixTemplateTableView}"/>
                    </dxmvvm:Interaction.Behaviors>
                </dxnav:TileBar>
            </UIHelper:DpiResizingPanel>

            <ToggleButton x:Name="expandButton" DockPanel.Dock="Left" Style="{StaticResource HideButtonStyle}" IsChecked="False" VerticalAlignment="Center"/>

            <dxg:GridControl DockPanel.Dock="Top" AutoGenerateColumns="None"  
                         x:Name="QuotationMatrixTemplateGrid" Grid.Row="1" Grid.ColumnSpan="2" 
                         ItemsSource="{Binding QuotationMatrixTemplateList,Mode=TwoWay}"
                  SelectedItem="{Binding SelectedQuotationMatrixTemplate,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}" 
                         Width="Auto" Height="Auto" SelectionMode="Row"  ImplyNullLikeEmptyStringWhenFiltering="True"
                        FilterString="{Binding MyFilterString,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}"
                        IsFilterEnabled="{Binding IsFilterEnabled, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                       >
                
                <dxg:GridControl.Columns>
                <dxg:GridColumn FieldName="Name" Header="{DynamicResource MatrixNameHeader}" ReadOnly="True" 
                                MinWidth="280" Width="Auto" MaxWidth="550" FilterPopupMode="CheckedList"/>
                <dxg:GridColumn FieldName="Description" Header="{DynamicResource MatrixDescriptionHeader}"  
                                ReadOnly="True" MinWidth="280" Width="Auto" MaxWidth="550" FilterPopupMode="CheckedList"/>
                <dxg:GridColumn FieldName="RegionLookupValue.Region" Header="{DynamicResource MatrixRegionHeader}" 
                                ReadOnly="True" MinWidth="120" 
                                FilterPopupMode="CheckedList"/>
                <dxg:GridColumn FieldName="Customer.CustomerName" Header="{DynamicResource MatrixGroupHeader}"  
                                ReadOnly="True" MinWidth="120"  FilterPopupMode="CheckedList"/>
                    <dxg:GridColumn FieldName="ProductCategory.Name" Header="{DynamicResource MatrixCategory1Header}"  
                                    ReadOnly="True" MinWidth="140"  FixedWidth="True" FilterPopupMode="CheckedList"/>

                <dxg:GridColumn FieldName="InUseYesOrNo" Header="{DynamicResource MatrixInUseHeader}"                                  
                                ReadOnly="True" FixedWidth="True" FilterPopupMode="CheckedList"
                                AllowPrinting="True" Width="70">
                </dxg:GridColumn>
                <dxg:GridColumn FieldName="Url" Header="{DynamicResource MatrixURLHeader}"  
                                ReadOnly="True" FixedWidth="True"  FilterPopupMode="CheckedList"
                                AllowPrinting="False" AllowSorting="False" AllowColumnFiltering="False" 
                                Width="50">
                    <dxg:GridColumn.CellTemplate>
                        <DataTemplate>
                                <TextBlock ToolTip="{Binding Data.Url}" Margin="5,0,0,0" VerticalAlignment="Center" 
                                       HorizontalAlignment="Center" TextAlignment="Center">
                                <Hyperlink TargetName="_blank"  
                                            Command="{Binding View.DataContext.HyperlinkForWebsite}" 
                                            CommandParameter="{Binding Data.Url}"
                                            Style="{DynamicResource hyperlinkGridStyle}">                
                                    <Image Height="16" Width="16"  Style="{ DynamicResource DownloadAttachmentButtonImageStyle}" />
                                    
                                </Hyperlink>
                            </TextBlock>
                        </DataTemplate>
                    </dxg:GridColumn.CellTemplate>
                </dxg:GridColumn>
            </dxg:GridControl.Columns>
            <dxg:GridControl.TotalSummary>
                <dxg:GridSummaryItem x:Name="summary" FieldName="Group" SummaryType="Count" DisplayFormat="Total Count: {0}" Visible="True"   Alignment="Left"/>
            </dxg:GridControl.TotalSummary>

            <dxmvvm:Interaction.Behaviors>
                    <dxmvvm:EventToCommand Command="{Binding GridControlLoadedCommand}" EventName="Loaded" PassEventArgsToCommand="True" />
                    <UIHelper:GridSelectingBehavior />
            </dxmvvm:Interaction.Behaviors>

            <dxg:GridControl.View>
                <dxg:TableView Name="QuotationMatrixTemplateTableView" NavigationStyle="Row" RowDetailsVisibilityMode="Visible" ShowHorizontalLines="True" ShowSearchPanelMode="Always"
                        VerticalScrollbarVisibility="Visible" 
                        ColumnChooserColumnDisplayMode="ShowHiddenColumnsOnly"
                        ShowFixedTotalSummary="True"                                      
                        AllowGrouping="False" ShowGroupPanel="False" 
                        ShowIndicator="False" SearchPanelHorizontalAlignment="Stretch"
                        FocusedRow="{Binding SelectedQuotationMatrixTemplate,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged }"
                        ShowAutoFilterRow="False"
                        UseLegacyFilterEditor="True">
                    <dxg:TableView.Resources>
                        <DataTemplate x:Key="MatrixListReportPrintHeaderTemplate">
                            <Grid Width="{Binding UsablePageWidth}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="50" />
                                    <ColumnDefinition Width="130" />
                                </Grid.ColumnDefinitions>
                                <dxe:TextEdit Text=" " Width="{Binding UsablePageWidth}" Grid.ColumnSpan="3" IsPrintingMode="True" Background="#333E5E" HorizontalAlignment="Stretch" 
                                                      VerticalAlignment="Stretch" Padding="12" Foreground="#FFFFFFFF" Style="{DynamicResource TextEdit20Style}" FontWeight="Bold" Height="50" />
                                <dxe:TextEdit Text="Matrix List Report" IsPrintingMode="True" HorizontalAlignment="Stretch" 
                                                      VerticalAlignment="Stretch" Padding="12" Foreground="#FFFFFFFF" Style="{DynamicResource TextEdit20Style}" FontWeight="Bold" />
                                <Image Source="/Emdep.Geos.Modules.Crm;component/Assets/Images/GeosReportLogo.png" Height="50" Width="80"  dxp:ExportSettings.TargetType="Image" Grid.Column="2" />
                            </Grid>
                        </DataTemplate>

                        <DataTemplate x:Key="MatrixListReportPrintFooterTemplate">
                            <dxe:TextEdit HorizontalContentAlignment="Center" 
                                                  Width="{Binding Path=UsablePageWidth, Mode=OneWay}" 
                                                  dxp:ExportSettings.TargetType="PageNumber" 
                                                  dxp:PageNumberExportSettings.Kind="NumberOfTotal" 
                                                  dxp:PageNumberExportSettings.Format="Page {0} of {1}"/>
                        </DataTemplate>

                    </dxg:TableView.Resources>

                    <dxmvvm:Interaction.Behaviors>

                            <dxmvvm:EventToCommand Command="{Binding MatrixListGridDoubleClickCommand}"
                                                   EventName="MouseDoubleClick" CommandParameter="{Binding ElementName=QuotationMatrixTemplateTableView}"
                                                   PassEventArgsToCommand="True">
                            <dxmvvm:EventToCommand.EventArgsConverter>
                                <dx:EventArgsToDataRowConverter />
                            </dxmvvm:EventToCommand.EventArgsConverter>
                        </dxmvvm:EventToCommand>
                            <dxmvvm:EventToCommand Command="{Binding FilterEditorCreatedCommand}" EventName="FilterEditorCreated" PassEventArgsToCommand="True" />                            
                        </dxmvvm:Interaction.Behaviors>
                </dxg:TableView>
            </dxg:GridControl.View>
        </dxg:GridControl>
        </DockPanel>
    </Grid>
</UserControl>
