<dxwui:WinUIDialogWindow x:Class="Emdep.Geos.Modules.Crm.Views.ReadImportedCustomerContactView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                         xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                         xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
                         xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
                         xmlns:local="clr-namespace:Emdep.Geos.Modules.Crm.Views"
                         xmlns:dxwui="http://schemas.devexpress.com/winfx/2008/xaml/windowsui"
                         xmlns:dxg="http://schemas.devexpress.com/winfx/2008/xaml/grid"
                         xmlns:dx="http://schemas.devexpress.com/winfx/2008/xaml/core"
                         xmlns:dxe="http://schemas.devexpress.com/winfx/2008/xaml/editors"
                         xmlns:dxmvvm="http://schemas.devexpress.com/winfx/2008/xaml/mvvm"
                         xmlns:Validation="clr-namespace:Emdep.Geos.UI.Validations;assembly=Emdep.Geos.UI.Validations"
                         xmlns:i="http://schemas.microsoft.com/expression/2010/interactivity"
                         xmlns:behaviors="clr-namespace:Emdep.Geos.UI.Behaviors;assembly=Emdep.Geos.UI.Common"
                         mc:Ignorable="d" 
                         xmlns:Coverter="clr-namespace:Emdep.Geos.UI.Converters;assembly=Emdep.Geos.UI.Converters"
                         HorizontalAlignment="Stretch" Margin="20,0,0,0"
                         Title="{DynamicResource ImportContactView_ViewCustomerContacts}" 
                         TitleStyle="{DynamicResource WinUIDialogWindowTitleStyle}"
                         Style="{DynamicResource WinUIDialogWindowStyle}">
    <dxwui:WinUIDialogWindow.InputBindings>
        <KeyBinding Key="Escape"  Command="{Binding CancelButtonCommand}"/>
    </dxwui:WinUIDialogWindow.InputBindings>
    <dxwui:WinUIDialogWindow.Resources>
        <Coverter:ForegroundColorConverter x:Key="ForegroundColorConverter" />
    </dxwui:WinUIDialogWindow.Resources>
    <Grid HorizontalAlignment="Stretch" Height="600" Margin="20,0,20,0">
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
            <RowDefinition Height="40"/>
        </Grid.RowDefinitions>
        <dxg:GridControl x:Name="ContactGrid" ItemsSource="{Binding ImportedContacts,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}" Width="Auto" Height="Auto" 
                 FilterString="{Binding MyFilterString ,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}" SelectionMode="Row" AllowLiveDataShaping="True"
                 SelectedItem="{Binding SelectedObject, Mode=TwoWay}" ImplyNullLikeEmptyStringWhenFiltering="True">
            <dxg:GridColumn Header=" " ShowCheckBoxInHeader="True" FieldName="IsSelected" Width="50" FixedWidth="True" 
                                AllowBestFit="true" 
                                AllowCellMerge="False"
                                AllowMoving="false"
                                AllowAutoFilter="False"
                                ShowInColumnChooser="False" 
                                FilterPopupMode="Default">
                <dxg:GridColumn.CellTemplate>
                    <DataTemplate>
                        <CheckBox x:Name="Part_Editor" IsChecked="{Binding RowData.Row.IsSelected,Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                  HorizontalAlignment="Center" VerticalAlignment="Center" />
                    </DataTemplate>
                </dxg:GridColumn.CellTemplate>
            </dxg:GridColumn>
            <dxg:GridColumn FieldName="Customer.CustomerName" Header="{DynamicResource ReadImportedCotactView_Group}" MinWidth="150" Width="200" FilterPopupMode="Default">
                <dxg:GridColumn.CellTemplate>
                    <DataTemplate>
                        <dxe:ComboBoxEdit Name="GroupEditor" ItemsSource="{Binding DataContext.ListGroup, RelativeSource={RelativeSource AncestorType=dxg:GridControl},UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                                                  HorizontalAlignment="Stretch" IsTextEditable="False" ValidateOnTextInput="False" ValidateOnEnterKeyPressed="True" InvalidValueBehavior="AllowLeaveEditor"
                                                  DisplayMember="CustomerName" ValueMember="IdCustomer" 
                                                  AutoComplete="False" ImmediatePopup="True" IncrementalFiltering="True" 
                                          SelectedItem="{Binding RowData.Row.Customer,UpdateSourceTrigger=PropertyChanged , Mode=TwoWay}">
                            <dxmvvm:Interaction.Behaviors>
                                <dxmvvm:EventToCommand EventName="Validate"
                                       Command="{Binding DataContext.GroupNameValidateCommand, RelativeSource={RelativeSource AncestorType=dxg:GridControl}}"
                                       PassEventArgsToCommand="True"/>
                            </dxmvvm:Interaction.Behaviors>
                        </dxe:ComboBoxEdit>
                    </DataTemplate>
                </dxg:GridColumn.CellTemplate>
            </dxg:GridColumn>
            <dxg:GridColumn FieldName="ImportContactCompany.SiteNameWithoutCountry" Header="{DynamicResource ReadImportedCotactView_Plant}" MinWidth="150" Width="200" FilterPopupMode="Default">
                <dxg:GridColumn.CellTemplate>
                    <DataTemplate>
                        <dxe:ComboBoxEdit Name="CompanyEditor" 
                                          ItemsSource="{Binding RowData.Row.FilteredCompanies,UpdateSourceTrigger =PropertyChanged, Mode=TwoWay}"
                                                  HorizontalAlignment="Stretch" IsTextEditable="False" ValidateOnTextInput="False" ValidateOnEnterKeyPressed="True" InvalidValueBehavior="AllowLeaveEditor"
                                                  DisplayMember="SiteNameWithoutCountry" ValueMember="IdCompany"
                                                  AutoComplete="False" ImmediatePopup="True" IncrementalFiltering="True" 
                                        SelectedItem="{Binding RowData.Row.ImportContactCompany,UpdateSourceTrigger=PropertyChanged , Mode=TwoWay}">
                            <dxmvvm:Interaction.Behaviors>
                                <dxmvvm:EventToCommand EventName="Validate"
                                       Command="{Binding DataContext.PlantValidateCommand, RelativeSource={RelativeSource AncestorType=dxg:GridControl}}"
                                       PassEventArgsToCommand="True"/>
                            </dxmvvm:Interaction.Behaviors>
                        </dxe:ComboBoxEdit>
                    </DataTemplate>
                </dxg:GridColumn.CellTemplate>
            </dxg:GridColumn>
            <dxg:GridColumn FieldName="ImportContactCompany.Country.Name" Header="{DynamicResource ReadImportedCotactView_Country}" MinWidth="150" Width="200" FilterPopupMode="Default" ReadOnly="True"/>
            <dxg:GridColumn FieldName="Name" Header="{DynamicResource ReadImportedCotactView_FirstName}" MinWidth="150" Width="200" FilterPopupMode="Default">
                <dxg:GridColumn.CellTemplate>
                    <DataTemplate>
                        <dxe:TextEdit Name="FirstNameFieldEditorEditor" Text="{Binding RowData.Row.Name,UpdateSourceTrigger=PropertyChanged , Mode=TwoWay}"
                                                  HorizontalAlignment="Stretch" InvalidValueBehavior="AllowLeaveEditor" >
                            <dxmvvm:Interaction.Behaviors>
                                <dxmvvm:EventToCommand EventName="Validate"
                                       Command="{Binding DataContext.FirstNameFieldValidateCommand, RelativeSource={RelativeSource AncestorType=dxg:GridControl}}"
                                       PassEventArgsToCommand="True"/>
                            </dxmvvm:Interaction.Behaviors>
                        </dxe:TextEdit>
                    </DataTemplate>
                </dxg:GridColumn.CellTemplate>
            </dxg:GridColumn>
            <dxg:GridColumn FieldName="Surname" Header="{DynamicResource ReadImportedCotactView_LastName}" MinWidth="150" Width="200" FilterPopupMode="Default">
                <dxg:GridColumn.CellTemplate>
                    <DataTemplate>
                        <dxe:TextEdit Name="LastNameFieldEditorEditor" Text="{Binding RowData.Row.Surname,UpdateSourceTrigger=PropertyChanged , Mode=TwoWay}"
                                                  HorizontalAlignment="Stretch" InvalidValueBehavior="AllowLeaveEditor" >
                            <dxmvvm:Interaction.Behaviors>
                                <dxmvvm:EventToCommand EventName="Validate"
                                       Command="{Binding DataContext.LastNameFieldValidateCommand, RelativeSource={RelativeSource AncestorType=dxg:GridControl}}"
                                       PassEventArgsToCommand="True"/>
                            </dxmvvm:Interaction.Behaviors>
                        </dxe:TextEdit>
                    </DataTemplate>
                </dxg:GridColumn.CellTemplate>
            </dxg:GridColumn>
            <dxg:GridColumn FieldName="Gender.Value" Header="{DynamicResource ReadImportedCotactView_Gender}" MinWidth="150" Width="200" FilterPopupMode="Default">
                <dxg:GridColumn.CellTemplate>
                    <DataTemplate>
                        <dxe:ComboBoxEdit Name="UserGenderEditor" ItemsSource="{Binding DataContext.GenderList, RelativeSource={RelativeSource AncestorType=dxg:GridControl},UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                                                  HorizontalAlignment="Stretch" IsTextEditable="False" ValidateOnTextInput="False" ValidateOnEnterKeyPressed="True" InvalidValueBehavior="AllowLeaveEditor"
                                                  DisplayMember="Value" ValueMember="IdLookupValue" 
                                                  AutoComplete="False" ImmediatePopup="True" IncrementalFiltering="True" 
                                          SelectedItem="{Binding RowData.Row.Gender,UpdateSourceTrigger=PropertyChanged , Mode=TwoWay}">
                            <dxmvvm:Interaction.Behaviors>
                                <dxmvvm:EventToCommand EventName="Validate"
                                       Command="{Binding DataContext.GenderValidateCommand, RelativeSource={RelativeSource AncestorType=dxg:GridControl}}"
                                       PassEventArgsToCommand="True"/>
                            </dxmvvm:Interaction.Behaviors>
                        </dxe:ComboBoxEdit>
                    </DataTemplate>
                </dxg:GridColumn.CellTemplate>
            </dxg:GridColumn>
            <dxg:GridColumn FieldName="Phone" Header="{DynamicResource ReadImportedCotactView_Phone}" MinWidth="150" Width="200" FilterPopupMode="Default"/>
            <dxg:GridColumn FieldName="CompanyDepartment.Value" Header="{DynamicResource ReadImportedCotactView_Department}" MinWidth="200" Width="250" FilterPopupMode="Default">
                <dxg:GridColumn.CellTemplate>
                    <DataTemplate>
                        <dxe:ComboBoxEdit Name="CompanyDepartmentEditor" ItemsSource="{Binding DataContext.DepartmentList, RelativeSource={RelativeSource AncestorType=dxg:GridControl},UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                                                  HorizontalAlignment="Stretch" IsTextEditable="False" ValidateOnTextInput="False" ValidateOnEnterKeyPressed="True" InvalidValueBehavior="AllowLeaveEditor"
                                                  DisplayMember="Value" ValueMember="IdLookupValue" 
                                                  SelectedItem="{Binding RowData.Row.CompanyDepartment,UpdateSourceTrigger=PropertyChanged , Mode=TwoWay}" AutoComplete="False" ImmediatePopup="True" IncrementalFiltering="True">
                            <dxmvvm:Interaction.Behaviors>
                                <dxmvvm:EventToCommand EventName="Validate"
                                       Command="{Binding DataContext.CompanyDepartmentEditorValidateCommand, RelativeSource={RelativeSource AncestorType=dxg:GridControl}}"
                                       PassEventArgsToCommand="True"/>
                            </dxmvvm:Interaction.Behaviors>
                        </dxe:ComboBoxEdit>
                    </DataTemplate>
                </dxg:GridColumn.CellTemplate>
            </dxg:GridColumn>
            <dxg:GridColumn FieldName="JobTitle" Header="{DynamicResource ReadImportedCotactView_JobTitle}" MinWidth="150" Width="200" FilterPopupMode="Default">
                <dxg:GridColumn.CellTemplate>
                    <DataTemplate>
                        <dxe:TextEdit Name="JobTitleFieldEditorEditor" Text="{Binding RowData.Row.JobTitle,UpdateSourceTrigger=PropertyChanged , Mode=TwoWay}"
                                                  HorizontalAlignment="Stretch" InvalidValueBehavior="AllowLeaveEditor" >
                            <dxmvvm:Interaction.Behaviors>
                                <dxmvvm:EventToCommand EventName="Validate"
                                       Command="{Binding DataContext.JobTitleFieldValidateCommand, RelativeSource={RelativeSource AncestorType=dxg:GridControl}}"
                                       PassEventArgsToCommand="True"/>
                            </dxmvvm:Interaction.Behaviors>
                        </dxe:TextEdit>
                    </DataTemplate>
                </dxg:GridColumn.CellTemplate>
            </dxg:GridColumn>
            <dxg:GridColumn FieldName="Email" Header="{DynamicResource ReadImportedCotactView_Email}" MinWidth="150" Width="200" FilterPopupMode="Default">
                <dxg:GridColumn.CellTemplate>
                    <DataTemplate>
                        <dxe:TextEdit Name="JobTitleFieldEditorEditor" Text="{Binding RowData.Row.Email,UpdateSourceTrigger=PropertyChanged , Mode=TwoWay}"
                                                  HorizontalAlignment="Stretch" InvalidValueBehavior="AllowLeaveEditor" >
                            <dxmvvm:Interaction.Behaviors>
                                <dxmvvm:EventToCommand EventName="Validate"
                                       Command="{Binding DataContext.EmailFieldValidateCommand, RelativeSource={RelativeSource AncestorType=dxg:GridControl}}"
                                       PassEventArgsToCommand="True"/>
                            </dxmvvm:Interaction.Behaviors>
                        </dxe:TextEdit>
                    </DataTemplate>
                </dxg:GridColumn.CellTemplate>
            </dxg:GridColumn>
            <dxg:GridColumn FieldName="ProductInvolved.Value" Header="{DynamicResource ReadImportedCotactView_ProductInvolved}" MinWidth="200" Width="250" FilterPopupMode="Default">
                <dxg:GridColumn.CellTemplate>
                    <DataTemplate>
                        <dxe:ComboBoxEdit Name="ProductInvolvedEditor" ItemsSource="{Binding DataContext.ProductInvolvedList, RelativeSource={RelativeSource AncestorType=dxg:GridControl},UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                                                  HorizontalAlignment="Stretch" IsTextEditable="False" ValidateOnTextInput="False" ValidateOnEnterKeyPressed="True" InvalidValueBehavior="AllowLeaveEditor"
                                                  DisplayMember="Value" ValueMember="IdLookupValue" 
                                                  SelectedItem="{Binding RowData.Row.ProductInvolved,UpdateSourceTrigger=PropertyChanged , Mode=TwoWay}" AutoComplete="False" ImmediatePopup="True" IncrementalFiltering="True">
                            <dxmvvm:Interaction.Behaviors>
                                <dxmvvm:EventToCommand EventName="Validate"
                                       Command="{Binding DataContext.ProductInvolvedEditorValidateCommand, RelativeSource={RelativeSource AncestorType=dxg:GridControl}}"
                                       PassEventArgsToCommand="True"/>
                            </dxmvvm:Interaction.Behaviors>
                        </dxe:ComboBoxEdit>
                    </DataTemplate>
                </dxg:GridColumn.CellTemplate>
            </dxg:GridColumn>
            <dxg:GridColumn FieldName="InfluenceLevel.Value" Header="{DynamicResource ReadImportedCotactView_InfluenceLevel}" MinWidth="200" Width="250" FilterPopupMode="Default">
                <dxg:GridColumn.CellTemplate>
                    <DataTemplate>
                        <dxe:ComboBoxEdit Name="InfluenceLevelEditor" ItemsSource="{Binding DataContext.InfluenceLevelList, RelativeSource={RelativeSource AncestorType=dxg:GridControl},UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                                                  HorizontalAlignment="Stretch" IsTextEditable="False" ValidateOnTextInput="False" ValidateOnEnterKeyPressed="True" InvalidValueBehavior="AllowLeaveEditor"
                                                  DisplayMember="Value" ValueMember="IdLookupValue" 
                                                  SelectedItem="{Binding RowData.Row.InfluenceLevel,UpdateSourceTrigger=PropertyChanged , Mode=TwoWay}" AutoComplete="False" ImmediatePopup="True" IncrementalFiltering="True">
                            <dxmvvm:Interaction.Behaviors>
                                <dxmvvm:EventToCommand EventName="Validate"
                                       Command="{Binding DataContext.InfluenceLevelEditorValidateCommand, RelativeSource={RelativeSource AncestorType=dxg:GridControl}}"
                                       PassEventArgsToCommand="True"/>
                            </dxmvvm:Interaction.Behaviors>
                        </dxe:ComboBoxEdit>
                    </DataTemplate>
                </dxg:GridColumn.CellTemplate>
            </dxg:GridColumn>
            <dxg:GridColumn FieldName="EmdepAffinity.Value" Header="{DynamicResource ReadImportedCotactView_EMDEPAffinity}" MinWidth="200" Width="250" FilterPopupMode="Default">
                <dxg:GridColumn.CellTemplate>
                    <DataTemplate>
                        <dxe:ComboBoxEdit Name="EmdepAffinityEditor" ItemsSource="{Binding DataContext.EmdepAffinityList, RelativeSource={RelativeSource AncestorType=dxg:GridControl},UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                                                  HorizontalAlignment="Stretch" IsTextEditable="False" ValidateOnTextInput="False" ValidateOnEnterKeyPressed="True" InvalidValueBehavior="AllowLeaveEditor"
                                                  DisplayMember="Value" ValueMember="IdLookupValue" 
                                                  SelectedItem="{Binding RowData.Row.EmdepAffinity,UpdateSourceTrigger=PropertyChanged , Mode=TwoWay}" AutoComplete="False" ImmediatePopup="True" IncrementalFiltering="True">
                            <dxmvvm:Interaction.Behaviors>
                                <dxmvvm:EventToCommand EventName="Validate"
                                       Command="{Binding DataContext.EmdepAffinityEditorValidateCommand, RelativeSource={RelativeSource AncestorType=dxg:GridControl}}"
                                       PassEventArgsToCommand="True"/>
                            </dxmvvm:Interaction.Behaviors>
                        </dxe:ComboBoxEdit>
                    </DataTemplate>
                </dxg:GridColumn.CellTemplate>
            </dxg:GridColumn>
            <dxg:GridControl.TotalSummary>
                <dxg:GridSummaryItem x:Name="summary" FieldName="Name" SummaryType="Count" DisplayFormat="Total Count: {0}" Alignment="Left"/>
            </dxg:GridControl.TotalSummary>
            <dxg:GridControl.View>
                <dxg:TableView x:Name="tblCustomerAccount" 
                       AllowBestFit="True"
                       AllowEditing="True"
                       ShowGroupPanel="False" 
                       ShowIndicator="False"
                       AutoWidth="True"                               
                       ShowSearchPanelMode="Always" 
                       SearchPanelHorizontalAlignment="Stretch"
                       HorizontalScrollbarVisibility="Auto"
                       VerticalScrollbarVisibility="Auto"
                       NavigationStyle="Cell" 
                       ShowFixedTotalSummary="True"
                       AllowPerPixelScrolling="True"
                       AllowConditionalFormattingMenu="True" >
                    <dxg:TableView.FormatConditions>
                        <dxg:FormatCondition Expression="[IsRowError] = True" ApplyToRow="True">
                            <dxg:Format Background="#FFFF0000"/>
                        </dxg:FormatCondition>
                    </dxg:TableView.FormatConditions>
                    <dxmvvm:Interaction.Behaviors>
                        <dxmvvm:EventToCommand Event="PreviewKeyDown" Command="{Binding UpdateSelectedFieldsCommand}" PassEventArgsToCommand="True" CommandParameter="{Binding DataContext.RowData.FieldName}"/>
                    </dxmvvm:Interaction.Behaviors>
                </dxg:TableView>
            </dxg:GridControl.View>
        </dxg:GridControl>
        <StackPanel Grid.Row=" 1" 
                    HorizontalAlignment="Center" 
                    Orientation="Horizontal"
                    Margin="20,0,0,0"
                    Width="290">
            <Button Content="{DynamicResource AcceptButton}"
                    Command="{Binding AcceptButtonCommand}"  CommandParameter="{Binding ElementName=tblAttendance}"
                    Height="30"
                    Width="100" IsEnabled="{Binding IsAcceptEnable, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                    Margin="0,0,30,0"
                    Style="{DynamicResource Button16Style}"
                    VerticalAlignment="Bottom" />
            <Button Content="{DynamicResource CancelButton}"
                    Command="{Binding CancelButtonCommand}" 
                    Height="30"
                    Width="100"
                    Margin="30,0,0,0"
                    Style="{DynamicResource Button16Style}"
                    VerticalAlignment="Bottom" />
        </StackPanel>
    </Grid>
    <!--<i:Interaction.Triggers>
        <i:EventTrigger EventName="KeyDown">
            <behaviors:InvokeDelegateCommandAction Command="{Binding CommandTextInput}" CommandParameter="{Binding Path=InvokeParameter, RelativeSource={RelativeSource Self}}"/>
        </i:EventTrigger>
    </i:Interaction.Triggers>-->
</dxwui:WinUIDialogWindow> 
