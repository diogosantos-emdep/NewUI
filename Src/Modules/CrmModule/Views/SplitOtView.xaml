<UserControl
    x:Class="Emdep.Geos.Modules.Crm.Views.SplitOtView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:dxwui="http://schemas.devexpress.com/winfx/2008/xaml/windowsui"
    xmlns:dx="http://schemas.devexpress.com/winfx/2008/xaml/core"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:Emdep.Geos.Modules.Crm.Views"
    xmlns:dxe="http://schemas.devexpress.com/winfx/2008/xaml/editors"
    xmlns:dxg="http://schemas.devexpress.com/winfx/2008/xaml/grid"
    xmlns:dxlc="http://schemas.devexpress.com/winfx/2008/xaml/layoutcontrol"
    xmlns:ViewModels="clr-namespace:Emdep.Geos.Modules.Crm.ViewModels"
    xmlns:Views="clr-namespace:Emdep.Geos.Modules.Crm.Views"
    xmlns:dxci="http://schemas.devexpress.com/winfx/2008/xaml/core/internal"
    xmlns:UIHelper="clr-namespace:Emdep.Geos.UI.Helper;assembly=Emdep.Geos.UI.Helper"
    xmlns:dxmvvm="http://schemas.devexpress.com/winfx/2008/xaml/mvvm"
    xmlns:dxdo="http://schemas.devexpress.com/winfx/2008/xaml/docking"
    xmlns:dxb="http://schemas.devexpress.com/winfx/2008/xaml/bars"
    xmlns:ve="http://schemas.devexpress.com/winfx/2008/xaml/docking/visualelements"
    xmlns:UIConverter ="clr-namespace:Emdep.Geos.UI.Converters;assembly=Emdep.Geos.UI.Converters"
    xmlns:Validation ="clr-namespace:Emdep.Geos.UI.Validations;assembly=Emdep.Geos.UI.Validations"
    xmlns:GeosApplication="clr-namespace:Emdep.Geos.UI.Common;assembly=Emdep.Geos.UI.Common"
    xmlns:i="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity"
    mc:Ignorable="d"
    d:DesignHeight="670"
    d:DesignWidth="500"
    Style="{DynamicResource UserControlStyle}">

    <UserControl.Resources>
        <DataTemplate x:Key="headerTemplate" >
            <TextBlock Text="{Binding TaskOfferCode,UpdateSourceTrigger=PropertyChanged}" />
        </DataTemplate>

        <!--<Style x:Key="tabItemStyle" TargetType="dx:DXTabItem">
            <Setter Property="Header" Value="{Binding TaskOfferCode,UpdateSourceTrigger=PropertyChanged}"/>
            <Setter Property="CloseCommand" Value="{Binding RelativeSource={RelativeSource Self}, Path=Owner.DataContext.CloseTaskCommand}" />
            <Setter Property="CloseCommandParameter" Value="{Binding}" />
        </Style>-->
        <DataTemplate x:Key="FlowLayoutitemTemplate">
            <dx:DXTabControl
            MaxWidth="700"
            ItemsSource="{Binding Tasks ,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}"
            Name="DXTabControl2"
            TabContentCacheMode="CacheTabsOnSelecting">
                <dx:DXTabControl.ItemContainerStyle>
                    <Style TargetType="dx:DXTabItem">
                        <Setter Property="Header" Value="{Binding TaskOfferCode,UpdateSourceTrigger=PropertyChanged}"/>
                        <Setter Property="CloseCommand" Value="{Binding RelativeSource={RelativeSource AncestorType=UserControl}, Path=DataContext.CloseTaskCommand}" />
                        <Setter Property="CloseCommandParameter" Value="{Binding}" />
                    </Style>
                </dx:DXTabControl.ItemContainerStyle>
                <dx:DXTabItem >
                    <ScrollViewer ScrollViewer.HorizontalScrollBarVisibility="Auto" ScrollViewer.VerticalScrollBarVisibility="Auto">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="5" />
                                <RowDefinition Height="40" />
                                <RowDefinition Height="35" />
                                <RowDefinition Height="35" />
                                <RowDefinition Height="AUTO" />
                                <RowDefinition Height="35" />
                                <RowDefinition Height="35" />
                                <RowDefinition Height="60" />
                                <RowDefinition Height="35" />
                                <RowDefinition Height="35" />
                                <RowDefinition Height="35" />
                                <RowDefinition Height="35" />
                                <RowDefinition Height="35" />
                                <RowDefinition Height="35" />
                                <RowDefinition Height="35" />
                                <RowDefinition Height="35" />
                                <RowDefinition Height="35" />
                                <RowDefinition Height="35" />
                                <RowDefinition Height="35" />
                                <RowDefinition Height="35" />
                                <RowDefinition Height="35" />
                                <RowDefinition Height="35" />
                                <RowDefinition Height="35" />
                            </Grid.RowDefinitions>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="170" />
                                <ColumnDefinition Width="250" />
                                <!--<ColumnDefinition Width="40"/>
                                <ColumnDefinition Width="150"/>
                                <ColumnDefinition Width="200"/>-->
                            </Grid.ColumnDefinitions>
                             <StackPanel Orientation="Horizontal" Grid.Column="0" Grid.Row="1" HorizontalAlignment="Right" VerticalAlignment="Top" Height="30" >
                               <Label HorizontalAlignment="Right" VerticalAlignment="Top" Content="{DynamicResource LeadsAddViewStatus}" Margin="0,0,5,0" />
                                <dxe:TextEdit   Width="20" Margin="0,0,5,0"  
                                                HorizontalAlignment="Right"
                                                VerticalAlignment="Top"
                                                Foreground="Transparent"
                                                IsReadOnly="True"
                                                ShowBorder="False" 
                                                Text="{Binding DataContext.IsSplitOfferStatusDisabled,RelativeSource={RelativeSource AncestorType=dx:DXTabControl}}">
                                    <dxe:TextEdit.EditValue>
                                        <Binding Mode="TwoWay"
                                                    Path="DataContext.IsSplitOfferStatusDisabled"
                                                    RelativeSource="{RelativeSource AncestorType=dx:DXTabControl}"
                                                    UpdateSourceTrigger="PropertyChanged"
                                                    ValidatesOnDataErrors="True">
                                            <Binding.ValidationRules>
                                                <Validation:SplitOtValidationRule FieldName="IsSplitOfferStatusDisabled" />
                                            </Binding.ValidationRules>
                                        </Binding>
                                    </dxe:TextEdit.EditValue>
                                </dxe:TextEdit>
                            </StackPanel>

                            <!--<Label
                        Grid.Column="0"
                        Grid.Row="1"
                        Margin="0,0,10,0"
                        HorizontalAlignment="Right"
                        Content= "{DynamicResource LeadsAddViewStatus}" />-->
                            <dxe:ComboBoxEdit
                        Grid.Column="1"
                        Grid.Row="1"
                        Width="250"
                        Height="30"
                        HorizontalAlignment="Stretch"
                        VerticalAlignment="Top"
                        ApplyItemTemplateToSelectedItem="True"
                        DisplayMember="Name"
                        FocusManager.IsFocusScope="False"
                        IsSynchronizedWithCurrentItem="True"
                        IsTextEditable="False"
                        ItemsSource="{Binding DataContext.GeosStatusListSplit, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                SelectedIndex="{Binding SelectedGeosStatusTask, Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}">
                                <dxe:ComboBoxEdit.ItemContainerStyle>
                                    <Style TargetType="dxe:ComboBoxEditItem">
                                        <Setter Property="HorizontalContentAlignment" Value="Stretch" />
                                        <Setter Property="IsEnabled" Value="{Binding IsEnabled}"/>
                                    </Style>
                                </dxe:ComboBoxEdit.ItemContainerStyle>
                                <dxe:ComboBoxEdit.ItemTemplate>
                                    <DataTemplate>
                                        <Border
                                    Margin="2,0,0,0"
                                    Background="{Binding HtmlColor}"
                                    BorderBrush="{Binding ColorName}"
                                    Padding="2">
                                            <TextBlock
                                        Margin="2,0,0,0"
                                        HorizontalAlignment="Center"
                                        Foreground="Black"
                                        Padding="2"
                                        Text="{Binding Name}" />
                                        </Border>
                                    </DataTemplate>
                                </dxe:ComboBoxEdit.ItemTemplate>
                                <dxe:ComboBoxEdit.EditNonEditableTemplate>
                                    <ControlTemplate>
                                        <Border
                                    Margin="2,2,2,2"
                                    Background="{Binding EditValue.HtmlColor}"
                                    BorderBrush="{Binding EditValue.ColorName}">
                                            <TextBlock
                                        HorizontalAlignment="Center"
                                        Foreground="Black"
                                        Text="{Binding EditValue.Name}" />
                                        </Border>
                                    </ControlTemplate>
                                </dxe:ComboBoxEdit.EditNonEditableTemplate>
                                <i:Interaction.Triggers>
                                    <i:EventTrigger EventName="SelectedIndexChanged">
                                        <i:InvokeCommandAction Command="{Binding DataContext.SplitOtStatusSelectedIndexChangedCommand,RelativeSource={RelativeSource AncestorType=UserControl}}" />
                                    </i:EventTrigger>
                                </i:Interaction.Triggers>
                                <!--<dxe:ComboBoxEdit.SelectedIndex>
                                    <Binding
                                                Mode="TwoWay"
                                                Path="SelectedGeosStatusTask"
                                                UpdateSourceTrigger="PropertyChanged"
                                                ValidatesOnDataErrors="True">
                                        <Binding.ValidationRules>
                                            <Validation:SplitOtValidationRule FieldName="SelectedGeosStatusTask" />
                                        </Binding.ValidationRules>
                                    </Binding>
                                </dxe:ComboBoxEdit.SelectedIndex>-->
                            </dxe:ComboBoxEdit>
                            <Label
                        Grid.Column="0"
                        Grid.Row="2"
                        Margin="0,0,10,0"
                        HorizontalAlignment="Right"
                        Content="{DynamicResource LeadsAddViewCode}" />
                            <Image
                        Grid.Column="0"
                        Grid.Row="2"
                        Margin="20 4 60 0"
                        Width="18"
                        Height="18"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Top"
                        DataContext="{Binding DataContext,RelativeSource={RelativeSource AncestorType=dxlc:GroupBox}}"
                        Style="{DynamicResource SplitStatusButtonImageStyle}">
                                <Image.ToolTip>
                                    <TextBlock HorizontalAlignment="Stretch" Text="{DynamicResource ExclamationsSplitCode}" />
                                </Image.ToolTip>
                            </Image>
                            <DockPanel Grid.Column="1" Grid.Row="2">
                                <dxe:ComboBoxEdit
                            Width="110"
                            Height="25"
                            VerticalAlignment="Top"
                            DisplayMember="Name"
                            IsEnabled="False"
                            IsTextEditable="False"
                            ItemsSource="{Binding DataContext.OfferTypeList,RelativeSource={RelativeSource AncestorType=UserControl}}"
                            SelectedIndex="{Binding SelectedIndexOfferTypeTask,UpdateSourceTrigger=PropertyChanged,Mode=OneWay}"
                            SelectedItem="{Binding DataContext.GeosStatusTask, Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}"
                            ValueMember="IdOfferType" />
                                <dxe:TextEdit
                            Margin="5,0,0,0"
                            HorizontalAlignment="Stretch"
                            VerticalAlignment="Top"
                            IsReadOnly="True"
                            Text="{Binding TaskOfferCode,UpdateSourceTrigger=PropertyChanged}" />
                            </DockPanel>

                            <!--Amount-->
                            <Label
                        Grid.Column="0"
                        Grid.Row="3"
                        Margin="0,0,10,0"
                        HorizontalAlignment="Right"
                        Content="{DynamicResource LeadsAddViewAmount}" />
                            <StackPanel
                        Grid.Column="1"
                        Grid.Row="3"
                        HorizontalAlignment="Stretch">
                                <dxlc:LayoutControl
                            Margin="0,0,0,0"
                            Orientation="Vertical"
                            Padding="0,0,0,0">
                                    <StackPanel Orientation="Horizontal">
                                        <dxlc:LayoutItem>
                                            <dxe:TextEdit Name="TxtOfferAmountSplit"
                                                Width="185"
                                                MaskType="Numeric"
                                                HorizontalAlignment="Stretch"
                                                HorizontalContentAlignment="Right"
                                                Text="{Binding OfferAmountSplit, Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}">
                                                <dxe:TextEdit.EditValue>
                                                    <Binding
                                                Mode="TwoWay"
                                                Path="OfferAmountSplit"
                                                UpdateSourceTrigger="PropertyChanged"
                                                ValidatesOnDataErrors="True">
                                                        <Binding.ValidationRules>
                                                            <Validation:SplitOtValidationRule FieldName="OfferAmountSplit" />
                                                        </Binding.ValidationRules>
                                                    </Binding>
                                                </dxe:TextEdit.EditValue>
                                                <dxmvvm:Interaction.Behaviors>
                                                    <dxmvvm:EventToCommand EventName="LostFocus" Command="{Binding DataContext.OfferAmountSplitLostFocusCommand,RelativeSource={RelativeSource AncestorType=UserControl}}"  PassEventArgsToCommand="True"/>
                                                    <dxmvvm:EventToCommand EventName="EditValueChanging" Command="{Binding SplitTextEditValueChangingCommand}" PassEventArgsToCommand="True"/>
                                                </dxmvvm:Interaction.Behaviors>
                                            </dxe:TextEdit>
                                        </dxlc:LayoutItem>
                                        <dxlc:LayoutItem>
                                            <dxe:ComboBoxEdit
                                        Width="60"
                                        Margin="5,0,0,0"
                                        HorizontalAlignment="Right"
                                        VerticalAlignment="Top"
                                        DisplayMember="Name"
                                        IsTextEditable="False" ValidateOnTextInput="False" AutoComplete="True" ImmediatePopup="True" IncrementalFiltering="True"
                                        ItemsSource="{Binding DataContext.Currencies,RelativeSource={RelativeSource AncestorType=UserControl}}"
                                        SelectedIndex="{Binding SelectedIndexCurrencyTask,Mode=TwoWay}"
                                        ValueMember="IdCurrency" >
                                                <dxmvvm:Interaction.Behaviors>
                                                    <dxmvvm:EventToCommand EventName="SelectedIndexChanged" Command="{Binding SplitSelectedIndexChangedCommand}" PassEventArgsToCommand="True"/>
                                                </dxmvvm:Interaction.Behaviors>
                                            </dxe:ComboBoxEdit> 
                                        </dxlc:LayoutItem>
                                    </StackPanel>
                                </dxlc:LayoutControl>
                            </StackPanel>
                            
                            <!--Converted Amount-->
                            <Label Grid.Column="1" Grid.Row="4" HorizontalAlignment="Stretch" VerticalContentAlignment="Top"
                                        VerticalAlignment="Top" Content="{Binding ConvertedOfferAmountSplit, Mode=TwoWay ,UpdateSourceTrigger=PropertyChanged}"
                                               HorizontalContentAlignment="Right" FontWeight="Bold" FontSize="14" Margin="0 -5 0 0" Height="22">
                                <Label.Style>
                                    <Style TargetType="{x:Type Label}">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding GridRowHeightForAmountSplit}" Value="True">
                                                <Setter Property="Label.Visibility" Value="Visible" />
                                            </DataTrigger>
                                            <DataTrigger Value="False" Binding="{Binding GridRowHeightForAmountSplit}">
                                                <Setter Property="Label.Visibility" Value="Collapsed" />
                                            </DataTrigger>
                                            <DataTrigger Value="0" Binding="{Binding ElementName=TxtOfferAmountSplit, Path=Text}">
                                                <Setter Property="Label.Visibility" Value="Collapsed" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Label.Style>
                            </Label>

                            <!--CloseDate-->
                            <Label
                        Grid.Column="0"
                        Grid.Row="5"
                        Margin="0,0,10,0"
                        HorizontalAlignment="Right"
                        Content= "{DynamicResource LeadsAddViewCloseDate}" />
                            <dxe:DateEdit
                        Grid.Column="1"
                        Grid.Row="5"
                        VerticalAlignment="Top"
                        HorizontalContentAlignment="Right"
                        InvalidValueBehavior="AllowLeaveEditor"
                        IsReadOnly="{Binding DataContext.IsControlEnable,Mode=OneTime, RelativeSource={RelativeSource AncestorType=UserControl}}"
                        IsTextEditable="False"
                        Mask="{Binding CultureInfo.CurrentCulture.DateTimeFormat.YearMonthPattern}"
                        MaskUseAsDisplayFormat="True"
                        MinValue="{Binding OfferCloseDateSplitMinValue, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                <dxe:DateEdit.EditValue>
                                    <Binding
                                Mode="TwoWay"
                                Path="OfferCloseDateSplit"
                                UpdateSourceTrigger="PropertyChanged"
                                ValidatesOnDataErrors="True">
                                        <Binding.ValidationRules>
                                            <Validation:SplitOtValidationRule FieldName="OfferCloseDateSplit" />
                                        </Binding.ValidationRules>
                                    </Binding>
                                </dxe:DateEdit.EditValue>
                                <dxe:DateEdit.ErrorToolTipContentTemplate>
                                    <DataTemplate>
                                        <TextBlock x:Name="txtErrorMsg" Text="Can not set on previous date" />
                                    </DataTemplate>
                                </dxe:DateEdit.ErrorToolTipContentTemplate>
                                <dxmvvm:Interaction.Behaviors>
                                    <dxmvvm:EventToCommand EventName="EditValueChanged" Command="{Binding OnSplitDateEditValueChangingCommand}" PassEventArgsToCommand="True"/>
                                </dxmvvm:Interaction.Behaviors>
                            </dxe:DateEdit>

                            <!--RFQReceptionDate-->
                            <Label
                        Grid.Column="0"
                        Grid.Row="6"
                        Margin="0,0,10,0"
                        HorizontalAlignment="Right"
                        Content= "{DynamicResource LeadsEditViewRFQReceptionDate}" />
                            <dxe:DateEdit
                        Grid.Column="2"
                        Grid.Row="6"
                        VerticalAlignment="Top"
                        HorizontalContentAlignment="Right"
                        InvalidValueBehavior="AllowLeaveEditor"
                        IsTextEditable="False"
                        Mask="{Binding CultureInfo.CurrentCulture.DateTimeFormat.YearMonthPattern}"
                        MaskUseAsDisplayFormat="True">
                                <dxe:DateEdit.EditValue>
                                    <Binding
                                Mode="TwoWay"
                                Path="RFQReceptionDateSplit"
                                UpdateSourceTrigger="PropertyChanged"
                                ValidatesOnDataErrors="True">
                                        <Binding.ValidationRules>
                                            <Validation:SplitOtValidationRule FieldName="RFQReceptionDateSplit" />
                                        </Binding.ValidationRules>
                                    </Binding>
                                </dxe:DateEdit.EditValue>
                                <dxmvvm:Interaction.Behaviors>
                                    <dxmvvm:EventToCommand EventName="EditValueChanged" Command="{Binding OnSplitDateEditValueChangingCommand}" PassEventArgsToCommand="True"/>
                                </dxmvvm:Interaction.Behaviors>
                            </dxe:DateEdit>

                            <!--QuoteSentDate-->
                            <Label
                        Grid.Column="0"
                        Grid.Row="7"
                        Margin="0,0,10,0"
                        HorizontalAlignment="Right"
                        Content= "{DynamicResource LeadsEditViewQuoteSentDate}" />
                            <dxe:DateEdit
                        Grid.Column="2"
                        Grid.Row="7"
                        VerticalAlignment="Top"
                        HorizontalContentAlignment="Right"
                        InvalidValueBehavior="AllowLeaveEditor"
                        IsTextEditable="False"
                        Mask="{Binding CultureInfo.CurrentCulture.DateTimeFormat.YearMonthPattern}"
                        MaskUseAsDisplayFormat="True">
                                <dxe:DateEdit.EditValue>
                                    <Binding
                                Mode="TwoWay"
                                Path="QuoteSentDateSplit"
                                UpdateSourceTrigger="PropertyChanged"
                                ValidatesOnDataErrors="True">
                                        <Binding.ValidationRules>
                                            <Validation:SplitOtValidationRule FieldName="QuoteSentDateSplit" />
                                        </Binding.ValidationRules>
                                    </Binding>
                                </dxe:DateEdit.EditValue>
                                <dxmvvm:Interaction.Behaviors>
                                    <dxmvvm:EventToCommand EventName="EditValueChanged" Command="{Binding OnSplitDateEditValueChangingCommand}" PassEventArgsToCommand="True"/>
                                </dxmvvm:Interaction.Behaviors>
                            </dxe:DateEdit>

                            <!--ConfidentalLevel-->
                            <Label
                        Grid.Row="8"
                        Margin="0,0,10,0"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Center"
                        Content="{DynamicResource LeadsAddViewConfidentalLevel}" />
                            <StackPanel
                        Grid.Row="8"
                        Grid.Column="1"
                        VerticalAlignment="Center"
                        HorizontalAlignment="Left"
                        Orientation="Horizontal">
                                <dxe:RatingEdit
                            x:Name="Ratingeditor"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            EditValue="{Binding ElementName=comboBoxEdit1, Path=EditValue, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged,Converter={UIConverter:CustConverter}}"
                            Maximum="100"
                            Minimum="0"
                            Precision="Full">
                                    <dxe:RatingEdit.EditTemplate>
                                        <ControlTemplate>
                                            <dxe:RatingControl
                                        Height="25"
                                        Width="158"
                                        Name="PART_Editor" />
                                        </ControlTemplate>
                                    </dxe:RatingEdit.EditTemplate>
                                    <dxe:RatingEdit.ItemStyle>
                                        <Style TargetType="dxe:RatingItem">
                                            <Setter Property="DataContext" Value="{Binding Path=(dxe:BaseEdit.OwnerEdit).DataContext}" />
                                            <Style.Triggers>
                                                <DataTrigger Value="False" Binding="{Binding HoverBackgroundTask, Converter={UIConverter:IsNullColorConverter}}">
                                                    <Setter Property="HoverBackground" Value="{Binding ActualHoverValue, Converter={UIConverter:ColorToBrushConverter}, RelativeSource={RelativeSource AncestorType=dxe:RatingControl}, ConverterParameter=hover}" />
                                                </DataTrigger>
                                                <DataTrigger Value="False" Binding="{Binding SelectedBackgroundTask,Mode=TwoWay, Converter={UIConverter:IsNullColorConverter}}">
                                                    <Setter Property="SelectedBackground" Value="{Binding SelectedBackgroundTask,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged, Converter={UIConverter:ColorToBrushConverter}}" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </dxe:RatingEdit.ItemStyle>
                                </dxe:RatingEdit>
                                <dxe:ComboBoxEdit
                            Margin="18,0,0,0"
                            Width="70"
                            Height="30"
                            HorizontalAlignment="Right"
                            HorizontalContentAlignment="Center"
                            ApplyItemTemplateToSelectedItem="True"
                            EditValue="{Binding SelectedIndexConfidentialLevelTask,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}"
                            IsTextEditable="False"
                            ItemsSource="{Binding DataContext.ConfidentialLevelList,RelativeSource={RelativeSource AncestorType=UserControl}}"
                            Name="comboBoxEdit1">
                                    <dxe:ComboBoxEdit.ItemTemplate>
                                        <DataTemplate>
                                            <TextBlock Text="{Binding StringFormat={}{0}%}" />
                                        </DataTemplate>
                                    </dxe:ComboBoxEdit.ItemTemplate>
                                </dxe:ComboBoxEdit>
                            </StackPanel>
                            <!--<StackPanel
                    Grid.Column="0"
                    Grid.ColumnSpan="2"
                    Grid.Row="8"
                    Grid.RowSpan="9"
                    Orientation="Horizontal">
                  
                </StackPanel>-->
                            <Label
                        Grid.Column="0"
                        Grid.Row="9"
                        Margin="0,0,10,0"
                        HorizontalAlignment="Left"
                        Content= "{DynamicResource LeadsAddViewProductService}" />
                            <dxe:TextEdit
                        Grid.Row="9"
                        Grid.Column="1"
                        HorizontalAlignment="Left"
                        VerticalAlignment="Center"
                        Foreground="Transparent"
                        IsReadOnly="True"
                        ShowBorder="False"
                        Text="{Binding ProductAndServicesSplitCount}">
                                <dxe:TextEdit.EditValue>
                                    <Binding
                                Mode="TwoWay"
                                Path="ProductAndServicesSplitCount"
                                UpdateSourceTrigger="PropertyChanged"
                                ValidatesOnDataErrors="True">
                                        <Binding.ValidationRules>
                                            <Validation:SplitOtValidationRule FieldName="ProductAndServicesSplitCount" />
                                        </Binding.ValidationRules>
                                    </Binding>
                                </dxe:TextEdit.EditValue>
                            </dxe:TextEdit>
                            
                            <dxe:CheckEdit
                        Grid.Column="0"
                        Grid.Row="10"
                        Width="150"
                        HorizontalAlignment="Left"
                        Content= "{DynamicResource LeadsAddViewShowAll}"
                          Uid="{Binding Tasks[SelectedIndex].IsShowAllSplit,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}"
                        EditValue="{Binding Tasks[SelectedIndex].IsShowAllSplit,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}">
                                <dxmvvm:Interaction.Behaviors>
                                    <dxmvvm:EventToCommand 
                                Command="{Binding DataContext.ShowAllCheckedSplitCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                CommandParameter="{Binding ElementName=treeListView1}"
                                EventName="Checked" PassEventArgsToCommand="True"  />
                                    <dxmvvm:EventToCommand
                                Command="{Binding DataContext.ShowAllUncheckedSplitCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                CommandParameter="{Binding ElementName=treeListView1}"
                                EventName="Unchecked" />
                                </dxmvvm:Interaction.Behaviors>
                            </dxe:CheckEdit>
                            <dxg:TreeListControl
                        Grid.Column="0"
                        Grid.Row="11"
                        Grid.RowSpan="11"
                        Grid.ColumnSpan="2"
                        Height="220"
                        Width="Auto"
                        VerticalAlignment="Top"
                        ItemsSource="{Binding DttableSplit, IsAsync=True, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                        Name="TreeListControl1"
                        ScrollViewer.HorizontalScrollBarVisibility="Visible"
                        ShowBorder="True">
                                <dxg:TreeListControl.Columns>
                                    <dxg:TreeListColumn
                                Width="30"
                                Header=" "
                                HorizontalHeaderContentAlignment="Center">
                                        <dxg:TreeListColumn.CellTemplate>
                                            <DataTemplate>
                                                <dxe:CheckEdit
                                            HorizontalAlignment="Center"
                                            IsChecked="{Binding RowData.Row.IsChecked,Mode=TwoWay}"
                                            Tag="{Binding Data.idOfferOption}"
                                                    Uid="{Binding Data.SplitTabIndex}">
                                                    <dxe:CheckEdit.Style>
                                                        <Style TargetType="{x:Type dxe:CheckEdit}">
                                                            <Setter Property="Visibility" Value="Visible" />
                                                            <Setter Property="IsEnabled" Value="True" />
                                                            <Style.Triggers>
                                                                <DataTrigger Value="{x:Null}" Binding="{Binding RowData.Row.Qty}">
                                                                    <Setter Property="Visibility" Value="Hidden" />
                                                                    <Setter Property="IsEnabled" Value="False" />
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </dxe:CheckEdit.Style>
                                                    <dxmvvm:Interaction.Triggers>
                                                        <dxmvvm:EventToCommand
                                                    Command="{Binding DataContext.CheckEditQuantityValueChangedSplitCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                    EventName="EditValueChanged"
                                                    PassEventArgsToCommand="True" />
                                                    </dxmvvm:Interaction.Triggers>
                                                </dxe:CheckEdit>
                                            </DataTemplate>
                                        </dxg:TreeListColumn.CellTemplate>
                                    </dxg:TreeListColumn>
                                    <dxg:TreeListColumn
                                Width="150"
                                FieldName="{Binding RowData.Row.Name}"
                                Header="Name"
                                HorizontalHeaderContentAlignment="Center">
                                        <dxg:TreeListColumn.CellTemplate>
                                            <DataTemplate>
                                                <TextBlock Text="{Binding RowData.Row.Name}" />
                                            </DataTemplate>
                                        </dxg:TreeListColumn.CellTemplate>
                                    </dxg:TreeListColumn>
                                    <dxg:TreeListColumn FieldName="{Binding RowData.Row.Qty}" Header="Qty" Width="50">
                                        <dxg:TreeListColumn.CellTemplate>
                                            <DataTemplate>
                                                <dxe:SpinEdit
                                            Value="{Binding RowData.Row.Qty,Mode=TwoWay}"
                                            AllowRoundOutOfRangeValue="True"
                                            Increment="1"
                                            IsFloatValue="False"
                                            MaxValue="999"
                                            MinValue="0"
                                            Tag="{Binding RowData.Row.idOfferOption}"
                                                    Uid="{Binding RowData.Row.SplitTabIndex}"
                                                    >
                                                    <dxe:SpinEdit.Style>
                                                        <Style TargetType="{x:Type dxe:SpinEdit}">
                                                            <Setter Property="Visibility" Value="Visible" />
                                                            <Setter Property="IsEnabled" Value="True" />
                                                            <Setter Property="IsReadOnly" Value="False" />
                                                            <Style.Triggers>
                                                                <DataTrigger Value="{x:Null}" Binding="{Binding RowData.Row.Qty}">
                                                                    <Setter Property="Visibility" Value="Hidden" />
                                                                    <Setter Property="IsEnabled" Value="False" />
                                                                    <Setter Property="IsReadOnly" Value="True" />
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </dxe:SpinEdit.Style>
                                                    <dxmvvm:Interaction.Triggers>
                                                        <dxmvvm:EventToCommand
                                                    Command="{Binding DataContext.QuantityEditValueChangedSplitCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                                    EventName="EditValueChanged"
                                                    PassEventArgsToCommand="True" />
                                                    </dxmvvm:Interaction.Triggers>
                                                </dxe:SpinEdit>
                                            </DataTemplate>
                                        </dxg:TreeListColumn.CellTemplate>
                                    </dxg:TreeListColumn>
                                </dxg:TreeListControl.Columns>
                                <dxg:TreeListControl.View>
                                    <dxg:TreeListView
                                AutoExpandAllNodes="True"
                                AutoWidth="True"
                                KeyFieldName="idOfferOption"
                                Name="treeListView1"
                                ColumnChooserColumnDisplayMode="ShowHiddenColumnsOnly"
                                ParentFieldName="IdOfferOptionType">
                                        <dxmvvm:Interaction.Behaviors>
                                            <dxmvvm:EventToCommand
                                        Command="{Binding DataContext.CustomNodeFilterSplitCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                        EventName="CustomNodeFilter"
                                        PassEventArgsToCommand="True"
                                        SourceObject="{Binding ElementName=treeListView1}" />
                                        </dxmvvm:Interaction.Behaviors>
                                    </dxg:TreeListView>
                                </dxg:TreeListControl.View>
                            </dxg:TreeListControl>
                        </Grid>
                    </ScrollViewer>
                </dx:DXTabItem>
                <dx:DXTabControl.View>
                    <dx:TabControlScrollView
                    x:Name="DXTabControl1"
                    HideButtonShowMode="InAllTabs"
                    NewButtonShowMode="NoWhere"
                    NewTabCommand="{Binding AddNewTaskCommand}" />
                </dx:DXTabControl.View>
                <dxmvvm:Interaction.Behaviors>
                    <dxmvvm:EventToCommand
                    Command="{Binding DataContext.SelectionChangedCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                    EventName="SelectionChanged"
                    PassEventArgsToCommand="True" />
                </dxmvvm:Interaction.Behaviors>
            </dx:DXTabControl>
        </DataTemplate>
    </UserControl.Resources>

    <Grid >
        <Grid.RowDefinitions>
            <!--<RowDefinition Height="40" />-->
            <RowDefinition Height="*" />
            <RowDefinition Height="40" />
        </Grid.RowDefinitions>
        <!--<StackPanel               
            Grid.Row="0"
             Margin="0,0,0,0"
            Width="100"
            HorizontalAlignment="Right"
            VerticalAlignment="Top"
            Orientation="Horizontal">
            <Button
                Height="30"
                Width="50"
                Margin="0,-10,0,0"
                VerticalAlignment="Top"
                Content="Add"
                Command="{Binding AddNewTaskCommand}"               
                Style="{DynamicResource Button16Style}" />
        </StackPanel>-->
        <!--<Button Grid.Row="0"
                Height="40"
                Width="40"
                HorizontalAlignment="Right"
                VerticalAlignment="Top"
                Command="{Binding AddNewTaskCommand}">
            <Button.ToolTip>
                <TextBlock Text="{DynamicResource ButtonSplit}" />
            </Button.ToolTip>
            <Button.ContentTemplate>
                <DataTemplate>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <Image Style="{ DynamicResource SplitLeadOfferImageStyle}" Grid.Column="1" Height="24" Width="24" HorizontalAlignment="Right" Margin="-10" />
                    </Grid>
                </DataTemplate>
            </Button.ContentTemplate>
        </Button>-->
        <dxlc:FlowLayoutControl
                        Grid.Row="0"
                        Margin="-10"
                        MaxWidth="1500"
                        AllowItemMoving="False"
                        AllowMaximizedElementMoving="False"
                        AnimateItemMoving="True"
                        BreakFlowToFit="False"
                        DragScrolling="False"
                        ItemsSource="{Binding Tasks}"
                        ItemTemplate="{StaticResource FlowLayoutitemTemplate}"
                        MaximizedElementPosition="Left"
                        Orientation="Horizontal"
                        ScrollViewer.HorizontalScrollBarVisibility="Visible"
                        ScrollViewer.VerticalScrollBarVisibility="Hidden"
                        ShowLayerSeparators="True"
                        StretchContent="True">
        </dxlc:FlowLayoutControl>
        <StackPanel
            
            Grid.Row="1"
            Margin="0,10,0,0"
            Width="290"
            HorizontalAlignment="Center"
            VerticalAlignment="Center"
            Orientation="Horizontal">

            <Button
                Height="30"
                Width="100"
                Margin="15,0,30,0"
                VerticalAlignment="Bottom"
                Command="{Binding SplitOtViewAcceptButtonCommand}"
                Content="{DynamicResource EditTargetAndForecastViewAccept}"
                Style="{DynamicResource Button16Style}" />
            <Button
                Height="30"
                Width="100"
                Margin="30,0,0,0"
                VerticalAlignment="Bottom"
                Command="{Binding SplitOtViewCancelButtonCommand}"
                Content="{DynamicResource EditTargetAndForecastViewCancel}"
                Style="{DynamicResource Button16Style}" />
        </StackPanel>
    </Grid>

</UserControl>
