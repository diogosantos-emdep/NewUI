<UserControl x:Class="Emdep.Geos.Modules.Crm.Views.DashboardEngineeringAnalysisView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:dxe="http://schemas.devexpress.com/winfx/2008/xaml/editors"
             xmlns:dxc="http://schemas.devexpress.com/winfx/2008/xaml/charts"
             xmlns:dxlc="http://schemas.devexpress.com/winfx/2008/xaml/layoutcontrol" 
             xmlns:dxci="http://schemas.devexpress.com/winfx/2008/xaml/core/internal"
             xmlns:gif="http://wpfanimatedgif.codeplex.com"
             xmlns:UIHelper="clr-namespace:Emdep.Geos.UI.Helper;assembly=Emdep.Geos.UI.Helper"
             xmlns:dx="http://schemas.devexpress.com/winfx/2008/xaml/core"
             xmlns:dxmvvm="http://schemas.devexpress.com/winfx/2008/xaml/mvvm"
             xmlns:sysglb="clr-namespace:System.Globalization;assembly=mscorlib"
             xmlns:GeosApplication="clr-namespace:Emdep.Geos.UI.Common;assembly=Emdep.Geos.UI.Common"
             xmlns:Converters="clr-namespace:Emdep.Geos.UI.Converters;assembly=Emdep.Geos.UI.Converters"
             xmlns:dxg="http://schemas.devexpress.com/winfx/2008/xaml/grid"
             xmlns:Helper="clr-namespace:Emdep.Geos.UI.Helper;assembly=Emdep.Geos.UI.Helper"
             xmlns:UIConverter="clr-namespace:Emdep.Geos.UI.Converters;assembly=Emdep.Geos.UI.Converters"
             xmlns:local="clr-namespace:Emdep.Geos.Modules.Crm.Views"
             mc:Ignorable="d" 
             d:DesignHeight="600" d:DesignWidth="900">

    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis"/>
        <Converters:ImageUrlToByteArrayConverter x:Key="ImageUrlToByteArrayConverter" />
    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="45"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="50*"/>
            <ColumnDefinition Width="50*"/>
        </Grid.ColumnDefinitions>

        <!--<DockPanel  Grid.Row="0" Grid.Column="2"  HorizontalAlignment="Stretch" Margin="0,5,0,0" Height="45"  >-->
        <Grid Grid.Row="0" Grid.Column="0" Grid.ColumnSpan="2" HorizontalAlignment="Stretch" VerticalAlignment="Center" >
            <Grid.RowDefinitions>
                <RowDefinition Height="45"/>
            </Grid.RowDefinitions>
            <Grid.ColumnDefinitions>

                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>

                <ColumnDefinition Width="Auto"/>
                
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>

                <ColumnDefinition Width="Auto"/>
                
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <Label Content="{DynamicResource DbEnggAnalysisHeader}" VerticalAlignment="Top" Margin="10,0,0,0" Style="{DynamicResource LabelTitleStyle}" HorizontalAlignment="Left" />
            <Image Grid.Row="0" Grid.Column="1" HorizontalAlignment="Left" VerticalAlignment="Center" Margin="5,2,5,0" Height="30" Width="30"
                   gif:ImageBehavior.RepeatBehavior="Forever" gif:ImageBehavior.AnimatedSource="/Emdep.Geos.Modules.Crm;component/Assets/Images/animatedWarning.gif" 
                   Visibility="{Binding IsShowFailedPlantWarning,UpdateSourceTrigger=PropertyChanged,Mode=TwoWay,Converter={StaticResource BoolToVis}}">
                <Image.ToolTip>
                    <TextBlock Text="{Binding WarningFailedPlants}"/>
                </Image.ToolTip>
            </Image>

            <!-- Plant Owner -->
            <DockPanel Grid.Column="2" HorizontalAlignment="Center" VerticalAlignment="Center" Visibility="{Binding Source={x:Static GeosApplication:GeosApplication.Instance}, Path=CmbPlantOwnerUsers}" >
                <Image Style="{DynamicResource PlantOwnerImageStyle}" Width="24" Height="24" Margin="7,0,3,0" />
                <TextBlock Text="{DynamicResource CommonPlantOwner}"  FontWeight="Bold" Margin="5,2,5,0" />
            </DockPanel>

            <dxe:ComboBoxEdit Style="{DynamicResource ComboBoxEditStyle}" Grid.Column="3" Width="150" Height="30"
                                      Visibility="{Binding Source={x:Static GeosApplication:GeosApplication.Instance}, Path=CmbPlantOwnerUsers}"
                                      ItemsSource="{Binding Source={x:Static GeosApplication:GeosApplication.Instance}, Path=PlantOwnerUsersList}" Margin="5,0,5,0"
                                      DisplayMember="ShortName"
                                      EditValue="{Binding Source={x:Static GeosApplication:GeosApplication.Instance}, Path=SelectedPlantOwnerUsersList, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                <dxe:ComboBoxEdit.StyleSettings>
                    <dxe:CheckedComboBoxStyleSettings />
                </dxe:ComboBoxEdit.StyleSettings>
                <dxmvvm:Interaction.Triggers>
                    <dxmvvm:EventToCommand EventName="PopupClosed"
                                           Command="{Binding DataContext.PlantOwnerPopupClosedCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                                           PassEventArgsToCommand="True"/>
                </dxmvvm:Interaction.Triggers>
            </dxe:ComboBoxEdit>


            <!-- Sales Owner -->
            <DockPanel Grid.Column="2" HorizontalAlignment="Center" VerticalAlignment="Center" Visibility="{Binding Source={x:Static GeosApplication:GeosApplication.Instance}, Path=CmbSalesOwnerUsers}">
                <Image Style="{DynamicResource OwnerGroupImageStyle}" Width="24" Height="24" Margin="7,0,3,0" />
                <TextBlock Text="{DynamicResource CommonSalesOwner}" FontWeight="Bold" Margin="5,2,5,0" />
            </DockPanel>

            <dxe:ComboBoxEdit Style="{DynamicResource ComboBoxEditStyle}" Grid.Column="3" Width="150"
                              Visibility="{Binding Source={x:Static GeosApplication:GeosApplication.Instance}, Path=CmbSalesOwnerUsers}"
                              ItemsSource="{Binding Source={x:Static GeosApplication:GeosApplication.Instance}, Path=SalesOwnerUsersList, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" Margin="5,0,0,0"
                              DisplayMember="User.FullName" Height="30"
                                      EditValue="{Binding Source={x:Static GeosApplication:GeosApplication.Instance}, Path=SelectedSalesOwnerUsersList, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                <dxe:ComboBoxEdit.StyleSettings>
                    <dxe:CheckedComboBoxStyleSettings />
                </dxe:ComboBoxEdit.StyleSettings>
                <dxmvvm:Interaction.Triggers>
                    <dxmvvm:EventToCommand EventName="PopupClosed"
                                               Command="{Binding DataContext.SalesOwnerPopupClosedCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                                               PassEventArgsToCommand="True" />
                </dxmvvm:Interaction.Triggers>
            </dxe:ComboBoxEdit>


            <!-- Period -->
            <DockPanel Grid.Column="5" HorizontalAlignment="Center" VerticalAlignment="Center" >
                <Image Style="{DynamicResource CalendarImageStyle}" Width="16" Height="16" Margin="7,0,3,0" />
                <TextBlock Text="{DynamicResource AnnualSalesPerformanceViewPeriod}"  FontWeight="Bold" Margin="5,0,0,0" />
            </DockPanel>

            <TextBlock Text="{Binding Source={x:Static GeosApplication:GeosApplication.Instance}, Path=SelectedyearStarDate, StringFormat=d, ConverterCulture={x:Static sysglb:CultureInfo.CurrentCulture}}" HorizontalAlignment="Left" VerticalAlignment="Center" Grid.Column="6" Margin="3,0,0,0"/>
            <TextBlock Text=" - " HorizontalAlignment="Center" VerticalAlignment="Center" Grid.Column="7" FontWeight="Bold"/>
            <TextBlock Text="{Binding Source={x:Static GeosApplication:GeosApplication.Instance}, Path=SelectedyearEndDate, StringFormat=d, ConverterCulture={x:Static sysglb:CultureInfo.CurrentCulture}}" HorizontalAlignment="Left" VerticalAlignment="Center" Grid.Column="8"/>

            <!-- Remaining -->
            <DockPanel Grid.Column="10" HorizontalAlignment="Center" VerticalAlignment="Center" >
                <Image Style="{DynamicResource WatchImageStyle}" Width="16" Height="16" Margin="3,0,3,0" />
                <TextBlock Text="{DynamicResource AnnualSalesPerformanceViewRemaining}" FontWeight="Bold" Margin="5,0,0,0" />
            </DockPanel>
            <DockPanel Grid.Column="11" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="5,0,0,0" >
                <TextBlock Text="{Binding Source={x:Static GeosApplication:GeosApplication.Instance}, Path=RemainingDays}"  />
                <TextBlock Text="{DynamicResource AnnualSalesPerformanceViewDays}" Margin="3,0,5,0" />
            </DockPanel>

            <Button Content=" " Grid.Column="12" Height="38" Width="38" 
                    Command="{Binding RefreshDashboardEnggAnalysisCommand}" HorizontalAlignment="Right" Margin="0,0,5,0">
                <Button.ToolTip>
                    <TextBlock Text="{DynamicResource ButtonRefresh}"/>
                </Button.ToolTip>
                <Button.ContentTemplate>
                    <DataTemplate>
                        <Image Style="{ DynamicResource RefreshButtonImageStyle}" Grid.Column="0" Height="24" Width="24" Margin="-10"/>
                    </DataTemplate>
                </Button.ContentTemplate>
            </Button>

            <Button Content=" " Height="38" Width="38"  HorizontalAlignment="Right" Grid.Column="13" Margin="0,0,5,0"
                    Command="{Binding ExportButtonCommand}" CommandParameter="{Binding ElementName=ActivityTableView}" >
                <Button.ToolTip>
                    <TextBlock Text="{DynamicResource ButtonExportToExcel}"/>
                </Button.ToolTip>
                <Button.ContentTemplate>
                    <DataTemplate>
                        <Image Style="{ DynamicResource ExcelExportButtonImageStyle}" Grid.Column="0" Height="24" Width="24" Margin="-10"/>
                    </DataTemplate>
                </Button.ContentTemplate>
            </Button>

        </Grid>
        <!--</DockPanel>-->

        <dxlc:LayoutControl Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" Margin="0 -5 0 0">
            <dxlc:LayoutGroup Name="Root" Orientation="Horizontal" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">

                <dxlc:LayoutGroup Orientation="Vertical" Width="600">
                    <dxlc:LayoutGroup Orientation="Vertical" 
                                      Header="{DynamicResource DbEnggAnalysisByMonth}"
                                      View="GroupBox" IsCollapsible="True" IsCollapsed="False">
                        <dxc:ChartControl BorderThickness="0" x:Name="ChartEngineeringAnalysisByMonth"
                                          HorizontalAlignment="Stretch" VerticalAlignment="Stretch" 
                                          DataSource="{Binding DataTableEnggAnalysisByMonth, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                            <dxc:ChartControl.Legend>
                                <dxc:Legend HorizontalPosition="Right" VerticalPosition="TopOutside" Orientation="Horizontal"/>
                            </dxc:ChartControl.Legend>
                            <dxmvvm:Interaction.Triggers>
                                <dxmvvm:EventToCommand EventName="Loaded" Command="{Binding ChartEngineeringAnalysisByMonthLoadCommand}" PassEventArgsToCommand="True"/>
                            </dxmvvm:Interaction.Triggers>
                        </dxc:ChartControl>
                    </dxlc:LayoutGroup>

                    <!--Indicators-->
                    <dxlc:LayoutGroup Orientation="Vertical" 
                                      Header="{DynamicResource DbEnggAnalysisIndicators}"
                                      View="GroupBox" IsCollapsible="True" IsCollapsed="False">
                        <dxg:GridControl x:Name="gridEnggAnalysisIndicators"
                                         Margin="-5" SelectionMode="None"
                                         MaxHeight="1200" 
                                         VerticalAlignment="Stretch" HorizontalAlignment="Stretch"
                                         ItemsSource="{Binding DataTableIndicators, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"  ImplyNullLikeEmptyStringWhenFiltering="True" >

                            <dxg:GridColumn FieldName="Name" UnboundType="String" Header="{DynamicResource DbEnggAnalysisName}" Width="150" FilterPopupMode="CheckedList" MinWidth="150" BestFitMode="VisibleRows" ReadOnly="True" AllowBestFit="True"/>
                            <dxg:GridColumn FieldName="{Binding PeriodString,Mode=TwoWay}" UnboundType="String" Header="{Binding PeriodString,Mode=TwoWay}" Width="160" FilterPopupMode="CheckedList" MinWidth="160" BestFitMode="VisibleRows" ReadOnly="True" AllowBestFit="True"/>
                            <dxg:GridColumn FieldName="{Binding CurrentMonthString,Mode=TwoWay}" UnboundType="String" Header="{Binding CurrentMonthString,Mode=TwoWay}" Width="125" FilterPopupMode="CheckedList" MinWidth="125" BestFitMode="VisibleRows" ReadOnly="True" AllowBestFit="True"/>
                            <dxg:GridColumn FieldName="Trend(%)" Header="{DynamicResource DbEnggAnalysisTrend}" Width="130" FilterPopupMode="CheckedList" MinWidth="130" BestFitMode="VisibleRows" ReadOnly="True" AllowBestFit="True">
                                <dxg:GridColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal">
                                            <Image Margin="5 2 2 2" Height="20" Width="20">
                                                <Image.Style>
                                                    <Style>
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding Data.IsRedGreen}" Value="True">
                                                                <Setter Property="Image.Source" Value="{DynamicResource EngAnalysisGreenUp}"/>
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding Data.IsRedGreen}" Value="False">
                                                                <Setter Property="Image.Source" Value="{DynamicResource EngAnalysisRedDown}"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </Image.Style>
                                            </Image>
                                            <TextBlock Margin="5 0 0 0" Text="{Binding Path=Data.Trend(%)}" VerticalAlignment="Center">
                                                <TextBlock.Style>
                                                    <Style TargetType="{x:Type TextBlock}">
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding Data.IsRedGreen}" Value="False">
                                                                <Setter Property="TextBlock.Foreground" Value="Red" />
                                                            </DataTrigger>
                                                            <DataTrigger Binding="{Binding Data.IsRedGreen}" Value="True">
                                                                <Setter Property="TextBlock.Foreground" Value="Green" />
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </TextBlock.Style>
                                            </TextBlock>
                                        </StackPanel>
                                    </DataTemplate>
                                </dxg:GridColumn.CellTemplate>
                            </dxg:GridColumn>
                            <dxg:GridControl.View>
                                <dxg:TableView Name="tbEnggAnalysisIndicators" 
                                               ShowIndicator="False" 
                                               IsColumnChooserVisible="False"
                                               ColumnChooserColumnDisplayMode="ShowHiddenColumnsOnly"
                                               NavigationStyle="Row" 
                                               AllowGrouping="False" 
                                               ShowGroupPanel="False" 
                                               ShowColumnHeaders="True" 
                                               SearchPanelHorizontalAlignment="Stretch"/>
                            </dxg:GridControl.View>

                            <dxmvvm:Interaction.Behaviors>
                                <dxmvvm:EventToCommand EventName="MouseDoubleClick" 
                                                       Command="{Binding OfferGridDoubleClickCommand}"
                                                       CommandParameter="{Binding ElementName=tbEnggAnalysisIndicators}">
                                    <dxmvvm:EventToCommand.EventArgsConverter>
                                        <dx:EventArgsToDataRowConverter />
                                    </dxmvvm:EventToCommand.EventArgsConverter>
                                </dxmvvm:EventToCommand>
                            </dxmvvm:Interaction.Behaviors>
                        </dxg:GridControl>
                    </dxlc:LayoutGroup>
                </dxlc:LayoutGroup>

                <dxlc:LayoutGroup Orientation="Vertical" Width="Auto" >

                    <!--Open Offers-->
                    <dxlc:LayoutGroup Orientation="Vertical" 
                                      MaxHeight="1200"
                                      Header="{Binding OpenOffersText,Mode=TwoWay}"
                                      View="GroupBox" IsCollapsible="True" IsCollapsed="False">
                        <!--[Rahul.Gadhave][Date:09-10-2025][https://helpdesk.emdep.com/browse/GEOS2-8442]-->
                        <dxlc:LayoutGroup.HeaderTemplate>
                            <DataTemplate>
                                <Grid ShowGridLines="False">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="90*" />
                                        <ColumnDefinition Width="10*" />

                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <Button Content=" " Grid.Row="0" Grid.Column="1" Height="20" Width="30"  HorizontalAlignment="Right"
                                  Command="{Binding DataContext.ShowEngineeringAnalysisLoadGridDialogWindowCommand,UpdateSourceTrigger=PropertyChanged,Mode=TwoWay,
                            RelativeSource={RelativeSource AncestorType={x:Type UserControl}}}"  CommandParameter="{Binding ElementName=tbEnggAnalysisOpenOffer}"  >
                                        <Button.ToolTip>
                                            <TextBlock Text="{DynamicResource Expand}"/>
                                        </Button.ToolTip>
                                        <Button.ContentTemplate>
                                            <DataTemplate>
                                                <Image Style="{ DynamicResource ExpandButtonForDashboardStyle}"  Height="16" Width="24" Margin="-10"/>
                                            </DataTemplate>
                                        </Button.ContentTemplate>
                                    </Button>

                                    <TextBlock Text="{Binding}" Grid.Column="0" HorizontalAlignment="Left" VerticalAlignment="Stretch" />
                                </Grid>
                            </DataTemplate>
                        </dxlc:LayoutGroup.HeaderTemplate>
                        <!--[Rahul.Gadhave][Date:09-10-2025][https://helpdesk.emdep.com/browse/GEOS2-8442]-->
                        <dxg:GridControl x:Name="gridEngineeringAnalysisOpen" 
                                         Margin="-5"
                                         VerticalAlignment="Stretch" HorizontalAlignment="Stretch"
                                         ItemsSource="{Binding DataTableOpenOffers, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"  ImplyNullLikeEmptyStringWhenFiltering="True" >

                            <dxg:GridColumn FieldName="OfferCode" Header="{DynamicResource DbEnggAnalysisOffer}" Width="100"  FilterPopupMode="CheckedList"/>

                            <!--[pramod.misal][19-11-2025][GEOS2-8444] https://helpdesk.emdep.com/browse/GEOS2-8444-->
                            <dxg:GridColumn FieldName="Group" Header="{DynamicResource DbEnggAnalysisGroup}" Width="100"  FilterPopupMode="CheckedList"/>
                            <dxg:GridColumn FieldName="Plant" Header="{DynamicResource DbEnggAnalysisPlant}" Width="100"  FilterPopupMode="CheckedList"/>
                            
                            <!--<dxg:GridColumn FieldName="Country" Header="{DynamicResource DbEnggAnalysisCountry}" Width="100"  FilterPopupMode="CheckedList"/>-->

                            <dxg:GridColumn Header="{DynamicResource DbEnggAnalysisCountry}" MinWidth="100" Width="120" AllowBestFit="true"  FieldName="Country" FilterPopupMode="CheckedList" ReadOnly="True">
                                <dxg:GridColumn.CellToolTipBinding>
                                    <Binding Path="Country" />
                                </dxg:GridColumn.CellToolTipBinding>
                                <dxg:GridColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel VerticalAlignment="Center" Orientation="Horizontal" Height="24">

                                            <Image Source="{Binding RowData.Row.CountryIconUrl,Converter={StaticResource ImageUrlToByteArrayConverter},UpdateSourceTrigger=PropertyChanged ,ConverterParameter='image/png'}"
                                                 VerticalAlignment="Stretch" HorizontalAlignment="Stretch" MaxHeight="142" Margin="2" >

                                            </Image>

                                            <TextBlock Text ="{Binding RowData.Row.Country,UpdateSourceTrigger=PropertyChanged}"  VerticalAlignment="Center" Margin="5,0,0,0" ></TextBlock>
                                        </StackPanel>
                                    </DataTemplate>
                                </dxg:GridColumn.CellTemplate>
                                <!--<dxg:GridColumn.PrintCellStyle>
                                    <Style TargetType="dxe:TextEdit" BasedOn="{StaticResource {dxgt:TableViewThemeKey ResourceKey=DefaultPrintCellStyle}}">
                                        <Setter Property="dxp:ExportSettings.TargetType" Value="Panel" />
                                        <Setter Property="DisplayTemplate">
                                            <Setter.Value>
                                                <ControlTemplate>
                                                    <dxe:TextEdit Name="PART_Editor" Text="{Binding Row.Country}" HorizontalAlignment="Left" IsPrintingMode="True">
                                                    </dxe:TextEdit>
                                                </ControlTemplate>
                                            </Setter.Value>
                                        </Setter>
                                    </Style>
                                </dxg:GridColumn.PrintCellStyle>-->
                            </dxg:GridColumn>


                            <dxg:GridColumn FieldName="Description" Header="{DynamicResource DbEnggAnalysisDescription}" Width="477" FilterPopupMode="CheckedList" />
                            <dxg:GridColumn FieldName="BusinessUnit" Header="{DynamicResource DbEnggAnalysisBU}" Width="100" FilterPopupMode="CheckedList" />
                            <dxg:GridColumn FieldName="OfferStatus" Header="{DynamicResource DbEnggAnalysisOfferStatus}"  Width="150" FilterPopupMode="CheckedList">
                                <dxg:GridColumn.CellTemplate>
                                    <DataTemplate>
                                        <Border Background="{Binding Data.HtmlColor}" VerticalAlignment="Stretch" HorizontalAlignment="Stretch">
                                            <TextBlock Text="{Binding Data.OfferStatus}" Foreground="Black" />
                                        </Border>
                                    </DataTemplate>
                                </dxg:GridColumn.CellTemplate>

                            </dxg:GridColumn>
                            <dxg:GridColumn FieldName="RequestDate" Header="{DynamicResource DbEnggAnalysisRequestDate}" Width="100" FilterPopupMode="CheckedList" />
                            <dxg:GridColumn FieldName="DeliveryDate" Header="{DynamicResource DbEnggAnalysisDeliveryDate}" Width="100" FilterPopupMode="CheckedList">
                                <dxg:GridColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal">
                                            <dxe:DateEdit Name="PART_Editor" Mask="dd/MM/yyyy" ShowClearButton="False" IsTextEditable="False"
                                          MaskUseAsDisplayFormat="True" ShowError="False" ShowErrorToolTip="False" InvalidValueBehavior="AllowLeaveEditor">
                                                <dxe:DateEdit.Style>
                                                    <Style>
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding Data.IsOpenDeliveryDateRedColor}" Value="True">
                                                                <Setter Property="dxe:DateEdit.Foreground" Value="Red"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </dxe:DateEdit.Style>
                                            </dxe:DateEdit>
                                        </StackPanel>
                                    </DataTemplate>
                                </dxg:GridColumn.CellTemplate>
                            </dxg:GridColumn>

                            <dxg:GridColumn FieldName="Unbound" UnboundType="String" Header="{DynamicResource DbEnggAnalysisDelay}" Width="70" FilterPopupMode="CheckedList">
                                <dxg:GridColumn.CellStyle>
                                    <Style TargetType="{x:Type dxg:LightweightCellEditor}">
                                        <Setter Property="BorderBrush" Value="{DynamicResource GridColumnCellBorderBrushColorStyle}" />
                                        <Style.Triggers >
                                            <DataTrigger Binding="{Binding Data.Unbound,Converter={UIConverter:CheckValueGreaterOrLessThenZero}}" Value="False">
                                                <Setter Property="Foreground" Value="Red"/>
                                                <Setter Property="dxe:TextEdit.FontWeight" Value="Bold"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding Data.Unbound,Converter={UIConverter:CheckValueGreaterOrLessThenZero}}" Value="True">
                                                <Setter Property="Foreground" Value="Green"/>
                                                <Setter Property="dxe:TextEdit.FontWeight" Value="Bold"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </dxg:GridColumn.CellStyle>
                            </dxg:GridColumn>

                            <dxg:GridColumn FieldName="Assigned" Header="{DynamicResource DbEnggAnalysisAssigned}" Width="140" FilterPopupMode="CheckedList" />

                            <dxg:GridControl.View>
                                <dxg:TableView Name="tbEnggAnalysisOpenOffer"
                                               NavigationStyle="Row" 
                                               ShowIndicator="False"
                                               AllowGrouping="False"
                                               ShowGroupPanel="False" 
                                               ShowColumnHeaders="True"
                                               SearchPanelHorizontalAlignment="Stretch"
                                               ColumnChooserColumnDisplayMode="ShowHiddenColumnsOnly">
                                    <!--<dxg:TableView.FormatConditions>
                                        <dxg:FormatCondition FieldName="Unbound" Expression="0>[Unbound]" >
                                            <dx:Format Foreground="Red" FontWeight="Bold"/>
                                        </dxg:FormatCondition>
                                    </dxg:TableView.FormatConditions>-->
                                </dxg:TableView>
                            </dxg:GridControl.View>

                            <dxmvvm:Interaction.Behaviors>
                                <dxmvvm:EventToCommand EventName="CustomUnboundColumnData"
                                                       Command="{Binding DelayDaysOpenUnboundDataCommand}"
                                                       PassEventArgsToCommand="True"/>
                                <dxmvvm:EventToCommand EventName="MouseDoubleClick" 
                                                       Command="{Binding OfferGridDoubleClickCommand}"
                                                       CommandParameter="{Binding ElementName=tbEnggAnalysisOpenOffer}">
                                    <dxmvvm:EventToCommand.EventArgsConverter>
                                        <dx:EventArgsToDataRowConverter />
                                    </dxmvvm:EventToCommand.EventArgsConverter>
                                </dxmvvm:EventToCommand>
                            </dxmvvm:Interaction.Behaviors>
                        </dxg:GridControl>
                    </dxlc:LayoutGroup>

                    <!--Closed Offers-->
                    <dxlc:LayoutGroup Orientation="Vertical" 
                                      Header="{Binding ClosedOffersText,Mode=TwoWay}"
                                      View="GroupBox" IsCollapsible="True" IsCollapsed="False">
                        <!--[Rahul.Gadhave][Date:09-10-2025][https://helpdesk.emdep.com/browse/GEOS2-8442]-->
                        <dxlc:LayoutGroup.HeaderTemplate>
                            <DataTemplate>
                                <Grid ShowGridLines="False">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="90*" />
                                        <ColumnDefinition Width="10*" />

                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="*"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <Button Content=" " Grid.Row="0" Grid.Column="1" Height="20" Width="30"  HorizontalAlignment="Right"
                                                Command="{Binding DataContext.ShowEngineeringAnalysisForCloseOfferLoadGridDialogWindowCommand,UpdateSourceTrigger=PropertyChanged,Mode=TwoWay,
                                                RelativeSource={RelativeSource AncestorType={x:Type UserControl}}}"  CommandParameter="{Binding ElementName=tbEnggAnalysisClosed}"  >
                                        <Button.ToolTip>
                                            <TextBlock Text="{DynamicResource Expand}"/>
                                        </Button.ToolTip>
                                        <Button.ContentTemplate>
                                            <DataTemplate>
                                                <Image Style="{ DynamicResource ExpandButtonForDashboardStyle}"  Height="16" Width="24" Margin="-10"/>
                                            </DataTemplate>
                                        </Button.ContentTemplate>
                                    </Button>

                                    <TextBlock Text="{Binding}" Grid.Column="0" HorizontalAlignment="Left" VerticalAlignment="Stretch" />
                                </Grid>
                            </DataTemplate>
                        </dxlc:LayoutGroup.HeaderTemplate>
                        <!--[Rahul.Gadhave][Date:09-10-2025][https://helpdesk.emdep.com/browse/GEOS2-8442]-->
                        <dxg:GridControl x:Name="gridEngineeringAnalysisClosed"
                                         Margin="-5"
                                         MaxHeight="1200" 
                                         VerticalAlignment="Stretch" HorizontalAlignment="Stretch"
                                         ItemsSource="{Binding DataTableClosedOffers, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"  ImplyNullLikeEmptyStringWhenFiltering="True" >

                            <dxg:GridColumn FieldName="OfferCode" Header="{DynamicResource DbEnggAnalysisOffer}" Width="100" FilterPopupMode="CheckedList" />

                            <!--[pramod.misal][19-11-2025][GEOS2-8444] https://helpdesk.emdep.com/browse/GEOS2-8444-->
                            <dxg:GridColumn FieldName="Group" Header="{DynamicResource DbEnggAnalysisGroup}" Width="100"  FilterPopupMode="CheckedList"/>
                            <dxg:GridColumn FieldName="Plant" Header="{DynamicResource DbEnggAnalysisPlant}" Width="100"  FilterPopupMode="CheckedList"/>

                            <dxg:GridColumn Header="{DynamicResource DbEnggAnalysisCountry}" MinWidth="100" Width="120" AllowBestFit="true"  FieldName="Country" FilterPopupMode="CheckedList" ReadOnly="True">
                                <dxg:GridColumn.CellToolTipBinding>
                                    <Binding Path="Country" />
                                </dxg:GridColumn.CellToolTipBinding>
                                <dxg:GridColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel VerticalAlignment="Center" Orientation="Horizontal" Height="24">

                                            <Image Source="{Binding RowData.Row.CountryIconUrl,Converter={StaticResource ImageUrlToByteArrayConverter},UpdateSourceTrigger=PropertyChanged ,ConverterParameter='image/png'}"
                                                      VerticalAlignment="Stretch" HorizontalAlignment="Stretch" MaxHeight="142" Margin="2" >

                                            </Image>

                                            <TextBlock Text ="{Binding RowData.Row.Country,UpdateSourceTrigger=PropertyChanged}"  VerticalAlignment="Center" Margin="5,0,0,0" ></TextBlock>
                                        </StackPanel>
                                    </DataTemplate>
                                </dxg:GridColumn.CellTemplate>
                                <!--<dxg:GridColumn.PrintCellStyle>
                                     <Style TargetType="dxe:TextEdit" BasedOn="{StaticResource {dxgt:TableViewThemeKey ResourceKey=DefaultPrintCellStyle}}">
                                         <Setter Property="dxp:ExportSettings.TargetType" Value="Panel" />
                                         <Setter Property="DisplayTemplate">
                                             <Setter.Value>
                                                 <ControlTemplate>
                                                     <dxe:TextEdit Name="PART_Editor" Text="{Binding Row.Country}" HorizontalAlignment="Left" IsPrintingMode="True">
                                                     </dxe:TextEdit>
                                                 </ControlTemplate>
                                             </Setter.Value>
                                         </Setter>
                                     </Style>
                                 </dxg:GridColumn.PrintCellStyle>-->
                            </dxg:GridColumn>




                            <dxg:GridColumn FieldName="Description" Header="{DynamicResource DbEnggAnalysisDescription}" Width="315" FilterPopupMode="CheckedList" />
                            <dxg:GridColumn FieldName="BusinessUnit" Header="{DynamicResource DbEnggAnalysisBU}" Width="100" FilterPopupMode="CheckedList" />

                            <dxg:GridColumn FieldName="OfferStatus" Header="{DynamicResource DbEnggAnalysisOfferStatus}" Width="150" FilterPopupMode="CheckedList">
                                <dxg:GridColumn.CellTemplate>
                                    <DataTemplate>
                                        <Border Background="{Binding Data.HtmlColor}" VerticalAlignment="Stretch" HorizontalAlignment="Stretch">
                                            <TextBlock Text="{Binding Data.OfferStatus}" Foreground="Black" />
                                        </Border>
                                    </DataTemplate>
                                </dxg:GridColumn.CellTemplate>
                            </dxg:GridColumn>

                            <dxg:GridColumn FieldName="RequestDate" Header="{DynamicResource DbEnggAnalysisRequestDate}" Width="100" FilterPopupMode="CheckedList" />
                            <dxg:GridColumn FieldName="DeliveryDate" Header="{DynamicResource DbEnggAnalysisDeliveryDate}" Width="100" FilterPopupMode="CheckedList">
                                <dxg:GridColumn.CellTemplate>
                                    <DataTemplate>
                                        <StackPanel Orientation="Horizontal">
                                            <dxe:DateEdit Name="PART_Editor" Mask="dd/MM/yyyy" ShowClearButton="False" IsTextEditable="False"
                                          MaskUseAsDisplayFormat="True" ShowError="False" ShowErrorToolTip="False" InvalidValueBehavior="AllowLeaveEditor">
                                                <dxe:DateEdit.Style>
                                                    <Style>
                                                        <Style.Triggers>
                                                            <DataTrigger Binding="{Binding Data.IsClosedDeliveryDateRedColor}" Value="True">
                                                                <Setter Property="dxe:DateEdit.Foreground" Value="Red"/>
                                                            </DataTrigger>
                                                        </Style.Triggers>
                                                    </Style>
                                                </dxe:DateEdit.Style>
                                            </dxe:DateEdit>
                                        </StackPanel>
                                    </DataTemplate>
                                </dxg:GridColumn.CellTemplate>
                            </dxg:GridColumn>
                            <dxg:GridColumn FieldName="Delay(d)" UnboundType="String" Header="{DynamicResource DbEnggAnalysisDelay}" Width="70" FilterPopupMode="CheckedList">
                                <dxg:GridColumn.CellStyle>
                                    <Style TargetType="{x:Type dxg:LightweightCellEditor}">
                                        <Setter Property="BorderBrush" Value="{DynamicResource GridColumnCellBorderBrushColorStyle}" />
                                        <Style.Triggers >
                                            <DataTrigger Binding="{Binding Data.Delay(d),Converter={UIConverter:CheckValueGreaterOrLessThenZero}}" Value="False">
                                                <Setter Property="Foreground" Value="Red"/>
                                                <Setter Property="dxe:TextEdit.FontWeight" Value="Bold"/>
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding Data.Delay(d),Converter={UIConverter:CheckValueGreaterOrLessThenZero}}" Value="True">
                                                <Setter Property="Foreground" Value="Green"/>
                                                <Setter Property="dxe:TextEdit.FontWeight" Value="Bold"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </dxg:GridColumn.CellStyle>
                            </dxg:GridColumn>
                            <dxg:GridColumn FieldName="CloseDate" Header="{DynamicResource DbEnggAnalysisCloseDate}" Width="100" FilterPopupMode="CheckedList" />
                            <!--<dxg:GridColumn FieldName="Week" Header="{DynamicResource DbEnggAnalysisWeek}" SortOrder="Descending" UnboundType="String"  Width="63" FilterPopupMode="CheckedList" />-->
                            <dxg:GridColumn FieldName="WeekNo" Header="{DynamicResource DbEnggAnalysisWeek}" SortOrder="Descending" Width="63" FilterPopupMode="CheckedList" />
                            <dxg:GridColumn FieldName="Assigned" Header="{DynamicResource DbEnggAnalysisAssigned}" Width="140" FilterPopupMode="CheckedList" />

                            <dxg:GridControl.View>
                                <dxg:TableView Name="tbEnggAnalysisClosed"
                                               ShowIndicator="False"
                                               NavigationStyle="Row"
                                               AllowGrouping="False"
                                               ShowGroupPanel="False" 
                                               ShowColumnHeaders="True"
                                               SearchPanelHorizontalAlignment="Stretch"
                                               ColumnChooserColumnDisplayMode="ShowHiddenColumnsOnly">
                                    <!--<dxg:TableView.FormatConditions>
                                        <dxg:FormatCondition FieldName="Delay(d)" Expression="0>[Delay(d)]" >
                                            <dx:Format Foreground="Red" FontWeight="Bold"/>
                                        </dxg:FormatCondition>
                                        
                                        <dxg:FormatCondition FieldName="Delay(d)" Expression="[Delay(d)]>0" >
                                            <dx:Format Foreground="Green" FontWeight="Bold"/>
                                        </dxg:FormatCondition>
                                        
                                    </dxg:TableView.FormatConditions>-->
                                </dxg:TableView>
                            </dxg:GridControl.View>

                            <dxmvvm:Interaction.Behaviors>
                                <dxmvvm:EventToCommand EventName="CustomUnboundColumnData"
                                                       Command="{Binding WeekandDelayDaysClosedUnboundDataCommand}"
                                                       PassEventArgsToCommand="True"/>
                                <dxmvvm:EventToCommand EventName="MouseDoubleClick" 
                                                       Command="{Binding OfferGridDoubleClickCommand}"
                                                       CommandParameter="{Binding ElementName=tbEnggAnalysisClosed}">
                                    <dxmvvm:EventToCommand.EventArgsConverter>
                                        <dx:EventArgsToDataRowConverter />
                                    </dxmvvm:EventToCommand.EventArgsConverter>
                                </dxmvvm:EventToCommand>
                            </dxmvvm:Interaction.Behaviors>
                        </dxg:GridControl>
                    </dxlc:LayoutGroup>

                </dxlc:LayoutGroup>
            </dxlc:LayoutGroup>
        </dxlc:LayoutControl>

    </Grid>
</UserControl>
