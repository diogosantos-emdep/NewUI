<UserControl x:Class="Emdep.Geos.Modules.ERM.Views.ModuleEquivalencyWeightView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:Emdep.Geos.Modules.ERM.Views"
             xmlns:dxe="http://schemas.devexpress.com/winfx/2008/xaml/editors"
             xmlns:dxdo="http://schemas.devexpress.com/winfx/2008/xaml/docking"
             xmlns:dxmvvm="http://schemas.devexpress.com/winfx/2008/xaml/mvvm"
             xmlns:dxn="http://schemas.devexpress.com/winfx/2008/xaml/navbar"
             xmlns:dx="http://schemas.devexpress.com/winfx/2008/xaml/core"
             xmlns:dxwui="http://schemas.devexpress.com/winfx/2008/xaml/windowsui"
             xmlns:sys="clr-namespace:System;assembly=mscorlib"
             xmlns:dxg="http://schemas.devexpress.com/winfx/2008/xaml/grid"
             xmlns:dxlc="http://schemas.devexpress.com/winfx/2008/xaml/layoutcontrol"
             xmlns:GeosApplication="clr-namespace:Emdep.Geos.UI.Common;assembly=Emdep.Geos.UI.Common"
             xmlns:ViewModel="clr-namespace:Emdep.Geos.Modules.ERM.ViewModels"
             xmlns:UIHelper="clr-namespace:Emdep.Geos.UI.Helper;assembly=Emdep.Geos.UI.Helper"
             xmlns:dxp="http://schemas.devexpress.com/winfx/2008/xaml/printing" 
              xmlns:dxnav="http://schemas.devexpress.com/winfx/2008/xaml/navigation"
             mc:Ignorable="d" 
             xmlns:sysglb="clr-namespace:System.Globalization;assembly=mscorlib"
             xmlns:Behaviors="clr-namespace:Emdep.Geos.UI.Behaviors;assembly=Emdep.Geos.UI.Common"
             xmlns:dxwuin="http://schemas.devexpress.com/winfx/2008/xaml/windowsui/navigation" 
             xmlns:dxb="http://schemas.devexpress.com/winfx/2008/xaml/bars"
             xmlns:dxgt="http://schemas.devexpress.com/winfx/2008/xaml/grid/themekeys"
             xmlns:Converters="clr-namespace:Emdep.Geos.UI.Converters;assembly=Emdep.Geos.UI.Converters"
             xmlns:UIConverter="clr-namespace:Emdep.Geos.UI.Converters;assembly=Emdep.Geos.UI.Converters" 
             xmlns:i="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity"
             d:DesignHeight="300" d:DesignWidth="300"
              Style="{DynamicResource UserControlStyle}">

    <UserControl.Resources>

        <Converters:ForegroundColorConverter x:Key="ForegroundColorConverter"/>
        <Style x:Key="HideButtonStyle" TargetType="{x:Type ToggleButton}">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type ToggleButton}">
                        <Border BorderThickness="0" Background="{TemplateBinding Background}">
                            <Grid>
                                <Image Stretch="None" VerticalAlignment="Center" HorizontalAlignment="Center"
                                   Source="/Emdep.Geos.Modules.PCM;component/Assets/Images/ArrowRight.png"
                                   Visibility="{TemplateBinding IsChecked, Converter={dxmvvm:BooleanToVisibilityConverter Inverse=True}}"/>
                                <Image Stretch="None" VerticalAlignment="Center" HorizontalAlignment="Center"
                                   Source="/Emdep.Geos.Modules.PCM;component/Assets/Images/ArrowLeft.png"
                                   Visibility="{TemplateBinding IsChecked, Converter={dxmvvm:BooleanToVisibilityConverter}}"/>
                            </Grid>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style x:Key="LeftPanelTileItemStyle" TargetType="{x:Type dxnav:TileBarItem}">
            <Setter Property="Foreground" Value="{Binding ForeColor,Converter={UIConverter:ForegroundColorConverter}}"/>
            <Setter Property="BorderBrush" Value="#FFD6D6D6"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Background" Value="{Binding BackColor}"/>
            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
            <Setter Property="VerticalContentAlignment" Value="Stretch"/>
            <Setter Property="Height" Value="{Binding Height}"/>
            <Setter Property="Width" Value="{Binding Width}"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="SelectionPadding" Value="0" />
            <Setter Property="ContentTemplate" >
                <Setter.Value >
                    <DataTemplate >
                        <StackPanel Orientation="Vertical" HorizontalAlignment="Left" Width="195" Height="75"  >
                            <Label Content="{Binding EntitiesCount,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}" HorizontalContentAlignment="Right"   Margin="0,-5,8,0" VerticalContentAlignment="Top" FontSize="36" Visibility="{Binding EntitiesCountVisibility}"></Label>
                            <Label Content="{Binding Caption, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" HorizontalContentAlignment="Left" Margin="6,0,0,3" VerticalAlignment="Bottom" FontSize="15" ></Label>
                        </StackPanel>
                    </DataTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="BorderThickness" Value="5"/>
                    <Setter Property="BorderBrush" Value="{DynamicResource TileBarItemColorStyle}"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        <Style x:Key="printCellStatusStyle" TargetType="dxe:TextEdit" BasedOn="{StaticResource {dxgt:TableViewThemeKey ResourceKey=DefaultPrintCellStyle}}">
            <Style.Setters>
                <Setter Property="dxp:ExportSettings.TargetType" Value="Panel"/>
                <Setter Property="DisplayTemplate">
                    <Setter.Value>
                        <ControlTemplate>
                            <dxe:TextEdit Name="PART_Editor" Text="{Binding RowData.Row.PCMStatus}" HorizontalAlignment="Stretch" 
                                          IsPrintingMode="True">
                            </dxe:TextEdit>
                        </ControlTemplate>
                    </Setter.Value>
                </Setter>
            </Style.Setters>
        </Style>
        <!--[plahange][5-1-23]-->

    </UserControl.Resources>

    <Grid ShowGridLines="False" >
        <Grid.RowDefinitions>
            <RowDefinition Height="70"/>
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <Grid Grid.Row="0" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <Label Content="{DynamicResource LabelModulesEquivalencyWeight}" Style="{StaticResource LabelTitleStyle}"
                   Grid.Row="0"
                   VerticalAlignment="Center" />

            <Grid Grid.Row="0" Grid.Column="1" HorizontalAlignment="Right">
                <Grid HorizontalAlignment="Right" Width="Auto" Height="45" >
                    <Grid.RowDefinitions>
                        <RowDefinition Height="45"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <!-- Add Button -->
                    <!--<Button Content=" " Grid.Row="0" Grid.Column="2" Height="40" Width="40" HorizontalAlignment="Right"
                            Command="{Binding AddDetectionButtonCommand}" CommandParameter="{Binding ElementName=ItemListTableView}" Margin="0,0,5,5"
                             IsEnabled="{Binding Source={x:Static GeosApplication:GeosApplication.Instance}, Path=IsPermissionReadOnlyForPCM}"
                            >
                        <Button.ToolTip>
                            <TextBlock Text="{DynamicResource ButtonAdd}"/>
                        </Button.ToolTip>
                        <Button.ContentTemplate>
                            <DataTemplate>
                                <Image Style="{ DynamicResource PCMAddButtonImageStyle}"  Height="24" Width="24" Margin="-10"/>
                            </DataTemplate>
                        </Button.ContentTemplate>
                    </Button>-->

                    <!-- Refresh Button -->
                    <Button Content=" " Grid.Row="0" Grid.Column="3" Height="40" Width="40" HorizontalAlignment="Right"
                            Command="{Binding EquivalencyWeightRefreshCommand}" CommandParameter="{Binding ElementName=ItemListTableView}" Margin="0,0,5,5">
                        <Button.ToolTip>
                            <TextBlock Text="{DynamicResource ButtonRefresh}"/>
                        </Button.ToolTip>
                        <Button.ContentTemplate>
                            <DataTemplate>
                                <Image Style="{ DynamicResource PCMRefreshButtonImageStyle}"  Height="24" Width="24" Margin="-10"/>
                            </DataTemplate>
                        </Button.ContentTemplate>
                    </Button>

                    <!-- Print Button -->
                    <Button Content=" " Grid.Row="0" Grid.Column="4" Height="40" Width="40" HorizontalAlignment="Right"
                            Command="{Binding PrintEquivalencyWeightCommand}" CommandParameter="{Binding ElementName=ItemListTableView}" Margin="0,0,5,5">
                        <Button.ToolTip>
                            <TextBlock Text="{DynamicResource ButtonPrint}"/>
                        </Button.ToolTip>
                        <Button.ContentTemplate>
                            <DataTemplate>
                                <Image Style="{DynamicResource PCMPrintButtonImageStyle}"  Height="24" Width="24" Margin="-10"/>
                            </DataTemplate>
                        </Button.ContentTemplate>
                    </Button>

                    <!-- Export to Excel -->
                    <Button Content=" " Grid.Row="0" Grid.Column="5" Height="40" Width="40" HorizontalAlignment="Right"
                            Command="{Binding ExportEquivalencyWeightCommand}" CommandParameter="{Binding ElementName=ItemListTableView}" Margin="0,0,5,5">
                        <Button.ToolTip>
                            <TextBlock Text="{DynamicResource ButtonExportToExcel}"/>
                        </Button.ToolTip>
                        <Button.ContentTemplate>
                            <DataTemplate>
                                <Image Style="{DynamicResource PCMExportToExcelButtonImageStyle}"  Height="24" Width="24" Margin="-10"/>
                            </DataTemplate>
                        </Button.ContentTemplate>
                    </Button>

                </Grid>
            </Grid>
        </Grid>


        <DockPanel Grid.Row="1" HorizontalAlignment="Stretch">
            <!--<Grid>-->
            <UIHelper:DpiResizingPanel DockPanel.Dock="Left" Visibility="{Binding IsTileBarVisible}">
                <dxnav:TileBar DockPanel.Dock="Left"
                               Visibility="{Binding ElementName=expandButton, Path=IsChecked, Converter={dxmvvm:BooleanToVisibilityConverter}}"
                               Margin="0,-20,0,0"
                               SelectedIndex="{Binding SelectedTileIndexDetection,UpdateSourceTrigger=PropertyChanged,Mode=TwoWay}"
                               SelectedItem="{Binding SelectedFilter,UpdateSourceTrigger=PropertyChanged,Mode=TwoWay}"
                               Orientation="Vertical"
                               Width="215"
                               ItemSpacing="5"
                               ItemsSource="{Binding Listofitem,Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                               ItemContainerStyle="{StaticResource LeftPanelTileItemStyle}"
                               Padding="0">
                    <!--SelectedIndex="{Binding SelectedTileIndex,UpdateSourceTrigger=PropertyChanged,Mode=TwoWay}"-->
                    <dxmvvm:Interaction.Behaviors>
                        <dxmvvm:EventToCommand Command="{Binding CommandEquivalencyWeightShowTileBarFilterPopupClick}" EventName="SelectionChanged" PassEventArgsToCommand="True"/>
                        <dxmvvm:EventToCommand Command="{Binding CommandTileBarClickDoubleClick}"  EventName="MouseDoubleClick" CommandParameter="{Binding ElementName=ItemListTableView}"/>
                    </dxmvvm:Interaction.Behaviors>
                </dxnav:TileBar>
            </UIHelper:DpiResizingPanel>
            <ToggleButton x:Name="expandButton" Visibility="{Binding IsTileBarVisible}" DockPanel.Dock="Left" Style="{StaticResource HideButtonStyle}" IsChecked="True" VerticalAlignment="Center"/>
            <!--</Grid>  SelectedItem="{Binding Path=SelectedGridRow,UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"  -->

            <dxg:GridControl x:Name="detectiongrid" VerticalAlignment="Stretch" HorizontalAlignment="Stretch" Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2"
                         ImplyNullLikeEmptyStringWhenFiltering="True" AllowLiveDataShaping="True" ItemsSource="{Binding ModulesEquivalencyWeightList,UpdateSourceTrigger=PropertyChanged,Mode=TwoWay}"
                             SelectedItem="{Binding SelectedModulesEquivalentWeight,UpdateSourceTrigger=PropertyChanged,Mode=TwoWay}"
                        FilterString="{Binding MyFilterString,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}"
                        SelectionMode="Cell" Width="Auto" Height="Auto">

                <dxg:GridColumn Header="{DynamicResource Code}" HorizontalHeaderContentAlignment="Left"  FieldName="Code" FilterPopupMode="CheckedList"  MaxWidth="150" ReadOnly="True" FixedWidth="True">
                    <dxg:GridColumn.CellTemplate>
                        <DataTemplate>
                            <TextBlock VerticalAlignment="Center" Margin="10 0 0 0">
                                             <Hyperlink x:Name="hyperlink" 
                                               TargetName="_blank"
                                               Command="{Binding DataContext.ModuleEquivalencyWeightHyperlinkCommand,RelativeSource={RelativeSource AncestorType=dxg:GridControl}}"
                                               CommandParameter="{Binding ElementName=ItemListTableView}" >
                                                 
                                     <InlineUIContainer>
                                            <TextBlock Text="{Binding Data.Code}" />
                                        </InlineUIContainer>
                                    </Hyperlink>
                                        </TextBlock>

                            <DataTemplate.Triggers>
                                <Trigger Property="dxg:DataViewBase.IsFocusedCell" Value="True">
                                    <Setter TargetName="hyperlink" Property="Foreground" Value="#000066"/>
                                </Trigger>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter TargetName="hyperlink" Property="Foreground" Value="OrangeRed" />
                                </Trigger>
                            </DataTemplate.Triggers>

                        </DataTemplate>
                    </dxg:GridColumn.CellTemplate>
                </dxg:GridColumn>


                <dxg:GridColumn Header="{DynamicResource Name}" HorizontalHeaderContentAlignment="Left" FieldName="Name" MinWidth="180" FilterPopupMode="CheckedList" ReadOnly="True">
                    
                </dxg:GridColumn>

                <dxg:GridColumn Header="{DynamicResource ColTemplate}" HorizontalHeaderContentAlignment="Left" FieldName="TemplateName"  FilterPopupMode="CheckedList" MinWidth="180" ReadOnly="True">
                    
                </dxg:GridColumn>
                <dxg:GridColumn Header="{DynamicResource ColStatus}" FieldName="Status" ReadOnly="True" FilterPopupMode="Default" MinWidth="75" Width="150" FixedWidth="True" >

                    <dxg:GridColumn.CellTemplate>
                        <DataTemplate>

                            <Border  Background="{Binding Data.StatusHtmlColor}" VerticalAlignment="Stretch" HorizontalAlignment="Stretch">
                                <dxe:TextEdit  Name="PART_Editor" Margin="0 0 0 0"     HorizontalAlignment="Stretch" VerticalAlignment="Stretch"  ShowBorder="False"
                                                                                             Foreground="Black">
                                </dxe:TextEdit>
                            </Border>
                        </DataTemplate>
                    </dxg:GridColumn.CellTemplate>

                </dxg:GridColumn>

                <dxg:GridColumn Header="{DynamicResource EquivalentWeight}" FieldName="EquivalentWeight" MinWidth="130" ReadOnly="True" FixedWidth="True" FilterPopupMode="Default">

                </dxg:GridColumn>
                
                <dxg:GridColumn Header="{DynamicResource StartDate}" FieldName="StartDate" Width="130" FixedWidth="True" ReadOnly="True" FilterPopupMode="Default"   ShowInColumnChooser="True" >
                    <dxg:GridColumn.CellTemplate>
                        <DataTemplate>
                            <TextBlock VerticalAlignment="Center" Text="{Binding RowData.Row.StartDate,StringFormat=d, ConverterCulture={x:Static sysglb:CultureInfo.CurrentCulture}}">

                            </TextBlock>
                        </DataTemplate>
                    </dxg:GridColumn.CellTemplate>
                    <!--<dxg:GridColumn.EditSettings>
                        <dxe:DateEditSettings   MaskType="DateTime" Mask="d" MaskUseAsDisplayFormat="True" ></dxe:DateEditSettings>
                    </dxg:GridColumn.EditSettings>-->


                </dxg:GridColumn>
                <dxg:GridColumn Header="{DynamicResource EndDate}" FieldName="EndDate" Width="130" ReadOnly="True" FixedWidth="True" FilterPopupMode="Default"  ShowInColumnChooser="True" >

                    <dxg:GridColumn.CellTemplate>
                        <DataTemplate>
                            <TextBlock VerticalAlignment="Center" Text="{Binding RowData.Row.EndDate,StringFormat=d, ConverterCulture={x:Static sysglb:CultureInfo.CurrentCulture}}">

                            </TextBlock>
                        </DataTemplate>
                    </dxg:GridColumn.CellTemplate>

                </dxg:GridColumn>
                <dxg:GridColumn Header="{DynamicResource LastUpdate}" ReadOnly="True" FieldName="LastUpdate" Width="130" FixedWidth="True" FilterPopupMode="Default"   ShowInColumnChooser="True" >

                    <dxg:GridColumn.CellTemplate>
                        <DataTemplate>
                            <TextBlock Text="{Binding RowData.Row.LastUpdate,StringFormat=d, ConverterCulture={x:Static sysglb:CultureInfo.CurrentCulture}}">

                            </TextBlock>
                        </DataTemplate>
                    </dxg:GridColumn.CellTemplate>

                </dxg:GridColumn>
                <!--<dxg:GridColumn Header="{DynamicResource LastUpdate}" FieldName="LastUpdated" Width="100" ReadOnly="False" FixedWidth="True" FilterPopupMode="Default">

                </dxg:GridColumn>-->
                <dxg:GridControl.TotalSummary>
                    <dxg:GridSummaryItem x:Name="summary" FieldName="Code" SummaryType="count" DisplayFormat="Total: {0}" Visible="True" />
                </dxg:GridControl.TotalSummary>
                <dxg:GridControl.View>
                    <dxg:TableView x:Name="ItemListTableView"
                                   ShowGroupedColumns="True"  
                                   HorizontalScrollbarVisibility="Auto"  
                                   VerticalScrollbarVisibility="Visible" 
                                   ShowIndicator="False" 
                                   ShowColumnHeaders="True"  
                                   ShowGroupPanel="False"  
                                   ShowAutoFilterRow="True"
                                   AllowEditing="True"  
                                   ShowHorizontalLines="True"  
                                   ShowVerticalLines="True"  
                                   ShowSearchPanelMode="Always" 
                                   SearchPanelHorizontalAlignment="Stretch" 
                                   EnableImmediatePosting="True"
                                   ImmediateUpdateRowPosition="False"
                                   FilterRowDelay="500" 
                                   ShowTotalSummary="True"
                                   AllowColumnMoving="True"
                                   NavigationStyle="Cell"
                                   ShowFixedTotalSummary="True"
                                   FilterEditorShowOperandTypeIcon="True"
                                   AllowColumnFiltering="True"
                                   ShowFilterPopup="{DXEvent Handler='@args.PopupBaseEdit.PopupWidth=200'}" 
                                   UseLegacyFilterEditor="True">
                        <dxg:TableView.RowStyle>

                            <Style TargetType="{x:Type dxg:RowControl}" BasedOn="{StaticResource BaseUniversalStyle}">
                                <Setter Property="Background" Value="{x:Null}"/>

                                <!--<Style TargetType="{x:Type dxg:RowControl}">
                                -->
                                <!--<Setter Property="Background" Value="None" />-->
                                <!--
                                <Style.Triggers>
                                    <DataTrigger Value="true" Binding="{Binding RowData.Row.FlagIdCPType}" >
                                        <Setter Property="Background" Value="Green" />
                                        <Setter Property="Foreground" Value="White" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>-->

                                <Style.Triggers>
                                    <MultiDataTrigger>
                                        <MultiDataTrigger.Conditions>


                                            <Condition Binding="{Binding Row.FlagIdCPType}" Value="true" />

                                        </MultiDataTrigger.Conditions>
                                        <Setter Property="Foreground" Value="White"/>
                                        <Setter Property="Background" Value="Green"/>

                                    </MultiDataTrigger>

                                </Style.Triggers>

                            </Style>
                        </dxg:TableView.RowStyle>
                        <dxmvvm:Interaction.Behaviors>
                            <dxmvvm:EventToCommand Command="{Binding TableViewLoadedCommand}"
                                                   EventName="Loaded"
                                                   PassEventArgsToCommand="True" />
                            
                            <dxmvvm:EventToCommand Command="{Binding FilterEditorCreatedCommand}"
                                                   EventName="FilterEditorCreated"
                                                   PassEventArgsToCommand="True"/>
                            <dxmvvm:EventToCommand EventName="Unloaded"
                                            Command="{Binding EquivalencyWeightGridControlUnloadedCommand}"
                                            PassEventArgsToCommand="True"
                                            CommandParameter="{Binding ElementName=detectiongrid}" >
                            </dxmvvm:EventToCommand>
                            <dxmvvm:EventToCommand EventName="ShownColumnChooser"
                                                                                 Command="{Binding EquivalencyWeightItemListTableViewLoadedCommand}"
                                                                                    PassEventArgsToCommand="True"
                                                                                 CommandParameter="{Binding ElementName=ItemListTableView}" >
                            </dxmvvm:EventToCommand>
                        </dxmvvm:Interaction.Behaviors>

                       
                    </dxg:TableView>
                </dxg:GridControl.View>
            </dxg:GridControl>

        </DockPanel>
    </Grid>

    <i:Interaction.Triggers>
        <i:EventTrigger EventName="Loaded">
            <i:InvokeCommandAction Command="{Binding PageLoadedCommand}" CommandParameter="{Binding ElementName=ItemListTableView}"/>
        </i:EventTrigger>
    </i:Interaction.Triggers>
</UserControl>
