using System;
using System.Collections.Generic;
using System.Collections.ObjectModel;
using System.ComponentModel;
using System.Data;
using System.Linq;
using System.ServiceModel;
using System.Windows;
using System.Windows.Input;
using System.Windows.Media;
using System.Windows.Media.Imaging;
using DevExpress.Mvvm;
using DevExpress.Xpf.Core;
using DevExpress.Xpf.Editors;
using DevExpress.Xpf.LayoutControl;
using Emdep.Geos.Data.Common;
using Emdep.Geos.Data.Common.Epc;
using Emdep.Geos.Data.Common.ERM;
using Emdep.Geos.Data.Common.PCM;
using Emdep.Geos.Data.Common.SynchronizationClass;
using Emdep.Geos.Modules.ERM.Views;
using Emdep.Geos.Services.Contracts;
using Emdep.Geos.UI.Common;
using Emdep.Geos.UI.CustomControls;
using Emdep.Geos.UI.ServiceProcess;
using Emdep.Geos.UI.Validations;
using Prism.Logging;
using DevExpress.Xpf.Grid;
using Emdep.Geos.UI.Helper;
using DevExpress.Data;
using Emdep.Geos.UI.Commands;
using Newtonsoft.Json;
using DevExpress.Mvvm.UI;
using DevExpress.Xpf.Grid.TreeList;
using System.Globalization;
using DevExpress.Xpf.Accordion;
using Emdep.Geos.Modules.ERM.CommonClasses;
using Microsoft.Win32;
using DevExpress.Spreadsheet;
using System.Text.RegularExpressions;

namespace Emdep.Geos.Modules.ERM.ViewModels
{
    class AddEditStandardOperationsDictionaryViewModel : ViewModelBase, INotifyPropertyChanged, IDataErrorInfo
    {
        #region Service


        IPCMService PCMService = new PCMServiceController(GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString());
        IPLMService PLMService = new PLMServiceController(GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString());
        IERMService ERMService = new ERMServiceController(GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString());
        // IERMService ERMService = new ERMServiceController("localhost:6699");
        private INavigationService Service { get { return this.GetService<INavigationService>(); } }
        #endregion

        #region Events
        public event EventHandler RequestClose;

        public event PropertyChangedEventHandler PropertyChanged;
        public void OnPropertyChanged(PropertyChangedEventArgs e)
        {
            if (PropertyChanged != null)
            {
                PropertyChanged(this, e);
            }
        }



        #endregion

        #region Declarations

        private bool IsCopyName;
        private bool IsCopyDescription;

        private double dialogHeight;
        private double dialogWidth;

        private ObservableCollection<Language> languages;
        private Language languageSelected;

        private string description;
        //GEOS2-3854 gulab lakade for use log section
        private string tempdescription;
        private string description_en;
        private string description_es;
        private string description_fr;
        private string description_pt;
        private string description_ro;
        private string description_ru;
        private string description_zh;

        private string name;
        //GEOS2-3854 gulab lakade for use log section
        private string tempname;
        private string name_en;
        private string name_es;
        private string name_fr;
        private string name_pt;
        private string name_ro;
        private string name_ru;
        private string name_zh;

        MaximizedElementPosition maximizedElementPosition;

        private string windowHeader;
        private bool isNew;
        MaximizedElementPosition selectedAppearanceItem;
        private ObservableCollection<Site> plantList;
        private List<object> selectedPlant;
        private List<object> selectedPlant_Copy;

        private List<LookupValue> statusList;
        private int selectedStatusIndex;
        private LookupValue selectedStatus;

        private string selectedSODCode;
        private ulong idStandardOperationsDictionary;

        private bool isCheckedAllLanguages;
        private bool isNewSODSave;
        private bool isUpdatedSODSave;

        private DateTime creationDate;
        private DateTime? expiryDate;
        private DateTime? effectiveDate;
        private DateTime? lastUpdated;

        private bool isAll;

        private bool isPlantAddedOrRemove;
        private string error = string.Empty;
        private string informationError;

        private bool isFirstTimeLoad;
        private bool isSwitch;

        private bool? oldIsCheckedAllLanguages = null;
        private DateTime? oldEffectiveDate;
        private DateTime? oldExpiryDate;
        private string oldName;
        private string oldDescription;
        private string oldSelectedLanguage;
        private bool isEnabledSaveButton;
        private bool isEnabledAcceptButton;
        private bool isUserPermission;
        private bool isSaveButtonClicked;
        private Visibility saveButtonVisibility;
        private bool isInitializeFirstTime;

        private bool inActiveStatus;
        private List<GeosAppSetting> geosAppSettingList;
        private ObservableCollection<WorkOperationByStages> workOperationMenulist;
        private WorkOperationByStages selectedWorkOperationMenulist;
        private ObservableCollection<WorkOperationByStages> clonedWorkOperationByStages;
        private ObservableCollection<WorkOperation> workOperationsList_All;
        private ObservableCollection<Stages> getStages;
        TreeListControl treeListControlInstance;
        private List<LookupValue> supplements;
        private StandardOperationsDictionary clonedStandardOperationsDictionary;
        private ObservableCollection<BandItem> bandsTemplete = new ObservableCollection<BandItem>();
        private DataTable dttable;
        private DataTable dttableCopy;
        private ObservableCollection<Emdep.Geos.UI.Helper.Column> columns;
        private List<Tuple<string, float?>> supplementsBoxMenu;
        private List<StandardOperationsDictionarySupplement> lstStandardOperationsDictionarySupplement;

        private ObservableCollection<ProductTypes> productTypesMenulistForGridLayout; ////[GEOS2-3909][Rupali Sarode][10-11-2022]
        private ObservableCollection<ERMStructures> structureMenulistForGridLayout; ////[GEOS2-3909][Rupali Sarode][10-11-2022]
        private ObservableCollection<ERMSpareParts> sparePartsMenulistForGridLayout; ////[GEOS2-3859][Rupali Sarode][28-11-2022]
        #region [GEOS2-4108][Rupali Sarode][04-01-2023]
        private object tempModuleSelectedCopy;
        private object tempDetectionSelectedCopy;
        private object tempOptionSelectedCopy;
        private object tempWaysSelectedCopy;
        private object tempStructureSelectedCopy;
        private object tempSparePartsSelectedCopy;
        #endregion


        //GEOS2-3855 -Supplement
        List<ICloneable> newList = new List<ICloneable>();

        #region [GEOS2-3857] Rupali Sarode
        private List<ERMSOPDetection> tempWorkOperationClonedDetection = new List<ERMSOPDetection>();
        private List<ERMSOPOptions> tempWorkOperationClonedOptions = new List<ERMSOPOptions>();
        private List<ERMSOPWays> tempWorkOperationClonedWays = new List<ERMSOPWays>();
        private List<ERMSOPStructures> tempWorkOperationClonedStructure = new List<ERMSOPStructures>();
        #endregion

        #region [GEOS2-3601] Rupali Sarode
        int duplicateItemloopStructure = 0;
        ObservableCollection<WorkOperationByStages> operationStructureMenulist = new ObservableCollection<WorkOperationByStages>();
        List<StandardOperationsDictionaryStructures> tempLstStandardOperationsDictionaryStructures = new List<StandardOperationsDictionaryStructures>();
        TreeListControl StructuretreeListControlInstance;
        List<StandardOperationsDictionaryStructures> standardOperationsDictionaryStructureDeleteList = new List<StandardOperationsDictionaryStructures>();
        List<ERMSOPStructures> ERMSOPStructureDeleteList = new List<ERMSOPStructures>();
        List<ERMSOPStructures> ERMSOPStructureDeleteParentList = new List<ERMSOPStructures>();

        #endregion
        private bool isInformationVisible;
        private string height;
        private Visibility isToggleButtonVisible;
        #region GEOS2-3855 gulab lakade
        private List<StandardOperationsDictionarySupplement> lstStandardOperationsDictionarySupplement_Cloned;
        private ObservableCollection<LogentriesbyStandardOperationsDictionary> standardOperationsDictionaryChangeLogList;
        private ObservableCollection<LogentriesbyStandardOperationsDictionary> standardOperationsDictionaryAllChangeLogList;
        #endregion

        #region [GEOS2-3909] [Rupali Sarode]

        private ObservableCollection<ERMSOPModule> tmpModuleMenulist; //[GEOS2-3909] [Rupali Sarode] [04-11-2022]
        private ObservableCollection<ERMSOPDetection> tmpDetectionMenulist; //[GEOS2-3922] [Rupali Sarode] [05-11-2022]
        private ObservableCollection<ERMSOPOptions> tmpOptionMenulist; //[GEOS2-3924] [Rupali Sarode] [22-11-2022]
        private ObservableCollection<ERMSOPStructures> tmpStructureMenulist; //[GEOS2-3926] [Rupali Sarode] [25-11-2022]
        private ObservableCollection<ERMSOPWays> tmpWayMenulist; //[GEOS2-3923] [sdeshpande] [17-11-2022]
        private ObservableCollection<ERMSOPSpareParts> tmpSparePartsMenulist; //[GEOS2-3925][Rupali Sarode][29-11-2022]


        private ObservableCollection<ERMSOPModule> tmpModuleMenulistOriginal; //[GEOS2-4108] [Rupali Sarode] [05-01-2023]
        private ObservableCollection<ERMSOPDetection> tmpDetectionMenulistOriginal; //[GEOS2-4108] [Rupali Sarode] [05-01-2023]
        private ObservableCollection<ERMSOPOptions> tmpOptionMenulistOriginal; //[GEOS2-4108] [Rupali Sarode] [05-01-2023]
        private ObservableCollection<ERMSOPStructures> tmpStructureMenulistOriginal; //[GEOS2-4108] [Rupali Sarode] [05-01-2023]
        private ObservableCollection<ERMSOPWays> tmpWayMenulistOriginal; //[GEOS2-4108] [Rupali Sarode] [05-01-2023]
        private ObservableCollection<ERMSOPSpareParts> tmpSparePartsMenulistOriginal; //[GEOS2-4108] [Rupali Sarode] [05-01-2023]


        private ulong tmpIdCPType;
        private ulong tmpIdDetection;
        private ulong tmpIdOption;  //[GEOS2-3924][Rupali Sarode][22-11-2022]
        private ulong tmpIdStructure;  //[GEOS2-3926][Rupali Sarode][25-11-2022]
        private int tmpIdWayType;//[GEOS2-3923][sdeshpande][17-11-2022]
        private ulong tmpIdSpareParts; //[GEOS2-3925][Rupali Sarode][29-11-2022]

        private bool flagToDragDrop;



        #endregion
        //[GEOS2-4987][gulab lakade][26 10 2023]
        private string selectedTabName;
        private string oldTabName;
        private bool isEnabled;
        #region [Sequence ][gulab  lakade][08 07 2024]
        public bool IsModulesequence = false;
        #endregion
        #endregion

        #region Properties
        public ObservableCollection<Summary> GroupSummary { get; private set; }

        public List<GeosAppSetting> GeosAppSettingList
        {
            get
            {
                return geosAppSettingList;
            }

            set
            {
                geosAppSettingList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("GeosAppSettingList"));
            }
        }

        public StandardOperationsDictionary NewSOD { get; set; }
        public StandardOperationsDictionary UpdatedSOD { get; set; }
        public StandardOperationsDictionary ClonedSOD { get; set; }

        public double DialogHeight
        {
            get { return dialogHeight; }
            set
            {
                dialogHeight = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DialogHeight"));
            }
        }

        public double DialogWidth
        {
            get { return dialogWidth; }
            set
            {
                dialogWidth = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DialogWidth"));
            }
        }

        public ObservableCollection<Language> Languages
        {
            get { return languages; }
            set
            {
                languages = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Languages"));
            }
        }

        public Language LanguageSelected
        {
            get
            {
                return languageSelected;
            }
            set
            {
                languageSelected = value;
                OnPropertyChanged(new PropertyChangedEventArgs("LanguageSelected"));
            }
        }

        public string Description
        {
            get { return description; }
            set
            {
                description = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Description"));
            }
        }
        //GEOS2-3854 gulab lakade
        public string Tempdescription
        {
            get { return tempdescription; }
            set
            {
                tempdescription = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Tempdescription"));
            }
        }

        public string Description_en
        {
            get
            {
                return description_en;
            }
            set
            {
                description_en = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Description_en"));
            }
        }

        public string Description_es
        {
            get
            {
                return description_es;
            }
            set
            {
                description_es = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Description_es"));
            }
        }

        public string Description_fr
        {
            get
            {
                return description_fr;
            }
            set
            {
                description_fr = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Description_fr"));
            }
        }

        public string Description_pt
        {
            get
            {
                return description_pt;
            }
            set
            {
                description_pt = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Description_pt"));
            }
        }

        public string Description_ro
        {
            get
            {
                return description_ro;
            }
            set
            {
                description_ro = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Description_ro"));
            }
        }

        public string Description_ru
        {
            get
            {
                return description_ru;
            }
            set
            {
                description_ru = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Description_ru"));
            }
        }

        public string Description_zh
        {
            get
            {
                return description_zh;
            }
            set
            {
                description_zh = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Description_zh"));
            }
        }

        public string Name
        {
            get
            {
                return name;
            }
            set
            {
                name = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Name"));
            }
        }
        //GEOS2-3854 gulab lakade
        public string Tempname
        {
            get
            {
                return tempname;
            }
            set
            {
                tempname = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Tempname"));
            }
        }

        public string Name_en
        {
            get
            {
                return name_en;
            }
            set
            {
                name_en = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Name_en"));
            }
        }

        public string Name_es
        {
            get
            {
                return name_es;
            }
            set
            {
                name_es = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Name_es"));
            }
        }

        public string Name_fr
        {
            get
            {
                return name_fr;
            }
            set
            {
                name_fr = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Name_fr"));
            }
        }

        public string Name_pt
        {
            get
            {
                return name_pt;
            }
            set
            {
                name_pt = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Name_pt"));
            }
        }

        public string Name_ro
        {
            get
            {
                return name_ro;
            }
            set
            {
                name_ro = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Name_ro"));
            }
        }

        public string Name_ru
        {
            get
            {
                return name_ru;
            }
            set
            {
                name_ru = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Name_ru"));
            }
        }

        public string Name_zh
        {
            get
            {
                return name_zh;
            }
            set
            {
                name_zh = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Name_zh"));
            }
        }

        public MaximizedElementPosition MaximizedElementPosition
        {
            get { return maximizedElementPosition; }
            set
            {
                maximizedElementPosition = value;
                OnPropertyChanged(new PropertyChangedEventArgs("MaximizedElementPosition"));
            }
        }

        public string WindowHeader
        {
            get
            {
                return windowHeader;
            }
            set
            {
                windowHeader = value;
                OnPropertyChanged(new PropertyChangedEventArgs("WindowHeader"));
            }
        }

        public bool IsNew
        {
            get
            {
                return isNew;
            }

            set
            {
                isNew = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsNew"));
            }
        }

        public MaximizedElementPosition SelectedAppearanceItem
        {
            get { return selectedAppearanceItem; }
            set
            {
                selectedAppearanceItem = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedAppearanceItem"));
            }
        }

        public ObservableCollection<Site> PlantList
        {
            get
            {
                return plantList;
            }

            set
            {
                plantList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("PlantList"));
            }
        }

        public List<object> SelectedPlant
        {
            get
            {
                return selectedPlant;
            }

            set
            {
                selectedPlant = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedPlant"));
            }
        }

        public List<object> SelectedPlant_Copy
        {
            get
            {
                return selectedPlant_Copy;
            }

            set
            {
                selectedPlant_Copy = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedPlant_Copy"));
            }
        }

        public List<LookupValue> StatusList
        {
            get { return statusList; }
            set
            {
                statusList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("StatusList"));
            }
        }

        public int SelectedStatusIndex
        {
            get { return selectedStatusIndex; }
            set
            {
                selectedStatusIndex = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedStatusIndex"));
            }
        }

        public LookupValue SelectedStatus
        {
            get { return selectedStatus; }
            set
            {
                selectedStatus = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedStatus"));
            }
        }

        public ulong IdStandardOperationsDictionary
        {
            get
            {
                return idStandardOperationsDictionary;
            }
            set
            {
                idStandardOperationsDictionary = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IdStandardOperationsDictionary"));
            }
        }

        public string SelectedSODCode
        {
            get
            {
                IsInformationVisible = true;
                return selectedSODCode;
            }
            set
            {
                IsInformationVisible = true;
                selectedSODCode = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedSODCode"));
            }
        }

        public bool IsCheckedAllLanguages
        {
            get
            {
                return isCheckedAllLanguages;
            }
            set
            {
                isCheckedAllLanguages = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsCheckedAllLanguages"));
            }
        }

        public bool IsNewSODSave
        {
            get
            {
                return isNewSODSave;
            }

            set
            {
                isNewSODSave = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsNewSODSave"));
            }
        }

        public bool IsUpdatedSODSave
        {
            get
            {
                return isUpdatedSODSave;
            }

            set
            {
                isUpdatedSODSave = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsUpdatedSODSave"));
            }
        }

        public DateTime CreationDate
        {
            get
            {
                return creationDate;
            }
            set
            {
                creationDate = value;
                OnPropertyChanged(new PropertyChangedEventArgs("CreationDate"));
            }
        }

        public DateTime? ExpiryDate
        {
            get
            {
                return expiryDate;
            }
            set
            {
                expiryDate = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ExpiryDate"));
            }
        }

        public DateTime? EffectiveDate
        {
            get
            {
                return effectiveDate;
            }
            set
            {
                effectiveDate = value;
                OnPropertyChanged(new PropertyChangedEventArgs("EffectiveDate"));
            }
        }

        public DateTime? LastUpdated
        {
            get
            {
                return lastUpdated;
            }
            set
            {
                lastUpdated = value;
                OnPropertyChanged(new PropertyChangedEventArgs("LastUpdated"));
            }
        }

        public bool IsAll
        {
            get
            {
                return isAll;
            }

            set
            {
                isAll = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsAll"));
            }
        }

        public virtual bool DialogResult { get; set; }
        public virtual string ResultFileName { get; set; }

        public LookupValue SelectedOriginalStatus { get; set; }

        public bool IsPlantAddedOrRemove
        {
            get
            {
                return isPlantAddedOrRemove;
            }

            set
            {
                isPlantAddedOrRemove = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsPlantAddedOrRemove"));
            }
        }

        public string InformationError
        {
            get { return informationError; }
            set
            {
                informationError = value;
                OnPropertyChanged(new PropertyChangedEventArgs("InformationError"));
            }
        }

        public bool IsFirstTimeLoad
        {
            get
            {
                return isFirstTimeLoad;
            }

            set
            {
                isFirstTimeLoad = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsFirstTimeLoad"));
            }
        }

        public bool IsSwitch
        {
            get
            {
                return isSwitch;
            }

            set
            {
                isSwitch = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsSwitch"));
            }
        }

        public bool IsUserPermission
        {
            get
            {
                return isUserPermission;
            }

            set
            {
                isUserPermission = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsUserPermission"));
            }
        }

        public bool IsEnabledAcceptButton
        {
            get { return isEnabledAcceptButton; }
            set
            {
                isEnabledAcceptButton = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsEnabledAcceptButton"));
            }
        }

        public bool IsEnabledSaveButton
        {
            get { return isEnabledSaveButton; }
            set
            {
                if (GeosApplication.Instance.IsEditSODPermissionERM)
                {
                    if (isEnabledSaveButton != value)
                    {
                        isEnabledSaveButton = value;
                    }
                }
                else
                {
                    isEnabledSaveButton = false;
                }

                OnPropertyChanged(new PropertyChangedEventArgs("IsEnabledSaveButton"));
            }
        }
        public Visibility SaveButtonVisibility
        {
            get { return saveButtonVisibility; }
            set { saveButtonVisibility = value; OnPropertyChanged(new PropertyChangedEventArgs("SaveButtonVisibility")); }
        }

        public bool InActiveStatus
        {
            get
            {
                return inActiveStatus;
            }

            set
            {
                inActiveStatus = value;
                OnPropertyChanged(new PropertyChangedEventArgs("InActiveStatus"));
            }
        }

        public ObservableCollection<WorkOperation> WorkOperationsList_All
        {
            get { return workOperationsList_All; }
            set
            {
                workOperationsList_All = value;
                OnPropertyChanged(new PropertyChangedEventArgs("WorkOperationsList_All"));
            }
        }

        public WorkOperationByStages SelectedWorkOperationMenulist
        {
            get { return selectedWorkOperationMenulist; }
            set
            {
                selectedWorkOperationMenulist = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedWorkOperationMenulist"));
            }

        }
        public ObservableCollection<WorkOperationByStages> WorkOperationMenulist
        {
            get
            {
                return workOperationMenulist;
            }

            set
            {
                workOperationMenulist = value;
                OnPropertyChanged(new PropertyChangedEventArgs("WorkOperationMenulist"));
            }
        }
        public ObservableCollection<WorkOperationByStages> ClonedWorkOperationByStages
        {
            get
            {
                return clonedWorkOperationByStages;
            }
            set
            {
                clonedWorkOperationByStages = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ClonedWorkOperationByStages"));
            }
        }
        public ObservableCollection<Stages> GetStages
        {
            get
            {
                return getStages;
            }
            set
            {
                getStages = value;
                OnPropertyChanged(new PropertyChangedEventArgs("GetStages"));
            }
        }


        public StandardOperationsDictionary ClonedStandardOperationsDictionary
        {
            get
            {
                return clonedStandardOperationsDictionary;
            }
            set
            {
                clonedStandardOperationsDictionary = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ClonedStandardOperationsDictionary"));
            }
        }

        public ObservableCollection<BandItem> BandsTemplete
        {
            get { return bandsTemplete; }
            set
            {
                bandsTemplete = value;
                OnPropertyChanged(new PropertyChangedEventArgs("BandsTemplete"));
            }
        }

        public DataTable Dttable
        {
            get
            {
                IsInformationVisible = true;
                return dttable;
            }
            set
            {
                IsInformationVisible = true;
                dttable = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Dttable"));
            }
        }
        public DataTable DtTableCopy
        {
            get { return dttableCopy; }
            set
            {
                dttableCopy = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DtTableCopy"));
            }
        }

        public ObservableCollection<Emdep.Geos.UI.Helper.Column> Columns
        {
            get { return columns; }
            set
            {
                columns = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Columns"));
            }
        }

        public ObservableCollection<Summary> TotalSummary { get; private set; }

        public List<Tuple<string, float?>> SupplementsBoxMenu
        {
            get { return supplementsBoxMenu; }
            set
            {
                supplementsBoxMenu = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SupplementsBoxMenu"));
            }
        }
        List<Tuple<string, float?>> allsupplementsBoxMenu;
        public List<Tuple<string, float?>> AllSupplementsBoxMenu
        {
            get { return allsupplementsBoxMenu; }
            set
            {
                allsupplementsBoxMenu = value;
                OnPropertyChanged(new PropertyChangedEventArgs("AllSupplementsBoxMenu"));
            }
        }
        public List<StandardOperationsDictionarySupplement> LstStandardOperationsDictionarySupplement
        {
            get { return lstStandardOperationsDictionarySupplement; }
            set
            {
                lstStandardOperationsDictionarySupplement = value;
                OnPropertyChanged(new PropertyChangedEventArgs("LstStandardOperationsDictionarySupplement"));
            }
        }

        public List<StandardOperationsDictionarySupplement> LstStandardOperationsDictionarySupplement_Cloned
        {
            get { return lstStandardOperationsDictionarySupplement_Cloned; }
            set
            {
                lstStandardOperationsDictionarySupplement_Cloned = value;
                OnPropertyChanged(new PropertyChangedEventArgs("LstStandardOperationsDictionarySupplement_Cloned"));
            }
        }


        public bool IsInformationVisible
        {
            get
            {
                return isInformationVisible;
            }

            set
            {
                isInformationVisible = value;

                OnPropertyChanged(new PropertyChangedEventArgs("IsInformationVisible"));
            }
        }

        public string Height
        {
            get
            {
                return height;
            }

            set
            {
                height = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Height"));
            }
        }

        public Visibility IsToggleButtonVisible
        {
            get
            {
                return isToggleButtonVisible;
            }

            set
            {
                isToggleButtonVisible = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsToggleButtonVisible"));
            }
        }

        ObservableCollection<ERMDetections> detectionsMenulistForGridLayout;
        public ObservableCollection<ERMDetections> DetectionsMenulistForGridLayout
        {
            get { return detectionsMenulistForGridLayout; }
            set
            {
                detectionsMenulistForGridLayout = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DetectionsMenulistForGridLayout"));
            }
        }

        ObservableCollection<ERMOptions> optionsMenulistForGridLayout;
        //[GEOS2-3924][Rupali Sarode][22-11-2022]
        public ObservableCollection<ERMOptions> OptionsMenulistForGridLayout
        {
            get { return optionsMenulistForGridLayout; }
            set
            {
                optionsMenulistForGridLayout = value;
                OnPropertyChanged(new PropertyChangedEventArgs("OptionsMenulistForGridLayout"));
            }
        }


        #region [GEOS2-4108][Rupali Sarode][04-01-2023]
        public virtual object TempModuleSelectedCopy
        {
            get { return tempModuleSelectedCopy; }
            set
            {
                tempModuleSelectedCopy = value;
                OnPropertyChanged(new PropertyChangedEventArgs("TempModuleSelectedCopy"));
            }
        }

        public virtual object TempDetectionSelectedCopy
        {
            get { return tempDetectionSelectedCopy; }
            set
            {
                tempDetectionSelectedCopy = value;
                OnPropertyChanged(new PropertyChangedEventArgs("TempDetectionSelectedCopy"));
            }
        }
        public virtual object TempOptionSelectedCopy
        {
            get { return tempOptionSelectedCopy; }
            set
            {
                tempOptionSelectedCopy = value;
                OnPropertyChanged(new PropertyChangedEventArgs("TempOptionSelectedCopy"));
            }
        }
        public virtual object TempWaysSelectedCopy
        {
            get { return tempWaysSelectedCopy; }
            set
            {
                tempWaysSelectedCopy = value;
                OnPropertyChanged(new PropertyChangedEventArgs("TempWaysSelectedCopy"));
            }
        }
        public virtual object TempStructureSelectedCopy
        {
            get { return tempStructureSelectedCopy; }
            set
            {
                tempStructureSelectedCopy = value;
                OnPropertyChanged(new PropertyChangedEventArgs("TempStructureSelectedCopy"));
            }
        }

        public virtual object TempSparePartsSelectedCopy
        {
            get { return tempSparePartsSelectedCopy; }
            set
            {
                tempSparePartsSelectedCopy = value;
                OnPropertyChanged(new PropertyChangedEventArgs("TempSparePartsSelectedCopy"));
            }
        }

        #endregion


        #region GEOS2-3855 gulab lakade
        public ObservableCollection<LogentriesbyStandardOperationsDictionary> StandardOperationsDictionaryChangeLogList
        {
            get { return standardOperationsDictionaryChangeLogList; }
            set
            {
                standardOperationsDictionaryChangeLogList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("StandardOperationsDictionaryChangeLogList"));
            }
        }

        public ObservableCollection<LogentriesbyStandardOperationsDictionary> StandardOperationsDictionaryAllChangeLogList
        {
            get { return standardOperationsDictionaryAllChangeLogList; }
            set
            {
                standardOperationsDictionaryAllChangeLogList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("StandardOperationsDictionaryAllChangeLogList"));
            }
        }
        #endregion

        #region [GEOS2-3601][Rupali Sarode][29/9/2022]

        private object selectedItemStructures;
        public virtual object SelectedItemStructures
        {
            get { return selectedItemStructures; }
            set
            {
                selectedItemStructures = value;
                if (selectedItemStructures != null)
                {
                    RetrieveWorkOperationsByStructure();
                }

                OnPropertyChanged(new PropertyChangedEventArgs("SelectedItemStructures"));
            }
        }

        ObservableCollection<DetectionGroupWithStructures> detectionGroupWithStructures;
        public ObservableCollection<DetectionGroupWithStructures> DetectionGroupWithStructures
        {
            get { return detectionGroupWithStructures; }
            set
            {
                detectionGroupWithStructures = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DetectionGroupWithStructures"));
            }
        }

        private Visibility isAccordionControlVisibleStructures;

        public Visibility IsAccordionControlVisibleStructures
        {
            get { return isAccordionControlVisibleStructures; }
            set
            {
                isAccordionControlVisibleStructures = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsAccordionControlVisibleStructures"));
            }
        }

        ObservableCollection<ERMSOPStructures> structureMenulist;
        public ObservableCollection<ERMSOPStructures> StructureMenulist
        {
            get { return structureMenulist; }
            set
            {
                structureMenulist = value;
                OnPropertyChanged(new PropertyChangedEventArgs("StructureMenulist"));
            }
        }


        private ObservableCollection<TreeListColumn> columnsStructureForSupplements;
        public ObservableCollection<TreeListColumn> ColumnsStructureForSupplements
        {
            get { return columnsStructureForSupplements; }
            set
            {
                columnsStructureForSupplements = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ColumnsStructureForSupplements"));
            }
        }

        private ObservableCollection<TreeListColumn> columnsStructureOperationTime;
        public ObservableCollection<TreeListColumn> ColumnsStructureOperationTime
        {
            get { return columnsStructureOperationTime; }
            set
            {
                columnsStructureOperationTime = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ColumnsStructureOperationTime"));
            }
        }

        ERMSOPStructures selectedStructureMenuItem;
        public ERMSOPStructures SelectedStructureMenuItem
        {
            get { return selectedStructureMenuItem; }
            set
            {
                selectedStructureMenuItem = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedStructureMenuItem"));
            }
        }

        private object selectedItemOldcloneStructure;
        public virtual object SelectedItemOldcloneStructure
        {
            get { return selectedItemOldcloneStructure; }
            set
            {
                selectedItemOldcloneStructure = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedItemOldcloneStructure"));
            }
        }

        private object selectedItemOldStructure;
        public virtual object SelectedItemOldStructure
        {
            get { return selectedItemOldStructure; }
            set
            {
                selectedItemOldStructure = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedItemOldStructure"));
            }
        }

        private string selectedItemStructureGroup;
        public string SelectedItemStructureGroup
        {
            get
            {
                return selectedItemStructureGroup;
            }
            set
            {
                selectedItemStructureGroup = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedItemStructureGroup"));
            }
        }
        #endregion

        #region [GEOS2-3909][Rupali Sarode]

        public ObservableCollection<ERMSOPModule> TmpModuleMenulist
        {

            get { return tmpModuleMenulist; }
            set
            {
                tmpModuleMenulist = value;
                OnPropertyChanged(new PropertyChangedEventArgs("TmpModuleMenulist"));
            }
        }

        #region [GEOS2-4108][Rupali Sarode]
        public ObservableCollection<ERMSOPModule> TmpModuleMenulistOriginal
        {

            get { return tmpModuleMenulistOriginal; }
            set
            {
                tmpModuleMenulistOriginal = value;
                OnPropertyChanged(new PropertyChangedEventArgs("TmpModuleMenulistOriginal"));
            }
        }

        public ObservableCollection<ERMSOPDetection> TmpDetectionMenulistOriginal
        {

            get { return tmpDetectionMenulistOriginal; }
            set
            {
                tmpDetectionMenulistOriginal = value;
                OnPropertyChanged(new PropertyChangedEventArgs("TmpDetectionMenulistOriginal"));
            }
        }

        public ObservableCollection<ERMSOPOptions> TmpOptionMenulistOriginal
        {

            get { return tmpOptionMenulistOriginal; }
            set
            {
                tmpOptionMenulistOriginal = value;
                OnPropertyChanged(new PropertyChangedEventArgs("TmpOptionMenulistOriginal"));
            }
        }

        public ObservableCollection<ERMSOPStructures> TmpStructureMenulistOriginal
        {

            get { return tmpStructureMenulistOriginal; }
            set
            {
                tmpStructureMenulistOriginal = value;
                OnPropertyChanged(new PropertyChangedEventArgs("TmpStructureMenulistOriginal"));
            }
        }

        public ObservableCollection<ERMSOPWays> TmpWayMenulistOriginal
        {

            get { return tmpWayMenulistOriginal; }
            set
            {
                tmpWayMenulistOriginal = value;
                OnPropertyChanged(new PropertyChangedEventArgs("TmpWayMenulistOriginal"));
            }
        }

        public ObservableCollection<ERMSOPSpareParts> TmpSparePartsMenulistOriginal
        {

            get { return tmpSparePartsMenulistOriginal; }
            set
            {
                tmpSparePartsMenulistOriginal = value;
                OnPropertyChanged(new PropertyChangedEventArgs("TmpSparePartsMenulistOriginal"));
            }
        }



        #endregion

        public bool FlagToDragDrop
        {
            get { return flagToDragDrop; }
            set
            {
                flagToDragDrop = value;
                OnPropertyChanged(new PropertyChangedEventArgs("FlagToDragDrop"));
            }
        }
        #endregion

        #region [GEOS2-3922][Rupali Sarode][05-11-2022]

        public ObservableCollection<ERMSOPDetection> TmpDetectionMenulist
        {

            get { return tmpDetectionMenulist; }
            set
            {
                tmpDetectionMenulist = value;
                OnPropertyChanged(new PropertyChangedEventArgs("TmpDetectionMenulist"));
            }
        }

        public ulong TmpIdCPType
        {

            get { return tmpIdCPType; }
            set
            {
                tmpIdCPType = value;
                OnPropertyChanged(new PropertyChangedEventArgs("TmpIdCPType"));
            }
        }

        public ulong TmpIdDetection
        {

            get { return tmpIdDetection; }
            set
            {
                tmpIdDetection = value;
                OnPropertyChanged(new PropertyChangedEventArgs("TmpIdDetection"));
            }
        }

        #endregion

        #region //[GEOS2-3924][Rupali Sarode][22-11-2022]
        public ulong TmpIdOption
        {

            get { return tmpIdOption; }
            set
            {
                tmpIdOption = value;
                OnPropertyChanged(new PropertyChangedEventArgs("TmpIdOption"));
            }
        }

        public ObservableCollection<ERMSOPOptions> TmpOptionMenulist
        {

            get { return tmpOptionMenulist; }
            set
            {
                tmpOptionMenulist = value;
                OnPropertyChanged(new PropertyChangedEventArgs("TmpOptionMenulist"));
            }
        }

        #endregion

        #region [GEOS2-3926][Rupali Sarode][25-11-2022]
        public ulong TmpIdStructure
        {

            get { return tmpIdStructure; }
            set
            {
                tmpIdStructure = value;
                OnPropertyChanged(new PropertyChangedEventArgs("TmpIdStructure"));
            }
        }

        public ObservableCollection<ERMSOPStructures> TmpStructureMenulist
        {

            get { return tmpStructureMenulist; }
            set
            {
                tmpStructureMenulist = value;
                OnPropertyChanged(new PropertyChangedEventArgs("TmpStructureMenulist"));
            }
        }

        public ObservableCollection<ERMStructures> StructureMenulistForGridLayout
        {

            get { return structureMenulistForGridLayout; }
            set
            {
                structureMenulistForGridLayout = value;
                OnPropertyChanged(new PropertyChangedEventArgs("StructureMenulistForGridLayout"));
            }
        }
        #endregion

        #region [GEOS2-3859][Rupali Sarode][28-11-2022]
        public ObservableCollection<ERMSpareParts> SparePartsMenulistForGridLayout
        {

            get { return sparePartsMenulistForGridLayout; }
            set
            {
                sparePartsMenulistForGridLayout = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SparePartsMenulistForGridLayout"));
            }
        }
        #endregion

        #region [sdeshpande][GEOS2-3923][17-11-2022]
        public int TmpIdWayType
        {

            get { return tmpIdWayType; }
            set
            {
                tmpIdWayType = value;
                OnPropertyChanged(new PropertyChangedEventArgs("TmpIdWayType"));
            }
        }

        public ObservableCollection<ERMSOPWays> TmpWayMenulist
        {
            get { return tmpWayMenulist; }
            set
            {
                tmpWayMenulist = value;
                OnPropertyChanged(new PropertyChangedEventArgs("TmpWayMenulist"));
            }
        }

        private ObservableCollection<ERMWays> waysMenulistForGridLayout;
        public ObservableCollection<ERMWays> WaysMenulistForGridLayout
        {
            get { return waysMenulistForGridLayout; }
            set
            {
                waysMenulistForGridLayout = value;
                OnPropertyChanged(new PropertyChangedEventArgs("WaysMenulistForGridLayout"));
            }
        }
        #endregion


        #region [GEOS2-3925][Rupali Sarode][29-11-2022]
        public ulong TmpIdSpareParts
        {

            get { return tmpIdSpareParts; }
            set
            {
                tmpIdSpareParts = value;
                OnPropertyChanged(new PropertyChangedEventArgs("TmpIdSpareParts"));
            }
        }

        public ObservableCollection<ERMSOPSpareParts> TmpSparePartsMenulist
        {

            get { return tmpSparePartsMenulist; }
            set
            {
                tmpSparePartsMenulist = value;
                OnPropertyChanged(new PropertyChangedEventArgs("TmpSparePartsMenulist"));
            }
        }


        #endregion

        //[GEOS2-4987][gulab lakade][26 10 2023]


        public string SelectedTabName
        {
            get
            {
                return selectedTabName;
            }
            set
            {
                selectedTabName = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedTabName"));
            }
        }
        public string OldTabName
        {
            get
            {
                return oldTabName;
            }
            set
            {
                oldTabName = value;
                OnPropertyChanged(new PropertyChangedEventArgs("OldTabName"));
            }
        }
        public bool IsEnabled
        {
            get
            {
                return isEnabled;
            }

            set
            {
                isEnabled = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsEnabled"));
            }
        }

        public StandardOperationsDictionary ClonedSODFORDRAGDROP { get; set; }

        #endregion





        #region ICommands

        public ICommand EscapeButtonCommand { get; set; }
        public ICommand CancelButtonCommand { get; set; }
        public ICommand ChangeLanguageCommand { get; set; }
        public ICommand ChangeNameCommand { get; set; }
        public ICommand SetControlWidthUsingActualWidthCommand { get; set; }
        public ICommand ChangeDescriptionCommand { get; set; }
        public ICommand UncheckedCopyNameDescriptionCommand { get; set; }

        public ICommand AcceptButtonCommand { get; set; }

        public ICommand ShowDescriptionViewCommand { get; set; }
        public ICommand ChangePlantCommand { get; set; }
        public ICommand SaveButtonCommand { get; set; }
        public ICommand ChangeStatusCommand { get; set; }
        public ICommand ChangeEffectiveDateCommand { get; set; }
        public ICommand ChangeExpiryDateCommand { get; set; }
        public ICommand ChangeCheckAllLanguagesCommand { get; set; }

        public ICommand TreeListViewLoadedCommand { get; set; }
        public ICommand SupplementsValueChangedCommand { get; set; }

        public ICommand ToogleButtonCommand { get; set; }
        public ICommand CommandOnDragRecordOverModuleGrid { get; set; }
        public ICommand CommandDropRecordModuleGrid { get; set; }
        public ICommand CommandCompleteRecordDragDropModuleGrid { get; set; }
        public ICommand ExportToExcelCommand { get; set; }


        #region GEOS2-3246
        public ICommand CommandShowFilterPopupClick { get; set; }
        public ICommand CommandTileBarClickDoubleClick { get; set; }
        public ICommand CommandTemplateSelection { get; set; }
        public ICommand HidePanelCommand { get; set; }
        public ICommand DeleteModuleTreeListControlCommand { get; set; }
        public ICommand SelectCPTypesCommand { get; set; }
        public ICommand CustomSummaryCommand { get; set; }
        public ICommand CommandCellValueChanged { get; set; }
        public ICommand ObservedTimeEditValueChangedCommand { get; set; }
        public ICommand CellValueChangedCommand { get; set; }
        public ICommand ModuleGridParentMenuTreeList_CellValueChanged { get; set; }
        public ICommand ModuleGridParentMenuTreeList_CellValueChanging { get; set; }


        public ICommand CommandAccordionControl_Drop { get; set; }  //[GEOS2-3909][Rupali Sarode]
        public ICommand CommandDetectionAccordionControl_Drop { get; set; }  //[GEOS2-3922][Rupali Sarode][05-11-2022]
        public ICommand CommandOptionsAccordionControl_Drop { get; set; }  //[GEOS2-3924][Rupali Sarode][21-11-2022]
        public ICommand CommandStructuresAccordionControl_Drop { get; set; } //[GEOS2-3926][Rupali Sarode][25-11-2022]
        public ICommand CommandWaysAccordionControl_Drop { get; set; }  //[GEOS2-3923][sdeshpande][17-11-2022]
        public ICommand CommandSparePartsAccordionControl_Drop { get; set; }  //[GEOS2-3925][Rupali Sarode][29-11-2022]

        // shubham[skadam] GEOS2-3808 Standard times in Detections per workstation (#ERM11) 07 Jul 2022
        #region GEOS2-3808
        public ICommand detectionHidePanelCommand { get; set; }
        public ICommand CommandOnDragRecordOverDetectionGrid { get; set; }
        public ICommand CommandDropRecordDetectionGrid { get; set; }
        public ICommand CommandCompleteRecordDragDropDetectionGrid { get; set; }
        public ICommand DetectionGridParentMenuTreeList_CellValueChanged { get; set; }
        public ICommand DetectionGridParentMenuTreeList_CellValueChanging { get; set; }
        public ICommand DetectionCustomSummaryCommand { get; set; }
        public ICommand DeleteDetectionTreeListControlCommand { get; set; }
        public ICommand DetectionTreeListViewLoadedCommand { get; set; }

        #endregion
        #endregion


        #region GEOS2-3665
        //shubham[skadam] GEOS2-3665 WorkOperation Menu to the Standard Operations Dictionary(SOD) (#ERM20) [6 / 7 ] - Drag and drop for the Ways Tab  18 Jul 2022
        public ICommand CommandOnDragRecordOverWaysGrid { get; set; }
        public ICommand CommandDropRecordWaysGrid { get; set; }
        public ICommand CommandCompleteRecordDragDropWaysGrid { get; set; }
        #endregion
        #region GEOS2-3664
        public ICommand CommandOnDragRecordOverOptionsGrid { get; set; }
        public ICommand CommandDropRecordOptionsGrid { get; set; }
        public ICommand CommandCompleteRecordDragDropOptionsGrid { get; set; }
        //Gulab Lakade GEOS2-3837 // Standard times in Options per workstation (#ERM12)
        #region GEOS2-3837
        public ICommand OptionsHidePanelCommand { get; set; }
        public ICommand OptionGridParentMenuTreeList_CellValueChanged { get; set; }
        public ICommand OptionGridParentMenuTreeList_CellValueChanging { get; set; }
        public ICommand OptionCustomSummaryCommand { get; set; }
        public ICommand DeleteOptionTreeListControlCommand { get; set; }
        public ICommand OptionTreeListViewLoadedCommand { get; set; }
        #endregion
        #region GEOS2-3838
        public ICommand WaysHidePanelCommand { get; set; }
        public ICommand WayGridParentMenuTreeList_CellValueChanged { get; set; }
        public ICommand WayGridParentMenuTreeList_CellValueChanging { get; set; }
        public ICommand WayCustomSummaryCommand { get; set; }
        public ICommand DeleteWayTreeListControlCommand { get; set; }
        public ICommand WayTreeListViewLoadedCommand { get; set; }
        #endregion
        #endregion
        #region GEOS2-3666
        public ICommand CommandOnDragRecordOverSparepartsGrid { get; set; }
        public ICommand CommandDropRecordSparepartsGrid { get; set; }
        public ICommand CommandCompleteRecordDragDropSparepartsGrid { get; set; }
        #endregion
        #region GEOS2-3666
        public ICommand CommandOnDragRecordOverStructuresGrid { get; set; }
        public ICommand CommandDropRecordStructuresGrid { get; set; }
        public ICommand CommandCompleteRecordDragDropStructuresGrid { get; set; }
        #endregion
        #region GEOS2 -3855
        public ICommand LogsHidePanelCommand { get; set; }
        #endregion

        #region [GEOS2-3601][Rupali Sarode]
        public ICommand StructuresHidePanelCommand { get; set; }
        public ICommand DeleteStructureTreeListControlCommand { get; set; }
        public ICommand StructureTreeListViewLoadedCommand { get; set; }
        public ICommand StructureCustomSummaryCommand { get; set; }
        public ICommand StructureGridParentMenuTreeList_CellValueChanged { get; set; }
        public ICommand StructureGridParentMenuTreeList_CellValueChanging { get; set; }
        #endregion
        #region Add Refresh Work Operation Icon
        public ICommand RefreshWorkOperationCommand { get; set; }
        #endregion
        #endregion

        #region GEOS2-4033 Spare Part Gulab Lakade
        public ICommand SparePartsHidePanelCommand { get; set; }
        public ICommand SparePartGridParentMenuTreeList_CellValueChanged { get; set; }
        public ICommand SparePartGridParentMenuTreeList_CellValueChanging { get; set; }
        public ICommand SparePartCustomSummaryCommand { get; set; }
        public ICommand DeleteSparePartTreeListControlCommand { get; set; }
        public ICommand SparePartTreeListViewLoadedCommand { get; set; }
        #endregion
        public ICommand TabSelectionChangingCommand { get; set; }//[GEOS2-4910][gulab lakade][05 10 2023]



        #region Constructor

        public AddEditStandardOperationsDictionaryViewModel()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Constructor AddEditStandardOperationsDictionaryViewModel ...", category: Category.Info, priority: Priority.Low);

                DialogWidth = System.Windows.SystemParameters.WorkArea.Width - 20;
                DialogHeight = System.Windows.SystemParameters.WorkArea.Height - 90;
                IsInformationVisible = true;
                IsToggleButtonVisible = Visibility.Visible;
                if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }

                EscapeButtonCommand = new DelegateCommand<object>(CloseWindow);
                CancelButtonCommand = new DelegateCommand<object>(CloseWindow);

                ChangeLanguageCommand = new DelegateCommand<object>(RetrieveDescriptionByLanguge);
                ChangeNameCommand = new DelegateCommand<object>(SetNameToLanguage);
                SetControlWidthUsingActualWidthCommand = new DelegateCommand<object>(SetControlWidthUsingActualWidth);
                ChangeDescriptionCommand = new DelegateCommand<object>(SetDescriptionToLanguage);
                UncheckedCopyNameDescriptionCommand = new DelegateCommand<object>(UncheckedCopyNameDescription);
                ShowDescriptionViewCommand = new DelegateCommand<object>(ShowDescriptionViewCommandAction);
                AcceptButtonCommand = new DelegateCommand<object>(AcceptButtonCommandAction);
                ChangePlantCommand = new DelegateCommand<object>(ChangePlantCommandAction);
                TreeListViewLoadedCommand = new DelegateCommand<RoutedEventArgs>(TreeListViewLoadedCommandAction);

                SaveButtonVisibility = Visibility.Collapsed;
                //GEOS2 - 3808
                SaveButtonCommand = new DelegateCommand(SaveButtonCommandAction);
                ChangeStatusCommand = new DelegateCommand<object>(ChangeStatusCommandAction);
                ChangeEffectiveDateCommand = new DelegateCommand(ChangeEffectiveDateCommandAction);
                ChangeExpiryDateCommand = new DelegateCommand(ChangeExpiryDateCommandAction);
                SupplementsValueChangedCommand = new DelegateCommand<object>(SupplementsValueChangedCommandAction);
                ToogleButtonCommand = new DelegateCommand(ToogleButtonCommandAction);
                isInitializeFirstTime = true;

                #region GEOS2-3246
                CommandTemplateSelection = new DelegateCommand(SelectItemForTemplate);
                HidePanelCommand = new RelayCommand(new Action<object>(HidePanel));
                IsTemplateDetailsViewVisible = Visibility.Visible;
                CommandOnDragRecordOverModuleGrid = new DelegateCommand<DragRecordOverEventArgs>(OnDragRecordOverModuleGrid);
                CommandDropRecordModuleGrid = new DelegateCommand<DropRecordEventArgs>(DropRecordModuleGrid);
                CommandCompleteRecordDragDropModuleGrid = new DelegateCommand<CompleteRecordDragDropEventArgs>(CompleteRecordDragDropModuleGrid);
                DeleteModuleTreeListControlCommand = new RelayCommand(new Action<object>(DeleteModuleTreeListControlCommandAction));
                //SelectCPTypesCommand = new DelegateCommand<object>(RetrieveWorkOperationsByCPTypes);
                //SelectCPTypesCommand = new DelegateCommand(RetrieveWorkOperationsByCPTypes);
                CustomSummaryCommand = new DelegateCommand<object>(CustomSummaryCommandAction);
                ObservedTimeEditValueChangedCommand = new DelegateCommand<EditValueChangedEventArgs>(EditValueChangedCommandAction);
                //RuleValueChangedCommand = new DelegateCommand<object>(RuleValueChangedCommandAction);
                CellValueChangedCommand = new DelegateCommand<TreeListCellValueChangedEventArgs>((x) => CellChanged(x));

                ModuleGridParentMenuTreeList_CellValueChanged = new DelegateCommand<object>(ModuleGridParentMenuTreeList_CellValueChangedCommandAction);
                ModuleGridParentMenuTreeList_CellValueChanging = new DelegateCommand<object>(ModuleGridParentMenuTreeList_CellValueChangingCommandAction);
                #endregion


                CommandAccordionControl_Drop = new DelegateCommand<DragEventArgs>(AccordionControl_Drop); //[GEOS2-3909][Rupali Sarode]
                CommandDetectionAccordionControl_Drop = new DelegateCommand<DragEventArgs>(DetectionAccordionControl_Drop); //[GEOS2-3922][Rupali Sarode][05-11-2022]
                CommandOptionsAccordionControl_Drop = new DelegateCommand<DragEventArgs>(OptionsAccordionControl_Drop); //[GEOS2-3924][Rupali Sarode][21-11-2022]
                CommandStructuresAccordionControl_Drop = new DelegateCommand<DragEventArgs>(StructuresAccordionControl_Drop); //[GEOS2-3926][Rupali Sarode][25-11-2022] 
                CommandWaysAccordionControl_Drop = new DelegateCommand<DragEventArgs>(WaysAccordionControl_Drop); //[GEOS2-3923][sdeshpande][05-11-2022] 
                CommandSparePartsAccordionControl_Drop = new DelegateCommand<DragEventArgs>(SparePartsAccordionControl_Drop); //[GEOS2-3925][Rupali Sarode][29-11-2022] 


                // shubham[skadam] GEOS2-3808 Standard times in Detections per workstation (#ERM11) 07 Jul 2022
                #region GEOS2-3808
                detectionHidePanelCommand = new RelayCommand(new Action<object>(HideDetectionPanel));
                CommandOnDragRecordOverDetectionGrid = new DelegateCommand<DragRecordOverEventArgs>(OnDragRecordOverDetectionGrid);
                CommandDropRecordDetectionGrid = new DelegateCommand<DropRecordEventArgs>(DropRecordDetectionGrid);
                CommandCompleteRecordDragDropDetectionGrid = new DelegateCommand<CompleteRecordDragDropEventArgs>(CompleteRecordDragDropDetectionGrid);
                DetectionGridParentMenuTreeList_CellValueChanged = new DelegateCommand<object>(DetectionGridParentMenuTreeList_CellValueChangedCommandAction);
                DetectionGridParentMenuTreeList_CellValueChanging = new DelegateCommand<object>(DetectionGridParentMenuTreeList_CellValueChangingCommandAction);
                DeleteDetectionTreeListControlCommand = new RelayCommand(new Action<object>(DeleteDetectionTreeListControlCommandAction));
                DetectionCustomSummaryCommand = new DelegateCommand<object>(DetectionCustomSummaryCommandAction);
                DetectionTreeListViewLoadedCommand = new DelegateCommand<RoutedEventArgs>(DetectionTreeListViewLoadedCommandAction);
                #endregion

                #region GEOS2-3665
                CommandOnDragRecordOverWaysGrid = new DelegateCommand<DragRecordOverEventArgs>(OnDragRecordOverWaysGrid);
                CommandDropRecordWaysGrid = new DelegateCommand<DropRecordEventArgs>(DropRecordWaysGrid);
                CommandCompleteRecordDragDropWaysGrid = new DelegateCommand<CompleteRecordDragDropEventArgs>(CompleteRecordDragDropWaysGrid);
                #endregion
                #region GEOS2-3664
                CommandOnDragRecordOverOptionsGrid = new DelegateCommand<DragRecordOverEventArgs>(OnDragRecordOverOptionsGrid);
                CommandDropRecordOptionsGrid = new DelegateCommand<DropRecordEventArgs>(DropRecordOptionsGrid);
                CommandCompleteRecordDragDropOptionsGrid = new DelegateCommand<CompleteRecordDragDropEventArgs>(CompleteRecordDragDropOptionsGrid);
                #region GEOS2-3837
                // Gulab lakade GEOS2-3837 // Standard times in Options per workstation (#ERM12) 26/07/2022
                OptionsHidePanelCommand = new RelayCommand(new Action<object>(HideOptionPanel));
                OptionGridParentMenuTreeList_CellValueChanged = new DelegateCommand<object>(OptionGridParentMenuTreeList_CellValueChangedCommandAction);
                OptionGridParentMenuTreeList_CellValueChanging = new DelegateCommand<object>(OptionGridParentMenuTreeList_CellValueChangingCommandAction);
                DeleteOptionTreeListControlCommand = new RelayCommand(new Action<object>(DeleteOptionTreeListControlCommandAction));
                OptionCustomSummaryCommand = new DelegateCommand<object>(OptionCustomSummaryCommandAction);
                OptionTreeListViewLoadedCommand = new DelegateCommand<RoutedEventArgs>(OptionTreeListViewLoadedCommandAction);
                #endregion
                #region GEOS2-3838
                WaysHidePanelCommand = new RelayCommand(new Action<object>(HideWayPanel));
                WayGridParentMenuTreeList_CellValueChanged = new DelegateCommand<object>(WayGridParentMenuTreeList_CellValueChangedCommandAction);
                WayGridParentMenuTreeList_CellValueChanging = new DelegateCommand<object>(WayGridParentMenuTreeList_CellValueChangingCommandAction);
                DeleteWayTreeListControlCommand = new RelayCommand(new Action<object>(DeleteWayTreeListControlCommandAction));
                WayCustomSummaryCommand = new DelegateCommand<object>(WayCustomSummaryCommandAction);
                WayTreeListViewLoadedCommand = new DelegateCommand<RoutedEventArgs>(WayTreeListViewLoadedCommandAction);
                #endregion
                #endregion
                #region GEOS2-3666
                CommandOnDragRecordOverSparepartsGrid = new DelegateCommand<DragRecordOverEventArgs>(OnDragRecordOverSparepartsGrid);
                CommandDropRecordSparepartsGrid = new DelegateCommand<DropRecordEventArgs>(DropRecordSparepartsGrid);
                CommandCompleteRecordDragDropSparepartsGrid = new DelegateCommand<CompleteRecordDragDropEventArgs>(CompleteRecordDragDropSparepartsGrid);
                #endregion
                #region GEOS2-3662
                CommandOnDragRecordOverStructuresGrid = new DelegateCommand<DragRecordOverEventArgs>(OnDragRecordOverStructuresGrid);
                CommandDropRecordStructuresGrid = new DelegateCommand<DropRecordEventArgs>(DropRecordStructuresGrid);
                CommandCompleteRecordDragDropStructuresGrid = new DelegateCommand<CompleteRecordDragDropEventArgs>(CompleteRecordDragDropStructuresGrid);
                #endregion

                #region GEOS2-3855
                LogsHidePanelCommand = new RelayCommand(new Action<object>(HideLogPanel));
                StandardOperationsDictionaryChangeLogList = new ObservableCollection<LogentriesbyStandardOperationsDictionary>();
                #endregion

                #region [GEOS2-3601][Rupali Sarode]
                StructuresHidePanelCommand = new RelayCommand(new Action<object>(HideStructurePanel));
                DeleteStructureTreeListControlCommand = new RelayCommand(new Action<object>(DeleteStructureTreeListControlCommandAction));
                StructureTreeListViewLoadedCommand = new DelegateCommand<RoutedEventArgs>(StructureTreeListViewLoadedCommandAction);
                StructureCustomSummaryCommand = new DelegateCommand<object>(StructureCustomSummaryCommandAction);

                StructureGridParentMenuTreeList_CellValueChanged = new DelegateCommand<object>(StructureGridParentMenuTreeList_CellValueChangedCommandAction);
                StructureGridParentMenuTreeList_CellValueChanging = new DelegateCommand<object>(StructureGridParentMenuTreeList_CellValueChangingCommandAction);

                #endregion
                #region Add Refresh Work Operation Icon
                RefreshWorkOperationCommand = new DelegateCommand<object>(RefreshWorkOperation);
                #endregion

                #region GEOS2-4033 Spare Part Gulab Lakade
                SparePartsHidePanelCommand = new RelayCommand(new Action<object>(HideSparePartPanel));
                SparePartGridParentMenuTreeList_CellValueChanged = new DelegateCommand<object>(SparePartGridParentMenuTreeList_CellValueChangedCommandAction);
                SparePartGridParentMenuTreeList_CellValueChanging = new DelegateCommand<object>(SparePartGridParentMenuTreeList_CellValueChangingCommandAction);
                DeleteSparePartTreeListControlCommand = new RelayCommand(new Action<object>(DeleteSparePartTreeListControlCommandAction));
                SparePartCustomSummaryCommand = new DelegateCommand<object>(SparePartCustomSummaryCommandAction);
                SparePartTreeListViewLoadedCommand = new DelegateCommand<RoutedEventArgs>(SparePartTreeListViewLoadedCommandAction);

                #endregion


                TabSelectionChangingCommand = new DelegateCommand<object>(TabSelectionChangingCommandAction); //[GEOS2-4910][gulab lakade][05 10 2023]

                ExportToExcelCommand = new DelegateCommand<object>(ExportToExcel); //[GEOS2-4994][Rupali Sarode][23-11-2023]



                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }

                GeosApplication.Instance.Logger.Log("Constructor AddEditStandardOperationsDictionaryViewModel() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log(string.Format("Error in Constructor AddEditStandardOperationsDictionaryViewModel() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }

        }


        #region Add Refresh Work Operation Icon
        private void RefreshWorkOperation(object obj)
        {
            try
            {
                if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }
                FillWorkOperationsStages();
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
            }
            catch (Exception ex)
            { }
        }
        #endregion

        #endregion

        #region Methods

        public void Init(string selectedHeader)
        {
            try
            {


                GeosApplication.Instance.Logger.Log("Method Init()...", category: Category.Info, priority: Priority.Low);
                // MaximizedElementPosition = MaximizedElementPosition.Right;
                MaximizedElementPosition = ERMCommon.Instance.SetMaximizedElementPosition();//[Aishwarya Ingale][4920][22/11/2023]
                FillLanguages();
                GetPlants();
                GetLatestSODCode();
                FillStatusList();
                FillWorkOperationsStages();
                AddEditPlantsColumnsToSupplementsDataTable();
                FillSupplementDataTable();
                SaveButtonVisibility = Visibility.Collapsed;
                if (GeosApplication.Instance.IsEditSODPermissionERM)
                {
                    IsEnabledAcceptButton = true;
                }


                EffectiveDate = new DateTime(DateTime.Now.Year, 01, 01);
                ExpiryDate = new DateTime(DateTime.Now.Year, 12, 31);
                FlagToDragDrop = false;  //[GEOS2-3909][Rupali Sarode][11-11-2022]

                #region GEOS2-3246
                // shubham[skadam] GEOS2-3246 20 May 2022
                IsTemplateDetailsViewVisible = Visibility.Visible;
                IsGridOpen = true;
                IsBandOpen = false;
                //AddEditColumnInModulesDataTable();
                //FillModuleDataTable();
                FillTemplateMenulist();



                #endregion
                #region GEOS2-3808
                FillDetectionsGroupsMenulist();
                #endregion
                #region GEOS2-3837
                FillOptionGroupsMenulist();
                #endregion
                #region GEOS2-3838 - Way module
                FillWayGroupsMenulist();
                #endregion

                FillStructureGroupsMenulist(); //[GEOS2-3601][Rupali Sarode][29/9/2022]
                TmpIdCPType = 0; //[GEOS2-3909][Rupali Sarode][07-11-2022]
                TmpIdDetection = 0; //[GEOS2-3922][Rupali Sarode][07-11-2022]
                TmpIdOption = 0; //[GEOS2-3924][Rupali Sarode][22-11-2022]
                TmpIdStructure = 0; //[GEOS2-3926][Rupali Sarode][25-11-2022]
                TmpIdWayType = 0;  //[GEOS2-3923][Rupali Sarode][26-11-2022]
                TmpIdSpareParts = 0; //[GEOS2-3925][Rupali Sarode][29-11-2022]
                #region GEOS2-4033 Spare Part Gulab Lakade
                FillSparePartGroupsMenulist();
                #endregion
                GeosApplication.Instance.Logger.Log("Method Init()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method Init() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        //[001][cpatil][18-04-2022][GEOS2-3659]
        public void FillWorkOperationsStages()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillWorkOperationsStages()...", category: Category.Info, priority: Priority.Low);
                ObservableCollection<WorkOperationByStages> OperationList = new ObservableCollection<WorkOperationByStages>();
                ObservableCollection<WorkOperationByStages> tempWorkOperationMenulist = new ObservableCollection<WorkOperationByStages>();
                if (GetStages == null)
                {
                    GetStages = new ObservableCollection<Stages>(ERMService.GetStages());
                }
                else
                {
                    GetStages.Clear();
                    GetStages.AddRange(ERMService.GetStages());
                }

                OperationList.Clear();
                foreach (Stages item in GetStages)
                {
                    // shubham[skadam] GEOS2-3246 30 May 2022 Updated by [rdixit][GEOS2-3764][04.08.2022]
                    //[GEOS2-3933][Rupali Sarode][21/09/2022]
                    //OperationList.AddRange(ERMService.GetAllWorkOperationStages_V2300(item.IdStage));
                    OperationList.AddRange(ERMService.GetAllWorkOperationStages_V2320(item.IdStage));

                }

                UpdateWorkOperationCount(OperationList);
                if (WorkOperationMenulist == null)
                {
                    WorkOperationMenulist = new ObservableCollection<WorkOperationByStages>();
                }
                else
                {
                    WorkOperationMenulist.Clear();
                }

                WorkOperationByStages workOperationByStages = new WorkOperationByStages();
                workOperationByStages.Name = "All";
                workOperationByStages.KeyName = "Group_All";
                workOperationByStages.WorkOperation_count = OperationList.GroupBy(i => i.IdworkOperationByStage).Count();
                workOperationByStages.NameWithWorkOperationCount = "All [" + workOperationByStages.WorkOperation_count + "]";
                tempWorkOperationMenulist.Insert(0, workOperationByStages);
                foreach (Stages item in GetStages)
                {
                    WorkOperationByStages workOperation = new WorkOperationByStages();
                    workOperation.IdworkOperationByStage = item.IdStage;
                    workOperation.Name = item.Code;
                    workOperation.KeyName = "Stage_" + item.IdStage;
                    workOperation.Parent = null;
                    workOperation.IdParent = null;
                    workOperation.Position = Convert.ToUInt32(item.IdSequence);
                    workOperation.WorkOperation_count = OperationList.Where(x => x.IdStage == item.IdStage).GroupBy(i => i.IdworkOperationByStage).Count();
                    workOperation.NameWithWorkOperationCount = item.Code + " [" + workOperation.WorkOperation_count + "]";
                    tempWorkOperationMenulist.Add(workOperation);
                    tempWorkOperationMenulist.AddRange(OperationList.Where(x => x.IdStage == item.IdStage));
                }
                var tempWorkOperationMenulist2 = tempWorkOperationMenulist.OrderBy(x => x.Position).ToList();
                //WorkOperationMenulist.Clear();
                if (treeListControlInstance != null) treeListControlInstance.BeginDataUpdate();
                WorkOperationMenulist.AddRange(tempWorkOperationMenulist2);
                // var temp= WorkOperationMenulist.Where(x=>x.idsta)
                if (treeListControlInstance != null) treeListControlInstance.EndDataUpdate();

                //WorkOperationMenulist = new ObservableCollection<WorkOperationByStages>(WorkOperationMenulist.OrderBy(x => x.Position));
                SelectedWorkOperationMenulist = WorkOperationMenulist.FirstOrDefault();
                if (treeListControlInstance != null) treeListControlInstance.View.ExpandAllNodes();
                //WorkOperationsList = new ObservableCollection<WorkOperation>(WorkOperationsList_All);

                //SelectedWorkOperation = WorkOperationsList.FirstOrDefault();
                // ClonedWorkOperationByStages = (ObservableCollection<WorkOperationByStages>)WorkOperationMenulist;
                GeosApplication.Instance.Logger.Log("Method FillWorkOperationsStages()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in FillWorkOperationsStages() Method " + ex.Detail.ErrorMessage, category: Category.Info, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in FillWorkOperationsStages() Method - ServiceUnexceptedException " + ex.Message, category: Category.Info, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString(), null);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in Method FillWorkOperationsStages()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        //[001][cpatil][18-04-2022][GEOS2-3659]
        private void UpdateWorkOperationCount(ObservableCollection<WorkOperationByStages> OperationList)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method UpdateWorkOperationCount()...", category: Category.Info, priority: Priority.Low);

                foreach (WorkOperationByStages item in OperationList)
                {
                    int count = 0;
                    //[001]
                    //if (item.WorkOperation_count_original != null)
                    //{
                    //    count = item.WorkOperation_count_original;
                    //}
                    if (OperationList.Any(a => a.ParentName == item.KeyName))
                    {
                        List<WorkOperationByStages> getFirstList = OperationList.Where(a => a.ParentName == item.KeyName).ToList();
                        foreach (WorkOperationByStages item1 in getFirstList)
                        {
                            if (item1.WorkOperation_count_original != null)
                            {
                                count = count + item1.WorkOperation_count_original;
                            }
                            if (OperationList.Any(a => a.ParentName == item1.KeyName))
                            {
                                List<WorkOperationByStages> getSecondList = OperationList.Where(a => a.ParentName == item1.KeyName).ToList();
                                foreach (WorkOperationByStages item2 in getSecondList)
                                {
                                    if (item2.WorkOperation_count_original != null)
                                    {
                                        count = count + item2.WorkOperation_count_original;
                                    }
                                    if (OperationList.Any(a => a.ParentName == item2.KeyName))
                                    {
                                        List<WorkOperationByStages> getThirdList = OperationList.Where(a => a.ParentName == item2.KeyName).ToList();
                                        foreach (WorkOperationByStages item3 in getThirdList)
                                        {
                                            if (item3.WorkOperation_count_original != null)
                                            {
                                                count = count + item3.WorkOperation_count_original;
                                            }
                                            if (OperationList.Any(a => a.ParentName == item3.KeyName))
                                            {
                                                List<WorkOperationByStages> getForthList = OperationList.Where(a => a.ParentName == item3.KeyName).ToList();
                                                foreach (WorkOperationByStages item4 in getForthList)
                                                {
                                                    if (item4.WorkOperation_count_original != null)
                                                    {
                                                        count = count + item4.WorkOperation_count_original;
                                                    }
                                                    if (OperationList.Any(a => a.ParentName == item4.KeyName))
                                                    {
                                                        List<WorkOperationByStages> getFifthList = OperationList.Where(a => a.ParentName == item4.KeyName).ToList();
                                                        foreach (WorkOperationByStages item5 in getFifthList)
                                                        {
                                                            if (item5.WorkOperation_count_original != null)
                                                            {
                                                                count = count + item5.WorkOperation_count_original;
                                                            }
                                                            if (OperationList.Any(a => a.ParentName == item5.KeyName))
                                                            {
                                                                List<WorkOperationByStages> getSixthList = OperationList.Where(a => a.ParentName == item5.KeyName).ToList();
                                                                foreach (WorkOperationByStages item6 in getSixthList)
                                                                {
                                                                    if (item6.WorkOperation_count_original != null)
                                                                    {
                                                                        count = count + item6.WorkOperation_count_original;
                                                                    }
                                                                    if (OperationList.Any(a => a.ParentName == item6.KeyName))
                                                                    {
                                                                        List<WorkOperationByStages> getSeventhList = OperationList.Where(a => a.ParentName == item6.KeyName).ToList();
                                                                        foreach (WorkOperationByStages item7 in getSeventhList)
                                                                        {
                                                                            if (item7.WorkOperation_count_original != null)
                                                                            {
                                                                                count = count + item7.WorkOperation_count_original;
                                                                            }
                                                                            if (OperationList.Any(a => a.ParentName == item7.KeyName))
                                                                            {
                                                                                List<WorkOperationByStages> getEightthList = OperationList.Where(a => a.ParentName == item7.KeyName).ToList();
                                                                                foreach (WorkOperationByStages item8 in getEightthList)
                                                                                {
                                                                                    if (item8.WorkOperation_count_original != null)
                                                                                    {
                                                                                        count = count + item8.WorkOperation_count_original;
                                                                                    }
                                                                                    if (OperationList.Any(a => a.ParentName == item8.KeyName))
                                                                                    {
                                                                                        List<WorkOperationByStages> getNinethList = OperationList.Where(a => a.ParentName == item8.KeyName).ToList();
                                                                                        foreach (WorkOperationByStages item9 in getNinethList)
                                                                                        {
                                                                                            if (item9.WorkOperation_count_original != null)
                                                                                            {
                                                                                                count = count + item9.WorkOperation_count_original;
                                                                                            }
                                                                                            if (OperationList.Any(a => a.ParentName == item9.KeyName))
                                                                                            {
                                                                                                List<WorkOperationByStages> gettenthList = OperationList.Where(a => a.ParentName == item9.KeyName).ToList();
                                                                                                foreach (WorkOperationByStages item10 in gettenthList)
                                                                                                {
                                                                                                    if (item10.WorkOperation_count_original != null)
                                                                                                    {
                                                                                                        count = count + item10.WorkOperation_count_original;
                                                                                                    }
                                                                                                }
                                                                                            }
                                                                                        }
                                                                                    }
                                                                                }
                                                                            }
                                                                        }
                                                                    }
                                                                }
                                                            }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                    item.WorkOperation_count = count;
                    item.NameWithWorkOperationCount = Convert.ToString(item.Name + " [" + Convert.ToInt32(item.WorkOperation_count) + "]");
                }
                GeosApplication.Instance.Logger.Log("Method UpdateWorkOperationCount()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {

                GeosApplication.Instance.Logger.Log(string.Format("Error in method UpdateWorkOperationCount() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        public void EditInit(string selectedHeader)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method EditInit()...", category: Category.Info, priority: Priority.Low);
                //  MaximizedElementPosition = MaximizedElementPosition.Right;
                MaximizedElementPosition = ERMCommon.Instance.SetMaximizedElementPosition();//[Aishwarya Ingale][4920][22/11/2023]
                FillLanguages();
                GetPlants();
                GetLatestSODCode();
                FillStatusList();
                FillWorkOperationsStages();

                SaveButtonVisibility = Visibility.Visible;
                if (GeosApplication.Instance.IsEditSODPermissionERM)
                {
                    IsEnabledAcceptButton = true;
                }


                EffectiveDate = new DateTime(DateTime.Now.Year + 1, 01, 01);
                ExpiryDate = new DateTime(DateTime.Now.Year + 1, 12, 31);
                Height = "0";

                FlagToDragDrop = false;  //[GEOS2-3909][Rupali Sarode][11-11-2022]

                #region GEOS2-3246
                // shubham[skadam] GEOS2-3246 20 May 2022
                IsTemplateDetailsViewVisible = Visibility.Visible;
                IsGridOpen = true;
                IsBandOpen = false;
                //AddEditColumnInModulesDataTable();
                //FillModuleDataTable();
                // FillTemplateMenulist();

                #endregion
                #region Comment code [28 12 2022]
                //#region GEOS2-3808
                //FillDetectionsGroupsMenulist();
                //#endregion
                //#region GEOS2-3837
                //FillOptionGroupsMenulist();
                //#endregion
                //#region GEOS2-3838 - Way module
                //FillWayGroupsMenulist();
                //#endregion

                //FillStructureGroupsMenulist(); //[GEOS2-3601][Rupali Sarode][29/9/2022]
                #endregion
                TmpIdCPType = 0; //[GEOS2-3909][Rupali Sarode][07-11-2022]
                TmpIdDetection = 0; //[GEOS2-3922][Rupali Sarode][07-11-2022]
                TmpIdOption = 0; //[GEOS2-3924][Rupali Sarode][22-11-2022]
                TmpIdStructure = 0; //[GEOS2-3926][Rupali Sarode][25-11-2022]
                TmpIdWayType = 0;  //[GEOS2-3923]
                TmpIdSpareParts = 0; //[GEOS2-3925][Rupali Sarode][29-11-2022]
                TmpModuleMenulist = null; //[GEOS2-3909][Rupali Sarode]
                TmpDetectionMenulist = null; //[GEOS2-3922][Rupali Sarode]
                TmpOptionMenulist = null; //[GEOS2-3924][Rupali Sarode][22-11-2022]
                TmpStructureMenulist = null; //[GEOS2-3926][Rupali Sarode][25-11-2022]
                TmpWayMenulist = null;
                TmpSparePartsMenulist = null; //[GEOS2-3925][Rupali Sarode][29-11-2022]

                //#region GEOS2-4033 Spare Part Gulab Lakade
                //FillSparePartGroupsMenulist();
                //#endregion
                GeosApplication.Instance.Logger.Log("Method EditInit()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {

                GeosApplication.Instance.Logger.Log(string.Format("Error in method EditInit() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        //[001][CPATIL][17-05-2022][GEOS2-3702]
        private void AddEditPlantsColumnsToSupplementsDataTable()
        {

            try
            {
                GeosApplication.Instance.Logger.Log("Method AddEditPlantsColumnsToSupplementsDataTable()...", category: Category.Info, priority: Priority.Low);

                if (SelectedPlant == null)
                    SelectedPlant = new List<object>();

                Columns = new ObservableCollection<Emdep.Geos.UI.Helper.Column>() {

                        new Emdep.Geos.UI.Helper.Column() { FieldName="IdLookupValue",HeaderText="IdLookupValue", Settings = SettingsType.Hidden , AllowCellMerge=false,  Width=120,AllowEditing=false,Visible=false,IsVertical= false,FixedWidth=false  },

                        new Emdep.Geos.UI.Helper.Column() { FieldName="Category",HeaderText="Category", Settings = SettingsType.Default, AllowCellMerge=false, Width=150, AllowEditing=false,Visible=true,IsVertical= false,FixedWidth=false  },
                        new Emdep.Geos.UI.Helper.Column() { FieldName="Name",HeaderText="Name", Settings = SettingsType.Default, AllowCellMerge=false, Width=150, AllowEditing=false,Visible=true,IsVertical= false,FixedWidth=false },

                 };
                DtTableCopy = new DataTable();

                DtTableCopy.Columns.Add("IdLookupValue", typeof(Int32));
                DtTableCopy.Columns.Add("Category", typeof(string));
                DtTableCopy.Columns.Add("Name", typeof(string));
                supplements = ERMService.GetSODSupplementsCategoryName();
                TotalSummary = new ObservableCollection<Summary>();

                // shubham[skadam] GEOS2-3246 20 May 2022
                //ColumnsModuleForSupplements = new ObservableCollection<TreeListColumn>();
                //ColumnsModuleOperationTime = new ObservableCollection<TreeListColumn>();
                //ColumnsModuleForSupplements.Add(new TreeListColumn() { FieldName = "StandardSupplements", Header = "Standard", AllowCellMerge = false, Width = 100, AllowEditing = DevExpress.Utils.DefaultBoolean.True, Visible = true, FixedWidth = true });
                //ColumnsModuleOperationTime.Add(new TreeListColumn() { FieldName = "StandardOperationTime", Header = "Standard", AllowCellMerge = false, Width = 100, AllowEditing = DevExpress.Utils.DefaultBoolean.True, Visible = true, FixedWidth = true });

                foreach (Site item in SelectedPlant)
                {
                    if (!DtTableCopy.Columns.Contains(item.Name.ToString()))
                    {


                        Columns.Add(new Emdep.Geos.UI.Helper.Column() { FieldName = item.Name.ToString(), HeaderText = item.Name.ToString() + "(%)", Settings = SettingsType.Array, AllowCellMerge = false, Width = 70, AllowEditing = false, Visible = true, IsVertical = false, FixedWidth = false });
                        // Columns.Add(new Emdep.Geos.UI.Helper.Column() { FieldName = item.Name.ToString(), HeaderText = item.Name.ToString() + "(%)", Settings = SettingsType.Array, AllowCellMerge = false, Width = 70, AllowEditing = false, Visible = true, IsVertical = false, FixedWidth = true });
                        //ColumnsModuleForSupplements.Add(new TreeListColumn() { FieldName = item.Name.ToString(), Header = item.Name.ToString(),  Width = 70, ReadOnly = false, Visible = true, FixedWidth = true });
                        //ColumnsModuleOperationTime.Add(new TreeListColumn() { FieldName = item.Name.ToString(), Header = item.Name.ToString(), AllowCellMerge = false, Width = 100, ReadOnly = false, AllowEditing = DevExpress.Utils.DefaultBoolean.True, Visible = true, FixedWidth = true });
                        //ColumnsModuleForSupplements.Add(new TreeListColumn() { FieldName = item.Name.ToString(), Header = item.Name.ToString(), AllowCellMerge = false, Width = 100, ReadOnly = false, Visible = true, FixedWidth = true, AllowEditing = DevExpress.Utils.DefaultBoolean.True, });
                        //ColumnsModuleOperationTime.Add(new TreeListColumn() { FieldName = item.Name.ToString(), Header = item.Name.ToString(), AllowCellMerge = false, Width = 100, ReadOnly = false, Visible = true, FixedWidth = true , AllowEditing =  DevExpress.Utils.DefaultBoolean.False, });
                        TotalSummary.Add(new Summary() { Type = SummaryItemType.Sum, FieldName = item.Name.ToString(), DisplayFormat = "n2" });


                        //ColumnsModuleForSupplements.Add(new TreeListColumn() { FieldName = "Supplements" + item.Name.ToString(), Header = item.Name.ToString() ,  AllowCellMerge = false, Width = 70, AllowEditing = DevExpress.Utils.DefaultBoolean.False, Visible = true, ReadOnly = false, FixedWidth = true });
                        //ColumnsModuleOperationTime.Add(new TreeListColumn() { FieldName = "OperationTime" + item.Name.ToString(), Header = item.Name.ToString() ,  AllowCellMerge = false, Width = 70, AllowEditing = DevExpress.Utils.DefaultBoolean.False, Visible = true, ReadOnly=false, FixedWidth = true });
                        DtTableCopy.Columns.Add(item.Name.ToString(), typeof(float));

                        //ColumnsModuleOperationTime.AddRange(new TreeListSummaryItem(){ new TreeListSummaryItem { SummaryType=SummaryItemType.Sum,FieldName=item.Name}});

                    }
                }




                GeosApplication.Instance.Logger.Log("Method AddEditPlantsColumnsToSupplementsDataTable()... Executed Successfully", category: Category.Info, priority: Priority.Low);
            }


            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in AddEditPlantsColumnsToSupplementsDataTable() method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), "Red", CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in AddEditPlantsColumnsToSupplementsDataTable() Method - ServiceUnexceptedException " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in AddEditPlantsColumnsToSupplementsDataTable() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }

        }


        //[001][CPATIL][17-05-2022][GEOS2-3702]
        public void EditInitSOD(StandardOperationsDictionary tempSelectedStandardOperationsDictionary)
        {
            try
            {
                GeosApplication.Instance.Logger.Log(string.Format("Method EditInitSOD..."), category: Category.Info, priority: Priority.Low);
                //[001]  
                // shubham[skadam] GEOS2-3246 30 May 2022       
                // shubham[skadam] GEOS2-3808 Standard times in Detections per workstation (#ERM11) 12 Jul 2022

                //StandardOperationsDictionary temp = (ERMService.GetStandardOperationsDictionaryDetail_V2290(tempSelectedStandardOperationsDictionary.IdStandardOperationsDictionary));

                //[GEOS2-3933][Rupali Sarode][22/09/2022]
                // StandardOperationsDictionary temp = (ERMService.GetStandardOperationsDictionaryDetail_V2301(tempSelectedStandardOperationsDictionary.IdStandardOperationsDictionary));

                //StandardOperationsDictionary temp = (ERMService.GetStandardOperationsDictionaryDetail_V2320(tempSelectedStandardOperationsDictionary.IdStandardOperationsDictionary));
                //GEOS2-4033 Spare Part Gulab Lakade
                // StandardOperationsDictionary temp = (ERMService.GetStandardOperationsDictionaryDetail_V2340(tempSelectedStandardOperationsDictionary.IdStandardOperationsDictionary));

                //  IERMService ERMService = new ERMServiceController("localhost:6699");
                //[GEOS2-5135][Rupali Sarode][19-12-2023]
                //StandardOperationsDictionary temp = (ERMService.GetStandardOperationsDictionaryDetail_V2460(tempSelectedStandardOperationsDictionary.IdStandardOperationsDictionary));

                //IERMService ERMService = new ERMServiceController("localhost:6699");
                //[GEOS2-5629][Aishwarya Ingale][19-06-2024]
                //StandardOperationsDictionary temp = (ERMService.GetStandardOperationsDictionaryDetail_V2530(tempSelectedStandardOperationsDictionary.IdStandardOperationsDictionary));
                StandardOperationsDictionary temp = (ERMService.GetStandardOperationsDictionaryDetail_V2540(tempSelectedStandardOperationsDictionary.IdStandardOperationsDictionary));

                ClonedSOD = (StandardOperationsDictionary)temp.Clone();

                //  ClonedSOD = (StandardOperationsDictionary)temp.Clone();

                //if (ClonedSOD.IdStatus == 224)
                //    InActiveStatus = true;
                //else
                //    InActiveStatus = false;

                IdStandardOperationsDictionary = temp.IdStandardOperationsDictionary;
                SelectedSODCode = temp.Code;

                Description = temp.Description;
                //GEOS2-3854 gulab lakade [use log]
                Tempdescription = temp.Description;
                oldDescription = string.IsNullOrEmpty(Description) ? "" : Description;
                Description_en = temp.Description;
                Description_es = temp.Description_es;
                Description_fr = temp.Description_fr;
                Description_pt = temp.Description_pt;
                Description_ro = temp.Description_ro;
                Description_ru = temp.Description_ru;
                Description_zh = temp.Description_zh;

                Name = temp.Name;
                //GEOS2-3854 gulab lakade [use log]
                Tempname = temp.Name;
                oldName = string.IsNullOrEmpty(Name) ? "" : Name;
                Name_en = temp.Name;
                Name_es = temp.Name_es;
                Name_fr = temp.Name_fr;
                Name_pt = temp.Name_pt;
                Name_ro = temp.Name_ro;
                Name_ru = temp.Name_ru;
                Name_zh = temp.Name_zh;

                CreationDate = temp.CreationDate;
                if (temp.ExpiryDate != DateTime.MinValue)
                {
                    ExpiryDate = temp.ExpiryDate;
                }
                if (temp.EffectiveDate != DateTime.MinValue)
                {
                    EffectiveDate = temp.EffectiveDate;
                }
                if (temp.LastUpdated != DateTime.MinValue)
                {
                    LastUpdated = temp.LastUpdated;
                }

                if (temp.PlantList != null)
                {
                    if (SelectedPlant == null)
                        SelectedPlant = new List<object>();
                    // shubham[skadam] GEOS2-3243 Add Standard Operations Dictionary (Information) (#ERM07) [1/2]
                    if (temp.Plants == "ALL")
                    {
                        SelectedPlant.AddRange(PlantList);
                    }
                    else
                    {
                        foreach (Site plant in temp.PlantList)
                        {
                            SelectedPlant.Add(PlantList.FirstOrDefault(a => a.IdSite == plant.IdSite));
                        }
                    }


                    SelectedPlant = new List<object>(SelectedPlant);
                    SelectedPlant_Copy = new List<object>(SelectedPlant);
                }
                else if (!string.IsNullOrEmpty(temp.Plants))
                {
                    if (SelectedPlant == null)
                        SelectedPlant = new List<object>();

                    if (temp.PlantList == null)
                        temp.PlantList = new List<Site>();

                    foreach (Site plant in PlantList)
                    {
                        // shubham[skadam] GEOS2-3243 Add Standard Operations Dictionary (Information) (#ERM07) [1/2]
                        if (temp.Plants == "ALL")
                        {
                            temp.PlantList.Add(plant);
                            SelectedPlant.Add(plant);
                        }
                        else
                        {
                            if (temp.Plants.Contains(plant.Name))
                            {
                                temp.PlantList.Add(plant);
                                SelectedPlant.Add(plant);
                            }

                        }

                    }
                    //  temp.PlantList = new List<object>(SelectedPlant);
                    SelectedPlant = new List<object>(SelectedPlant);
                    SelectedPlant_Copy = new List<object>(SelectedPlant);
                }

                // shubham[skadam] GEOS2-3243 Add Standard Operations Dictionary (Information) (#ERM07) [1/2]
                if (ClonedSOD.IdStatus == 1536)
                    InActiveStatus = true;
                else
                    InActiveStatus = false;

                if (StatusList != null)
                    SelectedStatus = StatusList.FirstOrDefault(x => x.IdLookupValue == temp.IdStatus);


                SelectedOriginalStatus = SelectedStatus;

                if (Name_en == Name_es && Name_en == Name_fr && Name_en == Name_pt && Name_en == Name_ro && Name_en == Name_ru && Name_en == Name_zh)
                {
                    IsCopyName = true;
                }
                if (Description_en == Description_es && Description_en == Description_fr && Description_en == Description_pt && Description_en == Description_ro && Description_en == Description_ru && Description_en == Description_zh)
                {
                    IsCopyDescription = true;
                }

                if (IsCopyName == true && IsCopyDescription == true)
                {
                    IsCheckedAllLanguages = true;
                }
                else
                {
                    IsCheckedAllLanguages = false;
                }
                oldSelectedLanguage = LanguageSelected.TwoLetterISOLanguage;
                LstStandardOperationsDictionarySupplement = temp.LstStandardOperationsDictionarySupplement;


                LstStandardOperationsDictionarySupplement_Cloned = temp.LstStandardOperationsDictionarySupplement;
                //[001]

                AddEditPlantsColumnsToSupplementsDataTable();
                FillSupplementDataTable();
                tempLstStandardOperationsDictionaryModules = temp.LstStandardOperationsDictionaryModules;
                //FillmoduleTemplateGridlist(temp.LstStandardOperationsDictionaryModules);
                tempLstStandardOperationsDictionaryDetection = temp.LstStandardOperationsDictionaryDetection;
                //FillDetectionTemplateGridlist(temp.LstStandardOperationsDictionaryDetection);
                ////GEOS2-3837 gulab lakade
                tempLstStandardOperationsDictionaryOption = temp.LstStandardOperationsDictionaryOption;
                ////GEOS2-3838 - way- gulab lakade
                tempLstStandardOperationsDictionaryWay = temp.LstStandardOperationsDictionaryWay;
                //[GEOS2-3601] - Structure Rupali Sarode
                tempLstStandardOperationsDictionaryStructures = temp.LstStandardOperationsDictionaryStructure;

                //GEOS2-4033 Spare Part Gulab Lakade
                tempLstStandardOperationsDictionarySparePart = temp.LstStandardOperationsDictionarySparePart;


                FillTemplateMenulist();
                #region 28 12 2022
                FillDetectionsGroupsMenulist();
                FillOptionGroupsMenulist();
                FillWayGroupsMenulist();
                FillStructureGroupsMenulist();
                FillSparePartGroupsMenulist();
                #endregion
                #region GEOS2-3855 gulab lakade
                tempLstStandardOperationsDictionaryChangeLogList = temp.LstStandardOperationsDictionaryChangeLogList;
                StandardOperationsDictionaryAllChangeLogList = new ObservableCollection<LogentriesbyStandardOperationsDictionary>(temp.LstStandardOperationsDictionaryChangeLogList.OrderByDescending(x => x.IdLogEntryBySOD).ToList());

                #endregion
                //FillDetectionGridColumn();
                oldIsCheckedAllLanguages = IsCheckedAllLanguages;

                GeosApplication.Instance.Logger.Log(string.Format("Method EditInitSOD()....executed successfully"), category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in EditInitSOD() Method " + ex.Detail.ErrorMessage, category: Category.Info, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in EditInitSOD() Method - ServiceUnexceptedException " + ex.Message, category: Category.Info, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method EditInitSOD()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }

        }
        private void FillSupplementDataTable()
        {
            GeosApplication.Instance.Logger.Log("Method FillSupplementDataTable()...", category: Category.Info, priority: Priority.Low);
            if (DtTableCopy == null)
                DtTableCopy = new DataTable();

            for (int i = 0; i < supplements.Count(); i++)
            {
                try
                {
                    DataRow dr = DtTableCopy.NewRow();
                    dr["IdLookupValue"] = supplements[i].IdLookupValue;
                    dr["Category"] = supplements[i].CategoryName;
                    dr["Name"] = supplements[i].Value;
                    foreach (Site itemPlant in SelectedPlant)
                    {
                        if (LstStandardOperationsDictionarySupplement != null && LstStandardOperationsDictionarySupplement.Any(supp => supp.IdLookupValue == supplements[i].IdLookupValue && supp.IdPlant == itemPlant.IdSite))
                        {
                            float? supplementPlantValue = LstStandardOperationsDictionarySupplement.Where(supp => supp.IdLookupValue == supplements[i].IdLookupValue && supp.IdPlant == itemPlant.IdSite).FirstOrDefault().PlantValue;
                            if (supplementPlantValue != null)
                                dr[itemPlant.Name.ToString()] = supplementPlantValue.Value;
                        }

                    }
                    DtTableCopy.Rows.Add(dr);
                    Dttable = DtTableCopy;
                }
                catch (Exception ex)
                {
                    GeosApplication.Instance.Logger.Log("Get an error in AddEditPlantsColumnsToSupplementsDataTable() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
                }
            }
            SupplementsBoxMenu = new List<Tuple<string, float?>>();

            foreach (Site itemPlant in SelectedPlant)
            {

                if (!SupplementsBoxMenu.Any(i => i.Item1.Contains(itemPlant.Name)))
                {
                    if (LstStandardOperationsDictionarySupplement != null && LstStandardOperationsDictionarySupplement.Any(supp => supp.IdPlant == itemPlant.IdSite))
                        SupplementsBoxMenu.Add(new Tuple<string, float?>(itemPlant.Name, LstStandardOperationsDictionarySupplement.Where(supp => supp.IdPlant == itemPlant.IdSite).Sum(i => i.PlantValue)));
                    else
                        SupplementsBoxMenu.Add(new Tuple<string, float?>(itemPlant.Name, null));
                }
            }
            AllSupplementsBoxMenu = SupplementsBoxMenu.OrderByDescending(i => i.Item2).ToList();
            SupplementsBoxMenu = SupplementsBoxMenu.OrderByDescending(i => i.Item2).Take(5).ToList();


            //var listadoDuplicadas = from c in SupplementsBoxMenu
            //                        join c2 in SupplementsBoxMenu on c.Item2 equals c2.Item2
            //                        where c != c2
            //                        select c;
            //foreach (var standardOperationTime in listadoDuplicadas)
            //{
            //    TreeListColumn tmpTreeListColumn = ColumnsModuleOperationTime.FirstOrDefault(w => (w.FieldName).Equals("OperationTime" + standardOperationTime.Item1));
            //    if(tmpTreeListColumn != null)
            //        tmpTreeListColumn.Visible = false;

            //    tmpTreeListColumn = ColumnsModuleForSupplements.FirstOrDefault(w => (w.FieldName).Equals("Supplements" + standardOperationTime.Item1));
            //    if (tmpTreeListColumn != null)
            //        tmpTreeListColumn.Visible = false;
            //}       
            FillmoduleGridColumn();
            CustomSummarycalculation();
            FillDetectionGridColumn();
            FillStructureGridColumn(); //[GEOS2-3601] Rupali Sarode
            detectionCustomSummarycalculation();
            structureCustomSummarycalculation(); //[GEOS2-3601] Rupali Sarode
            //GEOS2-3837 gulab lakade
            FillOptionGridColumn();
            optionCustomSummarycalculation();
            // GEOS2-3838 gulab lakade - Way 
            FillWayGridColumn();
            wayCustomSummarycalculation();
            //GEOS2-4033 Spare Part Gulab Lakade
            FillSparePartGridColumn();
            SparePartCustomSummarycalculation();
            GeosApplication.Instance.Logger.Log("Method FillSupplementDataTable()....executed successfully", category: Category.Info, priority: Priority.Low);
        }
        private void ChangeCheckAllLanguagesCommandAction()
        {
            if (oldIsCheckedAllLanguages != null && oldIsCheckedAllLanguages != IsCheckedAllLanguages)
            { oldIsCheckedAllLanguages = IsCheckedAllLanguages; IsEnabledSaveButton = true; }
        }
        //[001][cpatil][GEOS2-3704][17-05-2022]
        #region  gulab lakade beta changes 05 08 2024
        private UInt32 TempCalculateModule(UInt32 ModulePosition, List<ERMSOPModule> TmpmoduleListchild)
        {
            foreach (ERMSOPModule eRMSOPModule in TmpmoduleListchild)
            {
                string TempKeyName = eRMSOPModule.KeyName;
                #region [gulab lakade][beta changes][02 08 2024]
                if (TempKeyName.Contains("Group_"))
                {
                    eRMSOPModule.ModulePosition = ModulePosition;
                    ModulePosition++;

                    //var TempRecord = ModuleMenulist.Where(x => x.KeyName == eRMSOPModule.KeyName && x.ParentName != null).ToList();
                    //if (TempRecord.Count() > 0)
                    //{
                    //    foreach (var item in TempRecord.OrderBy(a => a.ModulePosition).ToList())
                    //    {
                    //        //start[GEOS2-5629][gulab lakade][16 07 2024]
                    //        int TempCount = 0;
                    //        TempCount = ModuleMenulist.Where(c => c.KeyName == item.KeyName).ToList().Count();
                    //        if (TempCount == 0)
                    //        {
                    //            item.ModulePosition = ModulePosition;
                    //            ModulePosition++;
                    //        }
                    //        //end[GEOS2-5629][gulab lakade][16 07 2024]
                    //    }

                    //}
                    //else
                    //{
                    //    eRMSOPModule.ModulePosition = ModulePosition;
                    //    ModulePosition++;

                    //}
                    #endregion
                }
                List<ERMSOPModule> tmpModulelist = ModuleMenulist.Where(a => a.ParentName == eRMSOPModule.KeyName).OrderBy(b=>b.ModulePosition).ToList();
                if(tmpModulelist.Count()>0)
                {
                    ModulePosition = TempCalculateModule(ModulePosition, tmpModulelist);
                }

            }
          
            return ModulePosition;
        }

        private UInt32 TempCalculatedetection(UInt32 DetectionPosition, List<ERMSOPDetection> TmpdetectionListchild)
        {
            foreach (ERMSOPDetection eRMSOPDetection in TmpdetectionListchild)
            {
                string TempKeyName = eRMSOPDetection.KeyName;
                #region [gulab lakade][beta changes][02 08 2024]
                if (TempKeyName.Contains("Group_"))
                {
                    eRMSOPDetection.DetectionPosition = DetectionPosition;
                      DetectionPosition++;
                    //var TempRecord = DetectionMenulist.Where(x => x.ParentName == eRMSOPDetection.KeyName && x.ParentName != null).ToList();
                    //if (TempRecord.Count() > 0)
                    //{
                    //    foreach (var item in TempRecord.OrderBy(a => a.DetectionPosition).ToList())
                    //    {

                    //        //start[GEOS2-5629][gulab lakade][16 07 2024]
                    //        int TempCount = 0;
                    //        TempCount = DetectionMenulist.Where(c => c.ParentName == item.KeyName).ToList().Count();
                    //        if (TempCount == 0)
                    //        {
                    //            item.DetectionPosition = DetectionPosition;
                    //            DetectionPosition++;
                    //        }
                    //        //end[GEOS2-5629][gulab lakade][16 07 2024]
                    //    }

                    //}
                    //else
                    //{
                    //    eRMSOPDetection.DetectionPosition = DetectionPosition;
                    //    DetectionPosition++;
                    //}

                }
                #endregion
                List<ERMSOPDetection> tmpDetectionlist = DetectionMenulist.Where(a => a.ParentName == eRMSOPDetection.KeyName).OrderBy(b => b.DetectionPosition).ToList();
                if (tmpDetectionlist.Count() > 0)
                {
                    DetectionPosition = TempCalculatedetection(DetectionPosition, tmpDetectionlist);
                }

            }

            return DetectionPosition;
        }

        private UInt32 TempCalculateoption(UInt32 OptionPosition, List<ERMSOPOptions> TmpoptionListchild)
        {
            foreach (ERMSOPOptions eRMSOPOption in TmpoptionListchild)
            {
                string TempKeyName = eRMSOPOption.KeyName;
                #region [gulab lakade][beta changes][02 08 2024]
                if (TempKeyName.Contains("Group_"))
                {
                    eRMSOPOption.OptionPosition = OptionPosition;
                    OptionPosition++;
                    //var TempRecord = OptionsMenulist.Where(x => x.ParentName == eRMSOPOption.KeyName && x.ParentName != null).ToList();
                    //if (TempRecord.Count() > 0)
                    //{
                    //    foreach (var item in TempRecord.OrderBy(a => a.OptionPosition).ToList())
                    //    {
                    //        //start[GEOS2-5629][gulab lakade][16 07 2024]
                    //        int TempCount = 0;
                    //        TempCount = OptionsMenulist.Where(c => c.ParentName == item.KeyName).ToList().Count();
                    //        if (TempCount == 0)
                    //        {
                    //            item.OptionPosition = OptionPosition;
                    //            OptionPosition++;
                    //        }
                    //        //end[GEOS2-5629][gulab lakade][16 07 2024]

                    //    }

                    //}
                    //else
                    //{
                    //    eRMSOPOption.OptionPosition = OptionPosition;
                    //    OptionPosition++;
                    //}
                }

                #endregion
                List<ERMSOPOptions> tmpoptionlist = OptionsMenulist.Where(a => a.ParentName == eRMSOPOption.KeyName).OrderBy(b => b.OptionPosition).ToList();
                if (tmpoptionlist.Count() > 0)
                {
                    OptionPosition = TempCalculateoption(OptionPosition, tmpoptionlist);
                }

            }

            return OptionPosition;
        }

        private UInt32 TempCalculateway(UInt32 WaysPosition, List<ERMSOPWays> TmpwayListchild)
        {
            foreach (ERMSOPWays eRMSOPWay in TmpwayListchild)
            {
                string TempKeyName = eRMSOPWay.KeyName;
                #region [gulab lakade][beta changes][02 08 2024]
                if (TempKeyName.Contains("Group_"))
                {
                    eRMSOPWay.WayPosition = WaysPosition;
                    WaysPosition++;
                    //var TempRecord = WaysMenulist.Where(x => x.ParentName == eRMSOPWay.KeyName && x.ParentName != null).ToList();
                    //if (TempRecord.Count() > 0)
                    //{
                    //    foreach (var item in TempRecord.OrderBy(a => a.WayPosition).ToList())
                    //    {
                    //        //start[GEOS2-5629][gulab lakade][16 07 2024]
                    //        int TempCount = 0;
                    //        TempCount = WaysMenulist.Where(c => c.ParentName == item.KeyName).ToList().Count();
                    //        if (TempCount == 0)
                    //        {
                    //            item.WayPosition = WaysPosition;
                    //            WaysPosition++;
                    //        }
                    //        //end[GEOS2-5629][gulab lakade][16 07 2024]

                    //    }

                    //}
                    //else
                    //{
                    //    eRMSOPWay.WayPosition = WaysPosition;
                    //    WaysPosition++;
                    //}
                }
                #endregion
                List<ERMSOPWays> tmpwaylist = WaysMenulist.Where(a => a.ParentName == eRMSOPWay.KeyName).OrderBy(b => b.WayPosition).ToList();
                if (tmpwaylist.Count() > 0)
                {
                    WaysPosition = TempCalculateway(WaysPosition, tmpwaylist);
                }

            }

            return WaysPosition;
        }
        private UInt32 TempCalculatestruture(UInt32 StructuresPosition, List<ERMSOPStructures> TmpstrutureListchild)
        {
            foreach (ERMSOPStructures eRMSOPStructures in TmpstrutureListchild)
            {
                string TempKeyName = eRMSOPStructures.KeyName;
                #region [gulab lakade][beta changes][02 08 2024]
                if (TempKeyName.Contains("Group_"))
                {
                    eRMSOPStructures.StructurePosition = StructuresPosition;
                    StructuresPosition++;
                    //var TempRecord = StructureMenulist.Where(x => x.ParentName == eRMSOPStructures.KeyName && x.ParentName != null).ToList();
                    //if (TempRecord.Count() > 0)
                    //{
                    //    foreach (var item in TempRecord.OrderBy(a => a.StructurePosition).ToList())
                    //    {
                    //        //start[GEOS2-5629][gulab lakade][16 07 2024]
                    //        int TempCount = 0;
                    //        TempCount = StructureMenulist.Where(c => c.ParentName == item.KeyName).ToList().Count();
                    //        if (TempCount == 0)
                    //        {
                    //            item.StructurePosition = StructuresPosition;
                    //            StructuresPosition++;
                    //        }
                    //        //end[GEOS2-5629][gulab lakade][16 07 2024]

                    //    }

                    //}
                    //else
                    //{
                    //    eRMSOPStructures.StructurePosition = StructuresPosition;
                    //    StructuresPosition++;
                    //}
                }
                #endregion
                List<ERMSOPStructures> tmpstruturelist = StructureMenulist.Where(a => a.ParentName == eRMSOPStructures.KeyName).OrderBy(b => b.StructurePosition).ToList();
                if (tmpstruturelist.Count() > 0)
                {
                    StructuresPosition = TempCalculatestruture(StructuresPosition, tmpstruturelist);
                }

            }

            return StructuresPosition;
        }
        private UInt32 TempCalculatesparepart(UInt32 SparePartsPosition, List<ERMSOPSpareParts> tmpsparepartlist)
        {
            foreach (ERMSOPSpareParts eRMSOPSpareParts in tmpsparepartlist)
            {
                string TempKeyName = eRMSOPSpareParts.KeyName;
                #region [gulab lakade][beta changes][02 082024]
                if (TempKeyName.Contains("Group_"))
                {
                    eRMSOPSpareParts.SparepartPosition = SparePartsPosition;
                    SparePartsPosition++;
                    //var TempRecord = SparePartsMenulist.Where(x => x.ParentName == eRMSOPSpareParts.KeyName && x.ParentName != null).ToList();
                    //if (TempRecord.Count() > 0)
                    //{
                    //    foreach (var item in TempRecord.OrderBy(a => a.SparepartPosition).ToList())
                    //    {
                    //        //start[GEOS2-5629][gulab lakade][16 07 2024]
                    //        int TempCount = 0;
                    //        TempCount = SparePartsMenulist.Where(c => c.ParentName == item.KeyName).ToList().Count();
                    //        if (TempCount == 0)
                    //        {
                    //            item.SparepartPosition = SparePartsPosition;
                    //            SparePartsPosition++;
                    //        }
                    //        //end[GEOS2-5629][gulab lakade][16 07 2024]

                    //    }

                    //}
                    //else
                    //{
                    //    eRMSOPSpareParts.SparepartPosition = SparePartsPosition;
                    //    SparePartsPosition++;

                    //}
                }
                #endregion
                tmpsparepartlist = new List<ERMSOPSpareParts>();
                 tmpsparepartlist = SparePartsMenulist.Where(a => a.ParentName == eRMSOPSpareParts.KeyName).OrderBy(b => b.SparepartPosition).ToList();
                if (tmpsparepartlist.Count() > 0)
                {
                    SparePartsPosition = TempCalculatesparepart(SparePartsPosition, tmpsparepartlist);
                }

            }

            return SparePartsPosition;
        }
        #endregion
        private void AcceptButtonCommandAction(object obj)
        {
            GeosApplication.Instance.Logger.Log(string.Format("Method AcceptButtonCommandAction()..."), category: Category.Info, priority: Priority.Low);
            if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }
            try
            {
                InformationError = null;
                string error = EnableValidationAndGetError();
                PropertyChanged(this, new PropertyChangedEventArgs("Name"));
                if (string.IsNullOrEmpty(error))
                    InformationError = null;
                else
                    InformationError = "";

                if (error != null)
                {
                    return;
                }


                if (SelectedPlant == null || SelectedPlant.Count == 0)
                {
                    CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("AddEditSODPlantMandatoryValidation").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                    GeosApplication.Instance.Logger.Log("Method AcceptButtonCommandAction()...atleast one plant.", category: Category.Info, priority: Priority.Low);
                    return;
                }

                var showMessageForStatusIsActive = false;
                if (IsNew)
                {
                    // shubham[skadam] GEOS2-3243 Add Standard Operations Dictionary (Information) (#ERM07) [1/2]
                    if (SelectedStatus.IdLookupValue == 1535)
                    {
                        showMessageForStatusIsActive = true;
                    }
                }
                else
                {
                    // shubham[skadam] GEOS2-3243 Add Standard Operations Dictionary (Information) (#ERM07) [1/2]
                    if (ClonedSOD != null && ClonedSOD.IdStatus != 1535 && SelectedStatus.IdLookupValue == 1535) showMessageForStatusIsActive = true;

                    if (ClonedSOD != null && SelectedStatus.IdLookupValue == 1535 && IsPlantAddedOrRemove) showMessageForStatusIsActive = true;
                }

                #region GEOS2-3904 Rupali Sarode
                if (DXSplashScreen.IsActive)
                {
                    DXSplashScreen.Close();
                    Mouse.OverrideCursor = Cursors.Arrow;
                }
                #endregion

                if (showMessageForStatusIsActive)
                {
                    var plantsNames = string.Join(", ", SelectedPlant.Select(x => ((Site)x).Name).ToList<string>().ToArray());
                    var msg = string.Format(System.Windows.Application.Current.FindResource("AddEditSODStatusIsActive").ToString(), plantsNames);

                    CustomMessageBox.Show(msg, Application.Current.Resources["PopUpNotifyColor"].ToString(), CustomMessageBox.MessageImagePath.Info, MessageBoxButton.OK);
                    GeosApplication.Instance.Logger.Log($"Method AcceptButtonCommandAction()... {msg}", category: Category.Info, priority: Priority.Low);

                }

                if (ExpiryDate == null || EffectiveDate > ExpiryDate)
                {
                    CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("AddEditSODEffectiveAndExpiryValidation").ToString()),
                        Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);

                    GeosApplication.Instance.Logger.Log("Method AcceptButtonCommandAction()...Expiry Date is mandatory and it must be equal or greater than Effective Date.",
                        category: Category.Info, priority: Priority.Low);

                    return;
                }



                #region RemoveStages
                if (ModuleMenulist != null)
                {
                    var tempModuleMenulist = ModuleMenulist.ToList();
                    for (int i = 0; i < tempModuleMenulist.Count; i++)
                    {
                        if (GetStages.Any(a => a.Code.Equals(tempModuleMenulist[i].Name)))
                        {
                            List<ERMSOPModule> childList = ModuleMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(tempModuleMenulist[i].KeyName)).ToList();
                            if (childList.Count == 0)
                            {
                                ModuleMenulist.Remove(tempModuleMenulist[i]);
                            }
                        }
                    }
                }
                if (DetectionMenulist != null)
                {
                    var tempDetectionMenulist = DetectionMenulist.ToList();
                    for (int i = 0; i < tempDetectionMenulist.Count; i++)
                    {
                        if (GetStages.Any(a => a.Code.Equals(tempDetectionMenulist[i].Name)))
                        {
                            List<ERMSOPDetection> childList = DetectionMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(tempDetectionMenulist[i].KeyName)).ToList();
                            if (childList.Count == 0)
                            {
                                DetectionMenulist.Remove(tempDetectionMenulist[i]);
                            }
                        }
                    }
                }
                #region GEOS2-3837  Option
                //gulab lakade
                if (OptionsMenulist != null)
                {
                    var tempOptionsMenulist = OptionsMenulist.ToList();
                    for (int i = 0; i < tempOptionsMenulist.Count; i++)
                    {
                        if (GetStages.Any(a => a.Code.Equals(tempOptionsMenulist[i].Name)))
                        {
                            List<ERMSOPOptions> childList = OptionsMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(tempOptionsMenulist[i].KeyName)).ToList();
                            if (childList.Count == 0)
                            {
                                OptionsMenulist.Remove(tempOptionsMenulist[i]);
                            }
                        }
                    }
                }
                #endregion

                #region GEOS2-3838  Way
                //gulab lakade
                if (WaysMenulist != null)
                {
                    var tempWaysMenulist = WaysMenulist.ToList();
                    for (int i = 0; i < tempWaysMenulist.Count; i++)
                    {
                        if (GetStages.Any(a => a.Code.Equals(tempWaysMenulist[i].Name)))
                        {
                            List<ERMSOPWays> childList = WaysMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(tempWaysMenulist[i].KeyName)).ToList();
                            if (childList.Count == 0)
                            {
                                WaysMenulist.Remove(tempWaysMenulist[i]);
                            }
                        }
                    }
                }
                #endregion


                #region [GEOS2-3601]  [Rupali Sarode]
                if (StructureMenulist != null)
                {
                    var tempStructureMenulist = StructureMenulist.ToList();
                    for (int i = 0; i < tempStructureMenulist.Count; i++)
                    {
                        if (GetStages.Any(a => a.Code.Equals(tempStructureMenulist[i].Name)))
                        {
                            List<ERMSOPStructures> childList = StructureMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(tempStructureMenulist[i].KeyName)).ToList();
                            if (childList.Count == 0)
                            {
                                StructureMenulist.Remove(tempStructureMenulist[i]);
                            }
                        }
                    }
                }

                #endregion

                #region GEOS2-4033 Spare Part Gulab Lakade
                if (SparePartsMenulist != null)
                {
                    var tempSparePartsMenulist = SparePartsMenulist.ToList();
                    for (int i = 0; i < tempSparePartsMenulist.Count; i++)
                    {
                        if (GetStages.Any(a => a.Code.Equals(tempSparePartsMenulist[i].Name)))
                        {
                            List<ERMSOPSpareParts> childList = SparePartsMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(tempSparePartsMenulist[i].KeyName)).ToList();
                            if (childList.Count == 0)
                            {
                                SparePartsMenulist.Remove(tempSparePartsMenulist[i]);
                            }
                        }
                    }
                }

                #endregion


                #endregion

                #region Modules

                #region [GEOS2-3909][Rupali Sarode][4-11-2022]
                // Copy data from tmp to ModuleMenulist
                if (TmpModuleMenulist != null)
                {
                    if (TmpModuleMenulist.Count > 0)
                    {
                        // [GEOS2-4108][Rupali Sarode] copy ModuleMenulist 
                        TmpModuleMenulistOriginal = new ObservableCollection<ERMSOPModule>();
                        TmpModuleMenulistOriginal.AddRange(ModuleMenulist);


                        ModuleMenulist = new ObservableCollection<ERMSOPModule>();
                        ModuleMenulist.AddRange(TmpModuleMenulist);


                    }
                }


                #endregion

                WorkOperationByStages tmpModuleWorkOperationByStage;

                List<StandardOperationsDictionaryModules> standardOperationsDictionaryModulesList = new List<StandardOperationsDictionaryModules>();
                if (SelectedItem is ProductTypes)
                {
                    ProductTypes productTypes = (ProductTypes)SelectedItem;
                    if (ModuleMenulist != null && ModuleMenulist.Count > 0)
                    {
                        //Aishwarya Ingale[Geos2-5629]


                        //ModuleMenulist = new ObservableCollection<ERMSOPModule>(ModuleMenulist.GroupBy(i => i.IdParent)
                        //        .SelectMany(group => group.Select((item, index) =>
                        //        {
                        //            item.ModulePosition = (uint)(index + 1); return item;
                        //        })).ToList());

                        // var tempWayList= WaysMenulist.
                        UInt32 ModulePosition = 1;
                        List<ERMSOPModule> TmpmoduleList = ModuleMenulist.Where(a => a.ParentName == null).OrderBy(a => a.Position).ToList();
                        foreach (ERMSOPModule eRMSOPModule in TmpmoduleList)
                        {

                            string TempKeyName = eRMSOPModule.KeyName;
                            #region [gulab lakade][beta changes][02 08 2024]
                            if (TempKeyName.Contains("Group_"))
                            {

                                eRMSOPModule.ModulePosition = ModulePosition;
                                ModulePosition++;
                                //var TempRecord = ModuleMenulist.Where(x => x.KeyName == eRMSOPModule.KeyName && x.ParentName != null).ToList();
                                //if (TempRecord.Count() > 0)
                                //{
                                //    foreach (var item in TempRecord.OrderBy(a => a.ModulePosition).ToList())
                                //    {
                                //        //start[GEOS2-5629][gulab lakade][16 07 2024]
                                //        int TempCount = 0;
                                //        TempCount = ModuleMenulist.Where(c => c.KeyName == item.KeyName).ToList().Count();
                                //        if (TempCount == 0)
                                //        {
                                //            item.ModulePosition = ModulePosition;
                                //            ModulePosition++;
                                //        }
                                //        //end[GEOS2-5629][gulab lakade][16 07 2024]
                                //    }

                                //}
                                //else
                                //{
                                //    eRMSOPModule.ModulePosition = ModulePosition;
                                //    ModulePosition++;

                                //}
                            }
                            #endregion
                            //foreach (ERMSOPModule eRMSOPModule in ModuleMenulist)
                            List<ERMSOPModule> TmpmoduleListchild = ModuleMenulist.Where(a => a.ParentName == eRMSOPModule.KeyName).OrderBy(a=>a.ModulePosition).ToList();
                                if (TmpmoduleListchild.Count() > 0)
                                {
                                    ModulePosition = TempCalculateModule(ModulePosition, TmpmoduleListchild);
                                }
                            
                        }


                        int ModulePos = 1;//[Geos2-5629][Aishwarya Ingale][26 06 2024]
                        //foreach (ERMSOPModule eRMSOPModule in ModuleMenulist)
                        foreach (ERMSOPModule eRMSOPModule in ModuleMenulist.Where(a => a.ModulePosition != null).OrderBy(x => x.ModulePosition))//[GEOS2-5629][gulab lakade][10 07 2024]
                        {
                            StandardOperationsDictionaryModules standardOperationsDictionaryModules = new StandardOperationsDictionaryModules();
                            WorkOperationByStages workOperationByStages = WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(eRMSOPModule.KeyName)).FirstOrDefault();
                            StandardOperationsDictionaryModules ISERMSOPModuleValueUpdated = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage) && w.IdCpTypeNew == eRMSOPModule.IdCpType).FirstOrDefault();
                            if (workOperationByStages != null)
                            {
                                //if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(workOperationByStages.Name.Trim())))
                                if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(workOperationByStages.Name.Trim())))
                                {


                                }
                                else
                                {
                                    if (ISERMSOPModuleValueUpdated == null)
                                    {
                                        standardOperationsDictionaryModules.TransactionOperation = ModelBase.TransactionOperations.Add;
                                        standardOperationsDictionaryModules.IdStandardOperationsDictionary = IdStandardOperationsDictionary;
                                        //standardOperationsDictionaryModules.IdCpType = (byte)(productTypes.IdCPType);
                                        if (TmpModuleMenulist == null) //[GEOS2-3909][Rupali Sarode][4-11-2022]
                                            standardOperationsDictionaryModules.IdCpTypeNew = (long)(productTypes.IdCPType);
                                        else
                                        {
                                            if (TmpModuleMenulist.Count == 0)
                                                standardOperationsDictionaryModules.IdCpTypeNew = (long)(productTypes.IdCPType);
                                            else
                                                standardOperationsDictionaryModules.IdCpTypeNew = (long)eRMSOPModule.IdCpType;
                                        }

                                        standardOperationsDictionaryModules.IdWorkoperation = Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage);
                                        //  standardOperationsDictionaryModules.ObservedTime = (float?)eRMSOPModule.ObservedTime;
                                        //  standardOperationsDictionaryModules.Activity = (float?)eRMSOPModule.Activity;

                                        #region [GEOS2-4071][Rupali Sarode][10-12-2022]

                                        tmpModuleWorkOperationByStage = new WorkOperationByStages();

                                        //tmpModuleWorkOperationByStage = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == eRMSOPModule.IdworkOperationByStage).FirstOrDefault();
                                        tmpModuleWorkOperationByStage = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == eRMSOPModule.IdworkOperationByStage && a.KeyName == eRMSOPModule.KeyName).FirstOrDefault();//[Cut  work operation not work properly.][gulab lakade][24 01 2023]

                                        if (tmpModuleWorkOperationByStage.ObservedTime == (float?)eRMSOPModule.ObservedTime)
                                            standardOperationsDictionaryModules.ObservedTime = null;
                                        else
                                            standardOperationsDictionaryModules.ObservedTime = (float?)eRMSOPModule.ObservedTime;

                                        if (tmpModuleWorkOperationByStage.Activity == (float?)eRMSOPModule.Activity)
                                            standardOperationsDictionaryModules.Activity = null;
                                        else
                                            standardOperationsDictionaryModules.Activity = (float?)eRMSOPModule.Activity;


                                        #endregion


                                        //[GEOS2-3933][Rupali Sarode][22/09/2022]
                                        standardOperationsDictionaryModules.Remarks = eRMSOPModule.Remarks == null ? "" : eRMSOPModule.Remarks.Trim();
                                        //Aishwarya Ingale[Geos2-5629]
                                        if (eRMSOPModule.ModulePosition != null && ModulePos == eRMSOPModule.ModulePosition)
                                        {
                                            standardOperationsDictionaryModules.Position = (uint?)eRMSOPModule.ModulePosition;
                                        }
                                        else
                                        {
                                            standardOperationsDictionaryModules.Position = (uint?)ModulePos;
                                        }
                                        ModulePos++;
                                        standardOperationsDictionaryModulesList.Add(standardOperationsDictionaryModules);
                                    }
                                    else if (ISERMSOPModuleValueUpdated.Activity != eRMSOPModule.Activity || ISERMSOPModuleValueUpdated.ObservedTime != eRMSOPModule.ObservedTime)
                                    {
                                        standardOperationsDictionaryModules.TransactionOperation = ModelBase.TransactionOperations.Add;
                                        standardOperationsDictionaryModules.IdStandardOperationsDictionary = IdStandardOperationsDictionary;
                                        //standardOperationsDictionaryModules.IdCpType = (byte)(productTypes.IdCPType);
                                        if (TmpModuleMenulist == null)  //[GEOS2-3909][Rupali Sarode][4-11-2022]
                                            standardOperationsDictionaryModules.IdCpTypeNew = (long)(productTypes.IdCPType);
                                        else
                                        {
                                            if (TmpModuleMenulist.Count == 0)
                                                standardOperationsDictionaryModules.IdCpTypeNew = (long)(productTypes.IdCPType);
                                            else
                                                standardOperationsDictionaryModules.IdCpTypeNew = (long)eRMSOPModule.IdCpType;
                                        }

                                        standardOperationsDictionaryModules.IdWorkoperation = Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage);
                                        //standardOperationsDictionaryModules.ObservedTime = (float?)eRMSOPModule.ObservedTime;
                                        //standardOperationsDictionaryModules.Activity = (float?)eRMSOPModule.Activity;

                                        #region [GEOS2-4071][Rupali Sarode][10-12-2022]

                                        tmpModuleWorkOperationByStage = new WorkOperationByStages();
                                        tmpModuleWorkOperationByStage = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == eRMSOPModule.IdworkOperationByStage && a.KeyName == eRMSOPModule.KeyName).FirstOrDefault(); //[Cut  work operation not work properly.][gulab lakade][24 01 2023]

                                        if (tmpModuleWorkOperationByStage.ObservedTime == (float?)eRMSOPModule.ObservedTime)
                                            standardOperationsDictionaryModules.ObservedTime = null;
                                        else
                                            standardOperationsDictionaryModules.ObservedTime = (float?)eRMSOPModule.ObservedTime;

                                        if (tmpModuleWorkOperationByStage.Activity == (float?)eRMSOPModule.Activity)
                                            standardOperationsDictionaryModules.Activity = null;
                                        else
                                            standardOperationsDictionaryModules.Activity = (float?)eRMSOPModule.Activity;


                                        #endregion

                                        //[GEOS2-3933][Rupali Sarode][22/09/2022]
                                        standardOperationsDictionaryModules.Remarks = eRMSOPModule.Remarks == null ? "" : eRMSOPModule.Remarks.Trim();
                                        //Aishwarya Ingale[Geos2-5629]
                                        if (eRMSOPModule.ModulePosition != null && ModulePos == eRMSOPModule.ModulePosition)
                                        {
                                            standardOperationsDictionaryModules.Position = (uint?)eRMSOPModule.ModulePosition;
                                        }
                                        else
                                        {
                                            standardOperationsDictionaryModules.Position = (uint?)ModulePos;
                                        }
                                        ModulePos++;
                                        standardOperationsDictionaryModulesList.Add(standardOperationsDictionaryModules);
                                    }

                                }
                            }
                            else
                            {
                                if (ISERMSOPModuleValueUpdated == null)
                                {
                                    standardOperationsDictionaryModules.TransactionOperation = ModelBase.TransactionOperations.Add;
                                    standardOperationsDictionaryModules.IdStandardOperationsDictionary = IdStandardOperationsDictionary;
                                    //standardOperationsDictionaryModules.IdCpType = (byte)(productTypes.IdCPType);
                                    if (TmpModuleMenulist == null)  //[GEOS2-3909][Rupali Sarode][4-11-2022]
                                        standardOperationsDictionaryModules.IdCpTypeNew = (long)(productTypes.IdCPType);
                                    else
                                    {
                                        if (TmpModuleMenulist.Count == 0)
                                            standardOperationsDictionaryModules.IdCpTypeNew = (long)(productTypes.IdCPType);
                                        else
                                            standardOperationsDictionaryModules.IdCpTypeNew = (long)eRMSOPModule.IdCpType;
                                    }

                                    standardOperationsDictionaryModules.IdWorkoperation = Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage);
                                    //standardOperationsDictionaryModules.ObservedTime = (float?)eRMSOPModule.ObservedTime;
                                    //standardOperationsDictionaryModules.Activity = (float?)eRMSOPModule.Activity;

                                    #region [GEOS2-4071][Rupali Sarode][10-12-2022]

                                    tmpModuleWorkOperationByStage = new WorkOperationByStages();
                                    //tmpModuleWorkOperationByStage = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == eRMSOPModule.IdworkOperationByStage).FirstOrDefault();
                                    tmpModuleWorkOperationByStage = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == eRMSOPModule.IdworkOperationByStage && a.KeyName == eRMSOPModule.KeyName).FirstOrDefault();        //[Cut  work operation not work properly.][gulab lakade][24 01 2023]

                                    if (tmpModuleWorkOperationByStage != null)
                                    {
                                        if (tmpModuleWorkOperationByStage.ObservedTime == (float?)eRMSOPModule.ObservedTime)
                                            standardOperationsDictionaryModules.ObservedTime = null;
                                        else
                                            standardOperationsDictionaryModules.ObservedTime = (float?)eRMSOPModule.ObservedTime;

                                        if (tmpModuleWorkOperationByStage.Activity == (float?)eRMSOPModule.Activity)
                                            standardOperationsDictionaryModules.Activity = null;
                                        else
                                            standardOperationsDictionaryModules.Activity = (float?)eRMSOPModule.Activity;

                                    }
                                    #endregion

                                    //[GEOS2-3933][Rupali Sarode][22/09/2022]
                                    standardOperationsDictionaryModules.Remarks = eRMSOPModule.Remarks == null ? "" : eRMSOPModule.Remarks.Trim();
                                    //Aishwarya Ingale[Geos2-5629]
                                    if (eRMSOPModule.ModulePosition != null && ModulePos == eRMSOPModule.ModulePosition)
                                    {
                                        standardOperationsDictionaryModules.Position = (uint?)eRMSOPModule.ModulePosition;
                                    }
                                    else
                                    {
                                        standardOperationsDictionaryModules.Position = (uint?)ModulePos;
                                    }
                                    ModulePos++;
                                    standardOperationsDictionaryModulesList.Add(standardOperationsDictionaryModules);
                                }
                                //[GEOS2-3933][Rupali Sarode][26/09/2022]
                                //else if (
                                //    ISERMSOPModuleValueUpdated.Activity != eRMSOPModule.Activity ||
                                //    Math.Round(Convert.ToDouble(ISERMSOPModuleValueUpdated.ObservedTime), 2) != Math.Round(Convert.ToDouble(eRMSOPModule.ObservedTime), 2)
                                //    )
                                else if (
                                   ISERMSOPModuleValueUpdated.Activity != eRMSOPModule.Activity ||
                                   Math.Round(Convert.ToDouble(ISERMSOPModuleValueUpdated.ObservedTime), 2) != Math.Round(Convert.ToDouble(eRMSOPModule.ObservedTime), 2) ||
                                   ISERMSOPModuleValueUpdated.Remarks != eRMSOPModule.Remarks
                                   )
                                {
                                    standardOperationsDictionaryModules.TransactionOperation = ModelBase.TransactionOperations.Add;
                                    standardOperationsDictionaryModules.IdStandardOperationsDictionary = IdStandardOperationsDictionary;
                                    if (TmpModuleMenulist == null)   //[GEOS2-3909][Rupali Sarode][4-11-2022]
                                        standardOperationsDictionaryModules.IdCpTypeNew = (long)(productTypes.IdCPType);
                                    else
                                    {
                                        if (TmpModuleMenulist.Count == 0)
                                            standardOperationsDictionaryModules.IdCpTypeNew = (long)(productTypes.IdCPType);
                                        else
                                            standardOperationsDictionaryModules.IdCpTypeNew = (long)eRMSOPModule.IdCpType;
                                    }

                                    standardOperationsDictionaryModules.IdWorkoperation = Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage);
                                    //   standardOperationsDictionaryModules.ObservedTime = (float?)eRMSOPModule.ObservedTime;
                                    //   standardOperationsDictionaryModules.Activity = (float?)eRMSOPModule.Activity;

                                    #region [GEOS2-4071][Rupali Sarode][10-12-2022]

                                    tmpModuleWorkOperationByStage = new WorkOperationByStages();
                                    tmpModuleWorkOperationByStage = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == eRMSOPModule.IdworkOperationByStage && a.KeyName == eRMSOPModule.KeyName).FirstOrDefault();//[Cut  work operation not work properly.][gulab lakade][24 01 2023]

                                    if (tmpModuleWorkOperationByStage.ObservedTime == (float?)eRMSOPModule.ObservedTime)
                                        standardOperationsDictionaryModules.ObservedTime = null;
                                    else
                                        standardOperationsDictionaryModules.ObservedTime = (float?)eRMSOPModule.ObservedTime;

                                    if (tmpModuleWorkOperationByStage.Activity == (float?)eRMSOPModule.Activity)
                                        standardOperationsDictionaryModules.Activity = null;
                                    else
                                        standardOperationsDictionaryModules.Activity = (float?)eRMSOPModule.Activity;

                                    #endregion
                                    //[GEOS2-3933][Rupali Sarode][22/09/2022]
                                    standardOperationsDictionaryModules.Remarks = eRMSOPModule.Remarks == null ? "" : eRMSOPModule.Remarks.Trim();
                                    //Aishwarya Ingale[Geos2-5629]
                                    if (eRMSOPModule.ModulePosition != null && ModulePos == eRMSOPModule.ModulePosition)
                                    {
                                        standardOperationsDictionaryModules.Position = (uint?)eRMSOPModule.ModulePosition;
                                    }
                                    else
                                    {
                                        standardOperationsDictionaryModules.Position = (uint?)ModulePos;
                                    }
                                    ModulePos++;
                                    standardOperationsDictionaryModulesList.Add(standardOperationsDictionaryModules);

                                }

                            }
                        }

                    }
                }






                #region insertProductTypes


                //if (SelectedItem is ProductTypes)
                //{
                //    ProductTypes productTypes = (ProductTypes)SelectedItem;
                //    if (ModuleMenulist != null && ModuleMenulist.Count > 0)
                //    {
                //        foreach (ERMSOPModule eRMSOPModule in ModuleMenulist)
                //        {
                //            StandardOperationsDictionaryModules standardOperationsDictionaryModules = new StandardOperationsDictionaryModules();
                //            WorkOperationByStages workOperationByStages = WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(eRMSOPModule.KeyName)).FirstOrDefault();
                //            if (workOperationByStages != null)
                //            {
                //                //if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(workOperationByStages.Name.Trim())))
                //                if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(workOperationByStages.Name.Trim())))
                //                {

                //                }
                //                else
                //                {
                //                    standardOperationsDictionaryModules.TransactionOperation = ModelBase.TransactionOperations.Add;
                //                    standardOperationsDictionaryModules.IdStandardOperationsDictionary = IdStandardOperationsDictionary;
                //                    standardOperationsDictionaryModules.IdCpType = (byte)(productTypes.IdCPType);
                //                    standardOperationsDictionaryModules.IdWorkoperation = Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage);
                //                    standardOperationsDictionaryModules.ObservedTime = (float?)eRMSOPModule.ObservedTime;
                //                    standardOperationsDictionaryModules.Activity = (float?)eRMSOPModule.Activity;
                //                    standardOperationsDictionaryModulesList.Add(standardOperationsDictionaryModules);
                //                }
                //            }
                //            else
                //            {
                //                standardOperationsDictionaryModules.TransactionOperation = ModelBase.TransactionOperations.Add;
                //                standardOperationsDictionaryModules.IdStandardOperationsDictionary = IdStandardOperationsDictionary;
                //                standardOperationsDictionaryModules.IdCpType = (byte)(productTypes.IdCPType);
                //                standardOperationsDictionaryModules.IdWorkoperation = Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage);
                //                standardOperationsDictionaryModules.ObservedTime = (float?)eRMSOPModule.ObservedTime;
                //                standardOperationsDictionaryModules.Activity = (float?)eRMSOPModule.Activity;
                //                standardOperationsDictionaryModulesList.Add(standardOperationsDictionaryModules);
                //            }
                //        }

                //    }
                //}
                #endregion
                if (standardOperationsDictionaryModulesDeleteList.Count() > 0)
                {
                    foreach (var eRMSOPModuleDelete in standardOperationsDictionaryModulesDeleteList)
                    {
                        StandardOperationsDictionaryModules standardOperationsDictionaryModulesDelete = new StandardOperationsDictionaryModules();

                        standardOperationsDictionaryModulesDelete.TransactionOperation = ModelBase.TransactionOperations.Delete;
                        standardOperationsDictionaryModulesDelete.IdStandardOperationsDictionary = eRMSOPModuleDelete.IdStandardOperationsDictionary;
                        standardOperationsDictionaryModulesDelete.IdCpTypeNew = eRMSOPModuleDelete.IdCpTypeNew;
                        standardOperationsDictionaryModulesDelete.IdWorkoperation = eRMSOPModuleDelete.IdWorkoperation;
                        standardOperationsDictionaryModulesDelete.ObservedTime = (float?)eRMSOPModuleDelete.ObservedTime;
                        standardOperationsDictionaryModulesDelete.Activity = (float?)eRMSOPModuleDelete.Activity;
                        standardOperationsDictionaryModulesList.Add(standardOperationsDictionaryModulesDelete);
                    }
                }
                standardOperationsDictionaryModulesList.ForEach(w => w.CreatedBy = Convert.ToInt32(GeosApplication.Instance.ActiveUser.IdUser));
                standardOperationsDictionaryModulesList.ForEach(w => w.ModifiedBy = Convert.ToInt32(GeosApplication.Instance.ActiveUser.IdUser));
                #endregion

                #region Detection

                #region [GEOS2-3922][Rupali Sarode][10-11-2022]
                // Copy data from tmp to DetectionMenulist
                if (TmpDetectionMenulist != null)
                {
                    if (TmpDetectionMenulist.Count > 0)
                    {
                        // [GEOS2-4108][Rupali Sarode] copy DetectionMenulist
                        TmpDetectionMenulistOriginal = new ObservableCollection<ERMSOPDetection>();
                        TmpDetectionMenulistOriginal.AddRange(DetectionMenulist);

                        DetectionMenulist = new ObservableCollection<ERMSOPDetection>();
                        DetectionMenulist.AddRange(TmpDetectionMenulist);
                    }
                }

                #endregion


                WorkOperationByStages tmpDetectionWorkOperationByStage;
                List<StandardOperationsDictionaryDetection> standardOperationsDictionaryDetectionsList = new List<StandardOperationsDictionaryDetection>();
                if (SelectedItemDetection is ERMDetections)
                {

                    ERMDetections ermDetections = (ERMDetections)SelectedItemDetection;

                    if (DetectionMenulist != null && DetectionMenulist.Count > 0)
                    {
                        //Aishwarya Ingale[Geos2-5629]
                        //DetectionMenulist = new ObservableCollection<ERMSOPDetection>(DetectionMenulist.GroupBy(i => i.IdParent)
                        //        .SelectMany(group => group.Select((item, index) =>
                        //        {
                        //            item.DetectionPosition = (uint)(index + 1); return item;
                        //        })).ToList());

                        // var tempWayList= WaysMenulist.
                        UInt32 DetectionPosition = 1;
                        List<ERMSOPDetection> TmpdetectionList = DetectionMenulist.Where(a => a.ParentName == null).OrderBy(a => a.Position).ToList();
                        //foreach (ERMSOPDetection eRMSOPDetection in DetectionMenulist)
                        foreach (ERMSOPDetection eRMSOPDetection in TmpdetectionList)
                        {
                            string TempKeyName = eRMSOPDetection.KeyName;
                            #region [gulab lakade][beta changes][02 08 2024]
                            if (TempKeyName.Contains("Group_"))
                            {
                                eRMSOPDetection.DetectionPosition = DetectionPosition;
                                DetectionPosition++;
                                //var TempRecord = DetectionMenulist.Where(x => x.ParentName == eRMSOPDetection.KeyName && x.ParentName != null).ToList();
                                //if (TempRecord.Count() > 0)
                                //{
                                //    foreach (var item in TempRecord.OrderBy(a => a.DetectionPosition).ToList())
                                //    {

                                //        //start[GEOS2-5629][gulab lakade][16 07 2024]
                                //        int TempCount = 0;
                                //        TempCount = DetectionMenulist.Where(c => c.ParentName == item.KeyName).ToList().Count();
                                //        if (TempCount == 0)
                                //        {
                                //            item.DetectionPosition = DetectionPosition;
                                //            DetectionPosition++;
                                //        }
                                //        //end[GEOS2-5629][gulab lakade][16 07 2024]
                                //    }

                                //}
                                //else
                                //{
                                //    eRMSOPDetection.DetectionPosition = DetectionPosition;
                                //    DetectionPosition++;
                                //}

                            }
                            #endregion
                            List<ERMSOPDetection> TmpdetectionListchild = DetectionMenulist.Where(a => a.ParentName == eRMSOPDetection.KeyName).OrderBy(a => a.DetectionPosition).ToList();
                            if (TmpdetectionListchild.Count() > 0)
                            {
                                DetectionPosition = TempCalculatedetection(DetectionPosition, TmpdetectionListchild);
                            }
                        }


                        int DetectionPos = 1;//[Geos2-5629][Aishwarya Ingale][26 06 2024]

                        foreach (ERMSOPDetection eRMSOPModule in DetectionMenulist.Where(a => a.DetectionPosition != null).OrderBy(x => x.DetectionPosition))//[GEOS2-5629][gulab lakade][10 07 2024])
                        {
                            StandardOperationsDictionaryDetection standardOperationsDictionaryDetection = new StandardOperationsDictionaryDetection();
                            WorkOperationByStages workOperationByStages = WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(eRMSOPModule.KeyName)).FirstOrDefault();
                            StandardOperationsDictionaryDetection ISERMSOPModuleValueUpdated = tempLstStandardOperationsDictionaryDetection.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage) && w.IdDetection == eRMSOPModule.IdDetection).FirstOrDefault();
                            if (workOperationByStages != null)
                            {
                                if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(workOperationByStages.Name.Trim())))
                                {

                                }
                                else
                                {
                                    if (ISERMSOPModuleValueUpdated == null)
                                    {
                                        standardOperationsDictionaryDetection.TransactionOperation = ModelBase.TransactionOperations.Add;
                                        standardOperationsDictionaryDetection.IdStandardOperationsDictionary = IdStandardOperationsDictionary;

                                        // standardOperationsDictionaryDetection.IdDetection = (UInt64)(ermDetections.IdDetection);
                                        //    standardOperationsDictionaryDetection.ObservedTime = (float?)eRMSOPModule.DetectionObservedTime;
                                        //standardOperationsDictionaryDetection.Activity = (float?)eRMSOPModule.DetectionActivity;
                                        //tmpDetectionObservedTime = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == eRMSOPModule.IdworkOperationByStage).Select(b => b.ObservedTime).FirstOrDefault();
                                        //tmpDetectionActivity = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == eRMSOPModule.IdworkOperationByStage).Select(b => b.Activity).FirstOrDefault();

                                        //if (tmpDetectionObservedTime == (float?)eRMSOPModule.DetectionObservedTime)
                                        //    standardOperationsDictionaryDetection.ObservedTime = null;
                                        //else
                                        //    standardOperationsDictionaryDetection.ObservedTime = (float?)eRMSOPModule.DetectionObservedTime;

                                        //if (tmpDetectionActivity == (float?)eRMSOPModule.DetectionActivity)
                                        //    standardOperationsDictionaryDetection.Activity = null;
                                        //else
                                        //    standardOperationsDictionaryDetection.Activity = (float?)eRMSOPModule.DetectionActivity;

                                        if (TmpDetectionMenulist == null)
                                            standardOperationsDictionaryDetection.IdDetection = (UInt64)(ermDetections.IdDetection);
                                        else
                                        {
                                            if (TmpDetectionMenulist.Count == 0)
                                                standardOperationsDictionaryDetection.IdDetection = (UInt64)(ermDetections.IdDetection);
                                            else
                                                standardOperationsDictionaryDetection.IdDetection = (UInt64)eRMSOPModule.IdDetection;
                                        }

                                        #region [GEOS2-4073][Rupali Sarode][09-12-2022]

                                        tmpDetectionWorkOperationByStage = new WorkOperationByStages();
                                        tmpDetectionWorkOperationByStage = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == eRMSOPModule.IdworkOperationByStage && a.KeyName == eRMSOPModule.KeyName).FirstOrDefault(); //[Cut  work operation not work properly.][gulab lakade][24 01 2023]

                                        if (tmpDetectionWorkOperationByStage.ObservedTime == (float?)eRMSOPModule.DetectionObservedTime)
                                            standardOperationsDictionaryDetection.ObservedTime = null;
                                        else
                                            standardOperationsDictionaryDetection.ObservedTime = (float?)eRMSOPModule.DetectionObservedTime;

                                        if (tmpDetectionWorkOperationByStage.Activity == (float?)eRMSOPModule.DetectionActivity)
                                            standardOperationsDictionaryDetection.Activity = null;
                                        else
                                            standardOperationsDictionaryDetection.Activity = (float?)eRMSOPModule.DetectionActivity;


                                        #endregion

                                        standardOperationsDictionaryDetection.IdWorkoperation = Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage);
                                        //  standardOperationsDictionaryDetection.ObservedTime = (float?)eRMSOPModule.DetectionObservedTime;
                                        //  standardOperationsDictionaryDetection.Activity = (float?)eRMSOPModule.DetectionActivity;
                                        //[GEOS2-3933][Rupali Sarode][22/09/2022]
                                        standardOperationsDictionaryDetection.Remarks = eRMSOPModule.Remarks == null ? "" : eRMSOPModule.Remarks.Trim();
                                        //[Geos2-5629][Aishwarya Ingale][26 06 2024]
                                        if (eRMSOPModule.DetectionPosition != null && DetectionPos == eRMSOPModule.DetectionPosition)
                                        {
                                            standardOperationsDictionaryDetection.Position = (uint?)eRMSOPModule.DetectionPosition;
                                        }
                                        else
                                        {
                                            standardOperationsDictionaryDetection.Position = (uint?)DetectionPos;
                                        }
                                        DetectionPos++;
                                        standardOperationsDictionaryDetectionsList.Add(standardOperationsDictionaryDetection);
                                    }
                                    else if (ISERMSOPModuleValueUpdated.Activity != eRMSOPModule.DetectionActivity || ISERMSOPModuleValueUpdated.ObservedTime != eRMSOPModule.DetectionObservedTime)
                                    {
                                        standardOperationsDictionaryDetection.TransactionOperation = ModelBase.TransactionOperations.Add;
                                        standardOperationsDictionaryDetection.IdStandardOperationsDictionary = IdStandardOperationsDictionary;
                                        //standardOperationsDictionaryDetection.IdDetection = (byte)(ermDetections.IdDetection);
                                        if (TmpDetectionMenulist == null)
                                            standardOperationsDictionaryDetection.IdDetection = (UInt64)(ermDetections.IdDetection);
                                        else
                                        {
                                            if (TmpDetectionMenulist.Count == 0)
                                                standardOperationsDictionaryDetection.IdDetection = (UInt64)(ermDetections.IdDetection);
                                            else
                                                standardOperationsDictionaryDetection.IdDetection = (UInt64)eRMSOPModule.IdDetection;
                                        }


                                        standardOperationsDictionaryDetection.IdWorkoperation = Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage);
                                        //standardOperationsDictionaryDetection.ObservedTime = (float?)eRMSOPModule.DetectionObservedTime;
                                        //standardOperationsDictionaryDetection.Activity = (float?)eRMSOPModule.DetectionActivity;

                                        #region [GEOS2-4073][Rupali Sarode][09-12-2022]

                                        tmpDetectionWorkOperationByStage = new WorkOperationByStages();
                                        tmpDetectionWorkOperationByStage = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == eRMSOPModule.IdworkOperationByStage && a.KeyName == eRMSOPModule.KeyName).FirstOrDefault(); //[Cut  work operation not work properly.][gulab lakade][24 01 2023]

                                        if (tmpDetectionWorkOperationByStage.ObservedTime == (float?)eRMSOPModule.DetectionObservedTime)
                                            standardOperationsDictionaryDetection.ObservedTime = null;
                                        else
                                            standardOperationsDictionaryDetection.ObservedTime = (float?)eRMSOPModule.DetectionObservedTime;

                                        if (tmpDetectionWorkOperationByStage.Activity == (float?)eRMSOPModule.DetectionActivity)
                                            standardOperationsDictionaryDetection.Activity = null;
                                        else
                                            standardOperationsDictionaryDetection.Activity = (float?)eRMSOPModule.DetectionActivity;


                                        #endregion

                                        //[GEOS2-3933][Rupali Sarode][22/09/2022]
                                        standardOperationsDictionaryDetection.Remarks = eRMSOPModule.Remarks == null ? "" : eRMSOPModule.Remarks.Trim();

                                        //[Geos2-5629][Aishwarya Ingale][26 06 2024]
                                        if (eRMSOPModule.DetectionPosition != null && DetectionPos == eRMSOPModule.DetectionPosition)
                                        {
                                            standardOperationsDictionaryDetection.Position = (uint?)eRMSOPModule.DetectionPosition;
                                        }
                                        else
                                        {
                                            standardOperationsDictionaryDetection.Position = (uint?)DetectionPos;
                                        }
                                        DetectionPos++;
                                        standardOperationsDictionaryDetectionsList.Add(standardOperationsDictionaryDetection);
                                    }

                                }
                            }
                            else
                            {
                                if (ISERMSOPModuleValueUpdated == null)
                                {
                                    standardOperationsDictionaryDetection.TransactionOperation = ModelBase.TransactionOperations.Add;
                                    standardOperationsDictionaryDetection.IdStandardOperationsDictionary = IdStandardOperationsDictionary;
                                    //standardOperationsDictionaryDetection.IdDetection = (UInt64)(ermDetections.IdDetection);
                                    if (TmpDetectionMenulist == null)
                                        standardOperationsDictionaryDetection.IdDetection = (UInt64)(ermDetections.IdDetection);
                                    else
                                    {
                                        if (TmpDetectionMenulist.Count == 0)
                                            standardOperationsDictionaryDetection.IdDetection = (UInt64)(ermDetections.IdDetection);
                                        else
                                            standardOperationsDictionaryDetection.IdDetection = (UInt64)eRMSOPModule.IdDetection;
                                    }
                                    standardOperationsDictionaryDetection.IdWorkoperation = Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage);
                                    // standardOperationsDictionaryDetection.ObservedTime = (float?)eRMSOPModule.DetectionObservedTime;
                                    // standardOperationsDictionaryDetection.Activity = (float?)eRMSOPModule.DetectionActivity;

                                    #region [GEOS2-4073][Rupali Sarode][09-12-2022]

                                    tmpDetectionWorkOperationByStage = new WorkOperationByStages();
                                    tmpDetectionWorkOperationByStage = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == eRMSOPModule.IdworkOperationByStage && a.KeyName == eRMSOPModule.KeyName).FirstOrDefault(); //[Cut  work operation not work properly.][gulab lakade][24 01 2023]
                                    if (tmpDetectionWorkOperationByStage != null)
                                    {
                                        if (tmpDetectionWorkOperationByStage.ObservedTime == (float?)eRMSOPModule.DetectionObservedTime)
                                            standardOperationsDictionaryDetection.ObservedTime = null;
                                        else
                                            standardOperationsDictionaryDetection.ObservedTime = (float?)eRMSOPModule.DetectionObservedTime;

                                        if (tmpDetectionWorkOperationByStage.Activity == (float?)eRMSOPModule.DetectionActivity)
                                            standardOperationsDictionaryDetection.Activity = null;
                                        else
                                            standardOperationsDictionaryDetection.Activity = (float?)eRMSOPModule.DetectionActivity;
                                    }

                                    #endregion

                                    //[GEOS2-3933][Rupali Sarode][22/09/2022]
                                    standardOperationsDictionaryDetection.Remarks = eRMSOPModule.Remarks == null ? "" : eRMSOPModule.Remarks.Trim();
                                    //[Geos2-5629][Aishwarya Ingale][26 06 2024]
                                    if (eRMSOPModule.DetectionPosition != null && DetectionPos == eRMSOPModule.DetectionPosition)
                                    {
                                        standardOperationsDictionaryDetection.Position = (uint?)eRMSOPModule.DetectionPosition;
                                    }
                                    else
                                    {
                                        standardOperationsDictionaryDetection.Position = (uint?)DetectionPos;
                                    }
                                    DetectionPos++;
                                    standardOperationsDictionaryDetectionsList.Add(standardOperationsDictionaryDetection);
                                }
                                //[GEOS2-3933][Rupali Sarode][26/09/2022]
                                //else if (ISERMSOPModuleValueUpdated.Activity != eRMSOPModule.DetectionActivity ||
                                //    // ISERMSOPModuleValueUpdated.ObservedTime != eRMSOPModule.DetectionObservedTime
                                //    Math.Round(Convert.ToDouble(ISERMSOPModuleValueUpdated.ObservedTime), 2) != Math.Round(Convert.ToDouble(eRMSOPModule.DetectionObservedTime), 2)
                                //    )
                                else if (ISERMSOPModuleValueUpdated.Activity != eRMSOPModule.DetectionActivity ||
                                       Math.Round(Convert.ToDouble(ISERMSOPModuleValueUpdated.ObservedTime), 2) != Math.Round(Convert.ToDouble(eRMSOPModule.DetectionObservedTime), 2) ||
                                       ISERMSOPModuleValueUpdated.Remarks != eRMSOPModule.Remarks)
                                {
                                    standardOperationsDictionaryDetection.TransactionOperation = ModelBase.TransactionOperations.Add;
                                    standardOperationsDictionaryDetection.IdStandardOperationsDictionary = IdStandardOperationsDictionary;
                                    //standardOperationsDictionaryDetection.IdDetection = (UInt64)(ermDetections.IdDetection);
                                    if (TmpDetectionMenulist == null)
                                        standardOperationsDictionaryDetection.IdDetection = (UInt64)(ermDetections.IdDetection);
                                    else
                                    {
                                        if (TmpDetectionMenulist.Count == 0)
                                            standardOperationsDictionaryDetection.IdDetection = (UInt64)(ermDetections.IdDetection);
                                        else
                                            standardOperationsDictionaryDetection.IdDetection = (UInt64)eRMSOPModule.IdDetection;
                                    }
                                    standardOperationsDictionaryDetection.IdWorkoperation = Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage);
                                    //standardOperationsDictionaryDetection.ObservedTime = (float?)eRMSOPModule.DetectionObservedTime;
                                    //standardOperationsDictionaryDetection.Activity = (float?)eRMSOPModule.DetectionActivity;

                                    #region [GEOS2-4073][Rupali Sarode][09-12-2022]

                                    tmpDetectionWorkOperationByStage = new WorkOperationByStages();
                                    tmpDetectionWorkOperationByStage = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == eRMSOPModule.IdworkOperationByStage && a.KeyName == eRMSOPModule.KeyName).FirstOrDefault(); //[Cut  work operation not work properly.][gulab lakade][24 01 2023]

                                    if (tmpDetectionWorkOperationByStage.ObservedTime == (float?)eRMSOPModule.DetectionObservedTime)
                                        standardOperationsDictionaryDetection.ObservedTime = null;
                                    else
                                        standardOperationsDictionaryDetection.ObservedTime = (float?)eRMSOPModule.DetectionObservedTime;

                                    if (tmpDetectionWorkOperationByStage.Activity == (float?)eRMSOPModule.DetectionActivity)
                                        standardOperationsDictionaryDetection.Activity = null;
                                    else
                                        standardOperationsDictionaryDetection.Activity = (float?)eRMSOPModule.DetectionActivity;


                                    #endregion

                                    //[GEOS2-3933][Rupali Sarode][22/09/2022]
                                    standardOperationsDictionaryDetection.Remarks = eRMSOPModule.Remarks == null ? "" : eRMSOPModule.Remarks.Trim();
                                    //[Geos2-5629][Aishwarya Ingale][26 06 2024]
                                    if (eRMSOPModule.DetectionPosition != null && DetectionPos == eRMSOPModule.DetectionPosition)
                                    {
                                        standardOperationsDictionaryDetection.Position = (uint?)eRMSOPModule.DetectionPosition;
                                    }
                                    else
                                    {
                                        standardOperationsDictionaryDetection.Position = (uint?)DetectionPos;
                                    }
                                    DetectionPos++;
                                    standardOperationsDictionaryDetectionsList.Add(standardOperationsDictionaryDetection);

                                }

                            }
                        }

                    }
                }
                #region insertProductTypes
                #endregion
                if (standardOperationsDictionaryDetectionDeleteList.Count() > 0)
                {
                    foreach (var eRMSOPDetectionDelete in standardOperationsDictionaryDetectionDeleteList)
                    {
                        StandardOperationsDictionaryDetection standardOperationsDictionaryDetectionDelete = new StandardOperationsDictionaryDetection();

                        standardOperationsDictionaryDetectionDelete.TransactionOperation = ModelBase.TransactionOperations.Delete;
                        standardOperationsDictionaryDetectionDelete.IdStandardOperationsDictionary = eRMSOPDetectionDelete.IdStandardOperationsDictionary;
                        standardOperationsDictionaryDetectionDelete.IdDetection = eRMSOPDetectionDelete.IdDetection;
                        standardOperationsDictionaryDetectionDelete.IdWorkoperation = eRMSOPDetectionDelete.IdWorkoperation;
                        standardOperationsDictionaryDetectionDelete.ObservedTime = (float?)eRMSOPDetectionDelete.ObservedTime;
                        standardOperationsDictionaryDetectionDelete.Activity = (float?)eRMSOPDetectionDelete.Activity;
                        standardOperationsDictionaryDetectionsList.Add(standardOperationsDictionaryDetectionDelete);
                    }
                }
                standardOperationsDictionaryDetectionsList.ForEach(w => w.CreatedBy = Convert.ToInt32(GeosApplication.Instance.ActiveUser.IdUser));
                standardOperationsDictionaryDetectionsList.ForEach(w => w.ModifiedBy = Convert.ToInt32(GeosApplication.Instance.ActiveUser.IdUser));
                #endregion




                #region GEOS2-3837 Option

                #region [GEOS2-3924][Rupali Sarode][21-11-2022]
                // Copy data from tmp to OptionsMenulist
                if (TmpOptionMenulist != null)
                {
                    if (TmpOptionMenulist.Count > 0)
                    {
                        // [GEOS2-4108][Rupali Sarode] copy ModuleMenulist 
                        TmpOptionMenulistOriginal = new ObservableCollection<ERMSOPOptions>();
                        TmpOptionMenulistOriginal.AddRange(OptionsMenulist);

                        OptionsMenulist = new ObservableCollection<ERMSOPOptions>();
                        OptionsMenulist.AddRange(TmpOptionMenulist);
                    }
                }

                #endregion

                WorkOperationByStages tmpOptionWorkOperationByStage;
                List<StandardOperationsDictionaryOption> standardOperationsDictionaryOptionsList = new List<StandardOperationsDictionaryOption>();
                if (SelectedItemOption is ERMOptions)
                {
                    ERMOptions ermOptions = (ERMOptions)SelectedItemOption;
                    if (OptionsMenulist != null && OptionsMenulist.Count > 0)
                    {

                        //Aishwarya Ingale[Geos2-5629]
                        //OptionsMenulist = new ObservableCollection<ERMSOPOptions>(OptionsMenulist.GroupBy(i => i.IdParent)
                        //        .SelectMany(group => group.Select((item, index) =>
                        //        {
                        //            item.OptionPosition = (uint)(index + 1); return item;
                        //        })).ToList());


                        UInt32 OptionPosition = 1;
                        foreach (ERMSOPOptions eRMSOPOption in OptionsMenulist)
                        {
                            string TempKeyName = eRMSOPOption.KeyName;
                            #region [gulab lakade][beta changes][02 08 2024]
                            if (TempKeyName.Contains("Group_"))
                            {
                                eRMSOPOption.OptionPosition = OptionPosition;
                                OptionPosition++;
                                //var TempRecord = OptionsMenulist.Where(x => x.ParentName == eRMSOPOption.KeyName && x.ParentName != null).ToList();
                                //if (TempRecord.Count() > 0)
                                //{
                                //    foreach (var item in TempRecord.OrderBy(a => a.OptionPosition).ToList())
                                //    {
                                //        //start[GEOS2-5629][gulab lakade][16 07 2024]
                                //        int TempCount = 0;
                                //        TempCount = OptionsMenulist.Where(c => c.ParentName == item.KeyName).ToList().Count();
                                //        if (TempCount == 0)
                                //        {
                                //            item.OptionPosition = OptionPosition;
                                //            OptionPosition++;
                                //        }
                                //        //end[GEOS2-5629][gulab lakade][16 07 2024]

                                //    }

                                //}
                                //else
                                //{
                                //    eRMSOPOption.OptionPosition = OptionPosition;
                                //    OptionPosition++;
                                //}
                            }

                            #endregion
                            List<ERMSOPOptions> TmpoptionListchild = OptionsMenulist.Where(a => a.ParentName == eRMSOPOption.KeyName).OrderBy(a => a.OptionPosition).ToList();
                            if (TmpoptionListchild.Count() > 0)
                            {
                                OptionPosition = TempCalculateoption(OptionPosition, TmpoptionListchild);
                            }

                        }


                        int OptionPos = 1;//[Geos2-5629][Aishwarya Ingale][26 06 2024]



                        //foreach (ERMSOPOptions eRMSOPModule in OptionsMenulist)
                        foreach (ERMSOPOptions eRMSOPOption in OptionsMenulist.Where(a => a.OptionPosition != null).OrderBy(x => x.OptionPosition))//[GEOS2-5629][gulab lakade][10 07 2024])
                        {
                            StandardOperationsDictionaryOption standardOperationsDictionaryOption = new StandardOperationsDictionaryOption();
                            WorkOperationByStages workOperationByStages = WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(eRMSOPOption.KeyName)).FirstOrDefault();
                            //StandardOperationsDictionaryOption ISERMSOPModuleValueUpdated = tempLstStandardOperationsDictionaryDetection.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage) && w.IdDetection == eRMSOPModule.IdDetection).FirstOrDefault();
                            StandardOperationsDictionaryOption ISERMSOPOptionValueUpdated = tempLstStandardOperationsDictionaryOption.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPOption.IdworkOperationByStage) && w.IdDetection == eRMSOPOption.IdDetection).FirstOrDefault();
                            if (workOperationByStages != null)
                            {
                                if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(workOperationByStages.Name.Trim())))
                                {

                                }
                                else
                                {
                                    if (ISERMSOPOptionValueUpdated == null)
                                    {
                                        standardOperationsDictionaryOption.TransactionOperation = ModelBase.TransactionOperations.Add;
                                        standardOperationsDictionaryOption.IdStandardOperationsDictionary = IdStandardOperationsDictionary;
                                        //standardOperationsDictionaryOption.IdDetection = (UInt64)(ermOptions.IdDetection);

                                        if (TmpOptionMenulist == null)  //[GEOS2-3924][Rupali Sarode][22-11-2022]
                                            standardOperationsDictionaryOption.IdDetection = (UInt64)(ermOptions.IdDetection);
                                        else
                                        {
                                            if (TmpOptionMenulist.Count == 0)
                                                standardOperationsDictionaryOption.IdDetection = (UInt64)(ermOptions.IdDetection);
                                            else
                                                standardOperationsDictionaryOption.IdDetection = (UInt64)eRMSOPOption.IdDetection;
                                        }
                                        standardOperationsDictionaryOption.IdWorkoperation = Convert.ToUInt64(eRMSOPOption.IdworkOperationByStage);
                                        //standardOperationsDictionaryOption.ObservedTime = (float?)eRMSOPOption.OptionObservedTime;
                                        //standardOperationsDictionaryOption.Activity = (float?)eRMSOPOption.OptionActivity;

                                        #region [GEOS2-4083][Rupali Sarode][10-12-2022]

                                        tmpOptionWorkOperationByStage = new WorkOperationByStages();
                                        tmpOptionWorkOperationByStage = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == eRMSOPOption.IdworkOperationByStage && a.KeyName == eRMSOPOption.KeyName).FirstOrDefault(); //[Cut  work operation not work properly.][gulab lakade][24 01 2023]

                                        if (tmpOptionWorkOperationByStage.ObservedTime == (float?)eRMSOPOption.OptionObservedTime)
                                            standardOperationsDictionaryOption.ObservedTime = null;
                                        else
                                            standardOperationsDictionaryOption.ObservedTime = (float?)eRMSOPOption.OptionObservedTime;

                                        if (tmpOptionWorkOperationByStage.Activity == (float?)eRMSOPOption.OptionActivity)
                                            standardOperationsDictionaryOption.Activity = null;
                                        else
                                            standardOperationsDictionaryOption.Activity = (float?)eRMSOPOption.OptionActivity;

                                        #endregion

                                        //[GEOS2-3933][Rupali Sarode][22/09/2022]
                                        standardOperationsDictionaryOption.Remarks = eRMSOPOption.Remarks == null ? "" : eRMSOPOption.Remarks.Trim();
                                        //[Geos2-5629][Aishwarya Ingale][26 06 2024]
                                        if (eRMSOPOption.OptionPosition != null && OptionPos == eRMSOPOption.OptionPosition)
                                        {
                                            standardOperationsDictionaryOption.Position = (uint?)eRMSOPOption.OptionPosition;
                                        }
                                        else
                                        {
                                            standardOperationsDictionaryOption.Position = (uint?)OptionPos;
                                        }
                                        OptionPos++;


                                        standardOperationsDictionaryOptionsList.Add(standardOperationsDictionaryOption);
                                    }
                                    else if (ISERMSOPOptionValueUpdated.Activity != eRMSOPOption.OptionActivity || ISERMSOPOptionValueUpdated.ObservedTime != eRMSOPOption.OptionObservedTime)
                                    {
                                        standardOperationsDictionaryOption.TransactionOperation = ModelBase.TransactionOperations.Add;
                                        standardOperationsDictionaryOption.IdStandardOperationsDictionary = IdStandardOperationsDictionary;
                                        //standardOperationsDictionaryOption.IdDetection = (UInt64)(ermOptions.IdDetection);
                                        if (TmpOptionMenulist == null)  //[GEOS2-3924][Rupali Sarode][22-11-2022]
                                            standardOperationsDictionaryOption.IdDetection = (UInt64)(ermOptions.IdDetection);
                                        else
                                        {
                                            if (TmpOptionMenulist.Count == 0)
                                                standardOperationsDictionaryOption.IdDetection = (UInt64)(ermOptions.IdDetection);
                                            else
                                                standardOperationsDictionaryOption.IdDetection = (UInt64)eRMSOPOption.IdDetection;
                                        }
                                        standardOperationsDictionaryOption.IdWorkoperation = Convert.ToUInt64(eRMSOPOption.IdworkOperationByStage);
                                        //standardOperationsDictionaryOption.ObservedTime = (float?)eRMSOPOption.OptionObservedTime;
                                        //standardOperationsDictionaryOption.Activity = (float?)eRMSOPOption.OptionActivity;
                                        #region [GEOS2-4083][Rupali Sarode][10-12-2022]

                                        tmpOptionWorkOperationByStage = new WorkOperationByStages();
                                        tmpOptionWorkOperationByStage = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == eRMSOPOption.IdworkOperationByStage && a.KeyName == eRMSOPOption.KeyName).FirstOrDefault(); //[Cut  work operation not work properly.][gulab lakade][24 01 2023]

                                        if (tmpOptionWorkOperationByStage.ObservedTime == (float?)eRMSOPOption.OptionObservedTime)
                                            standardOperationsDictionaryOption.ObservedTime = null;
                                        else
                                            standardOperationsDictionaryOption.ObservedTime = (float?)eRMSOPOption.OptionObservedTime;

                                        if (tmpOptionWorkOperationByStage.Activity == (float?)eRMSOPOption.OptionActivity)
                                            standardOperationsDictionaryOption.Activity = null;
                                        else
                                            standardOperationsDictionaryOption.Activity = (float?)eRMSOPOption.OptionActivity;

                                        #endregion
                                        //[GEOS2-3933][Rupali Sarode][22/09/2022]
                                        standardOperationsDictionaryOption.Remarks = eRMSOPOption.Remarks == null ? "" : eRMSOPOption.Remarks.Trim();
                                        //[Geos2-5629][Aishwarya Ingale][26 06 2024]
                                        if (eRMSOPOption.OptionPosition != null && OptionPos == eRMSOPOption.OptionPosition)
                                        {
                                            standardOperationsDictionaryOption.Position = (uint?)eRMSOPOption.OptionPosition;
                                        }
                                        else
                                        {
                                            standardOperationsDictionaryOption.Position = (uint?)OptionPos;
                                        }
                                        OptionPos++;
                                        standardOperationsDictionaryOptionsList.Add(standardOperationsDictionaryOption);
                                    }

                                }
                            }
                            else
                            {
                                if (ISERMSOPOptionValueUpdated == null)
                                {
                                    standardOperationsDictionaryOption.TransactionOperation = ModelBase.TransactionOperations.Add;
                                    standardOperationsDictionaryOption.IdStandardOperationsDictionary = IdStandardOperationsDictionary;
                                    //standardOperationsDictionaryOption.IdDetection = (UInt64)(ermOptions.IdDetection);
                                    if (TmpOptionMenulist == null)  //[GEOS2-3924][Rupali Sarode][22-11-2022]
                                        standardOperationsDictionaryOption.IdDetection = (UInt64)(ermOptions.IdDetection);
                                    else
                                    {
                                        if (TmpOptionMenulist.Count == 0)
                                            standardOperationsDictionaryOption.IdDetection = (UInt64)(ermOptions.IdDetection);
                                        else
                                            standardOperationsDictionaryOption.IdDetection = (UInt64)eRMSOPOption.IdDetection;
                                    }
                                    standardOperationsDictionaryOption.IdWorkoperation = Convert.ToUInt64(eRMSOPOption.IdworkOperationByStage);
                                    //standardOperationsDictionaryOption.ObservedTime = (float?)eRMSOPOption.OptionObservedTime;
                                    //standardOperationsDictionaryOption.Activity = (float?)eRMSOPOption.OptionActivity;

                                    #region [GEOS2-4083][Rupali Sarode][10-12-2022]

                                    tmpOptionWorkOperationByStage = new WorkOperationByStages();
                                    tmpOptionWorkOperationByStage = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == eRMSOPOption.IdworkOperationByStage && a.KeyName == eRMSOPOption.KeyName).FirstOrDefault(); //[Cut  work operation not work properly.][gulab lakade][24 01 2023]

                                    if (tmpOptionWorkOperationByStage.ObservedTime == (float?)eRMSOPOption.OptionObservedTime)
                                        standardOperationsDictionaryOption.ObservedTime = null;
                                    else
                                        standardOperationsDictionaryOption.ObservedTime = (float?)eRMSOPOption.OptionObservedTime;

                                    if (tmpOptionWorkOperationByStage.Activity == (float?)eRMSOPOption.OptionActivity)
                                        standardOperationsDictionaryOption.Activity = null;
                                    else
                                        standardOperationsDictionaryOption.Activity = (float?)eRMSOPOption.OptionActivity;

                                    #endregion

                                    //[GEOS2-3933][Rupali Sarode][22/09/2022]
                                    standardOperationsDictionaryOption.Remarks = eRMSOPOption.Remarks == null ? "" : eRMSOPOption.Remarks.Trim();
                                    //[Geos2-5629][Aishwarya Ingale][26 06 2024]
                                    if (eRMSOPOption.OptionPosition != null && OptionPos == eRMSOPOption.OptionPosition)
                                    {
                                        standardOperationsDictionaryOption.Position = (uint?)eRMSOPOption.OptionPosition;
                                    }
                                    else
                                    {
                                        standardOperationsDictionaryOption.Position = (uint?)OptionPos;
                                    }
                                    OptionPos++;
                                    standardOperationsDictionaryOptionsList.Add(standardOperationsDictionaryOption);
                                }
                                //[GEOS2-3933][Rupali Sarode][26/09/2022]
                                //else if (ISERMSOPOptionValueUpdated.Activity != eRMSOPOption.OptionActivity ||
                                //    // ISERMSOPModuleValueUpdated.ObservedTime != eRMSOPModule.DetectionObservedTime
                                //    Math.Round(Convert.ToDouble(ISERMSOPOptionValueUpdated.ObservedTime), 2) != Math.Round(Convert.ToDouble(eRMSOPOption.OptionObservedTime), 2)
                                //    )
                                else if (ISERMSOPOptionValueUpdated.Activity != eRMSOPOption.OptionActivity ||
                                    // ISERMSOPModuleValueUpdated.ObservedTime != eRMSOPModule.DetectionObservedTime
                                    Math.Round(Convert.ToDouble(ISERMSOPOptionValueUpdated.ObservedTime), 2) != Math.Round(Convert.ToDouble(eRMSOPOption.OptionObservedTime), 2) ||
                                    ISERMSOPOptionValueUpdated.Remarks != eRMSOPOption.Remarks)
                                {
                                    standardOperationsDictionaryOption.TransactionOperation = ModelBase.TransactionOperations.Add;
                                    standardOperationsDictionaryOption.IdStandardOperationsDictionary = IdStandardOperationsDictionary;
                                    //standardOperationsDictionaryOption.IdDetection = (UInt64)(ermOptions.IdDetection);
                                    if (TmpOptionMenulist == null)  //[GEOS2-3924][Rupali Sarode][22-11-2022]
                                        standardOperationsDictionaryOption.IdDetection = (UInt64)(ermOptions.IdDetection);
                                    else
                                    {
                                        if (TmpOptionMenulist.Count == 0)
                                            standardOperationsDictionaryOption.IdDetection = (UInt64)(ermOptions.IdDetection);
                                        else
                                            standardOperationsDictionaryOption.IdDetection = (UInt64)eRMSOPOption.IdDetection;
                                    }
                                    standardOperationsDictionaryOption.IdWorkoperation = Convert.ToUInt64(eRMSOPOption.IdworkOperationByStage);
                                    //standardOperationsDictionaryOption.ObservedTime = (float?)eRMSOPOption.OptionObservedTime;
                                    //standardOperationsDictionaryOption.Activity = (float?)eRMSOPOption.OptionActivity;

                                    #region [GEOS2-4083][Rupali Sarode][10-12-2022]

                                    tmpOptionWorkOperationByStage = new WorkOperationByStages();
                                    tmpOptionWorkOperationByStage = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == eRMSOPOption.IdworkOperationByStage && a.KeyName == eRMSOPOption.KeyName).FirstOrDefault(); //[Cut  work operation not work properly.][gulab lakade][24 01 2023]

                                    if (tmpOptionWorkOperationByStage.ObservedTime == (float?)eRMSOPOption.OptionObservedTime)
                                        standardOperationsDictionaryOption.ObservedTime = null;
                                    else
                                        standardOperationsDictionaryOption.ObservedTime = (float?)eRMSOPOption.OptionObservedTime;

                                    if (tmpOptionWorkOperationByStage.Activity == (float?)eRMSOPOption.OptionActivity)
                                        standardOperationsDictionaryOption.Activity = null;
                                    else
                                        standardOperationsDictionaryOption.Activity = (float?)eRMSOPOption.OptionActivity;

                                    #endregion
                                    //[GEOS2-3933][Rupali Sarode][22/09/2022]
                                    standardOperationsDictionaryOption.Remarks = eRMSOPOption.Remarks == null ? "" : eRMSOPOption.Remarks.Trim();
                                    //[Geos2-5629][Aishwarya Ingale][26 06 2024]
                                    if (eRMSOPOption.OptionPosition != null && OptionPos == eRMSOPOption.OptionPosition)
                                    {
                                        standardOperationsDictionaryOption.Position = (uint?)eRMSOPOption.OptionPosition;
                                    }
                                    else
                                    {
                                        standardOperationsDictionaryOption.Position = (uint?)OptionPos;
                                    }
                                    OptionPos++;
                                    standardOperationsDictionaryOptionsList.Add(standardOperationsDictionaryOption);

                                }

                            }
                        }

                    }
                }
                #region insertProductTypes
                #endregion
                if (standardOperationsDictionaryOptionDeleteList.Count() > 0)
                {
                    foreach (var eRMSOPOptionDelete in standardOperationsDictionaryOptionDeleteList)
                    {
                        StandardOperationsDictionaryOption standardOperationsDictionaryOptionDelete = new StandardOperationsDictionaryOption();

                        standardOperationsDictionaryOptionDelete.TransactionOperation = ModelBase.TransactionOperations.Delete;
                        standardOperationsDictionaryOptionDelete.IdStandardOperationsDictionary = eRMSOPOptionDelete.IdStandardOperationsDictionary;
                        standardOperationsDictionaryOptionDelete.IdDetection = eRMSOPOptionDelete.IdDetection;
                        standardOperationsDictionaryOptionDelete.IdWorkoperation = eRMSOPOptionDelete.IdWorkoperation;
                        standardOperationsDictionaryOptionDelete.ObservedTime = (float?)eRMSOPOptionDelete.ObservedTime;
                        standardOperationsDictionaryOptionDelete.Activity = (float?)eRMSOPOptionDelete.Activity;
                        standardOperationsDictionaryOptionsList.Add(standardOperationsDictionaryOptionDelete);
                    }
                }
                standardOperationsDictionaryOptionsList.ForEach(w => w.CreatedBy = Convert.ToInt32(GeosApplication.Instance.ActiveUser.IdUser));
                standardOperationsDictionaryOptionsList.ForEach(w => w.ModifiedBy = Convert.ToInt32(GeosApplication.Instance.ActiveUser.IdUser));
                #endregion
                #region GEOS2-3838 Way

                #region [sdeshpande] [GEOS2-3923] [17-11-2022]
                // Copy data from tmp to WayMenulist
                if (TmpWayMenulist != null)
                {
                    if (TmpWayMenulist.Count > 0)
                    {
                        // [GEOS2-4108][Rupali Sarode] copy ModuleMenulist 
                        TmpWayMenulistOriginal = new ObservableCollection<ERMSOPWays>();
                        TmpWayMenulistOriginal.AddRange(WaysMenulist);

                        WaysMenulist = new ObservableCollection<ERMSOPWays>();
                        WaysMenulist.AddRange(TmpWayMenulist);
                    }
                }


                #endregion

                List<StandardOperationsDictionaryWays> standardOperationsDictionaryWaysList = new List<StandardOperationsDictionaryWays>();
                if (SelectedItemWay is ERMWays)
                {
                    ERMWays ermWays = (ERMWays)SelectedItemWay;
                    if (WaysMenulist != null && WaysMenulist.Count > 0)
                    {

                        //Aishwarya Ingale[Geos2-5629]
                        //WaysMenulist = new ObservableCollection<ERMSOPWays>(WaysMenulist.GroupBy(i => i.IdParent)
                        //        .SelectMany(group => group.Select((item, index) =>
                        //        {
                        //            item.WayPosition = (uint)(index + 1); return item;
                        //        })).ToList());


                        UInt32 WaysPosition = 1;
                        foreach (ERMSOPWays eRMSOPWay in WaysMenulist)
                        {
                            string TempKeyName = eRMSOPWay.KeyName;
                            #region [gulab lakade][beta changes][02 08 2024]
                            if (TempKeyName.Contains("Group_"))
                            {
                                eRMSOPWay.WayPosition = WaysPosition;
                                WaysPosition++;
                                //var TempRecord = WaysMenulist.Where(x => x.ParentName == eRMSOPWay.KeyName && x.ParentName != null).ToList();
                                //if (TempRecord.Count() > 0)
                                //{
                                //    foreach (var item in TempRecord.OrderBy(a => a.WayPosition).ToList())
                                //    {
                                //        //start[GEOS2-5629][gulab lakade][16 07 2024]
                                //        int TempCount = 0;
                                //        TempCount = WaysMenulist.Where(c => c.ParentName == item.KeyName).ToList().Count();
                                //        if (TempCount == 0)
                                //        {
                                //            item.WayPosition = WaysPosition;
                                //            WaysPosition++;
                                //        }
                                //        //end[GEOS2-5629][gulab lakade][16 07 2024]

                                //    }

                                //}
                                //else
                                //{
                                //    eRMSOPWay.WayPosition = WaysPosition;
                                //    WaysPosition++;
                                //}
                            }
                            #endregion
                            List<ERMSOPWays> TmpwayListchild = WaysMenulist.Where(a => a.ParentName == eRMSOPWay.KeyName).OrderBy(a => a.WayPosition).ToList();
                            if (TmpwayListchild.Count() > 0)
                            {
                                WaysPosition = TempCalculateway(WaysPosition, TmpwayListchild);
                            }
                        }


                        int WaysPos = 1;//[Geos2-5629][Aishwarya Ingale][26 06 2024]

                        foreach (ERMSOPWays eRMSOPWay in WaysMenulist.Where(a => a.WayPosition != null).OrderBy(x => x.WayPosition))//[GEOS2-5629][gulab lakade][10 07 2024])
                        {
                            StandardOperationsDictionaryWays standardOperationsDictionaryWay = new StandardOperationsDictionaryWays();
                            WorkOperationByStages workOperationByStages = WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(eRMSOPWay.KeyName)).FirstOrDefault();
                            //StandardOperationsDictionaryOption ISERMSOPModuleValueUpdated = tempLstStandardOperationsDictionaryDetection.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage) && w.IdDetection == eRMSOPModule.IdDetection).FirstOrDefault();
                            StandardOperationsDictionaryWays ISERMSOPWayValueUpdated = tempLstStandardOperationsDictionaryWay.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPWay.IdworkOperationByStage) && w.IdDetection == eRMSOPWay.IdDetection).FirstOrDefault();
                            if (workOperationByStages != null)
                            {
                                if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(workOperationByStages.Name.Trim())))
                                {

                                }
                                else
                                {
                                    if (ISERMSOPWayValueUpdated == null)
                                    {
                                        standardOperationsDictionaryWay.TransactionOperation = ModelBase.TransactionOperations.Add;
                                        standardOperationsDictionaryWay.IdStandardOperationsDictionary = IdStandardOperationsDictionary;
                                        //standardOperationsDictionaryWay.IdDetection = (UInt64)(ermWays.IdDetection);
                                        if (TmpWayMenulist == null)
                                            standardOperationsDictionaryWay.IdDetection = (UInt64)(ermWays.IdDetection);  //[GEOS2-3923] [sdeshpande] [17-11-2022]
                                        else
                                        {
                                            if (TmpWayMenulist.Count == 0)
                                                standardOperationsDictionaryWay.IdDetection = (UInt64)(ermWays.IdDetection);  //[GEOS2-3923] [sdeshpande] [17-11-2022]
                                            else
                                                standardOperationsDictionaryWay.IdDetection = (UInt64)(eRMSOPWay.IdDetection);  //[GEOS2-3923] [sdeshpande] [17-11-2022]
                                        }

                                        standardOperationsDictionaryWay.IdWorkoperation = Convert.ToUInt64(eRMSOPWay.IdworkOperationByStage);
                                        #region Geos2 4077 Ways Store/ Save in the SDO tables the Observed time, Activity
                                        var tempListData = WorkOperationMenulist.Where(w => w.IdworkOperationByStage.Equals(eRMSOPWay.IdworkOperationByStage) && w.KeyName == eRMSOPWay.KeyName).FirstOrDefault(); //[Cut  work operation not work properly.][gulab lakade][24 01 2023]
                                        if (tempListData != null)
                                        {
                                            if (tempListData.ObservedTime == (float?)eRMSOPWay.WayObservedTime)
                                            {
                                                standardOperationsDictionaryWay.ObservedTime = null;

                                            }
                                            else
                                            {
                                                standardOperationsDictionaryWay.ObservedTime = (float?)eRMSOPWay.WayObservedTime;
                                            }
                                            if (tempListData.Activity == eRMSOPWay.WayActivity)
                                            {
                                                standardOperationsDictionaryWay.Activity = null;

                                            }
                                            else
                                            {
                                                standardOperationsDictionaryWay.Activity = (float?)eRMSOPWay.WayActivity;
                                            }
                                            //standardOperationsDictionaryWay.ObservedTime = (float?)eRMSOPWay.WayObservedTime;
                                            //standardOperationsDictionaryWay.Activity = (float?)eRMSOPWay.WayActivity;
                                        }


                                        #endregion
                                        //[GEOS2-3933][Rupali Sarode][22/09/2022]
                                        standardOperationsDictionaryWay.Remarks = eRMSOPWay.Remarks == null ? "" : eRMSOPWay.Remarks.Trim();

                                        //[Geos2-5629][Aishwarya Ingale][26 06 2024]
                                        if (eRMSOPWay.WayPosition != null && WaysPos == eRMSOPWay.WayPosition)
                                        {
                                            standardOperationsDictionaryWay.Position = (uint?)eRMSOPWay.WayPosition;
                                        }
                                        else
                                        {
                                            standardOperationsDictionaryWay.Position = (uint?)WaysPos;
                                        }
                                        WaysPos++;

                                        standardOperationsDictionaryWaysList.Add(standardOperationsDictionaryWay);
                                    }
                                    else if (ISERMSOPWayValueUpdated.Activity != eRMSOPWay.WayActivity || ISERMSOPWayValueUpdated.ObservedTime != eRMSOPWay.WayObservedTime)
                                    {
                                        standardOperationsDictionaryWay.TransactionOperation = ModelBase.TransactionOperations.Add;
                                        standardOperationsDictionaryWay.IdStandardOperationsDictionary = IdStandardOperationsDictionary;
                                        //standardOperationsDictionaryWay.IdDetection = (UInt64)(ermWays.IdDetection);
                                        if (TmpWayMenulist == null)
                                            standardOperationsDictionaryWay.IdDetection = (UInt64)(ermWays.IdDetection);  //[GEOS2-3923] [sdeshpande] [17-11-2022]
                                        else
                                        {
                                            if (TmpWayMenulist.Count == 0)
                                                standardOperationsDictionaryWay.IdDetection = (UInt64)(ermWays.IdDetection);  //[GEOS2-3923] [sdeshpande] [17-11-2022]
                                            else
                                                standardOperationsDictionaryWay.IdDetection = (UInt64)(eRMSOPWay.IdDetection);  //[GEOS2-3923] [sdeshpande] [17-11-2022]
                                        }
                                        standardOperationsDictionaryWay.IdWorkoperation = Convert.ToUInt64(eRMSOPWay.IdworkOperationByStage);
                                        #region Geos2 4077 Ways Store/ Save in the SDO tables the Observed time, Activity
                                        var tempListData = WorkOperationMenulist.Where(w => w.IdworkOperationByStage.Equals(eRMSOPWay.IdworkOperationByStage) && w.KeyName == eRMSOPWay.KeyName).FirstOrDefault(); //[Cut  work operation not work properly.][gulab lakade][24 01 2023]
                                        if (tempListData != null)
                                        {
                                            if (tempListData.ObservedTime == (float?)eRMSOPWay.WayObservedTime)
                                            {
                                                standardOperationsDictionaryWay.ObservedTime = null;

                                            }
                                            else
                                            {
                                                standardOperationsDictionaryWay.ObservedTime = (float?)eRMSOPWay.WayObservedTime;
                                            }
                                            if (tempListData.Activity == eRMSOPWay.WayActivity)
                                            {
                                                standardOperationsDictionaryWay.Activity = null;

                                            }
                                            else
                                            {
                                                standardOperationsDictionaryWay.Activity = (float?)eRMSOPWay.WayActivity;
                                            }
                                            //standardOperationsDictionaryWay.ObservedTime = (float?)eRMSOPWay.WayObservedTime;
                                            //standardOperationsDictionaryWay.Activity = (float?)eRMSOPWay.WayActivity;
                                        }


                                        #endregion
                                        //[GEOS2-3933][Rupali Sarode][22/09/2022]
                                        standardOperationsDictionaryWay.Remarks = eRMSOPWay.Remarks == null ? "" : eRMSOPWay.Remarks.Trim();
                                        //[Geos2-5629][Aishwarya Ingale][26 06 2024]
                                        if (eRMSOPWay.WayPosition != null && WaysPos == eRMSOPWay.WayPosition)
                                        {
                                            standardOperationsDictionaryWay.Position = (uint?)eRMSOPWay.WayPosition;
                                        }
                                        else
                                        {
                                            standardOperationsDictionaryWay.Position = (uint?)WaysPos;
                                        }
                                        WaysPos++;
                                        standardOperationsDictionaryWaysList.Add(standardOperationsDictionaryWay);
                                    }

                                }
                            }
                            else
                            {
                                if (ISERMSOPWayValueUpdated == null)
                                {
                                    standardOperationsDictionaryWay.TransactionOperation = ModelBase.TransactionOperations.Add;
                                    standardOperationsDictionaryWay.IdStandardOperationsDictionary = IdStandardOperationsDictionary;
                                    //standardOperationsDictionaryWay.IdDetection = (UInt64)(ermWays.IdDetection);
                                    if (TmpWayMenulist == null)
                                        standardOperationsDictionaryWay.IdDetection = (UInt64)(ermWays.IdDetection);  //[GEOS2-3923] [sdeshpande] [17-11-2022]
                                    else
                                    {
                                        if (TmpWayMenulist.Count == 0)
                                            standardOperationsDictionaryWay.IdDetection = (UInt64)(ermWays.IdDetection);  //[GEOS2-3923] [sdeshpande] [17-11-2022]
                                        else
                                            standardOperationsDictionaryWay.IdDetection = (UInt64)(eRMSOPWay.IdDetection);  //[GEOS2-3923] [sdeshpande] [17-11-2022]
                                    }
                                    standardOperationsDictionaryWay.IdWorkoperation = Convert.ToUInt64(eRMSOPWay.IdworkOperationByStage);
                                    #region Geos2 4077 Ways Store/ Save in the SDO tables the Observed time, Activity
                                    var tempListData = WorkOperationMenulist.Where(w => w.IdworkOperationByStage.Equals(eRMSOPWay.IdworkOperationByStage) && w.KeyName == eRMSOPWay.KeyName).FirstOrDefault(); //[Cut  work operation not work properly.][gulab lakade][24 01 2023]
                                    if (tempListData != null)
                                    {
                                        if (tempListData.ObservedTime == (float?)eRMSOPWay.WayObservedTime)
                                        {
                                            standardOperationsDictionaryWay.ObservedTime = null;

                                        }
                                        else
                                        {
                                            standardOperationsDictionaryWay.ObservedTime = (float?)eRMSOPWay.WayObservedTime;
                                        }
                                        if (tempListData.Activity == eRMSOPWay.WayActivity)
                                        {
                                            standardOperationsDictionaryWay.Activity = null;

                                        }
                                        else
                                        {
                                            standardOperationsDictionaryWay.Activity = (float?)eRMSOPWay.WayActivity;
                                        }
                                        //standardOperationsDictionaryWay.ObservedTime = (float?)eRMSOPWay.WayObservedTime;
                                        //standardOperationsDictionaryWay.Activity = (float?)eRMSOPWay.WayActivity;
                                    }


                                    #endregion
                                    //[GEOS2-3933][Rupali Sarode][22/09/2022]
                                    standardOperationsDictionaryWay.Remarks = eRMSOPWay.Remarks == null ? "" : eRMSOPWay.Remarks.Trim();
                                    //[Geos2-5629][Aishwarya Ingale][26 06 2024]
                                    if (eRMSOPWay.WayPosition != null && WaysPos == eRMSOPWay.WayPosition)
                                    {
                                        standardOperationsDictionaryWay.Position = (uint?)eRMSOPWay.WayPosition;
                                    }
                                    else
                                    {
                                        standardOperationsDictionaryWay.Position = (uint?)WaysPos;
                                    }
                                    WaysPos++;
                                    standardOperationsDictionaryWaysList.Add(standardOperationsDictionaryWay);
                                }
                                //[GEOS2-3933][Rupali Sarode][26/09/2022]
                                //else if (ISERMSOPWayValueUpdated.Activity != eRMSOPWay.WayActivity ||
                                //    Math.Round(Convert.ToDouble(ISERMSOPWayValueUpdated.ObservedTime), 2) != Math.Round(Convert.ToDouble(eRMSOPWay.WayObservedTime), 2)
                                //    )
                                else if (ISERMSOPWayValueUpdated.Activity != eRMSOPWay.WayActivity ||
                                   Math.Round(Convert.ToDouble(ISERMSOPWayValueUpdated.ObservedTime), 2) != Math.Round(Convert.ToDouble(eRMSOPWay.WayObservedTime), 2) ||
                                   ISERMSOPWayValueUpdated.Remarks != eRMSOPWay.Remarks)
                                {
                                    standardOperationsDictionaryWay.TransactionOperation = ModelBase.TransactionOperations.Add;
                                    standardOperationsDictionaryWay.IdStandardOperationsDictionary = IdStandardOperationsDictionary;
                                    //standardOperationsDictionaryWay.IdDetection = (UInt64)(ermWays.IdDetection);
                                    if (TmpWayMenulist == null)
                                        standardOperationsDictionaryWay.IdDetection = (UInt64)(ermWays.IdDetection);  //[GEOS2-3923] [sdeshpande] [17-11-2022]
                                    else
                                    {
                                        if (TmpWayMenulist.Count == 0)
                                            standardOperationsDictionaryWay.IdDetection = (UInt64)(ermWays.IdDetection);  //[GEOS2-3923] [sdeshpande] [17-11-2022]
                                        else
                                            standardOperationsDictionaryWay.IdDetection = (UInt64)(eRMSOPWay.IdDetection);  //[GEOS2-3923] [sdeshpande] [17-11-2022]
                                    }
                                    standardOperationsDictionaryWay.IdWorkoperation = Convert.ToUInt64(eRMSOPWay.IdworkOperationByStage);
                                    #region Geos2 4077 Ways Store/ Save in the SDO tables the Observed time, Activity
                                    var tempListData = WorkOperationMenulist.Where(w => w.IdworkOperationByStage.Equals(eRMSOPWay.IdworkOperationByStage) && w.KeyName == eRMSOPWay.KeyName).FirstOrDefault(); //[Cut  work operation not work properly.][gulab lakade][24 01 2023]
                                    if (tempListData != null)
                                    {
                                        if (tempListData.ObservedTime == (float?)eRMSOPWay.WayObservedTime)
                                        {
                                            standardOperationsDictionaryWay.ObservedTime = null;

                                        }
                                        else
                                        {
                                            standardOperationsDictionaryWay.ObservedTime = (float?)eRMSOPWay.WayObservedTime;
                                        }
                                        if (tempListData.Activity == eRMSOPWay.WayActivity)
                                        {
                                            standardOperationsDictionaryWay.Activity = null;

                                        }
                                        else
                                        {
                                            standardOperationsDictionaryWay.Activity = (float?)eRMSOPWay.WayActivity;
                                        }
                                        //standardOperationsDictionaryWay.ObservedTime = (float?)eRMSOPWay.WayObservedTime;
                                        //standardOperationsDictionaryWay.Activity = (float?)eRMSOPWay.WayActivity;
                                    }


                                    #endregion
                                    //[GEOS2-3933][Rupali Sarode][22/09/2022]
                                    standardOperationsDictionaryWay.Remarks = eRMSOPWay.Remarks == null ? "" : eRMSOPWay.Remarks.Trim();
                                    //[Geos2-5629][Aishwarya Ingale][26 06 2024]
                                    if (eRMSOPWay.WayPosition != null && WaysPos == eRMSOPWay.WayPosition)
                                    {
                                        standardOperationsDictionaryWay.Position = (uint?)eRMSOPWay.WayPosition;
                                    }
                                    else
                                    {
                                        standardOperationsDictionaryWay.Position = (uint?)WaysPos;
                                    }
                                    WaysPos++;
                                    standardOperationsDictionaryWaysList.Add(standardOperationsDictionaryWay);

                                }

                            }
                        }

                    }
                }
                #region insertProductTypes
                #endregion
                if (standardOperationsDictionaryWayDeleteList.Count() > 0)
                {
                    foreach (var eRMSOPWayDelete in standardOperationsDictionaryWayDeleteList)
                    {
                        StandardOperationsDictionaryWays standardOperationsDictionaryWayDelete = new StandardOperationsDictionaryWays();

                        standardOperationsDictionaryWayDelete.TransactionOperation = ModelBase.TransactionOperations.Delete;
                        standardOperationsDictionaryWayDelete.IdStandardOperationsDictionary = eRMSOPWayDelete.IdStandardOperationsDictionary;
                        standardOperationsDictionaryWayDelete.IdDetection = eRMSOPWayDelete.IdDetection;
                        standardOperationsDictionaryWayDelete.IdWorkoperation = eRMSOPWayDelete.IdWorkoperation;
                        standardOperationsDictionaryWayDelete.ObservedTime = (float?)eRMSOPWayDelete.ObservedTime;
                        standardOperationsDictionaryWayDelete.Activity = (float?)eRMSOPWayDelete.Activity;
                        standardOperationsDictionaryWaysList.Add(standardOperationsDictionaryWayDelete);
                    }
                }
                standardOperationsDictionaryWaysList.ForEach(w => w.CreatedBy = Convert.ToInt32(GeosApplication.Instance.ActiveUser.IdUser));
                standardOperationsDictionaryWaysList.ForEach(w => w.ModifiedBy = Convert.ToInt32(GeosApplication.Instance.ActiveUser.IdUser));
                #endregion

                #region [GEOS2-3601] Structure

                #region [GEOS2-3926][Rupali Sarode][25-11-2022]
                // Copy data from tmp to StructureMenulist
                if (TmpStructureMenulist != null)
                {
                    if (TmpStructureMenulist.Count > 0)
                    {
                        // [GEOS2-4108][Rupali Sarode] copy ModuleMenulist 
                        TmpStructureMenulistOriginal = new ObservableCollection<ERMSOPStructures>();
                        TmpStructureMenulistOriginal.AddRange(StructureMenulist);

                        StructureMenulist = new ObservableCollection<ERMSOPStructures>();
                        StructureMenulist.AddRange(TmpStructureMenulist);
                    }
                }


                #endregion



                List<StandardOperationsDictionaryStructures> standardOperationsDictionaryStructuresList = new List<StandardOperationsDictionaryStructures>();
                if (SelectedItemStructures is ERMStructures)
                {

                    ERMStructures ermStructures = (ERMStructures)SelectedItemStructures;

                    if (StructureMenulist != null && StructureMenulist.Count > 0)
                    {
                        //Aishwarya Ingale[Geos2-5629]
                        //StructureMenulist = new ObservableCollection<ERMSOPStructures>(StructureMenulist.GroupBy(i => i.IdParent)
                        //        .SelectMany(group => group.Select((item, index) =>
                        //        {
                        //            item.StructurePosition = (uint)(index + 1); return item;
                        //        })).ToList());


                        UInt32 StructuresPosition = 1;
                        foreach (ERMSOPStructures eRMSOPStructures in StructureMenulist)
                        {
                            string TempKeyName = eRMSOPStructures.KeyName;
                            #region [gulab lakade][beta changes][02 08 2024]
                            if (TempKeyName.Contains("Group_"))
                            {
                                eRMSOPStructures.StructurePosition = StructuresPosition;
                                StructuresPosition++;
                                //var TempRecord = StructureMenulist.Where(x => x.ParentName == eRMSOPStructures.KeyName && x.ParentName != null).ToList();
                                //if (TempRecord.Count() > 0)
                                //{
                                //    foreach (var item in TempRecord.OrderBy(a => a.StructurePosition).ToList())
                                //    {
                                //        //start[GEOS2-5629][gulab lakade][16 07 2024]
                                //        int TempCount = 0;
                                //        TempCount = StructureMenulist.Where(c => c.ParentName == item.KeyName).ToList().Count();
                                //        if (TempCount == 0)
                                //        {
                                //            item.StructurePosition = StructuresPosition;
                                //            StructuresPosition++;
                                //        }
                                //        //end[GEOS2-5629][gulab lakade][16 07 2024]

                                //    }

                                //}
                                //else
                                //{
                                //    eRMSOPStructures.StructurePosition = StructuresPosition;
                                //    StructuresPosition++;
                                //}
                            }
                            #endregion
                            List<ERMSOPStructures> TmpstrutureListchild = StructureMenulist.Where(a => a.ParentName == eRMSOPStructures.KeyName).OrderBy(a => a.StructurePosition).ToList();
                            if (TmpstrutureListchild.Count() > 0)
                            {
                                StructuresPosition = TempCalculatestruture(StructuresPosition, TmpstrutureListchild);
                            }
                        }


                        int StructurePos = 1;//[Geos2-5629][Aishwarya Ingale][26 06 2024]

                        foreach (ERMSOPStructures eRMSOPStructure in StructureMenulist.Where(a => a.StructurePosition != null).OrderBy(x => x.StructurePosition))//[GEOS2-5629][gulab lakade][10 07 2024])
                        {
                            StandardOperationsDictionaryStructures standardOperationsDictionaryStructures = new StandardOperationsDictionaryStructures();
                            WorkOperationByStages workOperationByStages = WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(eRMSOPStructure.KeyName)).FirstOrDefault();
                            StandardOperationsDictionaryStructures ISERMSOPModuleValueUpdated = tempLstStandardOperationsDictionaryStructures.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPStructure.IdworkOperationByStage) && w.IdCpTypeNew == eRMSOPStructure.IdCpType).FirstOrDefault();
                            if (workOperationByStages != null)
                            {
                                if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(workOperationByStages.Name.Trim())))
                                {

                                }
                                else
                                {
                                    if (ISERMSOPModuleValueUpdated == null)
                                    {
                                        standardOperationsDictionaryStructures.TransactionOperation = ModelBase.TransactionOperations.Add;
                                        standardOperationsDictionaryStructures.IdStandardOperationsDictionary = IdStandardOperationsDictionary;
                                        if (TmpStructureMenulist == null)
                                            standardOperationsDictionaryStructures.IdCpTypeNew = (long)(ermStructures.IdCPType);
                                        else
                                        {
                                            if (TmpStructureMenulist.Count == 0)
                                                standardOperationsDictionaryStructures.IdCpTypeNew = (long)(ermStructures.IdCPType);
                                            else
                                                standardOperationsDictionaryStructures.IdCpTypeNew = (long)(eRMSOPStructure.IdCpType);
                                        }

                                        standardOperationsDictionaryStructures.IdWorkoperation = Convert.ToUInt64(eRMSOPStructure.IdworkOperationByStage);
                                        #region Geos2 4079 Structure Store/ Save in the SDO tables the Observed time, Activity
                                        var tempListData = WorkOperationMenulist.Where(w => w.IdworkOperationByStage.Equals(eRMSOPStructure.IdworkOperationByStage) && w.KeyName == eRMSOPStructure.KeyName).FirstOrDefault(); //[Cut  work operation not work properly.][gulab lakade][24 01 2023]
                                        if (tempListData != null)
                                        {
                                            if (tempListData.ObservedTime == (float?)eRMSOPStructure.StructureObservedTime)
                                            {
                                                standardOperationsDictionaryStructures.ObservedTime = null;

                                            }
                                            else
                                            {
                                                standardOperationsDictionaryStructures.ObservedTime = (float?)eRMSOPStructure.StructureObservedTime;
                                            }
                                            if (tempListData.Activity == eRMSOPStructure.StructureActivity)
                                            {
                                                standardOperationsDictionaryStructures.Activity = null;

                                            }
                                            else
                                            {
                                                standardOperationsDictionaryStructures.Activity = (float?)eRMSOPStructure.StructureActivity;
                                            }
                                            //standardOperationsDictionaryStructures.ObservedTime = (float?)eRMSOPStructure.StructureObservedTime;
                                            //standardOperationsDictionaryStructures.Activity = (float?)eRMSOPStructure.StructureActivity;
                                        }


                                        #endregion

                                        //[GEOS2-3933][Rupali Sarode][22/09/2022]
                                        standardOperationsDictionaryStructures.Remarks = eRMSOPStructure.Remarks == null ? "" : eRMSOPStructure.Remarks.Trim();

                                        //[Geos2-5629][Aishwarya Ingale][26 06 2024]
                                        if (eRMSOPStructure.StructurePosition != null && StructurePos == eRMSOPStructure.StructurePosition)
                                        {
                                            standardOperationsDictionaryStructures.Position = (uint?)eRMSOPStructure.StructurePosition;
                                        }
                                        else
                                        {
                                            standardOperationsDictionaryStructures.Position = (uint?)StructurePos;
                                        }
                                        StructurePos++;

                                        standardOperationsDictionaryStructuresList.Add(standardOperationsDictionaryStructures);
                                    }
                                    else if (ISERMSOPModuleValueUpdated.Activity != eRMSOPStructure.StructureActivity || ISERMSOPModuleValueUpdated.ObservedTime != eRMSOPStructure.StructureObservedTime)
                                    {
                                        standardOperationsDictionaryStructures.TransactionOperation = ModelBase.TransactionOperations.Add;
                                        standardOperationsDictionaryStructures.IdStandardOperationsDictionary = IdStandardOperationsDictionary;
                                        //standardOperationsDictionaryStructures.IdCpType = (byte)(ermStructures.IdCPType);
                                        if (TmpStructureMenulist == null)
                                            standardOperationsDictionaryStructures.IdCpTypeNew = (long)(ermStructures.IdCPType);
                                        else
                                        {
                                            if (TmpStructureMenulist.Count == 0)
                                                standardOperationsDictionaryStructures.IdCpTypeNew = (long)(ermStructures.IdCPType);
                                            else
                                                standardOperationsDictionaryStructures.IdCpTypeNew = (long)(eRMSOPStructure.IdCpType);
                                        }
                                        standardOperationsDictionaryStructures.IdWorkoperation = Convert.ToUInt64(eRMSOPStructure.IdworkOperationByStage);
                                        #region Geos2 4079 Structure Store/ Save in the SDO tables the Observed time, Activity
                                        var tempListData = WorkOperationMenulist.Where(w => w.IdworkOperationByStage.Equals(eRMSOPStructure.IdworkOperationByStage) && w.KeyName == eRMSOPStructure.KeyName).FirstOrDefault(); //[Cut  work operation not work properly.][gulab lakade][24 01 2023]
                                        if (tempListData != null)
                                        {
                                            if (tempListData.ObservedTime == (float?)eRMSOPStructure.StructureObservedTime)
                                            {
                                                standardOperationsDictionaryStructures.ObservedTime = null;

                                            }
                                            else
                                            {
                                                standardOperationsDictionaryStructures.ObservedTime = (float?)eRMSOPStructure.StructureObservedTime;
                                            }
                                            if (tempListData.Activity == eRMSOPStructure.StructureActivity)
                                            {
                                                standardOperationsDictionaryStructures.Activity = null;

                                            }
                                            else
                                            {
                                                standardOperationsDictionaryStructures.Activity = (float?)eRMSOPStructure.StructureActivity;
                                            }
                                            //standardOperationsDictionaryStructures.ObservedTime = (float?)eRMSOPStructure.StructureObservedTime;
                                            //standardOperationsDictionaryStructures.Activity = (float?)eRMSOPStructure.StructureActivity;
                                        }


                                        #endregion

                                        //[GEOS2-3933][Rupali Sarode][22/09/2022]
                                        standardOperationsDictionaryStructures.Remarks = eRMSOPStructure.Remarks == null ? "" : eRMSOPStructure.Remarks.Trim();

                                        //[Geos2-5629][Aishwarya Ingale][26 06 2024]
                                        if (eRMSOPStructure.StructurePosition != null && StructurePos == eRMSOPStructure.StructurePosition)
                                        {
                                            standardOperationsDictionaryStructures.Position = (uint?)eRMSOPStructure.StructurePosition;
                                        }
                                        else
                                        {
                                            standardOperationsDictionaryStructures.Position = (uint?)StructurePos;
                                        }
                                        StructurePos++;

                                        standardOperationsDictionaryStructuresList.Add(standardOperationsDictionaryStructures);
                                    }

                                }
                            }
                            else
                            {
                                if (ISERMSOPModuleValueUpdated == null)
                                {
                                    standardOperationsDictionaryStructures.TransactionOperation = ModelBase.TransactionOperations.Add;
                                    standardOperationsDictionaryStructures.IdStandardOperationsDictionary = IdStandardOperationsDictionary;
                                    //standardOperationsDictionaryStructures.IdCpType = (byte)(ermStructures.IdCPType);
                                    if (TmpStructureMenulist == null)
                                        standardOperationsDictionaryStructures.IdCpTypeNew = (long)(ermStructures.IdCPType);
                                    else
                                    {
                                        if (TmpStructureMenulist.Count == 0)
                                            standardOperationsDictionaryStructures.IdCpTypeNew = (long)(ermStructures.IdCPType);
                                        else
                                            standardOperationsDictionaryStructures.IdCpTypeNew = (long)(eRMSOPStructure.IdCpType);
                                    }
                                    standardOperationsDictionaryStructures.IdWorkoperation = Convert.ToUInt64(eRMSOPStructure.IdworkOperationByStage);
                                    #region Geos2 4079 Structure Store/ Save in the SDO tables the Observed time, Activity
                                    var tempListData = WorkOperationMenulist.Where(w => w.IdworkOperationByStage.Equals(eRMSOPStructure.IdworkOperationByStage) && w.KeyName == eRMSOPStructure.KeyName).FirstOrDefault(); //[Cut  work operation not work properly.][gulab lakade][24 01 2023]
                                    if (tempListData != null)
                                    {
                                        if (tempListData.ObservedTime == (float?)eRMSOPStructure.StructureObservedTime)
                                        {
                                            standardOperationsDictionaryStructures.ObservedTime = null;

                                        }
                                        else
                                        {
                                            standardOperationsDictionaryStructures.ObservedTime = (float?)eRMSOPStructure.StructureObservedTime;
                                        }
                                        if (tempListData.Activity == eRMSOPStructure.StructureActivity)
                                        {
                                            standardOperationsDictionaryStructures.Activity = null;

                                        }
                                        else
                                        {
                                            standardOperationsDictionaryStructures.Activity = (float?)eRMSOPStructure.StructureActivity;
                                        }
                                        //standardOperationsDictionaryStructures.ObservedTime = (float?)eRMSOPStructure.StructureObservedTime;
                                        //standardOperationsDictionaryStructures.Activity = (float?)eRMSOPStructure.StructureActivity;
                                    }
                                    #endregion

                                    //[GEOS2-3933][Rupali Sarode][22/09/2022]
                                    standardOperationsDictionaryStructures.Remarks = eRMSOPStructure.Remarks == null ? "" : eRMSOPStructure.Remarks.Trim();

                                    //[Geos2-5629][Aishwarya Ingale][26 06 2024]
                                    if (eRMSOPStructure.StructurePosition != null && StructurePos == eRMSOPStructure.StructurePosition)
                                    {
                                        standardOperationsDictionaryStructures.Position = (uint?)eRMSOPStructure.StructurePosition;
                                    }
                                    else
                                    {
                                        standardOperationsDictionaryStructures.Position = (uint?)StructurePos;
                                    }
                                    StructurePos++;

                                    standardOperationsDictionaryStructuresList.Add(standardOperationsDictionaryStructures);
                                }
                                //[GEOS2-3933][Rupali Sarode][26/09/2022]
                                //else if (ISERMSOPModuleValueUpdated.Activity != eRMSOPModule.DetectionActivity ||
                                //    // ISERMSOPModuleValueUpdated.ObservedTime != eRMSOPModule.DetectionObservedTime
                                //    Math.Round(Convert.ToDouble(ISERMSOPModuleValueUpdated.ObservedTime), 2) != Math.Round(Convert.ToDouble(eRMSOPModule.DetectionObservedTime), 2)
                                //    )
                                else if (ISERMSOPModuleValueUpdated.Activity != eRMSOPStructure.StructureActivity ||
                                       Math.Round(Convert.ToDouble(ISERMSOPModuleValueUpdated.ObservedTime), 2) != Math.Round(Convert.ToDouble(eRMSOPStructure.StructureObservedTime), 2) ||
                                       ISERMSOPModuleValueUpdated.Remarks != eRMSOPStructure.Remarks)
                                {
                                    standardOperationsDictionaryStructures.TransactionOperation = ModelBase.TransactionOperations.Add;
                                    standardOperationsDictionaryStructures.IdStandardOperationsDictionary = IdStandardOperationsDictionary;
                                    //standardOperationsDictionaryStructures.IdCpType = (byte)(ermStructures.IdCPType);
                                    if (TmpStructureMenulist == null)
                                        standardOperationsDictionaryStructures.IdCpTypeNew = (long)(ermStructures.IdCPType);
                                    else
                                    {
                                        if (TmpStructureMenulist.Count == 0)
                                            standardOperationsDictionaryStructures.IdCpTypeNew = (long)(ermStructures.IdCPType);
                                        else
                                            standardOperationsDictionaryStructures.IdCpTypeNew = (long)(eRMSOPStructure.IdCpType);
                                    }
                                    standardOperationsDictionaryStructures.IdWorkoperation = Convert.ToUInt64(eRMSOPStructure.IdworkOperationByStage);
                                    #region Geos2 4079 Structure Store/ Save in the SDO tables the Observed time, Activity
                                    var tempListData = WorkOperationMenulist.Where(w => w.IdworkOperationByStage.Equals(eRMSOPStructure.IdworkOperationByStage) && w.KeyName == eRMSOPStructure.KeyName).FirstOrDefault(); //[Cut  work operation not work properly.][gulab lakade][24 01 2023]
                                    if (tempListData != null)
                                    {
                                        if (tempListData.ObservedTime == (float?)eRMSOPStructure.StructureObservedTime)
                                        {
                                            standardOperationsDictionaryStructures.ObservedTime = null;

                                        }
                                        else
                                        {
                                            standardOperationsDictionaryStructures.ObservedTime = (float?)eRMSOPStructure.StructureObservedTime;
                                        }
                                        if (tempListData.Activity == eRMSOPStructure.StructureActivity)
                                        {
                                            standardOperationsDictionaryStructures.Activity = null;

                                        }
                                        else
                                        {
                                            standardOperationsDictionaryStructures.Activity = (float?)eRMSOPStructure.StructureActivity;
                                        }
                                        //standardOperationsDictionaryStructures.ObservedTime = (float?)eRMSOPStructure.StructureObservedTime;
                                        //standardOperationsDictionaryStructures.Activity = (float?)eRMSOPStructure.StructureActivity;
                                    }


                                    #endregion

                                    //[GEOS2-3933][Rupali Sarode][22/09/2022]
                                    standardOperationsDictionaryStructures.Remarks = eRMSOPStructure.Remarks == null ? "" : eRMSOPStructure.Remarks.Trim();

                                    //[Geos2-5629][Aishwarya Ingale][26 06 2024]
                                    if (eRMSOPStructure.StructurePosition != null && StructurePos == eRMSOPStructure.StructurePosition)
                                    {
                                        standardOperationsDictionaryStructures.Position = (uint?)eRMSOPStructure.StructurePosition;
                                    }
                                    else
                                    {
                                        standardOperationsDictionaryStructures.Position = (uint?)StructurePos;
                                    }
                                    StructurePos++;

                                    standardOperationsDictionaryStructuresList.Add(standardOperationsDictionaryStructures);

                                }

                            }
                        }

                    }
                }
                #region insertProductTypes
                #endregion
                if (standardOperationsDictionaryStructureDeleteList.Count() > 0)
                {
                    foreach (var eRMSOPStructureDelete in standardOperationsDictionaryStructureDeleteList)
                    {
                        StandardOperationsDictionaryStructures standardOperationsDictionaryStructureDelete = new StandardOperationsDictionaryStructures();

                        standardOperationsDictionaryStructureDelete.TransactionOperation = ModelBase.TransactionOperations.Delete;
                        standardOperationsDictionaryStructureDelete.IdStandardOperationsDictionary = eRMSOPStructureDelete.IdStandardOperationsDictionary;
                        standardOperationsDictionaryStructureDelete.IdCpTypeNew = eRMSOPStructureDelete.IdCpTypeNew;
                        standardOperationsDictionaryStructureDelete.IdWorkoperation = eRMSOPStructureDelete.IdWorkoperation;
                        standardOperationsDictionaryStructureDelete.ObservedTime = (float?)eRMSOPStructureDelete.ObservedTime;
                        standardOperationsDictionaryStructureDelete.Activity = (float?)eRMSOPStructureDelete.Activity;
                        standardOperationsDictionaryStructuresList.Add(standardOperationsDictionaryStructureDelete);
                    }
                }
                standardOperationsDictionaryStructuresList.ForEach(w => w.CreatedBy = Convert.ToInt32(GeosApplication.Instance.ActiveUser.IdUser));
                standardOperationsDictionaryStructuresList.ForEach(w => w.ModifiedBy = Convert.ToInt32(GeosApplication.Instance.ActiveUser.IdUser));
                #endregion

                #region GEOS2-4033 Spare Part Gulab Lakade

                #region [GEOS2-3925][Rupali Sarode][29-11-2022]
                // Copy data from tmp to SparePartsMenulist
                if (TmpSparePartsMenulist != null)
                {
                    if (TmpSparePartsMenulist.Count > 0)
                    {
                        // [GEOS2-4108][Rupali Sarode] copy ModuleMenulist 
                        TmpSparePartsMenulistOriginal = new ObservableCollection<ERMSOPSpareParts>();
                        TmpSparePartsMenulistOriginal.AddRange(SparePartsMenulist);

                        SparePartsMenulist = new ObservableCollection<ERMSOPSpareParts>();
                        SparePartsMenulist.AddRange(TmpSparePartsMenulist);
                    }
                }


                #endregion

                List<StandardOperationsDictionarySparePart> standardOperationsDictionarySparePartsList = new List<StandardOperationsDictionarySparePart>();
                if (SelectedItemSparePart is ERMSpareParts)
                {
                    ERMSpareParts ermSpareParts = (ERMSpareParts)SelectedItemSparePart;
                    if (SparePartsMenulist != null && SparePartsMenulist.Count > 0)
                    {
                        //Aishwarya Ingale[Geos2-5629]
                        //SparePartsMenulist = new ObservableCollection<ERMSOPSpareParts>(SparePartsMenulist.GroupBy(i => i.IdParent)
                        //        .SelectMany(group => group.Select((item, index) =>
                        //        {
                        //            item.SparepartPosition = (uint)(index + 1); return item;
                        //        })).ToList());


                        UInt32 SparePartsPosition = 1;
                        foreach (ERMSOPSpareParts eRMSOPSpareParts in SparePartsMenulist)
                        {
                            string TempKeyName = eRMSOPSpareParts.KeyName;
                            #region [gulab lakade][beta changes][02 082024]
                            if (TempKeyName.Contains("Group_"))
                            {

                                var TempRecord = SparePartsMenulist.Where(x => x.ParentName == eRMSOPSpareParts.KeyName && x.ParentName != null).ToList();
                            if (TempRecord.Count() > 0)
                            {
                                foreach (var item in TempRecord.OrderBy(a => a.SparepartPosition).ToList())
                                {
                                    //start[GEOS2-5629][gulab lakade][16 07 2024]
                                    int TempCount = 0;
                                    TempCount = SparePartsMenulist.Where(c => c.ParentName == item.KeyName).ToList().Count();
                                    if (TempCount == 0)
                                    {
                                        item.SparepartPosition = SparePartsPosition;
                                        SparePartsPosition++;
                                    }
                                    //end[GEOS2-5629][gulab lakade][16 07 2024]

                                }

                            }
                            else
                            {
                                    eRMSOPSpareParts.SparepartPosition = SparePartsPosition;
                                    SparePartsPosition++;

                                }
                        }
                            #endregion
                            List<ERMSOPSpareParts> TmpsparepartListchild = SparePartsMenulist.Where(a => a.ParentName == eRMSOPSpareParts.KeyName).OrderBy(a => a.SparepartPosition).ToList();
                            if (TmpsparepartListchild.Count() > 0)
                            {
                                SparePartsPosition = TempCalculatesparepart(SparePartsPosition, TmpsparepartListchild);
                            }
                        }


                    int SparePartsPos = 1;//[Geos2-5629][Aishwarya Ingale][26 06 2024]

                        //foreach (ERMSOPSpareParts eRMSOPModule in SparePartsMenulist)
                        foreach (ERMSOPSpareParts eRMSOPSparePart in SparePartsMenulist.Where(a => a.SparepartPosition != null).OrderBy(x => x.SparepartPosition))//[GEOS2-5629][gulab lakade][10 07 2024])
                        {
                            StandardOperationsDictionarySparePart standardOperationsDictionarySparePart = new StandardOperationsDictionarySparePart();
                            WorkOperationByStages workOperationByStages = WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(eRMSOPSparePart.KeyName)).FirstOrDefault();
                            //StandardOperationsDictionarySparePart ISERMSOPModuleValueUpdated = tempLstStandardOperationsDictionaryDetection.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage) && w.IdDetection == eRMSOPModule.IdDetection).FirstOrDefault();
                            StandardOperationsDictionarySparePart ISERMSOPSparePartValueUpdated = tempLstStandardOperationsDictionarySparePart.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPSparePart.IdworkOperationByStage) && w.IdDetection == eRMSOPSparePart.IdDetection).FirstOrDefault();
                            if (workOperationByStages != null)
                            {
                                if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(workOperationByStages.Name.Trim())))
                                {

                                }
                                else
                                {
                                    if (ISERMSOPSparePartValueUpdated == null)
                                    {
                                        standardOperationsDictionarySparePart.TransactionOperation = ModelBase.TransactionOperations.Add;
                                        standardOperationsDictionarySparePart.IdStandardOperationsDictionary = IdStandardOperationsDictionary;
                                        //standardOperationsDictionarySparePart.IdDetection = (ulong)(ermSpareParts.IdDetection);
                                        if (TmpSparePartsMenulist == null)
                                            standardOperationsDictionarySparePart.IdDetection = (ulong)(ermSpareParts.IdDetection);
                                        else
                                        {
                                            if (TmpSparePartsMenulist.Count == 0)
                                                standardOperationsDictionarySparePart.IdDetection = (ulong)(ermSpareParts.IdDetection);
                                            else
                                                standardOperationsDictionarySparePart.IdDetection = (ulong)(eRMSOPSparePart.IdDetection);
                                        }

                                        standardOperationsDictionarySparePart.IdWorkoperation = Convert.ToUInt64(eRMSOPSparePart.IdworkOperationByStage);
                                        #region Geos2 4078 SpareParts Store/ Save in the SDO tables the Observed time, Activity
                                        var tempListData = WorkOperationMenulist.Where(w => w.IdworkOperationByStage.Equals(eRMSOPSparePart.IdworkOperationByStage) && w.KeyName == eRMSOPSparePart.KeyName).FirstOrDefault(); //[Cut  work operation not work properly.][gulab lakade][24 01 2023]
                                        if (tempListData != null)
                                        {
                                            if (tempListData.ObservedTime == (float?)eRMSOPSparePart.SparePartObservedTime)
                                            {
                                                standardOperationsDictionarySparePart.ObservedTime = null;

                                            }
                                            else
                                            {
                                                standardOperationsDictionarySparePart.ObservedTime = (float?)eRMSOPSparePart.SparePartObservedTime;
                                            }
                                            if (tempListData.Activity == (float?)eRMSOPSparePart.SparePartActivity)
                                            {
                                                standardOperationsDictionarySparePart.Activity = null;

                                            }
                                            else
                                            {
                                                standardOperationsDictionarySparePart.Activity = (float?)eRMSOPSparePart.SparePartActivity;
                                            }
                                            //standardOperationsDictionarySparePart.ObservedTime = (float?)eRMSOPSparePart.SparePartObservedTime;
                                            //standardOperationsDictionarySparePart.Activity = (float?)eRMSOPSparePart.SparePartActivity;
                                        }
                                        #endregion


                                        //[GEOS2-3933][Rupali Sarode][22/09/2022]
                                        standardOperationsDictionarySparePart.Remarks = eRMSOPSparePart.Remarks == null ? "" : eRMSOPSparePart.Remarks.Trim();

                                        //[Geos2-5629][Aishwarya Ingale][26 06 2024]
                                        if (eRMSOPSparePart.SparepartPosition != null && SparePartsPos == eRMSOPSparePart.SparepartPosition)
                                        {
                                            standardOperationsDictionarySparePart.Position = (uint?)eRMSOPSparePart.SparepartPosition;
                                        }
                                        else
                                        {
                                            standardOperationsDictionarySparePart.Position = (uint?)SparePartsPos;
                                        }
                                        SparePartsPos++;

                                        standardOperationsDictionarySparePartsList.Add(standardOperationsDictionarySparePart);
                                    }
                                    else if (ISERMSOPSparePartValueUpdated.Activity != eRMSOPSparePart.SparePartActivity || ISERMSOPSparePartValueUpdated.ObservedTime != eRMSOPSparePart.SparePartObservedTime)
                                    {
                                        standardOperationsDictionarySparePart.TransactionOperation = ModelBase.TransactionOperations.Add;
                                        standardOperationsDictionarySparePart.IdStandardOperationsDictionary = IdStandardOperationsDictionary;
                                        //standardOperationsDictionarySparePart.IdDetection = (ulong)(ermSpareParts.IdDetection);
                                        if (TmpSparePartsMenulist == null)
                                            standardOperationsDictionarySparePart.IdDetection = (ulong)(ermSpareParts.IdDetection);
                                        else
                                        {
                                            if (TmpSparePartsMenulist.Count == 0)
                                                standardOperationsDictionarySparePart.IdDetection = (ulong)(ermSpareParts.IdDetection);
                                            else
                                                standardOperationsDictionarySparePart.IdDetection = (ulong)(eRMSOPSparePart.IdDetection);
                                        }
                                        standardOperationsDictionarySparePart.IdWorkoperation = Convert.ToUInt64(eRMSOPSparePart.IdworkOperationByStage);
                                        #region Geos2 4078 SpareParts Store/ Save in the SDO tables the Observed time, Activity
                                        var tempListData = WorkOperationMenulist.Where(w => w.IdworkOperationByStage.Equals(eRMSOPSparePart.IdworkOperationByStage) && w.KeyName == eRMSOPSparePart.KeyName).FirstOrDefault(); //[Cut  work operation not work properly.][gulab lakade][24 01 2023]
                                        if (tempListData != null)
                                        {
                                            if (tempListData.ObservedTime == (float?)eRMSOPSparePart.SparePartObservedTime)
                                            {
                                                standardOperationsDictionarySparePart.ObservedTime = null;

                                            }
                                            else
                                            {
                                                standardOperationsDictionarySparePart.ObservedTime = (float?)eRMSOPSparePart.SparePartObservedTime;
                                            }
                                            if (tempListData.Activity == (float?)eRMSOPSparePart.SparePartActivity)
                                            {
                                                standardOperationsDictionarySparePart.Activity = null;

                                            }
                                            else
                                            {
                                                standardOperationsDictionarySparePart.Activity = (float?)eRMSOPSparePart.SparePartActivity;
                                            }
                                            //standardOperationsDictionarySparePart.ObservedTime = (float?)eRMSOPSparePart.SparePartObservedTime;
                                            //standardOperationsDictionarySparePart.Activity = (float?)eRMSOPSparePart.SparePartActivity;
                                        }
                                        #endregion
                                        //[GEOS2-3933][Rupali Sarode][22/09/2022]
                                        standardOperationsDictionarySparePart.Remarks = eRMSOPSparePart.Remarks == null ? "" : eRMSOPSparePart.Remarks.Trim();
                                        //[Geos2-5629][Aishwarya Ingale][26 06 2024]
                                        if (eRMSOPSparePart.SparepartPosition != null && SparePartsPos == eRMSOPSparePart.SparepartPosition)
                                        {
                                            standardOperationsDictionarySparePart.Position = (uint?)eRMSOPSparePart.SparepartPosition;
                                        }
                                        else
                                        {
                                            standardOperationsDictionarySparePart.Position = (uint?)SparePartsPos;
                                        }
                                        SparePartsPos++;

                                        standardOperationsDictionarySparePartsList.Add(standardOperationsDictionarySparePart);
                                    }

                                }
                            }
                            else
                            {
                                if (ISERMSOPSparePartValueUpdated == null)
                                {
                                    standardOperationsDictionarySparePart.TransactionOperation = ModelBase.TransactionOperations.Add;
                                    standardOperationsDictionarySparePart.IdStandardOperationsDictionary = IdStandardOperationsDictionary;
                                    //  standardOperationsDictionarySparePart.IdDetection = (UInt64)(ermSpareParts.IdDetection);
                                    if (TmpSparePartsMenulist == null)
                                        standardOperationsDictionarySparePart.IdDetection = (ulong)(ermSpareParts.IdDetection);
                                    else
                                    {
                                        if (TmpSparePartsMenulist.Count == 0)
                                            standardOperationsDictionarySparePart.IdDetection = (ulong)(ermSpareParts.IdDetection);
                                        else
                                            standardOperationsDictionarySparePart.IdDetection = (ulong)(eRMSOPSparePart.IdDetection);
                                    }
                                    standardOperationsDictionarySparePart.IdWorkoperation = Convert.ToUInt64(eRMSOPSparePart.IdworkOperationByStage);
                                    #region Geos2 4078 SpareParts Store/ Save in the SDO tables the Observed time, Activity
                                    var tempListData = WorkOperationMenulist.Where(w => w.IdworkOperationByStage.Equals(eRMSOPSparePart.IdworkOperationByStage) && w.KeyName == eRMSOPSparePart.KeyName).FirstOrDefault(); //[Cut  work operation not work properly.][gulab lakade][24 01 2023]
                                    if (tempListData != null)
                                    {
                                        if (tempListData.ObservedTime == (float?)eRMSOPSparePart.SparePartObservedTime)
                                        {
                                            standardOperationsDictionarySparePart.ObservedTime = null;

                                        }
                                        else
                                        {
                                            standardOperationsDictionarySparePart.ObservedTime = (float?)eRMSOPSparePart.SparePartObservedTime;
                                        }
                                        if (tempListData.Activity == (float?)eRMSOPSparePart.SparePartActivity)
                                        {
                                            standardOperationsDictionarySparePart.Activity = null;

                                        }
                                        else
                                        {
                                            standardOperationsDictionarySparePart.Activity = (float?)eRMSOPSparePart.SparePartActivity;
                                        }
                                        //standardOperationsDictionarySparePart.ObservedTime = (float?)eRMSOPSparePart.SparePartObservedTime;
                                        //standardOperationsDictionarySparePart.Activity = (float?)eRMSOPSparePart.SparePartActivity;
                                    }
                                    #endregion
                                    //[GEOS2-3933][Rupali Sarode][22/09/2022]
                                    standardOperationsDictionarySparePart.Remarks = eRMSOPSparePart.Remarks == null ? "" : eRMSOPSparePart.Remarks.Trim();
                                    //[Geos2-5629][Aishwarya Ingale][26 06 2024]
                                    if (eRMSOPSparePart.SparepartPosition != null && SparePartsPos == eRMSOPSparePart.SparepartPosition)
                                    {
                                        standardOperationsDictionarySparePart.Position = (uint?)eRMSOPSparePart.SparepartPosition;
                                    }
                                    else
                                    {
                                        standardOperationsDictionarySparePart.Position = (uint?)SparePartsPos;
                                    }
                                    SparePartsPos++;

                                    standardOperationsDictionarySparePartsList.Add(standardOperationsDictionarySparePart);
                                }
                                //[GEOS2-3933][Rupali Sarode][26/09/2022]
                                //else if (ISERMSOPSparePartValueUpdated.Activity != eRMSOPSparePart.SparePartActivity ||
                                //    // ISERMSOPModuleValueUpdated.ObservedTime != eRMSOPModule.DetectionObservedTime
                                //    Math.Round(Convert.ToDouble(ISERMSOPSparePartValueUpdated.ObservedTime), 2) != Math.Round(Convert.ToDouble(eRMSOPSparePart.SparePartObservedTime), 2)
                                //    )
                                else if (ISERMSOPSparePartValueUpdated.Activity != eRMSOPSparePart.SparePartActivity ||
                                    // ISERMSOPModuleValueUpdated.ObservedTime != eRMSOPModule.DetectionObservedTime
                                    Math.Round(Convert.ToDouble(ISERMSOPSparePartValueUpdated.ObservedTime), 2) != Math.Round(Convert.ToDouble(eRMSOPSparePart.SparePartObservedTime), 2) ||
                                    ISERMSOPSparePartValueUpdated.Remarks != eRMSOPSparePart.Remarks)
                                {
                                    standardOperationsDictionarySparePart.TransactionOperation = ModelBase.TransactionOperations.Add;
                                    standardOperationsDictionarySparePart.IdStandardOperationsDictionary = IdStandardOperationsDictionary;
                                    //  standardOperationsDictionarySparePart.IdDetection = (UInt64)(ermSpareParts.IdDetection);
                                    if (TmpSparePartsMenulist == null)
                                        standardOperationsDictionarySparePart.IdDetection = (ulong)(ermSpareParts.IdDetection);
                                    else
                                    {
                                        if (TmpSparePartsMenulist.Count == 0)
                                            standardOperationsDictionarySparePart.IdDetection = (ulong)(ermSpareParts.IdDetection);
                                        else
                                            standardOperationsDictionarySparePart.IdDetection = (ulong)(eRMSOPSparePart.IdDetection);
                                    }
                                    standardOperationsDictionarySparePart.IdWorkoperation = Convert.ToUInt64(eRMSOPSparePart.IdworkOperationByStage);
                                    #region Geos2 4078 SpareParts Store/ Save in the SDO tables the Observed time, Activity
                                    var tempListData = WorkOperationMenulist.Where(w => w.IdworkOperationByStage.Equals(eRMSOPSparePart.IdworkOperationByStage) && w.KeyName == eRMSOPSparePart.KeyName).FirstOrDefault(); //[Cut  work operation not work properly.][gulab lakade][24 01 2023]
                                    if (tempListData != null)
                                    {
                                        if (tempListData.ObservedTime == (float?)eRMSOPSparePart.SparePartObservedTime)
                                        {
                                            standardOperationsDictionarySparePart.ObservedTime = null;

                                        }
                                        else
                                        {
                                            standardOperationsDictionarySparePart.ObservedTime = (float?)eRMSOPSparePart.SparePartObservedTime;
                                        }
                                        if (tempListData.Activity == (float?)eRMSOPSparePart.SparePartActivity)
                                        {
                                            standardOperationsDictionarySparePart.Activity = null;

                                        }
                                        else
                                        {
                                            standardOperationsDictionarySparePart.Activity = (float?)eRMSOPSparePart.SparePartActivity;
                                        }
                                        //standardOperationsDictionarySparePart.ObservedTime = (float?)eRMSOPSparePart.SparePartObservedTime;
                                        //standardOperationsDictionarySparePart.Activity = (float?)eRMSOPSparePart.SparePartActivity;
                                    }
                                    #endregion
                                    //[GEOS2-3933][Rupali Sarode][22/09/2022]
                                    standardOperationsDictionarySparePart.Remarks = eRMSOPSparePart.Remarks == null ? "" : eRMSOPSparePart.Remarks.Trim();
                                    //[Geos2-5629][Aishwarya Ingale][26 06 2024]
                                    if (eRMSOPSparePart.SparepartPosition != null && SparePartsPos == eRMSOPSparePart.SparepartPosition)
                                    {
                                        standardOperationsDictionarySparePart.Position = (uint?)eRMSOPSparePart.SparepartPosition;
                                    }
                                    else
                                    {
                                        standardOperationsDictionarySparePart.Position = (uint?)SparePartsPos;
                                    }
                                    SparePartsPos++;

                                    standardOperationsDictionarySparePartsList.Add(standardOperationsDictionarySparePart);

                                }

                            }
                        }

                    }
                }
                #region insertProductTypes
                #endregion
                if (standardOperationsDictionarySparePartDeleteList.Count() > 0)
                {
                    foreach (var eRMSOPSparePartDelete in standardOperationsDictionarySparePartDeleteList)
                    {
                        StandardOperationsDictionarySparePart standardOperationsDictionarySparePartDelete = new StandardOperationsDictionarySparePart();

                        standardOperationsDictionarySparePartDelete.TransactionOperation = ModelBase.TransactionOperations.Delete;
                        standardOperationsDictionarySparePartDelete.IdStandardOperationsDictionary = eRMSOPSparePartDelete.IdStandardOperationsDictionary;
                        standardOperationsDictionarySparePartDelete.IdDetection = eRMSOPSparePartDelete.IdDetection;
                        standardOperationsDictionarySparePartDelete.IdWorkoperation = eRMSOPSparePartDelete.IdWorkoperation;
                        standardOperationsDictionarySparePartDelete.ObservedTime = (float?)eRMSOPSparePartDelete.ObservedTime;
                        standardOperationsDictionarySparePartDelete.Activity = (float?)eRMSOPSparePartDelete.Activity;
                        standardOperationsDictionarySparePartsList.Add(standardOperationsDictionarySparePartDelete);
                    }
                }
                standardOperationsDictionarySparePartsList.ForEach(w => w.CreatedBy = Convert.ToInt32(GeosApplication.Instance.ActiveUser.IdUser));
                standardOperationsDictionarySparePartsList.ForEach(w => w.ModifiedBy = Convert.ToInt32(GeosApplication.Instance.ActiveUser.IdUser));
                #endregion

                if (IsNew)
                {
                    #region New

                    NewSOD = new StandardOperationsDictionary();

                    if (IsCheckedAllLanguages == true)
                    {
                        NewSOD.Name = Name.Trim();
                        NewSOD.Name_es = Name.Trim();
                        NewSOD.Name_fr = Name.Trim();
                        NewSOD.Name_pt = Name.Trim();
                        NewSOD.Name_ro = Name.Trim();
                        NewSOD.Name_ru = Name.Trim();
                        NewSOD.Name_zh = Name.Trim();
                        NewSOD.Description = Description == null ? "" : Description.Trim();
                        NewSOD.Description_es = Description == null ? "" : Description.Trim();
                        NewSOD.Description_fr = Description == null ? "" : Description.Trim();
                        NewSOD.Description_pt = Description == null ? "" : Description.Trim();
                        NewSOD.Description_ro = Description == null ? "" : Description.Trim();
                        NewSOD.Description_ru = Description == null ? "" : Description.Trim();
                        NewSOD.Description_zh = Description == null ? "" : Description == null ? "" : Description.Trim();
                    }
                    else
                    {
                        NewSOD.Name = Name_en == null ? "" : Name_en.Trim();
                        NewSOD.Name_es = Name_es == null ? "" : Name_es.Trim();
                        NewSOD.Name_fr = Name_fr == null ? "" : Name_fr.Trim();
                        NewSOD.Name_pt = Name_pt == null ? "" : Name_pt.Trim();
                        NewSOD.Name_ro = Name_ro == null ? "" : Name_ro.Trim();
                        NewSOD.Name_ru = Name_ru == null ? "" : Name_ru.Trim();
                        NewSOD.Name_zh = Name_zh == null ? "" : Name_zh.Trim();
                        NewSOD.Description = Description_en == null ? "" : Description_en.Trim();
                        NewSOD.Description_es = Description_es == null ? "" : Description_es.Trim();
                        NewSOD.Description_fr = Description_fr == null ? "" : Description_fr.Trim();
                        NewSOD.Description_pt = Description_pt == null ? "" : Description_pt.Trim();
                        NewSOD.Description_ro = Description_ro == null ? "" : Description_ro.Trim();
                        NewSOD.Description_ru = Description_ru == null ? "" : Description_ru.Trim();
                        NewSOD.Description_zh = Description_zh == null ? "" : Description_zh.Trim();
                    }

                    NewSOD.Code = SelectedSODCode;

                    if (ExpiryDate != null)
                        NewSOD.ExpiryDate = Convert.ToDateTime(ExpiryDate);

                    if (EffectiveDate != null)
                        NewSOD.EffectiveDate = Convert.ToDateTime(EffectiveDate);

                    NewSOD.IdStatus = (uint)SelectedStatus.IdLookupValue;
                    NewSOD.Status = SelectedStatus;

                    NewSOD.PlantList = new List<Site>();

                    foreach (Site site in SelectedPlant)
                    {
                        NewSOD.PlantList.Add(site);
                    }
                    if (LstStandardOperationsDictionarySupplement == null)
                    {
                        LstStandardOperationsDictionarySupplement = new List<StandardOperationsDictionarySupplement>();
                    }
                    List<UInt32> idSites = NewSOD.PlantList.Select(i => i.IdSite).ToList();
                    if (LstStandardOperationsDictionarySupplement != null && LstStandardOperationsDictionarySupplement.Any(i => !idSites.Contains(Convert.ToUInt32(i.IdPlant))))
                        LstStandardOperationsDictionarySupplement.Where(i => !idSites.Contains(Convert.ToUInt32(i.IdPlant))).ToList().ForEach(i => i.TransactionOperation = ModelBase.TransactionOperations.Delete);

                    NewSOD.Plants = string.Join("\n", NewSOD.PlantList.Select(x => x.Name).ToList<string>().ToArray());

                    NewSOD.CreationDate = DateTime.Now;
                    NewSOD.IdCreator = (uint)GeosApplication.Instance.ActiveUser.IdUser;
                    NewSOD.LstStandardOperationsDictionarySupplement = LstStandardOperationsDictionarySupplement.Where(i => i.TransactionOperation == ModelBase.TransactionOperations.Add).ToList();
                    //[001]
                    NewSOD.LstStandardOperationsDictionaryModules = standardOperationsDictionaryModulesList;
                    NewSOD.LstStandardOperationsDictionaryDetection = standardOperationsDictionaryDetectionsList;
                    // //GEOS2-3837 Insert Option
                    NewSOD.LstStandardOperationsDictionaryOption = standardOperationsDictionaryOptionsList;
                    // //GEOS2-3838 Insert Way
                    NewSOD.LstStandardOperationsDictionaryWay = standardOperationsDictionaryWaysList;
                    //[GEOS2-3601] [Rupali Sarode] Insert Structure
                    NewSOD.LstStandardOperationsDictionaryStructure = standardOperationsDictionaryStructuresList;

                    //GEOS2-4033 Spare Part Gulab Lakade
                    NewSOD.LstStandardOperationsDictionarySparePart = standardOperationsDictionarySparePartsList;

                    #region GEOS2-3855 gulab lakade
                    AddChangedStandardOperationsDictionaryLogDetails("New");
                    NewSOD.LstStandardOperationsDictionaryChangeLogList = StandardOperationsDictionaryChangeLogList.ToList();
                    #endregion
                    // NewSOD = ERMService.AddStandardOperationsDictionary_V2290(NewSOD);

                    //[GEOS2-3933][Rupali Sarode][22/09/2022]
                    //NewSOD = ERMService.AddStandardOperationsDictionary_V2301(NewSOD);
                    // NewSOD = ERMService.AddStandardOperationsDictionary_V2320(NewSOD);
                    //GEOS2-4033 Spare Part Gulab Lakade                    
                    //NewSOD = ERMService.AddStandardOperationsDictionary_V2340(NewSOD);

                    //IERMService ERMService = new ERMServiceController("localhost:6699");
                    //Aishwarya Ingale [Geos2-5629][19/06/2024]
                    NewSOD = ERMService.AddStandardOperationsDictionary_V2530(NewSOD);

                    NewSOD.LastUpdated = NewSOD.CreationDate;
                    ////RefreshModuleGrid();
                    if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }

                    CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("SODAddSuccessMessage").ToString()), Application.Current.Resources["PopUpSuccessColor"].ToString(), CustomMessageBox.MessageImagePath.Ok, MessageBoxButton.OK);
                    IsNewSODSave = true;
                    RequestClose(null, null);

                    #endregion

                }
                else
                {

                    #region Update

                    UpdatedSOD = new StandardOperationsDictionary();
                    UpdatedSOD.IdStandardOperationsDictionary = IdStandardOperationsDictionary;

                    if (IsCheckedAllLanguages == true)
                    {
                        UpdatedSOD.Name = Name.Trim();
                        UpdatedSOD.Name_es = Name.Trim();
                        UpdatedSOD.Name_fr = Name.Trim();
                        UpdatedSOD.Name_pt = Name.Trim();
                        UpdatedSOD.Name_ro = Name.Trim();
                        UpdatedSOD.Name_ru = Name.Trim();
                        UpdatedSOD.Name_zh = Name.Trim();
                        UpdatedSOD.Description = Description == null ? "" : Description.Trim();
                        UpdatedSOD.Description_es = Description == null ? "" : Description.Trim();
                        UpdatedSOD.Description_fr = Description == null ? "" : Description.Trim();
                        UpdatedSOD.Description_pt = Description == null ? "" : Description.Trim();
                        UpdatedSOD.Description_ro = Description == null ? "" : Description.Trim();
                        UpdatedSOD.Description_ru = Description == null ? "" : Description.Trim();
                        UpdatedSOD.Description_zh = Description == null ? "" : Description == null ? "" : Description.Trim();
                    }
                    else
                    {
                        UpdatedSOD.Name = Name_en == null ? "" : Name_en.Trim();
                        UpdatedSOD.Name_es = Name_es == null ? "" : Name_es.Trim();
                        UpdatedSOD.Name_fr = Name_fr == null ? "" : Name_fr.Trim();
                        UpdatedSOD.Name_pt = Name_pt == null ? "" : Name_pt.Trim();
                        UpdatedSOD.Name_ro = Name_ro == null ? "" : Name_ro.Trim();
                        UpdatedSOD.Name_ru = Name_ru == null ? "" : Name_ru.Trim();
                        UpdatedSOD.Name_zh = Name_zh == null ? "" : Name_zh.Trim();
                        UpdatedSOD.Description = Description_en == null ? "" : Description_en.Trim();
                        UpdatedSOD.Description_es = Description_es == null ? "" : Description_es.Trim();
                        UpdatedSOD.Description_fr = Description_fr == null ? "" : Description_fr.Trim();
                        UpdatedSOD.Description_pt = Description_pt == null ? "" : Description_pt.Trim();
                        UpdatedSOD.Description_ro = Description_ro == null ? "" : Description_ro.Trim();
                        UpdatedSOD.Description_ru = Description_ru == null ? "" : Description_ru.Trim();
                        UpdatedSOD.Description_zh = Description_zh == null ? "" : Description_zh.Trim();
                    }

                    UpdatedSOD.Code = SelectedSODCode;

                    if (ExpiryDate != null)
                        UpdatedSOD.ExpiryDate = Convert.ToDateTime(ExpiryDate);

                    if (EffectiveDate != null)
                        UpdatedSOD.EffectiveDate = Convert.ToDateTime(EffectiveDate);

                    UpdatedSOD.IdStatus = (uint)SelectedStatus.IdLookupValue;
                    UpdatedSOD.Status = SelectedStatus;

                    UpdatedSOD.PlantList = new List<Site>();

                    UpdatedSOD.ModificationDate = DateTime.Now;
                    UpdatedSOD.IdModifier = (uint)GeosApplication.Instance.ActiveUser.IdUser;

                    if (IsPlantAddedOrRemove == true)
                    {
                        //add/remove plant 
                        UpdatedSOD.PlantList = new List<Site>();
                        if (ClonedSOD.PlantList == null) ClonedSOD.PlantList = new List<Site>();
                        UpdatedSOD.PlantList_Cloned = ClonedSOD.PlantList;
                        UpdatedSOD.DeletePlantList = new List<Site>();
                        UpdatedSOD.AddPlantList = new List<Site>();

                        foreach (Site site in SelectedPlant)
                        {
                            UpdatedSOD.PlantList.Add(site);
                        }
                        foreach (Site temp in UpdatedSOD.PlantList_Cloned)
                        {
                            if (!UpdatedSOD.PlantList.Any(x => x.IdSite == temp.IdSite))
                            {
                                Site site_dlt = (Site)temp.Clone();
                                site_dlt.TransactionOperation = ModelBase.TransactionOperations.Delete;
                                UpdatedSOD.DeletePlantList.Add(site_dlt);
                            }
                        }
                        foreach (Site temp1 in UpdatedSOD.PlantList)
                        {
                            if (!UpdatedSOD.PlantList_Cloned.Any(x => x.IdSite == temp1.IdSite))
                            {
                                Site site_add = (Site)temp1.Clone();
                                site_add.TransactionOperation = ModelBase.TransactionOperations.Add;
                                UpdatedSOD.AddPlantList.Add(site_add);
                            }
                        }
                    }
                    else
                    {
                        UpdatedSOD.PlantList = ClonedSOD.PlantList;
                    }


                    UpdatedSOD.Plants = string.Join("\n", UpdatedSOD.PlantList.Select(x => x.Name).ToList<string>().ToArray());

                    List<UInt32> idSites = UpdatedSOD.PlantList.Select(i => i.IdSite).ToList();
                    foreach (var supplementitem in LstStandardOperationsDictionarySupplement)
                    {
                        if (supplementitem.PlantValue == 0)
                        {
                            supplementitem.TransactionOperation = ModelBase.TransactionOperations.Delete;

                        }

                    }
                    LstStandardOperationsDictionarySupplement.Where(i => !idSites.Contains(Convert.ToUInt32(i.IdPlant))).ToList().ForEach(i => i.TransactionOperation = ModelBase.TransactionOperations.Delete);

                    UpdatedSOD.LstStandardOperationsDictionarySupplement = LstStandardOperationsDictionarySupplement.Where(i => i.TransactionOperation != ModelBase.TransactionOperations.Modify).ToList();

                    //[001]
                    UpdatedSOD.LstStandardOperationsDictionaryModules = standardOperationsDictionaryModulesList;
                    UpdatedSOD.LstStandardOperationsDictionaryDetection = standardOperationsDictionaryDetectionsList;

                    UpdatedSOD.LstStandardOperationsDictionaryOption = standardOperationsDictionaryOptionsList;
                    ////GEOS2-38358 -Way - gulab lakade
                    UpdatedSOD.LstStandardOperationsDictionaryWay = standardOperationsDictionaryWaysList;
                    //[GEOS2-3601][Rupali Sarode]  - Structure
                    UpdatedSOD.LstStandardOperationsDictionaryStructure = standardOperationsDictionaryStructuresList;

                    //GEOS2-4033 Spare Part Gulab Lakade
                    UpdatedSOD.LstStandardOperationsDictionarySparePart = standardOperationsDictionarySparePartsList;


                    #region GEOS2-3855 gulab lakade
                    AddChangedStandardOperationsDictionaryLogDetails("Update");

                    UpdatedSOD.LstStandardOperationsDictionaryChangeLogList = StandardOperationsDictionaryChangeLogList.ToList();
                    #endregion


                    //[GEOS2-3933][Rupali Sarode][22/09/2022]
                    //  IsUpdatedSODSave = ERMService.UpdateStandardOperationsDictionary_V2301(UpdatedSOD);

                    //GEOS2 - 4033 Spare Part Gulab Lakade
                    // IsUpdatedSODSave = ERMService.UpdateStandardOperationsDictionary_V2340(UpdatedSOD);

                    // IERMService ERMService = new ERMServiceController("localhost:6699");
                    //Aishwarya Ingale [Geos2-5629][19/06/2024]
                    // ERMService = new ERMServiceController("localhost:6699");
                    //IsUpdatedSODSave = ERMService.UpdateStandardOperationsDictionary_V2530(UpdatedSOD);
                    IsUpdatedSODSave = ERMService.UpdateStandardOperationsDictionary_V2540(UpdatedSOD);
                    //IsUpdatedSODSave = ERMService.UpdateStandardOperationsDictionary_V2320(UpdatedSOD);
                    //IsUpdatedSODSave = ERMService.UpdateStandardOperationsDictionary_V2290(UpdatedSOD);
                    UpdatedSOD.LastUpdated = UpdatedSOD.ModificationDate.Value;

                    //RefreshModuleGrid();
                    // if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); } //Rupali Sarode 15Sept2022

                    //CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("SODUpdateMessage").ToString()), Application.Current.Resources["PopUpSuccessColor"].ToString(), CustomMessageBox.MessageImagePath.Ok, MessageBoxButton.OK);
                    //Rupali Sarode 15Sept2022
                    try
                    {
                        CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("SODUpdateMessage").ToString()), Application.Current.Resources["PopUpSuccessColor"].ToString(), CustomMessageBox.MessageImagePath.Ok, MessageBoxButton.OK, null);
                    }
                    catch (Exception ex)
                    {

                    }
                    #region GEOS2-3882
                    //RefreshModuleGrid();
                    RefreshModuleGridAfterSave();
                    #endregion

                    if (SaveButtonVisibility == Visibility.Visible && !isSaveButtonClicked)
                    {
                        IsUpdatedSODSave = true;
                        RequestClose(null, null);

                    }


                    #endregion

                }
                IsEnabledSaveButton = false;
                //SaveButtonVisibility = Visibility.Hidden;              
                //RefreshModuleGrid();

                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Method AcceptButtonCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log(string.Format("Error in method AcceptButtonCommandAction() - {0}", ex.Detail.ErrorMessage), category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }

                GeosApplication.Instance.Logger.Log(string.Format("Error in method AcceptButtonCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }

                GeosApplication.Instance.Logger.Log(string.Format("Error in method AcceptButtonCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void SaveButtonCommandAction()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method SaveButtonCommandAction()...", category: Category.Info, priority: Priority.Low);

                var tempselectedCurrentitem = Convert.ToString(Saveselecteditem);
                if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }
                isSaveButtonClicked = true;
                AcceptButtonCommandAction(null);
                IsEnabledSaveButton = false;
                isSaveButtonClicked = false;
                #region GEOS2-3882 Commented Code
                //if (ISSavechanges == true)
                //{
                //    try
                //    {
                //        SelectedItem = SelectedItemOld;
                //        if (SelectedItemOldclone != null)
                //            SelectedItem = SelectedItemOldclone;
                //        SelectedItemDetection = SelectedItemOldDetection;
                //        if (SelectedItemOldcloneDetection != null)
                //            SelectedItemDetection = SelectedItemOldcloneDetection;

                //        SelectedItemOption = SelectedItemOldOption;
                //        if (SelectedItemOldcloneOption != null)
                //            SelectedItemOption = SelectedItemOldcloneOption;
                //        SelectedItemWay = SelectedItemOldWay;
                //        if (SelectedItemOldcloneWay != null)
                //            SelectedItemWay = SelectedItemOldcloneWay;

                //        SelectedItemStructures = SelectedItemOldStructure;
                //        if (SelectedItemOldcloneStructure != null)
                //            SelectedItemStructures = SelectedItemOldcloneStructure;
                //        //GEOS2-4033 Spare Part Gulab Lakade
                //        SelectedItemSparePart = SelectedItemOldSparePart;
                //        if (SelectedItemOldcloneSparePart != null)
                //            SelectedItemSparePart = SelectedItemOldcloneSparePart;

                //    }
                //    catch (Exception ex) { }
                //}
                //else
                //{
                //    try
                //    {
                //        if (string.IsNullOrEmpty(tempselectedCurrentitem))
                //        {
                //            SelectedItemDetection = SelectedItemOldcloneDetection;
                //            SelectedItemOption = SelectedItemOldcloneOption;
                //            SelectedItemWay = SelectedItemOldcloneWay;
                //            SelectedItemStructures = SelectedItemOldcloneStructure;
                //            SelectedItem = SelectedItemOldclone;
                //        }
                //        else
                //            if (tempselectedCurrentitem == "module")
                //        {
                //            SelectedItemDetection = SelectedItemOldcloneDetection;
                //            SelectedItemOption = SelectedItemOldcloneOption;
                //            SelectedItemWay = SelectedItemOldcloneWay;
                //            SelectedItemStructures = SelectedItemOldcloneStructure; //[GEOS2-3601][Rupali Sarode]
                //            SelectedItemSparePart = SelectedItemOldcloneSparePart;   //GEOS2-4033 Spare Part Gulab Lakade
                //            SelectedItem = SelectedItemOldclone;
                //        }
                //        else
                //            if (tempselectedCurrentitem == "Detection")
                //        {
                //            SelectedItemOption = SelectedItemOldcloneOption;
                //            SelectedItemWay = SelectedItemOldcloneWay;
                //            SelectedItem = SelectedItemOldclone;
                //            SelectedItemStructures = SelectedItemOldcloneStructure; //[GEOS2-3601][Rupali Sarode]
                //            SelectedItemSparePart = SelectedItemOldcloneSparePart;   //GEOS2-4033 Spare Part Gulab Lakade
                //            SelectedItemDetection = SelectedItemOldcloneDetection;
                //        }
                //        else
                //            if (tempselectedCurrentitem == "Option")
                //        {
                //            SelectedItemWay = SelectedItemOldcloneWay;
                //            SelectedItem = SelectedItemOldclone;
                //            SelectedItemDetection = SelectedItemOldcloneDetection;
                //            SelectedItemStructures = SelectedItemOldcloneStructure; //[GEOS2-3601][Rupali Sarode]
                //            SelectedItemSparePart = SelectedItemOldcloneSparePart;   //GEOS2-4033 Spare Part Gulab Lakade
                //            SelectedItemOption = SelectedItemOldcloneOption;
                //        }
                //        else
                //            if (tempselectedCurrentitem == "Ways")
                //        {
                //            SelectedItem = SelectedItemOldclone;
                //            SelectedItemDetection = SelectedItemOldcloneDetection;
                //            SelectedItemOption = SelectedItemOldcloneOption;
                //            SelectedItemStructures = SelectedItemOldcloneStructure; //[GEOS2-3601][Rupali Sarode]
                //            SelectedItemSparePart = SelectedItemOldcloneSparePart;   //GEOS2-4033 Spare Part Gulab Lakade
                //            SelectedItemWay = SelectedItemOldcloneWay;
                //        }

                //        else
                //            if (tempselectedCurrentitem == "Structure")
                //        {
                //            SelectedItem = SelectedItemOldclone;
                //            SelectedItemDetection = SelectedItemOldcloneDetection;
                //            SelectedItemOption = SelectedItemOldcloneOption;
                //            SelectedItemWay = SelectedItemOldcloneWay;
                //            SelectedItemSparePart = SelectedItemOldcloneSparePart;   //GEOS2-4033 Spare Part Gulab Lakade
                //            SelectedItemStructures = SelectedItemOldcloneStructure; //[GEOS2-3601][Rupali Sarode]
                //        }
                //        //GEOS2 - 4033 Spare Part Gulab Lakade
                //        else
                //            if (tempselectedCurrentitem == "SparePart")
                //        {
                //            SelectedItem = SelectedItemOldclone;
                //            SelectedItemDetection = SelectedItemOldcloneDetection;
                //            SelectedItemOption = SelectedItemOldcloneOption;
                //            SelectedItemWay = SelectedItemOldcloneWay;
                //            SelectedItemStructures = SelectedItemOldcloneStructure;
                //            SelectedItemSparePart = SelectedItemOldcloneSparePart;
                //        }

                //    }
                //    catch (Exception ex) { }

                //}

                #endregion
                //standardOperationsDictionaryModulesDeleteList = new List<StandardOperationsDictionaryModules>();
                //RetrieveWorkOperationsByCPTypes();
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Method SaveButtonCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {

                GeosApplication.Instance.Logger.Log(string.Format("Error in method SaveButtonCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }

        }
        //[001][cpatil][GEOS2-3718]
        private void ToogleButtonCommandAction()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ToogleButtonCommandAction()...", category: Category.Info, priority: Priority.Low);
                if (IsInformationVisible == true)
                {
                    IsInformationVisible = false;
                }
                else
                {
                    IsInformationVisible = true;
                }
                GeosApplication.Instance.Logger.Log("Method ToogleButtonCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {

                GeosApplication.Instance.Logger.Log(string.Format("Error in method ToogleButtonCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        private void ShowDescriptionViewCommandAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ShowDescriptionViewCommandAction()...", category: Category.Info, priority: Priority.Low);

                if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }

                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Error in ShowDescriptionViewCommandAction() Method " + ex.Detail.ErrorMessage, category: Category.Info, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Error in ShowDescriptionViewCommandAction() Method - ServiceUnexceptedException " + ex.Message, category: Category.Info, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString(), null);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Error in ShowDescriptionViewCommandAction()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        private void SetMaximizedElement()
        {
            if (GeosApplication.Instance.UserSettings != null && GeosApplication.Instance.UserSettings.ContainsKey("PLM_Appearance"))
            {
                if (string.IsNullOrEmpty(GeosApplication.Instance.UserSettings["PLM_Appearance"].ToString()))
                {
                    SelectedAppearanceItem = (MaximizedElementPosition)Enum.Parse(typeof(MaximizedElementPosition), "Right", true);
                }
                else
                {
                    SelectedAppearanceItem = (MaximizedElementPosition)Enum.Parse(typeof(MaximizedElementPosition), GeosApplication.Instance.UserSettings["PLM_Appearance"].ToString(), true);
                }
            }
            else
            {
                SelectedAppearanceItem = (MaximizedElementPosition)Enum.Parse(typeof(MaximizedElementPosition), "Right", true);
            }
        }

        private void FillStatusList()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillStatusList()...", category: Category.Info, priority: Priority.Low);

                //IList<LookupValue> tempStatusList = PCMService.GetLookupValues(45);
                //StatusList = new List<LookupValue>();
                //StatusList = new List<LookupValue>(tempStatusList);
                //SelectedStatus = StatusList.FirstOrDefault(x => x.IdLookupValue == 225);
                //SelectedStatusIndex = StatusList.FindIndex(x => x.IdLookupValue == 225);

                IList<LookupValue> tempStatusList = PCMService.GetLookupValues(83);
                StatusList = new List<LookupValue>(tempStatusList);
                SelectedStatus = StatusList.FirstOrDefault(x => x.IdLookupValue == 1537);
                SelectedStatusIndex = StatusList.FindIndex(x => x.IdLookupValue == 1537);


                GeosApplication.Instance.Logger.Log("Method FillStatusList()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillStatusList() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillStatusList() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method FillStatusList() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void GetLatestSODCode()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method GetLatestSODCode()...", category: Category.Info, priority: Priority.Low);
                //Service Method Changed from GetLatestSODCode_V2260 to GetLatestSODCode_V2350 by [rdixit][10.01.2022][GEOS2-4121]
                SelectedSODCode = ERMService.GetLatestSODCode_V2350();

                GeosApplication.Instance.Logger.Log("Method GetLatestSODCode()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (FaultException<ServiceException> ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in GetLatestSODCode() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in GetLatestSODCode() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method GetLatestSODCode() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void GetPlants()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method GetPlants()...", category: Category.Info, priority: Priority.Low);

                PlantList = new ObservableCollection<Site>(PLMService.GetPlants_V2120());

                GeosApplication.Instance.Logger.Log("Method GetPlants()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (FaultException<ServiceException> ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in GetPlants() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in GetPlants() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method GetPlants() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void RetrieveDescriptionByLanguge(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method RetrieveDescriptionByLanguge()...", category: Category.Info, priority: Priority.Low);

                if (IsCheckedAllLanguages == false)
                {
                    if (LanguageSelected.TwoLetterISOLanguage == "EN")
                    {
                        Description = Description_en;
                        Name = Name_en;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "ES")
                    {
                        Description = Description_es;
                        Name = Name_es;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "FR")
                    {
                        Description = Description_fr;
                        Name = Name_fr;

                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "PT")
                    {
                        Description = Description_pt;
                        Name = Name_pt;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "RO")
                    {
                        Description = Description_ro;
                        Name = Name_ro;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "RU")
                    {
                        Description = Description_ru;
                        Name = Name_ru;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "ZH")
                    {
                        Description = Description_zh;
                        Name = Name_zh;
                    }
                }

                GeosApplication.Instance.Logger.Log("Method RetrieveDescriptionByLanguge()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method RetrieveDescriptionByLanguge()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        private void SetNameToLanguage(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log(string.Format("Method SetNameToLanguage..."), category: Category.Info, priority: Priority.Low);

                if (IsCheckedAllLanguages == false)
                {
                    if (string.IsNullOrEmpty(Name))
                    {
                        InformationError = string.Empty; ;
                        PropertyChanged(this, new PropertyChangedEventArgs("InformationError"));
                    }
                    else
                    {
                        InformationError = null;
                        PropertyChanged(this, new PropertyChangedEventArgs("InformationError"));
                    }
                    if (LanguageSelected.TwoLetterISOLanguage == "EN")
                    {
                        Name_en = Name;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "ES")
                    {
                        Name_es = Name;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "FR")
                    {
                        Name_fr = Name;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "PT")
                    {
                        Name_pt = Name;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "RO")
                    {
                        Name_ro = Name;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "RU")
                    {
                        Name_ru = Name;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "ZH")
                    {
                        Name_zh = Name;
                    }
                }

                if (oldName == null)
                {
                    oldName = Name;

                }
                else
                {
                    if (oldName != Name)
                    {
                        oldName = Name; IsEnabledSaveButton = true;
                    }
                }

                GeosApplication.Instance.Logger.Log(string.Format("Method SetNameToLanguage()....executed successfully"), category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method SetNameToLanguage() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void SetControlWidthUsingActualWidth(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log(string.Format("Method SetControlWidthUsingActualWidth..."), category: Category.Info, priority: Priority.Low);

                System.Windows.Controls.Control control = (System.Windows.Controls.Control)obj;
                control.Width = control.ActualWidth;

                GeosApplication.Instance.Logger.Log(string.Format("Method SetControlWidthUsingActualWidth()....executed successfully"), category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method SetControlWidthUsingActualWidth() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void SetDescriptionToLanguage(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log(string.Format("Method SetDescriptionToLanguage..."), category: Category.Info, priority: Priority.Low);

                if (IsCheckedAllLanguages == false)
                {
                    if (LanguageSelected.TwoLetterISOLanguage == "EN")
                    {
                        Description_en = Description;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "ES")
                    {
                        Description_es = Description;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "FR")
                    {
                        Description_fr = Description;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "PT")
                    {
                        Description_pt = Description;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "RO")
                    {
                        Description_ro = Description;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "RU")
                    {
                        Description_ru = Description;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "ZH")
                    {
                        Description_zh = Description;
                    }
                }
                if (oldDescription == null)
                {
                    oldDescription = Description;
                }
                else
                {
                    if (oldDescription != Description)
                    {
                        oldDescription = Description; IsEnabledSaveButton = true;
                    }
                }
                GeosApplication.Instance.Logger.Log(string.Format("Method SetDescriptionToLanguage()....executed successfully"), category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method SetDescriptionToLanguage() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void UncheckedCopyNameDescription(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log(string.Format("Method UncheckedCopyNameDescription..."), category: Category.Info, priority: Priority.Low);

                if (LanguageSelected.TwoLetterISOLanguage == "EN")
                {
                    Name = Name_en;
                    Description = Description_en;
                }
                else if (LanguageSelected.TwoLetterISOLanguage == "ES")
                {
                    Name = Name_es;
                    Description = Description_es;
                }
                else if (LanguageSelected.TwoLetterISOLanguage == "FR")
                {
                    Name = Name_fr;
                    Description = Description_fr;
                }
                else if (LanguageSelected.TwoLetterISOLanguage == "PT")
                {
                    Name = Name_pt;
                    Description = Description_pt;
                }
                else if (LanguageSelected.TwoLetterISOLanguage == "RO")
                {
                    Name = Name_ro;
                    Description = Description_ro;
                }
                else if (LanguageSelected.TwoLetterISOLanguage == "RU")
                {
                    Name = Name_ru;
                    Description = Description_ru;
                }
                else if (LanguageSelected.TwoLetterISOLanguage == "ZH")
                {
                    Name = Name_zh;
                    Description = Description_zh;
                }
                GeosApplication.Instance.Logger.Log(string.Format("Method UncheckedCopyNameDescription()....executed successfully"), category: Category.Info, priority: Priority.Low);
            }

            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method UncheckedCopyNameDescription() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        public void FillLanguages()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillLanguages()...", category: Category.Info, priority: Priority.Low);

                Languages = new ObservableCollection<Language>(PLMService.GetLanguages());
                LanguageSelected = Languages.FirstOrDefault();

                GeosApplication.Instance.Logger.Log("Method FillLanguages()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (FaultException<ServiceException> ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillLanguages() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillLanguages() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method FillLanguages() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void CloseWindow(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method CloseWindow()...", category: Category.Info, priority: Priority.Low);
                if (IsEnabledSaveButton && SaveButtonVisibility == Visibility.Visible)
                {
                    MessageBoxResult MessageBoxResult = MessageBoxResult = CustomMessageBox.Show(string.Format(Application.Current.Resources["ArticleGridUpdateWarning"].ToString()), "Yellow", CustomMessageBox.MessageImagePath.Warning, MessageBoxButton.YesNo);
                    if (MessageBoxResult == MessageBoxResult.Yes)
                    {
                        AcceptButtonCommandAction(null);
                    }
                }
                IsEnabledSaveButton = false;
                RequestClose(null, null);

                GeosApplication.Instance.Logger.Log("Method CloseWindow()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method CloseWindow() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void TreeListViewLoadedCommandAction(RoutedEventArgs obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method TreeListViewLoadedCommandAction ...", category: Category.Info, priority: Priority.Low);

                treeListControlInstance = (TreeListControl)((DevExpress.Xpf.Grid.TreeListView)obj.OriginalSource).DataControl;
                //    TreeListView view = (TreeListView)treeListControlInstance.View;

                GeosApplication.Instance.Logger.Log("Method TreeListViewLoadedCommandAction() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in TreeListViewLoadedCommandAction() Method " + ex.Message, category: Category.Info, priority: Priority.Low);
            }
        }

        private void ChangePlantCommandAction(object obj)
        {
            try
            {
                if (obj == null)
                    return;
                GeosApplication.Instance.Logger.Log("Method ChangePlantCommandAction()...", category: Category.Info, priority: Priority.Low);

                if (((DevExpress.Xpf.Editors.ClosePopupEventArgs)obj).CloseMode == DevExpress.Xpf.Editors.PopupCloseMode.Normal && SelectedPlant != SelectedPlant_Copy)
                {

                    if (SelectedPlant == null)
                    {
                        SelectedPlant = new List<object>();
                    }


                    if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }
                    SelectedPlant_Copy = SelectedPlant;
                    IsPlantAddedOrRemove = true;
                    IsEnabledSaveButton = true;
                    AddEditPlantsColumnsToSupplementsDataTable();
                    FillSupplementDataTable();
                }
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Method ChangePlantCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log(string.Format("Error in method ChangePlantCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void ChangeStatusCommandAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ChangeStatusCommandAction()...", category: Category.Info, priority: Priority.Low);
                ComboBoxEdit value = ((System.Windows.RoutedEventArgs)obj).OriginalSource as ComboBoxEdit;

                if (ClonedSOD == null || value.DisplayText == SelectedStatus.Value)
                {

                    return;
                }

                IsEnabledSaveButton = true;
                GeosApplication.Instance.Logger.Log("Method ChangeStatusCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {

                GeosApplication.Instance.Logger.Log(string.Format("Error in method ChangeStatusCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        private void ChangeEffectiveDateCommandAction()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ChangeEffectiveDateCommandAction()...", category: Category.Info, priority: Priority.Low);
                if (oldEffectiveDate == null)
                {
                    oldEffectiveDate = EffectiveDate;
                }
                else
                {
                    if (oldEffectiveDate != EffectiveDate)
                    {
                        oldEffectiveDate = EffectiveDate; IsEnabledSaveButton = true;

                    }
                }
                GeosApplication.Instance.Logger.Log("Method ChangeEffectiveDateCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {

                GeosApplication.Instance.Logger.Log(string.Format("Error in method ChangeEffectiveDateCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        private void ChangeExpiryDateCommandAction()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ChangeExpiryDateCommandAction()...", category: Category.Info, priority: Priority.Low);

                if (oldExpiryDate == null)
                {
                    oldExpiryDate = ExpiryDate;
                }
                else
                {
                    if (oldExpiryDate != expiryDate)
                    {

                        oldExpiryDate = ExpiryDate; IsEnabledSaveButton = true;

                    }
                }
                GeosApplication.Instance.Logger.Log("Method ChangeExpiryDateCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {

                GeosApplication.Instance.Logger.Log(string.Format("Error in method ChangeExpiryDateCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        private void SupplementsValueChangedCommandAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method SupplementsValueChangedCommandAction()...", category: Category.Info, priority: Priority.Low);
                if (obj == null)
                    return;


                DataRow Row = ((System.Data.DataRowView)((DevExpress.Xpf.Grid.RowEventArgs)obj).Row).Row;
                Int32 IdLookupValue = Convert.ToInt32(Row.ItemArray[0]);
                string columnFieldName = ((DevExpress.Xpf.Grid.CellValueEventArgs)obj).Column.FieldName;

                if (LstStandardOperationsDictionarySupplement == null)
                {
                    LstStandardOperationsDictionarySupplement = new List<StandardOperationsDictionarySupplement>();
                }
                if (LstStandardOperationsDictionarySupplement.Any(ls => ls.IdLookupValue == IdLookupValue && ls.PlantName == columnFieldName))
                {
                    StandardOperationsDictionarySupplement standardOperationsDictionarySupplement = LstStandardOperationsDictionarySupplement.Where(ls => ls.IdLookupValue == IdLookupValue && ls.PlantName == columnFieldName).FirstOrDefault();
                    standardOperationsDictionarySupplement.PlantValue = (float?)((DevExpress.Xpf.Grid.CellValueEventArgs)obj).Value;
                    if (standardOperationsDictionarySupplement.TransactionOperation != ModelBase.TransactionOperations.Add)
                    {
                        standardOperationsDictionarySupplement.TransactionOperation = ModelBase.TransactionOperations.Update;
                        IsEnabledSaveButton = true;
                    }

                }
                else
                {
                    StandardOperationsDictionarySupplement standardOperationsDictionarySupplement = new StandardOperationsDictionarySupplement();
                    standardOperationsDictionarySupplement.IdLookupValue = IdLookupValue;
                    standardOperationsDictionarySupplement.IdStandardOperationsDictionary = IdStandardOperationsDictionary;
                    standardOperationsDictionarySupplement.PlantName = columnFieldName;
                    standardOperationsDictionarySupplement.IdPlant = Convert.ToInt32(PlantList.Where(i => i.Name == columnFieldName).FirstOrDefault().IdSite);
                    standardOperationsDictionarySupplement.PlantValue = (float?)((DevExpress.Xpf.Grid.CellValueEventArgs)obj).Value;
                    standardOperationsDictionarySupplement.TransactionOperation = ModelBase.TransactionOperations.Add;
                    LstStandardOperationsDictionarySupplement.Add(standardOperationsDictionarySupplement);
                    IsEnabledSaveButton = true;

                }


                SupplementsBoxMenu = new List<Tuple<string, float?>>();

                foreach (Site itemPlant in SelectedPlant)
                {

                    if (!SupplementsBoxMenu.Any(i => i.Item1.Contains(itemPlant.Name)))
                    {
                        if (LstStandardOperationsDictionarySupplement != null && LstStandardOperationsDictionarySupplement.Any(supp => supp.IdPlant == itemPlant.IdSite))
                            SupplementsBoxMenu.Add(new Tuple<string, float?>(itemPlant.Name, LstStandardOperationsDictionarySupplement.Where(supp => supp.IdPlant == itemPlant.IdSite).Sum(i => i.PlantValue)));
                        else
                            SupplementsBoxMenu.Add(new Tuple<string, float?>(itemPlant.Name, null));

                    }
                }
                AllSupplementsBoxMenu = SupplementsBoxMenu.OrderByDescending(i => i.Item2).ToList();
                SupplementsBoxMenu = SupplementsBoxMenu.OrderByDescending(i => i.Item2).Take(5).ToList();
                FillmoduleGridColumn();
                CustomSummarycalculation();
                FillDetectionGridColumn();
                FillStructureGridColumn(); //[GOES2-3601] Rupali Sarode
                detectionCustomSummarycalculation();
                structureCustomSummarycalculation(); //[GEOS2-3601] Rupali Sarode
                //GEOS2-3837 gulab lakade
                FillOptionGridColumn();
                optionCustomSummarycalculation();
                //GEOS2-3838 - Way- gulab lakade
                FillWayGridColumn();
                wayCustomSummarycalculation();
                //DataColumn Column = ((System.Data.DataColumn)((DevExpress.Xpf.Grid.ColEventArgs)obj).Row).Row;

                GeosApplication.Instance.Logger.Log("Method SupplementsValueChangedCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method SupplementsValueChangedCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        #region [GEOS2-3909][Rupali Sarode]
        private void AccordionControl_Drop(DragEventArgs e)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method AccordionControl_Drop()...", category: Category.Info, priority: Priority.Low);

                e.Effects = DragDropEffects.None;
                e.Handled = true;

                //MessageBoxResult MessageBoxResult = CustomMessageBox.Show(String.Format(Application.Current.Resources["AddEditSODCopyWorkOperationConfirmation"].ToString()), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                //if (MessageBoxResult == MessageBoxResult.Yes)
                //{
                e.Effects = DragDropEffects.Copy;
                //  if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }
                CompleteDropRecordModuleGridForAccordian(e);
                //  if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                e.Handled = true;
                //}
                GeosApplication.Instance.Logger.Log("Method AccordionControl_Drop()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {

                GeosApplication.Instance.Logger.Log(string.Format("Error in method AccordionControl_Drop() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        #region gulab 05 08 2024
        List<ERMSOPModule> tmpoldmodulelist = new List<ERMSOPModule>();
        private void oldRecordModuleGridForAccordian(List<WorkOperationByStages> tmpchildmodule)
        {
             //tmpoldmodulelist = new List<ERMSOPModule>();
            foreach (var child in tmpchildmodule)
            {
                if (child.ParentName == null)
                {
                    ERMSOPModule childrecord = new ERMSOPModule();
                    childrecord.Name = child.Name;
                    childrecord.IdworkOperationByStage = child.IdworkOperationByStage;
                    childrecord.IdSequence = child.IdSequence;
                    childrecord.IdStatus = child.IdStatus;
                    childrecord.Status = child.Status;
                    childrecord.Code = child.Name;
                    childrecord.Parent = child.Parent;
                    childrecord.IdParent = child.IdParent;
                    childrecord.KeyName = child.KeyName;
                    childrecord.ParentName = child.ParentName;
                    childrecord.Position = Convert.ToUInt32(child.Position);
                    childrecord.ModulePosition = Convert.ToUInt32(child.Position);
                    tmpoldmodulelist.Add(childrecord);
                }
                else
                {
                    List<WorkOperationByStages> tmpchildmodule1 = WorkOperationMenulist.Where(a => a.KeyName == child.ParentName).ToList();
                    if(tmpchildmodule1.Count()>0)
                    {
                        oldRecordModuleGridForAccordian(tmpchildmodule1);
                    }
                    
                    //tmpoldmodulelist.AddRange();
                }

            }

           // return tmpoldmodulelist;
        }

        #endregion
        private void CompleteDropRecordModuleGridForAccordian(DragEventArgs e)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method CompleteDropRecordModuleGridForAccordian()...", category: Category.Info, priority: Priority.Low);
                //if (!DXSplashScreen.IsActive)
                //{
                //    DXSplashScreen.Show(x =>
                //    {
                //        Window win = new Window()
                //        {
                //            ShowActivated = false,
                //            WindowStyle = WindowStyle.None,
                //            ResizeMode = ResizeMode.NoResize,
                //            AllowsTransparency = true,
                //            Background = new SolidColorBrush(Colors.Transparent),
                //            ShowInTaskbar = false,
                //            Topmost = true,
                //            SizeToContent = SizeToContent.WidthAndHeight,
                //            WindowStartupLocation = WindowStartupLocation.CenterScreen,
                //        };
                //        WindowFadeAnimationBehavior.SetEnableAnimation(win, true);
                //        win.Topmost = false;
                //        return win;
                //    }, x =>
                //    {
                //        return new SplashScreenView() { DataContext = new SplashScreenViewModel() };
                //    }, null, null);
                //}

                if (SelectedItem is ProductTypes)
                {
                    ulong tmpIdWorkOperation = 0;
                    //IsEnabledSaveButton = true;
                    //SaveButtonVisibility = Visibility.Visible;
                    duplicateItemloop = 0;
                    // if ((e.IsFromOutside) && typeof(WorkOperationByStages).IsAssignableFrom(e.GetRecordType()))
                    // {
                    //ModuleMenulist = new ObservableCollection<ERMSOPModule>();


                    ////  WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false); // [GEOS2-3909][Rupali Sarode][04-11-2022] 
                    var data = (RecordDragDropData)e.Data.GetData(typeof(RecordDragDropData));

                    List<WorkOperationByStages> found = new List<WorkOperationByStages>();
                    List<WorkOperationByStages> TempfoundAllrecords = new List<WorkOperationByStages>();
                    //List<WorkOperationByStages> records = data.Records.OfType<WorkOperationByStages>().ToList();
                    List<WorkOperationByStages> FindParent = new List<WorkOperationByStages>();
                    List<ERMSOPModule> records = data.Records.OfType<ERMSOPModule>().ToList();

                    AccordionItem itemModule = LayoutTreeHelper.GetVisualParents((DependencyObject)e.OriginalSource).OfType<AccordionItem>().FirstOrDefault();
                    ProductTypes ModuleHeader = (ProductTypes)itemModule.Header;
                    var ModuleIdCPType = ModuleHeader.IdCPType;

                    //If user added from work operation left tab & 
                    //without save user dragged & drop, then first allow user to first save it.
                    //if (IsEnabledSaveButton && SaveButtonVisibility == Visibility.Visible)
                    Saveselecteditem = "module";
                    if (FlagToDragDrop == true)
                    {
                        if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                        MessageBoxResult MessageBoxResult = MessageBoxResult = CustomMessageBox.Show(string.Format(Application.Current.Resources["AddEditSODSaveWOBeforeDrag"].ToString()), "Yellow", CustomMessageBox.MessageImagePath.Warning, MessageBoxButton.YesNo);
                        if (MessageBoxResult == MessageBoxResult.Yes)
                        {

                            if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }
                            ISSavechanges = true;
                            IsEnabledSaveButton = false;
                            SelectedItemOldclone = SelectedItem;
                            SelectedItem = SelectedItemOld;
                            var tempSelectedItem = SelectedItemOldclone;
                            SaveButtonCommandAction();
                            ISSavechanges = false;
                            SelectedItem = tempSelectedItem;
                            //AcceptButtonCommandAction(null);
                            /* if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                             SelectedItemDetection = SelectedItemOldDetection;
                             if (SelectedItemOldcloneDetection != null)
                                 SelectedItemDetection = SelectedItemOldcloneDetection;

                             SelectedItemOption = SelectedItemOldOption;
                             if (SelectedItemOldcloneOption != null)
                                 SelectedItemOption = SelectedItemOldcloneOption;
                             ////GEOS2-3838 - Way
                             SelectedItemWay = SelectedItemOldWay;
                             if (SelectedItemOldcloneWay != null)
                                 SelectedItemWay = SelectedItemOldcloneWay;
                             //[GEOS2-3601] - Structure
                             SelectedItemStructures = SelectedItemOldStructure;
                             if (SelectedItemOldcloneStructure != null)
                                 SelectedItemStructures = SelectedItemOldcloneStructure; */

                            return;
                        }

                        if (MessageBoxResult == MessageBoxResult.No)
                        {
                            TmpModuleMenulist = null;
                            TmpDetectionMenulist = null;
                            TmpOptionMenulist = null;
                            TmpStructureMenulist = null;
                            TmpWayMenulist = null;
                            TmpSparePartsMenulist = null;
                            FlagToDragDrop = false;
                            TmpIdCPType = 0;
                            TmpIdDetection = 0;
                            TmpIdOption = 0;
                            TmpIdWayType = 0;
                            TmpIdStructure = 0;
                            TmpIdSpareParts = 0;

                            return;
                        }

                    }

                    MessageBoxResult MsgBoxResult = CustomMessageBox.Show(String.Format(Application.Current.Resources["AddEditSODCopyWorkOperationConfirmation"].ToString()), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                    if (MsgBoxResult == MessageBoxResult.Yes)
                    {

                        IsEnabledSaveButton = true;
                        SaveButtonVisibility = Visibility.Visible;


                        if (records.Count == 0)  // Dragging work operation from left panal is not allowed
                        {
                            CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("AddEditSODCopyWorkOperationNotAllowed").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                            return;
                        }

                        if (TmpIdCPType == 0)
                            TmpIdCPType = ModuleIdCPType;

                        if (TmpIdCPType != 0 && TmpIdCPType != ModuleIdCPType) // if copied to different cptype without saving then popup the message
                        {
                            CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("AddEditSODCopyWOSavePreviousCopiedWO").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);

                            return;
                        }


                        if (TmpModuleMenulist == null)
                        {
                            TmpModuleMenulist = new ObservableCollection<ERMSOPModule>();
                        }

                        if (ModuleIdCPType == Convert.ToUInt64(records[0].IdCpType))  // Dragging in same CP type is not allowed
                        {
                            CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("AddEditSODCopyWorkOperationInSameCPtype").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                            return;
                        }

                        tmpIdWorkOperation = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(records[0].IdworkOperationByStage)
                         && w.IdCpTypeNew == (long)(ModuleIdCPType)).Select(s => s.IdWorkoperation).FirstOrDefault();

                        if (tmpIdWorkOperation == 0)
                        {
                            tmpIdWorkOperation = Convert.ToUInt64(TmpModuleMenulist.Where(w => w.IdworkOperationByStage == Convert.ToInt32(records[0].IdworkOperationByStage)
                            && Convert.ToUInt64(w.IdCpType) == ModuleIdCPType).Select(s => s.IdworkOperationByStage).FirstOrDefault());
                        }

                        if (tmpIdWorkOperation > 0)
                        {
                            MessageBoxResult MessageBoxResult = CustomMessageBox.Show(String.Format(Application.Current.Resources["AddEditSODCopyWorkOperationAlreadyExists"].ToString()), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                            if (MessageBoxResult == MessageBoxResult.No)
                            {
                                return;
                            }
                        }

                        List<WorkOperationByStages> tmpChildList = WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(records[0].KeyName)).ToList();
                        if (tmpChildList.Count > 0)
                        {
                            foreach (WorkOperationByStages child in tmpChildList)
                            {
                                //[Rahul][geos2-5629]
                                tmpIdWorkOperation = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(child.IdworkOperationByStage)
                                && w.IdCpTypeNew == (long)(ModuleIdCPType)).Select(s => s.IdWorkoperation).FirstOrDefault();
                                if (tmpIdWorkOperation > 0)
                                {
                                    MessageBoxResult MessageBoxResult = CustomMessageBox.Show(String.Format(Application.Current.Resources["AddEditSODCopyWorkOperationAlreadyExists"].ToString()), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                                    if (MessageBoxResult == MessageBoxResult.No)
                                    {
                                        return;
                                    }
                                    if (MessageBoxResult == MessageBoxResult.Yes)
                                        break;
                                }

                            }

                            if (tmpIdWorkOperation == 0)
                            {
                                foreach (WorkOperationByStages child in tmpChildList)
                                {
                                    tmpIdWorkOperation = Convert.ToUInt64(TmpModuleMenulist.Where(w => w.IdWorkoperation == child.IdworkOperationByStage
                                    && w.IdCpType == Convert.ToInt64(ModuleIdCPType)).Select(s => s.IdWorkoperation).FirstOrDefault());
                                    if (tmpIdWorkOperation > 0)
                                    {
                                        MessageBoxResult MessageBoxResult = CustomMessageBox.Show(String.Format(Application.Current.Resources["AddEditSODCopyWorkOperationAlreadyExists"].ToString()), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                                        if (MessageBoxResult == MessageBoxResult.No)
                                        {
                                            return;
                                        }
                                    }

                                }

                            }

                        }



                        TempModuleSelectedCopy = ModuleHeader;
                        operationMenulist = new ObservableCollection<WorkOperationByStages>();
                        int count = 0;

                        if (records.Any(a => a.Name.Equals("All")))
                        {
                            //records.RemoveAll(r => r.Name.Equals("All"));
                            #region ALL
                            // found.AddRange(records);
                            found = new List<WorkOperationByStages>();
                            operationMenulist = new ObservableCollection<WorkOperationByStages>();
                            operationMenulist.AddRange(WorkOperationMenulist.Where(w => !w.Name.Equals("All")));
                            #endregion
                        }
                        else

                        //if (true)
                        {

                            //for (int i = 0; i < records.Count(); i++)
                            //{

                            //}
                            //foreach (WorkOperationByStages itemWorkOperationByStages in records)
                            for (int r = 0; r < records.Count(); r++)
                            {
                                if (!TmpModuleMenulist.Any(a => a.Name.Equals(records[r].Name)))
                                {
                                    // if (records[r].IdStatus != 1536) [rdixit][GEOS2-3764][04.08.2022]
                                    // {
                                    ////////records[r].IsCurrentWorkOperation = true;
                                    ////////// ModuleMenulist.Add(JsonConvert.DeserializeObject<ERMSOPModule>(JsonConvert.SerializeObject(records[r])));
                                    ////////operationMenulist.Add(records[r]);  // [GEOS2-3933] Rupali Sarode 
                                    // }


                                }

                                if (GetStages.Any(a => a != null && a.Code.Trim().Equals(records[r].Name.Trim())))
                                {
                                    found.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(records[r].KeyName)).ToList());
                                    int x = 0;
                                    Loop:
                                    x++;
                                    if (x < 4)
                                    {
                                        for (int i = 0; i < found.Count(); i++)
                                        {
                                            //TempfoundAllrecords.AddRange(WorkOperationMenulist.Where(s => s.IdworkOperationByStage == found[i].IdworkOperationByStage).ToList());
                                            TempfoundAllrecords.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(found[i].KeyName)).ToList());
                                        }
                                        for (int i = 0; i < TempfoundAllrecords.Count(); i++)
                                        {
                                            if (!found.Any(a => a != null && a.KeyName.Trim().Equals(TempfoundAllrecords[i].KeyName.Trim())))
                                                found.Add(TempfoundAllrecords[i]);
                                        }
                                        goto Loop;
                                    }



                                }
                                else
                                {
                                    found.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(records[r].KeyName)).ToList());
                                    for (int i = 0; i < found.Count(); i++)
                                    {
                                        TempfoundAllrecords.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(found[i].KeyName)).ToList());
                                    }

                                    for (int i = 0; i < TempfoundAllrecords.Count(); i++)
                                    {
                                        if (!found.Any(a => a != null && a.KeyName.Trim().Equals(TempfoundAllrecords[i].KeyName.Trim())))
                                            found.Add(TempfoundAllrecords[i]);
                                    }

                                    for (int i = 0; i < records.Where(a => a.IdworkOperationByStage > 0).Count(); i++)
                                    {
                                        if (!found.Any(a => a != null && a.KeyName.Trim().Equals(records[i].KeyName.Trim())))
                                            found.AddRange(WorkOperationMenulist.Where(s => s.IdworkOperationByStage == records[i].IdworkOperationByStage).ToList());
                                        if (found.Count() != 0)
                                        {
                                            count++;
                                        }
                                    }

                                }

                            }
                        }


                        if (count > 0)
                        {
                            for (int i = 0; i < found.Count(); i++)
                            {
                                if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(found[i].Name.Trim())))
                                {
                                    duplicateItemloop = 0;
                                    GetAllTreeList(found[i], WorkOperationMenulist);
                                }

                            }

                        }
                        else
                        {
                            if (!records.Any(a => a.Name.Equals("All")))
                                foreach (WorkOperationByStages item in found)
                                {
                                    duplicateItemloop = 0;
                                    GetAllTreeList(item, WorkOperationMenulist);
                                }
                        }
                        if (!records.Any(a => a.Name.Equals("All")))
                            if (operationMenulist != null)
                            {
                                var tempModuleMenulist = operationMenulist.ToList();
                                for (int i = 0; i < tempModuleMenulist.Count; i++)
                                {
                                    if (GetStages.Any(a => a.Code.Equals(tempModuleMenulist[i].Name)))
                                    {
                                        List<WorkOperationByStages> childList = operationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(tempModuleMenulist[i].KeyName)).ToList();
                                        if (childList.Count == 0)
                                        {
                                            operationMenulist.Remove(tempModuleMenulist[i]);
                                        }
                                    }
                                }
                            }


                        #region Check for Head parent whose parent is null like CUT, CAM etc
                        ulong tempWOId = 0;
                        if (GetStages.Any(a => a != null && a.Code.Trim().Equals(records[0].Name.Trim())))
                        {

                            foreach (WorkOperationByStages wo in operationMenulist)
                            {
                                tempWOId = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(wo.IdworkOperationByStage)
                                && w.IdCpTypeNew == (long)(ModuleIdCPType)).Select(s => s.IdWorkoperation).FirstOrDefault();
                                if (tempWOId > 0)
                                    break;

                            }

                            if (tempWOId > 0)
                            {
                                MessageBoxResult MessageBoxResult = CustomMessageBox.Show(String.Format(Application.Current.Resources["AddEditSODCopyWOSaveAlreadyExistsStage"].ToString()), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                                if (MessageBoxResult == MessageBoxResult.No)
                                {
                                    return;
                                }
                            }
                        }

                        #endregion Check for Head parent whose parent is null like CUT, CAM etc





                        #region copy data to tempWorkOperationClonedModule

                        tempWorkOperationClonedModule = new List<ERMSOPModule>();
                        var SelectedCPTypesItems = tempLstStandardOperationsDictionaryModules.Where(w => w.IdCpTypeNew == (long)(ModuleIdCPType)).ToList();


                        for (int i = 0; i < SelectedCPTypesItems.Count; i++)
                        {
                            ERMSOPModule eRMSOPModule = new ERMSOPModule();

                            //foreach (WorkOperationByStages Module in WorkOperationMenulist)
                            ////foreach (WorkOperationByStages Module in SelectedCPTypesItems)

                            //{

                            //if (operationMenulist.Any(a => a.IdworkOperationByStage == Convert.ToInt64(Module.IdworkOperationByStage))
                            //    && operationMenulist.Any(a => a.IdStage == Module.IdStage)
                            //    && operationMenulist.Any(a => a.Name.Trim().Equals(Module.Name.Trim()))
                            //    )
                            //{
                            //StandardOperationsDictionaryModules standardOperationsDictionaryModules = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(Module.IdworkOperationByStage) && Module.Parent != null
                            //&& w.IdCpType == Convert.ToInt32(ModuleIdCPType)).FirstOrDefault();
                            // ERMSOPModule eRMSOPModule = new ERMSOPModule();
                            //if (standardOperationsDictionaryModules != null)
                            WorkOperationByStages Module = new WorkOperationByStages();
                            Module = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == Convert.ToInt64(SelectedCPTypesItems[i].IdWorkoperation)).FirstOrDefault();

                            eRMSOPModule.IdCpType = Convert.ToInt32(SelectedCPTypesItems[i].IdCpTypeNew);
                            eRMSOPModule.Name = Module.Name;
                            eRMSOPModule.IdworkOperationByStage = Module.IdworkOperationByStage;
                            eRMSOPModule.IdSequence = Module.IdSequence;
                            eRMSOPModule.IdStatus = Module.IdStatus;
                            eRMSOPModule.Status = Module.Status;
                            eRMSOPModule.Code = Module.Name;
                            eRMSOPModule.Parent = Module.Parent;
                            eRMSOPModule.IdParent = Module.IdParent;
                            eRMSOPModule.KeyName = Module.KeyName;
                            eRMSOPModule.ParentName = Module.ParentName;
                            //eRMSOPModule.Position = Module.Position;
                            eRMSOPModule.Position = Convert.ToUInt32(SelectedCPTypesItems[i].Position);//[GEOS2-5629][gulab lakade][16 07 2024]
                            eRMSOPModule.ModulePosition = Convert.ToUInt32(SelectedCPTypesItems[i].ModulePosition);//[GEOS2-5629][gulab lakade][16 07 2024]
                            eRMSOPModule.WorkOperation_count = Module.WorkOperation_count;
                            eRMSOPModule.WorkOperation_count_original = Module.WorkOperation_count_original;
                            eRMSOPModule.NameWithWorkOperationCount = Module.NameWithWorkOperationCount;
                            //[rdixit][03.08.2022][GEOS2-3764]
                            eRMSOPModule.IsReadOnly = Module.IsReadOnly;
                            eRMSOPModule.IsInactiveWorkOperation = Module.IsInactiveWorkOperation;

                            if (!GetStages.Any(a => a.Code.Equals(eRMSOPModule.Name)))
                            {
                                var tempActivity = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage)
                                 && w.IdCpTypeNew == (long)(eRMSOPModule.IdCpType)).Select(s => s.Activity).DefaultIfEmpty(null).FirstOrDefault();
                                var tempObservedTime = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage)
                                 && w.IdCpTypeNew == (long)(eRMSOPModule.IdCpType)).Select(s => s.ObservedTime).DefaultIfEmpty(null).FirstOrDefault();

                                #region [GEOS2-4071][Rupali Sarode][10-12-2022]
                                var tempModule = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage)
                                && w.IdCpTypeNew == (long)(eRMSOPModule.IdCpType)).FirstOrDefault();

                                if (tempModule != null)
                                {
                                    if (tempModule.IdWorkoperation == Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage) && (tempActivity == null || tempActivity == 0))
                                        tempActivity = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == Module.IdworkOperationByStage).Select(b => b.Activity).FirstOrDefault();

                                    if (tempModule.IdWorkoperation == Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage) && (tempObservedTime == null || tempObservedTime == 0))
                                        tempObservedTime = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == Module.IdworkOperationByStage).Select(b => b.ObservedTime).FirstOrDefault();
                                }

                                #endregion


                                if (tempActivity != null)
                                    eRMSOPModule.Activity = Math.Round((double)tempActivity, 2);
                                //if (tempObservedTime != null)
                                //    eRMSOPModule.ObservedTime = Math.Round((double)tempObservedTime, 2);
                                if (tempObservedTime != null)
                                {
                                    eRMSOPModule.ObservedTime = Math.Round((double)tempObservedTime, 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    //eRMSOPModule.UITempobservedTime = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage)
                                    //&& w.IdCpType == Convert.ToUInt64(eRMSOPModule.IdCpType)).Select(s => s.UITempobservedTime).FirstOrDefault();

                                    #region [GEOS2-5008][gulab lakade][1 11 2023]
                                    //eRMSOPModule.UITempobservedTime = TimeSpan.FromMinutes(Convert.ToDouble(tempObservedTime));
                                    eRMSOPModule.UITempobservedTime = ConvertfloattoTimespan(Convert.ToString(Convert.ToDouble(tempObservedTime)));
                                    #endregion
                                    #endregion
                                }

                                eRMSOPModule.NormalTime = Math.Round(Convert.ToDouble(eRMSOPModule.ObservedTime * eRMSOPModule.Activity / 100), 2);
                                #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                eRMSOPModule.UITempNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(eRMSOPModule.NormalTime));

                                #endregion
                                //[GEOS2-3933][Rupali Sarode][21/09/2022]
                                eRMSOPModule.WORemarks = Module.WORemarks == null ? "" : Module.WORemarks.Trim();

                                var tempRemarks = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage)
                                 && w.IdCpTypeNew == (long)(eRMSOPModule.IdCpType)).Select(s => s.Remarks).DefaultIfEmpty(null).FirstOrDefault();

                                eRMSOPModule.Remarks = tempRemarks == null ? "" : tempRemarks.Trim();

                            }
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(Module.Name.Trim())))
                            {
                                eRMSOPModule.IsDeleteButton = false;
                                eRMSOPModule.IsDeleteButtonVisibility = Visibility.Hidden;
                                // eRMSOPModule.ObservedTimeIsReadOnly =true;
                                eRMSOPModule.IsReadOnly = true;
                                eRMSOPModule.IsValidateOnTextInput = false;
                                Module.IsCurrentWorkOperation = true;
                            }
                            else
                            {
                                Module.IsCurrentWorkOperation = true;
                                //eRMSOPModule.ObservedTimeIsReadOnly = false;
                                eRMSOPModule.IsReadOnly = false;
                                eRMSOPModule.IsValidateOnTextInput = true;
                            }
                            if (Module.IdStatus == 1536)
                            {
                                eRMSOPModule.IsInactiveWorkOperation = true;
                                eRMSOPModule.IsReadOnly = true;
                            }
                            try
                            {
                                //  if (!tempWorkOperationClonedModule.Any(a => a.KeyName.Equals(Module.KeyName)))
                                tempWorkOperationClonedModule.Add(eRMSOPModule);
                            }
                            catch (Exception ex)
                            {

                            }

                            //}
                            //}

                        }

                        #endregion copy data to tempWorkOperationClonedModule 
                        #region [GEOS2-5629][gulab lakade][16 07 2024]

                        List<StandardOperationsDictionaryModules> tempLstStandardOperationsDictionaryModules_ACCordian = new List<StandardOperationsDictionaryModules>();
                        tempLstStandardOperationsDictionaryModules_ACCordian = tempLstStandardOperationsDictionaryModules.Where(w => w.IdCpTypeNew == (long)(ModuleIdCPType)).ToList();
                        if (tempLstStandardOperationsDictionaryModules_ACCordian.Count() > 0)
                        {
                            foreach (var eRMSOPModule in tempLstStandardOperationsDictionaryModules_ACCordian)
                            {
                                //List<WorkOperationByStages> tempModuleList = WorkOperationMenulist.Where(w => w.IdworkOperationByStage ==Convert.ToInt32(eRMSOPModule.IdWorkoperation)).ToList();
                                //  operationMenulist.AddRange(tempModuleList);
                                if (eRMSOPModule != null)
                                {
                                    List<WorkOperationByStages> tempModuleList = WorkOperationMenulist.Where(w => w.IdworkOperationByStage == Convert.ToInt32(eRMSOPModule.IdWorkoperation) && w.Name == eRMSOPModule.WorkOperationName).ToList();//[Cut  work operation not work properly.][gulab lakade][24 01 2023]
                                    if (tempModuleList != null)
                                        foreach (WorkOperationByStages item in tempModuleList)
                                        {
                                            if (item.IdStatus == 1536)//[rdixit][03.08.2022][GEOS2-3764]
                                            {
                                                item.IsInactiveWorkOperation = true;
                                                item.IsReadOnly = true;
                                            }
                                            WorkOperationByStages ParentName = WorkOperationMenulist.Where(w => w.ParentName != null && w.KeyName.Equals(item.ParentName)).FirstOrDefault();
                                            if (ParentName != null)
                                            {
                                                if (!operationMenulist.Any(a => a.KeyName.Equals(ParentName.KeyName)))
                                                    operationMenulist.Add(ParentName);
                                            }
                                            duplicateItemloop = 0;
                                            GetAllTreeList(item, WorkOperationMenulist);
                                        }

                                }

                            }
                        }



                        #region commonCode
                        if (tempWorkOperationClonedModule != null && tempWorkOperationClonedModule.Count() > 0)
                        {
                            //List<ERMSOPModule> tempWorkOperationModule = new List<ERMSOPModule>();
                            //List<int> TempIdworkOp = new List<int>();
                            //TempIdworkOp=records.Select(a => a.IdworkOperationByStage).ToList();
                            //tempWorkOperationModule = tempWorkOperationClonedModule.Where(a => !TempIdworkOp.Contains(a.IdworkOperationByStage)).ToList();

                            //tempWorkOperationModule11tempWorkOperationModule;
                            List<ERMSOPModule> tmpoldmodulelist = new List<ERMSOPModule>();
                            foreach (ERMSOPModule item in tempWorkOperationClonedModule)
                            {
                                records.Add(item);
                                var tmpmodule= WorkOperationMenulist.Where(a => a.KeyName == item.ParentName).ToList();
                                if(tmpmodule.Count()>0)
                                {
                                    foreach(var child in tmpmodule)
                                    {
                                        if(child.ParentName==null)
                                        {
                                            ERMSOPModule childrecord = new ERMSOPModule();
                                            childrecord.Name = child.Name;
                                            childrecord.IdworkOperationByStage = child.IdworkOperationByStage;
                                            childrecord.IdSequence = child.IdSequence;
                                            childrecord.IdStatus = child.IdStatus;
                                            childrecord.Status = child.Status;
                                            childrecord.Code = child.Name;
                                            childrecord.Parent = child.Parent;
                                            childrecord.IdParent = child.IdParent;
                                            childrecord.KeyName = child.KeyName;
                                            childrecord.ParentName = child.ParentName;
                                            childrecord.Position = Convert.ToUInt32(child.Position);
                                            childrecord.ModulePosition = Convert.ToUInt32(child.Position);
                                            tmpoldmodulelist.Add(childrecord);
                                        }
                                        else
                                        {
                                            var tmpchildmodule = WorkOperationMenulist.Where(a => a.KeyName == child.ParentName).ToList();
                                          if(tmpchildmodule.Count()>0)
                                            {
                                                oldRecordModuleGridForAccordian(tmpchildmodule);
                                            }
                                        }

                                    }
                                }
                            }

                            records.AddRange(tmpoldmodulelist);
                            tmpoldmodulelist = new List<ERMSOPModule>();
                        }

                      
                        //[GEOS2-5629][gulab lakade][16 07 2024]
                        List<ERMSOPModule> ACC_ModuleList = new List<ERMSOPModule>();
                        // tempModuleList = tempWorkOperationClonedModule;
                        bool FlagAddItemModule = false;
                        foreach (var Module in operationMenulist)
                        {
                            //if (Module.IdworkOperationByStage == records[0].IdworkOperationByStage)
                            //if (operationMenulist.Any(a => a.IdworkOperationByStage == Convert.ToInt64(Module.IdworkOperationByStage))
                            //       && operationMenulist.Any(a => a.IdStage == Module.IdStage)
                            //    && operationMenulist.Any(a => a.Name.Trim().Equals(Module.Name.Trim()))
                            //    )
                            //[GEOS2-5629][gulab lakade][16 07 2024]
                            #region  [GEOS2-5135][Rupali Sarode][18-12-2023]
                            FlagAddItemModule = true;
                            // If it is child & only active then add
                            List<WorkOperationByStages> childListInActiveDraft = operationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(Module.KeyName)).ToList();

                            if (childListInActiveDraft.Count == 0)
                            {
                                if (Module.IdStatus == 1535)
                                {
                                    FlagAddItemModule = true;
                                }
                                else
                                    FlagAddItemModule = false;
                            }
                            else // If it is parent and does not contain any active child, then do not include it
                            if (childListInActiveDraft.Count > 0)
                            {
                                //List<WorkOperationByStages> childListInParent = operationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(Module.KeyName)).ToList();
                                foreach (WorkOperationByStages objChild in childListInActiveDraft)
                                {
                                    List<WorkOperationByStages> GrandChildListInActiveDraft = new List<WorkOperationByStages>();
                                    GrandChildListInActiveDraft = operationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(objChild.KeyName)).ToList();
                                    if (GrandChildListInActiveDraft.Count == 0)
                                    { // If it is child and Active
                                        if (objChild.IdStatus == 1535)
                                        {
                                            FlagAddItemModule = true;
                                            break;
                                        }
                                        else
                                        {
                                            FlagAddItemModule = false;
                                        }

                                    }
                                    else
                                    {
                                        if (GrandChildListInActiveDraft.Count > 0)
                                        {
                                            if (GrandChildListInActiveDraft.Where(i => i.IdStatus == 1535).Count() > 0)
                                            {
                                                FlagAddItemModule = true;
                                                break;
                                            }
                                            else
                                            {
                                                FlagAddItemModule = false;
                                            }
                                        }
                                    }
                                }
                            }
                            #endregion  [GEOS2-5135][Rupali Sarode][18-12-2023]
                            if (FlagAddItemModule == true)
                            {
                                bool Checkrecord = false;
                                var tmprecord = ModuleMenulist.Where(x => x.KeyName == Module.KeyName).FirstOrDefault();
                                ERMSOPModule eRMSOPModule = new ERMSOPModule();
                                eRMSOPModule.Name = Module.Name;
                                eRMSOPModule.IdworkOperationByStage = Module.IdworkOperationByStage;
                                eRMSOPModule.IdSequence = Module.IdSequence;
                                eRMSOPModule.IdStatus = Module.IdStatus;
                                eRMSOPModule.Status = Module.Status;
                                eRMSOPModule.Code = Module.Name;
                                eRMSOPModule.Parent = Module.Parent;
                                eRMSOPModule.IdParent = Module.IdParent;
                                eRMSOPModule.KeyName = Module.KeyName;
                                eRMSOPModule.ParentName = Module.ParentName;
                                //start[GEOS2-5629][gulab lakade][16 07 2024]
                                var ACC_Record = tempLstStandardOperationsDictionaryModules_ACCordian.Where(a => a.IdWorkoperation == Convert.ToUInt32(Module.IdworkOperationByStage)).FirstOrDefault();
                                if (ACC_Record != null)
                                {
                                    eRMSOPModule.Position = Convert.ToUInt32(ACC_Record.Position);
                                    eRMSOPModule.ModulePosition = Convert.ToUInt32(ACC_Record.Position);//[GEOS2-5629][gulab lakade][16 07 2024]
                                }
                                else if (tmprecord != null)
                                {
                                    eRMSOPModule.Position = tmprecord.Position;
                                    eRMSOPModule.ModulePosition = tmprecord.Position;//[GEOS2-5629][gulab lakade][16 07 2024]
                                }
                                else
                                {
                                    eRMSOPModule.Position = Module.Position;
                                    eRMSOPModule.ModulePosition = Module.Position;//[GEOS2-5629][gulab lakade][16 07 2024]
                                }
                                //end[GEOS2-5629][gulab lakade][16 07 2024]
                                eRMSOPModule.WorkOperation_count = Module.WorkOperation_count;
                                eRMSOPModule.WorkOperation_count_original = Module.WorkOperation_count_original;
                                eRMSOPModule.NameWithWorkOperationCount = Module.NameWithWorkOperationCount;
                                if (tmprecord != null)
                                {
                                    eRMSOPModule.NormalTime = tmprecord.NormalTime;
                                    eRMSOPModule.ObservedTime = tmprecord.ObservedTime;
                                    eRMSOPModule.Activity = tmprecord.Activity;
                                    eRMSOPModule.WORemarks = tmprecord.WORemarks == null ? "" : tmprecord.WORemarks.Trim();
                                    eRMSOPModule.Remarks = tmprecord.Remarks == null ? "" : tmprecord.Remarks.Trim();
                                    Checkrecord = true;
                                }
                                else
                                {
                                    var tmprecord1 = records.Where(x => x.KeyName == Module.KeyName).FirstOrDefault();
                                    if (tmprecord1 != null)
                                    {
                                        eRMSOPModule.NormalTime = tmprecord1.NormalTime;
                                        eRMSOPModule.ObservedTime = tmprecord1.ObservedTime;
                                        eRMSOPModule.Activity = tmprecord1.Activity;
                                        eRMSOPModule.WORemarks = tmprecord1.WORemarks == null ? "" : tmprecord1.WORemarks.Trim();
                                        eRMSOPModule.Remarks = tmprecord1.Remarks == null ? "" : tmprecord1.Remarks.Trim();
                                        Checkrecord = true;
                                    }
                                    else
                                    {
                                        eRMSOPModule.NormalTime = Module.NormalTime;
                                        eRMSOPModule.ObservedTime = Module.ObservedTime;
                                        eRMSOPModule.Activity = Module.Activity;
                                        eRMSOPModule.WORemarks = Module.WORemarks == null ? "" : Module.WORemarks.Trim();
                                        eRMSOPModule.Remarks = Module.Remarks == null ? "" : Module.Remarks.Trim();
                                    }

                                }


                                //if (Module.IdCpType != 0)
                                eRMSOPModule.IdCpType = Convert.ToInt32(ModuleIdCPType);  // Assign new IdCPType
                                                                                          //eRMSOPModule.NameWithWorkOperationCount 
                                                                                          //[GEOS2-3933][Rupali Sarode][21/09/2022]



                                if (GetStages.Any(a => a != null && a.Code.Trim().Equals(Module.Name.Trim())))
                                {
                                    //    Module.IsCurrentWorkOperation = true;
                                    eRMSOPModule.IsDeleteButton = false;
                                    eRMSOPModule.IsDeleteButtonVisibility = Visibility.Hidden;
                                    eRMSOPModule.IsValidateOnTextInput = false;
                                }
                                else
                                {
                                    //  Module.IsCurrentWorkOperation = true;
                                    eRMSOPModule.IsValidateOnTextInput = true;
                                }
                                if (Module.IdStatus == 1536)
                                {
                                    eRMSOPModule.IsInactiveWorkOperation = true;

                                }
                                else
                                {

                                }
                                try
                                {
                                    if (!TmpModuleMenulist.Any(a => a.KeyName.Equals(Module.KeyName)) && Checkrecord==true)
                                    {
                                        TmpModuleMenulist.Add(eRMSOPModule);
                                        ACC_ModuleList.Add(eRMSOPModule);//[GEOS2-5629][gulab lakade][16 07 2024]
                                    }

                                }
                                catch (Exception ex)
                                {

                                }

                            }
                        }

                        #endregion


                        #endregion

                        #region //[GEOS2-5629][gulab lakade][16 07 2024]

                        ObservableCollection<ERMSOPModule> CopyModuleMenulist = new ObservableCollection<ERMSOPModule>();
                        CopyModuleMenulist = tmpModuleMenulist;
                        tmpModuleMenulist = new ObservableCollection<ERMSOPModule>();
                        foreach (ERMSOPModule Module in ACC_ModuleList.OrderBy(a=>a.ModulePosition))
                        {
                            //if (Module.IdworkOperationByStage == records[0].IdworkOperationByStage)

                            {

                                ERMSOPModule eRMSOPModule = new ERMSOPModule();
                                eRMSOPModule.Name = Module.Name;
                                eRMSOPModule.IdworkOperationByStage = Module.IdworkOperationByStage;
                                eRMSOPModule.IdSequence = Module.IdSequence;
                                eRMSOPModule.IdStatus = Module.IdStatus;
                                eRMSOPModule.Status = Module.Status;
                                eRMSOPModule.Code = Module.Name;
                                eRMSOPModule.Parent = Module.Parent;
                                eRMSOPModule.IdParent = Module.IdParent;
                                eRMSOPModule.KeyName = Module.KeyName;
                                eRMSOPModule.ParentName = Module.ParentName;
                                if (ACC_ModuleList != null)
                                {
                                    if (Module.ParentName == null)
                                    {
                                        eRMSOPModule.ModulePosition = Module.Position;
                                    }
                                    else
                                    {
                                        var TempModule = ACC_ModuleList.Where(x => x.KeyName == Module.KeyName).FirstOrDefault();
                                        if (TempModule != null)
                                        {
                                            eRMSOPModule.ModulePosition = TempModule.ModulePosition;
                                        }
                                        else
                                        {
                                            if (ACC_ModuleList.Where(x => x.ParentName == Module.ParentName).FirstOrDefault() == null)
                                            {
                                                var maxpos = ACC_ModuleList.Max(a => a.ModulePosition);
                                                eRMSOPModule.ModulePosition = maxpos + 1;
                                            }
                                            else
                                            {
                                                var maxpos = ACC_ModuleList.Where(x => x.ParentName == Module.ParentName).Max(a => a.ModulePosition);
                                                eRMSOPModule.ModulePosition = maxpos + 1;
                                            }

                                        }
                                    }


                                }
                                eRMSOPModule.WorkOperation_count = Module.WorkOperation_count;
                                eRMSOPModule.WorkOperation_count_original = Module.WorkOperation_count_original;
                                eRMSOPModule.NameWithWorkOperationCount = Module.NameWithWorkOperationCount;
                                eRMSOPModule.NormalTime = Module.NormalTime;

                                if (Module.IdCpType != 0)
                                    eRMSOPModule.IdCpType = Convert.ToInt32(ModuleIdCPType);  // Assign new IdCPType
                                                                                              //eRMSOPModule.NameWithWorkOperationCount 
                                                                                              //[GEOS2-3933][Rupali Sarode][21/09/2022]
                                eRMSOPModule.WORemarks = Module.WORemarks == null ? "" : Module.WORemarks.Trim();
                                eRMSOPModule.Remarks = Module.Remarks == null ? "" : Module.Remarks.Trim();

                                if (Module.NormalTime != null)
                                {
                                    eRMSOPModule.NormalTime = Math.Round((double)Module.NormalTime, 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    eRMSOPModule.UITempNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(eRMSOPModule.NormalTime));
                                    #endregion
                                }
                                eRMSOPModule.ObservedTime = Module.ObservedTime;
                                if (Module.ObservedTime != null)
                                {
                                    eRMSOPModule.ObservedTime = Math.Round((double)Module.ObservedTime, 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    eRMSOPModule.UITempobservedTime = ConvertfloattoTimespan(Convert.ToString(eRMSOPModule.ObservedTime));
                                    #endregion
                                }

                                if (Module.Activity != null)
                                    eRMSOPModule.Activity = Module.Activity;

                                if (Module.Activity != 0 && Module.Activity != null)
                                    eRMSOPModule.Activity = Math.Round((double)Module.Activity, 2);
                                if (eRMSOPModule.Activity == 0)
                                    eRMSOPModule.Activity = null;

                                if (GetStages.Any(a => a != null && a.Code.Trim().Equals(Module.Name.Trim())))
                                {
                                    //    Module.IsCurrentWorkOperation = true;
                                    eRMSOPModule.IsDeleteButton = false;
                                    eRMSOPModule.IsDeleteButtonVisibility = Visibility.Hidden;
                                    eRMSOPModule.IsValidateOnTextInput = false;
                                }
                                else
                                {
                                    //  Module.IsCurrentWorkOperation = true;
                                    eRMSOPModule.IsValidateOnTextInput = true;
                                }
                                if (Module.IdStatus == 1536)
                                {
                                    eRMSOPModule.IsInactiveWorkOperation = true;

                                }
                                else
                                {

                                }
                                try
                                {
                                    if (!TmpModuleMenulist.Any(a => a.KeyName.Equals(Module.KeyName)))
                                    {
                                        TmpModuleMenulist.Add(eRMSOPModule);
                                    }

                                }
                                catch (Exception ex)
                                {

                                }

                            }
                        }
                        ObservableCollection<ERMSOPModule> tempWorkOperationMenulist2 = new ObservableCollection<ERMSOPModule>(TmpModuleMenulist.OrderBy(x => x.ModulePosition).ToList());
                        TmpModuleMenulist = new ObservableCollection<ERMSOPModule>();
                        TmpModuleMenulist = tempWorkOperationMenulist2;
                        #endregion
                        // }
                        ////var tempWorkOperationMenulist2 = ModuleMenulist.OrderBy(x => x.Position).ToList();
                        ////ModuleMenulist.Clear();
                        ////ModuleMenulist.AddRange(tempWorkOperationMenulist2);
                        ////if (tempWorkOperationMenulist2 != null)
                        ////    tempWorkOperationMenulist2.Clear();
                        ////FillmoduleGridColumn();
                        ////CustomSummarycalculation();
                        e.Handled = true;
                    }
                    if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                }
                GeosApplication.Instance.Logger.Log("Method CompleteDropRecordModuleGridForAccordian()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in Method CompleteDropRecordModuleGridForAccordian()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        //        private void CompleteDropRecordModuleGridForAccordian_old(DragEventArgs e)
        //        {
        //            try
        //            {
        //                GeosApplication.Instance.Logger.Log("Method CompleteDropRecordModuleGridForAccordian()...", category: Category.Info, priority: Priority.Low);
        //                //if (!DXSplashScreen.IsActive)
        //                //{
        //                //    DXSplashScreen.Show(x =>
        //                //    {
        //                //        Window win = new Window()
        //                //        {
        //                //            ShowActivated = false,
        //                //            WindowStyle = WindowStyle.None,
        //                //            ResizeMode = ResizeMode.NoResize,
        //                //            AllowsTransparency = true,
        //                //            Background = new SolidColorBrush(Colors.Transparent),
        //                //            ShowInTaskbar = false,
        //                //            Topmost = true,
        //                //            SizeToContent = SizeToContent.WidthAndHeight,
        //                //            WindowStartupLocation = WindowStartupLocation.CenterScreen,
        //                //        };
        //                //        WindowFadeAnimationBehavior.SetEnableAnimation(win, true);
        //                //        win.Topmost = false;
        //                //        return win;
        //                //    }, x =>
        //                //    {
        //                //        return new SplashScreenView() { DataContext = new SplashScreenViewModel() };
        //                //    }, null, null);
        //                //}

        //                if (SelectedItem is ProductTypes)
        //                {
        //                    ulong tmpIdWorkOperation = 0;
        //                    //IsEnabledSaveButton = true;
        //                    //SaveButtonVisibility = Visibility.Visible;
        //                    duplicateItemloop = 0;
        //                    // if ((e.IsFromOutside) && typeof(WorkOperationByStages).IsAssignableFrom(e.GetRecordType()))
        //                    // {
        //                    //ModuleMenulist = new ObservableCollection<ERMSOPModule>();


        //                    ////  WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false); // [GEOS2-3909][Rupali Sarode][04-11-2022] 
        //                    var data = (RecordDragDropData)e.Data.GetData(typeof(RecordDragDropData));

        //                    List<WorkOperationByStages> found = new List<WorkOperationByStages>();
        //                    List<WorkOperationByStages> TempfoundAllrecords = new List<WorkOperationByStages>();
        //                    //List<WorkOperationByStages> records = data.Records.OfType<WorkOperationByStages>().ToList();
        //                    List<WorkOperationByStages> FindParent = new List<WorkOperationByStages>();
        //                    List<ERMSOPModule> records = data.Records.OfType<ERMSOPModule>().ToList();

        //                    AccordionItem itemModule = LayoutTreeHelper.GetVisualParents((DependencyObject)e.OriginalSource).OfType<AccordionItem>().FirstOrDefault();
        //                    ProductTypes ModuleHeader = (ProductTypes)itemModule.Header;
        //                    var ModuleIdCPType = ModuleHeader.IdCPType;

        //                    //If user added from work operation left tab & 
        //                    //without save user dragged & drop, then first allow user to first save it.
        //                    //if (IsEnabledSaveButton && SaveButtonVisibility == Visibility.Visible)
        //                    Saveselecteditem = "module";
        //                    if (FlagToDragDrop == true)
        //                    {
        //                        if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
        //                        MessageBoxResult MessageBoxResult = MessageBoxResult = CustomMessageBox.Show(string.Format(Application.Current.Resources["AddEditSODSaveWOBeforeDrag"].ToString()), "Yellow", CustomMessageBox.MessageImagePath.Warning, MessageBoxButton.YesNo);
        //                        if (MessageBoxResult == MessageBoxResult.Yes)
        //                        {

        //                            if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }
        //                            ISSavechanges = true;
        //                            IsEnabledSaveButton = false;
        //                            SelectedItemOldclone = SelectedItem;
        //                            SelectedItem = SelectedItemOld;
        //                            var tempSelectedItem = SelectedItemOldclone;
        //                            SaveButtonCommandAction();
        //                            ISSavechanges = false;
        //                            SelectedItem = tempSelectedItem;
        //                            //AcceptButtonCommandAction(null);
        //                            /* if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
        //                             SelectedItemDetection = SelectedItemOldDetection;
        //                             if (SelectedItemOldcloneDetection != null)
        //                                 SelectedItemDetection = SelectedItemOldcloneDetection;

        //                             SelectedItemOption = SelectedItemOldOption;
        //                             if (SelectedItemOldcloneOption != null)
        //                                 SelectedItemOption = SelectedItemOldcloneOption;
        //                             ////GEOS2-3838 - Way
        //                             SelectedItemWay = SelectedItemOldWay;
        //                             if (SelectedItemOldcloneWay != null)
        //                                 SelectedItemWay = SelectedItemOldcloneWay;
        //                             //[GEOS2-3601] - Structure
        //                             SelectedItemStructures = SelectedItemOldStructure;
        //                             if (SelectedItemOldcloneStructure != null)
        //                                 SelectedItemStructures = SelectedItemOldcloneStructure; */

        //                            return;
        //                        }

        //                        if (MessageBoxResult == MessageBoxResult.No)
        //                        {
        //                            TmpModuleMenulist = null;
        //                            TmpDetectionMenulist = null;
        //                            TmpOptionMenulist = null;
        //                            TmpStructureMenulist = null;
        //                            TmpWayMenulist = null;
        //                            TmpSparePartsMenulist = null;
        //                            FlagToDragDrop = false;
        //                            TmpIdCPType = 0;
        //                            TmpIdDetection = 0;
        //                            TmpIdOption = 0;
        //                            TmpIdWayType = 0;
        //                            TmpIdStructure = 0;
        //                            TmpIdSpareParts = 0;

        //                            return;
        //                        }

        //                    }

        //                    MessageBoxResult MsgBoxResult = CustomMessageBox.Show(String.Format(Application.Current.Resources["AddEditSODCopyWorkOperationConfirmation"].ToString()), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
        //                    if (MsgBoxResult == MessageBoxResult.Yes)
        //                    {

        //                        IsEnabledSaveButton = true;
        //                        SaveButtonVisibility = Visibility.Visible;


        //                        if (records.Count == 0)  // Dragging work operation from left panal is not allowed
        //                        {
        //                            CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("AddEditSODCopyWorkOperationNotAllowed").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
        //                            return;
        //                        }

        //                        if (TmpIdCPType == 0)
        //                            TmpIdCPType = ModuleIdCPType;

        //                        if (TmpIdCPType != 0 && TmpIdCPType != ModuleIdCPType) // if copied to different cptype without saving then popup the message
        //                        {
        //                            CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("AddEditSODCopyWOSavePreviousCopiedWO").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);

        //                            return;
        //                        }


        //                        if (TmpModuleMenulist == null)
        //                        {
        //                            TmpModuleMenulist = new ObservableCollection<ERMSOPModule>();
        //                        }

        //                        if (ModuleIdCPType == Convert.ToUInt64(records[0].IdCpType))  // Dragging in same CP type is not allowed
        //                        {
        //                            CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("AddEditSODCopyWorkOperationInSameCPtype").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
        //                            return;
        //                        }

        //                        tmpIdWorkOperation = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(records[0].IdworkOperationByStage)
        //                         && w.IdCpTypeNew == (long)(ModuleIdCPType)).Select(s => s.IdWorkoperation).FirstOrDefault();

        //                        if (tmpIdWorkOperation == 0)
        //                        {
        //                            tmpIdWorkOperation = Convert.ToUInt64(TmpModuleMenulist.Where(w => w.IdworkOperationByStage == Convert.ToInt32(records[0].IdworkOperationByStage)
        //                            && Convert.ToUInt64(w.IdCpType) == ModuleIdCPType).Select(s => s.IdworkOperationByStage).FirstOrDefault());
        //                        }

        //                        if (tmpIdWorkOperation > 0)
        //                        {
        //                            MessageBoxResult MessageBoxResult = CustomMessageBox.Show(String.Format(Application.Current.Resources["AddEditSODCopyWorkOperationAlreadyExists"].ToString()), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
        //                            if (MessageBoxResult == MessageBoxResult.No)
        //                            {
        //                                return;
        //                            }
        //                        }

        //                        List<WorkOperationByStages> tmpChildList = WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(records[0].KeyName)).ToList();
        //                        if (tmpChildList.Count > 0)
        //                        {
        //                            foreach (WorkOperationByStages child in tmpChildList)
        //                            {
        //                                //[Rahul][geos2-5629]
        //                                tmpIdWorkOperation = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(child.IdworkOperationByStage)
        //                                && w.IdCpTypeNew == (long)(ModuleIdCPType)).Select(s => s.IdWorkoperation).FirstOrDefault();
        //                                if (tmpIdWorkOperation > 0)
        //                                {
        //                                    MessageBoxResult MessageBoxResult = CustomMessageBox.Show(String.Format(Application.Current.Resources["AddEditSODCopyWorkOperationAlreadyExists"].ToString()), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
        //                                    if (MessageBoxResult == MessageBoxResult.No)
        //                                    {
        //                                        return;
        //                                    }
        //                                    if (MessageBoxResult == MessageBoxResult.Yes)
        //                                        break;
        //                                }

        //                            }

        //                            if (tmpIdWorkOperation == 0)
        //                            {
        //                                foreach (WorkOperationByStages child in tmpChildList)
        //                                {
        //                                    tmpIdWorkOperation = Convert.ToUInt64(TmpModuleMenulist.Where(w => w.IdWorkoperation == child.IdworkOperationByStage
        //                                    && w.IdCpType == Convert.ToInt64(ModuleIdCPType)).Select(s => s.IdWorkoperation).FirstOrDefault());
        //                                    if (tmpIdWorkOperation > 0)
        //                                    {
        //                                        MessageBoxResult MessageBoxResult = CustomMessageBox.Show(String.Format(Application.Current.Resources["AddEditSODCopyWorkOperationAlreadyExists"].ToString()), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
        //                                        if (MessageBoxResult == MessageBoxResult.No)
        //                                        {
        //                                            return;
        //                                        }
        //                                    }

        //                                }

        //                            }

        //                        }



        //                        TempModuleSelectedCopy = ModuleHeader;
        //                        operationMenulist = new ObservableCollection<WorkOperationByStages>();
        //                        int count = 0;

        //                        if (records.Any(a => a.Name.Equals("All")))
        //                        {
        //                            //records.RemoveAll(r => r.Name.Equals("All"));
        //                            #region ALL
        //                            // found.AddRange(records);
        //                            found = new List<WorkOperationByStages>();
        //                            operationMenulist = new ObservableCollection<WorkOperationByStages>();
        //                            operationMenulist.AddRange(WorkOperationMenulist.Where(w => !w.Name.Equals("All")));
        //                            #endregion
        //                        }
        //                        else

        //                        //if (true)
        //                        {

        //                            //for (int i = 0; i < records.Count(); i++)
        //                            //{

        //                            //}
        //                            //foreach (WorkOperationByStages itemWorkOperationByStages in records)
        //                            for (int r = 0; r < records.Count(); r++)
        //                            {
        //                                if (!TmpModuleMenulist.Any(a => a.Name.Equals(records[r].Name)))
        //                                {
        //                                    // if (records[r].IdStatus != 1536) [rdixit][GEOS2-3764][04.08.2022]
        //                                    // {
        //                                    ////////records[r].IsCurrentWorkOperation = true;
        //                                    ////////// ModuleMenulist.Add(JsonConvert.DeserializeObject<ERMSOPModule>(JsonConvert.SerializeObject(records[r])));
        //                                    ////////operationMenulist.Add(records[r]);  // [GEOS2-3933] Rupali Sarode 
        //                                    // }


        //                                }

        //                                if (GetStages.Any(a => a != null && a.Code.Trim().Equals(records[r].Name.Trim())))
        //                                {
        //                                    found.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(records[r].KeyName)).ToList());
        //                                    int x = 0;
        //                                    Loop:
        //                                    x++;
        //                                    if (x < 4)
        //                                    {
        //                                        for (int i = 0; i < found.Count(); i++)
        //                                        {
        //                                            //TempfoundAllrecords.AddRange(WorkOperationMenulist.Where(s => s.IdworkOperationByStage == found[i].IdworkOperationByStage).ToList());
        //                                            TempfoundAllrecords.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(found[i].KeyName)).ToList());
        //                                        }
        //                                        for (int i = 0; i < TempfoundAllrecords.Count(); i++)
        //                                        {
        //                                            if (!found.Any(a => a != null && a.KeyName.Trim().Equals(TempfoundAllrecords[i].KeyName.Trim())))
        //                                                found.Add(TempfoundAllrecords[i]);
        //                                        }
        //                                        goto Loop;
        //                                    }



        //                                }
        //                                else
        //                                {
        //                                    found.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(records[r].KeyName)).ToList());
        //                                    for (int i = 0; i < found.Count(); i++)
        //                                    {
        //                                        TempfoundAllrecords.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(found[i].KeyName)).ToList());
        //                                    }

        //                                    for (int i = 0; i < TempfoundAllrecords.Count(); i++)
        //                                    {
        //                                        if (!found.Any(a => a != null && a.KeyName.Trim().Equals(TempfoundAllrecords[i].KeyName.Trim())))
        //                                            found.Add(TempfoundAllrecords[i]);
        //                                    }

        //                                    for (int i = 0; i < records.Where(a => a.IdworkOperationByStage > 0).Count(); i++)
        //                                    {
        //                                        if (!found.Any(a => a != null && a.KeyName.Trim().Equals(records[i].KeyName.Trim())))
        //                                            found.AddRange(WorkOperationMenulist.Where(s => s.IdworkOperationByStage == records[i].IdworkOperationByStage).ToList());
        //                                        if (found.Count() != 0)
        //                                        {
        //                                            count++;
        //                                        }
        //                                    }

        //                                }

        //                            }
        //                        }


        //                        if (count > 0)
        //                        {
        //                            for (int i = 0; i < found.Count(); i++)
        //                            {
        //                                if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(found[i].Name.Trim())))
        //                                {
        //                                    duplicateItemloop = 0;
        //                                    GetAllTreeList(found[i], WorkOperationMenulist);
        //                                }

        //                            }

        //                        }
        //                        else
        //                        {
        //                            if (!records.Any(a => a.Name.Equals("All")))
        //                                foreach (WorkOperationByStages item in found)
        //                                {
        //                                    duplicateItemloop = 0;
        //                                    GetAllTreeList(item, WorkOperationMenulist);
        //                                }
        //                        }
        //                        if (!records.Any(a => a.Name.Equals("All")))
        //                            if (operationMenulist != null)
        //                            {
        //                                var tempModuleMenulist = operationMenulist.ToList();
        //                                for (int i = 0; i < tempModuleMenulist.Count; i++)
        //                                {
        //                                    if (GetStages.Any(a => a.Code.Equals(tempModuleMenulist[i].Name)))
        //                                    {
        //                                        List<WorkOperationByStages> childList = operationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(tempModuleMenulist[i].KeyName)).ToList();
        //                                        if (childList.Count == 0)
        //                                        {
        //                                            operationMenulist.Remove(tempModuleMenulist[i]);
        //                                        }
        //                                    }
        //                                }
        //                            }


        //                        #region Check for Head parent whose parent is null like CUT, CAM etc
        //                        ulong tempWOId = 0;
        //                        if (GetStages.Any(a => a != null && a.Code.Trim().Equals(records[0].Name.Trim())))
        //                        {

        //                            foreach (WorkOperationByStages wo in operationMenulist)
        //                            {
        //                                tempWOId = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(wo.IdworkOperationByStage)
        //                                && w.IdCpTypeNew == (long)(ModuleIdCPType)).Select(s => s.IdWorkoperation).FirstOrDefault();
        //                                if (tempWOId > 0)
        //                                    break;

        //                            }

        //                            if (tempWOId > 0)
        //                            {
        //                                MessageBoxResult MessageBoxResult = CustomMessageBox.Show(String.Format(Application.Current.Resources["AddEditSODCopyWOSaveAlreadyExistsStage"].ToString()), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
        //                                if (MessageBoxResult == MessageBoxResult.No)
        //                                {
        //                                    return;
        //                                }
        //                            }
        //                        }

        //                        #endregion Check for Head parent whose parent is null like CUT, CAM etc





        //                        #region copy data to tempWorkOperationClonedModule

        //                        tempWorkOperationClonedModule = new List<ERMSOPModule>();
        //                        var SelectedCPTypesItems = tempLstStandardOperationsDictionaryModules.Where(w => w.IdCpTypeNew == (long)(ModuleIdCPType)).ToList();


        //                        for (int i = 0; i < SelectedCPTypesItems.Count; i++)
        //                        {
        //                            ERMSOPModule eRMSOPModule = new ERMSOPModule();

        //                            //foreach (WorkOperationByStages Module in WorkOperationMenulist)
        //                            ////foreach (WorkOperationByStages Module in SelectedCPTypesItems)

        //                            //{

        //                            //if (operationMenulist.Any(a => a.IdworkOperationByStage == Convert.ToInt64(Module.IdworkOperationByStage))
        //                            //    && operationMenulist.Any(a => a.IdStage == Module.IdStage)
        //                            //    && operationMenulist.Any(a => a.Name.Trim().Equals(Module.Name.Trim()))
        //                            //    )
        //                            //{
        //                            //StandardOperationsDictionaryModules standardOperationsDictionaryModules = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(Module.IdworkOperationByStage) && Module.Parent != null
        //                            //&& w.IdCpType == Convert.ToInt32(ModuleIdCPType)).FirstOrDefault();
        //                            // ERMSOPModule eRMSOPModule = new ERMSOPModule();
        //                            //if (standardOperationsDictionaryModules != null)
        //                            WorkOperationByStages Module = new WorkOperationByStages();
        //                            Module = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == Convert.ToInt64(SelectedCPTypesItems[i].IdWorkoperation)).FirstOrDefault();

        //                            eRMSOPModule.IdCpType = Convert.ToInt32(SelectedCPTypesItems[i].IdCpTypeNew);
        //                            eRMSOPModule.Name = Module.Name;
        //                            eRMSOPModule.IdworkOperationByStage = Module.IdworkOperationByStage;
        //                            eRMSOPModule.IdSequence = Module.IdSequence;
        //                            eRMSOPModule.IdStatus = Module.IdStatus;
        //                            eRMSOPModule.Status = Module.Status;
        //                            eRMSOPModule.Code = Module.Name;
        //                            eRMSOPModule.Parent = Module.Parent;
        //                            eRMSOPModule.IdParent = Module.IdParent;
        //                            eRMSOPModule.KeyName = Module.KeyName;
        //                            eRMSOPModule.ParentName = Module.ParentName;
        //                            //eRMSOPModule.Position = Module.Position;
        //                            eRMSOPModule.Position = Convert.ToUInt32(SelectedCPTypesItems[i].Position);//[GEOS2-5629][gulab lakade][16 07 2024]
        //                            #region //[GEOS2-5629][gulab lakade][16 07 2024]
        //                            //if (tempWorkOperationClonedModule != null)
        //                            //{
        //                            //    if (Module.ParentName == null)
        //                            //    {
        //                            //        eRMSOPModule.ModulePosition = Module.Position;
        //                            //    }
        //                            //    else
        //                            //    {
        //                            //        var TempModule = tempWorkOperationClonedModule.Where(x => x.KeyName == Module.KeyName).FirstOrDefault();
        //                            //        if (TempModule != null)
        //                            //        {
        //                            //            eRMSOPModule.ModulePosition = TempModule.ModulePosition;
        //                            //        }
        //                            //        else
        //                            //        {
        //                            //            if (tempWorkOperationClonedModule.Where(x => x.ParentName == Module.ParentName).FirstOrDefault() == null)
        //                            //            {
        //                            //                var maxpos = tempWorkOperationClonedModule.Max(a => a.ModulePosition);
        //                            //                eRMSOPModule.ModulePosition = maxpos + 1;
        //                            //            }
        //                            //            else
        //                            //            {
        //                            //                var maxpos = tempWorkOperationClonedModule.Where(x => x.ParentName == Module.ParentName).Max(a => a.ModulePosition);
        //                            //                eRMSOPModule.ModulePosition = maxpos + 1;
        //                            //            }

        //                            //        }
        //                            //    }


        //                            //}
        //                            #endregion
        //                            eRMSOPModule.WorkOperation_count = Module.WorkOperation_count;
        //                            eRMSOPModule.WorkOperation_count_original = Module.WorkOperation_count_original;
        //                            eRMSOPModule.NameWithWorkOperationCount = Module.NameWithWorkOperationCount;
        //                            //[rdixit][03.08.2022][GEOS2-3764]
        //                            eRMSOPModule.IsReadOnly = Module.IsReadOnly;
        //                            eRMSOPModule.IsInactiveWorkOperation = Module.IsInactiveWorkOperation;

        //                            if (!GetStages.Any(a => a.Code.Equals(eRMSOPModule.Name)))
        //                            {
        //                                var tempActivity = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage)
        //                                 && w.IdCpTypeNew == (long)(eRMSOPModule.IdCpType)).Select(s => s.Activity).DefaultIfEmpty(null).FirstOrDefault();
        //                                var tempObservedTime = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage)
        //                                 && w.IdCpTypeNew == (long)(eRMSOPModule.IdCpType)).Select(s => s.ObservedTime).DefaultIfEmpty(null).FirstOrDefault();

        //                                #region [GEOS2-4071][Rupali Sarode][10-12-2022]
        //                                var tempModule = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage)
        //                                && w.IdCpTypeNew == (long)(eRMSOPModule.IdCpType)).FirstOrDefault();

        //                                if (tempModule != null)
        //                                {
        //                                    if (tempModule.IdWorkoperation == Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage) && (tempActivity == null || tempActivity == 0))
        //                                        tempActivity = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == Module.IdworkOperationByStage).Select(b => b.Activity).FirstOrDefault();

        //                                    if (tempModule.IdWorkoperation == Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage) && (tempObservedTime == null || tempObservedTime == 0))
        //                                        tempObservedTime = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == Module.IdworkOperationByStage).Select(b => b.ObservedTime).FirstOrDefault();
        //                                }

        //                                #endregion


        //                                if (tempActivity != null)
        //                                    eRMSOPModule.Activity = Math.Round((double)tempActivity, 2);
        //                                //if (tempObservedTime != null)
        //                                //    eRMSOPModule.ObservedTime = Math.Round((double)tempObservedTime, 2);
        //                                if (tempObservedTime != null)
        //                                {
        //                                    eRMSOPModule.ObservedTime = Math.Round((double)tempObservedTime, 2);
        //                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
        //                                    //eRMSOPModule.UITempobservedTime = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage)
        //                                    //&& w.IdCpType == Convert.ToUInt64(eRMSOPModule.IdCpType)).Select(s => s.UITempobservedTime).FirstOrDefault();

        //                                    #region [GEOS2-5008][gulab lakade][1 11 2023]
        //                                    //eRMSOPModule.UITempobservedTime = TimeSpan.FromMinutes(Convert.ToDouble(tempObservedTime));
        //                                    eRMSOPModule.UITempobservedTime = ConvertfloattoTimespan(Convert.ToString(Convert.ToDouble(tempObservedTime)));
        //                                    #endregion
        //                                    #endregion
        //                                }

        //                                eRMSOPModule.NormalTime = Math.Round(Convert.ToDouble(eRMSOPModule.ObservedTime * eRMSOPModule.Activity / 100), 2);
        //                                #region GEOS2-3954 gulab lakade Time format HH:mm:ss
        //                                eRMSOPModule.UITempNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(eRMSOPModule.NormalTime));

        //                                #endregion
        //                                //[GEOS2-3933][Rupali Sarode][21/09/2022]
        //                                eRMSOPModule.WORemarks = Module.WORemarks == null ? "" : Module.WORemarks.Trim();

        //                                var tempRemarks = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage)
        //                                 && w.IdCpTypeNew == (long)(eRMSOPModule.IdCpType)).Select(s => s.Remarks).DefaultIfEmpty(null).FirstOrDefault();

        //                                eRMSOPModule.Remarks = tempRemarks == null ? "" : tempRemarks.Trim();

        //                            }
        //                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(Module.Name.Trim())))
        //                            {
        //                                eRMSOPModule.IsDeleteButton = false;
        //                                eRMSOPModule.IsDeleteButtonVisibility = Visibility.Hidden;
        //                                // eRMSOPModule.ObservedTimeIsReadOnly =true;
        //                                eRMSOPModule.IsReadOnly = true;
        //                                eRMSOPModule.IsValidateOnTextInput = false;
        //                                Module.IsCurrentWorkOperation = true;
        //                            }
        //                            else
        //                            {
        //                                Module.IsCurrentWorkOperation = true;
        //                                //eRMSOPModule.ObservedTimeIsReadOnly = false;
        //                                eRMSOPModule.IsReadOnly = false;
        //                                eRMSOPModule.IsValidateOnTextInput = true;
        //                            }
        //                            if (Module.IdStatus == 1536)
        //                            {
        //                                eRMSOPModule.IsInactiveWorkOperation = true;
        //                                eRMSOPModule.IsReadOnly = true;
        //                            }
        //                            try
        //                            {
        //                                //  if (!tempWorkOperationClonedModule.Any(a => a.KeyName.Equals(Module.KeyName)))
        //                                tempWorkOperationClonedModule.Add(eRMSOPModule);
        //                            }
        //                            catch (Exception ex)
        //                            {

        //                            }

        //                            //}
        //                            //}

        //                        }


        //                        #endregion copy data to tempWorkOperationClonedModule 






        //                        #region commonCode
        //                        #region [GEOS2-5629][gulab lakade][16 07 2024]
        //                        List<StandardOperationsDictionaryModules> tempLstStandardOperationsDictionaryModules_ACCordian = new List<StandardOperationsDictionaryModules>();
        //                        tempLstStandardOperationsDictionaryModules_ACCordian = tempLstStandardOperationsDictionaryModules.Where(w => w.IdCpTypeNew == (long)(ModuleIdCPType)).ToList();
        //                        if (tempLstStandardOperationsDictionaryModules_ACCordian.Count() > 0)
        //                        {
        //                            foreach (var eRMSOPModule in tempLstStandardOperationsDictionaryModules_ACCordian)
        //                            {
        //                                //List<WorkOperationByStages> tempModuleList = WorkOperationMenulist.Where(w => w.IdworkOperationByStage ==Convert.ToInt32(eRMSOPModule.IdWorkoperation)).ToList();
        //                                //  operationMenulist.AddRange(tempModuleList);
        //                                if (eRMSOPModule != null)
        //                                {
        //                                    List<WorkOperationByStages> tempModuleList = WorkOperationMenulist.Where(w => w.IdworkOperationByStage == Convert.ToInt32(eRMSOPModule.IdWorkoperation) && w.Name == eRMSOPModule.WorkOperationName).ToList();//[Cut  work operation not work properly.][gulab lakade][24 01 2023]
        //                                    if (tempModuleList != null)
        //                                        foreach (WorkOperationByStages item in tempModuleList)
        //                                        {
        //                                            if (item.IdStatus == 1536)//[rdixit][03.08.2022][GEOS2-3764]
        //                                            {
        //                                                item.IsInactiveWorkOperation = true;
        //                                                item.IsReadOnly = true;
        //                                            }
        //                                            WorkOperationByStages ParentName = WorkOperationMenulist.Where(w => w.ParentName != null && w.KeyName.Equals(item.ParentName)).FirstOrDefault();
        //                                            if (ParentName != null)
        //                                            {
        //                                                if (!operationMenulist.Any(a => a.KeyName.Equals(ParentName.KeyName)))
        //                                                    operationMenulist.Add(ParentName);
        //                                            }
        //                                            duplicateItemloop = 0;
        //                                            GetAllTreeList(item, WorkOperationMenulist);
        //                                        }

        //                                }

        //                            }
        //                        }

        //                        //foreach (ERMSOPModule Module in tempWorkOperationClonedModule)
        //                        //{
        //                        //    WorkOperationByStages eRMSOPModule = new WorkOperationByStages();
        //                        //    eRMSOPModule.Name = Module.Name;
        //                        //    eRMSOPModule.IdworkOperationByStage = Module.IdworkOperationByStage;
        //                        //    eRMSOPModule.IdSequence = Module.IdSequence;
        //                        //    eRMSOPModule.IdStatus = Module.IdStatus;
        //                        //    eRMSOPModule.Status = Module.Status;
        //                        //    eRMSOPModule.Code = Module.Name;
        //                        //    eRMSOPModule.Parent = Module.Parent;
        //                        //    eRMSOPModule.IdParent = Module.IdParent;
        //                        //    eRMSOPModule.KeyName = Module.KeyName;
        //                        //    eRMSOPModule.ParentName = Module.ParentName;
        //                        //    eRMSOPModule.Position = Module.Position;
        //                        //    eRMSOPModule.WorkOperation_count = Module.WorkOperation_count;
        //                        //    eRMSOPModule.WorkOperation_count_original = Module.WorkOperation_count_original;
        //                        //    eRMSOPModule.NameWithWorkOperationCount = Module.NameWithWorkOperationCount;
        //                        //    eRMSOPModule.WORemarks = Module.WORemarks == null ? "" : Module.WORemarks.Trim();

        //                        //    if (Module.NormalTime != null)
        //                        //    {
        //                        //        eRMSOPModule.NormalTime = (float)Module.NormalTime;

        //                        //    }
        //                        //    eRMSOPModule.ObservedTime = (float)Module.ObservedTime;
        //                        //    operationMenulist.Add(eRMSOPModule);
        //                        //}
        //                        foreach (WorkOperationByStages Module in operationMenulist)
        //                        {
        //                            //if (Module.IdworkOperationByStage == records[0].IdworkOperationByStage)
        //                            //if (operationMenulist.Any(a => a.IdworkOperationByStage == Convert.ToInt64(Module.IdworkOperationByStage))
        //                            //       && operationMenulist.Any(a => a.IdStage == Module.IdStage)
        //                            //    && operationMenulist.Any(a => a.Name.Trim().Equals(Module.Name.Trim()))
        //                            //    )
        //                            {

        //                                ERMSOPModule eRMSOPModule = new ERMSOPModule();
        //                                eRMSOPModule.Name = Module.Name;
        //                                eRMSOPModule.IdworkOperationByStage = Module.IdworkOperationByStage;
        //                                eRMSOPModule.IdSequence = Module.IdSequence;
        //                                eRMSOPModule.IdStatus = Module.IdStatus;
        //                                eRMSOPModule.Status = Module.Status;
        //                                eRMSOPModule.Code = Module.Name;
        //                                eRMSOPModule.Parent = Module.Parent;
        //                                eRMSOPModule.IdParent = Module.IdParent;
        //                                eRMSOPModule.KeyName = Module.KeyName;
        //                                eRMSOPModule.ParentName = Module.ParentName;
        //                               // eRMSOPModule.Position = Module.Position;
        //                                #region [GEOS2-5629][gulab lakade][16 07 2024]
        //                                StandardOperationsDictionaryModules standardOperationsDictionaryModules = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(Module.IdworkOperationByStage) && Module.Parent != null
        //                               && w.IdCpTypeNew == Convert.ToInt32(ModuleIdCPType)).FirstOrDefault();

        //                                if (operationMenulist != null)
        //                                {
        //                                    if (Module.ParentName == null)
        //                                    {
        //                                        eRMSOPModule.ModulePosition = Module.Position;
        //                                    }
        //                                    else
        //                                    {
        //                                        var TempModule = operationMenulist.Where(x => x.KeyName == Module.KeyName).FirstOrDefault();
        //                                        if (TempModule != null)
        //                                        {
        //                                            eRMSOPModule.ModulePosition = TempModule.ModulePosition;
        //                                        }
        //                                        else
        //                                        {
        //                                            if (operationMenulist.Where(x => x.ParentName == Module.ParentName).FirstOrDefault() == null)
        //                                            {
        //                                                var maxpos = operationMenulist.Max(a => a.ModulePosition);
        //                                                eRMSOPModule.ModulePosition = maxpos + 1;
        //                                            }
        //                                            else
        //                                            {
        //                                                var maxpos = operationMenulist.Where(x => x.ParentName == Module.ParentName).Max(a => a.ModulePosition);
        //                                                eRMSOPModule.ModulePosition = maxpos + 1;
        //                                            }

        //                                        }
        //                                    }


        //                                }

        //                                if (standardOperationsDictionaryModules != null)
        //                                {
        //                                    eRMSOPModule.Position = Convert.ToUInt32(standardOperationsDictionaryModules.Position);
        //                                    eRMSOPModule.ModulePosition = Convert.ToUInt32(standardOperationsDictionaryModules.Position);//[GEOS2-5629][gulab lakade][10 07 2024]
        //                                    //tempmodulepos++;//[GEOS2-5629][gulab lakade][10 07 2024]
        //                                }
        //                                else
        //                                {
        //                                    eRMSOPModule.Position = Module.Position;
        //                                    eRMSOPModule.ModulePosition = Module.Position; //[GEOS2-5629][gulab lakade][10 07 2024]
        //                                }
        //                                //if (TmpModuleMenulist != null)
        //                                //{
        //                                //    if (Module.ParentName == null)
        //                                //    {
        //                                //        eRMSOPModule.ModulePosition = Module.Position;
        //                                //    }
        //                                //    else
        //                                //    {
        //                                //        var TempModule = TmpModuleMenulist.Where(x => x.KeyName == Module.KeyName).FirstOrDefault();
        //                                //        if (TempModule != null)
        //                                //        {
        //                                //            eRMSOPModule.ModulePosition = TempModule.ModulePosition;
        //                                //        }
        //                                //        else
        //                                //        {
        //                                //            if (TmpModuleMenulist.Where(x => x.ParentName == Module.ParentName).FirstOrDefault() == null)
        //                                //            {
        //                                //                var maxpos = TmpModuleMenulist.Max(a => a.ModulePosition);
        //                                //                eRMSOPModule.ModulePosition = maxpos + 1;
        //                                //            }
        //                                //            else
        //                                //            {
        //                                //                var maxpos = TmpModuleMenulist.Where(x => x.ParentName == Module.ParentName).Max(a => a.ModulePosition);
        //                                //                eRMSOPModule.ModulePosition = maxpos + 1;
        //                                //            }

        //                                //        }
        //                                //    }


        //                                //}
        //                                #endregion
        //                                eRMSOPModule.WorkOperation_count = Module.WorkOperation_count;
        //                                eRMSOPModule.WorkOperation_count_original = Module.WorkOperation_count_original;
        //                                eRMSOPModule.NameWithWorkOperationCount = Module.NameWithWorkOperationCount;
        //                                eRMSOPModule.NormalTime = Module.NormalTime;

        //                                // if (Module.IdCpType != 0)
        //                                eRMSOPModule.IdCpType = Convert.ToInt32(ModuleIdCPType);  // Assign new IdCPType
        //                                                                                          //eRMSOPModule.NameWithWorkOperationCount 
        //                                                                                          //[GEOS2-3933][Rupali Sarode][21/09/2022]
        //                                eRMSOPModule.WORemarks = Module.WORemarks == null ? "" : Module.WORemarks.Trim();

        //                                if (Module.NormalTime != null)
        //                                {
        //                                    eRMSOPModule.NormalTime = Math.Round((double)Module.NormalTime, 2);
        //                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
        //                                    eRMSOPModule.UITempNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(eRMSOPModule.NormalTime));
        //                                    #endregion
        //                                }
        //                                eRMSOPModule.ObservedTime = Module.ObservedTime;
        //                                if (Module.ObservedTime != null)
        //                                {
        //                                    eRMSOPModule.ObservedTime = Math.Round((double)Module.ObservedTime, 2);
        //                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
        //                                    eRMSOPModule.UITempobservedTime = ConvertfloattoTimespan(Convert.ToString(eRMSOPModule.ObservedTime));
        //                                    #endregion
        //                                }

        //                                if (Module.Activity != null)
        //                                    eRMSOPModule.Activity = Module.Activity;

        //                                if (Module.Activity != 0 && Module.Activity != null)
        //                                    eRMSOPModule.Activity = Math.Round((double)Module.Activity, 2);
        //                                if (eRMSOPModule.Activity == 0)
        //                                    eRMSOPModule.Activity = null;

        //                                if (GetStages.Any(a => a != null && a.Code.Trim().Equals(Module.Name.Trim())))
        //                                {
        //                                    //    Module.IsCurrentWorkOperation = true;
        //                                    eRMSOPModule.IsDeleteButton = false;
        //                                    eRMSOPModule.IsDeleteButtonVisibility = Visibility.Hidden;
        //                                    eRMSOPModule.IsValidateOnTextInput = false;
        //                                }
        //                                else
        //                                {
        //                                    //  Module.IsCurrentWorkOperation = true;
        //                                    eRMSOPModule.IsValidateOnTextInput = true;
        //                                }
        //                                if (Module.IdStatus == 1536)
        //                                {
        //                                    eRMSOPModule.IsInactiveWorkOperation = true;

        //                                }
        //                                else
        //                                {

        //                                }
        //                                try
        //                                {
        //                                    if (!TmpModuleMenulist.Any(a => a.KeyName.Equals(Module.KeyName)))
        //                                    {
        //                                        TmpModuleMenulist.Add(eRMSOPModule);
        //                                    }

        //                                }
        //                                catch (Exception ex)
        //                                {

        //                                }

        //                            }

        //                        }
        //                        //foreach (ERMSOPModule Module in ModuleMenulist)
        //                        //{
        //                        //    //if (Module.IdworkOperationByStage == records[0].IdworkOperationByStage)
        //                        //    if (operationMenulist.Any(a => a.IdworkOperationByStage == Convert.ToInt64(Module.IdworkOperationByStage))
        //                        //           && operationMenulist.Any(a => a.IdStage == Module.IdStage)
        //                        //        && operationMenulist.Any(a => a.Name.Trim().Equals(Module.Name.Trim()))
        //                        //        )
        //                        //    {

        //                        //        ERMSOPModule eRMSOPModule = new ERMSOPModule();
        //                        //        eRMSOPModule.Name = Module.Name;
        //                        //        eRMSOPModule.IdworkOperationByStage = Module.IdworkOperationByStage;
        //                        //        eRMSOPModule.IdSequence = Module.IdSequence;
        //                        //        eRMSOPModule.IdStatus = Module.IdStatus;
        //                        //        eRMSOPModule.Status = Module.Status;
        //                        //        eRMSOPModule.Code = Module.Name;
        //                        //        eRMSOPModule.Parent = Module.Parent;
        //                        //        eRMSOPModule.IdParent = Module.IdParent;
        //                        //        eRMSOPModule.KeyName = Module.KeyName;
        //                        //        eRMSOPModule.ParentName = Module.ParentName;
        //                        //        eRMSOPModule.Position = Module.Position;
        //                        //        #region [GEOS2-5629][gulab lakade][16 07 2024]
        //                        //        if (TmpModuleMenulist != null)
        //                        //        {
        //                        //            if (Module.ParentName == null)
        //                        //            {
        //                        //                eRMSOPModule.ModulePosition = Module.Position;
        //                        //            }
        //                        //            else
        //                        //            {
        //                        //                var TempModule = TmpModuleMenulist.Where(x => x.KeyName == Module.KeyName).FirstOrDefault();
        //                        //                if (TempModule != null)
        //                        //                {
        //                        //                    eRMSOPModule.ModulePosition = TempModule.ModulePosition;
        //                        //                }
        //                        //                else
        //                        //                {
        //                        //                    if (TmpModuleMenulist.Where(x => x.ParentName == Module.ParentName).FirstOrDefault() == null)
        //                        //                    {
        //                        //                        var maxpos = TmpModuleMenulist.Max(a => a.ModulePosition);
        //                        //                        eRMSOPModule.ModulePosition = maxpos + 1;
        //                        //                    }
        //                        //                    else
        //                        //                    {
        //                        //                        var maxpos = TmpModuleMenulist.Where(x => x.ParentName == Module.ParentName).Max(a => a.ModulePosition);
        //                        //                        eRMSOPModule.ModulePosition = maxpos + 1;
        //                        //                    }

        //                        //                }
        //                        //            }


        //                        //        }
        //                        //        #endregion
        //                        //        eRMSOPModule.WorkOperation_count = Module.WorkOperation_count;
        //                        //        eRMSOPModule.WorkOperation_count_original = Module.WorkOperation_count_original;
        //                        //        eRMSOPModule.NameWithWorkOperationCount = Module.NameWithWorkOperationCount;
        //                        //        eRMSOPModule.NormalTime = Module.NormalTime;

        //                        //        if (Module.IdCpType != 0)
        //                        //            eRMSOPModule.IdCpType = Convert.ToInt32(ModuleIdCPType);  // Assign new IdCPType
        //                        //                                                                      //eRMSOPModule.NameWithWorkOperationCount 
        //                        //                                                                      //[GEOS2-3933][Rupali Sarode][21/09/2022]
        //                        //        eRMSOPModule.WORemarks = Module.WORemarks == null ? "" : Module.WORemarks.Trim();

        //                        //        if (Module.NormalTime != null)
        //                        //        {
        //                        //            eRMSOPModule.NormalTime = Math.Round((double)Module.NormalTime, 2);
        //                        //            #region GEOS2-3954 gulab lakade Time format HH:mm:ss
        //                        //            eRMSOPModule.UITempNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(eRMSOPModule.NormalTime));
        //                        //            #endregion
        //                        //        }
        //                        //        eRMSOPModule.ObservedTime = Module.ObservedTime;
        //                        //        if (Module.ObservedTime != null)
        //                        //        {
        //                        //            eRMSOPModule.ObservedTime = Math.Round((double)Module.ObservedTime, 2);
        //                        //            #region GEOS2-3954 gulab lakade Time format HH:mm:ss
        //                        //            eRMSOPModule.UITempobservedTime = ConvertfloattoTimespan(Convert.ToString(eRMSOPModule.ObservedTime));
        //                        //            #endregion
        //                        //        }

        //                        //        if (Module.Activity != null)
        //                        //            eRMSOPModule.Activity = Module.Activity;

        //                        //        if (Module.Activity != 0 && Module.Activity != null)
        //                        //            eRMSOPModule.Activity = Math.Round((double)Module.Activity, 2);
        //                        //        if (eRMSOPModule.Activity == 0)
        //                        //            eRMSOPModule.Activity = null;

        //                        //        if (GetStages.Any(a => a != null && a.Code.Trim().Equals(Module.Name.Trim())))
        //                        //        {
        //                        //            //    Module.IsCurrentWorkOperation = true;
        //                        //            eRMSOPModule.IsDeleteButton = false;
        //                        //            eRMSOPModule.IsDeleteButtonVisibility = Visibility.Hidden;
        //                        //            eRMSOPModule.IsValidateOnTextInput = false;
        //                        //        }
        //                        //        else
        //                        //        {
        //                        //            //  Module.IsCurrentWorkOperation = true;
        //                        //            eRMSOPModule.IsValidateOnTextInput = true;
        //                        //        }
        //                        //        if (Module.IdStatus == 1536)
        //                        //        {
        //                        //            eRMSOPModule.IsInactiveWorkOperation = true;

        //                        //        }
        //                        //        else
        //                        //        {

        //                        //        }
        //                        //        try
        //                        //        {
        //                        //            if (!TmpModuleMenulist.Any(a => a.KeyName.Equals(Module.KeyName)))
        //                        //            {
        //                        //                TmpModuleMenulist.Add(eRMSOPModule);
        //                        //            }

        //                        //        }
        //                        //        catch (Exception ex)
        //                        //        {

        //                        //        }

        //                        //    }

        //                        //}

        //#endregion


        //                        #endregion


        //                        // }
        //                        ////var tempWorkOperationMenulist2 = ModuleMenulist.OrderBy(x => x.Position).ToList();
        //                        ////ModuleMenulist.Clear();
        //                        ////ModuleMenulist.AddRange(tempWorkOperationMenulist2);
        //                        ////if (tempWorkOperationMenulist2 != null)
        //                        ////    tempWorkOperationMenulist2.Clear();
        //                        ////FillmoduleGridColumn();
        //                        ////CustomSummarycalculation();
        //                        e.Handled = true;
        //                    }
        //                    if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
        //                }
        //                GeosApplication.Instance.Logger.Log("Method CompleteDropRecordModuleGridForAccordian()....executed successfully", category: Category.Info, priority: Priority.Low);
        //            }
        //            catch (Exception ex)
        //            {
        //                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
        //                GeosApplication.Instance.Logger.Log("Get an error in Method CompleteDropRecordModuleGridForAccordian()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
        //            }
        //        }

        #endregion

        #region [GEOS2-3922][Rupali Sarode][05-11-2022]
        private void DetectionAccordionControl_Drop(DragEventArgs e)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method DetectionAccordionControl_Drop()...", category: Category.Info, priority: Priority.Low);

                e.Effects = DragDropEffects.None;
                e.Handled = true;

                //MessageBoxResult MessageBoxResult = CustomMessageBox.Show(String.Format(Application.Current.Resources["AddEditSODCopyWorkOperationConfirmation"].ToString()), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                //if (MessageBoxResult == MessageBoxResult.Yes)
                //{
                e.Effects = DragDropEffects.Copy;
                //  if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }
                CompleteDropRecorDetectionGridForAccordian(e);
                //  if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                e.Handled = true;
                //}
                GeosApplication.Instance.Logger.Log("Method DetectionAccordionControl_Drop()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {

                GeosApplication.Instance.Logger.Log(string.Format("Error in method DetectionAccordionControl_Drop() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }

        }


        #region gulab 05 08 2024
        List<ERMSOPDetection> tmpolddetectionlist = new List<ERMSOPDetection>();
        private void oldRecordDetectionGridForAccordian(List<WorkOperationByStages> tmpchildmodule)
        {
            //tmpoldmodulelist = new List<ERMSOPModule>();
            foreach (var child in tmpchildmodule)
            {
                if (child.ParentName == null)
                {
                    ERMSOPDetection childrecord = new ERMSOPDetection();
                    childrecord.Name = child.Name;
                    childrecord.IdworkOperationByStage = child.IdworkOperationByStage;
                    childrecord.IdSequence = child.IdSequence;
                    childrecord.IdStatus = child.IdStatus;
                    childrecord.Status = child.Status;
                    childrecord.Code = child.Name;
                    childrecord.Parent = child.Parent;
                    childrecord.IdParent = child.IdParent;
                    childrecord.KeyName = child.KeyName;
                    childrecord.ParentName = child.ParentName;
                    childrecord.Position = Convert.ToUInt32(child.Position);
                    childrecord.DetectionPosition = Convert.ToUInt32(child.Position);
                    tmpolddetectionlist.Add(childrecord);
                }
                else
                {
                    List<WorkOperationByStages> tmpchildmodule1 = WorkOperationMenulist.Where(a => a.KeyName == child.ParentName).ToList();
                    if (tmpchildmodule1.Count() > 0)
                    {
                        oldRecordDetectionGridForAccordian(tmpchildmodule1);
                    }

                    //tmpoldmodulelist.AddRange();
                }

            }

            // return tmpoldmodulelist;
        }

        #endregion
        private void CompleteDropRecorDetectionGridForAccordian(DragEventArgs e)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method CompleteDropRecorDetectionGridForAccordian()...", category: Category.Info, priority: Priority.Low);
                //if (!DXSplashScreen.IsActive)
                //{
                //    DXSplashScreen.Show(x =>
                //    {
                //        Window win = new Window()
                //        {
                //            ShowActivated = false,
                //            WindowStyle = WindowStyle.None,
                //            ResizeMode = ResizeMode.NoResize,
                //            AllowsTransparency = true,
                //            Background = new SolidColorBrush(Colors.Transparent),
                //            ShowInTaskbar = false,
                //            Topmost = true,
                //            SizeToContent = SizeToContent.WidthAndHeight,
                //            WindowStartupLocation = WindowStartupLocation.CenterScreen,
                //        };
                //        WindowFadeAnimationBehavior.SetEnableAnimation(win, true);
                //        win.Topmost = false;
                //        return win;
                //    }, x =>
                //    {
                //        return new SplashScreenView() { DataContext = new SplashScreenViewModel() };
                //    }, null, null);
                //}

                if (SelectedItemDetection is ERMDetections)
                {

                    //IsEnabledSaveButton = true;
                    //SaveButtonVisibility = Visibility.Visible;
                    ulong tmpIdWorkOperation = 0;
                    duplicateItemloopDetection = 0;
                    //if ((e.IsFromOutside) && typeof(WorkOperationByStages).IsAssignableFrom(e.GetRecordType()))
                    //{
                    //WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                    var data = (RecordDragDropData)e.Data.GetData(typeof(RecordDragDropData));
                    List<WorkOperationByStages> found = new List<WorkOperationByStages>();
                    List<WorkOperationByStages> TempfoundAllrecords = new List<WorkOperationByStages>();
                    //List<WorkOperationByStages> records = data.Records.OfType<WorkOperationByStages>().ToList();
                    List<ERMSOPDetection> records = data.Records.OfType<ERMSOPDetection>().ToList();

                    AccordionItem itemModule = LayoutTreeHelper.GetVisualParents((DependencyObject)e.OriginalSource).OfType<AccordionItem>().FirstOrDefault();
                    ERMDetections DetectionHeader = (ERMDetections)itemModule.Header;
                    var HeaderDetectionId = DetectionHeader.IdDetection;


                    //If user added from work operation left tab & 
                    //without save user dragged & drop, then first allow user to first save it.
                    //if (IsEnabledSaveButton && SaveButtonVisibility == Visibility.Visible)
                    Saveselecteditem = "Detection";
                    if (FlagToDragDrop == true)
                    {
                        if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                        MessageBoxResult MessageBoxResult = MessageBoxResult = CustomMessageBox.Show(string.Format(Application.Current.Resources["AddEditSODSaveWOBeforeDrag"].ToString()), "Yellow", CustomMessageBox.MessageImagePath.Warning, MessageBoxButton.YesNo);
                        if (MessageBoxResult == MessageBoxResult.Yes)
                        {
                            if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }
                            ISSavechanges = true;
                            IsEnabledSaveButton = false;
                            ////SelectedItemOldclone = SelectedItem;
                            ////SelectedItem = SelectedItemOld;
                            ////var tempSelectedItem = SelectedItemOldclone;
                            SaveButtonCommandAction();
                            ISSavechanges = false;
                            ////SelectedItem = tempSelectedItem;

                            //AcceptButtonCommandAction(null);
                            if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                            #region [GEOS2-4830][gulab lakade][07 12 2023]
                            //SelectedItemDetection = SelectedItemOldDetection;
                            //if (SelectedItemOldcloneDetection != null)
                            //    SelectedItemDetection = SelectedItemOldcloneDetection;

                            if (SelectedItemOldcloneDetection != null)
                            {
                                SelectedItemDetection = SelectedItemOldcloneDetection;
                            }
                            else
                            {
                                SelectedItemDetection = SelectedItemOldDetection;
                            }

                            #endregion
                            /*   SelectedItemOption = SelectedItemOldOption;
                               if (SelectedItemOldcloneOption != null)
                                   SelectedItemOption = SelectedItemOldcloneOption;
                               ////GEOS2-3838 - Way
                               SelectedItemWay = SelectedItemOldWay;
                               if (SelectedItemOldcloneWay != null)
                                   SelectedItemWay = SelectedItemOldcloneWay;
                               //[GEOS2-3601] - Structure
                               SelectedItemStructures = SelectedItemOldStructure;
                               if (SelectedItemOldcloneStructure != null)
                                   SelectedItemStructures = SelectedItemOldcloneStructure; */

                            return;
                        }

                        if (MessageBoxResult == MessageBoxResult.No)
                        {
                            TmpModuleMenulist = null;
                            TmpDetectionMenulist = null;
                            TmpOptionMenulist = null;
                            TmpStructureMenulist = null;
                            TmpWayMenulist = null;
                            TmpSparePartsMenulist = null;
                            FlagToDragDrop = false;
                            TmpIdCPType = 0;
                            TmpIdDetection = 0;
                            TmpIdOption = 0;
                            TmpIdWayType = 0;
                            TmpIdStructure = 0;
                            TmpIdSpareParts = 0;
                            return;
                        }

                    }

                    MessageBoxResult MsgBoxResult = CustomMessageBox.Show(String.Format(Application.Current.Resources["AddEditSODCopyWorkOperationConfirmation"].ToString()), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                    if (MsgBoxResult == MessageBoxResult.Yes)
                    {




                        IsEnabledSaveButton = true;
                        SaveButtonVisibility = Visibility.Visible;

                        if (records.Count == 0)  // Dragging work operation from left panal is not allowed
                        {
                            CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("AddEditSODCopyWorkOperationNotAllowed").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                            return;
                        }



                        if (TmpIdDetection == 0)
                            TmpIdDetection = (ulong)HeaderDetectionId;

                        if (TmpIdDetection != 0 && TmpIdDetection != (ulong)HeaderDetectionId) // if copied to different cptype without saving then popup the message
                        {
                            CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("AddEditSODCopyWOSavePreviousCopiedWO").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                            return;
                        }

                        if (TmpDetectionMenulist == null)
                        {
                            TmpDetectionMenulist = new ObservableCollection<ERMSOPDetection>();
                        }


                        if (HeaderDetectionId == Convert.ToInt32(records[0].IdDetection))  // Dragging in same CP type is not allowed
                        {
                            CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("AddEditSODCopyWorkOperationInSameCPtype").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                            return;
                        }

                        tmpIdWorkOperation = tempLstStandardOperationsDictionaryDetection.Where(w => w.IdWorkoperation == Convert.ToUInt64(records[0].IdworkOperationByStage)
                          && w.IdDetection == Convert.ToUInt64(HeaderDetectionId)).Select(s => s.IdWorkoperation).FirstOrDefault();

                        if (tmpIdWorkOperation == 0)
                        {
                            tmpIdWorkOperation = Convert.ToUInt64(TmpDetectionMenulist.Where(w => w.IdworkOperationByStage == Convert.ToInt32(records[0].IdworkOperationByStage)
                                && w.IdDetection == (ulong)HeaderDetectionId).Select(s => s.IdworkOperationByStage).FirstOrDefault());
                        }

                        if (tmpIdWorkOperation > 0)
                        {
                            MessageBoxResult MessageBoxResult = CustomMessageBox.Show(String.Format(Application.Current.Resources["AddEditSODCopyWorkOperationAlreadyExists"].ToString()), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                            if (MessageBoxResult == MessageBoxResult.No)
                            {
                                return;
                            }
                        }

                        List<WorkOperationByStages> tmpChildList = WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(records[0].KeyName)).ToList();
                        if (tmpChildList.Count > 0)
                        {
                            foreach (WorkOperationByStages child in tmpChildList)
                            {
                                tmpIdWorkOperation = tempLstStandardOperationsDictionaryDetection.Where(w => w.IdWorkoperation == Convert.ToUInt64(child.IdworkOperationByStage)
                                && w.IdDetection == Convert.ToUInt64(HeaderDetectionId)).Select(s => s.IdWorkoperation).FirstOrDefault();
                                if (tmpIdWorkOperation > 0)
                                {
                                    MessageBoxResult MessageBoxResult = CustomMessageBox.Show(String.Format(Application.Current.Resources["AddEditSODCopyWorkOperationAlreadyExists"].ToString()), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                                    if (MessageBoxResult == MessageBoxResult.No)
                                    {
                                        return;
                                    }
                                    if (MessageBoxResult == MessageBoxResult.Yes)
                                        break;
                                }

                            }

                            if (tmpIdWorkOperation == 0)
                            {
                                foreach (WorkOperationByStages child in tmpChildList)
                                {
                                    tmpIdWorkOperation = Convert.ToUInt64(TmpDetectionMenulist.Where(w => w.IdWorkoperation == child.IdworkOperationByStage
                                    && w.IdDetection == Convert.ToUInt64(HeaderDetectionId)).Select(s => s.IdWorkoperation).FirstOrDefault());
                                    if (tmpIdWorkOperation > 0)
                                    {
                                        MessageBoxResult MessageBoxResult = CustomMessageBox.Show(String.Format(Application.Current.Resources["AddEditSODCopyWorkOperationAlreadyExists"].ToString()), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                                        if (MessageBoxResult == MessageBoxResult.No)
                                        {
                                            return;
                                        }
                                    }

                                }

                            }

                        }

                        // [GEOS2-4108][Rupali Sarode][04-01-2023]
                        TempDetectionSelectedCopy = DetectionHeader;

                        operationDetectionMenulist = new ObservableCollection<WorkOperationByStages>();
                        int count = 0;
                        if (TmpDetectionMenulist == null)
                        {
                            TmpDetectionMenulist = new ObservableCollection<ERMSOPDetection>();
                        }

                        if (records.Any(a => a.Name.Equals("All")))
                        {
                            #region ALL
                            found = new List<WorkOperationByStages>();
                            operationDetectionMenulist = new ObservableCollection<WorkOperationByStages>();
                            operationDetectionMenulist.AddRange(WorkOperationMenulist.Where(w => !w.Name.Equals("All")));
                            #endregion
                        }
                        else
                        {

                            for (int r = 0; r < records.Count(); r++)
                            {
                                if (!TmpDetectionMenulist.Any(a => a.Name.Equals(records[r].Name)))
                                {
                                    // if (records[r].IdStatus != 1536) [rdixit][GEOS2-3764][04.08.2022]
                                    //  {
                                    //////records[r].IsCurrentWorkOperation = true;
                                    ////////DetectionMenulist.Add(JsonConvert.DeserializeObject<ERMSOPDetection>(JsonConvert.SerializeObject(records[r])));
                                    //////if (!operationDetectionMenulist.Any(a => a.KeyName.Equals(records[r].KeyName)))
                                    //////    operationDetectionMenulist.Add(records[r]);
                                    // }


                                }

                                if (GetStages.Any(a => a != null && a.Code.Trim().Equals(records[r].Name.Trim())))
                                {
                                    found.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(records[r].KeyName)).ToList());
                                    int x = 0;
                                    Loop:
                                    x++;
                                    if (x < 4)
                                    {
                                        for (int i = 0; i < found.Count(); i++)
                                        {
                                            TempfoundAllrecords.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(found[i].KeyName)).ToList());
                                        }
                                        for (int i = 0; i < TempfoundAllrecords.Count(); i++)
                                        {
                                            if (!found.Any(a => a != null && a.KeyName.Trim().Equals(TempfoundAllrecords[i].KeyName.Trim())))
                                                found.Add(TempfoundAllrecords[i]);
                                        }
                                        goto Loop;
                                    }

                                }
                                else
                                {
                                    found.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(records[r].KeyName)).ToList());
                                    for (int i = 0; i < found.Count(); i++)
                                    {
                                        TempfoundAllrecords.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(found[i].KeyName)).ToList());
                                    }
                                    for (int i = 0; i < TempfoundAllrecords.Count(); i++)
                                    {
                                        if (!found.Any(a => a != null && a.KeyName.Trim().Equals(TempfoundAllrecords[i].KeyName.Trim())))
                                            found.Add(TempfoundAllrecords[i]);
                                    }
                                    for (int i = 0; i < records.Where(a => a.IdworkOperationByStage > 0).Count(); i++)
                                    {
                                        if (!found.Any(a => a != null && a.KeyName.Trim().Equals(records[i].KeyName.Trim())))
                                            found.AddRange(WorkOperationMenulist.Where(s => s.IdworkOperationByStage == records[i].IdworkOperationByStage).ToList());
                                        if (found.Count() != 0)
                                        {
                                            count++;
                                        }
                                    }
                                }

                            }
                        }


                        if (count > 0)
                        {
                            for (int i = 0; i < found.Count(); i++)
                            {
                                if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(found[i].Name.Trim())))
                                {
                                    duplicateItemloopDetection = 0;
                                    GetAllTreeListDetection(found[i], WorkOperationMenulist);
                                }

                            }
                        }
                        else
                        {

                            if (!records.Any(a => a.Name.Equals("All")))
                                foreach (WorkOperationByStages item in found)
                                {
                                    duplicateItemloopDetection = 0;
                                    GetAllTreeListDetection(item, WorkOperationMenulist);
                                }
                        }
                        if (!records.Any(a => a.Name.Equals("All")))
                            if (operationDetectionMenulist != null)
                            {
                                var tempModuleMenulist = operationDetectionMenulist.ToList();
                                for (int i = 0; i < tempModuleMenulist.Count; i++)
                                {
                                    if (GetStages.Any(a => a.Code.Equals(tempModuleMenulist[i].Name)))
                                    {
                                        List<WorkOperationByStages> childList = operationDetectionMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(tempModuleMenulist[i].KeyName)).ToList();
                                        if (childList.Count == 0)
                                        {
                                            operationDetectionMenulist.Remove(tempModuleMenulist[i]);
                                        }
                                    }
                                }
                            }

                        #region Check for Head parent whose parent is null like CUT, CAM etc
                        ulong tempWOId = 0;
                        if (GetStages.Any(a => a != null && a.Code.Trim().Equals(records[0].Name.Trim())))
                        {

                            foreach (WorkOperationByStages wo in operationDetectionMenulist)
                            {
                                tempWOId = tempLstStandardOperationsDictionaryDetection.Where(w => w.IdWorkoperation == Convert.ToUInt64(wo.IdworkOperationByStage)
                                && w.IdDetection == Convert.ToUInt64(HeaderDetectionId)).Select(s => s.IdWorkoperation).FirstOrDefault();
                                if (tempWOId > 0)
                                    break;

                            }

                            if (tempWOId > 0)
                            {
                                MessageBoxResult MessageBoxResult = CustomMessageBox.Show(String.Format(Application.Current.Resources["AddEditSODCopyWOSaveAlreadyExistsStage"].ToString()), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                                if (MessageBoxResult == MessageBoxResult.No)
                                {
                                    return;
                                }
                            }
                        }

                        #endregion Check for Head parent whose parent is null like CUT, CAM etc

                        #region copy data to tempWorkOperationClonedDetection

                        tempWorkOperationClonedDetection = new List<ERMSOPDetection>();
                        var SelectedCPTypesItems = tempLstStandardOperationsDictionaryDetection.Where(w => w.IdDetection == Convert.ToUInt64(HeaderDetectionId)).ToList();


                        for (int i = 0; i < SelectedCPTypesItems.Count; i++)
                        {
                            ERMSOPDetection eRMSOPModule = new ERMSOPDetection();

                            WorkOperationByStages Module = new WorkOperationByStages();
                            Module = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == Convert.ToInt64(SelectedCPTypesItems[i].IdWorkoperation)).FirstOrDefault();

                            eRMSOPModule.IdDetection = SelectedCPTypesItems[i].IdDetection;
                            eRMSOPModule.Name = Module.Name;
                            eRMSOPModule.IdworkOperationByStage = Module.IdworkOperationByStage;
                            eRMSOPModule.IdSequence = Module.IdSequence;
                            eRMSOPModule.IdStatus = Module.IdStatus;
                            eRMSOPModule.Status = Module.Status;
                            eRMSOPModule.Code = Module.Name;
                            eRMSOPModule.Parent = Module.Parent;
                            eRMSOPModule.IdParent = Module.IdParent;
                            eRMSOPModule.KeyName = Module.KeyName;
                            eRMSOPModule.ParentName = Module.ParentName;
                            //eRMSOPModule.Position = Module.Position;
                            eRMSOPModule.Position = Convert.ToUInt32(SelectedCPTypesItems[i].Position);//[GEOS2-5629][gulab lakade][16 07 2024]
                            eRMSOPModule.DetectionPosition = Convert.ToUInt32(SelectedCPTypesItems[i].DetectionPosition);//[GEOS2-5629][gulab lakade][16 07 2024]
                            eRMSOPModule.WorkOperation_count = Module.WorkOperation_count;
                            eRMSOPModule.WorkOperation_count_original = Module.WorkOperation_count_original;
                            eRMSOPModule.NameWithWorkOperationCount = Module.NameWithWorkOperationCount;
                            //[rdixit][03.08.2022][GEOS2-3764]
                            eRMSOPModule.IsReadOnly = Module.IsReadOnly;
                            eRMSOPModule.IsInactiveWorkOperation = Module.IsInactiveWorkOperation;

                            if (!GetStages.Any(a => a.Code.Equals(eRMSOPModule.Name)))
                            {
                                var tempActivity = tempLstStandardOperationsDictionaryDetection.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage)
                                 && w.IdDetection == Convert.ToUInt64(eRMSOPModule.IdDetection)).Select(s => s.Activity).DefaultIfEmpty(null).FirstOrDefault();
                                var tempObservedTime = tempLstStandardOperationsDictionaryDetection.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage)
                                 && w.IdDetection == Convert.ToUInt64(eRMSOPModule.IdDetection)).Select(s => s.ObservedTime).DefaultIfEmpty(null).FirstOrDefault();

                                #region [GEOS2-4073][Rupali Sarode][09-12-2022]
                                var tempDetection = tempLstStandardOperationsDictionaryDetection.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage)
                                && w.IdDetection == Convert.ToUInt64(eRMSOPModule.IdDetection)).FirstOrDefault();

                                if (tempDetection != null)
                                {
                                    if (tempDetection.IdWorkoperation == Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage) && (tempActivity == null || tempActivity == 0))
                                        tempActivity = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == Module.IdworkOperationByStage).Select(b => b.Activity).FirstOrDefault();

                                    if (tempDetection.IdWorkoperation == Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage) && (tempObservedTime == null || tempObservedTime == 0))
                                        tempObservedTime = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == Module.IdworkOperationByStage).Select(b => b.ObservedTime).FirstOrDefault();
                                }

                                #endregion

                                if (tempActivity != null)
                                    eRMSOPModule.DetectionActivity = Math.Round((double)tempActivity, 2);
                                //if (tempObservedTime != null)
                                //    eRMSOPModule.ObservedTime = Math.Round((double)tempObservedTime, 2);
                                if (tempObservedTime != null)
                                {
                                    eRMSOPModule.DetectionObservedTime = Math.Round((double)tempObservedTime, 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    //  eRMSOPModule.UITempDetectionobservedTime = tempLstStandardOperationsDictionaryDetection.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage)
                                    //  && w.IdDetection == Convert.ToUInt64(eRMSOPModule.IdDetection)).Select(s => s.UITempDetectionobservedTime).FirstOrDefault();

                                    eRMSOPModule.UITempDetectionobservedTime = TimeSpan.FromMinutes(Convert.ToDouble(tempObservedTime));

                                    #endregion
                                }

                                eRMSOPModule.DetectionNormalTime = Math.Round(Convert.ToDouble(eRMSOPModule.DetectionObservedTime * eRMSOPModule.DetectionActivity / 100), 2);
                                #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                eRMSOPModule.UITempDetectionNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(eRMSOPModule.DetectionNormalTime));

                                #endregion
                                //[GEOS2-3933][Rupali Sarode][21/09/2022]
                                eRMSOPModule.WORemarks = Module.WORemarks == null ? "" : Module.WORemarks.Trim();

                                var tempRemarks = tempLstStandardOperationsDictionaryDetection.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage)
                                 && w.IdDetection == Convert.ToUInt64(eRMSOPModule.IdDetection)).Select(s => s.Remarks).DefaultIfEmpty(null).FirstOrDefault();

                                eRMSOPModule.Remarks = tempRemarks == null ? "" : tempRemarks.Trim();

                            }
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(Module.Name.Trim())))
                            {
                                eRMSOPModule.IsDeleteButton = false;
                                eRMSOPModule.IsDeleteButtonVisibility = Visibility.Hidden;
                                // eRMSOPModule.ObservedTimeIsReadOnly =true;
                                eRMSOPModule.IsReadOnly = true;
                                eRMSOPModule.IsValidateOnTextInput = false;
                                Module.IsCurrentWorkOperation = true;
                            }
                            else
                            {
                                Module.IsCurrentWorkOperation = true;
                                //eRMSOPModule.ObservedTimeIsReadOnly = false;
                                eRMSOPModule.IsReadOnly = false;
                                eRMSOPModule.IsValidateOnTextInput = true;
                            }
                            if (Module.IdStatus == 1536)
                            {
                                eRMSOPModule.IsInactiveWorkOperation = true;
                                eRMSOPModule.IsReadOnly = true;
                            }
                            try
                            {
                                //  if (!tempWorkOperationClonedModule.Any(a => a.KeyName.Equals(Module.KeyName)))
                                tempWorkOperationClonedDetection.Add(eRMSOPModule);
                            }
                            catch (Exception ex)
                            {

                            }

                            //}
                            //}
                        }


                        #endregion copy data to tempWorkOperationClonedDetection 

                        #region commonCode
                        #region [GEOS2-5629][gulab lakade][16 07 2024]
                        List<StandardOperationsDictionaryDetection> tempStandardOperationsDictionaryDetection_ACCordian = tempLstStandardOperationsDictionaryDetection.Where(w => w.IdDetection == Convert.ToUInt64(DetectionHeader.IdDetection)).ToList();
                        // DetectionMenulist = new ObservableCollection<ERMSOPDetection>();
                        // operationDetectionMenulist = new ObservableCollection<WorkOperationByStages>();
                        duplicateItemloopDetection = 0;
                        duplicateItemloop = 0;
                        if (tempStandardOperationsDictionaryDetection_ACCordian.Count() > 0)
                        {
                            foreach (var eRMSOPDetection in tempStandardOperationsDictionaryDetection_ACCordian)
                            {
                                if (eRMSOPDetection != null)
                                {
                                    List<WorkOperationByStages> tempDetectionList = WorkOperationMenulist.Where(w => w.IdworkOperationByStage == Convert.ToInt32(eRMSOPDetection.IdWorkoperation) && w.Name == eRMSOPDetection.WorkOperationName).ToList(); //[Cut  work operation not work properly.][gulab lakade][24 01 2023]
                                    if (tempDetectionList != null)
                                        foreach (WorkOperationByStages item in tempDetectionList)
                                        {
                                            if (item.IdStatus == 1536)//[rdixit][03.08.2022][GEOS2-3764]
                                            {
                                                item.IsInactiveWorkOperation = true;
                                                item.IsReadOnly = true;
                                            }
                                            WorkOperationByStages ParentName = WorkOperationMenulist.Where(w => w.KeyName.Equals(item.ParentName)).FirstOrDefault();
                                            if (ParentName != null)
                                            {
                                                if (!operationDetectionMenulist.Any(a => a.KeyName.Equals(ParentName.KeyName)))
                                                    operationDetectionMenulist.Add(ParentName);
                                            }
                                            duplicateItemloopDetection = 0;
                                            duplicateItemloop = 0;
                                            GetAllTreeListDetection(item, WorkOperationMenulist);
                                        }

                                }

                            }
                        }
                        #region gulab lakade beta changes 05 08 2024
                        if (tempWorkOperationClonedDetection != null && tempWorkOperationClonedDetection.Count() > 0)
                        {
                            tmpolddetectionlist = new List<ERMSOPDetection>();
                            foreach (ERMSOPDetection itemdetection in tempWorkOperationClonedDetection)
                            {
                                records.Add(itemdetection);
                                var tmpmodule = WorkOperationMenulist.Where(a => a.KeyName == itemdetection.ParentName).ToList();
                                if (tmpmodule.Count() > 0)
                                {
                                    foreach (var child in tmpmodule)
                                    {
                                        if (child.ParentName == null)
                                        {
                                            ERMSOPDetection childrecord = new ERMSOPDetection();
                                            childrecord.Name = child.Name;
                                            childrecord.IdworkOperationByStage = child.IdworkOperationByStage;
                                            childrecord.IdSequence = child.IdSequence;
                                            childrecord.IdStatus = child.IdStatus;
                                            childrecord.Status = child.Status;
                                            childrecord.Code = child.Name;
                                            childrecord.Parent = child.Parent;
                                            childrecord.IdParent = child.IdParent;
                                            childrecord.KeyName = child.KeyName;
                                            childrecord.ParentName = child.ParentName;
                                            childrecord.Position = Convert.ToUInt32(child.Position);
                                            childrecord.DetectionPosition = Convert.ToUInt32(child.Position);
                                            tmpolddetectionlist.Add(childrecord);
                                        }
                                        else
                                        {
                                            var tmpchildmodule = WorkOperationMenulist.Where(a => a.KeyName == child.ParentName).ToList();
                                            if (tmpchildmodule.Count() > 0)
                                            {
                                                oldRecordDetectionGridForAccordian(tmpchildmodule);
                                            }
                                        }

                                    }
                                }
                            }

                            records.AddRange(tmpolddetectionlist);
                            tmpolddetectionlist = new List<ERMSOPDetection>();
                            //records.AddRange(tempWorkOperationClonedDetection);
                        }
                        #endregion
                        List<ERMSOPDetection> ACC_DetectionList = new List<ERMSOPDetection>();
                        ////foreach (ERMSOPDetection Detection in DetectionMenulist)
                        bool FlagAddItemModule = false;
                        foreach (var Detection in operationDetectionMenulist)
                        {
                            // if (Detection.IdStatus != 1536) [rdixit][GEOS2-3764][04.08.2022]
                            //if (operationDetectionMenulist.Any(a => a.IdworkOperationByStage == Convert.ToInt64(Detection.IdworkOperationByStage))
                            //       && operationDetectionMenulist.Any(a => a.IdStage == Detection.IdStage)
                            //    && operationDetectionMenulist.Any(a => a.Name.Trim().Equals(Detection.Name.Trim()))
                            //    )
                            #region  [GEOS2-5135][Rupali Sarode][18-12-2023]
                            FlagAddItemModule = true;
                            // If it is child & only active then add
                            List<WorkOperationByStages> childListInActiveDraft = operationDetectionMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(Detection.KeyName)).ToList();

                            if (childListInActiveDraft.Count == 0)
                            {
                                if (Detection.IdStatus == 1535)
                                {
                                    FlagAddItemModule = true;
                                }
                                else
                                    FlagAddItemModule = false;
                            }
                            else // If it is parent and does not contain any active child, then do not include it
                            if (childListInActiveDraft.Count > 0)
                            {
                                //List<WorkOperationByStages> childListInParent = operationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(Module.KeyName)).ToList();
                                foreach (WorkOperationByStages objChild in childListInActiveDraft)
                                {
                                    List<WorkOperationByStages> GrandChildListInActiveDraft = new List<WorkOperationByStages>();
                                    GrandChildListInActiveDraft = operationDetectionMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(objChild.KeyName)).ToList();
                                    if (GrandChildListInActiveDraft.Count == 0)
                                    { // If it is child and Active
                                        if (objChild.IdStatus == 1535)
                                        {
                                            FlagAddItemModule = true;
                                            break;
                                        }
                                        else
                                        {
                                            FlagAddItemModule = false;
                                        }

                                    }
                                    else
                                    {
                                        if (GrandChildListInActiveDraft.Count > 0)
                                        {
                                            if (GrandChildListInActiveDraft.Where(i => i.IdStatus == 1535).Count() > 0)
                                            {
                                                FlagAddItemModule = true;
                                                break;
                                            }
                                            else
                                            {
                                                FlagAddItemModule = false;
                                            }
                                        }
                                    }
                                }
                            }
                            #endregion  [GEOS2-5135][Rupali Sarode][18-12-2023]
                            #endregion
                            if (FlagAddItemModule == true)
                            {
                                bool Checkrecord = false;
                                //var tmprecord = records.Where(x => x.KeyName == Detection.KeyName).FirstOrDefault();
                                var tmprecord = DetectionMenulist.Where(x => x.KeyName == Detection.KeyName).FirstOrDefault();
                                ERMSOPDetection eRMSOPDetection = new ERMSOPDetection();

                                //eRMSOPDetection.IdDetection = Detection.IdDetection;
                                eRMSOPDetection.IdDetection = Convert.ToUInt64(DetectionHeader.IdDetection);//[GEOS2-5629][gulab lakade][16 07 2024]
                                eRMSOPDetection.Name = Detection.Name;
                                eRMSOPDetection.IdworkOperationByStage = Detection.IdworkOperationByStage;
                                eRMSOPDetection.IdSequence = Detection.IdSequence;
                                eRMSOPDetection.IdStatus = Detection.IdStatus;
                                eRMSOPDetection.Status = Detection.Status;
                                eRMSOPDetection.Code = Detection.Name;
                                eRMSOPDetection.Parent = Detection.Parent;
                                eRMSOPDetection.IdParent = Detection.IdParent;
                                eRMSOPDetection.KeyName = Detection.KeyName;
                                eRMSOPDetection.ParentName = Detection.ParentName;
                                var ACC_Record = tempStandardOperationsDictionaryDetection_ACCordian.Where(a => a.IdWorkoperation == Convert.ToUInt32(Detection.IdworkOperationByStage)).FirstOrDefault();
                                if (ACC_Record != null)
                                {
                                    eRMSOPDetection.Position = Convert.ToUInt32(ACC_Record.Position);
                                    eRMSOPDetection.DetectionPosition = Convert.ToUInt32(ACC_Record.Position);//[GEOS2-5629][gulab lakade][16 07 2024]
                                }
                                else
                                    if(tmprecord!=null)
                                {
                                    eRMSOPDetection.Position = tmprecord.Position;
                                    eRMSOPDetection.DetectionPosition = tmprecord.Position;
                                }
                                else
                                {
                                    eRMSOPDetection.Position = Detection.Position;
                                    eRMSOPDetection.DetectionPosition = Detection.Position;//[GEOS2-5629][gulab lakade][16 07 2024]
                                }
                                eRMSOPDetection.WorkOperation_count = Detection.WorkOperation_count;
                                eRMSOPDetection.WorkOperation_count_original = Detection.WorkOperation_count_original;
                                eRMSOPDetection.NameWithWorkOperationCount = Detection.NameWithWorkOperationCount;
                                if (tmprecord != null)
                                {
                                    eRMSOPDetection.DetectionNormalTime = tmprecord.DetectionNormalTime;
                                    eRMSOPDetection.DetectionObservedTime = tmprecord.DetectionObservedTime;
                                    eRMSOPDetection.DetectionActivity = tmprecord.DetectionActivity;
                                    eRMSOPDetection.WORemarks = tmprecord.WORemarks == null ? "" : tmprecord.WORemarks.Trim();
                                    eRMSOPDetection.Remarks = tmprecord.Remarks == null ? "" : tmprecord.Remarks.Trim();
                                    Checkrecord = true;
                                }
                                else
                                {

                                    var tmprecord1 = records.Where(x => x.KeyName == Detection.KeyName).FirstOrDefault();
                                    if (tmprecord1 != null)
                                    {
                                        eRMSOPDetection.DetectionNormalTime = tmprecord1.DetectionNormalTime;
                                        eRMSOPDetection.DetectionObservedTime = tmprecord1.DetectionObservedTime;
                                        eRMSOPDetection.DetectionActivity = tmprecord1.DetectionActivity;
                                        eRMSOPDetection.WORemarks = tmprecord1.WORemarks == null ? "" : tmprecord1.WORemarks.Trim();
                                        eRMSOPDetection.Remarks = tmprecord1.Remarks == null ? "" : tmprecord1.Remarks.Trim();
                                        Checkrecord = true;
                                    }
                                    else
                                    {
                                        eRMSOPDetection.DetectionNormalTime = Detection.NormalTime;
                                        eRMSOPDetection.DetectionObservedTime = Detection.ObservedTime;
                                        eRMSOPDetection.DetectionActivity = Detection.Activity;
                                        eRMSOPDetection.WORemarks = Detection.WORemarks == null ? "" : Detection.WORemarks.Trim();
                                        eRMSOPDetection.Remarks = Detection.Remarks == null ? "" : Detection.Remarks.Trim();
                                    }

                                }
                                eRMSOPDetection.UITempDetectionobservedTime = ConvertfloattoTimespan(Convert.ToString(eRMSOPDetection.DetectionObservedTime));
                                #region //[GEOS2-5629][gulab lakade][16 07 2024]
                                //eRMSOPDetection.DetectionNormalTime = Detection.DetectionNormalTime;


                                //if (Detection.IdDetection != 0)
                                //    eRMSOPDetection.IdDetection = Convert.ToUInt64(HeaderDetectionId);  // Assign new IdCPType

                                //[GEOS2-3933][Rupali Sarode][21/09/2022]


                                #endregion
                                if (GetStages.Any(a => a != null && a.Code.Trim().Equals(Detection.Name.Trim())))
                                {
                                    //Detection.IsCurrentWorkOperation = true;
                                    eRMSOPDetection.IsDeleteButton = false;
                                    eRMSOPDetection.IsDeleteButtonVisibility = Visibility.Hidden;
                                    eRMSOPDetection.IsValidateOnTextInput = false;
                                }
                                else
                                {
                                    // Detection.IsCurrentWorkOperation = true;

                                    eRMSOPDetection.IsValidateOnTextInput = true;
                                }
                                if (Detection.IdStatus == 1536)
                                {
                                    eRMSOPDetection.IsInactiveWorkOperation = true;
                                }
                                try
                                {
                                    if (!TmpDetectionMenulist.Any(a => a.KeyName.Equals(Detection.KeyName)) && Checkrecord==true)
                                    {
                                        TmpDetectionMenulist.Add(eRMSOPDetection);
                                        ACC_DetectionList.Add(eRMSOPDetection);
                                    }

                                }
                                catch (Exception ex)
                                {

                                }
                            }
                        }
                        #endregion
                        TmpDetectionMenulist = new ObservableCollection<ERMSOPDetection>();
                        #region //[GEOS2-5629][gulab lakade][16 07 2024]
                        foreach (ERMSOPDetection Detection in ACC_DetectionList.OrderBy(a=>a.DetectionPosition))
                        {

                            ERMSOPDetection eRMSOPDetection = new ERMSOPDetection();

                            //eRMSOPDetection.IdDetection = Detection.IdDetection;
                            eRMSOPDetection.IdDetection = Convert.ToUInt64(DetectionHeader.IdDetection);//[GEOS2-5629][gulab lakade][16 07 2024]
                            eRMSOPDetection.Name = Detection.Name;
                            eRMSOPDetection.IdworkOperationByStage = Detection.IdworkOperationByStage;
                            eRMSOPDetection.IdSequence = Detection.IdSequence;
                            eRMSOPDetection.IdStatus = Detection.IdStatus;
                            eRMSOPDetection.Status = Detection.Status;
                            eRMSOPDetection.Code = Detection.Name;
                            eRMSOPDetection.Parent = Detection.Parent;
                            eRMSOPDetection.IdParent = Detection.IdParent;
                            eRMSOPDetection.KeyName = Detection.KeyName;
                            eRMSOPDetection.ParentName = Detection.ParentName;
                            // eRMSOPDetection.Position = Detection.Position;
                            #region [GEOS2-5629][gulab lakade][16 07 2024]
                            if (ACC_DetectionList != null)
                            {
                                if (Detection.ParentName == null)
                                {
                                    eRMSOPDetection.DetectionPosition = Detection.Position;
                                }
                                else
                                {
                                    var TempModule = ACC_DetectionList.Where(x => x.KeyName == Detection.KeyName).FirstOrDefault();
                                    if (TempModule != null)
                                    {
                                        eRMSOPDetection.DetectionPosition = TempModule.DetectionPosition;
                                    }
                                    else
                                    {
                                        if (ACC_DetectionList.Where(x => x.ParentName == Detection.ParentName).FirstOrDefault() == null)
                                        {
                                            var maxpos = ACC_DetectionList.Max(a => a.DetectionPosition);
                                            eRMSOPDetection.DetectionPosition = maxpos + 1;
                                        }
                                        else
                                        {
                                            var maxpos = ACC_DetectionList.Where(x => x.ParentName == Detection.ParentName).Max(a => a.DetectionPosition);
                                            eRMSOPDetection.DetectionPosition = maxpos + 1;
                                        }

                                    }
                                }


                            }

                            #endregion
                            eRMSOPDetection.WorkOperation_count = Detection.WorkOperation_count;
                            eRMSOPDetection.WorkOperation_count_original = Detection.WorkOperation_count_original;
                            eRMSOPDetection.NameWithWorkOperationCount = Detection.NameWithWorkOperationCount;
                            eRMSOPDetection.DetectionNormalTime = Detection.DetectionNormalTime;
                            #region //[GEOS2-5629][gulab lakade][16 07 2024]

                            eRMSOPDetection.WORemarks = Detection.WORemarks == null ? "" : Detection.WORemarks.Trim();
                            eRMSOPDetection.Remarks = Detection.Remarks == null ? "" : Detection.Remarks.Trim();
                            eRMSOPDetection.DetectionObservedTime = Detection.DetectionObservedTime;
                            #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                            eRMSOPDetection.UITempDetectionobservedTime = ConvertfloattoTimespan(Convert.ToString(eRMSOPDetection.DetectionObservedTime));
                            #endregion
                            eRMSOPDetection.DetectionActivity = Detection.DetectionActivity;
                            #endregion
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(Detection.Name.Trim())))
                            {
                                //Detection.IsCurrentWorkOperation = true;
                                eRMSOPDetection.IsDeleteButton = false;
                                eRMSOPDetection.IsDeleteButtonVisibility = Visibility.Hidden;
                                eRMSOPDetection.IsValidateOnTextInput = false;
                            }
                            else
                            {
                                // Detection.IsCurrentWorkOperation = true;

                                eRMSOPDetection.IsValidateOnTextInput = true;
                            }
                            if (Detection.IdStatus == 1536)
                            {
                                eRMSOPDetection.IsInactiveWorkOperation = true;
                            }
                            try
                            {
                                if (!TmpDetectionMenulist.Any(a => a.KeyName.Equals(Detection.KeyName)))
                                {
                                    TmpDetectionMenulist.Add(eRMSOPDetection);
                                }

                            }
                            catch (Exception ex)
                            {

                            }

                        }
                        ObservableCollection<ERMSOPDetection> TmpDetectionMenulist2 = new ObservableCollection<ERMSOPDetection>();
                        TmpDetectionMenulist2.AddRange(TmpDetectionMenulist.OrderBy(a => a.DetectionPosition).ToList());
                        TmpDetectionMenulist = new ObservableCollection<ERMSOPDetection>();
                        TmpDetectionMenulist = TmpDetectionMenulist2;

                        #endregion
                        // }
                        //List<ERMSOPDetection> tempWorkOperationDetectionMenulist = DetectionMenulist.OrderBy(x => x.Position).ToList();
                        //DetectionMenulist.Clear();
                        //DetectionMenulist.AddRange(tempWorkOperationDetectionMenulist);
                        //tempWorkOperationDetectionMenulist.Clear();

                        //FillDetectionGridColumn();
                        //detectionCustomSummarycalculation();
                        e.Handled = true;
                    }
                    if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                }
                GeosApplication.Instance.Logger.Log("Method CompleteDropRecorDetectionGridForAccordian()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in Method CompleteDropRecorDetectionGridForAccordian()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        //private void CompleteDropRecordDetectionGridForAccordian(DragEventArgs e)
        //{
        //    try
        //    {
        //        //if (!DXSplashScreen.IsActive)
        //        //{
        //        //    DXSplashScreen.Show(x =>
        //        //    {
        //        //        Window win = new Window()
        //        //        {
        //        //            ShowActivated = false,
        //        //            WindowStyle = WindowStyle.None,
        //        //            ResizeMode = ResizeMode.NoResize,
        //        //            AllowsTransparency = true,
        //        //            Background = new SolidColorBrush(Colors.Transparent),
        //        //            ShowInTaskbar = false,
        //        //            Topmost = true,
        //        //            SizeToContent = SizeToContent.WidthAndHeight,
        //        //            WindowStartupLocation = WindowStartupLocation.CenterScreen,
        //        //        };
        //        //        WindowFadeAnimationBehavior.SetEnableAnimation(win, true);
        //        //        win.Topmost = false;
        //        //        return win;
        //        //    }, x =>
        //        //    {
        //        //        return new SplashScreenView() { DataContext = new SplashScreenViewModel() };
        //        //    }, null, null);
        //        //}

        //        if (SelectedItemDetection is ERMDetections)
        //        {

        //            IsEnabledSaveButton = true;
        //            SaveButtonVisibility = Visibility.Visible;
        //            duplicateItemloop = 0;
        //            // if ((e.IsFromOutside) && typeof(WorkOperationByStages).IsAssignableFrom(e.GetRecordType()))
        //            // {
        //            //ModuleMenulist = new ObservableCollection<ERMSOPModule>();


        //            ////  WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false); // [GEOS2-3909][Rupali Sarode][04-11-2022] 
        //            var data = (RecordDragDropData)e.Data.GetData(typeof(RecordDragDropData));

        //            List<WorkOperationByStages> found = new List<WorkOperationByStages>();
        //            List<WorkOperationByStages> TempfoundAllrecords = new List<WorkOperationByStages>();
        //            //List<WorkOperationByStages> records = data.Records.OfType<WorkOperationByStages>().ToList();
        //            List<WorkOperationByStages> FindParent = new List<WorkOperationByStages>();
        //            List<ERMSOPDetection> records = data.Records.OfType<ERMSOPDetection>().ToList();

        //            AccordionItem itemModule = LayoutTreeHelper.GetVisualParents((DependencyObject)e.OriginalSource).OfType<AccordionItem>().FirstOrDefault();
        //            ERMDetections ModuleHeader = (ERMDetections)itemModule.Header;
        //            var IdDetection = ModuleHeader.IdDetection;

        //            if (TmpDetectionMenulist == null)
        //            {
        //                TmpDetectionMenulist = new ObservableCollection<ERMSOPDetection>();
        //            }

        //            if (records.Count == 0)  // Dragging work operation from left panal is not allowed
        //            {
        //                CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("AddEditSODCopyWorkOperationNotAllowed").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
        //                return;
        //            }

        //            if (IdDetection == Convert.ToInt32(records[0].IdDetection))  // Dragging in same CP type is not allowed
        //            {
        //                CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("AddEditSODCopyWorkOperationInSameCPtype").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
        //                return;
        //            }

        //            var tmpIdWorkOperation = tempLstStandardOperationsDictionaryDetection.Where(w => w.IdWorkoperation == Convert.ToUInt64(records[0].IdworkOperationByStage)
        //            && w.IdDetection == Convert.ToUInt64(IdDetection)).Select(s => s.IdWorkoperation).FirstOrDefault();

        //            if (tmpIdWorkOperation == 0)
        //            {
        //                //    tmpIdWorkOperation = Convert.ToUInt64(operationMenulist.Where(w => w.IdworkOperationByStage == Convert.ToInt32(records[0].IdworkOperationByStage)).Select(s => s.IdworkOperationByStage).FirstOrDefault());
        //                tmpIdWorkOperation = Convert.ToUInt64(TmpDetectionMenulist.Where(w => w.IdworkOperationByStage == Convert.ToInt32(records[0].IdworkOperationByStage)).Select(s => s.IdworkOperationByStage).FirstOrDefault());
        //            }

        //            if (tmpIdWorkOperation > 0)
        //            {
        //                //    var tmpIdWorkOperation1 = operationMenulist.Where(w => w.IdworkOperationByStage == Convert.ToInt32(records[0].IdworkOperationByStage)).Select(s => s.IdworkOperationByStage).FirstOrDefault();

        //                MessageBoxResult MessageBoxResult = CustomMessageBox.Show(String.Format(Application.Current.Resources["AddEditSODCopyWorkOperationAlreadyExists"].ToString()), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
        //                if (MessageBoxResult == MessageBoxResult.No)
        //                {
        //                    return;
        //                }
        //            }


        //            operationMenulist = new ObservableCollection<WorkOperationByStages>();
        //            int count = 0;

        //            if (records.Any(a => a.Name.Equals("All")))
        //            {
        //                //records.RemoveAll(r => r.Name.Equals("All"));
        //                #region ALL
        //                // found.AddRange(records);
        //                found = new List<WorkOperationByStages>();
        //                operationMenulist = new ObservableCollection<WorkOperationByStages>();
        //                operationMenulist.AddRange(WorkOperationMenulist.Where(w => !w.Name.Equals("All")));
        //                #endregion
        //            }
        //            else

        //            //if (true)
        //            {

        //                //for (int i = 0; i < records.Count(); i++)
        //                //{

        //                //}
        //                //foreach (WorkOperationByStages itemWorkOperationByStages in records)
        //                for (int r = 0; r < records.Count(); r++)
        //                {
        //                    if (!TmpDetectionMenulist.Any(a => a.Name.Equals(records[r].Name)))
        //                    {
        //                        // if (records[r].IdStatus != 1536) [rdixit][GEOS2-3764][04.08.2022]
        //                        // {
        //                        ////////records[r].IsCurrentWorkOperation = true;
        //                        ////////// ModuleMenulist.Add(JsonConvert.DeserializeObject<ERMSOPModule>(JsonConvert.SerializeObject(records[r])));
        //                        ////////operationMenulist.Add(records[r]);  // [GEOS2-3933] Rupali Sarode 
        //                        // }


        //                    }

        //                    if (GetStages.Any(a => a != null && a.Code.Trim().Equals(records[r].Name.Trim())))
        //                    {
        //                        found.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(records[r].KeyName)).ToList());
        //                        int x = 0;
        //                        Loop:
        //                        x++;
        //                        if (x < 4)
        //                        {
        //                            for (int i = 0; i < found.Count(); i++)
        //                            {
        //                                //TempfoundAllrecords.AddRange(WorkOperationMenulist.Where(s => s.IdworkOperationByStage == found[i].IdworkOperationByStage).ToList());
        //                                TempfoundAllrecords.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(found[i].KeyName)).ToList());
        //                            }
        //                            for (int i = 0; i < TempfoundAllrecords.Count(); i++)
        //                            {
        //                                if (!found.Any(a => a != null && a.KeyName.Trim().Equals(TempfoundAllrecords[i].KeyName.Trim())))
        //                                    found.Add(TempfoundAllrecords[i]);
        //                            }
        //                            goto Loop;
        //                        }



        //                    }
        //                    else
        //                    {
        //                        found.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(records[r].KeyName)).ToList());
        //                        for (int i = 0; i < found.Count(); i++)
        //                        {
        //                            TempfoundAllrecords.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(found[i].KeyName)).ToList());
        //                        }

        //                        for (int i = 0; i < TempfoundAllrecords.Count(); i++)
        //                        {
        //                            if (!found.Any(a => a != null && a.KeyName.Trim().Equals(TempfoundAllrecords[i].KeyName.Trim())))
        //                                found.Add(TempfoundAllrecords[i]);
        //                        }

        //                        for (int i = 0; i < records.Where(a => a.IdworkOperationByStage > 0).Count(); i++)
        //                        {
        //                            if (!found.Any(a => a != null && a.KeyName.Trim().Equals(records[i].KeyName.Trim())))
        //                                found.AddRange(WorkOperationMenulist.Where(s => s.IdworkOperationByStage == records[i].IdworkOperationByStage).ToList());
        //                            if (found.Count() != 0)
        //                            {
        //                                count++;
        //                            }
        //                        }

        //                    }

        //                }
        //            }


        //            if (count > 0)
        //            {
        //                for (int i = 0; i < found.Count(); i++)
        //                {
        //                    if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(found[i].Name.Trim())))
        //                    {
        //                        duplicateItemloop = 0;
        //                        GetAllTreeList(found[i], WorkOperationMenulist);
        //                    }

        //                }

        //            }
        //            else
        //            {
        //                if (!records.Any(a => a.Name.Equals("All")))
        //                    foreach (WorkOperationByStages item in found)
        //                    {
        //                        duplicateItemloop = 0;
        //                        GetAllTreeList(item, WorkOperationMenulist);
        //                    }
        //            }
        //            if (!records.Any(a => a.Name.Equals("All")))
        //                if (operationMenulist != null)
        //                {
        //                    var tempModuleMenulist = operationMenulist.ToList();
        //                    for (int i = 0; i < tempModuleMenulist.Count; i++)
        //                    {
        //                        if (GetStages.Any(a => a.Code.Equals(tempModuleMenulist[i].Name)))
        //                        {
        //                            List<WorkOperationByStages> childList = operationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(tempModuleMenulist[i].KeyName)).ToList();
        //                            if (childList.Count == 0)
        //                            {
        //                                operationMenulist.Remove(tempModuleMenulist[i]);
        //                            }
        //                        }
        //                    }
        //                }


        //            #region commonCode

        //            foreach (ERMSOPDetection Module in DetectionMenulist)
        //            {
        //                //if (Module.IdworkOperationByStage == records[0].IdworkOperationByStage)
        //                if (operationMenulist.Any(a => a.IdworkOperationByStage == Convert.ToInt64(Module.IdworkOperationByStage))
        //                       && operationMenulist.Any(a => a.IdStage == Module.IdStage)
        //                    && operationMenulist.Any(a => a.Name.Trim().Equals(Module.Name.Trim()))
        //                    )
        //                {

        //                    ERMSOPDetection eRMSOPModule = new ERMSOPDetection();
        //                    eRMSOPModule.Name = Module.Name;
        //                    eRMSOPModule.IdworkOperationByStage = Module.IdworkOperationByStage;
        //                    eRMSOPModule.IdSequence = Module.IdSequence;
        //                    eRMSOPModule.IdStatus = Module.IdStatus;
        //                    eRMSOPModule.Status = Module.Status;
        //                    eRMSOPModule.Code = Module.Name;
        //                    eRMSOPModule.Parent = Module.Parent;
        //                    eRMSOPModule.IdParent = Module.IdParent;
        //                    eRMSOPModule.KeyName = Module.KeyName;
        //                    eRMSOPModule.ParentName = Module.ParentName;
        //                    eRMSOPModule.Position = Module.Position;
        //                    eRMSOPModule.WorkOperation_count = Module.WorkOperation_count;
        //                    eRMSOPModule.WorkOperation_count_original = Module.WorkOperation_count_original;
        //                    eRMSOPModule.NameWithWorkOperationCount = Module.NameWithWorkOperationCount;
        //                    eRMSOPModule.DetectionNormalTime = Module.DetectionNormalTime;

        //                    if (Module.IdCpType != 0)
        //                        eRMSOPModule.IdDetection = Convert.ToUInt32(IdDetection);  // Assign new IdCPType

        //                    //[GEOS2-3933][Rupali Sarode][21/09/2022]
        //                    eRMSOPModule.WORemarks = Module.WORemarks == null ? "" : Module.WORemarks.Trim();

        //                    if (Module.DetectionNormalTime != null)
        //                    {
        //                        eRMSOPModule.DetectionNormalTime = Math.Round((double)Module.DetectionNormalTime, 2);
        //                        #region GEOS2-3954 gulab lakade Time format HH:mm:ss
        //                        eRMSOPModule.UITempDetectionNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(eRMSOPModule.DetectionNormalTime));
        //                        #endregion
        //                    }
        //                    eRMSOPModule.DetectionObservedTime = Module.DetectionObservedTime;
        //                    if (Module.DetectionObservedTime != null)
        //                    {
        //                        eRMSOPModule.DetectionObservedTime = Math.Round((double)Module.DetectionObservedTime, 2);
        //                        #region GEOS2-3954 gulab lakade Time format HH:mm:ss
        //                        eRMSOPModule.UITempDetectionobservedTime = ConvertfloattoTimespan(Convert.ToString(eRMSOPModule.DetectionObservedTime));
        //                        #endregion
        //                    }

        //                    if (Module.DetectionActivity != null)
        //                        eRMSOPModule.DetectionActivity = Module.DetectionActivity;

        //                    if (Module.DetectionActivity != 0 && Module.DetectionActivity != null)
        //                        eRMSOPModule.DetectionActivity = Math.Round((double)Module.DetectionActivity, 2);
        //                    if (eRMSOPModule.DetectionActivity == 0)
        //                        eRMSOPModule.DetectionActivity = null;

        //                    if (GetStages.Any(a => a != null && a.Code.Trim().Equals(Module.Name.Trim())))
        //                    {
        //                        //    Module.IsCurrentWorkOperation = true;
        //                        eRMSOPModule.IsDeleteButton = false;
        //                        eRMSOPModule.IsDeleteButtonVisibility = Visibility.Hidden;
        //                        eRMSOPModule.IsValidateOnTextInput = false;
        //                    }
        //                    else
        //                    {
        //                        //  Module.IsCurrentWorkOperation = true;
        //                        eRMSOPModule.IsValidateOnTextInput = true;
        //                    }
        //                    if (Module.IdStatus == 1536)
        //                    {
        //                        eRMSOPModule.IsInactiveWorkOperation = true;

        //                    }
        //                    else
        //                    {

        //                    }
        //                    try
        //                    {
        //                        if (!TmpDetectionMenulist.Any(a => a.KeyName.Equals(Module.KeyName)))
        //                        {
        //                            TmpDetectionMenulist.Add(eRMSOPModule);
        //                        }

        //                    }
        //                    catch (Exception ex)
        //                    {

        //                    }

        //                }
        //            }

        //            #endregion

        //            e.Handled = true;
        //        }
        //        if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
        //    }
        //    catch (Exception ex)
        //    {
        //        if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
        //        GeosApplication.Instance.Logger.Log("Get an error in Method CompleteDropRecordDetectionGridForAccordian()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
        //    }
        //}

        #endregion

        #region [GEOS2-3924][Rupali Sarode][21-11-2022]
        private void OptionsAccordionControl_Drop(DragEventArgs e)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method OptionsAccordionControl_Drop()...", category: Category.Info, priority: Priority.Low);

                e.Effects = DragDropEffects.None;
                e.Handled = true;

                e.Effects = DragDropEffects.Copy;
                //  if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }
                CompleteDropRecorOptionGridForAccordian(e);
                //  if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                e.Handled = true;
                GeosApplication.Instance.Logger.Log("Method OptionsAccordionControl_Drop()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {

                GeosApplication.Instance.Logger.Log(string.Format("Error in method OptionsAccordionControl_Drop() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }

        }
        #region gulab 05 08 2024
        List<ERMSOPOptions> tmpoldoptionlist = new List<ERMSOPOptions>();
        private void oldRecordOptionGridForAccordian(List<WorkOperationByStages> tmpchildmodule)
        {
            //tmpoldmodulelist = new List<ERMSOPModule>();
            foreach (var child in tmpchildmodule)
            {
                if (child.ParentName == null)
                {
                    ERMSOPOptions childrecord = new ERMSOPOptions();
                    childrecord.Name = child.Name;
                    childrecord.IdworkOperationByStage = child.IdworkOperationByStage;
                    childrecord.IdSequence = child.IdSequence;
                    childrecord.IdStatus = child.IdStatus;
                    childrecord.Status = child.Status;
                    childrecord.Code = child.Name;
                    childrecord.Parent = child.Parent;
                    childrecord.IdParent = child.IdParent;
                    childrecord.KeyName = child.KeyName;
                    childrecord.ParentName = child.ParentName;
                    childrecord.Position = Convert.ToUInt32(child.Position);
                    childrecord.OptionPosition = Convert.ToUInt32(child.Position);
                    tmpoldoptionlist.Add(childrecord);
                }
                else
                {
                    List<WorkOperationByStages> tmpchildmodule1 = WorkOperationMenulist.Where(a => a.KeyName == child.ParentName).ToList();
                    if (tmpchildmodule1.Count() > 0)
                    {
                        oldRecordOptionGridForAccordian(tmpchildmodule1);
                    }

                    //tmpoldmodulelist.AddRange();
                }

            }

            // return tmpoldmodulelist;
        }

        #endregion
        private void CompleteDropRecorOptionGridForAccordian(DragEventArgs e)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method CompleteDropRecorOptionGridForAccordian()...", category: Category.Info, priority: Priority.Low);
                if (SelectedItemOption is ERMOptions)
                {
                    ulong tmpIdOptionsWorkOperation = 0;
                    // IsEnabledSaveButton = true;
                    // SaveButtonVisibility = Visibility.Visible;
                    duplicateItemloopOption = 0;
                    //if ((e.IsFromOutside) && typeof(WorkOperationByStages).IsAssignableFrom(e.GetRecordType()))
                    //{
                    //WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                    var data = (RecordDragDropData)e.Data.GetData(typeof(RecordDragDropData));
                    List<WorkOperationByStages> found = new List<WorkOperationByStages>();
                    List<WorkOperationByStages> TempfoundAllrecords = new List<WorkOperationByStages>();
                    List<ERMSOPOptions> records = data.Records.OfType<ERMSOPOptions>().ToList();

                    AccordionItem itemModule = LayoutTreeHelper.GetVisualParents((DependencyObject)e.OriginalSource).OfType<AccordionItem>().FirstOrDefault();
                    ERMOptions OptionsHeader = (ERMOptions)itemModule.Header;
                    var OptionsIdDetection = OptionsHeader.IdDetection;

                    //If user added from work operation left tab & 
                    //without save user dragged & drop, then first allow user to first save it.
                    //if (IsEnabledSaveButton && SaveButtonVisibility == Visibility.Visible)
                    Saveselecteditem = "Option";
                    if (FlagToDragDrop == true)
                    {
                        if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                        MessageBoxResult MessageBoxResult = MessageBoxResult = CustomMessageBox.Show(string.Format(Application.Current.Resources["AddEditSODSaveWOBeforeDrag"].ToString()), "Yellow", CustomMessageBox.MessageImagePath.Warning, MessageBoxButton.YesNo);
                        if (MessageBoxResult == MessageBoxResult.Yes)
                        {
                            if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }
                            ISSavechanges = true;
                            IsEnabledSaveButton = false;
                            //SelectedItemOldclone = SelectedItem;
                            //SelectedItem = SelectedItemOld;
                            //var tempSelectedItem = SelectedItemOldclone;
                            SaveButtonCommandAction();
                            ISSavechanges = false;
                            // SelectedItem = tempSelectedItem;
                            //AcceptButtonCommandAction(null);
                            if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                            //SelectedItemDetection = SelectedItemOldDetection;
                            //if (SelectedItemOldcloneDetection != null)
                            //    SelectedItemDetection = SelectedItemOldcloneDetection;
                            #region [GEOS2-4830][gulab lakade][07 12 2023]
                            //SelectedItemOption = SelectedItemOldOption;
                            //if (SelectedItemOldcloneOption != null)
                            //    SelectedItemOption = SelectedItemOldcloneOption;

                            if (SelectedItemOldcloneOption != null)
                            {
                                SelectedItemOption = SelectedItemOldcloneOption;
                            }
                            else
                            {
                                SelectedItemOption = SelectedItemOldOption;
                            }

                            #endregion
                            ////GEOS2-3838 - Way
                            //SelectedItemWay = SelectedItemOldWay;
                            //if (SelectedItemOldcloneWay != null)
                            //    SelectedItemWay = SelectedItemOldcloneWay;
                            ////[GEOS2-3601] - Structure
                            //SelectedItemStructures = SelectedItemOldStructure;
                            //if (SelectedItemOldcloneStructure != null)
                            //    SelectedItemStructures = SelectedItemOldcloneStructure;

                            return;
                        }

                        if (MessageBoxResult == MessageBoxResult.No)
                        {
                            TmpModuleMenulist = null;
                            TmpDetectionMenulist = null;
                            TmpOptionMenulist = null;
                            TmpStructureMenulist = null;
                            TmpWayMenulist = null;
                            TmpSparePartsMenulist = null;
                            FlagToDragDrop = false;
                            TmpIdCPType = 0;
                            TmpIdDetection = 0;
                            TmpIdOption = 0;
                            TmpIdWayType = 0;
                            TmpIdStructure = 0;
                            TmpIdSpareParts = 0;
                            return;
                        }

                    }

                    MessageBoxResult MsgBoxResult = CustomMessageBox.Show(String.Format(Application.Current.Resources["AddEditSODCopyWorkOperationConfirmation"].ToString()), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                    if (MsgBoxResult == MessageBoxResult.Yes)
                    {

                        IsEnabledSaveButton = true;
                        SaveButtonVisibility = Visibility.Visible;


                        if (records.Count == 0)  // Dragging work operation from left panal is not allowed
                        {
                            CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("AddEditSODCopyWorkOperationNotAllowed").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                            return;
                        }

                        if (TmpIdOption == 0)
                            TmpIdOption = (ulong)OptionsIdDetection;

                        if (TmpIdOption != 0 && TmpIdOption != (ulong)OptionsIdDetection) // if copied to different cptype without saving then popup the message
                        {
                            CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("AddEditSODCopyWOSavePreviousCopiedWO").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);

                            return;
                        }


                        if (TmpOptionMenulist == null)
                        {
                            TmpOptionMenulist = new ObservableCollection<ERMSOPOptions>();
                        }

                        if (OptionsIdDetection == (int)records[0].IdDetection)  // Dragging in same CP type is not allowed
                        {
                            CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("AddEditSODCopyWorkOperationInSameCPtype").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                            return;
                        }

                        tmpIdOptionsWorkOperation = tempLstStandardOperationsDictionaryOption.Where(w => w.IdWorkoperation == Convert.ToUInt64(records[0].IdworkOperationByStage)
                         && w.IdDetection == Convert.ToUInt64(OptionsIdDetection)).Select(s => s.IdWorkoperation).FirstOrDefault();

                        if (tmpIdOptionsWorkOperation == 0)
                        {
                            tmpIdOptionsWorkOperation = Convert.ToUInt64(TmpOptionMenulist.Where(w => w.IdworkOperationByStage == Convert.ToInt32(records[0].IdworkOperationByStage)
                            && w.IdDetection == (ulong)OptionsIdDetection).Select(s => s.IdworkOperationByStage).FirstOrDefault());
                        }

                        if (tmpIdOptionsWorkOperation > 0)
                        {
                            MessageBoxResult MessageBoxResult = CustomMessageBox.Show(String.Format(Application.Current.Resources["AddEditSODCopyWorkOperationAlreadyExists"].ToString()), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                            if (MessageBoxResult == MessageBoxResult.No)
                            {
                                return;
                            }
                        }

                        List<WorkOperationByStages> tmpChildList = WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(records[0].KeyName)).ToList();
                        if (tmpChildList.Count > 0)
                        {
                            foreach (WorkOperationByStages child in tmpChildList)
                            {
                                tmpIdOptionsWorkOperation = tempLstStandardOperationsDictionaryOption.Where(w => w.IdWorkoperation == Convert.ToUInt64(child.IdworkOperationByStage)
                                && w.IdDetection == Convert.ToUInt64(OptionsIdDetection)).Select(s => s.IdWorkoperation).FirstOrDefault();
                                if (tmpIdOptionsWorkOperation > 0)
                                {
                                    MessageBoxResult MessageBoxResult = CustomMessageBox.Show(String.Format(Application.Current.Resources["AddEditSODCopyWorkOperationAlreadyExists"].ToString()), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                                    if (MessageBoxResult == MessageBoxResult.No)
                                    {
                                        return;
                                    }
                                    if (MessageBoxResult == MessageBoxResult.Yes)
                                        break;
                                }

                            }

                            if (tmpIdOptionsWorkOperation == 0)
                            {
                                foreach (WorkOperationByStages child in tmpChildList)
                                {
                                    tmpIdOptionsWorkOperation = Convert.ToUInt64(TmpOptionMenulist.Where(w => w.IdWorkoperation == child.IdworkOperationByStage
                                    && w.IdDetection == (ulong)OptionsIdDetection).Select(s => s.IdWorkoperation).FirstOrDefault());
                                    if (tmpIdOptionsWorkOperation > 0)
                                    {
                                        MessageBoxResult MessageBoxResult = CustomMessageBox.Show(String.Format(Application.Current.Resources["AddEditSODCopyWorkOperationAlreadyExists"].ToString()), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                                        if (MessageBoxResult == MessageBoxResult.No)
                                        {
                                            return;
                                        }
                                    }

                                }

                            }

                        }

                        TempOptionSelectedCopy = OptionsHeader;

                        operationOptionMenulist = new ObservableCollection<WorkOperationByStages>();
                        int count = 0;
                        //if (TmpOptionsMenulist == null)
                        //{
                        //    TmpOptionsMenulist = new ObservableCollection<ERMSOPOptions>();
                        //}
                        if (records.Any(a => a.Name.Equals("All")))
                        {
                            #region ALL
                            found = new List<WorkOperationByStages>();
                            operationOptionMenulist = new ObservableCollection<WorkOperationByStages>();
                            operationOptionMenulist.AddRange(WorkOperationMenulist.Where(w => !w.Name.Equals("All")));
                            #endregion
                        }
                        else
                        {

                            for (int r = 0; r < records.Count(); r++)
                            {
                                if (!TmpOptionMenulist.Any(a => a.Name.Equals(records[r].Name)))
                                {
                                    //if (records[r].IdStatus != 1536)
                                    //{
                                    ////records[r].IsCurrentWorkOperation = true;
                                    //////DetectionMenulist.Add(JsonConvert.DeserializeObject<ERMSOPDetection>(JsonConvert.SerializeObject(records[r])));
                                    ////if (!operationOptionMenulist.Any(a => a.KeyName.Equals(records[r].KeyName)))
                                    ////    operationOptionMenulist.Add(records[r]);
                                    //}


                                }

                                if (GetStages.Any(a => a != null && a.Code.Trim().Equals(records[r].Name.Trim())))
                                {
                                    found.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(records[r].KeyName)).ToList());
                                    int x = 0;
                                    Loop:
                                    x++;
                                    if (x < 4)
                                    {
                                        for (int i = 0; i < found.Count(); i++)
                                        {
                                            TempfoundAllrecords.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(found[i].KeyName)).ToList());
                                        }
                                        for (int i = 0; i < TempfoundAllrecords.Count(); i++)
                                        {
                                            if (!found.Any(a => a != null && a.KeyName.Trim().Equals(TempfoundAllrecords[i].KeyName.Trim())))
                                                found.Add(TempfoundAllrecords[i]);
                                        }
                                        goto Loop;
                                    }

                                }
                                else
                                {
                                    found.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(records[r].KeyName)).ToList());
                                    for (int i = 0; i < found.Count(); i++)
                                    {
                                        TempfoundAllrecords.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(found[i].KeyName)).ToList());
                                    }
                                    for (int i = 0; i < TempfoundAllrecords.Count(); i++)
                                    {
                                        if (!found.Any(a => a != null && a.KeyName.Trim().Equals(TempfoundAllrecords[i].KeyName.Trim())))
                                            found.Add(TempfoundAllrecords[i]);
                                    }
                                    for (int i = 0; i < records.Where(a => a.IdworkOperationByStage > 0).Count(); i++)
                                    {
                                        if (!found.Any(a => a != null && a.KeyName.Trim().Equals(records[i].KeyName.Trim())))
                                            found.AddRange(WorkOperationMenulist.Where(s => s.IdworkOperationByStage == records[i].IdworkOperationByStage).ToList());
                                        if (found.Count() != 0)
                                        {
                                            count++;
                                        }
                                    }
                                }

                            }
                        }


                        if (count > 0)
                        {
                            for (int i = 0; i < found.Count(); i++)
                            {
                                if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(found[i].Name.Trim())))
                                {
                                    duplicateItemloopOption = 0;
                                    GetAllTreeListOption(found[i], WorkOperationMenulist);
                                }

                            }
                        }
                        else
                        {

                            if (!records.Any(a => a.Name.Equals("All")))
                                foreach (WorkOperationByStages item in found)
                                {
                                    duplicateItemloopOption = 0;
                                    GetAllTreeListOption(item, WorkOperationMenulist);
                                }
                        }
                        if (!records.Any(a => a.Name.Equals("All")))
                            if (operationOptionMenulist != null)
                            {
                                var tempOptionMenulist = operationOptionMenulist.ToList();
                                for (int i = 0; i < tempOptionMenulist.Count; i++)
                                {
                                    if (GetStages.Any(a => a.Code.Equals(tempOptionMenulist[i].Name)))
                                    {
                                        List<WorkOperationByStages> childList = operationOptionMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(tempOptionMenulist[i].KeyName)).ToList();
                                        if (childList.Count == 0)
                                        {
                                            operationOptionMenulist.Remove(tempOptionMenulist[i]);
                                        }
                                    }
                                }
                            }

                        #region Check for Head parent whose parent is null like CUT, CAM etc
                        ulong tempWOId = 0;
                        if (GetStages.Any(a => a != null && a.Code.Trim().Equals(records[0].Name.Trim())))
                        {

                            foreach (WorkOperationByStages wo in operationOptionMenulist)
                            {
                                tempWOId = tempLstStandardOperationsDictionaryOption.Where(w => w.IdWorkoperation == Convert.ToUInt64(wo.IdworkOperationByStage)
                                && w.IdDetection == Convert.ToUInt64(OptionsIdDetection)).Select(s => s.IdWorkoperation).FirstOrDefault();
                                if (tempWOId > 0)
                                    break;

                            }

                            if (tempWOId > 0)
                            {
                                MessageBoxResult MessageBoxResult = CustomMessageBox.Show(String.Format(Application.Current.Resources["AddEditSODCopyWOSaveAlreadyExistsStage"].ToString()), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                                if (MessageBoxResult == MessageBoxResult.No)
                                {
                                    return;
                                }
                            }
                        }

                        #endregion Check for Head parent whose parent is null like CUT, CAM etc





                        #region copy data to tempWorkOperationClonedOptions

                        tempWorkOperationClonedOptions = new List<ERMSOPOptions>();
                        var SelectedOptionItems = tempLstStandardOperationsDictionaryOption.Where(w => w.IdDetection == Convert.ToUInt64(OptionsIdDetection)).ToList();

                        for (int i = 0; i < SelectedOptionItems.Count; i++)
                        {
                            ERMSOPOptions eRMSOPOption = new ERMSOPOptions();

                            WorkOperationByStages Module = new WorkOperationByStages();
                            Module = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == Convert.ToInt64(SelectedOptionItems[i].IdWorkoperation)).FirstOrDefault();

                            eRMSOPOption.IdDetection = SelectedOptionItems[i].IdDetection;
                            eRMSOPOption.Name = Module.Name;
                            eRMSOPOption.IdworkOperationByStage = Module.IdworkOperationByStage;
                            eRMSOPOption.IdSequence = Module.IdSequence;
                            eRMSOPOption.IdStatus = Module.IdStatus;
                            eRMSOPOption.Status = Module.Status;
                            eRMSOPOption.Code = Module.Name;
                            eRMSOPOption.Parent = Module.Parent;
                            eRMSOPOption.IdParent = Module.IdParent;
                            eRMSOPOption.KeyName = Module.KeyName;
                            eRMSOPOption.ParentName = Module.ParentName;
                            //eRMSOPOption.Position = Module.Position;
                            eRMSOPOption.Position = Convert.ToUInt32(SelectedOptionItems[i].Position);//[GEOS2-5629][gulab lakade][16 07 2024]
                            eRMSOPOption.OptionPosition = Convert.ToUInt32(SelectedOptionItems[i].OptionPosition);//[GEOS2-5629][gulab lakade][16 07 2024]
                            eRMSOPOption.WorkOperation_count = Module.WorkOperation_count;
                            eRMSOPOption.WorkOperation_count_original = Module.WorkOperation_count_original;
                            eRMSOPOption.NameWithWorkOperationCount = Module.NameWithWorkOperationCount;
                            //[rdixit][03.08.2022][GEOS2-3764]
                            eRMSOPOption.IsReadOnly = Module.IsReadOnly;
                            eRMSOPOption.IsInactiveWorkOperation = Module.IsInactiveWorkOperation;

                            if (!GetStages.Any(a => a.Code.Equals(eRMSOPOption.Name)))
                            {
                                var tempActivity = tempLstStandardOperationsDictionaryOption.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPOption.IdworkOperationByStage)
                                 && w.IdDetection == Convert.ToUInt64(eRMSOPOption.IdDetection)).Select(s => s.Activity).DefaultIfEmpty(null).FirstOrDefault();
                                var tempObservedTime = tempLstStandardOperationsDictionaryOption.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPOption.IdworkOperationByStage)
                                 && w.IdDetection == Convert.ToUInt64(eRMSOPOption.IdDetection)).Select(s => s.ObservedTime).DefaultIfEmpty(null).FirstOrDefault();

                                #region [GEOS2-4083][Rupali Sarode][10-12-2022]
                                var tempOption = tempLstStandardOperationsDictionaryOption.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPOption.IdworkOperationByStage)
                                && w.IdDetection == Convert.ToUInt64(eRMSOPOption.IdDetection)).FirstOrDefault();

                                if (tempOption != null)
                                {
                                    if (tempOption.IdWorkoperation == Convert.ToUInt64(eRMSOPOption.IdworkOperationByStage) && (tempActivity == null || tempActivity == 0))
                                        tempActivity = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == Module.IdworkOperationByStage).Select(b => b.Activity).FirstOrDefault();

                                    if (tempOption.IdWorkoperation == Convert.ToUInt64(eRMSOPOption.IdworkOperationByStage) && (tempObservedTime == null || tempObservedTime == 0))
                                        tempObservedTime = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == Module.IdworkOperationByStage).Select(b => b.ObservedTime).FirstOrDefault();
                                }

                                #endregion


                                if (tempActivity != null)
                                    eRMSOPOption.OptionActivity = Math.Round((double)tempActivity, 2);
                                //if (tempObservedTime != null)
                                //    eRMSOPOption.ObservedTime = Math.Round((double)tempObservedTime, 2);
                                if (tempObservedTime != null)
                                {
                                    eRMSOPOption.OptionObservedTime = Math.Round((double)tempObservedTime, 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    //  eRMSOPOption.UITempOptionObservedTime = tempLstStandardOperationsDictionaryOption.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPOption.IdworkOperationByStage)
                                    //&& w.IdDetection == Convert.ToUInt64(eRMSOPOption.IdDetection)).Select(s => s.UITempOptionObservedTime).FirstOrDefault();
                                    eRMSOPOption.UITempOptionObservedTime = TimeSpan.FromMinutes(Convert.ToDouble(tempObservedTime));
                                    #endregion
                                }

                                eRMSOPOption.OptionNormalTime = Math.Round(Convert.ToDouble(eRMSOPOption.OptionObservedTime * eRMSOPOption.OptionActivity / 100), 2);
                                #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                eRMSOPOption.UITempOptionNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(eRMSOPOption.OptionNormalTime));

                                #endregion
                                //[GEOS2-3933][Rupali Sarode][21/09/2022]
                                eRMSOPOption.WORemarks = Module.WORemarks == null ? "" : Module.WORemarks.Trim();

                                var tempRemarks = tempLstStandardOperationsDictionaryOption.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPOption.IdworkOperationByStage)
                                 && w.IdDetection == Convert.ToUInt64(eRMSOPOption.IdDetection)).Select(s => s.Remarks).DefaultIfEmpty(null).FirstOrDefault();

                                eRMSOPOption.Remarks = tempRemarks == null ? "" : tempRemarks.Trim();

                            }
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(Module.Name.Trim())))
                            {
                                eRMSOPOption.IsDeleteButton = false;
                                eRMSOPOption.IsDeleteButtonVisibility = Visibility.Hidden;
                                // eRMSOPOption.ObservedTimeIsReadOnly =true;
                                eRMSOPOption.IsReadOnly = true;
                                eRMSOPOption.IsValidateOnTextInput = false;
                                Module.IsCurrentWorkOperation = true;
                            }
                            else
                            {
                                Module.IsCurrentWorkOperation = true;
                                //eRMSOPOption.ObservedTimeIsReadOnly = false;
                                eRMSOPOption.IsReadOnly = false;
                                eRMSOPOption.IsValidateOnTextInput = true;
                            }
                            if (Module.IdStatus == 1536)
                            {
                                eRMSOPOption.IsInactiveWorkOperation = true;
                                eRMSOPOption.IsReadOnly = true;
                            }
                            try
                            {
                                //  if (!tempWorkOperationClonedModule.Any(a => a.KeyName.Equals(Module.KeyName)))
                                tempWorkOperationClonedOptions.Add(eRMSOPOption);
                            }
                            catch (Exception ex)
                            {

                            }


                            //}
                            //}
                        }
                        var tempWorkOperationMenuList2 = tempWorkOperationClonedOptions.OrderBy(x => x.Position).ToList();
                        tempWorkOperationClonedOptions.Clear();
                        tempWorkOperationClonedOptions = new List<ERMSOPOptions>();
                        tempWorkOperationClonedOptions.AddRange(tempWorkOperationMenuList2);
                        tempWorkOperationMenuList2.Clear();

                        #endregion copy data to tempWorkOperationClonedOptions
                        #region //[GEOS2-5629][gulab lakade][16 07 2024]
                        List<StandardOperationsDictionaryOption> tempStandardOperationsDictionaryOption_Accordian = tempLstStandardOperationsDictionaryOption.Where(w => w.IdDetection == Convert.ToUInt64(OptionsHeader.IdDetection)).ToList();
                        //OptionsMenulist = new ObservableCollection<ERMSOPOptions>();
                        //operationOptionMenulist = new ObservableCollection<WorkOperationByStages>();
                        duplicateItemloopOption = 0;
                        duplicateItemloop = 0;
                        if (tempStandardOperationsDictionaryOption_Accordian.Count() > 0)
                        {
                            foreach (var eRMSOPOption in tempStandardOperationsDictionaryOption_Accordian)
                            {
                                if (eRMSOPOption != null)
                                {
                                    List<WorkOperationByStages> tempOptionList = WorkOperationMenulist.Where(w => w.IdworkOperationByStage == Convert.ToInt32(eRMSOPOption.IdWorkoperation) && w.Name == eRMSOPOption.WorkOperationName).ToList();
                                    if (tempOptionList != null)
                                        foreach (WorkOperationByStages item in tempOptionList)
                                        {
                                            if (item.IdStatus == 1536)//[gulablakade][10.08.2022][GEOS2-3837]
                                            {
                                                item.IsInactiveWorkOperation = true;
                                                item.IsReadOnly = true;
                                            }
                                            WorkOperationByStages ParentName = WorkOperationMenulist.Where(w => w.KeyName.Equals(item.ParentName)).FirstOrDefault();
                                            if (ParentName != null)
                                            {
                                                if (!operationOptionMenulist.Any(a => a.KeyName.Equals(ParentName.KeyName)))
                                                    operationOptionMenulist.Add(ParentName);
                                            }
                                            duplicateItemloopOption = 0;
                                            duplicateItemloop = 0;
                                            GetAllTreeListOption(item, WorkOperationMenulist);
                                        }

                                }

                            }
                        }
                        #region gulab lakade beta changes 05 08 2024
                        if (tempWorkOperationClonedOptions != null && tempWorkOperationClonedOptions.Count() > 0)
                        {
                            tmpoldoptionlist = new List<ERMSOPOptions>();
                            foreach (ERMSOPOptions item in tempWorkOperationClonedOptions)
                            {
                                records.Add(item);
                                var tmpmodule = WorkOperationMenulist.Where(a => a.KeyName == item.ParentName).ToList();
                                if (tmpmodule.Count() > 0)
                                {
                                    foreach (var child in tmpmodule)
                                    {
                                        if (child.ParentName == null)
                                        {
                                            ERMSOPOptions childrecord = new ERMSOPOptions();
                                            childrecord.Name = child.Name;
                                            childrecord.IdworkOperationByStage = child.IdworkOperationByStage;
                                            childrecord.IdSequence = child.IdSequence;
                                            childrecord.IdStatus = child.IdStatus;
                                            childrecord.Status = child.Status;
                                            childrecord.Code = child.Name;
                                            childrecord.Parent = child.Parent;
                                            childrecord.IdParent = child.IdParent;
                                            childrecord.KeyName = child.KeyName;
                                            childrecord.ParentName = child.ParentName;
                                            childrecord.Position = Convert.ToUInt32(child.Position);
                                            childrecord.OptionPosition = Convert.ToUInt32(child.Position);
                                            tmpoldoptionlist.Add(childrecord);
                                        }
                                        else
                                        {
                                            var tmpchildmodule = WorkOperationMenulist.Where(a => a.KeyName == child.ParentName).ToList();
                                            if (tmpchildmodule.Count() > 0)
                                            {
                                                oldRecordOptionGridForAccordian(tmpchildmodule);
                                            }
                                        }

                                    }
                                }
                            }

                            records.AddRange(tmpoldoptionlist);
                            tmpoldoptionlist = new List<ERMSOPOptions>();
                            //records.AddRange(tempWorkOperationClonedOptions);
                        }
                        #endregion
                        List<ERMSOPOptions> ACC_OptionsList = new List<ERMSOPOptions>();
                        bool FlagAddItemModule = false;
                        foreach (var Option in operationOptionMenulist)
                        {
                            ////if (Option.IdStatus != 1536)
                            //if (operationOptionMenulist.Any(a => a.IdworkOperationByStage == Convert.ToInt64(Option.IdworkOperationByStage))
                            //   && operationOptionMenulist.Any(a => a.IdStage == Option.IdStage)
                            //&& operationOptionMenulist.Any(a => a.Name.Trim().Equals(Option.Name.Trim()))
                            //)
                            #region  [GEOS2-5135][Rupali Sarode][18-12-2023]
                            FlagAddItemModule = true;
                            // If it is child & only active then add
                            List<WorkOperationByStages> childListInActiveDraft = operationOptionMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(Option.KeyName)).ToList();

                            if (childListInActiveDraft.Count == 0)
                            {
                                if (Option.IdStatus == 1535)
                                {
                                    FlagAddItemModule = true;
                                }
                                else
                                    FlagAddItemModule = false;
                            }
                            else // If it is parent and does not contain any active child, then do not include it
                            if (childListInActiveDraft.Count > 0)
                            {
                                //List<WorkOperationByStages> childListInParent = operationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(Module.KeyName)).ToList();
                                foreach (WorkOperationByStages objChild in childListInActiveDraft)
                                {
                                    List<WorkOperationByStages> GrandChildListInActiveDraft = new List<WorkOperationByStages>();
                                    GrandChildListInActiveDraft = operationOptionMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(objChild.KeyName)).ToList();
                                    if (GrandChildListInActiveDraft.Count == 0)
                                    { // If it is child and Active
                                        if (objChild.IdStatus == 1535)
                                        {
                                            FlagAddItemModule = true;
                                            break;
                                        }
                                        else
                                        {
                                            FlagAddItemModule = false;
                                        }

                                    }
                                    else
                                    {
                                        if (GrandChildListInActiveDraft.Count > 0)
                                        {
                                            if (GrandChildListInActiveDraft.Where(i => i.IdStatus == 1535).Count() > 0)
                                            {
                                                FlagAddItemModule = true;
                                                break;
                                            }
                                            else
                                            {
                                                FlagAddItemModule = false;
                                            }
                                        }
                                    }
                                }
                            }
                            #endregion  [GEOS2-5135][Rupali Sarode][18-12-2023]
                            if (FlagAddItemModule == true)
                            {
                                bool Checkrecord = false;
                                var tmprecord = OptionsMenulist.Where(x => x.KeyName == Option.KeyName).FirstOrDefault();
                                //var tmprecord = records.Where(x => x.KeyName == Option.KeyName).FirstOrDefault();
                                ERMSOPOptions eRMSOPOption = new ERMSOPOptions();
                                eRMSOPOption.Name = Option.Name;
                                eRMSOPOption.IdworkOperationByStage = Option.IdworkOperationByStage;
                                eRMSOPOption.IdSequence = Option.IdSequence;
                                eRMSOPOption.IdStatus = Option.IdStatus;
                                eRMSOPOption.Status = Option.Status;
                                eRMSOPOption.Code = Option.Name;
                                eRMSOPOption.Parent = Option.Parent;
                                eRMSOPOption.IdParent = Option.IdParent;
                                eRMSOPOption.KeyName = Option.KeyName;
                                eRMSOPOption.ParentName = Option.ParentName;
                                var ACC_Record = tempStandardOperationsDictionaryOption_Accordian.Where(a => a.IdWorkoperation == Convert.ToUInt32(Option.IdworkOperationByStage)).FirstOrDefault();
                                if (ACC_Record != null)
                                {
                                    eRMSOPOption.Position = Convert.ToUInt32(ACC_Record.Position);
                                    eRMSOPOption.OptionPosition = Convert.ToUInt32(ACC_Record.Position);//[GEOS2-5629][gulab lakade][16 07 2024]
                                }
                                else if (tmprecord != null)
                                {
                                    eRMSOPOption.Position = tmprecord.Position;
                                    eRMSOPOption.OptionPosition = tmprecord.Position;//[GEOS2-5629][gulab lakade][16 07 2024]
                                }
                                else
                                {
                                    eRMSOPOption.Position = Option.Position;
                                    eRMSOPOption.OptionPosition = Option.Position;//[GEOS2-5629][gulab lakade][16 07 2024]
                                }
                                eRMSOPOption.WorkOperation_count = Option.WorkOperation_count;
                                eRMSOPOption.WorkOperation_count_original = Option.WorkOperation_count_original;
                                eRMSOPOption.NameWithWorkOperationCount = Option.NameWithWorkOperationCount;
                                eRMSOPOption.IdDetection = Convert.ToUInt64(OptionsHeader.IdDetection);

                                //[GEOS2-3933][Rupali Sarode][22/09/2022]

                                if (tmprecord != null)
                                {
                                    eRMSOPOption.OptionNormalTime = tmprecord.OptionNormalTime;
                                    eRMSOPOption.OptionObservedTime = tmprecord.OptionObservedTime;
                                    eRMSOPOption.OptionActivity = tmprecord.OptionActivity;
                                    eRMSOPOption.WORemarks = tmprecord.WORemarks == null ? "" : tmprecord.WORemarks.Trim();
                                    eRMSOPOption.Remarks = tmprecord.Remarks == null ? "" : tmprecord.Remarks.Trim();
                                    Checkrecord = true;
                                }
                                else
                                {
                                    var record1 = records.Where(x => x.KeyName == Option.KeyName).FirstOrDefault();
                                    if (record1 != null)
                                    {
                                        eRMSOPOption.OptionNormalTime = record1.OptionNormalTime;
                                        eRMSOPOption.OptionObservedTime = record1.OptionObservedTime;
                                        eRMSOPOption.OptionActivity = record1.OptionActivity;
                                        eRMSOPOption.WORemarks = record1.WORemarks == null ? "" : record1.WORemarks.Trim();
                                        eRMSOPOption.Remarks = record1.Remarks == null ? "" : record1.Remarks.Trim();
                                        Checkrecord = true;
                                    }
                                    else
                                    {
                                        eRMSOPOption.OptionNormalTime = Option.NormalTime;
                                        eRMSOPOption.OptionObservedTime = Option.ObservedTime;
                                        eRMSOPOption.OptionActivity = Option.Activity;
                                        eRMSOPOption.WORemarks = Option.WORemarks == null ? "" : Option.WORemarks.Trim();
                                        eRMSOPOption.Remarks = Option.Remarks == null ? "" : Option.Remarks.Trim();
                                    }

                                }

                                if (GetStages.Any(a => a != null && a.Code.Trim().Equals(Option.Name.Trim())))
                                {
                                    //Option.IsCurrentWorkOperation = true;
                                    eRMSOPOption.IsDeleteButton = false;
                                    eRMSOPOption.IsDeleteButtonVisibility = Visibility.Hidden;
                                    eRMSOPOption.IsValidateOnTextInput = false;
                                }
                                else
                                {
                                    // Option.IsCurrentWorkOperation = true;

                                    eRMSOPOption.IsValidateOnTextInput = true;
                                }
                                if (Option.IdStatus == 1536)
                                {
                                    eRMSOPOption.IsInactiveWorkOperation = true;
                                }
                                try
                                {
                                    if (!TmpOptionMenulist.Any(a => a.KeyName.Equals(Option.KeyName)) && Checkrecord==true)
                                    {
                                        TmpOptionMenulist.Add(eRMSOPOption);
                                        ACC_OptionsList.Add(eRMSOPOption);
                                    }

                                }
                                catch (Exception ex)
                                {

                                }


                            }
                        }
                        TmpOptionMenulist = new ObservableCollection<ERMSOPOptions>();


                        foreach (ERMSOPOptions Option in ACC_OptionsList.OrderBy(a=>a.OptionPosition))
                        {

                            {
                                ERMSOPOptions eRMSOPOption = new ERMSOPOptions();
                                eRMSOPOption.Name = Option.Name;
                                eRMSOPOption.IdworkOperationByStage = Option.IdworkOperationByStage;
                                eRMSOPOption.IdSequence = Option.IdSequence;
                                eRMSOPOption.IdStatus = Option.IdStatus;
                                eRMSOPOption.Status = Option.Status;
                                eRMSOPOption.Code = Option.Name;
                                eRMSOPOption.Parent = Option.Parent;
                                eRMSOPOption.IdParent = Option.IdParent;
                                eRMSOPOption.KeyName = Option.KeyName;
                                eRMSOPOption.ParentName = Option.ParentName;
                                if (ACC_OptionsList != null)
                                {
                                    if (Option.ParentName == null)
                                    {
                                        eRMSOPOption.OptionPosition = Option.Position;
                                    }
                                    else
                                    {
                                        var TempModule = ACC_OptionsList.Where(x => x.KeyName == Option.KeyName).FirstOrDefault();
                                        if (TempModule != null)
                                        {
                                            eRMSOPOption.OptionPosition = TempModule.OptionPosition;
                                        }
                                        else
                                        {
                                            if (ACC_OptionsList.Where(x => x.ParentName == Option.ParentName).FirstOrDefault() == null)
                                            {
                                                var maxpos = ACC_OptionsList.Max(a => a.OptionPosition);
                                                eRMSOPOption.OptionPosition = maxpos + 1;
                                            }
                                            else
                                            {
                                                var maxpos = ACC_OptionsList.Where(x => x.ParentName == Option.ParentName).Max(a => a.OptionPosition);
                                                eRMSOPOption.OptionPosition = maxpos + 1;
                                            }

                                        }
                                    }


                                }
                                eRMSOPOption.WorkOperation_count = Option.WorkOperation_count;
                                eRMSOPOption.WorkOperation_count_original = Option.WorkOperation_count_original;
                                eRMSOPOption.NameWithWorkOperationCount = Option.NameWithWorkOperationCount;
                                eRMSOPOption.IdDetection = Convert.ToUInt64(OptionsHeader.IdDetection);

                                //[GEOS2-3933][Rupali Sarode][22/09/2022]
                                eRMSOPOption.WORemarks = Option.WORemarks == null ? "" : Option.WORemarks.Trim();
                                eRMSOPOption.Remarks = Option.Remarks == null ? "" : Option.Remarks.Trim();
                                if (Option.OptionActivity != null)
                                    eRMSOPOption.OptionActivity = Option.OptionActivity;
                                if (eRMSOPOption.OptionActivity != 0 && Option.OptionActivity != null)
                                    eRMSOPOption.OptionActivity = Math.Round((double)Option.OptionActivity, 2);
                                if (eRMSOPOption.OptionActivity == 0)
                                    eRMSOPOption.OptionActivity = null;

                                eRMSOPOption.OptionNormalTime = Option.OptionNormalTime;
                                eRMSOPOption.OptionObservedTime = Option.OptionObservedTime;
                                eRMSOPOption.UITempOptionObservedTime = ConvertfloattoTimespan(Convert.ToString(eRMSOPOption.OptionObservedTime));
                                if (GetStages.Any(a => a != null && a.Code.Trim().Equals(Option.Name.Trim())))
                                {
                                    //Option.IsCurrentWorkOperation = true;
                                    eRMSOPOption.IsDeleteButton = false;
                                    eRMSOPOption.IsDeleteButtonVisibility = Visibility.Hidden;
                                    eRMSOPOption.IsValidateOnTextInput = false;
                                }
                                else
                                {
                                    // Option.IsCurrentWorkOperation = true;

                                    eRMSOPOption.IsValidateOnTextInput = true;
                                }
                                if (Option.IdStatus == 1536)
                                {
                                    eRMSOPOption.IsInactiveWorkOperation = true;
                                }
                                try
                                {
                                    if (!TmpOptionMenulist.Any(a => a.KeyName.Equals(Option.KeyName)))
                                    {
                                        TmpOptionMenulist.Add(eRMSOPOption);

                                    }

                                }
                                catch (Exception ex)
                                {

                                }


                            }
                        }

                        List<ERMSOPOptions> tmpWorkOperationMenuList4 = TmpOptionMenulist.OrderBy(x => x.OptionPosition).ToList();
                        TmpOptionMenulist.Clear();
                        TmpOptionMenulist.AddRange(tmpWorkOperationMenuList4);
                        tmpWorkOperationMenuList4.Clear();
                        #endregion

                        #region commonCode
                        //foreach (ERMSOPOptions Option in OptionsMenulist)
                        //{
                        //    //if (Option.IdStatus != 1536)
                        //    if (operationOptionMenulist.Any(a => a.IdworkOperationByStage == Convert.ToInt64(Option.IdworkOperationByStage))
                        //       && operationOptionMenulist.Any(a => a.IdStage == Option.IdStage)
                        //    && operationOptionMenulist.Any(a => a.Name.Trim().Equals(Option.Name.Trim()))
                        //    )
                        //    {
                        //        ERMSOPOptions eRMSOPOption = new ERMSOPOptions();
                        //        eRMSOPOption.Name = Option.Name;
                        //        eRMSOPOption.IdworkOperationByStage = Option.IdworkOperationByStage;
                        //        eRMSOPOption.IdSequence = Option.IdSequence;
                        //        eRMSOPOption.IdStatus = Option.IdStatus;
                        //        eRMSOPOption.Status = Option.Status;
                        //        eRMSOPOption.Code = Option.Name;
                        //        eRMSOPOption.Parent = Option.Parent;
                        //        eRMSOPOption.IdParent = Option.IdParent;
                        //        eRMSOPOption.KeyName = Option.KeyName;
                        //        eRMSOPOption.ParentName = Option.ParentName;
                        //        eRMSOPOption.Position = Option.Position;
                        //        eRMSOPOption.WorkOperation_count = Option.WorkOperation_count;
                        //        eRMSOPOption.WorkOperation_count_original = Option.WorkOperation_count_original;
                        //        eRMSOPOption.NameWithWorkOperationCount = Option.NameWithWorkOperationCount;

                        //        if (Option.IdDetection != 0)
                        //            eRMSOPOption.IdDetection = Convert.ToUInt64(OptionsIdDetection);  // Assign new IdDetection

                        //        //[GEOS2-3933][Rupali Sarode][22/09/2022]
                        //        eRMSOPOption.WORemarks = Option.WORemarks == null ? "" : Option.WORemarks.Trim();
                        //        if (Option.OptionActivity != null)
                        //            eRMSOPOption.OptionActivity = Option.OptionActivity;
                        //        if (eRMSOPOption.OptionActivity != 0 && Option.OptionActivity != null)
                        //            eRMSOPOption.OptionActivity = Math.Round((double)Option.OptionActivity, 2);
                        //        if (eRMSOPOption.OptionActivity == 0)
                        //            eRMSOPOption.OptionActivity = null;

                        //        eRMSOPOption.OptionNormalTime = Option.OptionNormalTime;
                        //        eRMSOPOption.OptionObservedTime = Option.OptionObservedTime;

                        //        if (Option.OptionNormalTime != null)
                        //        {
                        //            eRMSOPOption.OptionNormalTime = Math.Round((double)Option.OptionNormalTime, 2);
                        //            #region [GEOS2-3954][Rupali Sarode]
                        //            eRMSOPOption.UITempOptionNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(eRMSOPOption.OptionNormalTime));
                        //            #endregion
                        //        }

                        //        if (Option.OptionObservedTime != null)
                        //        {
                        //            eRMSOPOption.OptionObservedTime = Math.Round((double)Option.OptionObservedTime, 2);
                        //            #region [GEOS2-3954][Rupali Sarode]
                        //            eRMSOPOption.UITempOptionObservedTime = ConvertfloattoTimespan(eRMSOPOption.OptionObservedTime.ToString());
                        //            #endregion
                        //        }


                        //        if (GetStages.Any(a => a != null && a.Code.Trim().Equals(Option.Name.Trim())))
                        //        {
                        //            //Option.IsCurrentWorkOperation = true;
                        //            eRMSOPOption.IsDeleteButton = false;
                        //            eRMSOPOption.IsDeleteButtonVisibility = Visibility.Hidden;
                        //            eRMSOPOption.IsValidateOnTextInput = false;
                        //        }
                        //        else
                        //        {
                        //            // Option.IsCurrentWorkOperation = true;

                        //            eRMSOPOption.IsValidateOnTextInput = true;
                        //        }
                        //        if (Option.IdStatus == 1536)
                        //        {
                        //            eRMSOPOption.IsInactiveWorkOperation = true;
                        //        }
                        //        try
                        //        {
                        //            if (!TmpOptionMenulist.Any(a => a.KeyName.Equals(Option.KeyName)))
                        //            {
                        //                TmpOptionMenulist.Add(eRMSOPOption);
                        //            }

                        //        }
                        //        catch (Exception ex)
                        //        {

                        //        }


                        //    }
                        //}

                        //List<ERMSOPOptions> tmpWorkOperationMenuList4 = TmpOptionMenulist.OrderBy(x => x.Position).ToList();
                        //TmpOptionMenulist.Clear();
                        //TmpOptionMenulist.AddRange(tmpWorkOperationMenuList4);
                        //tmpWorkOperationMenuList4.Clear();
                        #endregion


                        // }

                        e.Handled = true;
                    }
                    if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                }
                GeosApplication.Instance.Logger.Log("Method CompleteDropRecorOptionGridForAccordian()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in Method CompleteDropRecorOptionGridForAccordian()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        #endregion

        #region [GEOS2-3926][Rupali Sarode]
        private void StructuresAccordionControl_Drop(DragEventArgs e)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method StructuresAccordionControl_Drop()...", category: Category.Info, priority: Priority.Low);

                e.Effects = DragDropEffects.None;
                e.Handled = true;

                //MessageBoxResult MessageBoxResult = CustomMessageBox.Show(String.Format(Application.Current.Resources["AddEditSODCopyWorkOperationConfirmation"].ToString()), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                //if (MessageBoxResult == MessageBoxResult.Yes)
                //{
                e.Effects = DragDropEffects.Copy;
                //  if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }
                CompleteDropRecordStructureGridForAccordian(e);
                //  if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                e.Handled = true;
                //}
                GeosApplication.Instance.Logger.Log("Method StructuresAccordionControl_Drop()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {

                GeosApplication.Instance.Logger.Log(string.Format("Error in method StructuresAccordionControl_Drop() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        #region gulab lakade beta changes 05 08 2024
        List<ERMSOPStructures> tmpoldstructurlist = new List<ERMSOPStructures>();
        private void oldRecordStructureGridForAccordian(List<WorkOperationByStages> tmpchildmodule)
        {
            //tmpoldmodulelist = new List<ERMSOPModule>();
            foreach (var child in tmpchildmodule)
            {
                if (child.ParentName == null)
                {
                    ERMSOPStructures childrecord = new ERMSOPStructures();
                    childrecord.Name = child.Name;
                    childrecord.IdworkOperationByStage = child.IdworkOperationByStage;
                    childrecord.IdSequence = child.IdSequence;
                    childrecord.IdStatus = child.IdStatus;
                    childrecord.Status = child.Status;
                    childrecord.Code = child.Name;
                    childrecord.Parent = child.Parent;
                    childrecord.IdParent = child.IdParent;
                    childrecord.KeyName = child.KeyName;
                    childrecord.ParentName = child.ParentName;
                    childrecord.Position = Convert.ToUInt32(child.Position);
                    childrecord.StructurePosition = Convert.ToUInt32(child.Position);
                    tmpoldstructurlist.Add(childrecord);
                }
                else
                {
                    List<WorkOperationByStages> tmpchildmodule1 = WorkOperationMenulist.Where(a => a.KeyName == child.ParentName).ToList();
                    if (tmpchildmodule1.Count() > 0)
                    {
                        oldRecordStructureGridForAccordian(tmpchildmodule1);
                    }

                    //tmpoldmodulelist.AddRange();
                }

            }

            // return tmpoldmodulelist;
        }

        #endregion
        private void CompleteDropRecordStructureGridForAccordian(DragEventArgs e)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method CompleteDropRecordStructureGridForAccordian()...", category: Category.Info, priority: Priority.Low);
                if (SelectedItemStructures is ERMStructures)
                {
                    ulong tmpIdStructureWorkOperation = 0;
                    //IsEnabledSaveButton = true;
                    //SaveButtonVisibility = Visibility.Visible;
                    duplicateItemloopStructure = 0;
                    // if ((e.IsFromOutside) && typeof(WorkOperationByStages).IsAssignableFrom(e.GetRecordType()))
                    // {
                    //ModuleMenulist = new ObservableCollection<ERMSOPModule>();


                    ////  WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false); // [GEOS2-3909][Rupali Sarode][04-11-2022] 
                    var data = (RecordDragDropData)e.Data.GetData(typeof(RecordDragDropData));

                    List<WorkOperationByStages> found = new List<WorkOperationByStages>();
                    List<WorkOperationByStages> TempfoundAllrecords = new List<WorkOperationByStages>();
                    //List<WorkOperationByStages> records = data.Records.OfType<WorkOperationByStages>().ToList();
                    List<WorkOperationByStages> FindParent = new List<WorkOperationByStages>();
                    List<ERMSOPStructures> records = data.Records.OfType<ERMSOPStructures>().ToList();

                    AccordionItem itemModule = LayoutTreeHelper.GetVisualParents((DependencyObject)e.OriginalSource).OfType<AccordionItem>().FirstOrDefault();
                    ERMStructures ModuleHeader = (ERMStructures)itemModule.Header;
                    var StructureIdDetection = ModuleHeader.IdCPType;

                    //If user added from work operation left tab & 
                    //without save user dragged & drop, then first allow user to first save it.
                    //if (IsEnabledSaveButton && SaveButtonVisibility == Visibility.Visible)
                    Saveselecteditem = "Structure";
                    if (FlagToDragDrop == true)
                    {
                        if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                        MessageBoxResult MessageBoxResult = MessageBoxResult = CustomMessageBox.Show(string.Format(Application.Current.Resources["AddEditSODSaveWOBeforeDrag"].ToString()), "Yellow", CustomMessageBox.MessageImagePath.Warning, MessageBoxButton.YesNo);
                        if (MessageBoxResult == MessageBoxResult.Yes)
                        {
                            if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }
                            ISSavechanges = true;
                            IsEnabledSaveButton = false;
                            //SelectedItemOldclone = SelectedItem;
                            //SelectedItem = SelectedItemOld;
                            //var tempSelectedItem = SelectedItemOldclone;
                            SaveButtonCommandAction();
                            ISSavechanges = false;
                            //SelectedItem = tempSelectedItem;
                            //AcceptButtonCommandAction(null);
                            if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                            //SelectedItemDetection = SelectedItemOldDetection;
                            //if (SelectedItemOldcloneDetection != null)
                            //    SelectedItemDetection = SelectedItemOldcloneDetection;

                            //SelectedItemOption = SelectedItemOldOption;
                            //if (SelectedItemOldcloneOption != null)
                            //    SelectedItemOption = SelectedItemOldcloneOption;
                            //////GEOS2-3838 - Way
                            //SelectedItemWay = SelectedItemOldWay;
                            //if (SelectedItemOldcloneWay != null)
                            //    SelectedItemWay = SelectedItemOldcloneWay;
                            //[GEOS2-3601] - Structure
                            #region [GEOS2-4830][gulab lakade][07 12 2023]
                            //SelectedItemStructures = SelectedItemOldStructure;
                            //if (SelectedItemOldcloneStructure != null)
                            //    SelectedItemStructures = SelectedItemOldcloneStructure;

                            if (SelectedItemOldcloneStructure != null)
                            {
                                SelectedItemStructures = SelectedItemOldcloneStructure;
                            }
                            else
                            {
                                SelectedItemStructures = SelectedItemOldStructure;
                            }

                            #endregion

                            return;
                        }

                        if (MessageBoxResult == MessageBoxResult.No)
                        {
                            TmpModuleMenulist = null;
                            TmpDetectionMenulist = null;
                            TmpOptionMenulist = null;
                            TmpStructureMenulist = null;
                            TmpWayMenulist = null;
                            TmpSparePartsMenulist = null;
                            FlagToDragDrop = false;
                            TmpIdCPType = 0;
                            TmpIdDetection = 0;
                            TmpIdOption = 0;
                            TmpIdWayType = 0;
                            TmpIdStructure = 0;
                            TmpIdSpareParts = 0;
                            return;
                        }

                    }

                    MessageBoxResult MsgBoxResult = CustomMessageBox.Show(String.Format(Application.Current.Resources["AddEditSODCopyWorkOperationConfirmation"].ToString()), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                    if (MsgBoxResult == MessageBoxResult.Yes)
                    {

                        IsEnabledSaveButton = true;
                        SaveButtonVisibility = Visibility.Visible;


                        if (records.Count == 0)  // Dragging work operation from left panal is not allowed
                        {
                            CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("AddEditSODCopyWorkOperationNotAllowed").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                            return;
                        }

                        if (TmpIdStructure == 0)
                            TmpIdStructure = (ulong)StructureIdDetection;

                        if (TmpIdStructure != 0 && TmpIdStructure != StructureIdDetection) // if copied to different cptype without saving then popup the message
                        {
                            CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("AddEditSODCopyWOSavePreviousCopiedWO").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);

                            return;
                        }


                        if (TmpStructureMenulist == null)
                        {
                            TmpStructureMenulist = new ObservableCollection<ERMSOPStructures>();
                        }

                        if (StructureIdDetection == Convert.ToUInt64(records[0].IdCpType))  // Dragging in same CP type is not allowed
                        {
                            CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("AddEditSODCopyWorkOperationInSameCPtype").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                            return;
                        }

                        tmpIdStructureWorkOperation = tempLstStandardOperationsDictionaryStructures.Where(w => w.IdWorkoperation == Convert.ToUInt64(records[0].IdworkOperationByStage)
                         && w.IdCpTypeNew == Convert.ToUInt32(StructureIdDetection)).Select(s => s.IdWorkoperation).FirstOrDefault();

                        if (tmpIdStructureWorkOperation == 0)
                        {
                            tmpIdStructureWorkOperation = Convert.ToUInt64(TmpStructureMenulist.Where(w => w.IdworkOperationByStage == Convert.ToInt32(records[0].IdworkOperationByStage)
                                && Convert.ToUInt64(w.IdCpType) == StructureIdDetection).Select(s => s.IdworkOperationByStage).FirstOrDefault());
                        }

                        if (tmpIdStructureWorkOperation > 0)
                        {
                            MessageBoxResult MessageBoxResult = CustomMessageBox.Show(String.Format(Application.Current.Resources["AddEditSODCopyWorkOperationAlreadyExists"].ToString()), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                            if (MessageBoxResult == MessageBoxResult.No)
                            {
                                return;
                            }
                        }

                        List<WorkOperationByStages> tmpChildList = WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(records[0].KeyName)).ToList();
                        if (tmpChildList.Count > 0)
                        {
                            foreach (WorkOperationByStages child in tmpChildList)
                            {
                                tmpIdStructureWorkOperation = tempLstStandardOperationsDictionaryStructures.Where(w => w.IdWorkoperation == Convert.ToUInt64(child.IdworkOperationByStage)
                                && w.IdCpTypeNew == Convert.ToUInt32(StructureIdDetection)).Select(s => s.IdWorkoperation).FirstOrDefault();
                                if (tmpIdStructureWorkOperation > 0)
                                {
                                    MessageBoxResult MessageBoxResult = CustomMessageBox.Show(String.Format(Application.Current.Resources["AddEditSODCopyWorkOperationAlreadyExists"].ToString()), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                                    if (MessageBoxResult == MessageBoxResult.No)
                                    {
                                        return;
                                    }
                                    if (MessageBoxResult == MessageBoxResult.Yes)
                                        break;
                                }

                            }

                            if (tmpIdStructureWorkOperation == 0)
                            {
                                foreach (WorkOperationByStages child in tmpChildList)
                                {
                                    tmpIdStructureWorkOperation = Convert.ToUInt64(TmpStructureMenulist.Where(w => w.IdWorkoperation == child.IdworkOperationByStage
                                    && w.IdCpType == Convert.ToInt64(StructureIdDetection)).Select(s => s.IdWorkoperation).FirstOrDefault());
                                    if (tmpIdStructureWorkOperation > 0)
                                    {
                                        MessageBoxResult MessageBoxResult = CustomMessageBox.Show(String.Format(Application.Current.Resources["AddEditSODCopyWorkOperationAlreadyExists"].ToString()), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                                        if (MessageBoxResult == MessageBoxResult.No)
                                        {
                                            return;
                                        }
                                    }

                                }

                            }

                        }


                        // [GEOS2-4108][Rupali Sarode][04-01-2023]
                        TempStructureSelectedCopy = ModuleHeader;

                        operationStructureMenulist = new ObservableCollection<WorkOperationByStages>();
                        int count = 0;

                        if (records.Any(a => a.Name.Equals("All")))
                        {
                            #region ALL
                            found = new List<WorkOperationByStages>();
                            operationStructureMenulist = new ObservableCollection<WorkOperationByStages>();
                            operationStructureMenulist.AddRange(WorkOperationMenulist.Where(w => !w.Name.Equals("All")));
                            #endregion
                        }
                        else
                        {

                            for (int r = 0; r < records.Count(); r++)
                            {
                                //if (!StructureMenulist.Any(a => a.Name.Equals(records[r].Name)))
                                //{
                                //    // if (records[r].IdStatus != 1536) [rdixit][GEOS2-3764][04.08.2022]
                                //    //  {
                                //    records[r].IsCurrentWorkOperation = true;
                                //    //DetectionMenulist.Add(JsonConvert.DeserializeObject<ERMSOPDetection>(JsonConvert.SerializeObject(records[r])));
                                //    if (!operationStructureMenulist.Any(a => a.KeyName.Equals(records[r].KeyName)))
                                //        operationStructureMenulist.Add(records[r]);
                                //    // }
                                //}

                                if (GetStages.Any(a => a != null && a.Code.Trim().Equals(records[r].Name.Trim())))
                                {
                                    found.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(records[r].KeyName)).ToList());
                                    int x = 0;
                                    Loop:
                                    x++;
                                    if (x < 4)
                                    {
                                        for (int i = 0; i < found.Count(); i++)
                                        {
                                            TempfoundAllrecords.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(found[i].KeyName)).ToList());
                                        }
                                        for (int i = 0; i < TempfoundAllrecords.Count(); i++)
                                        {
                                            if (!found.Any(a => a != null && a.KeyName.Trim().Equals(TempfoundAllrecords[i].KeyName.Trim())))
                                                found.Add(TempfoundAllrecords[i]);
                                        }
                                        goto Loop;
                                    }

                                }
                                else
                                {
                                    found.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(records[r].KeyName)).ToList());
                                    for (int i = 0; i < found.Count(); i++)
                                    {
                                        TempfoundAllrecords.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(found[i].KeyName)).ToList());
                                    }
                                    for (int i = 0; i < TempfoundAllrecords.Count(); i++)
                                    {
                                        if (!found.Any(a => a != null && a.KeyName.Trim().Equals(TempfoundAllrecords[i].KeyName.Trim())))
                                            found.Add(TempfoundAllrecords[i]);
                                    }
                                    for (int i = 0; i < records.Where(a => a.IdworkOperationByStage > 0).Count(); i++)
                                    {
                                        if (!found.Any(a => a != null && a.KeyName.Trim().Equals(records[i].KeyName.Trim())))
                                            found.AddRange(WorkOperationMenulist.Where(s => s.IdworkOperationByStage == records[i].IdworkOperationByStage).ToList());
                                        if (found.Count() != 0)
                                        {
                                            count++;
                                        }
                                    }
                                }

                            }
                        }


                        if (count > 0)
                        {
                            for (int i = 0; i < found.Count(); i++)
                            {
                                if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(found[i].Name.Trim())))
                                {
                                    duplicateItemloopStructure = 0;
                                    GetAllTreeListStructure(found[i], WorkOperationMenulist);
                                }

                            }
                        }
                        else
                        {

                            if (!records.Any(a => a.Name.Equals("All")))
                                foreach (WorkOperationByStages item in found)
                                {
                                    duplicateItemloopStructure = 0;
                                    GetAllTreeListStructure(item, WorkOperationMenulist);
                                }
                        }
                        if (!records.Any(a => a.Name.Equals("All")))
                            if (operationStructureMenulist != null)
                            {
                                var tempStructureMenulist = operationStructureMenulist.ToList();
                                for (int i = 0; i < tempStructureMenulist.Count; i++)
                                {
                                    if (GetStages.Any(a => a.Code.Equals(tempStructureMenulist[i].Name)))
                                    {
                                        List<WorkOperationByStages> childList = operationStructureMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(tempStructureMenulist[i].KeyName)).ToList();
                                        if (childList.Count == 0)
                                        {
                                            operationStructureMenulist.Remove(tempStructureMenulist[i]);
                                        }
                                    }
                                }
                            }





                        #region Check for Head parent whose parent is null like CUT, CAM etc
                        ulong tempWOId = 0;
                        if (GetStages.Any(a => a != null && a.Code.Trim().Equals(records[0].Name.Trim())))
                        {

                            foreach (WorkOperationByStages wo in operationStructureMenulist)
                            {
                                tempWOId = tempLstStandardOperationsDictionaryStructures.Where(w => w.IdWorkoperation == Convert.ToUInt64(wo.IdworkOperationByStage)
                                && w.IdCpTypeNew == Convert.ToUInt32(StructureIdDetection)).Select(s => s.IdWorkoperation).FirstOrDefault();
                                if (tempWOId > 0)
                                    break;

                            }

                            if (tempWOId > 0)
                            {
                                MessageBoxResult MessageBoxResult = CustomMessageBox.Show(String.Format(Application.Current.Resources["AddEditSODCopyWOSaveAlreadyExistsStage"].ToString()), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                                if (MessageBoxResult == MessageBoxResult.No)
                                {
                                    return;
                                }
                            }
                        }

                        #endregion Check for Head parent whose parent is null like CUT, CAM etc





                        #region copy data to tempWorkOperationClonedStructure

                        tempWorkOperationClonedStructure = new List<ERMSOPStructures>();
                        var SelectedStructureItems = tempLstStandardOperationsDictionaryStructures.Where(w => w.IdCpTypeNew == Convert.ToUInt32(StructureIdDetection)).ToList();


                        for (int i = 0; i < SelectedStructureItems.Count; i++)
                        {
                            ERMSOPStructures eRMSOPStructure = new ERMSOPStructures();

                            WorkOperationByStages Module = new WorkOperationByStages();
                            Module = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == Convert.ToInt64(SelectedStructureItems[i].IdWorkoperation)).FirstOrDefault();

                            eRMSOPStructure.IdCpType = Convert.ToInt32(SelectedStructureItems[i].IdCpTypeNew);
                            eRMSOPStructure.Name = Module.Name;
                            eRMSOPStructure.IdworkOperationByStage = Module.IdworkOperationByStage;
                            eRMSOPStructure.IdSequence = Module.IdSequence;
                            eRMSOPStructure.IdStatus = Module.IdStatus;
                            eRMSOPStructure.Status = Module.Status;
                            eRMSOPStructure.Code = Module.Name;
                            eRMSOPStructure.Parent = Module.Parent;
                            eRMSOPStructure.IdParent = Module.IdParent;
                            eRMSOPStructure.KeyName = Module.KeyName;
                            eRMSOPStructure.ParentName = Module.ParentName;
                            //eRMSOPStructure.Position = Module.Position;
                            eRMSOPStructure.Position = Convert.ToUInt32(SelectedStructureItems[i].Position);//[GEOS2-5629][gulab lakade][16 07 2024]
                            eRMSOPStructure.StructurePosition = Convert.ToUInt32(SelectedStructureItems[i].StructurePosition);//[GEOS2-5629][gulab lakade][16 07 2024]
                            eRMSOPStructure.WorkOperation_count = Module.WorkOperation_count;
                            eRMSOPStructure.WorkOperation_count_original = Module.WorkOperation_count_original;
                            eRMSOPStructure.NameWithWorkOperationCount = Module.NameWithWorkOperationCount;
                            //[rdixit][03.08.2022][GEOS2-3764]
                            eRMSOPStructure.IsReadOnly = Module.IsReadOnly;
                            eRMSOPStructure.IsInactiveWorkOperation = Module.IsInactiveWorkOperation;

                            if (!GetStages.Any(a => a.Code.Equals(eRMSOPStructure.Name)))
                            {
                                var tempActivity = tempLstStandardOperationsDictionaryStructures.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPStructure.IdworkOperationByStage)
                                 && w.IdCpTypeNew == Convert.ToUInt32(eRMSOPStructure.IdCpType)).Select(s => s.Activity).DefaultIfEmpty(null).FirstOrDefault();
                                var tempObservedTime = tempLstStandardOperationsDictionaryStructures.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPStructure.IdworkOperationByStage)
                                 && w.IdCpTypeNew == Convert.ToUInt32(eRMSOPStructure.IdCpType)).Select(s => s.ObservedTime).DefaultIfEmpty(null).FirstOrDefault();
                                #region Geos2 4079 Structure Store/ Save in the SDO tables the Observed time, Activity
                                var tempStructure = tempLstStandardOperationsDictionaryStructures.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPStructure.IdworkOperationByStage)
                                && w.IdCpTypeNew == Convert.ToUInt32(eRMSOPStructure.IdCpType)).FirstOrDefault();

                                if (tempStructure != null)
                                {
                                    if (tempStructure.IdWorkoperation == Convert.ToUInt64(eRMSOPStructure.IdworkOperationByStage) && (tempStructure.Activity == null || tempStructure.Activity == 0))
                                    {
                                        tempActivity = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == Module.IdworkOperationByStage).Select(b => b.Activity).FirstOrDefault();
                                    }
                                    if (tempStructure.IdWorkoperation == Convert.ToUInt64(eRMSOPStructure.IdworkOperationByStage) && (tempStructure.ObservedTime == null || tempStructure.ObservedTime == 0))
                                    {
                                        tempObservedTime = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == Module.IdworkOperationByStage).Select(b => b.ObservedTime).FirstOrDefault();
                                    }
                                }
                                #endregion
                                if (tempActivity != null)
                                    eRMSOPStructure.StructureActivity = Math.Round((double)tempActivity, 2);
                                //if (tempObservedTime != null)
                                //    eRMSOPStructure.ObservedTime = Math.Round((double)tempObservedTime, 2);
                                if (tempObservedTime != null)
                                {
                                    eRMSOPStructure.StructureObservedTime = Math.Round((double)tempObservedTime, 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    //   eRMSOPStructure.UITempStructureObservedTime = tempLstStandardOperationsDictionaryStructures.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPStructure.IdworkOperationByStage)
                                    //&& w.IdCpType == Convert.ToUInt64(eRMSOPStructure.IdCpType)).Select(s => s.UITempStructureObservedTime).FirstOrDefault();
                                    eRMSOPStructure.UITempStructureObservedTime = TimeSpan.FromMinutes(Convert.ToDouble(tempObservedTime));
                                    #endregion
                                }

                                eRMSOPStructure.StructureNormalTime = Math.Round(Convert.ToDouble(eRMSOPStructure.StructureObservedTime * eRMSOPStructure.StructureActivity / 100), 2);
                                #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                eRMSOPStructure.UITempStructureNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(eRMSOPStructure.StructureNormalTime));

                                #endregion
                                //[GEOS2-3933][Rupali Sarode][21/09/2022]
                                eRMSOPStructure.WORemarks = Module.WORemarks == null ? "" : Module.WORemarks.Trim();

                                var tempRemarks = tempLstStandardOperationsDictionaryStructures.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPStructure.IdworkOperationByStage)
                                 && w.IdCpTypeNew == Convert.ToUInt32(eRMSOPStructure.IdCpType)).Select(s => s.Remarks).DefaultIfEmpty(null).FirstOrDefault();

                                eRMSOPStructure.Remarks = tempRemarks == null ? "" : tempRemarks.Trim();

                            }
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(Module.Name.Trim())))
                            {
                                eRMSOPStructure.IsDeleteButton = false;
                                eRMSOPStructure.IsDeleteButtonVisibility = Visibility.Hidden;
                                // eRMSOPStructure.ObservedTimeIsReadOnly =true;
                                eRMSOPStructure.IsReadOnly = true;
                                eRMSOPStructure.IsValidateOnTextInput = false;
                                Module.IsCurrentWorkOperation = true;
                            }
                            else
                            {
                                Module.IsCurrentWorkOperation = true;
                                //eRMSOPStructure.ObservedTimeIsReadOnly = false;
                                eRMSOPStructure.IsReadOnly = false;
                                eRMSOPStructure.IsValidateOnTextInput = true;
                            }
                            if (Module.IdStatus == 1536)
                            {
                                eRMSOPStructure.IsInactiveWorkOperation = true;
                                eRMSOPStructure.IsReadOnly = true;
                            }
                            try
                            {
                                //  if (!tempWorkOperationClonedModule.Any(a => a.KeyName.Equals(Module.KeyName)))
                                tempWorkOperationClonedStructure.Add(eRMSOPStructure);
                            }
                            catch (Exception ex)
                            {

                            }



                            //}
                            //}
                        }
                        #region //[GEOS2-5629][gulab lakade][16 07 2024]
                        List<StandardOperationsDictionaryStructures> tempStandardOperationsDictionaryStructures_Accordian = tempLstStandardOperationsDictionaryStructures.Where(w => w.IdCpTypeNew == Convert.ToUInt32(StructureIdDetection)).ToList();
                        //StructureMenulist = new ObservableCollection<ERMSOPStructures>();
                        duplicateItemloopStructure = 0;
                        duplicateItemloop = 0;
                        if (tempStandardOperationsDictionaryStructures_Accordian.Count() > 0)
                        {
                            foreach (var eRMSOPStructure in tempStandardOperationsDictionaryStructures_Accordian)
                            {
                                if (eRMSOPStructure != null)
                                {
                                    List<WorkOperationByStages> tempStructureList = WorkOperationMenulist.Where(w => w.IdworkOperationByStage == Convert.ToInt32(eRMSOPStructure.IdWorkoperation) && w.Name == eRMSOPStructure.WorkOperationName).ToList();  //[Cut  work operation not work properly.][gulab lakade][24 01 2023]
                                    if (tempStructureList != null)
                                        foreach (WorkOperationByStages item in tempStructureList)
                                        {
                                            if (item.IdStatus == 1536)//[rdixit][03.08.2022][GEOS2-3764]
                                            {
                                                item.IsInactiveWorkOperation = true;
                                                item.IsReadOnly = true;
                                            }
                                            WorkOperationByStages ParentName = WorkOperationMenulist.Where(w => w.KeyName.Equals(item.ParentName)).FirstOrDefault();
                                            if (ParentName != null)
                                            {
                                                if (!operationStructureMenulist.Any(a => a.KeyName.Equals(ParentName.KeyName)))
                                                    operationStructureMenulist.Add(ParentName);
                                            }
                                            duplicateItemloopStructure = 0;
                                            duplicateItemloop = 0;
                                            GetAllTreeListStructure(item, WorkOperationMenulist);
                                        }

                                }

                            }
                        }
                        #region gulab lakade beta changes 05 08 2024
                        if (tempWorkOperationClonedStructure != null && tempWorkOperationClonedStructure.Count() > 0)
                        {
                            tmpoldstructurlist = new List<ERMSOPStructures>();
                            foreach (ERMSOPStructures item in tempWorkOperationClonedStructure)
                            {
                                records.Add(item);
                                var tmpmodule = WorkOperationMenulist.Where(a => a.KeyName == item.ParentName).ToList();
                                if (tmpmodule.Count() > 0)
                                {
                                    foreach (var child in tmpmodule)
                                    {
                                        if (child.ParentName == null)
                                        {
                                            ERMSOPStructures childrecord = new ERMSOPStructures();
                                            childrecord.Name = child.Name;
                                            childrecord.IdworkOperationByStage = child.IdworkOperationByStage;
                                            childrecord.IdSequence = child.IdSequence;
                                            childrecord.IdStatus = child.IdStatus;
                                            childrecord.Status = child.Status;
                                            childrecord.Code = child.Name;
                                            childrecord.Parent = child.Parent;
                                            childrecord.IdParent = child.IdParent;
                                            childrecord.KeyName = child.KeyName;
                                            childrecord.ParentName = child.ParentName;
                                            childrecord.Position = Convert.ToUInt32(child.Position);
                                            childrecord.StructurePosition = Convert.ToUInt32(child.Position);
                                            tmpoldstructurlist.Add(childrecord);
                                        }
                                        else
                                        {
                                            var tmpchildmodule = WorkOperationMenulist.Where(a => a.KeyName == child.ParentName).ToList();
                                            if (tmpchildmodule.Count() > 0)
                                            {
                                                oldRecordStructureGridForAccordian(tmpchildmodule);
                                            }
                                        }

                                    }
                                }
                            }

                            records.AddRange(tmpoldstructurlist);
                            tmpoldstructurlist = new List<ERMSOPStructures>();
                            //records.AddRange(tempWorkOperationClonedStructure);
                        }
                        #endregion
                        List<ERMSOPStructures> ACC_Structurelist = new List<ERMSOPStructures>();
                        bool FlagAddItemModule = false;
                        foreach (var Module in operationStructureMenulist)
                        {
                            //if (Module.IdworkOperationByStage == records[0].IdworkOperationByStage)
                            //if (operationStructureMenulist.Any(a => a.IdworkOperationByStage == Convert.ToInt64(Module.IdworkOperationByStage))
                            //       && operationStructureMenulist.Any(a => a.IdStage == Module.IdStage)
                            //    && operationStructureMenulist.Any(a => a.Name.Trim().Equals(Module.Name.Trim()))
                            //    )
                            #region  [GEOS2-5135][Rupali Sarode][18-12-2023]
                            FlagAddItemModule = true;
                            // If it is child & only active then add
                            List<WorkOperationByStages> childListInActiveDraft = operationStructureMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(Module.KeyName)).ToList();

                            if (childListInActiveDraft.Count == 0)
                            {
                                if (Module.IdStatus == 1535)
                                {
                                    FlagAddItemModule = true;
                                }
                                else
                                    FlagAddItemModule = false;
                            }
                            else // If it is parent and does not contain any active child, then do not include it
                            if (childListInActiveDraft.Count > 0)
                            {
                                //List<WorkOperationByStages> childListInParent = operationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(Module.KeyName)).ToList();
                                foreach (WorkOperationByStages objChild in childListInActiveDraft)
                                {
                                    List<WorkOperationByStages> GrandChildListInActiveDraft = new List<WorkOperationByStages>();
                                    GrandChildListInActiveDraft = operationStructureMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(objChild.KeyName)).ToList();
                                    if (GrandChildListInActiveDraft.Count == 0)
                                    { // If it is child and Active
                                        if (objChild.IdStatus == 1535)
                                        {
                                            FlagAddItemModule = true;
                                            break;
                                        }
                                        else
                                        {
                                            FlagAddItemModule = false;
                                        }

                                    }
                                    else
                                    {
                                        if (GrandChildListInActiveDraft.Count > 0)
                                        {
                                            if (GrandChildListInActiveDraft.Where(i => i.IdStatus == 1535).Count() > 0)
                                            {
                                                FlagAddItemModule = true;
                                                break;
                                            }
                                            else
                                            {
                                                FlagAddItemModule = false;
                                            }
                                        }
                                    }
                                }
                            }
                            #endregion  [GEOS2-5135][Rupali Sarode][18-12-2023]
                            if (FlagAddItemModule == true)
                            {
                                bool Checkrecord = false;
                                //var tmprecord = records.Where(x => x.KeyName == Module.KeyName).FirstOrDefault();
                                var tmprecord = StructureMenulist.Where(x => x.KeyName == Module.KeyName).FirstOrDefault();
                                ERMSOPStructures eRMSOPStructure = new ERMSOPStructures();
                                eRMSOPStructure.Name = Module.Name;
                                eRMSOPStructure.IdworkOperationByStage = Module.IdworkOperationByStage;
                                eRMSOPStructure.IdSequence = Module.IdSequence;
                                eRMSOPStructure.IdStatus = Module.IdStatus;
                                eRMSOPStructure.Status = Module.Status;
                                eRMSOPStructure.Code = Module.Name;
                                eRMSOPStructure.Parent = Module.Parent;
                                eRMSOPStructure.IdParent = Module.IdParent;
                                eRMSOPStructure.KeyName = Module.KeyName;
                                eRMSOPStructure.ParentName = Module.ParentName;
                                var ACC_Record = tempStandardOperationsDictionaryStructures_Accordian.Where(a => a.IdWorkoperation == Convert.ToUInt32(Module.IdworkOperationByStage)).FirstOrDefault();
                                if (ACC_Record != null)
                                {
                                    eRMSOPStructure.Position = Convert.ToUInt32(ACC_Record.Position);
                                    eRMSOPStructure.StructurePosition = Convert.ToUInt32(ACC_Record.Position);//[GEOS2-5629][gulab lakade][16 07 2024]
                                }
                                else if (tmprecord != null)
                                {
                                    eRMSOPStructure.Position = tmprecord.Position;
                                    eRMSOPStructure.StructurePosition = tmprecord.Position;//[GEOS2-5629][gulab lakade][16 07 2024]
                                }
                                else
                                {
                                    eRMSOPStructure.Position = Module.Position;
                                    eRMSOPStructure.StructurePosition = Module.Position;//[GEOS2-5629][gulab lakade][16 07 2024]
                                }
                                eRMSOPStructure.WorkOperation_count = Module.WorkOperation_count;
                                eRMSOPStructure.WorkOperation_count_original = Module.WorkOperation_count_original;
                                eRMSOPStructure.NameWithWorkOperationCount = Module.NameWithWorkOperationCount;

                                eRMSOPStructure.IdCpType = Convert.ToInt32(StructureIdDetection);  // Assign new IdCPType
                                                                                                   //eRMSOPStructure.NameWithWorkOperationCount 
                                                                                                   //[GEOS2-3933][Rupali Sarode][21/09/2022]

                                if (tmprecord != null)
                                {
                                    eRMSOPStructure.StructureNormalTime = tmprecord.StructureNormalTime;
                                    eRMSOPStructure.StructureObservedTime = tmprecord.StructureObservedTime;
                                    eRMSOPStructure.StructureActivity = tmprecord.StructureActivity;
                                    eRMSOPStructure.WORemarks = tmprecord.WORemarks == null ? "" : tmprecord.WORemarks.Trim();
                                    eRMSOPStructure.Remarks = tmprecord.Remarks == null ? "" : tmprecord.Remarks.Trim();
                                    Checkrecord = true;
                                }
                                else
                                {
                                    var tmprecord1 = records.Where(x => x.KeyName == Module.KeyName).FirstOrDefault();
                                    if (tmprecord1 != null)
                                    {
                                        eRMSOPStructure.StructureNormalTime = tmprecord1.StructureNormalTime;
                                        eRMSOPStructure.StructureObservedTime = tmprecord1.StructureObservedTime;
                                        eRMSOPStructure.StructureActivity = tmprecord1.StructureActivity;
                                        eRMSOPStructure.WORemarks = tmprecord1.WORemarks == null ? "" : tmprecord1.WORemarks.Trim();
                                        eRMSOPStructure.Remarks = tmprecord1.Remarks == null ? "" : tmprecord1.Remarks.Trim();
                                        Checkrecord = true;
                                    }
                                    else
                                    {
                                        eRMSOPStructure.StructureNormalTime = Module.NormalTime;
                                        eRMSOPStructure.StructureObservedTime = Module.ObservedTime;
                                        eRMSOPStructure.StructureActivity = Module.Activity;
                                        eRMSOPStructure.WORemarks = Module.WORemarks == null ? "" : Module.WORemarks.Trim();
                                        eRMSOPStructure.Remarks = Module.Remarks == null ? "" : Module.Remarks.Trim();
                                    }

                                }

                                if (GetStages.Any(a => a != null && a.Code.Trim().Equals(Module.Name.Trim())))
                                {
                                    //    Module.IsCurrentWorkOperation = true;
                                    eRMSOPStructure.IsDeleteButton = false;
                                    eRMSOPStructure.IsDeleteButtonVisibility = Visibility.Hidden;
                                    eRMSOPStructure.IsValidateOnTextInput = false;
                                }
                                else
                                {
                                    //  Module.IsCurrentWorkOperation = true;
                                    eRMSOPStructure.IsValidateOnTextInput = true;
                                }
                                if (Module.IdStatus == 1536)
                                {
                                    eRMSOPStructure.IsInactiveWorkOperation = true;

                                }
                                else
                                {

                                }
                                try
                                {
                                    if (!TmpStructureMenulist.Any(a => a.KeyName.Equals(Module.KeyName)) && Checkrecord==true)
                                    {
                                        TmpStructureMenulist.Add(eRMSOPStructure);
                                        ACC_Structurelist.Add(eRMSOPStructure);
                                    }

                                }
                                catch (Exception ex)
                                {

                                }


                            }
                        }

                        TmpStructureMenulist = new ObservableCollection<ERMSOPStructures>();
                        foreach (ERMSOPStructures Module in ACC_Structurelist.OrderBy(a=>a.StructurePosition))
                        {
                            //if (Module.IdworkOperationByStage == records[0].IdworkOperationByStage)
                            //if (operationStructureMenulist.Any(a => a.IdworkOperationByStage == Convert.ToInt64(Module.IdworkOperationByStage))
                            //       && operationStructureMenulist.Any(a => a.IdStage == Module.IdStage)
                            //    && operationStructureMenulist.Any(a => a.Name.Trim().Equals(Module.Name.Trim()))
                            //    )
                            {

                                ERMSOPStructures eRMSOPStructure = new ERMSOPStructures();
                                eRMSOPStructure.Name = Module.Name;
                                eRMSOPStructure.IdworkOperationByStage = Module.IdworkOperationByStage;
                                eRMSOPStructure.IdSequence = Module.IdSequence;
                                eRMSOPStructure.IdStatus = Module.IdStatus;
                                eRMSOPStructure.Status = Module.Status;
                                eRMSOPStructure.Code = Module.Name;
                                eRMSOPStructure.Parent = Module.Parent;
                                eRMSOPStructure.IdParent = Module.IdParent;
                                eRMSOPStructure.KeyName = Module.KeyName;
                                eRMSOPStructure.ParentName = Module.ParentName;
                                if (ACC_Structurelist != null)
                                {
                                    if (Module.ParentName == null)
                                    {
                                        eRMSOPStructure.StructurePosition = Module.Position;
                                    }
                                    else
                                    {
                                        var TempModule = ACC_Structurelist.Where(x => x.KeyName == Module.KeyName).FirstOrDefault();
                                        if (TempModule != null)
                                        {
                                            eRMSOPStructure.StructurePosition = TempModule.StructurePosition;
                                        }
                                        else
                                        {
                                            if (ACC_Structurelist.Where(x => x.ParentName == Module.ParentName).FirstOrDefault() == null)
                                            {
                                                var maxpos = ACC_Structurelist.Max(a => a.StructurePosition);
                                                eRMSOPStructure.StructurePosition = maxpos + 1;
                                            }
                                            else
                                            {
                                                var maxpos = ACC_Structurelist.Where(x => x.ParentName == Module.ParentName).Max(a => a.StructurePosition);
                                                eRMSOPStructure.StructurePosition = maxpos + 1;
                                            }

                                        }
                                    }


                                }
                                eRMSOPStructure.WorkOperation_count = Module.WorkOperation_count;
                                eRMSOPStructure.WorkOperation_count_original = Module.WorkOperation_count_original;
                                eRMSOPStructure.NameWithWorkOperationCount = Module.NameWithWorkOperationCount;
                                eRMSOPStructure.StructureNormalTime = Module.StructureNormalTime;
                                eRMSOPStructure.IdCpType = Convert.ToInt32(StructureIdDetection);  // Assign new IdCPType
                                                                                                   //eRMSOPStructure.NameWithWorkOperationCount 
                                                                                                   //[GEOS2-3933][Rupali Sarode][21/09/2022]
                                eRMSOPStructure.WORemarks = Module.WORemarks == null ? "" : Module.WORemarks.Trim();
                                eRMSOPStructure.Remarks = Module.Remarks == null ? "" : Module.Remarks.Trim();

                                eRMSOPStructure.StructureObservedTime = Module.StructureObservedTime;
                                eRMSOPStructure.UITempStructureObservedTime = ConvertfloattoTimespan(Convert.ToString(eRMSOPStructure.StructureObservedTime));

                                if (Module.StructureActivity != null)
                                    eRMSOPStructure.StructureActivity = Module.StructureActivity;

                                if (Module.StructureActivity != 0 && Module.StructureActivity != null)
                                    eRMSOPStructure.StructureActivity = Math.Round((double)Module.StructureActivity, 2);
                                if (eRMSOPStructure.StructureActivity == 0)
                                    eRMSOPStructure.StructureActivity = null;

                                if (GetStages.Any(a => a != null && a.Code.Trim().Equals(Module.Name.Trim())))
                                {
                                    //    Module.IsCurrentWorkOperation = true;
                                    eRMSOPStructure.IsDeleteButton = false;
                                    eRMSOPStructure.IsDeleteButtonVisibility = Visibility.Hidden;
                                    eRMSOPStructure.IsValidateOnTextInput = false;
                                }
                                else
                                {
                                    //  Module.IsCurrentWorkOperation = true;
                                    eRMSOPStructure.IsValidateOnTextInput = true;
                                }
                                if (Module.IdStatus == 1536)
                                {
                                    eRMSOPStructure.IsInactiveWorkOperation = true;

                                }
                                else
                                {

                                }
                                try
                                {
                                    if (!TmpStructureMenulist.Any(a => a.KeyName.Equals(Module.KeyName)))
                                    {
                                        TmpStructureMenulist.Add(eRMSOPStructure);
                                    }

                                }
                                catch (Exception ex)
                                {

                                }


                            }
                        }
                        if (TmpStructureMenulist != null)
                        {
                            List<ERMSOPStructures> tmpWorkOperationMenuListStruct = TmpStructureMenulist.OrderBy(x => x.StructurePosition).ToList();
                            TmpStructureMenulist.Clear();
                            TmpStructureMenulist.AddRange(tmpWorkOperationMenuListStruct);
                            tmpWorkOperationMenuListStruct.Clear();
                        }
                        #endregion

                        //var tempWorkOperationMenuListStruct = tempWorkOperationClonedStructure.OrderBy(x => x.Position).ToList();
                        //tempWorkOperationClonedStructure.Clear();
                        //tempWorkOperationClonedStructure = new List<ERMSOPStructures>();
                        //tempWorkOperationClonedStructure.AddRange(tempWorkOperationMenuListStruct);
                        //tempWorkOperationMenuListStruct.Clear();

                        #endregion copy data to tempWorkOperationClonedStructure

                        #region commonCode

                        //foreach (ERMSOPStructures Module in StructureMenulist)
                        //{
                        //    //if (Module.IdworkOperationByStage == records[0].IdworkOperationByStage)
                        //    if (operationStructureMenulist.Any(a => a.IdworkOperationByStage == Convert.ToInt64(Module.IdworkOperationByStage))
                        //           && operationStructureMenulist.Any(a => a.IdStage == Module.IdStage)
                        //        && operationStructureMenulist.Any(a => a.Name.Trim().Equals(Module.Name.Trim()))
                        //        )
                        //    {

                        //        ERMSOPStructures eRMSOPStructure = new ERMSOPStructures();
                        //        eRMSOPStructure.Name = Module.Name;
                        //        eRMSOPStructure.IdworkOperationByStage = Module.IdworkOperationByStage;
                        //        eRMSOPStructure.IdSequence = Module.IdSequence;
                        //        eRMSOPStructure.IdStatus = Module.IdStatus;
                        //        eRMSOPStructure.Status = Module.Status;
                        //        eRMSOPStructure.Code = Module.Name;
                        //        eRMSOPStructure.Parent = Module.Parent;
                        //        eRMSOPStructure.IdParent = Module.IdParent;
                        //        eRMSOPStructure.KeyName = Module.KeyName;
                        //        eRMSOPStructure.ParentName = Module.ParentName;
                        //        eRMSOPStructure.Position = Module.Position;
                        //        eRMSOPStructure.WorkOperation_count = Module.WorkOperation_count;
                        //        eRMSOPStructure.WorkOperation_count_original = Module.WorkOperation_count_original;
                        //        eRMSOPStructure.NameWithWorkOperationCount = Module.NameWithWorkOperationCount;
                        //        eRMSOPStructure.StructureNormalTime = Module.StructureNormalTime;

                        //        if (Module.IdCpType != 0)
                        //            eRMSOPStructure.IdCpType = Convert.ToInt32(StructureIdDetection);  // Assign new IdCPType
                        //                                                                               //eRMSOPStructure.NameWithWorkOperationCount 
                        //                                                                               //[GEOS2-3933][Rupali Sarode][21/09/2022]
                        //        eRMSOPStructure.WORemarks = Module.WORemarks == null ? "" : Module.WORemarks.Trim();

                        //        if (Module.StructureNormalTime != null)
                        //        {
                        //            eRMSOPStructure.StructureNormalTime = Math.Round((double)Module.StructureNormalTime, 2);
                        //            #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                        //            eRMSOPStructure.UITempStructureNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(eRMSOPStructure.UITempStructureNormalTime));
                        //            #endregion
                        //        }
                        //        eRMSOPStructure.StructureObservedTime = Module.StructureObservedTime;
                        //        if (Module.StructureObservedTime != null)
                        //        {
                        //            eRMSOPStructure.StructureObservedTime = Math.Round((double)Module.StructureObservedTime, 2);
                        //            #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                        //            eRMSOPStructure.UITempStructureObservedTime = ConvertfloattoTimespan(Convert.ToString(eRMSOPStructure.StructureObservedTime));
                        //            #endregion
                        //        }

                        //        if (Module.StructureActivity != null)
                        //            eRMSOPStructure.StructureActivity = Module.StructureActivity;

                        //        if (Module.StructureActivity != 0 && Module.StructureActivity != null)
                        //            eRMSOPStructure.StructureActivity = Math.Round((double)Module.StructureActivity, 2);
                        //        if (eRMSOPStructure.StructureActivity == 0)
                        //            eRMSOPStructure.StructureActivity = null;

                        //        if (GetStages.Any(a => a != null && a.Code.Trim().Equals(Module.Name.Trim())))
                        //        {
                        //            //    Module.IsCurrentWorkOperation = true;
                        //            eRMSOPStructure.IsDeleteButton = false;
                        //            eRMSOPStructure.IsDeleteButtonVisibility = Visibility.Hidden;
                        //            eRMSOPStructure.IsValidateOnTextInput = false;
                        //        }
                        //        else
                        //        {
                        //            //  Module.IsCurrentWorkOperation = true;
                        //            eRMSOPStructure.IsValidateOnTextInput = true;
                        //        }
                        //        if (Module.IdStatus == 1536)
                        //        {
                        //            eRMSOPStructure.IsInactiveWorkOperation = true;

                        //        }
                        //        else
                        //        {

                        //        }
                        //        try
                        //        {
                        //            if (!TmpStructureMenulist.Any(a => a.KeyName.Equals(Module.KeyName)))
                        //            {
                        //                TmpStructureMenulist.Add(eRMSOPStructure);
                        //            }

                        //        }
                        //        catch (Exception ex)
                        //        {

                        //        }


                        //    }
                        //}
                        //if (TmpStructureMenulist != null)
                        //{
                        //    List<ERMSOPStructures> tmpWorkOperationMenuListStruct = TmpStructureMenulist.OrderBy(x => x.Position).ToList();
                        //    TmpStructureMenulist.Clear();
                        //    TmpStructureMenulist.AddRange(tmpWorkOperationMenuListStruct);
                        //    tmpWorkOperationMenuListStruct.Clear();
                        //}
                        #endregion


                        e.Handled = true;
                    }
                    if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                }
                GeosApplication.Instance.Logger.Log("Method CompleteDropRecordStructureGridForAccordian()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in Method CompleteDropRecordStructureGridForAccordian()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        #endregion

        #region [GEOS2-3923][sdeshpande][17-11-2022]
        private void WaysAccordionControl_Drop(DragEventArgs e)

        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method WaysAccordionControl_Drop()...", category: Category.Info, priority: Priority.Low);

                e.Effects = DragDropEffects.None;
                e.Handled = true;
                e.Effects = DragDropEffects.Copy;
                CompleteDropRecordWaysGridForAccordian(e);
                e.Handled = true;
                GeosApplication.Instance.Logger.Log("Method WaysAccordionControl_Drop()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {

                GeosApplication.Instance.Logger.Log(string.Format("Error in method WaysAccordionControl_Drop() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        #region gulab lakade beta changes 05 08 2024
        List<ERMSOPWays> tmpoldwaylist = new List<ERMSOPWays>();
        private void oldRecordWayGridForAccordian(List<WorkOperationByStages> tmpchildmodule)
        {
            //tmpoldmodulelist = new List<ERMSOPModule>();
            foreach (var child in tmpchildmodule)
            {
                if (child.ParentName == null)
                {
                    ERMSOPWays childrecord = new ERMSOPWays();
                    childrecord.Name = child.Name;
                    childrecord.IdworkOperationByStage = child.IdworkOperationByStage;
                    childrecord.IdSequence = child.IdSequence;
                    childrecord.IdStatus = child.IdStatus;
                    childrecord.Status = child.Status;
                    childrecord.Code = child.Name;
                    childrecord.Parent = child.Parent;
                    childrecord.IdParent = child.IdParent;
                    childrecord.KeyName = child.KeyName;
                    childrecord.ParentName = child.ParentName;
                    childrecord.Position = Convert.ToUInt32(child.Position);
                    childrecord.WayPosition = Convert.ToUInt32(child.Position);
                    tmpoldwaylist.Add(childrecord);
                }
                else
                {
                    List<WorkOperationByStages> tmpchildmodule1 = WorkOperationMenulist.Where(a => a.KeyName == child.ParentName).ToList();
                    if (tmpchildmodule1.Count() > 0)
                    {
                        oldRecordWayGridForAccordian(tmpchildmodule1);
                    }

                    //tmpoldmodulelist.AddRange();
                }

            }

            // return tmpoldmodulelist;
        }

        #endregion
        private void CompleteDropRecordWaysGridForAccordian(DragEventArgs e)
        {
            try
            {

                GeosApplication.Instance.Logger.Log("Method CompleteDropRecordWaysGridForAccordian()...", category: Category.Info, priority: Priority.Low);
                if (SelectedItemWay is ERMWays)
                {
                    ulong tmpIdWaysWorkOperation = 0;
                    duplicateItemloopWay = 0;

                    ////  WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false); // [GEOS2-3909][Rupali Sarode][04-11-2022] 
                    var data = (RecordDragDropData)e.Data.GetData(typeof(RecordDragDropData));

                    List<WorkOperationByStages> found = new List<WorkOperationByStages>();
                    List<WorkOperationByStages> TempfoundAllrecords = new List<WorkOperationByStages>();
                    //List<WorkOperationByStages> records = data.Records.OfType<WorkOperationByStages>().ToList();
                    List<WorkOperationByStages> FindParent = new List<WorkOperationByStages>();
                    List<ERMSOPWays> records = data.Records.OfType<ERMSOPWays>().ToList();

                    AccordionItem itemWays = LayoutTreeHelper.GetVisualParents((DependencyObject)e.OriginalSource).OfType<AccordionItem>().FirstOrDefault();
                    ERMWays WayHeader = (ERMWays)itemWays.Header;
                    var WaysIdCPType = WayHeader.IdDetection;

                    //If user added from work operation left tab & 
                    //without save user dragged & drop, then first allow user to first save it.
                    //if (IsEnabledSaveButton && SaveButtonVisibility == Visibility.Visible)
                    Saveselecteditem = "Ways";
                    if (FlagToDragDrop == true)
                    {
                        if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                        MessageBoxResult MessageBoxResult = MessageBoxResult = CustomMessageBox.Show(string.Format(Application.Current.Resources["AddEditSODSaveWOBeforeDrag"].ToString()), "Yellow", CustomMessageBox.MessageImagePath.Warning, MessageBoxButton.YesNo);
                        if (MessageBoxResult == MessageBoxResult.Yes)
                        {
                            if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }
                            ISSavechanges = true;
                            IsEnabledSaveButton = false;
                            //SelectedItemOldclone = SelectedItem;
                            //SelectedItem = SelectedItemOld;
                            //var tempSelectedItem = SelectedItemOldclone;
                            SaveButtonCommandAction();
                            ISSavechanges = false;
                            //SelectedItem = tempSelectedItem;
                            //AcceptButtonCommandAction(null);
                            if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                            //SelectedItemDetection = SelectedItemOldDetection;
                            //if (SelectedItemOldcloneDetection != null)
                            //    SelectedItemDetection = SelectedItemOldcloneDetection;

                            //SelectedItemOption = SelectedItemOldOption;
                            //if (SelectedItemOldcloneOption != null)
                            //    SelectedItemOption = SelectedItemOldcloneOption;
                            ////GEOS2-3838 - Way
                            #region [GEOS2-4830][gulab lakade][07 12 2023]
                            //SelectedItemWay = SelectedItemOldWay;
                            //if (SelectedItemOldcloneWay != null)
                            //    SelectedItemWay = SelectedItemOldcloneWay;

                            if (SelectedItemOldcloneWay != null)
                            {
                                SelectedItemWay = SelectedItemOldcloneWay;
                            }
                            else
                            {
                                SelectedItemWay = SelectedItemOldWay;
                            }

                            #endregion
                            //[GEOS2-3601] - Structure
                            //SelectedItemStructures = SelectedItemOldStructure;
                            //if (SelectedItemOldcloneStructure != null)
                            //    SelectedItemStructures = SelectedItemOldcloneStructure;

                            return;
                        }

                        if (MessageBoxResult == MessageBoxResult.No)
                        {
                            TmpModuleMenulist = null;
                            TmpDetectionMenulist = null;
                            TmpOptionMenulist = null;
                            TmpStructureMenulist = null;
                            TmpWayMenulist = null;
                            TmpSparePartsMenulist = null;
                            FlagToDragDrop = false;
                            TmpIdCPType = 0;
                            TmpIdDetection = 0;
                            TmpIdOption = 0;
                            TmpIdWayType = 0;
                            TmpIdStructure = 0;
                            TmpIdSpareParts = 0;


                            return;
                        }

                    }

                    MessageBoxResult MsgBoxResult = CustomMessageBox.Show(String.Format(Application.Current.Resources["AddEditSODCopyWorkOperationConfirmation"].ToString()), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                    if (MsgBoxResult == MessageBoxResult.Yes)
                    {

                        IsEnabledSaveButton = true;
                        SaveButtonVisibility = Visibility.Visible;


                        if (records.Count == 0)  // Dragging work operation from left panal is not allowed
                        {
                            CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("AddEditSODCopyWorkOperationNotAllowed").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                            return;
                        }

                        if (TmpIdWayType == 0)
                            TmpIdWayType = Convert.ToInt32(WaysIdCPType);

                        if (TmpIdWayType != 0 && TmpIdWayType != WaysIdCPType) // if copied to different cptype without saving then popup the message
                        {
                            CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("AddEditSODCopyWOSavePreviousCopiedWO").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);

                            return;
                        }


                        if (TmpWayMenulist == null)
                        {
                            TmpWayMenulist = new ObservableCollection<ERMSOPWays>();
                        }

                        if (WaysIdCPType == Convert.ToInt64(records[0].IdDetection))  // Dragging in same CP type is not allowed
                        {
                            CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("AddEditSODCopyWorkOperationInSameCPtype").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                            return;
                        }

                        tmpIdWaysWorkOperation = tempLstStandardOperationsDictionaryWay.Where(w => w.IdWorkoperation == Convert.ToUInt64(records[0].IdworkOperationByStage)
                         && w.IdDetection == Convert.ToUInt64(WaysIdCPType)).Select(s => s.IdWorkoperation).FirstOrDefault();

                        if (tmpIdWaysWorkOperation == 0)
                        {
                            tmpIdWaysWorkOperation = Convert.ToUInt64(tmpWayMenulist.Where(w => w.IdworkOperationByStage == Convert.ToInt32(records[0].IdworkOperationByStage)
                            && w.IdDetection == Convert.ToUInt64(WaysIdCPType)).Select(s => s.IdworkOperationByStage).FirstOrDefault());
                        }

                        if (tmpIdWaysWorkOperation > 0)
                        {
                            MessageBoxResult MessageBoxResult = CustomMessageBox.Show(String.Format(Application.Current.Resources["AddEditSODCopyWorkOperationAlreadyExists"].ToString()), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                            if (MessageBoxResult == MessageBoxResult.No)
                            {
                                return;
                            }
                        }

                        List<WorkOperationByStages> tmpChildList = WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(records[0].KeyName)).ToList();
                        if (tmpChildList.Count > 0)
                        {
                            foreach (WorkOperationByStages child in tmpChildList)
                            {
                                tmpIdWaysWorkOperation = tempLstStandardOperationsDictionaryWay.Where(w => w.IdWorkoperation == Convert.ToUInt64(child.IdworkOperationByStage)
                                && w.IdDetection == Convert.ToUInt64(WaysIdCPType)).Select(s => s.IdWorkoperation).FirstOrDefault();
                                if (tmpIdWaysWorkOperation > 0)
                                {
                                    MessageBoxResult MessageBoxResult = CustomMessageBox.Show(String.Format(Application.Current.Resources["AddEditSODCopyWorkOperationAlreadyExists"].ToString()), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                                    if (MessageBoxResult == MessageBoxResult.No)
                                    {
                                        return;
                                    }
                                    if (MessageBoxResult == MessageBoxResult.Yes)
                                        break;
                                }

                            }

                            if (tmpIdWaysWorkOperation == 0)
                            {
                                foreach (WorkOperationByStages child in tmpChildList)
                                {
                                    tmpIdWaysWorkOperation = Convert.ToUInt64(TmpWayMenulist.Where(w => w.IdWorkoperation == child.IdworkOperationByStage
                                    && w.IdDetection == Convert.ToUInt64(WaysIdCPType)).Select(s => s.IdWorkoperation).FirstOrDefault());
                                    if (tmpIdWaysWorkOperation > 0)
                                    {
                                        MessageBoxResult MessageBoxResult = CustomMessageBox.Show(String.Format(Application.Current.Resources["AddEditSODCopyWorkOperationAlreadyExists"].ToString()), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                                        if (MessageBoxResult == MessageBoxResult.No)
                                        {
                                            return;
                                        }
                                    }

                                }

                            }

                        }

                        // [GEOS2-4108][Rupali Sarode][04-01-2023]
                        TempWaysSelectedCopy = WayHeader;

                        operationWayMenulist = new ObservableCollection<WorkOperationByStages>();
                        int count = 0;
                        //[sdeshpande]
                        //if (TmpWayMenulist == null)
                        //{
                        //    TmpWayMenulist = new ObservableCollection<ERMSOPWays>();
                        //}

                        if (records.Any(a => a.Name.Equals("All")))
                        {
                            //records.RemoveAll(r => r.Name.Equals("All"));
                            #region ALL
                            // found.AddRange(records);
                            found = new List<WorkOperationByStages>();
                            operationWayMenulist = new ObservableCollection<WorkOperationByStages>();
                            operationWayMenulist.AddRange(WorkOperationMenulist.Where(w => !w.Name.Equals("All")));
                            #endregion
                        }
                        else

                        //if (true)
                        {

                            //for (int i = 0; i < records.Count(); i++)
                            //{

                            //}
                            //foreach (WorkOperationByStages itemWorkOperationByStages in records)
                            for (int r = 0; r < records.Count(); r++)
                            {
                                if (!TmpWayMenulist.Any(a => a.Name.Equals(records[r].Name)))
                                {
                                    // if (records[r].IdStatus != 1536) [rdixit][GEOS2-3764][04.08.2022]
                                    // {
                                    ////////records[r].IsCurrentWorkOperation = true;
                                    ////////// ModuleMenulist.Add(JsonConvert.DeserializeObject<ERMSOPModule>(JsonConvert.SerializeObject(records[r])));
                                    ////////operationMenulist.Add(records[r]);  // [GEOS2-3933] Rupali Sarode 
                                    // }


                                }

                                if (GetStages.Any(a => a != null && a.Code.Trim().Equals(records[r].Name.Trim())))
                                {
                                    found.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(records[r].KeyName)).ToList());
                                    int x = 0;
                                    Loop:
                                    x++;
                                    if (x < 4)
                                    {
                                        for (int i = 0; i < found.Count(); i++)
                                        {
                                            //TempfoundAllrecords.AddRange(WorkOperationMenulist.Where(s => s.IdworkOperationByStage == found[i].IdworkOperationByStage).ToList());
                                            TempfoundAllrecords.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(found[i].KeyName)).ToList());
                                        }
                                        for (int i = 0; i < TempfoundAllrecords.Count(); i++)
                                        {
                                            if (!found.Any(a => a != null && a.KeyName.Trim().Equals(TempfoundAllrecords[i].KeyName.Trim())))
                                                found.Add(TempfoundAllrecords[i]);
                                        }
                                        goto Loop;
                                    }



                                }
                                else
                                {
                                    found.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(records[r].KeyName)).ToList());
                                    for (int i = 0; i < found.Count(); i++)
                                    {
                                        TempfoundAllrecords.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(found[i].KeyName)).ToList());
                                    }

                                    for (int i = 0; i < TempfoundAllrecords.Count(); i++)
                                    {
                                        if (!found.Any(a => a != null && a.KeyName.Trim().Equals(TempfoundAllrecords[i].KeyName.Trim())))
                                            found.Add(TempfoundAllrecords[i]);
                                    }

                                    for (int i = 0; i < records.Where(a => a.IdworkOperationByStage > 0).Count(); i++)
                                    {
                                        if (!found.Any(a => a != null && a.KeyName.Trim().Equals(records[i].KeyName.Trim())))
                                            found.AddRange(WorkOperationMenulist.Where(s => s.IdworkOperationByStage == records[i].IdworkOperationByStage).ToList());
                                        if (found.Count() != 0)
                                        {
                                            count++;
                                        }
                                    }

                                }

                            }
                        }


                        if (count > 0)
                        {
                            for (int i = 0; i < found.Count(); i++)
                            {
                                if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(found[i].Name.Trim())))
                                {
                                    duplicateItemloopWay = 0;
                                    GetAllTreeListWay(found[i], WorkOperationMenulist);
                                }

                            }

                        }
                        else
                        {
                            if (!records.Any(a => a.Name.Equals("All")))
                                foreach (WorkOperationByStages item in found)
                                {
                                    duplicateItemloopWay = 0;
                                    GetAllTreeListWay(item, WorkOperationMenulist);
                                }
                        }
                        if (!records.Any(a => a.Name.Equals("All")))
                            if (operationWayMenulist != null)
                            {
                                var tempWayMenulist = operationWayMenulist.ToList();
                                for (int i = 0; i < tempWayMenulist.Count; i++)
                                {
                                    if (GetStages.Any(a => a.Code.Equals(tempWayMenulist[i].Name)))
                                    {
                                        List<WorkOperationByStages> childList = operationWayMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(tempWayMenulist[i].KeyName)).ToList();
                                        if (childList.Count == 0)
                                        {
                                            operationWayMenulist.Remove(tempWayMenulist[i]);
                                        }
                                    }
                                }
                            }


                        #region Check for Head parent whose parent is null like CUT, CAM etc
                        ulong tempWOId = 0;
                        if (GetStages.Any(a => a != null && a.Code.Trim().Equals(records[0].Name.Trim())))
                        {

                            foreach (WorkOperationByStages wo in operationWayMenulist)
                            {
                                tempWOId = tempLstStandardOperationsDictionaryWay.Where(w => w.IdWorkoperation == Convert.ToUInt64(wo.IdworkOperationByStage)
                                && w.IdDetection == Convert.ToUInt64(WaysIdCPType)).Select(s => s.IdWorkoperation).FirstOrDefault();
                                if (tempWOId > 0)
                                    break;

                            }

                            if (tempWOId > 0)
                            {
                                MessageBoxResult MessageBoxResult = CustomMessageBox.Show(String.Format(Application.Current.Resources["AddEditSODCopyWOSaveAlreadyExistsStage"].ToString()), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                                if (MessageBoxResult == MessageBoxResult.No)
                                {
                                    return;
                                }
                            }
                        }

                        #endregion Check for Head parent whose parent is null like CUT, CAM etc





                        #region copy data to tempWorkOperationClonedModule

                        tempWorkOperationClonedWays = new List<ERMSOPWays>();
                        var SelectedCPTypesItems = tempLstStandardOperationsDictionaryWay.Where(w => w.IdDetection == Convert.ToUInt64(WaysIdCPType)).ToList();


                        for (int i = 0; i < SelectedCPTypesItems.Count; i++)
                        {
                            ERMSOPWays eRMSOPWays = new ERMSOPWays();

                            //foreach (WorkOperationByStages Ways in WorkOperationMenulist)
                            ////foreach (WorkOperationByStages Ways in SelectedCPTypesItems)

                            //{

                            //if (operationMenulist.Any(a => a.IdworkOperationByStage == Convert.ToInt64(Ways.IdworkOperationByStage))
                            //    && operationMenulist.Any(a => a.IdStage == Ways.IdStage)
                            //    && operationMenulist.Any(a => a.Name.Trim().Equals(Ways.Name.Trim()))
                            //    )
                            //{
                            //StandardOperationsDictionaryWays standardOperationsDictionaryWays = tempLstStandardOperationsDictionaryWays.Where(w => w.IdWorkoperation == Convert.ToUInt64(Ways.IdworkOperationByStage) && Ways.Parent != null
                            //&& w.IdCpType == Convert.ToInt32(WaysIdCPType)).FirstOrDefault();
                            // ERMSOPWays eRMSOPWays = new ERMSOPWays();
                            //if (standardOperationsDictionaryWays != null)
                            WorkOperationByStages Ways = new WorkOperationByStages();
                            Ways = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == Convert.ToInt64(SelectedCPTypesItems[i].IdWorkoperation)).FirstOrDefault();

                            eRMSOPWays.IdDetection = Convert.ToUInt64(SelectedCPTypesItems[i].IdDetection);
                            eRMSOPWays.Name = Ways.Name;
                            eRMSOPWays.IdworkOperationByStage = Ways.IdworkOperationByStage;
                            eRMSOPWays.IdSequence = Ways.IdSequence;
                            eRMSOPWays.IdStatus = Ways.IdStatus;
                            eRMSOPWays.Status = Ways.Status;
                            eRMSOPWays.Code = Ways.Name;
                            eRMSOPWays.Parent = Ways.Parent;
                            eRMSOPWays.IdParent = Ways.IdParent;
                            eRMSOPWays.KeyName = Ways.KeyName;
                            eRMSOPWays.ParentName = Ways.ParentName;
                            //eRMSOPWays.Position = Ways.Position;
                            eRMSOPWays.Position = Convert.ToUInt32(SelectedCPTypesItems[i].Position);//[GEOS2-5629][gulab lakade][16 07 2024]
                            eRMSOPWays.WayPosition = Convert.ToUInt32(SelectedCPTypesItems[i].WayPosition);//[GEOS2-5629][gulab lakade][16 07 2024]
                            eRMSOPWays.WorkOperation_count = Ways.WorkOperation_count;
                            eRMSOPWays.WorkOperation_count_original = Ways.WorkOperation_count_original;
                            eRMSOPWays.NameWithWorkOperationCount = Ways.NameWithWorkOperationCount;
                            //[rdixit][03.08.2022][GEOS2-3764]
                            eRMSOPWays.IsReadOnly = Ways.IsReadOnly;
                            eRMSOPWays.IsInactiveWorkOperation = Ways.IsInactiveWorkOperation;

                            if (!GetStages.Any(a => a.Code.Equals(eRMSOPWays.Name)))
                            {
                                var tempActivity = tempLstStandardOperationsDictionaryWay.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPWays.IdworkOperationByStage)
                                 && w.IdDetection == Convert.ToUInt64(eRMSOPWays.IdDetection)).Select(s => s.Activity).DefaultIfEmpty(null).FirstOrDefault();
                                var tempObservedTime = tempLstStandardOperationsDictionaryWay.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPWays.IdworkOperationByStage)
                                 && w.IdDetection == Convert.ToUInt64(eRMSOPWays.IdDetection)).Select(s => s.ObservedTime).DefaultIfEmpty(null).FirstOrDefault();
                                #region Geos2 4077 Ways Store/ Save in the SDO tables the Observed time, Activity

                                var tempWay = tempLstStandardOperationsDictionaryWay.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPWays.IdworkOperationByStage)
                                && w.IdDetection == Convert.ToUInt64(eRMSOPWays.IdDetection)).FirstOrDefault();

                                if (tempWay != null)
                                {
                                    if (tempWay.IdWorkoperation == Convert.ToUInt64(eRMSOPWays.IdworkOperationByStage) && (tempWay.Activity == null || tempWay.Activity == 0))
                                    {
                                        tempActivity = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == eRMSOPWays.IdworkOperationByStage).Select(b => b.Activity).FirstOrDefault();
                                    }
                                    if (tempWay.IdWorkoperation == Convert.ToUInt64(eRMSOPWays.IdworkOperationByStage) && (tempWay.ObservedTime == null || tempWay.ObservedTime == 0))
                                    {
                                        tempObservedTime = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == eRMSOPWays.IdworkOperationByStage).Select(b => b.ObservedTime).FirstOrDefault();
                                    }
                                }
                                #endregion
                                if (tempActivity != null)
                                    eRMSOPWays.WayActivity = Math.Round((double)tempActivity, 2);
                                //if (tempObservedTime != null)
                                //    eRMSOPModule.ObservedTime = Math.Round((double)tempObservedTime, 2);
                                if (tempObservedTime != null)
                                {
                                    eRMSOPWays.WayObservedTime = Math.Round((double)tempObservedTime, 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    //   eRMSOPWays.UITempWaysObservedTime = tempLstStandardOperationsDictionaryWay.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPWays.IdworkOperationByStage)
                                    //&& w.IdDetection == Convert.ToUInt64(eRMSOPWays.IdDetection)).Select(s => s.UITempWaysObservedTime).FirstOrDefault();
                                    eRMSOPWays.UITempWaysObservedTime = TimeSpan.FromMinutes(Convert.ToDouble(tempObservedTime));
                                    #endregion
                                }

                                eRMSOPWays.WayNormalTime = Math.Round(Convert.ToDouble(eRMSOPWays.WayObservedTime * eRMSOPWays.WayActivity / 100), 2);
                                #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                eRMSOPWays.UITempWaysNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(eRMSOPWays.WayNormalTime));

                                #endregion
                                //[GEOS2-3933][Rupali Sarode][21/09/2022]
                                eRMSOPWays.WORemarks = Ways.WORemarks == null ? "" : Ways.WORemarks.Trim();

                                var tempRemarks = tempLstStandardOperationsDictionaryWay.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPWays.IdworkOperationByStage)
                                 && w.IdDetection == Convert.ToUInt64(eRMSOPWays.IdDetection)).Select(s => s.Remarks).DefaultIfEmpty(null).FirstOrDefault();

                                eRMSOPWays.Remarks = tempRemarks == null ? "" : tempRemarks.Trim();

                            }
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(Ways.Name.Trim())))
                            {
                                eRMSOPWays.IsDeleteButton = false;
                                eRMSOPWays.IsDeleteButtonVisibility = Visibility.Hidden;
                                // eRMSOPModule.ObservedTimeIsReadOnly =true;
                                eRMSOPWays.IsReadOnly = true;
                                eRMSOPWays.IsValidateOnTextInput = false;
                                Ways.IsCurrentWorkOperation = true;
                            }
                            else
                            {
                                Ways.IsCurrentWorkOperation = true;
                                //eRMSOPModule.ObservedTimeIsReadOnly = false;
                                eRMSOPWays.IsReadOnly = false;
                                eRMSOPWays.IsValidateOnTextInput = true;
                            }
                            if (Ways.IdStatus == 1536)
                            {
                                eRMSOPWays.IsInactiveWorkOperation = true;
                                eRMSOPWays.IsReadOnly = true;
                            }
                            try
                            {
                                //  if (!tempWorkOperationClonedWays.Any(a => a.KeyName.Equals(Ways.KeyName)))
                                tempWorkOperationClonedWays.Add(eRMSOPWays);

                            }
                            catch (Exception ex)
                            {

                            }




                            //}
                            //}
                        }
                        #region //[GEOS2-5629][gulab lakade][16 07 2024]
                        List<StandardOperationsDictionaryWays> tempStandardOperationsDictionaryWay_Accordian = tempLstStandardOperationsDictionaryWay.Where(w => w.IdDetection == Convert.ToUInt64(WayHeader.IdDetection)).ToList();
                        //WaysMenulist = new ObservableCollection<ERMSOPWays>();
                        //operationWayMenulist = new ObservableCollection<WorkOperationByStages>();
                        duplicateItemloop = 0;
                        duplicateItemloopWay = 0;
                        if (tempStandardOperationsDictionaryWay_Accordian.Count() > 0)
                        {
                            foreach (var eRMSOPWay in tempStandardOperationsDictionaryWay_Accordian)
                            {
                                if (eRMSOPWay != null)
                                {
                                    List<WorkOperationByStages> tempWayList = WorkOperationMenulist.Where(w => w.IdworkOperationByStage == Convert.ToInt32(eRMSOPWay.IdWorkoperation) && w.Name == eRMSOPWay.WorkOperationName).ToList();  //[Cut  work operation not work properly.][gulab lakade][24 01 2023]
                                    if (tempWayList != null)
                                        foreach (WorkOperationByStages item in tempWayList)
                                        {
                                            if (item.IdStatus == 1536)//[gulablakade][10.08.2022][GEOS2-3837]
                                            {
                                                item.IsInactiveWorkOperation = true;
                                                item.IsReadOnly = true;
                                            }
                                            WorkOperationByStages ParentName = WorkOperationMenulist.Where(w => w.KeyName.Equals(item.ParentName)).FirstOrDefault();
                                            if (ParentName != null)
                                            {
                                                if (!operationWayMenulist.Any(a => a.KeyName.Equals(ParentName.KeyName)))
                                                    operationWayMenulist.Add(ParentName);
                                            }
                                            duplicateItemloop = 0;
                                            duplicateItemloopWay = 0;
                                            GetAllTreeListWay(item, WorkOperationMenulist);
                                        }

                                }

                            }
                        }
                        #region gulab lakade beta changes 05 08 2024
                        if (tempWorkOperationClonedWays != null && tempWorkOperationClonedWays.Count() > 0)
                        {
                            tmpoldwaylist = new List<ERMSOPWays>();
                            foreach (ERMSOPWays item in tempWorkOperationClonedWays)
                            {
                                records.Add(item);
                                var tmpmodule = WorkOperationMenulist.Where(a => a.KeyName == item.ParentName).ToList();
                                if (tmpmodule.Count() > 0)
                                {
                                    foreach (var child in tmpmodule)
                                    {
                                        if (child.ParentName == null)
                                        {
                                            ERMSOPWays childrecord = new ERMSOPWays();
                                            childrecord.Name = child.Name;
                                            childrecord.IdworkOperationByStage = child.IdworkOperationByStage;
                                            childrecord.IdSequence = child.IdSequence;
                                            childrecord.IdStatus = child.IdStatus;
                                            childrecord.Status = child.Status;
                                            childrecord.Code = child.Name;
                                            childrecord.Parent = child.Parent;
                                            childrecord.IdParent = child.IdParent;
                                            childrecord.KeyName = child.KeyName;
                                            childrecord.ParentName = child.ParentName;
                                            childrecord.Position = Convert.ToUInt32(child.Position);
                                            childrecord.WayPosition = Convert.ToUInt32(child.Position);
                                            tmpoldwaylist.Add(childrecord);
                                        }
                                        else
                                        {
                                            var tmpchildmodule = WorkOperationMenulist.Where(a => a.KeyName == child.ParentName).ToList();
                                            if (tmpchildmodule.Count() > 0)
                                            {
                                                oldRecordWayGridForAccordian(tmpchildmodule);
                                            }
                                        }

                                    }
                                }
                            }

                            records.AddRange(tmpoldwaylist);
                            tmpoldwaylist = new List<ERMSOPWays>();
                            //records.AddRange(tempWorkOperationClonedWays);
                        }
                        #endregion
                        List<ERMSOPWays> ACC_WaysList = new List<ERMSOPWays>();
                        bool FlagAddItemModule = false;
                        foreach (var Ways in operationWayMenulist)
                        {
                            //if (Module.IdworkOperationByStage == records[0].IdworkOperationByStage)
                            //if (operationWayMenulist.Any(a => a.IdworkOperationByStage == Convert.ToInt64(Ways.IdworkOperationByStage))
                            //       && operationWayMenulist.Any(a => a.IdStage == Ways.IdStage)
                            //    && operationWayMenulist.Any(a => a.Name.Trim().Equals(Ways.Name.Trim()))
                            //    )
                            #region  [GEOS2-5135][Rupali Sarode][18-12-2023]
                            FlagAddItemModule = true;
                            // If it is child & only active then add
                            List<WorkOperationByStages> childListInActiveDraft = operationWayMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(Ways.KeyName)).ToList();

                            if (childListInActiveDraft.Count == 0)
                            {
                                if (Ways.IdStatus == 1535)
                                {
                                    FlagAddItemModule = true;
                                }
                                else
                                    FlagAddItemModule = false;
                            }
                            else // If it is parent and does not contain any active child, then do not include it
                            if (childListInActiveDraft.Count > 0)
                            {
                                //List<WorkOperationByStages> childListInParent = operationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(Module.KeyName)).ToList();
                                foreach (WorkOperationByStages objChild in childListInActiveDraft)
                                {
                                    List<WorkOperationByStages> GrandChildListInActiveDraft = new List<WorkOperationByStages>();
                                    GrandChildListInActiveDraft = operationWayMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(objChild.KeyName)).ToList();
                                    if (GrandChildListInActiveDraft.Count == 0)
                                    { // If it is child and Active
                                        if (objChild.IdStatus == 1535)
                                        {
                                            FlagAddItemModule = true;
                                            break;
                                        }
                                        else
                                        {
                                            FlagAddItemModule = false;
                                        }

                                    }
                                    else
                                    {
                                        if (GrandChildListInActiveDraft.Count > 0)
                                        {
                                            if (GrandChildListInActiveDraft.Where(i => i.IdStatus == 1535).Count() > 0)
                                            {
                                                FlagAddItemModule = true;
                                                break;
                                            }
                                            else
                                            {
                                                FlagAddItemModule = false;
                                            }
                                        }
                                    }
                                }
                            }
                            #endregion  [GEOS2-5135][Rupali Sarode][18-12-2023]
                            if (FlagAddItemModule == true)
                            {
                                bool Checkrecord = false;
                                var tmprecord = WaysMenulist.Where(x => x.KeyName == Ways.KeyName).FirstOrDefault();

                                ERMSOPWays eRMSOPWays = new ERMSOPWays();
                                //eRMSOPWays.IdDetection = Ways.IdDetection;
                                eRMSOPWays.IdDetection = Convert.ToUInt32(WayHeader.IdDetection);
                                eRMSOPWays.Name = Ways.Name;
                                eRMSOPWays.IdworkOperationByStage = Ways.IdworkOperationByStage;
                                eRMSOPWays.IdSequence = Ways.IdSequence;
                                eRMSOPWays.IdStatus = Ways.IdStatus;
                                eRMSOPWays.Status = Ways.Status;
                                eRMSOPWays.Code = Ways.Name;
                                eRMSOPWays.Parent = Ways.Parent;
                                eRMSOPWays.IdParent = Ways.IdParent;
                                eRMSOPWays.KeyName = Ways.KeyName;
                                eRMSOPWays.ParentName = Ways.ParentName;
                                // eRMSOPWays.Position = Ways.Position;
                                var ACC_Record = tempStandardOperationsDictionaryWay_Accordian.Where(a => a.IdWorkoperation == Convert.ToUInt32(Ways.IdworkOperationByStage)).FirstOrDefault();
                                if (ACC_Record != null)
                                {
                                    eRMSOPWays.Position = Convert.ToUInt32(ACC_Record.Position);
                                    eRMSOPWays.WayPosition = Convert.ToUInt32(ACC_Record.Position);//[GEOS2-5629][gulab lakade][16 07 2024]

                                }
                                else if (tmprecord != null)
                                {
                                    eRMSOPWays.Position = tmprecord.Position;
                                    eRMSOPWays.WayPosition = tmprecord.Position;//[GEOS2-5629][gulab lakade][16 07 2024]
                                }
                                else
                                {
                                    eRMSOPWays.Position = Ways.Position;
                                    eRMSOPWays.WayPosition = Ways.Position;//[GEOS2-5629][gulab lakade][16 07 2024]

                                }
                                eRMSOPWays.WorkOperation_count = Ways.WorkOperation_count;
                                eRMSOPWays.WorkOperation_count_original = Ways.WorkOperation_count_original;
                                eRMSOPWays.NameWithWorkOperationCount = Ways.NameWithWorkOperationCount;


                                if (tmprecord != null)
                                {
                                    eRMSOPWays.WayNormalTime = tmprecord.WayNormalTime;
                                    eRMSOPWays.WayObservedTime = tmprecord.WayObservedTime;
                                    eRMSOPWays.WayActivity = tmprecord.WayActivity;
                                    eRMSOPWays.WORemarks = tmprecord.WORemarks == null ? "" : tmprecord.WORemarks.Trim();
                                    eRMSOPWays.Remarks = tmprecord.Remarks == null ? "" : tmprecord.Remarks.Trim();
                                    Checkrecord = true;
                                }
                                else
                                {
                                    var tmprecord1 = records.Where(x => x.KeyName == Ways.KeyName).FirstOrDefault();
                                    if (tmprecord1 != null)
                                    {
                                        eRMSOPWays.WayNormalTime = tmprecord1.WayNormalTime;
                                        eRMSOPWays.WayObservedTime = tmprecord1.WayObservedTime;
                                        eRMSOPWays.WayActivity = tmprecord1.WayActivity;
                                        eRMSOPWays.WORemarks = tmprecord1.WORemarks == null ? "" : tmprecord1.WORemarks.Trim();
                                        eRMSOPWays.Remarks = tmprecord1.Remarks == null ? "" : tmprecord1.Remarks.Trim();
                                        Checkrecord = true;
                                    }
                                    else
                                    {
                                        eRMSOPWays.WayNormalTime = Ways.NormalTime;
                                        eRMSOPWays.WayObservedTime = Ways.ObservedTime;
                                        eRMSOPWays.WayActivity = Ways.Activity;
                                        eRMSOPWays.WORemarks = Ways.WORemarks == null ? "" : Ways.WORemarks.Trim();
                                        eRMSOPWays.Remarks = Ways.Remarks == null ? "" : Ways.Remarks.Trim();
                                    }

                                }

                                if (GetStages.Any(a => a != null && a.Code.Trim().Equals(Ways.Name.Trim())))
                                {
                                    //    Ways.IsCurrentWorkOperation = true;
                                    eRMSOPWays.IsDeleteButton = false;
                                    eRMSOPWays.IsDeleteButtonVisibility = Visibility.Hidden;
                                    eRMSOPWays.IsValidateOnTextInput = false;
                                }
                                else
                                {
                                    //  Module.IsCurrentWorkOperation = true;
                                    eRMSOPWays.IsValidateOnTextInput = true;
                                }
                                if (Ways.IdStatus == 1536)
                                {
                                    eRMSOPWays.IsInactiveWorkOperation = true;

                                }
                                else
                                {

                                }
                                try
                                {
                                    if (!TmpWayMenulist.Any(a => a.KeyName.Equals(Ways.KeyName)) && Checkrecord==true)
                                    {
                                        TmpWayMenulist.Add(eRMSOPWays);
                                        ACC_WaysList.Add(eRMSOPWays);
                                    }

                                }
                                catch (Exception ex)
                                {

                                }



                            }
                        }
                        TmpWayMenulist = new ObservableCollection<ERMSOPWays>();

                        foreach (var Ways in ACC_WaysList.OrderBy(a=>a.WayPosition))
                        {
                            //if (Module.IdworkOperationByStage == records[0].IdworkOperationByStage)
                            //if (operationWayMenulist.Any(a => a.IdworkOperationByStage == Convert.ToInt64(Ways.IdworkOperationByStage))
                            //       && operationWayMenulist.Any(a => a.IdStage == Ways.IdStage)
                            //    && operationWayMenulist.Any(a => a.Name.Trim().Equals(Ways.Name.Trim()))
                            //    )
                            {

                                ERMSOPWays eRMSOPWays = new ERMSOPWays();
                                //eRMSOPWays.IdDetection = Ways.IdDetection;
                                eRMSOPWays.IdDetection = Convert.ToUInt32(WayHeader.IdDetection);
                                eRMSOPWays.Name = Ways.Name;
                                eRMSOPWays.IdworkOperationByStage = Ways.IdworkOperationByStage;
                                eRMSOPWays.IdSequence = Ways.IdSequence;
                                eRMSOPWays.IdStatus = Ways.IdStatus;
                                eRMSOPWays.Status = Ways.Status;
                                eRMSOPWays.Code = Ways.Name;
                                eRMSOPWays.Parent = Ways.Parent;
                                eRMSOPWays.IdParent = Ways.IdParent;
                                eRMSOPWays.KeyName = Ways.KeyName;
                                eRMSOPWays.ParentName = Ways.ParentName;
                                if (ACC_WaysList != null)
                                {
                                    if (eRMSOPWays.ParentName == null)
                                    {
                                        eRMSOPWays.WayPosition = Ways.Position;
                                    }
                                    else
                                    {
                                        var TempModule = ACC_WaysList.Where(x => x.KeyName == Ways.KeyName).FirstOrDefault();
                                        if (TempModule != null)
                                        {
                                            eRMSOPWays.WayPosition = TempModule.WayPosition;
                                        }
                                        else
                                        {
                                            if (ACC_WaysList.Where(x => x.ParentName == Ways.ParentName).FirstOrDefault() == null)
                                            {
                                                var maxpos = ACC_WaysList.Max(a => a.WayPosition);
                                                eRMSOPWays.WayPosition = maxpos + 1;
                                            }
                                            else
                                            {
                                                var maxpos = ACC_WaysList.Where(x => x.ParentName == Ways.ParentName).Max(a => a.WayPosition);
                                                eRMSOPWays.WayPosition = maxpos + 1;
                                            }

                                        }
                                    }


                                }
                                eRMSOPWays.WorkOperation_count = Ways.WorkOperation_count;
                                eRMSOPWays.WorkOperation_count_original = Ways.WorkOperation_count_original;
                                eRMSOPWays.NameWithWorkOperationCount = Ways.NameWithWorkOperationCount;
                                eRMSOPWays.WayNormalTime = Ways.WayNormalTime;
                                eRMSOPWays.WORemarks = Ways.WORemarks == null ? "" : Ways.WORemarks.Trim();
                                eRMSOPWays.Remarks = Ways.Remarks == null ? "" : Ways.Remarks.Trim();

                                eRMSOPWays.WayObservedTime = Ways.WayObservedTime;
                                eRMSOPWays.UITempWaysObservedTime = ConvertfloattoTimespan(Convert.ToString(eRMSOPWays.WayObservedTime));

                                if (Ways.WayActivity != null)
                                    eRMSOPWays.WayActivity = Ways.WayActivity;

                                if (Ways.WayActivity != 0 && Ways.WayActivity != null)
                                    eRMSOPWays.WayActivity = Math.Round((double)Ways.WayActivity, 2);
                                if (eRMSOPWays.WayActivity == 0)
                                    eRMSOPWays.WayActivity = null;

                                if (GetStages.Any(a => a != null && a.Code.Trim().Equals(Ways.Name.Trim())))
                                {
                                    //    Ways.IsCurrentWorkOperation = true;
                                    eRMSOPWays.IsDeleteButton = false;
                                    eRMSOPWays.IsDeleteButtonVisibility = Visibility.Hidden;
                                    eRMSOPWays.IsValidateOnTextInput = false;
                                }
                                else
                                {
                                    //  Module.IsCurrentWorkOperation = true;
                                    eRMSOPWays.IsValidateOnTextInput = true;
                                }
                                if (Ways.IdStatus == 1536)
                                {
                                    eRMSOPWays.IsInactiveWorkOperation = true;

                                }
                                else
                                {

                                }
                                try
                                {
                                    if (!TmpWayMenulist.Any(a => a.KeyName.Equals(Ways.KeyName)))
                                    {
                                        TmpWayMenulist.Add(eRMSOPWays);
                                    }

                                }
                                catch (Exception ex)
                                {

                                }



                            }
                        }
                        List<ERMSOPWays> tmpWorkOperationMenuList4 = TmpWayMenulist.OrderBy(x => x.WayPosition).ToList();
                        TmpWayMenulist.Clear();
                        TmpWayMenulist.AddRange(tmpWorkOperationMenuList4);
                        tmpWorkOperationMenuList4.Clear();
                        #endregion
                        #endregion copy data to tempWorkOperationClonedWays 

                        #region commonCode

                        //foreach (ERMSOPWays Ways in WaysMenulist)
                        //{
                        //    //if (Module.IdworkOperationByStage == records[0].IdworkOperationByStage)
                        //    if (operationWayMenulist.Any(a => a.IdworkOperationByStage == Convert.ToInt64(Ways.IdworkOperationByStage))
                        //           && operationWayMenulist.Any(a => a.IdStage == Ways.IdStage)
                        //        && operationWayMenulist.Any(a => a.Name.Trim().Equals(Ways.Name.Trim()))
                        //        )
                        //    {

                        //        ERMSOPWays eRMSOPWays = new ERMSOPWays();
                        //        eRMSOPWays.IdDetection = Ways.IdDetection;
                        //        eRMSOPWays.Name = Ways.Name;
                        //        eRMSOPWays.IdworkOperationByStage = Ways.IdworkOperationByStage;
                        //        eRMSOPWays.IdSequence = Ways.IdSequence;
                        //        eRMSOPWays.IdStatus = Ways.IdStatus;
                        //        eRMSOPWays.Status = Ways.Status;
                        //        eRMSOPWays.Code = Ways.Name;
                        //        eRMSOPWays.Parent = Ways.Parent;
                        //        eRMSOPWays.IdParent = Ways.IdParent;
                        //        eRMSOPWays.KeyName = Ways.KeyName;
                        //        eRMSOPWays.ParentName = Ways.ParentName;
                        //        eRMSOPWays.Position = Ways.Position;
                        //        eRMSOPWays.WorkOperation_count = Ways.WorkOperation_count;
                        //        eRMSOPWays.WorkOperation_count_original = Ways.WorkOperation_count_original;
                        //        eRMSOPWays.NameWithWorkOperationCount = Ways.NameWithWorkOperationCount;
                        //        eRMSOPWays.WayNormalTime = Ways.WayNormalTime;

                        //        if (Ways.IdDetection != 0)
                        //            eRMSOPWays.IdDetection = Convert.ToUInt64(WaysIdCPType);  // Assign new IdCPType
                        //                                                                      //eRMSOPModule.NameWithWorkOperationCount 
                        //                                                                      //[GEOS2-3933][Rupali Sarode][21/09/2022]
                        //        eRMSOPWays.WORemarks = Ways.WORemarks == null ? "" : Ways.WORemarks.Trim();

                        //        if (Ways.WayNormalTime != null)
                        //        {
                        //            eRMSOPWays.WayNormalTime = Math.Round((double)Ways.WayNormalTime, 2);
                        //            #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                        //            eRMSOPWays.UITempWaysNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(eRMSOPWays.WayNormalTime));
                        //            #endregion
                        //        }
                        //        eRMSOPWays.WayObservedTime = Ways.WayObservedTime;
                        //        if (Ways.WayObservedTime != null)
                        //        {
                        //            eRMSOPWays.WayObservedTime = Math.Round((double)Ways.WayObservedTime, 2);
                        //            #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                        //            eRMSOPWays.UITempWaysObservedTime = ConvertfloattoTimespan(Convert.ToString(eRMSOPWays.WayObservedTime));
                        //            #endregion
                        //        }

                        //        if (Ways.WayActivity != null)
                        //            eRMSOPWays.WayActivity = Ways.WayActivity;

                        //        if (Ways.WayActivity != 0 && Ways.WayActivity != null)
                        //            eRMSOPWays.WayActivity = Math.Round((double)Ways.WayActivity, 2);
                        //        if (eRMSOPWays.WayActivity == 0)
                        //            eRMSOPWays.WayActivity = null;

                        //        if (GetStages.Any(a => a != null && a.Code.Trim().Equals(Ways.Name.Trim())))
                        //        {
                        //            //    Ways.IsCurrentWorkOperation = true;
                        //            eRMSOPWays.IsDeleteButton = false;
                        //            eRMSOPWays.IsDeleteButtonVisibility = Visibility.Hidden;
                        //            eRMSOPWays.IsValidateOnTextInput = false;
                        //        }
                        //        else
                        //        {
                        //            //  Module.IsCurrentWorkOperation = true;
                        //            eRMSOPWays.IsValidateOnTextInput = true;
                        //        }
                        //        if (Ways.IdStatus == 1536)
                        //        {
                        //            eRMSOPWays.IsInactiveWorkOperation = true;

                        //        }
                        //        else
                        //        {

                        //        }
                        //        try
                        //        {
                        //            if (!TmpWayMenulist.Any(a => a.KeyName.Equals(Ways.KeyName)))
                        //            {
                        //                TmpWayMenulist.Add(eRMSOPWays);
                        //            }

                        //        }
                        //        catch (Exception ex)
                        //        {

                        //        }



                        //    }
                        //}

                        //List<ERMSOPWays> tmpWorkOperationMenuList4 = TmpWayMenulist.OrderBy(x => x.Position).ToList();
                        //TmpWayMenulist.Clear();
                        //TmpWayMenulist.AddRange(tmpWorkOperationMenuList4);
                        //tmpWorkOperationMenuList4.Clear();


                        #endregion


                        // }
                        ////var tempWorkOperationMenulist2 = ModuleMenulist.OrderBy(x => x.Position).ToList();
                        ////ModuleMenulist.Clear();
                        ////ModuleMenulist.AddRange(tempWorkOperationMenulist2);
                        ////if (tempWorkOperationMenulist2 != null)
                        ////    tempWorkOperationMenulist2.Clear();
                        ////FillmoduleGridColumn();
                        ////CustomSummarycalculation();
                        e.Handled = true;
                        //   FlagToDragDrop = true;
                    }
                    if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                }
                GeosApplication.Instance.Logger.Log("Method CompleteDropRecordWaysGridForAccordian()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in Method CompleteDropRecordWaysGridForAccordian()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }

        }
        #endregion



        #region [GEOS2-3926][Rupali Sarode]
        private void SparePartsAccordionControl_Drop(DragEventArgs e)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method SparePartsAccordionControl_Drop()...", category: Category.Info, priority: Priority.Low);


                e.Effects = DragDropEffects.None;
                e.Handled = true;

                e.Effects = DragDropEffects.Copy;
                CompleteDropRecordSparePartsGridForAccordian(e);
                e.Handled = true;
                GeosApplication.Instance.Logger.Log("Method SparePartsAccordionControl_Drop()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {

                GeosApplication.Instance.Logger.Log(string.Format("Error in method SparePartsAccordionControl_Drop() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        #region gulab lakade beta changes 05 08 2024
        List<ERMSOPSpareParts> tmpoldsparepartlist = new List<ERMSOPSpareParts>();
        private void oldRecordSparepartGridForAccordian(List<WorkOperationByStages> tmpchildmodule)
        {
            //tmpoldmodulelist = new List<ERMSOPModule>();
            foreach (var child in tmpchildmodule)
            {
                if (child.ParentName == null)
                {
                    ERMSOPSpareParts childrecord = new ERMSOPSpareParts();
                    childrecord.Name = child.Name;
                    childrecord.IdworkOperationByStage = child.IdworkOperationByStage;
                    childrecord.IdSequence = child.IdSequence;
                    childrecord.IdStatus = child.IdStatus;
                    childrecord.Status = child.Status;
                    childrecord.Code = child.Name;
                    childrecord.Parent = child.Parent;
                    childrecord.IdParent = child.IdParent;
                    childrecord.KeyName = child.KeyName;
                    childrecord.ParentName = child.ParentName;
                    childrecord.Position = Convert.ToUInt32(child.Position);
                    childrecord.SparepartPosition = Convert.ToUInt32(child.Position);
                    tmpoldsparepartlist.Add(childrecord);
                }
                else
                {
                    List<WorkOperationByStages> tmpchildmodule1 = WorkOperationMenulist.Where(a => a.KeyName == child.ParentName).ToList();
                    if (tmpchildmodule1.Count() > 0)
                    {
                        oldRecordSparepartGridForAccordian(tmpchildmodule1);
                    }

                    //tmpoldmodulelist.AddRange();
                }

            }

            // return tmpoldmodulelist;
        }

        #endregion
        private void CompleteDropRecordSparePartsGridForAccordian(DragEventArgs e)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method CompleteDropRecordSparePartsGridForAccordian()...", category: Category.Info, priority: Priority.Low);

                if (SelectedItemSparePart is ERMSpareParts)
                {
                    ulong tmpIdSparePartsWorkOperation = 0;
                    duplicateItemloopSparePart = 0;

                    var data = (RecordDragDropData)e.Data.GetData(typeof(RecordDragDropData));
                    List<WorkOperationByStages> found = new List<WorkOperationByStages>();
                    List<WorkOperationByStages> TempfoundAllrecords = new List<WorkOperationByStages>();
                    List<ERMSOPSpareParts> records = data.Records.OfType<ERMSOPSpareParts>().ToList();

                    AccordionItem itemModule = LayoutTreeHelper.GetVisualParents((DependencyObject)e.OriginalSource).OfType<AccordionItem>().FirstOrDefault();
                    ERMSpareParts SparePartsHeader = (ERMSpareParts)itemModule.Header;
                    var SparePartsIdDetection = SparePartsHeader.IdDetection;

                    //If user added from work operation left tab & 
                    //without save user dragged & drop, then first allow user to first save it.
                    //if (IsEnabledSaveButton && SaveButtonVisibility == Visibility.Visible)
                    Saveselecteditem = "SparePart";
                    if (FlagToDragDrop == true)
                    {
                        if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                        MessageBoxResult MessageBoxResult = MessageBoxResult = CustomMessageBox.Show(string.Format(Application.Current.Resources["AddEditSODSaveWOBeforeDrag"].ToString()), "Yellow", CustomMessageBox.MessageImagePath.Warning, MessageBoxButton.YesNo);
                        if (MessageBoxResult == MessageBoxResult.Yes)
                        {
                            if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }
                            ISSavechanges = true;
                            IsEnabledSaveButton = false;
                            //SelectedItemOldclone = SelectedItem;
                            //SelectedItem = SelectedItemOld;
                            //var tempSelectedItem = SelectedItemOldclone;
                            SaveButtonCommandAction();
                            ISSavechanges = false;
                            //SelectedItem = tempSelectedItem;
                            //AcceptButtonCommandAction(null);
                            if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                            //SelectedItemDetection = SelectedItemOldDetection;
                            //if (SelectedItemOldcloneDetection != null)
                            //    SelectedItemDetection = SelectedItemOldcloneDetection;

                            //SelectedItemOption = SelectedItemOldOption;
                            //if (SelectedItemOldcloneOption != null)
                            //    SelectedItemOption = SelectedItemOldcloneOption;
                            //////GEOS2-3838 - Way
                            //SelectedItemWay = SelectedItemOldWay;
                            //if (SelectedItemOldcloneWay != null)
                            //    SelectedItemWay = SelectedItemOldcloneWay;
                            ////[GEOS2-3601] - Structure
                            //SelectedItemStructures = SelectedItemOldStructure;
                            //if (SelectedItemOldcloneStructure != null)
                            //    SelectedItemStructures = SelectedItemOldcloneStructure;
                            #region [GEOS2-4830][gulab lakade][07 12 2023]
                            //SelectedItemSparePart = SelectedItemOldSparePart;
                            //if (SelectedItemOldcloneSparePart != null)
                            //    SelectedItemSparePart = SelectedItemOldcloneSparePart;

                            if (SelectedItemOldcloneSparePart != null)
                            {
                                SelectedItemSparePart = SelectedItemOldcloneSparePart;
                            }
                            else
                            {
                                SelectedItemSparePart = SelectedItemOldSparePart;
                            }

                            #endregion

                            return;
                        }

                        if (MessageBoxResult == MessageBoxResult.No)
                        {
                            TmpModuleMenulist = null;
                            TmpDetectionMenulist = null;
                            TmpOptionMenulist = null;
                            TmpStructureMenulist = null;
                            TmpWayMenulist = null;
                            TmpSparePartsMenulist = null;
                            FlagToDragDrop = false;
                            TmpIdCPType = 0;
                            TmpIdDetection = 0;
                            TmpIdOption = 0;
                            TmpIdWayType = 0;
                            TmpIdStructure = 0;
                            TmpIdSpareParts = 0;
                            return;
                        }

                    }

                    MessageBoxResult MsgBoxResult = CustomMessageBox.Show(String.Format(Application.Current.Resources["AddEditSODCopyWorkOperationConfirmation"].ToString()), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                    if (MsgBoxResult == MessageBoxResult.Yes)
                    {

                        IsEnabledSaveButton = true;
                        SaveButtonVisibility = Visibility.Visible;


                        if (records.Count == 0)  // Dragging work operation from left panal is not allowed
                        {
                            CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("AddEditSODCopyWorkOperationNotAllowed").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                            return;
                        }

                        if (TmpIdSpareParts == 0)
                            TmpIdSpareParts = (ulong)SparePartsIdDetection;

                        if (TmpIdSpareParts != 0 && TmpIdSpareParts != (ulong)SparePartsIdDetection) // if copied to different cptype without saving then popup the message
                        {
                            CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("AddEditSODCopyWOSavePreviousCopiedWO").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                            return;
                        }


                        if (TmpSparePartsMenulist == null)
                        {
                            TmpSparePartsMenulist = new ObservableCollection<ERMSOPSpareParts>();
                        }

                        if (SparePartsIdDetection == (int)records[0].IdDetection)  // Dragging in same CP type is not allowed
                        {
                            CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("AddEditSODCopyWorkOperationInSameCPtype").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                            return;
                        }

                        tmpIdSparePartsWorkOperation = tempLstStandardOperationsDictionarySparePart.Where(w => w.IdWorkoperation == Convert.ToUInt64(records[0].IdworkOperationByStage)
                         && w.IdDetection == Convert.ToUInt64(SparePartsIdDetection)).Select(s => s.IdWorkoperation).FirstOrDefault();

                        if (tmpIdSparePartsWorkOperation == 0)
                        {
                            tmpIdSparePartsWorkOperation = Convert.ToUInt64(TmpSparePartsMenulist.Where(w => w.IdworkOperationByStage == Convert.ToInt32(records[0].IdworkOperationByStage)
                            && w.IdDetection == (ulong)SparePartsIdDetection).Select(s => s.IdworkOperationByStage).FirstOrDefault());
                        }

                        if (tmpIdSparePartsWorkOperation > 0)
                        {
                            MessageBoxResult MessageBoxResult = CustomMessageBox.Show(String.Format(Application.Current.Resources["AddEditSODCopyWorkOperationAlreadyExists"].ToString()), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                            if (MessageBoxResult == MessageBoxResult.No)
                            {
                                return;
                            }
                        }

                        List<WorkOperationByStages> tmpChildList = WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(records[0].KeyName)).ToList();
                        if (tmpChildList.Count > 0)
                        {
                            foreach (WorkOperationByStages child in tmpChildList)
                            {
                                tmpIdSparePartsWorkOperation = tempLstStandardOperationsDictionarySparePart.Where(w => w.IdWorkoperation == Convert.ToUInt64(child.IdworkOperationByStage)
                                && w.IdDetection == Convert.ToUInt64(SparePartsIdDetection)).Select(s => s.IdWorkoperation).FirstOrDefault();
                                if (tmpIdSparePartsWorkOperation > 0)
                                {
                                    MessageBoxResult MessageBoxResult = CustomMessageBox.Show(String.Format(Application.Current.Resources["AddEditSODCopyWorkOperationAlreadyExists"].ToString()), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                                    if (MessageBoxResult == MessageBoxResult.No)
                                    {
                                        return;
                                    }
                                    if (MessageBoxResult == MessageBoxResult.Yes)
                                        break;
                                }

                            }

                            if (tmpIdSparePartsWorkOperation == 0)
                            {
                                foreach (WorkOperationByStages child in tmpChildList)
                                {
                                    tmpIdSparePartsWorkOperation = Convert.ToUInt64(TmpSparePartsMenulist.Where(w => w.IdWorkoperation == child.IdworkOperationByStage
                                    && w.IdDetection == (ulong)SparePartsIdDetection).Select(s => s.IdWorkoperation).FirstOrDefault());
                                    if (tmpIdSparePartsWorkOperation > 0)
                                    {
                                        MessageBoxResult MessageBoxResult = CustomMessageBox.Show(String.Format(Application.Current.Resources["AddEditSODCopyWorkOperationAlreadyExists"].ToString()), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                                        if (MessageBoxResult == MessageBoxResult.No)
                                        {
                                            return;
                                        }
                                    }

                                }

                            }

                        }

                        // [GEOS2-4108][Rupali Sarode][04-01-2023]

                        TempSparePartsSelectedCopy = SparePartsHeader;

                        operationSparePartMenulist = new ObservableCollection<WorkOperationByStages>();
                        int count = 0;

                        if (records.Any(a => a.Name.Equals("All")))
                        {
                            #region ALL
                            found = new List<WorkOperationByStages>();
                            operationSparePartMenulist = new ObservableCollection<WorkOperationByStages>();
                            operationSparePartMenulist.AddRange(WorkOperationMenulist.Where(w => !w.Name.Equals("All")));
                            #endregion
                        }
                        else
                        {

                            for (int r = 0; r < records.Count(); r++)
                            {
                                if (GetStages.Any(a => a != null && a.Code.Trim().Equals(records[r].Name.Trim())))
                                {
                                    found.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(records[r].KeyName)).ToList());
                                    int x = 0;
                                    Loop:
                                    x++;
                                    if (x < 4)
                                    {
                                        for (int i = 0; i < found.Count(); i++)
                                        {
                                            TempfoundAllrecords.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(found[i].KeyName)).ToList());
                                        }
                                        for (int i = 0; i < TempfoundAllrecords.Count(); i++)
                                        {
                                            if (!found.Any(a => a != null && a.KeyName.Trim().Equals(TempfoundAllrecords[i].KeyName.Trim())))
                                                found.Add(TempfoundAllrecords[i]);
                                        }
                                        goto Loop;
                                    }

                                }
                                else
                                {
                                    found.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(records[r].KeyName)).ToList());
                                    for (int i = 0; i < found.Count(); i++)
                                    {
                                        TempfoundAllrecords.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(found[i].KeyName)).ToList());
                                    }
                                    for (int i = 0; i < TempfoundAllrecords.Count(); i++)
                                    {
                                        if (!found.Any(a => a != null && a.KeyName.Trim().Equals(TempfoundAllrecords[i].KeyName.Trim())))
                                            found.Add(TempfoundAllrecords[i]);
                                    }
                                    for (int i = 0; i < records.Where(a => a.IdworkOperationByStage > 0).Count(); i++)
                                    {
                                        if (!found.Any(a => a != null && a.KeyName.Trim().Equals(records[i].KeyName.Trim())))
                                            found.AddRange(WorkOperationMenulist.Where(s => s.IdworkOperationByStage == records[i].IdworkOperationByStage).ToList());
                                        if (found.Count() != 0)
                                        {
                                            count++;
                                        }
                                    }
                                }

                            }
                        }


                        if (count > 0)
                        {
                            for (int i = 0; i < found.Count(); i++)
                            {
                                if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(found[i].Name.Trim())))
                                {
                                    duplicateItemloopSparePart = 0;
                                    GetAllTreeListSparePart(found[i], WorkOperationMenulist);
                                }

                            }
                        }
                        else
                        {

                            if (!records.Any(a => a.Name.Equals("All")))
                                foreach (WorkOperationByStages item in found)
                                {
                                    duplicateItemloopSparePart = 0;
                                    GetAllTreeListSparePart(item, WorkOperationMenulist);
                                }
                        }
                        if (!records.Any(a => a.Name.Equals("All")))
                            if (operationSparePartMenulist != null)
                            {
                                var tempModuleMenulist = operationSparePartMenulist.ToList();
                                for (int i = 0; i < tempModuleMenulist.Count; i++)
                                {
                                    if (GetStages.Any(a => a.Code.Equals(tempModuleMenulist[i].Name)))
                                    {
                                        List<WorkOperationByStages> childList = operationSparePartMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(tempModuleMenulist[i].KeyName)).ToList();
                                        if (childList.Count == 0)
                                        {
                                            operationSparePartMenulist.Remove(tempModuleMenulist[i]);
                                        }
                                    }
                                }
                            }



                        #region Check for Head parent whose parent is null like CUT, CAM etc
                        ulong tempWOId = 0;
                        if (GetStages.Any(a => a != null && a.Code.Trim().Equals(records[0].Name.Trim())))
                        {

                            foreach (WorkOperationByStages wo in operationSparePartMenulist)
                            {
                                tempWOId = tempLstStandardOperationsDictionarySparePart.Where(w => w.IdWorkoperation == Convert.ToUInt64(wo.IdworkOperationByStage)
                                && w.IdDetection == Convert.ToUInt64(SparePartsIdDetection)).Select(s => s.IdWorkoperation).FirstOrDefault();
                                if (tempWOId > 0)
                                    break;

                            }

                            if (tempWOId > 0)
                            {
                                MessageBoxResult MessageBoxResult = CustomMessageBox.Show(String.Format(Application.Current.Resources["AddEditSODCopyWOSaveAlreadyExistsStage"].ToString()), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                                if (MessageBoxResult == MessageBoxResult.No)
                                {
                                    return;
                                }
                            }
                        }

                        #endregion Check for Head parent whose parent is null like CUT, CAM etc





                        #region copy data to tempWorkOperationClonedSparePart

                        tempWorkOperationClonedSpareParts = new List<ERMSOPSpareParts>();
                        var SelectedSparePartItems = tempLstStandardOperationsDictionarySparePart.Where(w => w.IdDetection == Convert.ToUInt64(SparePartsIdDetection)).ToList();

                        for (int i = 0; i < SelectedSparePartItems.Count; i++)
                        {
                            ERMSOPSpareParts eRMSOPSparePart = new ERMSOPSpareParts();

                            WorkOperationByStages SparePart = new WorkOperationByStages();
                            SparePart = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == Convert.ToInt64(SelectedSparePartItems[i].IdWorkoperation)).FirstOrDefault();

                            eRMSOPSparePart.IdDetection = SelectedSparePartItems[i].IdDetection;
                            eRMSOPSparePart.Name = SparePart.Name;
                            eRMSOPSparePart.IdworkOperationByStage = SparePart.IdworkOperationByStage;
                            eRMSOPSparePart.IdSequence = SparePart.IdSequence;
                            eRMSOPSparePart.IdStatus = SparePart.IdStatus;
                            eRMSOPSparePart.Status = SparePart.Status;
                            eRMSOPSparePart.Code = SparePart.Name;
                            eRMSOPSparePart.Parent = SparePart.Parent;
                            eRMSOPSparePart.IdParent = SparePart.IdParent;
                            eRMSOPSparePart.KeyName = SparePart.KeyName;
                            eRMSOPSparePart.ParentName = SparePart.ParentName;
                            //eRMSOPSparePart.Position = SparePart.Position;
                            eRMSOPSparePart.Position = Convert.ToUInt32(SelectedSparePartItems[i].Position);//[GEOS2-5629][gulab lakade][16 07 2024]
                            eRMSOPSparePart.SparepartPosition = Convert.ToUInt32(SelectedSparePartItems[i].SparepartPosition);//[GEOS2-5629][gulab lakade][16 07 2024]
                            eRMSOPSparePart.WorkOperation_count = SparePart.WorkOperation_count;
                            eRMSOPSparePart.WorkOperation_count_original = SparePart.WorkOperation_count_original;
                            eRMSOPSparePart.NameWithWorkOperationCount = SparePart.NameWithWorkOperationCount;

                            //[rdixit][03.08.2022][GEOS2-3764]
                            eRMSOPSparePart.IsReadOnly = SparePart.IsReadOnly;
                            eRMSOPSparePart.IsInactiveWorkOperation = SparePart.IsInactiveWorkOperation;

                            if (!GetStages.Any(a => a.Code.Equals(eRMSOPSparePart.Name)))
                            {
                                var tempActivity = tempLstStandardOperationsDictionarySparePart.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPSparePart.IdworkOperationByStage)
                                 && w.IdDetection == Convert.ToUInt64(eRMSOPSparePart.IdDetection)).Select(s => s.Activity).DefaultIfEmpty(null).FirstOrDefault();
                                var tempObservedTime = tempLstStandardOperationsDictionarySparePart.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPSparePart.IdworkOperationByStage)
                                 && w.IdDetection == Convert.ToUInt64(eRMSOPSparePart.IdDetection)).Select(s => s.ObservedTime).DefaultIfEmpty(null).FirstOrDefault();
                                #region Geos2 4078 SparePart Store/ Save in the SDO tables the Observed time, Activity

                                var tempSparepart = tempLstStandardOperationsDictionarySparePart.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPSparePart.IdworkOperationByStage)
                                && w.IdDetection == Convert.ToUInt64(eRMSOPSparePart.IdDetection)).FirstOrDefault();

                                if (tempSparepart != null)
                                {
                                    if (tempSparepart.IdWorkoperation == Convert.ToUInt64(eRMSOPSparePart.IdworkOperationByStage) && (tempSparepart.Activity == null || tempSparepart.Activity == 0))
                                    {
                                        tempActivity = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == SparePart.IdworkOperationByStage).Select(b => b.Activity).FirstOrDefault();
                                    }
                                    if (tempSparepart.IdWorkoperation == Convert.ToUInt64(eRMSOPSparePart.IdworkOperationByStage) && (tempSparepart.ObservedTime == null || tempSparepart.ObservedTime == 0))
                                    {
                                        tempObservedTime = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == SparePart.IdworkOperationByStage).Select(b => b.ObservedTime).FirstOrDefault();
                                    }
                                }
                                #endregion
                                if (tempActivity != null)
                                    eRMSOPSparePart.SparePartActivity = Math.Round((double)tempActivity, 2);


                                if (tempObservedTime != null)
                                {
                                    eRMSOPSparePart.SparePartObservedTime = Math.Round((double)tempObservedTime, 2);
                                    #region [GEOS2-3954][Rupali Sarode]
                                    eRMSOPSparePart.UITempSparePartObservedTime = TimeSpan.FromMinutes(Convert.ToDouble(tempObservedTime));
                                    #endregion
                                }
                                eRMSOPSparePart.SparePartNormalTime = Math.Round(Convert.ToDouble(eRMSOPSparePart.SparePartObservedTime * eRMSOPSparePart.SparePartActivity / 100), 2);
                                #region [GEOS2-3954][Rupali Sarode]
                                eRMSOPSparePart.UITempSparePartNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(eRMSOPSparePart.SparePartNormalTime));
                                #endregion


                                //[GEOS2-3933][Rupali Sarode][22/09/2022]
                                eRMSOPSparePart.WORemarks = SparePart.WORemarks == null ? "" : SparePart.WORemarks.Trim();

                                //[GEOS2-3933][Rupali Sarode][26/09/2022]
                                var tempRemarks = tempLstStandardOperationsDictionarySparePart.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPSparePart.IdworkOperationByStage)
                                && w.IdDetection == Convert.ToUInt64(eRMSOPSparePart.IdDetection)).Select(s => s.Remarks).DefaultIfEmpty(null).FirstOrDefault();

                                eRMSOPSparePart.Remarks = tempRemarks == null ? "" : tempRemarks.Trim();
                            }
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(SparePart.Name.Trim())))
                            {
                                SparePart.IsCurrentWorkOperation = true;
                                eRMSOPSparePart.IsDeleteButton = false;
                                eRMSOPSparePart.IsDeleteButtonVisibility = Visibility.Hidden;
                                eRMSOPSparePart.IsValidateOnTextInput = false;
                            }
                            else
                            {
                                SparePart.IsCurrentWorkOperation = true;

                                eRMSOPSparePart.IsValidateOnTextInput = true;
                            }
                            if (SparePart.IdStatus == 1536)
                            {
                                eRMSOPSparePart.IsInactiveWorkOperation = true;
                            }
                            try
                            {
                                //  if (!tempWorkOperationClonedModule.Any(a => a.KeyName.Equals(Module.KeyName)))
                                tempWorkOperationClonedSpareParts.Add(eRMSOPSparePart);
                            }
                            catch (Exception ex)
                            {

                            }


                            //}
                            //}
                        }
                        #region //[GEOS2-5629][gulab lakade][16 07 2024]
                        List<StandardOperationsDictionarySparePart> tempStandardOperationsDictionarySparePart_Accordain = tempLstStandardOperationsDictionarySparePart.Where(w => w.IdDetection == Convert.ToUInt64(SparePartsIdDetection)).ToList();
                        //SparePartsMenulist = new ObservableCollection<ERMSOPSpareParts>();
                        duplicateItemloopSparePart = 0;
                        duplicateItemloop = 0;
                        if (tempStandardOperationsDictionarySparePart_Accordain.Count() > 0)
                        {
                            foreach (var eRMSOPSparePart in tempStandardOperationsDictionarySparePart_Accordain)
                            {
                                if (eRMSOPSparePart != null)
                                {
                                    List<WorkOperationByStages> tempSparePartList = WorkOperationMenulist.Where(w => w.IdworkOperationByStage == Convert.ToInt32(eRMSOPSparePart.IdWorkoperation) && w.Name == eRMSOPSparePart.WorkOperationName).ToList();  //[Cut  work operation not work properly.][gulab lakade][24 01 2023]
                                    if (tempSparePartList != null)
                                        foreach (WorkOperationByStages item in tempSparePartList)
                                        {
                                            if (item.IdStatus == 1536)//[gulablakade][10.08.2022][GEOS2-3837]
                                            {
                                                item.IsInactiveWorkOperation = true;
                                                item.IsReadOnly = true;
                                            }
                                            WorkOperationByStages ParentName = WorkOperationMenulist.Where(w => w.KeyName.Equals(item.ParentName)).FirstOrDefault();
                                            if (ParentName != null)
                                            {
                                                if (!operationSparePartMenulist.Any(a => a.KeyName.Equals(ParentName.KeyName)))
                                                    operationSparePartMenulist.Add(ParentName);
                                            }
                                            duplicateItemloopSparePart = 0;
                                            duplicateItemloop = 0;
                                            GetAllTreeListSparePart(item, WorkOperationMenulist);
                                        }

                                }

                            }
                        }
                        #region gulab lakade beta changes 05 08 2024
                        if (tempWorkOperationClonedSpareParts != null && tempWorkOperationClonedSpareParts.Count() > 0)
                        {
                            tmpoldsparepartlist = new List<ERMSOPSpareParts>();
                            foreach (ERMSOPSpareParts item in tempWorkOperationClonedSpareParts)
                            {
                                records.Add(item);
                                var tmpmodule = WorkOperationMenulist.Where(a => a.KeyName == item.ParentName).ToList();
                                if (tmpmodule.Count() > 0)
                                {
                                    foreach (var child in tmpmodule)
                                    {
                                        if (child.ParentName == null)
                                        {
                                            ERMSOPSpareParts childrecord = new ERMSOPSpareParts();
                                            childrecord.Name = child.Name;
                                            childrecord.IdworkOperationByStage = child.IdworkOperationByStage;
                                            childrecord.IdSequence = child.IdSequence;
                                            childrecord.IdStatus = child.IdStatus;
                                            childrecord.Status = child.Status;
                                            childrecord.Code = child.Name;
                                            childrecord.Parent = child.Parent;
                                            childrecord.IdParent = child.IdParent;
                                            childrecord.KeyName = child.KeyName;
                                            childrecord.ParentName = child.ParentName;
                                            childrecord.Position = Convert.ToUInt32(child.Position);
                                            childrecord.SparepartPosition = Convert.ToUInt32(child.Position);
                                            tmpoldsparepartlist.Add(childrecord);
                                        }
                                        else
                                        {
                                            var tmpchildmodule = WorkOperationMenulist.Where(a => a.KeyName == child.ParentName).ToList();
                                            if (tmpchildmodule.Count() > 0)
                                            {
                                                oldRecordSparepartGridForAccordian(tmpchildmodule);
                                            }
                                        }

                                    }
                                }
                            }

                            records.AddRange(tmpoldsparepartlist);
                            tmpoldsparepartlist = new List<ERMSOPSpareParts>();
                            //records.AddRange(tempWorkOperationClonedSpareParts);
                        }
                        #endregion
                        List<ERMSOPSpareParts> ACC_SparePartslist = new List<ERMSOPSpareParts>();
                        bool FlagAddItemModule = false;
                        foreach (var SparePart in operationSparePartMenulist)
                        {
                            //if (Option.IdStatus != 1536)
                            //if (operationSparePartMenulist.Any(a => a.IdworkOperationByStage == Convert.ToInt64(SparePart.IdworkOperationByStage))
                            //   && operationSparePartMenulist.Any(a => a.IdStage == SparePart.IdStage)
                            //&& operationSparePartMenulist.Any(a => a.Name.Trim().Equals(SparePart.Name.Trim()))
                            //)
                            #region  [GEOS2-5135][Rupali Sarode][18-12-2023]
                            FlagAddItemModule = true;
                            // If it is child & only active then add
                            List<WorkOperationByStages> childListInActiveDraft = operationSparePartMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(SparePart.KeyName)).ToList();

                            if (childListInActiveDraft.Count == 0)
                            {
                                if (SparePart.IdStatus == 1535)
                                {
                                    FlagAddItemModule = true;
                                }
                                else
                                    FlagAddItemModule = false;
                            }
                            else // If it is parent and does not contain any active child, then do not include it
                            if (childListInActiveDraft.Count > 0)
                            {
                                //List<WorkOperationByStages> childListInParent = operationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(Module.KeyName)).ToList();
                                foreach (WorkOperationByStages objChild in childListInActiveDraft)
                                {
                                    List<WorkOperationByStages> GrandChildListInActiveDraft = new List<WorkOperationByStages>();
                                    GrandChildListInActiveDraft = operationSparePartMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(objChild.KeyName)).ToList();
                                    if (GrandChildListInActiveDraft.Count == 0)
                                    { // If it is child and Active
                                        if (objChild.IdStatus == 1535)
                                        {
                                            FlagAddItemModule = true;
                                            break;
                                        }
                                        else
                                        {
                                            FlagAddItemModule = false;
                                        }

                                    }
                                    else
                                    {
                                        if (GrandChildListInActiveDraft.Count > 0)
                                        {
                                            if (GrandChildListInActiveDraft.Where(i => i.IdStatus == 1535).Count() > 0)
                                            {
                                                FlagAddItemModule = true;
                                                break;
                                            }
                                            else
                                            {
                                                FlagAddItemModule = false;
                                            }
                                        }
                                    }
                                }
                            }
                            #endregion  [GEOS2-5135][Rupali Sarode][18-12-2023]
                            if (FlagAddItemModule == true)
                            {
                                bool Checkrecord = false;
                                //var tmprecord = records.Where(x => x.KeyName == SparePart.KeyName).FirstOrDefault();
                                var tmprecord = SparePartsMenulist.Where(x => x.KeyName == SparePart.KeyName).FirstOrDefault();
                                ERMSOPSpareParts eRMSOPSparePart = new ERMSOPSpareParts();
                                eRMSOPSparePart.Name = SparePart.Name;
                                eRMSOPSparePart.IdworkOperationByStage = SparePart.IdworkOperationByStage;
                                eRMSOPSparePart.IdSequence = SparePart.IdSequence;
                                eRMSOPSparePart.IdStatus = SparePart.IdStatus;
                                eRMSOPSparePart.Status = SparePart.Status;
                                eRMSOPSparePart.Code = SparePart.Name;
                                eRMSOPSparePart.Parent = SparePart.Parent;
                                eRMSOPSparePart.IdParent = SparePart.IdParent;
                                eRMSOPSparePart.KeyName = SparePart.KeyName;
                                eRMSOPSparePart.ParentName = SparePart.ParentName;
                                var ACC_Record = tempStandardOperationsDictionarySparePart_Accordain.Where(a => a.IdWorkoperation == Convert.ToUInt32(SparePart.IdworkOperationByStage)).FirstOrDefault();
                                if (ACC_Record != null)
                                {
                                    eRMSOPSparePart.Position = Convert.ToUInt32(ACC_Record.Position);
                                    eRMSOPSparePart.SparepartPosition = Convert.ToUInt32(ACC_Record.Position);//[GEOS2-5629][gulab lakade][16 07 2024]
                                }
                                else if (tmprecord != null)
                                {
                                    eRMSOPSparePart.Position = tmprecord.Position;
                                    eRMSOPSparePart.SparepartPosition = tmprecord.Position;//[GEOS2-5629][gulab lakade][16 07 2024]
                                }
                                else
                                {
                                    eRMSOPSparePart.Position = SparePart.Position;
                                    eRMSOPSparePart.SparepartPosition = SparePart.Position;//[GEOS2-5629][gulab lakade][16 07 2024]
                                }
                                eRMSOPSparePart.WorkOperation_count = SparePart.WorkOperation_count;
                                eRMSOPSparePart.WorkOperation_count_original = SparePart.WorkOperation_count_original;
                                eRMSOPSparePart.NameWithWorkOperationCount = SparePart.NameWithWorkOperationCount;

                                // if (SparePart.IdDetection != 0)
                                eRMSOPSparePart.IdDetection = Convert.ToUInt64(SparePartsIdDetection);  // Assign new IdDetection



                                if (tmprecord != null)
                                {
                                    eRMSOPSparePart.SparePartNormalTime = tmprecord.SparePartNormalTime;
                                    eRMSOPSparePart.SparePartObservedTime = tmprecord.SparePartObservedTime;
                                    eRMSOPSparePart.SparePartActivity = tmprecord.SparePartActivity;
                                    eRMSOPSparePart.WORemarks = tmprecord.WORemarks == null ? "" : tmprecord.WORemarks.Trim();
                                    eRMSOPSparePart.Remarks = tmprecord.Remarks == null ? "" : tmprecord.Remarks.Trim();
                                    Checkrecord = true;
                                }
                                else
                                {
                                    var tmprecord1 = records.Where(x => x.KeyName == SparePart.KeyName).FirstOrDefault();
                                    if (tmprecord1 != null)
                                    {
                                        eRMSOPSparePart.SparePartNormalTime = tmprecord1.SparePartNormalTime;
                                        eRMSOPSparePart.SparePartObservedTime = tmprecord1.SparePartObservedTime;
                                        eRMSOPSparePart.SparePartActivity = tmprecord1.SparePartActivity;
                                        eRMSOPSparePart.WORemarks = tmprecord1.WORemarks == null ? "" : tmprecord1.WORemarks.Trim();
                                        eRMSOPSparePart.Remarks = tmprecord1.Remarks == null ? "" : tmprecord1.Remarks.Trim();
                                        Checkrecord = true;
                                    }
                                    else
                                    {
                                        eRMSOPSparePart.SparePartNormalTime = SparePart.NormalTime;
                                        eRMSOPSparePart.SparePartObservedTime = SparePart.ObservedTime;
                                        eRMSOPSparePart.SparePartActivity = SparePart.Activity;
                                        eRMSOPSparePart.WORemarks = SparePart.WORemarks == null ? "" : SparePart.WORemarks.Trim();
                                        eRMSOPSparePart.Remarks = SparePart.Remarks == null ? "" : SparePart.Remarks.Trim();
                                    }

                                }
                                //[GEOS2-3933][Rupali Sarode][22/09/2022]


                                if (GetStages.Any(a => a != null && a.Code.Trim().Equals(SparePart.Name.Trim())))
                                {
                                    // SparePart.IsCurrentWorkOperation = true;
                                    eRMSOPSparePart.IsDeleteButton = false;
                                    eRMSOPSparePart.IsDeleteButtonVisibility = Visibility.Hidden;
                                    eRMSOPSparePart.IsValidateOnTextInput = false;
                                }
                                else
                                {
                                    //  SparePart.IsCurrentWorkOperation = true;

                                    eRMSOPSparePart.IsValidateOnTextInput = true;
                                }
                                if (SparePart.IdStatus == 1536)
                                {
                                    eRMSOPSparePart.IsInactiveWorkOperation = true;
                                }
                                try
                                {
                                    if (!TmpSparePartsMenulist.Any(a => a.KeyName.Equals(eRMSOPSparePart.KeyName)) && Checkrecord==true)
                                    {
                                        TmpSparePartsMenulist.Add(eRMSOPSparePart);
                                        ACC_SparePartslist.Add(eRMSOPSparePart);
                                    }

                                }
                                catch (Exception ex)
                                {

                                }


                            }
                        }

                        TmpSparePartsMenulist = new ObservableCollection<ERMSOPSpareParts>();
                        foreach (ERMSOPSpareParts SparePart in ACC_SparePartslist.OrderBy(a=>a.SparepartPosition))
                        {

                            {
                                ERMSOPSpareParts eRMSOPSparePart = new ERMSOPSpareParts();
                                eRMSOPSparePart.Name = SparePart.Name;
                                eRMSOPSparePart.IdworkOperationByStage = SparePart.IdworkOperationByStage;
                                eRMSOPSparePart.IdSequence = SparePart.IdSequence;
                                eRMSOPSparePart.IdStatus = SparePart.IdStatus;
                                eRMSOPSparePart.Status = SparePart.Status;
                                eRMSOPSparePart.Code = SparePart.Name;
                                eRMSOPSparePart.Parent = SparePart.Parent;
                                eRMSOPSparePart.IdParent = SparePart.IdParent;
                                eRMSOPSparePart.KeyName = SparePart.KeyName;
                                eRMSOPSparePart.ParentName = SparePart.ParentName;
                                if (ACC_SparePartslist != null)
                                {
                                    if (SparePart.ParentName == null)
                                    {
                                        eRMSOPSparePart.SparepartPosition = SparePart.Position;
                                    }
                                    else
                                    {
                                        var TempModule = ACC_SparePartslist.Where(x => x.KeyName == SparePart.KeyName).FirstOrDefault();
                                        if (TempModule != null)
                                        {
                                            eRMSOPSparePart.SparepartPosition = TempModule.SparepartPosition;
                                        }
                                        else
                                        {
                                            if (ACC_SparePartslist.Where(x => x.ParentName == SparePart.ParentName).FirstOrDefault() == null)
                                            {
                                                var maxpos = ACC_SparePartslist.Max(a => a.SparepartPosition);
                                                eRMSOPSparePart.SparepartPosition = maxpos + 1;
                                            }
                                            else
                                            {
                                                var maxpos = ACC_SparePartslist.Where(x => x.ParentName == SparePart.ParentName).Max(a => a.SparepartPosition);
                                                eRMSOPSparePart.SparepartPosition = maxpos + 1;
                                            }

                                        }
                                    }


                                }
                                eRMSOPSparePart.WorkOperation_count = SparePart.WorkOperation_count;
                                eRMSOPSparePart.WorkOperation_count_original = SparePart.WorkOperation_count_original;
                                eRMSOPSparePart.NameWithWorkOperationCount = SparePart.NameWithWorkOperationCount;

                                // if (SparePart.IdDetection != 0)
                                eRMSOPSparePart.IdDetection = Convert.ToUInt64(SparePartsIdDetection);  // Assign new IdDetection

                                eRMSOPSparePart.SparePartActivity = SparePart.SparePartActivity;
                                if (eRMSOPSparePart.SparePartActivity != 0 && eRMSOPSparePart.SparePartActivity != null)
                                    eRMSOPSparePart.SparePartActivity = Math.Round((double)SparePart.SparePartActivity, 2);
                                if (eRMSOPSparePart.SparePartActivity == 0)
                                    eRMSOPSparePart.SparePartActivity = null;

                                eRMSOPSparePart.SparePartNormalTime = SparePart.SparePartNormalTime;
                                eRMSOPSparePart.SparePartObservedTime = SparePart.SparePartObservedTime;
                                eRMSOPSparePart.UITempSparePartObservedTime = ConvertfloattoTimespan(Convert.ToString(eRMSOPSparePart.SparePartObservedTime));
                                //[GEOS2-3933][Rupali Sarode][22/09/2022]
                                eRMSOPSparePart.WORemarks = SparePart.WORemarks == null ? "" : SparePart.WORemarks.Trim();
                                eRMSOPSparePart.Remarks = SparePart.Remarks == null ? "" : SparePart.Remarks.Trim();
                                if (GetStages.Any(a => a != null && a.Code.Trim().Equals(SparePart.Name.Trim())))
                                {
                                    // SparePart.IsCurrentWorkOperation = true;
                                    eRMSOPSparePart.IsDeleteButton = false;
                                    eRMSOPSparePart.IsDeleteButtonVisibility = Visibility.Hidden;
                                    eRMSOPSparePart.IsValidateOnTextInput = false;
                                }
                                else
                                {
                                    //  SparePart.IsCurrentWorkOperation = true;

                                    eRMSOPSparePart.IsValidateOnTextInput = true;
                                }
                                if (SparePart.IdStatus == 1536)
                                {
                                    eRMSOPSparePart.IsInactiveWorkOperation = true;
                                }
                                try
                                {
                                    if (!TmpSparePartsMenulist.Any(a => a.KeyName.Equals(eRMSOPSparePart.KeyName)))
                                    {
                                        TmpSparePartsMenulist.Add(eRMSOPSparePart);
                                    }

                                }
                                catch (Exception ex)
                                {

                                }


                            }
                        }
                        List<ERMSOPSpareParts> tmpWorkOperationMenuList4 = TmpSparePartsMenulist.OrderBy(x => x.SparepartPosition).ToList();
                        TmpSparePartsMenulist.Clear();
                        TmpSparePartsMenulist = new ObservableCollection<ERMSOPSpareParts>();
                        TmpSparePartsMenulist.AddRange(tmpWorkOperationMenuList4);
                        tmpWorkOperationMenuList4.Clear();
                        #endregion

                        //var tempWorkOperationMenuList2 = tempWorkOperationClonedSpareParts.OrderBy(x => x.Position).ToList();
                        //tempWorkOperationClonedSpareParts.Clear();
                        //tempWorkOperationClonedSpareParts = new List<ERMSOPSpareParts>();
                        //tempWorkOperationClonedSpareParts.AddRange(tempWorkOperationMenuList2);
                        //tempWorkOperationMenuList2.Clear();
                        #endregion copy data to tempWorkOperationClonedSparePart


                        #region commonCode
                        //foreach (ERMSOPSpareParts SparePart in SparePartsMenulist)
                        //{
                        //    //if (Option.IdStatus != 1536)
                        //    if (operationSparePartMenulist.Any(a => a.IdworkOperationByStage == Convert.ToInt64(SparePart.IdworkOperationByStage))
                        //       && operationSparePartMenulist.Any(a => a.IdStage == SparePart.IdStage)
                        //    && operationSparePartMenulist.Any(a => a.Name.Trim().Equals(SparePart.Name.Trim()))
                        //    )
                        //    {
                        //        ERMSOPSpareParts eRMSOPSparePart = new ERMSOPSpareParts();
                        //        eRMSOPSparePart.Name = SparePart.Name;
                        //        eRMSOPSparePart.IdworkOperationByStage = SparePart.IdworkOperationByStage;
                        //        eRMSOPSparePart.IdSequence = SparePart.IdSequence;
                        //        eRMSOPSparePart.IdStatus = SparePart.IdStatus;
                        //        eRMSOPSparePart.Status = SparePart.Status;
                        //        eRMSOPSparePart.Code = SparePart.Name;
                        //        eRMSOPSparePart.Parent = SparePart.Parent;
                        //        eRMSOPSparePart.IdParent = SparePart.IdParent;
                        //        eRMSOPSparePart.KeyName = SparePart.KeyName;
                        //        eRMSOPSparePart.ParentName = SparePart.ParentName;
                        //        eRMSOPSparePart.Position = SparePart.Position;
                        //        eRMSOPSparePart.WorkOperation_count = SparePart.WorkOperation_count;
                        //        eRMSOPSparePart.WorkOperation_count_original = SparePart.WorkOperation_count_original;
                        //        eRMSOPSparePart.NameWithWorkOperationCount = SparePart.NameWithWorkOperationCount;

                        //        if (SparePart.IdDetection != 0)
                        //            eRMSOPSparePart.IdDetection = Convert.ToUInt64(SparePartsIdDetection);  // Assign new IdDetection

                        //        eRMSOPSparePart.SparePartActivity = SparePart.SparePartActivity;
                        //        if (eRMSOPSparePart.SparePartActivity != 0 && eRMSOPSparePart.SparePartActivity != null)
                        //            eRMSOPSparePart.SparePartActivity = Math.Round((double)SparePart.SparePartActivity, 2);
                        //        if (eRMSOPSparePart.SparePartActivity == 0)
                        //            eRMSOPSparePart.SparePartActivity = null;

                        //        eRMSOPSparePart.SparePartNormalTime = SparePart.SparePartNormalTime;
                        //        eRMSOPSparePart.SparePartObservedTime = SparePart.SparePartObservedTime;

                        //        if (SparePart.SparePartNormalTime != null)
                        //        {
                        //            eRMSOPSparePart.SparePartNormalTime = Math.Round((double)SparePart.SparePartNormalTime, 2);
                        //            #region [GEOS2-3954][Rupali Sarode]
                        //            eRMSOPSparePart.UITempSparePartNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(eRMSOPSparePart.SparePartNormalTime));
                        //            #endregion
                        //        }

                        //        if (SparePart.SparePartObservedTime != null)
                        //        {
                        //            eRMSOPSparePart.SparePartObservedTime = Math.Round((double)SparePart.SparePartObservedTime, 2);
                        //            #region [GEOS2-3954][Rupali Sarode]
                        //            eRMSOPSparePart.UITempSparePartObservedTime = ConvertfloattoTimespan(eRMSOPSparePart.SparePartObservedTime.ToString());
                        //            #endregion
                        //        }

                        //        //[GEOS2-3933][Rupali Sarode][22/09/2022]
                        //        eRMSOPSparePart.WORemarks = SparePart.WORemarks == null ? "" : SparePart.WORemarks.Trim();

                        //        if (GetStages.Any(a => a != null && a.Code.Trim().Equals(SparePart.Name.Trim())))
                        //        {
                        //            // SparePart.IsCurrentWorkOperation = true;
                        //            eRMSOPSparePart.IsDeleteButton = false;
                        //            eRMSOPSparePart.IsDeleteButtonVisibility = Visibility.Hidden;
                        //            eRMSOPSparePart.IsValidateOnTextInput = false;
                        //        }
                        //        else
                        //        {
                        //            //  SparePart.IsCurrentWorkOperation = true;

                        //            eRMSOPSparePart.IsValidateOnTextInput = true;
                        //        }
                        //        if (SparePart.IdStatus == 1536)
                        //        {
                        //            eRMSOPSparePart.IsInactiveWorkOperation = true;
                        //        }
                        //        try
                        //        {
                        //            if (!TmpSparePartsMenulist.Any(a => a.KeyName.Equals(eRMSOPSparePart.KeyName)))
                        //            {
                        //                TmpSparePartsMenulist.Add(eRMSOPSparePart);
                        //            }

                        //        }
                        //        catch (Exception ex)
                        //        {

                        //        }


                        //    }
                        //}

                        //List<ERMSOPSpareParts> tmpWorkOperationMenuList4 = TmpSparePartsMenulist.OrderBy(x => x.Position).ToList();
                        //TmpSparePartsMenulist.Clear();
                        //TmpSparePartsMenulist = new ObservableCollection<ERMSOPSpareParts>();
                        //TmpSparePartsMenulist.AddRange(tmpWorkOperationMenuList4);
                        //tmpWorkOperationMenuList4.Clear();
                        #endregion
                        // }

                        e.Handled = true;
                    }
                    if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                }
                GeosApplication.Instance.Logger.Log("Method CompleteDropRecordSparePartsGridForAccordian()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in Method CompleteDropRecordSparePartsGridForAccordian()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        #endregion

        // shubham[skadam] GEOS2-3246 20 May 2022
        #region GEOS2-3246 
        // shubham[skadam] GEOS2-3246 20 May 2022
        private List<Template> templatesMenuList;
        private ObservableCollection<TileBarFilters> listofitem;
        private int selectedTileIndex;
        private bool isGridOpen;
        private bool isBandOpen;
        private List<GridColumn> GridColumnList;
        private bool isEdit;
        private string myFilterString;
        private ObservableCollection<Emdep.Geos.UI.Helper.ColumnItem> column;
        private DataTable dataTableForGridLayout;
        private DataTable dataTableForGridLayoutCopy;
        //private ObservableCollection<ProductTypes> productTypesMenulistForGridLayoutForLog; //[GEOS2-4108][Rupali Sarode][3-1-2022]

        private Visibility isTemplateDetailsViewVisible;

        #region GEOS2-3857 Rupali Sarode
        private string selectedItemDetectionGroup;
        public string SelectedItemDetectionGroup
        {
            get
            {
                return selectedItemDetectionGroup;
            }
            set
            {
                selectedItemDetectionGroup = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedItemDetectionGroup"));
            }
        }

        private string selectedItemOptionGroup;
        public string SelectedItemOptionGroup
        {
            get
            {
                return selectedItemOptionGroup;
            }
            set
            {
                selectedItemOptionGroup = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedItemOptionGroup"));
            }
        }


        #endregion

        //[GEOS2-3909][Rupali Sarode][10-11-2022] 
        public ObservableCollection<ProductTypes> ProductTypesMenulistForGridLayout
        {
            get { return productTypesMenulistForGridLayout; }
            set
            {
                productTypesMenulistForGridLayout = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ProductTypesMenulistForGridLayout"));
            }
        }

        //[GEOS2-4108][Rupali Sarode][3-1-2022]
        //public ObservableCollection<ProductTypes> ProductTypesMenulistForGridLayoutForLog
        //{
        //    get { return productTypesMenulistForGridLayoutForLog; }
        //    set
        //    {
        //        productTypesMenulistForGridLayoutForLog = value;
        //        OnPropertyChanged(new PropertyChangedEventArgs("ProductTypesMenulistForGridLayoutForLog"));
        //    }
        //}
        public ProductTypes ClonedProductType { get; set; } //GEOS2-4108

        public List<Template> TemplatesMenuList
        {
            get { return templatesMenuList; }
            set
            {
                templatesMenuList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("TemplatesMenuList"));
            }
        }

        public bool IsGridOpen
        {
            get
            {
                return isGridOpen;
            }
            set
            {
                isGridOpen = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsGridOpen"));
            }
        }

        public bool IsBandOpen
        {
            get
            {
                return isBandOpen;
            }
            set
            {
                isBandOpen = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsBandOpen"));
            }
        }

        private object selectedItem;
        public virtual object SelectedItem
        {
            get { return selectedItem; }
            set
            {
                selectedItem = value;
                if (IsTemplateDetailsViewVisible == Visibility.Visible)
                {
                    SelectItemForTemplate();
                }

                //bool temp = IsEnabledSaveButton;
                //IsEnabledSaveButton = false;
                #region [GEOS2-4830][gulab lakade][07 12 2023]
                if (selectedItem != null)
                {
                    //string tempselectedobj = Convert.ToString(selectedItem);
                    //var temp = TemplatesMenuList.Where(i =>tempselectedobj.Contains(i.Name)).ToList();
                    //if (temp.Count() == 0)
                    //{
                    RetrieveWorkOperationsByCPTypes();
                    //}

                }
                #endregion
                //IsEnabledSaveButton = temp;
                //FillTemplateMenulist();
                //TileBarArrange(TemplatesMenuList);
                //if (IsEmployeeDetailViewVisible == Visibility.Visible)
                //{
                //    SelectItemForCompany();
                //}
                //else
                //{
                //    DisplayEmployeeHeirarchicalView();
                //}

                OnPropertyChanged(new PropertyChangedEventArgs("SelectedItem"));
            }
        }

        ObservableCollection<TemplateWithCPTypes> templateWithCPTypes;
        public ObservableCollection<TemplateWithCPTypes> TemplateWithCPTypes
        {
            get { return templateWithCPTypes; }
            set
            {
                templateWithCPTypes = value;
                OnPropertyChanged(new PropertyChangedEventArgs("TemplateWithCPTypes"));
            }
        }

        private object selectedTemplateWithCPTypeslist;
        public virtual object SelectedTemplateWithCPTypeslist
        {
            get { return selectedTemplateWithCPTypeslist; }
            set
            {
                selectedTemplateWithCPTypeslist = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedTemplateWithCPTypeslist"));
            }
        }

        public Visibility IsTemplateDetailsViewVisible
        {
            get { return isTemplateDetailsViewVisible; }
            set
            {
                isTemplateDetailsViewVisible = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsTemplateDetailsViewVisible"));
            }
        }

        List<ProductTypes> cptypes;
        public List<ProductTypes> Cptypes
        {
            get { return cptypes; }
            set
            {
                cptypes = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Cptypes"));
            }
        }
        List<ProductTypes> cptypesGridList;
        public List<ProductTypes> CptypesGridList
        {
            get { return cptypesGridList; }
            set
            {
                cptypesGridList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("CptypesGridList"));
            }
        }
        private Visibility isAccordionControlVisible;
        public Visibility IsAccordionControlVisible
        {
            get { return isAccordionControlVisible; }
            set
            {
                isAccordionControlVisible = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsAccordionControlVisible"));
            }
        }

        private DataTable dttableModule;
        private DataTable dttableCopyModule;
        private ObservableCollection<Emdep.Geos.UI.Helper.Column> columnsModule;

        private ObservableCollection<TreeListColumn> columnsModuleForSupplements;
        public ObservableCollection<TreeListColumn> ColumnsModuleForSupplements
        {
            get { return columnsModuleForSupplements; }
            set
            {
                columnsModuleForSupplements = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ColumnsModuleForSupplements"));
            }
        }

        private ObservableCollection<TreeListColumn> columnsModuleOperationTime;
        public ObservableCollection<TreeListColumn> ColumnsModuleOperationTime
        {
            get { return columnsModuleOperationTime; }
            set
            {
                columnsModuleOperationTime = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ColumnsModuleOperationTime"));
            }
        }
        ObservableCollection<ERMSOPModule> moduleMenulist;
        public ObservableCollection<ERMSOPModule> ModuleMenulist
        {
            get { return moduleMenulist; }
            set
            {
                moduleMenulist = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ModuleMenulist"));
            }
        }




        ObservableCollection<ERMSOPModule> moduleMenulistCloned;
        public ObservableCollection<ERMSOPModule> ModuleMenulistCloned
        {
            get { return moduleMenulistCloned; }
            set
            {
                moduleMenulistCloned = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ModuleMenulistCloned"));
            }
        }
        ObservableCollection<WorkOperationByStages> operationMenulistCloned = new ObservableCollection<WorkOperationByStages>();
        ERMSOPModule selectedModuleMenuItem;
        public ERMSOPModule SelectedModuleMenuItem
        {
            get { return selectedModuleMenuItem; }
            set
            {
                selectedModuleMenuItem = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedModuleMenuItem"));
            }
        }
        string supplementPlant1Name;
        public string SupplementPlant1Name
        {
            get
            {
                return supplementPlant1Name;
            }

            set
            {
                supplementPlant1Name = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SupplementPlant1Name"));
            }
        }
        string supplementPlant2Name;
        public string SupplementPlant2Name
        {
            get
            {
                return supplementPlant2Name;
            }

            set
            {
                supplementPlant2Name = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SupplementPlant2Name"));
            }
        }
        string supplementPlant3Name;
        public string SupplementPlant3Name
        {
            get
            {
                return supplementPlant3Name;
            }

            set
            {
                supplementPlant3Name = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SupplementPlant3Name"));
            }
        }
        string supplementPlant4Name;
        public string SupplementPlant4Name
        {
            get
            {
                return supplementPlant4Name;
            }

            set
            {
                supplementPlant4Name = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SupplementPlant4Name"));
            }
        }
        string supplementPlant5Name;
        public string SupplementPlant5Name
        {
            get
            {
                return supplementPlant5Name;
            }

            set
            {
                supplementPlant5Name = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SupplementPlant5Name"));
            }
        }

        bool supplementPlant1NameVisibility = false;
        bool supplementPlant2NameVisibility = false;
        bool supplementPlant3NameVisibility = false;
        bool supplementPlant4NameVisibility = false;
        bool supplementPlant5NameVisibility = false;
        public bool SupplementPlant1NameVisibility
        {
            get
            {
                return supplementPlant1NameVisibility;
            }

            set
            {
                supplementPlant1NameVisibility = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SupplementPlant1NameVisibility"));
            }
        }
        public bool SupplementPlant2NameVisibility
        {
            get
            {
                return supplementPlant2NameVisibility;
            }

            set
            {
                supplementPlant2NameVisibility = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SupplementPlant2NameVisibility"));
            }
        }
        public bool SupplementPlant3NameVisibility
        {
            get
            {
                return supplementPlant3NameVisibility;
            }

            set
            {
                supplementPlant3NameVisibility = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SupplementPlant3NameVisibility"));
            }
        }
        public bool SupplementPlant4NameVisibility
        {
            get
            {
                return supplementPlant4NameVisibility;
            }

            set
            {
                supplementPlant4NameVisibility = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SupplementPlant4NameVisibility"));
            }
        }
        public bool SupplementPlant5NameVisibility
        {
            get
            {
                return supplementPlant5NameVisibility;
            }

            set
            {
                supplementPlant5NameVisibility = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SupplementPlant5NameVisibility"));
            }
        }


        ObservableCollection<ERMSOPModule> ModuleMenulistupdated = new ObservableCollection<ERMSOPModule>();
        bool iSSavechanges = false;
        public bool ISSavechanges
        {
            get { return iSSavechanges; }
            set
            {
                if (iSSavechanges != value)
                {
                    iSSavechanges = value;
                }
                OnPropertyChanged(new PropertyChangedEventArgs("ISSavechanges"));
            }
        }
        private object selectedItemOld;
        public virtual object SelectedItemOld
        {
            get { return selectedItemOld; }
            set
            {
                selectedItemOld = value;
                if (IsTemplateDetailsViewVisible == Visibility.Visible)
                {
                    SelectItemForTemplate();
                }
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedItemOld"));
            }
        }
        private object selectedItemOldclone;
        public virtual object SelectedItemOldclone
        {
            get { return selectedItemOldclone; }
            set
            {
                selectedItemOldclone = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedItemOldclone"));
            }
        }

        private void FillTemplateMenulist()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillTemplateMenulist()...", category: Category.Info, priority: Priority.Low);

                TemplatesMenuList = new List<Template>(ERMService.GetAllTemplates().ToList().Where(a => a.IdTemplate == null || a.IdTemplate != 24).ToList());

                var List = TemplatesMenuList.GroupBy(info => info.IdTemplate)
                                .Select(group => new
                                {
                                    Name = TemplatesMenuList.FirstOrDefault(a => a.IdTemplate == group.Key).Name,
                                    Count = TemplatesMenuList.Where(b => b.IdTemplate == null && b.IdTemplate != 24).Count(),
                                }).ToList();

                ProductTypesMenulistForGridLayout = new ObservableCollection<ProductTypes>(ERMService.GetAllProductTypes_V2460().ToList().Where(a => a.Template == null || a.Template.IdTemplate != 24).ToList());

                if (TemplateWithCPTypes == null)
                    TemplateWithCPTypes = new ObservableCollection<TemplateWithCPTypes>();

                if (TemplateWithCPTypes.Count() == 0)
                {
                    // Sort templates, placing "NO GROUP" last
                    TemplatesMenuList = new List<Template>(
                        TemplatesMenuList
                            .OrderBy(template => template.Name == "NO GROUP")
                            .ThenBy(template => template.Name, new AlphanumericComparer())
                    );

                    foreach (var item in TemplatesMenuList)
                    {
                        TemplateWithCPTypes templateWithCPTypes = new TemplateWithCPTypes();

                        templateWithCPTypes.ProductTypesMenu = ProductTypesMenulistForGridLayout
                            .Where(w => w.Template != null && w.Template.Name.Equals(item.Name))
                            .OrderBy(option => option.Name, new AlphanumericComparer())
                            .ToList();

                        #region Gulab Lakade [28 12 2022]
                        foreach (var item1 in templateWithCPTypes.ProductTypesMenu)
                        {
                            int CPTypecount = tempLstStandardOperationsDictionaryModules
                                .Where(x => x.IdCpTypeNew == (long)item1.IdCPType)
                                .ToList()
                                .Count();
                            item1.Name = item1.Name + "  (" + CPTypecount + ")";
                        }
                        #endregion

                        // Add count to the name
                        templateWithCPTypes.Name = $"{item.Name}  ({templateWithCPTypes.ProductTypesMenu.Count()})";

                        TemplateWithCPTypes.Add(templateWithCPTypes);
                    }
                }

                SelectedItem = TemplateWithCPTypes.First();

                GeosApplication.Instance.Logger.Log("Method FillTemplateMenulist()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillTemplateMenulist() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillTemplateMenulist() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log($"Error in Method FillTemplateMenulist() - {ex.Message}", category: Category.Exception, priority: Priority.Low);
            }
        }




        private void SelectItemForTemplate()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method SelectItemForCompany()...", category: Category.Info, priority: Priority.Low);

                if (IsTemplateDetailsViewVisible == Visibility.Visible)
                {
                    Cptypes = new List<ProductTypes>();
                    List<ProductTypes> CptypesList = new List<ProductTypes>();
                    CptypesGridList = new List<ProductTypes>();

                    if (SelectedItem is ProductTypes)
                    {
                        //EmployeeList.Add((Employee)SelectedItem);
                        //Employees = new List<Employee>(EmployeeList);
                        //OrganizationGridList = Employees;
                    }
                    else if (SelectedItem is Template)
                    {
                        //SelectedDepartment = new Department();
                        //SelectedDepartment = (Department)SelectedItem;

                        //if (SelectedDepartment.DepartmentName == "ALL")
                        //{
                        //    //for (int i = 1; i < EmployeeDepartments.Count; i++)
                        //    //{
                        //    //    for (int j = 0; j < EmployeeDepartments[i].Employees.Count; j++)
                        //    //    {
                        //    //        EmployeeList.Add(EmployeeDepartments[i].Employees[j]);
                        //    //    }
                        //    //}

                        //    //Employees = new List<Employee>(EmployeeList);
                        //    //OrganizationGridList = Employees.GroupBy(x => x.IdEmployee, (key, g) => g.OrderBy(e => e.IdEmployee).First()).ToList();
                        //}
                        //else
                        //{
                        //    //var DeptId = (EmployeeDepartments.Where(x => x.IdDepartment == ((Department)SelectedItem).IdDepartment)).ToList().DefaultIfEmpty();
                        //    //Employees = ((Department)SelectedItem).Employees.ToList();
                        //    //OrganizationGridList = Employees.GroupBy(x => x.IdEmployee, (key, g) => g.OrderBy(e => e.IdEmployee).First()).ToList();
                        //}
                    }
                    else
                    {
                        Cptypes = new List<ProductTypes>();
                        CptypesGridList = new List<ProductTypes>();
                    }
                }

                GeosApplication.Instance.Logger.Log("Method SelectItemForCompany()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method SelectItemForCompany()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        private void HidePanel(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method HidePanel ...", category: Category.Info, priority: Priority.Low);

                if (IsAccordionControlVisible == Visibility.Collapsed)
                    IsAccordionControlVisible = Visibility.Visible;
                else
                    IsAccordionControlVisible = Visibility.Collapsed;
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method HidePanel()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        private void FillmoduleGridColumn()
        {
            try
            {
                //if (!DXSplashScreen.IsActive)
                //{
                //    DXSplashScreen.Show(x =>
                //    {
                //        Window win = new Window()
                //        {
                //            ShowActivated = false,
                //            WindowStyle = WindowStyle.None,
                //            ResizeMode = ResizeMode.NoResize,
                //            AllowsTransparency = true,
                //            Background = new SolidColorBrush(Colors.Transparent),
                //            ShowInTaskbar = false,
                //            Topmost = true,
                //            SizeToContent = SizeToContent.WidthAndHeight,
                //            WindowStartupLocation = WindowStartupLocation.CenterScreen,
                //        };
                //        WindowFadeAnimationBehavior.SetEnableAnimation(win, true);
                //        win.Topmost = false;
                //        return win;
                //    }, x =>
                //    {
                //        return new SplashScreenView() { DataContext = new SplashScreenViewModel() };
                //    }, null, null);
                //}
                #region FillmoduleGridColumn
                if (AllSupplementsBoxMenu != null)
                {
                    var listadoDuplicadas = from c in AllSupplementsBoxMenu
                                            join c2 in AllSupplementsBoxMenu on c.Item2 equals c2.Item2
                                            where c != c2
                                            select c;

                    var ModuleSandardOperationTime = listadoDuplicadas.FirstOrDefault();
                    if (ModuleSandardOperationTime != null)
                    {
                        var templist = listadoDuplicadas.Where(a => a.Item2 == ModuleSandardOperationTime.Item2);
                        listadoDuplicadas = templist;
                    }
                    var tempSupplementsBoxMenu = AllSupplementsBoxMenu;

                    ColumnsModuleForSupplements = new ObservableCollection<TreeListColumn>();
                    ColumnsModuleForSupplements.Add(new TreeListColumn()
                    {
                        FieldName = "StandardSupplements",
                        Header = "Standard",
                        HeaderToolTip = "Standard",
                        AllowCellMerge = false,
                        Width = 150, //gulab lakade not show supplements name all
                        AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                        Visible = true,
                        ReadOnly = false,
                        FixedWidth = false,

                    });

                    ColumnsModuleOperationTime = new ObservableCollection<TreeListColumn>();
                    ColumnsModuleOperationTime.Add(new TreeListColumn()
                    {
                        //FieldName = "StandardOperationTime",
                        FieldName = "UiTempStandardOperationTimeName",
                        Header = "Standard",
                        HeaderToolTip = "Standard",
                        AllowCellMerge = false,
                        Width = 150,//gulab lakade not show supplements name all
                        AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                        Visible = true,
                        ReadOnly = false,
                        FixedWidth = false,



                    });

                    int count = 1;
                    var ColumnsModuleList = tempSupplementsBoxMenu.Where(p => !listadoDuplicadas.Any(p2 => p2.Item1 == p.Item1));
                    foreach (var item in ColumnsModuleList)
                    {
                        if (count == 5)
                        {
                            ColumnsModuleForSupplements.Add(new TreeListColumn()
                            {
                                FieldName = "SupplementPlant" + count + "Value",
                                Header = "Others",
                                HeaderToolTip = "Others",
                                AllowCellMerge = false,
                                Width = 60,
                                AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                Visible = true,
                                ReadOnly = false,
                                FixedWidth = false
                            });
                            ColumnsModuleOperationTime.Add(new TreeListColumn()
                            {
                                FieldName = "UiTempoperationTimePlant" + count + "Value",
                                Header = "Others",
                                HeaderToolTip = "Others",
                                AllowCellMerge = false,
                                Width = 60,
                                AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                Visible = true,
                                ReadOnly = false,
                                FixedWidth = false
                            });
                            break;
                        }
                        if (count == 5)
                        {
                            break;
                        }
                        ColumnsModuleForSupplements.Add(new TreeListColumn()
                        {
                            FieldName = "SupplementPlant" + count + "Value",
                            Header = item.Item1,
                            HeaderToolTip = item.Item1,
                            AllowCellMerge = false,
                            Width = 100,
                            AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                            Visible = true,
                            ReadOnly = false,
                            FixedWidth = false
                        });

                        ColumnsModuleOperationTime.Add(new TreeListColumn()
                        {
                            //FieldName = "OperationTimePlant" + count + "Value",
                            FieldName = "UiTempoperationTimePlant" + count + "Value",
                            Header = item.Item1,
                            HeaderToolTip = item.Item1,
                            AllowCellMerge = false,
                            Width = 60,
                            AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                            Visible = true,
                            ReadOnly = false,
                            FixedWidth = false
                        });
                        count = count + 1;
                    }

                    #region Temp  check only [GEOS2-4830][gulab lakade][07 12 2023]
                    if (ModuleMenulist != null)
                        foreach (ERMSOPModule itemERMSOPModule in ModuleMenulist)
                        {
                            if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(itemERMSOPModule.Name.Trim())))
                            {
                                if (ModuleSandardOperationTime != null)
                                    itemERMSOPModule.StandardSupplements = (float?)ModuleSandardOperationTime.Item2;
                                if (tempSupplementsBoxMenu.Any(p => !listadoDuplicadas.Any(p2 => p2.Item1 == p.Item1)))
                                {
                                    itemERMSOPModule.AllSupplementsBoxMenu = AllSupplementsBoxMenu;
                                    List<float?> lst = new List<float?>();

                                    var a = ColumnsModuleList.ToList();
                                    for (int i = 0; i < a.Count(); i++)
                                    {
                                        lst.Add((float?)a[i].Item2);
                                    }

                                    if (ColumnsModuleList.Count() == 1)
                                    {
                                        itemERMSOPModule.SupplementPlant1Value = (float?)lst[0];
                                    }
                                    else if (ColumnsModuleList.Count() == 2)
                                    {
                                        itemERMSOPModule.SupplementPlant1Value = (float?)lst[0];
                                        itemERMSOPModule.SupplementPlant2Value = (float?)lst[1];
                                    }
                                    else if (ColumnsModuleList.Count() == 3)
                                    {
                                        itemERMSOPModule.SupplementPlant1Value = (float?)lst[0];
                                        itemERMSOPModule.SupplementPlant2Value = (float?)lst[1];
                                        itemERMSOPModule.SupplementPlant3Value = (float?)lst[2];
                                    }
                                    else if (ColumnsModuleList.Count() == 4)
                                    {
                                        itemERMSOPModule.SupplementPlant1Value = (float?)lst[0];
                                        itemERMSOPModule.SupplementPlant2Value = (float?)lst[1];
                                        itemERMSOPModule.SupplementPlant3Value = (float?)lst[2];
                                        itemERMSOPModule.SupplementPlant4Value = (float?)lst[3];
                                    }
                                    else if (ColumnsModuleList.Count() == 5)
                                    {
                                        itemERMSOPModule.SupplementPlant1Value = (float?)lst[0];
                                        itemERMSOPModule.SupplementPlant2Value = (float?)lst[1];
                                        itemERMSOPModule.SupplementPlant3Value = (float?)lst[2];
                                        itemERMSOPModule.SupplementPlant4Value = (float?)lst[3];
                                        itemERMSOPModule.SupplementPlant5Value = (float?)lst[4];
                                    }
                                    else
                                    {
                                        itemERMSOPModule.SupplementPlant1Value = (float?)lst[0];
                                        itemERMSOPModule.SupplementPlant2Value = (float?)lst[1];
                                        itemERMSOPModule.SupplementPlant3Value = (float?)lst[2];
                                        itemERMSOPModule.SupplementPlant4Value = (float?)lst[3];
                                        itemERMSOPModule.SupplementPlant5Value = 0;
                                        if (ColumnsModuleList.Count() > 5)
                                        {
                                            for (int q = 4; q < ColumnsModuleList.Count(); q++)
                                            {
                                                if (itemERMSOPModule.SupplementPlant5Value == null)
                                                    itemERMSOPModule.SupplementPlant5Value = 0;
                                                itemERMSOPModule.SupplementPlant5Value = (float?)(Convert.ToDouble(itemERMSOPModule.SupplementPlant5Value)) + (float?)lst[q];  ///GEOS2-4046 Gulab Lakade
                                            }
                                        }


                                    }

                                }

                                if (ModuleSandardOperationTime != null)
                                    itemERMSOPModule.StandardOperationTime = (float?)Math.Round(Convert.ToDouble(itemERMSOPModule.NormalTime * (1 + (ModuleSandardOperationTime.Item2 / 100))), 2);
                                #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                //TimeSpan temp= ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.StandardOperationTime));
                                //if(temp.Hours==0)
                                //{
                                //    itemERMSOPModule.UiTempStandardOperationTimeName = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.StandardOperationTime)).ToString(@"mm\:ss"); ;
                                //   //string t2= itemERMSOPModule.UiTempStandardOperationTimeName.ToString(@"mm\:ss");
                                //   //TimeSpan t1 = TimeSpan.FromMinutes(Convert.ToDouble(itemERMSOPModule.StandardOperationTime));
                                //}
                                //else
                                //{
                                //    itemERMSOPModule.UiTempStandardOperationTimeName = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.StandardOperationTime)).ToString(@"hh\:mm\:ss"); ;
                                //}
                                itemERMSOPModule.UiTempStandardOperationTimeName = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.StandardOperationTime));

                                #endregion
                                itemERMSOPModule.OperationTimePlant1Value = (float?)Math.Round(Convert.ToDouble(itemERMSOPModule.NormalTime * (1 + (Convert.ToDouble(itemERMSOPModule.SupplementPlant1Value) / 100))), 2);
                                itemERMSOPModule.OperationTimePlant2Value = (float?)Math.Round(Convert.ToDouble(itemERMSOPModule.NormalTime * (1 + (Convert.ToDouble(itemERMSOPModule.SupplementPlant2Value) / 100))), 2);
                                itemERMSOPModule.OperationTimePlant3Value = (float?)Math.Round(Convert.ToDouble(itemERMSOPModule.NormalTime * (1 + (Convert.ToDouble(itemERMSOPModule.SupplementPlant3Value) / 100))), 2);
                                //if(!string.IsNullOrEmpty(Convert.ToString(itemERMSOPModule.SupplementPlant4Value)))
                                //{
                                //    itemERMSOPModule.OperationTimePlant4Value = (float?)Math.Round(Convert.ToDouble(itemERMSOPModule.NormalTime * (1 + (itemERMSOPModule.SupplementPlant4Value / 100))), 2);
                                //}
                                //else
                                //{
                                itemERMSOPModule.OperationTimePlant4Value = (float?)Math.Round(Convert.ToDouble(itemERMSOPModule.NormalTime * (1 + (Convert.ToDouble(itemERMSOPModule.SupplementPlant4Value) / 100))), 2);
                                //}

                                itemERMSOPModule.OperationTimePlant5Value = (float?)Math.Round(Convert.ToDouble(itemERMSOPModule.NormalTime * (1 + (Convert.ToDouble(itemERMSOPModule.SupplementPlant5Value) / 100))), 2);
                                #region GEOS2-3954 gulab lakade Time format HH:mm:ss

                                itemERMSOPModule.UiTempoperationTimePlant1Value = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.OperationTimePlant1Value));
                                itemERMSOPModule.UiTempoperationTimePlant2Value = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.OperationTimePlant2Value));
                                itemERMSOPModule.UiTempoperationTimePlant3Value = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.OperationTimePlant3Value));
                                itemERMSOPModule.UiTempoperationTimePlant4Value = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.OperationTimePlant4Value));
                                itemERMSOPModule.UiTempoperationTimePlant5Value = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.OperationTimePlant5Value));

                                #endregion
                            }
                        }
                    #endregion
                }



                #endregion
                //if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method FillmoduleTemplateGridlist() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        private void FillmoduleTemplateGridlist(List<StandardOperationsDictionaryModules> LstStandardOperationsDictionaryModules)

        {
            try
            {
                FillModuleData(LstStandardOperationsDictionaryModules);
                //FillmoduleGridColumn();  ////[GEOS2-4830][gulab lakade][07 12 2023]
            }
            catch (FaultException<ServiceException> ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillmoduleTemplateGridlist() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillmoduleTemplateGridlist() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method FillmoduleTemplateGridlist() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        List<StandardOperationsDictionaryModules> tempLstStandardOperationsDictionaryModules = new List<StandardOperationsDictionaryModules>();
        private void FillModuleData(List<StandardOperationsDictionaryModules> LstStandardOperationsDictionaryModules)
        {

            try
            {
                List<Int32> IdworkOperation = new List<int>();
                ObservableCollection<WorkOperationByStages> ModelList = new ObservableCollection<WorkOperationByStages>();
                if (WorkOperationMenulist != null)
                {
                    if (ModuleMenulist == null)
                    {
                        ModuleMenulist = new ObservableCollection<ERMSOPModule>();
                        ObservableCollection<ERMSOPModule> TempModuleMenulist = new ObservableCollection<ERMSOPModule>();
                        foreach (var DictionaryModules in LstStandardOperationsDictionaryModules)
                        {
                            List<WorkOperationByStages> tempModuleList = WorkOperationMenulist.Where(w => w.IdworkOperationByStage == Convert.ToInt32(DictionaryModules.IdWorkoperation)).ToList();
                            foreach (WorkOperationByStages item in tempModuleList)
                            {
                                duplicateItemloop = 0;
                                GetAllTreeList(item, WorkOperationMenulist);
                            }


                        }
                        #region [GEOS2-4830][gulab lakade][07 12 2023]
                        if (AllSupplementsBoxMenu != null)
                        {
                            var listadoDuplicadas = from c in AllSupplementsBoxMenu
                                                    join c2 in AllSupplementsBoxMenu on c.Item2 equals c2.Item2
                                                    where c != c2
                                                    select c;

                            var ModuleSandardOperationTime = listadoDuplicadas.FirstOrDefault();
                            if (ModuleSandardOperationTime != null)
                            {
                                var templist = listadoDuplicadas.Where(a => a.Item2 == ModuleSandardOperationTime.Item2);
                                listadoDuplicadas = templist;
                            }
                            var tempSupplementsBoxMenu = AllSupplementsBoxMenu;

                            ColumnsModuleForSupplements = new ObservableCollection<TreeListColumn>();
                            ColumnsModuleForSupplements.Add(new TreeListColumn()
                            {
                                FieldName = "StandardSupplements",
                                Header = "Standard",
                                HeaderToolTip = "Standard",
                                AllowCellMerge = false,
                                Width = 150, //gulab lakade not show supplements name all
                                AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                Visible = true,
                                ReadOnly = false,
                                FixedWidth = false,

                            });

                            ColumnsModuleOperationTime = new ObservableCollection<TreeListColumn>();
                            ColumnsModuleOperationTime.Add(new TreeListColumn()
                            {
                                //FieldName = "StandardOperationTime",
                                FieldName = "UiTempStandardOperationTimeName",
                                Header = "Standard",
                                HeaderToolTip = "Standard",
                                AllowCellMerge = false,
                                Width = 150,//gulab lakade not show supplements name all
                                AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                Visible = true,
                                ReadOnly = false,
                                FixedWidth = false,



                            });

                            int Suplimentcount = 1;
                            var ColumnsModuleList = tempSupplementsBoxMenu.Where(p => !listadoDuplicadas.Any(p2 => p2.Item1 == p.Item1));
                            foreach (var item in ColumnsModuleList)
                            {
                                if (Suplimentcount == 5)
                                {
                                    ColumnsModuleForSupplements.Add(new TreeListColumn()
                                    {
                                        FieldName = "SupplementPlant" + Suplimentcount + "Value",
                                        Header = "Others",
                                        HeaderToolTip = "Others",
                                        AllowCellMerge = false,
                                        Width = 60,
                                        AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                        Visible = true,
                                        ReadOnly = false,
                                        FixedWidth = false
                                    });
                                    ColumnsModuleOperationTime.Add(new TreeListColumn()
                                    {
                                        FieldName = "UiTempoperationTimePlant" + Suplimentcount + "Value",
                                        Header = "Others",
                                        HeaderToolTip = "Others",
                                        AllowCellMerge = false,
                                        Width = 60,
                                        AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                        Visible = true,
                                        ReadOnly = false,
                                        FixedWidth = false
                                    });
                                    break;
                                }
                                if (Suplimentcount == 5)
                                {
                                    break;
                                }
                                ColumnsModuleForSupplements.Add(new TreeListColumn()
                                {
                                    FieldName = "SupplementPlant" + Suplimentcount + "Value",
                                    Header = item.Item1,
                                    HeaderToolTip = item.Item1,
                                    AllowCellMerge = false,
                                    Width = 100,
                                    AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                    Visible = true,
                                    ReadOnly = false,
                                    FixedWidth = false
                                });

                                ColumnsModuleOperationTime.Add(new TreeListColumn()
                                {
                                    //FieldName = "OperationTimePlant" + count + "Value",
                                    FieldName = "UiTempoperationTimePlant" + Suplimentcount + "Value",
                                    Header = item.Item1,
                                    HeaderToolTip = item.Item1,
                                    AllowCellMerge = false,
                                    Width = 60,
                                    AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                    Visible = true,
                                    ReadOnly = false,
                                    FixedWidth = false
                                });
                                Suplimentcount = Suplimentcount + 1;
                            }



                            #endregion

                            foreach (WorkOperationByStages Module in WorkOperationMenulist)
                            {

                                //if (LstStandardOperationsDictionaryModules.Any(a => a.IdWorkoperation == Convert.ToUInt64(Module.IdworkOperationByStage)))
                                if (operationMenulist.Any(a => a.IdworkOperationByStage == Convert.ToInt64(Module.IdworkOperationByStage))
                                    && operationMenulist.Any(a => a.IdStage == Module.IdStage)
                                    && operationMenulist.Any(a => a.Name.Trim().Equals(Module.Name.Trim()))
                                    )
                                {
                                    StandardOperationsDictionaryModules standardOperationsDictionaryModules = LstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(Module.IdworkOperationByStage) && Module.Parent != null).FirstOrDefault();

                                    ERMSOPModule eRMSOPModule = new ERMSOPModule();
                                    if (standardOperationsDictionaryModules != null)
                                        eRMSOPModule.IdCpType = Convert.ToInt32(standardOperationsDictionaryModules.IdCpTypeNew);
                                    eRMSOPModule.Name = Module.Name;
                                    eRMSOPModule.IdworkOperationByStage = Module.IdworkOperationByStage;
                                    eRMSOPModule.IdSequence = Module.IdSequence;
                                    eRMSOPModule.IdStatus = Module.IdStatus;
                                    eRMSOPModule.Status = Module.Status;
                                    eRMSOPModule.Code = Module.Name;
                                    eRMSOPModule.Parent = Module.Parent;
                                    eRMSOPModule.IdParent = Module.IdParent;
                                    eRMSOPModule.KeyName = Module.KeyName;
                                    eRMSOPModule.ParentName = Module.ParentName;
                                    eRMSOPModule.Position = Module.Position;
                                    eRMSOPModule.WorkOperation_count = Module.WorkOperation_count;
                                    eRMSOPModule.WorkOperation_count_original = Module.WorkOperation_count_original;
                                    eRMSOPModule.NameWithWorkOperationCount = Module.NameWithWorkOperationCount;
                                    eRMSOPModule.NormalTime = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(Module.IdworkOperationByStage)).Select(s => s.NormalTime).DefaultIfEmpty(null).FirstOrDefault();
                                    if (eRMSOPModule.NormalTime != null)
                                        eRMSOPModule.NormalTime = Math.Round((double)eRMSOPModule.NormalTime, 2);
                                    eRMSOPModule.ObservedTime = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(Module.IdworkOperationByStage)).Select(s => s.ObservedTime).DefaultIfEmpty(null).FirstOrDefault();
                                    if (eRMSOPModule.ObservedTime != null)
                                        eRMSOPModule.ObservedTime = Math.Round((double)eRMSOPModule.ObservedTime, 2);
                                    eRMSOPModule.Activity = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(Module.IdworkOperationByStage)).Select(s => s.Activity).DefaultIfEmpty(null).FirstOrDefault(); ;
                                    if (eRMSOPModule.Activity != null)
                                        eRMSOPModule.Activity = Math.Round((double)eRMSOPModule.Activity, 2);
                                    if (GetStages.Any(a => a != null && a.Code.Trim().Equals(Module.Name.Trim())))
                                    {
                                        eRMSOPModule.IsDeleteButton = false;
                                        eRMSOPModule.IsDeleteButtonVisibility = Visibility.Hidden;
                                        // eRMSOPModule.ObservedTimeIsReadOnly =true;
                                        eRMSOPModule.IsReadOnly = true;
                                        eRMSOPModule.IsValidateOnTextInput = false;
                                        Module.IsCurrentWorkOperation = true;
                                    }
                                    else
                                    {
                                        Module.IsCurrentWorkOperation = true;
                                        //eRMSOPModule.ObservedTimeIsReadOnly = false;
                                        eRMSOPModule.IsReadOnly = false;
                                        eRMSOPModule.IsValidateOnTextInput = true;
                                    }
                                    if (Module.IdStatus == 1536)
                                    {
                                        eRMSOPModule.IsInactiveWorkOperation = true;
                                        eRMSOPModule.IsReadOnly = true;
                                    }
                                    #region Temp  check only [GEOS2-4830][gulab lakade][07 12 2023]

                                    if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(eRMSOPModule.Name.Trim())))
                                    {
                                        if (ModuleSandardOperationTime != null)
                                            eRMSOPModule.StandardSupplements = (float?)ModuleSandardOperationTime.Item2;
                                        if (tempSupplementsBoxMenu.Any(p => !listadoDuplicadas.Any(p2 => p2.Item1 == p.Item1)))
                                        {
                                            eRMSOPModule.AllSupplementsBoxMenu = AllSupplementsBoxMenu;
                                            List<float?> lst = new List<float?>();

                                            var a = ColumnsModuleList.ToList();
                                            for (int i = 0; i < a.Count(); i++)
                                            {
                                                lst.Add((float?)a[i].Item2);
                                            }

                                            if (ColumnsModuleList.Count() == 1)
                                            {
                                                eRMSOPModule.SupplementPlant1Value = (float?)lst[0];
                                            }
                                            else if (ColumnsModuleList.Count() == 2)
                                            {
                                                eRMSOPModule.SupplementPlant1Value = (float?)lst[0];
                                                eRMSOPModule.SupplementPlant2Value = (float?)lst[1];
                                            }
                                            else if (ColumnsModuleList.Count() == 3)
                                            {
                                                eRMSOPModule.SupplementPlant1Value = (float?)lst[0];
                                                eRMSOPModule.SupplementPlant2Value = (float?)lst[1];
                                                eRMSOPModule.SupplementPlant3Value = (float?)lst[2];
                                            }
                                            else if (ColumnsModuleList.Count() == 4)
                                            {
                                                eRMSOPModule.SupplementPlant1Value = (float?)lst[0];
                                                eRMSOPModule.SupplementPlant2Value = (float?)lst[1];
                                                eRMSOPModule.SupplementPlant3Value = (float?)lst[2];
                                                eRMSOPModule.SupplementPlant4Value = (float?)lst[3];
                                            }
                                            else if (ColumnsModuleList.Count() == 5)
                                            {
                                                eRMSOPModule.SupplementPlant1Value = (float?)lst[0];
                                                eRMSOPModule.SupplementPlant2Value = (float?)lst[1];
                                                eRMSOPModule.SupplementPlant3Value = (float?)lst[2];
                                                eRMSOPModule.SupplementPlant4Value = (float?)lst[3];
                                                eRMSOPModule.SupplementPlant5Value = (float?)lst[4];
                                            }
                                            else
                                            {
                                                eRMSOPModule.SupplementPlant1Value = (float?)lst[0];
                                                eRMSOPModule.SupplementPlant2Value = (float?)lst[1];
                                                eRMSOPModule.SupplementPlant3Value = (float?)lst[2];
                                                eRMSOPModule.SupplementPlant4Value = (float?)lst[3];
                                                eRMSOPModule.SupplementPlant5Value = 0;
                                                if (ColumnsModuleList.Count() > 5)
                                                {
                                                    for (int q = 4; q < ColumnsModuleList.Count(); q++)
                                                    {
                                                        if (eRMSOPModule.SupplementPlant5Value == null)
                                                            eRMSOPModule.SupplementPlant5Value = 0;
                                                        eRMSOPModule.SupplementPlant5Value = (float?)(Convert.ToDouble(eRMSOPModule.SupplementPlant5Value)) + (float?)lst[q];  ///GEOS2-4046 Gulab Lakade
                                                    }
                                                }


                                            }

                                        }

                                        if (ModuleSandardOperationTime != null)
                                            eRMSOPModule.StandardOperationTime = (float?)Math.Round(Convert.ToDouble(eRMSOPModule.NormalTime * (1 + (ModuleSandardOperationTime.Item2 / 100))), 2);
                                        #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                        //TimeSpan temp= ConvertfloattoTimespan(Convert.ToString(eRMSOPModule.StandardOperationTime));
                                        //if(temp.Hours==0)
                                        //{
                                        //    eRMSOPModule.UiTempStandardOperationTimeName = ConvertfloattoTimespan(Convert.ToString(eRMSOPModule.StandardOperationTime)).ToString(@"mm\:ss"); ;
                                        //   //string t2= eRMSOPModule.UiTempStandardOperationTimeName.ToString(@"mm\:ss");
                                        //   //TimeSpan t1 = TimeSpan.FromMinutes(Convert.ToDouble(eRMSOPModule.StandardOperationTime));
                                        //}
                                        //else
                                        //{
                                        //    eRMSOPModule.UiTempStandardOperationTimeName = ConvertfloattoTimespan(Convert.ToString(eRMSOPModule.StandardOperationTime)).ToString(@"hh\:mm\:ss"); ;
                                        //}
                                        eRMSOPModule.UiTempStandardOperationTimeName = ConvertfloattoTimespan(Convert.ToString(eRMSOPModule.StandardOperationTime));

                                        #endregion
                                        eRMSOPModule.OperationTimePlant1Value = (float?)Math.Round(Convert.ToDouble(eRMSOPModule.NormalTime * (1 + (Convert.ToDouble(eRMSOPModule.SupplementPlant1Value) / 100))), 2);
                                        eRMSOPModule.OperationTimePlant2Value = (float?)Math.Round(Convert.ToDouble(eRMSOPModule.NormalTime * (1 + (Convert.ToDouble(eRMSOPModule.SupplementPlant2Value) / 100))), 2);
                                        eRMSOPModule.OperationTimePlant3Value = (float?)Math.Round(Convert.ToDouble(eRMSOPModule.NormalTime * (1 + (Convert.ToDouble(eRMSOPModule.SupplementPlant3Value) / 100))), 2);
                                        //if(!string.IsNullOrEmpty(Convert.ToString(eRMSOPModule.SupplementPlant4Value)))
                                        //{
                                        //    eRMSOPModule.OperationTimePlant4Value = (float?)Math.Round(Convert.ToDouble(eRMSOPModule.NormalTime * (1 + (eRMSOPModule.SupplementPlant4Value / 100))), 2);
                                        //}
                                        //else
                                        //{
                                        eRMSOPModule.OperationTimePlant4Value = (float?)Math.Round(Convert.ToDouble(eRMSOPModule.NormalTime * (1 + (Convert.ToDouble(eRMSOPModule.SupplementPlant4Value) / 100))), 2);
                                        //}

                                        eRMSOPModule.OperationTimePlant5Value = (float?)Math.Round(Convert.ToDouble(eRMSOPModule.NormalTime * (1 + (Convert.ToDouble(eRMSOPModule.SupplementPlant5Value) / 100))), 2);
                                        #region GEOS2-3954 gulab lakade Time format HH:mm:ss

                                        eRMSOPModule.UiTempoperationTimePlant1Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPModule.OperationTimePlant1Value));
                                        eRMSOPModule.UiTempoperationTimePlant2Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPModule.OperationTimePlant2Value));
                                        eRMSOPModule.UiTempoperationTimePlant3Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPModule.OperationTimePlant3Value));
                                        eRMSOPModule.UiTempoperationTimePlant4Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPModule.OperationTimePlant4Value));
                                        eRMSOPModule.UiTempoperationTimePlant5Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPModule.OperationTimePlant5Value));

                                        #endregion
                                    }


                                    #endregion

                                    try
                                    {
                                        if (!ModuleMenulist.Any(a => a.KeyName.Equals(Module.KeyName)))
                                            ModuleMenulist.Add(eRMSOPModule);
                                    }
                                    catch (Exception ex)
                                    {
                                    }


                                }
                            }
                        }  //[GEOS2-4830][gulab lakade][07 12 2023]
                    }

                }
                CustomSummarycalculation();
            }
            catch (Exception ex)
            {

                GeosApplication.Instance.Logger.Log("Get an error in FillModuleData() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        ObservableCollection<ERMSOPModule> moduleList = new ObservableCollection<ERMSOPModule>();
        ObservableCollection<WorkOperationByStages> operationMenulist = new ObservableCollection<WorkOperationByStages>();
        int duplicateItemloop = 0;
        private void GetAllTreeList(WorkOperationByStages StandardOperationsDictionaryModules, ObservableCollection<WorkOperationByStages> WorkOperationMenulist)
        {
            try
            {
                if (StandardOperationsDictionaryModules != null && StandardOperationsDictionaryModules.Name.ToLower() != "All".ToLower())
                {

                    if (Convert.ToInt32(StandardOperationsDictionaryModules.IdParent) == Convert.ToInt32(StandardOperationsDictionaryModules.IdStage))
                    {
                        if (!operationMenulist.Any(a => a.KeyName.Equals(StandardOperationsDictionaryModules.KeyName)))
                            operationMenulist.Add(StandardOperationsDictionaryModules);
                        if (StandardOperationsDictionaryModules.IdParent == null || StandardOperationsDictionaryModules.IdStage == 0)
                        {

                        }
                        else
                        {
                            WorkOperationByStages TempStagesList = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == Convert.ToInt32(StandardOperationsDictionaryModules.IdStage) &&
                            a.KeyName.Equals(("Stage_" + Convert.ToInt32(StandardOperationsDictionaryModules.IdStage)).ToString())).FirstOrDefault();
                            if (duplicateItemloop >= 20) { TempStagesList = null; }
                            GetAllTreeList(TempStagesList, WorkOperationMenulist);
                        }
                    }
                    else
                    {
                        if (operationMenulist.Any(a => a.IdworkOperationByStage == Convert.ToInt64(StandardOperationsDictionaryModules.IdworkOperationByStage)))
                        {
                            duplicateItemloop = duplicateItemloop + 1;
                            if (duplicateItemloop >= 20)
                            {
                                GetAllTreeList(null, WorkOperationMenulist);
                            }
                        }
                        else
                        {
                            if (!operationMenulist.Any(a => a.KeyName.Equals(StandardOperationsDictionaryModules.KeyName)))
                                operationMenulist.Add(StandardOperationsDictionaryModules);
                        }
                        List<WorkOperationByStages> TempList = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == Convert.ToInt32(StandardOperationsDictionaryModules.IdParent)).ToList();
                        if (duplicateItemloop >= 20) { TempList = null; }
                        if (TempList != null)
                            foreach (WorkOperationByStages itemWorkOperationByStages in TempList)
                            {
                                GetAllTreeList(itemWorkOperationByStages, WorkOperationMenulist);
                            }
                    }

                }
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method GetAllTreeList()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }


        private void OnDragRecordOverModuleGrid(DragRecordOverEventArgs e)
        {
            try
            {
                #region Rajashri
                //Rajshri [Geos2-5629]
                Int64 targetParentid = 0;
                Int64 idparentValue = 0;
                int TempCount = 0;//[GEOS2-5629][gulab lakade][16 07 2024]
                DevExpress.Xpf.Grid.TreeListView TempWayTree = (DevExpress.Xpf.Grid.TreeListView)e.Source;
                DevExpress.Xpf.Grid.TreeListControl TempNode = (DevExpress.Xpf.Grid.TreeListControl)TempWayTree.Parent;

                var currentItem = TempNode.CurrentItem as Emdep.Geos.Data.Common.ERM.ERMSOPModule;

                if (currentItem != null)
                {
                    idparentValue = Convert.ToInt64(currentItem.IdParent);
                    TempCount = ModuleMenulist.Where(x => x.ParentName == currentItem.KeyName).ToList().Count();//[GEOS2-5629][gulab lakade][16 07 2024]
                }
                var targetrecord = e.TargetRecord as Emdep.Geos.Data.Common.ERM.ERMSOPModule;
                if (targetrecord != null)
                {
                    targetParentid = Convert.ToInt64(targetrecord.IdParent);
                }
                #endregion
                if ((e.IsFromOutside) && typeof(WorkOperationByStages).IsAssignableFrom(e.GetRecordType()))
                {
                    e.Effects = DragDropEffects.Copy;
                    e.Handled = true;
                }
                #region Aishwarya
                else if ((e.IsFromOutside) && typeof(ERMSOPModule).IsAssignableFrom(e.GetRecordType()))
                {
                    e.Effects = DragDropEffects.Copy;
                    e.Handled = true;
                    IsEnabled = true;
                }
                else if ((e.IsFromOutside) && typeof(ERMSOPModule).IsAssignableFrom(e.GetRecordType()) && e.TargetRecord == null)
                {
                    e.Effects = DragDropEffects.Copy;
                    e.Handled = true;
                }
                else if (e.DropPosition == DropPosition.Inside && typeof(ERMSOPModule).IsAssignableFrom(e.GetRecordType()))
                {
                    e.Effects = DragDropEffects.None;
                    e.Handled = false;
                }
                else if (typeof(ERMSOPModule).IsAssignableFrom(e.GetRecordType()) && (e.DropPosition == DropPosition.Before || e.DropPosition == DropPosition.After))
                {

                    #region Rajashri
                    ////Rajshri [Geos2-5629]

                    //DevExpress.Xpf.Grid.TreeListView TempWayTree = (DevExpress.Xpf.Grid.TreeListView)e.Source;
                    //DevExpress.Xpf.Grid.TreeListControl TempNode = (DevExpress.Xpf.Grid.TreeListControl)TempWayTree.Parent;

                    //var currentItem = TempNode.CurrentItem as Emdep.Geos.Data.Common.ERM.ERMSOPModule;
                    //if (currentItem != null)
                    //{
                    //    idparentValue = Convert.ToInt64(currentItem.IdParent);
                    //}
                    //var targetrecord = e.TargetRecord as Emdep.Geos.Data.Common.ERM.ERMSOPModule;
                    //if (targetrecord != null)
                    //{
                    //    targetParentid = Convert.ToInt64(targetrecord.IdParent);
                    //    }
                    #endregion
                    #region Rajashri
                    if (idparentValue == targetParentid)
                    {
                        // start [GEOS2-5629][gulab lakade][16 07 2024]
                        if (TempCount == 0)
                        {
                            e.Effects = DragDropEffects.Move;
                            e.Handled = true;
                            IsModulesequence = true;
                        }
                        else
                        {
                            e.Effects = DragDropEffects.None;
                            e.Handled = false;
                        }
                        //end [GEOS2-5629][gulab lakade][16 07 2024]
                    }
                    else
                    {
                        e.Effects = DragDropEffects.None;
                        e.Handled = false;
                    }
                    #endregion
                }
                #endregion
                else
                {
                    e.Effects = DragDropEffects.None;
                    e.Handled = false;
                }
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method OnDragRecordOverModuleGrid()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }

        }

        private void DropRecordModuleGrid(DropRecordEventArgs e)
        {
            try
            {
                if ((e.IsFromOutside) && e.TargetRecord != null && typeof(WorkOperationByStages).IsAssignableFrom(e.GetRecordType()))
                {
                    e.Effects = DragDropEffects.Copy;
                    if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }
                    CompleteDropRecordModuleGrid(e);

                    //if (ModuleMenulist != null)
                    //{
                    //    var tempModuleMenulist = ModuleMenulist.ToList();
                    //    //foreach (ERMSOPModule itemRemove in tempModuleMenulist)
                    //    for (int i = 0; i < tempModuleMenulist.Count; i++)
                    //    {
                    //        if (GetStages.Any(a => a.Code.Equals(tempModuleMenulist[i].Name)))
                    //        {
                    //            List<ERMSOPModule> childList = ModuleMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(tempModuleMenulist[i].KeyName)).ToList();
                    //            if (childList.Count == 0)
                    //            {
                    //                ModuleMenulist.Remove(tempModuleMenulist[i]);
                    //            }
                    //        }
                    //    }
                    //}
                    if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                    e.Handled = true;
                }
                else if ((e.IsFromOutside) && typeof(WorkOperationByStages).IsAssignableFrom(e.GetRecordType()) && e.TargetRecord == null)
                {
                    e.Effects = DragDropEffects.Copy;
                    CompleteDropRecordModuleGrid(e);
                    if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }
                    //if (ModuleMenulist!=null)
                    //{
                    //    var tempModuleMenulist = ModuleMenulist.ToList();
                    //    //foreach (ERMSOPModule itemRemove in tempModuleMenulist)
                    //    for (int i = 0; i < tempModuleMenulist.Count; i++)
                    //    {
                    //        if (GetStages.Any(a => a.Code.Equals(tempModuleMenulist[i].Name)))
                    //        {
                    //            List<ERMSOPModule> childList = ModuleMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(tempModuleMenulist[i].KeyName)).ToList();
                    //            if (childList.Count == 0)
                    //            {
                    //                ModuleMenulist.Remove(tempModuleMenulist[i]);
                    //            }
                    //        }
                    //    }
                    //}

                    if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                    e.Handled = true;
                    //e.Handled = true;
                }
                else if (e.DropPosition == DropPosition.Inside && typeof(WorkOperationByStages).IsAssignableFrom(e.GetRecordType()))
                {
                    e.Effects = DragDropEffects.None;
                    e.Handled = false;
                }
                else if (typeof(WorkOperationByStages).IsAssignableFrom(e.GetRecordType()) && (e.DropPosition == DropPosition.Before || e.DropPosition == DropPosition.After))
                {
                    e.Effects = DragDropEffects.Move;
                    e.Handled = false;
                }
                //#region Aishwarya
                else if ((e.IsFromOutside) && e.TargetRecord != null && typeof(ERMSOPModule).IsAssignableFrom(e.GetRecordType()))
                {
                    e.Effects = DragDropEffects.Copy;
                    if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }
                    CompleteDropRecordModuleGrid(e);

                    if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                    e.Handled = true;
                }
                else if ((e.IsFromOutside) && typeof(ERMSOPModule).IsAssignableFrom(e.GetRecordType()) && e.TargetRecord == null)
                {
                    e.Effects = DragDropEffects.Copy;
                    CompleteDropRecordModuleGrid(e);
                    if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }


                    if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                    e.Handled = false;
                    //e.Handled = true;
                }
                else if (e.DropPosition == DropPosition.Inside && typeof(ERMSOPModule).IsAssignableFrom(e.GetRecordType()))
                {
                    e.Effects = DragDropEffects.None;
                    e.Handled = false;
                }
                else if (typeof(ERMSOPModule).IsAssignableFrom(e.GetRecordType()) && (e.DropPosition == DropPosition.Before || e.DropPosition == DropPosition.After))
                {
                    var tragetPosition_var = e.TargetRecord.GetType().GetProperty("ModulePosition").GetValue(e.TargetRecord);
                    var TempTargetKeyName = e.TargetRecord.GetType().GetProperty("KeyName").GetValue(e.TargetRecord);
                    DevExpress.Xpf.Grid.TreeListView originsource = (DevExpress.Xpf.Grid.TreeListView)e.OriginalSource;
                    var MPosition_var = (originsource.FocusedRow.GetType().GetProperty("ModulePosition").GetValue(originsource.FocusedRow));
                    var TempChangeKeyName = (originsource.FocusedRow.GetType().GetProperty("KeyName").GetValue(originsource.FocusedRow));
                    UInt32 MPosition = Convert.ToUInt32(MPosition_var);
                    UInt32 tragetPosition = Convert.ToUInt32(tragetPosition_var);
                    string TargetKeyName = Convert.ToString(TempTargetKeyName);
                    string ChangeKeyName = Convert.ToString(TempChangeKeyName);
                    if (e.DropPosition == DropPosition.Before)
                    {
                        var TempChangesrecord = ModuleMenulist.Where(x => x.ModulePosition == MPosition && x.KeyName == ChangeKeyName).FirstOrDefault();

                        var TempBeforerecord = ModuleMenulist.Where(x => x.ModulePosition == tragetPosition && x.KeyName == TargetKeyName).FirstOrDefault();
                        if (tragetPosition < MPosition)
                        {
                            UInt32 pos = Convert.ToUInt32(tragetPosition);
                            foreach (var update in ModuleMenulist.Where(x => x.ModulePosition >= tragetPosition).OrderBy(a => a.ModulePosition).ToList())
                            {

                                //start[GEOS2-5629][gulab lakade][16 07 2024]
                                int TempCount = 0;
                                TempCount = ModuleMenulist.Where(x => x.ParentName == update.KeyName).ToList().Count();//[GEOS2-5629][gulab lakade][16 07 2024]
                                if (TempCount == 0)
                                {
                                    if (update.IdworkOperationByStage == TempChangesrecord.IdworkOperationByStage)
                                    {
                                        update.ModulePosition = Convert.ToUInt32(tragetPosition);
                                        // break;
                                    }
                                    else
                                    {
                                        if (Convert.ToUInt32(tragetPosition) == Convert.ToUInt32(pos))
                                        {
                                            pos++;
                                        }
                                        update.ModulePosition = pos;
                                        pos++;
                                    }
                                }
                                //end[GEOS2-5629][gulab lakade][16 07 2024]


                            }
                        }
                        else
                        {
                            UInt32 pos = Convert.ToUInt32(MPosition);

                            foreach (var update in ModuleMenulist.Where(x => x.ModulePosition >= MPosition).OrderBy(a => a.ModulePosition).ToList())
                            {

                                //start[GEOS2-5629][gulab lakade][16 07 2024]
                                int TempCount = 0;
                                TempCount = ModuleMenulist.Where(x => x.ParentName == update.KeyName).ToList().Count();//[GEOS2-5629][gulab lakade][16 07 2024]
                                if (TempCount == 0)
                                {
                                    if (update.IdworkOperationByStage == TempChangesrecord.IdworkOperationByStage)
                                    {
                                        update.ModulePosition = Convert.ToUInt32(tragetPosition - 1);
                                        // break;
                                    }
                                    else
                                    {
                                        if (pos == 0)
                                        {
                                            pos = 1;
                                        }
                                        if (pos == Convert.ToUInt32(tragetPosition - 1))
                                        {
                                            pos++;
                                        }
                                        update.ModulePosition = pos;
                                        pos++;
                                    }
                                }
                                //end[GEOS2-5629][gulab lakade][16 07 2024]


                            }
                        }



                    }
                    else if (e.DropPosition == DropPosition.After)
                    {
                        var TempChangesrecord = ModuleMenulist.Where(x => x.ModulePosition == MPosition && x.KeyName == ChangeKeyName).FirstOrDefault();

                        var TempBeforerecord = ModuleMenulist.Where(x => x.ModulePosition == tragetPosition && x.KeyName == TargetKeyName).FirstOrDefault();
                        if (tragetPosition < MPosition)
                        {
                            UInt32 pos = Convert.ToUInt32(tragetPosition);
                            foreach (var update in ModuleMenulist.Where(x => x.ModulePosition >= tragetPosition).OrderBy(a => a.ModulePosition).ToList())
                            {

                                //start[GEOS2-5629][gulab lakade][16 07 2024]
                                int TempCount = 0;
                                TempCount = ModuleMenulist.Where(x => x.ParentName == update.KeyName).ToList().Count();//[GEOS2-5629][gulab lakade][16 07 2024]
                                if (TempCount == 0)
                                {
                                    if (update.IdworkOperationByStage == TempChangesrecord.IdworkOperationByStage)
                                    {
                                        update.ModulePosition = Convert.ToUInt32(tragetPosition);
                                        // break;
                                    }
                                    else
                                    {
                                        if (Convert.ToUInt32(tragetPosition) == Convert.ToUInt32(pos))
                                        {
                                            pos++;
                                        }
                                        update.ModulePosition = pos;
                                        pos++;
                                    }
                                }
                                //end[GEOS2-5629][gulab lakade][16 07 2024]

                            }
                        }
                        else
                        {

                            UInt32 pos = Convert.ToUInt32(MPosition);
                            foreach (var update in ModuleMenulist.Where(x => x.ModulePosition >= MPosition).OrderBy(a => a.ModulePosition).ToList())
                            {

                                //start[GEOS2-5629][gulab lakade][16 07 2024]
                                int TempCount = 0;
                                TempCount = ModuleMenulist.Where(x => x.ParentName == update.KeyName).ToList().Count();//[GEOS2-5629][gulab lakade][16 07 2024]
                                if (TempCount == 0)
                                {
                                    if (update.IdworkOperationByStage == TempChangesrecord.IdworkOperationByStage)
                                    {
                                        update.ModulePosition = Convert.ToUInt32(tragetPosition);
                                        // break;
                                    }
                                    else
                                    {
                                        if (pos == 0)
                                        {
                                            pos = 1;
                                        }
                                        if (pos == Convert.ToUInt32(tragetPosition))
                                        {
                                            pos++;
                                        }
                                        update.ModulePosition = pos;
                                        pos++;
                                    }
                                }
                                //end[GEOS2-5629][gulab lakade][16 07 2024]

                            }
                        }
                    }

                    var Tmpmodule = ModuleMenulist.OrderBy(a => a.ModulePosition).ToList();
                    ModuleMenulist = new ObservableCollection<ERMSOPModule>(Tmpmodule);
                    e.Effects = DragDropEffects.Move;
                    e.Handled = true;
                    IsModulesequence = true;
                }
                //#endregion
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in Method OnDragRecordOverModuleGrid()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }

        }

        //private void CompleteDropRecordModuleGrid(DropRecordEventArgs e)
        //{
        //    try
        //    {
        //        Saveselecteditem = "module";  //[GEOS2-4108][Rupali Sarode][3-1-2022]
        //        if (!DXSplashScreen.IsActive)
        //        {
        //            DXSplashScreen.Show(x =>
        //            {
        //                Window win = new Window()
        //                {
        //                    ShowActivated = false,
        //                    WindowStyle = WindowStyle.None,
        //                    ResizeMode = ResizeMode.NoResize,
        //                    AllowsTransparency = true,
        //                    Background = new SolidColorBrush(Colors.Transparent),
        //                    ShowInTaskbar = false,
        //                    Topmost = true,
        //                    SizeToContent = SizeToContent.WidthAndHeight,
        //                    WindowStartupLocation = WindowStartupLocation.CenterScreen,
        //                };
        //                WindowFadeAnimationBehavior.SetEnableAnimation(win, true);
        //                win.Topmost = false;
        //                return win;
        //            }, x =>
        //            {
        //                return new SplashScreenView() { DataContext = new SplashScreenViewModel() };
        //            }, null, null);
        //        }

        //        if (SelectedItem is ProductTypes)
        //        {

        //            IsEnabledSaveButton = true;
        //            SaveButtonVisibility = Visibility.Visible;
        //            duplicateItemloop = 0;
        //            if ((e.IsFromOutside) && typeof(WorkOperationByStages).IsAssignableFrom(e.GetRecordType()))
        //            {
        //                //ModuleMenulist = new ObservableCollection<ERMSOPModule>();
        //                WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
        //                var data = (RecordDragDropData)e.Data.GetData(typeof(RecordDragDropData));
        //                List<WorkOperationByStages> found = new List<WorkOperationByStages>();
        //                List<WorkOperationByStages> TempfoundAllrecords = new List<WorkOperationByStages>();
        //                List<WorkOperationByStages> records = data.Records.OfType<WorkOperationByStages>().ToList();
        //                operationMenulist = new ObservableCollection<WorkOperationByStages>();
        //                int count = 0;
        //                if (ModuleMenulist == null)
        //                {
        //                    ModuleMenulist = new ObservableCollection<ERMSOPModule>();
        //                }
        //                if (records.Any(a => a.Name.Equals("All")))
        //                {
        //                    //records.RemoveAll(r => r.Name.Equals("All"));
        //                    #region ALL
        //                    // found.AddRange(records);
        //                    found = new List<WorkOperationByStages>();
        //                    operationMenulist = new ObservableCollection<WorkOperationByStages>();
        //                    operationMenulist.AddRange(WorkOperationMenulist.Where(w => !w.Name.Equals("All")));
        //                    #endregion
        //                }
        //                else

        //                //if (true)
        //                {

        //                    //for (int i = 0; i < records.Count(); i++)
        //                    //{

        //                    //}
        //                    //foreach (WorkOperationByStages itemWorkOperationByStages in records)
        //                    for (int r = 0; r < records.Count(); r++)
        //                    {
        //                        if (!ModuleMenulist.Any(a => a.Name.Equals(records[r].Name)))
        //                        {
        //                            // if (records[r].IdStatus != 1536) [rdixit][GEOS2-3764][04.08.2022]
        //                            // {
        //                            records[r].IsCurrentWorkOperation = true;
        //                            // ModuleMenulist.Add(JsonConvert.DeserializeObject<ERMSOPModule>(JsonConvert.SerializeObject(records[r])));
        //                            operationMenulist.Add(records[r]);  // [GEOS2-3933] Rupali Sarode 
        //                            // }


        //                        }

        //                        if (GetStages.Any(a => a != null && a.Code.Trim().Equals(records[r].Name.Trim())))
        //                        {
        //                            found.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(records[r].KeyName)).ToList());
        //                            int x = 0;
        //                            Loop:
        //                            x++;
        //                            if (x < 4)
        //                            {
        //                                for (int i = 0; i < found.Count(); i++)
        //                                {
        //                                    //TempfoundAllrecords.AddRange(WorkOperationMenulist.Where(s => s.IdworkOperationByStage == found[i].IdworkOperationByStage).ToList());
        //                                    TempfoundAllrecords.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(found[i].KeyName)).ToList());
        //                                }
        //                                for (int i = 0; i < TempfoundAllrecords.Count(); i++)
        //                                {
        //                                    if (!found.Any(a => a != null && a.KeyName.Trim().Equals(TempfoundAllrecords[i].KeyName.Trim())))
        //                                        found.Add(TempfoundAllrecords[i]);
        //                                }
        //                                goto Loop;
        //                            }


        //                            //foreach (var itemfound in found)
        //                            //{
        //                            //    //TempfoundAllrecords.AddRange(WorkOperationMenulist.Where(s => s.Name.Trim().Equals(itemfound.Name.Trim())).ToList());
        //                            //    TempfoundAllrecords.AddRange(WorkOperationMenulist.Where(s => s.IdworkOperationByStage==itemfound.IdworkOperationByStage).ToList());
        //                            //    TempfoundAllrecords.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(itemfound.KeyName)).ToList());
        //                            //}


        //                            //foreach (var tempfoundAllrecords in TempfoundAllrecords)
        //                            //{
        //                            //    if (!found.Any(a => a != null && a.KeyName.Trim().Equals(tempfoundAllrecords.KeyName.Trim())))
        //                            //        found.Add(tempfoundAllrecords);
        //                            //}
        //                        }
        //                        else
        //                        {
        //                            found.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(records[r].KeyName)).ToList());
        //                            for (int i = 0; i < found.Count(); i++)
        //                            {
        //                                TempfoundAllrecords.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(found[i].KeyName)).ToList());
        //                            }
        //                            //foreach (var itemfound in found)
        //                            //{
        //                            //    TempfoundAllrecords.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(itemfound.KeyName)).ToList());
        //                            //}
        //                            for (int i = 0; i < TempfoundAllrecords.Count(); i++)
        //                            {
        //                                if (!found.Any(a => a != null && a.KeyName.Trim().Equals(TempfoundAllrecords[i].KeyName.Trim())))
        //                                    found.Add(TempfoundAllrecords[i]);
        //                            }
        //                            //foreach (var tempfoundAllrecords in TempfoundAllrecords)
        //                            //{
        //                            //    if (!found.Any(a => a != null && a.KeyName.Trim().Equals(tempfoundAllrecords.KeyName.Trim())))
        //                            //        found.Add(tempfoundAllrecords);
        //                            //}
        //                            for (int i = 0; i < records.Where(a => a.IdworkOperationByStage > 0).Count(); i++)
        //                            {
        //                                if (!found.Any(a => a != null && a.KeyName.Trim().Equals(records[i].KeyName.Trim())))
        //                                    found.AddRange(WorkOperationMenulist.Where(s => s.IdworkOperationByStage == records[i].IdworkOperationByStage).ToList());
        //                                if (found.Count() != 0)
        //                                {
        //                                    count++;
        //                                }
        //                            }
        //                            //foreach (WorkOperationByStages eRMModule in records.Where(a => a.IdworkOperationByStage > 0))
        //                            //{
        //                            //    //found.AddRange(WorkOperationMenulist.Where(s => s.IdworkOperationByStage == eRMModule.IdworkOperationByStage).ToList());
        //                            //    if (!found.Any(a => a != null && a.KeyName.Trim().Equals(eRMModule.KeyName.Trim())))
        //                            //        found.AddRange(WorkOperationMenulist.Where(s => s.IdworkOperationByStage==eRMModule.IdworkOperationByStage).ToList());
        //                            //    //found.AddRange(WorkOperationMenulist.Where(s => s.Name.Trim().Equals(eRMModule.Name.Trim())).ToList());
        //                            //    if (found.Count() != 0)
        //                            //    {
        //                            //        count++;
        //                            //    }
        //                            //}
        //                        }

        //                    }
        //                }


        //                if (count > 0)
        //                {
        //                    for (int i = 0; i < found.Count(); i++)
        //                    {
        //                        if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(found[i].Name.Trim())))
        //                        {
        //                            duplicateItemloop = 0;
        //                            GetAllTreeList(found[i], WorkOperationMenulist);
        //                        }

        //                    }
        //                    //foreach (WorkOperationByStages item in found)
        //                    //{
        //                    //    if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(item.Name.Trim())))
        //                    //    {
        //                    //        GetAllTreeList(item, WorkOperationMenulist);
        //                    //    }

        //                    //}
        //                }
        //                else
        //                {
        //                    //for (int i = 0; i < found.Count(); i++)
        //                    //{
        //                    //    GetAllTreeList(found[i], WorkOperationMenulist);
        //                    //}
        //                    if (!records.Any(a => a.Name.Equals("All")))
        //                        foreach (WorkOperationByStages item in found)
        //                        {
        //                            duplicateItemloop = 0;
        //                            GetAllTreeList(item, WorkOperationMenulist);
        //                        }
        //                }
        //                if (!records.Any(a => a.Name.Equals("All")))
        //                    if (operationMenulist != null)
        //                    {
        //                        var tempModuleMenulist = operationMenulist.ToList();
        //                        for (int i = 0; i < tempModuleMenulist.Count; i++)
        //                        {
        //                            if (GetStages.Any(a => a.Code.Equals(tempModuleMenulist[i].Name)))
        //                            {
        //                                List<WorkOperationByStages> childList = operationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(tempModuleMenulist[i].KeyName)).ToList();
        //                                if (childList.Count == 0)
        //                                {
        //                                    operationMenulist.Remove(tempModuleMenulist[i]);
        //                                }
        //                            }
        //                        }
        //                    }


        //                //#region [GEOS2-5020][Rupali Sarode][29-11-2023]
        //                //List<string> WOWithStatusList;

        //                //WOWithStatusList = new List<string>();
        //                //string WOWithStatus = string.Empty;

        //                //List<WorkOperationByStages> WOChilds = WorkOperationMenulist.Where(i => i.ParentName != null && i.ParentName == records[0].KeyName).ToList();
        //                //if (WOChilds != null)
        //                //{
        //                //    if (WOChilds.Count == 0) //If dropped item is child
        //                //    {
        //                //        int WOIdStatus = WorkOperationMenulist.Where(i => i.Name == records[0].Name).FirstOrDefault().IdStatus;
        //                //        if (WOIdStatus > 0 && WOIdStatus != 1535)
        //                //        {
        //                //            CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("AddEditSODDragOnlyActiveWO").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
        //                //            return;
        //                //        }

        //                //    }

        //                //    else if (WOChilds.Count > 0)  //If dropped item is parent
        //                //    {
        //                //        foreach(WorkOperationByStages item in operationMenulist)
        //                //        {
        //                //            if (item.IdStatus != 1535)
        //                //            {
        //                //                if (item.IdStatus == 1536)
        //                //                    WOWithStatusList.Add(item.Name + " - " + "Inactive");
        //                //                else if (item.IdStatus == 1537)
        //                //                    WOWithStatusList.Add(item.Name + " - " + "Draft");
        //                //            }
        //                //        }

        //                //        if (WOWithStatusList.Count > 0)
        //                //        {
        //                //            foreach (string WorkOperation in WOWithStatusList)
        //                //            {
        //                //                if (string.IsNullOrEmpty(WOWithStatus))
        //                //                    WOWithStatus = WorkOperation;
        //                //                else
        //                //                    WOWithStatus = WOWithStatus + "," + WorkOperation;
        //                //            }
        //                //        }
        //                //    }
        //                //}

        //                //if (!string.IsNullOrEmpty(WOWithStatus))
        //                //{
        //                //    CustomMessageBox.Show(string.Format("Can not drop following WOs as they are Inactive/Draft : " +   WOWithStatus), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
        //                //}

        //                //#endregion [GEOS2-5020][Rupali Sarode][29-11-2023]


        //                #region commonCode

        //                if (AllSupplementsBoxMenu != null)
        //                {
        //                    var listadoDuplicadas = from c in AllSupplementsBoxMenu
        //                                            join c2 in AllSupplementsBoxMenu on c.Item2 equals c2.Item2
        //                                            where c != c2
        //                                            select c;

        //                    var ModuleSandardOperationTime = listadoDuplicadas.FirstOrDefault();
        //                    if (ModuleSandardOperationTime != null)
        //                    {
        //                        var templist = listadoDuplicadas.Where(a => a.Item2 == ModuleSandardOperationTime.Item2);
        //                        listadoDuplicadas = templist;
        //                    }
        //                    var tempSupplementsBoxMenu = AllSupplementsBoxMenu;

        //                    ColumnsModuleForSupplements = new ObservableCollection<TreeListColumn>();
        //                    ColumnsModuleForSupplements.Add(new TreeListColumn()
        //                    {
        //                        FieldName = "StandardSupplements",
        //                        Header = "Standard",
        //                        HeaderToolTip = "Standard",
        //                        AllowCellMerge = false,
        //                        Width = 150, //gulab lakade not show supplements name all
        //                        AllowEditing = DevExpress.Utils.DefaultBoolean.False,
        //                        Visible = true,
        //                        ReadOnly = false,
        //                        FixedWidth = false,

        //                    });

        //                    ColumnsModuleOperationTime = new ObservableCollection<TreeListColumn>();
        //                    ColumnsModuleOperationTime.Add(new TreeListColumn()
        //                    {
        //                        //FieldName = "StandardOperationTime",
        //                        FieldName = "UiTempStandardOperationTimeName",
        //                        Header = "Standard",
        //                        HeaderToolTip = "Standard",
        //                        AllowCellMerge = false,
        //                        Width = 150,//gulab lakade not show supplements name all
        //                        AllowEditing = DevExpress.Utils.DefaultBoolean.False,
        //                        Visible = true,
        //                        ReadOnly = false,
        //                        FixedWidth = false,



        //                    });

        //                    int Suplimentcount = 1;
        //                    var ColumnsModuleList = tempSupplementsBoxMenu.Where(p => !listadoDuplicadas.Any(p2 => p2.Item1 == p.Item1));
        //                    foreach (var item in ColumnsModuleList)
        //                    {
        //                        if (Suplimentcount == 5)
        //                        {
        //                            ColumnsModuleForSupplements.Add(new TreeListColumn()
        //                            {
        //                                FieldName = "SupplementPlant" + Suplimentcount + "Value",
        //                                Header = "Others",
        //                                HeaderToolTip = "Others",
        //                                AllowCellMerge = false,
        //                                Width = 60,
        //                                AllowEditing = DevExpress.Utils.DefaultBoolean.False,
        //                                Visible = true,
        //                                ReadOnly = false,
        //                                FixedWidth = false
        //                            });
        //                            ColumnsModuleOperationTime.Add(new TreeListColumn()
        //                            {
        //                                FieldName = "UiTempoperationTimePlant" + Suplimentcount + "Value",
        //                                Header = "Others",
        //                                HeaderToolTip = "Others",
        //                                AllowCellMerge = false,
        //                                Width = 60,
        //                                AllowEditing = DevExpress.Utils.DefaultBoolean.False,
        //                                Visible = true,
        //                                ReadOnly = false,
        //                                FixedWidth = false
        //                            });
        //                            break;
        //                        }
        //                        if (Suplimentcount == 5)
        //                        {
        //                            break;
        //                        }
        //                        ColumnsModuleForSupplements.Add(new TreeListColumn()
        //                        {
        //                            FieldName = "SupplementPlant" + Suplimentcount + "Value",
        //                            Header = item.Item1,
        //                            HeaderToolTip = item.Item1,
        //                            AllowCellMerge = false,
        //                            Width = 100,
        //                            AllowEditing = DevExpress.Utils.DefaultBoolean.False,
        //                            Visible = true,
        //                            ReadOnly = false,
        //                            FixedWidth = false
        //                        });

        //                        ColumnsModuleOperationTime.Add(new TreeListColumn()
        //                        {
        //                            //FieldName = "OperationTimePlant" + count + "Value",
        //                            FieldName = "UiTempoperationTimePlant" + Suplimentcount + "Value",
        //                            Header = item.Item1,
        //                            HeaderToolTip = item.Item1,
        //                            AllowCellMerge = false,
        //                            Width = 60,
        //                            AllowEditing = DevExpress.Utils.DefaultBoolean.False,
        //                            Visible = true,
        //                            ReadOnly = false,
        //                            FixedWidth = false
        //                        });
        //                        Suplimentcount = Suplimentcount + 1;
        //                    }





        //                    foreach (WorkOperationByStages Module in WorkOperationMenulist)
        //                    {
        //                        // if (Module.IdStatus != 1536) [rdixit][GEOS2-3764][04.08.2022]
        //                        //if (LstStandardOperationsDictionaryModules.Any(a => a.IdWorkoperation == Convert.ToUInt64(Module.IdworkOperationByStage)))
        //                        if (operationMenulist.Any(a => a.IdworkOperationByStage == Convert.ToInt64(Module.IdworkOperationByStage))
        //                               && operationMenulist.Any(a => a.IdStage == Module.IdStage)
        //                            && operationMenulist.Any(a => a.Name.Trim().Equals(Module.Name.Trim()))
        //                            )
        //                        {

        //                            //    if (Module.IdStatus != 1536 && Module.IdStatus != 1537) //[GEOS2-5020][Rupali Sarode][30-11-2023]
        //                            //{

        //                                ERMSOPModule eRMSOPModule = new ERMSOPModule();
        //                                eRMSOPModule.Name = Module.Name;
        //                                eRMSOPModule.IdworkOperationByStage = Module.IdworkOperationByStage;
        //                                eRMSOPModule.IdSequence = Module.IdSequence;
        //                                eRMSOPModule.IdStatus = Module.IdStatus;
        //                                eRMSOPModule.Status = Module.Status;
        //                                eRMSOPModule.Code = Module.Name;
        //                                eRMSOPModule.Parent = Module.Parent;
        //                                eRMSOPModule.IdParent = Module.IdParent;
        //                                eRMSOPModule.KeyName = Module.KeyName;
        //                                eRMSOPModule.ParentName = Module.ParentName;
        //                                eRMSOPModule.Position = Module.Position;
        //                                eRMSOPModule.WorkOperation_count = Module.WorkOperation_count;
        //                                eRMSOPModule.WorkOperation_count_original = Module.WorkOperation_count_original;
        //                                eRMSOPModule.NameWithWorkOperationCount = Module.NameWithWorkOperationCount;
        //                                eRMSOPModule.NormalTime = Module.NormalTime;

        //                                ProductTypes tIdCPType = (ProductTypes)SelectedItem;  //[GEOS2-3909][Rupali Sarode][09-11-2022]
        //                                eRMSOPModule.IdCpType = Convert.ToInt32(tIdCPType.IdCPType); //[GEOS2-3909][Rupali Sarode][09-11-2022]

        //                                //[GEOS2-3933][Rupali Sarode][21/09/2022]
        //                                eRMSOPModule.WORemarks = Module.WORemarks == null ? "" : Module.WORemarks.Trim();


        //                                if (Module.NormalTime != null)
        //                                {
        //                                    eRMSOPModule.NormalTime = Math.Round((double)Module.NormalTime, 2);
        //                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
        //                                    eRMSOPModule.UITempNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(eRMSOPModule.NormalTime));
        //                                    #endregion
        //                                }
        //                                eRMSOPModule.ObservedTime = Module.ObservedTime;
        //                                if (Module.ObservedTime != null)
        //                                {
        //                                    eRMSOPModule.ObservedTime = Math.Round((double)Module.ObservedTime, 2);
        //                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
        //                                    eRMSOPModule.UITempobservedTime = ConvertfloattoTimespan(Convert.ToString(eRMSOPModule.ObservedTime));
        //                                    #endregion
        //                                }
        //                                eRMSOPModule.Activity = Module.Activity;
        //                                if (eRMSOPModule.Activity != 0)
        //                                    eRMSOPModule.Activity = Math.Round((double)Module.Activity, 2);
        //                                if (eRMSOPModule.Activity == 0)
        //                                    eRMSOPModule.Activity = null;
        //                                if (GetStages.Any(a => a != null && a.Code.Trim().Equals(Module.Name.Trim())))
        //                                {
        //                                    Module.IsCurrentWorkOperation = true;
        //                                    eRMSOPModule.IsDeleteButton = false;
        //                                    eRMSOPModule.IsDeleteButtonVisibility = Visibility.Hidden;
        //                                    // eRMSOPModule.ObservedTimeIsReadOnly =true;
        //                                    //eRMSOPModule.IsReadOnly = true;
        //                                    eRMSOPModule.IsValidateOnTextInput = false;
        //                                }
        //                                else
        //                                {
        //                                    Module.IsCurrentWorkOperation = true;
        //                                    //eRMSOPModule.ObservedTimeIsReadOnly = false;
        //                                    // eRMSOPModule.IsReadOnly = false;
        //                                    eRMSOPModule.IsValidateOnTextInput = true;
        //                                }
        //                                if (Module.IdStatus == 1536)
        //                                {
        //                                    eRMSOPModule.IsInactiveWorkOperation = true;
        //                                    //eRMSOPModule.IsReadOnly = true;

        //                                }
        //                                else
        //                                {
        //                                    //eRMSOPModule.IsReadOnly = false;
        //                                }



        //                                #region Temp  check only [GEOS2-4830][gulab lakade][07 12 2023]

        //                                        if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(eRMSOPModule.Name.Trim())))
        //                                        {
        //                                            if (ModuleSandardOperationTime != null)
        //                                                eRMSOPModule.StandardSupplements = (float?)ModuleSandardOperationTime.Item2;
        //                                            if (tempSupplementsBoxMenu.Any(p => !listadoDuplicadas.Any(p2 => p2.Item1 == p.Item1)))
        //                                            {
        //                                                eRMSOPModule.AllSupplementsBoxMenu = AllSupplementsBoxMenu;
        //                                                List<float?> lst = new List<float?>();

        //                                                var a = ColumnsModuleList.ToList();
        //                                                for (int i = 0; i < a.Count(); i++)
        //                                                {
        //                                                    lst.Add((float?)a[i].Item2);
        //                                                }

        //                                                if (ColumnsModuleList.Count() == 1)
        //                                                {
        //                                                    eRMSOPModule.SupplementPlant1Value = (float?)lst[0];
        //                                                }
        //                                                else if (ColumnsModuleList.Count() == 2)
        //                                                {
        //                                                    eRMSOPModule.SupplementPlant1Value = (float?)lst[0];
        //                                                    eRMSOPModule.SupplementPlant2Value = (float?)lst[1];
        //                                                }
        //                                                else if (ColumnsModuleList.Count() == 3)
        //                                                {
        //                                                    eRMSOPModule.SupplementPlant1Value = (float?)lst[0];
        //                                                    eRMSOPModule.SupplementPlant2Value = (float?)lst[1];
        //                                                    eRMSOPModule.SupplementPlant3Value = (float?)lst[2];
        //                                                }
        //                                                else if (ColumnsModuleList.Count() == 4)
        //                                                {
        //                                                    eRMSOPModule.SupplementPlant1Value = (float?)lst[0];
        //                                                    eRMSOPModule.SupplementPlant2Value = (float?)lst[1];
        //                                                    eRMSOPModule.SupplementPlant3Value = (float?)lst[2];
        //                                                    eRMSOPModule.SupplementPlant4Value = (float?)lst[3];
        //                                                }
        //                                                else if (ColumnsModuleList.Count() == 5)
        //                                                {
        //                                                    eRMSOPModule.SupplementPlant1Value = (float?)lst[0];
        //                                                    eRMSOPModule.SupplementPlant2Value = (float?)lst[1];
        //                                                    eRMSOPModule.SupplementPlant3Value = (float?)lst[2];
        //                                                    eRMSOPModule.SupplementPlant4Value = (float?)lst[3];
        //                                                    eRMSOPModule.SupplementPlant5Value = (float?)lst[4];
        //                                                }
        //                                                else
        //                                                {
        //                                                    eRMSOPModule.SupplementPlant1Value = (float?)lst[0];
        //                                                    eRMSOPModule.SupplementPlant2Value = (float?)lst[1];
        //                                                    eRMSOPModule.SupplementPlant3Value = (float?)lst[2];
        //                                                    eRMSOPModule.SupplementPlant4Value = (float?)lst[3];
        //                                                    eRMSOPModule.SupplementPlant5Value = 0;
        //                                                    if (ColumnsModuleList.Count() > 5)
        //                                                    {
        //                                                        for (int q = 4; q < ColumnsModuleList.Count(); q++)
        //                                                        {
        //                                                            if (eRMSOPModule.SupplementPlant5Value == null)
        //                                                                eRMSOPModule.SupplementPlant5Value = 0;
        //                                                            eRMSOPModule.SupplementPlant5Value = (float?)(Convert.ToDouble(eRMSOPModule.SupplementPlant5Value)) + (float?)lst[q];  ///GEOS2-4046 Gulab Lakade
        //                                                        }
        //                                                    }


        //                                                }

        //                                            }

        //                                            if (ModuleSandardOperationTime != null)
        //                                                eRMSOPModule.StandardOperationTime = (float?)Math.Round(Convert.ToDouble(eRMSOPModule.NormalTime * (1 + (ModuleSandardOperationTime.Item2 / 100))), 2);
        //                                            #region GEOS2-3954 gulab lakade Time format HH:mm:ss
        //                                            //TimeSpan temp= ConvertfloattoTimespan(Convert.ToString(eRMSOPModule.StandardOperationTime));
        //                                            //if(temp.Hours==0)
        //                                            //{
        //                                            //    eRMSOPModule.UiTempStandardOperationTimeName = ConvertfloattoTimespan(Convert.ToString(eRMSOPModule.StandardOperationTime)).ToString(@"mm\:ss"); ;
        //                                            //   //string t2= eRMSOPModule.UiTempStandardOperationTimeName.ToString(@"mm\:ss");
        //                                            //   //TimeSpan t1 = TimeSpan.FromMinutes(Convert.ToDouble(eRMSOPModule.StandardOperationTime));
        //                                            //}
        //                                            //else
        //                                            //{
        //                                            //    eRMSOPModule.UiTempStandardOperationTimeName = ConvertfloattoTimespan(Convert.ToString(eRMSOPModule.StandardOperationTime)).ToString(@"hh\:mm\:ss"); ;
        //                                            //}
        //                                            eRMSOPModule.UiTempStandardOperationTimeName = ConvertfloattoTimespan(Convert.ToString(eRMSOPModule.StandardOperationTime));

        //                                            #endregion
        //                                            eRMSOPModule.OperationTimePlant1Value = (float?)Math.Round(Convert.ToDouble(eRMSOPModule.NormalTime * (1 + (Convert.ToDouble(eRMSOPModule.SupplementPlant1Value) / 100))), 2);
        //                                            eRMSOPModule.OperationTimePlant2Value = (float?)Math.Round(Convert.ToDouble(eRMSOPModule.NormalTime * (1 + (Convert.ToDouble(eRMSOPModule.SupplementPlant2Value) / 100))), 2);
        //                                            eRMSOPModule.OperationTimePlant3Value = (float?)Math.Round(Convert.ToDouble(eRMSOPModule.NormalTime * (1 + (Convert.ToDouble(eRMSOPModule.SupplementPlant3Value) / 100))), 2);
        //                                            //if(!string.IsNullOrEmpty(Convert.ToString(eRMSOPModule.SupplementPlant4Value)))
        //                                            //{
        //                                            //    eRMSOPModule.OperationTimePlant4Value = (float?)Math.Round(Convert.ToDouble(eRMSOPModule.NormalTime * (1 + (eRMSOPModule.SupplementPlant4Value / 100))), 2);
        //                                            //}
        //                                            //else
        //                                            //{
        //                                            eRMSOPModule.OperationTimePlant4Value = (float?)Math.Round(Convert.ToDouble(eRMSOPModule.NormalTime * (1 + (Convert.ToDouble(eRMSOPModule.SupplementPlant4Value) / 100))), 2);
        //                                            //}

        //                                            eRMSOPModule.OperationTimePlant5Value = (float?)Math.Round(Convert.ToDouble(eRMSOPModule.NormalTime * (1 + (Convert.ToDouble(eRMSOPModule.SupplementPlant5Value) / 100))), 2);
        //                                            #region GEOS2-3954 gulab lakade Time format HH:mm:ss

        //                                            eRMSOPModule.UiTempoperationTimePlant1Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPModule.OperationTimePlant1Value));
        //                                            eRMSOPModule.UiTempoperationTimePlant2Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPModule.OperationTimePlant2Value));
        //                                            eRMSOPModule.UiTempoperationTimePlant3Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPModule.OperationTimePlant3Value));
        //                                            eRMSOPModule.UiTempoperationTimePlant4Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPModule.OperationTimePlant4Value));
        //                                            eRMSOPModule.UiTempoperationTimePlant5Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPModule.OperationTimePlant5Value));

        //                                            #endregion
        //                                        }


        //                                #endregion



        //                                try
        //                                {
        //                                    if (!ModuleMenulist.Any(a => a.KeyName.Equals(Module.KeyName)))
        //                                    {
        //                                        ModuleMenulist.Add(eRMSOPModule);
        //                                    }

        //                                }
        //                                catch (Exception ex)
        //                                {

        //                                }
        //                                //if(WorkOperationMenulist!=null)
        //                                //WorkOperationMenulist.Where(w=>w.IdworkOperationByStage== eRMSOPModule.IdworkOperationByStage).ToList().ForEach(f => f.IsCurrentWorkOperation = true);










        //                            //} temp rupali mam
        //                        }
        //                    }
        //                }
        //                #endregion
        //            }
        //            var tempWorkOperationMenulist2 = ModuleMenulist.OrderBy(x => x.Position).ToList();
        //            ModuleMenulist.Clear();
        //            ModuleMenulist.AddRange(tempWorkOperationMenulist2);
        //            if (tempWorkOperationMenulist2 != null)
        //                tempWorkOperationMenulist2.Clear();
        //            //FillmoduleGridColumn();//[GEOS2-4830][gulab lakade][07 12 2023]
        //           // CustomSummarycalculation();
        //            FlagToDragDrop = true;  //[GEOS2-3909][Rupali Sarode][11-11-2022]

        //            e.Handled = true;
        //        }
        //        if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
        //    }
        //    catch (Exception ex)
        //    {
        //        if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
        //        GeosApplication.Instance.Logger.Log("Get an error in Method CompleteDropRecordModuleGrid()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
        //    }
        //}


        private void CompleteDropRecordModuleGrid(DropRecordEventArgs e)
        {
            ObservableCollection<ERMSOPModule> ModuleMenulistTemp = new ObservableCollection<ERMSOPModule>();
            try
            {
                Saveselecteditem = "module";  //[GEOS2-4108][Rupali Sarode][3-1-2022]
                string WOWithStatusMessage = string.Empty;  // [GEOS2-5020][Rupali Sarode][29-11-2023]
                if (!DXSplashScreen.IsActive)
                {
                    DXSplashScreen.Show(x =>
                    {
                        Window win = new Window()
                        {
                            ShowActivated = false,
                            WindowStyle = WindowStyle.None,
                            ResizeMode = ResizeMode.NoResize,
                            AllowsTransparency = true,
                            Background = new SolidColorBrush(Colors.Transparent),
                            ShowInTaskbar = false,
                            Topmost = true,
                            SizeToContent = SizeToContent.WidthAndHeight,
                            WindowStartupLocation = WindowStartupLocation.CenterScreen,
                        };
                        WindowFadeAnimationBehavior.SetEnableAnimation(win, true);
                        win.Topmost = false;
                        return win;
                    }, x =>
                    {
                        return new SplashScreenView() { DataContext = new SplashScreenViewModel() };
                    }, null, null);
                }

                if (SelectedItem is ProductTypes)
                {
                    int tempmodulepos = 1;//[GEOS2-5629][gulab lakade][10 07 2024]
                    if (ModuleMenulist.Count() > 0)
                    {
                        ModuleMenulistTemp = ModuleMenulist;
                        tempmodulepos = Convert.ToInt32(ModuleMenulist.Max(a => a.ModulePosition)) + 1;//[GEOS2-5629][gulab lakade][10 07 2024]
                    }
                    IsEnabledSaveButton = true;
                    SaveButtonVisibility = Visibility.Visible;
                    duplicateItemloop = 0;
                    if ((e.IsFromOutside) && typeof(WorkOperationByStages).IsAssignableFrom(e.GetRecordType()))
                    {
                        //ModuleMenulistTemp12 = new ObservableCollection<ERMSOPModule>();
                        WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                        var data = (RecordDragDropData)e.Data.GetData(typeof(RecordDragDropData));
                        List<WorkOperationByStages> found = new List<WorkOperationByStages>();
                        List<WorkOperationByStages> TempfoundAllrecords = new List<WorkOperationByStages>();
                        List<WorkOperationByStages> records = data.Records.OfType<WorkOperationByStages>().ToList();
                        operationMenulist = new ObservableCollection<WorkOperationByStages>();


                        int count = 0;
                        if (ModuleMenulistTemp == null)
                        {
                            ModuleMenulistTemp = new ObservableCollection<ERMSOPModule>();
                        }
                        if (records.Any(a => a.Name.Equals("All")))
                        {
                            //records.RemoveAll(r => r.Name.Equals("All"));
                            #region ALL
                            // found.AddRange(records);
                            found = new List<WorkOperationByStages>();
                            operationMenulist = new ObservableCollection<WorkOperationByStages>();
                            operationMenulist.AddRange(WorkOperationMenulist.Where(w => !w.Name.Equals("All")));
                            #endregion
                        }
                        else

                        //if (true)
                        {

                            //for (int i = 0; i < records.Count(); i++)
                            //{

                            //}
                            //foreach (WorkOperationByStages itemWorkOperationByStages in records)
                            for (int r = 0; r < records.Count(); r++)
                            {
                                if (!ModuleMenulistTemp.Any(a => a.Name.Equals(records[r].Name)))
                                {
                                    // if (records[r].IdStatus != 1536) [rdixit][GEOS2-3764][04.08.2022]
                                    // {
                                    records[r].IsCurrentWorkOperation = true;
                                    // ModuleMenulistTemp12.Add(JsonConvert.DeserializeObject<ERMSOPModule>(JsonConvert.SerializeObject(records[r])));
                                    operationMenulist.Add(records[r]);  // [GEOS2-3933] Rupali Sarode 
                                    // }


                                }

                                if (GetStages.Any(a => a != null && a.Code.Trim().Equals(records[r].Name.Trim())))
                                {
                                    found.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(records[r].KeyName)).ToList());
                                    int x = 0;
                                    Loop:
                                    x++;
                                    if (x < 4)
                                    {
                                        for (int i = 0; i < found.Count(); i++)
                                        {
                                            //TempfoundAllrecords.AddRange(WorkOperationMenulist.Where(s => s.IdworkOperationByStage == found[i].IdworkOperationByStage).ToList());
                                            TempfoundAllrecords.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(found[i].KeyName)).ToList());
                                        }
                                        for (int i = 0; i < TempfoundAllrecords.Count(); i++)
                                        {
                                            if (!found.Any(a => a != null && a.KeyName.Trim().Equals(TempfoundAllrecords[i].KeyName.Trim())))
                                                found.Add(TempfoundAllrecords[i]);
                                        }
                                        goto Loop;
                                    }


                                    //foreach (var itemfound in found)
                                    //{
                                    //    //TempfoundAllrecords.AddRange(WorkOperationMenulist.Where(s => s.Name.Trim().Equals(itemfound.Name.Trim())).ToList());
                                    //    TempfoundAllrecords.AddRange(WorkOperationMenulist.Where(s => s.IdworkOperationByStage==itemfound.IdworkOperationByStage).ToList());
                                    //    TempfoundAllrecords.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(itemfound.KeyName)).ToList());
                                    //}


                                    //foreach (var tempfoundAllrecords in TempfoundAllrecords)
                                    //{
                                    //    if (!found.Any(a => a != null && a.KeyName.Trim().Equals(tempfoundAllrecords.KeyName.Trim())))
                                    //        found.Add(tempfoundAllrecords);
                                    //}
                                }
                                else
                                {
                                    found.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(records[r].KeyName)).ToList());
                                    for (int i = 0; i < found.Count(); i++)
                                    {
                                        TempfoundAllrecords.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(found[i].KeyName)).ToList());
                                    }
                                    //foreach (var itemfound in found)
                                    //{
                                    //    TempfoundAllrecords.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(itemfound.KeyName)).ToList());
                                    //}
                                    for (int i = 0; i < TempfoundAllrecords.Count(); i++)
                                    {
                                        if (!found.Any(a => a != null && a.KeyName.Trim().Equals(TempfoundAllrecords[i].KeyName.Trim())))
                                            found.Add(TempfoundAllrecords[i]);
                                    }
                                    //foreach (var tempfoundAllrecords in TempfoundAllrecords)
                                    //{
                                    //    if (!found.Any(a => a != null && a.KeyName.Trim().Equals(tempfoundAllrecords.KeyName.Trim())))
                                    //        found.Add(tempfoundAllrecords);
                                    //}
                                    for (int i = 0; i < records.Where(a => a.IdworkOperationByStage > 0).Count(); i++)
                                    {
                                        if (!found.Any(a => a != null && a.KeyName.Trim().Equals(records[i].KeyName.Trim())))
                                            found.AddRange(WorkOperationMenulist.Where(s => s.IdworkOperationByStage == records[i].IdworkOperationByStage).ToList());
                                        if (found.Count() != 0)
                                        {
                                            count++;
                                        }
                                    }
                                    //foreach (WorkOperationByStages eRMModule in records.Where(a => a.IdworkOperationByStage > 0))
                                    //{
                                    //    //found.AddRange(WorkOperationMenulist.Where(s => s.IdworkOperationByStage == eRMModule.IdworkOperationByStage).ToList());
                                    //    if (!found.Any(a => a != null && a.KeyName.Trim().Equals(eRMModule.KeyName.Trim())))
                                    //        found.AddRange(WorkOperationMenulist.Where(s => s.IdworkOperationByStage==eRMModule.IdworkOperationByStage).ToList());
                                    //    //found.AddRange(WorkOperationMenulist.Where(s => s.Name.Trim().Equals(eRMModule.Name.Trim())).ToList());
                                    //    if (found.Count() != 0)
                                    //    {
                                    //        count++;
                                    //    }
                                    //}
                                }

                            }
                        }


                        if (count > 0)
                        {
                            for (int i = 0; i < found.Count(); i++)
                            {
                                if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(found[i].Name.Trim())))
                                {
                                    duplicateItemloop = 0;
                                    GetAllTreeList(found[i], WorkOperationMenulist);
                                }

                            }
                            //foreach (WorkOperationByStages item in found)
                            //{
                            //    if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(item.Name.Trim())))
                            //    {
                            //        GetAllTreeList(item, WorkOperationMenulist);
                            //    }

                            //}
                        }
                        else
                        {
                            //for (int i = 0; i < found.Count(); i++)
                            //{
                            //    GetAllTreeList(found[i], WorkOperationMenulist);
                            //}
                            if (!records.Any(a => a.Name.Equals("All")))
                                foreach (WorkOperationByStages item in found)
                                {
                                    duplicateItemloop = 0;
                                    GetAllTreeList(item, WorkOperationMenulist);
                                }
                        }
                        if (!records.Any(a => a.Name.Equals("All")))
                            if (operationMenulist != null)
                            {
                                var tempModuleMenulistTemp12 = operationMenulist.ToList();
                                for (int i = 0; i < tempModuleMenulistTemp12.Count; i++)
                                {
                                    if (GetStages.Any(a => a.Code.Equals(tempModuleMenulistTemp12[i].Name)))
                                    {
                                        List<WorkOperationByStages> childList = operationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(tempModuleMenulistTemp12[i].KeyName)).ToList();
                                        if (childList.Count == 0)
                                        {
                                            operationMenulist.Remove(tempModuleMenulistTemp12[i]);
                                        }
                                    }
                                }
                            }


                        #region [GEOS2-5020][Rupali Sarode][29-11-2023]
                        List<string> WOWithStatusList;

                        WOWithStatusList = new List<string>();
                        //string WOWithStatus = string.Empty;
                        string WOStausForChild = string.Empty;

                        List<WorkOperationByStages> WOChilds = operationMenulist.Where(i => i.ParentName != null && i.ParentName == records[0].KeyName).ToList();
                        if (WOChilds != null)
                        {
                            if (WOChilds.Count == 0) //If dropped item is child
                            {
                                if (records[0].Name != "All")
                                {
                                    int WOIdStatus = operationMenulist.Where(i => i.Name == records[0].Name).FirstOrDefault().IdStatus;
                                    if (WOIdStatus > 0 && WOIdStatus != 1535)
                                    {
                                        if (WOIdStatus == 1536) WOStausForChild = "in inactive status";
                                        if (WOIdStatus == 1537) WOStausForChild = "in draft status";

                                        if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                                        CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("AddEditSODDragOnlyActiveWO").ToString() + "\n" + "Work operation '" + records[0].Name + "' is " + WOStausForChild), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                                        //CustomMessageBox.Show(string.Format("Only allowed to drop active work operation. Can not drop below work operation as it is in inactive/draft status : " + "\n" + "Work operation '" + records[0].Name + "' is " + WOStausForChild), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                                        return;
                                    }
                                }

                            }
                        }
                        //else if (WOChilds.Count > 0)  //If dropped item is parent
                        //{
                        //    foreach (WorkOperationByStages item in operationMenulist)
                        //    {
                        //        if (item.IdStatus != 1535)
                        //        {
                        //            if (item.IdStatus == 1536)
                        //                WOWithStatusList.Add("Work operation '" + item.Name + "' is " + "in inactive status");
                        //            else if (item.IdStatus == 1537)
                        //                WOWithStatusList.Add("Work operation '" + item.Name + "' is " + "in draft status");
                        //        }
                        //    }

                        //    if (WOWithStatusList.Count > 0)
                        //    {
                        //        foreach (string WorkOperation in WOWithStatusList)
                        //        {
                        //            if (string.IsNullOrEmpty(WOWithStatus))
                        //                WOWithStatus = WorkOperation;
                        //            else
                        //                WOWithStatus = WOWithStatus + "\n" + WorkOperation;
                        //        }
                        //    }
                        //}

                        //if (!string.IsNullOrEmpty(WOWithStatus))
                        //{
                        //    if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                        //    CustomMessageBox.Show(string.Format("Only allowed to drop active work operation(s). Can not drop below work operation(s) as they are in inactive/draft status : " + "\n" +   WOWithStatus), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                        //}

                        #endregion [GEOS2-5020][Rupali Sarode][29-11-2023]

                        #region commonCode

                        if (AllSupplementsBoxMenu != null)
                        {
                            var listadoDuplicadas = from c in AllSupplementsBoxMenu
                                                    join c2 in AllSupplementsBoxMenu on c.Item2 equals c2.Item2
                                                    where c != c2
                                                    select c;

                            var ModuleSandardOperationTime = listadoDuplicadas.FirstOrDefault();
                            if (ModuleSandardOperationTime != null)
                            {
                                var templist = listadoDuplicadas.Where(a => a.Item2 == ModuleSandardOperationTime.Item2);
                                listadoDuplicadas = templist;
                            }
                            var tempSupplementsBoxMenu = AllSupplementsBoxMenu;

                            ColumnsModuleForSupplements = new ObservableCollection<TreeListColumn>();
                            ColumnsModuleForSupplements.Add(new TreeListColumn()
                            {
                                FieldName = "StandardSupplements",
                                Header = "Standard",
                                HeaderToolTip = "Standard",
                                AllowCellMerge = false,
                                Width = 150, //gulab lakade not show supplements name all
                                AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                Visible = true,
                                ReadOnly = false,
                                FixedWidth = false,

                            });

                            ColumnsModuleOperationTime = new ObservableCollection<TreeListColumn>();
                            ColumnsModuleOperationTime.Add(new TreeListColumn()
                            {
                                //FieldName = "StandardOperationTime",
                                FieldName = "UiTempStandardOperationTimeName",
                                Header = "Standard",
                                HeaderToolTip = "Standard",
                                AllowCellMerge = false,
                                Width = 150,//gulab lakade not show supplements name all
                                AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                Visible = true,
                                ReadOnly = false,
                                FixedWidth = false,



                            });

                            int Suplimentcount = 1;
                            var ColumnsModuleList = tempSupplementsBoxMenu.Where(p => !listadoDuplicadas.Any(p2 => p2.Item1 == p.Item1));
                            foreach (var item in ColumnsModuleList)
                            {
                                if (Suplimentcount == 5)
                                {
                                    ColumnsModuleForSupplements.Add(new TreeListColumn()
                                    {
                                        FieldName = "SupplementPlant" + Suplimentcount + "Value",
                                        Header = "Others",
                                        HeaderToolTip = "Others",
                                        AllowCellMerge = false,
                                        Width = 60,
                                        AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                        Visible = true,
                                        ReadOnly = false,
                                        FixedWidth = false
                                    });
                                    ColumnsModuleOperationTime.Add(new TreeListColumn()
                                    {
                                        FieldName = "UiTempoperationTimePlant" + Suplimentcount + "Value",
                                        Header = "Others",
                                        HeaderToolTip = "Others",
                                        AllowCellMerge = false,
                                        Width = 60,
                                        AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                        Visible = true,
                                        ReadOnly = false,
                                        FixedWidth = false
                                    });
                                    break;
                                }
                                if (Suplimentcount == 5)
                                {
                                    break;
                                }
                                ColumnsModuleForSupplements.Add(new TreeListColumn()
                                {
                                    FieldName = "SupplementPlant" + Suplimentcount + "Value",
                                    Header = item.Item1,
                                    HeaderToolTip = item.Item1,
                                    AllowCellMerge = false,
                                    Width = 100,
                                    AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                    Visible = true,
                                    ReadOnly = false,
                                    FixedWidth = false
                                });

                                ColumnsModuleOperationTime.Add(new TreeListColumn()
                                {
                                    //FieldName = "OperationTimePlant" + count + "Value",
                                    FieldName = "UiTempoperationTimePlant" + Suplimentcount + "Value",
                                    Header = item.Item1,
                                    HeaderToolTip = item.Item1,
                                    AllowCellMerge = false,
                                    Width = 60,
                                    AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                    Visible = true,
                                    ReadOnly = false,
                                    FixedWidth = false
                                });
                                Suplimentcount = Suplimentcount + 1;
                            }



                            bool FlagAddItemToList; //[GEOS2-5020][Rupali Sarode][29-11-2023]
                            foreach (WorkOperationByStages Module in WorkOperationMenulist)
                            {
                                FlagAddItemToList = true; //[GEOS2-5020][Rupali Sarode][29-11-2023]

                                // if (Module.IdStatus != 1536) [rdixit][GEOS2-3764][04.08.2022]
                                //if (LstStandardOperationsDictionaryModules.Any(a => a.IdWorkoperation == Convert.ToUInt64(Module.IdworkOperationByStage)))
                                if (operationMenulist.Any(a => a.IdworkOperationByStage == Convert.ToInt64(Module.IdworkOperationByStage))
                                       && operationMenulist.Any(a => a.IdStage == Module.IdStage)
                                    && operationMenulist.Any(a => a.Name.Trim().Equals(Module.Name.Trim()))
                                    )
                                {

                                    //[GEOS2-5020][Rupali Sarode][30-11-2023] 
                                    List<WorkOperationByStages> TempWOChilds = new List<WorkOperationByStages>();
                                    TempWOChilds = operationMenulist.Where(i => i.ParentName == Module.KeyName).ToList();

                                    if (GetStages.Any(a => a.Code.Equals(Module.Name)))
                                    //If it is stage and only one parent is selected which is inactive/draft, then do not add such a stage to list
                                    {
                                        List<WorkOperationByStages> childListInActiveDraft = operationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(Module.KeyName)).ToList();

                                        if (childListInActiveDraft.Count > 0)
                                        {
                                            foreach (WorkOperationByStages objChild in childListInActiveDraft)
                                            {
                                                List<WorkOperationByStages> GrandChildListInActiveDraft = new List<WorkOperationByStages>();
                                                GrandChildListInActiveDraft = operationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(objChild.KeyName)).ToList();
                                                if (GrandChildListInActiveDraft.Count == 0)
                                                { // If it is child and Active
                                                    if (objChild.IdStatus == 1535)
                                                    {
                                                        FlagAddItemToList = true;
                                                        break;
                                                    }
                                                    else
                                                    {
                                                        FlagAddItemToList = false;
                                                    }

                                                }
                                                else
                                                {
                                                    if (GrandChildListInActiveDraft.Count > 0)
                                                    {
                                                        if (GrandChildListInActiveDraft.Where(i => i.IdStatus == 1535).Count() > 0)
                                                        {
                                                            FlagAddItemToList = true;
                                                            break;
                                                        }
                                                        else
                                                        {
                                                            FlagAddItemToList = false;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    else if (TempWOChilds.Count() > 0 && (TempWOChilds.Count() == TempWOChilds.Where(i => i.IdStatus != 1535).Count()))
                                    // All children are in inactive/draft status
                                    {
                                        // do not add such parent to list in grid
                                        FlagAddItemToList = false;
                                    }
                                    //}
                                    else
                                    if (TempWOChilds.Count == 0 && Module.IdStatus != 1535)
                                    // If child is inactive/draft, do not add it.
                                    // If Parent is inactive/draft, add it only if it has inactive/draft child(s).
                                    {
                                        if (string.IsNullOrEmpty(WOWithStatusMessage))
                                        {
                                            if (Module.IdStatus == 1536)
                                                WOWithStatusMessage = "Work operation '" + Module.Name + "' is " + "in inactive status";
                                            else if (Module.IdStatus == 1537)
                                                WOWithStatusMessage = "Work operation '" + Module.Name + "' is " + "in draft status";
                                        }
                                        else
                                        {
                                            if (Module.IdStatus == 1536)
                                                WOWithStatusMessage = WOWithStatusMessage + "\n" + "Work operation '" + Module.Name + "' is " + "in inactive status";
                                            else if (Module.IdStatus == 1537)
                                                WOWithStatusMessage = WOWithStatusMessage + "\n" + "Work operation '" + Module.Name + "' is " + "in draft status";
                                        }
                                        FlagAddItemToList = false;

                                    }


                                    //    if (Module.IdStatus != 1536 && Module.IdStatus != 1537) //[GEOS2-5020][Rupali Sarode][30-11-2023]
                                    //{

                                    ERMSOPModule eRMSOPModule = new ERMSOPModule();
                                    eRMSOPModule.Name = Module.Name;
                                    eRMSOPModule.IdworkOperationByStage = Module.IdworkOperationByStage;
                                    eRMSOPModule.IdSequence = Module.IdSequence;
                                    eRMSOPModule.IdStatus = Module.IdStatus;
                                    eRMSOPModule.Status = Module.Status;
                                    eRMSOPModule.Code = Module.Name;
                                    eRMSOPModule.Parent = Module.Parent;
                                    eRMSOPModule.IdParent = Module.IdParent;
                                    eRMSOPModule.KeyName = Module.KeyName;
                                    eRMSOPModule.ParentName = Module.ParentName;
                                    eRMSOPModule.Position = Module.Position;
                                    if (ModuleMenulistTemp != null)
                                    {
                                      

                                      

                                        if (Module.ParentName == null)
                                        {
                                            eRMSOPModule.ModulePosition = Module.Position;
                                        }
                                        else
                                        {
                                            #region [gulab lakade][beta changes][01082024]
                                            if (ModuleMenulistTemp.Count() == 0)
                                            {
                                                if (Module.Position == 1)
                                                {
                                                    eRMSOPModule.ModulePosition = Module.Position;
                                                }
                                                else
                                                {
                                                    eRMSOPModule.ModulePosition = 1;
                                                }

                                            }
                                            else
                                            {
                                                #endregion
                                                var TempModule = ModuleMenulistTemp.Where(x => x.KeyName == Module.KeyName).FirstOrDefault();
                                                if (TempModule != null)
                                                {
                                                    eRMSOPModule.ModulePosition = TempModule.ModulePosition;
                                                }
                                                else
                                                {
                                                    if (ModuleMenulistTemp.Where(x => x.ParentName == Module.ParentName).FirstOrDefault() == null)
                                                    {
                                                        var maxpos = ModuleMenulistTemp.Max(a => a.ModulePosition);
                                                        eRMSOPModule.ModulePosition = maxpos + 1;
                                                    }
                                                    else
                                                    {
                                                        var maxpos = ModuleMenulistTemp.Where(x => x.ParentName == Module.ParentName).Max(a => a.ModulePosition);
                                                        eRMSOPModule.ModulePosition = maxpos + 1;
                                                    }

                                                }//[gulab lakade][beta changes][01082024]
                                            }

                                        }
                                   
                                    }

                                    eRMSOPModule.WorkOperation_count = Module.WorkOperation_count;
                                    eRMSOPModule.WorkOperation_count_original = Module.WorkOperation_count_original;
                                    eRMSOPModule.NameWithWorkOperationCount = Module.NameWithWorkOperationCount;
                                    eRMSOPModule.NormalTime = Module.NormalTime;

                                    ProductTypes tIdCPType = (ProductTypes)SelectedItem;  //[GEOS2-3909][Rupali Sarode][09-11-2022]
                                    eRMSOPModule.IdCpType = Convert.ToInt32(tIdCPType.IdCPType); //[GEOS2-3909][Rupali Sarode][09-11-2022]

                                    //[GEOS2-3933][Rupali Sarode][21/09/2022]
                                    eRMSOPModule.WORemarks = Module.WORemarks == null ? "" : Module.WORemarks.Trim();


                                    if (Module.NormalTime != null)
                                    {
                                        eRMSOPModule.NormalTime = Math.Round((double)Module.NormalTime, 2);
                                        #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                        eRMSOPModule.UITempNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(eRMSOPModule.NormalTime));
                                        #endregion
                                    }
                                    eRMSOPModule.ObservedTime = Module.ObservedTime;
                                    if (Module.ObservedTime != null)
                                    {
                                        eRMSOPModule.ObservedTime = Math.Round((double)Module.ObservedTime, 2);
                                        #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                        eRMSOPModule.UITempobservedTime = ConvertfloattoTimespan(Convert.ToString(eRMSOPModule.ObservedTime));
                                        #endregion
                                    }
                                    eRMSOPModule.Activity = Module.Activity;
                                    if (eRMSOPModule.Activity != 0)
                                        eRMSOPModule.Activity = Math.Round((double)Module.Activity, 2);
                                    if (eRMSOPModule.Activity == 0)
                                        eRMSOPModule.Activity = null;
                                    if (GetStages.Any(a => a != null && a.Code.Trim().Equals(Module.Name.Trim())))
                                    {
                                        Module.IsCurrentWorkOperation = true;
                                        eRMSOPModule.IsDeleteButton = false;
                                        eRMSOPModule.IsDeleteButtonVisibility = Visibility.Hidden;
                                        // eRMSOPModule.ObservedTimeIsReadOnly =true;
                                        //eRMSOPModule.IsReadOnly = true;
                                        eRMSOPModule.IsValidateOnTextInput = false;
                                    }
                                    else
                                    {
                                        Module.IsCurrentWorkOperation = true;
                                        //eRMSOPModule.ObservedTimeIsReadOnly = false;
                                        // eRMSOPModule.IsReadOnly = false;
                                        eRMSOPModule.IsValidateOnTextInput = true;
                                    }
                                    if (Module.IdStatus == 1536)
                                    {
                                        eRMSOPModule.IsInactiveWorkOperation = true;
                                        //eRMSOPModule.IsReadOnly = true;

                                    }
                                    else
                                    {
                                        //eRMSOPModule.IsReadOnly = false;
                                    }



                                    #region Temp  check only [GEOS2-4830][gulab lakade][07 12 2023]

                                    if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(eRMSOPModule.Name.Trim())))
                                    {
                                        if (ModuleSandardOperationTime != null)
                                            eRMSOPModule.StandardSupplements = (float?)ModuleSandardOperationTime.Item2;
                                        if (tempSupplementsBoxMenu.Any(p => !listadoDuplicadas.Any(p2 => p2.Item1 == p.Item1)))
                                        {
                                            eRMSOPModule.AllSupplementsBoxMenu = AllSupplementsBoxMenu;
                                            List<float?> lst = new List<float?>();

                                            var a = ColumnsModuleList.ToList();
                                            for (int i = 0; i < a.Count(); i++)
                                            {
                                                lst.Add((float?)a[i].Item2);
                                            }

                                            if (ColumnsModuleList.Count() == 1)
                                            {
                                                eRMSOPModule.SupplementPlant1Value = (float?)lst[0];
                                            }
                                            else if (ColumnsModuleList.Count() == 2)
                                            {
                                                eRMSOPModule.SupplementPlant1Value = (float?)lst[0];
                                                eRMSOPModule.SupplementPlant2Value = (float?)lst[1];
                                            }
                                            else if (ColumnsModuleList.Count() == 3)
                                            {
                                                eRMSOPModule.SupplementPlant1Value = (float?)lst[0];
                                                eRMSOPModule.SupplementPlant2Value = (float?)lst[1];
                                                eRMSOPModule.SupplementPlant3Value = (float?)lst[2];
                                            }
                                            else if (ColumnsModuleList.Count() == 4)
                                            {
                                                eRMSOPModule.SupplementPlant1Value = (float?)lst[0];
                                                eRMSOPModule.SupplementPlant2Value = (float?)lst[1];
                                                eRMSOPModule.SupplementPlant3Value = (float?)lst[2];
                                                eRMSOPModule.SupplementPlant4Value = (float?)lst[3];
                                            }
                                            else if (ColumnsModuleList.Count() == 5)
                                            {
                                                eRMSOPModule.SupplementPlant1Value = (float?)lst[0];
                                                eRMSOPModule.SupplementPlant2Value = (float?)lst[1];
                                                eRMSOPModule.SupplementPlant3Value = (float?)lst[2];
                                                eRMSOPModule.SupplementPlant4Value = (float?)lst[3];
                                                eRMSOPModule.SupplementPlant5Value = (float?)lst[4];
                                            }
                                            else
                                            {
                                                eRMSOPModule.SupplementPlant1Value = (float?)lst[0];
                                                eRMSOPModule.SupplementPlant2Value = (float?)lst[1];
                                                eRMSOPModule.SupplementPlant3Value = (float?)lst[2];
                                                eRMSOPModule.SupplementPlant4Value = (float?)lst[3];
                                                eRMSOPModule.SupplementPlant5Value = 0;
                                                if (ColumnsModuleList.Count() > 5)
                                                {
                                                    for (int q = 4; q < ColumnsModuleList.Count(); q++)
                                                    {
                                                        if (eRMSOPModule.SupplementPlant5Value == null)
                                                            eRMSOPModule.SupplementPlant5Value = 0;
                                                        eRMSOPModule.SupplementPlant5Value = (float?)(Convert.ToDouble(eRMSOPModule.SupplementPlant5Value)) + (float?)lst[q];  ///GEOS2-4046 Gulab Lakade
                                                    }
                                                }


                                            }

                                        }

                                        if (ModuleSandardOperationTime != null)
                                            eRMSOPModule.StandardOperationTime = (float?)Math.Round(Convert.ToDouble(eRMSOPModule.NormalTime * (1 + (ModuleSandardOperationTime.Item2 / 100))), 2);
                                        #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                        //TimeSpan temp= ConvertfloattoTimespan(Convert.ToString(eRMSOPModule.StandardOperationTime));
                                        //if(temp.Hours==0)
                                        //{
                                        //    eRMSOPModule.UiTempStandardOperationTimeName = ConvertfloattoTimespan(Convert.ToString(eRMSOPModule.StandardOperationTime)).ToString(@"mm\:ss"); ;
                                        //   //string t2= eRMSOPModule.UiTempStandardOperationTimeName.ToString(@"mm\:ss");
                                        //   //TimeSpan t1 = TimeSpan.FromMinutes(Convert.ToDouble(eRMSOPModule.StandardOperationTime));
                                        //}
                                        //else
                                        //{
                                        //    eRMSOPModule.UiTempStandardOperationTimeName = ConvertfloattoTimespan(Convert.ToString(eRMSOPModule.StandardOperationTime)).ToString(@"hh\:mm\:ss"); ;
                                        //}
                                        eRMSOPModule.UiTempStandardOperationTimeName = ConvertfloattoTimespan(Convert.ToString(eRMSOPModule.StandardOperationTime));

                                        #endregion
                                        eRMSOPModule.OperationTimePlant1Value = (float?)Math.Round(Convert.ToDouble(eRMSOPModule.NormalTime * (1 + (Convert.ToDouble(eRMSOPModule.SupplementPlant1Value) / 100))), 2);
                                        eRMSOPModule.OperationTimePlant2Value = (float?)Math.Round(Convert.ToDouble(eRMSOPModule.NormalTime * (1 + (Convert.ToDouble(eRMSOPModule.SupplementPlant2Value) / 100))), 2);
                                        eRMSOPModule.OperationTimePlant3Value = (float?)Math.Round(Convert.ToDouble(eRMSOPModule.NormalTime * (1 + (Convert.ToDouble(eRMSOPModule.SupplementPlant3Value) / 100))), 2);
                                        //if(!string.IsNullOrEmpty(Convert.ToString(eRMSOPModule.SupplementPlant4Value)))
                                        //{
                                        //    eRMSOPModule.OperationTimePlant4Value = (float?)Math.Round(Convert.ToDouble(eRMSOPModule.NormalTime * (1 + (eRMSOPModule.SupplementPlant4Value / 100))), 2);
                                        //}
                                        //else
                                        //{
                                        eRMSOPModule.OperationTimePlant4Value = (float?)Math.Round(Convert.ToDouble(eRMSOPModule.NormalTime * (1 + (Convert.ToDouble(eRMSOPModule.SupplementPlant4Value) / 100))), 2);
                                        //}

                                        eRMSOPModule.OperationTimePlant5Value = (float?)Math.Round(Convert.ToDouble(eRMSOPModule.NormalTime * (1 + (Convert.ToDouble(eRMSOPModule.SupplementPlant5Value) / 100))), 2);
                                        #region GEOS2-3954 gulab lakade Time format HH:mm:ss

                                        eRMSOPModule.UiTempoperationTimePlant1Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPModule.OperationTimePlant1Value));
                                        eRMSOPModule.UiTempoperationTimePlant2Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPModule.OperationTimePlant2Value));
                                        eRMSOPModule.UiTempoperationTimePlant3Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPModule.OperationTimePlant3Value));
                                        eRMSOPModule.UiTempoperationTimePlant4Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPModule.OperationTimePlant4Value));
                                        eRMSOPModule.UiTempoperationTimePlant5Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPModule.OperationTimePlant5Value));

                                        #endregion
                                    }


                                    #endregion



                                    try
                                    {
                                        //if (!ModuleMenulistTemp.Any(a => a.KeyName.Equals(Module.KeyName)))
                                        if (!ModuleMenulistTemp.Any(a => a.KeyName.Equals(Module.KeyName)) && FlagAddItemToList == true)  //  [GEOS2-5020][Rupali Sarode][29-11-2023]
                                        {

                                            ModuleMenulistTemp.Add(eRMSOPModule);
                                        }

                                    }
                                    catch (Exception ex)
                                    {

                                    }
                                    //if(WorkOperationMenulist!=null)
                                    //WorkOperationMenulist.Where(w=>w.IdworkOperationByStage== eRMSOPModule.IdworkOperationByStage).ToList().ForEach(f => f.IsCurrentWorkOperation = true);










                                    //} temp rupali mam
                                }
                            }
                        }
                        #endregion
                    }
                    //var tempWorkOperationMenulist2 = ModuleMenulistTemp.OrderBy(x => x.Position).ToList();
                    var tempWorkOperationMenulist2 = ModuleMenulistTemp.OrderBy(x => x.ModulePosition).ToList();//[GEOS2-5629][gulab lakade][10 07 2024]
                    ModuleMenulistTemp.Clear();
                    ModuleMenulistTemp.AddRange(tempWorkOperationMenulist2);

                    #region RND 
                    if (ModuleMenulistTemp != null)
                        foreach (ERMSOPModule itemERMSOPModule in ModuleMenulistTemp)
                        {
                            WorkOperationMenulist.Where(w => w.KeyName == itemERMSOPModule.KeyName).ToList().ForEach(f => f.IsCurrentWorkOperation = true);
                            //var listCount = ModuleMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(itemERMSOPModule.KeyName) && w.IsInactiveWorkOperation == false).ToList();//[rdixit][03.08.2022][GEOS2-3764]
                            //[GEOS2-5135][Rupali Sarode][18-12-2023]
                            var listCount = ModuleMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(itemERMSOPModule.KeyName)).ToList();//[rdixit][03.08.2022][GEOS2-3764]
                            if (listCount != null)
                                if (listCount.Count() > 0)
                                {
                                    itemERMSOPModule.ObservedTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.ObservedTime)), 2);
                                    itemERMSOPModule.NormalTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.NormalTime)), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    itemERMSOPModule.UITempobservedTime = ConvertfloattoTimespan(Convert.ToString(listCount.Sum(s => s.ObservedTime)));
                                    itemERMSOPModule.UITempNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(listCount.Sum(s => s.NormalTime)));
                                    #endregion
                                    itemERMSOPModule.IsReadOnly = true;
                                }
                        }

                    if (ModuleMenulistTemp != null)
                        foreach (ERMSOPModule itemERMSOPModule in ModuleMenulistTemp)
                        {

                            if (GetStages.Any(a => a.Code.Equals(itemERMSOPModule.Name)))
                            {
                                ObservableCollection<ERMSOPModule> ActivitySum = new ObservableCollection<ERMSOPModule>();
                                ObservableCollection<ERMSOPModule> TempActivitySum = new ObservableCollection<ERMSOPModule>();
                                int x = 1;
                                Loop:
                                x++;
                                if (x < 10)
                                {
                                    if (ActivitySum.Count == 0)
                                    {
                                        itemERMSOPModule.ObservedTime = 0;
                                        itemERMSOPModule.NormalTime = 0;
                                        #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                        itemERMSOPModule.UITempobservedTime = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.ObservedTime));
                                        itemERMSOPModule.UITempNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(itemERMSOPModule.NormalTime));
                                        #endregion
                                        //[GEOS2-5135][Rupali Sarode][18-12-2023]
                                        // var ActivitySumList = ModuleMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(itemERMSOPModule.KeyName) && w.IsInactiveWorkOperation == false).ToList();//[rdixit][03.08.2022][GEOS2-3764]
                                        var ActivitySumList = ModuleMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(itemERMSOPModule.KeyName)).ToList();
                                        ActivitySum.AddRange(ActivitySumList);
                                    }
                                    else
                                    {

                                    }


                                    goto Loop;
                                }

                                double? ObservedTime = 0;
                                double? NormalTime = 0;
                                float? StandardTime = 0;
                                // string OperationTimePlant1Name =null;
                                float? OperationTimePlant1Value = 0;
                                float? OperationTimePlant2Value = 0;
                                float? OperationTimePlant3Value = 0;
                                float? OperationTimePlant4Value = 0;
                                float? OperationTimePlant5Value = 0;
                                var tempDistinctList = ActivitySum.Select(xa => xa.KeyName).Distinct().ToList();
                                foreach (var item in tempDistinctList)
                                {
                                    if (itemERMSOPModule.ObservedTime == null)
                                        itemERMSOPModule.ObservedTime = 0;
                                    double? tempObservedTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.ObservedTime).FirstOrDefault();
                                    if (tempObservedTime != null)
                                    {
                                        ObservedTime = Math.Round(Convert.ToDouble(ObservedTime + tempObservedTime), 2);
                                        #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                        itemERMSOPModule.UITempobservedTime = ConvertfloattoTimespan(Convert.ToString(ObservedTime));
                                        #endregion
                                    }
                                    if (itemERMSOPModule.NormalTime == null)
                                        itemERMSOPModule.NormalTime = 0;
                                    double? tempNormalTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.NormalTime).FirstOrDefault();
                                    if (tempNormalTime != null)
                                    {
                                        NormalTime = Math.Round(Convert.ToDouble(NormalTime + tempNormalTime), 2);
                                        #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                        itemERMSOPModule.UITempNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(NormalTime));
                                        #endregion
                                    }

                                    //if (itemERMSOPModule.OperationTimePlant1Name != null)
                                    //    OperationTimePlant1Name = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.OperationTimePlant1Name).FirstOrDefault();

                                }
                                itemERMSOPModule.ObservedTime = ObservedTime;
                                itemERMSOPModule.NormalTime = NormalTime;
                                #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                itemERMSOPModule.UITempobservedTime = ConvertfloattoTimespan(Convert.ToString(ObservedTime));
                                itemERMSOPModule.UITempNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(itemERMSOPModule.NormalTime));
                                #endregion
                                //itemERMSOPModule.NormalTime = Math.Round(Convert.ToDouble(ObservedTime * itemERMSOPModule.Activity / 100), 2);
                                #region PlantValue


                                foreach (var item in tempDistinctList)
                                {
                                    if (itemERMSOPModule.StandardOperationTime == null)
                                        itemERMSOPModule.StandardOperationTime = 0;
                                    float? tempStandardTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.StandardOperationTime).FirstOrDefault();

                                    if (tempStandardTime != null)
                                    {
                                        StandardTime = StandardTime + tempStandardTime;
                                        #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                        itemERMSOPModule.UiTempStandardOperationTimeName = (ConvertfloattoTimespan(Convert.ToString(StandardTime)));
                                        #endregion
                                    }


                                    if (itemERMSOPModule.OperationTimePlant1Value == null)
                                    {
                                        itemERMSOPModule.OperationTimePlant1Value = 0;
                                        #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                        //itemERMSOPModule.UiTempoperationTimePlant1Value = Convert.ToString(ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.OperationTimePlant1Value)));
                                        //itemERMSOPModule.UiTempoperationTimePlant1Value = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.OperationTimePlant1Value)).ToString(@"mm\:ss");
                                        #endregion
                                    }

                                    float? tempOperationTimePlant1Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.OperationTimePlant1Value).FirstOrDefault();
                                    if (tempOperationTimePlant1Value != null)
                                    {
                                        OperationTimePlant1Value = OperationTimePlant1Value + tempOperationTimePlant1Value;
                                        #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                        //itemERMSOPModule.UiTempoperationTimePlant1Value = Convert.ToString(ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.OperationTimePlant1Value)));
                                        //itemERMSOPModule.UiTempoperationTimePlant1Value = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.OperationTimePlant1Value)).ToString(@"mm\:ss");
                                        #endregion
                                    }


                                    if (itemERMSOPModule.OperationTimePlant2Value == null)
                                    {
                                        itemERMSOPModule.OperationTimePlant2Value = 0;
                                        #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                        itemERMSOPModule.UiTempoperationTimePlant2Value = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.OperationTimePlant2Value));
                                        #endregion
                                    }

                                    float? tempOperationTimePlant2Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.OperationTimePlant2Value).FirstOrDefault();
                                    if (tempOperationTimePlant2Value != null)
                                    {
                                        OperationTimePlant2Value = OperationTimePlant2Value + tempOperationTimePlant2Value;
                                        #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                        itemERMSOPModule.UiTempoperationTimePlant2Value = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.OperationTimePlant2Value));
                                        #endregion
                                    }


                                    if (itemERMSOPModule.OperationTimePlant3Value == null)
                                    {
                                        itemERMSOPModule.OperationTimePlant3Value = 0;
                                        #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                        itemERMSOPModule.UiTempoperationTimePlant3Value = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.OperationTimePlant3Value));
                                        #endregion
                                    }

                                    float? tempOperationTimePlant3Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.OperationTimePlant3Value).FirstOrDefault();
                                    if (tempOperationTimePlant3Value != null)
                                    {
                                        OperationTimePlant3Value = OperationTimePlant3Value + tempOperationTimePlant3Value;
                                        #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                        itemERMSOPModule.UiTempoperationTimePlant3Value = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.OperationTimePlant3Value));
                                        #endregion
                                    }


                                    if (itemERMSOPModule.OperationTimePlant4Value == null)
                                    {
                                        itemERMSOPModule.OperationTimePlant4Value = 0;
                                        #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                        itemERMSOPModule.UiTempoperationTimePlant4Value = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.OperationTimePlant4Value));
                                        #endregion
                                    }

                                    float? tempOperationTimePlant4Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.OperationTimePlant4Value).FirstOrDefault();
                                    if (tempOperationTimePlant4Value != null)
                                    {
                                        OperationTimePlant4Value = OperationTimePlant4Value + tempOperationTimePlant4Value;
                                        #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                        itemERMSOPModule.UiTempoperationTimePlant4Value = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.OperationTimePlant4Value));
                                        #endregion
                                    }


                                    if (itemERMSOPModule.OperationTimePlant5Value == null)
                                        itemERMSOPModule.OperationTimePlant5Value = 0;
                                    float? tempOperationTimePlant5Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.OperationTimePlant5Value).FirstOrDefault();
                                    if (tempOperationTimePlant5Value != null)
                                        OperationTimePlant5Value = OperationTimePlant5Value + tempOperationTimePlant5Value;
                                }
                                #endregion
                                itemERMSOPModule.StandardOperationTime = (float?)Math.Round(Convert.ToDouble(StandardTime), 2);
                                #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                itemERMSOPModule.UiTempStandardOperationTimeName = (ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.StandardOperationTime)));
                                #endregion
                                itemERMSOPModule.OperationTimePlant1Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant1Value), 2);
                                itemERMSOPModule.OperationTimePlant2Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant2Value), 2);
                                itemERMSOPModule.OperationTimePlant3Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant3Value), 2);
                                itemERMSOPModule.OperationTimePlant4Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant4Value), 2);
                                itemERMSOPModule.OperationTimePlant5Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant5Value), 2);
                                #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                itemERMSOPModule.UiTempoperationTimePlant1Value = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.OperationTimePlant1Value));
                                //itemERMSOPModule.UiTempoperationTimePlant1Value = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.OperationTimePlant1Value)).ToString(@"mm\:ss");
                                itemERMSOPModule.UiTempoperationTimePlant2Value = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.OperationTimePlant2Value));
                                itemERMSOPModule.UiTempoperationTimePlant3Value = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.OperationTimePlant3Value));
                                itemERMSOPModule.UiTempoperationTimePlant4Value = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.OperationTimePlant4Value));
                                itemERMSOPModule.UiTempoperationTimePlant5Value = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.OperationTimePlant5Value));
                                #endregion

                            }
                        }
                    ModuleMenulist = ModuleMenulistTemp;
                    #endregion
                    //ModuleMenulist = ModuleMenulistTemp12;
                    if (tempWorkOperationMenulist2 != null)
                        tempWorkOperationMenulist2.Clear();
                    //FillmoduleGridColumn();//[GEOS2-4830][gulab lakade][07 12 2023]
                    // CustomSummarycalculation();
                    FlagToDragDrop = true;  //[GEOS2-3909][Rupali Sarode][11-11-2022]


                    e.Handled = true;

                    if (!string.IsNullOrEmpty(WOWithStatusMessage)) //  [GEOS2-5020][Rupali Sarode][29-11-2023]
                    {
                        if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                        CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("AddEditSODDragOnlyActiveWO").ToString() + "\n" + WOWithStatusMessage), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                    }

                }
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in Method CompleteDropRecordModuleGrid()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        private void CompleteRecordDragDropModuleGrid(CompleteRecordDragDropEventArgs e)
        {
            //if (IsModulesequence == true)
            //{
            //    e.Handled = false;
            //}
            //else
            //{
            //    e.Handled = true;
            //}
            e.Handled = true;
            IsModulesequence = false;
            IsEnabledSaveButton = true;
            // e.Handled = true;
            //FillmoduleGridColumn();
            int wocount = WorkOperationMenulist.ToList().Count();
        }

        private void CompleteDropRecordStructureGrid(DropRecordEventArgs e)
        {
            try
            {
                Saveselecteditem = "Structure";  //[GEOS2-4108][Rupali Sarode][3-1-2022]
                string WOWithStatusMessage = string.Empty;  // [GEOS2-5020][Rupali Sarode][29-11-2023]
                ObservableCollection<ERMSOPStructures> StructureMenulistTemp = new ObservableCollection<ERMSOPStructures>();//[GEOS2-4830][gulab lakade][07 12 2023]
                if (!DXSplashScreen.IsActive)
                {
                    DXSplashScreen.Show(x =>
                    {
                        Window win = new Window()
                        {
                            ShowActivated = false,
                            WindowStyle = WindowStyle.None,
                            ResizeMode = ResizeMode.NoResize,
                            AllowsTransparency = true,
                            Background = new SolidColorBrush(Colors.Transparent),
                            ShowInTaskbar = false,
                            Topmost = true,
                            SizeToContent = SizeToContent.WidthAndHeight,
                            WindowStartupLocation = WindowStartupLocation.CenterScreen,
                        };
                        WindowFadeAnimationBehavior.SetEnableAnimation(win, true);
                        win.Topmost = false;
                        return win;
                    }, x =>
                    {
                        return new SplashScreenView() { DataContext = new SplashScreenViewModel() };
                    }, null, null);
                }

                if (SelectedItemStructures is ERMStructures)
                {

                    IsEnabledSaveButton = true;
                    SaveButtonVisibility = Visibility.Visible;
                    duplicateItemloopStructure = 0;
                    if ((e.IsFromOutside) && typeof(WorkOperationByStages).IsAssignableFrom(e.GetRecordType()))
                    {
                        //WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                        var data = (RecordDragDropData)e.Data.GetData(typeof(RecordDragDropData));
                        List<WorkOperationByStages> found = new List<WorkOperationByStages>();
                        List<WorkOperationByStages> TempfoundAllrecords = new List<WorkOperationByStages>();
                        List<WorkOperationByStages> records = data.Records.OfType<WorkOperationByStages>().ToList();
                        operationStructureMenulist = new ObservableCollection<WorkOperationByStages>();
                        int count = 0;
                        if (StructureMenulist == null)
                        {
                            StructureMenulist = new ObservableCollection<ERMSOPStructures>();
                        }
                        if (StructureMenulist.Count > 0)
                        {
                            StructureMenulistTemp = StructureMenulist;
                        }
                        if (records.Any(a => a.Name.Equals("All")))
                        {
                            #region ALL
                            found = new List<WorkOperationByStages>();
                            operationStructureMenulist = new ObservableCollection<WorkOperationByStages>();
                            operationStructureMenulist.AddRange(WorkOperationMenulist.Where(w => !w.Name.Equals("All")));
                            #endregion
                        }
                        else
                        {

                            for (int r = 0; r < records.Count(); r++)
                            {
                                if (!StructureMenulistTemp.Any(a => a.Name.Equals(records[r].Name)))
                                {
                                    // if (records[r].IdStatus != 1536) [rdixit][GEOS2-3764][04.08.2022]
                                    //  {
                                    records[r].IsCurrentWorkOperation = true;
                                    //DetectionMenulist.Add(JsonConvert.DeserializeObject<ERMSOPDetection>(JsonConvert.SerializeObject(records[r])));
                                    if (!operationStructureMenulist.Any(a => a.KeyName.Equals(records[r].KeyName)))
                                        operationStructureMenulist.Add(records[r]);
                                    // }


                                }

                                if (GetStages.Any(a => a != null && a.Code.Trim().Equals(records[r].Name.Trim())))
                                {
                                    found.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(records[r].KeyName)).ToList());
                                    int x = 0;
                                    Loop:
                                    x++;
                                    if (x < 4)
                                    {
                                        for (int i = 0; i < found.Count(); i++)
                                        {
                                            TempfoundAllrecords.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(found[i].KeyName)).ToList());
                                        }
                                        for (int i = 0; i < TempfoundAllrecords.Count(); i++)
                                        {
                                            if (!found.Any(a => a != null && a.KeyName.Trim().Equals(TempfoundAllrecords[i].KeyName.Trim())))
                                                found.Add(TempfoundAllrecords[i]);
                                        }
                                        goto Loop;
                                    }

                                }
                                else
                                {
                                    found.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(records[r].KeyName)).ToList());
                                    for (int i = 0; i < found.Count(); i++)
                                    {
                                        TempfoundAllrecords.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(found[i].KeyName)).ToList());
                                    }
                                    for (int i = 0; i < TempfoundAllrecords.Count(); i++)
                                    {
                                        if (!found.Any(a => a != null && a.KeyName.Trim().Equals(TempfoundAllrecords[i].KeyName.Trim())))
                                            found.Add(TempfoundAllrecords[i]);
                                    }
                                    for (int i = 0; i < records.Where(a => a.IdworkOperationByStage > 0).Count(); i++)
                                    {
                                        if (!found.Any(a => a != null && a.KeyName.Trim().Equals(records[i].KeyName.Trim())))
                                            found.AddRange(WorkOperationMenulist.Where(s => s.IdworkOperationByStage == records[i].IdworkOperationByStage).ToList());
                                        if (found.Count() != 0)
                                        {
                                            count++;
                                        }
                                    }
                                }

                            }
                        }


                        if (count > 0)
                        {
                            for (int i = 0; i < found.Count(); i++)
                            {
                                if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(found[i].Name.Trim())))
                                {
                                    duplicateItemloopStructure = 0;
                                    GetAllTreeListStructure(found[i], WorkOperationMenulist);
                                }

                            }
                        }
                        else
                        {

                            if (!records.Any(a => a.Name.Equals("All")))
                                foreach (WorkOperationByStages item in found)
                                {
                                    duplicateItemloopStructure = 0;
                                    GetAllTreeListStructure(item, WorkOperationMenulist);
                                }
                        }
                        if (!records.Any(a => a.Name.Equals("All")))
                            if (operationStructureMenulist != null)
                            {
                                var tempModuleMenulist = operationStructureMenulist.ToList();
                                for (int i = 0; i < tempModuleMenulist.Count; i++)
                                {
                                    if (GetStages.Any(a => a.Code.Equals(tempModuleMenulist[i].Name)))
                                    {
                                        List<WorkOperationByStages> childList = operationStructureMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(tempModuleMenulist[i].KeyName)).ToList();
                                        if (childList.Count == 0)
                                        {
                                            operationStructureMenulist.Remove(tempModuleMenulist[i]);
                                        }
                                    }
                                }
                            }

                        #region [GEOS2-5020][Rupali Sarode][29-11-2023]
                        List<string> WOWithStatusList;

                        WOWithStatusList = new List<string>();
                        string WOStausForChild = string.Empty;

                        List<WorkOperationByStages> WOChilds = operationStructureMenulist.Where(i => i.ParentName != null && i.ParentName == records[0].KeyName).ToList();
                        if (WOChilds != null)
                        {
                            if (WOChilds.Count == 0) //If dropped item is child
                            {
                                if (records[0].Name != "All")
                                {
                                    int WOIdStatus = operationStructureMenulist.Where(i => i.Name == records[0].Name).FirstOrDefault().IdStatus;
                                    if (WOIdStatus > 0 && WOIdStatus != 1535)
                                    {
                                        if (WOIdStatus == 1536) WOStausForChild = "in inactive status";
                                        if (WOIdStatus == 1537) WOStausForChild = "in draft status";

                                        if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                                        CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("AddEditSODDragOnlyActiveWO").ToString() + "\n" + "Work operation '" + records[0].Name + "' is " + WOStausForChild), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                                        return;
                                    }
                                }

                            }
                        }

                        #endregion [GEOS2-5020][Rupali Sarode][29-11-2023]

                        #region commonCode

                        bool FlagAddItemToList; // [GEOS2-5020][Rupali Sarode][29-11-2023]

                        #region [GEOS2-4830][gulab lakade][07 12 2023]
                        if (AllSupplementsBoxMenu != null)
                        {
                            var listadoDuplicadas = from c in AllSupplementsBoxMenu
                                                    join c2 in AllSupplementsBoxMenu on c.Item2 equals c2.Item2
                                                    where c != c2
                                                    select c;

                            var StructureStandardOperationTime = listadoDuplicadas.FirstOrDefault();
                            if (StructureStandardOperationTime != null)
                            {
                                var templist = listadoDuplicadas.Where(a => a.Item2 == StructureStandardOperationTime.Item2);
                                listadoDuplicadas = templist;
                            }

                            var tempSupplementsBoxMenu = AllSupplementsBoxMenu;

                            ColumnsStructureForSupplements = new ObservableCollection<TreeListColumn>();
                            ColumnsStructureForSupplements.Add(new TreeListColumn()
                            {
                                FieldName = "StructureStandardSupplements",
                                Header = "Standard",
                                HeaderToolTip = "Standard",
                                AllowCellMerge = false,
                                Width = 150,    //gulab lakade not show Supplement proper
                                AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                Visible = true,
                                ReadOnly = false,
                                FixedWidth = false
                            });

                            ColumnsStructureOperationTime = new ObservableCollection<TreeListColumn>();
                            ColumnsStructureOperationTime.Add(new TreeListColumn()
                            {
                                FieldName = "UiTempStandardOperationTimeName",
                                Header = "Standard",
                                HeaderToolTip = "Standard",
                                AllowCellMerge = false,
                                Width = 150,    //gulab lakade not show StandardOperationTime proper
                                AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                Visible = true,
                                ReadOnly = false,
                                FixedWidth = false
                            });

                            int Supplimentcount = 1;
                            var ColumnsStructureList = tempSupplementsBoxMenu.Where(p => !listadoDuplicadas.Any(p2 => p2.Item1 == p.Item1));
                            foreach (var item in ColumnsStructureList)
                            {
                                if (Supplimentcount == 5)
                                {
                                    ColumnsStructureForSupplements.Add(new TreeListColumn()
                                    {
                                        FieldName = "StructureSupplementPlant" + Supplimentcount + "Value",
                                        Header = "Others",
                                        HeaderToolTip = "Others",
                                        AllowCellMerge = false,
                                        Width = 60,
                                        AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                        Visible = true,
                                        ReadOnly = false,
                                        FixedWidth = false
                                    });
                                    ColumnsStructureOperationTime.Add(new TreeListColumn()
                                    {
                                        FieldName = "UiTempoperationTimePlant" + Supplimentcount + "Value",
                                        Header = "Others",
                                        HeaderToolTip = "Others",
                                        AllowCellMerge = false,
                                        Width = 60,
                                        AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                        Visible = true,
                                        ReadOnly = false,
                                        FixedWidth = false
                                    });
                                    break;
                                }
                                if (Supplimentcount == 5)
                                {
                                    break;
                                }
                                ColumnsStructureForSupplements.Add(new TreeListColumn()
                                {
                                    FieldName = "StructureSupplementPlant" + Supplimentcount + "Value",
                                    Header = item.Item1,
                                    HeaderToolTip = item.Item1,
                                    AllowCellMerge = false,
                                    Width = 60,
                                    AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                    Visible = true,
                                    ReadOnly = false,
                                    FixedWidth = false
                                });

                                ColumnsStructureOperationTime.Add(new TreeListColumn()
                                {
                                    FieldName = "UiTempoperationTimePlant" + Supplimentcount + "Value",
                                    Header = item.Item1,
                                    HeaderToolTip = item.Item1,
                                    AllowCellMerge = false,
                                    Width = 60,
                                    AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                    Visible = true,
                                    ReadOnly = false,
                                    FixedWidth = false
                                });
                                Supplimentcount = Supplimentcount + 1;
                            }
                            #endregion
                            foreach (WorkOperationByStages Structure in WorkOperationMenulist)
                            {
                                FlagAddItemToList = true; //[GEOS2-5020][Rupali Sarode][29-11-2023]

                                // if (Detection.IdStatus != 1536) [rdixit][GEOS2-3764][04.08.2022]
                                if (operationStructureMenulist.Any(a => a.IdworkOperationByStage == Convert.ToInt64(Structure.IdworkOperationByStage))
                                       && operationStructureMenulist.Any(a => a.IdStage == Structure.IdStage)
                                    && operationStructureMenulist.Any(a => a.Name.Trim().Equals(Structure.Name.Trim()))
                                    )
                                {

                                    //[GEOS2-5020][Rupali Sarode][30-11-2023] 
                                    List<WorkOperationByStages> TempWOChilds = new List<WorkOperationByStages>();
                                    TempWOChilds = operationStructureMenulist.Where(i => i.ParentName == Structure.KeyName).ToList();

                                    if (GetStages.Any(a => a.Code.Equals(Structure.Name)))
                                    //If it is stage and only one parent is selected which is inactive/draft, then do not add such a stage to list
                                    {
                                        List<WorkOperationByStages> childListInActiveDraft = operationStructureMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(Structure.KeyName)).ToList();

                                        if (childListInActiveDraft.Count > 0)
                                        {
                                            foreach (WorkOperationByStages objChild in childListInActiveDraft)
                                            {
                                                List<WorkOperationByStages> GrandChildListInActiveDraft = new List<WorkOperationByStages>();
                                                GrandChildListInActiveDraft = operationStructureMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(objChild.KeyName)).ToList();
                                                if (GrandChildListInActiveDraft.Count == 0)
                                                { // If it is child and Active
                                                    if (objChild.IdStatus == 1535)
                                                    {
                                                        FlagAddItemToList = true;
                                                        break;
                                                    }
                                                    else
                                                    {
                                                        FlagAddItemToList = false;
                                                    }

                                                }
                                                else
                                                {
                                                    if (GrandChildListInActiveDraft.Count > 0)
                                                    {
                                                        if (GrandChildListInActiveDraft.Where(i => i.IdStatus == 1535).Count() > 0)
                                                        {
                                                            FlagAddItemToList = true;
                                                            break;
                                                        }
                                                        else
                                                        {
                                                            FlagAddItemToList = false;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    else if (TempWOChilds.Count() > 0 && (TempWOChilds.Count() == TempWOChilds.Where(i => i.IdStatus != 1535).Count()))
                                    // All children are in inactive/draft status
                                    {
                                        // do not add such parent to list in grid
                                        FlagAddItemToList = false;
                                    }
                                    //}
                                    else
                                    if (TempWOChilds.Count == 0 && Structure.IdStatus != 1535)
                                    // If child is inactive/draft, do not add it.
                                    // If Parent is inactive/draft, add it only if it has inactive/draft child(s).
                                    {
                                        if (string.IsNullOrEmpty(WOWithStatusMessage))
                                        {
                                            if (Structure.IdStatus == 1536)
                                                WOWithStatusMessage = "Work operation '" + Structure.Name + "' is " + "in inactive status";
                                            else if (Structure.IdStatus == 1537)
                                                WOWithStatusMessage = "Work operation '" + Structure.Name + "' is " + "in draft status";
                                        }
                                        else
                                        {
                                            if (Structure.IdStatus == 1536)
                                                WOWithStatusMessage = WOWithStatusMessage + "\n" + "Work operation '" + Structure.Name + "' is " + "in inactive status";
                                            else if (Structure.IdStatus == 1537)
                                                WOWithStatusMessage = WOWithStatusMessage + "\n" + "Work operation '" + Structure.Name + "' is " + "in draft status";
                                        }
                                        FlagAddItemToList = false;

                                    }

                                    //if (Structure.IdStatus != 1536 && Structure.IdStatus != 1537) //[GEOS2-5020][Rupali Sarode][30-11-2023]
                                    //{
                                    ERMSOPStructures eRMSOPStructures = new ERMSOPStructures();
                                    eRMSOPStructures.Name = Structure.Name;
                                    eRMSOPStructures.IdworkOperationByStage = Structure.IdworkOperationByStage;
                                    eRMSOPStructures.IdSequence = Structure.IdSequence;
                                    eRMSOPStructures.IdStatus = Structure.IdStatus;
                                    eRMSOPStructures.Status = Structure.Status;
                                    eRMSOPStructures.Code = Structure.Name;
                                    eRMSOPStructures.Parent = Structure.Parent;
                                    eRMSOPStructures.IdParent = Structure.IdParent;
                                    eRMSOPStructures.KeyName = Structure.KeyName;
                                    eRMSOPStructures.ParentName = Structure.ParentName;
                                    eRMSOPStructures.Position = Structure.Position;
                                    #region [GEOS2-5629][gulab lakade][16 07 2024]
                                    if (StructureMenulistTemp != null)
                                    {
                                        if (Structure.ParentName == null)
                                        {
                                            eRMSOPStructures.StructurePosition = Structure.Position;
                                        }
                                        else
                                        {
                                            #region [gulab lakade][beta changes][01082024]
                                            if (StructureMenulistTemp.Count() == 0)
                                            {
                                                if (Structure.Position == 1)
                                                {
                                                    eRMSOPStructures.StructurePosition = Structure.Position;
                                                }
                                                else
                                                {
                                                    eRMSOPStructures.StructurePosition = 1;
                                                }

                                            }
                                            else
                                            {
                                                #endregion
                                                var TempModule = StructureMenulistTemp.Where(x => x.KeyName == Structure.KeyName).FirstOrDefault();
                                                if (TempModule != null)
                                                {
                                                    eRMSOPStructures.StructurePosition = TempModule.StructurePosition;
                                                }
                                                else
                                                {
                                                    if (StructureMenulistTemp.Where(x => x.ParentName == Structure.ParentName).FirstOrDefault() == null)
                                                    {
                                                        var maxpos = StructureMenulistTemp.Max(a => a.StructurePosition);
                                                        eRMSOPStructures.StructurePosition = maxpos + 1;
                                                    }
                                                    else
                                                    {
                                                        var maxpos = StructureMenulistTemp.Where(x => x.ParentName == Structure.ParentName).Max(a => a.StructurePosition);
                                                        eRMSOPStructures.StructurePosition = maxpos + 1;
                                                    }

                                                }
                                            }
                                        }//[gulab lakade][beta changes][01082024]

                                    }
                                    #endregion
                                    eRMSOPStructures.WorkOperation_count = Structure.WorkOperation_count;
                                    eRMSOPStructures.WorkOperation_count_original = Structure.WorkOperation_count_original;
                                    eRMSOPStructures.NameWithWorkOperationCount = Structure.NameWithWorkOperationCount;
                                    eRMSOPStructures.StructureNormalTime = Structure.NormalTime;
                                    //[GEOS2-3933][Rupali Sarode][21/09/2022]
                                    eRMSOPStructures.WORemarks = Structure.WORemarks == null ? "" : Structure.WORemarks.Trim();

                                    ERMStructures tIdDetectionForStructure = (ERMStructures)SelectedItemStructures;  //[GEOS2-3926][Rupali Sarode][25-11-2022]
                                    eRMSOPStructures.IdCpType = Convert.ToInt32(tIdDetectionForStructure.IdCPType); //[GEOS2-3926][Rupali Sarode][25-11-2022]

                                    if (Structure.NormalTime != null)
                                    {
                                        eRMSOPStructures.StructureNormalTime = Math.Round((double)Structure.NormalTime, 2);
                                        #region [GEOS2-3954] [Rupali Sarode] Time format HH:mm:ss
                                        eRMSOPStructures.UITempStructureNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(eRMSOPStructures.StructureNormalTime));
                                        #endregion
                                    }

                                    eRMSOPStructures.StructureObservedTime = Structure.ObservedTime;
                                    if (Structure.ObservedTime != null)
                                    {
                                        eRMSOPStructures.StructureObservedTime = Math.Round((double)Structure.ObservedTime, 2);
                                        #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                        eRMSOPStructures.UITempStructureObservedTime = ConvertfloattoTimespan(Convert.ToString(eRMSOPStructures.StructureObservedTime));
                                        #endregion

                                    }
                                    eRMSOPStructures.StructureActivity = Structure.Activity;
                                    if (eRMSOPStructures.StructureActivity != 0)
                                        eRMSOPStructures.StructureActivity = Math.Round((double)Structure.Activity, 2);
                                    if (eRMSOPStructures.StructureActivity == 0)
                                        eRMSOPStructures.StructureActivity = null;
                                    if (GetStages.Any(a => a != null && a.Code.Trim().Equals(Structure.Name.Trim())))
                                    {
                                        Structure.IsCurrentWorkOperation = true;
                                        eRMSOPStructures.IsDeleteButton = false;
                                        eRMSOPStructures.IsDeleteButtonVisibility = Visibility.Hidden;
                                        eRMSOPStructures.IsValidateOnTextInput = false;
                                    }
                                    else
                                    {
                                        Structure.IsCurrentWorkOperation = true;

                                        eRMSOPStructures.IsValidateOnTextInput = true;
                                    }
                                    if (Structure.IdStatus == 1536)
                                    {
                                        eRMSOPStructures.IsInactiveWorkOperation = true;
                                    }
                                    #region [GEOS2-4830][gulab lakade][07 12 2023]
                                    if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(eRMSOPStructures.Name.Trim())))
                                    {
                                        if (StructureStandardOperationTime != null)
                                            eRMSOPStructures.StructureStandardSupplements = (float?)StructureStandardOperationTime.Item2;
                                        if (tempSupplementsBoxMenu.Any(p => !listadoDuplicadas.Any(p2 => p2.Item1 == p.Item1)))
                                        {
                                            eRMSOPStructures.AllSupplementsBoxMenu = AllSupplementsBoxMenu;
                                            List<float?> lst = new List<float?>();

                                            var a = ColumnsStructureList.ToList();
                                            for (int i = 0; i < a.Count(); i++)
                                            {
                                                lst.Add((float?)a[i].Item2);
                                            }

                                            if (ColumnsStructureList.Count() == 1)
                                            {
                                                eRMSOPStructures.StructureSupplementPlant1Value = (float?)lst[0];
                                            }
                                            else if (ColumnsStructureList.Count() == 2)
                                            {
                                                eRMSOPStructures.StructureSupplementPlant1Value = (float?)lst[0];
                                                eRMSOPStructures.StructureSupplementPlant2Value = (float?)lst[1];
                                            }
                                            else if (ColumnsStructureList.Count() == 3)
                                            {
                                                eRMSOPStructures.StructureSupplementPlant1Value = (float?)lst[0];
                                                eRMSOPStructures.StructureSupplementPlant2Value = (float?)lst[1];
                                                eRMSOPStructures.StructureSupplementPlant3Value = (float?)lst[2];
                                            }
                                            else if (ColumnsStructureList.Count() == 4)
                                            {
                                                eRMSOPStructures.StructureSupplementPlant1Value = (float?)lst[0];
                                                eRMSOPStructures.StructureSupplementPlant2Value = (float?)lst[1];
                                                eRMSOPStructures.StructureSupplementPlant3Value = (float?)lst[2];
                                                eRMSOPStructures.StructureSupplementPlant4Value = (float?)lst[3];
                                            }
                                            else if (ColumnsStructureList.Count() == 5)
                                            {
                                                eRMSOPStructures.StructureSupplementPlant1Value = (float?)lst[0];
                                                eRMSOPStructures.StructureSupplementPlant2Value = (float?)lst[1];
                                                eRMSOPStructures.StructureSupplementPlant3Value = (float?)lst[2];
                                                eRMSOPStructures.StructureSupplementPlant4Value = (float?)lst[3];
                                                eRMSOPStructures.StructureSupplementPlant5Value = (float?)lst[4];
                                            }
                                            else
                                            {
                                                eRMSOPStructures.StructureSupplementPlant1Value = (float?)lst[0];
                                                eRMSOPStructures.StructureSupplementPlant2Value = (float?)lst[1];
                                                eRMSOPStructures.StructureSupplementPlant3Value = (float?)lst[2];
                                                eRMSOPStructures.StructureSupplementPlant4Value = (float?)lst[3];
                                                eRMSOPStructures.StructureSupplementPlant5Value = 0;
                                                if (ColumnsStructureList.Count() > 5)
                                                {
                                                    for (int q = 4; q < ColumnsStructureList.Count(); q++)
                                                    {
                                                        if (eRMSOPStructures.StructureSupplementPlant5Value == null)
                                                            eRMSOPStructures.StructureSupplementPlant5Value = 0;
                                                        eRMSOPStructures.StructureSupplementPlant5Value = eRMSOPStructures.StructureSupplementPlant5Value + (float?)lst[q];
                                                    }
                                                }


                                            }

                                        }
                                        #region GEOS2-4046 Gulab Lakade
                                        if (StructureStandardOperationTime != null)
                                            eRMSOPStructures.StructureStandardOperationTime = (float?)Math.Round(Convert.ToDouble(eRMSOPStructures.StructureNormalTime * (1 + (Convert.ToDouble(StructureStandardOperationTime.Item2) / 100))), 2);

                                        eRMSOPStructures.StructureOperationTimePlant1Value = (float?)Math.Round(Convert.ToDouble(eRMSOPStructures.StructureNormalTime * (1 + (Convert.ToDouble(eRMSOPStructures.StructureSupplementPlant1Value) / 100))), 2);
                                        eRMSOPStructures.StructureOperationTimePlant2Value = (float?)Math.Round(Convert.ToDouble(eRMSOPStructures.StructureNormalTime * (1 + (Convert.ToDouble(eRMSOPStructures.StructureSupplementPlant2Value) / 100))), 2);
                                        eRMSOPStructures.StructureOperationTimePlant3Value = (float?)Math.Round(Convert.ToDouble(eRMSOPStructures.StructureNormalTime * (1 + (Convert.ToDouble(eRMSOPStructures.StructureSupplementPlant3Value) / 100))), 2);
                                        eRMSOPStructures.StructureOperationTimePlant4Value = (float?)Math.Round(Convert.ToDouble(eRMSOPStructures.StructureNormalTime * (1 + (Convert.ToDouble(eRMSOPStructures.StructureSupplementPlant4Value) / 100))), 2);
                                        eRMSOPStructures.StructureOperationTimePlant5Value = (float?)Math.Round(Convert.ToDouble(eRMSOPStructures.StructureNormalTime * (1 + (Convert.ToDouble(eRMSOPStructures.StructureSupplementPlant5Value) / 100))), 2);
                                        #endregion
                                        #region GEOS2-3954 Show the WorkOperations and SOD Time in the format: MM:SS or HH:MM:SS
                                        try
                                        {
                                            eRMSOPStructures.UiTempStandardOperationTimeName = ConvertfloattoTimespan(Convert.ToString(eRMSOPStructures.StructureStandardOperationTime));
                                            eRMSOPStructures.UiTempoperationTimePlant1Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPStructures.StructureOperationTimePlant1Value));
                                            eRMSOPStructures.UiTempoperationTimePlant2Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPStructures.StructureOperationTimePlant2Value));
                                            eRMSOPStructures.UiTempoperationTimePlant3Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPStructures.StructureOperationTimePlant3Value));
                                            eRMSOPStructures.UiTempoperationTimePlant4Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPStructures.StructureOperationTimePlant4Value));
                                            eRMSOPStructures.UiTempoperationTimePlant5Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPStructures.StructureOperationTimePlant5Value));
                                        }
                                        catch (Exception ex)
                                        {
                                            GeosApplication.Instance.Logger.Log(string.Format("Error in Method CompleteDropRecordStructureGrid() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                        }
                                        #endregion
                                    }
                                    #endregion
                                    try
                                    {
                                        //if (!StructureMenulistTemp.Any(a => a.KeyName.Equals(Structure.KeyName)))
                                        if (!StructureMenulistTemp.Any(a => a.KeyName.Equals(Structure.KeyName)) && FlagAddItemToList == true)  //  [GEOS2-5020][Rupali Sarode][29-11-2023]
                                        {
                                            StructureMenulistTemp.Add(eRMSOPStructures);
                                        }

                                    }
                                    catch (Exception ex)
                                    {

                                    }
                                    //}
                                }
                            }
                        }//[GEOS2-4830][gulab lakade][07 12 2023]
                        #endregion
                    }
                    //List<ERMSOPStructures> tempWorkOperationStructureMenulist = StructureMenulistTemp.OrderBy(x => x.Position).ToList();
                    List<ERMSOPStructures> tempWorkOperationStructureMenulist = StructureMenulistTemp.OrderBy(x => x.StructurePosition).ToList();
                    StructureMenulistTemp.Clear();
                    StructureMenulistTemp.AddRange(tempWorkOperationStructureMenulist);
                    tempWorkOperationStructureMenulist.Clear();
                    #region RND
                    #region calculation
                    #region [GEOS2-4830][gulab lakade][07 12 2023]
                    //if (StructureMenulistTemp != null)
                    //    //foreach (ERMSOPDetection itemERMSOPDetection in DetectionMenulist)
                    //    for (int d = 0; d < StructureMenulistTemp.Count(); d++)
                    //    {
                    //        WorkOperationMenulist.Where(w => w.KeyName == StructureMenulistTemp[d].KeyName).ToList().ForEach(f => f.IsCurrentWorkOperation = true);
                    //        var listCount = StructureMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(StructureMenulistTemp[d].KeyName) && w.IsInactiveWorkOperation == false).ToList();//[rdixit][03.08.2022][GEOS2-3764]
                    //        if (listCount != null)
                    //            if (listCount.Count() > 0)
                    //            {
                    //                StructureMenulistTemp[d].StructureObservedTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.StructureObservedTime)), 2);
                    //                StructureMenulistTemp[d].StructureNormalTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.StructureNormalTime)), 2);
                    //                #region [GEOS2-3954] [Rupali Sarode] Time format HH:mm:ss
                    //                StructureMenulistTemp[d].UITempStructureObservedTime = ConvertfloattoTimespan(Convert.ToString(Convert.ToDouble(listCount.Sum(s => s.StructureObservedTime))));
                    //                StructureMenulistTemp[d].UITempStructureNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(Convert.ToDouble(listCount.Sum(s => s.StructureNormalTime))));
                    //                #endregion

                    //                StructureMenulistTemp[d].IsReadOnly = true;
                    //            }
                    //    }
                    #endregion

                    if (StructureMenulistTemp != null)
                        for (int d = 0; d < StructureMenulistTemp.Count(); d++)
                        {
                            WorkOperationMenulist.Where(w => w.KeyName == StructureMenulistTemp[d].KeyName).ToList().ForEach(f => f.IsCurrentWorkOperation = true);
                            //[GEOS2-5135][Rupali Sarode][18-12-2023]
                            var listCount = StructureMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(StructureMenulistTemp[d].KeyName)).ToList();//[rdixit][03.08.2022][GEOS2-3764]
                            // var listCount = StructureMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(StructureMenulistTemp[d].KeyName) && w.IsInactiveWorkOperation == false).ToList();//[rdixit][03.08.2022][GEOS2-3764]
                            if (listCount != null)
                                if (listCount.Count() > 0)
                                {
                                    StructureMenulistTemp[d].StructureObservedTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.StructureObservedTime)), 2);
                                    StructureMenulistTemp[d].StructureNormalTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.StructureNormalTime)), 2);

                                    #region [GEOS2-3954] [Rupali Sarode] Time format HH:mm:ss
                                    StructureMenulistTemp[d].UITempStructureObservedTime = ConvertfloattoTimespan(Convert.ToString(listCount.Sum(s => s.StructureObservedTime)));
                                    StructureMenulistTemp[d].UITempStructureNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(listCount.Sum(s => s.StructureNormalTime)));
                                    #endregion

                                    StructureMenulistTemp[d].IsReadOnly = true;
                                }
                        }

                    if (StructureMenulistTemp != null)
                        //foreach (ERMSOPDetection itemERMSOPDetection in DetectionMenulist)
                        for (int d = 0; d < StructureMenulistTemp.Count(); d++)
                        {
                            if (GetStages.Any(a => a.Code.Equals(StructureMenulistTemp[d].Name)))
                            {
                                ObservableCollection<ERMSOPStructures> ActivitySum = new ObservableCollection<ERMSOPStructures>();
                                ObservableCollection<ERMSOPStructures> TempActivitySum = new ObservableCollection<ERMSOPStructures>();
                                int x = 1;
                                Loop:
                                x++;
                                if (x < 10)
                                {
                                    if (ActivitySum.Count == 0)
                                    {
                                        StructureMenulistTemp[d].StructureObservedTime = 0;
                                        StructureMenulistTemp[d].StructureNormalTime = 0;
                                        #region [GEOS2-3954] [Rupali Sarode] Time format HH:mm:ss
                                        StructureMenulistTemp[d].UITempStructureObservedTime = ConvertfloattoTimespan(Convert.ToString(StructureMenulistTemp[d].StructureObservedTime));
                                        StructureMenulistTemp[d].UITempStructureNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(StructureMenulistTemp[d].StructureNormalTime));
                                        #endregion
                                        //[GEOS2-5135][Rupali Sarode][18-12-2023]
                                        // var ActivitySumList = StructureMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(StructureMenulistTemp[d].KeyName) && w.IsInactiveWorkOperation == false).ToList();//[rdixit][03.08.2022][GEOS2-3764]
                                        var ActivitySumList = StructureMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(StructureMenulistTemp[d].KeyName)).ToList();
                                        ActivitySum.AddRange(ActivitySumList);
                                    }
                                    else
                                    {
                                        #region Commented Code
                                        //foreach (var item in ActivitySum)
                                        //{
                                        //    var ActivitySumList = DetectionMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(item.KeyName)).ToList();
                                        //    if (ActivitySumList != null && ActivitySumList.Count > 0)
                                        //    {

                                        //        foreach (var itemActivity in ActivitySumList)
                                        //        {
                                        //            if (!ActivitySum.Any(ac => ac.KeyName.Equals(itemActivity.KeyName)))
                                        //            {
                                        //                TempActivitySum.Add(itemActivity);
                                        //            }

                                        //        }

                                        //    }

                                        //}
                                        //ActivitySum.AddRange(TempActivitySum);
                                        #endregion
                                    }


                                    goto Loop;
                                }

                                double? ObservedTime = 0;
                                double? NormalTime = 0;
                                float? StandardTime = 0;
                                float? OperationTimePlant1Value = 0;
                                float? OperationTimePlant2Value = 0;
                                float? OperationTimePlant3Value = 0;
                                float? OperationTimePlant4Value = 0;
                                float? OperationTimePlant5Value = 0;
                                var tempDistinctList = ActivitySum.Select(xa => xa.KeyName).Distinct().ToList();
                                foreach (var item in tempDistinctList)
                                {
                                    if (StructureMenulistTemp[d].StructureObservedTime == null)
                                        StructureMenulistTemp[d].StructureObservedTime = 0;
                                    double? tempObservedTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.StructureObservedTime).FirstOrDefault();
                                    if (tempObservedTime != null)
                                    {
                                        ObservedTime = Math.Round(Convert.ToDouble(ObservedTime + tempObservedTime), 2);
                                        #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                        StructureMenulistTemp[d].UITempStructureObservedTime = ConvertfloattoTimespan(Convert.ToString(ObservedTime));
                                        #endregion
                                    }
                                    if (StructureMenulistTemp[d].StructureNormalTime == null)
                                        StructureMenulistTemp[d].StructureNormalTime = 0;
                                    double? tempNormalTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.StructureNormalTime).FirstOrDefault();
                                    if (tempNormalTime != null)
                                    {
                                        NormalTime = Math.Round(Convert.ToDouble(NormalTime + tempNormalTime), 2);
                                        #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                        StructureMenulistTemp[d].UITempStructureNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(NormalTime));
                                        #endregion
                                    }
                                }
                                StructureMenulistTemp[d].StructureObservedTime = ObservedTime;
                                StructureMenulistTemp[d].StructureNormalTime = NormalTime;
                                #region [GEOS2-3954] [Rupali Sarode] Time format HH:mm:ss
                                StructureMenulistTemp[d].UITempStructureObservedTime = ConvertfloattoTimespan(Convert.ToString(ObservedTime));
                                StructureMenulistTemp[d].UITempStructureNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(StructureMenulistTemp[d].StructureNormalTime));
                                #endregion

                                //DetectionMenulist[d].DetectionNormalTime = Math.Round(Convert.ToDouble(ObservedTime * DetectionMenulist[d].DetectionActivity / 100), 2);
                                #region PlantValue


                                foreach (var item in tempDistinctList)
                                {
                                    if (StructureMenulistTemp[d].StructureStandardOperationTime == null)
                                        StructureMenulistTemp[d].StructureStandardOperationTime = 0;
                                    float? tempStandardTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.StructureStandardOperationTime).FirstOrDefault();
                                    if (tempStandardTime != null)
                                        StandardTime = StandardTime + tempStandardTime;

                                    if (StructureMenulistTemp[d].StructureOperationTimePlant1Value == null)
                                        StructureMenulistTemp[d].StructureOperationTimePlant1Value = 0;
                                    float? tempOperationTimePlant1Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.StructureOperationTimePlant1Value).FirstOrDefault();
                                    if (tempOperationTimePlant1Value != null)
                                        OperationTimePlant1Value = OperationTimePlant1Value + tempOperationTimePlant1Value;

                                    if (StructureMenulistTemp[d].StructureOperationTimePlant2Value == null)
                                        StructureMenulistTemp[d].StructureOperationTimePlant2Value = 0;
                                    float? tempOperationTimePlant2Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.StructureOperationTimePlant2Value).FirstOrDefault();
                                    if (tempOperationTimePlant2Value != null)
                                        OperationTimePlant2Value = OperationTimePlant2Value + tempOperationTimePlant2Value;

                                    if (StructureMenulistTemp[d].StructureOperationTimePlant3Value == null)
                                        StructureMenulistTemp[d].StructureOperationTimePlant3Value = 0;
                                    float? tempOperationTimePlant3Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.StructureOperationTimePlant3Value).FirstOrDefault();
                                    if (tempOperationTimePlant3Value != null)
                                        OperationTimePlant3Value = OperationTimePlant3Value + tempOperationTimePlant3Value;

                                    if (StructureMenulistTemp[d].StructureOperationTimePlant4Value == null)
                                        StructureMenulistTemp[d].StructureOperationTimePlant4Value = 0;
                                    float? tempOperationTimePlant4Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.StructureOperationTimePlant4Value).FirstOrDefault();
                                    if (tempOperationTimePlant4Value != null)
                                        OperationTimePlant4Value = OperationTimePlant4Value + tempOperationTimePlant4Value;

                                    if (StructureMenulistTemp[d].StructureOperationTimePlant5Value == null)
                                        StructureMenulistTemp[d].StructureOperationTimePlant5Value = 0;
                                    float? tempOperationTimePlant5Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.StructureOperationTimePlant5Value).FirstOrDefault();
                                    if (tempOperationTimePlant5Value != null)
                                        OperationTimePlant5Value = OperationTimePlant5Value + tempOperationTimePlant5Value;
                                }
                                #endregion
                                StructureMenulistTemp[d].StructureStandardOperationTime = (float?)Math.Round(Convert.ToDouble(StandardTime), 2);
                                StructureMenulistTemp[d].StructureOperationTimePlant1Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant1Value), 2);
                                StructureMenulistTemp[d].StructureOperationTimePlant2Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant2Value), 2);
                                StructureMenulistTemp[d].StructureOperationTimePlant3Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant3Value), 2);
                                StructureMenulistTemp[d].StructureOperationTimePlant4Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant4Value), 2);
                                StructureMenulistTemp[d].StructureOperationTimePlant5Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant5Value), 2);
                                #region GEOS2-3954 Show the WorkOperations and SOD Time in the format: MM:SS or HH:MM:SS
                                try
                                {
                                    StructureMenulistTemp[d].UiTempStandardOperationTimeName = ConvertfloattoTimespan(Convert.ToString(StructureMenulistTemp[d].StructureStandardOperationTime));
                                    StructureMenulistTemp[d].UiTempoperationTimePlant1Value = ConvertfloattoTimespan(Convert.ToString(StructureMenulistTemp[d].StructureOperationTimePlant1Value));
                                    StructureMenulistTemp[d].UiTempoperationTimePlant2Value = ConvertfloattoTimespan(Convert.ToString(StructureMenulistTemp[d].StructureOperationTimePlant2Value));
                                    StructureMenulistTemp[d].UiTempoperationTimePlant3Value = ConvertfloattoTimespan(Convert.ToString(StructureMenulistTemp[d].StructureOperationTimePlant3Value));
                                    StructureMenulistTemp[d].UiTempoperationTimePlant4Value = ConvertfloattoTimespan(Convert.ToString(StructureMenulistTemp[d].StructureOperationTimePlant4Value));
                                    StructureMenulistTemp[d].UiTempoperationTimePlant5Value = ConvertfloattoTimespan(Convert.ToString(StructureMenulistTemp[d].StructureOperationTimePlant5Value));
                                }
                                catch (Exception ex)
                                {
                                    GeosApplication.Instance.Logger.Log(string.Format("Error in Method StructureCustomSummarycalculation() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                }
                                #endregion
                            }
                        }
                    #endregion
                    StructureMenulist = new ObservableCollection<ERMSOPStructures>();
                    StructureMenulist = StructureMenulistTemp;
                    #endregion
                    //FillStructureGridColumn();//[GEOS2-4830][gulab lakade][07 12 2023]
                    //structureCustomSummarycalculation();//[GEOS2-4830][gulab lakade][07 12 2023]
                    FlagToDragDrop = true; //[GEOS2-3926][Rupali Sarode][26-11-2022]
                    e.Handled = true;

                    if (!string.IsNullOrEmpty(WOWithStatusMessage)) //  [GEOS2-5020][Rupali Sarode][29-11-2023]
                    {
                        if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                        CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("AddEditSODDragOnlyActiveWO").ToString() + "\n" + WOWithStatusMessage), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                    }
                }
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in Method CompleteDropRecordStructureGrid()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }


        List<StandardOperationsDictionaryModules> standardOperationsDictionaryModulesDeleteList = new List<StandardOperationsDictionaryModules>();
        List<ERMSOPModule> ERMSOPModuleDeleteList = new List<ERMSOPModule>();
        List<ERMSOPModule> ERMSOPModuleDeleteParentList = new List<ERMSOPModule>();
        private void ERMSOPModuleDeleteAction(List<ERMSOPModule> deletelist)
        {
            try
            {
                foreach (ERMSOPModule item in deletelist)
                {
                    if (!ERMSOPModuleDeleteList.Any(a => a.KeyName.Equals(item.KeyName)))
                    {
                        ERMSOPModuleDeleteList.Add(item);
                        WorkOperationMenulist.Where(w => w.IdworkOperationByStage == item.IdworkOperationByStage).ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                    }

                    List<ERMSOPModule> isitemExist = ModuleMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(item.KeyName)).ToList();
                    if (deletelist != null || deletelist.Count() > 0)
                    {
                        ERMSOPModuleDeleteAction(isitemExist);
                    }
                }
            }
            catch (Exception ex)
            {
            }
        }
        private void ERMSOPModuleDeleteParentAction(List<ERMSOPModule> deleteParentlist)
        {
            try
            {
                foreach (ERMSOPModule item in deleteParentlist)
                {
                    if (!ERMSOPModuleDeleteParentList.Any(a => a.KeyName.Equals(item.KeyName)))
                    {
                        ERMSOPModuleDeleteParentList.Add(item);
                        ModuleMenulist.Remove(item);
                        WorkOperationMenulist.Where(w => w.IdworkOperationByStage == item.IdworkOperationByStage).ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                    }

                    //List<ERMSOPModule> isitemExist = ModuleMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(item.KeyName)).ToList();
                    //if (deleteParentlist != null || deleteParentlist.Count() > 0)
                    //{
                    //    ERMSOPModuleDeleteParentAction(isitemExist);
                    //}
                    List<ERMSOPModule> isitemExist = ModuleMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(item.ParentName)).ToList();
                    if (isitemExist.Count == 0)
                    {
                        List<ERMSOPModule> parentlist = ModuleMenulist.Where(w => w.KeyName.Equals(item.ParentName)).ToList();
                        ERMSOPModuleDeleteParentAction(parentlist);
                    }

                }
            }
            catch (Exception ex)
            {
            }
        }
        private void DeleteModuleTreeListControlCommandAction(object obj)
        {
            try
            {
                ERMSOPModule MainRow = ((ERMSOPModule)obj);
                GeosApplication.Instance.Logger.Log("Method DeleteModuleTreeListControlCommandAction()...", category: Category.Info, priority: Priority.Low);
                #region Commented Code
                //List<StandardOperationsDictionaryDetection> ValidateLstStandardOperationsDictionaryDetection = new List<StandardOperationsDictionaryDetection>();
                ////[rdixit][03.08.2022][GEOS2-3764]
                //ValidateLstStandardOperationsDictionaryDetection = tempLstStandardOperationsDictionaryDetection.Where(i => i.WorkOperationName == MainRow.Code).ToList();
                //if (ValidateLstStandardOperationsDictionaryDetection.Count > 0)
                //{
                //    CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("RemoveWorkOperationGridValidationPresentinMultipleSOD").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                //    return;
                //}
                //else if (WorkOperationMenulist.Any(i => i.IdParent == (ulong?)(MainRow.IdworkOperationByStage)) == true)
                //{
                //    CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("RemoveWorkOperationGridValidationForHavingSons").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                //    return;
                //}
                //else if (MainRow.IdStatus == 1535)
                //{
                //    CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("RemoveWorkOperationGridValidationForActive").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                //    return;
                //}

                //else if (MainRow.IdStatus == 1536)
                //{
                //    CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("RemoveWorkOperationGridValidationForInactive").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                //    return;
                //}
                #endregion
                MessageBoxResult MessageBoxResult = CustomMessageBox.Show(String.Format(Application.Current.Resources["WorkOperationsDeleteMessage"].ToString()), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                if (MessageBoxResult == MessageBoxResult.Yes)
                {
                    operationMenulist = new ObservableCollection<WorkOperationByStages>();
                    ERMSOPModuleDeleteList = new List<ERMSOPModule>();
                    ERMSOPModuleDeleteParentList = new List<ERMSOPModule>();
                    IsEnabledSaveButton = true;
                    SaveButtonVisibility = Visibility.Visible;
                    StandardOperationsDictionary tempSelectedStandardOperationsDictionary = new StandardOperationsDictionary();
                    tempSelectedStandardOperationsDictionary.IdStandardOperationsDictionary = tempLstStandardOperationsDictionaryModules.Select(w => w.IdStandardOperationsDictionary).FirstOrDefault();

                    StandardOperationsDictionaryModules standardOperationsDictionaryModules = new StandardOperationsDictionaryModules();
                    if (MainRow != null)
                    {
                        #region GEOS2-4046 Gulab Lakade
                        //List<ERMSOPModule> found = new List<ERMSOPModule>();
                        //if (!found.Any(a => a != null && a.KeyName.Trim().Equals(MainRow.KeyName.Trim())))
                        //    found.AddRange(ModuleMenulist.Where(s => s.IdworkOperationByStage == MainRow.IdworkOperationByStage).ToList());

                        //for (int i = 0; i < found.Count(); i++)
                        //{


                        //    standardOperationsDictionaryModules.IdWorkoperation = Convert.ToUInt32(MainRow.IdworkOperationByStage);
                        //    if (SelectedItem is ProductTypes)
                        //    {
                        //        ProductTypes productTypes = (ProductTypes)SelectedItem;
                        //        //standardOperationsDictionaryModules.IdCpType = (byte)productTypes.IdCPType;
                        //        standardOperationsDictionaryModules.IdCpType = (byte)productTypes.IdCPType;
                        //    }
                        //    //standardOperationsDictionaryModules.ObservedTime = (float?)MainRow.ObservedTime;
                        //    //standardOperationsDictionaryModules.Activity = (float?)MainRow.Activity;
                        //    standardOperationsDictionaryModules.ObservedTime = (float?)found[i].ObservedTime;
                        //    standardOperationsDictionaryModules.Activity = (float?)found[i].Activity;

                        //    ModuleMenulist.Remove(found[i]);
                        //    WorkOperationMenulist.Where(w => w.IdworkOperationByStage == found[i].IdworkOperationByStage).ToList().ForEach(f => f.IsCurrentWorkOperation = false);

                        //    standardOperationsDictionaryModulesDeleteList.Add(standardOperationsDictionaryModules);
                        //    List<ERMSOPModule> deletelist = ModuleMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(found[i].KeyName)).ToList();
                        //    if (deletelist != null)
                        //    {
                        //        ERMSOPModuleDeleteAction(deletelist);
                        //    }
                        //    //foreach (ERMSOPModule item in deletelist)
                        //    //{
                        //    //        StandardOperationsDictionaryModules standardOperationsDictionary = new StandardOperationsDictionaryModules();
                        //    //        standardOperationsDictionary.IdWorkoperation = Convert.ToUInt32(item.IdworkOperationByStage);
                        //    //        if (SelectedItem is ProductTypes)
                        //    //        {
                        //    //            ProductTypes productTypes = (ProductTypes)SelectedItem;
                        //    //            standardOperationsDictionary.IdCpType = (byte)productTypes.IdCPType;
                        //    //        }
                        //    //        standardOperationsDictionary.ObservedTime = (float?)item.ObservedTime;
                        //    //        standardOperationsDictionary.Activity = (float?)item.Activity;
                        //    //        ModuleMenulist.Remove(item);
                        //    //    standardOperationsDictionaryModulesDeleteList.Add(standardOperationsDictionary);
                        //    //}
                        //    if (ERMSOPModuleDeleteList != null)
                        //        foreach (ERMSOPModule item in ERMSOPModuleDeleteList)
                        //        {
                        //            StandardOperationsDictionaryModules standardOperationsDictionary = new StandardOperationsDictionaryModules();
                        //            standardOperationsDictionary.IdWorkoperation = Convert.ToUInt32(item.IdworkOperationByStage);
                        //            if (SelectedItem is ProductTypes)
                        //            {
                        //                ProductTypes productTypes = (ProductTypes)SelectedItem;
                        //                standardOperationsDictionary.IdCpType = (byte)productTypes.IdCPType;
                        //            }
                        //            standardOperationsDictionary.ObservedTime = (float?)item.ObservedTime;
                        //            standardOperationsDictionary.Activity = (float?)item.Activity;
                        //            ModuleMenulist.Remove(item);
                        //            standardOperationsDictionaryModulesDeleteList.Add(standardOperationsDictionary);
                        //        }

                        //    List<ERMSOPModule> deleteParentlist = ModuleMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(found[i].ParentName)).ToList();
                        //    if (deleteParentlist.Count == 0)
                        //    {
                        //        List<ERMSOPModule> parentlist = ModuleMenulist.Where(w => w.KeyName.Equals(found[i].ParentName)).ToList();
                        //        ERMSOPModuleDeleteParentAction(parentlist);
                        //    }
                        //    if (ERMSOPModuleDeleteParentList != null)
                        //        foreach (ERMSOPModule item in ERMSOPModuleDeleteParentList)
                        //        {
                        //            StandardOperationsDictionaryModules standardOperationsDictionary = new StandardOperationsDictionaryModules();
                        //            standardOperationsDictionary.IdWorkoperation = Convert.ToUInt32(item.IdworkOperationByStage);
                        //            if (SelectedItem is ProductTypes)
                        //            {
                        //                ProductTypes productTypes = (ProductTypes)SelectedItem;
                        //                standardOperationsDictionary.IdCpType = (byte)productTypes.IdCPType;
                        //            }
                        //            standardOperationsDictionary.ObservedTime = (float?)item.ObservedTime;
                        //            standardOperationsDictionary.Activity = (float?)item.Activity;
                        //            ModuleMenulist.Remove(item);
                        //            standardOperationsDictionaryModulesDeleteList.Add(standardOperationsDictionary);
                        //        }
                        //    var tempModuleMenulist = ModuleMenulist.ToList();
                        //    foreach (ERMSOPModule itemRemove in tempModuleMenulist)
                        //    {
                        //        if (GetStages.Any(a => a.Code.Equals(itemRemove.Name)))
                        //        {
                        //            List<ERMSOPModule> childList = ModuleMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(itemRemove.KeyName)).ToList();
                        //            if (childList.Count == 0)
                        //            {
                        //                ModuleMenulist.Remove(itemRemove);
                        //            }
                        //        }

                        //    }
                        //}
                        #endregion
                        #region [GEOS2-4830][gulab lakade][07 12 2023]
                        ObservableCollection<ERMSOPModule> ModuleMenulistTemp = new ObservableCollection<ERMSOPModule>();
                        ModuleMenulistTemp = ModuleMenulist;
                        #region GEOS2-4046 Gulab Lakade
                        List<ERMSOPModule> found = new List<ERMSOPModule>();
                        if (!found.Any(a => a != null && a.KeyName.Trim().Equals(MainRow.KeyName.Trim())))
                            found.AddRange(ModuleMenulistTemp.Where(s => s.IdworkOperationByStage == MainRow.IdworkOperationByStage).ToList());

                        for (int i = 0; i < found.Count(); i++)
                        {


                            standardOperationsDictionaryModules.IdWorkoperation = Convert.ToUInt32(MainRow.IdworkOperationByStage);
                            if (SelectedItem is ProductTypes)
                            {
                                ProductTypes productTypes = (ProductTypes)SelectedItem;
                                //standardOperationsDictionaryModules.IdCpType = (byte)productTypes.IdCPType;
                                standardOperationsDictionaryModules.IdCpTypeNew = (long)productTypes.IdCPType;
                            }
                            //standardOperationsDictionaryModules.ObservedTime = (float?)MainRow.ObservedTime;
                            //standardOperationsDictionaryModules.Activity = (float?)MainRow.Activity;
                            standardOperationsDictionaryModules.ObservedTime = (float?)found[i].ObservedTime;
                            standardOperationsDictionaryModules.Activity = (float?)found[i].Activity;

                            ModuleMenulistTemp.Remove(found[i]);
                            WorkOperationMenulist.Where(w => w.IdworkOperationByStage == found[i].IdworkOperationByStage).ToList().ForEach(f => f.IsCurrentWorkOperation = false);

                            standardOperationsDictionaryModulesDeleteList.Add(standardOperationsDictionaryModules);
                            List<ERMSOPModule> deletelist = ModuleMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(found[i].KeyName)).ToList();
                            if (deletelist != null)
                            {
                                ERMSOPModuleDeleteAction(deletelist);
                            }
                            //foreach (ERMSOPModule item in deletelist)
                            //{
                            //        StandardOperationsDictionaryModules standardOperationsDictionary = new StandardOperationsDictionaryModules();
                            //        standardOperationsDictionary.IdWorkoperation = Convert.ToUInt32(item.IdworkOperationByStage);
                            //        if (SelectedItem is ProductTypes)
                            //        {
                            //            ProductTypes productTypes = (ProductTypes)SelectedItem;
                            //            standardOperationsDictionary.IdCpType = (byte)productTypes.IdCPType;
                            //        }
                            //        standardOperationsDictionary.ObservedTime = (float?)item.ObservedTime;
                            //        standardOperationsDictionary.Activity = (float?)item.Activity;
                            //        ModuleMenulist.Remove(item);
                            //    standardOperationsDictionaryModulesDeleteList.Add(standardOperationsDictionary);
                            //}
                            if (ERMSOPModuleDeleteList != null)
                                foreach (ERMSOPModule item in ERMSOPModuleDeleteList)
                                {
                                    StandardOperationsDictionaryModules standardOperationsDictionary = new StandardOperationsDictionaryModules();
                                    standardOperationsDictionary.IdWorkoperation = Convert.ToUInt32(item.IdworkOperationByStage);
                                    if (SelectedItem is ProductTypes)
                                    {
                                        ProductTypes productTypes = (ProductTypes)SelectedItem;
                                        standardOperationsDictionary.IdCpTypeNew = (long)productTypes.IdCPType;
                                    }
                                    standardOperationsDictionary.ObservedTime = (float?)item.ObservedTime;
                                    standardOperationsDictionary.Activity = (float?)item.Activity;
                                    ModuleMenulistTemp.Remove(item);
                                    standardOperationsDictionaryModulesDeleteList.Add(standardOperationsDictionary);
                                }

                            List<ERMSOPModule> deleteParentlist = ModuleMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(found[i].ParentName)).ToList();
                            if (deleteParentlist.Count == 0)
                            {
                                List<ERMSOPModule> parentlist = ModuleMenulistTemp.Where(w => w.KeyName.Equals(found[i].ParentName)).ToList();
                                ERMSOPModuleDeleteParentAction(parentlist);
                            }
                            if (ERMSOPModuleDeleteParentList != null)
                                foreach (ERMSOPModule item in ERMSOPModuleDeleteParentList)
                                {
                                    StandardOperationsDictionaryModules standardOperationsDictionary = new StandardOperationsDictionaryModules();
                                    standardOperationsDictionary.IdWorkoperation = Convert.ToUInt32(item.IdworkOperationByStage);
                                    if (SelectedItem is ProductTypes)
                                    {
                                        ProductTypes productTypes = (ProductTypes)SelectedItem;
                                        standardOperationsDictionary.IdCpTypeNew = (long)productTypes.IdCPType;
                                    }
                                    standardOperationsDictionary.ObservedTime = (float?)item.ObservedTime;
                                    standardOperationsDictionary.Activity = (float?)item.Activity;
                                    ModuleMenulistTemp.Remove(item);
                                    standardOperationsDictionaryModulesDeleteList.Add(standardOperationsDictionary);
                                }
                            var tempModuleMenulist = ModuleMenulistTemp.ToList();
                            foreach (ERMSOPModule itemRemove in tempModuleMenulist)
                            {
                                if (GetStages.Any(a => a.Code.Equals(itemRemove.Name)))
                                {
                                    List<ERMSOPModule> childList = ModuleMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(itemRemove.KeyName)).ToList();
                                    if (childList.Count == 0)
                                    {
                                        ModuleMenulistTemp.Remove(itemRemove);
                                    }
                                }

                            }
                        }
                        #endregion
                        #endregion
                        ModuleMenulist = new ObservableCollection<ERMSOPModule>();
                        ModuleMenulist = ModuleMenulistTemp;
                    }

                    CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("WorkOperationDeletedSuccess").ToString()), Application.Current.Resources["PopUpSuccessColor"].ToString(), CustomMessageBox.MessageImagePath.Ok, MessageBoxButton.OK);
                }
                GeosApplication.Instance.Logger.Log("Method DeleteModuleTreeListControlCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in DeleteModuleTreeListControlCommandAction() Method " + ex.Detail.ErrorMessage, category: Category.Info, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in DeleteModuleTreeListControlCommandAction() Method - ServiceUnexceptedException " + ex.Message, category: Category.Info, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method DeleteModuleTreeListControlCommandAction()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        List<ERMSOPModule> tempWorkOperationClonedModule = new List<ERMSOPModule>();
        string Saveselecteditem = string.Empty;
        private void RetrieveWorkOperationsByCPTypes()
        {
            Saveselecteditem = "module";
            GeosApplication.Instance.Logger.Log("Method RetrieveArticlesByCategory()...", category: Category.Info, priority: Priority.Low);
            try
            {


                if (!DXSplashScreen.IsActive)
                {
                    DXSplashScreen.Show(x =>
                    {
                        Window win = new Window()
                        {
                            ShowActivated = false,
                            WindowStyle = WindowStyle.None,
                            ResizeMode = ResizeMode.NoResize,
                            AllowsTransparency = true,
                            Background = new SolidColorBrush(Colors.Transparent),
                            ShowInTaskbar = false,
                            Topmost = true,
                            SizeToContent = SizeToContent.WidthAndHeight,
                            WindowStartupLocation = WindowStartupLocation.CenterScreen,
                        };
                        WindowFadeAnimationBehavior.SetEnableAnimation(win, true);
                        win.Topmost = false;
                        return win;
                    }, x =>
                    {
                        return new SplashScreenView() { DataContext = new SplashScreenViewModel() };
                    }, null, null);
                }
            }
            catch (Exception ex)
            {

            }
            if (ISSavechanges == true)
            {
                return;
            }
            if (IsEnabledSaveButton && SaveButtonVisibility == Visibility.Visible)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                MessageBoxResult MessageBoxResult = MessageBoxResult = CustomMessageBox.Show(string.Format(Application.Current.Resources["ArticleGridUpdateWarning"].ToString()), "Yellow", CustomMessageBox.MessageImagePath.Warning, MessageBoxButton.YesNo);
                if (MessageBoxResult == MessageBoxResult.Yes)
                {
                    if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }
                    ISSavechanges = true;
                    IsEnabledSaveButton = false;
                    SelectedItemOldclone = SelectedItem;
                    SelectedItem = SelectedItemOld;
                    var tempSelectedItem = SelectedItemOldclone;
                    SaveButtonCommandAction();
                    ISSavechanges = false;
                    SelectedItem = tempSelectedItem;
                    //AcceptButtonCommandAction(null);
                    if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                    #region GEOS2-3882 Commented Code
                    //SelectedItemDetection = SelectedItemOldDetection;
                    //if (SelectedItemOldcloneDetection != null)
                    //    SelectedItemDetection = SelectedItemOldcloneDetection;

                    //SelectedItemOption = SelectedItemOldOption;
                    //if (SelectedItemOldcloneOption != null)
                    //    SelectedItemOption = SelectedItemOldcloneOption;
                    //////GEOS2-3838 - Way
                    //SelectedItemWay = SelectedItemOldWay;
                    //if (SelectedItemOldcloneWay != null)
                    //    SelectedItemWay = SelectedItemOldcloneWay;
                    ////[GEOS2-3601] - Structure
                    //SelectedItemStructures = SelectedItemOldStructure;
                    //if (SelectedItemOldcloneStructure != null)
                    //    SelectedItemStructures = SelectedItemOldcloneStructure;
                    ////GEOS2-4033 Spare Part Gulab Lakade
                    //SelectedItemSparePart = SelectedItemOldSparePart;
                    //if (SelectedItemOldcloneSparePart != null)
                    //    SelectedItemSparePart = SelectedItemOldcloneSparePart;
                    #endregion
                }

                #region [GEOS2-3909][Rupali Sarode][05-11-2022]
                if (MessageBoxResult == MessageBoxResult.No)
                {
                    TmpModuleMenulist = null;
                    TmpDetectionMenulist = null;
                    TmpOptionMenulist = null;
                    TmpStructureMenulist = null;
                    TmpWayMenulist = null;
                    TmpSparePartsMenulist = null;
                    TmpIdCPType = 0;
                    TmpIdDetection = 0; //[GEOS2-3922][Rupali Sarode][07-11-2022]
                    TmpIdOption = 0;
                    TmpIdWayType = 0;
                    TmpIdStructure = 0;
                    TmpIdSpareParts = 0;
                }
                #endregion
            }

            if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
            if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }
            SelectedItemOld = SelectedItem;
            IsEnabledSaveButton = false;
            ModuleMenulistupdated = new ObservableCollection<ERMSOPModule>();
            try
            {
                ObservableCollection<ERMSOPModule> ModuleMenulistTemp = new ObservableCollection<ERMSOPModule>();
                if (SelectedItem is ProductTypes)
                {

                    //ModuleMenulistupdated = ModuleMenulist;
                    ProductTypes productTypes = (ProductTypes)SelectedItem;
                    //ModuleMenulist = null;
                    List<StandardOperationsDictionaryModules> tempStandardOperationsDictionaryModules = tempLstStandardOperationsDictionaryModules.Where(w => w.IdCpTypeNew == (long)productTypes.IdCPType).ToList();
                    //FillModuleData(tempStandardOperationsDictionaryModules);

                    //var idCPTypeList = (ModuleMenulist.Where(x => x.IdCpType == Convert.ToInt32(productTypes.IdCPType))).ToList();
                    // operationMenulist.AddRange(idCPTypeList.ToList());
                    //ModuleMenulistCloned = ModuleMenulist;
                    operationMenulistCloned = operationMenulist;
                    ModuleMenulist = new ObservableCollection<ERMSOPModule>();

                    operationMenulist = new ObservableCollection<WorkOperationByStages>();
                    duplicateItemloop = 0;
                    if (tempStandardOperationsDictionaryModules.Count() > 0)
                    {
                        foreach (var eRMSOPModule in tempStandardOperationsDictionaryModules.OrderBy(x => x.ModulePosition).ToList())
                        {
                            //List<WorkOperationByStages> tempModuleList = WorkOperationMenulist.Where(w => w.IdworkOperationByStage ==Convert.ToInt32(eRMSOPModule.IdWorkoperation)).ToList();
                            //  operationMenulist.AddRange(tempModuleList);
                            if (eRMSOPModule != null)
                            {
                                List<WorkOperationByStages> tempModuleList = WorkOperationMenulist.Where(w => w.IdworkOperationByStage == Convert.ToInt32(eRMSOPModule.IdWorkoperation) && w.Name == eRMSOPModule.WorkOperationName).ToList();//[Cut  work operation not work properly.][gulab lakade][24 01 2023]
                                if (tempModuleList != null)
                                    foreach (WorkOperationByStages item in tempModuleList)
                                    {
                                        if (item.IdStatus == 1536)//[rdixit][03.08.2022][GEOS2-3764]
                                        {
                                            item.IsInactiveWorkOperation = true;
                                            item.IsReadOnly = true;
                                        }
                                        WorkOperationByStages ParentName = WorkOperationMenulist.Where(w => w.ParentName != null && w.KeyName.Equals(item.ParentName)).FirstOrDefault();
                                        if (ParentName != null)
                                        {
                                            if (!operationMenulist.Any(a => a.KeyName.Equals(ParentName.KeyName)))
                                                operationMenulist.Add(ParentName);
                                        }
                                        duplicateItemloop = 0;
                                        GetAllTreeList(item, WorkOperationMenulist);
                                    }

                            }

                        }
                    }
                    #region ModuleMenulist
                    #region Supplements [GEOS2-4830][gulab lakade][07 12 2023]
                    if (AllSupplementsBoxMenu != null)
                    {
                        var listadoDuplicadas = from c in AllSupplementsBoxMenu
                                                join c2 in AllSupplementsBoxMenu on c.Item2 equals c2.Item2
                                                where c != c2
                                                select c;

                        var ModuleSandardOperationTime = listadoDuplicadas.FirstOrDefault();
                        if (ModuleSandardOperationTime != null)
                        {
                            var templist = listadoDuplicadas.Where(a => a.Item2 == ModuleSandardOperationTime.Item2);
                            listadoDuplicadas = templist;
                        }
                        var tempSupplementsBoxMenu = AllSupplementsBoxMenu;

                        ColumnsModuleForSupplements = new ObservableCollection<TreeListColumn>();
                        ColumnsModuleForSupplements.Add(new TreeListColumn()
                        {
                            FieldName = "StandardSupplements",
                            Header = "Standard",
                            HeaderToolTip = "Standard",
                            AllowCellMerge = false,
                            Width = 150, //gulab lakade not show supplements name all
                            AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                            Visible = true,
                            ReadOnly = false,
                            FixedWidth = false,

                        });

                        ColumnsModuleOperationTime = new ObservableCollection<TreeListColumn>();
                        ColumnsModuleOperationTime.Add(new TreeListColumn()
                        {
                            //FieldName = "StandardOperationTime",
                            FieldName = "UiTempStandardOperationTimeName",
                            Header = "Standard",
                            HeaderToolTip = "Standard",
                            AllowCellMerge = false,
                            Width = 150,//gulab lakade not show supplements name all
                            AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                            Visible = true,
                            ReadOnly = false,
                            FixedWidth = false,



                        });

                        int Suplimentcount = 1;
                        var ColumnsModuleList = tempSupplementsBoxMenu.Where(p => !listadoDuplicadas.Any(p2 => p2.Item1 == p.Item1));
                        foreach (var item in ColumnsModuleList)
                        {
                            if (Suplimentcount == 5)
                            {
                                ColumnsModuleForSupplements.Add(new TreeListColumn()
                                {
                                    FieldName = "SupplementPlant" + Suplimentcount + "Value",
                                    Header = "Others",
                                    HeaderToolTip = "Others",
                                    AllowCellMerge = false,
                                    Width = 60,
                                    AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                    Visible = true,
                                    ReadOnly = false,
                                    FixedWidth = false
                                });
                                ColumnsModuleOperationTime.Add(new TreeListColumn()
                                {
                                    FieldName = "UiTempoperationTimePlant" + Suplimentcount + "Value",
                                    Header = "Others",
                                    HeaderToolTip = "Others",
                                    AllowCellMerge = false,
                                    Width = 60,
                                    AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                    Visible = true,
                                    ReadOnly = false,
                                    FixedWidth = false
                                });
                                break;
                            }
                            if (Suplimentcount == 5)
                            {
                                break;
                            }
                            ColumnsModuleForSupplements.Add(new TreeListColumn()
                            {
                                FieldName = "SupplementPlant" + Suplimentcount + "Value",
                                Header = item.Item1,
                                HeaderToolTip = item.Item1,
                                AllowCellMerge = false,
                                Width = 100,
                                AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                Visible = true,
                                ReadOnly = false,
                                FixedWidth = false
                            });

                            ColumnsModuleOperationTime.Add(new TreeListColumn()
                            {
                                //FieldName = "OperationTimePlant" + count + "Value",
                                FieldName = "UiTempoperationTimePlant" + Suplimentcount + "Value",
                                Header = item.Item1,
                                HeaderToolTip = item.Item1,
                                AllowCellMerge = false,
                                Width = 60,
                                AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                Visible = true,
                                ReadOnly = false,
                                FixedWidth = false
                            });
                            Suplimentcount = Suplimentcount + 1;
                        }
                        #endregion





                        WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                        //foreach (WorkOperationByStages Module in operationMenulist)
                        //        foreach (WorkOperationByStages Module in WorkOperationMenulist)
                        //        {

                        //            //if (LstStandardOperationsDictionaryModules.Any(a => a.IdWorkoperation == Convert.ToUInt64(Module.IdworkOperationByStage)))
                        //            // if (Module.IdStatus != 1536) //[rdixit][03.08.2022][GEOS2-3764]
                        //            if (operationMenulist.Any(a => a.IdworkOperationByStage == Convert.ToInt64(Module.IdworkOperationByStage))
                        //                && operationMenulist.Any(a => a.IdStage == Module.IdStage)
                        //                && operationMenulist.Any(a => a.Name.Trim().Equals(Module.Name.Trim()))
                        //                )
                        //            {
                        //                StandardOperationsDictionaryModules standardOperationsDictionaryModules = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(Module.IdworkOperationByStage) && Module.Parent != null
                        //                && w.IdCpType == Convert.ToInt32(productTypes.IdCPType)).FirstOrDefault();
                        //                ERMSOPModule eRMSOPModule = new ERMSOPModule();
                        //                if (standardOperationsDictionaryModules != null)
                        //                    eRMSOPModule.IdCpType = standardOperationsDictionaryModules.IdCpType;
                        //                eRMSOPModule.Name = Module.Name;
                        //                eRMSOPModule.IdworkOperationByStage = Module.IdworkOperationByStage;
                        //                eRMSOPModule.IdSequence = Module.IdSequence;
                        //                eRMSOPModule.IdStatus = Module.IdStatus;
                        //                eRMSOPModule.Status = Module.Status;
                        //                eRMSOPModule.Code = Module.Name;
                        //                eRMSOPModule.Parent = Module.Parent;
                        //                eRMSOPModule.IdParent = Module.IdParent;
                        //                eRMSOPModule.KeyName = Module.KeyName;
                        //                eRMSOPModule.ParentName = Module.ParentName;
                        //                eRMSOPModule.Position = Module.Position;
                        //                eRMSOPModule.WorkOperation_count = Module.WorkOperation_count;
                        //                eRMSOPModule.WorkOperation_count_original = Module.WorkOperation_count_original;
                        //                eRMSOPModule.NameWithWorkOperationCount = Module.NameWithWorkOperationCount;
                        //                //[rdixit][03.08.2022][GEOS2-3764]
                        //                eRMSOPModule.IsReadOnly = Module.IsReadOnly;
                        //                eRMSOPModule.IsInactiveWorkOperation = Module.IsInactiveWorkOperation;

                        //                //eRMSOPModule.NormalTime = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(Module.IdworkOperationByStage)).Select(s => s.NormalTime).DefaultIfEmpty(null).FirstOrDefault();
                        //                //if (eRMSOPModule.NormalTime != null)
                        //                //    eRMSOPModule.NormalTime = Math.Round((double)eRMSOPModule.NormalTime, 2);
                        //                //eRMSOPModule.ObservedTime = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(Module.IdworkOperationByStage)).Select(s => s.ObservedTime).DefaultIfEmpty(null).FirstOrDefault();
                        //                //if (eRMSOPModule.ObservedTime != null)
                        //                //    eRMSOPModule.ObservedTime = Math.Round((double)eRMSOPModule.ObservedTime, 2);
                        //                //eRMSOPModule.Activity = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(Module.IdworkOperationByStage)).Select(s => s.Activity).DefaultIfEmpty(null).FirstOrDefault(); ;
                        //                //if (eRMSOPModule.Activity != null)
                        //                //    eRMSOPModule.Activity = Math.Round((double)eRMSOPModule.Activity, 2);

                        //                if (!GetStages.Any(a => a.Code.Equals(eRMSOPModule.Name)))
                        //                {
                        //                    var tempActivity = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage)
                        //                     && w.IdCpType == Convert.ToUInt64(eRMSOPModule.IdCpType)).Select(s => s.Activity).DefaultIfEmpty(null).FirstOrDefault();
                        //                    var tempObservedTime = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage)
                        //                     && w.IdCpType == Convert.ToUInt64(eRMSOPModule.IdCpType)).Select(s => s.ObservedTime).DefaultIfEmpty(null).FirstOrDefault();


                        //                    #region [GEOS2-4071][Rupali Sarode][10-12-2022]

                        //                    var tempModule = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage)
                        //                    && w.IdCpType == Convert.ToUInt64(eRMSOPModule.IdCpType)).FirstOrDefault();

                        //                    if (tempModule != null)
                        //                    {
                        //                        if (tempModule.IdWorkoperation == Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage) && (tempActivity == null || tempActivity == 0))
                        //                            tempActivity = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == Module.IdworkOperationByStage && a.KeyName == Module.KeyName).Select(b => b.Activity).FirstOrDefault();   //[Cut  work operation not work properly.][gulab lakade][24 01 2023]

                        //                        if (tempModule.IdWorkoperation == Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage) && (tempObservedTime == null || tempObservedTime == 0))
                        //                            tempObservedTime = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == Module.IdworkOperationByStage && a.KeyName == Module.KeyName).Select(b => b.ObservedTime).FirstOrDefault();  //[Cut  work operation not work properly.][gulab lakade][24 01 2023]
                        //                    }

                        //                    #endregion

                        //                    if (tempActivity != null)
                        //                        eRMSOPModule.Activity = Math.Round((double)tempActivity, 2);
                        //                    //if (tempObservedTime != null)
                        //                    //    eRMSOPModule.ObservedTime = Math.Round((double)tempObservedTime, 2);
                        //                    if (tempObservedTime != null)
                        //                    {
                        //                        eRMSOPModule.ObservedTime = Math.Round((double)tempObservedTime, 2);
                        //                        #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                        //                        //   eRMSOPModule.UITempobservedTime = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage)
                        //                        //&& w.IdCpType == Convert.ToUInt64(eRMSOPModule.IdCpType)).Select(s => s.UITempobservedTime).FirstOrDefault();

                        //                        #region [GEOS2-5008][gulab lakade][1 11 2023]

                        //                        //eRMSOPModule.UITempobservedTime = TimeSpan.FromMinutes(Convert.ToDouble(tempObservedTime));
                        //                        eRMSOPModule.UITempobservedTime = ConvertfloattoTimespan(Convert.ToString(Convert.ToDouble(tempObservedTime)));
                        //                        #endregion
                        //                        #endregion
                        //                    }

                        //                    eRMSOPModule.NormalTime = Math.Round(Convert.ToDouble(eRMSOPModule.ObservedTime * eRMSOPModule.Activity / 100), 2);
                        //                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                        //                    eRMSOPModule.UITempNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(eRMSOPModule.NormalTime));

                        //                    #endregion
                        //                    //[GEOS2-3933][Rupali Sarode][21/09/2022]
                        //                    eRMSOPModule.WORemarks = Module.WORemarks == null ? "" : Module.WORemarks.Trim();

                        //                    var tempRemarks = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage)
                        //                     && w.IdCpType == Convert.ToUInt64(eRMSOPModule.IdCpType)).Select(s => s.Remarks).DefaultIfEmpty(null).FirstOrDefault();

                        //                    eRMSOPModule.Remarks = tempRemarks == null ? "" : tempRemarks.Trim();

                        //                }
                        //                if (GetStages.Any(a => a != null && a.Code.Trim().Equals(Module.Name.Trim())))
                        //                {
                        //                    eRMSOPModule.IsDeleteButton = false;
                        //                    eRMSOPModule.IsDeleteButtonVisibility = Visibility.Hidden;
                        //                    // eRMSOPModule.ObservedTimeIsReadOnly =true;
                        //                    eRMSOPModule.IsReadOnly = true;
                        //                    eRMSOPModule.IsValidateOnTextInput = false;
                        //                    Module.IsCurrentWorkOperation = true;
                        //                }
                        //                else
                        //                {
                        //                    Module.IsCurrentWorkOperation = true;
                        //                    //eRMSOPModule.ObservedTimeIsReadOnly = false;
                        //                    eRMSOPModule.IsReadOnly = false;
                        //                    eRMSOPModule.IsValidateOnTextInput = true;
                        //                }
                        //                if (Module.IdStatus == 1536)
                        //                {
                        //                    eRMSOPModule.IsInactiveWorkOperation = true;
                        //                    eRMSOPModule.IsReadOnly = true;
                        //                }
                        //                #region Temp  check only [GEOS2-4830][gulab lakade][07 12 2023]

                        //                if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(eRMSOPModule.Name.Trim())))
                        //                {
                        //                    if (ModuleSandardOperationTime != null)
                        //                        eRMSOPModule.StandardSupplements = (float?)ModuleSandardOperationTime.Item2;
                        //                    if (tempSupplementsBoxMenu.Any(p => !listadoDuplicadas.Any(p2 => p2.Item1 == p.Item1)))
                        //                    {
                        //                        eRMSOPModule.AllSupplementsBoxMenu = AllSupplementsBoxMenu;
                        //                        List<float?> lst = new List<float?>();

                        //                        var a = ColumnsModuleList.ToList();
                        //                        for (int i = 0; i < a.Count(); i++)
                        //                        {
                        //                            lst.Add((float?)a[i].Item2);
                        //                        }

                        //                        if (ColumnsModuleList.Count() == 1)
                        //                        {
                        //                            eRMSOPModule.SupplementPlant1Value = (float?)lst[0];
                        //                        }
                        //                        else if (ColumnsModuleList.Count() == 2)
                        //                        {
                        //                            eRMSOPModule.SupplementPlant1Value = (float?)lst[0];
                        //                            eRMSOPModule.SupplementPlant2Value = (float?)lst[1];
                        //                        }
                        //                        else if (ColumnsModuleList.Count() == 3)
                        //                        {
                        //                            eRMSOPModule.SupplementPlant1Value = (float?)lst[0];
                        //                            eRMSOPModule.SupplementPlant2Value = (float?)lst[1];
                        //                            eRMSOPModule.SupplementPlant3Value = (float?)lst[2];
                        //                        }
                        //                        else if (ColumnsModuleList.Count() == 4)
                        //                        {
                        //                            eRMSOPModule.SupplementPlant1Value = (float?)lst[0];
                        //                            eRMSOPModule.SupplementPlant2Value = (float?)lst[1];
                        //                            eRMSOPModule.SupplementPlant3Value = (float?)lst[2];
                        //                            eRMSOPModule.SupplementPlant4Value = (float?)lst[3];
                        //                        }
                        //                        else if (ColumnsModuleList.Count() == 5)
                        //                        {
                        //                            eRMSOPModule.SupplementPlant1Value = (float?)lst[0];
                        //                            eRMSOPModule.SupplementPlant2Value = (float?)lst[1];
                        //                            eRMSOPModule.SupplementPlant3Value = (float?)lst[2];
                        //                            eRMSOPModule.SupplementPlant4Value = (float?)lst[3];
                        //                            eRMSOPModule.SupplementPlant5Value = (float?)lst[4];
                        //                        }
                        //                        else
                        //                        {
                        //                            eRMSOPModule.SupplementPlant1Value = (float?)lst[0];
                        //                            eRMSOPModule.SupplementPlant2Value = (float?)lst[1];
                        //                            eRMSOPModule.SupplementPlant3Value = (float?)lst[2];
                        //                            eRMSOPModule.SupplementPlant4Value = (float?)lst[3];
                        //                            eRMSOPModule.SupplementPlant5Value = 0;
                        //                            if (ColumnsModuleList.Count() > 5)
                        //                            {
                        //                                for (int q = 4; q < ColumnsModuleList.Count(); q++)
                        //                                {
                        //                                    if (eRMSOPModule.SupplementPlant5Value == null)
                        //                                        eRMSOPModule.SupplementPlant5Value = 0;
                        //                                    eRMSOPModule.SupplementPlant5Value = (float?)(Convert.ToDouble(eRMSOPModule.SupplementPlant5Value)) + (float?)lst[q];  ///GEOS2-4046 Gulab Lakade
                        //                                }
                        //                            }


                        //                        }

                        //                    }

                        //                    if (ModuleSandardOperationTime != null)
                        //                        eRMSOPModule.StandardOperationTime = (float?)Math.Round(Convert.ToDouble(eRMSOPModule.NormalTime * (1 + (ModuleSandardOperationTime.Item2 / 100))), 2);
                        //                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                        //                    //TimeSpan temp= ConvertfloattoTimespan(Convert.ToString(eRMSOPModule.StandardOperationTime));
                        //                    //if(temp.Hours==0)
                        //                    //{
                        //                    //    eRMSOPModule.UiTempStandardOperationTimeName = ConvertfloattoTimespan(Convert.ToString(eRMSOPModule.StandardOperationTime)).ToString(@"mm\:ss"); ;
                        //                    //   //string t2= eRMSOPModule.UiTempStandardOperationTimeName.ToString(@"mm\:ss");
                        //                    //   //TimeSpan t1 = TimeSpan.FromMinutes(Convert.ToDouble(eRMSOPModule.StandardOperationTime));
                        //                    //}
                        //                    //else
                        //                    //{
                        //                    //    eRMSOPModule.UiTempStandardOperationTimeName = ConvertfloattoTimespan(Convert.ToString(eRMSOPModule.StandardOperationTime)).ToString(@"hh\:mm\:ss"); ;
                        //                    //}
                        //                    eRMSOPModule.UiTempStandardOperationTimeName = ConvertfloattoTimespan(Convert.ToString(eRMSOPModule.StandardOperationTime));

                        //                    #endregion
                        //                    eRMSOPModule.OperationTimePlant1Value = (float?)Math.Round(Convert.ToDouble(eRMSOPModule.NormalTime * (1 + (Convert.ToDouble(eRMSOPModule.SupplementPlant1Value) / 100))), 2);
                        //                    eRMSOPModule.OperationTimePlant2Value = (float?)Math.Round(Convert.ToDouble(eRMSOPModule.NormalTime * (1 + (Convert.ToDouble(eRMSOPModule.SupplementPlant2Value) / 100))), 2);
                        //                    eRMSOPModule.OperationTimePlant3Value = (float?)Math.Round(Convert.ToDouble(eRMSOPModule.NormalTime * (1 + (Convert.ToDouble(eRMSOPModule.SupplementPlant3Value) / 100))), 2);
                        //                    //if(!string.IsNullOrEmpty(Convert.ToString(eRMSOPModule.SupplementPlant4Value)))
                        //                    //{
                        //                    //    eRMSOPModule.OperationTimePlant4Value = (float?)Math.Round(Convert.ToDouble(eRMSOPModule.NormalTime * (1 + (eRMSOPModule.SupplementPlant4Value / 100))), 2);
                        //                    //}
                        //                    //else
                        //                    //{
                        //                    eRMSOPModule.OperationTimePlant4Value = (float?)Math.Round(Convert.ToDouble(eRMSOPModule.NormalTime * (1 + (Convert.ToDouble(eRMSOPModule.SupplementPlant4Value) / 100))), 2);
                        //                    //}

                        //                    eRMSOPModule.OperationTimePlant5Value = (float?)Math.Round(Convert.ToDouble(eRMSOPModule.NormalTime * (1 + (Convert.ToDouble(eRMSOPModule.SupplementPlant5Value) / 100))), 2);
                        //                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss

                        //                    eRMSOPModule.UiTempoperationTimePlant1Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPModule.OperationTimePlant1Value));
                        //                    eRMSOPModule.UiTempoperationTimePlant2Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPModule.OperationTimePlant2Value));
                        //                    eRMSOPModule.UiTempoperationTimePlant3Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPModule.OperationTimePlant3Value));
                        //                    eRMSOPModule.UiTempoperationTimePlant4Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPModule.OperationTimePlant4Value));
                        //                    eRMSOPModule.UiTempoperationTimePlant5Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPModule.OperationTimePlant5Value));

                        //                    #endregion
                        //                }


                        //                #endregion



                        //                try
                        //                {
                        //                    if (!ModuleMenulist.Any(a => a.KeyName.Equals(Module.KeyName)))
                        //                        ModuleMenulist.Add(eRMSOPModule);
                        //                }
                        //                catch (Exception ex)
                        //                {

                        //                }

                        //            }
                        //        }
                        //    }
                        //        var tempWorkOperationMenulist2 = ModuleMenulist.OrderBy(x => x.Position).ToList();
                        //        tempWorkOperationClonedModule = new List<ERMSOPModule>();
                        //        tempWorkOperationClonedModule.AddRange(tempWorkOperationMenulist2);
                        //        ModuleMenulist.Clear();
                        //        ModuleMenulist.AddRange(tempWorkOperationMenulist2);
                        //        if (tempWorkOperationMenulist2 != null)
                        //            tempWorkOperationMenulist2.Clear();
                        //        if (ModuleMenulist != null)
                        //        {
                        //            var tempModuleMenulist = ModuleMenulist.ToList();
                        //            for (int i = 0; i < tempModuleMenulist.Count; i++)
                        //            {
                        //                if (GetStages.Any(a => a.Code.Equals(tempModuleMenulist[i].Name)))
                        //                {
                        //                    List<ERMSOPModule> childList = ModuleMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(tempModuleMenulist[i].KeyName)).ToList();
                        //                    if (childList.Count == 0)
                        //                    {
                        //                        // WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                        //                        List<WorkOperationByStages> tempWOList = WorkOperationMenulist.Where(w => w.KeyName == tempModuleMenulist[i].KeyName).ToList();
                        //                        if (tempWOList != null)
                        //                            tempWOList.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                        //                        ModuleMenulist.Remove(tempModuleMenulist[i]);
                        //                    }
                        //                }
                        //            }
                        //        }
                        //        #endregion
                        //    }
                        //    else if (SelectedItem is Template)
                        //    {

                        //    }
                        //    #region TemplateWithCPTypes


                        //    else if (SelectedItem is TemplateWithCPTypes)
                        //    {
                        //        ModuleMenulist = null;
                        //        WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                        //        //TemplateWithCPTypes templateWithCPTypes = (TemplateWithCPTypes)SelectedItem;
                        //        //#region All
                        //        //if (templateWithCPTypes.Name.Equals("ALL"))
                        //        //{

                        //        //}
                        //        //else
                        //        //{
                        //        //    ModuleMenulist = null;
                        //        //    FillModuleData(tempLstStandardOperationsDictionaryModules);
                        //        //    var template = TemplateWithCPTypes.Where(w => w.Name.Equals(templateWithCPTypes.Name)).FirstOrDefault();
                        //        //    if (template != null && template.ProductTypesMenu != null)
                        //        //        foreach (ProductTypes item in template.ProductTypesMenu)
                        //        //        {
                        //        //            ModuleMenulistupdated.AddRange(ModuleMenulist.Where(x => x.IdCpType == Convert.ToInt32(item.IdCPType))).ToList().DefaultIfEmpty();
                        //        //        }
                        //        //    #region TemplatWiseRecord
                        //        //    ModuleMenulist = new ObservableCollection<ERMSOPModule>();
                        //        //    operationMenulist = new ObservableCollection<WorkOperationByStages>();
                        //        //    duplicateItemloop = 0;
                        //        //    //ModuleMenulistupdated.AddRange(ModuleMenulist.Where(w => w.IdCpType == Convert.ToInt32(productTypes.IdCPType)));
                        //        //    foreach (ERMSOPModule itemERMSOPModule in ModuleMenulistupdated)
                        //        //    {
                        //        //        if (itemERMSOPModule != null)
                        //        //        {
                        //        //            List<WorkOperationByStages> tempModuleList = WorkOperationMenulist.Where(w => w.IdworkOperationByStage == Convert.ToInt32(itemERMSOPModule.IdworkOperationByStage)).ToList();
                        //        //            foreach (WorkOperationByStages item in tempModuleList)
                        //        //            {
                        //        //                GetAllTreeList(item, WorkOperationMenulist);
                        //        //            }
                        //        //        }

                        //        //    }
                        //        //    #region ModuleMenulist
                        //        //    foreach (WorkOperationByStages Module in WorkOperationMenulist)
                        //        //    {

                        //        //        //if (LstStandardOperationsDictionaryModules.Any(a => a.IdWorkoperation == Convert.ToUInt64(Module.IdworkOperationByStage)))
                        //        //        if (operationMenulist.Any(a => a.IdworkOperationByStage == Convert.ToInt64(Module.IdworkOperationByStage))
                        //        //            && operationMenulist.Any(a => a.Name.Trim().Equals(Module.Name.Trim()))
                        //        //            )
                        //        //        {
                        //        //            StandardOperationsDictionaryModules standardOperationsDictionaryModules = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(Module.IdworkOperationByStage) && Module.Parent != null).FirstOrDefault();

                        //        //            ERMSOPModule eRMSOPModule = new ERMSOPModule();
                        //        //            if (standardOperationsDictionaryModules != null)
                        //        //                eRMSOPModule.IdCpType = standardOperationsDictionaryModules.IdCpType;
                        //        //            eRMSOPModule.Name = Module.Name;
                        //        //            eRMSOPModule.IdworkOperationByStage = Module.IdworkOperationByStage;
                        //        //            eRMSOPModule.IdSequence = Module.IdSequence;
                        //        //            eRMSOPModule.IdStatus = Module.IdStatus;
                        //        //            eRMSOPModule.Status = Module.Status;
                        //        //            eRMSOPModule.Code = Module.Name;
                        //        //            eRMSOPModule.Parent = Module.Parent;
                        //        //            eRMSOPModule.IdParent = Module.IdParent;
                        //        //            eRMSOPModule.KeyName = Module.KeyName;
                        //        //            eRMSOPModule.ParentName = Module.ParentName;
                        //        //            eRMSOPModule.Position = Module.Position;
                        //        //            eRMSOPModule.WorkOperation_count = Module.WorkOperation_count;
                        //        //            eRMSOPModule.WorkOperation_count_original = Module.WorkOperation_count_original;
                        //        //            eRMSOPModule.NameWithWorkOperationCount = Module.NameWithWorkOperationCount;
                        //        //            eRMSOPModule.NormalTime = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(Module.IdworkOperationByStage)).Select(s => s.NormalTime).DefaultIfEmpty(null).FirstOrDefault();
                        //        //            if (eRMSOPModule.NormalTime != null)
                        //        //                eRMSOPModule.NormalTime = Math.Round((double)eRMSOPModule.NormalTime, 2);
                        //        //            eRMSOPModule.ObservedTime = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(Module.IdworkOperationByStage)).Select(s => s.ObservedTime).DefaultIfEmpty(null).FirstOrDefault();
                        //        //            if (eRMSOPModule.ObservedTime != null)
                        //        //                eRMSOPModule.ObservedTime = Math.Round((double)eRMSOPModule.ObservedTime, 2);
                        //        //            eRMSOPModule.Activity = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(Module.IdworkOperationByStage)).Select(s => s.Activity).DefaultIfEmpty(null).FirstOrDefault(); ;
                        //        //            if (eRMSOPModule.Activity != null)
                        //        //                eRMSOPModule.Activity = Math.Round((double)eRMSOPModule.Activity, 2);
                        //        //            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(Module.Name.Trim())))
                        //        //            {
                        //        //                eRMSOPModule.IsDeleteButton = false;
                        //        //                eRMSOPModule.IsDeleteButtonVisibility = Visibility.Hidden;
                        //        //                // eRMSOPModule.ObservedTimeIsReadOnly =true;
                        //        //                eRMSOPModule.IsReadOnly = true;
                        //        //                eRMSOPModule.IsValidateOnTextInput = false;
                        //        //                Module.IsCurrentWorkOperation = true;
                        //        //            }
                        //        //            else
                        //        //            {
                        //        //                Module.IsCurrentWorkOperation = true;
                        //        //                //eRMSOPModule.ObservedTimeIsReadOnly = false;
                        //        //                eRMSOPModule.IsReadOnly = false;
                        //        //                eRMSOPModule.IsValidateOnTextInput = true;
                        //        //            }
                        //        //            if (Module.IdStatus == 1536)
                        //        //            {
                        //        //                eRMSOPModule.IsInactiveWorkOperation = true;
                        //        //                eRMSOPModule.IsReadOnly = true;
                        //        //            }

                        //        //            ModuleMenulist.Add(eRMSOPModule);
                        //        //        }
                        //        //    }
                        //        //    #endregion
                        //        //}
                        //        //#endregion




                        //        //#endregion

                        //    }
                        //#endregion

                        ////FillmoduleGridColumn();  //[GEOS2-4830][gulab lakade][07 12 2023]
                        //#region Commented Code
                        ////if (ModuleMenulist != null)
                        ////    foreach (var item in ModuleMenulist)
                        ////    {
                        ////        if (!GetStages.Any(a => a.Code.Equals(item.Name)))
                        ////        {
                        ////            var tempActivity = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(item.IdworkOperationByStage)
                        ////             && w.IdCpType == Convert.ToUInt64(item.IdCpType)).Select(s => s.Activity).DefaultIfEmpty(null).FirstOrDefault();
                        ////            //var tempNormalTime = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(item.IdworkOperationByStage)).Select(s => s.NormalTime).DefaultIfEmpty(null).FirstOrDefault();
                        ////            var tempObservedTime = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(item.IdworkOperationByStage)
                        ////             && w.IdCpType == Convert.ToUInt64(item.IdCpType)).Select(s => s.ObservedTime).DefaultIfEmpty(null).FirstOrDefault();
                        ////            if (tempActivity != null)
                        ////                item.Activity = Math.Round((double)tempActivity, 2);
                        ////            if (tempObservedTime != null)
                        ////                item.ObservedTime = Math.Round((double)tempObservedTime, 2);
                        ////            item.NormalTime = Math.Round(Convert.ToDouble(item.ObservedTime * item.Activity / 100),2);
                        ////        }
                        ////    }
                        //#endregion


                        #region RND
                        bool FlagAddItemModule = false; //[GEOS2-5135][Rupali Sarode][18-12-2023]
                        int tempmodulepos = 1;//[GEOS2-5629][gulab lakade][10 07 2024]
                        foreach (WorkOperationByStages Module in WorkOperationMenulist)
                        {
                            FlagAddItemModule = true;  //[GEOS2-5135][Rupali Sarode][18-12-2023]
                            //if (LstStandardOperationsDictionaryModules.Any(a => a.IdWorkoperation == Convert.ToUInt64(Module.IdworkOperationByStage)))
                            // if (Module.IdStatus != 1536) //[rdixit][03.08.2022][GEOS2-3764]
                            if (operationMenulist.Any(a => a.IdworkOperationByStage == Convert.ToInt64(Module.IdworkOperationByStage))
                                && operationMenulist.Any(a => a.IdStage == Module.IdStage)
                                && operationMenulist.Any(a => a.Name.Trim().Equals(Module.Name.Trim()))
                                )
                            {
                                StandardOperationsDictionaryModules standardOperationsDictionaryModules = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(Module.IdworkOperationByStage) && Module.Parent != null
                                && w.IdCpTypeNew == Convert.ToInt32(productTypes.IdCPType)).FirstOrDefault();
                                ERMSOPModule eRMSOPModule = new ERMSOPModule();

                                #region  [GEOS2-5135][Rupali Sarode][18-12-2023]
                                // If it is child & only active then add
                                List<WorkOperationByStages> childListInActiveDraft = operationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(Module.KeyName)).ToList();

                                if (childListInActiveDraft.Count == 0)
                                {
                                    if (Module.IdStatus == 1535)
                                    {
                                        FlagAddItemModule = true;
                                    }
                                    else
                                        FlagAddItemModule = false;
                                }
                                else // If it is parent and does not contain any active child, then do not include it
                                if (childListInActiveDraft.Count > 0)
                                {
                                    //List<WorkOperationByStages> childListInParent = operationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(Module.KeyName)).ToList();
                                    foreach (WorkOperationByStages objChild in childListInActiveDraft)
                                    {
                                        List<WorkOperationByStages> GrandChildListInActiveDraft = new List<WorkOperationByStages>();
                                        GrandChildListInActiveDraft = operationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(objChild.KeyName)).ToList();
                                        if (GrandChildListInActiveDraft.Count == 0)
                                        { // If it is child and Active
                                            if (objChild.IdStatus == 1535)
                                            {
                                                FlagAddItemModule = true;
                                                break;
                                            }
                                            else
                                            {
                                                FlagAddItemModule = false;
                                            }

                                        }
                                        else
                                        {
                                            if (GrandChildListInActiveDraft.Count > 0)
                                            {
                                                if (GrandChildListInActiveDraft.Where(i => i.IdStatus == 1535).Count() > 0)
                                                {
                                                    FlagAddItemModule = true;
                                                    break;
                                                }
                                                else
                                                {
                                                    FlagAddItemModule = false;
                                                }
                                            }
                                        }
                                    }
                                }
                                #endregion  [GEOS2-5135][Rupali Sarode][18-12-2023]

                                if (FlagAddItemModule == true)  //[GEOS2-5135][Rupali Sarode][18-12-2023]
                                { //[GEOS2-5135][Rupali Sarode][18-12-2023]

                                    if (standardOperationsDictionaryModules != null)
                                        eRMSOPModule.IdCpType = Convert.ToInt32(standardOperationsDictionaryModules.IdCpTypeNew);
                                    eRMSOPModule.Name = Module.Name;
                                    eRMSOPModule.IdworkOperationByStage = Module.IdworkOperationByStage;
                                    eRMSOPModule.IdSequence = Module.IdSequence;
                                    eRMSOPModule.IdStatus = Module.IdStatus;
                                    eRMSOPModule.Status = Module.Status;
                                    eRMSOPModule.Code = Module.Name;
                                    eRMSOPModule.Parent = Module.Parent;
                                    eRMSOPModule.IdParent = Module.IdParent;
                                    eRMSOPModule.KeyName = Module.KeyName;
                                    eRMSOPModule.ParentName = Module.ParentName;
                                    if (standardOperationsDictionaryModules != null)
                                    {
                                        eRMSOPModule.Position = Convert.ToUInt32(standardOperationsDictionaryModules.Position);
                                        eRMSOPModule.ModulePosition = Convert.ToUInt32(standardOperationsDictionaryModules.Position);//[GEOS2-5629][gulab lakade][10 07 2024]
                                        tempmodulepos++;//[GEOS2-5629][gulab lakade][10 07 2024]
                                    }
                                    else
                                    {
                                        eRMSOPModule.Position = Module.Position;
                                        eRMSOPModule.ModulePosition = Module.Position; //[GEOS2-5629][gulab lakade][10 07 2024]
                                    }

                                    eRMSOPModule.WorkOperation_count = Module.WorkOperation_count;
                                    eRMSOPModule.WorkOperation_count_original = Module.WorkOperation_count_original;
                                    eRMSOPModule.NameWithWorkOperationCount = Module.NameWithWorkOperationCount;
                                    //[rdixit][03.08.2022][GEOS2-3764]
                                    eRMSOPModule.IsReadOnly = Module.IsReadOnly;
                                    eRMSOPModule.IsInactiveWorkOperation = Module.IsInactiveWorkOperation;



                                    if (!GetStages.Any(a => a.Code.Equals(eRMSOPModule.Name)))
                                    {
                                        var tempActivity = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage)
                                         && w.IdCpTypeNew == Convert.ToUInt32(eRMSOPModule.IdCpType)).Select(s => s.Activity).DefaultIfEmpty(null).FirstOrDefault();
                                        var tempObservedTime = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage)
                                         && w.IdCpTypeNew == Convert.ToUInt32(eRMSOPModule.IdCpType)).Select(s => s.ObservedTime).DefaultIfEmpty(null).FirstOrDefault();


                                        #region [GEOS2-4071][Rupali Sarode][10-12-2022]

                                        var tempModule = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage)
                                        && w.IdCpTypeNew == Convert.ToUInt32(eRMSOPModule.IdCpType)).FirstOrDefault();

                                        if (tempModule != null)
                                        {
                                            if (tempModule.IdWorkoperation == Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage) && (tempActivity == null || tempActivity == 0))
                                                tempActivity = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == Module.IdworkOperationByStage && a.KeyName == Module.KeyName).Select(b => b.Activity).FirstOrDefault();   //[Cut  work operation not work properly.][gulab lakade][24 01 2023]

                                            if (tempModule.IdWorkoperation == Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage) && (tempObservedTime == null || tempObservedTime == 0))
                                                tempObservedTime = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == Module.IdworkOperationByStage && a.KeyName == Module.KeyName).Select(b => b.ObservedTime).FirstOrDefault();  //[Cut  work operation not work properly.][gulab lakade][24 01 2023]
                                        }

                                        #endregion

                                        if (tempActivity != null)
                                            eRMSOPModule.Activity = Math.Round((double)tempActivity, 2);

                                        if (tempObservedTime != null)
                                        {
                                            eRMSOPModule.ObservedTime = Math.Round((double)tempObservedTime, 2);
                                            #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                            //   eRMSOPModule.UITempobservedTime = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage)
                                            //&& w.IdCpType == Convert.ToUInt64(eRMSOPModule.IdCpType)).Select(s => s.UITempobservedTime).FirstOrDefault();

                                            #region [GEOS2-5008][gulab lakade][1 11 2023]

                                            //eRMSOPModule.UITempobservedTime = TimeSpan.FromMinutes(Convert.ToDouble(tempObservedTime));
                                            eRMSOPModule.UITempobservedTime = ConvertfloattoTimespan(Convert.ToString(Convert.ToDouble(tempObservedTime)));
                                            #endregion
                                            #endregion
                                        }

                                        eRMSOPModule.NormalTime = Math.Round(Convert.ToDouble(eRMSOPModule.ObservedTime * eRMSOPModule.Activity / 100), 2);
                                        #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                        eRMSOPModule.UITempNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(eRMSOPModule.NormalTime));

                                        #endregion
                                        //[GEOS2-3933][Rupali Sarode][21/09/2022]
                                        eRMSOPModule.WORemarks = Module.WORemarks == null ? "" : Module.WORemarks.Trim();

                                        var tempRemarks = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage)
                                         && w.IdCpTypeNew == Convert.ToUInt32(eRMSOPModule.IdCpType)).Select(s => s.Remarks).DefaultIfEmpty(null).FirstOrDefault();

                                        eRMSOPModule.Remarks = tempRemarks == null ? "" : tempRemarks.Trim();

                                    }
                                    if (GetStages.Any(a => a != null && a.Code.Trim().Equals(Module.Name.Trim())))
                                    {
                                        eRMSOPModule.IsDeleteButton = false;
                                        eRMSOPModule.IsDeleteButtonVisibility = Visibility.Hidden;
                                        // eRMSOPModule.ObservedTimeIsReadOnly =true;
                                        eRMSOPModule.IsReadOnly = true;
                                        eRMSOPModule.IsValidateOnTextInput = false;
                                        Module.IsCurrentWorkOperation = true;
                                    }
                                    else
                                    {
                                        Module.IsCurrentWorkOperation = true;
                                        //eRMSOPModule.ObservedTimeIsReadOnly = false;
                                        eRMSOPModule.IsReadOnly = false;
                                        eRMSOPModule.IsValidateOnTextInput = true;
                                    }
                                    if (Module.IdStatus == 1536)
                                    {
                                        eRMSOPModule.IsInactiveWorkOperation = true;
                                        eRMSOPModule.IsReadOnly = true;
                                    }
                                    #region Temp  check only [GEOS2-4830][gulab lakade][07 12 2023]

                                    if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(eRMSOPModule.Name.Trim())))
                                    {
                                        if (ModuleSandardOperationTime != null)
                                            eRMSOPModule.StandardSupplements = (float?)ModuleSandardOperationTime.Item2;
                                        if (tempSupplementsBoxMenu.Any(p => !listadoDuplicadas.Any(p2 => p2.Item1 == p.Item1)))
                                        {
                                            eRMSOPModule.AllSupplementsBoxMenu = AllSupplementsBoxMenu;
                                            List<float?> lst = new List<float?>();

                                            var a = ColumnsModuleList.ToList();
                                            for (int i = 0; i < a.Count(); i++)
                                            {
                                                lst.Add((float?)a[i].Item2);
                                            }

                                            if (ColumnsModuleList.Count() == 1)
                                            {
                                                eRMSOPModule.SupplementPlant1Value = (float?)lst[0];
                                            }
                                            else if (ColumnsModuleList.Count() == 2)
                                            {
                                                eRMSOPModule.SupplementPlant1Value = (float?)lst[0];
                                                eRMSOPModule.SupplementPlant2Value = (float?)lst[1];
                                            }
                                            else if (ColumnsModuleList.Count() == 3)
                                            {
                                                eRMSOPModule.SupplementPlant1Value = (float?)lst[0];
                                                eRMSOPModule.SupplementPlant2Value = (float?)lst[1];
                                                eRMSOPModule.SupplementPlant3Value = (float?)lst[2];
                                            }
                                            else if (ColumnsModuleList.Count() == 4)
                                            {
                                                eRMSOPModule.SupplementPlant1Value = (float?)lst[0];
                                                eRMSOPModule.SupplementPlant2Value = (float?)lst[1];
                                                eRMSOPModule.SupplementPlant3Value = (float?)lst[2];
                                                eRMSOPModule.SupplementPlant4Value = (float?)lst[3];
                                            }
                                            else if (ColumnsModuleList.Count() == 5)
                                            {
                                                eRMSOPModule.SupplementPlant1Value = (float?)lst[0];
                                                eRMSOPModule.SupplementPlant2Value = (float?)lst[1];
                                                eRMSOPModule.SupplementPlant3Value = (float?)lst[2];
                                                eRMSOPModule.SupplementPlant4Value = (float?)lst[3];
                                                eRMSOPModule.SupplementPlant5Value = (float?)lst[4];
                                            }
                                            else
                                            {
                                                eRMSOPModule.SupplementPlant1Value = (float?)lst[0];
                                                eRMSOPModule.SupplementPlant2Value = (float?)lst[1];
                                                eRMSOPModule.SupplementPlant3Value = (float?)lst[2];
                                                eRMSOPModule.SupplementPlant4Value = (float?)lst[3];
                                                eRMSOPModule.SupplementPlant5Value = 0;
                                                if (ColumnsModuleList.Count() > 5)
                                                {
                                                    for (int q = 4; q < ColumnsModuleList.Count(); q++)
                                                    {
                                                        if (eRMSOPModule.SupplementPlant5Value == null)
                                                            eRMSOPModule.SupplementPlant5Value = 0;
                                                        eRMSOPModule.SupplementPlant5Value = (float?)(Convert.ToDouble(eRMSOPModule.SupplementPlant5Value)) + (float?)lst[q];  ///GEOS2-4046 Gulab Lakade
                                                    }
                                                }


                                            }

                                        }

                                        if (ModuleSandardOperationTime != null)
                                            eRMSOPModule.StandardOperationTime = (float?)Math.Round(Convert.ToDouble(eRMSOPModule.NormalTime * (1 + (ModuleSandardOperationTime.Item2 / 100))), 2);
                                        #region GEOS2-3954 gulab lakade Time format HH:mm:ss

                                        eRMSOPModule.UiTempStandardOperationTimeName = ConvertfloattoTimespan(Convert.ToString(eRMSOPModule.StandardOperationTime));

                                        #endregion
                                        eRMSOPModule.OperationTimePlant1Value = (float?)Math.Round(Convert.ToDouble(eRMSOPModule.NormalTime * (1 + (Convert.ToDouble(eRMSOPModule.SupplementPlant1Value) / 100))), 2);
                                        eRMSOPModule.OperationTimePlant2Value = (float?)Math.Round(Convert.ToDouble(eRMSOPModule.NormalTime * (1 + (Convert.ToDouble(eRMSOPModule.SupplementPlant2Value) / 100))), 2);
                                        eRMSOPModule.OperationTimePlant3Value = (float?)Math.Round(Convert.ToDouble(eRMSOPModule.NormalTime * (1 + (Convert.ToDouble(eRMSOPModule.SupplementPlant3Value) / 100))), 2);

                                        eRMSOPModule.OperationTimePlant4Value = (float?)Math.Round(Convert.ToDouble(eRMSOPModule.NormalTime * (1 + (Convert.ToDouble(eRMSOPModule.SupplementPlant4Value) / 100))), 2);


                                        eRMSOPModule.OperationTimePlant5Value = (float?)Math.Round(Convert.ToDouble(eRMSOPModule.NormalTime * (1 + (Convert.ToDouble(eRMSOPModule.SupplementPlant5Value) / 100))), 2);
                                        #region GEOS2-3954 gulab lakade Time format HH:mm:ss

                                        eRMSOPModule.UiTempoperationTimePlant1Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPModule.OperationTimePlant1Value));
                                        eRMSOPModule.UiTempoperationTimePlant2Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPModule.OperationTimePlant2Value));
                                        eRMSOPModule.UiTempoperationTimePlant3Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPModule.OperationTimePlant3Value));
                                        eRMSOPModule.UiTempoperationTimePlant4Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPModule.OperationTimePlant4Value));
                                        eRMSOPModule.UiTempoperationTimePlant5Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPModule.OperationTimePlant5Value));

                                        #endregion
                                    }


                                    #endregion



                                    try
                                    {
                                        //if (!ModuleMenulistTemp.Any(a => a.KeyName.Equals(Module.KeyName)))
                                        //    ModuleMenulistTemp.Add(eRMSOPModule);
                                        if (!ModuleMenulistTemp.Any(a => a.KeyName.Equals(Module.KeyName)))
                                        {

                                            ModuleMenulistTemp.Add(eRMSOPModule);

                                        }

                                    }
                                    catch (Exception ex)
                                    {

                                    }
                                }  //[GEOS2-5135][Rupali Sarode][18-12-2023]

                            }
                        }
                    }
                    //var tempWorkOperationMenulist2 = ModuleMenulistTemp.OrderBy(x => x.Position).ToList();
                    var tempWorkOperationMenulist2 = ModuleMenulistTemp.OrderBy(x => x.ModulePosition).ToList();//[GEOS2-5629][gulab lakade][10 07 2024]
                    tempWorkOperationClonedModule = new List<ERMSOPModule>();
                    tempWorkOperationClonedModule.AddRange(tempWorkOperationMenulist2);
                    ModuleMenulistTemp.Clear();
                    ModuleMenulistTemp.AddRange(tempWorkOperationMenulist2);
                    if (tempWorkOperationMenulist2 != null)
                        tempWorkOperationMenulist2.Clear();
                    if (ModuleMenulistTemp != null)
                    {
                        var tempModuleMenulistTemp = ModuleMenulistTemp.ToList();
                        for (int i = 0; i < tempModuleMenulistTemp.Count; i++)
                        {
                            if (GetStages.Any(a => a.Code.Equals(tempModuleMenulistTemp[i].Name)))
                            {
                                List<ERMSOPModule> childList = ModuleMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(tempModuleMenulistTemp[i].KeyName)).ToList();
                                if (childList.Count == 0)
                                {
                                    // WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                                    List<WorkOperationByStages> tempWOList = WorkOperationMenulist.Where(w => w.KeyName == tempModuleMenulistTemp[i].KeyName).ToList();
                                    if (tempWOList != null)
                                        tempWOList.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                                    ModuleMenulistTemp.Remove(tempModuleMenulistTemp[i]);
                                }
                            }
                        }
                    }
                    #endregion
                }
                else if (SelectedItem is Template)
                {

                }
                #region TemplateWithCPTypes


                else if (SelectedItem is TemplateWithCPTypes)
                {
                    ModuleMenulistTemp = null;
                    WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);


                }
                #endregion

                //FillmoduleGridColumn();  //[GEOS2-4830][gulab lakade][07 12 2023]

                #endregion

                #region CustomSummarycalculation

                #region calculation
                #region [GEOS2-4830][gulab lakade][07 12 2023]


                if (ModuleMenulistTemp != null)
                    foreach (ERMSOPModule itemERMSOPModule in ModuleMenulistTemp)
                    {
                        WorkOperationMenulist.Where(w => w.KeyName == itemERMSOPModule.KeyName).ToList().ForEach(f => f.IsCurrentWorkOperation = true);
                        //[GEOS2-5135][Rupali Sarode][18-12-2023]
                        //var listCount = ModuleMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(itemERMSOPModule.KeyName) && w.IsInactiveWorkOperation == false).ToList();//[rdixit][03.08.2022][GEOS2-3764]
                        var listCount = ModuleMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(itemERMSOPModule.KeyName)).ToList();
                        if (listCount != null)
                            if (listCount.Count() > 0)
                            {
                                itemERMSOPModule.ObservedTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.ObservedTime)), 2);
                                itemERMSOPModule.NormalTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.NormalTime)), 2);
                                #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                itemERMSOPModule.UITempobservedTime = ConvertfloattoTimespan(Convert.ToString(listCount.Sum(s => s.ObservedTime)));
                                itemERMSOPModule.UITempNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(listCount.Sum(s => s.NormalTime)));
                                #endregion
                                itemERMSOPModule.IsReadOnly = true;
                            }
                    }
                #endregion
                if (ModuleMenulistTemp != null)
                    foreach (ERMSOPModule itemERMSOPModule in ModuleMenulistTemp)
                    {

                        if (GetStages.Any(a => a.Code.Equals(itemERMSOPModule.Name)))
                        {
                            ObservableCollection<ERMSOPModule> ActivitySum = new ObservableCollection<ERMSOPModule>();
                            ObservableCollection<ERMSOPModule> TempActivitySum = new ObservableCollection<ERMSOPModule>();
                            int x = 1;
                            Loop:
                            x++;
                            if (x < 10)
                            {
                                if (ActivitySum.Count == 0)
                                {
                                    itemERMSOPModule.ObservedTime = 0;
                                    itemERMSOPModule.NormalTime = 0;
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    itemERMSOPModule.UITempobservedTime = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.ObservedTime));
                                    itemERMSOPModule.UITempNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(itemERMSOPModule.NormalTime));
                                    #endregion
                                    //[GEOS2-5135][Rupali Sarode][18-12-2023]
                                    //  var ActivitySumList = ModuleMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(itemERMSOPModule.KeyName) && w.IsInactiveWorkOperation == false).ToList();//[rdixit][03.08.2022][GEOS2-3764]
                                    var ActivitySumList = ModuleMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(itemERMSOPModule.KeyName)).ToList();
                                    ActivitySum.AddRange(ActivitySumList);
                                }
                                else
                                {

                                }


                                goto Loop;
                            }

                            double? ObservedTime = 0;
                            double? NormalTime = 0;
                            float? StandardTime = 0;
                            // string OperationTimePlant1Name =null;
                            float? OperationTimePlant1Value = 0;
                            float? OperationTimePlant2Value = 0;
                            float? OperationTimePlant3Value = 0;
                            float? OperationTimePlant4Value = 0;
                            float? OperationTimePlant5Value = 0;
                            var tempDistinctList = ActivitySum.Select(xa => xa.KeyName).Distinct().ToList();
                            foreach (var item in tempDistinctList)
                            {
                                if (itemERMSOPModule.ObservedTime == null)
                                    itemERMSOPModule.ObservedTime = 0;
                                double? tempObservedTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.ObservedTime).FirstOrDefault();
                                if (tempObservedTime != null)
                                {
                                    ObservedTime = Math.Round(Convert.ToDouble(ObservedTime + tempObservedTime), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    itemERMSOPModule.UITempobservedTime = ConvertfloattoTimespan(Convert.ToString(ObservedTime));
                                    #endregion
                                }
                                if (itemERMSOPModule.NormalTime == null)
                                    itemERMSOPModule.NormalTime = 0;
                                double? tempNormalTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.NormalTime).FirstOrDefault();
                                if (tempNormalTime != null)
                                {
                                    NormalTime = Math.Round(Convert.ToDouble(NormalTime + tempNormalTime), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    itemERMSOPModule.UITempNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(NormalTime));
                                    #endregion
                                }

                                //if (itemERMSOPModule.OperationTimePlant1Name != null)
                                //    OperationTimePlant1Name = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.OperationTimePlant1Name).FirstOrDefault();

                            }
                            itemERMSOPModule.ObservedTime = ObservedTime;
                            itemERMSOPModule.NormalTime = NormalTime;
                            #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                            itemERMSOPModule.UITempobservedTime = ConvertfloattoTimespan(Convert.ToString(ObservedTime));
                            itemERMSOPModule.UITempNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(itemERMSOPModule.NormalTime));
                            #endregion
                            //itemERMSOPModule.NormalTime = Math.Round(Convert.ToDouble(ObservedTime * itemERMSOPModule.Activity / 100), 2);
                            #region PlantValue


                            foreach (var item in tempDistinctList)
                            {
                                if (itemERMSOPModule.StandardOperationTime == null)
                                    itemERMSOPModule.StandardOperationTime = 0;
                                float? tempStandardTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.StandardOperationTime).FirstOrDefault();

                                if (tempStandardTime != null)
                                {
                                    StandardTime = StandardTime + tempStandardTime;
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    itemERMSOPModule.UiTempStandardOperationTimeName = (ConvertfloattoTimespan(Convert.ToString(StandardTime)));
                                    #endregion
                                }


                                if (itemERMSOPModule.OperationTimePlant1Value == null)
                                {
                                    itemERMSOPModule.OperationTimePlant1Value = 0;

                                }

                                float? tempOperationTimePlant1Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.OperationTimePlant1Value).FirstOrDefault();
                                if (tempOperationTimePlant1Value != null)
                                {
                                    OperationTimePlant1Value = OperationTimePlant1Value + tempOperationTimePlant1Value;

                                }


                                if (itemERMSOPModule.OperationTimePlant2Value == null)
                                {
                                    itemERMSOPModule.OperationTimePlant2Value = 0;
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    itemERMSOPModule.UiTempoperationTimePlant2Value = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.OperationTimePlant2Value));
                                    #endregion
                                }

                                float? tempOperationTimePlant2Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.OperationTimePlant2Value).FirstOrDefault();
                                if (tempOperationTimePlant2Value != null)
                                {
                                    OperationTimePlant2Value = OperationTimePlant2Value + tempOperationTimePlant2Value;
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    itemERMSOPModule.UiTempoperationTimePlant2Value = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.OperationTimePlant2Value));
                                    #endregion
                                }


                                if (itemERMSOPModule.OperationTimePlant3Value == null)
                                {
                                    itemERMSOPModule.OperationTimePlant3Value = 0;
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    itemERMSOPModule.UiTempoperationTimePlant3Value = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.OperationTimePlant3Value));
                                    #endregion
                                }

                                float? tempOperationTimePlant3Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.OperationTimePlant3Value).FirstOrDefault();
                                if (tempOperationTimePlant3Value != null)
                                {
                                    OperationTimePlant3Value = OperationTimePlant3Value + tempOperationTimePlant3Value;
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    itemERMSOPModule.UiTempoperationTimePlant3Value = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.OperationTimePlant3Value));
                                    #endregion
                                }


                                if (itemERMSOPModule.OperationTimePlant4Value == null)
                                {
                                    itemERMSOPModule.OperationTimePlant4Value = 0;
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    itemERMSOPModule.UiTempoperationTimePlant4Value = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.OperationTimePlant4Value));
                                    #endregion
                                }

                                float? tempOperationTimePlant4Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.OperationTimePlant4Value).FirstOrDefault();
                                if (tempOperationTimePlant4Value != null)
                                {
                                    OperationTimePlant4Value = OperationTimePlant4Value + tempOperationTimePlant4Value;
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    itemERMSOPModule.UiTempoperationTimePlant4Value = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.OperationTimePlant4Value));
                                    #endregion
                                }


                                if (itemERMSOPModule.OperationTimePlant5Value == null)
                                    itemERMSOPModule.OperationTimePlant5Value = 0;
                                float? tempOperationTimePlant5Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.OperationTimePlant5Value).FirstOrDefault();
                                if (tempOperationTimePlant5Value != null)
                                    OperationTimePlant5Value = OperationTimePlant5Value + tempOperationTimePlant5Value;
                            }
                            #endregion
                            itemERMSOPModule.StandardOperationTime = (float?)Math.Round(Convert.ToDouble(StandardTime), 2);
                            #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                            itemERMSOPModule.UiTempStandardOperationTimeName = (ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.StandardOperationTime)));
                            #endregion
                            itemERMSOPModule.OperationTimePlant1Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant1Value), 2);
                            itemERMSOPModule.OperationTimePlant2Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant2Value), 2);
                            itemERMSOPModule.OperationTimePlant3Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant3Value), 2);
                            itemERMSOPModule.OperationTimePlant4Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant4Value), 2);
                            itemERMSOPModule.OperationTimePlant5Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant5Value), 2);
                            #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                            itemERMSOPModule.UiTempoperationTimePlant1Value = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.OperationTimePlant1Value));
                            //itemERMSOPModule.UiTempoperationTimePlant1Value = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.OperationTimePlant1Value)).ToString(@"mm\:ss");
                            itemERMSOPModule.UiTempoperationTimePlant2Value = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.OperationTimePlant2Value));
                            itemERMSOPModule.UiTempoperationTimePlant3Value = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.OperationTimePlant3Value));
                            itemERMSOPModule.UiTempoperationTimePlant4Value = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.OperationTimePlant4Value));
                            itemERMSOPModule.UiTempoperationTimePlant5Value = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.OperationTimePlant5Value));
                            #endregion

                        }
                    }
                #endregion
                ModuleMenulist = ModuleMenulistTemp;
                #endregion



                // CustomSummarycalculation();
                if (ModuleMenulist != null)
                    ModuleMenulistCloned = ModuleMenulist;
                #region [GEOS2-5853][gulab lakade][11 07 2024]
                //ModuleMenulist = new ObservableCollection<ERMSOPModule>(ModuleMenulist.GroupBy(i => i.IdParent)
                //              .SelectMany(group => group.Select((item, index) =>
                //              {
                //                  item.ModulePosition = (uint)(index + 1); return item;
                //              })).ToList());
                #endregion
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Method RetrieveWorkOperationsByCPTypes()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log(string.Format("Error in method RetrieveWorkOperationsByCPTypes() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        private void CustomSummaryCommandAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method CustomSummaryCommandAction()...", category: Category.Info, priority: Priority.Low);

                TreeListCustomSummaryEventArgs e = (TreeListCustomSummaryEventArgs)obj;
                if (e.SummaryItem.FieldName == "ObservedTime")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPModule temp = (ERMSOPModule)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                if (e.TotalValue != null)
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                            }

                        }

                    }
                }
                #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                if (e.SummaryItem.FieldName == "UITempobservedTime")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {

                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPModule temp = (ERMSOPModule)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                //e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                //if (e.TotalValue != null)
                                //    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                //e.TotalValue = Convert.ToDouble(ConvertTimespantoFloat1(Convert.ToString(e.TotalValue))) + Convert.ToDouble(ConvertTimespantoFloat1(Convert.ToString(e.FieldValue)));
                                #region Time changes 28 11 2022
                                TimeSpan temp3 = TimeSpan.Parse(e.FieldValue.ToString());
                                double TempFieldValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.FieldValue)))
                                {
                                    TempFieldValue = 0;
                                }
                                else
                                {
                                    TempFieldValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.FieldValue)).TotalMinutes);
                                }

                                double TempTotalValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.TotalValue)))
                                {
                                    TempTotalValue = 0;
                                }
                                else
                                {
                                    TempTotalValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.TotalValue)).TotalMinutes);
                                }

                                e.TotalValue = TempTotalValue + TempFieldValue;
                                if (e.TotalValue != null)
                                {
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    e.TotalValue = ConvertfloattoTimespan(Convert.ToString(e.TotalValue));

                                    #endregion

                                }
                                #endregion
                            }

                        }

                    }
                }
                if (e.SummaryItem.FieldName == "UITempNormalTime")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPModule temp = (ERMSOPModule)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                //e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                //if (e.TotalValue != null)
                                //    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);

                                #region Time changes 28 11 2022
                                TimeSpan temp3 = TimeSpan.Parse(e.FieldValue.ToString());
                                double TempFieldValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.FieldValue)))
                                {
                                    TempFieldValue = 0;
                                }
                                else
                                {
                                    TempFieldValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.FieldValue)).TotalMinutes);
                                }

                                double TempTotalValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.TotalValue)))
                                {
                                    TempTotalValue = 0;
                                }
                                else
                                {
                                    TempTotalValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.TotalValue)).TotalMinutes);
                                }

                                e.TotalValue = TempTotalValue + TempFieldValue;
                                if (e.TotalValue != null)
                                {
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    e.TotalValue = ConvertfloattoTimespan(Convert.ToString(e.TotalValue));

                                    #endregion

                                }
                                #endregion


                                //e.TotalValue = Convert.ToDouble(ConvertTimespantoFloat(TimeSpan.FromMinutes(Convert.ToDouble(e.TotalValue)))) + Convert.ToDouble(ConvertTimespantoFloat(TimeSpan.FromMinutes(Convert.ToDouble(e.FieldValue))));
                                //if (e.TotalValue != null)
                                //{
                                //    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                //    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                //    e.TotalValue = ConvertfloattoTimespan(Convert.ToString(e.TotalValue));
                                //    //if (ConvertfloattoTimespan(Convert.ToString(e.TotalValue)).Hours > 0)
                                //    //{
                                //    //    e.TotalValue = Convert.ToString(ConvertfloattoTimespan(Convert.ToString(e.TotalValue)).ToString(@"hh\:mm\:ss"));
                                //    //}
                                //    //else
                                //    //{
                                //    //    e.TotalValue = Convert.ToString(ConvertfloattoTimespan(Convert.ToString(e.TotalValue)).ToString(@"mm\:ss"));
                                //    //}
                                //    #endregion

                                //}
                            }

                        }

                    }
                }
                #endregion
                if (e.SummaryItem.FieldName == "NormalTime")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPModule temp = (ERMSOPModule)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                if (e.TotalValue != null)
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                            }

                        }

                    }
                }

                if (e.SummaryItem.FieldName == "StandardOperationTime")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPModule temp = (ERMSOPModule)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                if (e.TotalValue != null)
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                            }

                        }

                    }
                }
                #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                if (e.SummaryItem.FieldName == "UiTempStandardOperationTimeName")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {

                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPModule temp = (ERMSOPModule)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                //e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                //if (e.TotalValue != null)
                                //    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);

                                //e.TotalValue = Convert.ToDouble(ConvertTimespantoFloat(TimeSpan.FromMinutes(Convert.ToDouble(e.TotalValue)))) + Convert.ToDouble(ConvertTimespantoFloat(TimeSpan.FromMinutes(Convert.ToDouble(e.FieldValue))));
                                //if (e.TotalValue != null)
                                //{
                                //    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                //    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                //    e.TotalValue = ConvertfloattoTimespan(Convert.ToString(e.TotalValue));

                                //    //if (ConvertfloattoTimespan(Convert.ToString(e.TotalValue)).Hours > 0)
                                //    //{
                                //    //    e.TotalValue = Convert.ToString(ConvertfloattoTimespan(Convert.ToString(e.TotalValue)).ToString(@"hh\:mm\:ss"));
                                //    //}
                                //    //else
                                //    //{
                                //    //    e.TotalValue = Convert.ToString(ConvertfloattoTimespan(Convert.ToString(e.TotalValue)).ToString(@"mm\:ss"));
                                //    //}


                                //    #endregion

                                //}

                                #region Time changes 28 11 2022
                                TimeSpan temp3 = TimeSpan.Parse(e.FieldValue.ToString());
                                double TempFieldValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.FieldValue)))
                                {
                                    TempFieldValue = 0;
                                }
                                else
                                {
                                    TempFieldValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.FieldValue)).TotalMinutes);
                                }

                                double TempTotalValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.TotalValue)))
                                {
                                    TempTotalValue = 0;
                                }
                                else
                                {
                                    TempTotalValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.TotalValue)).TotalMinutes);
                                }

                                e.TotalValue = TempTotalValue + TempFieldValue;
                                if (e.TotalValue != null)
                                {
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    e.TotalValue = ConvertfloattoTimespan(Convert.ToString(e.TotalValue));

                                    #endregion

                                }
                                #endregion
                            }

                        }

                    }
                }

                #endregion
                if (e.SummaryItem.FieldName == "OperationTimePlant1Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPModule temp = (ERMSOPModule)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                if (e.TotalValue != null)
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                            }

                        }

                    }
                }


                if (e.SummaryItem.FieldName == "OperationTimePlant2Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPModule temp = (ERMSOPModule)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {

                                e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                if (e.TotalValue != null)
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                            }

                        }

                    }
                }


                if (e.SummaryItem.FieldName == "OperationTimePlant3Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPModule temp = (ERMSOPModule)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {

                                e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                if (e.TotalValue != null)
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                            }

                        }

                    }
                }

                if (e.SummaryItem.FieldName == "OperationTimePlant4Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPModule temp = (ERMSOPModule)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {

                                e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                if (e.TotalValue != null)
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                            }

                        }

                    }
                }

                #region
                if (e.SummaryItem.FieldName == "UiTempoperationTimePlant1Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPModule temp = (ERMSOPModule)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                //e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                //if (e.TotalValue != null)
                                //    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                #region Time changes 28 11 2022
                                TimeSpan temp3 = TimeSpan.Parse(e.FieldValue.ToString());
                                double TempFieldValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.FieldValue)))
                                {
                                    TempFieldValue = 0;
                                }
                                else
                                {
                                    TempFieldValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.FieldValue)).TotalMinutes);
                                }

                                double TempTotalValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.TotalValue)))
                                {
                                    TempTotalValue = 0;
                                }
                                else
                                {
                                    TempTotalValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.TotalValue)).TotalMinutes);
                                }

                                e.TotalValue = TempTotalValue + TempFieldValue;
                                if (e.TotalValue != null)
                                {
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    e.TotalValue = ConvertfloattoTimespan(Convert.ToString(e.TotalValue));

                                    #endregion

                                }
                                #endregion
                            }

                        }

                    }
                }
                if (e.SummaryItem.FieldName == "UiTempoperationTimePlant2Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPModule temp = (ERMSOPModule)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                #region Time changes 28 11 2022
                                TimeSpan temp3 = TimeSpan.Parse(e.FieldValue.ToString());
                                double TempFieldValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.FieldValue)))
                                {
                                    TempFieldValue = 0;
                                }
                                else
                                {
                                    TempFieldValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.FieldValue)).TotalMinutes);
                                }

                                double TempTotalValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.TotalValue)))
                                {
                                    TempTotalValue = 0;
                                }
                                else
                                {
                                    TempTotalValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.TotalValue)).TotalMinutes);
                                }

                                e.TotalValue = TempTotalValue + TempFieldValue;
                                if (e.TotalValue != null)
                                {
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    e.TotalValue = ConvertfloattoTimespan(Convert.ToString(e.TotalValue));

                                    #endregion

                                }
                                #endregion
                            }

                        }

                    }
                }
                if (e.SummaryItem.FieldName == "UiTempoperationTimePlant3Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPModule temp = (ERMSOPModule)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                #region Time changes 28 11 2022
                                TimeSpan temp3 = TimeSpan.Parse(e.FieldValue.ToString());
                                double TempFieldValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.FieldValue)))
                                {
                                    TempFieldValue = 0;
                                }
                                else
                                {
                                    TempFieldValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.FieldValue)).TotalMinutes);
                                }

                                double TempTotalValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.TotalValue)))
                                {
                                    TempTotalValue = 0;
                                }
                                else
                                {
                                    TempTotalValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.TotalValue)).TotalMinutes);
                                }

                                e.TotalValue = TempTotalValue + TempFieldValue;
                                if (e.TotalValue != null)
                                {
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    e.TotalValue = ConvertfloattoTimespan(Convert.ToString(e.TotalValue));

                                    #endregion

                                }
                                #endregion
                            }

                        }

                    }
                }
                if (e.SummaryItem.FieldName == "UiTempoperationTimePlant4Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPModule temp = (ERMSOPModule)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                #region Time changes 28 11 2022
                                TimeSpan temp3 = TimeSpan.Parse(e.FieldValue.ToString());
                                double TempFieldValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.FieldValue)))
                                {
                                    TempFieldValue = 0;
                                }
                                else
                                {
                                    TempFieldValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.FieldValue)).TotalMinutes);
                                }

                                double TempTotalValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.TotalValue)))
                                {
                                    TempTotalValue = 0;
                                }
                                else
                                {
                                    TempTotalValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.TotalValue)).TotalMinutes);
                                }

                                e.TotalValue = TempTotalValue + TempFieldValue;
                                if (e.TotalValue != null)
                                {
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    e.TotalValue = ConvertfloattoTimespan(Convert.ToString(e.TotalValue));

                                    #endregion

                                }
                                #endregion
                            }

                        }
                    }

                }

                if (e.SummaryItem.FieldName == "UiTempoperationTimePlant5Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPModule temp = (ERMSOPModule)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                #region Time changes 28 11 2022
                                TimeSpan temp3 = TimeSpan.Parse(e.FieldValue.ToString());
                                double TempFieldValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.FieldValue)))
                                {
                                    TempFieldValue = 0;
                                }
                                else
                                {
                                    TempFieldValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.FieldValue)).TotalMinutes);
                                }

                                double TempTotalValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.TotalValue)))
                                {
                                    TempTotalValue = 0;
                                }
                                else
                                {
                                    TempTotalValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.TotalValue)).TotalMinutes);
                                }

                                e.TotalValue = TempTotalValue + TempFieldValue;
                                if (e.TotalValue != null)
                                {
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    e.TotalValue = ConvertfloattoTimespan(Convert.ToString(e.TotalValue));

                                    #endregion

                                }
                                #endregion
                            }

                        }
                    }
                }
                #endregion
                if (e.SummaryItem.FieldName == "OperationTimePlant5Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPModule temp = (ERMSOPModule)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {

                                e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                if (e.TotalValue != null)
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                            }

                        }

                    }
                }

                GeosApplication.Instance.Logger.Log("Method CustomSummaryCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {

                GeosApplication.Instance.Logger.Log(string.Format("Error in method CustomSummaryCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        #region ModuleSummaryCalculation

        private void CustomSummarycalculation()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method CustomSummarycalculation()...", category: Category.Info, priority: Priority.Low);

                #region calculation
                #region [GEOS2-4830][gulab lakade][07 12 2023]
                //if (ModuleMenulist != null)
                //    foreach (ERMSOPModule itemERMSOPModule in ModuleMenulist)
                //    {
                //        WorkOperationMenulist.Where(w => w.KeyName == itemERMSOPModule.KeyName).ToList().ForEach(f => f.IsCurrentWorkOperation = true);
                //        var listCount = ModuleMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(itemERMSOPModule.KeyName) && w.IsInactiveWorkOperation == false).ToList();//[rdixit][03.08.2022][GEOS2-3764]
                //        if (listCount != null)
                //            if (listCount.Count() > 0)
                //            {
                //                itemERMSOPModule.ObservedTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.ObservedTime)), 2);
                //                itemERMSOPModule.NormalTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.NormalTime)), 2);
                //                #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                //                itemERMSOPModule.UITempobservedTime = ConvertfloattoTimespan(Convert.ToString(Convert.ToDouble(listCount.Sum(s => s.ObservedTime))));
                //                itemERMSOPModule.UITempNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(Convert.ToDouble(listCount.Sum(s => s.NormalTime))));
                //                #endregion
                //                itemERMSOPModule.IsReadOnly = true;
                //            }
                //    }

                if (ModuleMenulist != null)
                    foreach (ERMSOPModule itemERMSOPModule in ModuleMenulist)
                    {
                        WorkOperationMenulist.Where(w => w.KeyName == itemERMSOPModule.KeyName).ToList().ForEach(f => f.IsCurrentWorkOperation = true);
                        //[GEOS2-5135][Rupali Sarode][18-12-2023]
                        // var listCount = ModuleMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(itemERMSOPModule.KeyName) && w.IsInactiveWorkOperation == false).ToList();//[rdixit][03.08.2022][GEOS2-3764]
                        var listCount = ModuleMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(itemERMSOPModule.KeyName)).ToList();
                        if (listCount != null)
                            if (listCount.Count() > 0)
                            {
                                itemERMSOPModule.ObservedTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.ObservedTime)), 2);
                                itemERMSOPModule.NormalTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.NormalTime)), 2);
                                #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                itemERMSOPModule.UITempobservedTime = ConvertfloattoTimespan(Convert.ToString(listCount.Sum(s => s.ObservedTime)));
                                itemERMSOPModule.UITempNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(listCount.Sum(s => s.NormalTime)));
                                #endregion
                                itemERMSOPModule.IsReadOnly = true;
                            }
                    }
                #endregion
                if (ModuleMenulist != null)
                    foreach (ERMSOPModule itemERMSOPModule in ModuleMenulist)
                    {
                        //#region [GEOS2-4830][gulab lakade][07 12 2023]
                        //WorkOperationMenulist.Where(w => w.KeyName == itemERMSOPModule.KeyName).ToList().ForEach(f => f.IsCurrentWorkOperation = true);
                        //var listCount = ModuleMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(itemERMSOPModule.KeyName) && w.IsInactiveWorkOperation == false).ToList();//[rdixit][03.08.2022][GEOS2-3764]
                        //if (listCount != null)
                        //    if (listCount.Count() > 0)
                        //    {
                        //        itemERMSOPModule.ObservedTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.ObservedTime)), 2);
                        //        itemERMSOPModule.NormalTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.NormalTime)), 2);
                        //        //#region GEOS2-3954 gulab lakade Time format HH:mm:ss
                        //        //itemERMSOPModule.UITempobservedTime = ConvertfloattoTimespan(Convert.ToString(Convert.ToDouble(listCount.Sum(s => s.ObservedTime))));
                        //        //itemERMSOPModule.UITempNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(Convert.ToDouble(listCount.Sum(s => s.NormalTime))));
                        //        //#endregion
                        //        itemERMSOPModule.IsReadOnly = true;
                        //    }
                        //#endregion
                        if (GetStages.Any(a => a.Code.Equals(itemERMSOPModule.Name)))
                        {
                            ObservableCollection<ERMSOPModule> ActivitySum = new ObservableCollection<ERMSOPModule>();
                            ObservableCollection<ERMSOPModule> TempActivitySum = new ObservableCollection<ERMSOPModule>();
                            int x = 1;
                            Loop:
                            x++;
                            if (x < 10)
                            {
                                if (ActivitySum.Count == 0)
                                {
                                    itemERMSOPModule.ObservedTime = 0;
                                    itemERMSOPModule.NormalTime = 0;
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    itemERMSOPModule.UITempobservedTime = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.ObservedTime));
                                    itemERMSOPModule.UITempNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(itemERMSOPModule.NormalTime));
                                    #endregion
                                    //[GEOS2-5135][Rupali Sarode][18-12-2023]
                                    // var ActivitySumList = ModuleMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(itemERMSOPModule.KeyName) && w.IsInactiveWorkOperation == false).ToList();//[rdixit][03.08.2022][GEOS2-3764]
                                    var ActivitySumList = ModuleMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(itemERMSOPModule.KeyName)).ToList();
                                    ActivitySum.AddRange(ActivitySumList);
                                }
                                else
                                {
                                    //foreach (var item in ActivitySum)
                                    //{
                                    //    var ActivitySumList = ModuleMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(item.KeyName)).ToList();
                                    //    if (ActivitySumList != null && ActivitySumList.Count > 0)
                                    //    {

                                    //        foreach (var itemActivity in ActivitySumList)
                                    //        {
                                    //            if (!ActivitySum.Any(ac => ac.KeyName.Equals(itemActivity.KeyName)))
                                    //            {
                                    //                TempActivitySum.Add(itemActivity);
                                    //            }

                                    //        }

                                    //    }

                                    //}
                                    //ActivitySum.AddRange(TempActivitySum);
                                }


                                goto Loop;
                            }

                            double? ObservedTime = 0;
                            double? NormalTime = 0;
                            float? StandardTime = 0;
                            // string OperationTimePlant1Name =null;
                            float? OperationTimePlant1Value = 0;
                            float? OperationTimePlant2Value = 0;
                            float? OperationTimePlant3Value = 0;
                            float? OperationTimePlant4Value = 0;
                            float? OperationTimePlant5Value = 0;
                            var tempDistinctList = ActivitySum.Select(xa => xa.KeyName).Distinct().ToList();
                            foreach (var item in tempDistinctList)
                            {
                                if (itemERMSOPModule.ObservedTime == null)
                                    itemERMSOPModule.ObservedTime = 0;
                                double? tempObservedTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.ObservedTime).FirstOrDefault();
                                if (tempObservedTime != null)
                                {
                                    ObservedTime = Math.Round(Convert.ToDouble(ObservedTime + tempObservedTime), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    itemERMSOPModule.UITempobservedTime = ConvertfloattoTimespan(Convert.ToString(ObservedTime));
                                    #endregion
                                }
                                if (itemERMSOPModule.NormalTime == null)
                                    itemERMSOPModule.NormalTime = 0;
                                double? tempNormalTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.NormalTime).FirstOrDefault();
                                if (tempNormalTime != null)
                                {
                                    NormalTime = Math.Round(Convert.ToDouble(NormalTime + tempNormalTime), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    itemERMSOPModule.UITempNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(NormalTime));
                                    #endregion
                                }

                                //if (itemERMSOPModule.OperationTimePlant1Name != null)
                                //    OperationTimePlant1Name = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.OperationTimePlant1Name).FirstOrDefault();

                            }
                            itemERMSOPModule.ObservedTime = ObservedTime;
                            itemERMSOPModule.NormalTime = NormalTime;
                            #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                            itemERMSOPModule.UITempobservedTime = ConvertfloattoTimespan(Convert.ToString(ObservedTime));
                            itemERMSOPModule.UITempNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(itemERMSOPModule.NormalTime));
                            #endregion
                            //itemERMSOPModule.NormalTime = Math.Round(Convert.ToDouble(ObservedTime * itemERMSOPModule.Activity / 100), 2);
                            #region PlantValue


                            foreach (var item in tempDistinctList)
                            {
                                if (itemERMSOPModule.StandardOperationTime == null)
                                    itemERMSOPModule.StandardOperationTime = 0;
                                float? tempStandardTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.StandardOperationTime).FirstOrDefault();

                                if (tempStandardTime != null)
                                {
                                    StandardTime = StandardTime + tempStandardTime;
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    itemERMSOPModule.UiTempStandardOperationTimeName = (ConvertfloattoTimespan(Convert.ToString(StandardTime)));
                                    #endregion
                                }


                                if (itemERMSOPModule.OperationTimePlant1Value == null)
                                {
                                    itemERMSOPModule.OperationTimePlant1Value = 0;
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    //itemERMSOPModule.UiTempoperationTimePlant1Value = Convert.ToString(ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.OperationTimePlant1Value)));
                                    //itemERMSOPModule.UiTempoperationTimePlant1Value = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.OperationTimePlant1Value)).ToString(@"mm\:ss");
                                    #endregion
                                }

                                float? tempOperationTimePlant1Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.OperationTimePlant1Value).FirstOrDefault();
                                if (tempOperationTimePlant1Value != null)
                                {
                                    OperationTimePlant1Value = OperationTimePlant1Value + tempOperationTimePlant1Value;
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    //itemERMSOPModule.UiTempoperationTimePlant1Value = Convert.ToString(ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.OperationTimePlant1Value)));
                                    //itemERMSOPModule.UiTempoperationTimePlant1Value = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.OperationTimePlant1Value)).ToString(@"mm\:ss");
                                    #endregion
                                }


                                if (itemERMSOPModule.OperationTimePlant2Value == null)
                                {
                                    itemERMSOPModule.OperationTimePlant2Value = 0;
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    itemERMSOPModule.UiTempoperationTimePlant2Value = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.OperationTimePlant2Value));
                                    #endregion
                                }

                                float? tempOperationTimePlant2Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.OperationTimePlant2Value).FirstOrDefault();
                                if (tempOperationTimePlant2Value != null)
                                {
                                    OperationTimePlant2Value = OperationTimePlant2Value + tempOperationTimePlant2Value;
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    itemERMSOPModule.UiTempoperationTimePlant2Value = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.OperationTimePlant2Value));
                                    #endregion
                                }


                                if (itemERMSOPModule.OperationTimePlant3Value == null)
                                {
                                    itemERMSOPModule.OperationTimePlant3Value = 0;
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    itemERMSOPModule.UiTempoperationTimePlant3Value = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.OperationTimePlant3Value));
                                    #endregion
                                }

                                float? tempOperationTimePlant3Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.OperationTimePlant3Value).FirstOrDefault();
                                if (tempOperationTimePlant3Value != null)
                                {
                                    OperationTimePlant3Value = OperationTimePlant3Value + tempOperationTimePlant3Value;
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    itemERMSOPModule.UiTempoperationTimePlant3Value = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.OperationTimePlant3Value));
                                    #endregion
                                }


                                if (itemERMSOPModule.OperationTimePlant4Value == null)
                                {
                                    itemERMSOPModule.OperationTimePlant4Value = 0;
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    itemERMSOPModule.UiTempoperationTimePlant4Value = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.OperationTimePlant4Value));
                                    #endregion
                                }

                                float? tempOperationTimePlant4Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.OperationTimePlant4Value).FirstOrDefault();
                                if (tempOperationTimePlant4Value != null)
                                {
                                    OperationTimePlant4Value = OperationTimePlant4Value + tempOperationTimePlant4Value;
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    itemERMSOPModule.UiTempoperationTimePlant4Value = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.OperationTimePlant4Value));
                                    #endregion
                                }


                                if (itemERMSOPModule.OperationTimePlant5Value == null)
                                    itemERMSOPModule.OperationTimePlant5Value = 0;
                                float? tempOperationTimePlant5Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.OperationTimePlant5Value).FirstOrDefault();
                                if (tempOperationTimePlant5Value != null)
                                    OperationTimePlant5Value = OperationTimePlant5Value + tempOperationTimePlant5Value;
                            }
                            #endregion
                            itemERMSOPModule.StandardOperationTime = (float?)Math.Round(Convert.ToDouble(StandardTime), 2);
                            #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                            itemERMSOPModule.UiTempStandardOperationTimeName = (ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.StandardOperationTime)));
                            #endregion
                            itemERMSOPModule.OperationTimePlant1Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant1Value), 2);
                            itemERMSOPModule.OperationTimePlant2Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant2Value), 2);
                            itemERMSOPModule.OperationTimePlant3Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant3Value), 2);
                            itemERMSOPModule.OperationTimePlant4Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant4Value), 2);
                            itemERMSOPModule.OperationTimePlant5Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant5Value), 2);
                            #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                            itemERMSOPModule.UiTempoperationTimePlant1Value = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.OperationTimePlant1Value));
                            //itemERMSOPModule.UiTempoperationTimePlant1Value = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.OperationTimePlant1Value)).ToString(@"mm\:ss");
                            itemERMSOPModule.UiTempoperationTimePlant2Value = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.OperationTimePlant2Value));
                            itemERMSOPModule.UiTempoperationTimePlant3Value = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.OperationTimePlant3Value));
                            itemERMSOPModule.UiTempoperationTimePlant4Value = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.OperationTimePlant4Value));
                            itemERMSOPModule.UiTempoperationTimePlant5Value = ConvertfloattoTimespan(Convert.ToString(itemERMSOPModule.OperationTimePlant5Value));
                            #endregion
                            #region Commented Code
                            //itemERMSOPModule.StandardOperationTime =    (float?)Math.Round(Convert.ToDouble(StandardTime/100),2);
                            //itemERMSOPModule.OperationTimePlant1Value = (float?)Math.Round(Convert.ToDouble( OperationTimePlant1Value / 100),2);
                            //itemERMSOPModule.OperationTimePlant2Value = (float?)Math.Round(Convert.ToDouble( OperationTimePlant2Value / 100),2);
                            //itemERMSOPModule.OperationTimePlant3Value = (float?)Math.Round(Convert.ToDouble( OperationTimePlant3Value / 100),2);
                            //itemERMSOPModule.OperationTimePlant4Value = (float?)Math.Round(Convert.ToDouble( OperationTimePlant4Value / 100),2);
                            //itemERMSOPModule.OperationTimePlant5Value = (float?)Math.Round(Convert.ToDouble( OperationTimePlant5Value / 100),2);

                            //var listadoDuplicadas = from c in AllSupplementsBoxMenu
                            //                        join c2 in AllSupplementsBoxMenu on c.Item2 equals c2.Item2
                            //                        where c != c2
                            //                        select c;

                            //var ModuleSandardOperationTime = listadoDuplicadas.FirstOrDefault();
                            //var tempSupplementsBoxMenu = AllSupplementsBoxMenu;
                            //var ColumnsModuleList = tempSupplementsBoxMenu.Where(p => !listadoDuplicadas.Any(p2 => p2.Item1 == p.Item1)).ToList();
                            //List<string> lst = new List<string>();

                            //var a = ColumnsModuleList.ToList();
                            //for (int i = 0; i < a.Count(); i++)
                            //{
                            //    lst.Add((string)a[i].Item1.ToString());
                            //}
                            //if (ColumnsModuleList.Count() == 1)
                            //{
                            //    SupplementPlant1Name = (string)lst[0] + " Sum: {0}";
                            //    SupplementPlant1NameVisibility = true;
                            //    SupplementPlant2NameVisibility = false;
                            //    SupplementPlant3NameVisibility = false;
                            //    SupplementPlant4NameVisibility = false;
                            //    SupplementPlant5NameVisibility = false;
                            //}
                            //else if (ColumnsModuleList.Count() == 2)
                            //{
                            //    SupplementPlant1Name = (string)lst[0] + " Sum: {0}";
                            //    SupplementPlant2Name = (string)lst[1] + " Sum: {0}";
                            //    SupplementPlant1NameVisibility = true;
                            //    SupplementPlant2NameVisibility = true;
                            //    SupplementPlant3NameVisibility = false;
                            //    SupplementPlant4NameVisibility = false;
                            //    SupplementPlant5NameVisibility = false;
                            //}
                            //else if (ColumnsModuleList.Count() == 3)
                            //{
                            //    SupplementPlant1Name = (string)lst[0] + " Sum: {0}";
                            //    SupplementPlant2Name = (string)lst[1] + " Sum: {0}";
                            //    SupplementPlant3Name = (string)lst[2] + " Sum: {0}";
                            //    SupplementPlant1NameVisibility = true;
                            //    SupplementPlant2NameVisibility = true;
                            //    SupplementPlant3NameVisibility = true;
                            //    SupplementPlant4NameVisibility = false;
                            //    SupplementPlant5NameVisibility = false;
                            //}
                            //else if (ColumnsModuleList.Count() == 4)
                            //{
                            //    SupplementPlant1Name = (string)lst[0] + " Sum: {0}";
                            //    SupplementPlant2Name = (string)lst[1] + " Sum: {0}";
                            //    SupplementPlant3Name = (string)lst[2] + " Sum: {0}";
                            //    SupplementPlant4Name = (string)lst[3] + " Sum: {0}";
                            //    SupplementPlant1NameVisibility = true;
                            //    SupplementPlant2NameVisibility = true;
                            //    SupplementPlant3NameVisibility = true;
                            //    SupplementPlant4NameVisibility = true;


                            //}
                            //else //if (ColumnsModuleList.Count() == 5)
                            //{
                            //    if (ColumnsModuleList.Count()>0)
                            //    {
                            //        SupplementPlant1Name = (string)lst[0] + " Sum: {0}";
                            //        SupplementPlant2Name = (string)lst[1] + " Sum: {0}";
                            //        SupplementPlant3Name = (string)lst[2] + " Sum: {0}";
                            //        SupplementPlant4Name = (string)lst[3] + " Sum: {0}";
                            //        SupplementPlant1NameVisibility = true;
                            //        SupplementPlant2NameVisibility = true;
                            //        SupplementPlant3NameVisibility = true;
                            //        SupplementPlant4NameVisibility = true;
                            //        SupplementPlant5NameVisibility = true;

                            //    }

                            //}
                            #endregion
                        }
                    }
                #endregion

                GeosApplication.Instance.Logger.Log("Method CustomSummarycalculation()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log(string.Format("Error in method CustomSummarycalculation() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

            }

        }
        #endregion

        private void EditValueChangedCommandAction(EditValueChangedEventArgs obj)
        {
            try
            {
                if (obj != null)
                {


                }
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log(string.Format("Error in method EditValueChangedCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                //throw;
            }
        }


        private void ModuleGridParentMenuTreeList_CellValueChangedCommandAction(object sender)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ModuleGridParentMenuTreeList_CellValueChangedCommandAction()...", category: Category.Info, priority: Priority.Low);

                if (sender is DevExpress.Xpf.Grid.TreeList.TreeListCellValueChangedEventArgs)
                {
                    if (sender != null)
                    {
                        FlagToDragDrop = true;  //[GEOS2-3909][Rupali Sarode][11-11-2022]
                        IsEnabledSaveButton = true;
                        SaveButtonVisibility = Visibility.Visible;
                        TreeListCellValueChangedEventArgs obj = (TreeListCellValueChangedEventArgs)sender;
                        if (!obj.Cell.Property.Equals("Remarks"))  //[GEOS2-4108][Rupali Sarode][6-1-2023]
                        {
                            if (obj.Value != null)
                            {
                                double? NewValue;
                                if (obj.Cell.Property.Equals("UITempobservedTime"))
                                {
                                    //tempnewvalue = ConvertTimespantoFloat(TimeSpan.FromMinutes(Convert.ToDouble(obj.Value)));
                                    NewValue = Math.Round(Convert.ToDouble(TimeSpan.Parse(Convert.ToString(obj.Value)).TotalMinutes), 2); // ConvertTimespantoFloat(TimeSpan.Parse(obj.Value));
                                }
                                else
                                {
                                    NewValue = Math.Round(Convert.ToDouble(Convert.ToString(obj.Value)), 2);
                                }
                                //double? NewValue = Math.Round(Convert.ToDouble(string.IsNullOrEmpty(obj.Value.ToString()) ? 0 : obj.Value), 2);
                                #region GEOS2-3954 gulab lakade Time format HH:mm:ss

                                //double? NewValue = 0;
                                //double? NewValue = Math.Round(Convert.ToDouble(tempnewvalue),2);
                                //if (Convert.ToString(obj.Value).Contains(":"))
                                //{
                                //    NewValue = Math.Round(Convert.ToDouble(string.IsNullOrEmpty(tempnewvalue.ToString()) ? 0 : tempnewvalue), 2);
                                //}
                                //else
                                //{
                                //    NewValue = Math.Round(Convert.ToDouble(string.IsNullOrEmpty(obj.Value.ToString()) ? 0 : obj.Value), 2);
                                //}

                                #endregion
                                if (NewValue != null)
                                    if (obj.Cell.Property.Equals("ObservedTime"))
                                    {
                                        //var tempModuleMenulist= ModuleMenulist.Where(w => w.IdworkOperationByStage == SelectedModuleMenuItem.IdworkOperationByStage).ToList();
                                        ModuleMenulist.Where(w => w.IdworkOperationByStage == SelectedModuleMenuItem.IdworkOperationByStage).ToList().ForEach(f => f.ObservedTime = NewValue);
                                        //ModuleMenulist.Where(w => w.KeyName == SelectedModuleMenuItem.KeyName).ToList().ForEach(f => f.ObservedTime = NewValue);
                                    }
                                    else if (obj.Cell.Property.Equals("Activity"))
                                    {
                                        ModuleMenulist.Where(w => w.IdworkOperationByStage == SelectedModuleMenuItem.IdworkOperationByStage).ToList().ForEach(f => f.Activity = NewValue);
                                    }
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    else if (obj.Cell.Property.Equals("UITempobservedTime"))
                                    {
                                        try
                                        {
                                            ModuleMenulist.Where(w => w.IdworkOperationByStage == SelectedModuleMenuItem.IdworkOperationByStage).ToList().ForEach(f => f.ObservedTime = NewValue);
                                            ModuleMenulist.Where(w => w.IdworkOperationByStage == SelectedModuleMenuItem.IdworkOperationByStage).ToList().ForEach(f => f.UITempobservedTime = ConvertfloattoTimespan(Convert.ToString(NewValue)));
                                        }
                                        catch (Exception ex) { }

                                    }
                                #endregion
                            }
                        }

                        if (!obj.Cell.Property.Equals("Remarks"))  //[GEOS2-4108][Rupali Sarode][6-1-2023]
                            CustomSummarycalculation();
                    }
                }

                GeosApplication.Instance.Logger.Log("Method ModuleGridParentMenuTreeList_CellValueChangedCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log(string.Format("Error in method ModuleGridParentMenuTreeList_CellValueChangedCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        private void ModuleGridParentMenuTreeList_CellValueChangingCommandAction(object sender)
        {

        }

        private void CellChanged(TreeListCellValueChangedEventArgs e)
        {
            try
            {
                var currentRow = e.Row as ERMSOPModule; //current row
                var currentNode = e.Node; //current node
            }
            catch (Exception ex)
            {

                GeosApplication.Instance.Logger.Log(string.Format("Error in method CellChanged() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        #region GEOS2-3882
        private void RefreshModuleGridAfterSave()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method RefreshModuleGridAfterSave()...", category: Category.Info, priority: Priority.Low);

                //SelectedItemOld = SelectedItem;
                //SelectedItemOldclone = SelectedItem;
                standardOperationsDictionaryModulesDeleteList = new List<StandardOperationsDictionaryModules>();
                ERMSOPModuleDeleteList = new List<ERMSOPModule>();
                ERMSOPModuleDeleteParentList = new List<ERMSOPModule>();

                //SelectedItemOldDetection = SelectedItemDetection;
                //SelectedItemOldcloneDetection = SelectedItemDetection;
                standardOperationsDictionaryDetectionDeleteList = new List<StandardOperationsDictionaryDetection>();
                ERMSOPDetectionDeleteList = new List<ERMSOPDetection>();
                ERMSOPDetectionDeleteParentList = new List<ERMSOPDetection>();

                //#region GEOS2-3837
                //SelectedItemOldOption = SelectedItemOption;
                //SelectedItemOldcloneOption = SelectedItemOption;
                standardOperationsDictionaryOptionDeleteList = new List<StandardOperationsDictionaryOption>();
                ERMSOPOptionDeleteList = new List<ERMSOPOptions>();
                ERMSOPOptionDeleteParentList = new List<ERMSOPOptions>();
                //#endregion

                //#region GEOS2-3838 - Way
                //SelectedItemOldWay = SelectedItemWay;
                //SelectedItemOldcloneWay = SelectedItemWay;
                standardOperationsDictionaryWayDeleteList = new List<StandardOperationsDictionaryWays>();
                ERMSOPWayDeleteList = new List<ERMSOPWays>();
                ERMSOPWayDeleteParentList = new List<ERMSOPWays>();
                //#endregion

                //#region [GEOS2-3601]
                //SelectedItemOldStructure = SelectedItemStructures;
                //SelectedItemOldcloneStructure = SelectedItemStructures;
                standardOperationsDictionaryStructureDeleteList = new List<StandardOperationsDictionaryStructures>();
                ERMSOPStructureDeleteList = new List<ERMSOPStructures>();
                ERMSOPStructureDeleteParentList = new List<ERMSOPStructures>();
                //#endregion

                //#region GEOS2-4033 Spare Part Gulab Lakade
                //SelectedItemOldSparePart = SelectedItemSparePart;
                //SelectedItemOldcloneSparePart = SelectedItemSparePart;
                standardOperationsDictionarySparePartDeleteList = new List<StandardOperationsDictionarySparePart>();
                ERMSOPSparePartDeleteList = new List<ERMSOPSpareParts>();
                ERMSOPSparePartDeleteParentList = new List<ERMSOPSpareParts>();
                //#endregion

                //StandardOperationsDictionary temp = (ERMService.GetStandardOperationsDictionaryDetail_V2290(ClonedSOD.IdStandardOperationsDictionary));

                //[GEOS2-3933][Rupali Sarode][2/09/2022]
                //StandardOperationsDictionary temp = (ERMService.GetStandardOperationsDictionaryDetail_V2301(ClonedSOD.IdStandardOperationsDictionary));
                // StandardOperationsDictionary temp = (ERMService.GetStandardOperationsDictionaryDetail_V2320(ClonedSOD.IdStandardOperationsDictionary));

                //GEOS2-4033 Spare Part Gulab Lakade
                //StandardOperationsDictionary temp = (ERMService.GetStandardOperationsDictionaryDetail_V2340(ClonedSOD.IdStandardOperationsDictionary));

                //[GEOS2-5135][Rupali Sarode][19-12-2023]
                //IERMService ERMService = new ERMServiceController("localhost:6699");
                //StandardOperationsDictionary temp = (ERMService.GetStandardOperationsDictionaryDetail_V2460(ClonedSOD.IdStandardOperationsDictionary));
                //StandardOperationsDictionary temp = (ERMService.GetStandardOperationsDictionaryDetail_V2530(ClonedSOD.IdStandardOperationsDictionary));
                StandardOperationsDictionary temp = (ERMService.GetStandardOperationsDictionaryDetail_V2540(ClonedSOD.IdStandardOperationsDictionary));

                //GEOS2-3903 -gulab lakade
                ClonedSOD = (StandardOperationsDictionary)temp.Clone();


                Description = temp.Description;
                //GEOS2-3854 gulab lakade [use log]
                // Tempdescription = temp.Description;
                oldDescription = string.IsNullOrEmpty(Description) ? "" : Description;
                Description_en = temp.Description;
                Description_es = temp.Description_es;
                Description_fr = temp.Description_fr;
                Description_pt = temp.Description_pt;
                Description_ro = temp.Description_ro;
                Description_ru = temp.Description_ru;
                Description_zh = temp.Description_zh;

                Name = temp.Name;
                //GEOS2-3854 gulab lakade [use log]
                //Tempname = temp.Name;
                oldName = string.IsNullOrEmpty(Name) ? "" : Name;
                Name_en = temp.Name;
                Name_es = temp.Name_es;
                Name_fr = temp.Name_fr;
                Name_pt = temp.Name_pt;
                Name_ro = temp.Name_ro;
                Name_ru = temp.Name_ru;
                Name_zh = temp.Name_zh;

                if (StatusList != null)
                    SelectedStatus = StatusList.FirstOrDefault(x => x.IdLookupValue == temp.IdStatus);


                SelectedOriginalStatus = SelectedStatus;
                tempLstStandardOperationsDictionaryModules = new List<StandardOperationsDictionaryModules>();
                tempLstStandardOperationsDictionaryModules = temp.LstStandardOperationsDictionaryModules;
                tempLstStandardOperationsDictionaryDetection = new List<StandardOperationsDictionaryDetection>();
                tempLstStandardOperationsDictionaryDetection = temp.LstStandardOperationsDictionaryDetection;
                ////GEOS2-3837 gulab lakade
                tempLstStandardOperationsDictionaryOption = new List<StandardOperationsDictionaryOption>();
                tempLstStandardOperationsDictionaryOption = temp.LstStandardOperationsDictionaryOption;

                ////GEOS2-3838 - way- gulab lakade
                tempLstStandardOperationsDictionaryWay = new List<StandardOperationsDictionaryWays>();
                tempLstStandardOperationsDictionaryWay = temp.LstStandardOperationsDictionaryWay;
                //GEOS2-3855 -Supplement
                //TemplstStandardOperationsDictionarySupplement = temp.LstStandardOperationsDictionarySupplement;

                //[GEOS2-3601] - Structures
                tempLstStandardOperationsDictionaryStructures = new List<StandardOperationsDictionaryStructures>();
                tempLstStandardOperationsDictionaryStructures = temp.LstStandardOperationsDictionaryStructure;
                //GEOS2-4033 Spare Part Gulab Lakade
                tempLstStandardOperationsDictionarySparePart = new List<StandardOperationsDictionarySparePart>();
                tempLstStandardOperationsDictionarySparePart = temp.LstStandardOperationsDictionarySparePart;

                #region GEOS2-4108 [Gulab lakade] [30 12 2022]
                ISSavechanges = true;
                IsEnabledSaveButton = false;
                WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                if (ModuleMenulist != null)
                {
                    //var tempWorkOperationMenulist2 = ModuleMenulist.OrderBy(x => x.Position).ToList();
                    var tempWorkOperationMenulist2 = ModuleMenulist.OrderBy(x => x.ModulePosition).ToList();//[GEOS2-5629][gulab lakade][10 07 2024]
                    tempWorkOperationClonedModule = new List<ERMSOPModule>();
                    tempWorkOperationClonedModule.AddRange(tempWorkOperationMenulist2);

                }

                if (DetectionMenulist != null)
                {
                    //var tempWorkOperationMenulistDetection = DetectionMenulist.OrderBy(x => x.Position).ToList();
                    var tempWorkOperationMenulistDetection = DetectionMenulist.OrderBy(x => x.DetectionPosition).ToList();//[GEOS2-5629][gulab lakade][16 07 2024]
                    tempWorkOperationClonedDetection = new List<ERMSOPDetection>();
                    tempWorkOperationClonedDetection.AddRange(tempWorkOperationMenulistDetection);

                }

                if (OptionsMenulist != null)
                {
                    //var tempWorkOperationMenulistOption = OptionsMenulist.OrderBy(x => x.Position).ToList();
                    var tempWorkOperationMenulistOption = OptionsMenulist.OrderBy(x => x.OptionPosition).ToList();//[GEOS2-5629][gulab lakade][16 07 2024]
                    tempWorkOperationClonedOptions = new List<ERMSOPOptions>();
                    tempWorkOperationClonedOptions.AddRange(tempWorkOperationMenulistOption);

                }

                if (WaysMenulist != null)
                {
                    //var tempWorkOperationMenulistWays = WaysMenulist.OrderBy(x => x.Position).ToList();
                    var tempWorkOperationMenulistWays = WaysMenulist.OrderBy(x => x.WayPosition).ToList();//[GEOS2-5629][gulab lakade][16 07 2024]
                    tempWorkOperationClonedWays = new List<ERMSOPWays>();
                    tempWorkOperationClonedWays.AddRange(tempWorkOperationMenulistWays);

                }

                if (StructureMenulist != null)
                {
                    //var tempWorkOperationMenulistStructure = StructureMenulist.OrderBy(x => x.Position).ToList();
                    var tempWorkOperationMenulistStructure = StructureMenulist.OrderBy(x => x.StructurePosition).ToList();//[GEOS2-5629][gulab lakade][16 07 2024]
                    tempWorkOperationClonedStructure = new List<ERMSOPStructures>();
                    tempWorkOperationClonedStructure.AddRange(tempWorkOperationMenulistStructure);

                }

                if (SparePartsMenulist != null)
                {
                    //var tempWorkOperationMenulistSparePart = SparePartsMenulist.OrderBy(x => x.Position).ToList();
                    var tempWorkOperationMenulistSparePart = SparePartsMenulist.OrderBy(x => x.SparepartPosition).ToList();//[GEOS2-5629][gulab lakade][16 07 2024]
                    tempWorkOperationClonedSpareParts = new List<ERMSOPSpareParts>();
                    tempWorkOperationClonedSpareParts.AddRange(tempWorkOperationMenulistSparePart);

                }

                #region [GEOS2-4987][gulab lakade][26 10 2023]
                string tempSelectedName = string.Empty;
                if (SelectedTabName == "Modules")
                {
                    Saveselecteditem = "module";
                }
                else
                      if (SelectedTabName == "Detections")
                {
                    Saveselecteditem = "Detection";

                }
                else
                       if (SelectedTabName == "Options")
                {
                    Saveselecteditem = "Option";
                }
                else
                       if (SelectedTabName == "Ways")
                {
                    Saveselecteditem = "Ways";
                }
                else
                       if (SelectedTabName == "Spareparts")
                {
                    Saveselecteditem = "SparePart";
                }
                else
                       if (SelectedTabName == "Structures")
                {
                    Saveselecteditem = "Structure";
                }
                tempSelectedName = Saveselecteditem;
                //ISSavechanges = false;  //[GEOS2-4108][Rupali Sarode][02-01-2022]
                #region OldTabName!=null
                if (OldTabName != null)
                {
                    #region module
                    if (OldTabName == "Modules")
                    {
                        if (tempSelectedName == "module")
                        {
                            WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                            Modules();
                        }
                        else
                       if (tempSelectedName == "Detection")
                        {
                            Modules();
                            Saveselecteditem = tempSelectedName;
                            WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                            Detections();

                        }
                        else
                        if (tempSelectedName == "Option")
                        {
                            Modules();
                            Saveselecteditem = tempSelectedName;
                            WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                            Options();
                        }
                        else
                        if (tempSelectedName == "Ways")
                        {
                            Modules();
                            Saveselecteditem = tempSelectedName;
                            WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                            Ways();
                        }
                        else
                        if (tempSelectedName == "SparePart")
                        {
                            Modules();
                            Saveselecteditem = tempSelectedName;
                            WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                            Spareparts();
                        }
                        else
                        if (tempSelectedName == "Structure")
                        {
                            Modules();
                            Saveselecteditem = tempSelectedName;
                            WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                            Structures();
                        }

                    }
                    #endregion
                    #region Detections
                    else
                        if (OldTabName == "Detections")
                    {
                        if (tempSelectedName == "module")
                        {
                            Detections();
                            Saveselecteditem = tempSelectedName;
                            WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                            Modules();
                        }
                        else
                       if (tempSelectedName == "Detection")
                        {
                            Detections();
                            Saveselecteditem = tempSelectedName;
                            WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                            Detections();
                        }
                        else
                        if (tempSelectedName == "Option")
                        {
                            Detections();
                            Saveselecteditem = tempSelectedName;
                            WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                            Options();
                        }
                        else
                        if (tempSelectedName == "Ways")
                        {
                            Detections();
                            Saveselecteditem = tempSelectedName;
                            WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                            Ways();
                        }
                        else
                        if (tempSelectedName == "SparePart")
                        {
                            Detections();
                            Saveselecteditem = tempSelectedName;
                            WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                            Spareparts();
                        }
                        else
                        if (tempSelectedName == "Structure")
                        {
                            Detections();
                            Saveselecteditem = tempSelectedName;
                            WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                            Structures();
                        }
                    }
                    #endregion
                    #region Options
                    else
                         if (OldTabName == "Options")
                    {
                        if (tempSelectedName == "module")
                        {
                            Options();
                            Saveselecteditem = tempSelectedName;
                            WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                            Modules();
                        }
                        else
                       if (tempSelectedName == "Detection")
                        {
                            Options();
                            Saveselecteditem = tempSelectedName;
                            WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                            Detections();
                        }
                        else
                        if (tempSelectedName == "Option")
                        {
                            Saveselecteditem = tempSelectedName;
                            WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                            Options();

                        }
                        else
                        if (tempSelectedName == "Ways")
                        {
                            Options();
                            Saveselecteditem = tempSelectedName;
                            WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                            Ways();
                        }
                        else
                        if (tempSelectedName == "SparePart")
                        {
                            Options();
                            Saveselecteditem = tempSelectedName;
                            WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                            Spareparts();
                        }
                        else
                        if (tempSelectedName == "Structure")
                        {
                            Options();
                            Saveselecteditem = tempSelectedName;
                            WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                            Structures();
                        }
                    }
                    #endregion
                    #region Ways
                    else
                         if (OldTabName == "Ways")
                    {
                        if (tempSelectedName == "module")
                        {
                            Ways();
                            Saveselecteditem = tempSelectedName;
                            WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                            Modules();
                        }
                        else
                       if (tempSelectedName == "Detection")
                        {
                            Ways();
                            Saveselecteditem = tempSelectedName;
                            WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                            Detections();
                        }
                        else
                        if (tempSelectedName == "Option")
                        {
                            Ways();
                            Saveselecteditem = tempSelectedName;
                            WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                            Options();
                        }
                        else
                        if (tempSelectedName == "Ways")
                        {
                            Saveselecteditem = tempSelectedName;
                            WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                            Ways();
                        }
                        else
                        if (tempSelectedName == "SparePart")
                        {
                            Ways();
                            Saveselecteditem = tempSelectedName;
                            WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                            Spareparts();
                        }
                        else
                        if (tempSelectedName == "Structure")
                        {
                            Ways();
                            Saveselecteditem = tempSelectedName;
                            WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                            Structures();
                        }
                    }
                    #endregion
                    #region Spareparts
                    else
                         if (OldTabName == "Spareparts")
                    {
                        if (tempSelectedName == "module")
                        {
                            Spareparts();
                            Saveselecteditem = tempSelectedName;
                            WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                            Modules();
                        }
                        else
                       if (tempSelectedName == "Detection")
                        {
                            Spareparts();
                            Saveselecteditem = tempSelectedName;
                            WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                            Detections();
                        }
                        else
                        if (tempSelectedName == "Option")
                        {
                            Spareparts();
                            Saveselecteditem = tempSelectedName;
                            WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                            Options();
                        }
                        else
                        if (tempSelectedName == "Ways")
                        {
                            Spareparts();
                            Saveselecteditem = tempSelectedName;
                            WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                            Ways();
                        }
                        else
                        if (tempSelectedName == "SparePart")
                        {
                            Saveselecteditem = tempSelectedName;
                            WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);

                            Spareparts();

                        }
                        else
                        if (tempSelectedName == "Structure")
                        {
                            Spareparts();
                            Saveselecteditem = tempSelectedName;
                            WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                            Structures();
                        }
                    }
                    #endregion
                    #region Structures
                    else
                         if (OldTabName == "Structures")
                    {
                        if (tempSelectedName == "module")
                        {
                            Structures();
                            Saveselecteditem = tempSelectedName;
                            WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                            Modules();
                        }
                        else
                       if (tempSelectedName == "Detection")
                        {
                            Structures();
                            Saveselecteditem = tempSelectedName;
                            WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                            Detections();
                        }
                        else
                        if (tempSelectedName == "Option")
                        {
                            Structures();
                            Saveselecteditem = tempSelectedName;
                            WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                            Options();
                        }
                        else
                        if (tempSelectedName == "Ways")
                        {
                            Structures();
                            Saveselecteditem = tempSelectedName;
                            WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                            Ways();
                        }
                        else
                        if (tempSelectedName == "SparePart")
                        {
                            Structures();
                            Saveselecteditem = tempSelectedName;
                            WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                            Spareparts();
                        }
                        else
                        if (tempSelectedName == "Structure")
                        {
                            Saveselecteditem = tempSelectedName;
                            WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                            Structures();
                        }
                    }
                    #endregion


                }
                #endregion
                #region OldTabName==null
                else
                {
                    if (tempSelectedName == "module")
                    {
                        Saveselecteditem = tempSelectedName;
                        WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                        Modules();
                    }
                    else
                        if (tempSelectedName == "Detection")
                    {
                        Saveselecteditem = tempSelectedName;
                        WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                        Detections();
                    }
                    else
                         if (tempSelectedName == "Option")
                    {
                        Saveselecteditem = tempSelectedName;
                        WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                        Options();
                    }
                    else
                         if (tempSelectedName == "Ways")
                    {
                        Saveselecteditem = tempSelectedName;
                        WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                        Ways();
                    }
                    else
                         if (tempSelectedName == "SparePart")
                    {
                        Saveselecteditem = tempSelectedName;
                        WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                        Spareparts();
                    }
                    else
                         if (tempSelectedName == "Structure")
                    {
                        Saveselecteditem = tempSelectedName;
                        WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                        Structures();
                    }
                }
                #endregion

                #endregion

                #endregion
                #region GEOS2-3855 gulab lakade
                LstStandardOperationsDictionarySupplement = new List<StandardOperationsDictionarySupplement>();
                LstStandardOperationsDictionarySupplement = temp.LstStandardOperationsDictionarySupplement;
                tempLstStandardOperationsDictionaryChangeLogList = new List<LogentriesbyStandardOperationsDictionary>();
                tempLstStandardOperationsDictionaryChangeLogList = temp.LstStandardOperationsDictionaryChangeLogList;
                StandardOperationsDictionaryAllChangeLogList = new ObservableCollection<LogentriesbyStandardOperationsDictionary>(temp.LstStandardOperationsDictionaryChangeLogList.OrderByDescending(x => x.IdLogEntryBySOD).ToList());
                StandardOperationsDictionaryChangeLogList = null;
                StandardOperationsDictionaryChangeLogList = new ObservableCollection<LogentriesbyStandardOperationsDictionary>();
                #endregion

                //#region GEOS2-4033 Spare Part Gulab Lakade
                //SparePartsMenulist = null;
                //operationSparePartMenulist = new ObservableCollection<WorkOperationByStages>();
                //#endregion

                TmpModuleMenulist = null; //[GEOS2-3909][Rupali Sarode]
                TmpDetectionMenulist = null; //[GEOS2-3922][Rupali Sarode]
                TmpOptionMenulist = null; //[GEOS2-3924][Rupali Sarode][22-11-2022]
                TmpStructureMenulist = null; //[GEOS2-3926][Rupali Sarode][25-11-2022]
                TmpWayMenulist = null;
                TmpSparePartsMenulist = null; //[GEOS2-3925][Rupali Sarode][29-11-2022]
                TmpIdCPType = 0; //[GEOS2-3909][Rupali Sarode][07-11-2022]
                TmpIdDetection = 0; //[GEOS2-3922][Rupali Sarode][07-11-2022]
                FlagToDragDrop = false;  //[GEOS2-3909][Rupali Sarode][11-11-2022]
                TmpIdOption = 0; //[GEOS2-3924][Rupali Sarode][22-11-2022]
                TmpIdStructure = 0;  //[GEOS2-3926][Rupali Sarode][25-11-2022]
                TmpIdWayType = 0;  //[GEOS2-3923]
                TmpIdSpareParts = 0;
                ISSavechanges = false;  //[GEOS2-4108][Rupali Sarode][02-01-2022]
                GeosApplication.Instance.Logger.Log("Method RefreshModuleGridAfterSave()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method RefreshModuleGridAfterSave() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
            if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
        }

        #region [GEOS2-4987][gulab lakade][26 10 2023]
        private void Modules()
        {
            try
            {
                #region Module
                //if (Saveselecteditem == "module" || OldTabName == "Modules")
                //{
                try
                {

                    var tempItemodule = (ProductTypes)SelectedItem;

                    if (TempModuleSelectedCopy != null)
                    {
                        var tempItemoduleDragOrNot = (ProductTypes)TempModuleSelectedCopy;
                        int tempindex = tempItemoduleDragOrNot.Name.LastIndexOf("(");
                        string na = tempItemoduleDragOrNot.Name.Remove(tempindex);
                        string TempCPTypeName = Convert.ToString(tempItemoduleDragOrNot.Name.Remove(tempindex).Trim()) + "  (" + (tempLstStandardOperationsDictionaryModules.Where(x => x.IdCpTypeNew == (long)tempItemoduleDragOrNot.IdCPType).ToList().Count) + ")";
                        TemplateWithCPTypes.ToList().ForEach(x => x.ProductTypesMenu.Where(a => a.IdCPType == tempItemoduleDragOrNot.IdCPType).ToList().ForEach(p => p.Name = TempCPTypeName));
                        if (TmpModuleMenulist != null)
                        {
                            ModuleMenulist = new ObservableCollection<ERMSOPModule>();
                            ModuleMenulist.AddRange(TmpModuleMenulistOriginal);
                        }

                        TempModuleSelectedCopy = null;
                    }
                    else
                    {
                        int tempindex = tempItemodule.Name.LastIndexOf("(");
                        string na = tempItemodule.Name.Remove(tempindex);
                        string TempCPTypeName = Convert.ToString(tempItemodule.Name.Remove(tempindex).Trim()) + "  (" + (tempLstStandardOperationsDictionaryModules.Where(x => x.IdCpTypeNew == (long)tempItemodule.IdCPType).ToList().Count) + ")";
                        TemplateWithCPTypes.ToList().ForEach(x => x.ProductTypesMenu.Where(a => a.IdCPType == tempItemodule.IdCPType).ToList().ForEach(p => p.Name = TempCPTypeName));
                    }

                    try
                    {

                        var List = TemplatesMenuList.GroupBy(info => info.IdTemplate)
                               .Select(group => new
                               {
                                   Name = TemplatesMenuList.FirstOrDefault(a => a.IdTemplate == group.Key).Name,
                                   Count = TemplatesMenuList.Where(b => b.IdTemplate == null && b.IdTemplate != 24).Count(),
                               }).ToList();
                        //
                        //  ProductTypesMenulistForGridLayout = new ObservableCollection<ProductTypes>(ERMService.GetAllProductTypes_V2270().ToList().Where(a => a.Template == null || a.Template.IdTemplate != 24).ToList());

                        TemplateWithCPTypes = null;
                        if (TemplateWithCPTypes == null)
                            TemplateWithCPTypes = new ObservableCollection<TemplateWithCPTypes>();
                        if (TemplateWithCPTypes.Count() == 0)
                            foreach (var item in TemplatesMenuList)
                            {
                                TemplateWithCPTypes templateWithCPTypes = new TemplateWithCPTypes();
                                //templateWithCPTypes.Name = item.Name;
                                //[GEOS2-3909][Rupali Sarode][10-11-2022]
                                templateWithCPTypes.ProductTypesMenu = ProductTypesMenulistForGridLayout.Where(w => w.Template != null && w.Template.Name.Equals(item.Name)).ToList();

                                //foreach (var item1 in templateWithCPTypes.ProductTypesMenu)
                                //{
                                //    int CPTypecount = tempLstStandardOperationsDictionaryModules.Where(x => x.IdCpType == item1.IdCPType).ToList().Count();
                                //    item1.Name = item1.Name + "  (" + CPTypecount + ")";
                                //}

                                templateWithCPTypes.Name = item.Name + "  (" + templateWithCPTypes.ProductTypesMenu.Count() + ")";
                                TemplateWithCPTypes.Add(templateWithCPTypes);
                            }
                        #region [GEOS2-4987][gulab lakade][26 10 2023]
                        //if (SelectedTabName == "Modules")
                        //{
                        SelectedItem = ProductTypesMenulistForGridLayout.Where(x => x.IdCPType == tempItemodule.IdCPType).FirstOrDefault();

                        if (ModuleMenulist != null && ModuleMenulist.Count() > 0)
                        {
                            List<string> TempKeyNameList = ModuleMenulist.Select(a => a.KeyName).ToList();
                            if (TempKeyNameList.Count > 0)
                            {
                                WorkOperationMenulist.Where(x => TempKeyNameList.Contains(x.KeyName)).ToList().ForEach(a => a.IsCurrentWorkOperation = true);
                            }

                        }
                        //    Saveselecteditem = "module";
                        //}

                        #endregion

                        //  SelectedItem = TemplateWithCPTypes.ToList().ProductTypesMenu.Where(x => x.IdCPType == tempItemodule.IdCPType).FirstOrDefault();
                    }
                    catch (Exception ex)
                    {
                        GeosApplication.Instance.Logger.Log(string.Format("Error in Method RefreshModuleGridAfterSave() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                    }

                }
                catch (Exception ex)
                {

                }
                //SelectedItem = TemplateWithCPTypes.FirstOrDefault().ProductTypesMenu.Where(x => x.IdCPType == tempItemodule.IdCPType).FirstOrDefault();
                //}
                #endregion
            }
            catch (Exception ex)
            {

            }
        }

        private void Detections()
        {
            try
            {
                #region Detection
                //if (Saveselecteditem == "Detection" || OldTabName == "Detections")
                //{
                try
                {
                    var tempItemDetection = (ERMDetections)SelectedItemDetection;

                    try
                    {


                        if (TempDetectionSelectedCopy != null)
                        {
                            var tempItemDetectionDragOrNot = (ERMDetections)TempDetectionSelectedCopy;
                            int tempindexDetection = tempItemDetectionDragOrNot.Name.LastIndexOf("(");
                            //string na = tempItemodule.Name.Remove(tempindex);
                            UInt64 tempIdDetection = Convert.ToUInt64(tempItemDetectionDragOrNot.IdDetection);
                            string TempDetection = Convert.ToString(tempItemDetectionDragOrNot.Name.Remove(tempindexDetection).Trim()) + "  (" + (tempLstStandardOperationsDictionaryDetection.Where(x => x.IdDetection == tempIdDetection).ToList().Count) + ")";
                            DetectionGroupWithDetections.ToList().ForEach(x => x.Detections.Where(a => a.IdDetection == tempItemDetectionDragOrNot.IdDetection).ToList().ForEach(p => p.Name = TempDetection));
                            if (TmpDetectionMenulist != null)
                            {
                                DetectionMenulist = new ObservableCollection<ERMSOPDetection>();
                                DetectionMenulist.AddRange(TmpDetectionMenulistOriginal);
                            }

                            TempDetectionSelectedCopy = null;

                        }
                        else
                        {
                            int tempindexDetection = tempItemDetection.Name.LastIndexOf("(");
                            //string na = tempItemodule.Name.Remove(tempindex);
                            UInt64 tempIdDetection = Convert.ToUInt64(tempItemDetection.IdDetection);
                            string TempDetection = Convert.ToString(tempItemDetection.Name.Remove(tempindexDetection).Trim()) + "  (" + (tempLstStandardOperationsDictionaryDetection.Where(x => x.IdDetection == tempIdDetection).ToList().Count) + ")";
                            DetectionGroupWithDetections.ToList().ForEach(x => x.Detections.Where(a => a.IdDetection == tempItemDetection.IdDetection).ToList().ForEach(p => p.Name = TempDetection));
                        }

                        // DetectionsMenulistForGridLayout = new ObservableCollection<ERMDetections>(ERMService.GetAllDetections_V2280().ToList());

                        DetectionGroupWithDetections = null;
                        if (DetectionGroupWithDetections == null)
                            DetectionGroupWithDetections = new ObservableCollection<DetectionGroupWithDetections>();
                        if (DetectionGroupWithDetections.Count() == 0)
                            foreach (var item in DetectionsGroups)
                            {
                                DetectionGroupWithDetections TempDetectionGroupWithDetections = new DetectionGroupWithDetections();
                                //[GEOS2-3922][Rupali Sarode][10-11-2022]
                                //TempDetectionGroupWithDetections.Detections = detectionsMenulistForGridLayout.Where(w => w != null && w.IdGroup == item.IdGroup).ToList();
                                TempDetectionGroupWithDetections.Detections = DetectionsMenulistForGridLayout.Where(w => w != null && w.IdGroup == item.IdGroup).ToList();
                                //foreach (var item1 in TempDetectionGroupWithDetections.Detections)
                                //{
                                //    UInt64 Iddetection = Convert.ToUInt64(item1.IdDetection);
                                //    int Detectioncount = tempLstStandardOperationsDictionaryDetection.Where(x => x.IdDetection == Iddetection).ToList().Count();
                                //    item1.Name = item1.Name + "  (" + Detectioncount + ")";
                                //}

                                TempDetectionGroupWithDetections.Name = item.Name + "  (" + TempDetectionGroupWithDetections.Detections.Count() + ")";
                                DetectionGroupWithDetections.Add(TempDetectionGroupWithDetections);
                            }
                        // SelectedItemDetection = DetectionGroupWithDetections.First();
                        //SelectedItemDetection = DetectionGroupWithDetections.FirstOrDefault().Detections.Where(a => a.IdDetection == tempItemDetection.IdDetection).FirstOrDefault();
                        //if (Saveselecteditem == "Detection")
                        //{
                        #region [GEOS2-4987][gulab lakade][26 10 2023]

                        SelectedItemDetection = DetectionsMenulistForGridLayout.Where(a => a.IdDetection == tempItemDetection.IdDetection).FirstOrDefault();

                        if (DetectionMenulist != null && DetectionMenulist.Count() > 0)
                        {
                            List<string> TempKeyNameList = DetectionMenulist.Select(a => a.KeyName).ToList();
                            if (TempKeyNameList.Count > 0)
                            {
                                WorkOperationMenulist.Where(x => TempKeyNameList.Contains(x.KeyName)).ToList().ForEach(a => a.IsCurrentWorkOperation = true);
                            }

                        }


                        #endregion
                        //}
                    }
                    catch (Exception ex)
                    {

                        GeosApplication.Instance.Logger.Log(string.Format("Error in Method RefreshModuleGridAfterSave() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                    }
                }
                catch (Exception ex)
                {

                }
                //SelectedItemDetection = DetectionGroupWithDetections.FirstOrDefault().Detections.Where(a => a.IdDetection == tempItemDetection.IdDetection).FirstOrDefault();
                // }
                #endregion
            }
            catch (Exception ex)
            {

            }
        }
        private void Options()
        {
            try
            {
                #region Option
                //if (Saveselecteditem == "Option" || OldTabName == "Options")
                //{
                try
                {
                    var tempItemOption = (ERMOptions)SelectedItemOption;

                    try
                    {


                        if (TempOptionSelectedCopy != null)
                        {
                            var tempItemOptionDragOrNot = (ERMOptions)TempOptionSelectedCopy;
                            int tempindexOption = tempItemOptionDragOrNot.Name.LastIndexOf("(");
                            //string na = tempItemodule.Name.Remove(tempindex);
                            UInt64 tempIdDetection = Convert.ToUInt64(tempItemOptionDragOrNot.IdDetection);
                            string TempOption = Convert.ToString(tempItemOptionDragOrNot.Name.Remove(tempindexOption).Trim()) + "  (" + (tempLstStandardOperationsDictionaryOption.Where(x => x.IdDetection == tempIdDetection).ToList().Count) + ")";
                            DetectionGroupWithOptions.ToList().ForEach(x => x.Options.Where(a => a.IdDetection == tempItemOptionDragOrNot.IdDetection).ToList().ForEach(p => p.Name = TempOption));
                            if (TmpOptionMenulist != null)
                            {
                                OptionsMenulist = new ObservableCollection<ERMSOPOptions>();
                                OptionsMenulist.AddRange(TmpOptionMenulistOriginal);
                            }

                            TempOptionSelectedCopy = null;
                        }
                        else
                        {
                            int tempindexOption = tempItemOption.Name.LastIndexOf("(");
                            //string na = tempItemodule.Name.Remove(tempindex);
                            UInt64 tempIdDetection = Convert.ToUInt64(tempItemOption.IdDetection);
                            string TempOption = Convert.ToString(tempItemOption.Name.Remove(tempindexOption).Trim()) + "  (" + (tempLstStandardOperationsDictionaryOption.Where(x => x.IdDetection == tempIdDetection).ToList().Count) + ")";
                            DetectionGroupWithOptions.ToList().ForEach(x => x.Options.Where(a => a.IdDetection == tempItemOption.IdDetection).ToList().ForEach(p => p.Name = TempOption));
                        }


                        //   OptionsGroups = new List<ERMOptionsGroups>(ERMService.GetAllOptionGroups_V2300().ToList());

                        //[GEOS2-3924][Rupali Sarode][22-11-2022]
                        //ObservableCollection<ERMOptions> OptionsMenulistForGridLayout = new ObservableCollection<ERMOptions>(ERMService.GetAllOptions_V2300().ToList());
                        //OptionsMenulistForGridLayout = new ObservableCollection<ERMOptions>(ERMService.GetAllOptions_V2300().ToList());
                        //if (Saveselecteditem == "Option")
                        //{
                        DetectionGroupWithOptions = null;
                        if (DetectionGroupWithOptions == null)
                            DetectionGroupWithOptions = new ObservableCollection<DetectionGroupWithOptions>();
                        // if (DetectionGroupWithOptions.Count() == 0)
                        foreach (var item in OptionsGroups)
                        {
                            DetectionGroupWithOptions TempDetectionGroupWithOptions = new DetectionGroupWithOptions();
                            TempDetectionGroupWithOptions.Options = OptionsMenulistForGridLayout.Where(w => w != null && w.IdGroup == item.IdGroup).ToList();
                            #region [28 12 2022]
                            //foreach (var item1 in TempDetectionGroupWithOptions.Options)
                            //{
                            //    UInt64 Iddetection = Convert.ToUInt64(item1.IdDetection);
                            //    int OptionTypecount = tempLstStandardOperationsDictionaryOption.Where(x => x.IdDetection == Iddetection).ToList().Count();
                            //    item1.Name = item1.Name + "  (" + OptionTypecount + ")";
                            //}
                            #endregion
                            TempDetectionGroupWithOptions.Name = item.Name + "  (" + TempDetectionGroupWithOptions.Options.Count() + ")";
                            DetectionGroupWithOptions.Add(TempDetectionGroupWithOptions);
                        }
                        //  SelectedItemOption = DetectionGroupWithOptions.First();

                        //SelectedItemOption = DetectionGroupWithOptions.FirstOrDefault().Options.Where(a => a.IdDetection == tempItemOption.IdDetection).FirstOrDefault();
                        #region [GEOS2-4987][gulab lakade][26 10 2023]

                        SelectedItemOption = OptionsMenulistForGridLayout.Where(a => a.IdDetection == tempItemOption.IdDetection).FirstOrDefault();
                        if (OptionsMenulist != null && OptionsMenulist.Count() > 0)
                        {
                            List<string> TempKeyNameList = OptionsMenulist.Select(a => a.KeyName).ToList();
                            if (TempKeyNameList.Count > 0)
                            {
                                WorkOperationMenulist.Where(x => TempKeyNameList.Contains(x.KeyName)).ToList().ForEach(a => a.IsCurrentWorkOperation = true);
                            }

                        }


                        #endregion
                        //}
                    }
                    catch (Exception ex)
                    {

                        GeosApplication.Instance.Logger.Log(string.Format("Error in Method RefreshModuleGridAfterSave() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                    }
                }
                catch (Exception ex)
                {

                }
                //SelectedItemOption = DetectionGroupWithOptions.FirstOrDefault().Options.Where(a => a.IdDetection == tempItemOption.IdDetection).FirstOrDefault();
                //}

                #endregion
            }
            catch (Exception ex)
            {

            }
        }
        private void Ways()
        {
            try
            {
                #region Way
                //if (Saveselecteditem == "Ways" || OldTabName == "Ways")
                //{
                try
                {
                    var tempItemWay = (ERMWays)SelectedItemWay;

                    try
                    {


                        if (TempWaysSelectedCopy != null)
                        {
                            var tempItemWaysDragOrNot = (ERMWays)TempWaysSelectedCopy;
                            int tempindexWay = tempItemWaysDragOrNot.Name.LastIndexOf("(");
                            //string na = tempItemodule.Name.Remove(tempindex);
                            UInt64 tempIdDetection = Convert.ToUInt64(tempItemWaysDragOrNot.IdDetection);
                            string TempWay = Convert.ToString(tempItemWaysDragOrNot.Name.Remove(tempindexWay).Trim()) + "  (" + (tempLstStandardOperationsDictionaryWay.Where(x => x.IdDetection == tempIdDetection).ToList().Count) + ")";
                            DetectionGroupWithWays.ToList().ForEach(x => x.Ways.Where(a => a.IdDetection == tempItemWaysDragOrNot.IdDetection).ToList().ForEach(p => p.Name = TempWay));
                            if (TmpWayMenulist != null)
                            {
                                TmpWayMenulist = new ObservableCollection<ERMSOPWays>();
                                TmpWayMenulist.AddRange(TmpWayMenulistOriginal);
                            }

                            TempWaysSelectedCopy = null;

                        }
                        else
                        {
                            int tempindexWay = tempItemWay.Name.LastIndexOf("(");
                            //string na = tempItemodule.Name.Remove(tempindex);
                            UInt64 tempIdDetection = Convert.ToUInt64(tempItemWay.IdDetection);
                            string TempWay = Convert.ToString(tempItemWay.Name.Remove(tempindexWay).Trim()) + "  (" + (tempLstStandardOperationsDictionaryWay.Where(x => x.IdDetection == tempIdDetection).ToList().Count) + ")";
                            DetectionGroupWithWays.ToList().ForEach(x => x.Ways.Where(a => a.IdDetection == tempItemWay.IdDetection).ToList().ForEach(p => p.Name = TempWay));

                        }


                        //WaysGroups = new List<ERMWaysGroups>(ERMService.GetAllWaysGroups_V2301().ToList());

                        // ObservableCollection<ERMWays> WaysMenulistForGridLayout = new ObservableCollection<ERMWays>(ERMService.GetAllWays_V2301().ToList());
                        //if (Saveselecteditem == "Ways")
                        //{
                        DetectionGroupWithWays = null;
                        if (DetectionGroupWithWays == null)
                            DetectionGroupWithWays = new ObservableCollection<DetectionGroupWithWays>();
                        if (DetectionGroupWithWays.Count() == 0)
                        {
                            //foreach (var item in WaysGroups)
                            //{
                            //    DetectionGroupWithWays TempDetectionGroupWithWays = new DetectionGroupWithWays();
                            //    TempDetectionGroupWithWays.Ways = WaysMenulistForGridLayout.Where(w => w != null && w.IdGroup == item.IdGroup).ToList();
                            //    //#region [28 12 2022]
                            //    //foreach (var item1 in TempDetectionGroupWithWays.Ways)
                            //    //{
                            //    //    UInt64 Iddetection = Convert.ToUInt64(item1.IdDetection);
                            //    //    int WayTypecount = tempLstStandardOperationsDictionaryWay.Where(x => x.IdDetection == Iddetection).ToList().Count();
                            //    //    item1.Name = item1.Name + "  (" + WayTypecount + ")";
                            //    //}
                            //    //#endregion
                            //    TempDetectionGroupWithWays.Name = item.Name + "  (" + TempDetectionGroupWithWays.Ways.Count() + ")";
                            //    DetectionGroupWithWays.Add(TempDetectionGroupWithWays);
                            //}

                            //foreach (var item in WaysGroups)
                            //{
                            DetectionGroupWithWays TempDetectionGroupWithWays = new DetectionGroupWithWays();
                            //TempDetectionGroupWithWays.Ways = WaysMenulistForGridLayout.Where(w => w != null && w.IdGroup == item.IdGroup).ToList();
                            TempDetectionGroupWithWays.Ways = WaysMenulistForGridLayout.ToList();
                            #region [28 12 2022]
                            //foreach (var item1 in TempDetectionGroupWithWays.Ways)
                            //{
                            //    UInt64 Iddetection = Convert.ToUInt64(item1.IdDetection);
                            //    int WayTypecount = tempLstStandardOperationsDictionaryWay.Where(x => x.IdDetection == Iddetection).ToList().Count();
                            //    item1.Name = item1.Name + "  (" + WayTypecount + ")";
                            //}
                            #endregion
                            //TempDetectionGroupWithWays.Name = item.Name + "  (" + TempDetectionGroupWithWays.Ways.Count() + ")";
                            TempDetectionGroupWithWays.Name = "Ways" + "  (" + TempDetectionGroupWithWays.Ways.Count() + ")";

                            DetectionGroupWithWays.Add(TempDetectionGroupWithWays);
                        }

                        //SelectedItemWay = DetectionGroupWithWays.FirstOrDefault().Ways.Where(a => a.IdDetection == tempItemWay.IdDetection).FirstOrDefault();

                        #region [GEOS2-4987][gulab lakade][26 10 2023]

                        SelectedItemWay = WaysMenulistForGridLayout.Where(a => a.IdDetection == tempItemWay.IdDetection).FirstOrDefault();
                        if (WaysMenulist != null && WaysMenulist.Count() > 0)
                        {

                            operationWayMenulist = new ObservableCollection<WorkOperationByStages>();

                            List<string> TempKeyNameList = WaysMenulist.Select(a => a.KeyName).ToList();
                            if (TempKeyNameList.Count > 0)
                            {
                                WorkOperationMenulist.Where(x => TempKeyNameList.Contains(x.KeyName)).ToList().ForEach(a => a.IsCurrentWorkOperation = true);
                            }

                        }


                        #endregion
                        //}
                    }
                    catch (Exception ex)
                    {

                        GeosApplication.Instance.Logger.Log(string.Format("Error in Method RefreshModuleGridAfterSave() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                    }
                }
                catch (Exception ex)
                {

                }
                //  SelectedItemWay = DetectionGroupWithWays.FirstOrDefault().Ways.Where(a => a.IdDetection == tempItemWay.IdDetection).FirstOrDefault();
                // }
                #endregion
            }
            catch (Exception ex)
            {

            }
        }

        private void Spareparts()
        {
            try
            {
                #region SparePart
                //if (Saveselecteditem == "SparePart" || OldTabName == "Spareparts")
                //{
                try
                {
                    var tempItemSparePart = (ERMSpareParts)SelectedItemSparePart;

                    try
                    {
                        if (TempSparePartsSelectedCopy != null)
                        {
                            var tempItemSparePartDragOrNot = (ERMSpareParts)TempSparePartsSelectedCopy;
                            int tempindexSparePart = tempItemSparePartDragOrNot.Name.LastIndexOf("(");
                            //string na = tempItemodule.Name.Remove(tempindex);
                            UInt64 tempIdDetection = Convert.ToUInt64(tempItemSparePartDragOrNot.IdDetection);
                            string TempSparePart = Convert.ToString(tempItemSparePartDragOrNot.Name.Remove(tempindexSparePart).Trim()) + "  (" + (tempLstStandardOperationsDictionarySparePart.Where(x => x.IdDetection == tempIdDetection).ToList().Count) + ")";
                            DetectionGroupWithSpareParts.ToList().ForEach(x => x.SpareParts.Where(a => a.IdDetection == tempItemSparePartDragOrNot.IdDetection).ToList().ForEach(p => p.Name = TempSparePart));

                            if (TmpSparePartsMenulist != null)
                            {
                                SparePartsMenulist = new ObservableCollection<ERMSOPSpareParts>();
                                SparePartsMenulist.AddRange(TmpSparePartsMenulistOriginal);
                            }

                            TempSparePartsSelectedCopy = null;
                        }
                        else
                        {
                            int tempindexSparePart = tempItemSparePart.Name.LastIndexOf("(");
                            //string na = tempItemodule.Name.Remove(tempindex);
                            UInt64 tempIdDetection = Convert.ToUInt64(tempItemSparePart.IdDetection);
                            string TempSparePart = Convert.ToString(tempItemSparePart.Name.Remove(tempindexSparePart).Trim()) + "  (" + (tempLstStandardOperationsDictionarySparePart.Where(x => x.IdDetection == tempIdDetection).ToList().Count) + ")";
                            DetectionGroupWithSpareParts.ToList().ForEach(x => x.SpareParts.Where(a => a.IdDetection == tempItemSparePart.IdDetection).ToList().ForEach(p => p.Name = TempSparePart));

                        }


                        //SparePartsGroups = new List<ERMSparePartsGroups>(ERMService.GetAllSparePartGroups_V2340().ToList());

                        ////[GEOS2-3859][Rupali Sarode][28-11-2022]
                        ////ObservableCollection<ERMSpareParts> SparePartsMenulistForGridLayout = new ObservableCollection<ERMSpareParts>(ERMService.GetAllSparePart_V2340().ToList());
                        // SparePartsMenulistForGridLayout = new ObservableCollection<ERMSpareParts>(ERMService.GetAllSparePart_V2340().ToList());
                        //if (Saveselecteditem == "SparePart")
                        //{
                        DetectionGroupWithSpareParts = null;
                        if (DetectionGroupWithSpareParts == null)
                            DetectionGroupWithSpareParts = new ObservableCollection<DetectionGroupWithSpareParts>();
                        if (DetectionGroupWithSpareParts.Count() == 0)
                            foreach (var item in SparePartsGroups)
                            {
                                DetectionGroupWithSpareParts TempDetectionGroupWithSpareParts = new DetectionGroupWithSpareParts();
                                TempDetectionGroupWithSpareParts.SpareParts = SparePartsMenulistForGridLayout.Where(w => w != null && w.IdGroup == item.IdGroup).ToList();
                                #region [28 12 2022]
                                //foreach (var item1 in TempDetectionGroupWithSpareParts.SpareParts)
                                //{
                                //    UInt64 Iddetection = Convert.ToUInt64(item1.IdDetection);
                                //    int SparePartTypecount = tempLstStandardOperationsDictionarySparePart.Where(x => x.IdDetection == Iddetection).ToList().Count();
                                //    item1.Name = item1.Name + "  (" + SparePartTypecount + ")";
                                //}
                                #endregion
                                TempDetectionGroupWithSpareParts.Name = item.Name + "  (" + TempDetectionGroupWithSpareParts.SpareParts.Count() + ")";
                                DetectionGroupWithSpareParts.Add(TempDetectionGroupWithSpareParts);
                            }
                        // SelectedItemSparePart = DetectionGroupWithSpareParts.First();
                        //SelectedItemSparePart = DetectionGroupWithSpareParts.FirstOrDefault().SpareParts.Where(a => a.IdDetection == tempItemSparePart.IdDetection).FirstOrDefault();

                        #region [GEOS2-4987][gulab lakade][26 10 2023]

                        SelectedItemSparePart = SparePartsMenulistForGridLayout.Where(a => a.IdDetection == tempItemSparePart.IdDetection).FirstOrDefault();
                        if (SparePartsMenulist != null && SparePartsMenulist.Count() > 0)
                        {
                            List<string> TempKeyNameList = SparePartsMenulist.Select(a => a.KeyName).ToList();
                            if (TempKeyNameList.Count > 0)
                            {
                                WorkOperationMenulist.Where(x => TempKeyNameList.Contains(x.KeyName)).ToList().ForEach(a => a.IsCurrentWorkOperation = true);
                            }

                        }


                        #endregion
                        // }
                    }
                    catch (Exception ex)
                    {

                        GeosApplication.Instance.Logger.Log(string.Format("Error in Method RefreshModuleGridAfterSave() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                    }
                }
                catch (Exception ex)
                {

                }
                //SelectedItemSparePart = DetectionGroupWithSpareParts.FirstOrDefault().SpareParts.Where(a => a.IdDetection == tempItemSparePart.IdDetection).FirstOrDefault();
                //}
                #endregion
            }
            catch (Exception ex)
            {

            }
        }
        private void Structures()
        {
            try
            {
                #region Structure
                //if (Saveselecteditem == "Structure" || OldTabName == "Structures")
                //{
                try
                {
                    var tempItemStructures = (ERMStructures)SelectedItemStructures;

                    try
                    {


                        if (TempStructureSelectedCopy != null)
                        {
                            var tempItemStructureDragOrNot = (ERMStructures)TempStructureSelectedCopy;

                            int tempindex = tempItemStructureDragOrNot.Name.LastIndexOf("(");
                            //string na = tempItemStructures.Name.Remove(tempindex);
                            string TempStructures = Convert.ToString(tempItemStructureDragOrNot.Name.Remove(tempindex).Trim()) + "  (" + (tempLstStandardOperationsDictionaryStructures.Where(x => x.IdCpTypeNew == tempItemStructureDragOrNot.IdCPType).ToList().Count) + ")";
                            DetectionGroupWithStructures.ToList().ForEach(x => x.Structures.Where(a => a.IdCPType == tempItemStructureDragOrNot.IdCPType).ToList().ForEach(p => p.Name = TempStructures));

                            if (TmpStructureMenulist != null)
                            {
                                StructureMenulist = new ObservableCollection<ERMSOPStructures>();
                                StructureMenulist.AddRange(TmpStructureMenulistOriginal);
                            }

                            TempStructureSelectedCopy = null;
                        }
                        else
                        {
                            int tempindex = tempItemStructures.Name.LastIndexOf("(");
                            //string na = tempItemStructures.Name.Remove(tempindex);
                            string TempStructures = Convert.ToString(tempItemStructures.Name.Remove(tempindex).Trim()) + "  (" + (tempLstStandardOperationsDictionaryStructures.Where(x => x.IdCpTypeNew == tempItemStructures.IdCPType).ToList().Count) + ")";
                            DetectionGroupWithStructures.ToList().ForEach(x => x.Structures.Where(a => a.IdCPType == tempItemStructures.IdCPType).ToList().ForEach(p => p.Name = TempStructures));
                        }

                        //  StructureMenulistForGridLayout = new ObservableCollection<ERMStructures>(ERMService.GetAllStructures_V2320().ToList());
                        // DetectionGroupWithStructures
                        //if (Saveselecteditem == "Structure")
                        //{
                        DetectionGroupWithStructures = null;
                        if (DetectionGroupWithStructures == null)
                            DetectionGroupWithStructures = new ObservableCollection<DetectionGroupWithStructures>();

                        DetectionGroupWithStructures TempDetectionGroupWithStructure = new DetectionGroupWithStructures();
                        TempDetectionGroupWithStructure.Structures = StructureMenulistForGridLayout.ToList();
                        #region [28 12 2022]
                        //foreach (var item1 in TempDetectionGroupWithStructure.Structures)
                        //{
                        //    int StructureTypecount = tempLstStandardOperationsDictionaryStructures.Where(x => x.IdCpType == item1.IdCPType).ToList().Count();
                        //    item1.Name = item1.Name + "  (" + StructureTypecount + ")";
                        //}
                        #endregion
                        TempDetectionGroupWithStructure.Name = "Structures" + "  (" + TempDetectionGroupWithStructure.Structures.Count() + ")";
                        DetectionGroupWithStructures.Add(TempDetectionGroupWithStructure);

                        // SelectedItemStructures = DetectionGroupWithStructures.FirstOrDefault();
                        //SelectedItemStructures = DetectionGroupWithStructures.FirstOrDefault().Structures.Where(x => x.IdCPType == tempItemStructures.IdCPType).FirstOrDefault();

                        #region [GEOS2-4987][gulab lakade][26 10 2023]

                        SelectedItemStructures = StructureMenulistForGridLayout.Where(x => x.IdCPType == tempItemStructures.IdCPType).FirstOrDefault();
                        if (StructureMenulist != null && StructureMenulist.Count() > 0)
                        {
                            List<string> TempKeyNameList = StructureMenulist.Select(a => a.KeyName).ToList();
                            if (TempKeyNameList.Count > 0)
                            {
                                WorkOperationMenulist.Where(x => TempKeyNameList.Contains(x.KeyName)).ToList().ForEach(a => a.IsCurrentWorkOperation = true);
                            }

                        }


                        #endregion
                        //}
                    }

                    catch (Exception ex)
                    {

                        GeosApplication.Instance.Logger.Log(string.Format("Error in Method RefreshModuleGridAfterSave() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                    }
                }
                catch (Exception ex)
                {

                }
                //SelectedItemStructures = DetectionGroupWithStructures.FirstOrDefault().Structures.Where(x => x.IdCPType == tempItemStructures.IdCPType).FirstOrDefault();

                //}

                #endregion
            }
            catch (Exception ex)
            {

            }
        }
        #endregion
        #endregion
        private void RefreshModuleGrid()
        {
            try
            {
                SelectedItemOld = SelectedItem;
                SelectedItemOldclone = SelectedItem;
                standardOperationsDictionaryModulesDeleteList = new List<StandardOperationsDictionaryModules>();
                ERMSOPModuleDeleteList = new List<ERMSOPModule>();
                ERMSOPModuleDeleteParentList = new List<ERMSOPModule>();

                //SelectedPlant = new List<object>();
                //FillTemplateMenulist();
                //FillWorkOperationsStages();
                //EditInitSOD(ClonedSOD);
                //FillmoduleTemplateGridlist(tempLstStandardOperationsDictionaryModules);
                //FillmoduleGridColumn();
                //CustomSummarycalculation();
                SelectedItemOldDetection = SelectedItemDetection;
                SelectedItemOldcloneDetection = SelectedItemDetection;
                standardOperationsDictionaryDetectionDeleteList = new List<StandardOperationsDictionaryDetection>();
                ERMSOPDetectionDeleteList = new List<ERMSOPDetection>();
                ERMSOPDetectionDeleteParentList = new List<ERMSOPDetection>();

                #region GEOS2-3837
                SelectedItemOldOption = SelectedItemOption;
                SelectedItemOldcloneOption = SelectedItemOption;
                standardOperationsDictionaryOptionDeleteList = new List<StandardOperationsDictionaryOption>();
                ERMSOPOptionDeleteList = new List<ERMSOPOptions>();
                ERMSOPOptionDeleteParentList = new List<ERMSOPOptions>();
                #endregion

                #region GEOS2-3838 - Way
                SelectedItemOldWay = SelectedItemWay;
                SelectedItemOldcloneWay = SelectedItemWay;
                standardOperationsDictionaryWayDeleteList = new List<StandardOperationsDictionaryWays>();
                ERMSOPWayDeleteList = new List<ERMSOPWays>();
                ERMSOPWayDeleteParentList = new List<ERMSOPWays>();
                #endregion

                #region [GEOS2-3601]
                SelectedItemOldStructure = SelectedItemStructures;
                SelectedItemOldcloneStructure = SelectedItemStructures;
                standardOperationsDictionaryStructureDeleteList = new List<StandardOperationsDictionaryStructures>();
                ERMSOPStructureDeleteList = new List<ERMSOPStructures>();
                ERMSOPStructureDeleteParentList = new List<ERMSOPStructures>();
                #endregion

                #region GEOS2-4033 Spare Part Gulab Lakade
                SelectedItemOldSparePart = SelectedItemSparePart;
                SelectedItemOldcloneSparePart = SelectedItemSparePart;
                standardOperationsDictionarySparePartDeleteList = new List<StandardOperationsDictionarySparePart>();
                ERMSOPSparePartDeleteList = new List<ERMSOPSpareParts>();
                ERMSOPSparePartDeleteParentList = new List<ERMSOPSpareParts>();
                #endregion

                //StandardOperationsDictionary temp = (ERMService.GetStandardOperationsDictionaryDetail_V2290(ClonedSOD.IdStandardOperationsDictionary));

                //[GEOS2-3933][Rupali Sarode][2/09/2022]
                //StandardOperationsDictionary temp = (ERMService.GetStandardOperationsDictionaryDetail_V2301(ClonedSOD.IdStandardOperationsDictionary));
                // StandardOperationsDictionary temp = (ERMService.GetStandardOperationsDictionaryDetail_V2320(ClonedSOD.IdStandardOperationsDictionary));

                //GEOS2-4033 Spare Part Gulab Lakade
                // StandardOperationsDictionary temp = (ERMService.GetStandardOperationsDictionaryDetail_V2340(ClonedSOD.IdStandardOperationsDictionary));

                //[GEOS2-5135][Rupali Sarode][19-12-2023]
                StandardOperationsDictionary temp = (ERMService.GetStandardOperationsDictionaryDetail_V2460(ClonedSOD.IdStandardOperationsDictionary));

                //GEOS2-3903 -gulab lakade
                ClonedSOD = (StandardOperationsDictionary)temp.Clone();
                //LstStandardOperationsDictionarySupplement = temp.LstStandardOperationsDictionarySupplement;
                //SupplementsBoxMenu = new List<Tuple<string, float?>>();

                //foreach (Site itemPlant in SelectedPlant)
                //{

                //    if (!SupplementsBoxMenu.Any(i => i.Item1.Contains(itemPlant.Name)))
                //    {
                //        if (LstStandardOperationsDictionarySupplement != null && LstStandardOperationsDictionarySupplement.Any(supp => supp.IdPlant == itemPlant.IdSite))
                //            SupplementsBoxMenu.Add(new Tuple<string, float?>(itemPlant.Name, LstStandardOperationsDictionarySupplement.Where(supp => supp.IdPlant == itemPlant.IdSite).Sum(i => i.PlantValue)));
                //        else
                //            SupplementsBoxMenu.Add(new Tuple<string, float?>(itemPlant.Name, null));
                //    }
                //}

                Description = temp.Description;
                //GEOS2-3854 gulab lakade [use log]
                // Tempdescription = temp.Description;
                oldDescription = string.IsNullOrEmpty(Description) ? "" : Description;
                Description_en = temp.Description;
                Description_es = temp.Description_es;
                Description_fr = temp.Description_fr;
                Description_pt = temp.Description_pt;
                Description_ro = temp.Description_ro;
                Description_ru = temp.Description_ru;
                Description_zh = temp.Description_zh;

                Name = temp.Name;
                //GEOS2-3854 gulab lakade [use log]
                //Tempname = temp.Name;
                oldName = string.IsNullOrEmpty(Name) ? "" : Name;
                Name_en = temp.Name;
                Name_es = temp.Name_es;
                Name_fr = temp.Name_fr;
                Name_pt = temp.Name_pt;
                Name_ro = temp.Name_ro;
                Name_ru = temp.Name_ru;
                Name_zh = temp.Name_zh;

                if (StatusList != null)
                    SelectedStatus = StatusList.FirstOrDefault(x => x.IdLookupValue == temp.IdStatus);


                SelectedOriginalStatus = SelectedStatus;
                tempLstStandardOperationsDictionaryModules = new List<StandardOperationsDictionaryModules>();
                tempLstStandardOperationsDictionaryModules = temp.LstStandardOperationsDictionaryModules;
                tempLstStandardOperationsDictionaryDetection = new List<StandardOperationsDictionaryDetection>();
                tempLstStandardOperationsDictionaryDetection = temp.LstStandardOperationsDictionaryDetection;
                ////GEOS2-3837 gulab lakade
                tempLstStandardOperationsDictionaryOption = new List<StandardOperationsDictionaryOption>();
                tempLstStandardOperationsDictionaryOption = temp.LstStandardOperationsDictionaryOption;

                ////GEOS2-3838 - way- gulab lakade
                tempLstStandardOperationsDictionaryWay = new List<StandardOperationsDictionaryWays>();
                tempLstStandardOperationsDictionaryWay = temp.LstStandardOperationsDictionaryWay;
                //GEOS2-3855 -Supplement
                //TemplstStandardOperationsDictionarySupplement = temp.LstStandardOperationsDictionarySupplement;

                //[GEOS2-3601] - Structures
                tempLstStandardOperationsDictionaryStructures = new List<StandardOperationsDictionaryStructures>();
                tempLstStandardOperationsDictionaryStructures = temp.LstStandardOperationsDictionaryStructure;
                //GEOS2-4033 Spare Part Gulab Lakade
                tempLstStandardOperationsDictionarySparePart = new List<StandardOperationsDictionarySparePart>();
                tempLstStandardOperationsDictionarySparePart = temp.LstStandardOperationsDictionarySparePart;


                ModuleMenulist = null;
                TmpModuleMenulist = null; //[GEOS2-3909][Rupali Sarode]
                TmpDetectionMenulist = null; //[GEOS2-3922][Rupali Sarode]
                TmpOptionMenulist = null; //[GEOS2-3924][Rupali Sarode][22-11-2022]
                TmpStructureMenulist = null; //[GEOS2-3926][Rupali Sarode][25-11-2022]
                TmpWayMenulist = null;
                TmpSparePartsMenulist = null; //[GEOS2-3925][Rupali Sarode][29-11-2022]
                operationMenulist = new ObservableCollection<WorkOperationByStages>();
                DetectionMenulist = null;
                operationDetectionMenulist = new ObservableCollection<WorkOperationByStages>();
                #region GEOS2-3837
                OptionsMenulist = null;
                operationOptionMenulist = new ObservableCollection<WorkOperationByStages>();
                #endregion
                #region GEOS2-3838 - Way
                WaysMenulist = null;
                operationWayMenulist = new ObservableCollection<WorkOperationByStages>();
                #endregion
                #region [GEOS2-3601] - Structure
                StructureMenulist = null;
                operationStructureMenulist = new ObservableCollection<WorkOperationByStages>();
                #endregion

                #region GEOS2-3855 gulab lakade
                LstStandardOperationsDictionarySupplement = temp.LstStandardOperationsDictionarySupplement;
                tempLstStandardOperationsDictionaryChangeLogList = temp.LstStandardOperationsDictionaryChangeLogList;
                StandardOperationsDictionaryAllChangeLogList = new ObservableCollection<LogentriesbyStandardOperationsDictionary>(temp.LstStandardOperationsDictionaryChangeLogList.OrderByDescending(x => x.IdLogEntryBySOD).ToList());
                StandardOperationsDictionaryChangeLogList = null;
                StandardOperationsDictionaryChangeLogList = new ObservableCollection<LogentriesbyStandardOperationsDictionary>();
                #endregion

                #region GEOS2-4033 Spare Part Gulab Lakade
                SparePartsMenulist = null;
                operationSparePartMenulist = new ObservableCollection<WorkOperationByStages>();
                #endregion
                TmpIdCPType = 0; //[GEOS2-3909][Rupali Sarode][07-11-2022]
                TmpIdDetection = 0; //[GEOS2-3922][Rupali Sarode][07-11-2022]
                FlagToDragDrop = false;  //[GEOS2-3909][Rupali Sarode][11-11-2022]
                TmpIdOption = 0; //[GEOS2-3924][Rupali Sarode][22-11-2022]
                TmpIdStructure = 0;  //[GEOS2-3926][Rupali Sarode][25-11-2022]
                TmpIdWayType = 0;  //[GEOS2-3923]
                TmpIdSpareParts = 0;
            }
            catch (Exception ex) { }
        }
        #endregion
        // shubham[skadam] GEOS2-3808 Standard times in Detections per workstation (#ERM11) 07 Jul 2022
        #region GEOS2-3808

        private Visibility isAccordionControlVisibleDetection;
        public Visibility IsAccordionControlVisibleDetection
        {
            get { return isAccordionControlVisibleDetection; }
            set
            {
                isAccordionControlVisibleDetection = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsAccordionControlVisibleDetection"));
            }
        }

        private List<ERMDetectionsGroups> detectionsGroups;
        public List<ERMDetectionsGroups> DetectionsGroups
        {
            get { return detectionsGroups; }
            set
            {
                detectionsGroups = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DetectionsGroups"));
            }
        }
        ObservableCollection<DetectionGroupWithDetections> detectionGroupWithDetections;
        public ObservableCollection<DetectionGroupWithDetections> DetectionGroupWithDetections
        {
            get { return detectionGroupWithDetections; }
            set
            {
                detectionGroupWithDetections = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DetectionGroupWithDetections"));
            }
        }

        private object selectedItemOldDetection;
        public virtual object SelectedItemOldDetection
        {
            get { return selectedItemOldDetection; }
            set
            {
                selectedItemOldDetection = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedItemOldDetection"));
            }
        }
        private object selectedItemDetection;
        public virtual object SelectedItemDetection
        {
            get { return selectedItemDetection; }
            set
            {
                selectedItemDetection = value;
                #region [GEOS2-4830][gulab lakade][07 12 2023]
                //if (selectedItemDetection != null)
                //{
                //string tempobj = Convert.ToString(selectedItemDetection);
                //var temp = DetectionsGroups.Where(a => tempobj.Contains(a.Name)).ToList();
                //if(temp.Count()==0)
                //{
                RetrieveWorkOperationsByDetection();
                // }

                //}
                #endregion
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedItemDetection"));
            }
        }
        private object selectedItemOldcloneDetection;
        public virtual object SelectedItemOldcloneDetection
        {
            get { return selectedItemOldcloneDetection; }
            set
            {
                selectedItemOldcloneDetection = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedItemOldcloneDetection"));
            }
        }

        ObservableCollection<ERMSOPDetection> detectionMenulist;
        public ObservableCollection<ERMSOPDetection> DetectionMenulist
        {
            get { return detectionMenulist; }
            set
            {
                detectionMenulist = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DetectionMenulist"));
            }
        }

        ObservableCollection<ERMSOPDetection> detectionMenulistCloned;
        public ObservableCollection<ERMSOPDetection> DetectionMenulistCloned
        {
            get { return detectionMenulistCloned; }
            set
            {
                detectionMenulistCloned = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DetectionMenulistCloned"));
            }
        }
        ObservableCollection<WorkOperationByStages> operationMenuDetectionlistCloned = new ObservableCollection<WorkOperationByStages>();
        ERMSOPDetection selectedDetectionMenuItem;
        public ERMSOPDetection SelectedDetectionMenuItem
        {
            get { return selectedDetectionMenuItem; }
            set
            {
                selectedDetectionMenuItem = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedDetectionMenuItem"));
            }
        }

        private WorkOperationByStages selectedDetectionWorkOperationMenulist;
        public WorkOperationByStages SelectedDetectionWorkOperationMenulist
        {
            get { return selectedDetectionWorkOperationMenulist; }
            set
            {
                selectedDetectionWorkOperationMenulist = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedDetectionWorkOperationMenulist"));
            }

        }
        private ObservableCollection<WorkOperationByStages> workOperationDetectionMenulist;
        public ObservableCollection<WorkOperationByStages> WorkOperationDetectionMenulist
        {
            get
            {
                return workOperationDetectionMenulist;
            }

            set
            {
                workOperationDetectionMenulist = value;
                OnPropertyChanged(new PropertyChangedEventArgs("WorkOperationDetectionMenulist"));
            }
        }
        private ObservableCollection<TreeListColumn> columnsDetectionForSupplements;
        public ObservableCollection<TreeListColumn> ColumnsDetectionForSupplements
        {
            get { return columnsDetectionForSupplements; }
            set
            {
                columnsDetectionForSupplements = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ColumnsDetectionForSupplements"));
            }
        }

        private ObservableCollection<TreeListColumn> columnsDetectionOperationTime;
        public ObservableCollection<TreeListColumn> ColumnsDetectionOperationTime
        {
            get { return columnsDetectionOperationTime; }
            set
            {
                columnsDetectionOperationTime = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ColumnsDetectionOperationTime"));
            }
        }


        private void HideDetectionPanel(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method HideDetectionPanel ...", category: Category.Info, priority: Priority.Low);

                if (IsAccordionControlVisibleDetection == Visibility.Collapsed)
                    IsAccordionControlVisibleDetection = Visibility.Visible;
                else
                    IsAccordionControlVisibleDetection = Visibility.Collapsed;
                GeosApplication.Instance.Logger.Log("Method HideDetectionPanel()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method HideDetectionPanel()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        private void HideStructurePanel(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method HideStructurePanel ...", category: Category.Info, priority: Priority.Low);

                if (IsAccordionControlVisibleStructures == Visibility.Collapsed)
                    IsAccordionControlVisibleStructures = Visibility.Visible;
                else
                    IsAccordionControlVisibleStructures = Visibility.Collapsed;

                GeosApplication.Instance.Logger.Log("Method HideStructurePanel()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method HideStructurePanel()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }


        private void FillDetectionsGroupsMenulist()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillDetectionsGroupsMenulist()...", category: Category.Info, priority: Priority.Low);

                DetectionsGroups = new List<ERMDetectionsGroups>(ERMService.GetAllDetectionsGroups_V2460().ToList());
                DetectionsMenulistForGridLayout = new ObservableCollection<ERMDetections>(ERMService.GetAllDetections_V2460().ToList());

                if (DetectionGroupWithDetections == null)
                    DetectionGroupWithDetections = new ObservableCollection<DetectionGroupWithDetections>();

                if (DetectionGroupWithDetections.Count() == 0)
                {
                    // Sort groups, placing "No group" last
                    DetectionsGroups = new List<ERMDetectionsGroups>(
                        DetectionsGroups
                            .OrderBy(group => group.Name == "NO GROUP")
                            .ThenBy(group => group.Name)
                    );

                    foreach (var item in DetectionsGroups)
                    {
                        DetectionGroupWithDetections TempDetectionGroupWithDetections = new DetectionGroupWithDetections();
                        TempDetectionGroupWithDetections.Detections = DetectionsMenulistForGridLayout
                            .Where(w => w != null && w.IdGroup == item.IdGroup)
                            .OrderBy(detection => detection.Name, StringComparer.OrdinalIgnoreCase)
                            .ThenBy(detection => detection.IdDetection)
                            .ToList();

                        #region Gulab Lakade [28 12 2022]
                        foreach (var item1 in TempDetectionGroupWithDetections.Detections)
                        {
                            UInt64 Iddetection = Convert.ToUInt64(item1.IdDetection);
                            int Detectioncount = tempLstStandardOperationsDictionaryDetection
                                .Where(x => x.IdDetection == Iddetection)
                                .ToList()
                                .Count();

                            item1.Name = item1.Name + "  (" + Detectioncount + ")";
                        }
                        #endregion

                        TempDetectionGroupWithDetections.Name = item.Name + "  (" + TempDetectionGroupWithDetections.Detections.Count() + ")";
                        DetectionGroupWithDetections.Add(TempDetectionGroupWithDetections);
                    }
                }

                SelectedItemDetection = DetectionGroupWithDetections.First();

                GeosApplication.Instance.Logger.Log("Method FillDetectionsGroupsMenulist()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log($"Error in Method FillDetectionsGroupsMenulist() - {ex.Message}", category: Category.Exception, priority: Priority.Low);
            }
        }



        private void RetrieveWorkOperationsByDetection()
        {
            Saveselecteditem = "Detection";
            GeosApplication.Instance.Logger.Log("Method RetrieveWorkOperationsByDetection()...", category: Category.Info, priority: Priority.Low);

            try
            {



                if (!DXSplashScreen.IsActive)
                {
                    DXSplashScreen.Show(x =>
                    {
                        Window win = new Window()
                        {
                            ShowActivated = false,
                            WindowStyle = WindowStyle.None,
                            ResizeMode = ResizeMode.NoResize,
                            AllowsTransparency = true,
                            Background = new SolidColorBrush(Colors.Transparent),
                            ShowInTaskbar = false,
                            Topmost = true,
                            SizeToContent = SizeToContent.WidthAndHeight,
                            WindowStartupLocation = WindowStartupLocation.CenterScreen,
                        };
                        WindowFadeAnimationBehavior.SetEnableAnimation(win, true);
                        win.Topmost = false;
                        return win;
                    }, x =>
                    {
                        return new SplashScreenView() { DataContext = new SplashScreenViewModel() };
                    }, null, null);
                }
            }
            catch (Exception ex)
            {

            }
            if (ISSavechanges == true)
            {
                return;
            }
            if (IsEnabledSaveButton && SaveButtonVisibility == Visibility.Visible)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                MessageBoxResult MessageBoxResult = MessageBoxResult = CustomMessageBox.Show(string.Format(Application.Current.Resources["ArticleGridUpdateWarning"].ToString()), "Yellow", CustomMessageBox.MessageImagePath.Warning, MessageBoxButton.YesNo);
                if (MessageBoxResult == MessageBoxResult.Yes)
                {
                    if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }
                    ISSavechanges = true;
                    IsEnabledSaveButton = false;
                    SelectedItemOldcloneDetection = SelectedItemDetection;
                    SelectedItemDetection = SelectedItemOldDetection;
                    var tempSelectedItemDetection = SelectedItemOldcloneDetection;
                    SaveButtonCommandAction();
                    ISSavechanges = false;
                    SelectedItemDetection = tempSelectedItemDetection;
                    if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                    #region GEOS2-3882 Commented Code
                    //SelectedItem = SelectedItemOld;
                    //if (SelectedItemOldclone != null)
                    //    SelectedItem = SelectedItemOldclone;

                    //SelectedItemOption = SelectedItemOldOption;
                    //if (SelectedItemOldcloneOption != null)
                    //    SelectedItemOption = SelectedItemOldcloneOption;

                    //////GEOS2-3838 - Way
                    //SelectedItemWay = SelectedItemOldWay;
                    //if (SelectedItemOldcloneWay != null)
                    //    SelectedItemWay = SelectedItemOldcloneWay;

                    ////[GEOS2-3601] - Structure
                    //SelectedItemStructures = SelectedItemOldStructure;
                    //if (SelectedItemOldcloneStructure != null)
                    //    SelectedItemStructures = SelectedItemOldcloneStructure;
                    ////GEOS2-4033 Spare Part Gulab Lakade
                    //SelectedItemSparePart = SelectedItemOldSparePart;
                    //if (SelectedItemOldcloneSparePart != null)
                    //    SelectedItemSparePart = SelectedItemOldcloneSparePart;
                    #endregion
                }

                #region [GEOS2-3922][Rupali Sarode][07-11-2022]
                if (MessageBoxResult == MessageBoxResult.No)
                {
                    TmpModuleMenulist = null;
                    TmpDetectionMenulist = null;
                    TmpOptionMenulist = null;
                    TmpStructureMenulist = null;
                    TmpWayMenulist = null;
                    TmpSparePartsMenulist = null;
                    TmpIdCPType = 0;
                    TmpIdDetection = 0; //[GEOS2-3922][Rupali Sarode][07-11-2022]
                    TmpIdOption = 0;
                    TmpIdWayType = 0;
                    TmpIdStructure = 0;
                    TmpIdSpareParts = 0;
                }
                #endregion
            }

            if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
            if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }
            SelectedItemOldDetection = SelectedItemDetection;
            IsEnabledSaveButton = false;
            ModuleMenulistupdated = new ObservableCollection<ERMSOPModule>();
            ObservableCollection<ERMSOPDetection> DetectionMenulistTemp = new ObservableCollection<ERMSOPDetection>(); //[GEOS2-4830][gulab lakade][07 12 2023]
            try
            {

                if (SelectedItemDetection is ERMDetections)
                {

                    ERMDetections ermDetections = (ERMDetections)SelectedItemDetection;
                    //DetectionMenulist = null;
                    List<StandardOperationsDictionaryDetection> tempStandardOperationsDictionaryDetection = tempLstStandardOperationsDictionaryDetection.Where(w => w.IdDetection == Convert.ToUInt64(ermDetections.IdDetection)).ToList();
                    DetectionMenulist = new ObservableCollection<ERMSOPDetection>();
                    operationDetectionMenulist = new ObservableCollection<WorkOperationByStages>();
                    duplicateItemloopDetection = 0;
                    duplicateItemloop = 0;
                    if (tempStandardOperationsDictionaryDetection.Count() > 0)
                    {
                        foreach (var eRMSOPDetection in tempStandardOperationsDictionaryDetection)
                        {
                            if (eRMSOPDetection != null)
                            {
                                List<WorkOperationByStages> tempDetectionList = WorkOperationMenulist.Where(w => w.IdworkOperationByStage == Convert.ToInt32(eRMSOPDetection.IdWorkoperation) && w.Name == eRMSOPDetection.WorkOperationName).ToList(); //[Cut  work operation not work properly.][gulab lakade][24 01 2023]
                                if (tempDetectionList != null)
                                    foreach (WorkOperationByStages item in tempDetectionList)
                                    {
                                        if (item.IdStatus == 1536)//[rdixit][03.08.2022][GEOS2-3764]
                                        {
                                            item.IsInactiveWorkOperation = true;
                                            item.IsReadOnly = true;
                                        }
                                        WorkOperationByStages ParentName = WorkOperationMenulist.Where(w => w.KeyName.Equals(item.ParentName)).FirstOrDefault();
                                        if (ParentName != null)
                                        {
                                            if (!operationDetectionMenulist.Any(a => a.KeyName.Equals(ParentName.KeyName)))
                                                operationDetectionMenulist.Add(ParentName);
                                        }
                                        duplicateItemloopDetection = 0;
                                        duplicateItemloop = 0;
                                        GetAllTreeListDetection(item, WorkOperationMenulist);
                                    }

                            }

                        }
                    }
                    #region ModuleMenulist
                    WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                    #region [GEOS2-4830][gulab lakade][07 12 2023]
                    if (AllSupplementsBoxMenu != null)
                    {
                        var listadoDuplicadas = from c in AllSupplementsBoxMenu
                                                join c2 in AllSupplementsBoxMenu on c.Item2 equals c2.Item2
                                                where c != c2
                                                select c;

                        var DetectionSandardOperationTime = listadoDuplicadas.FirstOrDefault();
                        if (DetectionSandardOperationTime != null)
                        {
                            var templist = listadoDuplicadas.Where(a => a.Item2 == DetectionSandardOperationTime.Item2);
                            listadoDuplicadas = templist;
                        }

                        var tempSupplementsBoxMenu = AllSupplementsBoxMenu;

                        ColumnsDetectionForSupplements = new ObservableCollection<TreeListColumn>();
                        ColumnsDetectionForSupplements.Add(new TreeListColumn()
                        {
                            FieldName = "DetectionStandardSupplements",
                            Header = "Standard",
                            HeaderToolTip = "Standard",
                            AllowCellMerge = false,
                            Width = 150,    //gulab lakade not show Supplement proper
                            AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                            Visible = true,
                            ReadOnly = false,
                            FixedWidth = false
                        });

                        ColumnsDetectionOperationTime = new ObservableCollection<TreeListColumn>();
                        ColumnsDetectionOperationTime.Add(new TreeListColumn()
                        {
                            FieldName = "UiTempDetectionStandardOperationTimeName",
                            Header = "Standard",
                            HeaderToolTip = "Standard",
                            AllowCellMerge = false,
                            Width = 150,    //gulab lakade not show StandardOperationTime proper
                            AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                            Visible = true,
                            ReadOnly = false,
                            FixedWidth = false
                        });

                        int count = 1;
                        var ColumnsDetectionList = tempSupplementsBoxMenu.Where(p => !listadoDuplicadas.Any(p2 => p2.Item1 == p.Item1));
                        foreach (var item in ColumnsDetectionList)
                        {
                            if (count == 5)
                            {
                                ColumnsDetectionForSupplements.Add(new TreeListColumn()
                                {
                                    FieldName = "DetectionSupplementPlant" + count + "Value",
                                    Header = "Others",
                                    HeaderToolTip = "Others",
                                    AllowCellMerge = false,
                                    Width = 60,
                                    AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                    Visible = true,
                                    ReadOnly = false,
                                    FixedWidth = false
                                });
                                ColumnsDetectionOperationTime.Add(new TreeListColumn()
                                {
                                    FieldName = "UiTempDetectionOperationTimePlant" + count + "Value",
                                    Header = "Others",
                                    HeaderToolTip = "Others",
                                    AllowCellMerge = false,
                                    Width = 60,
                                    AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                    Visible = true,
                                    ReadOnly = false,
                                    FixedWidth = false
                                });
                                break;
                            }
                            if (count == 5)
                            {
                                break;
                            }
                            ColumnsDetectionForSupplements.Add(new TreeListColumn()
                            {
                                FieldName = "DetectionSupplementPlant" + count + "Value",
                                Header = item.Item1,
                                HeaderToolTip = item.Item1,
                                AllowCellMerge = false,
                                Width = 60,
                                AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                Visible = true,
                                ReadOnly = false,
                                FixedWidth = false
                            });

                            ColumnsDetectionOperationTime.Add(new TreeListColumn()
                            {
                                FieldName = "UiTempDetectionOperationTimePlant" + count + "Value",
                                Header = item.Item1,
                                HeaderToolTip = item.Item1,
                                AllowCellMerge = false,
                                Width = 60,
                                AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                Visible = true,
                                ReadOnly = false,
                                FixedWidth = false
                            });
                            count = count + 1;
                        }

                        #endregion

                        bool FlagAddItemModule = false; //[GEOS2-5135][Rupali Sarode][18-12-2023]

                        foreach (WorkOperationByStages Module in operationDetectionMenulist)
                        {
                            FlagAddItemModule = true; //[GEOS2-5135][Rupali Sarode][18-12-2023]

                            if (operationDetectionMenulist.Any(a => a.IdworkOperationByStage == Convert.ToInt64(Module.IdworkOperationByStage))
                                && operationDetectionMenulist.Any(a => a.Name.Trim().Equals(Module.Name.Trim()))
                                )
                            {
                                StandardOperationsDictionaryDetection standardOperationsDictionaryDetection = tempLstStandardOperationsDictionaryDetection.Where(w => w.IdWorkoperation == Convert.ToUInt64(Module.IdworkOperationByStage) && Module.Parent != null
                                && w.IdDetection == Convert.ToUInt64(ermDetections.IdDetection)).FirstOrDefault();
                                ERMSOPDetection eRMSOPDetection = new ERMSOPDetection();

                                #region  [GEOS2-5135][Rupali Sarode][18-12-2023]
                                // If it is child & only active then add
                                List<WorkOperationByStages> childListInActiveDraft = operationDetectionMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(Module.KeyName)).ToList();

                                if (childListInActiveDraft.Count == 0)
                                {
                                    if (Module.IdStatus == 1535)
                                    {
                                        FlagAddItemModule = true;
                                    }
                                    else
                                        FlagAddItemModule = false;
                                }
                                else // If it is parent and does not contain any active child, then do not include it
                                if (childListInActiveDraft.Count > 0)
                                {
                                    //List<WorkOperationByStages> childListInParent = operationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(Module.KeyName)).ToList();
                                    foreach (WorkOperationByStages objChild in childListInActiveDraft)
                                    {
                                        List<WorkOperationByStages> GrandChildListInActiveDraft = new List<WorkOperationByStages>();
                                        GrandChildListInActiveDraft = operationDetectionMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(objChild.KeyName)).ToList();
                                        if (GrandChildListInActiveDraft.Count == 0)
                                        { // If it is child and Active
                                            if (objChild.IdStatus == 1535)
                                            {
                                                FlagAddItemModule = true;
                                                break;
                                            }
                                            else
                                            {
                                                FlagAddItemModule = false;
                                            }

                                        }
                                        else
                                        {
                                            if (GrandChildListInActiveDraft.Count > 0)
                                            {
                                                if (GrandChildListInActiveDraft.Where(i => i.IdStatus == 1535).Count() > 0)
                                                {
                                                    FlagAddItemModule = true;
                                                    break;
                                                }
                                                else
                                                {
                                                    FlagAddItemModule = false;
                                                }
                                            }
                                        }
                                    }
                                }
                                #endregion  [GEOS2-5135][Rupali Sarode][18-12-2023]

                                if (FlagAddItemModule == true)  //[GEOS2-5135][Rupali Sarode][18-12-2023]
                                { //[GEOS2-5135][Rupali Sarode][18-12-2023]

                                    if (standardOperationsDictionaryDetection != null)
                                        eRMSOPDetection.IdDetection = standardOperationsDictionaryDetection.IdDetection;
                                    eRMSOPDetection.Name = Module.Name;
                                    eRMSOPDetection.IdworkOperationByStage = Module.IdworkOperationByStage;
                                    eRMSOPDetection.IdSequence = Module.IdSequence;
                                    eRMSOPDetection.IdStatus = Module.IdStatus;
                                    eRMSOPDetection.Status = Module.Status;
                                    eRMSOPDetection.Code = Module.Name;
                                    eRMSOPDetection.Parent = Module.Parent;
                                    eRMSOPDetection.IdParent = Module.IdParent;
                                    eRMSOPDetection.KeyName = Module.KeyName;
                                    eRMSOPDetection.ParentName = Module.ParentName;
                                    #region [GEOS2-5629][gulab lakade][15 07 2024]
                                    // eRMSOPDetection.Position = Module.Position;
                                    if (standardOperationsDictionaryDetection != null)
                                    {
                                        eRMSOPDetection.Position = Convert.ToUInt32(standardOperationsDictionaryDetection.Position);
                                        eRMSOPDetection.DetectionPosition = Convert.ToUInt32(standardOperationsDictionaryDetection.Position);//[GEOS2-5629][gulab lakade][10 07 2024]

                                    }
                                    else
                                    {
                                        eRMSOPDetection.Position = Module.Position;
                                        eRMSOPDetection.DetectionPosition = Module.Position; //[GEOS2-5629][gulab lakade][10 07 2024]
                                    }
                                    #endregion
                                    eRMSOPDetection.WorkOperation_count = Module.WorkOperation_count;
                                    eRMSOPDetection.WorkOperation_count_original = Module.WorkOperation_count_original;
                                    eRMSOPDetection.NameWithWorkOperationCount = Module.NameWithWorkOperationCount;
                                    //[rdixit][03.08.2022][GEOS2-3764]
                                    eRMSOPDetection.IsInactiveWorkOperation = Module.IsInactiveWorkOperation;
                                    eRMSOPDetection.IsReadOnly = Module.IsReadOnly;
                                    //eRMSOPDetection.NormalTime = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(Module.IdworkOperationByStage)).Select(s => s.NormalTime).DefaultIfEmpty(null).FirstOrDefault();
                                    //if (eRMSOPDetection.NormalTime != null)
                                    //    eRMSOPDetection.NormalTime = Math.Round((double)eRMSOPDetection.NormalTime, 2);
                                    //eRMSOPDetection.ObservedTime = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(Module.IdworkOperationByStage)).Select(s => s.ObservedTime).DefaultIfEmpty(null).FirstOrDefault();
                                    //if (eRMSOPDetection.ObservedTime != null)
                                    //    eRMSOPDetection.ObservedTime = Math.Round((double)eRMSOPDetection.ObservedTime, 2);
                                    //eRMSOPDetection.Activity = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(Module.IdworkOperationByStage)).Select(s => s.Activity).DefaultIfEmpty(null).FirstOrDefault(); ;
                                    //if (eRMSOPDetection.Activity != null)
                                    //    eRMSOPDetection.Activity = Math.Round((double)eRMSOPDetection.Activity, 2);

                                    if (!GetStages.Any(a => a.Code.Equals(eRMSOPDetection.Name)))
                                    {
                                        var tempActivity = tempLstStandardOperationsDictionaryDetection.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPDetection.IdworkOperationByStage)
                                         && w.IdDetection == Convert.ToUInt64(eRMSOPDetection.IdDetection)).Select(s => s.Activity).DefaultIfEmpty(null).FirstOrDefault();
                                        var tempObservedTime = tempLstStandardOperationsDictionaryDetection.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPDetection.IdworkOperationByStage)
                                         && w.IdDetection == Convert.ToUInt64(eRMSOPDetection.IdDetection)).Select(s => s.ObservedTime).DefaultIfEmpty(null).FirstOrDefault();

                                        #region [GEOS2-4073][Rupali Sarode][09-12-2022]

                                        var tempDetection = tempLstStandardOperationsDictionaryDetection.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPDetection.IdworkOperationByStage)
                                        && w.IdDetection == Convert.ToUInt64(eRMSOPDetection.IdDetection)).FirstOrDefault();

                                        if (tempDetection != null)
                                        {
                                            if (tempDetection.IdWorkoperation == Convert.ToUInt64(eRMSOPDetection.IdworkOperationByStage) && (tempActivity == null || tempActivity == 0))
                                                tempActivity = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == Module.IdworkOperationByStage && a.KeyName == Module.KeyName).Select(b => b.Activity).FirstOrDefault(); //[Cut  work operation not work properly.][gulab lakade][24 01 2023]

                                            if (tempDetection.IdWorkoperation == Convert.ToUInt64(eRMSOPDetection.IdworkOperationByStage) && (tempObservedTime == null || tempObservedTime == 0))
                                                tempObservedTime = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == Module.IdworkOperationByStage && a.KeyName == Module.KeyName).Select(b => b.ObservedTime).FirstOrDefault(); //[Cut  work operation not work properly.][gulab lakade][24 01 2023]
                                        }

                                        #endregion
                                        if (tempActivity != null)
                                            eRMSOPDetection.DetectionActivity = Math.Round((double)tempActivity, 2);
                                        if (tempObservedTime != null)
                                        {
                                            eRMSOPDetection.DetectionObservedTime = Math.Round((double)tempObservedTime, 2);
                                            //  #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                            //  eRMSOPDetection.UITempDetectionobservedTime = tempLstStandardOperationsDictionaryDetection.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPDetection.IdworkOperationByStage)
                                            //&& w.IdDetection == Convert.ToUInt64(eRMSOPDetection.IdDetection)).Select(s => s.UITempDetectionobservedTime).FirstOrDefault();
                                            //  #endregion


                                            #region [GEOS2-5008][gulab lakade][1 11 2023]
                                            //eRMSOPDetection.UITempDetectionobservedTime = TimeSpan.FromMinutes(Convert.ToDouble(tempObservedTime));
                                            eRMSOPDetection.UITempDetectionobservedTime = ConvertfloattoTimespan(Convert.ToString(Convert.ToDouble(tempObservedTime)));
                                            #endregion
                                        }
                                        eRMSOPDetection.DetectionNormalTime = Math.Round(Convert.ToDouble(eRMSOPDetection.DetectionObservedTime * eRMSOPDetection.DetectionActivity / 100), 2);
                                        #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                        eRMSOPDetection.UITempDetectionNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(eRMSOPDetection.DetectionNormalTime));
                                        #endregion
                                        //[GEOS2-3933][Rupali Sarode][22/09/2022]
                                        eRMSOPDetection.WORemarks = Module.WORemarks == null ? "" : Module.WORemarks.Trim();

                                        //[GEOS2-3933][Rupali Sarode][26/09/2022]
                                        var tempRemarks = tempLstStandardOperationsDictionaryDetection.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPDetection.IdworkOperationByStage)
                                        && w.IdDetection == Convert.ToUInt64(eRMSOPDetection.IdDetection)).Select(s => s.Remarks).DefaultIfEmpty(null).FirstOrDefault();

                                        eRMSOPDetection.Remarks = tempRemarks == null ? "" : tempRemarks.Trim();

                                    }


                                    if (GetStages.Any(a => a != null && a.Code.Trim().Equals(Module.Name.Trim())))
                                    {
                                        eRMSOPDetection.IsDeleteButton = false;
                                        eRMSOPDetection.IsDeleteButtonVisibility = Visibility.Hidden;
                                        eRMSOPDetection.IsReadOnly = true;
                                        eRMSOPDetection.IsValidateOnTextInput = false;
                                        Module.IsCurrentWorkOperation = true;
                                    }
                                    else
                                    {
                                        Module.IsCurrentWorkOperation = true;
                                        eRMSOPDetection.IsReadOnly = false;
                                        eRMSOPDetection.IsValidateOnTextInput = true;
                                    }
                                    if (Module.IdStatus == 1536)
                                    {
                                        eRMSOPDetection.IsInactiveWorkOperation = true;
                                        eRMSOPDetection.IsReadOnly = true;
                                    }
                                    #region [GEOS2-4830][gulab lakade][07 12 2023]
                                    if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(eRMSOPDetection.Name.Trim())))
                                    {
                                        if (DetectionSandardOperationTime != null)
                                            eRMSOPDetection.DetectionStandardSupplements = (float?)DetectionSandardOperationTime.Item2;
                                        if (tempSupplementsBoxMenu.Any(p => !listadoDuplicadas.Any(p2 => p2.Item1 == p.Item1)))
                                        {
                                            eRMSOPDetection.AllSupplementsBoxMenu = AllSupplementsBoxMenu;
                                            List<float?> lst = new List<float?>();

                                            var a = ColumnsDetectionList.ToList();
                                            for (int i = 0; i < a.Count(); i++)
                                            {
                                                lst.Add((float?)a[i].Item2);
                                            }

                                            if (ColumnsDetectionList.Count() == 1)
                                            {
                                                eRMSOPDetection.DetectionSupplementPlant1Value = (float?)lst[0];
                                            }
                                            else if (ColumnsDetectionList.Count() == 2)
                                            {
                                                eRMSOPDetection.DetectionSupplementPlant1Value = (float?)lst[0];
                                                eRMSOPDetection.DetectionSupplementPlant2Value = (float?)lst[1];
                                            }
                                            else if (ColumnsDetectionList.Count() == 3)
                                            {
                                                eRMSOPDetection.DetectionSupplementPlant1Value = (float?)lst[0];
                                                eRMSOPDetection.DetectionSupplementPlant2Value = (float?)lst[1];
                                                eRMSOPDetection.DetectionSupplementPlant3Value = (float?)lst[2];
                                            }
                                            else if (ColumnsDetectionList.Count() == 4)
                                            {
                                                eRMSOPDetection.DetectionSupplementPlant1Value = (float?)lst[0];
                                                eRMSOPDetection.DetectionSupplementPlant2Value = (float?)lst[1];
                                                eRMSOPDetection.DetectionSupplementPlant3Value = (float?)lst[2];
                                                eRMSOPDetection.DetectionSupplementPlant4Value = (float?)lst[3];
                                            }
                                            else if (ColumnsDetectionList.Count() == 5)
                                            {
                                                eRMSOPDetection.DetectionSupplementPlant1Value = (float?)lst[0];
                                                eRMSOPDetection.DetectionSupplementPlant2Value = (float?)lst[1];
                                                eRMSOPDetection.DetectionSupplementPlant3Value = (float?)lst[2];
                                                eRMSOPDetection.DetectionSupplementPlant4Value = (float?)lst[3];
                                                eRMSOPDetection.DetectionSupplementPlant5Value = (float?)lst[4];
                                            }
                                            else
                                            {
                                                eRMSOPDetection.DetectionSupplementPlant1Value = (float?)lst[0];
                                                eRMSOPDetection.DetectionSupplementPlant2Value = (float?)lst[1];
                                                eRMSOPDetection.DetectionSupplementPlant3Value = (float?)lst[2];
                                                eRMSOPDetection.DetectionSupplementPlant4Value = (float?)lst[3];
                                                eRMSOPDetection.DetectionSupplementPlant5Value = 0;
                                                if (ColumnsDetectionList.Count() > 5)
                                                {
                                                    for (int q = 4; q < ColumnsDetectionList.Count(); q++)
                                                    {
                                                        if (eRMSOPDetection.DetectionSupplementPlant5Value == null)
                                                            eRMSOPDetection.DetectionSupplementPlant5Value = 0;
                                                        eRMSOPDetection.DetectionSupplementPlant5Value = eRMSOPDetection.DetectionSupplementPlant5Value + (float?)lst[q];
                                                    }
                                                }


                                            }

                                        }
                                        #region GEOS2-4046 Gulab Lakade
                                        if (DetectionSandardOperationTime != null)
                                            eRMSOPDetection.DetectionStandardOperationTime = (float?)Math.Round(Convert.ToDouble(eRMSOPDetection.DetectionNormalTime * (1 + (Convert.ToDouble(DetectionSandardOperationTime.Item2) / 100))), 2);

                                        eRMSOPDetection.DetectionOperationTimePlant1Value = (float?)Math.Round(Convert.ToDouble(eRMSOPDetection.DetectionNormalTime * (1 + (Convert.ToDouble(eRMSOPDetection.DetectionSupplementPlant1Value) / 100))), 2);
                                        eRMSOPDetection.DetectionOperationTimePlant2Value = (float?)Math.Round(Convert.ToDouble(eRMSOPDetection.DetectionNormalTime * (1 + (Convert.ToDouble(eRMSOPDetection.DetectionSupplementPlant2Value) / 100))), 2);
                                        eRMSOPDetection.DetectionOperationTimePlant3Value = (float?)Math.Round(Convert.ToDouble(eRMSOPDetection.DetectionNormalTime * (1 + (Convert.ToDouble(eRMSOPDetection.DetectionSupplementPlant3Value) / 100))), 2);
                                        eRMSOPDetection.DetectionOperationTimePlant4Value = (float?)Math.Round(Convert.ToDouble(eRMSOPDetection.DetectionNormalTime * (1 + (Convert.ToDouble(eRMSOPDetection.DetectionSupplementPlant4Value) / 100))), 2);
                                        eRMSOPDetection.DetectionOperationTimePlant5Value = (float?)Math.Round(Convert.ToDouble(eRMSOPDetection.DetectionNormalTime * (1 + (Convert.ToDouble(eRMSOPDetection.DetectionSupplementPlant5Value) / 100))), 2);
                                        #endregion
                                        #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                        try
                                        {
                                            eRMSOPDetection.UiTempDetectionStandardOperationTimeName = ConvertfloattoTimespan(Convert.ToString(eRMSOPDetection.DetectionStandardOperationTime));
                                            eRMSOPDetection.UiTempDetectionOperationTimePlant1Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPDetection.DetectionOperationTimePlant1Value));
                                            eRMSOPDetection.UiTempDetectionOperationTimePlant2Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPDetection.DetectionOperationTimePlant2Value));
                                            eRMSOPDetection.UiTempDetectionOperationTimePlant3Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPDetection.DetectionOperationTimePlant3Value));
                                            eRMSOPDetection.UiTempDetectionOperationTimePlant4Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPDetection.DetectionOperationTimePlant4Value));
                                            eRMSOPDetection.UiTempDetectionOperationTimePlant5Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPDetection.DetectionOperationTimePlant5Value));
                                        }
                                        catch (Exception ex)
                                        {
                                            GeosApplication.Instance.Logger.Log(string.Format("Error in Method RetrieveWorkOperationsByDetection() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                        }
                                        #endregion
                                    }

                                    #endregion
                                    try
                                    {
                                        if (!DetectionMenulistTemp.Any(a => a.KeyName.Equals(Module.KeyName)))
                                            DetectionMenulistTemp.Add(eRMSOPDetection);
                                    }
                                    catch (Exception ex)
                                    {

                                    }
                                } //[GEOS2-5135][Rupali Sarode][18-12-2023]
                            }
                        }
                    }//[GEOS2-4830][gulab lakade][07 12 2023]

                    #region GEOS2-3857 Rupali Sarode
                    //var tempWorkOperationMenulist2 = DetectionMenulistTemp.OrderBy(x => x.Position).ToList();
                    var tempWorkOperationMenulist2 = DetectionMenulistTemp.OrderBy(x => x.DetectionPosition).ToList();//[GEOS2-5629][gulab lakade][15 07 2024]
                    tempWorkOperationClonedDetection = new List<ERMSOPDetection>();
                    tempWorkOperationClonedDetection.AddRange(tempWorkOperationMenulist2);
                    #endregion

                    //List<ERMSOPDetection> tempWorkOperationDetectionMenulist = DetectionMenulistTemp.OrderBy(x => x.Position).ToList();
                    List<ERMSOPDetection> tempWorkOperationDetectionMenulist = DetectionMenulistTemp.OrderBy(x => x.DetectionPosition).ToList();//[GEOS2-5629][gulab lakade][15 07 2024]
                    DetectionMenulistTemp.Clear();
                    DetectionMenulistTemp.AddRange(tempWorkOperationDetectionMenulist);
                    tempWorkOperationDetectionMenulist.Clear();
                    if (DetectionMenulistTemp != null)
                    {
                        var tempDetectionMenulist = DetectionMenulistTemp.ToList();
                        for (int i = 0; i < tempDetectionMenulist.Count; i++)
                        {
                            if (GetStages.Any(a => a.Code.Equals(tempDetectionMenulist[i].Name)))
                            {
                                List<ERMSOPDetection> childList = DetectionMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(tempDetectionMenulist[i].KeyName)).ToList();
                                if (childList.Count == 0)
                                {
                                    List<WorkOperationByStages> tempWOList = WorkOperationMenulist.Where(w => w.KeyName == tempDetectionMenulist[i].KeyName).ToList();
                                    if (tempWOList != null)
                                        tempWOList.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                                    DetectionMenulistTemp.Remove(tempDetectionMenulist[i]);
                                }
                            }
                        }
                    }
                    #endregion
                }
                #region TemplateWithCPTypes
                else if (SelectedItemDetection is DetectionGroupWithDetections)
                {
                    DetectionMenulistTemp = null;
                    workOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                    #region GEOS2-3857 Rupali Sarode
                    SelectedItemDetectionGroup = Convert.ToString(SelectedItemDetection.ToString());
                    #endregion
                }
                #endregion

                //FillDetectionGridColumn();//[GEOS2-4830][gulab lakade][07 12 2023]

                //FillStructureGridColumn(); //[GEOS2-3601]  Rupali Sarode
                #region Commented Code
                //if (DetectionMenulist != null)
                //    foreach (var item in DetectionMenulist)
                //    {
                //        if (!GetStages.Any(a => a.Code.Equals(item.Name)))
                //        {
                //            var tempActivity = tempLstStandardOperationsDictionaryDetection.Where(w => w.IdWorkoperation == Convert.ToUInt64(item.IdworkOperationByStage)
                //             && w.IdDetection == Convert.ToUInt64(item.IdDetection)).Select(s => s.Activity).DefaultIfEmpty(null).FirstOrDefault();
                //            var tempObservedTime = tempLstStandardOperationsDictionaryDetection.Where(w => w.IdWorkoperation == Convert.ToUInt64(item.IdworkOperationByStage)
                //             && w.IdDetection == Convert.ToUInt64(item.IdDetection)).Select(s => s.ObservedTime).DefaultIfEmpty(null).FirstOrDefault();

                //            if (tempActivity != null)
                //                item.Activity = Math.Round((double)tempActivity, 2);
                //            if (tempObservedTime != null)
                //                item.ObservedTime = Math.Round((double)tempObservedTime, 2);

                //            item.NormalTime = Math.Round(Convert.ToDouble(item.ObservedTime * item.Activity / 100), 2);
                //        }
                //    }
                #endregion
                #region RND 
                #region calculation

                #region [GEOS2-4830][gulab lakade][07 12 2023]
                //if (DetectionMenulistTemp != null)
                //    //foreach (ERMSOPDetection itemERMSOPDetection in DetectionMenulistTemp)
                //    for (int d = 0; d < DetectionMenulistTemp.Count(); d++)
                //    {
                //        WorkOperationMenulist.Where(w => w.KeyName == DetectionMenulistTemp[d].KeyName).ToList().ForEach(f => f.IsCurrentWorkOperation = true);
                //        var listCount = DetectionMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(DetectionMenulistTemp[d].KeyName) && w.IsInactiveWorkOperation == false).ToList();//[rdixit][03.08.2022][GEOS2-3764]
                //        if (listCount != null)
                //            if (listCount.Count() > 0)
                //            {
                //                DetectionMenulistTemp[d].DetectionObservedTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.DetectionObservedTime)), 2);
                //                DetectionMenulistTemp[d].DetectionNormalTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.DetectionNormalTime)), 2);
                //                #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                //                DetectionMenulistTemp[d].UITempDetectionobservedTime = ConvertfloattoTimespan(Convert.ToString(Convert.ToDouble(listCount.Sum(s => s.DetectionObservedTime))));
                //                DetectionMenulistTemp[d].UITempDetectionNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(Convert.ToDouble(listCount.Sum(s => s.DetectionNormalTime))));
                //                #endregion
                //                DetectionMenulistTemp[d].IsReadOnly = true;
                //            }
                //    }
                #endregion
                if (DetectionMenulistTemp != null)
                    for (int d = 0; d < DetectionMenulistTemp.Count(); d++)
                    {
                        WorkOperationMenulist.Where(w => w.KeyName == DetectionMenulistTemp[d].KeyName).ToList().ForEach(f => f.IsCurrentWorkOperation = true);
                        //[GEOS2-5135][Rupali Sarode][19-12-2023]
                        //var listCount = DetectionMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(DetectionMenulistTemp[d].KeyName) && w.IsInactiveWorkOperation == false).ToList();//[rdixit][03.08.2022][GEOS2-3764]
                        var listCount = DetectionMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(DetectionMenulistTemp[d].KeyName)).ToList();
                        if (listCount != null)
                            if (listCount.Count() > 0)
                            {
                                DetectionMenulistTemp[d].DetectionObservedTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.DetectionObservedTime)), 2);
                                DetectionMenulistTemp[d].DetectionNormalTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.DetectionNormalTime)), 2);
                                #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                DetectionMenulistTemp[d].UITempDetectionobservedTime = ConvertfloattoTimespan(Convert.ToString(Convert.ToDouble(listCount.Sum(s => s.DetectionObservedTime))));
                                DetectionMenulistTemp[d].UITempDetectionNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(Convert.ToDouble(listCount.Sum(s => s.DetectionNormalTime))));
                                #endregion
                                DetectionMenulistTemp[d].IsReadOnly = true;
                            }
                    }

                if (DetectionMenulistTemp != null)
                    //foreach (ERMSOPDetection itemERMSOPDetection in DetectionMenulistTemp)
                    for (int d = 0; d < DetectionMenulistTemp.Count(); d++)
                    {
                        if (GetStages.Any(a => a.Code.Equals(DetectionMenulistTemp[d].Name)))
                        {
                            ObservableCollection<ERMSOPDetection> ActivitySum = new ObservableCollection<ERMSOPDetection>();
                            ObservableCollection<ERMSOPDetection> TempActivitySum = new ObservableCollection<ERMSOPDetection>();
                            int x = 1;
                            Loop:
                            x++;
                            if (x < 10)
                            {
                                if (ActivitySum.Count == 0)
                                {
                                    DetectionMenulistTemp[d].DetectionObservedTime = 0;
                                    DetectionMenulistTemp[d].DetectionNormalTime = 0;
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    DetectionMenulistTemp[d].UITempDetectionobservedTime = ConvertfloattoTimespan(Convert.ToString(DetectionMenulistTemp[d].DetectionObservedTime));
                                    DetectionMenulistTemp[d].UITempDetectionNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(DetectionMenulistTemp[d].DetectionNormalTime));
                                    #endregion
                                    //[GEOS2-5135][Rupali Sarode][19-12-2023]
                                    //var ActivitySumList = DetectionMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(DetectionMenulistTemp[d].KeyName) && w.IsInactiveWorkOperation == false).ToList();//[rdixit][03.08.2022][GEOS2-3764]
                                    var ActivitySumList = DetectionMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(DetectionMenulistTemp[d].KeyName)).ToList();
                                    ActivitySum.AddRange(ActivitySumList);
                                }
                                else
                                {
                                    #region Commented Code
                                    //foreach (var item in ActivitySum)
                                    //{
                                    //    var ActivitySumList = DetectionMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(item.KeyName)).ToList();
                                    //    if (ActivitySumList != null && ActivitySumList.Count > 0)
                                    //    {

                                    //        foreach (var itemActivity in ActivitySumList)
                                    //        {
                                    //            if (!ActivitySum.Any(ac => ac.KeyName.Equals(itemActivity.KeyName)))
                                    //            {
                                    //                TempActivitySum.Add(itemActivity);
                                    //            }

                                    //        }

                                    //    }

                                    //}
                                    //ActivitySum.AddRange(TempActivitySum);
                                    #endregion
                                }


                                goto Loop;
                            }

                            double? ObservedTime = 0;
                            double? NormalTime = 0;
                            float? StandardTime = 0;
                            float? OperationTimePlant1Value = 0;
                            float? OperationTimePlant2Value = 0;
                            float? OperationTimePlant3Value = 0;
                            float? OperationTimePlant4Value = 0;
                            float? OperationTimePlant5Value = 0;
                            var tempDistinctList = ActivitySum.Select(xa => xa.KeyName).Distinct().ToList();
                            foreach (var item in tempDistinctList)
                            {
                                if (DetectionMenulistTemp[d].DetectionObservedTime == null)
                                    DetectionMenulistTemp[d].DetectionObservedTime = 0;
                                double? tempObservedTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.DetectionObservedTime).FirstOrDefault();
                                if (tempObservedTime != null)
                                {
                                    ObservedTime = Math.Round(Convert.ToDouble(ObservedTime + tempObservedTime), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    DetectionMenulistTemp[d].UITempDetectionobservedTime = ConvertfloattoTimespan(Convert.ToString(ObservedTime));
                                    #endregion
                                }

                                if (DetectionMenulistTemp[d].DetectionNormalTime == null)
                                    DetectionMenulistTemp[d].DetectionNormalTime = 0;
                                double? tempNormalTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.DetectionNormalTime).FirstOrDefault();
                                if (tempNormalTime != null)
                                {
                                    NormalTime = Math.Round(Convert.ToDouble(NormalTime + tempNormalTime), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    DetectionMenulistTemp[d].UITempDetectionNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(NormalTime));
                                    #endregion
                                }

                            }
                            DetectionMenulistTemp[d].DetectionObservedTime = ObservedTime;
                            DetectionMenulistTemp[d].DetectionNormalTime = NormalTime;
                            #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                            DetectionMenulistTemp[d].UITempDetectionobservedTime = ConvertfloattoTimespan(Convert.ToString(ObservedTime));
                            DetectionMenulistTemp[d].UITempDetectionNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(DetectionMenulistTemp[d].DetectionNormalTime));
                            #endregion
                            //DetectionMenulistTemp[d].DetectionNormalTime = Math.Round(Convert.ToDouble(ObservedTime * DetectionMenulistTemp[d].DetectionActivity / 100), 2);
                            #region PlantValue


                            foreach (var item in tempDistinctList)
                            {
                                if (DetectionMenulistTemp[d].DetectionStandardOperationTime == null)
                                    DetectionMenulistTemp[d].DetectionStandardOperationTime = 0;
                                float? tempStandardTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.DetectionStandardOperationTime).FirstOrDefault();
                                if (tempStandardTime != null)
                                    StandardTime = StandardTime + tempStandardTime;

                                if (DetectionMenulistTemp[d].DetectionOperationTimePlant1Value == null)
                                    DetectionMenulistTemp[d].DetectionOperationTimePlant1Value = 0;
                                float? tempOperationTimePlant1Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.DetectionOperationTimePlant1Value).FirstOrDefault();
                                if (tempOperationTimePlant1Value != null)
                                    OperationTimePlant1Value = OperationTimePlant1Value + tempOperationTimePlant1Value;

                                if (DetectionMenulistTemp[d].DetectionOperationTimePlant2Value == null)
                                    DetectionMenulistTemp[d].DetectionOperationTimePlant2Value = 0;
                                float? tempOperationTimePlant2Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.DetectionOperationTimePlant2Value).FirstOrDefault();
                                if (tempOperationTimePlant2Value != null)
                                    OperationTimePlant2Value = OperationTimePlant2Value + tempOperationTimePlant2Value;

                                if (DetectionMenulistTemp[d].DetectionOperationTimePlant3Value == null)
                                    DetectionMenulistTemp[d].DetectionOperationTimePlant3Value = 0;
                                float? tempOperationTimePlant3Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.DetectionOperationTimePlant3Value).FirstOrDefault();
                                if (tempOperationTimePlant3Value != null)
                                    OperationTimePlant3Value = OperationTimePlant3Value + tempOperationTimePlant3Value;

                                if (DetectionMenulistTemp[d].DetectionOperationTimePlant4Value == null)
                                    DetectionMenulistTemp[d].DetectionOperationTimePlant4Value = 0;
                                float? tempOperationTimePlant4Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.DetectionOperationTimePlant4Value).FirstOrDefault();
                                if (tempOperationTimePlant4Value != null)
                                    OperationTimePlant4Value = OperationTimePlant4Value + tempOperationTimePlant4Value;

                                if (DetectionMenulistTemp[d].DetectionOperationTimePlant5Value == null)
                                    DetectionMenulistTemp[d].DetectionOperationTimePlant5Value = 0;
                                float? tempOperationTimePlant5Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.DetectionOperationTimePlant5Value).FirstOrDefault();
                                if (tempOperationTimePlant5Value != null)
                                    OperationTimePlant5Value = OperationTimePlant5Value + tempOperationTimePlant5Value;
                            }
                            #endregion
                            DetectionMenulistTemp[d].DetectionStandardOperationTime = (float?)Math.Round(Convert.ToDouble(StandardTime), 2);
                            DetectionMenulistTemp[d].DetectionOperationTimePlant1Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant1Value), 2);
                            DetectionMenulistTemp[d].DetectionOperationTimePlant2Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant2Value), 2);
                            DetectionMenulistTemp[d].DetectionOperationTimePlant3Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant3Value), 2);
                            DetectionMenulistTemp[d].DetectionOperationTimePlant4Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant4Value), 2);
                            DetectionMenulistTemp[d].DetectionOperationTimePlant5Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant5Value), 2);

                            #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                            try
                            {
                                DetectionMenulistTemp[d].UiTempDetectionStandardOperationTimeName = ConvertfloattoTimespan(Convert.ToString(DetectionMenulistTemp[d].DetectionStandardOperationTime));
                                DetectionMenulistTemp[d].UiTempDetectionOperationTimePlant1Value = ConvertfloattoTimespan(Convert.ToString(DetectionMenulistTemp[d].DetectionOperationTimePlant1Value));
                                DetectionMenulistTemp[d].UiTempDetectionOperationTimePlant2Value = ConvertfloattoTimespan(Convert.ToString(DetectionMenulistTemp[d].DetectionOperationTimePlant2Value));
                                DetectionMenulistTemp[d].UiTempDetectionOperationTimePlant3Value = ConvertfloattoTimespan(Convert.ToString(DetectionMenulistTemp[d].DetectionOperationTimePlant3Value));
                                DetectionMenulistTemp[d].UiTempDetectionOperationTimePlant4Value = ConvertfloattoTimespan(Convert.ToString(DetectionMenulistTemp[d].DetectionOperationTimePlant4Value));
                                DetectionMenulistTemp[d].UiTempDetectionOperationTimePlant5Value = ConvertfloattoTimespan(Convert.ToString(DetectionMenulistTemp[d].DetectionOperationTimePlant5Value));
                            }
                            catch (Exception ex)
                            {
                                GeosApplication.Instance.Logger.Log(string.Format("Error in Method FillDetectionGridColumn() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            }
                            #endregion
                        }
                    }
                #endregion 
                DetectionMenulist = DetectionMenulistTemp;
                #endregion

                //detectionCustomSummarycalculation();
                //if (ModuleMenulist != null)
                //    ModuleMenulistCloned = ModuleMenulist;
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Method RetrieveWorkOperationsByDetection()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log(string.Format("Error in method RetrieveWorkOperationsByDetection() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void OnDragRecordOverDetectionGrid(DragRecordOverEventArgs e)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method OnDragRecordOverDetectionGrid()...", category: Category.Info, priority: Priority.Low);

                #region Rajashri
                //Rajshri [Geos2-5629]
                Int64 targetParentid = 0;
                Int64 idparentValue = 0;
                int TempCount = 0;//[GEOS2-5629][gulab lakade][16 07 2024]
                DevExpress.Xpf.Grid.TreeListView TempWayTree = (DevExpress.Xpf.Grid.TreeListView)e.Source;
                DevExpress.Xpf.Grid.TreeListControl TempNode = (DevExpress.Xpf.Grid.TreeListControl)TempWayTree.Parent;

                var currentItem = TempNode.CurrentItem as Emdep.Geos.Data.Common.ERM.ERMSOPDetection;
                if (currentItem != null)
                {
                    idparentValue = Convert.ToInt64(currentItem.IdParent);
                    TempCount = DetectionMenulist.Where(x => x.ParentName == currentItem.KeyName).ToList().Count();//[GEOS2-5629][gulab lakade][16 07 2024]
                }
                var targetrecord = e.TargetRecord as Emdep.Geos.Data.Common.ERM.ERMSOPDetection;
                if (targetrecord != null)
                {
                    targetParentid = Convert.ToInt64(targetrecord.IdParent);
                }
                #endregion
                if ((e.IsFromOutside) && typeof(WorkOperationByStages).IsAssignableFrom(e.GetRecordType()))
                {
                    e.Effects = DragDropEffects.Copy;
                    e.Handled = true;
                }
                #region Aishwarya
                else if ((e.IsFromOutside) && typeof(ERMSOPDetection).IsAssignableFrom(e.GetRecordType()))
                {
                    e.Effects = DragDropEffects.Copy;
                    e.Handled = true;
                    IsEnabled = true;
                }
                else if ((e.IsFromOutside) && typeof(ERMSOPDetection).IsAssignableFrom(e.GetRecordType()) && e.TargetRecord == null)
                {
                    e.Effects = DragDropEffects.Copy;
                    e.Handled = true;
                }
                else if (e.DropPosition == DropPosition.Inside && typeof(ERMSOPDetection).IsAssignableFrom(e.GetRecordType()))
                {
                    e.Effects = DragDropEffects.None;
                    e.Handled = false;
                }
                else if (typeof(ERMSOPDetection).IsAssignableFrom(e.GetRecordType()) && (e.DropPosition == DropPosition.Before || e.DropPosition == DropPosition.After))
                {


                    #region Rajashri
                    if (idparentValue == targetParentid)
                    {
                        // start [GEOS2-5629][gulab lakade][16 07 2024]
                        if (TempCount == 0)
                        {
                            e.Effects = DragDropEffects.Move;
                            e.Handled = true;
                            IsModulesequence = true;
                        }
                        else
                        {
                            e.Effects = DragDropEffects.None;
                            e.Handled = false;
                        }
                        //end [GEOS2-5629][gulab lakade][16 07 2024]
                    }
                    else
                    {
                        e.Effects = DragDropEffects.None;
                        e.Handled = false;
                    }
                    #endregion
                }
                #endregion

                else
                {
                    e.Effects = DragDropEffects.None;
                    e.Handled = false;
                }
                GeosApplication.Instance.Logger.Log("Method OnDragRecordOverDetectionGrid()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method OnDragRecordOverDetectionGrid()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }

        }

        private void DropRecordDetectionGrid(DropRecordEventArgs e)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method DropRecordDetectionGrid()...", category: Category.Info, priority: Priority.Low);
                if ((e.IsFromOutside) && e.TargetRecord != null && typeof(WorkOperationByStages).IsAssignableFrom(e.GetRecordType()))
                {
                    e.Effects = DragDropEffects.Copy;
                    CompleteDropRecorDetectionGrid(e);
                    e.Handled = true;
                }
                else if ((e.IsFromOutside) && typeof(WorkOperationByStages).IsAssignableFrom(e.GetRecordType()) && e.TargetRecord == null)
                {
                    e.Effects = DragDropEffects.Copy;
                    CompleteDropRecorDetectionGrid(e);
                    e.Handled = true;
                    //e.Handled = true;
                }
                else if (e.DropPosition == DropPosition.Inside && typeof(WorkOperationByStages).IsAssignableFrom(e.GetRecordType()))
                {
                    e.Effects = DragDropEffects.None;
                    e.Handled = false;
                }
                else if (typeof(WorkOperationByStages).IsAssignableFrom(e.GetRecordType()) && (e.DropPosition == DropPosition.Before || e.DropPosition == DropPosition.After))
                {
                    e.Effects = DragDropEffects.Move;
                    e.Handled = false;
                }
                else if (typeof(ERMSOPDetection).IsAssignableFrom(e.GetRecordType()) && (e.DropPosition == DropPosition.Before || e.DropPosition == DropPosition.After))
                {
                    var tragetPosition_var = e.TargetRecord.GetType().GetProperty("DetectionPosition").GetValue(e.TargetRecord);
                    var TempTargetKeyName = e.TargetRecord.GetType().GetProperty("KeyName").GetValue(e.TargetRecord);//[GEOS2-5629][gulab lakade][16 07 2024]
                    DevExpress.Xpf.Grid.TreeListView originsource = (DevExpress.Xpf.Grid.TreeListView)e.OriginalSource;
                    var DPosition_var = (originsource.FocusedRow.GetType().GetProperty("DetectionPosition").GetValue(originsource.FocusedRow));
                    var TempChangeKeyName = (originsource.FocusedRow.GetType().GetProperty("KeyName").GetValue(originsource.FocusedRow));//[GEOS2-5629][gulab lakade][16 07 2024]
                    UInt32 DPosition = Convert.ToUInt32(DPosition_var);
                    UInt32 tragetPosition = Convert.ToUInt32(tragetPosition_var);
                    string TargetKeyName = Convert.ToString(TempTargetKeyName);//[GEOS2-5629][gulab lakade][16 07 2024]
                    string ChangeKeyName = Convert.ToString(TempChangeKeyName);//[GEOS2-5629][gulab lakade][16 07 2024]
                    if (e.DropPosition == DropPosition.Before)
                    {

                        var TempChangesrecord = DetectionMenulist.Where(x => x.DetectionPosition == DPosition && x.KeyName == ChangeKeyName).FirstOrDefault();

                        var TempBeforerecord = DetectionMenulist.Where(x => x.DetectionPosition == tragetPosition && x.KeyName == TargetKeyName).FirstOrDefault();
                        if (tragetPosition < DPosition)
                        {
                            UInt32 pos = Convert.ToUInt32(tragetPosition);
                            foreach (var update in DetectionMenulist.Where(x => x.DetectionPosition >= tragetPosition).OrderBy(a => a.DetectionPosition).ToList())
                            {

                                //start[GEOS2-5629][gulab lakade][16 07 2024]
                                int TempCount = 0;
                                TempCount = DetectionMenulist.Where(x => x.ParentName == update.KeyName).ToList().Count();//[GEOS2-5629][gulab lakade][16 07 2024]
                                if (TempCount == 0)
                                {
                                    if (update.IdworkOperationByStage == TempChangesrecord.IdworkOperationByStage)
                                    {
                                        update.DetectionPosition = Convert.ToUInt32(tragetPosition);
                                        // break;
                                    }
                                    else
                                    {
                                        if (Convert.ToUInt32(tragetPosition) == Convert.ToUInt32(pos))
                                        {
                                            pos++;
                                        }
                                        update.DetectionPosition = pos;
                                        pos++;
                                    }
                                }

                            }
                        }
                        else
                        {
                            UInt32 pos = Convert.ToUInt32(DPosition);

                            foreach (var update in DetectionMenulist.Where(x => x.DetectionPosition >= DPosition).OrderBy(a => a.DetectionPosition).ToList())
                            {
                                //start[GEOS2-5629][gulab lakade][16 07 2024]
                                int TempCount = 0;
                                TempCount = DetectionMenulist.Where(x => x.ParentName == update.KeyName).ToList().Count();//[GEOS2-5629][gulab lakade][16 07 2024]
                                if (TempCount == 0)
                                {
                                    if (update.IdworkOperationByStage == TempChangesrecord.IdworkOperationByStage)
                                    {
                                        update.DetectionPosition = Convert.ToUInt32(tragetPosition - 1);
                                        // break;
                                    }
                                    else
                                    {
                                        if (pos == 0)
                                        {
                                            pos = 1;
                                        }
                                        if (pos == Convert.ToUInt32(tragetPosition - 1))
                                        {
                                            pos++;
                                        }
                                        update.DetectionPosition = pos;
                                        pos++;
                                    }
                                }

                            }
                        }



                    }
                    else if (e.DropPosition == DropPosition.After)
                    {
                        var TempChangesrecord = DetectionMenulist.Where(x => x.DetectionPosition == DPosition && x.KeyName == ChangeKeyName).FirstOrDefault();

                        var TempBeforerecord = DetectionMenulist.Where(x => x.DetectionPosition == tragetPosition && x.KeyName == TargetKeyName).FirstOrDefault();
                        if (tragetPosition < DPosition)
                        {
                            UInt32 pos = Convert.ToUInt32(tragetPosition);
                            foreach (var update in DetectionMenulist.Where(x => x.DetectionPosition >= tragetPosition).OrderBy(a => a.DetectionPosition).ToList())
                            {

                                //start[GEOS2-5629][gulab lakade][16 07 2024]
                                int TempCount = 0;
                                TempCount = DetectionMenulist.Where(x => x.ParentName == update.KeyName).ToList().Count();//[GEOS2-5629][gulab lakade][16 07 2024]
                                if (TempCount == 0)
                                {
                                    if (update.IdworkOperationByStage == TempChangesrecord.IdworkOperationByStage)
                                    {
                                        update.DetectionPosition = Convert.ToUInt32(tragetPosition);
                                        //break;
                                    }
                                    else
                                    {
                                        if (Convert.ToUInt32(tragetPosition) == Convert.ToUInt32(pos))
                                        {
                                            pos++;
                                        }
                                        update.DetectionPosition = pos;
                                        pos++;
                                    }
                                }
                            }
                        }
                        else
                        {

                            UInt32 pos = Convert.ToUInt32(DPosition);
                            foreach (var update in DetectionMenulist.Where(x => x.DetectionPosition >= DPosition).OrderBy(a => a.DetectionPosition).ToList())
                            {
                                //start[GEOS2-5629][gulab lakade][16 07 2024]
                                int TempCount = 0;
                                TempCount = DetectionMenulist.Where(x => x.ParentName == update.KeyName).ToList().Count();//[GEOS2-5629][gulab lakade][16 07 2024]
                                if (TempCount == 0)
                                {
                                    if (update.IdworkOperationByStage == TempChangesrecord.IdworkOperationByStage)
                                    {
                                        update.DetectionPosition = Convert.ToUInt32(tragetPosition);
                                        //break;
                                    }
                                    else
                                    {
                                        if (pos == 0)
                                        {
                                            pos = 1;
                                        }
                                        if (pos == Convert.ToUInt32(tragetPosition))
                                        {
                                            pos++;
                                        }
                                        update.DetectionPosition = pos;
                                        pos++;
                                    }
                                }
                            }
                        }
                    }

                    var TmpDetetction = DetectionMenulist.OrderBy(a => a.DetectionPosition).ToList();
                    DetectionMenulist = new ObservableCollection<ERMSOPDetection>(TmpDetetction);
                    e.Effects = DragDropEffects.Move;
                    e.Handled = true;
                    IsModulesequence = true;
                }

                GeosApplication.Instance.Logger.Log("Method DropRecordDetectionGrid()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method DropRecordDetectionGrid()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }

        }

        private void CompleteRecordDragDropDetectionGrid(CompleteRecordDragDropEventArgs e)
        {

            e.Handled = true;
            IsModulesequence = false;
            IsEnabledSaveButton = true;
            // e.Handled = true;
            //FillmoduleGridColumn();
            int wocount = WorkOperationMenulist.ToList().Count();
        }


        private void FillDetectionTemplateGridlist(List<StandardOperationsDictionaryDetection> LstStandardOperationsDictionaryDetection)

        {
            try
            {
                FillDetectionData(LstStandardOperationsDictionaryDetection);
                //FillmoduleGridColumn();
            }
            catch (FaultException<ServiceException> ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillDetectionTemplateGridlist() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillDetectionTemplateGridlist() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method FillDetectionTemplateGridlist() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        List<StandardOperationsDictionaryDetection> tempLstStandardOperationsDictionaryDetection = new List<StandardOperationsDictionaryDetection>();
        private void FillDetectionData(List<StandardOperationsDictionaryDetection> LstStandardOperationsDictionaryModules)
        {

            try
            {
                GeosApplication.Instance.Logger.Log("Method FillDetectionData()...", category: Category.Info, priority: Priority.Low);
                List<Int32> IdworkOperation = new List<int>();
                ObservableCollection<WorkOperationByStages> ModelList = new ObservableCollection<WorkOperationByStages>();
                if (WorkOperationMenulist != null)
                {
                    if (DetectionMenulist == null)
                    {
                        DetectionMenulist = new ObservableCollection<ERMSOPDetection>();
                        ObservableCollection<ERMSOPModule> TempModuleMenulist = new ObservableCollection<ERMSOPModule>();
                        foreach (var DictionaryModules in LstStandardOperationsDictionaryModules)
                        {
                            List<WorkOperationByStages> tempModuleList = WorkOperationMenulist.Where(w => w.IdworkOperationByStage == Convert.ToInt32(DictionaryModules.IdWorkoperation)).ToList();
                            foreach (WorkOperationByStages item in tempModuleList)
                            {
                                GetAllTreeListDetection(item, WorkOperationMenulist);
                            }
                        }
                        foreach (WorkOperationByStages Module in WorkOperationMenulist)
                        {

                            //if (LstStandardOperationsDictionaryModules.Any(a => a.IdWorkoperation == Convert.ToUInt64(Module.IdworkOperationByStage)))
                            if (operationDetectionMenulist.Any(a => a.IdworkOperationByStage == Convert.ToInt64(Module.IdworkOperationByStage))
                                && operationDetectionMenulist.Any(a => a.IdStage == Module.IdStage)
                                && operationDetectionMenulist.Any(a => a.Name.Trim().Equals(Module.Name.Trim()))
                                )
                            {
                                StandardOperationsDictionaryDetection standardOperationsDictionaryModules = LstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(Module.IdworkOperationByStage) && Module.Parent != null).FirstOrDefault();

                                ERMSOPDetection eRMSOPDetection = new ERMSOPDetection();
                                if (standardOperationsDictionaryModules != null)
                                    eRMSOPDetection.IdDetection = standardOperationsDictionaryModules.IdDetection;
                                eRMSOPDetection.Name = Module.Name;
                                eRMSOPDetection.IdworkOperationByStage = Module.IdworkOperationByStage;
                                eRMSOPDetection.IdSequence = Module.IdSequence;
                                eRMSOPDetection.IdStatus = Module.IdStatus;
                                eRMSOPDetection.Status = Module.Status;
                                eRMSOPDetection.Code = Module.Name;
                                eRMSOPDetection.Parent = Module.Parent;
                                eRMSOPDetection.IdParent = Module.IdParent;
                                eRMSOPDetection.KeyName = Module.KeyName;
                                eRMSOPDetection.ParentName = Module.ParentName;
                                eRMSOPDetection.Position = Module.Position;
                                eRMSOPDetection.WorkOperation_count = Module.WorkOperation_count;
                                eRMSOPDetection.WorkOperation_count_original = Module.WorkOperation_count_original;
                                eRMSOPDetection.NameWithWorkOperationCount = Module.NameWithWorkOperationCount;
                                eRMSOPDetection.DetectionNormalTime = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(Module.IdworkOperationByStage)).Select(s => s.NormalTime).DefaultIfEmpty(null).FirstOrDefault();
                                if (eRMSOPDetection.DetectionNormalTime != null)
                                    eRMSOPDetection.DetectionNormalTime = Math.Round((double)eRMSOPDetection.DetectionNormalTime, 2);
                                eRMSOPDetection.DetectionObservedTime = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(Module.IdworkOperationByStage)).Select(s => s.ObservedTime).DefaultIfEmpty(null).FirstOrDefault();
                                if (eRMSOPDetection.DetectionObservedTime != null)
                                    eRMSOPDetection.DetectionObservedTime = Math.Round((double)eRMSOPDetection.DetectionObservedTime, 2);
                                eRMSOPDetection.DetectionActivity = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(Module.IdworkOperationByStage)).Select(s => s.Activity).DefaultIfEmpty(null).FirstOrDefault(); ;
                                if (eRMSOPDetection.DetectionActivity != null)
                                    eRMSOPDetection.DetectionActivity = Math.Round((double)eRMSOPDetection.DetectionActivity, 2);
                                if (GetStages.Any(a => a != null && a.Code.Trim().Equals(Module.Name.Trim())))
                                {
                                    eRMSOPDetection.IsDeleteButton = false;
                                    eRMSOPDetection.IsDeleteButtonVisibility = Visibility.Hidden;
                                    eRMSOPDetection.IsReadOnly = true;
                                    eRMSOPDetection.IsValidateOnTextInput = false;
                                    Module.IsCurrentWorkOperation = true;
                                }
                                else
                                {
                                    Module.IsCurrentWorkOperation = true;
                                    eRMSOPDetection.IsReadOnly = false;
                                    eRMSOPDetection.IsValidateOnTextInput = true;
                                }
                                if (Module.IdStatus == 1536)
                                {
                                    eRMSOPDetection.IsInactiveWorkOperation = true;
                                    eRMSOPDetection.IsReadOnly = true;
                                }
                                try
                                {
                                    if (!DetectionMenulist.Any(a => a.KeyName.Equals(Module.KeyName)))
                                        DetectionMenulist.Add(eRMSOPDetection);
                                }
                                catch (Exception ex)
                                {
                                }


                            }
                        }
                    }

                }
                CustomSummarycalculation();
                GeosApplication.Instance.Logger.Log("Method FillDetectionData()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {

                GeosApplication.Instance.Logger.Log("Get an error in FillDetectionData() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        ObservableCollection<ERMSOPDetection> DetectionList = new ObservableCollection<ERMSOPDetection>();
        ObservableCollection<WorkOperationByStages> operationDetectionMenulist = new ObservableCollection<WorkOperationByStages>();
        int duplicateItemloopDetection = 0;
        private void GetAllTreeListDetectionOldmethod(WorkOperationByStages StandardOperationsDictionaryDetection, ObservableCollection<WorkOperationByStages> WorkOperationMenulist)
        {
            try
            {
                if (StandardOperationsDictionaryDetection != null && StandardOperationsDictionaryDetection.Name.ToLower() != "All".ToLower())
                {

                    if (Convert.ToInt32(StandardOperationsDictionaryDetection.IdParent) == Convert.ToInt32(StandardOperationsDictionaryDetection.IdStage))
                    {
                        if (!operationDetectionMenulist.Any(a => a.KeyName.Equals(StandardOperationsDictionaryDetection.KeyName)))
                            operationDetectionMenulist.Add(StandardOperationsDictionaryDetection);
                        if (StandardOperationsDictionaryDetection.IdParent == null || StandardOperationsDictionaryDetection.IdStage == 0)
                        {

                        }
                        else
                        {
                            WorkOperationByStages TempStagesList = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == Convert.ToInt32(StandardOperationsDictionaryDetection.IdStage) &&
                            a.KeyName.Equals(("Stage_" + Convert.ToInt32(StandardOperationsDictionaryDetection.IdStage)).ToString())).FirstOrDefault();
                            if (duplicateItemloopDetection >= 20) { TempStagesList = null; }
                            GetAllTreeListDetection(TempStagesList, WorkOperationMenulist);
                        }
                    }
                    else
                    {
                        if (operationDetectionMenulist.Any(a => a.IdworkOperationByStage == Convert.ToInt64(StandardOperationsDictionaryDetection.IdworkOperationByStage)))
                        {
                            duplicateItemloopDetection = duplicateItemloopDetection + 1;
                            if (duplicateItemloopDetection >= 20)
                            {
                                GetAllTreeListDetection(null, WorkOperationMenulist);
                            }
                        }
                        else
                        {
                            if (!operationDetectionMenulist.Any(a => a.KeyName.Equals(StandardOperationsDictionaryDetection.KeyName)))
                                operationDetectionMenulist.Add(StandardOperationsDictionaryDetection);
                        }
                        List<WorkOperationByStages> TempList = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == Convert.ToInt32(StandardOperationsDictionaryDetection.IdParent)).ToList();
                        if (duplicateItemloopDetection >= 20) { TempList = null; }
                        foreach (WorkOperationByStages itemWorkOperationByStages in TempList)
                        {
                            GetAllTreeListDetection(itemWorkOperationByStages, WorkOperationMenulist);
                        }
                    }

                }
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method GetAllTreeList()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        private void GetAllTreeListDetection(WorkOperationByStages StandardOperationsDictionaryModules, ObservableCollection<WorkOperationByStages> WorkOperationMenulist)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method GetAllTreeListDetection()...", category: Category.Info, priority: Priority.Low);

                if (StandardOperationsDictionaryModules != null && StandardOperationsDictionaryModules.Name.ToLower() != "All".ToLower())
                {

                    if (Convert.ToInt32(StandardOperationsDictionaryModules.IdParent) == Convert.ToInt32(StandardOperationsDictionaryModules.IdStage))
                    {
                        if (!operationDetectionMenulist.Any(a => a.KeyName.Equals(StandardOperationsDictionaryModules.KeyName)))
                            operationDetectionMenulist.Add(StandardOperationsDictionaryModules);
                        if (StandardOperationsDictionaryModules.IdParent == null || StandardOperationsDictionaryModules.IdStage == 0)
                        {

                        }
                        else
                        {
                            WorkOperationByStages TempStagesList = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == Convert.ToInt32(StandardOperationsDictionaryModules.IdStage) &&
                            a.KeyName.Equals(("Stage_" + Convert.ToInt32(StandardOperationsDictionaryModules.IdStage)).ToString())).FirstOrDefault();
                            if (duplicateItemloopDetection >= 20) { TempStagesList = null; }
                            GetAllTreeListDetection(TempStagesList, WorkOperationMenulist);
                        }
                    }
                    else
                    {
                        if (operationDetectionMenulist.Any(a => a.IdworkOperationByStage == Convert.ToInt64(StandardOperationsDictionaryModules.IdworkOperationByStage)))
                        {
                            duplicateItemloopDetection = duplicateItemloopDetection + 1;
                            if (duplicateItemloopDetection >= 20)
                            {
                                GetAllTreeListDetection(null, WorkOperationMenulist);
                            }
                        }
                        else
                        {
                            if (!operationDetectionMenulist.Any(a => a.KeyName.Equals(StandardOperationsDictionaryModules.KeyName)))
                                operationDetectionMenulist.Add(StandardOperationsDictionaryModules);
                        }
                        List<WorkOperationByStages> TempList = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == Convert.ToInt32(StandardOperationsDictionaryModules.IdParent)).ToList();
                        if (duplicateItemloopDetection >= 20) { TempList = null; }
                        if (TempList != null)
                            foreach (WorkOperationByStages itemWorkOperationByStages in TempList)
                            {
                                GetAllTreeListDetection(itemWorkOperationByStages, WorkOperationMenulist);
                            }
                    }

                }
                GeosApplication.Instance.Logger.Log("Method GetAllTreeListDetection()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method GetAllTreeListDetection()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        private void GetAllTreeListStructure(WorkOperationByStages StandardOperationsDictionaryModules, ObservableCollection<WorkOperationByStages> WorkOperationMenulist)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method GetAllTreeListStructure()...", category: Category.Info, priority: Priority.Low);

                if (StandardOperationsDictionaryModules != null && StandardOperationsDictionaryModules.Name.ToLower() != "All".ToLower())
                {

                    if (Convert.ToInt32(StandardOperationsDictionaryModules.IdParent) == Convert.ToInt32(StandardOperationsDictionaryModules.IdStage))
                    {
                        if (!operationStructureMenulist.Any(a => a.KeyName.Equals(StandardOperationsDictionaryModules.KeyName)))
                            operationStructureMenulist.Add(StandardOperationsDictionaryModules);
                        if (StandardOperationsDictionaryModules.IdParent == null || StandardOperationsDictionaryModules.IdStage == 0)
                        {

                        }
                        else
                        {
                            WorkOperationByStages TempStagesList = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == Convert.ToInt32(StandardOperationsDictionaryModules.IdStage) &&
                            a.KeyName.Equals(("Stage_" + Convert.ToInt32(StandardOperationsDictionaryModules.IdStage)).ToString())).FirstOrDefault();
                            if (duplicateItemloopStructure >= 20) { TempStagesList = null; }
                            GetAllTreeListStructure(TempStagesList, WorkOperationMenulist);
                        }
                    }
                    else
                    {
                        if (operationStructureMenulist.Any(a => a.IdworkOperationByStage == Convert.ToInt64(StandardOperationsDictionaryModules.IdworkOperationByStage)))
                        {
                            duplicateItemloopStructure = duplicateItemloopStructure + 1;
                            if (duplicateItemloopStructure >= 20)
                            {
                                GetAllTreeListStructure(null, WorkOperationMenulist);
                            }
                        }
                        else
                        {
                            if (!operationStructureMenulist.Any(a => a.KeyName.Equals(StandardOperationsDictionaryModules.KeyName)))
                                operationStructureMenulist.Add(StandardOperationsDictionaryModules);
                        }
                        List<WorkOperationByStages> TempList = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == Convert.ToInt32(StandardOperationsDictionaryModules.IdParent)).ToList();
                        if (duplicateItemloopStructure >= 20) { TempList = null; }
                        if (TempList != null)
                            foreach (WorkOperationByStages itemWorkOperationByStages in TempList)
                            {
                                GetAllTreeListStructure(itemWorkOperationByStages, WorkOperationMenulist);
                            }
                    }

                }
                GeosApplication.Instance.Logger.Log("Method GetAllTreeListStructure()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method GetAllTreeListStructure()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        private void CompleteDropRecorDetectionGridOldMethod(DropRecordEventArgs e)
        {
            try
            {

                if (!DXSplashScreen.IsActive)
                {
                    DXSplashScreen.Show(x =>
                    {
                        Window win = new Window()
                        {
                            ShowActivated = false,
                            WindowStyle = WindowStyle.None,
                            ResizeMode = ResizeMode.NoResize,
                            AllowsTransparency = true,
                            Background = new SolidColorBrush(Colors.Transparent),
                            ShowInTaskbar = false,
                            Topmost = true,
                            SizeToContent = SizeToContent.WidthAndHeight,
                            WindowStartupLocation = WindowStartupLocation.CenterScreen,
                        };
                        WindowFadeAnimationBehavior.SetEnableAnimation(win, true);
                        win.Topmost = false;
                        return win;
                    }, x =>
                    {
                        return new SplashScreenView() { DataContext = new SplashScreenViewModel() };
                    }, null, null);
                }

                if (SelectedItemDetection is ERMDetections)
                {
                    IsEnabledSaveButton = true;
                    SaveButtonVisibility = Visibility.Visible;
                    duplicateItemloop = 0;
                    if ((e.IsFromOutside) && typeof(WorkOperationByStages).IsAssignableFrom(e.GetRecordType()))
                    {
                        //ModuleMenulist = new ObservableCollection<ERMSOPModule>();
                        var data = (RecordDragDropData)e.Data.GetData(typeof(RecordDragDropData));
                        List<WorkOperationByStages> found = new List<WorkOperationByStages>();
                        List<WorkOperationByStages> TempfoundAllrecords = new List<WorkOperationByStages>();
                        List<WorkOperationByStages> records = data.Records.OfType<WorkOperationByStages>().ToList();
                        int count = 0;
                        if (DetectionMenulist == null)
                        {
                            DetectionMenulist = new ObservableCollection<ERMSOPDetection>();
                        }
                        if (records.Any(a => a.Name.Equals("All")))
                        {
                            //records.RemoveAll(r => r.Name.Equals("All"));
                            #region ALL
                            // found.AddRange(records);
                            found = new List<WorkOperationByStages>();
                            operationDetectionMenulist = new ObservableCollection<WorkOperationByStages>();
                            operationDetectionMenulist.AddRange(WorkOperationMenulist.Where(w => !w.Name.Equals("All")));
                            #endregion
                        }
                        else

                        //if (true)
                        {
                            foreach (WorkOperationByStages itemWorkOperationByStages in records)
                            {
                                if (DetectionMenulist == null)
                                {
                                    DetectionMenulist = new ObservableCollection<ERMSOPDetection>();
                                }
                                if (!DetectionMenulist.Any(a => a.Name.Equals(itemWorkOperationByStages.Name)))
                                {
                                    if (itemWorkOperationByStages.IdStatus != 1536)  //[rdixit][GEOS2 - 3764][04.08.2022]
                                    {
                                        itemWorkOperationByStages.IsCurrentWorkOperation = true;
                                        DetectionMenulist.Add(JsonConvert.DeserializeObject<ERMSOPDetection>(JsonConvert.SerializeObject(itemWorkOperationByStages)));
                                    }


                                }

                                //if (GetStages.Any(a => a != null && a.Code.Trim().Equals(itemWorkOperationByStages.Name.Trim())))
                                //{
                                //    found.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(itemWorkOperationByStages.KeyName)).ToList());
                                //    //
                                //    foreach (var itemfound in found)
                                //    {
                                //        //TempfoundAllrecords.AddRange(WorkOperationMenulist.Where(s => s.Name.Trim().Equals(itemfound.Name.Trim())).ToList());
                                //        TempfoundAllrecords.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(itemfound.KeyName)).ToList());
                                //    }
                                //    foreach (var tempfoundAllrecords in TempfoundAllrecords)
                                //    {
                                //        if (!found.Any(a => a != null && a.KeyName.Trim().Equals(tempfoundAllrecords.KeyName.Trim())))
                                //            found.Add(tempfoundAllrecords);
                                //    }
                                //}
                                if (GetStages.Any(a => a != null && a.Code.Trim().Equals(itemWorkOperationByStages.Name.Trim())))
                                {
                                    found.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(itemWorkOperationByStages.KeyName)).ToList());
                                    int x = 0;
                                    Loop:
                                    x++;
                                    if (x < 4)
                                    {
                                        for (int i = 0; i < found.Count(); i++)
                                        {
                                            TempfoundAllrecords.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(found[i].KeyName)).ToList());
                                        }
                                        for (int i = 0; i < TempfoundAllrecords.Count(); i++)
                                        {
                                            if (!found.Any(a => a != null && a.KeyName.Trim().Equals(TempfoundAllrecords[i].KeyName.Trim())))
                                                found.Add(TempfoundAllrecords[i]);
                                        }
                                        goto Loop;
                                    }
                                }
                                else
                                {
                                    found.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(itemWorkOperationByStages.KeyName)).ToList());
                                    foreach (var itemfound in found)
                                    {
                                        TempfoundAllrecords.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(itemfound.KeyName)).ToList());
                                    }
                                    foreach (var tempfoundAllrecords in TempfoundAllrecords)
                                    {
                                        if (!found.Any(a => a != null && a.KeyName.Trim().Equals(tempfoundAllrecords.KeyName.Trim())))
                                            found.Add(tempfoundAllrecords);
                                    }
                                    foreach (WorkOperationByStages eRMModule in records.Where(a => a.IdworkOperationByStage > 0))
                                    {
                                        if (!found.Any(a => a != null && a.KeyName.Trim().Equals(eRMModule.KeyName.Trim())))
                                            found.AddRange(WorkOperationMenulist.Where(s => s.IdworkOperationByStage == eRMModule.IdworkOperationByStage).ToList());
                                        //found.AddRange(WorkOperationMenulist.Where(s => s.Name.Trim().Equals(eRMModule.Name.Trim())).ToList());
                                        if (found.Count() != 0)
                                        {
                                            count++;
                                        }
                                    }
                                }

                            }
                        }


                        if (count > 0)
                        {
                            for (int i = 0; i < found.Count(); i++)
                            {
                                if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(found[i].Name.Trim())))
                                {
                                    duplicateItemloop = 0;
                                    GetAllTreeListDetection(found[i], WorkOperationMenulist);
                                }

                            }
                        }
                        else
                        {
                            if (!found.Any(a => a.Name.Equals("All")))
                                foreach (WorkOperationByStages item in found)
                                {
                                    duplicateItemloop = 0;
                                    GetAllTreeListDetection(item, WorkOperationMenulist);
                                }
                        }
                        #region commonCode
                        foreach (WorkOperationByStages Module in WorkOperationMenulist)
                        {
                            //if (Module.IdStatus != 1536) [rdixit][GEOS2-3764][04.08.2022]
                            if (operationDetectionMenulist.Any(a => a.IdworkOperationByStage == Convert.ToInt64(Module.IdworkOperationByStage))
                                    && operationDetectionMenulist.Any(a => a.IdStage == Module.IdStage)
                                    && operationDetectionMenulist.Any(a => a.Name.Trim().Equals(Module.Name.Trim()))
                                )
                            {
                                StandardOperationsDictionaryDetection standardOperationsDictionaryDetection = tempLstStandardOperationsDictionaryDetection.Where(w => w.IdWorkoperation == Convert.ToUInt64(Module.IdworkOperationByStage) && Module.Parent != null).FirstOrDefault();

                                ERMSOPDetection eRMSOPDetection = new ERMSOPDetection();
                                if (standardOperationsDictionaryDetection != null)
                                    eRMSOPDetection.IdDetection = standardOperationsDictionaryDetection.IdDetection;
                                eRMSOPDetection.Name = Module.Name;
                                eRMSOPDetection.IdworkOperationByStage = Module.IdworkOperationByStage;
                                eRMSOPDetection.IdSequence = Module.IdSequence;
                                eRMSOPDetection.IdStatus = Module.IdStatus;
                                eRMSOPDetection.Status = Module.Status;
                                eRMSOPDetection.Code = Module.Name;
                                eRMSOPDetection.Parent = Module.Parent;
                                eRMSOPDetection.IdParent = Module.IdParent;
                                eRMSOPDetection.KeyName = Module.KeyName;
                                eRMSOPDetection.ParentName = Module.ParentName;
                                eRMSOPDetection.Position = Module.Position;
                                eRMSOPDetection.WorkOperation_count = Module.WorkOperation_count;
                                eRMSOPDetection.WorkOperation_count_original = Module.WorkOperation_count_original;
                                eRMSOPDetection.NameWithWorkOperationCount = Module.NameWithWorkOperationCount;
                                eRMSOPDetection.DetectionNormalTime = Module.NormalTime;

                                if (Module.NormalTime != null)
                                    eRMSOPDetection.DetectionNormalTime = Math.Round((double)Module.NormalTime, 2);
                                eRMSOPDetection.DetectionObservedTime = Module.ObservedTime;
                                if (Module.ObservedTime != null)
                                    eRMSOPDetection.DetectionObservedTime = Math.Round((double)Module.ObservedTime, 2);
                                eRMSOPDetection.DetectionActivity = Module.Activity;
                                if (eRMSOPDetection.DetectionActivity != 0)
                                    eRMSOPDetection.DetectionActivity = Math.Round((double)Module.Activity, 2);
                                if (eRMSOPDetection.DetectionActivity == 0)
                                    eRMSOPDetection.DetectionActivity = null;
                                if (GetStages.Any(a => a != null && a.Code.Trim().Equals(Module.Name.Trim())))
                                {
                                    Module.IsCurrentWorkOperation = true;
                                    eRMSOPDetection.IsDeleteButton = false;
                                    eRMSOPDetection.IsDeleteButtonVisibility = Visibility.Hidden;
                                    eRMSOPDetection.IsValidateOnTextInput = false;
                                }
                                else
                                {
                                    Module.IsCurrentWorkOperation = true;
                                    eRMSOPDetection.IsValidateOnTextInput = true;
                                }
                                if (Module.IdStatus == 1536)
                                {
                                    eRMSOPDetection.IsInactiveWorkOperation = true;
                                }

                                try
                                {
                                    if (!DetectionMenulist.Any(a => a.KeyName.Equals(Module.KeyName)))
                                    {
                                        DetectionMenulist.Add(eRMSOPDetection);
                                    }

                                }
                                catch (Exception ex)
                                {

                                }
                            }
                        }
                        List<ERMSOPDetection> tempWorkOperationDetectionMenulist = DetectionMenulist.OrderBy(x => x.Position).ToList();
                        DetectionMenulist.Clear();
                        DetectionMenulist.AddRange(tempWorkOperationDetectionMenulist);
                        tempWorkOperationDetectionMenulist.Clear();
                        #endregion
                    }
                    FillDetectionGridColumn();
                    detectionCustomSummarycalculation();
                    e.Handled = true;
                }
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in Method CompleteDropRecordDetectionGrid()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        private void CompleteDropRecorDetectionGrid(DropRecordEventArgs e)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method CompleteDropRecorDetectionGrid()...", category: Category.Info, priority: Priority.Low);
                Saveselecteditem = "Detection"; //[GEOS2-4108][Rupali Sarode][3-1-2022]
                string WOWithStatusMessage = string.Empty;  // [GEOS2-5020][Rupali Sarode][29-11-2023]
                ObservableCollection<ERMSOPDetection> DetectionMenulistTemp = new ObservableCollection<ERMSOPDetection>();  //[GEOS2-4830][gulab lakade][07 12 2023]
                if (!DXSplashScreen.IsActive)
                {
                    DXSplashScreen.Show(x =>
                    {
                        Window win = new Window()
                        {
                            ShowActivated = false,
                            WindowStyle = WindowStyle.None,
                            ResizeMode = ResizeMode.NoResize,
                            AllowsTransparency = true,
                            Background = new SolidColorBrush(Colors.Transparent),
                            ShowInTaskbar = false,
                            Topmost = true,
                            SizeToContent = SizeToContent.WidthAndHeight,
                            WindowStartupLocation = WindowStartupLocation.CenterScreen,
                        };
                        WindowFadeAnimationBehavior.SetEnableAnimation(win, true);
                        win.Topmost = false;
                        return win;
                    }, x =>
                    {
                        return new SplashScreenView() { DataContext = new SplashScreenViewModel() };
                    }, null, null);
                }

                if (SelectedItemDetection is ERMDetections)
                {

                    IsEnabledSaveButton = true;
                    SaveButtonVisibility = Visibility.Visible;
                    duplicateItemloopDetection = 0;
                    if ((e.IsFromOutside) && typeof(WorkOperationByStages).IsAssignableFrom(e.GetRecordType()))
                    {
                        //WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                        var data = (RecordDragDropData)e.Data.GetData(typeof(RecordDragDropData));
                        List<WorkOperationByStages> found = new List<WorkOperationByStages>();
                        List<WorkOperationByStages> TempfoundAllrecords = new List<WorkOperationByStages>();
                        List<WorkOperationByStages> records = data.Records.OfType<WorkOperationByStages>().ToList();
                        operationDetectionMenulist = new ObservableCollection<WorkOperationByStages>();
                        int count = 0;
                        if (DetectionMenulist == null)
                        {
                            DetectionMenulist = new ObservableCollection<ERMSOPDetection>();
                        }
                        //#region start [GEOS2-4830][gulab lakade][07 12 2023]
                        if (DetectionMenulist.Count > 0)
                        {
                            DetectionMenulistTemp = DetectionMenulist;
                        }

                        if (records.Any(a => a.Name.Equals("All")))
                        {
                            #region ALL
                            found = new List<WorkOperationByStages>();
                            operationDetectionMenulist = new ObservableCollection<WorkOperationByStages>();
                            operationDetectionMenulist.AddRange(WorkOperationMenulist.Where(w => !w.Name.Equals("All")));
                            #endregion
                        }
                        else
                        {

                            for (int r = 0; r < records.Count(); r++)
                            {
                                if (!DetectionMenulistTemp.Any(a => a.Name.Equals(records[r].Name)))
                                {
                                    // if (records[r].IdStatus != 1536) [rdixit][GEOS2-3764][04.08.2022]
                                    //  {
                                    records[r].IsCurrentWorkOperation = true;
                                    //DetectionMenulist.Add(JsonConvert.DeserializeObject<ERMSOPDetection>(JsonConvert.SerializeObject(records[r])));
                                    if (!operationDetectionMenulist.Any(a => a.KeyName.Equals(records[r].KeyName)))
                                        operationDetectionMenulist.Add(records[r]);
                                    // }


                                }

                                if (GetStages.Any(a => a != null && a.Code.Trim().Equals(records[r].Name.Trim())))
                                {
                                    found.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(records[r].KeyName)).ToList());
                                    int x = 0;
                                    Loop:
                                    x++;
                                    if (x < 4)
                                    {
                                        for (int i = 0; i < found.Count(); i++)
                                        {
                                            TempfoundAllrecords.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(found[i].KeyName)).ToList());
                                        }
                                        for (int i = 0; i < TempfoundAllrecords.Count(); i++)
                                        {
                                            if (!found.Any(a => a != null && a.KeyName.Trim().Equals(TempfoundAllrecords[i].KeyName.Trim())))
                                                found.Add(TempfoundAllrecords[i]);
                                        }
                                        goto Loop;
                                    }

                                }
                                else
                                {
                                    found.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(records[r].KeyName)).ToList());
                                    for (int i = 0; i < found.Count(); i++)
                                    {
                                        TempfoundAllrecords.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(found[i].KeyName)).ToList());
                                    }
                                    for (int i = 0; i < TempfoundAllrecords.Count(); i++)
                                    {
                                        if (!found.Any(a => a != null && a.KeyName.Trim().Equals(TempfoundAllrecords[i].KeyName.Trim())))
                                            found.Add(TempfoundAllrecords[i]);
                                    }
                                    for (int i = 0; i < records.Where(a => a.IdworkOperationByStage > 0).Count(); i++)
                                    {
                                        if (!found.Any(a => a != null && a.KeyName.Trim().Equals(records[i].KeyName.Trim())))
                                            found.AddRange(WorkOperationMenulist.Where(s => s.IdworkOperationByStage == records[i].IdworkOperationByStage).ToList());
                                        if (found.Count() != 0)
                                        {
                                            count++;
                                        }
                                    }
                                }

                            }
                        }


                        if (count > 0)
                        {
                            for (int i = 0; i < found.Count(); i++)
                            {
                                if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(found[i].Name.Trim())))
                                {
                                    duplicateItemloopDetection = 0;
                                    GetAllTreeListDetection(found[i], WorkOperationMenulist);
                                }

                            }
                        }
                        else
                        {

                            if (!records.Any(a => a.Name.Equals("All")))
                                foreach (WorkOperationByStages item in found)
                                {
                                    duplicateItemloopDetection = 0;
                                    GetAllTreeListDetection(item, WorkOperationMenulist);
                                }
                        }
                        if (!records.Any(a => a.Name.Equals("All")))
                            if (operationDetectionMenulist != null)
                            {
                                var tempModuleMenulist = operationDetectionMenulist.ToList();
                                for (int i = 0; i < tempModuleMenulist.Count; i++)
                                {
                                    if (GetStages.Any(a => a.Code.Equals(tempModuleMenulist[i].Name)))
                                    {
                                        List<WorkOperationByStages> childList = operationDetectionMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(tempModuleMenulist[i].KeyName)).ToList();
                                        if (childList.Count == 0)
                                        {
                                            operationDetectionMenulist.Remove(tempModuleMenulist[i]);
                                        }
                                    }
                                }
                            }


                        #region [GEOS2-5020][Rupali Sarode][30-11-2023]
                        List<string> WOWithStatusList;

                        WOWithStatusList = new List<string>();
                        // string WOWithStatus = string.Empty;
                        string WOStausForChild = string.Empty;
                        List<WorkOperationByStages> WOChilds = operationDetectionMenulist.Where(i => i.ParentName != null && i.ParentName == records[0].KeyName).ToList();
                        if (WOChilds != null)
                        {
                            if (WOChilds.Count == 0) //If dropped item is child
                            {
                                if (records[0].Name != "All")
                                {
                                    int WOIdStatus = operationDetectionMenulist.Where(i => i.Name == records[0].Name).FirstOrDefault().IdStatus;
                                    if (WOIdStatus > 0 && WOIdStatus != 1535)
                                    {
                                        if (WOIdStatus == 1536) WOStausForChild = "in inactive status";
                                        if (WOIdStatus == 1537) WOStausForChild = "in draft status";

                                        if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                                        CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("AddEditSODDragOnlyActiveWO").ToString() + "\n" + "Work operation '" + records[0].Name + "' is " + WOStausForChild), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                                        return;
                                    }
                                }

                            }
                        }


                        #endregion [GEOS2-5020][Rupali Sarode][30-11-2023]

                        #region [GEOS2-4830][gulab lakade][07 12 2023]
                        if (AllSupplementsBoxMenu != null)
                        {
                            var listadoDuplicadas = from c in AllSupplementsBoxMenu
                                                    join c2 in AllSupplementsBoxMenu on c.Item2 equals c2.Item2
                                                    where c != c2
                                                    select c;

                            var DetectionSandardOperationTime = listadoDuplicadas.FirstOrDefault();
                            if (DetectionSandardOperationTime != null)
                            {
                                var templist = listadoDuplicadas.Where(a => a.Item2 == DetectionSandardOperationTime.Item2);
                                listadoDuplicadas = templist;
                            }

                            var tempSupplementsBoxMenu = AllSupplementsBoxMenu;

                            ColumnsDetectionForSupplements = new ObservableCollection<TreeListColumn>();
                            ColumnsDetectionForSupplements.Add(new TreeListColumn()
                            {
                                FieldName = "DetectionStandardSupplements",
                                Header = "Standard",
                                HeaderToolTip = "Standard",
                                AllowCellMerge = false,
                                Width = 150,    //gulab lakade not show Supplement proper
                                AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                Visible = true,
                                ReadOnly = false,
                                FixedWidth = false
                            });

                            ColumnsDetectionOperationTime = new ObservableCollection<TreeListColumn>();
                            ColumnsDetectionOperationTime.Add(new TreeListColumn()
                            {
                                FieldName = "UiTempDetectionStandardOperationTimeName",
                                Header = "Standard",
                                HeaderToolTip = "Standard",
                                AllowCellMerge = false,
                                Width = 150,    //gulab lakade not show StandardOperationTime proper
                                AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                Visible = true,
                                ReadOnly = false,
                                FixedWidth = false
                            });

                            int Supplimentcount = 1;
                            var ColumnsDetectionList = tempSupplementsBoxMenu.Where(p => !listadoDuplicadas.Any(p2 => p2.Item1 == p.Item1));
                            foreach (var item in ColumnsDetectionList)
                            {
                                if (Supplimentcount == 5)
                                {
                                    ColumnsDetectionForSupplements.Add(new TreeListColumn()
                                    {
                                        FieldName = "DetectionSupplementPlant" + Supplimentcount + "Value",
                                        Header = "Others",
                                        HeaderToolTip = "Others",
                                        AllowCellMerge = false,
                                        Width = 60,
                                        AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                        Visible = true,
                                        ReadOnly = false,
                                        FixedWidth = false
                                    });
                                    ColumnsDetectionOperationTime.Add(new TreeListColumn()
                                    {
                                        FieldName = "UiTempDetectionOperationTimePlant" + Supplimentcount + "Value",
                                        Header = "Others",
                                        HeaderToolTip = "Others",
                                        AllowCellMerge = false,
                                        Width = 60,
                                        AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                        Visible = true,
                                        ReadOnly = false,
                                        FixedWidth = false
                                    });
                                    break;
                                }
                                if (Supplimentcount == 5)
                                {
                                    break;
                                }
                                ColumnsDetectionForSupplements.Add(new TreeListColumn()
                                {
                                    FieldName = "DetectionSupplementPlant" + Supplimentcount + "Value",
                                    Header = item.Item1,
                                    HeaderToolTip = item.Item1,
                                    AllowCellMerge = false,
                                    Width = 60,
                                    AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                    Visible = true,
                                    ReadOnly = false,
                                    FixedWidth = false
                                });

                                ColumnsDetectionOperationTime.Add(new TreeListColumn()
                                {
                                    FieldName = "UiTempDetectionOperationTimePlant" + Supplimentcount + "Value",
                                    Header = item.Item1,
                                    HeaderToolTip = item.Item1,
                                    AllowCellMerge = false,
                                    Width = 60,
                                    AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                    Visible = true,
                                    ReadOnly = false,
                                    FixedWidth = false
                                });
                                Supplimentcount = Supplimentcount + 1;
                            }

                            #region commonCode

                            bool FlagAddItemToList; //[GEOS2-5020][Rupali Sarode][29-11-2023]

                            foreach (WorkOperationByStages Detection in WorkOperationMenulist)
                            {
                                FlagAddItemToList = true; //[GEOS2-5020][Rupali Sarode][29-11-2023]

                                // if (Detection.IdStatus != 1536) [rdixit][GEOS2-3764][04.08.2022]
                                if (operationDetectionMenulist.Any(a => a.IdworkOperationByStage == Convert.ToInt64(Detection.IdworkOperationByStage))
                                       && operationDetectionMenulist.Any(a => a.IdStage == Detection.IdStage)
                                    && operationDetectionMenulist.Any(a => a.Name.Trim().Equals(Detection.Name.Trim()))
                                    )
                                {

                                    //[GEOS2-5020][Rupali Sarode][30-11-2023] 
                                    List<WorkOperationByStages> TempWOChilds = new List<WorkOperationByStages>();
                                    TempWOChilds = operationDetectionMenulist.Where(i => i.ParentName == Detection.KeyName).ToList();

                                    if (GetStages.Any(a => a.Code.Equals(Detection.Name)))
                                    //If it is stage and only one parent is selected which is inactive/draft, then do not add such a stage to list
                                    {
                                        List<WorkOperationByStages> childListInActiveDraft = operationDetectionMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(Detection.KeyName)).ToList();

                                        if (childListInActiveDraft.Count > 0)
                                        {
                                            foreach (WorkOperationByStages objChild in childListInActiveDraft)
                                            {
                                                List<WorkOperationByStages> GrandChildListInActiveDraft = new List<WorkOperationByStages>();
                                                GrandChildListInActiveDraft = operationDetectionMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(objChild.KeyName)).ToList();
                                                if (GrandChildListInActiveDraft.Count == 0)
                                                { // If it is child and Active
                                                    if (objChild.IdStatus == 1535)
                                                    {
                                                        FlagAddItemToList = true;
                                                        break;
                                                    }
                                                    else
                                                    {
                                                        FlagAddItemToList = false;
                                                    }

                                                }
                                                else
                                                {
                                                    if (GrandChildListInActiveDraft.Count > 0)
                                                    {
                                                        if (GrandChildListInActiveDraft.Where(i => i.IdStatus == 1535).Count() > 0)
                                                        {
                                                            FlagAddItemToList = true;
                                                            break;
                                                        }
                                                        else
                                                        {
                                                            FlagAddItemToList = false;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    else if (TempWOChilds.Count() > 0 && (TempWOChilds.Count() == TempWOChilds.Where(i => i.IdStatus != 1535).Count()))
                                    // All children are in inactive/draft status
                                    {
                                        // do not add such parent to list in grid
                                        FlagAddItemToList = false;
                                    }
                                    //}
                                    else
                                    if (TempWOChilds.Count == 0 && Detection.IdStatus != 1535)
                                    // If child is inactive/draft, do not add it.
                                    // If Parent is inactive/draft, add it only if it has inactive/draft child(s).
                                    {
                                        if (string.IsNullOrEmpty(WOWithStatusMessage))
                                        {
                                            if (Detection.IdStatus == 1536)
                                                WOWithStatusMessage = "Work operation '" + Detection.Name + "' is " + "in inactive status";
                                            else if (Detection.IdStatus == 1537)
                                                WOWithStatusMessage = "Work operation '" + Detection.Name + "' is " + "in draft status";
                                        }
                                        else
                                        {
                                            if (Detection.IdStatus == 1536)
                                                WOWithStatusMessage = WOWithStatusMessage + "\n" + "Work operation '" + Detection.Name + "' is " + "in inactive status";
                                            else if (Detection.IdStatus == 1537)
                                                WOWithStatusMessage = WOWithStatusMessage + "\n" + "Work operation '" + Detection.Name + "' is " + "in draft status";
                                        }
                                        FlagAddItemToList = false;

                                    }




                                    //if (Detection.IdStatus != 1536 && Detection.IdStatus != 1537) //[GEOS2-5020][Rupali Sarode][30-11-2023]
                                    //{

                                    ERMSOPDetection eRMSOPDetection = new ERMSOPDetection();
                                    eRMSOPDetection.Name = Detection.Name;
                                    eRMSOPDetection.IdworkOperationByStage = Detection.IdworkOperationByStage;
                                    eRMSOPDetection.IdSequence = Detection.IdSequence;
                                    eRMSOPDetection.IdStatus = Detection.IdStatus;
                                    eRMSOPDetection.Status = Detection.Status;
                                    eRMSOPDetection.Code = Detection.Name;
                                    eRMSOPDetection.Parent = Detection.Parent;
                                    eRMSOPDetection.IdParent = Detection.IdParent;
                                    eRMSOPDetection.KeyName = Detection.KeyName;
                                    eRMSOPDetection.ParentName = Detection.ParentName;
                                    eRMSOPDetection.Position = Detection.Position;
                                    #region [GEOS2-5629][gulab lakade][16 07 2024]
                                    if (DetectionMenulistTemp != null)
                                    {
                                        if (Detection.ParentName == null)
                                        {
                                            eRMSOPDetection.DetectionPosition = Detection.Position;
                                        }
                                        else
                                        {
                                            #region [gulab lakade][beta changes][01082024]
                                            if (DetectionMenulistTemp.Count() == 0)
                                            {
                                                if (Detection.Position == 1)
                                                {
                                                    eRMSOPDetection.DetectionPosition = Detection.Position;
                                                }
                                                else
                                                {
                                                    eRMSOPDetection.DetectionPosition = 1;
                                                }

                                            }
                                            else
                                            {
                                                #endregion
                                                var TempModule = DetectionMenulistTemp.Where(x => x.KeyName == Detection.KeyName).FirstOrDefault();
                                                if (TempModule != null)
                                                {
                                                    eRMSOPDetection.DetectionPosition = TempModule.DetectionPosition;
                                                }
                                                else
                                                {
                                                    if (DetectionMenulistTemp.Where(x => x.ParentName == Detection.ParentName).FirstOrDefault() == null)
                                                    {
                                                        var maxpos = DetectionMenulistTemp.Max(a => a.DetectionPosition);
                                                        eRMSOPDetection.DetectionPosition = maxpos + 1;
                                                    }
                                                    else
                                                    {
                                                        var maxpos = DetectionMenulistTemp.Where(x => x.ParentName == Detection.ParentName).Max(a => a.DetectionPosition);
                                                        eRMSOPDetection.DetectionPosition = maxpos + 1;
                                                    }

                                                }
                                            }//[gulab lakade][beta changes][01082024]
                                        }


                                    }

                                    #endregion
                                    eRMSOPDetection.WorkOperation_count = Detection.WorkOperation_count;
                                    eRMSOPDetection.WorkOperation_count_original = Detection.WorkOperation_count_original;
                                    eRMSOPDetection.NameWithWorkOperationCount = Detection.NameWithWorkOperationCount;
                                    eRMSOPDetection.DetectionNormalTime = Detection.NormalTime;

                                    ERMDetections tIdDetection = (ERMDetections)SelectedItemDetection;  //[GEOS2-3922][Rupali Sarode][09-11-2022]
                                    eRMSOPDetection.IdDetection = Convert.ToUInt64(tIdDetection.IdDetection); //[GEOS2-3922][Rupali Sarode][09-11-2022]

                                    //[GEOS2-3933][Rupali Sarode][21/09/2022]
                                    eRMSOPDetection.WORemarks = Detection.WORemarks == null ? "" : Detection.WORemarks.Trim();


                                    if (Detection.NormalTime != null)
                                    {
                                        eRMSOPDetection.DetectionNormalTime = Math.Round((double)Detection.NormalTime, 2);
                                        #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                        eRMSOPDetection.UITempDetectionNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(eRMSOPDetection.DetectionNormalTime));
                                        #endregion
                                    }
                                    eRMSOPDetection.DetectionObservedTime = Detection.ObservedTime;
                                    if (Detection.ObservedTime != null)
                                    {
                                        eRMSOPDetection.DetectionObservedTime = Math.Round((double)Detection.ObservedTime, 2);
                                        #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                        eRMSOPDetection.UITempDetectionobservedTime = ConvertfloattoTimespan(Convert.ToString(eRMSOPDetection.DetectionObservedTime));
                                        #endregion
                                    }
                                    eRMSOPDetection.DetectionActivity = Detection.Activity;
                                    if (eRMSOPDetection.DetectionActivity != 0)
                                        eRMSOPDetection.DetectionActivity = Math.Round((double)Detection.Activity, 2);
                                    if (eRMSOPDetection.DetectionActivity == 0)
                                        eRMSOPDetection.DetectionActivity = null;
                                    if (GetStages.Any(a => a != null && a.Code.Trim().Equals(Detection.Name.Trim())))
                                    {
                                        Detection.IsCurrentWorkOperation = true;
                                        eRMSOPDetection.IsDeleteButton = false;
                                        eRMSOPDetection.IsDeleteButtonVisibility = Visibility.Hidden;
                                        eRMSOPDetection.IsValidateOnTextInput = false;
                                    }
                                    else
                                    {
                                        Detection.IsCurrentWorkOperation = true;

                                        eRMSOPDetection.IsValidateOnTextInput = true;
                                    }
                                    if (Detection.IdStatus == 1536)
                                    {
                                        eRMSOPDetection.IsInactiveWorkOperation = true;
                                    }
                                    #region [GEOS2-4830][gulab lakade][07 12 2023]
                                    if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(eRMSOPDetection.Name.Trim())))
                                    {
                                        if (DetectionSandardOperationTime != null)
                                            eRMSOPDetection.DetectionStandardSupplements = (float?)DetectionSandardOperationTime.Item2;
                                        if (tempSupplementsBoxMenu.Any(p => !listadoDuplicadas.Any(p2 => p2.Item1 == p.Item1)))
                                        {
                                            eRMSOPDetection.AllSupplementsBoxMenu = AllSupplementsBoxMenu;
                                            List<float?> lst = new List<float?>();

                                            var a = ColumnsDetectionList.ToList();
                                            for (int i = 0; i < a.Count(); i++)
                                            {
                                                lst.Add((float?)a[i].Item2);
                                            }

                                            if (ColumnsDetectionList.Count() == 1)
                                            {
                                                eRMSOPDetection.DetectionSupplementPlant1Value = (float?)lst[0];
                                            }
                                            else if (ColumnsDetectionList.Count() == 2)
                                            {
                                                eRMSOPDetection.DetectionSupplementPlant1Value = (float?)lst[0];
                                                eRMSOPDetection.DetectionSupplementPlant2Value = (float?)lst[1];
                                            }
                                            else if (ColumnsDetectionList.Count() == 3)
                                            {
                                                eRMSOPDetection.DetectionSupplementPlant1Value = (float?)lst[0];
                                                eRMSOPDetection.DetectionSupplementPlant2Value = (float?)lst[1];
                                                eRMSOPDetection.DetectionSupplementPlant3Value = (float?)lst[2];
                                            }
                                            else if (ColumnsDetectionList.Count() == 4)
                                            {
                                                eRMSOPDetection.DetectionSupplementPlant1Value = (float?)lst[0];
                                                eRMSOPDetection.DetectionSupplementPlant2Value = (float?)lst[1];
                                                eRMSOPDetection.DetectionSupplementPlant3Value = (float?)lst[2];
                                                eRMSOPDetection.DetectionSupplementPlant4Value = (float?)lst[3];
                                            }
                                            else if (ColumnsDetectionList.Count() == 5)
                                            {
                                                eRMSOPDetection.DetectionSupplementPlant1Value = (float?)lst[0];
                                                eRMSOPDetection.DetectionSupplementPlant2Value = (float?)lst[1];
                                                eRMSOPDetection.DetectionSupplementPlant3Value = (float?)lst[2];
                                                eRMSOPDetection.DetectionSupplementPlant4Value = (float?)lst[3];
                                                eRMSOPDetection.DetectionSupplementPlant5Value = (float?)lst[4];
                                            }
                                            else
                                            {
                                                eRMSOPDetection.DetectionSupplementPlant1Value = (float?)lst[0];
                                                eRMSOPDetection.DetectionSupplementPlant2Value = (float?)lst[1];
                                                eRMSOPDetection.DetectionSupplementPlant3Value = (float?)lst[2];
                                                eRMSOPDetection.DetectionSupplementPlant4Value = (float?)lst[3];
                                                eRMSOPDetection.DetectionSupplementPlant5Value = 0;
                                                if (ColumnsDetectionList.Count() > 5)
                                                {
                                                    for (int q = 4; q < ColumnsDetectionList.Count(); q++)
                                                    {
                                                        if (eRMSOPDetection.DetectionSupplementPlant5Value == null)
                                                            eRMSOPDetection.DetectionSupplementPlant5Value = 0;
                                                        eRMSOPDetection.DetectionSupplementPlant5Value = eRMSOPDetection.DetectionSupplementPlant5Value + (float?)lst[q];
                                                    }
                                                }


                                            }

                                        }
                                        #region GEOS2-4046 Gulab Lakade
                                        if (DetectionSandardOperationTime != null)
                                            eRMSOPDetection.DetectionStandardOperationTime = (float?)Math.Round(Convert.ToDouble(eRMSOPDetection.DetectionNormalTime * (1 + (Convert.ToDouble(DetectionSandardOperationTime.Item2) / 100))), 2);

                                        eRMSOPDetection.DetectionOperationTimePlant1Value = (float?)Math.Round(Convert.ToDouble(eRMSOPDetection.DetectionNormalTime * (1 + (Convert.ToDouble(eRMSOPDetection.DetectionSupplementPlant1Value) / 100))), 2);
                                        eRMSOPDetection.DetectionOperationTimePlant2Value = (float?)Math.Round(Convert.ToDouble(eRMSOPDetection.DetectionNormalTime * (1 + (Convert.ToDouble(eRMSOPDetection.DetectionSupplementPlant2Value) / 100))), 2);
                                        eRMSOPDetection.DetectionOperationTimePlant3Value = (float?)Math.Round(Convert.ToDouble(eRMSOPDetection.DetectionNormalTime * (1 + (Convert.ToDouble(eRMSOPDetection.DetectionSupplementPlant3Value) / 100))), 2);
                                        eRMSOPDetection.DetectionOperationTimePlant4Value = (float?)Math.Round(Convert.ToDouble(eRMSOPDetection.DetectionNormalTime * (1 + (Convert.ToDouble(eRMSOPDetection.DetectionSupplementPlant4Value) / 100))), 2);
                                        eRMSOPDetection.DetectionOperationTimePlant5Value = (float?)Math.Round(Convert.ToDouble(eRMSOPDetection.DetectionNormalTime * (1 + (Convert.ToDouble(eRMSOPDetection.DetectionSupplementPlant5Value) / 100))), 2);
                                        #endregion
                                        #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                        try
                                        {
                                            eRMSOPDetection.UiTempDetectionStandardOperationTimeName = ConvertfloattoTimespan(Convert.ToString(eRMSOPDetection.DetectionStandardOperationTime));
                                            eRMSOPDetection.UiTempDetectionOperationTimePlant1Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPDetection.DetectionOperationTimePlant1Value));
                                            eRMSOPDetection.UiTempDetectionOperationTimePlant2Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPDetection.DetectionOperationTimePlant2Value));
                                            eRMSOPDetection.UiTempDetectionOperationTimePlant3Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPDetection.DetectionOperationTimePlant3Value));
                                            eRMSOPDetection.UiTempDetectionOperationTimePlant4Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPDetection.DetectionOperationTimePlant4Value));
                                            eRMSOPDetection.UiTempDetectionOperationTimePlant5Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPDetection.DetectionOperationTimePlant5Value));
                                        }
                                        catch (Exception ex)
                                        {
                                            GeosApplication.Instance.Logger.Log(string.Format("Error in Method FillDetectionGridColumn() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                        }
                                        #endregion
                                    }

                                    #endregion
                                    try
                                    {
                                        //if (!DetectionMenulistTemp.Any(a => a.KeyName.Equals(Detection.KeyName)))
                                        if (!DetectionMenulistTemp.Any(a => a.KeyName.Equals(Detection.KeyName)) && FlagAddItemToList == true) //  [GEOS2-5020][Rupali Sarode][29-11-2023]
                                        {
                                            DetectionMenulistTemp.Add(eRMSOPDetection);
                                        }

                                    }
                                    catch (Exception ex)
                                    {

                                    }
                                    //}
                                }
                            }
                            #endregion
                        }
                    }
                    //List<ERMSOPDetection> tempWorkOperationDetectionMenulist = DetectionMenulistTemp.OrderBy(x => x.Position).ToList();
                    List<ERMSOPDetection> tempWorkOperationDetectionMenulist = DetectionMenulistTemp.OrderBy(x => x.DetectionPosition).ToList();
                    DetectionMenulistTemp.Clear();
                    DetectionMenulistTemp.AddRange(tempWorkOperationDetectionMenulist);
                    tempWorkOperationDetectionMenulist.Clear();
                    #region RND 
                    #region calculation

                    #region [GEOS2-4830][gulab lakade][07 12 2023]
                    //if (DetectionMenulistTemp != null)
                    //    //foreach (ERMSOPDetection itemERMSOPDetection in DetectionMenulistTemp)
                    //    for (int d = 0; d < DetectionMenulistTemp.Count(); d++)
                    //    {
                    //        WorkOperationMenulist.Where(w => w.KeyName == DetectionMenulistTemp[d].KeyName).ToList().ForEach(f => f.IsCurrentWorkOperation = true);
                    //        var listCount = DetectionMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(DetectionMenulistTemp[d].KeyName) && w.IsInactiveWorkOperation == false).ToList();//[rdixit][03.08.2022][GEOS2-3764]
                    //        if (listCount != null)
                    //            if (listCount.Count() > 0)
                    //            {
                    //                DetectionMenulistTemp[d].DetectionObservedTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.DetectionObservedTime)), 2);
                    //                DetectionMenulistTemp[d].DetectionNormalTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.DetectionNormalTime)), 2);
                    //                #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                    //                DetectionMenulistTemp[d].UITempDetectionobservedTime = ConvertfloattoTimespan(Convert.ToString(Convert.ToDouble(listCount.Sum(s => s.DetectionObservedTime))));
                    //                DetectionMenulistTemp[d].UITempDetectionNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(Convert.ToDouble(listCount.Sum(s => s.DetectionNormalTime))));
                    //                #endregion
                    //                DetectionMenulistTemp[d].IsReadOnly = true;
                    //            }
                    //    }
                    #endregion
                    if (DetectionMenulistTemp != null)
                        for (int d = 0; d < DetectionMenulistTemp.Count(); d++)
                        {
                            WorkOperationMenulist.Where(w => w.KeyName == DetectionMenulistTemp[d].KeyName).ToList().ForEach(f => f.IsCurrentWorkOperation = true);
                            //[GEOS2-5135][Rupali Sarode][18-12-2023]
                            // var listCount = DetectionMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(DetectionMenulistTemp[d].KeyName) && w.IsInactiveWorkOperation == false).ToList();//[rdixit][03.08.2022][GEOS2-3764]
                            var listCount = DetectionMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(DetectionMenulistTemp[d].KeyName)).ToList();
                            if (listCount != null)
                                if (listCount.Count() > 0)
                                {
                                    DetectionMenulistTemp[d].DetectionObservedTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.DetectionObservedTime)), 2);
                                    DetectionMenulistTemp[d].DetectionNormalTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.DetectionNormalTime)), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    DetectionMenulistTemp[d].UITempDetectionobservedTime = ConvertfloattoTimespan(Convert.ToString(Convert.ToDouble(listCount.Sum(s => s.DetectionObservedTime))));
                                    DetectionMenulistTemp[d].UITempDetectionNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(Convert.ToDouble(listCount.Sum(s => s.DetectionNormalTime))));
                                    #endregion
                                    DetectionMenulistTemp[d].IsReadOnly = true;
                                }
                        }

                    if (DetectionMenulistTemp != null)
                        //foreach (ERMSOPDetection itemERMSOPDetection in DetectionMenulistTemp)
                        for (int d = 0; d < DetectionMenulistTemp.Count(); d++)
                        {
                            if (GetStages.Any(a => a.Code.Equals(DetectionMenulistTemp[d].Name)))
                            {
                                ObservableCollection<ERMSOPDetection> ActivitySum = new ObservableCollection<ERMSOPDetection>();
                                ObservableCollection<ERMSOPDetection> TempActivitySum = new ObservableCollection<ERMSOPDetection>();
                                int x = 1;
                                Loop:
                                x++;
                                if (x < 10)
                                {
                                    if (ActivitySum.Count == 0)
                                    {
                                        DetectionMenulistTemp[d].DetectionObservedTime = 0;
                                        DetectionMenulistTemp[d].DetectionNormalTime = 0;
                                        #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                        DetectionMenulistTemp[d].UITempDetectionobservedTime = ConvertfloattoTimespan(Convert.ToString(DetectionMenulistTemp[d].DetectionObservedTime));
                                        DetectionMenulistTemp[d].UITempDetectionNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(DetectionMenulistTemp[d].DetectionNormalTime));
                                        #endregion
                                        //[GEOS2-5135][Rupali Sarode][18-12-2023]
                                        //var ActivitySumList = DetectionMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(DetectionMenulistTemp[d].KeyName) && w.IsInactiveWorkOperation == false).ToList();//[rdixit][03.08.2022][GEOS2-3764]
                                        var ActivitySumList = DetectionMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(DetectionMenulistTemp[d].KeyName)).ToList();
                                        ActivitySum.AddRange(ActivitySumList);
                                    }
                                    else
                                    {
                                        #region Commented Code
                                        //foreach (var item in ActivitySum)
                                        //{
                                        //    var ActivitySumList = DetectionMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(item.KeyName)).ToList();
                                        //    if (ActivitySumList != null && ActivitySumList.Count > 0)
                                        //    {

                                        //        foreach (var itemActivity in ActivitySumList)
                                        //        {
                                        //            if (!ActivitySum.Any(ac => ac.KeyName.Equals(itemActivity.KeyName)))
                                        //            {
                                        //                TempActivitySum.Add(itemActivity);
                                        //            }

                                        //        }

                                        //    }

                                        //}
                                        //ActivitySum.AddRange(TempActivitySum);
                                        #endregion
                                    }


                                    goto Loop;
                                }

                                double? ObservedTime = 0;
                                double? NormalTime = 0;
                                float? StandardTime = 0;
                                float? OperationTimePlant1Value = 0;
                                float? OperationTimePlant2Value = 0;
                                float? OperationTimePlant3Value = 0;
                                float? OperationTimePlant4Value = 0;
                                float? OperationTimePlant5Value = 0;
                                var tempDistinctList = ActivitySum.Select(xa => xa.KeyName).Distinct().ToList();
                                foreach (var item in tempDistinctList)
                                {
                                    if (DetectionMenulistTemp[d].DetectionObservedTime == null)
                                        DetectionMenulistTemp[d].DetectionObservedTime = 0;
                                    double? tempObservedTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.DetectionObservedTime).FirstOrDefault();
                                    if (tempObservedTime != null)
                                    {
                                        ObservedTime = Math.Round(Convert.ToDouble(ObservedTime + tempObservedTime), 2);
                                        #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                        DetectionMenulistTemp[d].UITempDetectionobservedTime = ConvertfloattoTimespan(Convert.ToString(ObservedTime));
                                        #endregion
                                    }

                                    if (DetectionMenulistTemp[d].DetectionNormalTime == null)
                                        DetectionMenulistTemp[d].DetectionNormalTime = 0;
                                    double? tempNormalTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.DetectionNormalTime).FirstOrDefault();
                                    if (tempNormalTime != null)
                                    {
                                        NormalTime = Math.Round(Convert.ToDouble(NormalTime + tempNormalTime), 2);
                                        #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                        DetectionMenulistTemp[d].UITempDetectionNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(NormalTime));
                                        #endregion
                                    }

                                }
                                DetectionMenulistTemp[d].DetectionObservedTime = ObservedTime;
                                DetectionMenulistTemp[d].DetectionNormalTime = NormalTime;
                                #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                DetectionMenulistTemp[d].UITempDetectionobservedTime = ConvertfloattoTimespan(Convert.ToString(ObservedTime));
                                DetectionMenulistTemp[d].UITempDetectionNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(DetectionMenulistTemp[d].DetectionNormalTime));
                                #endregion
                                //DetectionMenulistTemp[d].DetectionNormalTime = Math.Round(Convert.ToDouble(ObservedTime * DetectionMenulistTemp[d].DetectionActivity / 100), 2);
                                #region PlantValue


                                foreach (var item in tempDistinctList)
                                {
                                    if (DetectionMenulistTemp[d].DetectionStandardOperationTime == null)
                                        DetectionMenulistTemp[d].DetectionStandardOperationTime = 0;
                                    float? tempStandardTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.DetectionStandardOperationTime).FirstOrDefault();
                                    if (tempStandardTime != null)
                                        StandardTime = StandardTime + tempStandardTime;

                                    if (DetectionMenulistTemp[d].DetectionOperationTimePlant1Value == null)
                                        DetectionMenulistTemp[d].DetectionOperationTimePlant1Value = 0;
                                    float? tempOperationTimePlant1Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.DetectionOperationTimePlant1Value).FirstOrDefault();
                                    if (tempOperationTimePlant1Value != null)
                                        OperationTimePlant1Value = OperationTimePlant1Value + tempOperationTimePlant1Value;

                                    if (DetectionMenulistTemp[d].DetectionOperationTimePlant2Value == null)
                                        DetectionMenulistTemp[d].DetectionOperationTimePlant2Value = 0;
                                    float? tempOperationTimePlant2Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.DetectionOperationTimePlant2Value).FirstOrDefault();
                                    if (tempOperationTimePlant2Value != null)
                                        OperationTimePlant2Value = OperationTimePlant2Value + tempOperationTimePlant2Value;

                                    if (DetectionMenulistTemp[d].DetectionOperationTimePlant3Value == null)
                                        DetectionMenulistTemp[d].DetectionOperationTimePlant3Value = 0;
                                    float? tempOperationTimePlant3Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.DetectionOperationTimePlant3Value).FirstOrDefault();
                                    if (tempOperationTimePlant3Value != null)
                                        OperationTimePlant3Value = OperationTimePlant3Value + tempOperationTimePlant3Value;

                                    if (DetectionMenulistTemp[d].DetectionOperationTimePlant4Value == null)
                                        DetectionMenulistTemp[d].DetectionOperationTimePlant4Value = 0;
                                    float? tempOperationTimePlant4Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.DetectionOperationTimePlant4Value).FirstOrDefault();
                                    if (tempOperationTimePlant4Value != null)
                                        OperationTimePlant4Value = OperationTimePlant4Value + tempOperationTimePlant4Value;

                                    if (DetectionMenulistTemp[d].DetectionOperationTimePlant5Value == null)
                                        DetectionMenulistTemp[d].DetectionOperationTimePlant5Value = 0;
                                    float? tempOperationTimePlant5Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.DetectionOperationTimePlant5Value).FirstOrDefault();
                                    if (tempOperationTimePlant5Value != null)
                                        OperationTimePlant5Value = OperationTimePlant5Value + tempOperationTimePlant5Value;
                                }
                                #endregion
                                DetectionMenulistTemp[d].DetectionStandardOperationTime = (float?)Math.Round(Convert.ToDouble(StandardTime), 2);
                                DetectionMenulistTemp[d].DetectionOperationTimePlant1Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant1Value), 2);
                                DetectionMenulistTemp[d].DetectionOperationTimePlant2Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant2Value), 2);
                                DetectionMenulistTemp[d].DetectionOperationTimePlant3Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant3Value), 2);
                                DetectionMenulistTemp[d].DetectionOperationTimePlant4Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant4Value), 2);
                                DetectionMenulistTemp[d].DetectionOperationTimePlant5Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant5Value), 2);

                                #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                try
                                {
                                    DetectionMenulistTemp[d].UiTempDetectionStandardOperationTimeName = ConvertfloattoTimespan(Convert.ToString(DetectionMenulistTemp[d].DetectionStandardOperationTime));
                                    DetectionMenulistTemp[d].UiTempDetectionOperationTimePlant1Value = ConvertfloattoTimespan(Convert.ToString(DetectionMenulistTemp[d].DetectionOperationTimePlant1Value));
                                    DetectionMenulistTemp[d].UiTempDetectionOperationTimePlant2Value = ConvertfloattoTimespan(Convert.ToString(DetectionMenulistTemp[d].DetectionOperationTimePlant2Value));
                                    DetectionMenulistTemp[d].UiTempDetectionOperationTimePlant3Value = ConvertfloattoTimespan(Convert.ToString(DetectionMenulistTemp[d].DetectionOperationTimePlant3Value));
                                    DetectionMenulistTemp[d].UiTempDetectionOperationTimePlant4Value = ConvertfloattoTimespan(Convert.ToString(DetectionMenulistTemp[d].DetectionOperationTimePlant4Value));
                                    DetectionMenulistTemp[d].UiTempDetectionOperationTimePlant5Value = ConvertfloattoTimespan(Convert.ToString(DetectionMenulistTemp[d].DetectionOperationTimePlant5Value));
                                }
                                catch (Exception ex)
                                {
                                    GeosApplication.Instance.Logger.Log(string.Format("Error in Method FillDetectionGridColumn() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                }
                                #endregion
                            }
                        }
                    #endregion
                    if (DetectionMenulistTemp != null)
                        DetectionMenulist = DetectionMenulistTemp;
                    #endregion
                    //FillDetectionGridColumn(); //[GEOS2-4830][gulab lakade][07 12 2023]
                    // detectionCustomSummarycalculation();

                    FlagToDragDrop = true;  //[GEOS2-3909][Rupali Sarode][11-11-2022]
                    e.Handled = true;

                    if (!string.IsNullOrEmpty(WOWithStatusMessage)) //  [GEOS2-5020][Rupali Sarode][29-11-2023]
                    {
                        if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                        CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("AddEditSODDragOnlyActiveWO").ToString() + "\n" + WOWithStatusMessage), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                    }

                }
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Method CompleteDropRecorDetectionGrid()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in Method CompleteDropRecorDetectionGrid()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        private void FillDetectionGridColumn()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillDetectionGridColumn()...", category: Category.Info, priority: Priority.Low);
                if (AllSupplementsBoxMenu != null)
                {
                    var listadoDuplicadas = from c in AllSupplementsBoxMenu
                                            join c2 in AllSupplementsBoxMenu on c.Item2 equals c2.Item2
                                            where c != c2
                                            select c;

                    var DetectionSandardOperationTime = listadoDuplicadas.FirstOrDefault();
                    if (DetectionSandardOperationTime != null)
                    {
                        var templist = listadoDuplicadas.Where(a => a.Item2 == DetectionSandardOperationTime.Item2);
                        listadoDuplicadas = templist;
                    }

                    var tempSupplementsBoxMenu = AllSupplementsBoxMenu;

                    ColumnsDetectionForSupplements = new ObservableCollection<TreeListColumn>();
                    ColumnsDetectionForSupplements.Add(new TreeListColumn()
                    {
                        FieldName = "DetectionStandardSupplements",
                        Header = "Standard",
                        HeaderToolTip = "Standard",
                        AllowCellMerge = false,
                        Width = 150,    //gulab lakade not show Supplement proper
                        AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                        Visible = true,
                        ReadOnly = false,
                        FixedWidth = false
                    });

                    ColumnsDetectionOperationTime = new ObservableCollection<TreeListColumn>();
                    ColumnsDetectionOperationTime.Add(new TreeListColumn()
                    {
                        FieldName = "UiTempDetectionStandardOperationTimeName",
                        Header = "Standard",
                        HeaderToolTip = "Standard",
                        AllowCellMerge = false,
                        Width = 150,    //gulab lakade not show StandardOperationTime proper
                        AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                        Visible = true,
                        ReadOnly = false,
                        FixedWidth = false
                    });

                    int count = 1;
                    var ColumnsDetectionList = tempSupplementsBoxMenu.Where(p => !listadoDuplicadas.Any(p2 => p2.Item1 == p.Item1));
                    foreach (var item in ColumnsDetectionList)
                    {
                        if (count == 5)
                        {
                            ColumnsDetectionForSupplements.Add(new TreeListColumn()
                            {
                                FieldName = "DetectionSupplementPlant" + count + "Value",
                                Header = "Others",
                                HeaderToolTip = "Others",
                                AllowCellMerge = false,
                                Width = 60,
                                AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                Visible = true,
                                ReadOnly = false,
                                FixedWidth = false
                            });
                            ColumnsDetectionOperationTime.Add(new TreeListColumn()
                            {
                                FieldName = "UiTempDetectionOperationTimePlant" + count + "Value",
                                Header = "Others",
                                HeaderToolTip = "Others",
                                AllowCellMerge = false,
                                Width = 60,
                                AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                Visible = true,
                                ReadOnly = false,
                                FixedWidth = false
                            });
                            break;
                        }
                        if (count == 5)
                        {
                            break;
                        }
                        ColumnsDetectionForSupplements.Add(new TreeListColumn()
                        {
                            FieldName = "DetectionSupplementPlant" + count + "Value",
                            Header = item.Item1,
                            HeaderToolTip = item.Item1,
                            AllowCellMerge = false,
                            Width = 60,
                            AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                            Visible = true,
                            ReadOnly = false,
                            FixedWidth = false
                        });

                        ColumnsDetectionOperationTime.Add(new TreeListColumn()
                        {
                            FieldName = "UiTempDetectionOperationTimePlant" + count + "Value",
                            Header = item.Item1,
                            HeaderToolTip = item.Item1,
                            AllowCellMerge = false,
                            Width = 60,
                            AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                            Visible = true,
                            ReadOnly = false,
                            FixedWidth = false
                        });
                        count = count + 1;
                    }


                    if (DetectionMenulist != null)

                        for (int d = 0; d < DetectionMenulist.Count(); d++)
                        {
                            if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(DetectionMenulist[d].Name.Trim())))
                            {
                                if (DetectionSandardOperationTime != null)
                                    DetectionMenulist[d].DetectionStandardSupplements = (float?)DetectionSandardOperationTime.Item2;
                                if (tempSupplementsBoxMenu.Any(p => !listadoDuplicadas.Any(p2 => p2.Item1 == p.Item1)))
                                {
                                    DetectionMenulist[d].AllSupplementsBoxMenu = AllSupplementsBoxMenu;
                                    List<float?> lst = new List<float?>();

                                    var a = ColumnsDetectionList.ToList();
                                    for (int i = 0; i < a.Count(); i++)
                                    {
                                        lst.Add((float?)a[i].Item2);
                                    }

                                    if (ColumnsDetectionList.Count() == 1)
                                    {
                                        DetectionMenulist[d].DetectionSupplementPlant1Value = (float?)lst[0];
                                    }
                                    else if (ColumnsDetectionList.Count() == 2)
                                    {
                                        DetectionMenulist[d].DetectionSupplementPlant1Value = (float?)lst[0];
                                        DetectionMenulist[d].DetectionSupplementPlant2Value = (float?)lst[1];
                                    }
                                    else if (ColumnsDetectionList.Count() == 3)
                                    {
                                        DetectionMenulist[d].DetectionSupplementPlant1Value = (float?)lst[0];
                                        DetectionMenulist[d].DetectionSupplementPlant2Value = (float?)lst[1];
                                        DetectionMenulist[d].DetectionSupplementPlant3Value = (float?)lst[2];
                                    }
                                    else if (ColumnsDetectionList.Count() == 4)
                                    {
                                        DetectionMenulist[d].DetectionSupplementPlant1Value = (float?)lst[0];
                                        DetectionMenulist[d].DetectionSupplementPlant2Value = (float?)lst[1];
                                        DetectionMenulist[d].DetectionSupplementPlant3Value = (float?)lst[2];
                                        DetectionMenulist[d].DetectionSupplementPlant4Value = (float?)lst[3];
                                    }
                                    else if (ColumnsDetectionList.Count() == 5)
                                    {
                                        DetectionMenulist[d].DetectionSupplementPlant1Value = (float?)lst[0];
                                        DetectionMenulist[d].DetectionSupplementPlant2Value = (float?)lst[1];
                                        DetectionMenulist[d].DetectionSupplementPlant3Value = (float?)lst[2];
                                        DetectionMenulist[d].DetectionSupplementPlant4Value = (float?)lst[3];
                                        DetectionMenulist[d].DetectionSupplementPlant5Value = (float?)lst[4];
                                    }
                                    else
                                    {
                                        DetectionMenulist[d].DetectionSupplementPlant1Value = (float?)lst[0];
                                        DetectionMenulist[d].DetectionSupplementPlant2Value = (float?)lst[1];
                                        DetectionMenulist[d].DetectionSupplementPlant3Value = (float?)lst[2];
                                        DetectionMenulist[d].DetectionSupplementPlant4Value = (float?)lst[3];
                                        DetectionMenulist[d].DetectionSupplementPlant5Value = 0;
                                        if (ColumnsDetectionList.Count() > 5)
                                        {
                                            for (int q = 4; q < ColumnsDetectionList.Count(); q++)
                                            {
                                                if (DetectionMenulist[d].DetectionSupplementPlant5Value == null)
                                                    DetectionMenulist[d].DetectionSupplementPlant5Value = 0;
                                                DetectionMenulist[d].DetectionSupplementPlant5Value = DetectionMenulist[d].DetectionSupplementPlant5Value + (float?)lst[q];
                                            }
                                        }


                                    }

                                }
                                #region GEOS2-4046 Gulab Lakade
                                if (DetectionSandardOperationTime != null)
                                    DetectionMenulist[d].DetectionStandardOperationTime = (float?)Math.Round(Convert.ToDouble(DetectionMenulist[d].DetectionNormalTime * (1 + (Convert.ToDouble(DetectionSandardOperationTime.Item2) / 100))), 2);

                                DetectionMenulist[d].DetectionOperationTimePlant1Value = (float?)Math.Round(Convert.ToDouble(DetectionMenulist[d].DetectionNormalTime * (1 + (Convert.ToDouble(DetectionMenulist[d].DetectionSupplementPlant1Value) / 100))), 2);
                                DetectionMenulist[d].DetectionOperationTimePlant2Value = (float?)Math.Round(Convert.ToDouble(DetectionMenulist[d].DetectionNormalTime * (1 + (Convert.ToDouble(DetectionMenulist[d].DetectionSupplementPlant2Value) / 100))), 2);
                                DetectionMenulist[d].DetectionOperationTimePlant3Value = (float?)Math.Round(Convert.ToDouble(DetectionMenulist[d].DetectionNormalTime * (1 + (Convert.ToDouble(DetectionMenulist[d].DetectionSupplementPlant3Value) / 100))), 2);
                                DetectionMenulist[d].DetectionOperationTimePlant4Value = (float?)Math.Round(Convert.ToDouble(DetectionMenulist[d].DetectionNormalTime * (1 + (Convert.ToDouble(DetectionMenulist[d].DetectionSupplementPlant4Value) / 100))), 2);
                                DetectionMenulist[d].DetectionOperationTimePlant5Value = (float?)Math.Round(Convert.ToDouble(DetectionMenulist[d].DetectionNormalTime * (1 + (Convert.ToDouble(DetectionMenulist[d].DetectionSupplementPlant5Value) / 100))), 2);
                                #endregion
                                #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                try
                                {
                                    DetectionMenulist[d].UiTempDetectionStandardOperationTimeName = ConvertfloattoTimespan(Convert.ToString(DetectionMenulist[d].DetectionStandardOperationTime));
                                    DetectionMenulist[d].UiTempDetectionOperationTimePlant1Value = ConvertfloattoTimespan(Convert.ToString(DetectionMenulist[d].DetectionOperationTimePlant1Value));
                                    DetectionMenulist[d].UiTempDetectionOperationTimePlant2Value = ConvertfloattoTimespan(Convert.ToString(DetectionMenulist[d].DetectionOperationTimePlant2Value));
                                    DetectionMenulist[d].UiTempDetectionOperationTimePlant3Value = ConvertfloattoTimespan(Convert.ToString(DetectionMenulist[d].DetectionOperationTimePlant3Value));
                                    DetectionMenulist[d].UiTempDetectionOperationTimePlant4Value = ConvertfloattoTimespan(Convert.ToString(DetectionMenulist[d].DetectionOperationTimePlant4Value));
                                    DetectionMenulist[d].UiTempDetectionOperationTimePlant5Value = ConvertfloattoTimespan(Convert.ToString(DetectionMenulist[d].DetectionOperationTimePlant5Value));
                                }
                                catch (Exception ex)
                                {
                                    GeosApplication.Instance.Logger.Log(string.Format("Error in Method FillDetectionGridColumn() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                }
                                #endregion
                            }
                        }
                    //foreach (ERMSOPDetection itemERMSOPDetection in DetectionMenulist)
                    //{
                    //    if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(itemERMSOPDetection.Name.Trim())))
                    //    {
                    //        if (DetectionSandardOperationTime != null)
                    //            itemERMSOPDetection.StandardSupplements = (float?)DetectionSandardOperationTime.Item2;
                    //        if (tempSupplementsBoxMenu.Any(p => !listadoDuplicadas.Any(p2 => p2.Item1 == p.Item1)))
                    //        {
                    //            itemERMSOPDetection.AllSupplementsBoxMenu = AllSupplementsBoxMenu;
                    //            List<float?> lst = new List<float?>();

                    //            var a = ColumnsDetectionList.ToList();
                    //            for (int i = 0; i < a.Count(); i++)
                    //            {
                    //                lst.Add((float?)a[i].Item2);
                    //            }

                    //            if (ColumnsDetectionList.Count() == 1)
                    //            {
                    //                itemERMSOPDetection.SupplementPlant1Value = (float?)lst[0];
                    //            }
                    //            else if (ColumnsDetectionList.Count() == 2)
                    //            {
                    //                itemERMSOPDetection.SupplementPlant1Value = (float?)lst[0];
                    //                itemERMSOPDetection.SupplementPlant2Value = (float?)lst[1];
                    //            }
                    //            else if (ColumnsDetectionList.Count() == 3)
                    //            {
                    //                itemERMSOPDetection.SupplementPlant1Value = (float?)lst[0];
                    //                itemERMSOPDetection.SupplementPlant2Value = (float?)lst[1];
                    //                itemERMSOPDetection.SupplementPlant3Value = (float?)lst[2];
                    //            }
                    //            else if (ColumnsDetectionList.Count() == 4)
                    //            {
                    //                itemERMSOPDetection.SupplementPlant1Value = (float?)lst[0];
                    //                itemERMSOPDetection.SupplementPlant2Value = (float?)lst[1];
                    //                itemERMSOPDetection.SupplementPlant3Value = (float?)lst[2];
                    //                itemERMSOPDetection.SupplementPlant4Value = (float?)lst[3];
                    //            }
                    //            else if (ColumnsDetectionList.Count() == 5)
                    //            {
                    //                itemERMSOPDetection.SupplementPlant1Value = (float?)lst[0];
                    //                itemERMSOPDetection.SupplementPlant2Value = (float?)lst[1];
                    //                itemERMSOPDetection.SupplementPlant3Value = (float?)lst[2];
                    //                itemERMSOPDetection.SupplementPlant4Value = (float?)lst[3];
                    //                itemERMSOPDetection.SupplementPlant5Value = (float?)lst[4];
                    //            }
                    //            else
                    //            {
                    //                itemERMSOPDetection.SupplementPlant1Value = (float?)lst[0];
                    //                itemERMSOPDetection.SupplementPlant2Value = (float?)lst[1];
                    //                itemERMSOPDetection.SupplementPlant3Value = (float?)lst[2];
                    //                itemERMSOPDetection.SupplementPlant4Value = (float?)lst[3];
                    //                itemERMSOPDetection.SupplementPlant5Value = 0;
                    //                if (ColumnsDetectionList.Count() > 5)
                    //                {
                    //                    for (int q = 4; q < ColumnsDetectionList.Count(); q++)
                    //                    {
                    //                        if (itemERMSOPDetection.SupplementPlant5Value == null)
                    //                            itemERMSOPDetection.SupplementPlant5Value = 0;
                    //                        itemERMSOPDetection.SupplementPlant5Value = itemERMSOPDetection.SupplementPlant5Value + (float?)lst[q];
                    //                    }
                    //                }


                    //            }

                    //        }

                    //        if (DetectionSandardOperationTime != null)
                    //            itemERMSOPDetection.StandardOperationTime = (float?)(itemERMSOPDetection.NormalTime * (1 +( DetectionSandardOperationTime.Item2 / 100)));

                    //        itemERMSOPDetection.OperationTimePlant1Value = (float?)(itemERMSOPDetection.NormalTime * (1 + (itemERMSOPDetection.SupplementPlant1Value / 100)));
                    //        itemERMSOPDetection.OperationTimePlant2Value = (float?)(itemERMSOPDetection.NormalTime * (1 + (itemERMSOPDetection.SupplementPlant2Value / 100)));
                    //        itemERMSOPDetection.OperationTimePlant3Value = (float?)(itemERMSOPDetection.NormalTime * (1 + (itemERMSOPDetection.SupplementPlant3Value / 100)));
                    //        itemERMSOPDetection.OperationTimePlant4Value = (float?)(itemERMSOPDetection.NormalTime * (1 + (itemERMSOPDetection.SupplementPlant4Value / 100)));
                    //        itemERMSOPDetection.OperationTimePlant5Value = (float?)(itemERMSOPDetection.NormalTime * (1 + (itemERMSOPDetection.SupplementPlant5Value / 100)));

                    //    }
                    //}
                }
                GeosApplication.Instance.Logger.Log("Method FillDetectionGridColumn()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method FillDetectionGridColumn() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        private void FillStructureGridColumn()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillStructureGridColumn()...", category: Category.Info, priority: Priority.Low);
                if (AllSupplementsBoxMenu != null)
                {
                    var listadoDuplicadas = from c in AllSupplementsBoxMenu
                                            join c2 in AllSupplementsBoxMenu on c.Item2 equals c2.Item2
                                            where c != c2
                                            select c;

                    var StructureStandardOperationTime = listadoDuplicadas.FirstOrDefault();
                    if (StructureStandardOperationTime != null)
                    {
                        var templist = listadoDuplicadas.Where(a => a.Item2 == StructureStandardOperationTime.Item2);
                        listadoDuplicadas = templist;
                    }

                    var tempSupplementsBoxMenu = AllSupplementsBoxMenu;

                    ColumnsStructureForSupplements = new ObservableCollection<TreeListColumn>();
                    ColumnsStructureForSupplements.Add(new TreeListColumn()
                    {
                        FieldName = "StructureStandardSupplements",
                        Header = "Standard",
                        HeaderToolTip = "Standard",
                        AllowCellMerge = false,
                        Width = 150,    //gulab lakade not show Supplement proper
                        AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                        Visible = true,
                        ReadOnly = false,
                        FixedWidth = false
                    });

                    ColumnsStructureOperationTime = new ObservableCollection<TreeListColumn>();
                    ColumnsStructureOperationTime.Add(new TreeListColumn()
                    {
                        FieldName = "UiTempStandardOperationTimeName",
                        Header = "Standard",
                        HeaderToolTip = "Standard",
                        AllowCellMerge = false,
                        Width = 150,    //gulab lakade not show StandardOperationTime proper
                        AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                        Visible = true,
                        ReadOnly = false,
                        FixedWidth = false
                    });

                    int count = 1;
                    var ColumnsStructureList = tempSupplementsBoxMenu.Where(p => !listadoDuplicadas.Any(p2 => p2.Item1 == p.Item1));
                    foreach (var item in ColumnsStructureList)
                    {
                        if (count == 5)
                        {
                            ColumnsStructureForSupplements.Add(new TreeListColumn()
                            {
                                FieldName = "StructureSupplementPlant" + count + "Value",
                                Header = "Others",
                                HeaderToolTip = "Others",
                                AllowCellMerge = false,
                                Width = 60,
                                AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                Visible = true,
                                ReadOnly = false,
                                FixedWidth = false
                            });
                            ColumnsStructureOperationTime.Add(new TreeListColumn()
                            {
                                FieldName = "UiTempoperationTimePlant" + count + "Value",
                                Header = "Others",
                                HeaderToolTip = "Others",
                                AllowCellMerge = false,
                                Width = 60,
                                AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                Visible = true,
                                ReadOnly = false,
                                FixedWidth = false
                            });
                            break;
                        }
                        if (count == 5)
                        {
                            break;
                        }
                        ColumnsStructureForSupplements.Add(new TreeListColumn()
                        {
                            FieldName = "StructureSupplementPlant" + count + "Value",
                            Header = item.Item1,
                            HeaderToolTip = item.Item1,
                            AllowCellMerge = false,
                            Width = 60,
                            AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                            Visible = true,
                            ReadOnly = false,
                            FixedWidth = false
                        });

                        ColumnsStructureOperationTime.Add(new TreeListColumn()
                        {
                            FieldName = "UiTempoperationTimePlant" + count + "Value",
                            Header = item.Item1,
                            HeaderToolTip = item.Item1,
                            AllowCellMerge = false,
                            Width = 60,
                            AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                            Visible = true,
                            ReadOnly = false,
                            FixedWidth = false
                        });
                        count = count + 1;
                    }


                    if (StructureMenulist != null)

                        for (int d = 0; d < StructureMenulist.Count(); d++)
                        {
                            if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(StructureMenulist[d].Name.Trim())))
                            {
                                if (StructureStandardOperationTime != null)
                                    StructureMenulist[d].StructureStandardSupplements = (float?)StructureStandardOperationTime.Item2;
                                if (tempSupplementsBoxMenu.Any(p => !listadoDuplicadas.Any(p2 => p2.Item1 == p.Item1)))
                                {
                                    StructureMenulist[d].AllSupplementsBoxMenu = AllSupplementsBoxMenu;
                                    List<float?> lst = new List<float?>();

                                    var a = ColumnsStructureList.ToList();
                                    for (int i = 0; i < a.Count(); i++)
                                    {
                                        lst.Add((float?)a[i].Item2);
                                    }

                                    if (ColumnsStructureList.Count() == 1)
                                    {
                                        StructureMenulist[d].StructureSupplementPlant1Value = (float?)lst[0];
                                    }
                                    else if (ColumnsStructureList.Count() == 2)
                                    {
                                        StructureMenulist[d].StructureSupplementPlant1Value = (float?)lst[0];
                                        StructureMenulist[d].StructureSupplementPlant2Value = (float?)lst[1];
                                    }
                                    else if (ColumnsStructureList.Count() == 3)
                                    {
                                        StructureMenulist[d].StructureSupplementPlant1Value = (float?)lst[0];
                                        StructureMenulist[d].StructureSupplementPlant2Value = (float?)lst[1];
                                        StructureMenulist[d].StructureSupplementPlant3Value = (float?)lst[2];
                                    }
                                    else if (ColumnsStructureList.Count() == 4)
                                    {
                                        StructureMenulist[d].StructureSupplementPlant1Value = (float?)lst[0];
                                        StructureMenulist[d].StructureSupplementPlant2Value = (float?)lst[1];
                                        StructureMenulist[d].StructureSupplementPlant3Value = (float?)lst[2];
                                        StructureMenulist[d].StructureSupplementPlant4Value = (float?)lst[3];
                                    }
                                    else if (ColumnsStructureList.Count() == 5)
                                    {
                                        StructureMenulist[d].StructureSupplementPlant1Value = (float?)lst[0];
                                        StructureMenulist[d].StructureSupplementPlant2Value = (float?)lst[1];
                                        StructureMenulist[d].StructureSupplementPlant3Value = (float?)lst[2];
                                        StructureMenulist[d].StructureSupplementPlant4Value = (float?)lst[3];
                                        StructureMenulist[d].StructureSupplementPlant5Value = (float?)lst[4];
                                    }
                                    else
                                    {
                                        StructureMenulist[d].StructureSupplementPlant1Value = (float?)lst[0];
                                        StructureMenulist[d].StructureSupplementPlant2Value = (float?)lst[1];
                                        StructureMenulist[d].StructureSupplementPlant3Value = (float?)lst[2];
                                        StructureMenulist[d].StructureSupplementPlant4Value = (float?)lst[3];
                                        StructureMenulist[d].StructureSupplementPlant5Value = 0;
                                        if (ColumnsStructureList.Count() > 5)
                                        {
                                            for (int q = 4; q < ColumnsStructureList.Count(); q++)
                                            {
                                                if (StructureMenulist[d].StructureSupplementPlant5Value == null)
                                                    StructureMenulist[d].StructureSupplementPlant5Value = 0;
                                                StructureMenulist[d].StructureSupplementPlant5Value = StructureMenulist[d].StructureSupplementPlant5Value + (float?)lst[q];
                                            }
                                        }


                                    }

                                }
                                #region GEOS2-4046 Gulab Lakade
                                if (StructureStandardOperationTime != null)
                                    StructureMenulist[d].StructureStandardOperationTime = (float?)Math.Round(Convert.ToDouble(StructureMenulist[d].StructureNormalTime * (1 + (Convert.ToDouble(StructureStandardOperationTime.Item2) / 100))), 2);

                                StructureMenulist[d].StructureOperationTimePlant1Value = (float?)Math.Round(Convert.ToDouble(StructureMenulist[d].StructureNormalTime * (1 + (Convert.ToDouble(StructureMenulist[d].StructureSupplementPlant1Value) / 100))), 2);
                                StructureMenulist[d].StructureOperationTimePlant2Value = (float?)Math.Round(Convert.ToDouble(StructureMenulist[d].StructureNormalTime * (1 + (Convert.ToDouble(StructureMenulist[d].StructureSupplementPlant2Value) / 100))), 2);
                                StructureMenulist[d].StructureOperationTimePlant3Value = (float?)Math.Round(Convert.ToDouble(StructureMenulist[d].StructureNormalTime * (1 + (Convert.ToDouble(StructureMenulist[d].StructureSupplementPlant3Value) / 100))), 2);
                                StructureMenulist[d].StructureOperationTimePlant4Value = (float?)Math.Round(Convert.ToDouble(StructureMenulist[d].StructureNormalTime * (1 + (Convert.ToDouble(StructureMenulist[d].StructureSupplementPlant4Value) / 100))), 2);
                                StructureMenulist[d].StructureOperationTimePlant5Value = (float?)Math.Round(Convert.ToDouble(StructureMenulist[d].StructureNormalTime * (1 + (Convert.ToDouble(StructureMenulist[d].StructureSupplementPlant5Value) / 100))), 2);
                                #endregion
                                #region GEOS2-3954 Show the WorkOperations and SOD Time in the format: MM:SS or HH:MM:SS
                                try
                                {
                                    StructureMenulist[d].UiTempStandardOperationTimeName = ConvertfloattoTimespan(Convert.ToString(StructureMenulist[d].StructureStandardOperationTime));
                                    StructureMenulist[d].UiTempoperationTimePlant1Value = ConvertfloattoTimespan(Convert.ToString(StructureMenulist[d].StructureOperationTimePlant1Value));
                                    StructureMenulist[d].UiTempoperationTimePlant2Value = ConvertfloattoTimespan(Convert.ToString(StructureMenulist[d].StructureOperationTimePlant2Value));
                                    StructureMenulist[d].UiTempoperationTimePlant3Value = ConvertfloattoTimespan(Convert.ToString(StructureMenulist[d].StructureOperationTimePlant3Value));
                                    StructureMenulist[d].UiTempoperationTimePlant4Value = ConvertfloattoTimespan(Convert.ToString(StructureMenulist[d].StructureOperationTimePlant4Value));
                                    StructureMenulist[d].UiTempoperationTimePlant5Value = ConvertfloattoTimespan(Convert.ToString(StructureMenulist[d].StructureOperationTimePlant5Value));
                                }
                                catch (Exception ex)
                                {
                                    GeosApplication.Instance.Logger.Log(string.Format("Error in Method FillDetectionGridColumn() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                }
                                #endregion
                            }
                        }

                }
                GeosApplication.Instance.Logger.Log("Method FillStructureGridColumn()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method FillStructureGridColumn() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        private void detectionCustomSummarycalculation()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method detectionCustomSummarycalculation()...", category: Category.Info, priority: Priority.Low);

                #region calculation

                #region [GEOS2-4830][gulab lakade][07 12 2023]
                //if (DetectionMenulist != null)
                //    //foreach (ERMSOPDetection itemERMSOPDetection in DetectionMenulist)
                //    for (int d = 0; d < DetectionMenulist.Count(); d++)
                //    {
                //        WorkOperationMenulist.Where(w => w.KeyName == DetectionMenulist[d].KeyName).ToList().ForEach(f => f.IsCurrentWorkOperation = true);
                //        var listCount = DetectionMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(DetectionMenulist[d].KeyName) && w.IsInactiveWorkOperation == false).ToList();//[rdixit][03.08.2022][GEOS2-3764]
                //        if (listCount != null)
                //            if (listCount.Count() > 0)
                //            {
                //                DetectionMenulist[d].DetectionObservedTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.DetectionObservedTime)), 2);
                //                DetectionMenulist[d].DetectionNormalTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.DetectionNormalTime)), 2);
                //                #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                //                DetectionMenulist[d].UITempDetectionobservedTime = ConvertfloattoTimespan(Convert.ToString(Convert.ToDouble(listCount.Sum(s => s.DetectionObservedTime))));
                //                DetectionMenulist[d].UITempDetectionNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(Convert.ToDouble(listCount.Sum(s => s.DetectionNormalTime))));
                //                #endregion
                //                DetectionMenulist[d].IsReadOnly = true;
                //            }
                //    }
                #endregion
                if (DetectionMenulist != null)
                    for (int d = 0; d < DetectionMenulist.Count(); d++)
                    {
                        WorkOperationMenulist.Where(w => w.KeyName == DetectionMenulist[d].KeyName).ToList().ForEach(f => f.IsCurrentWorkOperation = true);
                        //[GEOS2-5135][Rupali Sarode][18-12-2023]
                        // var listCount = DetectionMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(DetectionMenulist[d].KeyName) && w.IsInactiveWorkOperation == false).ToList();//[rdixit][03.08.2022][GEOS2-3764]
                        var listCount = DetectionMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(DetectionMenulist[d].KeyName)).ToList();
                        if (listCount != null)
                            if (listCount.Count() > 0)
                            {
                                DetectionMenulist[d].DetectionObservedTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.DetectionObservedTime)), 2);
                                DetectionMenulist[d].DetectionNormalTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.DetectionNormalTime)), 2);
                                #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                DetectionMenulist[d].UITempDetectionobservedTime = ConvertfloattoTimespan(Convert.ToString(Convert.ToDouble(listCount.Sum(s => s.DetectionObservedTime))));
                                DetectionMenulist[d].UITempDetectionNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(Convert.ToDouble(listCount.Sum(s => s.DetectionNormalTime))));
                                #endregion
                                DetectionMenulist[d].IsReadOnly = true;
                            }
                    }

                if (DetectionMenulist != null)
                    //foreach (ERMSOPDetection itemERMSOPDetection in DetectionMenulist)
                    for (int d = 0; d < DetectionMenulist.Count(); d++)
                    {
                        if (GetStages.Any(a => a.Code.Equals(DetectionMenulist[d].Name)))
                        {
                            ObservableCollection<ERMSOPDetection> ActivitySum = new ObservableCollection<ERMSOPDetection>();
                            ObservableCollection<ERMSOPDetection> TempActivitySum = new ObservableCollection<ERMSOPDetection>();
                            int x = 1;
                            Loop:
                            x++;
                            if (x < 10)
                            {
                                if (ActivitySum.Count == 0)
                                {
                                    DetectionMenulist[d].DetectionObservedTime = 0;
                                    DetectionMenulist[d].DetectionNormalTime = 0;
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    DetectionMenulist[d].UITempDetectionobservedTime = ConvertfloattoTimespan(Convert.ToString(DetectionMenulist[d].DetectionObservedTime));
                                    DetectionMenulist[d].UITempDetectionNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(DetectionMenulist[d].DetectionNormalTime));
                                    #endregion
                                    //[GEOS2-5135][Rupali Sarode][18-12-2023]
                                    // var ActivitySumList = DetectionMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(DetectionMenulist[d].KeyName) && w.IsInactiveWorkOperation == false).ToList();//[rdixit][03.08.2022][GEOS2-3764]
                                    var ActivitySumList = DetectionMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(DetectionMenulist[d].KeyName)).ToList();
                                    ActivitySum.AddRange(ActivitySumList);
                                }
                                else
                                {
                                    #region Commented Code
                                    //foreach (var item in ActivitySum)
                                    //{
                                    //    var ActivitySumList = DetectionMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(item.KeyName)).ToList();
                                    //    if (ActivitySumList != null && ActivitySumList.Count > 0)
                                    //    {

                                    //        foreach (var itemActivity in ActivitySumList)
                                    //        {
                                    //            if (!ActivitySum.Any(ac => ac.KeyName.Equals(itemActivity.KeyName)))
                                    //            {
                                    //                TempActivitySum.Add(itemActivity);
                                    //            }

                                    //        }

                                    //    }

                                    //}
                                    //ActivitySum.AddRange(TempActivitySum);
                                    #endregion
                                }


                                goto Loop;
                            }

                            double? ObservedTime = 0;
                            double? NormalTime = 0;
                            float? StandardTime = 0;
                            float? OperationTimePlant1Value = 0;
                            float? OperationTimePlant2Value = 0;
                            float? OperationTimePlant3Value = 0;
                            float? OperationTimePlant4Value = 0;
                            float? OperationTimePlant5Value = 0;
                            var tempDistinctList = ActivitySum.Select(xa => xa.KeyName).Distinct().ToList();
                            foreach (var item in tempDistinctList)
                            {
                                if (DetectionMenulist[d].DetectionObservedTime == null)
                                    DetectionMenulist[d].DetectionObservedTime = 0;
                                double? tempObservedTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.DetectionObservedTime).FirstOrDefault();
                                if (tempObservedTime != null)
                                {
                                    ObservedTime = Math.Round(Convert.ToDouble(ObservedTime + tempObservedTime), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    DetectionMenulist[d].UITempDetectionobservedTime = ConvertfloattoTimespan(Convert.ToString(ObservedTime));
                                    #endregion
                                }

                                if (DetectionMenulist[d].DetectionNormalTime == null)
                                    DetectionMenulist[d].DetectionNormalTime = 0;
                                double? tempNormalTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.DetectionNormalTime).FirstOrDefault();
                                if (tempNormalTime != null)
                                {
                                    NormalTime = Math.Round(Convert.ToDouble(NormalTime + tempNormalTime), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    DetectionMenulist[d].UITempDetectionNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(NormalTime));
                                    #endregion
                                }

                            }
                            DetectionMenulist[d].DetectionObservedTime = ObservedTime;
                            DetectionMenulist[d].DetectionNormalTime = NormalTime;
                            #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                            DetectionMenulist[d].UITempDetectionobservedTime = ConvertfloattoTimespan(Convert.ToString(ObservedTime));
                            DetectionMenulist[d].UITempDetectionNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(DetectionMenulist[d].DetectionNormalTime));
                            #endregion
                            //DetectionMenulist[d].DetectionNormalTime = Math.Round(Convert.ToDouble(ObservedTime * DetectionMenulist[d].DetectionActivity / 100), 2);
                            #region PlantValue


                            foreach (var item in tempDistinctList)
                            {
                                if (DetectionMenulist[d].DetectionStandardOperationTime == null)
                                    DetectionMenulist[d].DetectionStandardOperationTime = 0;
                                float? tempStandardTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.DetectionStandardOperationTime).FirstOrDefault();
                                if (tempStandardTime != null)
                                    StandardTime = StandardTime + tempStandardTime;

                                if (DetectionMenulist[d].DetectionOperationTimePlant1Value == null)
                                    DetectionMenulist[d].DetectionOperationTimePlant1Value = 0;
                                float? tempOperationTimePlant1Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.DetectionOperationTimePlant1Value).FirstOrDefault();
                                if (tempOperationTimePlant1Value != null)
                                    OperationTimePlant1Value = OperationTimePlant1Value + tempOperationTimePlant1Value;

                                if (DetectionMenulist[d].DetectionOperationTimePlant2Value == null)
                                    DetectionMenulist[d].DetectionOperationTimePlant2Value = 0;
                                float? tempOperationTimePlant2Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.DetectionOperationTimePlant2Value).FirstOrDefault();
                                if (tempOperationTimePlant2Value != null)
                                    OperationTimePlant2Value = OperationTimePlant2Value + tempOperationTimePlant2Value;

                                if (DetectionMenulist[d].DetectionOperationTimePlant3Value == null)
                                    DetectionMenulist[d].DetectionOperationTimePlant3Value = 0;
                                float? tempOperationTimePlant3Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.DetectionOperationTimePlant3Value).FirstOrDefault();
                                if (tempOperationTimePlant3Value != null)
                                    OperationTimePlant3Value = OperationTimePlant3Value + tempOperationTimePlant3Value;

                                if (DetectionMenulist[d].DetectionOperationTimePlant4Value == null)
                                    DetectionMenulist[d].DetectionOperationTimePlant4Value = 0;
                                float? tempOperationTimePlant4Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.DetectionOperationTimePlant4Value).FirstOrDefault();
                                if (tempOperationTimePlant4Value != null)
                                    OperationTimePlant4Value = OperationTimePlant4Value + tempOperationTimePlant4Value;

                                if (DetectionMenulist[d].DetectionOperationTimePlant5Value == null)
                                    DetectionMenulist[d].DetectionOperationTimePlant5Value = 0;
                                float? tempOperationTimePlant5Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.DetectionOperationTimePlant5Value).FirstOrDefault();
                                if (tempOperationTimePlant5Value != null)
                                    OperationTimePlant5Value = OperationTimePlant5Value + tempOperationTimePlant5Value;
                            }
                            #endregion
                            DetectionMenulist[d].DetectionStandardOperationTime = (float?)Math.Round(Convert.ToDouble(StandardTime), 2);
                            DetectionMenulist[d].DetectionOperationTimePlant1Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant1Value), 2);
                            DetectionMenulist[d].DetectionOperationTimePlant2Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant2Value), 2);
                            DetectionMenulist[d].DetectionOperationTimePlant3Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant3Value), 2);
                            DetectionMenulist[d].DetectionOperationTimePlant4Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant4Value), 2);
                            DetectionMenulist[d].DetectionOperationTimePlant5Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant5Value), 2);

                            #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                            try
                            {
                                DetectionMenulist[d].UiTempDetectionStandardOperationTimeName = ConvertfloattoTimespan(Convert.ToString(DetectionMenulist[d].DetectionStandardOperationTime));
                                DetectionMenulist[d].UiTempDetectionOperationTimePlant1Value = ConvertfloattoTimespan(Convert.ToString(DetectionMenulist[d].DetectionOperationTimePlant1Value));
                                DetectionMenulist[d].UiTempDetectionOperationTimePlant2Value = ConvertfloattoTimespan(Convert.ToString(DetectionMenulist[d].DetectionOperationTimePlant2Value));
                                DetectionMenulist[d].UiTempDetectionOperationTimePlant3Value = ConvertfloattoTimespan(Convert.ToString(DetectionMenulist[d].DetectionOperationTimePlant3Value));
                                DetectionMenulist[d].UiTempDetectionOperationTimePlant4Value = ConvertfloattoTimespan(Convert.ToString(DetectionMenulist[d].DetectionOperationTimePlant4Value));
                                DetectionMenulist[d].UiTempDetectionOperationTimePlant5Value = ConvertfloattoTimespan(Convert.ToString(DetectionMenulist[d].DetectionOperationTimePlant5Value));
                            }
                            catch (Exception ex)
                            {
                                GeosApplication.Instance.Logger.Log(string.Format("Error in Method FillDetectionGridColumn() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            }
                            #endregion
                        }
                    }
                #endregion              

                GeosApplication.Instance.Logger.Log("Method detectionCustomSummarycalculation()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log(string.Format("Error in method detectionCustomSummarycalculation() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

            }

        }

        private void structureCustomSummarycalculation()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method structureCustomSummarycalculation()...", category: Category.Info, priority: Priority.Low);

                #region calculation
                #region [GEOS2-4830][gulab lakade][07 12 2023]
                //if (StructureMenulist != null)
                //    //foreach (ERMSOPDetection itemERMSOPDetection in DetectionMenulist)
                //    for (int d = 0; d < StructureMenulist.Count(); d++)
                //    {
                //        WorkOperationMenulist.Where(w => w.KeyName == StructureMenulist[d].KeyName).ToList().ForEach(f => f.IsCurrentWorkOperation = true);
                //        var listCount = StructureMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(StructureMenulist[d].KeyName) && w.IsInactiveWorkOperation == false).ToList();//[rdixit][03.08.2022][GEOS2-3764]
                //        if (listCount != null)
                //            if (listCount.Count() > 0)
                //            {
                //                StructureMenulist[d].StructureObservedTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.StructureObservedTime)), 2);
                //                StructureMenulist[d].StructureNormalTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.StructureNormalTime)), 2);
                //                #region [GEOS2-3954] [Rupali Sarode] Time format HH:mm:ss
                //                StructureMenulist[d].UITempStructureObservedTime = ConvertfloattoTimespan(Convert.ToString(Convert.ToDouble(listCount.Sum(s => s.StructureObservedTime))));
                //                StructureMenulist[d].UITempStructureNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(Convert.ToDouble(listCount.Sum(s => s.StructureNormalTime))));
                //                #endregion

                //                StructureMenulist[d].IsReadOnly = true;
                //            }
                //    }
                #endregion

                if (StructureMenulist != null)
                    for (int d = 0; d < StructureMenulist.Count(); d++)
                    {
                        WorkOperationMenulist.Where(w => w.KeyName == StructureMenulist[d].KeyName).ToList().ForEach(f => f.IsCurrentWorkOperation = true);
                        //[GEOS2-5135][Rupali Sarode][18-12-2023]
                        //var listCount = StructureMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(StructureMenulist[d].KeyName) && w.IsInactiveWorkOperation == false).ToList();//[rdixit][03.08.2022][GEOS2-3764]
                        var listCount = StructureMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(StructureMenulist[d].KeyName)).ToList();
                        if (listCount != null)
                            if (listCount.Count() > 0)
                            {
                                StructureMenulist[d].StructureObservedTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.StructureObservedTime)), 2);
                                StructureMenulist[d].StructureNormalTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.StructureNormalTime)), 2);

                                #region [GEOS2-3954] [Rupali Sarode] Time format HH:mm:ss
                                StructureMenulist[d].UITempStructureObservedTime = ConvertfloattoTimespan(Convert.ToString(listCount.Sum(s => s.StructureObservedTime)));
                                StructureMenulist[d].UITempStructureNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(listCount.Sum(s => s.StructureNormalTime)));
                                #endregion

                                StructureMenulist[d].IsReadOnly = true;
                            }
                    }

                if (StructureMenulist != null)
                    //foreach (ERMSOPDetection itemERMSOPDetection in DetectionMenulist)
                    for (int d = 0; d < StructureMenulist.Count(); d++)
                    {
                        if (GetStages.Any(a => a.Code.Equals(StructureMenulist[d].Name)))
                        {
                            ObservableCollection<ERMSOPStructures> ActivitySum = new ObservableCollection<ERMSOPStructures>();
                            ObservableCollection<ERMSOPStructures> TempActivitySum = new ObservableCollection<ERMSOPStructures>();
                            int x = 1;
                            Loop:
                            x++;
                            if (x < 10)
                            {
                                if (ActivitySum.Count == 0)
                                {
                                    StructureMenulist[d].StructureObservedTime = 0;
                                    StructureMenulist[d].StructureNormalTime = 0;
                                    #region [GEOS2-3954] [Rupali Sarode] Time format HH:mm:ss
                                    StructureMenulist[d].UITempStructureObservedTime = ConvertfloattoTimespan(Convert.ToString(StructureMenulist[d].StructureObservedTime));
                                    StructureMenulist[d].UITempStructureNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(StructureMenulist[d].StructureNormalTime));
                                    #endregion
                                    //[GEOS2-5135][Rupali Sarode][18-12-2023]
                                    //var ActivitySumList = StructureMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(StructureMenulist[d].KeyName) && w.IsInactiveWorkOperation == false).ToList();//[rdixit][03.08.2022][GEOS2-3764]
                                    var ActivitySumList = StructureMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(StructureMenulist[d].KeyName)).ToList();
                                    ActivitySum.AddRange(ActivitySumList);
                                }
                                else
                                {
                                    #region Commented Code
                                    //foreach (var item in ActivitySum)
                                    //{
                                    //    var ActivitySumList = DetectionMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(item.KeyName)).ToList();
                                    //    if (ActivitySumList != null && ActivitySumList.Count > 0)
                                    //    {

                                    //        foreach (var itemActivity in ActivitySumList)
                                    //        {
                                    //            if (!ActivitySum.Any(ac => ac.KeyName.Equals(itemActivity.KeyName)))
                                    //            {
                                    //                TempActivitySum.Add(itemActivity);
                                    //            }

                                    //        }

                                    //    }

                                    //}
                                    //ActivitySum.AddRange(TempActivitySum);
                                    #endregion
                                }


                                goto Loop;
                            }

                            double? ObservedTime = 0;
                            double? NormalTime = 0;
                            float? StandardTime = 0;
                            float? OperationTimePlant1Value = 0;
                            float? OperationTimePlant2Value = 0;
                            float? OperationTimePlant3Value = 0;
                            float? OperationTimePlant4Value = 0;
                            float? OperationTimePlant5Value = 0;
                            var tempDistinctList = ActivitySum.Select(xa => xa.KeyName).Distinct().ToList();
                            foreach (var item in tempDistinctList)
                            {
                                if (StructureMenulist[d].StructureObservedTime == null)
                                    StructureMenulist[d].StructureObservedTime = 0;
                                double? tempObservedTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.StructureObservedTime).FirstOrDefault();
                                if (tempObservedTime != null)
                                {
                                    ObservedTime = Math.Round(Convert.ToDouble(ObservedTime + tempObservedTime), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    StructureMenulist[d].UITempStructureObservedTime = ConvertfloattoTimespan(Convert.ToString(ObservedTime));
                                    #endregion
                                }
                                if (StructureMenulist[d].StructureNormalTime == null)
                                    StructureMenulist[d].StructureNormalTime = 0;
                                double? tempNormalTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.StructureNormalTime).FirstOrDefault();
                                if (tempNormalTime != null)
                                {
                                    NormalTime = Math.Round(Convert.ToDouble(NormalTime + tempNormalTime), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    StructureMenulist[d].UITempStructureNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(NormalTime));
                                    #endregion
                                }
                            }
                            StructureMenulist[d].StructureObservedTime = ObservedTime;
                            StructureMenulist[d].StructureNormalTime = NormalTime;
                            #region [GEOS2-3954] [Rupali Sarode] Time format HH:mm:ss
                            StructureMenulist[d].UITempStructureObservedTime = ConvertfloattoTimespan(Convert.ToString(ObservedTime));
                            StructureMenulist[d].UITempStructureNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(StructureMenulist[d].StructureNormalTime));
                            #endregion

                            //DetectionMenulist[d].DetectionNormalTime = Math.Round(Convert.ToDouble(ObservedTime * DetectionMenulist[d].DetectionActivity / 100), 2);
                            #region PlantValue


                            foreach (var item in tempDistinctList)
                            {
                                if (StructureMenulist[d].StructureStandardOperationTime == null)
                                    StructureMenulist[d].StructureStandardOperationTime = 0;
                                float? tempStandardTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.StructureStandardOperationTime).FirstOrDefault();
                                if (tempStandardTime != null)
                                    StandardTime = StandardTime + tempStandardTime;

                                if (StructureMenulist[d].StructureOperationTimePlant1Value == null)
                                    StructureMenulist[d].StructureOperationTimePlant1Value = 0;
                                float? tempOperationTimePlant1Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.StructureOperationTimePlant1Value).FirstOrDefault();
                                if (tempOperationTimePlant1Value != null)
                                    OperationTimePlant1Value = OperationTimePlant1Value + tempOperationTimePlant1Value;

                                if (StructureMenulist[d].StructureOperationTimePlant2Value == null)
                                    StructureMenulist[d].StructureOperationTimePlant2Value = 0;
                                float? tempOperationTimePlant2Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.StructureOperationTimePlant2Value).FirstOrDefault();
                                if (tempOperationTimePlant2Value != null)
                                    OperationTimePlant2Value = OperationTimePlant2Value + tempOperationTimePlant2Value;

                                if (StructureMenulist[d].StructureOperationTimePlant3Value == null)
                                    StructureMenulist[d].StructureOperationTimePlant3Value = 0;
                                float? tempOperationTimePlant3Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.StructureOperationTimePlant3Value).FirstOrDefault();
                                if (tempOperationTimePlant3Value != null)
                                    OperationTimePlant3Value = OperationTimePlant3Value + tempOperationTimePlant3Value;

                                if (StructureMenulist[d].StructureOperationTimePlant4Value == null)
                                    StructureMenulist[d].StructureOperationTimePlant4Value = 0;
                                float? tempOperationTimePlant4Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.StructureOperationTimePlant4Value).FirstOrDefault();
                                if (tempOperationTimePlant4Value != null)
                                    OperationTimePlant4Value = OperationTimePlant4Value + tempOperationTimePlant4Value;

                                if (StructureMenulist[d].StructureOperationTimePlant5Value == null)
                                    StructureMenulist[d].StructureOperationTimePlant5Value = 0;
                                float? tempOperationTimePlant5Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.StructureOperationTimePlant5Value).FirstOrDefault();
                                if (tempOperationTimePlant5Value != null)
                                    OperationTimePlant5Value = OperationTimePlant5Value + tempOperationTimePlant5Value;
                            }
                            #endregion
                            StructureMenulist[d].StructureStandardOperationTime = (float?)Math.Round(Convert.ToDouble(StandardTime), 2);
                            StructureMenulist[d].StructureOperationTimePlant1Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant1Value), 2);
                            StructureMenulist[d].StructureOperationTimePlant2Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant2Value), 2);
                            StructureMenulist[d].StructureOperationTimePlant3Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant3Value), 2);
                            StructureMenulist[d].StructureOperationTimePlant4Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant4Value), 2);
                            StructureMenulist[d].StructureOperationTimePlant5Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant5Value), 2);
                            #region GEOS2-3954 Show the WorkOperations and SOD Time in the format: MM:SS or HH:MM:SS
                            try
                            {
                                StructureMenulist[d].UiTempStandardOperationTimeName = ConvertfloattoTimespan(Convert.ToString(StructureMenulist[d].StructureStandardOperationTime));
                                StructureMenulist[d].UiTempoperationTimePlant1Value = ConvertfloattoTimespan(Convert.ToString(StructureMenulist[d].StructureOperationTimePlant1Value));
                                StructureMenulist[d].UiTempoperationTimePlant2Value = ConvertfloattoTimespan(Convert.ToString(StructureMenulist[d].StructureOperationTimePlant2Value));
                                StructureMenulist[d].UiTempoperationTimePlant3Value = ConvertfloattoTimespan(Convert.ToString(StructureMenulist[d].StructureOperationTimePlant3Value));
                                StructureMenulist[d].UiTempoperationTimePlant4Value = ConvertfloattoTimespan(Convert.ToString(StructureMenulist[d].StructureOperationTimePlant4Value));
                                StructureMenulist[d].UiTempoperationTimePlant5Value = ConvertfloattoTimespan(Convert.ToString(StructureMenulist[d].StructureOperationTimePlant5Value));
                            }
                            catch (Exception ex)
                            {
                                GeosApplication.Instance.Logger.Log(string.Format("Error in Method StructureCustomSummarycalculation() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            }
                            #endregion
                        }
                    }
                #endregion              

                GeosApplication.Instance.Logger.Log("Method structureCustomSummarycalculation()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log(string.Format("Error in method StructureCustomSummarycalculation() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

            }

        }
        private void detectionCustomSummarycalculationOldMethod()
        {
            try
            {
                #region calculation

                if (DetectionMenulist != null)
                    foreach (ERMSOPDetection itemERMSOPDetection in DetectionMenulist)
                    {
                        WorkOperationMenulist.Where(w => w.IdworkOperationByStage == itemERMSOPDetection.IdworkOperationByStage).ToList().ForEach(f => f.IsCurrentWorkOperation = true);
                        var listCount = DetectionMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(itemERMSOPDetection.KeyName)).ToList();
                        if (listCount != null)
                            if (listCount.Count() > 0)
                            {
                                itemERMSOPDetection.DetectionObservedTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.DetectionObservedTime)), 2);
                                itemERMSOPDetection.IsReadOnly = true;
                            }
                    }
                if (DetectionMenulist != null)
                    foreach (ERMSOPDetection itemERMSOPDetection in DetectionMenulist)
                    {
                        if (GetStages.Any(a => a.Code.Equals(itemERMSOPDetection.Name)))
                        {
                            ObservableCollection<ERMSOPDetection> ActivitySum = new ObservableCollection<ERMSOPDetection>();
                            ObservableCollection<ERMSOPDetection> TempActivitySum = new ObservableCollection<ERMSOPDetection>();
                            int x = 1;
                            Loop:
                            x++;
                            if (x < 10)
                            {
                                if (ActivitySum.Count == 0)
                                {
                                    itemERMSOPDetection.DetectionObservedTime = 0;
                                    itemERMSOPDetection.DetectionNormalTime = 0;
                                    var ActivitySumList = DetectionMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(itemERMSOPDetection.KeyName)).ToList();
                                    ActivitySum.AddRange(ActivitySumList);
                                }
                                else
                                {
                                    //foreach (var item in ActivitySum)
                                    //{
                                    //    var ActivitySumList = DetectionMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(item.KeyName)).ToList();
                                    //    if (ActivitySumList != null && ActivitySumList.Count > 0)
                                    //    {

                                    //        foreach (var itemActivity in ActivitySumList)
                                    //        {
                                    //            if (!ActivitySum.Any(ac => ac.KeyName.Equals(itemActivity.KeyName)))
                                    //            {
                                    //                TempActivitySum.Add(itemActivity);
                                    //            }

                                    //        }

                                    //    }

                                    //}
                                    //ActivitySum.AddRange(TempActivitySum);
                                }


                                goto Loop;
                            }

                            double? ObservedTime = 0;
                            double? NormalTime = 0;
                            float? StandardTime = 0;
                            float? OperationTimePlant1Value = 0;
                            float? OperationTimePlant2Value = 0;
                            float? OperationTimePlant3Value = 0;
                            float? OperationTimePlant4Value = 0;
                            float? OperationTimePlant5Value = 0;
                            var tempDistinctList = ActivitySum.Select(xa => xa.KeyName).Distinct().ToList();
                            foreach (var item in tempDistinctList)
                            {
                                if (itemERMSOPDetection.DetectionObservedTime == null)
                                    itemERMSOPDetection.DetectionObservedTime = 0;
                                double? tempObservedTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.DetectionObservedTime).FirstOrDefault();
                                if (tempObservedTime != null)
                                    ObservedTime = Math.Round(Convert.ToDouble(ObservedTime + tempObservedTime), 2);

                                if (itemERMSOPDetection.DetectionNormalTime == null)
                                    itemERMSOPDetection.DetectionNormalTime = 0;
                                double? tempNormalTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.DetectionNormalTime).FirstOrDefault();
                                if (tempNormalTime != null)
                                    NormalTime = Math.Round(Convert.ToDouble(NormalTime + tempNormalTime), 2);

                            }
                            itemERMSOPDetection.DetectionObservedTime = ObservedTime;
                            //itemERMSOPDetection.DetectionNormalTime = NormalTime;
                            itemERMSOPDetection.DetectionNormalTime = Math.Round(Convert.ToDouble(ObservedTime * itemERMSOPDetection.DetectionActivity / 100), 2);
                            #region PlantValue


                            foreach (var item in tempDistinctList)
                            {
                                if (itemERMSOPDetection.DetectionStandardOperationTime == null)
                                    itemERMSOPDetection.DetectionStandardOperationTime = 0;
                                float? tempStandardTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.DetectionStandardOperationTime).FirstOrDefault();
                                if (tempStandardTime != null)
                                    StandardTime = StandardTime + tempStandardTime;

                                if (itemERMSOPDetection.DetectionOperationTimePlant1Value == null)
                                    itemERMSOPDetection.DetectionOperationTimePlant1Value = 0;
                                float? tempOperationTimePlant1Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.DetectionOperationTimePlant1Value).FirstOrDefault();
                                if (tempOperationTimePlant1Value != null)
                                    OperationTimePlant1Value = OperationTimePlant1Value + tempOperationTimePlant1Value;

                                if (itemERMSOPDetection.DetectionOperationTimePlant2Value == null)
                                    itemERMSOPDetection.DetectionOperationTimePlant2Value = 0;
                                float? tempOperationTimePlant2Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.DetectionOperationTimePlant2Value).FirstOrDefault();
                                if (tempOperationTimePlant2Value != null)
                                    OperationTimePlant2Value = OperationTimePlant2Value + tempOperationTimePlant2Value;

                                if (itemERMSOPDetection.DetectionOperationTimePlant3Value == null)
                                    itemERMSOPDetection.DetectionOperationTimePlant3Value = 0;
                                float? tempOperationTimePlant3Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.DetectionOperationTimePlant3Value).FirstOrDefault();
                                if (tempOperationTimePlant3Value != null)
                                    OperationTimePlant3Value = OperationTimePlant3Value + tempOperationTimePlant3Value;

                                if (itemERMSOPDetection.DetectionOperationTimePlant4Value == null)
                                    itemERMSOPDetection.DetectionOperationTimePlant4Value = 0;
                                float? tempOperationTimePlant4Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.DetectionOperationTimePlant4Value).FirstOrDefault();
                                if (tempOperationTimePlant4Value != null)
                                    OperationTimePlant4Value = OperationTimePlant4Value + tempOperationTimePlant4Value;

                                if (itemERMSOPDetection.DetectionOperationTimePlant5Value == null)
                                    itemERMSOPDetection.DetectionOperationTimePlant5Value = 0;
                                float? tempOperationTimePlant5Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.DetectionOperationTimePlant5Value).FirstOrDefault();
                                if (tempOperationTimePlant5Value != null)
                                    OperationTimePlant5Value = OperationTimePlant5Value + tempOperationTimePlant5Value;
                            }
                            #endregion
                            itemERMSOPDetection.DetectionStandardOperationTime = (float?)Math.Round(Convert.ToDouble(StandardTime / 100), 2);
                            itemERMSOPDetection.DetectionOperationTimePlant1Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant1Value / 100), 2);
                            itemERMSOPDetection.DetectionOperationTimePlant2Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant2Value / 100), 2);
                            itemERMSOPDetection.DetectionOperationTimePlant3Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant3Value / 100), 2);
                            itemERMSOPDetection.DetectionOperationTimePlant4Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant4Value / 100), 2);
                            itemERMSOPDetection.DetectionOperationTimePlant5Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant5Value / 100), 2);
                        }
                    }
                #endregion              
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log(string.Format("Error in method detectionCustomSummarycalculation() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

            }

        }

        private void DetectionGridParentMenuTreeList_CellValueChangedCommandAction(object sender)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method DetectionGridParentMenuTreeList_CellValueChangedCommandAction()...", category: Category.Info, priority: Priority.Low);

                if (sender is DevExpress.Xpf.Grid.TreeList.TreeListCellValueChangedEventArgs)
                {
                    if (sender != null)
                    {
                        FlagToDragDrop = true;  //[GEOS2-3909][Rupali Sarode][11-11-2022]
                        IsEnabledSaveButton = true;
                        SaveButtonVisibility = Visibility.Visible;
                        TreeListCellValueChangedEventArgs obj = (TreeListCellValueChangedEventArgs)sender;
                        if (!obj.Cell.Property.Equals("Remarks"))  //[GEOS2-4108][Rupali Sarode][6-1-2023]
                        {
                            if (obj.Value != null)
                            {
                                double? NewValue;
                                if (obj.Cell.Property.Equals("UITempDetectionobservedTime"))
                                {
                                    //tempnewvalue = ConvertTimespantoFloat(TimeSpan.FromMinutes(Convert.ToDouble(obj.Value)));
                                    NewValue = Math.Round(Convert.ToDouble(TimeSpan.Parse(Convert.ToString(obj.Value)).TotalMinutes), 2); // ConvertTimespantoFloat(TimeSpan.Parse(obj.Value));
                                }
                                else
                                {
                                    NewValue = Math.Round(Convert.ToDouble(Convert.ToString(obj.Value)), 2);
                                }
                                //double? NewValue = Math.Round(Convert.ToDouble(string.IsNullOrEmpty(obj.Value.ToString()) ? 0 : obj.Value), 2);
                                //#region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                //float? tempnewvalue = ConvertTimespantoFloat(TimeSpan.FromMinutes(Convert.ToDouble(obj.Value)));
                                //double? NewValue = 0;
                                //if (Convert.ToString(obj.Value).Contains(":"))
                                //{
                                //    NewValue = Math.Round(Convert.ToDouble(string.IsNullOrEmpty(tempnewvalue.ToString()) ? 0 : tempnewvalue), 2);
                                //}
                                //else
                                //{
                                //    NewValue = Math.Round(Convert.ToDouble(string.IsNullOrEmpty(obj.Value.ToString()) ? 0 : obj.Value), 2);
                                //}
                                //#endregion
                                if (NewValue != null)
                                    if (obj.Cell.Property.Equals("ObservedTime"))
                                    {
                                        DetectionMenulist.Where(w => w.IdworkOperationByStage == SelectedDetectionMenuItem.IdworkOperationByStage).ToList().ForEach(f => f.DetectionObservedTime = NewValue);
                                    }
                                    else if (obj.Cell.Property.Equals("Activity"))
                                    {
                                        DetectionMenulist.Where(w => w.IdworkOperationByStage == SelectedDetectionMenuItem.IdworkOperationByStage).ToList().ForEach(f => f.DetectionActivity = NewValue);
                                    }
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    else if (obj.Cell.Property.Equals("UITempDetectionobservedTime"))
                                    {
                                        try
                                        {
                                            DetectionMenulist.Where(w => w.IdworkOperationByStage == SelectedDetectionMenuItem.IdworkOperationByStage).ToList().ForEach(f => f.DetectionObservedTime = NewValue);
                                            DetectionMenulist.Where(w => w.IdworkOperationByStage == SelectedDetectionMenuItem.IdworkOperationByStage).ToList().ForEach(f => f.UITempDetectionobservedTime = ConvertfloattoTimespan(Convert.ToString(NewValue)));
                                        }
                                        catch (Exception ex) { }

                                    }
                                #endregion
                            }
                        }

                        if (!obj.Cell.Property.Equals("Remarks"))  //[GEOS2-4108][Rupali Sarode][6-1-2023]
                            detectionCustomSummarycalculation();
                    }
                }

                GeosApplication.Instance.Logger.Log("Method DetectionGridParentMenuTreeList_CellValueChangedCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log(string.Format("Error in method DetectionGridParentMenuTreeList_CellValueChangedCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        private void DetectionGridParentMenuTreeList_CellValueChangingCommandAction(object sender)
        {

        }

        #region [GEOS2-3601][Rupali Sarode][29/9/2022]

        private void ERMSOPStructureDeleteParentAction(List<ERMSOPStructures> deleteParentlist)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ERMSOPStructureDeleteParentAction()...", category: Category.Info, priority: Priority.Low);

                foreach (ERMSOPStructures item in deleteParentlist)
                {
                    if (!ERMSOPStructureDeleteParentList.Any(a => a.KeyName.Equals(item.KeyName)))
                    {
                        ERMSOPStructureDeleteParentList.Add(item);
                        StructureMenulist.Remove(item);
                        WorkOperationMenulist.Where(w => w.IdworkOperationByStage == item.IdworkOperationByStage).ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                    }
                    List<ERMSOPStructures> isitemExist = StructureMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(item.ParentName)).ToList();
                    if (isitemExist.Count == 0)
                    {
                        List<ERMSOPStructures> parentlist = StructureMenulist.Where(w => w.KeyName.Equals(item.ParentName)).ToList();
                        ERMSOPStructureDeleteParentAction(parentlist);
                    }

                }
                GeosApplication.Instance.Logger.Log("Method ERMSOPStructureDeleteParentAction()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method ERMSOPStructureDeleteParentAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void ERMSOPStructureDeleteAction(List<ERMSOPStructures> deletelist)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ERMSOPStructureDeleteAction()...", category: Category.Info, priority: Priority.Low);

                foreach (ERMSOPStructures item in deletelist)
                {
                    if (!ERMSOPStructureDeleteList.Any(a => a.KeyName.Equals(item.KeyName)))
                    {
                        ERMSOPStructureDeleteList.Add(item);
                        WorkOperationMenulist.Where(w => w.IdworkOperationByStage == item.IdworkOperationByStage).ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                    }

                    List<ERMSOPStructures> isitemExist = StructureMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(item.KeyName)).ToList();
                    if (deletelist != null || deletelist.Count() > 0)
                    {
                        ERMSOPStructureDeleteAction(isitemExist);
                    }
                }
                GeosApplication.Instance.Logger.Log("Method ERMSOPStructureDeleteAction()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method ERMSOPStructureDeleteAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        private void StructureGridParentMenuTreeList_CellValueChangingCommandAction(object sender)
        {

        }

        private void FillStructureGroupsMenulist()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillStructureGroupsMenulist()...", category: Category.Info, priority: Priority.Low);

                StructureMenulistForGridLayout = new ObservableCollection<ERMStructures>(ERMService.GetAllStructures_V2390().ToList());

                if (DetectionGroupWithStructures == null)
                    DetectionGroupWithStructures = new ObservableCollection<DetectionGroupWithStructures>();

                if (DetectionGroupWithStructures.Count() == 0)
                {
                    // Sort structures, placing "No group" last
                    StructureMenulistForGridLayout = new ObservableCollection<ERMStructures>(
                        StructureMenulistForGridLayout
                            .OrderBy(structure => structure.Name == "NO GROUP")
                            .ThenBy(structure => structure.Name, new AlphanumericComparer())
                    );

                    DetectionGroupWithStructures TempDetectionGroupWithStructure = new DetectionGroupWithStructures();
                    TempDetectionGroupWithStructure.Structures = StructureMenulistForGridLayout.ToList();

                    #region [28 12 2022]
                    foreach (var item1 in TempDetectionGroupWithStructure.Structures)
                    {
                        int StructureTypecount = tempLstStandardOperationsDictionaryStructures
                            .Where(x => x.IdCpTypeNew == item1.IdCPType)
                            .ToList()
                            .Count();

                        item1.Name = item1.Name + "  (" + StructureTypecount + ")";
                    }
                    #endregion

                    TempDetectionGroupWithStructure.Name = "Structures" + "  (" + TempDetectionGroupWithStructure.Structures.Count() + ")";
                    DetectionGroupWithStructures.Add(TempDetectionGroupWithStructure);
                }

                SelectedItemStructures = DetectionGroupWithStructures.FirstOrDefault();

                GeosApplication.Instance.Logger.Log("Method FillStructureGroupsMenulist()....executed successfully", category: Category.Info, priority: Priority.Low);
            }

            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log($"Error in Method FillStructureGroupsMenulist() - {ex.Message}", category: Category.Exception, priority: Priority.Low);
            }
        }



        private void DeleteStructureTreeListControlCommandAction(object obj)
        {
            try
            {
                ERMSOPStructures MainRow = ((ERMSOPStructures)obj);
                GeosApplication.Instance.Logger.Log("Method DeleteStructureTreeListControlCommandAction()...", category: Category.Info, priority: Priority.Low);
                #region Commented Code
                //List<StandardOperationsDictionaryModules> ValidateLstStandardOperationsDictionaryModules = new List<StandardOperationsDictionaryModules>();
                //ValidateLstStandardOperationsDictionaryModules = tempLstStandardOperationsDictionaryModules.Where(i => i.WorkOperationName == MainRow.Code).ToList();
                ////[rdixit][03.08.2022][GEOS2-3764]
                //if (ValidateLstStandardOperationsDictionaryModules.Count > 0)
                //{
                //    CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("RemoveWorkOperationGridValidationPresentinMultipleSOD").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                //    return;
                //}
                //else if (WorkOperationMenulist.Any(i => i.IdParent == (ulong?)(MainRow.IdworkOperationByStage)) == true)
                //{
                //    CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("RemoveWorkOperationGridValidationForHavingSons").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                //    return;
                //}
                //else if (MainRow.IdStatus == 1535)
                //{
                //    CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("RemoveWorkOperationGridValidationForActive").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                //    return;
                //}

                //else if (MainRow.IdStatus == 1536)
                //{
                //    CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("RemoveWorkOperationGridValidationForInactive").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                //    return;
                //}
                #endregion
                MessageBoxResult MessageBoxResult = CustomMessageBox.Show(String.Format(Application.Current.Resources["WorkOperationsDeleteMessage"].ToString()), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                if (MessageBoxResult == MessageBoxResult.Yes)
                {
                    operationMenulist = new ObservableCollection<WorkOperationByStages>();
                    ERMSOPStructureDeleteList = new List<ERMSOPStructures>();
                    ERMSOPStructureDeleteParentList = new List<ERMSOPStructures>();
                    IsEnabledSaveButton = true;
                    SaveButtonVisibility = Visibility.Visible;
                    StandardOperationsDictionary tempSelectedStandardOperationsDictionary = new StandardOperationsDictionary();
                    tempSelectedStandardOperationsDictionary.IdStandardOperationsDictionary = tempLstStandardOperationsDictionaryStructures.Select(w => w.IdStandardOperationsDictionary).FirstOrDefault();

                    StandardOperationsDictionaryStructures standardOperationsDictionaryStructure = new StandardOperationsDictionaryStructures();
                    if (MainRow != null)
                    {
                        ObservableCollection<ERMSOPStructures> StructureMenulistTemp = new ObservableCollection<ERMSOPStructures>();
                        StructureMenulistTemp = StructureMenulist;
                        #region GEOS2-4046 Gulab Lakade
                        List<ERMSOPStructures> found = new List<ERMSOPStructures>();
                        if (!found.Any(a => a != null && a.KeyName.Trim().Equals(MainRow.KeyName.Trim())))
                            found.AddRange(StructureMenulistTemp.Where(s => s.IdworkOperationByStage == MainRow.IdworkOperationByStage).ToList());

                        for (int i = 0; i < found.Count(); i++)
                        {
                            standardOperationsDictionaryStructure.IdWorkoperation = Convert.ToUInt32(MainRow.IdworkOperationByStage);
                            if (SelectedItemStructures is ERMStructures)
                            {
                                ERMStructures eRMStructure = (ERMStructures)SelectedItemStructures;
                                standardOperationsDictionaryStructure.IdCpTypeNew = (long)eRMStructure.IdCPType;
                            }
                            standardOperationsDictionaryStructure.ObservedTime = (float?)found[i].StructureObservedTime;
                            #region [GEOS2-3954] [Rupali Sarode] Time format HH:mm:ss
                            standardOperationsDictionaryStructure.UITempStructureObservedTime = ConvertfloattoTimespan(Convert.ToString(MainRow.StructureObservedTime));
                            #endregion
                            standardOperationsDictionaryStructure.Activity = (float?)found[i].StructureActivity;

                            StructureMenulistTemp.Remove(found[i]);
                            WorkOperationMenulist.Where(w => w.IdworkOperationByStage == found[i].IdworkOperationByStage).ToList().ForEach(f => f.IsCurrentWorkOperation = false);

                            standardOperationsDictionaryStructureDeleteList.Add(standardOperationsDictionaryStructure);
                            List<ERMSOPStructures> deletelist = StructureMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(found[i].KeyName)).ToList();
                            if (deletelist != null)
                            {
                                ERMSOPStructureDeleteAction(deletelist);
                            }
                            if (ERMSOPStructureDeleteList != null)
                                foreach (ERMSOPStructures item in ERMSOPStructureDeleteList)
                                {
                                    StandardOperationsDictionaryStructures standardOperationsDictionary = new StandardOperationsDictionaryStructures();
                                    standardOperationsDictionary.IdWorkoperation = Convert.ToUInt32(item.IdworkOperationByStage);
                                    if (SelectedItemStructures is ERMStructures)
                                    {
                                        ERMStructures eRMStructure = (ERMStructures)SelectedItemStructures;
                                        standardOperationsDictionary.IdCpTypeNew = (long)eRMStructure.IdCPType;
                                    }
                                    standardOperationsDictionary.ObservedTime = (float?)item.StructureObservedTime;
                                    #region [GEOS2-3954] [Rupali Sarode] Time format HH:mm:ss
                                    standardOperationsDictionary.UITempStructureObservedTime = ConvertfloattoTimespan(Convert.ToString(item.StructureObservedTime));
                                    #endregion
                                    standardOperationsDictionary.Activity = (float?)item.StructureActivity;
                                    StructureMenulistTemp.Remove(item);
                                    standardOperationsDictionaryStructureDeleteList.Add(standardOperationsDictionary);
                                }

                            List<ERMSOPStructures> deleteParentlist = StructureMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(found[i].ParentName)).ToList();
                            if (deleteParentlist.Count == 0)
                            {
                                List<ERMSOPStructures> parentlist = StructureMenulistTemp.Where(w => w.KeyName.Equals(found[i].ParentName)).ToList();
                                ERMSOPStructureDeleteParentAction(parentlist);

                            }
                            if (ERMSOPStructureDeleteParentList != null)
                                foreach (ERMSOPStructures item in ERMSOPStructureDeleteParentList)
                                {
                                    StandardOperationsDictionaryStructures standardOperationsDictionary = new StandardOperationsDictionaryStructures();
                                    standardOperationsDictionary.IdWorkoperation = Convert.ToUInt32(item.IdworkOperationByStage);
                                    if (SelectedItemStructures is ERMStructures)
                                    {
                                        ERMStructures eRMStructures = (ERMStructures)SelectedItemStructures;
                                        standardOperationsDictionary.IdCpTypeNew = (long)eRMStructures.IdCPType;
                                    }
                                    standardOperationsDictionary.ObservedTime = (float?)item.StructureObservedTime;
                                    #region [GEOS2-3954] [Rupali Sarode] Time format HH:mm:ss
                                    standardOperationsDictionary.UITempStructureObservedTime = ConvertfloattoTimespan(Convert.ToString(item.StructureObservedTime));
                                    #endregion
                                    standardOperationsDictionary.Activity = (float?)item.StructureActivity;
                                    StructureMenulistTemp.Remove(item);
                                    standardOperationsDictionaryStructureDeleteList.Add(standardOperationsDictionary);

                                }
                            var tempStructureMenulist = StructureMenulistTemp.ToList();
                            foreach (ERMSOPStructures itemRemove in tempStructureMenulist)
                            {
                                if (GetStages.Any(a => a.Code.Equals(itemRemove.Name)))
                                {
                                    List<ERMSOPStructures> childList = StructureMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(itemRemove.KeyName)).ToList();
                                    if (childList.Count == 0)
                                    {
                                        StructureMenulistTemp.Remove(itemRemove);
                                    }
                                }

                            }
                        }
                        #endregion
                        StructureMenulist = new ObservableCollection<ERMSOPStructures>();
                        StructureMenulist = StructureMenulistTemp;
                    }
                    CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("WorkOperationDeletedSuccess").ToString()), Application.Current.Resources["PopUpSuccessColor"].ToString(), CustomMessageBox.MessageImagePath.Ok, MessageBoxButton.OK);
                }
                GeosApplication.Instance.Logger.Log("Method DeleteStructureTreeListControlCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in DeleteStructureTreeListControlCommandAction() Method " + ex.Detail.ErrorMessage, category: Category.Info, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in DeleteStructureTreeListControlCommandAction() Method - ServiceUnexceptedException " + ex.Message, category: Category.Info, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method DeleteStructureTreeListControlCommandAction()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }


        private void StructureTreeListViewLoadedCommandAction(RoutedEventArgs obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method StructureTreeListViewLoadedCommandAction ...", category: Category.Info, priority: Priority.Low);

                StructuretreeListControlInstance = (TreeListControl)((DevExpress.Xpf.Grid.TreeListView)obj.OriginalSource).DataControl;

                GeosApplication.Instance.Logger.Log("Method StructureTreeListViewLoadedCommandAction() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in StructureTreeListViewLoadedCommandAction() Method " + ex.Message, category: Category.Info, priority: Priority.Low);
            }
        }
        private void StructureCustomSummaryCommandAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method StructureCustomSummaryCommandAction()...", category: Category.Info, priority: Priority.Low);


                TreeListCustomSummaryEventArgs e = (TreeListCustomSummaryEventArgs)obj;
                if (e.SummaryItem.FieldName == "StructureObservedTime")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPStructures temp = (ERMSOPStructures)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                if (e.TotalValue != null)
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                            }

                        }

                    }
                }

                #region [GEOS2-3954] [Rupali Sarode] Time format HH:mm:ss
                if (e.SummaryItem.FieldName == "UITempStructureObservedTime")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {

                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPStructures temp = (ERMSOPStructures)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                //e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                //if (e.TotalValue != null)
                                //    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);


                                #region Time changes 28 11 2022
                                TimeSpan temp3 = TimeSpan.Parse(e.FieldValue.ToString());
                                double TempFieldValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.FieldValue)))
                                {
                                    TempFieldValue = 0;
                                }
                                else
                                {
                                    TempFieldValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.FieldValue)).TotalMinutes);
                                }

                                double TempTotalValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.TotalValue)))
                                {
                                    TempTotalValue = 0;
                                }
                                else
                                {
                                    TempTotalValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.TotalValue)).TotalMinutes);
                                }

                                e.TotalValue = TempTotalValue + TempFieldValue;
                                if (e.TotalValue != null)
                                {
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    e.TotalValue = ConvertfloattoTimespan(Convert.ToString(e.TotalValue));

                                    #endregion

                                }
                                #endregion
                            }

                        }

                    }
                }
                if (e.SummaryItem.FieldName == "UITempStructureNormalTime")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPStructures temp = (ERMSOPStructures)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                //e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                //if (e.TotalValue != null)
                                //    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);


                                #region Time changes 28 11 2022
                                TimeSpan temp3 = TimeSpan.Parse(e.FieldValue.ToString());
                                double TempFieldValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.FieldValue)))
                                {
                                    TempFieldValue = 0;
                                }
                                else
                                {
                                    TempFieldValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.FieldValue)).TotalMinutes);
                                }

                                double TempTotalValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.TotalValue)))
                                {
                                    TempTotalValue = 0;
                                }
                                else
                                {
                                    TempTotalValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.TotalValue)).TotalMinutes);
                                }

                                e.TotalValue = TempTotalValue + TempFieldValue;
                                if (e.TotalValue != null)
                                {
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    e.TotalValue = ConvertfloattoTimespan(Convert.ToString(e.TotalValue));

                                    #endregion

                                }
                                #endregion
                            }

                        }

                    }
                }
                #endregion

                if (e.SummaryItem.FieldName == "StructureNormalTime")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPStructures temp = (ERMSOPStructures)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                if (e.TotalValue != null)
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                            }

                        }

                    }
                }

                if (e.SummaryItem.FieldName == "StructureStandardOperationTime")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPStructures temp = (ERMSOPStructures)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                if (e.TotalValue != null)
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                            }

                        }

                    }
                }
                if (e.SummaryItem.FieldName == "StructureOperationTimePlant1Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPStructures temp = (ERMSOPStructures)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                if (e.TotalValue != null)
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                            }

                        }

                    }
                }


                if (e.SummaryItem.FieldName == "StructureOperationTimePlant2Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPStructures temp = (ERMSOPStructures)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {

                                e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                if (e.TotalValue != null)
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                            }

                        }

                    }
                }


                if (e.SummaryItem.FieldName == "StructureOperationTimePlant3Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPStructures temp = (ERMSOPStructures)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {

                                e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                if (e.TotalValue != null)
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                            }

                        }

                    }
                }

                if (e.SummaryItem.FieldName == "StructureOperationTimePlant4Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPStructures temp = (ERMSOPStructures)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {

                                e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                if (e.TotalValue != null)
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                            }

                        }

                    }
                }

                if (e.SummaryItem.FieldName == "StructureOperationTimePlant5Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPStructures temp = (ERMSOPStructures)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {

                                e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                if (e.TotalValue != null)
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                            }

                        }

                    }
                }

                #region GEOS2-3954 Show the WorkOperations and SOD Time in the format: MM:SS or HH:MM:SS
                if (e.SummaryItem.FieldName == "UiTempStandardOperationTimeName")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {

                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPStructures temp = (ERMSOPStructures)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {

                                #region Time changes 28 11 2022
                                TimeSpan temp3 = TimeSpan.Parse(e.FieldValue.ToString());
                                double TempFieldValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.FieldValue)))
                                {
                                    TempFieldValue = 0;
                                }
                                else
                                {
                                    TempFieldValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.FieldValue)).TotalMinutes);
                                }

                                double TempTotalValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.TotalValue)))
                                {
                                    TempTotalValue = 0;
                                }
                                else
                                {
                                    TempTotalValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.TotalValue)).TotalMinutes);
                                }

                                e.TotalValue = TempTotalValue + TempFieldValue;
                                if (e.TotalValue != null)
                                {
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    e.TotalValue = ConvertfloattoTimespan(Convert.ToString(e.TotalValue));

                                    #endregion

                                }
                                #endregion
                            }
                        }

                    }
                }


                if (e.SummaryItem.FieldName == "UiTempoperationTimePlant1Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPStructures temp = (ERMSOPStructures)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {

                                #region Time changes 28 11 2022
                                TimeSpan temp3 = TimeSpan.Parse(e.FieldValue.ToString());
                                double TempFieldValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.FieldValue)))
                                {
                                    TempFieldValue = 0;
                                }
                                else
                                {
                                    TempFieldValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.FieldValue)).TotalMinutes);
                                }

                                double TempTotalValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.TotalValue)))
                                {
                                    TempTotalValue = 0;
                                }
                                else
                                {
                                    TempTotalValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.TotalValue)).TotalMinutes);
                                }

                                e.TotalValue = TempTotalValue + TempFieldValue;
                                if (e.TotalValue != null)
                                {
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    e.TotalValue = ConvertfloattoTimespan(Convert.ToString(e.TotalValue));

                                    #endregion

                                }
                                #endregion
                            }

                        }
                    }
                }
                if (e.SummaryItem.FieldName == "UiTempoperationTimePlant2Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPStructures temp = (ERMSOPStructures)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {

                                #region Time changes 28 11 2022
                                TimeSpan temp3 = TimeSpan.Parse(e.FieldValue.ToString());
                                double TempFieldValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.FieldValue)))
                                {
                                    TempFieldValue = 0;
                                }
                                else
                                {
                                    TempFieldValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.FieldValue)).TotalMinutes);
                                }

                                double TempTotalValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.TotalValue)))
                                {
                                    TempTotalValue = 0;
                                }
                                else
                                {
                                    TempTotalValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.TotalValue)).TotalMinutes);
                                }

                                e.TotalValue = TempTotalValue + TempFieldValue;
                                if (e.TotalValue != null)
                                {
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    e.TotalValue = ConvertfloattoTimespan(Convert.ToString(e.TotalValue));

                                    #endregion

                                }
                                #endregion
                            }

                        }

                    }
                }
                if (e.SummaryItem.FieldName == "UiTempoperationTimePlant3Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPStructures temp = (ERMSOPStructures)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {

                                #region Time changes 28 11 2022
                                TimeSpan temp3 = TimeSpan.Parse(e.FieldValue.ToString());
                                double TempFieldValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.FieldValue)))
                                {
                                    TempFieldValue = 0;
                                }
                                else
                                {
                                    TempFieldValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.FieldValue)).TotalMinutes);
                                }

                                double TempTotalValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.TotalValue)))
                                {
                                    TempTotalValue = 0;
                                }
                                else
                                {
                                    TempTotalValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.TotalValue)).TotalMinutes);
                                }

                                e.TotalValue = TempTotalValue + TempFieldValue;
                                if (e.TotalValue != null)
                                {
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    e.TotalValue = ConvertfloattoTimespan(Convert.ToString(e.TotalValue));

                                    #endregion

                                }
                                #endregion
                            }

                        }

                    }
                }
                if (e.SummaryItem.FieldName == "UiTempoperationTimePlant4Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPStructures temp = (ERMSOPStructures)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {

                                #region Time changes 28 11 2022
                                TimeSpan temp3 = TimeSpan.Parse(e.FieldValue.ToString());
                                double TempFieldValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.FieldValue)))
                                {
                                    TempFieldValue = 0;
                                }
                                else
                                {
                                    TempFieldValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.FieldValue)).TotalMinutes);
                                }

                                double TempTotalValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.TotalValue)))
                                {
                                    TempTotalValue = 0;
                                }
                                else
                                {
                                    TempTotalValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.TotalValue)).TotalMinutes);
                                }

                                e.TotalValue = TempTotalValue + TempFieldValue;
                                if (e.TotalValue != null)
                                {
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    e.TotalValue = ConvertfloattoTimespan(Convert.ToString(e.TotalValue));

                                    #endregion

                                }
                                #endregion
                            }

                        }
                    }
                }

                if (e.SummaryItem.FieldName == "UiTempoperationTimePlant5Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPStructures temp = (ERMSOPStructures)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {

                                #region Time changes 28 11 2022
                                TimeSpan temp3 = TimeSpan.Parse(e.FieldValue.ToString());
                                double TempFieldValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.FieldValue)))
                                {
                                    TempFieldValue = 0;
                                }
                                else
                                {
                                    TempFieldValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.FieldValue)).TotalMinutes);
                                }

                                double TempTotalValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.TotalValue)))
                                {
                                    TempTotalValue = 0;
                                }
                                else
                                {
                                    TempTotalValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.TotalValue)).TotalMinutes);
                                }

                                e.TotalValue = TempTotalValue + TempFieldValue;
                                if (e.TotalValue != null)
                                {
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    e.TotalValue = ConvertfloattoTimespan(Convert.ToString(e.TotalValue));

                                    #endregion

                                }
                                #endregion
                            }

                        }
                    }
                }
                #endregion

                GeosApplication.Instance.Logger.Log("Method StructureCustomSummaryCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {

                GeosApplication.Instance.Logger.Log(string.Format("Error in method StructureCustomSummaryCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void StructureGridParentMenuTreeList_CellValueChangedCommandAction(object sender)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method StructureGridParentMenuTreeList_CellValueChangedCommandAction()...", category: Category.Info, priority: Priority.Low);

                if (sender is DevExpress.Xpf.Grid.TreeList.TreeListCellValueChangedEventArgs)
                {

                    if (sender != null)
                    {
                        FlagToDragDrop = true;  //[GEOS2-3926][Rupali Sarode][11-11-2022]

                        IsEnabledSaveButton = true;
                        SaveButtonVisibility = Visibility.Visible;
                        TreeListCellValueChangedEventArgs obj = (TreeListCellValueChangedEventArgs)sender;
                        if (!obj.Cell.Property.Equals("Remarks"))  //[GEOS2-4108][Rupali Sarode][6-1-2023]
                        {
                            if (obj.Value != null)
                            {
                                //double? NewValue = 0;
                                //float? tempnewvalue = ConvertTimespantoFloat(TimeSpan.FromMinutes(Convert.ToDouble(obj.Value)));

                                //#region [GEOS2-3954] [Rupali Sarode] Time format HH:mm:ss
                                //if (Convert.ToString(obj.Value).Contains(":"))
                                //    NewValue = Math.Round(Convert.ToDouble(string.IsNullOrEmpty(tempnewvalue.ToString()) ? 0 : tempnewvalue), 2);
                                //else
                                //    NewValue = Math.Round(Convert.ToDouble(string.IsNullOrEmpty(obj.Value.ToString()) ? 0 : obj.Value), 2);

                                //#endregion

                                double? NewValue;
                                if (obj.Cell.Property.Equals("UITempStructureObservedTime"))
                                {
                                    //tempnewvalue = ConvertTimespantoFloat(TimeSpan.FromMinutes(Convert.ToDouble(obj.Value)));
                                    NewValue = Math.Round(Convert.ToDouble(TimeSpan.Parse(Convert.ToString(obj.Value)).TotalMinutes), 2); // ConvertTimespantoFloat(TimeSpan.Parse(obj.Value));
                                }
                                else
                                {

                                    NewValue = Math.Round(Convert.ToDouble(Convert.ToString(obj.Value)), 2);
                                }

                                if (NewValue != null)
                                    if (obj.Cell.Property.Equals("StructureObservedTime"))
                                    {
                                        StructureMenulist.Where(w => w.IdworkOperationByStage == SelectedStructureMenuItem.IdworkOperationByStage).ToList().ForEach(f => f.StructureObservedTime = NewValue);
                                    }
                                    else if (obj.Cell.Property.Equals("StructureActivity"))
                                    {
                                        StructureMenulist.Where(w => w.IdworkOperationByStage == SelectedStructureMenuItem.IdworkOperationByStage).ToList().ForEach(f => f.StructureActivity = NewValue);
                                    }
                                    #region [GEOS2-3954] [Rupali Sarode] Time format HH:mm:ss
                                    else if (obj.Cell.Property.Equals("UITempStructureObservedTime"))
                                    {
                                        try
                                        {
                                            StructureMenulist.Where(w => w.IdworkOperationByStage == SelectedStructureMenuItem.IdworkOperationByStage).ToList().ForEach(f => f.StructureObservedTime = NewValue);
                                            StructureMenulist.Where(w => w.IdworkOperationByStage == SelectedStructureMenuItem.IdworkOperationByStage).ToList().ForEach(f => f.UITempStructureObservedTime = ConvertfloattoTimespan(Convert.ToString(NewValue)));
                                        }
                                        catch (Exception ex) { }
                                    }
                                #endregion
                            }
                        }

                        if (!obj.Cell.Property.Equals("Remarks"))  //[GEOS2-4108][Rupali Sarode][6-1-2023]
                            structureCustomSummarycalculation();
                    }
                }
                GeosApplication.Instance.Logger.Log("Method StructureGridParentMenuTreeList_CellValueChangedCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log(string.Format("Error in method StructureGridParentMenuTreeList_CellValueChangedCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void RetrieveWorkOperationsByStructure()
        {
            Saveselecteditem = "Structure";
            GeosApplication.Instance.Logger.Log("Method RetrieveWorkOperationsByStructure()...", category: Category.Info, priority: Priority.Low);
            try
            {


                if (!DXSplashScreen.IsActive)
                {
                    DXSplashScreen.Show(x =>
                    {
                        Window win = new Window()
                        {
                            ShowActivated = false,
                            WindowStyle = WindowStyle.None,
                            ResizeMode = ResizeMode.NoResize,
                            AllowsTransparency = true,
                            Background = new SolidColorBrush(Colors.Transparent),
                            ShowInTaskbar = false,
                            Topmost = true,
                            SizeToContent = SizeToContent.WidthAndHeight,
                            WindowStartupLocation = WindowStartupLocation.CenterScreen,
                        };
                        WindowFadeAnimationBehavior.SetEnableAnimation(win, true);
                        win.Topmost = false;
                        return win;
                    }, x =>
                    {
                        return new SplashScreenView() { DataContext = new SplashScreenViewModel() };
                    }, null, null);
                }
            }
            catch (Exception ex)
            {

            }
            if (ISSavechanges == true)
            {
                return;
            }
            if (IsEnabledSaveButton && SaveButtonVisibility == Visibility.Visible)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                MessageBoxResult MessageBoxResult = MessageBoxResult = CustomMessageBox.Show(string.Format(Application.Current.Resources["ArticleGridUpdateWarning"].ToString()), "Yellow", CustomMessageBox.MessageImagePath.Warning, MessageBoxButton.YesNo);
                if (MessageBoxResult == MessageBoxResult.Yes)
                {
                    if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }
                    ISSavechanges = true;
                    IsEnabledSaveButton = false;
                    SelectedItemOldcloneStructure = SelectedItemStructures;
                    SelectedItemStructures = SelectedItemOldStructure;
                    var tempSelectedItemStructure = SelectedItemOldcloneStructure;
                    SaveButtonCommandAction();
                    ISSavechanges = false;
                    SelectedItemStructures = tempSelectedItemStructure;
                    if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                    #region GEOS2 - 3882 Commented Code
                    //SelectedItem = SelectedItemOld;
                    //if (SelectedItemOldclone != null)
                    //    SelectedItem = SelectedItemOldclone;

                    //SelectedItemOption = SelectedItemOldOption;
                    //if (SelectedItemOldcloneOption != null)
                    //    SelectedItemOption = SelectedItemOldcloneOption;

                    //////GEOS2-3838 - Way
                    //SelectedItemWay = SelectedItemOldWay;
                    //if (SelectedItemOldcloneWay != null)
                    //    SelectedItemWay = SelectedItemOldcloneWay;

                    //SelectedItemDetection = SelectedItemOldDetection;
                    //if (SelectedItemOldcloneDetection != null)
                    //    SelectedItemDetection = SelectedItemOldcloneDetection;

                    ////GEOS2-4033 Spare Part Gulab Lakade
                    //SelectedItemSparePart = SelectedItemOldSparePart;
                    //if (SelectedItemOldcloneSparePart != null)
                    //    SelectedItemSparePart = SelectedItemOldcloneSparePart;
                    #endregion

                }
                #region [GEOS2-3926][Rupali Sarode][25-11-2022]
                if (MessageBoxResult == MessageBoxResult.No)
                {
                    TmpModuleMenulist = null;
                    TmpDetectionMenulist = null;
                    TmpOptionMenulist = null;
                    TmpStructureMenulist = null;
                    TmpWayMenulist = null;
                    TmpSparePartsMenulist = null;
                    TmpIdCPType = 0;
                    TmpIdDetection = 0; //[GEOS2-3922][Rupali Sarode][07-11-2022]
                    TmpIdOption = 0;
                    TmpIdWayType = 0;
                    TmpIdStructure = 0;
                    TmpIdSpareParts = 0;
                }
                #endregion

            }
            if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
            if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }
            ObservableCollection<ERMSOPStructures> StructureMenulistTemp = new ObservableCollection<ERMSOPStructures>();//[GEOS2-4830][gulab lakade][07 12 2023]
            SelectedItemOldStructure = SelectedItemStructures;
            IsEnabledSaveButton = false;
            ModuleMenulistupdated = new ObservableCollection<ERMSOPModule>();
            try
            {

                if (SelectedItemStructures is ERMStructures)
                {

                    ERMStructures ermStructures = (ERMStructures)SelectedItemStructures;
                    //DetectionMenulist = null;
                    List<StandardOperationsDictionaryStructures> tempStandardOperationsDictionaryStructures = tempLstStandardOperationsDictionaryStructures.Where(w => w.IdCpTypeNew == Convert.ToUInt32(ermStructures.IdCPType)).ToList();
                    StructureMenulist = new ObservableCollection<ERMSOPStructures>();
                    operationStructureMenulist = new ObservableCollection<WorkOperationByStages>();
                    duplicateItemloopStructure = 0;
                    duplicateItemloop = 0;
                    if (tempStandardOperationsDictionaryStructures.Count() > 0)
                    {
                        foreach (var eRMSOPStructure in tempStandardOperationsDictionaryStructures)
                        {
                            if (eRMSOPStructure != null)
                            {
                                List<WorkOperationByStages> tempStructureList = WorkOperationMenulist.Where(w => w.IdworkOperationByStage == Convert.ToInt32(eRMSOPStructure.IdWorkoperation) && w.Name == eRMSOPStructure.WorkOperationName).ToList();  //[Cut  work operation not work properly.][gulab lakade][24 01 2023]
                                if (tempStructureList != null)
                                    foreach (WorkOperationByStages item in tempStructureList)
                                    {
                                        if (item.IdStatus == 1536)//[rdixit][03.08.2022][GEOS2-3764]
                                        {
                                            item.IsInactiveWorkOperation = true;
                                            item.IsReadOnly = true;
                                        }
                                        WorkOperationByStages ParentName = WorkOperationMenulist.Where(w => w.KeyName.Equals(item.ParentName)).FirstOrDefault();
                                        if (ParentName != null)
                                        {
                                            if (!operationStructureMenulist.Any(a => a.KeyName.Equals(ParentName.KeyName)))
                                                operationStructureMenulist.Add(ParentName);
                                        }
                                        duplicateItemloopStructure = 0;
                                        duplicateItemloop = 0;
                                        GetAllTreeListStructure(item, WorkOperationMenulist);
                                    }

                            }

                        }
                    }
                    #region StructureMenulist
                    WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                    #region [GEOS2-4830][gulab lakade][07 12 2023]
                    if (AllSupplementsBoxMenu != null)
                    {
                        var listadoDuplicadas = from c in AllSupplementsBoxMenu
                                                join c2 in AllSupplementsBoxMenu on c.Item2 equals c2.Item2
                                                where c != c2
                                                select c;

                        var StructureStandardOperationTime = listadoDuplicadas.FirstOrDefault();
                        if (StructureStandardOperationTime != null)
                        {
                            var templist = listadoDuplicadas.Where(a => a.Item2 == StructureStandardOperationTime.Item2);
                            listadoDuplicadas = templist;
                        }

                        var tempSupplementsBoxMenu = AllSupplementsBoxMenu;

                        ColumnsStructureForSupplements = new ObservableCollection<TreeListColumn>();
                        ColumnsStructureForSupplements.Add(new TreeListColumn()
                        {
                            FieldName = "StructureStandardSupplements",
                            Header = "Standard",
                            HeaderToolTip = "Standard",
                            AllowCellMerge = false,
                            Width = 150,    //gulab lakade not show Supplement proper
                            AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                            Visible = true,
                            ReadOnly = false,
                            FixedWidth = false
                        });

                        ColumnsStructureOperationTime = new ObservableCollection<TreeListColumn>();
                        ColumnsStructureOperationTime.Add(new TreeListColumn()
                        {
                            FieldName = "UiTempStandardOperationTimeName",
                            Header = "Standard",
                            HeaderToolTip = "Standard",
                            AllowCellMerge = false,
                            Width = 150,    //gulab lakade not show StandardOperationTime proper
                            AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                            Visible = true,
                            ReadOnly = false,
                            FixedWidth = false
                        });

                        int Supplimentcount = 1;
                        var ColumnsStructureList = tempSupplementsBoxMenu.Where(p => !listadoDuplicadas.Any(p2 => p2.Item1 == p.Item1));
                        foreach (var item in ColumnsStructureList)
                        {
                            if (Supplimentcount == 5)
                            {
                                ColumnsStructureForSupplements.Add(new TreeListColumn()
                                {
                                    FieldName = "StructureSupplementPlant" + Supplimentcount + "Value",
                                    Header = "Others",
                                    HeaderToolTip = "Others",
                                    AllowCellMerge = false,
                                    Width = 60,
                                    AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                    Visible = true,
                                    ReadOnly = false,
                                    FixedWidth = false
                                });
                                ColumnsStructureOperationTime.Add(new TreeListColumn()
                                {
                                    FieldName = "UiTempoperationTimePlant" + Supplimentcount + "Value",
                                    Header = "Others",
                                    HeaderToolTip = "Others",
                                    AllowCellMerge = false,
                                    Width = 60,
                                    AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                    Visible = true,
                                    ReadOnly = false,
                                    FixedWidth = false
                                });
                                break;
                            }
                            if (Supplimentcount == 5)
                            {
                                break;
                            }
                            ColumnsStructureForSupplements.Add(new TreeListColumn()
                            {
                                FieldName = "StructureSupplementPlant" + Supplimentcount + "Value",
                                Header = item.Item1,
                                HeaderToolTip = item.Item1,
                                AllowCellMerge = false,
                                Width = 60,
                                AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                Visible = true,
                                ReadOnly = false,
                                FixedWidth = false
                            });

                            ColumnsStructureOperationTime.Add(new TreeListColumn()
                            {
                                FieldName = "UiTempoperationTimePlant" + Supplimentcount + "Value",
                                Header = item.Item1,
                                HeaderToolTip = item.Item1,
                                AllowCellMerge = false,
                                Width = 60,
                                AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                Visible = true,
                                ReadOnly = false,
                                FixedWidth = false
                            });
                            Supplimentcount = Supplimentcount + 1;
                        }
                        #endregion

                        bool FlagAddItemModule = false; //[GEOS2-5135][Rupali Sarode][18-12-2023]

                        foreach (WorkOperationByStages Module in operationStructureMenulist)
                        {
                            FlagAddItemModule = true; //[GEOS2-5135][Rupali Sarode][18-12-2023]

                            if (operationStructureMenulist.Any(a => a.IdworkOperationByStage == Convert.ToInt64(Module.IdworkOperationByStage))
                                && operationStructureMenulist.Any(a => a.Name.Trim().Equals(Module.Name.Trim()))
                                )
                            {
                                StandardOperationsDictionaryStructures standardOperationsDictionaryStructure = tempLstStandardOperationsDictionaryStructures.Where(w => w.IdWorkoperation == Convert.ToUInt64(Module.IdworkOperationByStage) && Module.Parent != null
                                && w.IdCpTypeNew == Convert.ToUInt32(ermStructures.IdCPType)).FirstOrDefault();

                                #region  [GEOS2-5135][Rupali Sarode][18-12-2023]
                                // If it is child & only active then add
                                List<WorkOperationByStages> childListInActiveDraft = operationStructureMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(Module.KeyName)).ToList();

                                if (childListInActiveDraft.Count == 0)
                                {
                                    if (Module.IdStatus == 1535)
                                    {
                                        FlagAddItemModule = true;
                                    }
                                    else
                                        FlagAddItemModule = false;
                                }
                                else // If it is parent and does not contain any active child, then do not include it
                                if (childListInActiveDraft.Count > 0)
                                {
                                    //List<WorkOperationByStages> childListInParent = operationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(Module.KeyName)).ToList();
                                    foreach (WorkOperationByStages objChild in childListInActiveDraft)
                                    {
                                        List<WorkOperationByStages> GrandChildListInActiveDraft = new List<WorkOperationByStages>();
                                        GrandChildListInActiveDraft = operationStructureMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(objChild.KeyName)).ToList();
                                        if (GrandChildListInActiveDraft.Count == 0)
                                        { // If it is child and Active
                                            if (objChild.IdStatus == 1535)
                                            {
                                                FlagAddItemModule = true;
                                                break;
                                            }
                                            else
                                            {
                                                FlagAddItemModule = false;
                                            }

                                        }
                                        else
                                        {
                                            if (GrandChildListInActiveDraft.Count > 0)
                                            {
                                                if (GrandChildListInActiveDraft.Where(i => i.IdStatus == 1535).Count() > 0)
                                                {
                                                    FlagAddItemModule = true;
                                                    break;
                                                }
                                                else
                                                {
                                                    FlagAddItemModule = false;
                                                }
                                            }
                                        }
                                    }
                                }
                                #endregion  [GEOS2-5135][Rupali Sarode][18-12-2023]
                                if (FlagAddItemModule == true)  //[GEOS2-5135][Rupali Sarode][18-12-2023]
                                { //[GEOS2-5135][Rupali Sarode][18-12-2023]

                                    ERMSOPStructures eRMSOPStructure = new ERMSOPStructures();
                                    if (standardOperationsDictionaryStructure != null)
                                        eRMSOPStructure.IdCpType = Convert.ToInt32(standardOperationsDictionaryStructure.IdCpTypeNew);
                                    eRMSOPStructure.Name = Module.Name;
                                    eRMSOPStructure.IdworkOperationByStage = Module.IdworkOperationByStage;
                                    eRMSOPStructure.IdSequence = Module.IdSequence;
                                    eRMSOPStructure.IdStatus = Module.IdStatus;
                                    eRMSOPStructure.Status = Module.Status;
                                    eRMSOPStructure.Code = Module.Name;
                                    eRMSOPStructure.Parent = Module.Parent;
                                    eRMSOPStructure.IdParent = Module.IdParent;
                                    eRMSOPStructure.KeyName = Module.KeyName;
                                    eRMSOPStructure.ParentName = Module.ParentName;
                                    #region [GEOS2-5629][gulab lakade][15 07 2024]
                                    if (standardOperationsDictionaryStructure != null)
                                    {
                                        eRMSOPStructure.Position = Convert.ToUInt32(standardOperationsDictionaryStructure.Position);
                                        eRMSOPStructure.StructurePosition = Convert.ToUInt32(standardOperationsDictionaryStructure.Position);//[GEOS2-5629][gulab lakade][10 07 2024]

                                    }
                                    else
                                    {
                                        eRMSOPStructure.Position = Module.Position;
                                        eRMSOPStructure.StructurePosition = Module.Position;

                                    }
                                    #endregion

                                    eRMSOPStructure.WorkOperation_count = Module.WorkOperation_count;
                                    eRMSOPStructure.WorkOperation_count_original = Module.WorkOperation_count_original;
                                    eRMSOPStructure.NameWithWorkOperationCount = Module.NameWithWorkOperationCount;
                                    //[rdixit][03.08.2022][GEOS2-3764]
                                    eRMSOPStructure.IsInactiveWorkOperation = Module.IsInactiveWorkOperation;
                                    eRMSOPStructure.IsReadOnly = Module.IsReadOnly;
                                    //eRMSOPDetection.NormalTime = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(Module.IdworkOperationByStage)).Select(s => s.NormalTime).DefaultIfEmpty(null).FirstOrDefault();
                                    //if (eRMSOPDetection.NormalTime != null)
                                    //    eRMSOPDetection.NormalTime = Math.Round((double)eRMSOPDetection.NormalTime, 2);
                                    //eRMSOPDetection.ObservedTime = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(Module.IdworkOperationByStage)).Select(s => s.ObservedTime).DefaultIfEmpty(null).FirstOrDefault();
                                    //if (eRMSOPDetection.ObservedTime != null)
                                    //    eRMSOPDetection.ObservedTime = Math.Round((double)eRMSOPDetection.ObservedTime, 2);
                                    //eRMSOPDetection.Activity = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(Module.IdworkOperationByStage)).Select(s => s.Activity).DefaultIfEmpty(null).FirstOrDefault(); ;
                                    //if (eRMSOPDetection.Activity != null)
                                    //    eRMSOPDetection.Activity = Math.Round((double)eRMSOPDetection.Activity, 2);

                                    if (!GetStages.Any(a => a.Code.Equals(eRMSOPStructure.Name)))
                                    {
                                        var tempActivity = tempLstStandardOperationsDictionaryStructures.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPStructure.IdworkOperationByStage)
                                         && w.IdCpTypeNew == Convert.ToUInt32(eRMSOPStructure.IdCpType)).Select(s => s.Activity).DefaultIfEmpty(null).FirstOrDefault();
                                        var tempObservedTime = tempLstStandardOperationsDictionaryStructures.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPStructure.IdworkOperationByStage)
                                         && w.IdCpTypeNew == Convert.ToUInt32(eRMSOPStructure.IdCpType)).Select(s => s.ObservedTime).DefaultIfEmpty(null).FirstOrDefault();
                                        #region Geos2 4079 Structure Store/ Save in the SDO tables the Observed time, Activity

                                        var tempStructure = tempLstStandardOperationsDictionaryStructures.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPStructure.IdworkOperationByStage)
                                        && w.IdCpTypeNew == Convert.ToUInt32(eRMSOPStructure.IdCpType)).FirstOrDefault();

                                        if (tempStructure != null)
                                        {
                                            if (tempStructure.IdWorkoperation == Convert.ToUInt64(eRMSOPStructure.IdworkOperationByStage) && (tempStructure.Activity == null || tempStructure.Activity == 0))
                                            {
                                                tempActivity = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == Module.IdworkOperationByStage && a.KeyName == Module.KeyName).Select(b => b.Activity).FirstOrDefault(); //[Cut  work operation not work properly.][gulab lakade][24 01 2023]
                                            }
                                            if (tempStructure.IdWorkoperation == Convert.ToUInt64(eRMSOPStructure.IdworkOperationByStage) && (tempStructure.ObservedTime == null || tempStructure.ObservedTime == 0))
                                            {
                                                tempObservedTime = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == Module.IdworkOperationByStage && a.KeyName == Module.KeyName).Select(b => b.ObservedTime).FirstOrDefault(); //[Cut  work operation not work properly.][gulab lakade][24 01 2023]
                                            }
                                        }
                                        #endregion
                                        if (tempActivity != null)
                                            eRMSOPStructure.StructureActivity = Math.Round((double)tempActivity, 2);
                                        if (tempObservedTime != null)
                                        {
                                            eRMSOPStructure.StructureObservedTime = Math.Round((double)tempObservedTime, 2);
                                            #region [GEOS2-3954] [Rupali Sarode] Time format HH:mm:ss
                                            //eRMSOPStructure.UITempStructureObservedTime = tempLstStandardOperationsDictionaryStructures.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPStructure.IdworkOperationByStage)
                                            //&& w.IdCpType == Convert.ToUInt64(eRMSOPStructure.IdCpType)).Select(s => s.UITempStructureObservedTime).FirstOrDefault();

                                            #region [GEOS2-5008][gulab lakade][1 11 2023]
                                            //eRMSOPStructure.UITempStructureObservedTime = TimeSpan.FromMinutes(Convert.ToDouble(tempObservedTime));
                                            eRMSOPStructure.UITempStructureObservedTime = ConvertfloattoTimespan(Convert.ToString(Convert.ToDouble(tempObservedTime)));
                                            #endregion
                                            #endregion
                                        }

                                        eRMSOPStructure.StructureNormalTime = Math.Round(Convert.ToDouble(eRMSOPStructure.StructureObservedTime * eRMSOPStructure.StructureActivity / 100), 2);
                                        #region [GEOS2-3954] [Rupali Sarode] Time format HH:mm:ss
                                        eRMSOPStructure.UITempStructureNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(eRMSOPStructure.StructureNormalTime));
                                        #endregion

                                        //[GEOS2-3933][Rupali Sarode][22/09/2022]
                                        eRMSOPStructure.WORemarks = Module.WORemarks == null ? "" : Module.WORemarks.Trim();

                                        //[GEOS2-3933][Rupali Sarode][26/09/2022]
                                        var tempRemarks = tempLstStandardOperationsDictionaryStructures.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPStructure.IdworkOperationByStage)
                                        && w.IdCpTypeNew == Convert.ToUInt32(eRMSOPStructure.IdCpType)).Select(s => s.Remarks).DefaultIfEmpty(null).FirstOrDefault();

                                        eRMSOPStructure.Remarks = tempRemarks == null ? "" : tempRemarks.Trim();

                                    }


                                    if (GetStages.Any(a => a != null && a.Code.Trim().Equals(Module.Name.Trim())))
                                    {
                                        eRMSOPStructure.IsDeleteButton = false;
                                        eRMSOPStructure.IsDeleteButtonVisibility = Visibility.Hidden;
                                        eRMSOPStructure.IsReadOnly = true;
                                        eRMSOPStructure.IsValidateOnTextInput = false;
                                        Module.IsCurrentWorkOperation = true;
                                    }
                                    else
                                    {
                                        Module.IsCurrentWorkOperation = true;
                                        eRMSOPStructure.IsReadOnly = false;
                                        eRMSOPStructure.IsValidateOnTextInput = true;
                                    }
                                    if (Module.IdStatus == 1536)
                                    {
                                        eRMSOPStructure.IsInactiveWorkOperation = true;
                                        eRMSOPStructure.IsReadOnly = true;
                                    }
                                    #region [GEOS2-4830][gulab lakade][07 12 2023]
                                    if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(eRMSOPStructure.Name.Trim())))
                                    {
                                        if (StructureStandardOperationTime != null)
                                            eRMSOPStructure.StructureStandardSupplements = (float?)StructureStandardOperationTime.Item2;
                                        if (tempSupplementsBoxMenu.Any(p => !listadoDuplicadas.Any(p2 => p2.Item1 == p.Item1)))
                                        {
                                            eRMSOPStructure.AllSupplementsBoxMenu = AllSupplementsBoxMenu;
                                            List<float?> lst = new List<float?>();

                                            var a = ColumnsStructureList.ToList();
                                            for (int i = 0; i < a.Count(); i++)
                                            {
                                                lst.Add((float?)a[i].Item2);
                                            }

                                            if (ColumnsStructureList.Count() == 1)
                                            {
                                                eRMSOPStructure.StructureSupplementPlant1Value = (float?)lst[0];
                                            }
                                            else if (ColumnsStructureList.Count() == 2)
                                            {
                                                eRMSOPStructure.StructureSupplementPlant1Value = (float?)lst[0];
                                                eRMSOPStructure.StructureSupplementPlant2Value = (float?)lst[1];
                                            }
                                            else if (ColumnsStructureList.Count() == 3)
                                            {
                                                eRMSOPStructure.StructureSupplementPlant1Value = (float?)lst[0];
                                                eRMSOPStructure.StructureSupplementPlant2Value = (float?)lst[1];
                                                eRMSOPStructure.StructureSupplementPlant3Value = (float?)lst[2];
                                            }
                                            else if (ColumnsStructureList.Count() == 4)
                                            {
                                                eRMSOPStructure.StructureSupplementPlant1Value = (float?)lst[0];
                                                eRMSOPStructure.StructureSupplementPlant2Value = (float?)lst[1];
                                                eRMSOPStructure.StructureSupplementPlant3Value = (float?)lst[2];
                                                eRMSOPStructure.StructureSupplementPlant4Value = (float?)lst[3];
                                            }
                                            else if (ColumnsStructureList.Count() == 5)
                                            {
                                                eRMSOPStructure.StructureSupplementPlant1Value = (float?)lst[0];
                                                eRMSOPStructure.StructureSupplementPlant2Value = (float?)lst[1];
                                                eRMSOPStructure.StructureSupplementPlant3Value = (float?)lst[2];
                                                eRMSOPStructure.StructureSupplementPlant4Value = (float?)lst[3];
                                                eRMSOPStructure.StructureSupplementPlant5Value = (float?)lst[4];
                                            }
                                            else
                                            {
                                                eRMSOPStructure.StructureSupplementPlant1Value = (float?)lst[0];
                                                eRMSOPStructure.StructureSupplementPlant2Value = (float?)lst[1];
                                                eRMSOPStructure.StructureSupplementPlant3Value = (float?)lst[2];
                                                eRMSOPStructure.StructureSupplementPlant4Value = (float?)lst[3];
                                                eRMSOPStructure.StructureSupplementPlant5Value = 0;
                                                if (ColumnsStructureList.Count() > 5)
                                                {
                                                    for (int q = 4; q < ColumnsStructureList.Count(); q++)
                                                    {
                                                        if (eRMSOPStructure.StructureSupplementPlant5Value == null)
                                                            eRMSOPStructure.StructureSupplementPlant5Value = 0;
                                                        eRMSOPStructure.StructureSupplementPlant5Value = eRMSOPStructure.StructureSupplementPlant5Value + (float?)lst[q];
                                                    }
                                                }


                                            }

                                        }
                                        #region GEOS2-4046 Gulab Lakade
                                        if (StructureStandardOperationTime != null)
                                            eRMSOPStructure.StructureStandardOperationTime = (float?)Math.Round(Convert.ToDouble(eRMSOPStructure.StructureNormalTime * (1 + (Convert.ToDouble(StructureStandardOperationTime.Item2) / 100))), 2);

                                        eRMSOPStructure.StructureOperationTimePlant1Value = (float?)Math.Round(Convert.ToDouble(eRMSOPStructure.StructureNormalTime * (1 + (Convert.ToDouble(eRMSOPStructure.StructureSupplementPlant1Value) / 100))), 2);
                                        eRMSOPStructure.StructureOperationTimePlant2Value = (float?)Math.Round(Convert.ToDouble(eRMSOPStructure.StructureNormalTime * (1 + (Convert.ToDouble(eRMSOPStructure.StructureSupplementPlant2Value) / 100))), 2);
                                        eRMSOPStructure.StructureOperationTimePlant3Value = (float?)Math.Round(Convert.ToDouble(eRMSOPStructure.StructureNormalTime * (1 + (Convert.ToDouble(eRMSOPStructure.StructureSupplementPlant3Value) / 100))), 2);
                                        eRMSOPStructure.StructureOperationTimePlant4Value = (float?)Math.Round(Convert.ToDouble(eRMSOPStructure.StructureNormalTime * (1 + (Convert.ToDouble(eRMSOPStructure.StructureSupplementPlant4Value) / 100))), 2);
                                        eRMSOPStructure.StructureOperationTimePlant5Value = (float?)Math.Round(Convert.ToDouble(eRMSOPStructure.StructureNormalTime * (1 + (Convert.ToDouble(eRMSOPStructure.StructureSupplementPlant5Value) / 100))), 2);
                                        #endregion
                                        #region GEOS2-3954 Show the WorkOperations and SOD Time in the format: MM:SS or HH:MM:SS
                                        try
                                        {
                                            eRMSOPStructure.UiTempStandardOperationTimeName = ConvertfloattoTimespan(Convert.ToString(eRMSOPStructure.StructureStandardOperationTime));
                                            eRMSOPStructure.UiTempoperationTimePlant1Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPStructure.StructureOperationTimePlant1Value));
                                            eRMSOPStructure.UiTempoperationTimePlant2Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPStructure.StructureOperationTimePlant2Value));
                                            eRMSOPStructure.UiTempoperationTimePlant3Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPStructure.StructureOperationTimePlant3Value));
                                            eRMSOPStructure.UiTempoperationTimePlant4Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPStructure.StructureOperationTimePlant4Value));
                                            eRMSOPStructure.UiTempoperationTimePlant5Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPStructure.StructureOperationTimePlant5Value));
                                        }
                                        catch (Exception ex)
                                        {
                                            GeosApplication.Instance.Logger.Log(string.Format("Error in Method RetrieveWorkOperationsByStructure() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                        }
                                        #endregion
                                    }
                                    #endregion
                                    try
                                    {
                                        if (!StructureMenulistTemp.Any(a => a.KeyName.Equals(Module.KeyName)))
                                            StructureMenulistTemp.Add(eRMSOPStructure);
                                    }
                                    catch (Exception ex)
                                    {

                                    }
                                } //[GEOS2-5135][Rupali Sarode][18-12-2023]
                            }
                        }
                    }//[GEOS2-4830][gulab lakade][07 12 2023]

                    #region GEOS2-3857 Rupali Sarode
                    //var tempWorkOperationMenulist2 = StructureMenulistTemp.OrderBy(x => x.Position).ToList();
                    var tempWorkOperationMenulist2 = StructureMenulistTemp.OrderBy(x => x.StructurePosition).ToList(); //[GEOS2-5629][gulab lakade][15 07 2024]
                    tempWorkOperationClonedStructure = new List<ERMSOPStructures>();
                    tempWorkOperationClonedStructure.AddRange(tempWorkOperationMenulist2);
                    #endregion

                    //List<ERMSOPStructures> tempWorkOperationStructureMenulist = StructureMenulistTemp.OrderBy(x => x.Position).ToList();
                    List<ERMSOPStructures> tempWorkOperationStructureMenulist = StructureMenulistTemp.OrderBy(x => x.StructurePosition).ToList();//[GEOS2-5629][gulab lakade][15 07 2024]
                    StructureMenulistTemp.Clear();
                    StructureMenulistTemp.AddRange(tempWorkOperationStructureMenulist);
                    tempWorkOperationStructureMenulist.Clear();
                    if (StructureMenulistTemp != null)
                    {
                        var tempStructureMenulist = StructureMenulistTemp.ToList();
                        for (int i = 0; i < tempStructureMenulist.Count; i++)
                        {
                            if (GetStages.Any(a => a.Code.Equals(tempStructureMenulist[i].Name)))
                            {
                                List<ERMSOPStructures> childList = StructureMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(tempStructureMenulist[i].KeyName)).ToList();
                                if (childList.Count == 0)
                                {
                                    List<WorkOperationByStages> tempWOList = WorkOperationMenulist.Where(w => w.KeyName == tempStructureMenulist[i].KeyName).ToList();
                                    if (tempWOList != null)
                                        tempWOList.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                                    StructureMenulistTemp.Remove(tempStructureMenulist[i]);
                                }
                            }
                        }
                    }
                    #endregion
                }
                #region TemplateWithCPTypes
                else if (SelectedItemStructures is DetectionGroupWithStructures)
                {
                    StructureMenulistTemp = null;
                    workOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                    #region GEOS2-3857 Rupali Sarode
                    SelectedItemStructureGroup = Convert.ToString(SelectedItemStructures.ToString());
                    #endregion
                }
                #endregion

                //FillStructureGridColumn();//[GEOS2-4830][gulab lakade][07 12 2023]

                //FillStructureGridColumn(); //[GEOS2-3601]  Rupali Sarode
                #region Commented Code
                //if (DetectionMenulist != null)
                //    foreach (var item in DetectionMenulist)
                //    {
                //        if (!GetStages.Any(a => a.Code.Equals(item.Name)))
                //        {
                //            var tempActivity = tempLstStandardOperationsDictionaryDetection.Where(w => w.IdWorkoperation == Convert.ToUInt64(item.IdworkOperationByStage)
                //             && w.IdDetection == Convert.ToUInt64(item.IdDetection)).Select(s => s.Activity).DefaultIfEmpty(null).FirstOrDefault();
                //            var tempObservedTime = tempLstStandardOperationsDictionaryDetection.Where(w => w.IdWorkoperation == Convert.ToUInt64(item.IdworkOperationByStage)
                //             && w.IdDetection == Convert.ToUInt64(item.IdDetection)).Select(s => s.ObservedTime).DefaultIfEmpty(null).FirstOrDefault();

                //            if (tempActivity != null)
                //                item.Activity = Math.Round((double)tempActivity, 2);
                //            if (tempObservedTime != null)
                //                item.ObservedTime = Math.Round((double)tempObservedTime, 2);

                //            item.NormalTime = Math.Round(Convert.ToDouble(item.ObservedTime * item.Activity / 100), 2);
                //        }
                //    }
                #endregion
                #region RND
                #region calculation
                #region [GEOS2-4830][gulab lakade][07 12 2023]
                //if (StructureMenulistTemp != null)
                //    //foreach (ERMSOPDetection itemERMSOPDetection in DetectionMenulist)
                //    for (int d = 0; d < StructureMenulistTemp.Count(); d++)
                //    {
                //        WorkOperationMenulist.Where(w => w.KeyName == StructureMenulistTemp[d].KeyName).ToList().ForEach(f => f.IsCurrentWorkOperation = true);
                //        var listCount = StructureMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(StructureMenulistTemp[d].KeyName) && w.IsInactiveWorkOperation == false).ToList();//[rdixit][03.08.2022][GEOS2-3764]
                //        if (listCount != null)
                //            if (listCount.Count() > 0)
                //            {
                //                StructureMenulistTemp[d].StructureObservedTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.StructureObservedTime)), 2);
                //                StructureMenulistTemp[d].StructureNormalTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.StructureNormalTime)), 2);
                //                #region [GEOS2-3954] [Rupali Sarode] Time format HH:mm:ss
                //                StructureMenulistTemp[d].UITempStructureObservedTime = ConvertfloattoTimespan(Convert.ToString(Convert.ToDouble(listCount.Sum(s => s.StructureObservedTime))));
                //                StructureMenulistTemp[d].UITempStructureNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(Convert.ToDouble(listCount.Sum(s => s.StructureNormalTime))));
                //                #endregion

                //                StructureMenulistTemp[d].IsReadOnly = true;
                //            }
                //    }
                #endregion

                if (StructureMenulistTemp != null)
                    for (int d = 0; d < StructureMenulistTemp.Count(); d++)
                    {
                        WorkOperationMenulist.Where(w => w.KeyName == StructureMenulistTemp[d].KeyName).ToList().ForEach(f => f.IsCurrentWorkOperation = true);
                        //[GEOS2-5135][Rupali Sarode][19-12-2023]

                        // var listCount = StructureMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(StructureMenulistTemp[d].KeyName) && w.IsInactiveWorkOperation == false).ToList();//[rdixit][03.08.2022][GEOS2-3764]
                        var listCount = StructureMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(StructureMenulistTemp[d].KeyName)).ToList();//[rdixit][03.08.2022][GEOS2-3764]
                        if (listCount != null)
                            if (listCount.Count() > 0)
                            {
                                StructureMenulistTemp[d].StructureObservedTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.StructureObservedTime)), 2);
                                StructureMenulistTemp[d].StructureNormalTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.StructureNormalTime)), 2);

                                #region [GEOS2-3954] [Rupali Sarode] Time format HH:mm:ss
                                StructureMenulistTemp[d].UITempStructureObservedTime = ConvertfloattoTimespan(Convert.ToString(listCount.Sum(s => s.StructureObservedTime)));
                                StructureMenulistTemp[d].UITempStructureNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(listCount.Sum(s => s.StructureNormalTime)));
                                #endregion

                                StructureMenulistTemp[d].IsReadOnly = true;
                            }
                    }

                if (StructureMenulistTemp != null)
                    //foreach (ERMSOPDetection itemERMSOPDetection in DetectionMenulist)
                    for (int d = 0; d < StructureMenulistTemp.Count(); d++)
                    {
                        if (GetStages.Any(a => a.Code.Equals(StructureMenulistTemp[d].Name)))
                        {
                            ObservableCollection<ERMSOPStructures> ActivitySum = new ObservableCollection<ERMSOPStructures>();
                            ObservableCollection<ERMSOPStructures> TempActivitySum = new ObservableCollection<ERMSOPStructures>();
                            int x = 1;
                            Loop:
                            x++;
                            if (x < 10)
                            {
                                if (ActivitySum.Count == 0)
                                {
                                    StructureMenulistTemp[d].StructureObservedTime = 0;
                                    StructureMenulistTemp[d].StructureNormalTime = 0;
                                    #region [GEOS2-3954] [Rupali Sarode] Time format HH:mm:ss
                                    StructureMenulistTemp[d].UITempStructureObservedTime = ConvertfloattoTimespan(Convert.ToString(StructureMenulistTemp[d].StructureObservedTime));
                                    StructureMenulistTemp[d].UITempStructureNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(StructureMenulistTemp[d].StructureNormalTime));
                                    #endregion

                                    //[GEOS2-5135][Rupali Sarode][19-12-2023]
                                    //var ActivitySumList = StructureMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(StructureMenulistTemp[d].KeyName) && w.IsInactiveWorkOperation == false).ToList();//[rdixit][03.08.2022][GEOS2-3764]
                                    var ActivitySumList = StructureMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(StructureMenulistTemp[d].KeyName)).ToList();//[rdixit][03.08.2022][GEOS2-3764]
                                    ActivitySum.AddRange(ActivitySumList);
                                }
                                else
                                {
                                    #region Commented Code
                                    //foreach (var item in ActivitySum)
                                    //{
                                    //    var ActivitySumList = DetectionMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(item.KeyName)).ToList();
                                    //    if (ActivitySumList != null && ActivitySumList.Count > 0)
                                    //    {

                                    //        foreach (var itemActivity in ActivitySumList)
                                    //        {
                                    //            if (!ActivitySum.Any(ac => ac.KeyName.Equals(itemActivity.KeyName)))
                                    //            {
                                    //                TempActivitySum.Add(itemActivity);
                                    //            }

                                    //        }

                                    //    }

                                    //}
                                    //ActivitySum.AddRange(TempActivitySum);
                                    #endregion
                                }


                                goto Loop;
                            }

                            double? ObservedTime = 0;
                            double? NormalTime = 0;
                            float? StandardTime = 0;
                            float? OperationTimePlant1Value = 0;
                            float? OperationTimePlant2Value = 0;
                            float? OperationTimePlant3Value = 0;
                            float? OperationTimePlant4Value = 0;
                            float? OperationTimePlant5Value = 0;
                            var tempDistinctList = ActivitySum.Select(xa => xa.KeyName).Distinct().ToList();
                            foreach (var item in tempDistinctList)
                            {
                                if (StructureMenulistTemp[d].StructureObservedTime == null)
                                    StructureMenulistTemp[d].StructureObservedTime = 0;
                                double? tempObservedTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.StructureObservedTime).FirstOrDefault();
                                if (tempObservedTime != null)
                                {
                                    ObservedTime = Math.Round(Convert.ToDouble(ObservedTime + tempObservedTime), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    StructureMenulistTemp[d].UITempStructureObservedTime = ConvertfloattoTimespan(Convert.ToString(ObservedTime));
                                    #endregion
                                }
                                if (StructureMenulistTemp[d].StructureNormalTime == null)
                                    StructureMenulistTemp[d].StructureNormalTime = 0;
                                double? tempNormalTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.StructureNormalTime).FirstOrDefault();
                                if (tempNormalTime != null)
                                {
                                    NormalTime = Math.Round(Convert.ToDouble(NormalTime + tempNormalTime), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    StructureMenulistTemp[d].UITempStructureNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(NormalTime));
                                    #endregion
                                }
                            }
                            StructureMenulistTemp[d].StructureObservedTime = ObservedTime;
                            StructureMenulistTemp[d].StructureNormalTime = NormalTime;
                            #region [GEOS2-3954] [Rupali Sarode] Time format HH:mm:ss
                            StructureMenulistTemp[d].UITempStructureObservedTime = ConvertfloattoTimespan(Convert.ToString(ObservedTime));
                            StructureMenulistTemp[d].UITempStructureNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(StructureMenulistTemp[d].StructureNormalTime));
                            #endregion

                            //DetectionMenulist[d].DetectionNormalTime = Math.Round(Convert.ToDouble(ObservedTime * DetectionMenulist[d].DetectionActivity / 100), 2);
                            #region PlantValue


                            foreach (var item in tempDistinctList)
                            {
                                if (StructureMenulistTemp[d].StructureStandardOperationTime == null)
                                    StructureMenulistTemp[d].StructureStandardOperationTime = 0;
                                float? tempStandardTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.StructureStandardOperationTime).FirstOrDefault();
                                if (tempStandardTime != null)
                                    StandardTime = StandardTime + tempStandardTime;

                                if (StructureMenulistTemp[d].StructureOperationTimePlant1Value == null)
                                    StructureMenulistTemp[d].StructureOperationTimePlant1Value = 0;
                                float? tempOperationTimePlant1Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.StructureOperationTimePlant1Value).FirstOrDefault();
                                if (tempOperationTimePlant1Value != null)
                                    OperationTimePlant1Value = OperationTimePlant1Value + tempOperationTimePlant1Value;

                                if (StructureMenulistTemp[d].StructureOperationTimePlant2Value == null)
                                    StructureMenulistTemp[d].StructureOperationTimePlant2Value = 0;
                                float? tempOperationTimePlant2Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.StructureOperationTimePlant2Value).FirstOrDefault();
                                if (tempOperationTimePlant2Value != null)
                                    OperationTimePlant2Value = OperationTimePlant2Value + tempOperationTimePlant2Value;

                                if (StructureMenulistTemp[d].StructureOperationTimePlant3Value == null)
                                    StructureMenulistTemp[d].StructureOperationTimePlant3Value = 0;
                                float? tempOperationTimePlant3Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.StructureOperationTimePlant3Value).FirstOrDefault();
                                if (tempOperationTimePlant3Value != null)
                                    OperationTimePlant3Value = OperationTimePlant3Value + tempOperationTimePlant3Value;

                                if (StructureMenulistTemp[d].StructureOperationTimePlant4Value == null)
                                    StructureMenulistTemp[d].StructureOperationTimePlant4Value = 0;
                                float? tempOperationTimePlant4Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.StructureOperationTimePlant4Value).FirstOrDefault();
                                if (tempOperationTimePlant4Value != null)
                                    OperationTimePlant4Value = OperationTimePlant4Value + tempOperationTimePlant4Value;

                                if (StructureMenulistTemp[d].StructureOperationTimePlant5Value == null)
                                    StructureMenulistTemp[d].StructureOperationTimePlant5Value = 0;
                                float? tempOperationTimePlant5Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.StructureOperationTimePlant5Value).FirstOrDefault();
                                if (tempOperationTimePlant5Value != null)
                                    OperationTimePlant5Value = OperationTimePlant5Value + tempOperationTimePlant5Value;
                            }
                            #endregion
                            StructureMenulistTemp[d].StructureStandardOperationTime = (float?)Math.Round(Convert.ToDouble(StandardTime), 2);
                            StructureMenulistTemp[d].StructureOperationTimePlant1Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant1Value), 2);
                            StructureMenulistTemp[d].StructureOperationTimePlant2Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant2Value), 2);
                            StructureMenulistTemp[d].StructureOperationTimePlant3Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant3Value), 2);
                            StructureMenulistTemp[d].StructureOperationTimePlant4Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant4Value), 2);
                            StructureMenulistTemp[d].StructureOperationTimePlant5Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant5Value), 2);
                            #region GEOS2-3954 Show the WorkOperations and SOD Time in the format: MM:SS or HH:MM:SS
                            try
                            {
                                StructureMenulistTemp[d].UiTempStandardOperationTimeName = ConvertfloattoTimespan(Convert.ToString(StructureMenulistTemp[d].StructureStandardOperationTime));
                                StructureMenulistTemp[d].UiTempoperationTimePlant1Value = ConvertfloattoTimespan(Convert.ToString(StructureMenulistTemp[d].StructureOperationTimePlant1Value));
                                StructureMenulistTemp[d].UiTempoperationTimePlant2Value = ConvertfloattoTimespan(Convert.ToString(StructureMenulistTemp[d].StructureOperationTimePlant2Value));
                                StructureMenulistTemp[d].UiTempoperationTimePlant3Value = ConvertfloattoTimespan(Convert.ToString(StructureMenulistTemp[d].StructureOperationTimePlant3Value));
                                StructureMenulistTemp[d].UiTempoperationTimePlant4Value = ConvertfloattoTimespan(Convert.ToString(StructureMenulistTemp[d].StructureOperationTimePlant4Value));
                                StructureMenulistTemp[d].UiTempoperationTimePlant5Value = ConvertfloattoTimespan(Convert.ToString(StructureMenulistTemp[d].StructureOperationTimePlant5Value));
                            }
                            catch (Exception ex)
                            {
                                GeosApplication.Instance.Logger.Log(string.Format("Error in Method RetrieveWorkOperationsByStructure() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            }
                            #endregion
                        }
                    }
                #endregion 
                StructureMenulist = new ObservableCollection<ERMSOPStructures>();
                StructureMenulist = StructureMenulistTemp;
                #endregion
                //structureCustomSummarycalculation();
                //if (ModuleMenulist != null)
                //    ModuleMenulistCloned = ModuleMenulist;
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Method RetrieveWorkOperationsByStructure()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log(string.Format("Error in method RetrieveWorkOperationsByStructure() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        #endregion

        List<StandardOperationsDictionaryDetection> standardOperationsDictionaryDetectionDeleteList = new List<StandardOperationsDictionaryDetection>();
        List<ERMSOPDetection> ERMSOPDetectionDeleteList = new List<ERMSOPDetection>();
        List<ERMSOPDetection> ERMSOPDetectionDeleteParentList = new List<ERMSOPDetection>();
        private void ERMSOPDetectionDeleteAction(List<ERMSOPDetection> deletelist)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ERMSOPDetectionDeleteAction()...", category: Category.Info, priority: Priority.Low);

                foreach (ERMSOPDetection item in deletelist)
                {
                    if (!ERMSOPDetectionDeleteList.Any(a => a.KeyName.Equals(item.KeyName)))
                    {
                        ERMSOPDetectionDeleteList.Add(item);
                        WorkOperationMenulist.Where(w => w.IdworkOperationByStage == item.IdworkOperationByStage).ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                    }

                    List<ERMSOPDetection> isitemExist = DetectionMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(item.KeyName)).ToList();
                    if (deletelist != null || deletelist.Count() > 0)
                    {
                        ERMSOPDetectionDeleteAction(isitemExist);
                    }
                }
                GeosApplication.Instance.Logger.Log("Method ERMSOPDetectionDeleteAction()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method ERMSOPDetectionDeleteAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

            }
        }
        private void ERMSOPDetectionDeleteParentAction(List<ERMSOPDetection> deleteParentlist)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ERMSOPDetectionDeleteParentAction()...", category: Category.Info, priority: Priority.Low);

                foreach (ERMSOPDetection item in deleteParentlist)
                {
                    if (!ERMSOPDetectionDeleteParentList.Any(a => a.KeyName.Equals(item.KeyName)))
                    {
                        ERMSOPDetectionDeleteParentList.Add(item);
                        DetectionMenulist.Remove(item);
                        WorkOperationMenulist.Where(w => w.IdworkOperationByStage == item.IdworkOperationByStage).ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                    }
                    List<ERMSOPDetection> isitemExist = DetectionMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(item.ParentName)).ToList();
                    if (isitemExist.Count == 0)
                    {
                        List<ERMSOPDetection> parentlist = DetectionMenulist.Where(w => w.KeyName.Equals(item.ParentName)).ToList();
                        ERMSOPDetectionDeleteParentAction(parentlist);
                    }

                }
                GeosApplication.Instance.Logger.Log("Method ERMSOPDetectionDeleteParentAction()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method ERMSOPDetectionDeleteParentAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

            }
        }
        private void DeleteDetectionTreeListControlCommandAction(object obj)
        {
            try
            {
                ERMSOPDetection MainRow = ((ERMSOPDetection)obj);
                GeosApplication.Instance.Logger.Log("Method DeleteDetectionTreeListControlCommandAction()...", category: Category.Info, priority: Priority.Low);
                #region Commented Code
                //List<StandardOperationsDictionaryModules> ValidateLstStandardOperationsDictionaryModules = new List<StandardOperationsDictionaryModules>();
                //ValidateLstStandardOperationsDictionaryModules = tempLstStandardOperationsDictionaryModules.Where(i => i.WorkOperationName == MainRow.Code).ToList();
                ////[rdixit][03.08.2022][GEOS2-3764]
                //if (ValidateLstStandardOperationsDictionaryModules.Count > 0)
                //{
                //    CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("RemoveWorkOperationGridValidationPresentinMultipleSOD").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                //    return;
                //}
                //else if (WorkOperationMenulist.Any(i => i.IdParent == (ulong?)(MainRow.IdworkOperationByStage)) == true)
                //{
                //    CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("RemoveWorkOperationGridValidationForHavingSons").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                //    return;
                //}
                //else if (MainRow.IdStatus == 1535)
                //{
                //    CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("RemoveWorkOperationGridValidationForActive").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                //    return;
                //}

                //else if (MainRow.IdStatus == 1536)
                //{
                //    CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("RemoveWorkOperationGridValidationForInactive").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                //    return;
                //}
                #endregion
                MessageBoxResult MessageBoxResult = CustomMessageBox.Show(String.Format(Application.Current.Resources["WorkOperationsDeleteMessage"].ToString()), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                if (MessageBoxResult == MessageBoxResult.Yes)
                {
                    operationMenulist = new ObservableCollection<WorkOperationByStages>();
                    ERMSOPDetectionDeleteList = new List<ERMSOPDetection>();
                    ERMSOPDetectionDeleteParentList = new List<ERMSOPDetection>();
                    IsEnabledSaveButton = true;
                    SaveButtonVisibility = Visibility.Visible;
                    StandardOperationsDictionary tempSelectedStandardOperationsDictionary = new StandardOperationsDictionary();
                    tempSelectedStandardOperationsDictionary.IdStandardOperationsDictionary = tempLstStandardOperationsDictionaryDetection.Select(w => w.IdStandardOperationsDictionary).FirstOrDefault();

                    StandardOperationsDictionaryDetection standardOperationsDictionaryDetection = new StandardOperationsDictionaryDetection();
                    if (MainRow != null)
                    {
                        #region GEOS2-4046 Gulab Lakade
                        ObservableCollection<ERMSOPDetection> DetectionMenulistTemp = new ObservableCollection<ERMSOPDetection>();
                        DetectionMenulistTemp = DetectionMenulist;
                        List<ERMSOPDetection> found = new List<ERMSOPDetection>();
                        if (!found.Any(a => a != null && a.KeyName.Trim().Equals(MainRow.KeyName.Trim())))
                            found.AddRange(DetectionMenulistTemp.Where(s => s.IdworkOperationByStage == MainRow.IdworkOperationByStage).ToList());

                        for (int i = 0; i < found.Count(); i++)
                        {

                            standardOperationsDictionaryDetection.IdWorkoperation = Convert.ToUInt32(MainRow.IdworkOperationByStage);
                            if (SelectedItemDetection is ERMDetections)
                            {
                                ERMDetections eRMDetections = (ERMDetections)SelectedItemDetection;
                                standardOperationsDictionaryDetection.IdDetection = (UInt64)eRMDetections.IdDetection;
                            }
                            standardOperationsDictionaryDetection.ObservedTime = (float?)found[i].DetectionObservedTime;
                            standardOperationsDictionaryDetection.Activity = (float?)found[i].DetectionActivity;

                            DetectionMenulistTemp.Remove(found[i]);
                            WorkOperationMenulist.Where(w => w.IdworkOperationByStage == found[i].IdworkOperationByStage).ToList().ForEach(f => f.IsCurrentWorkOperation = false);

                            standardOperationsDictionaryDetectionDeleteList.Add(standardOperationsDictionaryDetection);
                            List<ERMSOPDetection> deletelist = DetectionMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(found[i].KeyName)).ToList();
                            if (deletelist != null)
                            {
                                ERMSOPDetectionDeleteAction(deletelist);
                            }
                            if (ERMSOPDetectionDeleteList != null)
                                foreach (ERMSOPDetection item in ERMSOPDetectionDeleteList)
                                {
                                    StandardOperationsDictionaryDetection standardOperationsDictionary = new StandardOperationsDictionaryDetection();
                                    standardOperationsDictionary.IdWorkoperation = Convert.ToUInt32(item.IdworkOperationByStage);
                                    if (SelectedItemDetection is ERMDetections)
                                    {
                                        ERMDetections eRMDetections = (ERMDetections)SelectedItemDetection;
                                        standardOperationsDictionary.IdDetection = (UInt64)eRMDetections.IdDetection;
                                    }
                                    standardOperationsDictionary.ObservedTime = (float?)item.DetectionObservedTime;
                                    standardOperationsDictionary.Activity = (float?)item.DetectionActivity;
                                    DetectionMenulistTemp.Remove(item);
                                    standardOperationsDictionaryDetectionDeleteList.Add(standardOperationsDictionary);
                                }

                            List<ERMSOPDetection> deleteParentlist = DetectionMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(found[i].ParentName)).ToList();
                            if (deleteParentlist.Count == 0)
                            {
                                List<ERMSOPDetection> parentlist = DetectionMenulistTemp.Where(w => w.KeyName.Equals(found[i].ParentName)).ToList();
                                ERMSOPDetectionDeleteParentAction(parentlist);
                            }
                            if (ERMSOPDetectionDeleteParentList != null)
                                foreach (ERMSOPDetection item in ERMSOPDetectionDeleteParentList)
                                {
                                    StandardOperationsDictionaryDetection standardOperationsDictionary = new StandardOperationsDictionaryDetection();
                                    standardOperationsDictionary.IdWorkoperation = Convert.ToUInt32(item.IdworkOperationByStage);
                                    if (SelectedItemDetection is ERMDetections)
                                    {
                                        ERMDetections eRMDetections = (ERMDetections)SelectedItemDetection;
                                        standardOperationsDictionary.IdDetection = (UInt64)eRMDetections.IdDetection;
                                    }
                                    standardOperationsDictionary.ObservedTime = (float?)item.DetectionObservedTime;
                                    standardOperationsDictionary.Activity = (float?)item.DetectionActivity;
                                    DetectionMenulistTemp.Remove(item);
                                    standardOperationsDictionaryDetectionDeleteList.Add(standardOperationsDictionary);
                                }
                            var tempDetectionMenulist = DetectionMenulistTemp.ToList();
                            foreach (ERMSOPDetection itemRemove in tempDetectionMenulist)
                            {
                                if (GetStages.Any(a => a.Code.Equals(itemRemove.Name)))
                                {
                                    List<ERMSOPDetection> childList = DetectionMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(itemRemove.KeyName)).ToList();
                                    if (childList.Count == 0)
                                    {
                                        DetectionMenulistTemp.Remove(itemRemove);
                                    }
                                }

                            }
                        }
                        #endregion
                        DetectionMenulist = new ObservableCollection<ERMSOPDetection>();
                        DetectionMenulist = DetectionMenulistTemp;
                    }
                    CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("WorkOperationDeletedSuccess").ToString()), Application.Current.Resources["PopUpSuccessColor"].ToString(), CustomMessageBox.MessageImagePath.Ok, MessageBoxButton.OK);
                }
                GeosApplication.Instance.Logger.Log("Method DeleteDetectionTreeListControlCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in DeleteDetectionTreeListControlCommandAction() Method " + ex.Detail.ErrorMessage, category: Category.Info, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in DeleteDetectionTreeListControlCommandAction() Method - ServiceUnexceptedException " + ex.Message, category: Category.Info, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method DeleteModuleTreeListControlCommandAction()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        TreeListControl DetectiontreeListControlInstance;
        private void DetectionTreeListViewLoadedCommandAction(RoutedEventArgs obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method DetectionTreeListViewLoadedCommandAction ...", category: Category.Info, priority: Priority.Low);

                DetectiontreeListControlInstance = (TreeListControl)((DevExpress.Xpf.Grid.TreeListView)obj.OriginalSource).DataControl;

                GeosApplication.Instance.Logger.Log("Method DetectionTreeListViewLoadedCommandAction() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in DetectionTreeListViewLoadedCommandAction() Method " + ex.Message, category: Category.Info, priority: Priority.Low);
            }
        }

        private void DetectionCustomSummaryCommandAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method DetectionCustomSummaryCommandAction()...", category: Category.Info, priority: Priority.Low);

                TreeListCustomSummaryEventArgs e = (TreeListCustomSummaryEventArgs)obj;
                if (e.SummaryItem.FieldName == "DetectionObservedTime")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPDetection temp = (ERMSOPDetection)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                if (e.TotalValue != null)
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                            }

                        }

                    }
                }
                #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                if (e.SummaryItem.FieldName == "UITempDetectionobservedTime")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {

                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPDetection temp = (ERMSOPDetection)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                //e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);

                                #region Time changes 28 11 2022
                                TimeSpan temp3 = TimeSpan.Parse(e.FieldValue.ToString());
                                double TempFieldValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.FieldValue)))
                                {
                                    TempFieldValue = 0;
                                }
                                else
                                {
                                    TempFieldValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.FieldValue)).TotalMinutes);
                                }

                                double TempTotalValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.TotalValue)))
                                {
                                    TempTotalValue = 0;
                                }
                                else
                                {
                                    TempTotalValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.TotalValue)).TotalMinutes);
                                }

                                e.TotalValue = TempTotalValue + TempFieldValue;
                                if (e.TotalValue != null)
                                {
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    e.TotalValue = ConvertfloattoTimespan(Convert.ToString(e.TotalValue));

                                    #endregion

                                }
                                #endregion


                            }
                        }

                    }
                }
                if (e.SummaryItem.FieldName == "UITempDetectionNormalTime")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPDetection temp = (ERMSOPDetection)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                //e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                //if (e.TotalValue != null)
                                //    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);


                                #region Time changes 28 11 2022
                                TimeSpan temp3 = TimeSpan.Parse(e.FieldValue.ToString());
                                double TempFieldValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.FieldValue)))
                                {
                                    TempFieldValue = 0;
                                }
                                else
                                {
                                    TempFieldValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.FieldValue)).TotalMinutes);
                                }

                                double TempTotalValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.TotalValue)))
                                {
                                    TempTotalValue = 0;
                                }
                                else
                                {
                                    TempTotalValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.TotalValue)).TotalMinutes);
                                }

                                e.TotalValue = TempTotalValue + TempFieldValue;
                                if (e.TotalValue != null)
                                {
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    e.TotalValue = ConvertfloattoTimespan(Convert.ToString(e.TotalValue));

                                    #endregion

                                }
                                #endregion
                            }

                        }

                    }
                }
                #endregion
                if (e.SummaryItem.FieldName == "DetectionNormalTime")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPDetection temp = (ERMSOPDetection)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                if (e.TotalValue != null)
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                            }

                        }

                    }
                }

                if (e.SummaryItem.FieldName == "DetectionStandardOperationTime")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPDetection temp = (ERMSOPDetection)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                if (e.TotalValue != null)
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                            }

                        }

                    }
                }
                if (e.SummaryItem.FieldName == "DetectionOperationTimePlant1Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPDetection temp = (ERMSOPDetection)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                if (e.TotalValue != null)
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                            }

                        }

                    }
                }


                if (e.SummaryItem.FieldName == "DetectionOperationTimePlant2Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPDetection temp = (ERMSOPDetection)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {

                                e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                if (e.TotalValue != null)
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                            }

                        }

                    }
                }


                if (e.SummaryItem.FieldName == "DetectionOperationTimePlant3Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPDetection temp = (ERMSOPDetection)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {

                                e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                if (e.TotalValue != null)
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                            }

                        }

                    }
                }

                if (e.SummaryItem.FieldName == "DetectionOperationTimePlant4Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPDetection temp = (ERMSOPDetection)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {

                                e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                if (e.TotalValue != null)
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                            }

                        }

                    }
                }

                if (e.SummaryItem.FieldName == "DetectionOperationTimePlant5Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPDetection temp = (ERMSOPDetection)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {

                                e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                if (e.TotalValue != null)
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                            }

                        }

                    }
                }

                #region GEOS2-3954 Show the WorkOperations and SOD Time in the format: MM:SS or HH:MM:SS
                if (e.SummaryItem.FieldName == "UiTempDetectionStandardOperationTimeName")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {

                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPDetection temp = (ERMSOPDetection)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {

                                #region Time changes 28 11 2022
                                TimeSpan temp3 = TimeSpan.Parse(e.FieldValue.ToString());
                                double TempFieldValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.FieldValue)))
                                {
                                    TempFieldValue = 0;
                                }
                                else
                                {
                                    TempFieldValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.FieldValue)).TotalMinutes);
                                }

                                double TempTotalValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.TotalValue)))
                                {
                                    TempTotalValue = 0;
                                }
                                else
                                {
                                    TempTotalValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.TotalValue)).TotalMinutes);
                                }

                                e.TotalValue = TempTotalValue + TempFieldValue;
                                if (e.TotalValue != null)
                                {
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    e.TotalValue = ConvertfloattoTimespan(Convert.ToString(e.TotalValue));

                                    #endregion

                                }
                                #endregion
                            }
                        }

                    }
                }


                if (e.SummaryItem.FieldName == "UiTempDetectionOperationTimePlant1Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPDetection temp = (ERMSOPDetection)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {

                                #region Time changes 28 11 2022
                                TimeSpan temp3 = TimeSpan.Parse(e.FieldValue.ToString());
                                double TempFieldValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.FieldValue)))
                                {
                                    TempFieldValue = 0;
                                }
                                else
                                {
                                    TempFieldValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.FieldValue)).TotalMinutes);
                                }

                                double TempTotalValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.TotalValue)))
                                {
                                    TempTotalValue = 0;
                                }
                                else
                                {
                                    TempTotalValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.TotalValue)).TotalMinutes);
                                }

                                e.TotalValue = TempTotalValue + TempFieldValue;
                                if (e.TotalValue != null)
                                {
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    e.TotalValue = ConvertfloattoTimespan(Convert.ToString(e.TotalValue));

                                    #endregion

                                }
                                #endregion
                            }

                        }
                    }
                }
                if (e.SummaryItem.FieldName == "UiTempDetectionOperationTimePlant2Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPDetection temp = (ERMSOPDetection)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {

                                #region Time changes 28 11 2022
                                TimeSpan temp3 = TimeSpan.Parse(e.FieldValue.ToString());
                                double TempFieldValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.FieldValue)))
                                {
                                    TempFieldValue = 0;
                                }
                                else
                                {
                                    TempFieldValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.FieldValue)).TotalMinutes);
                                }

                                double TempTotalValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.TotalValue)))
                                {
                                    TempTotalValue = 0;
                                }
                                else
                                {
                                    TempTotalValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.TotalValue)).TotalMinutes);
                                }

                                e.TotalValue = TempTotalValue + TempFieldValue;
                                if (e.TotalValue != null)
                                {
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    e.TotalValue = ConvertfloattoTimespan(Convert.ToString(e.TotalValue));

                                    #endregion

                                }
                                #endregion
                            }

                        }

                    }
                }
                if (e.SummaryItem.FieldName == "UiTempDetectionOperationTimePlant3Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPDetection temp = (ERMSOPDetection)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {

                                #region Time changes 28 11 2022
                                TimeSpan temp3 = TimeSpan.Parse(e.FieldValue.ToString());
                                double TempFieldValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.FieldValue)))
                                {
                                    TempFieldValue = 0;
                                }
                                else
                                {
                                    TempFieldValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.FieldValue)).TotalMinutes);
                                }

                                double TempTotalValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.TotalValue)))
                                {
                                    TempTotalValue = 0;
                                }
                                else
                                {
                                    TempTotalValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.TotalValue)).TotalMinutes);
                                }

                                e.TotalValue = TempTotalValue + TempFieldValue;
                                if (e.TotalValue != null)
                                {
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    e.TotalValue = ConvertfloattoTimespan(Convert.ToString(e.TotalValue));

                                    #endregion

                                }
                                #endregion
                            }

                        }

                    }
                }
                if (e.SummaryItem.FieldName == "UiTempDetectionOperationTimePlant4Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPDetection temp = (ERMSOPDetection)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {

                                #region Time changes 28 11 2022
                                TimeSpan temp3 = TimeSpan.Parse(e.FieldValue.ToString());
                                double TempFieldValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.FieldValue)))
                                {
                                    TempFieldValue = 0;
                                }
                                else
                                {
                                    TempFieldValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.FieldValue)).TotalMinutes);
                                }

                                double TempTotalValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.TotalValue)))
                                {
                                    TempTotalValue = 0;
                                }
                                else
                                {
                                    TempTotalValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.TotalValue)).TotalMinutes);
                                }

                                e.TotalValue = TempTotalValue + TempFieldValue;
                                if (e.TotalValue != null)
                                {
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    e.TotalValue = ConvertfloattoTimespan(Convert.ToString(e.TotalValue));

                                    #endregion

                                }
                                #endregion
                            }

                        }
                    }
                }

                if (e.SummaryItem.FieldName == "UiTempDetectionOperationTimePlant5Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPDetection temp = (ERMSOPDetection)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {

                                #region Time changes 28 11 2022
                                TimeSpan temp3 = TimeSpan.Parse(e.FieldValue.ToString());
                                double TempFieldValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.FieldValue)))
                                {
                                    TempFieldValue = 0;
                                }
                                else
                                {
                                    TempFieldValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.FieldValue)).TotalMinutes);
                                }

                                double TempTotalValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.TotalValue)))
                                {
                                    TempTotalValue = 0;
                                }
                                else
                                {
                                    TempTotalValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.TotalValue)).TotalMinutes);
                                }

                                e.TotalValue = TempTotalValue + TempFieldValue;
                                if (e.TotalValue != null)
                                {
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    e.TotalValue = ConvertfloattoTimespan(Convert.ToString(e.TotalValue));

                                    #endregion

                                }
                                #endregion
                            }

                        }
                    }
                }
                #endregion

                GeosApplication.Instance.Logger.Log("Method DetectionCustomSummaryCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {

                GeosApplication.Instance.Logger.Log(string.Format("Error in method DetectionCustomSummaryCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

            }
        }
        #endregion

        #region GEOS2-3665
        private void OnDragRecordOverWaysGrid(DragRecordOverEventArgs e)
        {
            try
            {

                GeosApplication.Instance.Logger.Log("Method OnDragRecordOverWaysGrid()...", category: Category.Info, priority: Priority.Low);
                #region Rajashri
                //Rajshri [Geos2-5629]
                Int64 targetParentid = 0;
                Int64 idparentValue = 0;
                int TempCount = 0;//[GEOS2-5629][gulab lakade][16 07 2024]
                DevExpress.Xpf.Grid.TreeListView TempWayTree = (DevExpress.Xpf.Grid.TreeListView)e.Source;
                DevExpress.Xpf.Grid.TreeListControl TempNode = (DevExpress.Xpf.Grid.TreeListControl)TempWayTree.Parent;

                var currentItem = TempNode.CurrentItem as Emdep.Geos.Data.Common.ERM.ERMSOPWays;
                if (currentItem != null)
                {
                    idparentValue = Convert.ToInt64(currentItem.IdParent);
                    TempCount = WaysMenulist.Where(x => x.ParentName == currentItem.KeyName).ToList().Count();//[GEOS2-5629][gulab lakade][16 07 2024]
                }
                var targetrecord = e.TargetRecord as Emdep.Geos.Data.Common.ERM.ERMSOPWays;
                if (targetrecord != null)
                {
                    targetParentid = Convert.ToInt64(targetrecord.IdParent);
                }
                #endregion
                if ((e.IsFromOutside) && typeof(WorkOperationByStages).IsAssignableFrom(e.GetRecordType()))
                {
                    e.Effects = DragDropEffects.Copy;
                    e.Handled = true;
                }
                #region Aishwarya
                else if ((e.IsFromOutside) && typeof(ERMSOPWays).IsAssignableFrom(e.GetRecordType()))
                {
                    e.Effects = DragDropEffects.Copy;
                    e.Handled = true;
                    IsEnabled = true;
                }
                else if ((e.IsFromOutside) && typeof(ERMSOPWays).IsAssignableFrom(e.GetRecordType()) && e.TargetRecord == null)
                {
                    e.Effects = DragDropEffects.Copy;
                    e.Handled = true;
                }
                else if (e.DropPosition == DropPosition.Inside && typeof(ERMSOPWays).IsAssignableFrom(e.GetRecordType()))
                {
                    e.Effects = DragDropEffects.None;
                    e.Handled = false;
                }
                else if (typeof(ERMSOPWays).IsAssignableFrom(e.GetRecordType()) && (e.DropPosition == DropPosition.Before || e.DropPosition == DropPosition.After))
                {


                    #region Rajashri
                    if (idparentValue == targetParentid)
                    {
                        // start [GEOS2-5629][gulab lakade][16 07 2024]
                        if (TempCount == 0)
                        {
                            e.Effects = DragDropEffects.Move;
                            e.Handled = true;
                            IsModulesequence = true;
                        }
                        else
                        {
                            e.Effects = DragDropEffects.None;
                            e.Handled = false;
                        }
                        //end [GEOS2-5629][gulab lakade][16 07 2024]
                    }
                    else
                    {
                        e.Effects = DragDropEffects.None;
                        e.Handled = false;
                    }
                    #endregion
                }
                #endregion

                GeosApplication.Instance.Logger.Log("Method OnDragRecordOverWaysGrid()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method OnDragRecordOverModuleGrid()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }

        }
        private void DropRecordWaysGrid(DropRecordEventArgs e)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method DropRecordWaysGrid()...", category: Category.Info, priority: Priority.Low);

                if ((e.IsFromOutside) && e.TargetRecord != null && typeof(WorkOperationByStages).IsAssignableFrom(e.GetRecordType()))
                {
                    e.Effects = DragDropEffects.Copy;
                    CompleteDropRecorWayGrid(e);
                    e.Handled = true;
                }
                else if ((e.IsFromOutside) && typeof(WorkOperationByStages).IsAssignableFrom(e.GetRecordType()) && e.TargetRecord == null)
                {
                    e.Effects = DragDropEffects.Copy;
                    CompleteDropRecorWayGrid(e);
                    e.Handled = true;
                }
                else if (e.DropPosition == DropPosition.Inside && typeof(WorkOperationByStages).IsAssignableFrom(e.GetRecordType()))
                {
                    e.Effects = DragDropEffects.None;
                    e.Handled = false;
                }
                else if (typeof(WorkOperationByStages).IsAssignableFrom(e.GetRecordType()) && (e.DropPosition == DropPosition.Before || e.DropPosition == DropPosition.After))
                {
                    e.Effects = DragDropEffects.Move;
                    e.Handled = false;
                }
                else if (typeof(ERMSOPWays).IsAssignableFrom(e.GetRecordType()) && (e.DropPosition == DropPosition.Before || e.DropPosition == DropPosition.After))
                {
                    var tragetPosition_var = e.TargetRecord.GetType().GetProperty("WayPosition").GetValue(e.TargetRecord);
                    DevExpress.Xpf.Grid.TreeListView originsource = (DevExpress.Xpf.Grid.TreeListView)e.OriginalSource;
                    var WPosition_var = (originsource.FocusedRow.GetType().GetProperty("WayPosition").GetValue(originsource.FocusedRow));
                    UInt32 WPosition = Convert.ToUInt32(WPosition_var);
                    UInt32 tragetPosition = Convert.ToUInt32(tragetPosition_var);
                    var TempTargetKeyName = e.TargetRecord.GetType().GetProperty("KeyName").GetValue(e.TargetRecord);//[GEOS2-5629][gulab lakade][16 07 2024]
                    var TempChangeKeyName = (originsource.FocusedRow.GetType().GetProperty("KeyName").GetValue(originsource.FocusedRow));//[GEOS2-5629][gulab lakade][16 07 2024]
                    string TargetKeyName = Convert.ToString(TempTargetKeyName);//[GEOS2-5629][gulab lakade][16 07 2024]
                    string ChangeKeyName = Convert.ToString(TempChangeKeyName);//[GEOS2-5629][gulab lakade][16 07 2024]
                    if (e.DropPosition == DropPosition.Before)
                    {

                        var TempChangesrecord = WaysMenulist.Where(x => x.WayPosition == WPosition && x.KeyName == ChangeKeyName).FirstOrDefault();

                        var TempBeforerecord = WaysMenulist.Where(x => x.WayPosition == tragetPosition && x.KeyName == TargetKeyName).FirstOrDefault();
                        if (tragetPosition < WPosition)
                        {
                            UInt32 pos = Convert.ToUInt32(tragetPosition);
                            foreach (var update in WaysMenulist.Where(x => x.WayPosition >= tragetPosition).OrderBy(a => a.WayPosition).ToList())
                            {
                                //start[GEOS2-5629][gulab lakade][16 07 2024]
                                int TempCount = 0;
                                TempCount = WaysMenulist.Where(x => x.ParentName == update.KeyName).ToList().Count();//[GEOS2-5629][gulab lakade][16 07 2024]
                                if (TempCount == 0)
                                {
                                    if (update.IdworkOperationByStage == TempChangesrecord.IdworkOperationByStage)
                                    {
                                        update.WayPosition = Convert.ToUInt32(tragetPosition);
                                        // break;
                                    }
                                    else
                                    {
                                        if (Convert.ToUInt32(tragetPosition) == Convert.ToUInt32(pos))
                                        {
                                            pos++;
                                        }
                                        update.WayPosition = pos;
                                        pos++;
                                    }
                                }
                                //end[GEOS2-5629][gulab lakade][16 07 2024]

                            }
                        }
                        else
                        {
                            UInt32 pos = Convert.ToUInt32(WPosition);

                            foreach (var update in WaysMenulist.Where(x => x.WayPosition >= WPosition).OrderBy(a => a.WayPosition).ToList())
                            {
                                //start[GEOS2-5629][gulab lakade][16 07 2024]
                                int TempCount = 0;
                                TempCount = WaysMenulist.Where(x => x.ParentName == update.KeyName).ToList().Count();//[GEOS2-5629][gulab lakade][16 07 2024]
                                if (TempCount == 0)
                                {
                                    if (update.IdworkOperationByStage == TempChangesrecord.IdworkOperationByStage)
                                    {
                                        update.WayPosition = Convert.ToUInt32(tragetPosition - 1);
                                        // break;
                                    }
                                    else
                                    {
                                        if (pos == 0)
                                        {
                                            pos = 1;
                                        }
                                        if (pos == Convert.ToUInt32(tragetPosition - 1))
                                        {
                                            pos++;
                                        }
                                        update.WayPosition = pos;
                                        pos++;
                                    }
                                }
                                //end[GEOS2-5629][gulab lakade][16 07 2024]

                            }
                        }



                    }
                    else if (e.DropPosition == DropPosition.After)
                    {
                        var TempChangesrecord = WaysMenulist.Where(x => x.WayPosition == WPosition && x.KeyName == ChangeKeyName).FirstOrDefault();

                        var TempBeforerecord = WaysMenulist.Where(x => x.WayPosition == tragetPosition && x.KeyName == TargetKeyName).FirstOrDefault();
                        if (tragetPosition < WPosition)
                        {
                            UInt32 pos = Convert.ToUInt32(tragetPosition);
                            foreach (var update in WaysMenulist.Where(x => x.WayPosition >= tragetPosition).OrderBy(a => a.WayPosition).ToList())
                            {
                                //start[GEOS2-5629][gulab lakade][16 07 2024]
                                int TempCount = 0;
                                TempCount = WaysMenulist.Where(x => x.ParentName == update.KeyName).ToList().Count();//[GEOS2-5629][gulab lakade][16 07 2024]
                                if (TempCount == 0)
                                {
                                    if (update.IdworkOperationByStage == TempChangesrecord.IdworkOperationByStage)
                                    {
                                        update.WayPosition = Convert.ToUInt32(tragetPosition);
                                        //break;
                                    }
                                    else
                                    {
                                        if (Convert.ToUInt32(tragetPosition) == Convert.ToUInt32(pos))
                                        {
                                            pos++;
                                        }
                                        update.WayPosition = pos;
                                        pos++;
                                    }
                                }
                                //end[GEOS2-5629][gulab lakade][16 07 2024]
                            }
                        }
                        else
                        {

                            UInt32 pos = Convert.ToUInt32(WPosition);
                            foreach (var update in WaysMenulist.Where(x => x.WayPosition >= WPosition).OrderBy(a => a.WayPosition).ToList())
                            {
                                //start[GEOS2-5629][gulab lakade][16 07 2024]
                                int TempCount = 0;
                                TempCount = WaysMenulist.Where(x => x.ParentName == update.KeyName).ToList().Count();//[GEOS2-5629][gulab lakade][16 07 2024]
                                if (TempCount == 0)
                                {
                                    if (update.IdworkOperationByStage == TempChangesrecord.IdworkOperationByStage)
                                    {
                                        update.WayPosition = Convert.ToUInt32(tragetPosition);
                                        //break;
                                    }
                                    else
                                    {
                                        if (pos == 0)
                                        {
                                            pos = 1;
                                        }
                                        if (pos == Convert.ToUInt32(tragetPosition))
                                        {
                                            pos++;
                                        }
                                        update.WayPosition = pos;
                                        pos++;
                                    }
                                }
                                //end[GEOS2-5629][gulab lakade][16 07 2024]
                            }
                        }
                    }

                    var TmpWay = WaysMenulist.OrderBy(a => a.WayPosition).ToList();
                    WaysMenulist = new ObservableCollection<ERMSOPWays>(TmpWay);
                    e.Effects = DragDropEffects.Move;
                    e.Handled = true;
                    IsModulesequence = true;
                }
                // CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("SODDropRecordMessage").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);

                GeosApplication.Instance.Logger.Log("Method DropRecordWaysGrid()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method DropRecordWaysGrid()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }

        }
        private void CompleteRecordDragDropWaysGrid(CompleteRecordDragDropEventArgs e)
        {
            e.Handled = true;
            IsModulesequence = false;
            IsEnabledSaveButton = true;
            // e.Handled = true;
            //FillmoduleGridColumn();
            int wocount = WorkOperationMenulist.ToList().Count();
        }
        #endregion

        #region GEOS2-3664
        private void OnDragRecordOverOptionsGrid(DragRecordOverEventArgs e)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method OnDragRecordOverOptionsGrid()...", category: Category.Info, priority: Priority.Low);
                #region Rajashri
                //Rajshri [Geos2-5629]
                Int64 targetParentid = 0;
                Int64 idparentValue = 0;
                int TempCount = 0;//[GEOS2-5629][gulab lakade][16 07 2024]
                DevExpress.Xpf.Grid.TreeListView TempWayTree = (DevExpress.Xpf.Grid.TreeListView)e.Source;
                DevExpress.Xpf.Grid.TreeListControl TempNode = (DevExpress.Xpf.Grid.TreeListControl)TempWayTree.Parent;

                var currentItem = TempNode.CurrentItem as Emdep.Geos.Data.Common.ERM.ERMSOPOptions;
                if (currentItem != null)
                {
                    idparentValue = Convert.ToInt64(currentItem.IdParent);
                    TempCount = OptionsMenulist.Where(x => x.ParentName == currentItem.KeyName).ToList().Count();//[GEOS2-5629][gulab lakade][16 07 2024]
                }
                var targetrecord = e.TargetRecord as Emdep.Geos.Data.Common.ERM.ERMSOPOptions;
                if (targetrecord != null)
                {
                    targetParentid = Convert.ToInt64(targetrecord.IdParent);
                }
                #endregion
                if ((e.IsFromOutside) && typeof(WorkOperationByStages).IsAssignableFrom(e.GetRecordType()))
                {
                    e.Effects = DragDropEffects.Copy;
                    e.Handled = true;
                }
                #region Aishwarya
                else if ((e.IsFromOutside) && typeof(ERMSOPOptions).IsAssignableFrom(e.GetRecordType()))
                {
                    e.Effects = DragDropEffects.Copy;
                    e.Handled = true;
                    IsEnabled = true;
                }
                else if ((e.IsFromOutside) && typeof(ERMSOPOptions).IsAssignableFrom(e.GetRecordType()) && e.TargetRecord == null)
                {
                    e.Effects = DragDropEffects.Copy;
                    e.Handled = true;
                }
                else if (e.DropPosition == DropPosition.Inside && typeof(ERMSOPOptions).IsAssignableFrom(e.GetRecordType()))
                {
                    e.Effects = DragDropEffects.None;
                    e.Handled = false;
                }
                else if (typeof(ERMSOPOptions).IsAssignableFrom(e.GetRecordType()) && (e.DropPosition == DropPosition.Before || e.DropPosition == DropPosition.After))
                {


                    #region Rajashri
                    if (idparentValue == targetParentid)
                    {
                        // start [GEOS2-5629][gulab lakade][16 07 2024]
                        if (TempCount == 0)
                        {
                            e.Effects = DragDropEffects.Move;
                            e.Handled = true;
                            IsModulesequence = true;
                        }
                        else
                        {
                            e.Effects = DragDropEffects.None;
                            e.Handled = false;
                        }
                        //end [GEOS2-5629][gulab lakade][16 07 2024]
                    }
                    else
                    {
                        e.Effects = DragDropEffects.None;
                        e.Handled = false;
                    }
                    #endregion
                }
                #endregion
                GeosApplication.Instance.Logger.Log("Method OnDragRecordOverOptionsGrid()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method OnDragRecordOverModuleGrid()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }

        }
        private void DropRecordOptionsGrid(DropRecordEventArgs e)
        {
            try
            {

                GeosApplication.Instance.Logger.Log("Method DropRecordOptionsGrid()...", category: Category.Info, priority: Priority.Low);

                if ((e.IsFromOutside) && e.TargetRecord != null && typeof(WorkOperationByStages).IsAssignableFrom(e.GetRecordType()))
                {
                    e.Effects = DragDropEffects.Copy;
                    CompleteDropRecorOptionGrid(e);
                    e.Handled = true;
                }
                else if ((e.IsFromOutside) && typeof(WorkOperationByStages).IsAssignableFrom(e.GetRecordType()) && e.TargetRecord == null)
                {
                    e.Effects = DragDropEffects.Copy;
                    CompleteDropRecorOptionGrid(e);
                    e.Handled = true;
                }
                else if (e.DropPosition == DropPosition.Inside && typeof(WorkOperationByStages).IsAssignableFrom(e.GetRecordType()))
                {
                    e.Effects = DragDropEffects.None;
                    e.Handled = false;
                }
                else if (typeof(WorkOperationByStages).IsAssignableFrom(e.GetRecordType()) && (e.DropPosition == DropPosition.Before || e.DropPosition == DropPosition.After))
                {
                    e.Effects = DragDropEffects.Move;
                    e.Handled = false;
                }

                else if (typeof(ERMSOPOptions).IsAssignableFrom(e.GetRecordType()) && (e.DropPosition == DropPosition.Before || e.DropPosition == DropPosition.After))
                {
                    var tragetPosition_var = e.TargetRecord.GetType().GetProperty("OptionPosition").GetValue(e.TargetRecord);
                    DevExpress.Xpf.Grid.TreeListView originsource = (DevExpress.Xpf.Grid.TreeListView)e.OriginalSource;
                    var OPosition_var = (originsource.FocusedRow.GetType().GetProperty("OptionPosition").GetValue(originsource.FocusedRow));
                    UInt32 OPosition = Convert.ToUInt32(OPosition_var);
                    UInt32 tragetPosition = Convert.ToUInt32(tragetPosition_var);
                    var TempTargetKeyName = e.TargetRecord.GetType().GetProperty("KeyName").GetValue(e.TargetRecord);//[GEOS2-5629][gulab lakade][16 07 2024]
                    var TempChangeKeyName = (originsource.FocusedRow.GetType().GetProperty("KeyName").GetValue(originsource.FocusedRow));//[GEOS2-5629][gulab lakade][16 07 2024]
                    string TargetKeyName = Convert.ToString(TempTargetKeyName);//[GEOS2-5629][gulab lakade][16 07 2024]
                    string ChangeKeyName = Convert.ToString(TempChangeKeyName);//[GEOS2-5629][gulab lakade][16 07 2024]
                    if (e.DropPosition == DropPosition.Before)
                    {

                        var TempChangesrecord = OptionsMenulist.Where(x => x.OptionPosition == OPosition && x.KeyName == ChangeKeyName).FirstOrDefault();

                        var TempBeforerecord = OptionsMenulist.Where(x => x.OptionPosition == tragetPosition && x.KeyName == TargetKeyName).FirstOrDefault();
                        if (tragetPosition < OPosition)
                        {
                            UInt32 pos = Convert.ToUInt32(tragetPosition);
                            foreach (var update in OptionsMenulist.Where(x => x.OptionPosition >= tragetPosition).OrderBy(a => a.OptionPosition).ToList())
                            {
                                //start[GEOS2-5629][gulab lakade][16 07 2024]
                                int TempCount = 0;
                                TempCount = OptionsMenulist.Where(x => x.ParentName == update.KeyName).ToList().Count();//[GEOS2-5629][gulab lakade][16 07 2024]
                                if (TempCount == 0)
                                {
                                    if (update.IdworkOperationByStage == TempChangesrecord.IdworkOperationByStage)
                                    {
                                        update.OptionPosition = Convert.ToUInt32(tragetPosition);
                                        // break;
                                    }
                                    else
                                    {
                                        if (Convert.ToUInt32(tragetPosition) == Convert.ToUInt32(pos))
                                        {
                                            pos++;
                                        }
                                        update.OptionPosition = pos;
                                        pos++;
                                    }
                                }
                                //end[GEOS2-5629][gulab lakade][16 07 2024]

                            }
                        }
                        else
                        {
                            UInt32 pos = Convert.ToUInt32(OPosition);

                            foreach (var update in OptionsMenulist.Where(x => x.OptionPosition >= OPosition).OrderBy(a => a.OptionPosition).ToList())
                            {
                                //start[GEOS2-5629][gulab lakade][16 07 2024]
                                int TempCount = 0;
                                TempCount = OptionsMenulist.Where(x => x.ParentName == update.KeyName).ToList().Count();//[GEOS2-5629][gulab lakade][16 07 2024]
                                if (TempCount == 0)
                                {
                                    if (update.IdworkOperationByStage == TempChangesrecord.IdworkOperationByStage)
                                    {
                                        update.OptionPosition = Convert.ToUInt32(tragetPosition - 1);
                                        // break;
                                    }
                                    else
                                    {
                                        if (pos == 0)
                                        {
                                            pos = 1;
                                        }
                                        if (pos == Convert.ToUInt32(tragetPosition - 1))
                                        {
                                            pos++;
                                        }
                                        update.OptionPosition = pos;
                                        pos++;
                                    }
                                }
                                //end[GEOS2-5629][gulab lakade][16 07 2024]

                            }
                        }



                    }
                    else if (e.DropPosition == DropPosition.After)
                    {
                        var TempChangesrecord = OptionsMenulist.Where(x => x.OptionPosition == OPosition && x.KeyName == ChangeKeyName).FirstOrDefault();

                        var TempBeforerecord = OptionsMenulist.Where(x => x.OptionPosition == tragetPosition && x.KeyName == TargetKeyName).FirstOrDefault();
                        if (tragetPosition < OPosition)
                        {
                            UInt32 pos = Convert.ToUInt32(tragetPosition);
                            foreach (var update in OptionsMenulist.Where(x => x.OptionPosition >= tragetPosition).OrderBy(a => a.OptionPosition).ToList())
                            {
                                //start[GEOS2-5629][gulab lakade][16 07 2024]
                                int TempCount = 0;
                                TempCount = OptionsMenulist.Where(x => x.ParentName == update.KeyName).ToList().Count();//[GEOS2-5629][gulab lakade][16 07 2024]
                                if (TempCount == 0)
                                {
                                    if (update.IdworkOperationByStage == TempChangesrecord.IdworkOperationByStage)
                                    {
                                        update.OptionPosition = Convert.ToUInt32(tragetPosition);
                                        //break;
                                    }
                                    else
                                    {
                                        if (Convert.ToUInt32(tragetPosition) == Convert.ToUInt32(pos))
                                        {
                                            pos++;
                                        }
                                        update.OptionPosition = pos;
                                        pos++;
                                    }
                                }
                                //end[GEOS2-5629][gulab lakade][16 07 2024]
                            }
                        }
                        else
                        {

                            UInt32 pos = Convert.ToUInt32(OPosition);
                            foreach (var update in OptionsMenulist.Where(x => x.OptionPosition >= OPosition).OrderBy(a => a.OptionPosition).ToList())
                            {
                                //start[GEOS2-5629][gulab lakade][16 07 2024]
                                int TempCount = 0;
                                TempCount = OptionsMenulist.Where(x => x.ParentName == update.KeyName).ToList().Count();//[GEOS2-5629][gulab lakade][16 07 2024]
                                if (TempCount == 0)
                                {
                                    if (update.IdworkOperationByStage == TempChangesrecord.IdworkOperationByStage)
                                    {
                                        update.OptionPosition = Convert.ToUInt32(tragetPosition);
                                        //break;
                                    }
                                    else
                                    {
                                        if (pos == 0)
                                        {
                                            pos = 1;
                                        }
                                        if (pos == Convert.ToUInt32(tragetPosition))
                                        {
                                            pos++;
                                        }
                                        update.OptionPosition = pos;
                                        pos++;
                                    }
                                }
                                //end[GEOS2-5629][gulab lakade][16 07 2024]

                            }
                        }
                    }

                    var TmpPosition = OptionsMenulist.OrderBy(a => a.OptionPosition).ToList();
                    OptionsMenulist = new ObservableCollection<ERMSOPOptions>(TmpPosition);
                    e.Effects = DragDropEffects.Move;
                    e.Handled = true;
                    IsModulesequence = true;
                }
                // CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("SODDropRecordMessage").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                GeosApplication.Instance.Logger.Log("Method DropRecordOptionsGrid()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method DropRecordOptionsGrid()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }

        }
        private void CompleteRecordDragDropOptionsGrid(CompleteRecordDragDropEventArgs e)
        {
            e.Handled = true;
            IsModulesequence = false;
            IsEnabledSaveButton = true;
            // e.Handled = true;
            //FillmoduleGridColumn();
            int wocount = WorkOperationMenulist.ToList().Count();
        }
        #endregion
        #region GEOS2-3837
        /// <summary>
        /// /gulab lakade 27 07 2022
        /// </summary>
        /// <param name="sender"></param>



        private Visibility isAccordionControlVisibleOptions;
        public Visibility IsAccordionControlVisibleOptions
        {
            get { return isAccordionControlVisibleOptions; }
            set
            {
                isAccordionControlVisibleOptions = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsAccordionControlVisibleOptions"));
            }
        }

        private List<ERMOptionsGroups> optionsGroups;
        public List<ERMOptionsGroups> OptionsGroups
        {
            get { return optionsGroups; }
            set
            {
                optionsGroups = value;
                OnPropertyChanged(new PropertyChangedEventArgs("OptionsGroups"));
            }
        }

        private object selectedItemOldOption;
        public virtual object SelectedItemOldOption
        {
            get { return selectedItemOldOption; }
            set
            {
                selectedItemOldOption = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedItemOldOption"));
            }
        }

        private object selectedItemOption;
        public virtual object SelectedItemOption
        {
            get { return selectedItemOption; }
            set
            {
                selectedItemOption = value;
                #region [GEOS2-4830][gulab lakade][07 12 2023]
                if (selectedItemOption != null)
                {
                    //    string tempobj = Convert.ToString(selectedItemOption);
                    //    var temp = OptionsGroups.Where(x => tempobj.Contains(x.Name)).ToList();
                    //    if(temp.Count()==0)
                    //    {
                    RetrieveWorkOperationsByOption();
                    //    }

                }
                #endregion
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedItemOption"));
            }
        }
        ObservableCollection<DetectionGroupWithOptions> detectionGroupWithOptions;
        public ObservableCollection<DetectionGroupWithOptions> DetectionGroupWithOptions
        {
            get { return detectionGroupWithOptions; }
            set
            {
                detectionGroupWithOptions = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DetectionGroupWithOptions"));
            }
        }

        private object selectedItemOldcloneOption;
        public virtual object SelectedItemOldcloneOption
        {
            get { return selectedItemOldcloneOption; }
            set
            {
                selectedItemOldcloneOption = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedItemOldcloneOption"));
            }
        }

        ObservableCollection<ERMSOPOptions> optionsMenulist;
        public ObservableCollection<ERMSOPOptions> OptionsMenulist
        {
            get { return optionsMenulist; }
            set
            {
                optionsMenulist = value;
                OnPropertyChanged(new PropertyChangedEventArgs("OptionsMenulist"));
            }
        }

        ERMSOPOptions selectedOptionsMenuItem;
        public ERMSOPOptions SelectedOptionsMenuItem
        {
            get { return selectedOptionsMenuItem; }
            set
            {
                selectedOptionsMenuItem = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedOptionsMenuItem"));
            }
        }



        ObservableCollection<ERMSOPOptions> optionMenulistCloned;
        public ObservableCollection<ERMSOPOptions> OptionMenulistCloned
        {
            get { return optionMenulistCloned; }
            set
            {
                optionMenulistCloned = value;
                OnPropertyChanged(new PropertyChangedEventArgs("OptionMenulistCloned"));
            }
        }
        ObservableCollection<WorkOperationByStages> operationMenuOptionlistCloned = new ObservableCollection<WorkOperationByStages>();

        private WorkOperationByStages selectedOptionWorkOperationMenulist;
        public WorkOperationByStages SelectedOptionWorkOperationMenulist
        {
            get { return selectedOptionWorkOperationMenulist; }
            set
            {
                selectedOptionWorkOperationMenulist = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedOptionWorkOperationMenulist"));
            }

        }
        private ObservableCollection<WorkOperationByStages> workOperationOptionMenulist;
        public ObservableCollection<WorkOperationByStages> WorkOperationOptionMenulist
        {
            get
            {
                return workOperationOptionMenulist;
            }

            set
            {
                workOperationOptionMenulist = value;
                OnPropertyChanged(new PropertyChangedEventArgs("WorkOperationOptionMenulist"));
            }
        }

        private ObservableCollection<TreeListColumn> columnsOptionForSupplements;
        public ObservableCollection<TreeListColumn> ColumnsOptionForSupplements
        {
            get { return columnsOptionForSupplements; }
            set
            {
                columnsOptionForSupplements = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ColumnsOptionForSupplements"));
            }
        }

        private ObservableCollection<TreeListColumn> columnsOptionOperationTime;
        public ObservableCollection<TreeListColumn> ColumnsOptionOperationTime
        {
            get { return columnsOptionOperationTime; }
            set
            {
                columnsOptionOperationTime = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ColumnsOptionOperationTime"));
            }
        }
        private void HideOptionPanel(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method HideOptionPanel ...", category: Category.Info, priority: Priority.Low);

                if (IsAccordionControlVisibleOptions == Visibility.Collapsed)
                    IsAccordionControlVisibleOptions = Visibility.Visible;
                else
                    IsAccordionControlVisibleOptions = Visibility.Collapsed;
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method HideOptionPanel()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        List<StandardOperationsDictionaryOption> tempLstStandardOperationsDictionaryOption = new List<StandardOperationsDictionaryOption>();
        ObservableCollection<ERMSOPOptions> OptionList = new ObservableCollection<ERMSOPOptions>();
        ObservableCollection<WorkOperationByStages> operationOptionMenulist = new ObservableCollection<WorkOperationByStages>();
        int duplicateItemloopOption = 0;
        private void RetrieveWorkOperationsByOption()
        {
            Saveselecteditem = "Option";
            GeosApplication.Instance.Logger.Log("Method RetrieveWorkOperationsByOption()...", category: Category.Info, priority: Priority.Low);
            try
            {

                if (!DXSplashScreen.IsActive)
                {
                    DXSplashScreen.Show(x =>
                    {
                        Window win = new Window()
                        {
                            ShowActivated = false,
                            WindowStyle = WindowStyle.None,
                            ResizeMode = ResizeMode.NoResize,
                            AllowsTransparency = true,
                            Background = new SolidColorBrush(Colors.Transparent),
                            ShowInTaskbar = false,
                            Topmost = true,
                            SizeToContent = SizeToContent.WidthAndHeight,
                            WindowStartupLocation = WindowStartupLocation.CenterScreen,
                        };
                        WindowFadeAnimationBehavior.SetEnableAnimation(win, true);
                        win.Topmost = false;
                        return win;
                    }, x =>
                    {
                        return new SplashScreenView() { DataContext = new SplashScreenViewModel() };
                    }, null, null);
                }
            }
            catch (Exception ex)
            {

            }
            if (ISSavechanges == true)
            {
                return;
            }
            if (IsEnabledSaveButton && SaveButtonVisibility == Visibility.Visible)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                MessageBoxResult MessageBoxResult = MessageBoxResult = CustomMessageBox.Show(string.Format(Application.Current.Resources["ArticleGridUpdateWarning"].ToString()), "Yellow", CustomMessageBox.MessageImagePath.Warning, MessageBoxButton.YesNo);
                if (MessageBoxResult == MessageBoxResult.Yes)
                {
                    if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }
                    ISSavechanges = true;
                    IsEnabledSaveButton = false;
                    SelectedItemOldcloneOption = SelectedItemOption;
                    SelectedItemOption = SelectedItemOldOption;
                    var tempSelectedItemOption = SelectedItemOldcloneOption;
                    SaveButtonCommandAction();
                    ISSavechanges = false;
                    SelectedItemOption = tempSelectedItemOption;
                    if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                    #region GEOS2-3882 Commented Code
                    //SelectedItem = SelectedItemOld;
                    //if (SelectedItemOldclone != null)
                    //    SelectedItem = SelectedItemOldclone;

                    //SelectedItemDetection = SelectedItemOldDetection;
                    //if (SelectedItemOldcloneDetection != null)
                    //    SelectedItemDetection = SelectedItemOldcloneDetection;

                    //////GEOS2-3838 -Way
                    //SelectedItemWay = SelectedItemOldWay;
                    //if (SelectedItemOldcloneWay != null)
                    //    SelectedItemWay = SelectedItemOldcloneWay;

                    ////[GEOS2-3601] - Structure
                    //SelectedItemStructures = SelectedItemOldStructure;
                    //if (SelectedItemOldcloneStructure != null)
                    //    SelectedItemStructures = SelectedItemOldcloneStructure;
                    ////GEOS2-4033 Spare Part Gulab Lakade
                    //SelectedItemSparePart = SelectedItemOldSparePart;
                    //if (SelectedItemOldcloneSparePart != null)
                    //    SelectedItemSparePart = SelectedItemOldcloneSparePart;
                    #endregion

                }

                #region [GEOS2-3924][Rupali Sarode][22-11-2022]
                if (MessageBoxResult == MessageBoxResult.No)
                {
                    TmpModuleMenulist = null;
                    TmpDetectionMenulist = null;
                    TmpOptionMenulist = null;
                    TmpStructureMenulist = null;
                    TmpWayMenulist = null;
                    TmpSparePartsMenulist = null;
                    TmpIdCPType = 0;
                    TmpIdDetection = 0; //[GEOS2-3922][Rupali Sarode][07-11-2022]
                    TmpIdOption = 0;
                    TmpIdWayType = 0;
                    TmpIdStructure = 0;
                    TmpIdSpareParts = 0;
                }

                #endregion
            }

            if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
            if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }
            ObservableCollection<ERMSOPOptions> OptionsMenulistTemp = new ObservableCollection<ERMSOPOptions>();//[GEOS2-4830][gulab lakade][07 12 2023]
            SelectedItemOldOption = SelectedItemOption;
            IsEnabledSaveButton = false;
            ModuleMenulistupdated = new ObservableCollection<ERMSOPModule>();
            try
            {

                if (SelectedItemOption is ERMOptions)
                {

                    ERMOptions ermOptions = (ERMOptions)SelectedItemOption;
                    //DetectionMenulist = null;

                    List<StandardOperationsDictionaryOption> tempStandardOperationsDictionaryOption = tempLstStandardOperationsDictionaryOption.Where(w => w.IdDetection == Convert.ToUInt64(ermOptions.IdDetection)).ToList();
                    OptionsMenulist = new ObservableCollection<ERMSOPOptions>();
                    operationOptionMenulist = new ObservableCollection<WorkOperationByStages>();
                    duplicateItemloopOption = 0;
                    duplicateItemloop = 0;
                    if (tempStandardOperationsDictionaryOption.Count() > 0)
                    {
                        foreach (var eRMSOPOption in tempStandardOperationsDictionaryOption)
                        {
                            if (eRMSOPOption != null)
                            {
                                List<WorkOperationByStages> tempOptionList = WorkOperationMenulist.Where(w => w.IdworkOperationByStage == Convert.ToInt32(eRMSOPOption.IdWorkoperation) && w.Name == eRMSOPOption.WorkOperationName).ToList();
                                if (tempOptionList != null)
                                    foreach (WorkOperationByStages item in tempOptionList)
                                    {
                                        if (item.IdStatus == 1536)//[gulablakade][10.08.2022][GEOS2-3837]
                                        {
                                            item.IsInactiveWorkOperation = true;
                                            item.IsReadOnly = true;
                                        }
                                        WorkOperationByStages ParentName = WorkOperationMenulist.Where(w => w.KeyName.Equals(item.ParentName)).FirstOrDefault();
                                        if (ParentName != null)
                                        {
                                            if (!operationOptionMenulist.Any(a => a.KeyName.Equals(ParentName.KeyName)))
                                                operationOptionMenulist.Add(ParentName);
                                        }
                                        duplicateItemloopOption = 0;
                                        duplicateItemloop = 0;
                                        GetAllTreeListOption(item, WorkOperationMenulist);
                                    }

                            }

                        }
                    }
                    #region ModuleMenulist
                    WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                    #region [GEOS2-4830][gulab lakade][07 12 2023]

                    if (AllSupplementsBoxMenu != null)
                    {
                        var listadoDuplicadas = from c in AllSupplementsBoxMenu
                                                join c2 in AllSupplementsBoxMenu on c.Item2 equals c2.Item2
                                                where c != c2
                                                select c;

                        var OptionSandardOperationTime = listadoDuplicadas.FirstOrDefault();
                        if (OptionSandardOperationTime != null)
                        {
                            var templist = listadoDuplicadas.Where(a => a.Item2 == OptionSandardOperationTime.Item2);
                            listadoDuplicadas = templist;
                        }

                        var tempSupplementsBoxMenu = AllSupplementsBoxMenu;

                        ColumnsOptionForSupplements = new ObservableCollection<TreeListColumn>();
                        ColumnsOptionForSupplements.Add(new TreeListColumn()
                        {
                            FieldName = "OptionStandardSupplements",
                            Header = "Standard",
                            HeaderToolTip = "Standard",
                            AllowCellMerge = false,
                            Width = 150,    //gulab lakade not show supplement proper
                            AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                            Visible = true,
                            ReadOnly = false,
                            FixedWidth = false
                        });

                        ColumnsOptionOperationTime = new ObservableCollection<TreeListColumn>();
                        ColumnsOptionOperationTime.Add(new TreeListColumn()
                        {
                            FieldName = "UiTempStandardOperationTimeName",
                            Header = "Standard",
                            HeaderToolTip = "Standard",
                            AllowCellMerge = false,
                            Width = 150,    //not show StandardOperationTime proper
                            AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                            Visible = true,
                            ReadOnly = false,
                            FixedWidth = false
                        });

                        int Suplimentcount = 1;
                        var ColumnsOptionList = tempSupplementsBoxMenu.Where(p => !listadoDuplicadas.Any(p2 => p2.Item1 == p.Item1));
                        foreach (var item in ColumnsOptionList)
                        {
                            if (Suplimentcount == 5)
                            {
                                ColumnsOptionForSupplements.Add(new TreeListColumn()
                                {
                                    FieldName = "OptionSupplementPlant" + Suplimentcount + "Value",
                                    Header = "Others",
                                    HeaderToolTip = "Others",
                                    AllowCellMerge = false,
                                    Width = 60,
                                    AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                    Visible = true,
                                    ReadOnly = false,
                                    FixedWidth = false
                                });
                                ColumnsOptionOperationTime.Add(new TreeListColumn()
                                {
                                    FieldName = "UiTempoperationTimePlant" + Suplimentcount + "Value",
                                    Header = "Others",
                                    HeaderToolTip = "Others",
                                    AllowCellMerge = false,
                                    Width = 60,
                                    AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                    Visible = true,
                                    ReadOnly = false,
                                    FixedWidth = false
                                });
                                break;
                            }
                            if (Suplimentcount == 5)
                            {
                                break;
                            }
                            ColumnsOptionForSupplements.Add(new TreeListColumn()
                            {
                                FieldName = "OptionSupplementPlant" + Suplimentcount + "Value",
                                Header = item.Item1,
                                HeaderToolTip = item.Item1,
                                AllowCellMerge = false,
                                Width = 60,
                                AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                Visible = true,
                                ReadOnly = false,
                                FixedWidth = false
                            });

                            ColumnsOptionOperationTime.Add(new TreeListColumn()
                            {
                                FieldName = "UiTempoperationTimePlant" + Suplimentcount + "Value",
                                Header = item.Item1,
                                HeaderToolTip = item.Item1,
                                AllowCellMerge = false,
                                Width = 60,
                                AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                Visible = true,
                                ReadOnly = false,
                                FixedWidth = false
                            });
                            Suplimentcount = Suplimentcount + 1;
                        }

                        #endregion

                        bool FlagAddItemModule = false;  //[GEOS2-5135][Rupali Sarode][18-12-2023]
                        foreach (WorkOperationByStages Module in operationOptionMenulist)
                        {
                            FlagAddItemModule = true; //[GEOS2-5135][Rupali Sarode][18-12-2023]

                            if (operationOptionMenulist.Any(a => a.IdworkOperationByStage == Convert.ToInt64(Module.IdworkOperationByStage))
                                && operationOptionMenulist.Any(a => a.Name.Trim().Equals(Module.Name.Trim()))
                                )
                            {
                                StandardOperationsDictionaryOption standardOperationsDictionaryOption = tempLstStandardOperationsDictionaryOption.Where(w => w.IdWorkoperation == Convert.ToUInt64(Module.IdworkOperationByStage) && Module.Parent != null
                                && w.IdDetection == Convert.ToUInt64(ermOptions.IdDetection)).FirstOrDefault();

                                #region  [GEOS2-5135][Rupali Sarode][18-12-2023]
                                // If it is child & only active then add
                                List<WorkOperationByStages> childListInActiveDraft = operationOptionMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(Module.KeyName)).ToList();

                                if (childListInActiveDraft.Count == 0)
                                {
                                    if (Module.IdStatus == 1535)
                                    {
                                        FlagAddItemModule = true;
                                    }
                                    else
                                        FlagAddItemModule = false;
                                }
                                else // If it is parent and does not contain any active child, then do not include it
                                if (childListInActiveDraft.Count > 0)
                                {
                                    //List<WorkOperationByStages> childListInParent = operationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(Module.KeyName)).ToList();
                                    foreach (WorkOperationByStages objChild in childListInActiveDraft)
                                    {
                                        List<WorkOperationByStages> GrandChildListInActiveDraft = new List<WorkOperationByStages>();
                                        GrandChildListInActiveDraft = operationOptionMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(objChild.KeyName)).ToList();
                                        if (GrandChildListInActiveDraft.Count == 0)
                                        { // If it is child and Active
                                            if (objChild.IdStatus == 1535)
                                            {
                                                FlagAddItemModule = true;
                                                break;
                                            }
                                            else
                                            {
                                                FlagAddItemModule = false;
                                            }

                                        }
                                        else
                                        {
                                            if (GrandChildListInActiveDraft.Count > 0)
                                            {
                                                if (GrandChildListInActiveDraft.Where(i => i.IdStatus == 1535).Count() > 0)
                                                {
                                                    FlagAddItemModule = true;
                                                    break;
                                                }
                                                else
                                                {
                                                    FlagAddItemModule = false;
                                                }
                                            }
                                        }
                                    }
                                }
                                #endregion  [GEOS2-5135][Rupali Sarode][18-12-2023]


                                if (FlagAddItemModule == true)  //[GEOS2-5135][Rupali Sarode][18-12-2023]
                                { //[GEOS2-5135][Rupali Sarode][18-12-2023]

                                    ERMSOPOptions eRMSOPOption = new ERMSOPOptions();
                                    if (standardOperationsDictionaryOption != null)
                                        eRMSOPOption.IdDetection = standardOperationsDictionaryOption.IdDetection;
                                    eRMSOPOption.Name = Module.Name;
                                    eRMSOPOption.IdworkOperationByStage = Module.IdworkOperationByStage;
                                    eRMSOPOption.IdSequence = Module.IdSequence;
                                    eRMSOPOption.IdStatus = Module.IdStatus;
                                    eRMSOPOption.Status = Module.Status;
                                    eRMSOPOption.Code = Module.Name;
                                    eRMSOPOption.Parent = Module.Parent;
                                    eRMSOPOption.IdParent = Module.IdParent;
                                    eRMSOPOption.KeyName = Module.KeyName;
                                    eRMSOPOption.ParentName = Module.ParentName;
                                    #region [GEOS2-5629][gulab lakade][15 07 2024]

                                    if (standardOperationsDictionaryOption != null)
                                    {
                                        eRMSOPOption.Position = Convert.ToUInt32(standardOperationsDictionaryOption.Position);
                                        eRMSOPOption.OptionPosition = Convert.ToUInt32(standardOperationsDictionaryOption.Position);//[GEOS2-5629][gulab lakade][10 07 2024]

                                    }
                                    else
                                    {
                                        eRMSOPOption.Position = Module.Position;
                                        eRMSOPOption.OptionPosition = Module.Position; //[GEOS2-5629][gulab lakade][10 07 2024]
                                    }
                                    #endregion
                                    eRMSOPOption.WorkOperation_count = Module.WorkOperation_count;
                                    eRMSOPOption.WorkOperation_count_original = Module.WorkOperation_count_original;
                                    eRMSOPOption.NameWithWorkOperationCount = Module.NameWithWorkOperationCount;

                                    eRMSOPOption.IsInactiveWorkOperation = Module.IsInactiveWorkOperation;
                                    eRMSOPOption.IsReadOnly = Module.IsReadOnly;

                                    if (!GetStages.Any(a => a.Code.Equals(eRMSOPOption.Name)))
                                    {
                                        var tempActivity = tempLstStandardOperationsDictionaryOption.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPOption.IdworkOperationByStage)
                                         && w.IdDetection == Convert.ToUInt64(eRMSOPOption.IdDetection)).Select(s => s.Activity).DefaultIfEmpty(null).FirstOrDefault();
                                        var tempObservedTime = tempLstStandardOperationsDictionaryOption.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPOption.IdworkOperationByStage)
                                         && w.IdDetection == Convert.ToUInt64(eRMSOPOption.IdDetection)).Select(s => s.ObservedTime).DefaultIfEmpty(null).FirstOrDefault();


                                        #region [GEOS2-4083][Rupali Sarode][10-12-2022]

                                        var tempOption = tempLstStandardOperationsDictionaryOption.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPOption.IdworkOperationByStage)
                                        && w.IdDetection == Convert.ToUInt64(eRMSOPOption.IdDetection)).FirstOrDefault();

                                        if (tempOption != null)
                                        {
                                            if (tempOption.IdWorkoperation == Convert.ToUInt64(eRMSOPOption.IdworkOperationByStage) && (tempActivity == null || tempActivity == 0))
                                                tempActivity = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == Module.IdworkOperationByStage && a.KeyName == Module.KeyName).Select(b => b.Activity).FirstOrDefault();  //[Cut  work operation not work properly.][gulab lakade][24 01 2023]

                                            if (tempOption.IdWorkoperation == Convert.ToUInt64(eRMSOPOption.IdworkOperationByStage) && (tempObservedTime == null || tempObservedTime == 0))
                                                tempObservedTime = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == Module.IdworkOperationByStage && a.KeyName == Module.KeyName).Select(b => b.ObservedTime).FirstOrDefault();  //[Cut  work operation not work properly.][gulab lakade][24 01 2023]
                                        }

                                        #endregion

                                        if (tempActivity != null)
                                            eRMSOPOption.OptionActivity = Math.Round((double)tempActivity, 2);


                                        if (tempObservedTime != null)
                                        {
                                            eRMSOPOption.OptionObservedTime = Math.Round((double)tempObservedTime, 2);
                                            #region [GEOS2-3954][Rupali Sarode]
                                            //eRMSOPOption.UITempOptionObservedTime = ConvertfloattoTimespan(Convert.ToString (eRMSOPOption.OptionObservedTime));
                                            //    eRMSOPOption.UITempOptionObservedTime = tempLstStandardOperationsDictionaryOption.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPOption.IdworkOperationByStage)
                                            //&& w.IdDetection == Convert.ToUInt64(eRMSOPOption.IdDetection)).Select(s => s.UITempOptionObservedTime).FirstOrDefault();

                                            //eRMSOPOption.OptionNormalTime = Math.Round(Convert.ToDouble(eRMSOPOption.OptionObservedTime * eRMSOPOption.OptionActivity / 100), 2);

                                            #region [GEOS2-5008][gulab lakade][1 11 2023]
                                            // eRMSOPOption.UITempOptionObservedTime = TimeSpan.FromMinutes(Convert.ToDouble(tempObservedTime));
                                            eRMSOPOption.UITempOptionObservedTime = ConvertfloattoTimespan(Convert.ToString(Convert.ToDouble(tempObservedTime)));
                                            #endregion
                                            #endregion
                                        }


                                        eRMSOPOption.OptionNormalTime = Math.Round(Convert.ToDouble(eRMSOPOption.OptionObservedTime * eRMSOPOption.OptionActivity / 100), 2);
                                        #region [GEOS2-3954][Rupali Sarode]
                                        eRMSOPOption.UITempOptionNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(eRMSOPOption.OptionNormalTime));
                                        #endregion


                                        //[GEOS2-3933][Rupali Sarode][22/09/2022]
                                        eRMSOPOption.WORemarks = Module.WORemarks == null ? "" : Module.WORemarks.Trim();

                                        //[GEOS2-3933][Rupali Sarode][26/09/2022]
                                        var tempRemarks = tempLstStandardOperationsDictionaryOption.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPOption.IdworkOperationByStage)
                                        && w.IdDetection == Convert.ToUInt64(eRMSOPOption.IdDetection)).Select(s => s.Remarks).DefaultIfEmpty(null).FirstOrDefault();

                                        eRMSOPOption.Remarks = tempRemarks == null ? "" : tempRemarks.Trim();
                                    }


                                    if (GetStages.Any(a => a != null && a.Code.Trim().Equals(Module.Name.Trim())))
                                    {
                                        eRMSOPOption.IsDeleteButton = false;
                                        eRMSOPOption.IsDeleteButtonVisibility = Visibility.Hidden;
                                        eRMSOPOption.IsReadOnly = true;
                                        eRMSOPOption.IsValidateOnTextInput = false;
                                        Module.IsCurrentWorkOperation = true;
                                    }
                                    else
                                    {
                                        Module.IsCurrentWorkOperation = true;
                                        eRMSOPOption.IsReadOnly = false;
                                        eRMSOPOption.IsValidateOnTextInput = true;
                                    }
                                    if (Module.IdStatus == 1536)
                                    {
                                        eRMSOPOption.IsInactiveWorkOperation = true;
                                        eRMSOPOption.IsReadOnly = true;
                                    }
                                    #region [GEOS2-4830][gulab lakade][07 12 2023]
                                    if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(eRMSOPOption.Name.Trim())))
                                    {
                                        if (OptionSandardOperationTime != null)
                                            eRMSOPOption.OptionStandardSupplements = (float?)OptionSandardOperationTime.Item2;
                                        if (tempSupplementsBoxMenu.Any(p => !listadoDuplicadas.Any(p2 => p2.Item1 == p.Item1)))
                                        {
                                            eRMSOPOption.AllSupplementsBoxMenu = AllSupplementsBoxMenu;
                                            List<float?> lst = new List<float?>();

                                            var a = ColumnsOptionList.ToList();
                                            for (int i = 0; i < a.Count(); i++)
                                            {
                                                lst.Add((float?)a[i].Item2);
                                            }

                                            if (ColumnsOptionList.Count() == 1)
                                            {
                                                eRMSOPOption.OptionSupplementPlant1Value = (float?)lst[0];
                                            }
                                            else if (ColumnsOptionList.Count() == 2)
                                            {
                                                eRMSOPOption.OptionSupplementPlant1Value = (float?)lst[0];
                                                eRMSOPOption.OptionSupplementPlant2Value = (float?)lst[1];
                                            }
                                            else if (ColumnsOptionList.Count() == 3)
                                            {
                                                eRMSOPOption.OptionSupplementPlant1Value = (float?)lst[0];
                                                eRMSOPOption.OptionSupplementPlant2Value = (float?)lst[1];
                                                eRMSOPOption.OptionSupplementPlant3Value = (float?)lst[2];
                                            }
                                            else if (ColumnsOptionList.Count() == 4)
                                            {
                                                eRMSOPOption.OptionSupplementPlant1Value = (float?)lst[0];
                                                eRMSOPOption.OptionSupplementPlant2Value = (float?)lst[1];
                                                eRMSOPOption.OptionSupplementPlant3Value = (float?)lst[2];
                                                eRMSOPOption.OptionSupplementPlant4Value = (float?)lst[3];
                                            }
                                            else if (ColumnsOptionList.Count() == 5)
                                            {
                                                eRMSOPOption.OptionSupplementPlant1Value = (float?)lst[0];
                                                eRMSOPOption.OptionSupplementPlant2Value = (float?)lst[1];
                                                eRMSOPOption.OptionSupplementPlant3Value = (float?)lst[2];
                                                eRMSOPOption.OptionSupplementPlant4Value = (float?)lst[3];
                                                eRMSOPOption.OptionSupplementPlant5Value = (float?)lst[4];
                                            }
                                            else
                                            {
                                                eRMSOPOption.OptionSupplementPlant1Value = (float?)lst[0];
                                                eRMSOPOption.OptionSupplementPlant2Value = (float?)lst[1];
                                                eRMSOPOption.OptionSupplementPlant3Value = (float?)lst[2];
                                                eRMSOPOption.OptionSupplementPlant4Value = (float?)lst[3];
                                                eRMSOPOption.OptionSupplementPlant5Value = 0;
                                                if (ColumnsOptionList.Count() > 5)
                                                {
                                                    for (int q = 4; q < ColumnsOptionList.Count(); q++)
                                                    {
                                                        if (eRMSOPOption.OptionSupplementPlant5Value == null)
                                                            eRMSOPOption.OptionSupplementPlant5Value = 0;
                                                        eRMSOPOption.OptionSupplementPlant5Value = eRMSOPOption.OptionSupplementPlant5Value + (float?)lst[q];
                                                    }
                                                }


                                            }

                                        }
                                        #region GEOS2-4046 Gulab Lakade
                                        if (OptionSandardOperationTime != null)
                                            eRMSOPOption.OptionStandardOperationTime = (float?)Math.Round(Convert.ToDouble(eRMSOPOption.OptionNormalTime * (1 + (Convert.ToDouble(OptionSandardOperationTime.Item2) / 100))), 2);

                                        eRMSOPOption.OptionOperationTimePlant1Value = (float?)Math.Round(Convert.ToDouble(eRMSOPOption.OptionNormalTime * (1 + (Convert.ToDouble(eRMSOPOption.OptionSupplementPlant1Value) / 100))), 2);
                                        eRMSOPOption.OptionOperationTimePlant2Value = (float?)Math.Round(Convert.ToDouble(eRMSOPOption.OptionNormalTime * (1 + (Convert.ToDouble(eRMSOPOption.OptionSupplementPlant2Value) / 100))), 2);
                                        eRMSOPOption.OptionOperationTimePlant3Value = (float?)Math.Round(Convert.ToDouble(eRMSOPOption.OptionNormalTime * (1 + (Convert.ToDouble(eRMSOPOption.OptionSupplementPlant3Value) / 100))), 2);
                                        eRMSOPOption.OptionOperationTimePlant4Value = (float?)Math.Round(Convert.ToDouble(eRMSOPOption.OptionNormalTime * (1 + (Convert.ToDouble(eRMSOPOption.OptionSupplementPlant4Value) / 100))), 2);
                                        eRMSOPOption.OptionOperationTimePlant5Value = (float?)Math.Round(Convert.ToDouble(eRMSOPOption.OptionNormalTime * (1 + (Convert.ToDouble(eRMSOPOption.OptionSupplementPlant5Value) / 100))), 2);
                                        #endregion
                                        #region GEOS2-3954 Show the WorkOperations and SOD Time in the format: MM:SS or HH:MM:SS
                                        try
                                        {
                                            eRMSOPOption.UiTempStandardOperationTimeName = ConvertfloattoTimespan(Convert.ToString(eRMSOPOption.OptionStandardOperationTime));
                                            eRMSOPOption.UiTempoperationTimePlant1Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPOption.OptionOperationTimePlant1Value));
                                            eRMSOPOption.UiTempoperationTimePlant2Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPOption.OptionOperationTimePlant2Value));
                                            eRMSOPOption.UiTempoperationTimePlant3Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPOption.OptionOperationTimePlant3Value));
                                            eRMSOPOption.UiTempoperationTimePlant4Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPOption.OptionOperationTimePlant4Value));
                                            eRMSOPOption.UiTempoperationTimePlant5Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPOption.OptionOperationTimePlant5Value));
                                        }
                                        catch (Exception ex)
                                        {
                                            GeosApplication.Instance.Logger.Log(string.Format("Error in Method FillOptionGridColumn() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                        }
                                        #endregion
                                    }
                                    #endregion
                                    try
                                    {
                                        if (!OptionsMenulistTemp.Any(a => a.KeyName.Equals(Module.KeyName)))
                                            OptionsMenulistTemp.Add(eRMSOPOption);
                                    }
                                    catch (Exception ex)
                                    {

                                    }
                                } //[GEOS2-5135][Rupali Sarode][18-12-2023]

                            }
                        }
                    }//[GEOS2-4830][gulab lakade][07 12 2023]

                    #region GEOS2-3860 Rupali Sarode
                    //var tempWorkOperationMenulist2 = OptionsMenulistTemp.OrderBy(x => x.Position).ToList();
                    var tempWorkOperationMenulist2 = OptionsMenulistTemp.OrderBy(x => x.OptionPosition).ToList();//[GEOS2-5629][gulab lakade][15 07 2024]
                    tempWorkOperationClonedOptions = new List<ERMSOPOptions>();
                    tempWorkOperationClonedOptions.AddRange(tempWorkOperationMenulist2);
                    #endregion

                    //List<ERMSOPOptions> tempWorkOperationOptionMenulist = OptionsMenulistTemp.OrderBy(x => x.Position).ToList();
                    List<ERMSOPOptions> tempWorkOperationOptionMenulist = OptionsMenulistTemp.OrderBy(x => x.OptionPosition).ToList();//[GEOS2-5629][gulab lakade][15 07 2024]
                    OptionsMenulistTemp.Clear();
                    OptionsMenulistTemp.AddRange(tempWorkOperationOptionMenulist);
                    tempWorkOperationOptionMenulist.Clear();
                    if (OptionsMenulistTemp != null)
                    {
                        var tempOptionMenulist = OptionsMenulistTemp.ToList();
                        for (int i = 0; i < tempOptionMenulist.Count; i++)
                        {
                            if (GetStages.Any(a => a.Code.Equals(tempOptionMenulist[i].Name)))
                            {
                                List<ERMSOPOptions> childList = OptionsMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(tempOptionMenulist[i].KeyName)).ToList();
                                if (childList.Count == 0)
                                {
                                    List<WorkOperationByStages> tempWOList = WorkOperationMenulist.Where(w => w.KeyName == tempOptionMenulist[i].KeyName).ToList();
                                    if (tempWOList != null)
                                        tempWOList.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                                    OptionsMenulistTemp.Remove(tempOptionMenulist[i]);
                                }
                            }
                        }
                    }
                    #endregion
                }
                #region TemplateWithCPTypes
                else if (SelectedItemOption is DetectionGroupWithOptions)
                {
                    OptionsMenulistTemp = null;
                    workOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                    #region GEOS2-3860 Rupali Sarode
                    SelectedItemOptionGroup = Convert.ToString(SelectedItemOption.ToString());
                    #endregion
                }
                #endregion

                //FillOptionGridColumn();//[GEOS2-4830][gulab lakade][07 12 2023]
                #region RND
                #region calculation
                #region [GEOS2-4830][gulab lakade][07 12 2023]
                //if (OptionsMenulistTemp != null)
                //    //foreach (ERMSOPDetection itemERMSOPDetection in DetectionMenulist)
                //    for (int d = 0; d < OptionsMenulistTemp.Count(); d++)
                //    {
                //        WorkOperationMenulist.Where(w => w.KeyName == OptionsMenulistTemp[d].KeyName).ToList().ForEach(f => f.IsCurrentWorkOperation = true);
                //        var listCount = OptionsMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(OptionsMenulistTemp[d].KeyName) && w.IsInactiveWorkOperation == false).ToList();
                //        if (listCount != null)
                //            if (listCount.Count() > 0)
                //            {
                //                // decimal a = listCount.Sum(s => s.OptionObservedTime);

                //                OptionsMenulistTemp[d].OptionObservedTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.OptionObservedTime)), 2);
                //                OptionsMenulistTemp[d].OptionNormalTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.OptionNormalTime)), 2);

                //                //[GEOS2-3954][Rupali Sarode]
                //                OptionsMenulistTemp[d].UITempOptionObservedTime = ConvertfloattoTimespan(Convert.ToString(Convert.ToDouble(listCount.Sum(s => s.OptionObservedTime))));
                //                OptionsMenulistTemp[d].UITempOptionNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(Convert.ToDouble(listCount.Sum(s => s.OptionNormalTime))));

                //                OptionsMenulistTemp[d].IsReadOnly = true;
                //            }
                //    }
                #endregion

                if (OptionsMenulistTemp != null)
                    for (int d = 0; d < OptionsMenulistTemp.Count(); d++)
                    {
                        WorkOperationMenulist.Where(w => w.KeyName == OptionsMenulistTemp[d].KeyName).ToList().ForEach(f => f.IsCurrentWorkOperation = true);
                        //[GEOS2-5135][Rupali Sarode][19-12-2023]
                        //var listCount = OptionsMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(OptionsMenulistTemp[d].KeyName) && w.IsInactiveWorkOperation == false).ToList();
                        var listCount = OptionsMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(OptionsMenulistTemp[d].KeyName)).ToList();
                        if (listCount != null)
                            if (listCount.Count() > 0)
                            {
                                OptionsMenulistTemp[d].OptionObservedTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.OptionObservedTime)), 2);
                                OptionsMenulistTemp[d].OptionNormalTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.OptionNormalTime)), 2);

                                //[GEOS2-3954][Rupali Sarode]
                                OptionsMenulistTemp[d].UITempOptionObservedTime = ConvertfloattoTimespan(Convert.ToString(listCount.Sum(s => s.OptionObservedTime)));
                                OptionsMenulistTemp[d].UITempOptionNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(listCount.Sum(s => s.OptionNormalTime)));

                                OptionsMenulistTemp[d].IsReadOnly = true;
                            }
                    }

                if (OptionsMenulistTemp != null)
                    //foreach (ERMSOPDetection itemERMSOPDetection in DetectionMenulist)
                    for (int d = 0; d < OptionsMenulistTemp.Count(); d++)
                    {
                        if (GetStages.Any(a => a.Code.Equals(OptionsMenulistTemp[d].Name)))
                        {
                            ObservableCollection<ERMSOPOptions> ActivitySum = new ObservableCollection<ERMSOPOptions>();
                            ObservableCollection<ERMSOPOptions> TempActivitySum = new ObservableCollection<ERMSOPOptions>();
                            int x = 1;
                            Loop:
                            x++;
                            if (x < 10)
                            {
                                if (ActivitySum.Count == 0)
                                {
                                    OptionsMenulistTemp[d].OptionObservedTime = 0;
                                    OptionsMenulistTemp[d].OptionNormalTime = 0;

                                    //[GEOS2-3954][Rupali Sarode]
                                    OptionsMenulistTemp[d].UITempOptionObservedTime = ConvertfloattoTimespan(Convert.ToString(OptionsMenulistTemp[d].OptionObservedTime));
                                    OptionsMenulistTemp[d].UITempOptionNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(OptionsMenulistTemp[d].OptionNormalTime));
                                    //[GEOS2-5135][Rupali Sarode][19-12-2023]
                                    //var ActivitySumList = OptionsMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(OptionsMenulistTemp[d].KeyName) && w.IsInactiveWorkOperation == false).ToList();
                                    var ActivitySumList = OptionsMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(OptionsMenulistTemp[d].KeyName)).ToList();
                                    ActivitySum.AddRange(ActivitySumList);
                                }
                                else
                                {
                                    //foreach (var item in ActivitySum)
                                    //{
                                    //    var ActivitySumList = DetectionMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(item.KeyName)).ToList();
                                    //    if (ActivitySumList != null && ActivitySumList.Count > 0)
                                    //    {

                                    //        foreach (var itemActivity in ActivitySumList)
                                    //        {
                                    //            if (!ActivitySum.Any(ac => ac.KeyName.Equals(itemActivity.KeyName)))
                                    //            {
                                    //                TempActivitySum.Add(itemActivity);
                                    //            }

                                    //        }

                                    //    }

                                    //}
                                    //ActivitySum.AddRange(TempActivitySum);
                                }


                                goto Loop;
                            }

                            double? ObservedTime = 0;
                            double? NormalTime = 0;
                            float? StandardTime = 0;
                            float? OperationTimePlant1Value = 0;
                            float? OperationTimePlant2Value = 0;
                            float? OperationTimePlant3Value = 0;
                            float? OperationTimePlant4Value = 0;
                            float? OperationTimePlant5Value = 0;
                            var tempDistinctList = ActivitySum.Select(xa => xa.KeyName).Distinct().ToList();
                            foreach (var item in tempDistinctList)
                            {
                                if (OptionsMenulistTemp[d].OptionObservedTime == null)
                                    OptionsMenulistTemp[d].OptionObservedTime = 0;
                                double? tempObservedTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.OptionObservedTime).FirstOrDefault();
                                if (tempObservedTime != null)
                                {
                                    ObservedTime = Math.Round(Convert.ToDouble(ObservedTime + tempObservedTime), 2);
                                    //[GEOS2-3954][Rupali Sarode]
                                    OptionsMenulistTemp[d].UITempOptionObservedTime = ConvertfloattoTimespan(Convert.ToString(ObservedTime));
                                }
                                if (OptionsMenulistTemp[d].OptionNormalTime == null)
                                    OptionsMenulistTemp[d].OptionNormalTime = 0;
                                double? tempNormalTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.OptionNormalTime).FirstOrDefault();
                                if (tempNormalTime != null)
                                {
                                    NormalTime = Math.Round(Convert.ToDouble(NormalTime + tempNormalTime), 2);
                                    OptionsMenulistTemp[d].UITempOptionNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(NormalTime));
                                }

                            }
                            OptionsMenulistTemp[d].OptionObservedTime = ObservedTime;
                            OptionsMenulistTemp[d].OptionNormalTime = NormalTime;

                            //[GEOS2-3954][Rupali Sarode]
                            OptionsMenulistTemp[d].UITempOptionObservedTime = ConvertfloattoTimespan(Convert.ToString(ObservedTime));
                            OptionsMenulistTemp[d].UITempOptionNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(NormalTime));

                            //DetectionMenulist[d].DetectionNormalTime = Math.Round(Convert.ToDouble(ObservedTime * DetectionMenulist[d].DetectionActivity / 100), 2);
                            #region PlantValue


                            foreach (var item in tempDistinctList)
                            {
                                if (OptionsMenulistTemp[d].OptionStandardOperationTime == null)
                                    OptionsMenulistTemp[d].OptionStandardOperationTime = 0;
                                float? tempStandardTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.OptionStandardOperationTime).FirstOrDefault();
                                if (tempStandardTime != null)
                                    StandardTime = StandardTime + tempStandardTime;

                                if (OptionsMenulistTemp[d].OptionOperationTimePlant1Value == null)
                                    OptionsMenulistTemp[d].OptionOperationTimePlant1Value = 0;
                                float? tempOperationTimePlant1Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.OptionOperationTimePlant1Value).FirstOrDefault();
                                if (tempOperationTimePlant1Value != null)
                                    OperationTimePlant1Value = OperationTimePlant1Value + tempOperationTimePlant1Value;

                                if (OptionsMenulistTemp[d].OptionOperationTimePlant2Value == null)
                                    OptionsMenulistTemp[d].OptionOperationTimePlant2Value = 0;
                                float? tempOperationTimePlant2Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.OptionOperationTimePlant2Value).FirstOrDefault();
                                if (tempOperationTimePlant2Value != null)
                                    OperationTimePlant2Value = OperationTimePlant2Value + tempOperationTimePlant2Value;

                                if (OptionsMenulistTemp[d].OptionOperationTimePlant3Value == null)
                                    OptionsMenulistTemp[d].OptionOperationTimePlant3Value = 0;
                                float? tempOperationTimePlant3Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.OptionOperationTimePlant3Value).FirstOrDefault();
                                if (tempOperationTimePlant3Value != null)
                                    OperationTimePlant3Value = OperationTimePlant3Value + tempOperationTimePlant3Value;

                                if (OptionsMenulistTemp[d].OptionOperationTimePlant4Value == null)
                                    OptionsMenulistTemp[d].OptionOperationTimePlant4Value = 0;
                                float? tempOperationTimePlant4Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.OptionOperationTimePlant4Value).FirstOrDefault();
                                if (tempOperationTimePlant4Value != null)
                                    OperationTimePlant4Value = OperationTimePlant4Value + tempOperationTimePlant4Value;

                                if (OptionsMenulistTemp[d].OptionOperationTimePlant5Value == null)
                                    OptionsMenulistTemp[d].OptionOperationTimePlant5Value = 0;
                                float? tempOperationTimePlant5Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.OptionOperationTimePlant5Value).FirstOrDefault();
                                if (tempOperationTimePlant5Value != null)
                                    OperationTimePlant5Value = OperationTimePlant5Value + tempOperationTimePlant5Value;
                            }
                            #endregion
                            OptionsMenulistTemp[d].OptionStandardOperationTime = (float?)Math.Round(Convert.ToDouble(StandardTime), 2);
                            OptionsMenulistTemp[d].OptionOperationTimePlant1Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant1Value), 2);
                            OptionsMenulistTemp[d].OptionOperationTimePlant2Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant2Value), 2);
                            OptionsMenulistTemp[d].OptionOperationTimePlant3Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant3Value), 2);
                            OptionsMenulistTemp[d].OptionOperationTimePlant4Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant4Value), 2);
                            OptionsMenulistTemp[d].OptionOperationTimePlant5Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant5Value), 2);
                            #region GEOS2-3954 Show the WorkOperations and SOD Time in the format: MM:SS or HH:MM:SS
                            try
                            {
                                OptionsMenulistTemp[d].UiTempStandardOperationTimeName = ConvertfloattoTimespan(Convert.ToString(OptionsMenulistTemp[d].OptionStandardOperationTime));
                                OptionsMenulistTemp[d].UiTempoperationTimePlant1Value = ConvertfloattoTimespan(Convert.ToString(OptionsMenulistTemp[d].OptionOperationTimePlant1Value));
                                OptionsMenulistTemp[d].UiTempoperationTimePlant2Value = ConvertfloattoTimespan(Convert.ToString(OptionsMenulistTemp[d].OptionOperationTimePlant2Value));
                                OptionsMenulistTemp[d].UiTempoperationTimePlant3Value = ConvertfloattoTimespan(Convert.ToString(OptionsMenulistTemp[d].OptionOperationTimePlant3Value));
                                OptionsMenulistTemp[d].UiTempoperationTimePlant4Value = ConvertfloattoTimespan(Convert.ToString(OptionsMenulistTemp[d].OptionOperationTimePlant4Value));
                                OptionsMenulistTemp[d].UiTempoperationTimePlant5Value = ConvertfloattoTimespan(Convert.ToString(OptionsMenulistTemp[d].OptionOperationTimePlant5Value));
                            }
                            catch (Exception ex)
                            {
                                GeosApplication.Instance.Logger.Log(string.Format("Error in Method OptionCustomSummarycalculation() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            }
                            #endregion
                        }
                    }
                #endregion              
                OptionsMenulist = OptionsMenulistTemp;
                #endregion

                //optionCustomSummarycalculation();
                //if (ModuleMenulist != null)
                //    ModuleMenulistCloned = ModuleMenulist;
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Method RetrieveWorkOperationsByOption()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log(string.Format("Error in method RetrieveWorkOperationsByOption() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void CompleteDropRecorOptionGrid(DropRecordEventArgs e)
        {
            ObservableCollection<ERMSOPOptions> OptionsMenulistTemp = new ObservableCollection<ERMSOPOptions>();//[GEOS2-4830][gulab lakade][07 12 2023]
            try
            {
                GeosApplication.Instance.Logger.Log("Method CompleteDropRecorOptionGrid()...", category: Category.Info, priority: Priority.Low);

                Saveselecteditem = "Option";  //[GEOS2-4108][Rupali Sarode][3-1-2022]
                string WOWithStatusMessage = string.Empty;  // [GEOS2-5020][Rupali Sarode][29-11-2023]
                if (!DXSplashScreen.IsActive)
                {
                    DXSplashScreen.Show(x =>
                    {
                        Window win = new Window()
                        {
                            ShowActivated = false,
                            WindowStyle = WindowStyle.None,
                            ResizeMode = ResizeMode.NoResize,
                            AllowsTransparency = true,
                            Background = new SolidColorBrush(Colors.Transparent),
                            ShowInTaskbar = false,
                            Topmost = true,
                            SizeToContent = SizeToContent.WidthAndHeight,
                            WindowStartupLocation = WindowStartupLocation.CenterScreen,
                        };
                        WindowFadeAnimationBehavior.SetEnableAnimation(win, true);
                        win.Topmost = false;
                        return win;
                    }, x =>
                    {
                        return new SplashScreenView() { DataContext = new SplashScreenViewModel() };
                    }, null, null);
                }

                if (SelectedItemOption is ERMOptions)
                {

                    IsEnabledSaveButton = true;
                    SaveButtonVisibility = Visibility.Visible;
                    duplicateItemloopOption = 0;
                    if ((e.IsFromOutside) && typeof(WorkOperationByStages).IsAssignableFrom(e.GetRecordType()))
                    {
                        //WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                        var data = (RecordDragDropData)e.Data.GetData(typeof(RecordDragDropData));
                        List<WorkOperationByStages> found = new List<WorkOperationByStages>();
                        List<WorkOperationByStages> TempfoundAllrecords = new List<WorkOperationByStages>();
                        List<WorkOperationByStages> records = data.Records.OfType<WorkOperationByStages>().ToList();
                        operationOptionMenulist = new ObservableCollection<WorkOperationByStages>();
                        int count = 0;
                        if (OptionsMenulist == null)
                        {
                            OptionsMenulist = new ObservableCollection<ERMSOPOptions>();
                        }
                        if (OptionsMenulist.Count() > 0)
                        {
                            OptionsMenulistTemp = OptionsMenulist;
                        }
                        if (records.Any(a => a.Name.Equals("All")))
                        {
                            #region ALL
                            found = new List<WorkOperationByStages>();
                            operationOptionMenulist = new ObservableCollection<WorkOperationByStages>();
                            operationOptionMenulist.AddRange(WorkOperationMenulist.Where(w => !w.Name.Equals("All")));
                            #endregion
                        }
                        else
                        {

                            for (int r = 0; r < records.Count(); r++)
                            {
                                if (!OptionsMenulistTemp.Any(a => a.Name.Equals(records[r].Name)))
                                {
                                    //if (records[r].IdStatus != 1536)
                                    //{
                                    records[r].IsCurrentWorkOperation = true;
                                    //DetectionMenulist.Add(JsonConvert.DeserializeObject<ERMSOPDetection>(JsonConvert.SerializeObject(records[r])));
                                    if (!operationOptionMenulist.Any(a => a.KeyName.Equals(records[r].KeyName)))
                                        operationOptionMenulist.Add(records[r]);
                                    //}


                                }

                                if (GetStages.Any(a => a != null && a.Code.Trim().Equals(records[r].Name.Trim())))
                                {
                                    found.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(records[r].KeyName)).ToList());
                                    int x = 0;
                                    Loop:
                                    x++;
                                    if (x < 4)
                                    {
                                        for (int i = 0; i < found.Count(); i++)
                                        {
                                            TempfoundAllrecords.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(found[i].KeyName)).ToList());
                                        }
                                        for (int i = 0; i < TempfoundAllrecords.Count(); i++)
                                        {
                                            if (!found.Any(a => a != null && a.KeyName.Trim().Equals(TempfoundAllrecords[i].KeyName.Trim())))
                                                found.Add(TempfoundAllrecords[i]);
                                        }
                                        goto Loop;
                                    }

                                }
                                else
                                {
                                    found.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(records[r].KeyName)).ToList());
                                    for (int i = 0; i < found.Count(); i++)
                                    {
                                        TempfoundAllrecords.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(found[i].KeyName)).ToList());
                                    }
                                    for (int i = 0; i < TempfoundAllrecords.Count(); i++)
                                    {
                                        if (!found.Any(a => a != null && a.KeyName.Trim().Equals(TempfoundAllrecords[i].KeyName.Trim())))
                                            found.Add(TempfoundAllrecords[i]);
                                    }
                                    for (int i = 0; i < records.Where(a => a.IdworkOperationByStage > 0).Count(); i++)
                                    {
                                        if (!found.Any(a => a != null && a.KeyName.Trim().Equals(records[i].KeyName.Trim())))
                                            found.AddRange(WorkOperationMenulist.Where(s => s.IdworkOperationByStage == records[i].IdworkOperationByStage).ToList());
                                        if (found.Count() != 0)
                                        {
                                            count++;
                                        }
                                    }
                                }

                            }
                        }


                        if (count > 0)
                        {
                            for (int i = 0; i < found.Count(); i++)
                            {
                                if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(found[i].Name.Trim())))
                                {
                                    duplicateItemloopOption = 0;
                                    GetAllTreeListOption(found[i], WorkOperationMenulist);
                                }

                            }
                        }
                        else
                        {

                            if (!records.Any(a => a.Name.Equals("All")))
                                foreach (WorkOperationByStages item in found)
                                {
                                    duplicateItemloopOption = 0;
                                    GetAllTreeListOption(item, WorkOperationMenulist);
                                }
                        }
                        if (!records.Any(a => a.Name.Equals("All")))
                            if (operationOptionMenulist != null)
                            {
                                var tempModuleMenulist = operationOptionMenulist.ToList();
                                for (int i = 0; i < tempModuleMenulist.Count; i++)
                                {
                                    if (GetStages.Any(a => a.Code.Equals(tempModuleMenulist[i].Name)))
                                    {
                                        List<WorkOperationByStages> childList = operationOptionMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(tempModuleMenulist[i].KeyName)).ToList();
                                        if (childList.Count == 0)
                                        {
                                            operationOptionMenulist.Remove(tempModuleMenulist[i]);
                                        }
                                    }
                                }
                            }

                        #region [GEOS2-5020][Rupali Sarode][29-11-2023]
                        List<string> WOWithStatusList;

                        WOWithStatusList = new List<string>();
                        string WOStausForChild = string.Empty;

                        List<WorkOperationByStages> WOChilds = operationOptionMenulist.Where(i => i.ParentName != null && i.ParentName == records[0].KeyName).ToList();
                        if (WOChilds != null)
                        {
                            if (WOChilds.Count == 0) //If dropped item is child
                            {
                                if (records[0].Name != "All")
                                {
                                    int WOIdStatus = operationOptionMenulist.Where(i => i.Name == records[0].Name).FirstOrDefault().IdStatus;
                                    if (WOIdStatus > 0 && WOIdStatus != 1535)
                                    {
                                        if (WOIdStatus == 1536) WOStausForChild = "in inactive status";
                                        if (WOIdStatus == 1537) WOStausForChild = "in draft status";

                                        if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                                        CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("AddEditSODDragOnlyActiveWO").ToString() + "\n" + "Work operation '" + records[0].Name + "' is " + WOStausForChild), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                                        return;
                                    }
                                }

                            }
                        }

                        #endregion [GEOS2-5020][Rupali Sarode][29-11-2023]

                        #region commonCode

                        bool FlagAddItemToList; // [GEOS2-5020][Rupali Sarode][29-11-2023]

                        #region [GEOS2-4830][gulab lakade][07 12 2023]
                        if (AllSupplementsBoxMenu != null)
                        {
                            var listadoDuplicadas = from c in AllSupplementsBoxMenu
                                                    join c2 in AllSupplementsBoxMenu on c.Item2 equals c2.Item2
                                                    where c != c2
                                                    select c;

                            var OptionSandardOperationTime = listadoDuplicadas.FirstOrDefault();
                            if (OptionSandardOperationTime != null)
                            {
                                var templist = listadoDuplicadas.Where(a => a.Item2 == OptionSandardOperationTime.Item2);
                                listadoDuplicadas = templist;
                            }

                            var tempSupplementsBoxMenu = AllSupplementsBoxMenu;

                            ColumnsOptionForSupplements = new ObservableCollection<TreeListColumn>();
                            ColumnsOptionForSupplements.Add(new TreeListColumn()
                            {
                                FieldName = "OptionStandardSupplements",
                                Header = "Standard",
                                HeaderToolTip = "Standard",
                                AllowCellMerge = false,
                                Width = 150,    //gulab lakade not show supplement proper
                                AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                Visible = true,
                                ReadOnly = false,
                                FixedWidth = false
                            });

                            ColumnsOptionOperationTime = new ObservableCollection<TreeListColumn>();
                            ColumnsOptionOperationTime.Add(new TreeListColumn()
                            {
                                FieldName = "UiTempStandardOperationTimeName",
                                Header = "Standard",
                                HeaderToolTip = "Standard",
                                AllowCellMerge = false,
                                Width = 150,    //not show StandardOperationTime proper
                                AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                Visible = true,
                                ReadOnly = false,
                                FixedWidth = false
                            });

                            int Suplimentcount = 1;
                            var ColumnsOptionList = tempSupplementsBoxMenu.Where(p => !listadoDuplicadas.Any(p2 => p2.Item1 == p.Item1));
                            foreach (var item in ColumnsOptionList)
                            {
                                if (Suplimentcount == 5)
                                {
                                    ColumnsOptionForSupplements.Add(new TreeListColumn()
                                    {
                                        FieldName = "OptionSupplementPlant" + Suplimentcount + "Value",
                                        Header = "Others",
                                        HeaderToolTip = "Others",
                                        AllowCellMerge = false,
                                        Width = 60,
                                        AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                        Visible = true,
                                        ReadOnly = false,
                                        FixedWidth = false
                                    });
                                    ColumnsOptionOperationTime.Add(new TreeListColumn()
                                    {
                                        FieldName = "UiTempoperationTimePlant" + Suplimentcount + "Value",
                                        Header = "Others",
                                        HeaderToolTip = "Others",
                                        AllowCellMerge = false,
                                        Width = 60,
                                        AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                        Visible = true,
                                        ReadOnly = false,
                                        FixedWidth = false
                                    });
                                    break;
                                }
                                if (Suplimentcount == 5)
                                {
                                    break;
                                }
                                ColumnsOptionForSupplements.Add(new TreeListColumn()
                                {
                                    FieldName = "OptionSupplementPlant" + Suplimentcount + "Value",
                                    Header = item.Item1,
                                    HeaderToolTip = item.Item1,
                                    AllowCellMerge = false,
                                    Width = 60,
                                    AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                    Visible = true,
                                    ReadOnly = false,
                                    FixedWidth = false
                                });

                                ColumnsOptionOperationTime.Add(new TreeListColumn()
                                {
                                    FieldName = "UiTempoperationTimePlant" + Suplimentcount + "Value",
                                    Header = item.Item1,
                                    HeaderToolTip = item.Item1,
                                    AllowCellMerge = false,
                                    Width = 60,
                                    AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                    Visible = true,
                                    ReadOnly = false,
                                    FixedWidth = false
                                });
                                Suplimentcount = Suplimentcount + 1;
                            }
                            #endregion
                            foreach (WorkOperationByStages Option in WorkOperationMenulist)
                            {
                                FlagAddItemToList = true; //[GEOS2-5020][Rupali Sarode][29-11-2023]

                                //if (Option.IdStatus != 1536)
                                if (operationOptionMenulist.Any(a => a.IdworkOperationByStage == Convert.ToInt64(Option.IdworkOperationByStage))
                                   && operationOptionMenulist.Any(a => a.IdStage == Option.IdStage)
                                && operationOptionMenulist.Any(a => a.Name.Trim().Equals(Option.Name.Trim()))
                                )
                                {

                                    //[GEOS2-5020][Rupali Sarode][30-11-2023] 
                                    List<WorkOperationByStages> TempWOChilds = new List<WorkOperationByStages>();
                                    TempWOChilds = operationOptionMenulist.Where(i => i.ParentName == Option.KeyName).ToList();

                                    if (GetStages.Any(a => a.Code.Equals(Option.Name)))
                                    //If it is stage and only one parent is selected which is inactive/draft, then do not add such a stage to list
                                    {
                                        List<WorkOperationByStages> childListInActiveDraft = operationOptionMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(Option.KeyName)).ToList();

                                        if (childListInActiveDraft.Count > 0)
                                        {
                                            foreach (WorkOperationByStages objChild in childListInActiveDraft)
                                            {
                                                List<WorkOperationByStages> GrandChildListInActiveDraft = new List<WorkOperationByStages>();
                                                GrandChildListInActiveDraft = operationOptionMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(objChild.KeyName)).ToList();
                                                if (GrandChildListInActiveDraft.Count == 0)
                                                { // If it is child and Active
                                                    if (objChild.IdStatus == 1535)
                                                    {
                                                        FlagAddItemToList = true;
                                                        break;
                                                    }
                                                    else
                                                    {
                                                        FlagAddItemToList = false;
                                                    }

                                                }
                                                else
                                                {
                                                    if (GrandChildListInActiveDraft.Count > 0)
                                                    {
                                                        if (GrandChildListInActiveDraft.Where(i => i.IdStatus == 1535).Count() > 0)
                                                        {
                                                            FlagAddItemToList = true;
                                                            break;
                                                        }
                                                        else
                                                        {
                                                            FlagAddItemToList = false;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    else if (TempWOChilds.Count() > 0 && (TempWOChilds.Count() == TempWOChilds.Where(i => i.IdStatus != 1535).Count()))
                                    // All children are in inactive/draft status
                                    {
                                        // do not add such parent to list in grid
                                        FlagAddItemToList = false;
                                    }
                                    //}
                                    else
                                    if (TempWOChilds.Count == 0 && Option.IdStatus != 1535)
                                    // If child is inactive/draft, do not add it.
                                    // If Parent is inactive/draft, add it only if it has inactive/draft child(s).
                                    {
                                        if (string.IsNullOrEmpty(WOWithStatusMessage))
                                        {
                                            if (Option.IdStatus == 1536)
                                                WOWithStatusMessage = "Work operation '" + Option.Name + "' is " + "in inactive status";
                                            else if (Option.IdStatus == 1537)
                                                WOWithStatusMessage = "Work operation '" + Option.Name + "' is " + "in draft status";
                                        }
                                        else
                                        {
                                            if (Option.IdStatus == 1536)
                                                WOWithStatusMessage = WOWithStatusMessage + "\n" + "Work operation '" + Option.Name + "' is " + "in inactive status";
                                            else if (Option.IdStatus == 1537)
                                                WOWithStatusMessage = WOWithStatusMessage + "\n" + "Work operation '" + Option.Name + "' is " + "in draft status";
                                        }
                                        FlagAddItemToList = false;

                                    }

                                    //if (Option.IdStatus != 1536 && Option.IdStatus != 1537) //[GEOS2-5020][Rupali Sarode][30-11-2023]
                                    //{

                                    ERMSOPOptions eRMSOPOption = new ERMSOPOptions();
                                    eRMSOPOption.Name = Option.Name;
                                    eRMSOPOption.IdworkOperationByStage = Option.IdworkOperationByStage;
                                    eRMSOPOption.IdSequence = Option.IdSequence;
                                    eRMSOPOption.IdStatus = Option.IdStatus;
                                    eRMSOPOption.Status = Option.Status;
                                    eRMSOPOption.Code = Option.Name;
                                    eRMSOPOption.Parent = Option.Parent;
                                    eRMSOPOption.IdParent = Option.IdParent;
                                    eRMSOPOption.KeyName = Option.KeyName;
                                    eRMSOPOption.ParentName = Option.ParentName;
                                    eRMSOPOption.Position = Option.Position;
                                    #region [GEOS2-5629][gulab lakade][16 07 2024]
                                    if (OptionsMenulistTemp != null)
                                    {
                                        if (Option.ParentName == null)
                                        {
                                            eRMSOPOption.OptionPosition = Option.Position;
                                        }
                                        else
                                        {
                                            #region [gulab lakade][beta changes][01082024]
                                            if (OptionsMenulistTemp.Count() == 0)
                                            {
                                                if (Option.Position == 1)
                                                {
                                                    eRMSOPOption.OptionPosition = Option.Position;
                                                }
                                                else
                                                {
                                                    eRMSOPOption.OptionPosition = 1;
                                                }

                                            }
                                            else
                                            {
                                                #endregion
                                                var TempModule = OptionsMenulistTemp.Where(x => x.KeyName == Option.KeyName).FirstOrDefault();
                                                if (TempModule != null)
                                                {
                                                    eRMSOPOption.OptionPosition = TempModule.OptionPosition;
                                                }
                                                else
                                                {
                                                    if (OptionsMenulistTemp.Where(x => x.ParentName == Option.ParentName).FirstOrDefault() == null)
                                                    {
                                                        var maxpos = OptionsMenulistTemp.Max(a => a.OptionPosition);
                                                        eRMSOPOption.OptionPosition = maxpos + 1;
                                                    }
                                                    else
                                                    {
                                                        var maxpos = OptionsMenulistTemp.Where(x => x.ParentName == Option.ParentName).Max(a => a.OptionPosition);
                                                        eRMSOPOption.OptionPosition = maxpos + 1;
                                                    }

                                                }
                                            }//[gulab lakade][beta changes][01082024]
                                        }

                                    }
                                    #endregion
                                    eRMSOPOption.WorkOperation_count = Option.WorkOperation_count;
                                    eRMSOPOption.WorkOperation_count_original = Option.WorkOperation_count_original;
                                    eRMSOPOption.NameWithWorkOperationCount = Option.NameWithWorkOperationCount;

                                    ERMOptions tIdDetection = (ERMOptions)SelectedItemOption;  //[GEOS2-3924][Rupali Sarode][21-11-2022]
                                    eRMSOPOption.IdDetection = Convert.ToUInt64(tIdDetection.IdDetection); //[GEOS2-3924][Rupali Sarode][21-11-2022]


                                    eRMSOPOption.OptionActivity = Option.Activity;
                                    if (eRMSOPOption.OptionActivity != 0)
                                        eRMSOPOption.OptionActivity = Math.Round((double)Option.Activity, 2);
                                    if (eRMSOPOption.OptionActivity == 0)
                                        eRMSOPOption.OptionActivity = null;

                                    eRMSOPOption.OptionNormalTime = Option.NormalTime;
                                    eRMSOPOption.OptionObservedTime = Option.ObservedTime;

                                    if (Option.NormalTime != null)
                                    {
                                        eRMSOPOption.OptionNormalTime = Math.Round((double)Option.NormalTime, 2);
                                        #region [GEOS2-3954][Rupali Sarode]
                                        eRMSOPOption.UITempOptionNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(eRMSOPOption.OptionNormalTime));
                                        #endregion
                                    }

                                    if (Option.ObservedTime != null)
                                    {
                                        eRMSOPOption.OptionObservedTime = Math.Round((double)Option.ObservedTime, 2);
                                        #region [GEOS2-3954][Rupali Sarode]
                                        eRMSOPOption.UITempOptionObservedTime = ConvertfloattoTimespan(eRMSOPOption.OptionObservedTime.ToString());
                                        #endregion
                                    }


                                    //eRMSOPOption.OptionActivity = Option.Activity;
                                    //if (eRMSOPOption.OptionActivity != 0)
                                    //    eRMSOPOption.OptionActivity = Math.Round((double)Option.Activity, 2);
                                    //if (eRMSOPOption.OptionActivity == 0)
                                    //    eRMSOPOption.OptionActivity = null;

                                    //[GEOS2-3933][Rupali Sarode][22/09/2022]
                                    eRMSOPOption.WORemarks = Option.WORemarks == null ? "" : Option.WORemarks.Trim();

                                    if (GetStages.Any(a => a != null && a.Code.Trim().Equals(Option.Name.Trim())))
                                    {
                                        Option.IsCurrentWorkOperation = true;
                                        eRMSOPOption.IsDeleteButton = false;
                                        eRMSOPOption.IsDeleteButtonVisibility = Visibility.Hidden;
                                        eRMSOPOption.IsValidateOnTextInput = false;
                                    }
                                    else
                                    {
                                        Option.IsCurrentWorkOperation = true;

                                        eRMSOPOption.IsValidateOnTextInput = true;
                                    }
                                    if (Option.IdStatus == 1536)
                                    {
                                        eRMSOPOption.IsInactiveWorkOperation = true;
                                    }
                                    #region [GEOS2-4830][gulab lakade][07 12 2023]
                                    if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(eRMSOPOption.Name.Trim())))
                                    {
                                        if (OptionSandardOperationTime != null)
                                            eRMSOPOption.OptionStandardSupplements = (float?)OptionSandardOperationTime.Item2;
                                        if (tempSupplementsBoxMenu.Any(p => !listadoDuplicadas.Any(p2 => p2.Item1 == p.Item1)))
                                        {
                                            eRMSOPOption.AllSupplementsBoxMenu = AllSupplementsBoxMenu;
                                            List<float?> lst = new List<float?>();

                                            var a = ColumnsOptionList.ToList();
                                            for (int i = 0; i < a.Count(); i++)
                                            {
                                                lst.Add((float?)a[i].Item2);
                                            }

                                            if (ColumnsOptionList.Count() == 1)
                                            {
                                                eRMSOPOption.OptionSupplementPlant1Value = (float?)lst[0];
                                            }
                                            else if (ColumnsOptionList.Count() == 2)
                                            {
                                                eRMSOPOption.OptionSupplementPlant1Value = (float?)lst[0];
                                                eRMSOPOption.OptionSupplementPlant2Value = (float?)lst[1];
                                            }
                                            else if (ColumnsOptionList.Count() == 3)
                                            {
                                                eRMSOPOption.OptionSupplementPlant1Value = (float?)lst[0];
                                                eRMSOPOption.OptionSupplementPlant2Value = (float?)lst[1];
                                                eRMSOPOption.OptionSupplementPlant3Value = (float?)lst[2];
                                            }
                                            else if (ColumnsOptionList.Count() == 4)
                                            {
                                                eRMSOPOption.OptionSupplementPlant1Value = (float?)lst[0];
                                                eRMSOPOption.OptionSupplementPlant2Value = (float?)lst[1];
                                                eRMSOPOption.OptionSupplementPlant3Value = (float?)lst[2];
                                                eRMSOPOption.OptionSupplementPlant4Value = (float?)lst[3];
                                            }
                                            else if (ColumnsOptionList.Count() == 5)
                                            {
                                                eRMSOPOption.OptionSupplementPlant1Value = (float?)lst[0];
                                                eRMSOPOption.OptionSupplementPlant2Value = (float?)lst[1];
                                                eRMSOPOption.OptionSupplementPlant3Value = (float?)lst[2];
                                                eRMSOPOption.OptionSupplementPlant4Value = (float?)lst[3];
                                                eRMSOPOption.OptionSupplementPlant5Value = (float?)lst[4];
                                            }
                                            else
                                            {
                                                eRMSOPOption.OptionSupplementPlant1Value = (float?)lst[0];
                                                eRMSOPOption.OptionSupplementPlant2Value = (float?)lst[1];
                                                eRMSOPOption.OptionSupplementPlant3Value = (float?)lst[2];
                                                eRMSOPOption.OptionSupplementPlant4Value = (float?)lst[3];
                                                eRMSOPOption.OptionSupplementPlant5Value = 0;
                                                if (ColumnsOptionList.Count() > 5)
                                                {
                                                    for (int q = 4; q < ColumnsOptionList.Count(); q++)
                                                    {
                                                        if (eRMSOPOption.OptionSupplementPlant5Value == null)
                                                            eRMSOPOption.OptionSupplementPlant5Value = 0;
                                                        eRMSOPOption.OptionSupplementPlant5Value = eRMSOPOption.OptionSupplementPlant5Value + (float?)lst[q];
                                                    }
                                                }


                                            }

                                        }
                                        #region GEOS2-4046 Gulab Lakade
                                        if (OptionSandardOperationTime != null)
                                            eRMSOPOption.OptionStandardOperationTime = (float?)Math.Round(Convert.ToDouble(eRMSOPOption.OptionNormalTime * (1 + (Convert.ToDouble(OptionSandardOperationTime.Item2) / 100))), 2);

                                        eRMSOPOption.OptionOperationTimePlant1Value = (float?)Math.Round(Convert.ToDouble(eRMSOPOption.OptionNormalTime * (1 + (Convert.ToDouble(eRMSOPOption.OptionSupplementPlant1Value) / 100))), 2);
                                        eRMSOPOption.OptionOperationTimePlant2Value = (float?)Math.Round(Convert.ToDouble(eRMSOPOption.OptionNormalTime * (1 + (Convert.ToDouble(eRMSOPOption.OptionSupplementPlant2Value) / 100))), 2);
                                        eRMSOPOption.OptionOperationTimePlant3Value = (float?)Math.Round(Convert.ToDouble(eRMSOPOption.OptionNormalTime * (1 + (Convert.ToDouble(eRMSOPOption.OptionSupplementPlant3Value) / 100))), 2);
                                        eRMSOPOption.OptionOperationTimePlant4Value = (float?)Math.Round(Convert.ToDouble(eRMSOPOption.OptionNormalTime * (1 + (Convert.ToDouble(eRMSOPOption.OptionSupplementPlant4Value) / 100))), 2);
                                        eRMSOPOption.OptionOperationTimePlant5Value = (float?)Math.Round(Convert.ToDouble(eRMSOPOption.OptionNormalTime * (1 + (Convert.ToDouble(eRMSOPOption.OptionSupplementPlant5Value) / 100))), 2);
                                        #endregion
                                        #region GEOS2-3954 Show the WorkOperations and SOD Time in the format: MM:SS or HH:MM:SS
                                        try
                                        {
                                            eRMSOPOption.UiTempStandardOperationTimeName = ConvertfloattoTimespan(Convert.ToString(eRMSOPOption.OptionStandardOperationTime));
                                            eRMSOPOption.UiTempoperationTimePlant1Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPOption.OptionOperationTimePlant1Value));
                                            eRMSOPOption.UiTempoperationTimePlant2Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPOption.OptionOperationTimePlant2Value));
                                            eRMSOPOption.UiTempoperationTimePlant3Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPOption.OptionOperationTimePlant3Value));
                                            eRMSOPOption.UiTempoperationTimePlant4Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPOption.OptionOperationTimePlant4Value));
                                            eRMSOPOption.UiTempoperationTimePlant5Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPOption.OptionOperationTimePlant5Value));
                                        }
                                        catch (Exception ex)
                                        {
                                            GeosApplication.Instance.Logger.Log(string.Format("Error in Method FillOptionGridColumn() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                        }
                                        #endregion
                                    }
                                    #endregion
                                    try
                                    {
                                        // if (!OptionsMenulistTemp.Any(a => a.KeyName.Equals(Option.KeyName)))
                                        if (!OptionsMenulistTemp.Any(a => a.KeyName.Equals(Option.KeyName)) && FlagAddItemToList == true)  //  [GEOS2-5020][Rupali Sarode][29-11-2023]
                                        {
                                            OptionsMenulistTemp.Add(eRMSOPOption);
                                        }

                                    }
                                    catch (Exception ex)
                                    {

                                    }
                                    //}
                                }
                            }
                        }//[GEOS2-4830][gulab lakade][07 12 2023]
                        #endregion
                    }
                    //List<ERMSOPOptions> tempWorkOperationOptionMenulist = OptionsMenulistTemp.OrderBy(x => x.Position).ToList();
                    List<ERMSOPOptions> tempWorkOperationOptionMenulist = OptionsMenulistTemp.OrderBy(x => x.OptionPosition).ToList();
                    OptionsMenulistTemp.Clear();
                    OptionsMenulistTemp.AddRange(tempWorkOperationOptionMenulist);
                    tempWorkOperationOptionMenulist.Clear();
                    #region RND
                    #region calculation
                    #region [GEOS2-4830][gulab lakade][07 12 2023]
                    //if (OptionsMenulistTemp != null)
                    //    //foreach (ERMSOPDetection itemERMSOPDetection in DetectionMenulist)
                    //    for (int d = 0; d < OptionsMenulistTemp.Count(); d++)
                    //    {
                    //        WorkOperationMenulist.Where(w => w.KeyName == OptionsMenulistTemp[d].KeyName).ToList().ForEach(f => f.IsCurrentWorkOperation = true);
                    //        var listCount = OptionsMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(OptionsMenulistTemp[d].KeyName) && w.IsInactiveWorkOperation == false).ToList();
                    //        if (listCount != null)
                    //            if (listCount.Count() > 0)
                    //            {
                    //                // decimal a = listCount.Sum(s => s.OptionObservedTime);

                    //                OptionsMenulistTemp[d].OptionObservedTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.OptionObservedTime)), 2);
                    //                OptionsMenulistTemp[d].OptionNormalTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.OptionNormalTime)), 2);

                    //                //[GEOS2-3954][Rupali Sarode]
                    //                OptionsMenulistTemp[d].UITempOptionObservedTime = ConvertfloattoTimespan(Convert.ToString(Convert.ToDouble(listCount.Sum(s => s.OptionObservedTime))));
                    //                OptionsMenulistTemp[d].UITempOptionNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(Convert.ToDouble(listCount.Sum(s => s.OptionNormalTime))));

                    //                OptionsMenulistTemp[d].IsReadOnly = true;
                    //            }
                    //    }
                    #endregion

                    if (OptionsMenulistTemp != null)
                        for (int d = 0; d < OptionsMenulistTemp.Count(); d++)
                        {
                            WorkOperationMenulist.Where(w => w.KeyName == OptionsMenulistTemp[d].KeyName).ToList().ForEach(f => f.IsCurrentWorkOperation = true);
                            //[GEOS2-5135][Rupali Sarode][18-12-2023]
                            //var listCount = OptionsMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(OptionsMenulistTemp[d].KeyName) && w.IsInactiveWorkOperation == false).ToList();
                            var listCount = OptionsMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(OptionsMenulistTemp[d].KeyName)).ToList();
                            if (listCount != null)
                                if (listCount.Count() > 0)
                                {
                                    OptionsMenulistTemp[d].OptionObservedTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.OptionObservedTime)), 2);
                                    OptionsMenulistTemp[d].OptionNormalTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.OptionNormalTime)), 2);

                                    //[GEOS2-3954][Rupali Sarode]
                                    OptionsMenulistTemp[d].UITempOptionObservedTime = ConvertfloattoTimespan(Convert.ToString(listCount.Sum(s => s.OptionObservedTime)));
                                    OptionsMenulistTemp[d].UITempOptionNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(listCount.Sum(s => s.OptionNormalTime)));

                                    OptionsMenulistTemp[d].IsReadOnly = true;
                                }
                        }

                    if (OptionsMenulistTemp != null)
                        //foreach (ERMSOPDetection itemERMSOPDetection in DetectionMenulist)
                        for (int d = 0; d < OptionsMenulistTemp.Count(); d++)
                        {
                            if (GetStages.Any(a => a.Code.Equals(OptionsMenulistTemp[d].Name)))
                            {
                                ObservableCollection<ERMSOPOptions> ActivitySum = new ObservableCollection<ERMSOPOptions>();
                                ObservableCollection<ERMSOPOptions> TempActivitySum = new ObservableCollection<ERMSOPOptions>();
                                int x = 1;
                                Loop:
                                x++;
                                if (x < 10)
                                {
                                    if (ActivitySum.Count == 0)
                                    {
                                        OptionsMenulistTemp[d].OptionObservedTime = 0;
                                        OptionsMenulistTemp[d].OptionNormalTime = 0;

                                        //[GEOS2-3954][Rupali Sarode]
                                        OptionsMenulistTemp[d].UITempOptionObservedTime = ConvertfloattoTimespan(Convert.ToString(OptionsMenulistTemp[d].OptionObservedTime));
                                        OptionsMenulistTemp[d].UITempOptionNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(OptionsMenulistTemp[d].OptionNormalTime));
                                        //[GEOS2-5135][Rupali Sarode][18-12-2023]
                                        //var ActivitySumList = OptionsMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(OptionsMenulistTemp[d].KeyName) && w.IsInactiveWorkOperation == false).ToList();
                                        var ActivitySumList = OptionsMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(OptionsMenulistTemp[d].KeyName)).ToList();
                                        ActivitySum.AddRange(ActivitySumList);
                                    }
                                    else
                                    {
                                        //foreach (var item in ActivitySum)
                                        //{
                                        //    var ActivitySumList = DetectionMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(item.KeyName)).ToList();
                                        //    if (ActivitySumList != null && ActivitySumList.Count > 0)
                                        //    {

                                        //        foreach (var itemActivity in ActivitySumList)
                                        //        {
                                        //            if (!ActivitySum.Any(ac => ac.KeyName.Equals(itemActivity.KeyName)))
                                        //            {
                                        //                TempActivitySum.Add(itemActivity);
                                        //            }

                                        //        }

                                        //    }

                                        //}
                                        //ActivitySum.AddRange(TempActivitySum);
                                    }


                                    goto Loop;
                                }

                                double? ObservedTime = 0;
                                double? NormalTime = 0;
                                float? StandardTime = 0;
                                float? OperationTimePlant1Value = 0;
                                float? OperationTimePlant2Value = 0;
                                float? OperationTimePlant3Value = 0;
                                float? OperationTimePlant4Value = 0;
                                float? OperationTimePlant5Value = 0;
                                var tempDistinctList = ActivitySum.Select(xa => xa.KeyName).Distinct().ToList();
                                foreach (var item in tempDistinctList)
                                {
                                    if (OptionsMenulistTemp[d].OptionObservedTime == null)
                                        OptionsMenulistTemp[d].OptionObservedTime = 0;
                                    double? tempObservedTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.OptionObservedTime).FirstOrDefault();
                                    if (tempObservedTime != null)
                                    {
                                        ObservedTime = Math.Round(Convert.ToDouble(ObservedTime + tempObservedTime), 2);
                                        //[GEOS2-3954][Rupali Sarode]
                                        OptionsMenulistTemp[d].UITempOptionObservedTime = ConvertfloattoTimespan(Convert.ToString(ObservedTime));
                                    }
                                    if (OptionsMenulistTemp[d].OptionNormalTime == null)
                                        OptionsMenulistTemp[d].OptionNormalTime = 0;
                                    double? tempNormalTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.OptionNormalTime).FirstOrDefault();
                                    if (tempNormalTime != null)
                                    {
                                        NormalTime = Math.Round(Convert.ToDouble(NormalTime + tempNormalTime), 2);
                                        OptionsMenulistTemp[d].UITempOptionNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(NormalTime));
                                    }

                                }
                                OptionsMenulistTemp[d].OptionObservedTime = ObservedTime;
                                OptionsMenulistTemp[d].OptionNormalTime = NormalTime;

                                //[GEOS2-3954][Rupali Sarode]
                                OptionsMenulistTemp[d].UITempOptionObservedTime = ConvertfloattoTimespan(Convert.ToString(ObservedTime));
                                OptionsMenulistTemp[d].UITempOptionNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(NormalTime));

                                //DetectionMenulist[d].DetectionNormalTime = Math.Round(Convert.ToDouble(ObservedTime * DetectionMenulist[d].DetectionActivity / 100), 2);
                                #region PlantValue


                                foreach (var item in tempDistinctList)
                                {
                                    if (OptionsMenulistTemp[d].OptionStandardOperationTime == null)
                                        OptionsMenulistTemp[d].OptionStandardOperationTime = 0;
                                    float? tempStandardTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.OptionStandardOperationTime).FirstOrDefault();
                                    if (tempStandardTime != null)
                                        StandardTime = StandardTime + tempStandardTime;

                                    if (OptionsMenulistTemp[d].OptionOperationTimePlant1Value == null)
                                        OptionsMenulistTemp[d].OptionOperationTimePlant1Value = 0;
                                    float? tempOperationTimePlant1Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.OptionOperationTimePlant1Value).FirstOrDefault();
                                    if (tempOperationTimePlant1Value != null)
                                        OperationTimePlant1Value = OperationTimePlant1Value + tempOperationTimePlant1Value;

                                    if (OptionsMenulistTemp[d].OptionOperationTimePlant2Value == null)
                                        OptionsMenulistTemp[d].OptionOperationTimePlant2Value = 0;
                                    float? tempOperationTimePlant2Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.OptionOperationTimePlant2Value).FirstOrDefault();
                                    if (tempOperationTimePlant2Value != null)
                                        OperationTimePlant2Value = OperationTimePlant2Value + tempOperationTimePlant2Value;

                                    if (OptionsMenulistTemp[d].OptionOperationTimePlant3Value == null)
                                        OptionsMenulistTemp[d].OptionOperationTimePlant3Value = 0;
                                    float? tempOperationTimePlant3Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.OptionOperationTimePlant3Value).FirstOrDefault();
                                    if (tempOperationTimePlant3Value != null)
                                        OperationTimePlant3Value = OperationTimePlant3Value + tempOperationTimePlant3Value;

                                    if (OptionsMenulistTemp[d].OptionOperationTimePlant4Value == null)
                                        OptionsMenulistTemp[d].OptionOperationTimePlant4Value = 0;
                                    float? tempOperationTimePlant4Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.OptionOperationTimePlant4Value).FirstOrDefault();
                                    if (tempOperationTimePlant4Value != null)
                                        OperationTimePlant4Value = OperationTimePlant4Value + tempOperationTimePlant4Value;

                                    if (OptionsMenulistTemp[d].OptionOperationTimePlant5Value == null)
                                        OptionsMenulistTemp[d].OptionOperationTimePlant5Value = 0;
                                    float? tempOperationTimePlant5Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.OptionOperationTimePlant5Value).FirstOrDefault();
                                    if (tempOperationTimePlant5Value != null)
                                        OperationTimePlant5Value = OperationTimePlant5Value + tempOperationTimePlant5Value;
                                }
                                #endregion
                                OptionsMenulistTemp[d].OptionStandardOperationTime = (float?)Math.Round(Convert.ToDouble(StandardTime), 2);
                                OptionsMenulistTemp[d].OptionOperationTimePlant1Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant1Value), 2);
                                OptionsMenulistTemp[d].OptionOperationTimePlant2Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant2Value), 2);
                                OptionsMenulistTemp[d].OptionOperationTimePlant3Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant3Value), 2);
                                OptionsMenulistTemp[d].OptionOperationTimePlant4Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant4Value), 2);
                                OptionsMenulistTemp[d].OptionOperationTimePlant5Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant5Value), 2);
                                #region GEOS2-3954 Show the WorkOperations and SOD Time in the format: MM:SS or HH:MM:SS
                                try
                                {
                                    OptionsMenulistTemp[d].UiTempStandardOperationTimeName = ConvertfloattoTimespan(Convert.ToString(OptionsMenulistTemp[d].OptionStandardOperationTime));
                                    OptionsMenulistTemp[d].UiTempoperationTimePlant1Value = ConvertfloattoTimespan(Convert.ToString(OptionsMenulistTemp[d].OptionOperationTimePlant1Value));
                                    OptionsMenulistTemp[d].UiTempoperationTimePlant2Value = ConvertfloattoTimespan(Convert.ToString(OptionsMenulistTemp[d].OptionOperationTimePlant2Value));
                                    OptionsMenulistTemp[d].UiTempoperationTimePlant3Value = ConvertfloattoTimespan(Convert.ToString(OptionsMenulistTemp[d].OptionOperationTimePlant3Value));
                                    OptionsMenulistTemp[d].UiTempoperationTimePlant4Value = ConvertfloattoTimespan(Convert.ToString(OptionsMenulistTemp[d].OptionOperationTimePlant4Value));
                                    OptionsMenulistTemp[d].UiTempoperationTimePlant5Value = ConvertfloattoTimespan(Convert.ToString(OptionsMenulistTemp[d].OptionOperationTimePlant5Value));
                                }
                                catch (Exception ex)
                                {
                                    GeosApplication.Instance.Logger.Log(string.Format("Error in Method OptionCustomSummarycalculation() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                }
                                #endregion
                            }
                        }
                    #endregion
                    OptionsMenulist = OptionsMenulistTemp;
                    #endregion
                    //FillOptionGridColumn();//[GEOS2-4830][gulab lakade][07 12 2023]
                    //optionCustomSummarycalculation();//[GEOS2-4830][gulab lakade][07 12 2023]

                    FlagToDragDrop = true;  //[GEOS2-3909][Rupali Sarode][11-11-2022]
                    e.Handled = true;

                    if (!string.IsNullOrEmpty(WOWithStatusMessage)) //  [GEOS2-5020][Rupali Sarode][29-11-2023]
                    {
                        if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                        CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("AddEditSODDragOnlyActiveWO").ToString() + "\n" + WOWithStatusMessage), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                    }
                }
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Method CompleteDropRecorOptionGrid()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in Method CompleteDropRecorOptionGrid()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        private int GetSecondsFromTime(string tempd)
        {
            int i1 = 0;
            int i2 = 0;

            try
            {
                string[] parts = new string[2];
                if (tempd.Contains("."))
                {
                    parts = tempd.Split('.');
                    i1 = int.Parse(parts[0]);
                    i2 = int.Parse(parts[1]);
                    i1 = (i1 * 60) + i2;
                }
                else
                {
                    parts = tempd.Split('.');
                    i1 = int.Parse(parts[0]);
                    i1 = (i1 * 60);
                }

                return i1;
            }
            catch (Exception ex)
            {
                return i1;

            }
        }

        private float GetSecondsFromTimeFormat(TimeSpan vTime)
        {
            float tempfloat = 0;
            try
            {
                int TempOTDay = vTime.Days;
                int TempOTHours = vTime.Hours;
                int TempOTminute = vTime.Minutes;
                int TempOTSecond = vTime.Seconds;
                string tempstring = Convert.ToString(((TempOTDay * 24) + TempOTHours) * 60 + TempOTminute) + "." + TempOTSecond;
                tempfloat = float.Parse(tempstring);
                return tempfloat;
            }
            catch (Exception ex)
            {
                return tempfloat;
            }
        }

        private void FillOptionGridColumn()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillOptionGridColumn()...", category: Category.Info, priority: Priority.Low);

                if (AllSupplementsBoxMenu != null)
                {
                    var listadoDuplicadas = from c in AllSupplementsBoxMenu
                                            join c2 in AllSupplementsBoxMenu on c.Item2 equals c2.Item2
                                            where c != c2
                                            select c;

                    var OptionSandardOperationTime = listadoDuplicadas.FirstOrDefault();
                    if (OptionSandardOperationTime != null)
                    {
                        var templist = listadoDuplicadas.Where(a => a.Item2 == OptionSandardOperationTime.Item2);
                        listadoDuplicadas = templist;
                    }

                    var tempSupplementsBoxMenu = AllSupplementsBoxMenu;

                    ColumnsOptionForSupplements = new ObservableCollection<TreeListColumn>();
                    ColumnsOptionForSupplements.Add(new TreeListColumn()
                    {
                        FieldName = "OptionStandardSupplements",
                        Header = "Standard",
                        HeaderToolTip = "Standard",
                        AllowCellMerge = false,
                        Width = 150,    //gulab lakade not show supplement proper
                        AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                        Visible = true,
                        ReadOnly = false,
                        FixedWidth = false
                    });

                    ColumnsOptionOperationTime = new ObservableCollection<TreeListColumn>();
                    ColumnsOptionOperationTime.Add(new TreeListColumn()
                    {
                        FieldName = "UiTempStandardOperationTimeName",
                        Header = "Standard",
                        HeaderToolTip = "Standard",
                        AllowCellMerge = false,
                        Width = 150,    //not show StandardOperationTime proper
                        AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                        Visible = true,
                        ReadOnly = false,
                        FixedWidth = false
                    });

                    int count = 1;
                    var ColumnsOptionList = tempSupplementsBoxMenu.Where(p => !listadoDuplicadas.Any(p2 => p2.Item1 == p.Item1));
                    foreach (var item in ColumnsOptionList)
                    {
                        if (count == 5)
                        {
                            ColumnsOptionForSupplements.Add(new TreeListColumn()
                            {
                                FieldName = "OptionSupplementPlant" + count + "Value",
                                Header = "Others",
                                HeaderToolTip = "Others",
                                AllowCellMerge = false,
                                Width = 60,
                                AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                Visible = true,
                                ReadOnly = false,
                                FixedWidth = false
                            });
                            ColumnsOptionOperationTime.Add(new TreeListColumn()
                            {
                                FieldName = "UiTempoperationTimePlant" + count + "Value",
                                Header = "Others",
                                HeaderToolTip = "Others",
                                AllowCellMerge = false,
                                Width = 60,
                                AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                Visible = true,
                                ReadOnly = false,
                                FixedWidth = false
                            });
                            break;
                        }
                        if (count == 5)
                        {
                            break;
                        }
                        ColumnsOptionForSupplements.Add(new TreeListColumn()
                        {
                            FieldName = "OptionSupplementPlant" + count + "Value",
                            Header = item.Item1,
                            HeaderToolTip = item.Item1,
                            AllowCellMerge = false,
                            Width = 60,
                            AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                            Visible = true,
                            ReadOnly = false,
                            FixedWidth = false
                        });

                        ColumnsOptionOperationTime.Add(new TreeListColumn()
                        {
                            FieldName = "UiTempoperationTimePlant" + count + "Value",
                            Header = item.Item1,
                            HeaderToolTip = item.Item1,
                            AllowCellMerge = false,
                            Width = 60,
                            AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                            Visible = true,
                            ReadOnly = false,
                            FixedWidth = false
                        });
                        count = count + 1;
                    }


                    if (OptionsMenulist != null)

                        for (int d = 0; d < OptionsMenulist.Count(); d++)
                        {
                            if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(OptionsMenulist[d].Name.Trim())))
                            {
                                if (OptionSandardOperationTime != null)
                                    OptionsMenulist[d].OptionStandardSupplements = (float?)OptionSandardOperationTime.Item2;
                                if (tempSupplementsBoxMenu.Any(p => !listadoDuplicadas.Any(p2 => p2.Item1 == p.Item1)))
                                {
                                    OptionsMenulist[d].AllSupplementsBoxMenu = AllSupplementsBoxMenu;
                                    List<float?> lst = new List<float?>();

                                    var a = ColumnsOptionList.ToList();
                                    for (int i = 0; i < a.Count(); i++)
                                    {
                                        lst.Add((float?)a[i].Item2);
                                    }

                                    if (ColumnsOptionList.Count() == 1)
                                    {
                                        OptionsMenulist[d].OptionSupplementPlant1Value = (float?)lst[0];
                                    }
                                    else if (ColumnsOptionList.Count() == 2)
                                    {
                                        OptionsMenulist[d].OptionSupplementPlant1Value = (float?)lst[0];
                                        OptionsMenulist[d].OptionSupplementPlant2Value = (float?)lst[1];
                                    }
                                    else if (ColumnsOptionList.Count() == 3)
                                    {
                                        OptionsMenulist[d].OptionSupplementPlant1Value = (float?)lst[0];
                                        OptionsMenulist[d].OptionSupplementPlant2Value = (float?)lst[1];
                                        OptionsMenulist[d].OptionSupplementPlant3Value = (float?)lst[2];
                                    }
                                    else if (ColumnsOptionList.Count() == 4)
                                    {
                                        OptionsMenulist[d].OptionSupplementPlant1Value = (float?)lst[0];
                                        OptionsMenulist[d].OptionSupplementPlant2Value = (float?)lst[1];
                                        OptionsMenulist[d].OptionSupplementPlant3Value = (float?)lst[2];
                                        OptionsMenulist[d].OptionSupplementPlant4Value = (float?)lst[3];
                                    }
                                    else if (ColumnsOptionList.Count() == 5)
                                    {
                                        OptionsMenulist[d].OptionSupplementPlant1Value = (float?)lst[0];
                                        OptionsMenulist[d].OptionSupplementPlant2Value = (float?)lst[1];
                                        OptionsMenulist[d].OptionSupplementPlant3Value = (float?)lst[2];
                                        OptionsMenulist[d].OptionSupplementPlant4Value = (float?)lst[3];
                                        OptionsMenulist[d].OptionSupplementPlant5Value = (float?)lst[4];
                                    }
                                    else
                                    {
                                        OptionsMenulist[d].OptionSupplementPlant1Value = (float?)lst[0];
                                        OptionsMenulist[d].OptionSupplementPlant2Value = (float?)lst[1];
                                        OptionsMenulist[d].OptionSupplementPlant3Value = (float?)lst[2];
                                        OptionsMenulist[d].OptionSupplementPlant4Value = (float?)lst[3];
                                        OptionsMenulist[d].OptionSupplementPlant5Value = 0;
                                        if (ColumnsOptionList.Count() > 5)
                                        {
                                            for (int q = 4; q < ColumnsOptionList.Count(); q++)
                                            {
                                                if (OptionsMenulist[d].OptionSupplementPlant5Value == null)
                                                    OptionsMenulist[d].OptionSupplementPlant5Value = 0;
                                                OptionsMenulist[d].OptionSupplementPlant5Value = OptionsMenulist[d].OptionSupplementPlant5Value + (float?)lst[q];
                                            }
                                        }


                                    }

                                }
                                #region GEOS2-4046 Gulab Lakade
                                if (OptionSandardOperationTime != null)
                                    OptionsMenulist[d].OptionStandardOperationTime = (float?)Math.Round(Convert.ToDouble(OptionsMenulist[d].OptionNormalTime * (1 + (Convert.ToDouble(OptionSandardOperationTime.Item2) / 100))), 2);

                                OptionsMenulist[d].OptionOperationTimePlant1Value = (float?)Math.Round(Convert.ToDouble(OptionsMenulist[d].OptionNormalTime * (1 + (Convert.ToDouble(OptionsMenulist[d].OptionSupplementPlant1Value) / 100))), 2);
                                OptionsMenulist[d].OptionOperationTimePlant2Value = (float?)Math.Round(Convert.ToDouble(OptionsMenulist[d].OptionNormalTime * (1 + (Convert.ToDouble(OptionsMenulist[d].OptionSupplementPlant2Value) / 100))), 2);
                                OptionsMenulist[d].OptionOperationTimePlant3Value = (float?)Math.Round(Convert.ToDouble(OptionsMenulist[d].OptionNormalTime * (1 + (Convert.ToDouble(OptionsMenulist[d].OptionSupplementPlant3Value) / 100))), 2);
                                OptionsMenulist[d].OptionOperationTimePlant4Value = (float?)Math.Round(Convert.ToDouble(OptionsMenulist[d].OptionNormalTime * (1 + (Convert.ToDouble(OptionsMenulist[d].OptionSupplementPlant4Value) / 100))), 2);
                                OptionsMenulist[d].OptionOperationTimePlant5Value = (float?)Math.Round(Convert.ToDouble(OptionsMenulist[d].OptionNormalTime * (1 + (Convert.ToDouble(OptionsMenulist[d].OptionSupplementPlant5Value) / 100))), 2);
                                #endregion
                                #region GEOS2-3954 Show the WorkOperations and SOD Time in the format: MM:SS or HH:MM:SS
                                try
                                {
                                    OptionsMenulist[d].UiTempStandardOperationTimeName = ConvertfloattoTimespan(Convert.ToString(OptionsMenulist[d].OptionStandardOperationTime));
                                    OptionsMenulist[d].UiTempoperationTimePlant1Value = ConvertfloattoTimespan(Convert.ToString(OptionsMenulist[d].OptionOperationTimePlant1Value));
                                    OptionsMenulist[d].UiTempoperationTimePlant2Value = ConvertfloattoTimespan(Convert.ToString(OptionsMenulist[d].OptionOperationTimePlant2Value));
                                    OptionsMenulist[d].UiTempoperationTimePlant3Value = ConvertfloattoTimespan(Convert.ToString(OptionsMenulist[d].OptionOperationTimePlant3Value));
                                    OptionsMenulist[d].UiTempoperationTimePlant4Value = ConvertfloattoTimespan(Convert.ToString(OptionsMenulist[d].OptionOperationTimePlant4Value));
                                    OptionsMenulist[d].UiTempoperationTimePlant5Value = ConvertfloattoTimespan(Convert.ToString(OptionsMenulist[d].OptionOperationTimePlant5Value));
                                }
                                catch (Exception ex)
                                {
                                    GeosApplication.Instance.Logger.Log(string.Format("Error in Method FillOptionGridColumn() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                }
                                #endregion
                            }
                        }
                    //foreach (ERMSOPDetection itemERMSOPOption in DetectionMenulist)
                    //{
                    //    if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(itemERMSOPOption.Name.Trim())))
                    //    {
                    //        if (OptionSandardOperationTime != null)
                    //            itemERMSOPOption.StandardSupplements = (float?)DetectionSandardOperationTime.Item2;
                    //        if (tempSupplementsBoxMenu.Any(p => !listadoDuplicadas.Any(p2 => p2.Item1 == p.Item1)))
                    //        {
                    //            itemERMSOPDetection.AllSupplementsBoxMenu = AllSupplementsBoxMenu;
                    //            List<float?> lst = new List<float?>();

                    //            var a = ColumnsDetectionList.ToList();
                    //            for (int i = 0; i < a.Count(); i++)
                    //            {
                    //                lst.Add((float?)a[i].Item2);
                    //            }

                    //            if (ColumnsDetectionList.Count() == 1)
                    //            {
                    //                itemERMSOPDetection.SupplementPlant1Value = (float?)lst[0];
                    //            }
                    //            else if (ColumnsDetectionList.Count() == 2)
                    //            {
                    //                itemERMSOPDetection.SupplementPlant1Value = (float?)lst[0];
                    //                itemERMSOPDetection.SupplementPlant2Value = (float?)lst[1];
                    //            }
                    //            else if (ColumnsDetectionList.Count() == 3)
                    //            {
                    //                itemERMSOPDetection.SupplementPlant1Value = (float?)lst[0];
                    //                itemERMSOPDetection.SupplementPlant2Value = (float?)lst[1];
                    //                itemERMSOPDetection.SupplementPlant3Value = (float?)lst[2];
                    //            }
                    //            else if (ColumnsDetectionList.Count() == 4)
                    //            {
                    //                itemERMSOPDetection.SupplementPlant1Value = (float?)lst[0];
                    //                itemERMSOPDetection.SupplementPlant2Value = (float?)lst[1];
                    //                itemERMSOPDetection.SupplementPlant3Value = (float?)lst[2];
                    //                itemERMSOPDetection.SupplementPlant4Value = (float?)lst[3];
                    //            }
                    //            else if (ColumnsDetectionList.Count() == 5)
                    //            {
                    //                itemERMSOPDetection.SupplementPlant1Value = (float?)lst[0];
                    //                itemERMSOPDetection.SupplementPlant2Value = (float?)lst[1];
                    //                itemERMSOPDetection.SupplementPlant3Value = (float?)lst[2];
                    //                itemERMSOPDetection.SupplementPlant4Value = (float?)lst[3];
                    //                itemERMSOPDetection.SupplementPlant5Value = (float?)lst[4];
                    //            }
                    //            else
                    //            {
                    //                itemERMSOPDetection.SupplementPlant1Value = (float?)lst[0];
                    //                itemERMSOPDetection.SupplementPlant2Value = (float?)lst[1];
                    //                itemERMSOPDetection.SupplementPlant3Value = (float?)lst[2];
                    //                itemERMSOPDetection.SupplementPlant4Value = (float?)lst[3];
                    //                itemERMSOPDetection.SupplementPlant5Value = 0;
                    //                if (ColumnsDetectionList.Count() > 5)
                    //                {
                    //                    for (int q = 4; q < ColumnsDetectionList.Count(); q++)
                    //                    {
                    //                        if (itemERMSOPDetection.SupplementPlant5Value == null)
                    //                            itemERMSOPDetection.SupplementPlant5Value = 0;
                    //                        itemERMSOPDetection.SupplementPlant5Value = itemERMSOPDetection.SupplementPlant5Value + (float?)lst[q];
                    //                    }
                    //                }


                    //            }

                    //        }

                    //if (OptionSandardOperationTime != null)
                    //    itemERMSOPDetection.StandardOperationTime = (float?)(itemERMSOPDetection.NormalTime * (1 + (DetectionSandardOperationTime.Item2 / 100)));

                    //itemERMSOPDetection.OperationTimePlant1Value = (float?)(itemERMSOPDetection.NormalTime * (1 + (itemERMSOPDetection.SupplementPlant1Value / 100)));
                    //itemERMSOPDetection.OperationTimePlant2Value = (float?)(itemERMSOPDetection.NormalTime * (1 + (itemERMSOPDetection.SupplementPlant2Value / 100)));
                    //itemERMSOPDetection.OperationTimePlant3Value = (float?)(itemERMSOPDetection.NormalTime * (1 + (itemERMSOPDetection.SupplementPlant3Value / 100)));
                    //itemERMSOPDetection.OperationTimePlant4Value = (float?)(itemERMSOPDetection.NormalTime * (1 + (itemERMSOPDetection.SupplementPlant4Value / 100)));
                    //itemERMSOPDetection.OperationTimePlant5Value = (float?)(itemERMSOPDetection.NormalTime * (1 + (itemERMSOPDetection.SupplementPlant5Value / 100)));

                    //}
                    // }
                }
                GeosApplication.Instance.Logger.Log("Method FillOptionGridColumn()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method FillOptionGridColumn() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }


        private void GetAllTreeListOption(WorkOperationByStages StandardOperationsDictionaryModules, ObservableCollection<WorkOperationByStages> WorkOperationMenulist)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method GetAllTreeListOption()...", category: Category.Info, priority: Priority.Low);

                if (StandardOperationsDictionaryModules != null && StandardOperationsDictionaryModules.Name.ToLower() != "All".ToLower())
                {

                    if (Convert.ToInt32(StandardOperationsDictionaryModules.IdParent) == Convert.ToInt32(StandardOperationsDictionaryModules.IdStage))
                    {
                        if (!operationOptionMenulist.Any(a => a.KeyName.Equals(StandardOperationsDictionaryModules.KeyName)))
                            operationOptionMenulist.Add(StandardOperationsDictionaryModules);
                        if (StandardOperationsDictionaryModules.IdParent == null || StandardOperationsDictionaryModules.IdStage == 0)
                        {

                        }
                        else
                        {
                            WorkOperationByStages TempStagesList = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == Convert.ToInt32(StandardOperationsDictionaryModules.IdStage) &&
                            a.KeyName.Equals(("Stage_" + Convert.ToInt32(StandardOperationsDictionaryModules.IdStage)).ToString())).FirstOrDefault();
                            if (duplicateItemloopOption >= 20) { TempStagesList = null; }
                            GetAllTreeListOption(TempStagesList, WorkOperationMenulist);
                        }
                    }
                    else
                    {
                        if (operationOptionMenulist.Any(a => a.IdworkOperationByStage == Convert.ToInt64(StandardOperationsDictionaryModules.IdworkOperationByStage)))
                        {
                            duplicateItemloopOption = duplicateItemloopOption + 1;
                            if (duplicateItemloopOption >= 20)
                            {
                                GetAllTreeListOption(null, WorkOperationMenulist);
                            }
                        }
                        else
                        {
                            if (!operationOptionMenulist.Any(a => a.KeyName.Equals(StandardOperationsDictionaryModules.KeyName)))
                                operationOptionMenulist.Add(StandardOperationsDictionaryModules);
                        }
                        List<WorkOperationByStages> TempList = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == Convert.ToInt32(StandardOperationsDictionaryModules.IdParent)).ToList();
                        if (duplicateItemloopOption >= 20) { TempList = null; }
                        if (TempList != null)
                            foreach (WorkOperationByStages itemWorkOperationByStages in TempList)
                            {
                                GetAllTreeListOption(itemWorkOperationByStages, WorkOperationMenulist);
                            }
                    }

                }
                GeosApplication.Instance.Logger.Log("Method GetAllTreeListOption()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method GetAllTreeListOption()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        private void FillOptionGroupsMenulist()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillOptionGroupsMenulist()...", category: Category.Info, priority: Priority.Low);

                OptionsGroups = new List<ERMOptionsGroups>(ERMService.GetAllOptionGroups_V2460().ToList());
                OptionsMenulistForGridLayout = new ObservableCollection<ERMOptions>(ERMService.GetAllOptions_V2460().ToList());

                if (DetectionGroupWithOptions == null)
                    DetectionGroupWithOptions = new ObservableCollection<DetectionGroupWithOptions>();

                if (DetectionGroupWithOptions.Count() == 0)
                {
                    // Sort groups, placing "No group" last
                    OptionsGroups = new List<ERMOptionsGroups>(
                        OptionsGroups
                            .OrderBy(group => group.Name == "NO GROUP")
                            .ThenBy(group => group.Name, new AlphanumericComparer())
                    );

                    foreach (var item in OptionsGroups)
                    {
                        DetectionGroupWithOptions TempDetectionGroupWithOptions = new DetectionGroupWithOptions();
                        TempDetectionGroupWithOptions.Options = OptionsMenulistForGridLayout
                            .Where(w => w != null && w.IdGroup == item.IdGroup)
                            .OrderBy(option => option.Name, new AlphanumericComparer())
                            .ToList();

                        #region [28 12 2022]
                        foreach (var item1 in TempDetectionGroupWithOptions.Options)
                        {
                            UInt64 Iddetection = Convert.ToUInt64(item1.IdDetection);
                            int OptionTypecount = tempLstStandardOperationsDictionaryOption
                                .Where(x => x.IdDetection == Iddetection)
                                .ToList()
                                .Count();

                            item1.Name = item1.Name + "  (" + OptionTypecount + ")";
                        }
                        #endregion

                        TempDetectionGroupWithOptions.Name = item.Name + "  (" + TempDetectionGroupWithOptions.Options.Count() + ")";
                        DetectionGroupWithOptions.Add(TempDetectionGroupWithOptions);
                    }
                }

                SelectedItemOption = DetectionGroupWithOptions.First();

                GeosApplication.Instance.Logger.Log("Method FillOptionGroupsMenulist()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log($"Error in Method FillOptionGroupsMenulist() - {ex.Message}", category: Category.Exception, priority: Priority.Low);
            }
        }



        public class AlphanumericComparer : IComparer<string>
        {
            public int Compare(string x, string y)
            {
                int chunkXStart = 0, chunkYStart = 0;

                while (chunkXStart < x.Length && chunkYStart < y.Length)
                {
                    // Find the start of the next chunk in each string
                    int chunkXEnd = chunkXStart + 1;
                    while (chunkXEnd < x.Length && char.IsDigit(x[chunkXEnd]) == char.IsDigit(x[chunkXStart]))
                        chunkXEnd++;

                    int chunkYEnd = chunkYStart + 1;
                    while (chunkYEnd < y.Length && char.IsDigit(y[chunkYEnd]) == char.IsDigit(y[chunkYStart]))
                        chunkYEnd++;

                    // Compare the current chunks
                    int result;
                    if (char.IsDigit(x[chunkXStart]) && char.IsDigit(y[chunkYStart]))
                    {
                        // If both chunks are numeric, compare as integers
                        result = int.Parse(x.Substring(chunkXStart, chunkXEnd - chunkXStart))
                            .CompareTo(int.Parse(y.Substring(chunkYStart, chunkYEnd - chunkYStart)));
                    }
                    else
                    {
                        // If at least one chunk is non-numeric, compare as strings
                        result = string.Compare(x, chunkXStart, y, chunkYStart, chunkXEnd - chunkXStart);
                    }

                    // If chunks are different, return the comparison result
                    if (result != 0)
                        return result;

                    // Move to the next chunks
                    chunkXStart = chunkXEnd;
                    chunkYStart = chunkYEnd;
                }

                // If one string is a prefix of the other, return the length comparison
                return x.Length - y.Length;
            }
        }


        List<StandardOperationsDictionaryOption> standardOperationsDictionaryOptionDeleteList = new List<StandardOperationsDictionaryOption>();
        List<ERMSOPOptions> ERMSOPOptionDeleteList = new List<ERMSOPOptions>();
        List<ERMSOPOptions> ERMSOPOptionDeleteParentList = new List<ERMSOPOptions>();

        private void ERMSOPOptionDeleteAction(List<ERMSOPOptions> deletelist)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ERMSOPOptionDeleteAction()...", category: Category.Info, priority: Priority.Low);

                foreach (ERMSOPOptions item in deletelist)
                {
                    if (!ERMSOPOptionDeleteList.Any(a => a.KeyName.Equals(item.KeyName)))
                    {
                        ERMSOPOptionDeleteList.Add(item);
                        WorkOperationMenulist.Where(w => w.IdworkOperationByStage == item.IdworkOperationByStage).ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                    }

                    List<ERMSOPOptions> isitemExist = OptionsMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(item.KeyName)).ToList();
                    if (deletelist != null || deletelist.Count() > 0)
                    {
                        ERMSOPOptionDeleteAction(isitemExist);
                    }
                }
                GeosApplication.Instance.Logger.Log("Method ERMSOPOptionDeleteAction()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method ERMSOPOptionDeleteAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

            }
        }
        private void ERMSOPOptionDeleteParentAction(List<ERMSOPOptions> deleteParentlist)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ERMSOPOptionDeleteParentAction()...", category: Category.Info, priority: Priority.Low);

                foreach (ERMSOPOptions item in deleteParentlist)
                {
                    if (!ERMSOPOptionDeleteParentList.Any(a => a.KeyName.Equals(item.KeyName)))
                    {
                        ERMSOPOptionDeleteParentList.Add(item);
                        OptionsMenulist.Remove(item);
                        WorkOperationMenulist.Where(w => w.IdworkOperationByStage == item.IdworkOperationByStage).ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                    }
                    List<ERMSOPOptions> isitemExist = OptionsMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(item.ParentName)).ToList();
                    if (isitemExist.Count == 0)
                    {
                        List<ERMSOPOptions> parentlist = OptionsMenulist.Where(w => w.KeyName.Equals(item.ParentName)).ToList();
                        ERMSOPOptionDeleteParentAction(parentlist);
                    }

                }
                GeosApplication.Instance.Logger.Log("Method ERMSOPOptionDeleteParentAction()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method ERMSOPOptionDeleteParentAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

            }
        }
        private void DeleteOptionTreeListControlCommandAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method DeleteOptionTreeListControlCommandAction()...", category: Category.Info, priority: Priority.Low);
                MessageBoxResult MessageBoxResult = CustomMessageBox.Show(String.Format(Application.Current.Resources["WorkOperationsDeleteMessage"].ToString()), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);

                if (MessageBoxResult == MessageBoxResult.Yes)
                {
                    operationMenulist = new ObservableCollection<WorkOperationByStages>();
                    ERMSOPOptionDeleteList = new List<ERMSOPOptions>();
                    ERMSOPOptionDeleteParentList = new List<ERMSOPOptions>();
                    IsEnabledSaveButton = true;
                    SaveButtonVisibility = Visibility.Visible;
                    StandardOperationsDictionary tempSelectedStandardOperationsDictionary = new StandardOperationsDictionary();
                    tempSelectedStandardOperationsDictionary.IdStandardOperationsDictionary = tempLstStandardOperationsDictionaryOption.Select(w => w.IdStandardOperationsDictionary).FirstOrDefault();
                    ERMSOPOptions MainRow = ((ERMSOPOptions)obj);
                    StandardOperationsDictionaryOption standardOperationsDictionaryOption = new StandardOperationsDictionaryOption();
                    if (MainRow != null)
                    {
                        ObservableCollection<ERMSOPOptions> OptionsMenulistTemp = new ObservableCollection<ERMSOPOptions>();
                        OptionsMenulistTemp = OptionsMenulist;
                        #region GEOS2-4046 Gulab Lakade
                        List<ERMSOPOptions> found = new List<ERMSOPOptions>();
                        if (!found.Any(a => a != null && a.KeyName.Trim().Equals(MainRow.KeyName.Trim())))
                            found.AddRange(OptionsMenulistTemp.Where(s => s.IdworkOperationByStage == MainRow.IdworkOperationByStage).ToList());

                        for (int i = 0; i < found.Count(); i++)
                        {

                            standardOperationsDictionaryOption.IdWorkoperation = Convert.ToUInt32(MainRow.IdworkOperationByStage);
                            if (SelectedItemOption is ERMOptions)
                            {
                                ERMOptions eRMOptions = (ERMOptions)SelectedItemOption;
                                standardOperationsDictionaryOption.IdDetection = (UInt64)eRMOptions.IdDetection;
                            }
                            standardOperationsDictionaryOption.ObservedTime = (float?)found[i].OptionObservedTime;
                            #region [GEOS2-3954][Rupali Sarode]
                            standardOperationsDictionaryOption.UITempOptionObservedTime = ConvertfloattoTimespan(Convert.ToString(MainRow.OptionObservedTime));
                            #endregion
                            standardOperationsDictionaryOption.Activity = (float?)found[i].OptionActivity;

                            OptionsMenulistTemp.Remove(found[i]);
                            WorkOperationMenulist.Where(w => w.IdworkOperationByStage == found[i].IdworkOperationByStage).ToList().ForEach(f => f.IsCurrentWorkOperation = false);

                            standardOperationsDictionaryOptionDeleteList.Add(standardOperationsDictionaryOption);
                            List<ERMSOPOptions> deletelist = OptionsMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(found[i].KeyName)).ToList();
                            if (deletelist != null)
                            {
                                ERMSOPOptionDeleteAction(deletelist);
                            }
                            if (ERMSOPOptionDeleteList != null)
                                foreach (ERMSOPOptions item in ERMSOPOptionDeleteList)
                                {
                                    StandardOperationsDictionaryOption standardOperationsDictionary = new StandardOperationsDictionaryOption();
                                    standardOperationsDictionary.IdWorkoperation = Convert.ToUInt32(item.IdworkOperationByStage);
                                    if (SelectedItemOption is ERMOptions)
                                    {
                                        ERMOptions eRMOptions = (ERMOptions)SelectedItemOption;
                                        standardOperationsDictionary.IdDetection = (UInt64)eRMOptions.IdDetection;
                                    }
                                    standardOperationsDictionary.ObservedTime = (float?)item.OptionObservedTime;
                                    #region [GEOS2-3954][Rupali Sarode]
                                    standardOperationsDictionary.UITempOptionObservedTime = ConvertfloattoTimespan(Convert.ToString(item.OptionObservedTime));
                                    #endregion
                                    standardOperationsDictionary.Activity = (float?)item.OptionActivity;
                                    OptionsMenulistTemp.Remove(item);
                                    standardOperationsDictionaryOptionDeleteList.Add(standardOperationsDictionary);
                                }

                            List<ERMSOPOptions> deleteParentlist = OptionsMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(found[i].ParentName)).ToList();
                            if (deleteParentlist.Count == 0)
                            {
                                List<ERMSOPOptions> parentlist = OptionsMenulistTemp.Where(w => w.KeyName.Equals(found[i].ParentName)).ToList();
                                ERMSOPOptionDeleteParentAction(parentlist);
                            }
                            if (ERMSOPOptionDeleteParentList != null)
                                foreach (ERMSOPOptions item in ERMSOPOptionDeleteParentList)
                                {
                                    StandardOperationsDictionaryOption standardOperationsDictionary = new StandardOperationsDictionaryOption();
                                    standardOperationsDictionary.IdWorkoperation = Convert.ToUInt32(item.IdworkOperationByStage);
                                    if (SelectedItemOption is ERMOptions)
                                    {
                                        ERMOptions eRMOptions = (ERMOptions)SelectedItemOption;
                                        standardOperationsDictionary.IdDetection = (UInt64)eRMOptions.IdDetection;
                                    }
                                    standardOperationsDictionary.ObservedTime = (float?)item.OptionObservedTime;
                                    #region [GEOS2-3954][Rupali Sarode]
                                    standardOperationsDictionary.UITempOptionObservedTime = ConvertfloattoTimespan(Convert.ToString(item.OptionObservedTime));
                                    #endregion

                                    standardOperationsDictionary.Activity = (float?)item.OptionActivity;
                                    OptionsMenulistTemp.Remove(item);
                                    standardOperationsDictionaryOptionDeleteList.Add(standardOperationsDictionary);
                                }
                            var tempOptionMenulist = OptionsMenulistTemp.ToList();
                            foreach (ERMSOPOptions itemRemove in tempOptionMenulist)
                            {
                                if (GetStages.Any(a => a.Code.Equals(itemRemove.Name)))
                                {
                                    List<ERMSOPOptions> childList = OptionsMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(itemRemove.KeyName)).ToList();
                                    if (childList.Count == 0)
                                    {
                                        OptionsMenulistTemp.Remove(itemRemove);
                                    }
                                }

                            }
                        }
                        #endregion
                        OptionsMenulist = new ObservableCollection<ERMSOPOptions>();
                        OptionsMenulist = OptionsMenulistTemp;
                    }
                    CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("WorkOperationDeletedSuccess").ToString()), Application.Current.Resources["PopUpSuccessColor"].ToString(), CustomMessageBox.MessageImagePath.Ok, MessageBoxButton.OK);
                }
                GeosApplication.Instance.Logger.Log("Method DeleteOptionTreeListControlCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in DeleteOptionTreeListControlCommandAction() Method " + ex.Detail.ErrorMessage, category: Category.Info, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in DeleteOptionTreeListControlCommandAction() Method - ServiceUnexceptedException " + ex.Message, category: Category.Info, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method DeleteModuleTreeListControlCommandAction()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        private void optionCustomSummarycalculation()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method optionCustomSummarycalculation()...", category: Category.Info, priority: Priority.Low);

                #region calculation
                #region [GEOS2-4830][gulab lakade][07 12 2023]
                //if (OptionsMenulist != null)
                //    //foreach (ERMSOPDetection itemERMSOPDetection in DetectionMenulist)
                //    for (int d = 0; d < OptionsMenulist.Count(); d++)
                //    {
                //        WorkOperationMenulist.Where(w => w.KeyName == OptionsMenulist[d].KeyName).ToList().ForEach(f => f.IsCurrentWorkOperation = true);
                //        var listCount = OptionsMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(OptionsMenulist[d].KeyName) && w.IsInactiveWorkOperation == false).ToList();
                //        if (listCount != null)
                //            if (listCount.Count() > 0)
                //            {
                //                // decimal a = listCount.Sum(s => s.OptionObservedTime);

                //                OptionsMenulist[d].OptionObservedTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.OptionObservedTime)), 2);
                //                OptionsMenulist[d].OptionNormalTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.OptionNormalTime)), 2);

                //                //[GEOS2-3954][Rupali Sarode]
                //                OptionsMenulist[d].UITempOptionObservedTime = ConvertfloattoTimespan(Convert.ToString(Convert.ToDouble(listCount.Sum(s => s.OptionObservedTime))));
                //                OptionsMenulist[d].UITempOptionNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(Convert.ToDouble(listCount.Sum(s => s.OptionNormalTime))));

                //                OptionsMenulist[d].IsReadOnly = true;
                //            }
                //    }
                #endregion

                if (OptionsMenulist != null)
                    for (int d = 0; d < OptionsMenulist.Count(); d++)
                    {
                        WorkOperationMenulist.Where(w => w.KeyName == OptionsMenulist[d].KeyName).ToList().ForEach(f => f.IsCurrentWorkOperation = true);
                        //[GEOS2-5135][Rupali Sarode][18-12-2023]
                        //var listCount = OptionsMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(OptionsMenulist[d].KeyName) && w.IsInactiveWorkOperation == false).ToList();
                        var listCount = OptionsMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(OptionsMenulist[d].KeyName)).ToList();

                        if (listCount != null)
                            if (listCount.Count() > 0)
                            {
                                OptionsMenulist[d].OptionObservedTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.OptionObservedTime)), 2);
                                OptionsMenulist[d].OptionNormalTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.OptionNormalTime)), 2);

                                //[GEOS2-3954][Rupali Sarode]
                                OptionsMenulist[d].UITempOptionObservedTime = ConvertfloattoTimespan(Convert.ToString(listCount.Sum(s => s.OptionObservedTime)));
                                OptionsMenulist[d].UITempOptionNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(listCount.Sum(s => s.OptionNormalTime)));

                                OptionsMenulist[d].IsReadOnly = true;
                            }
                    }

                if (OptionsMenulist != null)
                    //foreach (ERMSOPDetection itemERMSOPDetection in DetectionMenulist)
                    for (int d = 0; d < OptionsMenulist.Count(); d++)
                    {
                        if (GetStages.Any(a => a.Code.Equals(OptionsMenulist[d].Name)))
                        {
                            ObservableCollection<ERMSOPOptions> ActivitySum = new ObservableCollection<ERMSOPOptions>();
                            ObservableCollection<ERMSOPOptions> TempActivitySum = new ObservableCollection<ERMSOPOptions>();
                            int x = 1;
                            Loop:
                            x++;
                            if (x < 10)
                            {
                                if (ActivitySum.Count == 0)
                                {
                                    OptionsMenulist[d].OptionObservedTime = 0;
                                    OptionsMenulist[d].OptionNormalTime = 0;

                                    //[GEOS2-3954][Rupali Sarode]
                                    OptionsMenulist[d].UITempOptionObservedTime = ConvertfloattoTimespan(Convert.ToString(OptionsMenulist[d].OptionObservedTime));
                                    OptionsMenulist[d].UITempOptionNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(OptionsMenulist[d].OptionNormalTime));

                                    //[GEOS2-5135][Rupali Sarode][18-12-2023]
                                    //var ActivitySumList = OptionsMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(OptionsMenulist[d].KeyName) && w.IsInactiveWorkOperation == false).ToList();
                                    var ActivitySumList = OptionsMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(OptionsMenulist[d].KeyName)).ToList();
                                    ActivitySum.AddRange(ActivitySumList);
                                }
                                else
                                {
                                    //foreach (var item in ActivitySum)
                                    //{
                                    //    var ActivitySumList = DetectionMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(item.KeyName)).ToList();
                                    //    if (ActivitySumList != null && ActivitySumList.Count > 0)
                                    //    {

                                    //        foreach (var itemActivity in ActivitySumList)
                                    //        {
                                    //            if (!ActivitySum.Any(ac => ac.KeyName.Equals(itemActivity.KeyName)))
                                    //            {
                                    //                TempActivitySum.Add(itemActivity);
                                    //            }

                                    //        }

                                    //    }

                                    //}
                                    //ActivitySum.AddRange(TempActivitySum);
                                }


                                goto Loop;
                            }

                            double? ObservedTime = 0;
                            double? NormalTime = 0;
                            float? StandardTime = 0;
                            float? OperationTimePlant1Value = 0;
                            float? OperationTimePlant2Value = 0;
                            float? OperationTimePlant3Value = 0;
                            float? OperationTimePlant4Value = 0;
                            float? OperationTimePlant5Value = 0;
                            var tempDistinctList = ActivitySum.Select(xa => xa.KeyName).Distinct().ToList();
                            foreach (var item in tempDistinctList)
                            {
                                if (OptionsMenulist[d].OptionObservedTime == null)
                                    OptionsMenulist[d].OptionObservedTime = 0;
                                double? tempObservedTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.OptionObservedTime).FirstOrDefault();
                                if (tempObservedTime != null)
                                {
                                    ObservedTime = Math.Round(Convert.ToDouble(ObservedTime + tempObservedTime), 2);
                                    //[GEOS2-3954][Rupali Sarode]
                                    OptionsMenulist[d].UITempOptionObservedTime = ConvertfloattoTimespan(Convert.ToString(ObservedTime));
                                }
                                if (OptionsMenulist[d].OptionNormalTime == null)
                                    OptionsMenulist[d].OptionNormalTime = 0;
                                double? tempNormalTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.OptionNormalTime).FirstOrDefault();
                                if (tempNormalTime != null)
                                {
                                    NormalTime = Math.Round(Convert.ToDouble(NormalTime + tempNormalTime), 2);
                                    OptionsMenulist[d].UITempOptionNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(NormalTime));
                                }

                            }
                            OptionsMenulist[d].OptionObservedTime = ObservedTime;
                            OptionsMenulist[d].OptionNormalTime = NormalTime;

                            //[GEOS2-3954][Rupali Sarode]
                            OptionsMenulist[d].UITempOptionObservedTime = ConvertfloattoTimespan(Convert.ToString(ObservedTime));
                            OptionsMenulist[d].UITempOptionNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(NormalTime));

                            //DetectionMenulist[d].DetectionNormalTime = Math.Round(Convert.ToDouble(ObservedTime * DetectionMenulist[d].DetectionActivity / 100), 2);
                            #region PlantValue


                            foreach (var item in tempDistinctList)
                            {
                                if (OptionsMenulist[d].OptionStandardOperationTime == null)
                                    OptionsMenulist[d].OptionStandardOperationTime = 0;
                                float? tempStandardTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.OptionStandardOperationTime).FirstOrDefault();
                                if (tempStandardTime != null)
                                    StandardTime = StandardTime + tempStandardTime;

                                if (OptionsMenulist[d].OptionOperationTimePlant1Value == null)
                                    OptionsMenulist[d].OptionOperationTimePlant1Value = 0;
                                float? tempOperationTimePlant1Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.OptionOperationTimePlant1Value).FirstOrDefault();
                                if (tempOperationTimePlant1Value != null)
                                    OperationTimePlant1Value = OperationTimePlant1Value + tempOperationTimePlant1Value;

                                if (OptionsMenulist[d].OptionOperationTimePlant2Value == null)
                                    OptionsMenulist[d].OptionOperationTimePlant2Value = 0;
                                float? tempOperationTimePlant2Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.OptionOperationTimePlant2Value).FirstOrDefault();
                                if (tempOperationTimePlant2Value != null)
                                    OperationTimePlant2Value = OperationTimePlant2Value + tempOperationTimePlant2Value;

                                if (OptionsMenulist[d].OptionOperationTimePlant3Value == null)
                                    OptionsMenulist[d].OptionOperationTimePlant3Value = 0;
                                float? tempOperationTimePlant3Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.OptionOperationTimePlant3Value).FirstOrDefault();
                                if (tempOperationTimePlant3Value != null)
                                    OperationTimePlant3Value = OperationTimePlant3Value + tempOperationTimePlant3Value;

                                if (OptionsMenulist[d].OptionOperationTimePlant4Value == null)
                                    OptionsMenulist[d].OptionOperationTimePlant4Value = 0;
                                float? tempOperationTimePlant4Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.OptionOperationTimePlant4Value).FirstOrDefault();
                                if (tempOperationTimePlant4Value != null)
                                    OperationTimePlant4Value = OperationTimePlant4Value + tempOperationTimePlant4Value;

                                if (OptionsMenulist[d].OptionOperationTimePlant5Value == null)
                                    OptionsMenulist[d].OptionOperationTimePlant5Value = 0;
                                float? tempOperationTimePlant5Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.OptionOperationTimePlant5Value).FirstOrDefault();
                                if (tempOperationTimePlant5Value != null)
                                    OperationTimePlant5Value = OperationTimePlant5Value + tempOperationTimePlant5Value;
                            }
                            #endregion
                            OptionsMenulist[d].OptionStandardOperationTime = (float?)Math.Round(Convert.ToDouble(StandardTime), 2);
                            OptionsMenulist[d].OptionOperationTimePlant1Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant1Value), 2);
                            OptionsMenulist[d].OptionOperationTimePlant2Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant2Value), 2);
                            OptionsMenulist[d].OptionOperationTimePlant3Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant3Value), 2);
                            OptionsMenulist[d].OptionOperationTimePlant4Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant4Value), 2);
                            OptionsMenulist[d].OptionOperationTimePlant5Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant5Value), 2);
                            #region GEOS2-3954 Show the WorkOperations and SOD Time in the format: MM:SS or HH:MM:SS
                            try
                            {
                                OptionsMenulist[d].UiTempStandardOperationTimeName = ConvertfloattoTimespan(Convert.ToString(OptionsMenulist[d].OptionStandardOperationTime));
                                OptionsMenulist[d].UiTempoperationTimePlant1Value = ConvertfloattoTimespan(Convert.ToString(OptionsMenulist[d].OptionOperationTimePlant1Value));
                                OptionsMenulist[d].UiTempoperationTimePlant2Value = ConvertfloattoTimespan(Convert.ToString(OptionsMenulist[d].OptionOperationTimePlant2Value));
                                OptionsMenulist[d].UiTempoperationTimePlant3Value = ConvertfloattoTimespan(Convert.ToString(OptionsMenulist[d].OptionOperationTimePlant3Value));
                                OptionsMenulist[d].UiTempoperationTimePlant4Value = ConvertfloattoTimespan(Convert.ToString(OptionsMenulist[d].OptionOperationTimePlant4Value));
                                OptionsMenulist[d].UiTempoperationTimePlant5Value = ConvertfloattoTimespan(Convert.ToString(OptionsMenulist[d].OptionOperationTimePlant5Value));
                            }
                            catch (Exception ex)
                            {
                                GeosApplication.Instance.Logger.Log(string.Format("Error in Method OptionCustomSummarycalculation() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            }
                            #endregion
                        }
                    }
                #endregion              

                GeosApplication.Instance.Logger.Log("Method optionCustomSummarycalculation()....executed successfully", category: Category.Info, priority: Priority.Low);


            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log(string.Format("Error in method OptionCustomSummarycalculation() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

            }

        }

        private void OptionGridParentMenuTreeList_CellValueChangedCommandAction(object sender)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method OptionGridParentMenuTreeList_CellValueChangedCommandAction()...", category: Category.Info, priority: Priority.Low);

                if (sender is DevExpress.Xpf.Grid.TreeList.TreeListCellValueChangedEventArgs)
                {
                    if (sender != null)
                    {
                        FlagToDragDrop = true;  //[GEOS2-3924][Rupali Sarode][22-11-2022]

                        IsEnabledSaveButton = true;
                        SaveButtonVisibility = Visibility.Visible;
                        TreeListCellValueChangedEventArgs obj = (TreeListCellValueChangedEventArgs)sender;
                        if (!obj.Cell.Property.Equals("Remarks"))  //[GEOS2-4108][Rupali Sarode][6-1-2023]
                        {
                            if (obj.Value != null)
                            {

                                #region [GEOS2-3954] [Rupali Sarode] Time format HH:mm:ss

                                //float? tempnewvalue = ConvertTimespantoFloat(TimeSpan.FromMinutes(Convert.ToDouble(obj.Value)));
                                //double? NewValue = 0;

                                //if (Convert.ToString(obj.Value).Contains(":"))
                                //    NewValue = Math.Round(Convert.ToDouble(string.IsNullOrEmpty(tempnewvalue.ToString()) ? 0 : tempnewvalue), 2);
                                //else
                                //    NewValue = Math.Round(Convert.ToDouble(string.IsNullOrEmpty(obj.Value.ToString()) ? 0 : obj.Value), 2);

                                double? NewValue;
                                if (obj.Cell.Property.Equals("UITempOptionObservedTime"))
                                {
                                    //tempnewvalue = ConvertTimespantoFloat(TimeSpan.FromMinutes(Convert.ToDouble(obj.Value)));
                                    NewValue = Math.Round(Convert.ToDouble(TimeSpan.Parse(Convert.ToString(obj.Value)).TotalMinutes), 2); // ConvertTimespantoFloat(TimeSpan.Parse(obj.Value));
                                }
                                else
                                {
                                    NewValue = Math.Round(Convert.ToDouble(Convert.ToString(obj.Value)), 2);
                                }
                                if (NewValue != null)
                                {
                                    //if (obj.Cell.Property.Equals("UITempOptionObservedTime"))
                                    //    NewValueTime = string.IsNullOrEmpty(obj.Value.ToString()) ? TimeSpan.FromSeconds(0) : TimeSpan.Parse(obj.Value.ToString());
                                    //else
                                    //    NewValue = Math.Round(Convert.ToDouble(string.IsNullOrEmpty(obj.Value.ToString()) ? 0 : obj.Value), 2);

                                    if (NewValue != null)
                                        if (obj.Cell.Property.Equals("ObservedTime"))
                                        {
                                            OptionsMenulist.Where(w => w.IdworkOperationByStage == SelectedOptionsMenuItem.IdworkOperationByStage).ToList().ForEach(f => f.OptionObservedTime = NewValue);
                                        }
                                        else if (obj.Cell.Property.Equals("Activity"))
                                        {
                                            OptionsMenulist.Where(w => w.IdworkOperationByStage == SelectedOptionsMenuItem.IdworkOperationByStage).ToList().ForEach(f => f.OptionActivity = NewValue);
                                        }
                                        else if (obj.Cell.Property.Equals("UITempOptionObservedTime"))
                                        {
                                            try
                                            {
                                                OptionsMenulist.Where(w => w.IdworkOperationByStage == SelectedOptionsMenuItem.IdworkOperationByStage).ToList().ForEach(f => f.UITempOptionObservedTime = ConvertfloattoTimespan(Convert.ToString(NewValue)));
                                                OptionsMenulist.Where(w => w.IdworkOperationByStage == SelectedOptionsMenuItem.IdworkOperationByStage).ToList().ForEach(f => f.OptionObservedTime = NewValue);
                                            }
                                            catch (Exception ex)
                                            { }

                                        }
                                }
                                #endregion
                            }

                        }

                        if (!obj.Cell.Property.Equals("Remarks"))  //[GEOS2-4108][Rupali Sarode][6-1-2023]
                            optionCustomSummarycalculation();
                    }
                }

                GeosApplication.Instance.Logger.Log("Method OptionGridParentMenuTreeList_CellValueChangedCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log(string.Format("Error in method OptionsGridParentMenuTreeList_CellValueChangedCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }


        private void OptionGridParentMenuTreeList_CellValueChangingCommandAction(object sender)
        {

        }

        private void OptionCustomSummaryCommandAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method OptionCustomSummaryCommandAction()...", category: Category.Info, priority: Priority.Low);

                TreeListCustomSummaryEventArgs e = (TreeListCustomSummaryEventArgs)obj;
                if (e.SummaryItem.FieldName == "OptionObservedTime")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPOptions temp = (ERMSOPOptions)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                if (e.TotalValue != null)
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);

                            }

                        }

                    }
                }

                if (e.SummaryItem.FieldName == "UITempOptionObservedTime")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPOptions temp = (ERMSOPOptions)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                //e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                //if (e.TotalValue != null)
                                //    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);


                                #region Time changes 28 11 2022
                                TimeSpan temp3 = TimeSpan.Parse(e.FieldValue.ToString());
                                double TempFieldValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.FieldValue)))
                                {
                                    TempFieldValue = 0;
                                }
                                else
                                {
                                    TempFieldValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.FieldValue)).TotalMinutes);
                                }

                                double TempTotalValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.TotalValue)))
                                {
                                    TempTotalValue = 0;
                                }
                                else
                                {
                                    TempTotalValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.TotalValue)).TotalMinutes);
                                }

                                e.TotalValue = TempTotalValue + TempFieldValue;
                                if (e.TotalValue != null)
                                {
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    e.TotalValue = ConvertfloattoTimespan(Convert.ToString(e.TotalValue));

                                    #endregion

                                }
                                #endregion
                            }

                        }

                    }
                }


                if (e.SummaryItem.FieldName == "OptionNormalTime")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPOptions temp = (ERMSOPOptions)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                if (e.TotalValue != null)
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                            }

                        }

                    }
                }

                if (e.SummaryItem.FieldName == "UITempOptionNormalTime")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPOptions temp = (ERMSOPOptions)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                //e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                //if (e.TotalValue != null)
                                //    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);


                                #region Time changes 28 11 2022
                                TimeSpan temp3 = TimeSpan.Parse(e.FieldValue.ToString());
                                double TempFieldValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.FieldValue)))
                                {
                                    TempFieldValue = 0;
                                }
                                else
                                {
                                    TempFieldValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.FieldValue)).TotalMinutes);
                                }

                                double TempTotalValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.TotalValue)))
                                {
                                    TempTotalValue = 0;
                                }
                                else
                                {
                                    TempTotalValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.TotalValue)).TotalMinutes);
                                }

                                e.TotalValue = TempTotalValue + TempFieldValue;
                                if (e.TotalValue != null)
                                {
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    e.TotalValue = ConvertfloattoTimespan(Convert.ToString(e.TotalValue));

                                    #endregion

                                }
                                #endregion

                            }

                        }

                    }
                }

                if (e.SummaryItem.FieldName == "OptionStandardOperationTime")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPOptions temp = (ERMSOPOptions)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                if (e.TotalValue != null)
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                            }

                        }

                    }
                }
                if (e.SummaryItem.FieldName == "OptionOperationTimePlant1Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPOptions temp = (ERMSOPOptions)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                if (e.TotalValue != null)
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                            }

                        }

                    }
                }


                if (e.SummaryItem.FieldName == "OptionOperationTimePlant2Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPOptions temp = (ERMSOPOptions)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {

                                e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                if (e.TotalValue != null)
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                            }

                        }

                    }
                }


                if (e.SummaryItem.FieldName == "OptionOperationTimePlant3Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPOptions temp = (ERMSOPOptions)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {

                                e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                if (e.TotalValue != null)
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                            }

                        }

                    }
                }

                if (e.SummaryItem.FieldName == "OptionOperationTimePlant4Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPOptions temp = (ERMSOPOptions)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {

                                e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                if (e.TotalValue != null)
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                            }

                        }

                    }
                }

                if (e.SummaryItem.FieldName == "OptionOperationTimePlant5Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPOptions temp = (ERMSOPOptions)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {

                                e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                if (e.TotalValue != null)
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                            }

                        }

                    }
                }
                #region GEOS2-3954 Show the WorkOperations and SOD Time in the format: MM:SS or HH:MM:SS
                if (e.SummaryItem.FieldName == "UiTempStandardOperationTimeName")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {

                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPOptions temp = (ERMSOPOptions)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {

                                #region Time changes 28 11 2022
                                TimeSpan temp3 = TimeSpan.Parse(e.FieldValue.ToString());
                                double TempFieldValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.FieldValue)))
                                {
                                    TempFieldValue = 0;
                                }
                                else
                                {
                                    TempFieldValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.FieldValue)).TotalMinutes);
                                }

                                double TempTotalValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.TotalValue)))
                                {
                                    TempTotalValue = 0;
                                }
                                else
                                {
                                    TempTotalValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.TotalValue)).TotalMinutes);
                                }

                                e.TotalValue = TempTotalValue + TempFieldValue;
                                if (e.TotalValue != null)
                                {
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    e.TotalValue = ConvertfloattoTimespan(Convert.ToString(e.TotalValue));

                                    #endregion

                                }
                                #endregion
                            }
                        }

                    }
                }


                if (e.SummaryItem.FieldName == "UiTempoperationTimePlant1Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPOptions temp = (ERMSOPOptions)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {

                                #region Time changes 28 11 2022
                                TimeSpan temp3 = TimeSpan.Parse(e.FieldValue.ToString());
                                double TempFieldValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.FieldValue)))
                                {
                                    TempFieldValue = 0;
                                }
                                else
                                {
                                    TempFieldValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.FieldValue)).TotalMinutes);
                                }

                                double TempTotalValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.TotalValue)))
                                {
                                    TempTotalValue = 0;
                                }
                                else
                                {
                                    TempTotalValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.TotalValue)).TotalMinutes);
                                }

                                e.TotalValue = TempTotalValue + TempFieldValue;
                                if (e.TotalValue != null)
                                {
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    e.TotalValue = ConvertfloattoTimespan(Convert.ToString(e.TotalValue));

                                    #endregion

                                }
                                #endregion
                            }

                        }
                    }
                }
                if (e.SummaryItem.FieldName == "UiTempoperationTimePlant2Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPOptions temp = (ERMSOPOptions)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {

                                #region Time changes 28 11 2022
                                TimeSpan temp3 = TimeSpan.Parse(e.FieldValue.ToString());
                                double TempFieldValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.FieldValue)))
                                {
                                    TempFieldValue = 0;
                                }
                                else
                                {
                                    TempFieldValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.FieldValue)).TotalMinutes);
                                }

                                double TempTotalValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.TotalValue)))
                                {
                                    TempTotalValue = 0;
                                }
                                else
                                {
                                    TempTotalValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.TotalValue)).TotalMinutes);
                                }

                                e.TotalValue = TempTotalValue + TempFieldValue;
                                if (e.TotalValue != null)
                                {
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    e.TotalValue = ConvertfloattoTimespan(Convert.ToString(e.TotalValue));

                                    #endregion

                                }
                                #endregion
                            }

                        }

                    }
                }
                if (e.SummaryItem.FieldName == "UiTempoperationTimePlant3Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPOptions temp = (ERMSOPOptions)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {

                                #region Time changes 28 11 2022
                                TimeSpan temp3 = TimeSpan.Parse(e.FieldValue.ToString());
                                double TempFieldValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.FieldValue)))
                                {
                                    TempFieldValue = 0;
                                }
                                else
                                {
                                    TempFieldValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.FieldValue)).TotalMinutes);
                                }

                                double TempTotalValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.TotalValue)))
                                {
                                    TempTotalValue = 0;
                                }
                                else
                                {
                                    TempTotalValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.TotalValue)).TotalMinutes);
                                }

                                e.TotalValue = TempTotalValue + TempFieldValue;
                                if (e.TotalValue != null)
                                {
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    e.TotalValue = ConvertfloattoTimespan(Convert.ToString(e.TotalValue));

                                    #endregion

                                }
                                #endregion
                            }

                        }

                    }
                }
                if (e.SummaryItem.FieldName == "UiTempoperationTimePlant4Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPOptions temp = (ERMSOPOptions)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {

                                #region Time changes 28 11 2022
                                TimeSpan temp3 = TimeSpan.Parse(e.FieldValue.ToString());
                                double TempFieldValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.FieldValue)))
                                {
                                    TempFieldValue = 0;
                                }
                                else
                                {
                                    TempFieldValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.FieldValue)).TotalMinutes);
                                }

                                double TempTotalValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.TotalValue)))
                                {
                                    TempTotalValue = 0;
                                }
                                else
                                {
                                    TempTotalValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.TotalValue)).TotalMinutes);
                                }

                                e.TotalValue = TempTotalValue + TempFieldValue;
                                if (e.TotalValue != null)
                                {
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    e.TotalValue = ConvertfloattoTimespan(Convert.ToString(e.TotalValue));

                                    #endregion

                                }
                                #endregion
                            }

                        }
                    }
                }

                if (e.SummaryItem.FieldName == "UiTempoperationTimePlant5Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPOptions temp = (ERMSOPOptions)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {

                                #region Time changes 28 11 2022
                                TimeSpan temp3 = TimeSpan.Parse(e.FieldValue.ToString());
                                double TempFieldValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.FieldValue)))
                                {
                                    TempFieldValue = 0;
                                }
                                else
                                {
                                    TempFieldValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.FieldValue)).TotalMinutes);
                                }

                                double TempTotalValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.TotalValue)))
                                {
                                    TempTotalValue = 0;
                                }
                                else
                                {
                                    TempTotalValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.TotalValue)).TotalMinutes);
                                }

                                e.TotalValue = TempTotalValue + TempFieldValue;
                                if (e.TotalValue != null)
                                {
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    e.TotalValue = ConvertfloattoTimespan(Convert.ToString(e.TotalValue));

                                    #endregion

                                }
                                #endregion
                            }

                        }
                    }
                }
                #endregion

                GeosApplication.Instance.Logger.Log("Method OptionCustomSummaryCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {

                GeosApplication.Instance.Logger.Log(string.Format("Error in method OptionCustomSummaryCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

            }
        }

        private void OptionTreeListViewLoadedCommandAction(RoutedEventArgs obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method OptionTreeListViewLoadedCommandAction ...", category: Category.Info, priority: Priority.Low);

                DetectiontreeListControlInstance = (TreeListControl)((DevExpress.Xpf.Grid.TreeListView)obj.OriginalSource).DataControl;

                GeosApplication.Instance.Logger.Log("Method OptionTreeListViewLoadedCommandAction() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in OptionTreeListViewLoadedCommandAction() Method " + ex.Message, category: Category.Info, priority: Priority.Low);
            }
        }

        #endregion

        #region GEOS2-3838 - Way module

        private Visibility isAccordionControlVisibleWays;
        public Visibility IsAccordionControlVisibleWays
        {
            get { return isAccordionControlVisibleWays; }
            set
            {
                isAccordionControlVisibleWays = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsAccordionControlVisibleWays"));
            }
        }

        private List<ERMWaysGroups> waysGroups;
        public List<ERMWaysGroups> WaysGroups
        {
            get { return waysGroups; }
            set
            {
                waysGroups = value;
                OnPropertyChanged(new PropertyChangedEventArgs("WaysGroups"));
            }
        }

        private object selectedItemOldWay;
        public virtual object SelectedItemOldWay
        {
            get { return selectedItemOldWay; }
            set
            {
                selectedItemOldWay = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedItemOldWay"));
            }
        }

        private object selectedItemWay;
        public virtual object SelectedItemWay
        {
            get { return selectedItemWay; }
            set
            {
                selectedItemWay = value;
                #region [GEOS2-4830][gulab lakade][07 12 2023]
                if (selectedItemWay != null)
                {
                    string temobj = Convert.ToString(selectedItemWay);
                    if (!temobj.Contains("Ways"))
                    {
                        RetrieveWorkOperationsByWays();
                    }

                }
                #endregion
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedItemWay"));
            }
        }
        ObservableCollection<DetectionGroupWithWays> detectionGroupWithWays;
        public ObservableCollection<DetectionGroupWithWays> DetectionGroupWithWays
        {
            get { return detectionGroupWithWays; }
            set
            {
                detectionGroupWithWays = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DetectionGroupWithWays"));
            }
        }

        private object selectedItemOldcloneWay;
        public virtual object SelectedItemOldcloneWay
        {
            get { return selectedItemOldcloneWay; }
            set
            {
                selectedItemOldcloneWay = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedItemOldcloneWay"));
            }
        }

        ObservableCollection<ERMSOPWays> waysMenulist;
        public ObservableCollection<ERMSOPWays> WaysMenulist
        {
            get { return waysMenulist; }
            set
            {
                waysMenulist = value;
                OnPropertyChanged(new PropertyChangedEventArgs("WaysMenulist"));
            }
        }

        ERMSOPWays selectedWaysMenuItem;
        public ERMSOPWays SelectedWaysMenuItem
        {
            get { return selectedWaysMenuItem; }
            set
            {
                selectedWaysMenuItem = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedWaysMenuItem"));
            }
        }



        ObservableCollection<ERMSOPWays> wayMenulistCloned;
        public ObservableCollection<ERMSOPWays> WayMenulistCloned
        {
            get { return wayMenulistCloned; }
            set
            {
                wayMenulistCloned = value;
                OnPropertyChanged(new PropertyChangedEventArgs("WayMenulistCloned"));
            }
        }
        ObservableCollection<WorkOperationByStages> operationMenuWaylistCloned = new ObservableCollection<WorkOperationByStages>();

        private WorkOperationByStages selectedWayWorkOperationMenulist;
        public WorkOperationByStages SelectedWayWorkOperationMenulist
        {
            get { return selectedWayWorkOperationMenulist; }
            set
            {
                selectedWayWorkOperationMenulist = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedWayWorkOperationMenulist"));
            }

        }
        private ObservableCollection<WorkOperationByStages> workOperationWayMenulist;
        public ObservableCollection<WorkOperationByStages> WorkOperationWayMenulist
        {
            get
            {
                return workOperationWayMenulist;
            }

            set
            {
                workOperationWayMenulist = value;
                OnPropertyChanged(new PropertyChangedEventArgs("WorkOperationWayMenulist"));
            }
        }

        private ObservableCollection<TreeListColumn> columnsWayForSupplements;
        public ObservableCollection<TreeListColumn> ColumnsWayForSupplements
        {
            get { return columnsWayForSupplements; }
            set
            {
                columnsWayForSupplements = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ColumnsWayForSupplements"));
            }
        }

        private ObservableCollection<TreeListColumn> columnsWayOperationTime;
        public ObservableCollection<TreeListColumn> ColumnsWayOperationTime
        {
            get { return columnsWayOperationTime; }
            set
            {
                columnsWayOperationTime = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ColumnsWayOperationTime"));
            }
        }
        private void HideWayPanel(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method HideWayPanel ...", category: Category.Info, priority: Priority.Low);

                if (IsAccordionControlVisibleWays == Visibility.Collapsed)
                    IsAccordionControlVisibleWays = Visibility.Visible;
                else
                    IsAccordionControlVisibleWays = Visibility.Collapsed;
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method HideWayPanel()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        List<StandardOperationsDictionaryWays> tempLstStandardOperationsDictionaryWay = new List<StandardOperationsDictionaryWays>();
        ObservableCollection<ERMSOPWays> WayList = new ObservableCollection<ERMSOPWays>();
        ObservableCollection<WorkOperationByStages> operationWayMenulist = new ObservableCollection<WorkOperationByStages>();
        int duplicateItemloopWay = 0;
        private void RetrieveWorkOperationsByWays()
        {
            Saveselecteditem = "Ways";
            GeosApplication.Instance.Logger.Log("Method RetrieveWorkOperationsByWays()...", category: Category.Info, priority: Priority.Low);
            try
            {


                if (!DXSplashScreen.IsActive)
                {
                    DXSplashScreen.Show(x =>
                    {
                        Window win = new Window()
                        {
                            ShowActivated = false,
                            WindowStyle = WindowStyle.None,
                            ResizeMode = ResizeMode.NoResize,
                            AllowsTransparency = true,
                            Background = new SolidColorBrush(Colors.Transparent),
                            ShowInTaskbar = false,
                            Topmost = true,
                            SizeToContent = SizeToContent.WidthAndHeight,
                            WindowStartupLocation = WindowStartupLocation.CenterScreen,
                        };
                        WindowFadeAnimationBehavior.SetEnableAnimation(win, true);
                        win.Topmost = false;
                        return win;
                    }, x =>
                    {
                        return new SplashScreenView() { DataContext = new SplashScreenViewModel() };
                    }, null, null);
                }
            }
            catch (Exception ex)
            {

            }
            if (ISSavechanges == true)
            {
                return;
            }

            if (IsEnabledSaveButton && SaveButtonVisibility == Visibility.Visible)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                MessageBoxResult MessageBoxResult = MessageBoxResult = CustomMessageBox.Show(string.Format(Application.Current.Resources["ArticleGridUpdateWarning"].ToString()), "Yellow", CustomMessageBox.MessageImagePath.Warning, MessageBoxButton.YesNo);
                if (MessageBoxResult == MessageBoxResult.Yes)
                {
                    if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }
                    ISSavechanges = true;
                    IsEnabledSaveButton = false;
                    SelectedItemOldcloneWay = SelectedItemWay;
                    SelectedItemWay = SelectedItemOldWay;
                    var tempSelectedItemWay = SelectedItemOldcloneWay;
                    SaveButtonCommandAction();
                    ISSavechanges = false;
                    SelectedItemWay = tempSelectedItemWay;
                    if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                    #region GEOS2-3882 Commented Code
                    //SelectedItem = SelectedItemOld;
                    //if (SelectedItemOldclone != null)
                    //    SelectedItem = SelectedItemOldclone;

                    //SelectedItemDetection = SelectedItemOldDetection;
                    //if (SelectedItemOldcloneDetection != null)
                    //    SelectedItemDetection = SelectedItemOldcloneDetection;

                    //SelectedItemOption = SelectedItemOldOption;
                    //if (SelectedItemOldcloneOption != null)
                    //    SelectedItemOption = SelectedItemOldcloneOption;

                    ////[GEOS2-3601] - Structure
                    //SelectedItemStructures = SelectedItemOldStructure;
                    //if (SelectedItemOldcloneStructure != null)
                    //    SelectedItemStructures = SelectedItemOldcloneStructure;

                    ////GEOS2-4033 Spare Part Gulab Lakade
                    //SelectedItemSparePart = SelectedItemOldSparePart;
                    //if (SelectedItemOldcloneSparePart != null)
                    //    SelectedItemSparePart = SelectedItemOldcloneSparePart;
                    #endregion
                }
                #region [GEOS2-3909][Rupali Sarode][05-11-2022]
                if (MessageBoxResult == MessageBoxResult.No)
                {
                    TmpModuleMenulist = null;
                    TmpDetectionMenulist = null;
                    TmpOptionMenulist = null;
                    TmpStructureMenulist = null;
                    TmpWayMenulist = null;
                    TmpSparePartsMenulist = null;
                    TmpIdCPType = 0;
                    TmpIdDetection = 0; //[GEOS2-3922][Rupali Sarode][07-11-2022]
                    TmpIdOption = 0;
                    TmpIdWayType = 0;
                    TmpIdStructure = 0;
                    TmpIdSpareParts = 0;

                }
                #endregion

            }
            if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
            if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }
            ObservableCollection<ERMSOPWays> WaysMenulistTemp = new ObservableCollection<ERMSOPWays>();
            SelectedItemOldWay = SelectedItemWay;
            IsEnabledSaveButton = false;
            ModuleMenulistupdated = new ObservableCollection<ERMSOPModule>();
            try
            {

                if (SelectedItemWay is ERMWays)
                {

                    ERMWays ermWays = (ERMWays)SelectedItemWay;
                    //DetectionMenulist = null;

                    List<StandardOperationsDictionaryWays> tempStandardOperationsDictionaryWay = tempLstStandardOperationsDictionaryWay.Where(w => w.IdDetection == Convert.ToUInt64(ermWays.IdDetection)).ToList();
                    WaysMenulist = new ObservableCollection<ERMSOPWays>();
                    operationWayMenulist = new ObservableCollection<WorkOperationByStages>();
                    duplicateItemloop = 0;
                    duplicateItemloopWay = 0;
                    if (tempStandardOperationsDictionaryWay.Count() > 0)
                    {
                        foreach (var eRMSOPWay in tempStandardOperationsDictionaryWay)
                        {
                            if (eRMSOPWay != null)
                            {
                                List<WorkOperationByStages> tempWayList = WorkOperationMenulist.Where(w => w.IdworkOperationByStage == Convert.ToInt32(eRMSOPWay.IdWorkoperation) && w.Name == eRMSOPWay.WorkOperationName).ToList();  //[Cut  work operation not work properly.][gulab lakade][24 01 2023]
                                if (tempWayList != null)
                                    foreach (WorkOperationByStages item in tempWayList)
                                    {
                                        if (item.IdStatus == 1536)//[gulablakade][10.08.2022][GEOS2-3837]
                                        {
                                            item.IsInactiveWorkOperation = true;
                                            item.IsReadOnly = true;
                                        }
                                        WorkOperationByStages ParentName = WorkOperationMenulist.Where(w => w.KeyName.Equals(item.ParentName)).FirstOrDefault();
                                        if (ParentName != null)
                                        {
                                            if (!operationWayMenulist.Any(a => a.KeyName.Equals(ParentName.KeyName)))
                                                operationWayMenulist.Add(ParentName);
                                        }
                                        duplicateItemloop = 0;
                                        duplicateItemloopWay = 0;
                                        GetAllTreeListWay(item, WorkOperationMenulist);
                                    }

                            }

                        }
                    }
                    #region ModuleMenulist
                    WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                    #region [GEOS2-4830][gulab lakade][07 12 2023]
                    if (AllSupplementsBoxMenu != null)
                    {
                        var listadoDuplicadas = from c in AllSupplementsBoxMenu
                                                join c2 in AllSupplementsBoxMenu on c.Item2 equals c2.Item2
                                                where c != c2
                                                select c;

                        var WaySandardOperationTime = listadoDuplicadas.FirstOrDefault();
                        if (WaySandardOperationTime != null)
                        {
                            var templist = listadoDuplicadas.Where(a => a.Item2 == WaySandardOperationTime.Item2);
                            listadoDuplicadas = templist;
                        }

                        var tempSupplementsBoxMenu = AllSupplementsBoxMenu;

                        ColumnsWayForSupplements = new ObservableCollection<TreeListColumn>();
                        ColumnsWayForSupplements.Add(new TreeListColumn()
                        {
                            FieldName = "WayStandardSupplements",
                            Header = "Standard",
                            HeaderToolTip = "Standard",
                            AllowCellMerge = false,
                            Width = 150,
                            AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                            Visible = true,
                            ReadOnly = false,
                            FixedWidth = false
                        });

                        ColumnsWayOperationTime = new ObservableCollection<TreeListColumn>();
                        ColumnsWayOperationTime.Add(new TreeListColumn()
                        {
                            FieldName = "UiTempStandardOperationTimeName",
                            Header = "Standard",
                            HeaderToolTip = "Standard",
                            AllowCellMerge = false,
                            Width = 150,
                            AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                            Visible = true,
                            ReadOnly = false,
                            FixedWidth = false
                        });

                        int Supplimentcount = 1;
                        var ColumnsWayList = tempSupplementsBoxMenu.Where(p => !listadoDuplicadas.Any(p2 => p2.Item1 == p.Item1));
                        foreach (var item in ColumnsWayList)
                        {
                            if (Supplimentcount == 5)
                            {
                                ColumnsWayForSupplements.Add(new TreeListColumn()
                                {
                                    FieldName = "WaySupplementPlant" + Supplimentcount + "Value",
                                    Header = "Others",
                                    HeaderToolTip = "Others",
                                    AllowCellMerge = false,
                                    Width = 60,
                                    AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                    Visible = true,
                                    ReadOnly = false,
                                    FixedWidth = false
                                });
                                ColumnsWayOperationTime.Add(new TreeListColumn()
                                {
                                    FieldName = "UiTempoperationTimePlant" + Supplimentcount + "Value",
                                    Header = "Others",
                                    HeaderToolTip = "Others",
                                    AllowCellMerge = false,
                                    Width = 60,
                                    AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                    Visible = true,
                                    ReadOnly = false,
                                    FixedWidth = false
                                });
                                break;
                            }
                            if (Supplimentcount == 5)
                            {
                                break;
                            }
                            ColumnsWayForSupplements.Add(new TreeListColumn()
                            {
                                FieldName = "WaySupplementPlant" + Supplimentcount + "Value",
                                Header = item.Item1,
                                HeaderToolTip = item.Item1,
                                AllowCellMerge = false,
                                Width = 60,
                                AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                Visible = true,
                                ReadOnly = false,
                                FixedWidth = false
                            });

                            ColumnsWayOperationTime.Add(new TreeListColumn()
                            {
                                FieldName = "UiTempoperationTimePlant" + Supplimentcount + "Value",
                                Header = item.Item1,
                                HeaderToolTip = item.Item1,
                                AllowCellMerge = false,
                                Width = 60,
                                AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                Visible = true,
                                ReadOnly = false,
                                FixedWidth = false
                            });
                            Supplimentcount = Supplimentcount + 1;
                        }

                        #endregion
                        bool FlagAddItemModule = false; //[GEOS2-5135][Rupali Sarode][18-12-2023]

                        foreach (WorkOperationByStages Module in operationWayMenulist)
                        {
                            FlagAddItemModule = true; //[GEOS2-5135][Rupali Sarode][18-12-2023]

                            if (operationWayMenulist.Any(a => a.IdworkOperationByStage == Convert.ToInt64(Module.IdworkOperationByStage))
                                && operationWayMenulist.Any(a => a.Name.Trim().Equals(Module.Name.Trim()))
                                )
                            {
                                StandardOperationsDictionaryWays standardOperationsDictionaryWay = tempLstStandardOperationsDictionaryWay.Where(w => w.IdWorkoperation == Convert.ToUInt64(Module.IdworkOperationByStage) && Module.Parent != null
                                && w.IdDetection == Convert.ToUInt64(ermWays.IdDetection)).FirstOrDefault();

                                #region  [GEOS2-5135][Rupali Sarode][18-12-2023]
                                // If it is child & only active then add
                                List<WorkOperationByStages> childListInActiveDraft = operationWayMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(Module.KeyName)).ToList();

                                if (childListInActiveDraft.Count == 0)
                                {
                                    if (Module.IdStatus == 1535)
                                    {
                                        FlagAddItemModule = true;
                                    }
                                    else
                                        FlagAddItemModule = false;
                                }
                                else // If it is parent and does not contain any active child, then do not include it
                                if (childListInActiveDraft.Count > 0)
                                {
                                    //List<WorkOperationByStages> childListInParent = operationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(Module.KeyName)).ToList();
                                    foreach (WorkOperationByStages objChild in childListInActiveDraft)
                                    {
                                        List<WorkOperationByStages> GrandChildListInActiveDraft = new List<WorkOperationByStages>();
                                        GrandChildListInActiveDraft = operationWayMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(objChild.KeyName)).ToList();
                                        if (GrandChildListInActiveDraft.Count == 0)
                                        { // If it is child and Active
                                            if (objChild.IdStatus == 1535)
                                            {
                                                FlagAddItemModule = true;
                                                break;
                                            }
                                            else
                                            {
                                                FlagAddItemModule = false;
                                            }

                                        }
                                        else
                                        {
                                            if (GrandChildListInActiveDraft.Count > 0)
                                            {
                                                if (GrandChildListInActiveDraft.Where(i => i.IdStatus == 1535).Count() > 0)
                                                {
                                                    FlagAddItemModule = true;
                                                    break;
                                                }
                                                else
                                                {
                                                    FlagAddItemModule = false;
                                                }
                                            }
                                        }
                                    }
                                }
                                #endregion  [GEOS2-5135][Rupali Sarode][18-12-2023]

                                if (FlagAddItemModule == true)  //[GEOS2-5135][Rupali Sarode][18-12-2023]
                                { //[GEOS2-5135][Rupali Sarode][18-12-2023]

                                    ERMSOPWays eRMSOPWay = new ERMSOPWays();
                                    if (standardOperationsDictionaryWay != null)
                                        eRMSOPWay.IdDetection = standardOperationsDictionaryWay.IdDetection;
                                    eRMSOPWay.Name = Module.Name;
                                    eRMSOPWay.IdworkOperationByStage = Module.IdworkOperationByStage;
                                    eRMSOPWay.IdSequence = Module.IdSequence;
                                    eRMSOPWay.IdStatus = Module.IdStatus;
                                    eRMSOPWay.Status = Module.Status;
                                    eRMSOPWay.Code = Module.Name;
                                    eRMSOPWay.Parent = Module.Parent;
                                    eRMSOPWay.IdParent = Module.IdParent;
                                    eRMSOPWay.KeyName = Module.KeyName;
                                    eRMSOPWay.ParentName = Module.ParentName;
                                    #region [GEOS2-5629][gulab lakade][15 07 2024]
                                    if (standardOperationsDictionaryWay != null)
                                    {
                                        eRMSOPWay.Position = Convert.ToUInt32(standardOperationsDictionaryWay.Position);
                                        eRMSOPWay.WayPosition = Convert.ToUInt32(standardOperationsDictionaryWay.Position);//[GEOS2-5629][gulab lakade][10 07 2024]

                                    }
                                    else
                                    {
                                        eRMSOPWay.Position = Module.Position;
                                        eRMSOPWay.WayPosition = Module.Position; //[GEOS2-5629][gulab lakade][10 07 2024]
                                    }
                                    #endregion
                                    eRMSOPWay.WorkOperation_count = Module.WorkOperation_count;
                                    eRMSOPWay.WorkOperation_count_original = Module.WorkOperation_count_original;
                                    eRMSOPWay.NameWithWorkOperationCount = Module.NameWithWorkOperationCount;

                                    eRMSOPWay.IsInactiveWorkOperation = Module.IsInactiveWorkOperation;
                                    eRMSOPWay.IsReadOnly = Module.IsReadOnly;

                                    if (!GetStages.Any(a => a.Code.Equals(eRMSOPWay.Name)))
                                    {
                                        var tempActivity = tempLstStandardOperationsDictionaryWay.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPWay.IdworkOperationByStage)
                                         && w.IdDetection == Convert.ToUInt64(eRMSOPWay.IdDetection)).Select(s => s.Activity).DefaultIfEmpty(null).FirstOrDefault();
                                        var tempObservedTime = tempLstStandardOperationsDictionaryWay.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPWay.IdworkOperationByStage)
                                         && w.IdDetection == Convert.ToUInt64(eRMSOPWay.IdDetection)).Select(s => s.ObservedTime).DefaultIfEmpty(null).FirstOrDefault();
                                        #region Geos2 4077 Ways Store/ Save in the SDO tables the Observed time, Activity

                                        var tempWay = tempLstStandardOperationsDictionaryWay.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPWay.IdworkOperationByStage)
                                        && w.IdDetection == Convert.ToUInt64(eRMSOPWay.IdDetection)).FirstOrDefault();

                                        if (tempWay != null)
                                        {
                                            if (tempWay.IdWorkoperation == Convert.ToUInt64(eRMSOPWay.IdworkOperationByStage) && (tempWay.Activity == null || tempWay.Activity == 0))
                                            {
                                                tempActivity = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == Module.IdworkOperationByStage && a.KeyName == Module.KeyName).Select(b => b.Activity).FirstOrDefault(); //[Cut  work operation not work properly.][gulab lakade][24 01 2023]
                                            }
                                            if (tempWay.IdWorkoperation == Convert.ToUInt64(eRMSOPWay.IdworkOperationByStage) && (tempWay.ObservedTime == null || tempWay.ObservedTime == 0))
                                            {
                                                tempObservedTime = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == Module.IdworkOperationByStage && a.KeyName == Module.KeyName).Select(b => b.ObservedTime).FirstOrDefault(); //[Cut  work operation not work properly.][gulab lakade][24 01 2023]
                                            }
                                        }
                                        #endregion
                                        if (tempActivity != null)
                                            eRMSOPWay.WayActivity = Math.Round((double)tempActivity, 2);
                                        if (tempObservedTime != null)
                                        {
                                            eRMSOPWay.WayObservedTime = Math.Round((double)tempObservedTime, 2);
                                            #region GEOS2-3954 [Rupali Sarode][15/10/2022]
                                            //eRMSOPWay.UITempWaysObservedTime = tempLstStandardOperationsDictionaryWay.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPWay.IdworkOperationByStage)
                                            //&& w.IdDetection == Convert.ToUInt64(eRMSOPWay.IdDetection)).Select(s => s.UITempWaysObservedTime).FirstOrDefault();
                                            #region [GEOS2-5008][gulab lakade][1 11 2023]
                                            //eRMSOPWay.UITempWaysObservedTime = TimeSpan.FromMinutes(Convert.ToDouble(tempObservedTime));
                                            eRMSOPWay.UITempWaysObservedTime = ConvertfloattoTimespan(Convert.ToString(Convert.ToDouble(tempObservedTime)));
                                            #endregion

                                            #endregion
                                        }
                                        eRMSOPWay.WayNormalTime = Math.Round(Convert.ToDouble(eRMSOPWay.WayObservedTime * eRMSOPWay.WayActivity / 100), 2);
                                        #region GEOS2-3954 [Rupali Sarode][15/10/2022]
                                        eRMSOPWay.UITempWaysNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(eRMSOPWay.WayNormalTime));
                                        #endregion

                                        //[GEOS2-3933][Rupali Sarode][22/09/2022]
                                        eRMSOPWay.WORemarks = Module.WORemarks == null ? "" : Module.WORemarks.Trim();

                                        //[GEOS2-3933][Rupali Sarode][26/09/2022]
                                        var tempRemarks = tempLstStandardOperationsDictionaryWay.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPWay.IdworkOperationByStage)
                                        && w.IdDetection == Convert.ToUInt64(eRMSOPWay.IdDetection)).Select(s => s.Remarks).DefaultIfEmpty(null).FirstOrDefault();

                                        eRMSOPWay.Remarks = tempRemarks == null ? "" : tempRemarks.Trim();
                                    }


                                    if (GetStages.Any(a => a != null && a.Code.Trim().Equals(Module.Name.Trim())))
                                    {
                                        eRMSOPWay.IsDeleteButton = false;
                                        eRMSOPWay.IsDeleteButtonVisibility = Visibility.Hidden;
                                        eRMSOPWay.IsReadOnly = true;
                                        eRMSOPWay.IsValidateOnTextInput = false;
                                        Module.IsCurrentWorkOperation = true;
                                    }
                                    else
                                    {
                                        Module.IsCurrentWorkOperation = true;
                                        eRMSOPWay.IsReadOnly = false;
                                        eRMSOPWay.IsValidateOnTextInput = true;
                                    }
                                    if (Module.IdStatus == 1536)
                                    {
                                        eRMSOPWay.IsInactiveWorkOperation = true;
                                        eRMSOPWay.IsReadOnly = true;
                                    }
                                    #region [GEOS2-4830][gulab lakade][07 12 2023]
                                    if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(eRMSOPWay.Name.Trim())))
                                    {
                                        if (WaySandardOperationTime != null)
                                            eRMSOPWay.WayStandardSupplements = (float?)WaySandardOperationTime.Item2;
                                        if (tempSupplementsBoxMenu.Any(p => !listadoDuplicadas.Any(p2 => p2.Item1 == p.Item1)))
                                        {
                                            eRMSOPWay.AllSupplementsBoxMenu = AllSupplementsBoxMenu;
                                            List<float?> lst = new List<float?>();

                                            var a = ColumnsWayList.ToList();
                                            for (int i = 0; i < a.Count(); i++)
                                            {
                                                lst.Add((float?)a[i].Item2);
                                            }

                                            if (ColumnsWayList.Count() == 1)
                                            {
                                                eRMSOPWay.WaySupplementPlant1Value = (float?)lst[0];
                                            }
                                            else if (ColumnsWayList.Count() == 2)
                                            {
                                                eRMSOPWay.WaySupplementPlant1Value = (float?)lst[0];
                                                eRMSOPWay.WaySupplementPlant2Value = (float?)lst[1];
                                            }
                                            else if (ColumnsWayList.Count() == 3)
                                            {
                                                eRMSOPWay.WaySupplementPlant1Value = (float?)lst[0];
                                                eRMSOPWay.WaySupplementPlant2Value = (float?)lst[1];
                                                eRMSOPWay.WaySupplementPlant3Value = (float?)lst[2];
                                            }
                                            else if (ColumnsWayList.Count() == 4)
                                            {
                                                eRMSOPWay.WaySupplementPlant1Value = (float?)lst[0];
                                                eRMSOPWay.WaySupplementPlant2Value = (float?)lst[1];
                                                eRMSOPWay.WaySupplementPlant3Value = (float?)lst[2];
                                                eRMSOPWay.WaySupplementPlant4Value = (float?)lst[3];
                                            }
                                            else if (ColumnsWayList.Count() == 5)
                                            {
                                                eRMSOPWay.WaySupplementPlant1Value = (float?)lst[0];
                                                eRMSOPWay.WaySupplementPlant2Value = (float?)lst[1];
                                                eRMSOPWay.WaySupplementPlant3Value = (float?)lst[2];
                                                eRMSOPWay.WaySupplementPlant4Value = (float?)lst[3];
                                                eRMSOPWay.WaySupplementPlant5Value = (float?)lst[4];
                                            }
                                            else
                                            {
                                                eRMSOPWay.WaySupplementPlant1Value = (float?)lst[0];
                                                eRMSOPWay.WaySupplementPlant2Value = (float?)lst[1];
                                                eRMSOPWay.WaySupplementPlant3Value = (float?)lst[2];
                                                eRMSOPWay.WaySupplementPlant4Value = (float?)lst[3];
                                                eRMSOPWay.WaySupplementPlant5Value = 0;
                                                if (ColumnsWayList.Count() > 5)
                                                {
                                                    for (int q = 4; q < ColumnsWayList.Count(); q++)
                                                    {
                                                        if (eRMSOPWay.WaySupplementPlant5Value == null)
                                                            eRMSOPWay.WaySupplementPlant5Value = 0;
                                                        eRMSOPWay.WaySupplementPlant5Value = eRMSOPWay.WaySupplementPlant5Value + (float?)lst[q];
                                                    }
                                                }


                                            }

                                        }
                                        #region GEOS2-4046 Gulab Lakade
                                        if (WaySandardOperationTime != null)
                                            eRMSOPWay.WayStandardOperationTime = (float?)Math.Round(Convert.ToDouble(eRMSOPWay.WayNormalTime * (1 + (Convert.ToDouble(WaySandardOperationTime.Item2) / 100))), 2);

                                        eRMSOPWay.WayOperationTimePlant1Value = (float?)Math.Round(Convert.ToDouble(eRMSOPWay.WayNormalTime * (1 + (Convert.ToDouble(eRMSOPWay.WaySupplementPlant1Value) / 100))), 2);
                                        eRMSOPWay.WayOperationTimePlant2Value = (float?)Math.Round(Convert.ToDouble(eRMSOPWay.WayNormalTime * (1 + (Convert.ToDouble(eRMSOPWay.WaySupplementPlant2Value) / 100))), 2);
                                        eRMSOPWay.WayOperationTimePlant3Value = (float?)Math.Round(Convert.ToDouble(eRMSOPWay.WayNormalTime * (1 + (Convert.ToDouble(eRMSOPWay.WaySupplementPlant3Value) / 100))), 2);
                                        eRMSOPWay.WayOperationTimePlant4Value = (float?)Math.Round(Convert.ToDouble(eRMSOPWay.WayNormalTime * (1 + (Convert.ToDouble(eRMSOPWay.WaySupplementPlant4Value) / 100))), 2);
                                        eRMSOPWay.WayOperationTimePlant5Value = (float?)Math.Round(Convert.ToDouble(eRMSOPWay.WayNormalTime * (1 + (Convert.ToDouble(eRMSOPWay.WaySupplementPlant5Value) / 100))), 2);
                                        #endregion
                                        #region GEOS2-3954 Show the WorkOperations and SOD Time in the format: MM:SS or HH:MM:SS
                                        try
                                        {
                                            eRMSOPWay.UiTempStandardOperationTimeName = ConvertfloattoTimespan(Convert.ToString(eRMSOPWay.WayStandardOperationTime));
                                            eRMSOPWay.UiTempoperationTimePlant1Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPWay.WayOperationTimePlant1Value));
                                            eRMSOPWay.UiTempoperationTimePlant2Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPWay.WayOperationTimePlant2Value));
                                            eRMSOPWay.UiTempoperationTimePlant3Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPWay.WayOperationTimePlant3Value));
                                            eRMSOPWay.UiTempoperationTimePlant4Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPWay.WayOperationTimePlant4Value));
                                            eRMSOPWay.UiTempoperationTimePlant5Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPWay.WayOperationTimePlant5Value));
                                        }
                                        catch (Exception ex)
                                        {
                                            GeosApplication.Instance.Logger.Log(string.Format("Error in Method RetrieveWorkOperationsByWay() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                        }
                                        #endregion
                                    }
                                    #endregion
                                    try
                                    {
                                        if (!WaysMenulistTemp.Any(a => a.KeyName.Equals(Module.KeyName)))
                                            WaysMenulistTemp.Add(eRMSOPWay);
                                    }
                                    catch (Exception ex)
                                    {

                                    }
                                } //[GEOS2-5135][Rupali Sarode][18-12-2023]

                            }
                        }
                    }//[GEOS2-4830][gulab lakade][07 12 2023]

                    #region GEOS2-3858 Rupali Sarode
                    //var tempWorkOperationMenulist2 = WaysMenulistTemp.OrderBy(x => x.Position).ToList();
                    var tempWorkOperationMenulist2 = WaysMenulistTemp.OrderBy(x => x.WayPosition).ToList();//[GEOS2-5629][gulab lakade][15 07 2024]
                    tempWorkOperationClonedWays = new List<ERMSOPWays>();
                    tempWorkOperationClonedWays.AddRange(tempWorkOperationMenulist2);
                    #endregion

                    //List<ERMSOPWays> tempWorkOperationWayMenulist = WaysMenulistTemp.OrderBy(x => x.Position).ToList();
                    List<ERMSOPWays> tempWorkOperationWayMenulist = WaysMenulistTemp.OrderBy(x => x.WayPosition).ToList();//[GEOS2-5629][gulab lakade][15 07 2024]
                    WaysMenulistTemp.Clear();
                    WaysMenulistTemp.AddRange(tempWorkOperationWayMenulist);
                    tempWorkOperationWayMenulist.Clear();
                    if (WaysMenulistTemp != null)
                    {
                        var tempWayMenulist = WaysMenulistTemp.ToList();
                        for (int i = 0; i < tempWayMenulist.Count; i++)
                        {
                            if (GetStages.Any(a => a.Code.Equals(tempWayMenulist[i].Name)))
                            {
                                List<ERMSOPWays> childList = WaysMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(tempWayMenulist[i].KeyName)).ToList();
                                if (childList.Count == 0)
                                {
                                    List<WorkOperationByStages> tempWOList = WorkOperationMenulist.Where(w => w.KeyName == tempWayMenulist[i].KeyName).ToList();
                                    if (tempWOList != null)
                                        tempWOList.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                                    WaysMenulistTemp.Remove(tempWayMenulist[i]);
                                }
                            }
                        }
                    }
                    #endregion
                }
                #region TemplateWithCPTypes
                else if (SelectedItemWay is DetectionGroupWithWays)
                {
                    WaysMenulistTemp = null;
                    workOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                }
                #endregion
                #region RND
                #region calculation
                #region [GEOS2-4830][gulab lakade][07 12 2023]
                //if (WaysMenulistTemp != null)
                //    for (int d = 0; d < WaysMenulistTemp.Count(); d++)
                //    {
                //        WorkOperationMenulist.Where(w => w.KeyName == WaysMenulistTemp[d].KeyName).ToList().ForEach(f => f.IsCurrentWorkOperation = true);
                //        var listCount = WaysMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(WaysMenulistTemp[d].KeyName) && w.IsInactiveWorkOperation == false).ToList();
                //        if (listCount != null)
                //            if (listCount.Count() > 0)
                //            {
                //                WaysMenulistTemp[d].WayObservedTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.WayObservedTime)), 2);
                //                WaysMenulistTemp[d].WayNormalTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.WayNormalTime)), 2);
                //                #region [GEOS2-3954][Rupali Sarode] Time format HH:mm:ss
                //                WaysMenulistTemp[d].UITempWaysObservedTime = ConvertfloattoTimespan(Convert.ToString(Convert.ToDouble(listCount.Sum(s => s.WayObservedTime))));
                //                WaysMenulistTemp[d].UITempWaysNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(Convert.ToDouble(listCount.Sum(s => s.WayNormalTime))));
                //                #endregion

                //                WaysMenulistTemp[d].IsReadOnly = true;
                //            }
                //    }
                #endregion
                if (WaysMenulistTemp != null)
                    for (int d = 0; d < WaysMenulistTemp.Count(); d++)
                    {
                        WorkOperationMenulist.Where(w => w.KeyName == WaysMenulistTemp[d].KeyName).ToList().ForEach(f => f.IsCurrentWorkOperation = true);
                        //[GEOS2-5135][Rupali Sarode][19-12-2023]
                        //var listCount = WaysMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(WaysMenulistTemp[d].KeyName) && w.IsInactiveWorkOperation == false).ToList();
                        var listCount = WaysMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(WaysMenulistTemp[d].KeyName)).ToList();
                        if (listCount != null)
                            if (listCount.Count() > 0)
                            {
                                WaysMenulistTemp[d].WayObservedTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.WayObservedTime)), 2);
                                WaysMenulistTemp[d].WayNormalTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.WayNormalTime)), 2);
                                #region [GEOS2-3954][Rupali Sarode] Time format HH:mm:ss
                                WaysMenulistTemp[d].UITempWaysObservedTime = ConvertfloattoTimespan(Convert.ToString(listCount.Sum(s => s.WayObservedTime)));
                                WaysMenulistTemp[d].UITempWaysNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(listCount.Sum(s => s.WayNormalTime)));
                                #endregion
                                WaysMenulistTemp[d].IsReadOnly = true;
                            }
                    }

                if (WaysMenulistTemp != null)
                    for (int d = 0; d < WaysMenulistTemp.Count(); d++)
                    {
                        if (GetStages.Any(a => a.Code.Equals(WaysMenulistTemp[d].Name)))
                        {
                            ObservableCollection<ERMSOPWays> ActivitySum = new ObservableCollection<ERMSOPWays>();
                            ObservableCollection<ERMSOPWays> TempActivitySum = new ObservableCollection<ERMSOPWays>();
                            int x = 1;
                            Loop:
                            x++;
                            if (x < 10)
                            {
                                if (ActivitySum.Count == 0)
                                {
                                    WaysMenulistTemp[d].WayObservedTime = 0;
                                    WaysMenulistTemp[d].WayNormalTime = 0;
                                    #region [GEOS2-3954][Rupali Sarode] Time format HH:mm:ss
                                    WaysMenulistTemp[d].UITempWaysObservedTime = ConvertfloattoTimespan(Convert.ToString(WaysMenulistTemp[d].WayObservedTime));
                                    WaysMenulistTemp[d].UITempWaysNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(WaysMenulistTemp[d].WayNormalTime));
                                    #endregion

                                    //[GEOS2-5135][Rupali Sarode][19-12-2023]
                                    //var ActivitySumList = WaysMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(WaysMenulistTemp[d].KeyName) && w.IsInactiveWorkOperation == false).ToList();
                                    var ActivitySumList = WaysMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(WaysMenulistTemp[d].KeyName)).ToList();
                                    ActivitySum.AddRange(ActivitySumList);
                                }
                                else
                                {

                                }


                                goto Loop;
                            }

                            double? ObservedTime = 0;
                            double? NormalTime = 0;
                            float? StandardTime = 0;
                            float? OperationTimePlant1Value = 0;
                            float? OperationTimePlant2Value = 0;
                            float? OperationTimePlant3Value = 0;
                            float? OperationTimePlant4Value = 0;
                            float? OperationTimePlant5Value = 0;
                            var tempDistinctList = ActivitySum.Select(xa => xa.KeyName).Distinct().ToList();
                            foreach (var item in tempDistinctList)
                            {
                                if (WaysMenulistTemp[d].WayObservedTime == null)
                                    WaysMenulistTemp[d].WayObservedTime = 0;
                                double? tempObservedTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.WayObservedTime).FirstOrDefault();
                                if (tempObservedTime != null)
                                {
                                    ObservedTime = Math.Round(Convert.ToDouble(ObservedTime + tempObservedTime), 2);
                                    #region [GEOS2-3954] [Rupali Sarode] Time format HH:mm:ss
                                    WaysMenulistTemp[d].UITempWaysObservedTime = ConvertfloattoTimespan(Convert.ToString(ObservedTime));

                                    #endregion
                                }
                                if (WaysMenulistTemp[d].WayNormalTime == null)
                                    WaysMenulistTemp[d].WayNormalTime = 0;
                                double? tempNormalTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.WayNormalTime).FirstOrDefault();
                                if (tempNormalTime != null)
                                {
                                    NormalTime = Math.Round(Convert.ToDouble(NormalTime + tempNormalTime), 2);
                                    #region [GEOS2-3954] [Rupali Sarode] Time format HH:mm:ss
                                    WaysMenulistTemp[d].UITempWaysNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(NormalTime));
                                    #endregion

                                }
                            }
                            WaysMenulistTemp[d].WayObservedTime = ObservedTime;
                            WaysMenulistTemp[d].WayNormalTime = NormalTime;
                            #region [GEOS2-3954] [Rupali Sarode] Time format HH:mm:ss
                            WaysMenulistTemp[d].UITempWaysObservedTime = ConvertfloattoTimespan(Convert.ToString(ObservedTime));
                            WaysMenulistTemp[d].UITempWaysNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(WaysMenulistTemp[d].WayNormalTime));
                            #endregion


                            #region PlantValue


                            foreach (var item in tempDistinctList)
                            {
                                if (WaysMenulistTemp[d].WayStandardOperationTime == null)
                                    WaysMenulistTemp[d].WayStandardOperationTime = 0;
                                float? tempStandardTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.WayStandardOperationTime).FirstOrDefault();
                                if (tempStandardTime != null)
                                    StandardTime = StandardTime + tempStandardTime;

                                if (WaysMenulistTemp[d].WayOperationTimePlant1Value == null)
                                    WaysMenulistTemp[d].WayOperationTimePlant1Value = 0;
                                float? tempOperationTimePlant1Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.WayOperationTimePlant1Value).FirstOrDefault();
                                if (tempOperationTimePlant1Value != null)
                                    OperationTimePlant1Value = OperationTimePlant1Value + tempOperationTimePlant1Value;

                                if (WaysMenulistTemp[d].WayOperationTimePlant2Value == null)
                                    WaysMenulistTemp[d].WayOperationTimePlant2Value = 0;
                                float? tempOperationTimePlant2Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.WayOperationTimePlant2Value).FirstOrDefault();
                                if (tempOperationTimePlant2Value != null)
                                    OperationTimePlant2Value = OperationTimePlant2Value + tempOperationTimePlant2Value;

                                if (WaysMenulistTemp[d].WayOperationTimePlant3Value == null)
                                    WaysMenulistTemp[d].WayOperationTimePlant3Value = 0;
                                float? tempOperationTimePlant3Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.WayOperationTimePlant3Value).FirstOrDefault();
                                if (tempOperationTimePlant3Value != null)
                                    OperationTimePlant3Value = OperationTimePlant3Value + tempOperationTimePlant3Value;

                                if (WaysMenulistTemp[d].WayOperationTimePlant4Value == null)
                                    WaysMenulistTemp[d].WayOperationTimePlant4Value = 0;
                                float? tempOperationTimePlant4Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.WayOperationTimePlant4Value).FirstOrDefault();
                                if (tempOperationTimePlant4Value != null)
                                    OperationTimePlant4Value = OperationTimePlant4Value + tempOperationTimePlant4Value;

                                if (WaysMenulistTemp[d].WayOperationTimePlant5Value == null)
                                    WaysMenulistTemp[d].WayOperationTimePlant5Value = 0;
                                float? tempOperationTimePlant5Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.WayOperationTimePlant5Value).FirstOrDefault();
                                if (tempOperationTimePlant5Value != null)
                                    OperationTimePlant5Value = OperationTimePlant5Value + tempOperationTimePlant5Value;
                            }
                            #endregion
                            WaysMenulistTemp[d].WayStandardOperationTime = (float?)Math.Round(Convert.ToDouble(StandardTime), 2);
                            WaysMenulistTemp[d].WayOperationTimePlant1Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant1Value), 2);
                            WaysMenulistTemp[d].WayOperationTimePlant2Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant2Value), 2);
                            WaysMenulistTemp[d].WayOperationTimePlant3Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant3Value), 2);
                            WaysMenulistTemp[d].WayOperationTimePlant4Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant4Value), 2);
                            WaysMenulistTemp[d].WayOperationTimePlant5Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant5Value), 2);
                            #region GEOS2-3954 Show the WorkOperations and SOD Time in the format: MM:SS or HH:MM:SS
                            try
                            {
                                WaysMenulistTemp[d].UiTempStandardOperationTimeName = ConvertfloattoTimespan(Convert.ToString(WaysMenulistTemp[d].WayStandardOperationTime));
                                WaysMenulistTemp[d].UiTempoperationTimePlant1Value = ConvertfloattoTimespan(Convert.ToString(WaysMenulistTemp[d].WayOperationTimePlant1Value));
                                WaysMenulistTemp[d].UiTempoperationTimePlant2Value = ConvertfloattoTimespan(Convert.ToString(WaysMenulistTemp[d].WayOperationTimePlant2Value));
                                WaysMenulistTemp[d].UiTempoperationTimePlant3Value = ConvertfloattoTimespan(Convert.ToString(WaysMenulistTemp[d].WayOperationTimePlant3Value));
                                WaysMenulistTemp[d].UiTempoperationTimePlant4Value = ConvertfloattoTimespan(Convert.ToString(WaysMenulistTemp[d].WayOperationTimePlant4Value));
                                WaysMenulistTemp[d].UiTempoperationTimePlant5Value = ConvertfloattoTimespan(Convert.ToString(WaysMenulistTemp[d].WayOperationTimePlant5Value));
                            }
                            catch (Exception ex)
                            {
                                GeosApplication.Instance.Logger.Log(string.Format("Error in Method WayCustomSummarycalculation() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            }
                            #endregion
                        }
                    }
                #endregion
                WaysMenulist = new ObservableCollection<ERMSOPWays>();
                WaysMenulist = WaysMenulistTemp;
                #endregion
                //FillWayGridColumn();//[GEOS2-4830][gulab lakade][07 12 2023]
                //wayCustomSummarycalculation();//[GEOS2-4830][gulab lakade][07 12 2023]

                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Method RetrieveWorkOperationsByWay()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log(string.Format("Error in method RetrieveWorkOperationsByWay() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void CompleteDropRecorWayGrid(DropRecordEventArgs e)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method CompleteDropRecorWayGrid()...", category: Category.Info, priority: Priority.Low);
                ObservableCollection<ERMSOPWays> WaysMenulistTemp = new ObservableCollection<ERMSOPWays>();  //[GEOS2-4830][gulab lakade][07 12 2023]
                Saveselecteditem = "Ways";  //[GEOS2-4108][Rupali Sarode][3-1-2022]
                string WOWithStatusMessage = string.Empty;  // [GEOS2-5020][Rupali Sarode][29-11-2023]

                if (!DXSplashScreen.IsActive)
                {
                    DXSplashScreen.Show(x =>
                    {
                        Window win = new Window()
                        {
                            ShowActivated = false,
                            WindowStyle = WindowStyle.None,
                            ResizeMode = ResizeMode.NoResize,
                            AllowsTransparency = true,
                            Background = new SolidColorBrush(Colors.Transparent),
                            ShowInTaskbar = false,
                            Topmost = true,
                            SizeToContent = SizeToContent.WidthAndHeight,
                            WindowStartupLocation = WindowStartupLocation.CenterScreen,
                        };
                        WindowFadeAnimationBehavior.SetEnableAnimation(win, true);
                        win.Topmost = false;
                        return win;
                    }, x =>
                    {
                        return new SplashScreenView() { DataContext = new SplashScreenViewModel() };
                    }, null, null);
                }

                if (SelectedItemWay is ERMWays)
                {

                    IsEnabledSaveButton = true;
                    SaveButtonVisibility = Visibility.Visible;
                    duplicateItemloopWay = 0;
                    if ((e.IsFromOutside) && typeof(WorkOperationByStages).IsAssignableFrom(e.GetRecordType()))
                    {
                        //WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                        var data = (RecordDragDropData)e.Data.GetData(typeof(RecordDragDropData));
                        List<WorkOperationByStages> found = new List<WorkOperationByStages>();
                        List<WorkOperationByStages> TempfoundAllrecords = new List<WorkOperationByStages>();
                        List<WorkOperationByStages> records = data.Records.OfType<WorkOperationByStages>().ToList();
                        operationWayMenulist = new ObservableCollection<WorkOperationByStages>();
                        int count = 0;
                        if (WaysMenulist == null)
                        {
                            WaysMenulist = new ObservableCollection<ERMSOPWays>();
                        }
                        if (WaysMenulist.Count() > 0)
                        {
                            WaysMenulistTemp = WaysMenulist;
                        }

                        if (records.Any(a => a.Name.Equals("All")))
                        {
                            #region ALL
                            found = new List<WorkOperationByStages>();
                            operationWayMenulist = new ObservableCollection<WorkOperationByStages>();
                            operationWayMenulist.AddRange(WorkOperationMenulist.Where(w => !w.Name.Equals("All")));
                            #endregion
                        }
                        else
                        {

                            for (int r = 0; r < records.Count(); r++)
                            {
                                if (!WaysMenulistTemp.Any(a => a.Name.Equals(records[r].Name)))
                                {
                                    //if (records[r].IdStatus != 1536)
                                    //{
                                    records[r].IsCurrentWorkOperation = true;
                                    //DetectionMenulist.Add(JsonConvert.DeserializeObject<ERMSOPDetection>(JsonConvert.SerializeObject(records[r])));
                                    if (!operationWayMenulist.Any(a => a.KeyName.Equals(records[r].KeyName)))
                                        operationWayMenulist.Add(records[r]);
                                    //}


                                }

                                if (GetStages.Any(a => a != null && a.Code.Trim().Equals(records[r].Name.Trim())))
                                {
                                    found.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(records[r].KeyName)).ToList());
                                    int x = 0;
                                    Loop:
                                    x++;
                                    if (x < 4)
                                    {
                                        for (int i = 0; i < found.Count(); i++)
                                        {
                                            TempfoundAllrecords.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(found[i].KeyName)).ToList());
                                        }
                                        for (int i = 0; i < TempfoundAllrecords.Count(); i++)
                                        {
                                            if (!found.Any(a => a != null && a.KeyName.Trim().Equals(TempfoundAllrecords[i].KeyName.Trim())))
                                                found.Add(TempfoundAllrecords[i]);
                                        }
                                        goto Loop;
                                    }

                                }
                                else
                                {
                                    found.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(records[r].KeyName)).ToList());
                                    for (int i = 0; i < found.Count(); i++)
                                    {
                                        TempfoundAllrecords.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(found[i].KeyName)).ToList());
                                    }
                                    for (int i = 0; i < TempfoundAllrecords.Count(); i++)
                                    {
                                        if (!found.Any(a => a != null && a.KeyName.Trim().Equals(TempfoundAllrecords[i].KeyName.Trim())))
                                            found.Add(TempfoundAllrecords[i]);
                                    }
                                    for (int i = 0; i < records.Where(a => a.IdworkOperationByStage > 0).Count(); i++)
                                    {
                                        if (!found.Any(a => a != null && a.KeyName.Trim().Equals(records[i].KeyName.Trim())))
                                            found.AddRange(WorkOperationMenulist.Where(s => s.IdworkOperationByStage == records[i].IdworkOperationByStage).ToList());
                                        if (found.Count() != 0)
                                        {
                                            count++;
                                        }
                                    }
                                }

                            }
                        }


                        if (count > 0)
                        {
                            for (int i = 0; i < found.Count(); i++)
                            {
                                if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(found[i].Name.Trim())))
                                {
                                    duplicateItemloopWay = 0;
                                    GetAllTreeListWay(found[i], WorkOperationMenulist);
                                }

                            }
                        }
                        else
                        {

                            if (!records.Any(a => a.Name.Equals("All")))
                                foreach (WorkOperationByStages item in found)
                                {
                                    duplicateItemloopWay = 0;
                                    GetAllTreeListWay(item, WorkOperationMenulist);
                                }
                        }
                        if (!records.Any(a => a.Name.Equals("All")))
                            if (operationWayMenulist != null)
                            {
                                var tempModuleMenulist = operationWayMenulist.ToList();
                                for (int i = 0; i < tempModuleMenulist.Count; i++)
                                {
                                    if (GetStages.Any(a => a.Code.Equals(tempModuleMenulist[i].Name)))
                                    {
                                        List<WorkOperationByStages> childList = operationWayMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(tempModuleMenulist[i].KeyName)).ToList();
                                        if (childList.Count == 0)
                                        {
                                            operationWayMenulist.Remove(tempModuleMenulist[i]);
                                        }
                                    }
                                }
                            }

                        #region [GEOS2-5020][Rupali Sarode][29-11-2023]
                        List<string> WOWithStatusList;

                        WOWithStatusList = new List<string>();
                        string WOStausForChild = string.Empty;
                        List<WorkOperationByStages> WOChilds = operationWayMenulist.Where(i => i.ParentName != null && i.ParentName == records[0].KeyName).ToList();
                        if (WOChilds != null)
                        {
                            if (WOChilds.Count == 0) //If dropped item is child
                            {
                                if (records[0].Name != "All")
                                {
                                    int WOIdStatus = operationWayMenulist.Where(i => i.Name == records[0].Name).FirstOrDefault().IdStatus;
                                    if (WOIdStatus > 0 && WOIdStatus != 1535)
                                    {
                                        if (WOIdStatus == 1536) WOStausForChild = "in inactive status";
                                        if (WOIdStatus == 1537) WOStausForChild = "in draft status";

                                        if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                                        CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("AddEditSODDragOnlyActiveWO").ToString() + "\n" + "Work operation '" + records[0].Name + "' is " + WOStausForChild), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                                        return;
                                    }
                                }

                            }
                        }

                        #endregion [GEOS2-5020][Rupali Sarode][29-11-2023]


                        #region commonCode

                        bool FlagAddItemToList; // [GEOS2-5020][Rupali Sarode][29-11-2023]

                        #region [GEOS2-4830][gulab lakade][07 12 2023]
                        if (AllSupplementsBoxMenu != null)
                        {
                            var listadoDuplicadas = from c in AllSupplementsBoxMenu
                                                    join c2 in AllSupplementsBoxMenu on c.Item2 equals c2.Item2
                                                    where c != c2
                                                    select c;

                            var WaySandardOperationTime = listadoDuplicadas.FirstOrDefault();
                            if (WaySandardOperationTime != null)
                            {
                                var templist = listadoDuplicadas.Where(a => a.Item2 == WaySandardOperationTime.Item2);
                                listadoDuplicadas = templist;
                            }

                            var tempSupplementsBoxMenu = AllSupplementsBoxMenu;

                            ColumnsWayForSupplements = new ObservableCollection<TreeListColumn>();
                            ColumnsWayForSupplements.Add(new TreeListColumn()
                            {
                                FieldName = "WayStandardSupplements",
                                Header = "Standard",
                                HeaderToolTip = "Standard",
                                AllowCellMerge = false,
                                Width = 150,
                                AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                Visible = true,
                                ReadOnly = false,
                                FixedWidth = false
                            });

                            ColumnsWayOperationTime = new ObservableCollection<TreeListColumn>();
                            ColumnsWayOperationTime.Add(new TreeListColumn()
                            {
                                FieldName = "UiTempStandardOperationTimeName",
                                Header = "Standard",
                                HeaderToolTip = "Standard",
                                AllowCellMerge = false,
                                Width = 150,
                                AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                Visible = true,
                                ReadOnly = false,
                                FixedWidth = false
                            });

                            int Supplimentcount = 1;
                            var ColumnsWayList = tempSupplementsBoxMenu.Where(p => !listadoDuplicadas.Any(p2 => p2.Item1 == p.Item1));
                            foreach (var item in ColumnsWayList)
                            {
                                if (Supplimentcount == 5)
                                {
                                    ColumnsWayForSupplements.Add(new TreeListColumn()
                                    {
                                        FieldName = "WaySupplementPlant" + Supplimentcount + "Value",
                                        Header = "Others",
                                        HeaderToolTip = "Others",
                                        AllowCellMerge = false,
                                        Width = 60,
                                        AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                        Visible = true,
                                        ReadOnly = false,
                                        FixedWidth = false
                                    });
                                    ColumnsWayOperationTime.Add(new TreeListColumn()
                                    {
                                        FieldName = "UiTempoperationTimePlant" + Supplimentcount + "Value",
                                        Header = "Others",
                                        HeaderToolTip = "Others",
                                        AllowCellMerge = false,
                                        Width = 60,
                                        AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                        Visible = true,
                                        ReadOnly = false,
                                        FixedWidth = false
                                    });
                                    break;
                                }
                                if (Supplimentcount == 5)
                                {
                                    break;
                                }
                                ColumnsWayForSupplements.Add(new TreeListColumn()
                                {
                                    FieldName = "WaySupplementPlant" + Supplimentcount + "Value",
                                    Header = item.Item1,
                                    HeaderToolTip = item.Item1,
                                    AllowCellMerge = false,
                                    Width = 60,
                                    AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                    Visible = true,
                                    ReadOnly = false,
                                    FixedWidth = false
                                });

                                ColumnsWayOperationTime.Add(new TreeListColumn()
                                {
                                    FieldName = "UiTempoperationTimePlant" + Supplimentcount + "Value",
                                    Header = item.Item1,
                                    HeaderToolTip = item.Item1,
                                    AllowCellMerge = false,
                                    Width = 60,
                                    AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                    Visible = true,
                                    ReadOnly = false,
                                    FixedWidth = false
                                });
                                Supplimentcount = Supplimentcount + 1;
                            }
                            #endregion
                            foreach (WorkOperationByStages Way in WorkOperationMenulist)
                            {
                                FlagAddItemToList = true; //[GEOS2-5020][Rupali Sarode][29-11-2023]

                                //if (Option.IdStatus != 1536)
                                if (operationWayMenulist.Any(a => a.IdworkOperationByStage == Convert.ToInt64(Way.IdworkOperationByStage))
                                   && operationWayMenulist.Any(a => a.IdStage == Way.IdStage)
                                && operationWayMenulist.Any(a => a.Name.Trim().Equals(Way.Name.Trim()))
                                )
                                {
                                    //[GEOS2-5020][Rupali Sarode][30-11-2023] 
                                    List<WorkOperationByStages> TempWOChilds = new List<WorkOperationByStages>();
                                    TempWOChilds = operationWayMenulist.Where(i => i.ParentName == Way.KeyName).ToList();

                                    if (GetStages.Any(a => a.Code.Equals(Way.Name)))
                                    //If it is stage and only one parent is selected which is inactive/draft, then do not add such a stage to list
                                    {
                                        List<WorkOperationByStages> childListInActiveDraft = operationWayMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(Way.KeyName)).ToList();

                                        if (childListInActiveDraft.Count > 0)
                                        {
                                            foreach (WorkOperationByStages objChild in childListInActiveDraft)
                                            {
                                                List<WorkOperationByStages> GrandChildListInActiveDraft = new List<WorkOperationByStages>();
                                                GrandChildListInActiveDraft = operationWayMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(objChild.KeyName)).ToList();
                                                if (GrandChildListInActiveDraft.Count == 0)
                                                { // If it is child and Active
                                                    if (objChild.IdStatus == 1535)
                                                    {
                                                        FlagAddItemToList = true;
                                                        break;
                                                    }
                                                    else
                                                    {
                                                        FlagAddItemToList = false;
                                                    }

                                                }
                                                else
                                                {
                                                    if (GrandChildListInActiveDraft.Count > 0)
                                                    {
                                                        if (GrandChildListInActiveDraft.Where(i => i.IdStatus == 1535).Count() > 0)
                                                        {
                                                            FlagAddItemToList = true;
                                                            break;
                                                        }
                                                        else
                                                        {
                                                            FlagAddItemToList = false;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    else if (TempWOChilds.Count() > 0 && (TempWOChilds.Count() == TempWOChilds.Where(i => i.IdStatus != 1535).Count()))
                                    // All children are in inactive/draft status
                                    {
                                        // do not add such parent to list in grid
                                        FlagAddItemToList = false;
                                    }
                                    //}
                                    else
                                    if (TempWOChilds.Count == 0 && Way.IdStatus != 1535)
                                    // If child is inactive/draft, do not add it.
                                    // If Parent is inactive/draft, add it only if it has inactive/draft child(s).
                                    {
                                        if (string.IsNullOrEmpty(WOWithStatusMessage))
                                        {
                                            if (Way.IdStatus == 1536)
                                                WOWithStatusMessage = "Work operation '" + Way.Name + "' is " + "in inactive status";
                                            else if (Way.IdStatus == 1537)
                                                WOWithStatusMessage = "Work operation '" + Way.Name + "' is " + "in draft status";
                                        }
                                        else
                                        {
                                            if (Way.IdStatus == 1536)
                                                WOWithStatusMessage = WOWithStatusMessage + "\n" + "Work operation '" + Way.Name + "' is " + "in inactive status";
                                            else if (Way.IdStatus == 1537)
                                                WOWithStatusMessage = WOWithStatusMessage + "\n" + "Work operation '" + Way.Name + "' is " + "in draft status";
                                        }
                                        FlagAddItemToList = false;

                                    }

                                    //if (Way.IdStatus != 1536 && Way.IdStatus != 1537) //[GEOS2-5020][Rupali Sarode][30-11-2023]
                                    //{
                                    ERMSOPWays eRMSOPWay = new ERMSOPWays();
                                    eRMSOPWay.Name = Way.Name;
                                    eRMSOPWay.IdworkOperationByStage = Way.IdworkOperationByStage;
                                    eRMSOPWay.IdSequence = Way.IdSequence;
                                    eRMSOPWay.IdStatus = Way.IdStatus;
                                    eRMSOPWay.Status = Way.Status;
                                    eRMSOPWay.Code = Way.Name;
                                    eRMSOPWay.Parent = Way.Parent;
                                    eRMSOPWay.IdParent = Way.IdParent;
                                    eRMSOPWay.KeyName = Way.KeyName;
                                    eRMSOPWay.ParentName = Way.ParentName;
                                    eRMSOPWay.Position = Way.Position;
                                    #region [GEOS2-5629][gulab lakade][16 07 2024]
                                    if (WaysMenulistTemp != null)
                                    {
                                        if (Way.ParentName == null)
                                        {
                                            eRMSOPWay.WayPosition = Way.Position;
                                        }
                                        else
                                        {
                                            #region [gulab lakade][beta changes][01082024]
                                            if (WaysMenulistTemp.Count() == 0)
                                            {
                                                if (Way.Position == 1)
                                                {
                                                    eRMSOPWay.WayPosition = Way.Position;
                                                }
                                                else
                                                {
                                                    eRMSOPWay.WayPosition = 1;
                                                }

                                            }
                                            else
                                            {
                                                #endregion
                                                var TempModule = WaysMenulistTemp.Where(x => x.KeyName == Way.KeyName).FirstOrDefault();
                                                if (TempModule != null)
                                                {
                                                    eRMSOPWay.WayPosition = TempModule.WayPosition;
                                                }
                                                else
                                                {
                                                    if (WaysMenulistTemp.Where(x => x.ParentName == Way.ParentName).FirstOrDefault() == null)
                                                    {
                                                        var maxpos = WaysMenulistTemp.Max(a => a.WayPosition);
                                                        eRMSOPWay.WayPosition = maxpos + 1;
                                                    }
                                                    else
                                                    {
                                                        var maxpos = WaysMenulistTemp.Where(x => x.ParentName == Way.ParentName).Max(a => a.WayPosition);
                                                        eRMSOPWay.WayPosition = maxpos + 1;
                                                    }

                                                }
                                            }
                                        }//[gulab lakade][beta changes][01082024]

                                    }

                                    #endregion
                                    eRMSOPWay.WorkOperation_count = Way.WorkOperation_count;
                                    eRMSOPWay.WorkOperation_count_original = Way.WorkOperation_count_original;
                                    eRMSOPWay.NameWithWorkOperationCount = Way.NameWithWorkOperationCount;
                                    eRMSOPWay.WayNormalTime = Way.NormalTime;

                                    ERMWays tIdDetection = (ERMWays)SelectedItemWay;  //[GEOS2-3923][Rupali Sarode][23-11-2022]
                                    eRMSOPWay.IdDetection = Convert.ToUInt64(tIdDetection.IdDetection); //[GEOS2-3923][Rupali Sarode][23-11-2022]


                                    if (Way.NormalTime != null)
                                    {
                                        eRMSOPWay.WayNormalTime = Math.Round((double)Way.NormalTime, 2);
                                        #region [GEOS2-3954][Rupali Sarode]
                                        eRMSOPWay.UITempWaysNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(eRMSOPWay.WayNormalTime));
                                        #endregion
                                    }
                                    eRMSOPWay.WayObservedTime = Way.ObservedTime;
                                    if (Way.ObservedTime != null)
                                    {
                                        eRMSOPWay.WayObservedTime = Math.Round((double)Way.ObservedTime, 2);
                                        #region [GEOS2-3954][Rupali Sarode]
                                        eRMSOPWay.UITempWaysObservedTime = ConvertfloattoTimespan(Convert.ToString(eRMSOPWay.WayObservedTime));
                                        #endregion
                                    }
                                    eRMSOPWay.WayActivity = Way.Activity;
                                    if (eRMSOPWay.WayActivity != 0)
                                        eRMSOPWay.WayActivity = Math.Round((double)Way.Activity, 2);
                                    if (eRMSOPWay.WayActivity == 0)
                                        eRMSOPWay.WayActivity = null;

                                    //[GEOS2-3933][Rupali Sarode][22/09/2022]
                                    eRMSOPWay.WORemarks = Way.WORemarks == null ? "" : Way.WORemarks.Trim();

                                    if (GetStages.Any(a => a != null && a.Code.Trim().Equals(Way.Name.Trim())))
                                    {
                                        Way.IsCurrentWorkOperation = true;
                                        eRMSOPWay.IsDeleteButton = false;
                                        eRMSOPWay.IsDeleteButtonVisibility = Visibility.Hidden;
                                        eRMSOPWay.IsValidateOnTextInput = false;
                                    }
                                    else
                                    {
                                        Way.IsCurrentWorkOperation = true;

                                        eRMSOPWay.IsValidateOnTextInput = true;
                                    }
                                    if (Way.IdStatus == 1536)
                                    {
                                        eRMSOPWay.IsInactiveWorkOperation = true;
                                    }
                                    #region [GEOS2-4830][gulab lakade][07 12 2023]
                                    if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(eRMSOPWay.Name.Trim())))
                                    {
                                        if (WaySandardOperationTime != null)
                                            eRMSOPWay.WayStandardSupplements = (float?)WaySandardOperationTime.Item2;
                                        if (tempSupplementsBoxMenu.Any(p => !listadoDuplicadas.Any(p2 => p2.Item1 == p.Item1)))
                                        {
                                            eRMSOPWay.AllSupplementsBoxMenu = AllSupplementsBoxMenu;
                                            List<float?> lst = new List<float?>();

                                            var a = ColumnsWayList.ToList();
                                            for (int i = 0; i < a.Count(); i++)
                                            {
                                                lst.Add((float?)a[i].Item2);
                                            }

                                            if (ColumnsWayList.Count() == 1)
                                            {
                                                eRMSOPWay.WaySupplementPlant1Value = (float?)lst[0];
                                            }
                                            else if (ColumnsWayList.Count() == 2)
                                            {
                                                eRMSOPWay.WaySupplementPlant1Value = (float?)lst[0];
                                                eRMSOPWay.WaySupplementPlant2Value = (float?)lst[1];
                                            }
                                            else if (ColumnsWayList.Count() == 3)
                                            {
                                                eRMSOPWay.WaySupplementPlant1Value = (float?)lst[0];
                                                eRMSOPWay.WaySupplementPlant2Value = (float?)lst[1];
                                                eRMSOPWay.WaySupplementPlant3Value = (float?)lst[2];
                                            }
                                            else if (ColumnsWayList.Count() == 4)
                                            {
                                                eRMSOPWay.WaySupplementPlant1Value = (float?)lst[0];
                                                eRMSOPWay.WaySupplementPlant2Value = (float?)lst[1];
                                                eRMSOPWay.WaySupplementPlant3Value = (float?)lst[2];
                                                eRMSOPWay.WaySupplementPlant4Value = (float?)lst[3];
                                            }
                                            else if (ColumnsWayList.Count() == 5)
                                            {
                                                eRMSOPWay.WaySupplementPlant1Value = (float?)lst[0];
                                                eRMSOPWay.WaySupplementPlant2Value = (float?)lst[1];
                                                eRMSOPWay.WaySupplementPlant3Value = (float?)lst[2];
                                                eRMSOPWay.WaySupplementPlant4Value = (float?)lst[3];
                                                eRMSOPWay.WaySupplementPlant5Value = (float?)lst[4];
                                            }
                                            else
                                            {
                                                eRMSOPWay.WaySupplementPlant1Value = (float?)lst[0];
                                                eRMSOPWay.WaySupplementPlant2Value = (float?)lst[1];
                                                eRMSOPWay.WaySupplementPlant3Value = (float?)lst[2];
                                                eRMSOPWay.WaySupplementPlant4Value = (float?)lst[3];
                                                eRMSOPWay.WaySupplementPlant5Value = 0;
                                                if (ColumnsWayList.Count() > 5)
                                                {
                                                    for (int q = 4; q < ColumnsWayList.Count(); q++)
                                                    {
                                                        if (eRMSOPWay.WaySupplementPlant5Value == null)
                                                            eRMSOPWay.WaySupplementPlant5Value = 0;
                                                        eRMSOPWay.WaySupplementPlant5Value = eRMSOPWay.WaySupplementPlant5Value + (float?)lst[q];
                                                    }
                                                }


                                            }

                                        }
                                        #region GEOS2-4046 Gulab Lakade
                                        if (WaySandardOperationTime != null)
                                            eRMSOPWay.WayStandardOperationTime = (float?)Math.Round(Convert.ToDouble(eRMSOPWay.WayNormalTime * (1 + (Convert.ToDouble(WaySandardOperationTime.Item2) / 100))), 2);

                                        eRMSOPWay.WayOperationTimePlant1Value = (float?)Math.Round(Convert.ToDouble(eRMSOPWay.WayNormalTime * (1 + (Convert.ToDouble(eRMSOPWay.WaySupplementPlant1Value) / 100))), 2);
                                        eRMSOPWay.WayOperationTimePlant2Value = (float?)Math.Round(Convert.ToDouble(eRMSOPWay.WayNormalTime * (1 + (Convert.ToDouble(eRMSOPWay.WaySupplementPlant2Value) / 100))), 2);
                                        eRMSOPWay.WayOperationTimePlant3Value = (float?)Math.Round(Convert.ToDouble(eRMSOPWay.WayNormalTime * (1 + (Convert.ToDouble(eRMSOPWay.WaySupplementPlant3Value) / 100))), 2);
                                        eRMSOPWay.WayOperationTimePlant4Value = (float?)Math.Round(Convert.ToDouble(eRMSOPWay.WayNormalTime * (1 + (Convert.ToDouble(eRMSOPWay.WaySupplementPlant4Value) / 100))), 2);
                                        eRMSOPWay.WayOperationTimePlant5Value = (float?)Math.Round(Convert.ToDouble(eRMSOPWay.WayNormalTime * (1 + (Convert.ToDouble(eRMSOPWay.WaySupplementPlant5Value) / 100))), 2);
                                        #endregion
                                        #region GEOS2-3954 Show the WorkOperations and SOD Time in the format: MM:SS or HH:MM:SS
                                        try
                                        {
                                            eRMSOPWay.UiTempStandardOperationTimeName = ConvertfloattoTimespan(Convert.ToString(eRMSOPWay.WayStandardOperationTime));
                                            eRMSOPWay.UiTempoperationTimePlant1Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPWay.WayOperationTimePlant1Value));
                                            eRMSOPWay.UiTempoperationTimePlant2Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPWay.WayOperationTimePlant2Value));
                                            eRMSOPWay.UiTempoperationTimePlant3Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPWay.WayOperationTimePlant3Value));
                                            eRMSOPWay.UiTempoperationTimePlant4Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPWay.WayOperationTimePlant4Value));
                                            eRMSOPWay.UiTempoperationTimePlant5Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPWay.WayOperationTimePlant5Value));
                                        }
                                        catch (Exception ex)
                                        {
                                            GeosApplication.Instance.Logger.Log(string.Format("Error in Method CompleteDropRecorWayGrid() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                        }
                                        #endregion
                                    }
                                    #endregion
                                    try
                                    {
                                        //if (!WaysMenulistTemp.Any(a => a.KeyName.Equals(Way.KeyName)))
                                        if (!WaysMenulistTemp.Any(a => a.KeyName.Equals(Way.KeyName)) && FlagAddItemToList == true) //  [GEOS2-5020][Rupali Sarode][29-11-2023]
                                        {
                                            WaysMenulistTemp.Add(eRMSOPWay);
                                        }

                                    }
                                    catch (Exception ex)
                                    {

                                    }
                                    //}
                                }
                            }
                        }// [GEOS2-4830][gulab lakade][07 12 2023]
                        #endregion
                    }
                    //List<ERMSOPWays> tempWorkOperationWayMenulist = WaysMenulistTemp.OrderBy(x => x.Position).ToList();
                    List<ERMSOPWays> tempWorkOperationWayMenulist = WaysMenulistTemp.OrderBy(x => x.WayPosition).ToList();
                    WaysMenulistTemp.Clear();
                    WaysMenulistTemp.AddRange(tempWorkOperationWayMenulist);
                    tempWorkOperationWayMenulist.Clear();

                    #region RND
                    #region calculation
                    #region [GEOS2-4830][gulab lakade][07 12 2023]
                    //if (WaysMenulistTemp != null)
                    //    for (int d = 0; d < WaysMenulistTemp.Count(); d++)
                    //    {
                    //        WorkOperationMenulist.Where(w => w.KeyName == WaysMenulistTemp[d].KeyName).ToList().ForEach(f => f.IsCurrentWorkOperation = true);
                    //        var listCount = WaysMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(WaysMenulistTemp[d].KeyName) && w.IsInactiveWorkOperation == false).ToList();
                    //        if (listCount != null)
                    //            if (listCount.Count() > 0)
                    //            {
                    //                WaysMenulistTemp[d].WayObservedTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.WayObservedTime)), 2);
                    //                WaysMenulistTemp[d].WayNormalTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.WayNormalTime)), 2);
                    //                #region [GEOS2-3954][Rupali Sarode] Time format HH:mm:ss
                    //                WaysMenulistTemp[d].UITempWaysObservedTime = ConvertfloattoTimespan(Convert.ToString(Convert.ToDouble(listCount.Sum(s => s.WayObservedTime))));
                    //                WaysMenulistTemp[d].UITempWaysNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(Convert.ToDouble(listCount.Sum(s => s.WayNormalTime))));
                    //                #endregion

                    //                WaysMenulistTemp[d].IsReadOnly = true;
                    //            }
                    //    }
                    #endregion
                    if (WaysMenulistTemp != null)
                        for (int d = 0; d < WaysMenulistTemp.Count(); d++)
                        {
                            WorkOperationMenulist.Where(w => w.KeyName == WaysMenulistTemp[d].KeyName).ToList().ForEach(f => f.IsCurrentWorkOperation = true);
                            //[GEOS2-5135][Rupali Sarode][18-12-2023]
                            // var listCount = WaysMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(WaysMenulistTemp[d].KeyName) && w.IsInactiveWorkOperation == false).ToList();
                            var listCount = WaysMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(WaysMenulistTemp[d].KeyName)).ToList();
                            if (listCount != null)
                                if (listCount.Count() > 0)
                                {
                                    WaysMenulistTemp[d].WayObservedTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.WayObservedTime)), 2);
                                    WaysMenulistTemp[d].WayNormalTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.WayNormalTime)), 2);
                                    #region [GEOS2-3954][Rupali Sarode] Time format HH:mm:ss
                                    WaysMenulistTemp[d].UITempWaysObservedTime = ConvertfloattoTimespan(Convert.ToString(listCount.Sum(s => s.WayObservedTime)));
                                    WaysMenulistTemp[d].UITempWaysNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(listCount.Sum(s => s.WayNormalTime)));
                                    #endregion
                                    WaysMenulistTemp[d].IsReadOnly = true;
                                }
                        }

                    if (WaysMenulistTemp != null)
                        for (int d = 0; d < WaysMenulistTemp.Count(); d++)
                        {
                            if (GetStages.Any(a => a.Code.Equals(WaysMenulistTemp[d].Name)))
                            {
                                ObservableCollection<ERMSOPWays> ActivitySum = new ObservableCollection<ERMSOPWays>();
                                ObservableCollection<ERMSOPWays> TempActivitySum = new ObservableCollection<ERMSOPWays>();
                                int x = 1;
                                Loop:
                                x++;
                                if (x < 10)
                                {
                                    if (ActivitySum.Count == 0)
                                    {
                                        WaysMenulistTemp[d].WayObservedTime = 0;
                                        WaysMenulistTemp[d].WayNormalTime = 0;
                                        #region [GEOS2-3954][Rupali Sarode] Time format HH:mm:ss
                                        WaysMenulistTemp[d].UITempWaysObservedTime = ConvertfloattoTimespan(Convert.ToString(WaysMenulistTemp[d].WayObservedTime));
                                        WaysMenulistTemp[d].UITempWaysNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(WaysMenulistTemp[d].WayNormalTime));
                                        #endregion
                                        //[GEOS2-5135][Rupali Sarode][18-12-2023]
                                        // var ActivitySumList = WaysMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(WaysMenulistTemp[d].KeyName) && w.IsInactiveWorkOperation == false).ToList();
                                        var ActivitySumList = WaysMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(WaysMenulistTemp[d].KeyName)).ToList();
                                        ActivitySum.AddRange(ActivitySumList);
                                    }
                                    else
                                    {

                                    }


                                    goto Loop;
                                }

                                double? ObservedTime = 0;
                                double? NormalTime = 0;
                                float? StandardTime = 0;
                                float? OperationTimePlant1Value = 0;
                                float? OperationTimePlant2Value = 0;
                                float? OperationTimePlant3Value = 0;
                                float? OperationTimePlant4Value = 0;
                                float? OperationTimePlant5Value = 0;
                                var tempDistinctList = ActivitySum.Select(xa => xa.KeyName).Distinct().ToList();
                                foreach (var item in tempDistinctList)
                                {
                                    if (WaysMenulistTemp[d].WayObservedTime == null)
                                        WaysMenulistTemp[d].WayObservedTime = 0;
                                    double? tempObservedTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.WayObservedTime).FirstOrDefault();
                                    if (tempObservedTime != null)
                                    {
                                        ObservedTime = Math.Round(Convert.ToDouble(ObservedTime + tempObservedTime), 2);
                                        #region [GEOS2-3954] [Rupali Sarode] Time format HH:mm:ss
                                        WaysMenulistTemp[d].UITempWaysObservedTime = ConvertfloattoTimespan(Convert.ToString(ObservedTime));

                                        #endregion
                                    }
                                    if (WaysMenulistTemp[d].WayNormalTime == null)
                                        WaysMenulistTemp[d].WayNormalTime = 0;
                                    double? tempNormalTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.WayNormalTime).FirstOrDefault();
                                    if (tempNormalTime != null)
                                    {
                                        NormalTime = Math.Round(Convert.ToDouble(NormalTime + tempNormalTime), 2);
                                        #region [GEOS2-3954] [Rupali Sarode] Time format HH:mm:ss
                                        WaysMenulistTemp[d].UITempWaysNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(NormalTime));
                                        #endregion

                                    }
                                }
                                WaysMenulistTemp[d].WayObservedTime = ObservedTime;
                                WaysMenulistTemp[d].WayNormalTime = NormalTime;
                                #region [GEOS2-3954] [Rupali Sarode] Time format HH:mm:ss
                                WaysMenulistTemp[d].UITempWaysObservedTime = ConvertfloattoTimespan(Convert.ToString(ObservedTime));
                                WaysMenulistTemp[d].UITempWaysNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(WaysMenulistTemp[d].WayNormalTime));
                                #endregion


                                #region PlantValue


                                foreach (var item in tempDistinctList)
                                {
                                    if (WaysMenulistTemp[d].WayStandardOperationTime == null)
                                        WaysMenulistTemp[d].WayStandardOperationTime = 0;
                                    float? tempStandardTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.WayStandardOperationTime).FirstOrDefault();
                                    if (tempStandardTime != null)
                                        StandardTime = StandardTime + tempStandardTime;

                                    if (WaysMenulistTemp[d].WayOperationTimePlant1Value == null)
                                        WaysMenulistTemp[d].WayOperationTimePlant1Value = 0;
                                    float? tempOperationTimePlant1Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.WayOperationTimePlant1Value).FirstOrDefault();
                                    if (tempOperationTimePlant1Value != null)
                                        OperationTimePlant1Value = OperationTimePlant1Value + tempOperationTimePlant1Value;

                                    if (WaysMenulistTemp[d].WayOperationTimePlant2Value == null)
                                        WaysMenulistTemp[d].WayOperationTimePlant2Value = 0;
                                    float? tempOperationTimePlant2Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.WayOperationTimePlant2Value).FirstOrDefault();
                                    if (tempOperationTimePlant2Value != null)
                                        OperationTimePlant2Value = OperationTimePlant2Value + tempOperationTimePlant2Value;

                                    if (WaysMenulistTemp[d].WayOperationTimePlant3Value == null)
                                        WaysMenulistTemp[d].WayOperationTimePlant3Value = 0;
                                    float? tempOperationTimePlant3Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.WayOperationTimePlant3Value).FirstOrDefault();
                                    if (tempOperationTimePlant3Value != null)
                                        OperationTimePlant3Value = OperationTimePlant3Value + tempOperationTimePlant3Value;

                                    if (WaysMenulistTemp[d].WayOperationTimePlant4Value == null)
                                        WaysMenulistTemp[d].WayOperationTimePlant4Value = 0;
                                    float? tempOperationTimePlant4Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.WayOperationTimePlant4Value).FirstOrDefault();
                                    if (tempOperationTimePlant4Value != null)
                                        OperationTimePlant4Value = OperationTimePlant4Value + tempOperationTimePlant4Value;

                                    if (WaysMenulistTemp[d].WayOperationTimePlant5Value == null)
                                        WaysMenulistTemp[d].WayOperationTimePlant5Value = 0;
                                    float? tempOperationTimePlant5Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.WayOperationTimePlant5Value).FirstOrDefault();
                                    if (tempOperationTimePlant5Value != null)
                                        OperationTimePlant5Value = OperationTimePlant5Value + tempOperationTimePlant5Value;
                                }
                                #endregion
                                WaysMenulistTemp[d].WayStandardOperationTime = (float?)Math.Round(Convert.ToDouble(StandardTime), 2);
                                WaysMenulistTemp[d].WayOperationTimePlant1Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant1Value), 2);
                                WaysMenulistTemp[d].WayOperationTimePlant2Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant2Value), 2);
                                WaysMenulistTemp[d].WayOperationTimePlant3Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant3Value), 2);
                                WaysMenulistTemp[d].WayOperationTimePlant4Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant4Value), 2);
                                WaysMenulistTemp[d].WayOperationTimePlant5Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant5Value), 2);
                                #region GEOS2-3954 Show the WorkOperations and SOD Time in the format: MM:SS or HH:MM:SS
                                try
                                {
                                    WaysMenulistTemp[d].UiTempStandardOperationTimeName = ConvertfloattoTimespan(Convert.ToString(WaysMenulistTemp[d].WayStandardOperationTime));
                                    WaysMenulistTemp[d].UiTempoperationTimePlant1Value = ConvertfloattoTimespan(Convert.ToString(WaysMenulistTemp[d].WayOperationTimePlant1Value));
                                    WaysMenulistTemp[d].UiTempoperationTimePlant2Value = ConvertfloattoTimespan(Convert.ToString(WaysMenulistTemp[d].WayOperationTimePlant2Value));
                                    WaysMenulistTemp[d].UiTempoperationTimePlant3Value = ConvertfloattoTimespan(Convert.ToString(WaysMenulistTemp[d].WayOperationTimePlant3Value));
                                    WaysMenulistTemp[d].UiTempoperationTimePlant4Value = ConvertfloattoTimespan(Convert.ToString(WaysMenulistTemp[d].WayOperationTimePlant4Value));
                                    WaysMenulistTemp[d].UiTempoperationTimePlant5Value = ConvertfloattoTimespan(Convert.ToString(WaysMenulistTemp[d].WayOperationTimePlant5Value));
                                }
                                catch (Exception ex)
                                {
                                    GeosApplication.Instance.Logger.Log(string.Format("Error in Method WayCustomSummarycalculation() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                }
                                #endregion
                            }
                        }
                    #endregion
                    WaysMenulist = new ObservableCollection<ERMSOPWays>();
                    WaysMenulist = WaysMenulistTemp;
                    #endregion
                    //FillWayGridColumn();// [GEOS2-4830][gulab lakade][07 12 2023]
                    //wayCustomSummarycalculation();// [GEOS2-4830][gulab lakade][07 12 2023]
                    FlagToDragDrop = true;  //[GEOS2-3923][Rupali Sarode][26-11-2022]
                    e.Handled = true;

                    if (!string.IsNullOrEmpty(WOWithStatusMessage)) //  [GEOS2-5020][Rupali Sarode][29-11-2023]
                    {
                        if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                        CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("AddEditSODDragOnlyActiveWO").ToString() + "\n" + WOWithStatusMessage), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                    }
                }
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }

                GeosApplication.Instance.Logger.Log("Method CompleteDropRecorWayGrid()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in Method CompleteDropRecorWayGrid()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        private void FillWayGridColumn()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillWayGridColumn()...", category: Category.Info, priority: Priority.Low);

                if (AllSupplementsBoxMenu != null)
                {
                    var listadoDuplicadas = from c in AllSupplementsBoxMenu
                                            join c2 in AllSupplementsBoxMenu on c.Item2 equals c2.Item2
                                            where c != c2
                                            select c;

                    var WaySandardOperationTime = listadoDuplicadas.FirstOrDefault();
                    if (WaySandardOperationTime != null)
                    {
                        var templist = listadoDuplicadas.Where(a => a.Item2 == WaySandardOperationTime.Item2);
                        listadoDuplicadas = templist;
                    }

                    var tempSupplementsBoxMenu = AllSupplementsBoxMenu;

                    ColumnsWayForSupplements = new ObservableCollection<TreeListColumn>();
                    ColumnsWayForSupplements.Add(new TreeListColumn()
                    {
                        FieldName = "WayStandardSupplements",
                        Header = "Standard",
                        HeaderToolTip = "Standard",
                        AllowCellMerge = false,
                        Width = 150,
                        AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                        Visible = true,
                        ReadOnly = false,
                        FixedWidth = false
                    });

                    ColumnsWayOperationTime = new ObservableCollection<TreeListColumn>();
                    ColumnsWayOperationTime.Add(new TreeListColumn()
                    {
                        FieldName = "UiTempStandardOperationTimeName",
                        Header = "Standard",
                        HeaderToolTip = "Standard",
                        AllowCellMerge = false,
                        Width = 150,
                        AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                        Visible = true,
                        ReadOnly = false,
                        FixedWidth = false
                    });

                    int count = 1;
                    var ColumnsWayList = tempSupplementsBoxMenu.Where(p => !listadoDuplicadas.Any(p2 => p2.Item1 == p.Item1));
                    foreach (var item in ColumnsWayList)
                    {
                        if (count == 5)
                        {
                            ColumnsWayForSupplements.Add(new TreeListColumn()
                            {
                                FieldName = "WaySupplementPlant" + count + "Value",
                                Header = "Others",
                                HeaderToolTip = "Others",
                                AllowCellMerge = false,
                                Width = 60,
                                AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                Visible = true,
                                ReadOnly = false,
                                FixedWidth = false
                            });
                            ColumnsWayOperationTime.Add(new TreeListColumn()
                            {
                                FieldName = "UiTempoperationTimePlant" + count + "Value",
                                Header = "Others",
                                HeaderToolTip = "Others",
                                AllowCellMerge = false,
                                Width = 60,
                                AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                Visible = true,
                                ReadOnly = false,
                                FixedWidth = false
                            });
                            break;
                        }
                        if (count == 5)
                        {
                            break;
                        }
                        ColumnsWayForSupplements.Add(new TreeListColumn()
                        {
                            FieldName = "WaySupplementPlant" + count + "Value",
                            Header = item.Item1,
                            HeaderToolTip = item.Item1,
                            AllowCellMerge = false,
                            Width = 60,
                            AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                            Visible = true,
                            ReadOnly = false,
                            FixedWidth = false
                        });

                        ColumnsWayOperationTime.Add(new TreeListColumn()
                        {
                            FieldName = "UiTempoperationTimePlant" + count + "Value",
                            Header = item.Item1,
                            HeaderToolTip = item.Item1,
                            AllowCellMerge = false,
                            Width = 60,
                            AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                            Visible = true,
                            ReadOnly = false,
                            FixedWidth = false
                        });
                        count = count + 1;
                    }


                    if (WaysMenulist != null)

                        for (int d = 0; d < WaysMenulist.Count(); d++)
                        {
                            if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(WaysMenulist[d].Name.Trim())))
                            {
                                if (WaySandardOperationTime != null)
                                    WaysMenulist[d].WayStandardSupplements = (float?)WaySandardOperationTime.Item2;
                                if (tempSupplementsBoxMenu.Any(p => !listadoDuplicadas.Any(p2 => p2.Item1 == p.Item1)))
                                {
                                    WaysMenulist[d].AllSupplementsBoxMenu = AllSupplementsBoxMenu;
                                    List<float?> lst = new List<float?>();

                                    var a = ColumnsWayList.ToList();
                                    for (int i = 0; i < a.Count(); i++)
                                    {
                                        lst.Add((float?)a[i].Item2);
                                    }

                                    if (ColumnsWayList.Count() == 1)
                                    {
                                        WaysMenulist[d].WaySupplementPlant1Value = (float?)lst[0];
                                    }
                                    else if (ColumnsWayList.Count() == 2)
                                    {
                                        WaysMenulist[d].WaySupplementPlant1Value = (float?)lst[0];
                                        WaysMenulist[d].WaySupplementPlant2Value = (float?)lst[1];
                                    }
                                    else if (ColumnsWayList.Count() == 3)
                                    {
                                        WaysMenulist[d].WaySupplementPlant1Value = (float?)lst[0];
                                        WaysMenulist[d].WaySupplementPlant2Value = (float?)lst[1];
                                        WaysMenulist[d].WaySupplementPlant3Value = (float?)lst[2];
                                    }
                                    else if (ColumnsWayList.Count() == 4)
                                    {
                                        WaysMenulist[d].WaySupplementPlant1Value = (float?)lst[0];
                                        WaysMenulist[d].WaySupplementPlant2Value = (float?)lst[1];
                                        WaysMenulist[d].WaySupplementPlant3Value = (float?)lst[2];
                                        WaysMenulist[d].WaySupplementPlant4Value = (float?)lst[3];
                                    }
                                    else if (ColumnsWayList.Count() == 5)
                                    {
                                        WaysMenulist[d].WaySupplementPlant1Value = (float?)lst[0];
                                        WaysMenulist[d].WaySupplementPlant2Value = (float?)lst[1];
                                        WaysMenulist[d].WaySupplementPlant3Value = (float?)lst[2];
                                        WaysMenulist[d].WaySupplementPlant4Value = (float?)lst[3];
                                        WaysMenulist[d].WaySupplementPlant5Value = (float?)lst[4];
                                    }
                                    else
                                    {
                                        WaysMenulist[d].WaySupplementPlant1Value = (float?)lst[0];
                                        WaysMenulist[d].WaySupplementPlant2Value = (float?)lst[1];
                                        WaysMenulist[d].WaySupplementPlant3Value = (float?)lst[2];
                                        WaysMenulist[d].WaySupplementPlant4Value = (float?)lst[3];
                                        WaysMenulist[d].WaySupplementPlant5Value = 0;
                                        if (ColumnsWayList.Count() > 5)
                                        {
                                            for (int q = 4; q < ColumnsWayList.Count(); q++)
                                            {
                                                if (WaysMenulist[d].WaySupplementPlant5Value == null)
                                                    WaysMenulist[d].WaySupplementPlant5Value = 0;
                                                WaysMenulist[d].WaySupplementPlant5Value = WaysMenulist[d].WaySupplementPlant5Value + (float?)lst[q];
                                            }
                                        }


                                    }

                                }
                                #region GEOS2-4046 Gulab Lakade
                                if (WaySandardOperationTime != null)
                                    WaysMenulist[d].WayStandardOperationTime = (float?)Math.Round(Convert.ToDouble(WaysMenulist[d].WayNormalTime * (1 + (Convert.ToDouble(WaySandardOperationTime.Item2) / 100))), 2);

                                WaysMenulist[d].WayOperationTimePlant1Value = (float?)Math.Round(Convert.ToDouble(WaysMenulist[d].WayNormalTime * (1 + (Convert.ToDouble(WaysMenulist[d].WaySupplementPlant1Value) / 100))), 2);
                                WaysMenulist[d].WayOperationTimePlant2Value = (float?)Math.Round(Convert.ToDouble(WaysMenulist[d].WayNormalTime * (1 + (Convert.ToDouble(WaysMenulist[d].WaySupplementPlant2Value) / 100))), 2);
                                WaysMenulist[d].WayOperationTimePlant3Value = (float?)Math.Round(Convert.ToDouble(WaysMenulist[d].WayNormalTime * (1 + (Convert.ToDouble(WaysMenulist[d].WaySupplementPlant3Value) / 100))), 2);
                                WaysMenulist[d].WayOperationTimePlant4Value = (float?)Math.Round(Convert.ToDouble(WaysMenulist[d].WayNormalTime * (1 + (Convert.ToDouble(WaysMenulist[d].WaySupplementPlant4Value) / 100))), 2);
                                WaysMenulist[d].WayOperationTimePlant5Value = (float?)Math.Round(Convert.ToDouble(WaysMenulist[d].WayNormalTime * (1 + (Convert.ToDouble(WaysMenulist[d].WaySupplementPlant5Value) / 100))), 2);
                                #endregion
                                #region GEOS2-3954 Show the WorkOperations and SOD Time in the format: MM:SS or HH:MM:SS
                                try
                                {
                                    WaysMenulist[d].UiTempStandardOperationTimeName = ConvertfloattoTimespan(Convert.ToString(WaysMenulist[d].WayStandardOperationTime));
                                    WaysMenulist[d].UiTempoperationTimePlant1Value = ConvertfloattoTimespan(Convert.ToString(WaysMenulist[d].WayOperationTimePlant1Value));
                                    WaysMenulist[d].UiTempoperationTimePlant2Value = ConvertfloattoTimespan(Convert.ToString(WaysMenulist[d].WayOperationTimePlant2Value));
                                    WaysMenulist[d].UiTempoperationTimePlant3Value = ConvertfloattoTimespan(Convert.ToString(WaysMenulist[d].WayOperationTimePlant3Value));
                                    WaysMenulist[d].UiTempoperationTimePlant4Value = ConvertfloattoTimespan(Convert.ToString(WaysMenulist[d].WayOperationTimePlant4Value));
                                    WaysMenulist[d].UiTempoperationTimePlant5Value = ConvertfloattoTimespan(Convert.ToString(WaysMenulist[d].WayOperationTimePlant5Value));
                                }
                                catch (Exception ex)
                                {
                                    GeosApplication.Instance.Logger.Log(string.Format("Error in Method FillOptionGridColumn() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                }
                                #endregion
                            }
                        }

                }
                GeosApplication.Instance.Logger.Log("Method FillWayGridColumn()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method FillWayGridColumn() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }


        private void GetAllTreeListWay(WorkOperationByStages StandardOperationsDictionaryModules, ObservableCollection<WorkOperationByStages> WorkOperationMenulist)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method GetAllTreeListWay()...", category: Category.Info, priority: Priority.Low);

                if (StandardOperationsDictionaryModules != null && StandardOperationsDictionaryModules.Name.ToLower() != "All".ToLower())
                {

                    if (Convert.ToInt32(StandardOperationsDictionaryModules.IdParent) == Convert.ToInt32(StandardOperationsDictionaryModules.IdStage))
                    {
                        if (!operationWayMenulist.Any(a => a.KeyName.Equals(StandardOperationsDictionaryModules.KeyName)))
                            operationWayMenulist.Add(StandardOperationsDictionaryModules);
                        if (StandardOperationsDictionaryModules.IdParent == null || StandardOperationsDictionaryModules.IdStage == 0)
                        {

                        }
                        else
                        {
                            WorkOperationByStages TempStagesList = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == Convert.ToInt32(StandardOperationsDictionaryModules.IdStage) &&
                            a.KeyName.Equals(("Stage_" + Convert.ToInt32(StandardOperationsDictionaryModules.IdStage)).ToString())).FirstOrDefault();
                            if (duplicateItemloopWay >= 20) { TempStagesList = null; }
                            GetAllTreeListWay(TempStagesList, WorkOperationMenulist);
                        }
                    }
                    else
                    {
                        if (operationWayMenulist.Any(a => a.IdworkOperationByStage == Convert.ToInt64(StandardOperationsDictionaryModules.IdworkOperationByStage)))
                        {
                            duplicateItemloopWay = duplicateItemloopWay + 1;
                            if (duplicateItemloopWay >= 20)
                            {
                                GetAllTreeListWay(null, WorkOperationMenulist);
                            }
                        }
                        else
                        {
                            if (!operationWayMenulist.Any(a => a.KeyName.Equals(StandardOperationsDictionaryModules.KeyName)))
                                operationWayMenulist.Add(StandardOperationsDictionaryModules);
                        }
                        List<WorkOperationByStages> TempList = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == Convert.ToInt32(StandardOperationsDictionaryModules.IdParent)).ToList();
                        if (duplicateItemloopWay >= 20) { TempList = null; }
                        if (TempList != null)
                            foreach (WorkOperationByStages itemWorkOperationByStages in TempList)
                            {
                                GetAllTreeListWay(itemWorkOperationByStages, WorkOperationMenulist);
                            }
                    }

                }
                GeosApplication.Instance.Logger.Log("Method GetAllTreeListWay()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method GetAllTreeListWay()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        private void FillWayGroupsMenulistold()
        {
            try
            {


                WaysGroups = new List<ERMWaysGroups>(ERMService.GetAllWaysGroups_V2301().ToList());

                ObservableCollection<ERMWays> WaysMenulistForGridLayout = new ObservableCollection<ERMWays>(ERMService.GetAllWays_V2301().ToList());


                if (DetectionGroupWithWays == null)
                    DetectionGroupWithWays = new ObservableCollection<DetectionGroupWithWays>();
                if (DetectionGroupWithWays.Count() == 0)
                    foreach (var item in WaysGroups)
                    {
                        DetectionGroupWithWays TempDetectionGroupWithWays = new DetectionGroupWithWays();
                        TempDetectionGroupWithWays.Ways = WaysMenulistForGridLayout.Where(w => w != null && w.IdGroup == item.IdGroup).ToList();
                        #region [28 12 2022]
                        foreach (var item1 in TempDetectionGroupWithWays.Ways)
                        {
                            UInt64 Iddetection = Convert.ToUInt64(item1.IdDetection);
                            int WayTypecount = tempLstStandardOperationsDictionaryWay.Where(x => x.IdDetection == Iddetection).ToList().Count();
                            item1.Name = item1.Name + "(" + WayTypecount + ")";
                        }
                        #endregion
                        TempDetectionGroupWithWays.Name = item.Name + "  (" + TempDetectionGroupWithWays.Ways.Count() + ")";
                        DetectionGroupWithWays.Add(TempDetectionGroupWithWays);
                    }
                SelectedItemWay = DetectionGroupWithWays.First();

            }
            catch (Exception ex)
            {

                GeosApplication.Instance.Logger.Log(string.Format("Error in Method FillWayGroupsMenulist() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }

        }
        private void FillWayGroupsMenulist()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillWayGroupsMenulist()...", category: Category.Info, priority: Priority.Low);

                WaysMenulistForGridLayout = new ObservableCollection<ERMWays>(ERMService.GetAllWays_V2460().ToList());

                if (DetectionGroupWithWays == null)
                    DetectionGroupWithWays = new ObservableCollection<DetectionGroupWithWays>();

                if (DetectionGroupWithWays.Count() == 0)
                {
                    // Sort groups, placing "No group" last
                    WaysMenulistForGridLayout = new ObservableCollection<ERMWays>(
                        WaysMenulistForGridLayout
                            .OrderBy(way => way.Name == "NO GROUP")
                            .ThenBy(way => way.Name, new AlphanumericComparer())
                    );

                    DetectionGroupWithWays TempDetectionGroupWithWays = new DetectionGroupWithWays();
                    TempDetectionGroupWithWays.Ways = WaysMenulistForGridLayout.ToList();

                    #region [28 12 2022]
                    foreach (var item1 in TempDetectionGroupWithWays.Ways)
                    {
                        UInt64 Iddetection = Convert.ToUInt64(item1.IdDetection);
                        int OptionTypecount = tempLstStandardOperationsDictionaryWay
                            .Where(x => x.IdDetection == Iddetection)
                            .ToList()
                            .Count();
                        item1.Name = item1.Name + "  (" + OptionTypecount + ")";
                    }
                    #endregion

                    TempDetectionGroupWithWays.Name = "Ways" + "  (" + TempDetectionGroupWithWays.Ways.Count() + ")";
                    DetectionGroupWithWays.Add(TempDetectionGroupWithWays);
                }

                SelectedItemWay = DetectionGroupWithWays.FirstOrDefault();

                GeosApplication.Instance.Logger.Log("Method FillWayGroupsMenulist()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log($"Error in Method FillWayGroupsMenulist() - {ex.Message}", category: Category.Exception, priority: Priority.Low);
            }
        }




        List<StandardOperationsDictionaryWays> standardOperationsDictionaryWayDeleteList = new List<StandardOperationsDictionaryWays>();
        List<ERMSOPWays> ERMSOPWayDeleteList = new List<ERMSOPWays>();
        List<ERMSOPWays> ERMSOPWayDeleteParentList = new List<ERMSOPWays>();

        private void ERMSOPWayDeleteAction(List<ERMSOPWays> deletelist)
        {
            try
            {
                foreach (ERMSOPWays item in deletelist)
                {
                    if (!ERMSOPWayDeleteList.Any(a => a.KeyName.Equals(item.KeyName)))
                    {
                        ERMSOPWayDeleteList.Add(item);
                        WorkOperationMenulist.Where(w => w.IdworkOperationByStage == item.IdworkOperationByStage).ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                    }

                    List<ERMSOPWays> isitemExist = WaysMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(item.KeyName)).ToList();
                    if (deletelist != null || deletelist.Count() > 0)
                    {
                        ERMSOPWayDeleteAction(isitemExist);
                    }
                }
            }
            catch (Exception ex)
            {
            }
        }
        private void ERMSOPWayDeleteParentAction(List<ERMSOPWays> deleteParentlist)
        {
            try
            {
                foreach (ERMSOPWays item in deleteParentlist)
                {
                    if (!ERMSOPWayDeleteParentList.Any(a => a.KeyName.Equals(item.KeyName)))
                    {
                        ERMSOPWayDeleteParentList.Add(item);
                        WaysMenulist.Remove(item);
                        WorkOperationMenulist.Where(w => w.IdworkOperationByStage == item.IdworkOperationByStage).ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                    }
                    List<ERMSOPWays> isitemExist = WaysMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(item.ParentName)).ToList();
                    if (isitemExist.Count == 0)
                    {
                        List<ERMSOPWays> parentlist = WaysMenulist.Where(w => w.KeyName.Equals(item.ParentName)).ToList();
                        ERMSOPWayDeleteParentAction(parentlist);
                    }

                }
            }
            catch (Exception ex)
            {
            }
        }
        private void DeleteWayTreeListControlCommandAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method DeleteWayTreeListControlCommandAction()...", category: Category.Info, priority: Priority.Low);
                MessageBoxResult MessageBoxResult = CustomMessageBox.Show(String.Format(Application.Current.Resources["WorkOperationsDeleteMessage"].ToString()), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);

                if (MessageBoxResult == MessageBoxResult.Yes)
                {
                    operationMenulist = new ObservableCollection<WorkOperationByStages>();
                    ERMSOPWayDeleteList = new List<ERMSOPWays>();
                    ERMSOPWayDeleteParentList = new List<ERMSOPWays>();
                    IsEnabledSaveButton = true;
                    SaveButtonVisibility = Visibility.Visible;
                    StandardOperationsDictionary tempSelectedStandardOperationsDictionary = new StandardOperationsDictionary();
                    tempSelectedStandardOperationsDictionary.IdStandardOperationsDictionary = tempLstStandardOperationsDictionaryWay.Select(w => w.IdStandardOperationsDictionary).FirstOrDefault();
                    ERMSOPWays MainRow = ((ERMSOPWays)obj);
                    StandardOperationsDictionaryWays standardOperationsDictionaryWay = new StandardOperationsDictionaryWays();
                    if (MainRow != null)
                    {
                        ObservableCollection<ERMSOPWays> WaysMenulistTemp = new ObservableCollection<ERMSOPWays>();
                        WaysMenulistTemp = WaysMenulist;
                        #region GEOS2-4046 Gulab Lakade
                        List<ERMSOPWays> found = new List<ERMSOPWays>();
                        if (!found.Any(a => a != null && a.KeyName.Trim().Equals(MainRow.KeyName.Trim())))
                            found.AddRange(WaysMenulistTemp.Where(s => s.IdworkOperationByStage == MainRow.IdworkOperationByStage).ToList());

                        for (int i = 0; i < found.Count(); i++)
                        {

                            standardOperationsDictionaryWay.IdWorkoperation = Convert.ToUInt32(MainRow.IdworkOperationByStage);
                            if (SelectedItemWay is ERMWays)
                            {
                                ERMWays eRMWays = (ERMWays)SelectedItemWay;
                                standardOperationsDictionaryWay.IdDetection = (UInt64)eRMWays.IdDetection;
                            }
                            standardOperationsDictionaryWay.ObservedTime = (float?)found[i].WayObservedTime;

                            #region [GEOS2-3954] [Rupali Sarode] Time format HH:mm:ss
                            standardOperationsDictionaryWay.UITempWaysObservedTime = ConvertfloattoTimespan(Convert.ToString(MainRow.WayObservedTime));
                            #endregion

                            standardOperationsDictionaryWay.Activity = (float?)found[i].WayActivity;

                            WaysMenulistTemp.Remove(found[i]);
                            WorkOperationMenulist.Where(w => w.IdworkOperationByStage == found[i].IdworkOperationByStage).ToList().ForEach(f => f.IsCurrentWorkOperation = false);

                            standardOperationsDictionaryWayDeleteList.Add(standardOperationsDictionaryWay);
                            List<ERMSOPWays> deletelist = WaysMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(found[i].KeyName)).ToList();
                            if (deletelist != null)
                            {
                                ERMSOPWayDeleteAction(deletelist);
                            }
                            if (ERMSOPWayDeleteList != null)
                                foreach (ERMSOPWays item in ERMSOPWayDeleteList)
                                {
                                    StandardOperationsDictionaryWays standardOperationsDictionary = new StandardOperationsDictionaryWays();
                                    standardOperationsDictionary.IdWorkoperation = Convert.ToUInt32(item.IdworkOperationByStage);
                                    if (SelectedItemWay is ERMWays)
                                    {
                                        ERMWays eRMWays = (ERMWays)SelectedItemWay;
                                        standardOperationsDictionary.IdDetection = (UInt64)eRMWays.IdDetection;
                                    }
                                    standardOperationsDictionary.ObservedTime = (float?)item.WayObservedTime;
                                    #region [GEOS2-3954] [Rupali Sarode] Time format HH:mm:ss
                                    standardOperationsDictionary.UITempWaysObservedTime = ConvertfloattoTimespan(Convert.ToString(item.WayObservedTime));
                                    #endregion

                                    standardOperationsDictionary.Activity = (float?)item.WayActivity;
                                    WaysMenulistTemp.Remove(item);
                                    standardOperationsDictionaryWayDeleteList.Add(standardOperationsDictionary);
                                }

                            List<ERMSOPWays> deleteParentlist = WaysMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(found[i].ParentName)).ToList();
                            if (deleteParentlist.Count == 0)
                            {
                                List<ERMSOPWays> parentlist = WaysMenulistTemp.Where(w => w.KeyName.Equals(MainRow.ParentName)).ToList();
                                ERMSOPWayDeleteParentAction(parentlist);
                            }
                            if (ERMSOPWayDeleteParentList != null)
                                foreach (ERMSOPWays item in ERMSOPWayDeleteParentList)
                                {
                                    StandardOperationsDictionaryWays standardOperationsDictionary = new StandardOperationsDictionaryWays();
                                    standardOperationsDictionary.IdWorkoperation = Convert.ToUInt32(item.IdworkOperationByStage);
                                    if (SelectedItemWay is ERMWays)
                                    {
                                        ERMWays eRMWays = (ERMWays)SelectedItemWay;
                                        standardOperationsDictionary.IdDetection = (UInt64)eRMWays.IdDetection;
                                    }
                                    standardOperationsDictionary.ObservedTime = (float?)item.WayObservedTime;
                                    #region [GEOS2-3954] [Rupali Sarode] Time format HH:mm:ss
                                    standardOperationsDictionary.UITempWaysObservedTime = ConvertfloattoTimespan(Convert.ToString(item.WayObservedTime));
                                    #endregion
                                    standardOperationsDictionary.Activity = (float?)item.WayActivity;
                                    WaysMenulistTemp.Remove(item);
                                    standardOperationsDictionaryWayDeleteList.Add(standardOperationsDictionary);
                                }
                            var tempWayMenulist = WaysMenulistTemp.ToList();
                            foreach (ERMSOPWays itemRemove in tempWayMenulist)
                            {
                                if (GetStages.Any(a => a.Code.Equals(itemRemove.Name)))
                                {
                                    List<ERMSOPWays> childList = WaysMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(itemRemove.KeyName)).ToList();
                                    if (childList.Count == 0)
                                    {
                                        WaysMenulistTemp.Remove(itemRemove);
                                    }
                                }

                            }
                        }
                        #endregion
                        WaysMenulist = new ObservableCollection<ERMSOPWays>();
                        WaysMenulist = WaysMenulistTemp;
                    }
                    CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("WorkOperationDeletedSuccess").ToString()), Application.Current.Resources["PopUpSuccessColor"].ToString(), CustomMessageBox.MessageImagePath.Ok, MessageBoxButton.OK);
                }
                GeosApplication.Instance.Logger.Log("Method DeleteWayTreeListControlCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in DeleteWayTreeListControlCommandAction() Method " + ex.Detail.ErrorMessage, category: Category.Info, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in DeleteWayTreeListControlCommandAction() Method - ServiceUnexceptedException " + ex.Message, category: Category.Info, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method DeleteWayTreeListControlCommandAction()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        private void wayCustomSummarycalculation()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method wayCustomSummarycalculation()...", category: Category.Info, priority: Priority.Low);

                #region calculation
                #region [GEOS2-4830][gulab lakade][07 12 2023]
                //if (WaysMenulist != null)
                //    for (int d = 0; d < WaysMenulist.Count(); d++)
                //    {
                //        WorkOperationMenulist.Where(w => w.KeyName == WaysMenulist[d].KeyName).ToList().ForEach(f => f.IsCurrentWorkOperation = true);
                //        var listCount = WaysMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(WaysMenulist[d].KeyName) && w.IsInactiveWorkOperation == false).ToList();
                //        if (listCount != null)
                //            if (listCount.Count() > 0)
                //            {
                //                WaysMenulist[d].WayObservedTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.WayObservedTime)), 2);
                //                WaysMenulist[d].WayNormalTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.WayNormalTime)), 2);
                //                #region [GEOS2-3954][Rupali Sarode] Time format HH:mm:ss
                //                WaysMenulist[d].UITempWaysObservedTime = ConvertfloattoTimespan(Convert.ToString(Convert.ToDouble(listCount.Sum(s => s.WayObservedTime))));
                //                WaysMenulist[d].UITempWaysNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(Convert.ToDouble(listCount.Sum(s => s.WayNormalTime))));
                //                #endregion

                //                WaysMenulist[d].IsReadOnly = true;
                //            }
                //    }
                #endregion
                if (WaysMenulist != null)
                    for (int d = 0; d < WaysMenulist.Count(); d++)
                    {
                        WorkOperationMenulist.Where(w => w.KeyName == WaysMenulist[d].KeyName).ToList().ForEach(f => f.IsCurrentWorkOperation = true);
                        //[GEOS2-5135][Rupali Sarode][18-12-2023]
                        //var listCount = WaysMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(WaysMenulist[d].KeyName) && w.IsInactiveWorkOperation == false).ToList();
                        var listCount = WaysMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(WaysMenulist[d].KeyName)).ToList();
                        if (listCount != null)
                            if (listCount.Count() > 0)
                            {
                                WaysMenulist[d].WayObservedTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.WayObservedTime)), 2);
                                WaysMenulist[d].WayNormalTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.WayNormalTime)), 2);
                                #region [GEOS2-3954][Rupali Sarode] Time format HH:mm:ss
                                WaysMenulist[d].UITempWaysObservedTime = ConvertfloattoTimespan(Convert.ToString(listCount.Sum(s => s.WayObservedTime)));
                                WaysMenulist[d].UITempWaysNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(listCount.Sum(s => s.WayNormalTime)));
                                #endregion
                                WaysMenulist[d].IsReadOnly = true;
                            }
                    }

                if (WaysMenulist != null)
                    for (int d = 0; d < WaysMenulist.Count(); d++)
                    {
                        if (GetStages.Any(a => a.Code.Equals(WaysMenulist[d].Name)))
                        {
                            ObservableCollection<ERMSOPWays> ActivitySum = new ObservableCollection<ERMSOPWays>();
                            ObservableCollection<ERMSOPWays> TempActivitySum = new ObservableCollection<ERMSOPWays>();
                            int x = 1;
                            Loop:
                            x++;
                            if (x < 10)
                            {
                                if (ActivitySum.Count == 0)
                                {
                                    WaysMenulist[d].WayObservedTime = 0;
                                    WaysMenulist[d].WayNormalTime = 0;
                                    #region [GEOS2-3954][Rupali Sarode] Time format HH:mm:ss
                                    WaysMenulist[d].UITempWaysObservedTime = ConvertfloattoTimespan(Convert.ToString(WaysMenulist[d].WayObservedTime));
                                    WaysMenulist[d].UITempWaysNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(WaysMenulist[d].WayNormalTime));
                                    #endregion
                                    //[GEOS2-5135][Rupali Sarode][18-12-2023]
                                    //  var ActivitySumList = WaysMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(WaysMenulist[d].KeyName) && w.IsInactiveWorkOperation == false).ToList();
                                    var ActivitySumList = WaysMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(WaysMenulist[d].KeyName)).ToList();
                                    ActivitySum.AddRange(ActivitySumList);
                                }
                                else
                                {

                                }


                                goto Loop;
                            }

                            double? ObservedTime = 0;
                            double? NormalTime = 0;
                            float? StandardTime = 0;
                            float? OperationTimePlant1Value = 0;
                            float? OperationTimePlant2Value = 0;
                            float? OperationTimePlant3Value = 0;
                            float? OperationTimePlant4Value = 0;
                            float? OperationTimePlant5Value = 0;
                            var tempDistinctList = ActivitySum.Select(xa => xa.KeyName).Distinct().ToList();
                            foreach (var item in tempDistinctList)
                            {
                                if (WaysMenulist[d].WayObservedTime == null)
                                    WaysMenulist[d].WayObservedTime = 0;
                                double? tempObservedTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.WayObservedTime).FirstOrDefault();
                                if (tempObservedTime != null)
                                {
                                    ObservedTime = Math.Round(Convert.ToDouble(ObservedTime + tempObservedTime), 2);
                                    #region [GEOS2-3954] [Rupali Sarode] Time format HH:mm:ss
                                    WaysMenulist[d].UITempWaysObservedTime = ConvertfloattoTimespan(Convert.ToString(ObservedTime));

                                    #endregion
                                }
                                if (WaysMenulist[d].WayNormalTime == null)
                                    WaysMenulist[d].WayNormalTime = 0;
                                double? tempNormalTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.WayNormalTime).FirstOrDefault();
                                if (tempNormalTime != null)
                                {
                                    NormalTime = Math.Round(Convert.ToDouble(NormalTime + tempNormalTime), 2);
                                    #region [GEOS2-3954] [Rupali Sarode] Time format HH:mm:ss
                                    WaysMenulist[d].UITempWaysNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(NormalTime));
                                    #endregion

                                }
                            }
                            WaysMenulist[d].WayObservedTime = ObservedTime;
                            WaysMenulist[d].WayNormalTime = NormalTime;
                            #region [GEOS2-3954] [Rupali Sarode] Time format HH:mm:ss
                            WaysMenulist[d].UITempWaysObservedTime = ConvertfloattoTimespan(Convert.ToString(ObservedTime));
                            WaysMenulist[d].UITempWaysNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(WaysMenulist[d].WayNormalTime));
                            #endregion


                            #region PlantValue


                            foreach (var item in tempDistinctList)
                            {
                                if (WaysMenulist[d].WayStandardOperationTime == null)
                                    WaysMenulist[d].WayStandardOperationTime = 0;
                                float? tempStandardTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.WayStandardOperationTime).FirstOrDefault();
                                if (tempStandardTime != null)
                                    StandardTime = StandardTime + tempStandardTime;

                                if (WaysMenulist[d].WayOperationTimePlant1Value == null)
                                    WaysMenulist[d].WayOperationTimePlant1Value = 0;
                                float? tempOperationTimePlant1Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.WayOperationTimePlant1Value).FirstOrDefault();
                                if (tempOperationTimePlant1Value != null)
                                    OperationTimePlant1Value = OperationTimePlant1Value + tempOperationTimePlant1Value;

                                if (WaysMenulist[d].WayOperationTimePlant2Value == null)
                                    WaysMenulist[d].WayOperationTimePlant2Value = 0;
                                float? tempOperationTimePlant2Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.WayOperationTimePlant2Value).FirstOrDefault();
                                if (tempOperationTimePlant2Value != null)
                                    OperationTimePlant2Value = OperationTimePlant2Value + tempOperationTimePlant2Value;

                                if (WaysMenulist[d].WayOperationTimePlant3Value == null)
                                    WaysMenulist[d].WayOperationTimePlant3Value = 0;
                                float? tempOperationTimePlant3Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.WayOperationTimePlant3Value).FirstOrDefault();
                                if (tempOperationTimePlant3Value != null)
                                    OperationTimePlant3Value = OperationTimePlant3Value + tempOperationTimePlant3Value;

                                if (WaysMenulist[d].WayOperationTimePlant4Value == null)
                                    WaysMenulist[d].WayOperationTimePlant4Value = 0;
                                float? tempOperationTimePlant4Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.WayOperationTimePlant4Value).FirstOrDefault();
                                if (tempOperationTimePlant4Value != null)
                                    OperationTimePlant4Value = OperationTimePlant4Value + tempOperationTimePlant4Value;

                                if (WaysMenulist[d].WayOperationTimePlant5Value == null)
                                    WaysMenulist[d].WayOperationTimePlant5Value = 0;
                                float? tempOperationTimePlant5Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.WayOperationTimePlant5Value).FirstOrDefault();
                                if (tempOperationTimePlant5Value != null)
                                    OperationTimePlant5Value = OperationTimePlant5Value + tempOperationTimePlant5Value;
                            }
                            #endregion
                            WaysMenulist[d].WayStandardOperationTime = (float?)Math.Round(Convert.ToDouble(StandardTime), 2);
                            WaysMenulist[d].WayOperationTimePlant1Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant1Value), 2);
                            WaysMenulist[d].WayOperationTimePlant2Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant2Value), 2);
                            WaysMenulist[d].WayOperationTimePlant3Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant3Value), 2);
                            WaysMenulist[d].WayOperationTimePlant4Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant4Value), 2);
                            WaysMenulist[d].WayOperationTimePlant5Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant5Value), 2);
                            #region GEOS2-3954 Show the WorkOperations and SOD Time in the format: MM:SS or HH:MM:SS
                            try
                            {
                                WaysMenulist[d].UiTempStandardOperationTimeName = ConvertfloattoTimespan(Convert.ToString(WaysMenulist[d].WayStandardOperationTime));
                                WaysMenulist[d].UiTempoperationTimePlant1Value = ConvertfloattoTimespan(Convert.ToString(WaysMenulist[d].WayOperationTimePlant1Value));
                                WaysMenulist[d].UiTempoperationTimePlant2Value = ConvertfloattoTimespan(Convert.ToString(WaysMenulist[d].WayOperationTimePlant2Value));
                                WaysMenulist[d].UiTempoperationTimePlant3Value = ConvertfloattoTimespan(Convert.ToString(WaysMenulist[d].WayOperationTimePlant3Value));
                                WaysMenulist[d].UiTempoperationTimePlant4Value = ConvertfloattoTimespan(Convert.ToString(WaysMenulist[d].WayOperationTimePlant4Value));
                                WaysMenulist[d].UiTempoperationTimePlant5Value = ConvertfloattoTimespan(Convert.ToString(WaysMenulist[d].WayOperationTimePlant5Value));
                            }
                            catch (Exception ex)
                            {
                                GeosApplication.Instance.Logger.Log(string.Format("Error in Method WayCustomSummarycalculation() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            }
                            #endregion
                        }
                    }
                #endregion              

                GeosApplication.Instance.Logger.Log("Method wayCustomSummarycalculation()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log(string.Format("Error in method wayCustomSummarycalculation() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

            }

        }

        private void WayGridParentMenuTreeList_CellValueChangedCommandAction(object sender)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method WayGridParentMenuTreeList_CellValueChangedCommandAction()...", category: Category.Info, priority: Priority.Low);

                if (sender is DevExpress.Xpf.Grid.TreeList.TreeListCellValueChangedEventArgs)
                {
                    if (sender != null)
                    {
                        FlagToDragDrop = true;  //[GEOS2-3923][Rupali Sarode][26-11-2022]
                        IsEnabledSaveButton = true;
                        SaveButtonVisibility = Visibility.Visible;
                        TreeListCellValueChangedEventArgs obj = (TreeListCellValueChangedEventArgs)sender;
                        if (!obj.Cell.Property.Equals("Remarks"))  //[GEOS2-4108][Rupali Sarode][6-1-2023]
                        {
                            if (obj.Value != null)
                            {
                                #region [GEOS2-3954][Rupali Sarode]

                                //double? NewValue = 0;
                                //float? tempnewvalue = ConvertTimespantoFloat(TimeSpan.FromMinutes(Convert.ToDouble(obj.Value)));

                                //if (Convert.ToString(obj.Value).Contains(":"))
                                //    NewValue = Math.Round(Convert.ToDouble(string.IsNullOrEmpty(tempnewvalue.ToString()) ? 0 : tempnewvalue), 2);
                                //else
                                //    NewValue = Math.Round(Convert.ToDouble(string.IsNullOrEmpty(obj.Value.ToString()) ? 0 : obj.Value), 2);
                                double? NewValue;
                                if (obj.Cell.Property.Equals("UITempWaysObservedTime"))
                                {
                                    //tempnewvalue = ConvertTimespantoFloat(TimeSpan.FromMinutes(Convert.ToDouble(obj.Value)));
                                    NewValue = Math.Round(Convert.ToDouble(TimeSpan.Parse(Convert.ToString(obj.Value)).TotalMinutes), 2); // ConvertTimespantoFloat(TimeSpan.Parse(obj.Value));
                                }
                                else
                                {
                                    NewValue = Math.Round(Convert.ToDouble(Convert.ToString(obj.Value)), 2);
                                }
                                #endregion
                                if (NewValue != null)
                                    if (obj.Cell.Property.Equals("ObservedTime"))
                                    {
                                        WaysMenulist.Where(w => w.IdworkOperationByStage == SelectedWaysMenuItem.IdworkOperationByStage).ToList().ForEach(f => f.WayObservedTime = NewValue);
                                    }
                                    else if (obj.Cell.Property.Equals("Activity"))
                                    {
                                        WaysMenulist.Where(w => w.IdworkOperationByStage == SelectedWaysMenuItem.IdworkOperationByStage).ToList().ForEach(f => f.WayActivity = NewValue);
                                    }
                                    #region [GEOS2-3954][Rupali Sarode]
                                    else if (obj.Cell.Property.Equals("UITempWaysObservedTime"))
                                    {
                                        try
                                        {
                                            WaysMenulist.Where(w => w.IdworkOperationByStage == SelectedWaysMenuItem.IdworkOperationByStage).ToList().ForEach(f => f.WayObservedTime = NewValue);
                                            WaysMenulist.Where(w => w.IdworkOperationByStage == SelectedWaysMenuItem.IdworkOperationByStage).ToList().ForEach(f => f.UITempWaysObservedTime = ConvertfloattoTimespan(Convert.ToString(NewValue)));
                                        }
                                        catch (Exception ex) { }

                                    }
                                #endregion

                            }
                        }

                        if (!obj.Cell.Property.Equals("Remarks"))  //[GEOS2-4108][Rupali Sarode][6-1-2023]
                            wayCustomSummarycalculation();
                    }
                }
                GeosApplication.Instance.Logger.Log("Method WayGridParentMenuTreeList_CellValueChangedCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log(string.Format("Error in method WayGridParentMenuTreeList_CellValueChangedCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }


        private void WayGridParentMenuTreeList_CellValueChangingCommandAction(object sender)
        {

        }

        private void WayCustomSummaryCommandAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method WayCustomSummaryCommandAction()...", category: Category.Info, priority: Priority.Low);

                TreeListCustomSummaryEventArgs e = (TreeListCustomSummaryEventArgs)obj;
                if (e.SummaryItem.FieldName == "WayObservedTime")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPWays temp = (ERMSOPWays)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                if (e.TotalValue != null)
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                            }

                        }

                    }
                }

                if (e.SummaryItem.FieldName == "UITempWaysObservedTime")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPWays temp = (ERMSOPWays)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                //e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                //if (e.TotalValue != null)
                                //    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);

                                #region Time changes 28 11 2022
                                TimeSpan temp3 = TimeSpan.Parse(e.FieldValue.ToString());
                                double TempFieldValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.FieldValue)))
                                {
                                    TempFieldValue = 0;
                                }
                                else
                                {
                                    TempFieldValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.FieldValue)).TotalMinutes);
                                }

                                double TempTotalValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.TotalValue)))
                                {
                                    TempTotalValue = 0;
                                }
                                else
                                {
                                    TempTotalValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.TotalValue)).TotalMinutes);
                                }

                                e.TotalValue = TempTotalValue + TempFieldValue;
                                if (e.TotalValue != null)
                                {
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    e.TotalValue = ConvertfloattoTimespan(Convert.ToString(e.TotalValue));

                                    #endregion

                                }
                                #endregion

                            }

                        }

                    }
                }

                if (e.SummaryItem.FieldName == "UITempWaysNormalTime")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPWays temp = (ERMSOPWays)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                //e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                //if (e.TotalValue != null)
                                //    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);

                                #region Time changes 28 11 2022
                                TimeSpan temp3 = TimeSpan.Parse(e.FieldValue.ToString());
                                double TempFieldValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.FieldValue)))
                                {
                                    TempFieldValue = 0;
                                }
                                else
                                {
                                    TempFieldValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.FieldValue)).TotalMinutes);
                                }

                                double TempTotalValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.TotalValue)))
                                {
                                    TempTotalValue = 0;
                                }
                                else
                                {
                                    TempTotalValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.TotalValue)).TotalMinutes);
                                }

                                e.TotalValue = TempTotalValue + TempFieldValue;
                                if (e.TotalValue != null)
                                {
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    e.TotalValue = ConvertfloattoTimespan(Convert.ToString(e.TotalValue));

                                    #endregion

                                }
                                #endregion
                            }

                        }

                    }
                }

                if (e.SummaryItem.FieldName == "WayNormalTime")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPWays temp = (ERMSOPWays)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                if (e.TotalValue != null)
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                            }

                        }

                    }
                }

                if (e.SummaryItem.FieldName == "WayStandardOperationTime")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPWays temp = (ERMSOPWays)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                if (e.TotalValue != null)
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                            }

                        }

                    }
                }
                if (e.SummaryItem.FieldName == "WayOperationTimePlant1Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPWays temp = (ERMSOPWays)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                if (e.TotalValue != null)
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                            }

                        }

                    }
                }


                if (e.SummaryItem.FieldName == "WayOperationTimePlant2Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPWays temp = (ERMSOPWays)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {

                                e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                if (e.TotalValue != null)
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                            }

                        }

                    }
                }


                if (e.SummaryItem.FieldName == "WayOperationTimePlant3Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPWays temp = (ERMSOPWays)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {

                                e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                if (e.TotalValue != null)
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                            }

                        }

                    }
                }

                if (e.SummaryItem.FieldName == "WayOperationTimePlant4Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPWays temp = (ERMSOPWays)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {

                                e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                if (e.TotalValue != null)
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                            }

                        }

                    }
                }

                if (e.SummaryItem.FieldName == "WayOperationTimePlant5Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPWays temp = (ERMSOPWays)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {

                                e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                if (e.TotalValue != null)
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                            }

                        }

                    }
                }

                #region GEOS2-3954 Show the WorkOperations and SOD Time in the format: MM:SS or HH:MM:SS
                if (e.SummaryItem.FieldName == "UiTempStandardOperationTimeName")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {

                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPWays temp = (ERMSOPWays)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                #region Time changes 28 11 2022
                                TimeSpan temp3 = TimeSpan.Parse(e.FieldValue.ToString());
                                double TempFieldValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.FieldValue)))
                                {
                                    TempFieldValue = 0;
                                }
                                else
                                {
                                    TempFieldValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.FieldValue)).TotalMinutes);
                                }

                                double TempTotalValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.TotalValue)))
                                {
                                    TempTotalValue = 0;
                                }
                                else
                                {
                                    TempTotalValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.TotalValue)).TotalMinutes);
                                }

                                e.TotalValue = TempTotalValue + TempFieldValue;
                                if (e.TotalValue != null)
                                {
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    e.TotalValue = ConvertfloattoTimespan(Convert.ToString(e.TotalValue));

                                    #endregion

                                }
                                #endregion
                            }
                        }

                    }
                }


                if (e.SummaryItem.FieldName == "UiTempoperationTimePlant1Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPWays temp = (ERMSOPWays)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                #region Time changes 28 11 2022
                                TimeSpan temp3 = TimeSpan.Parse(e.FieldValue.ToString());
                                double TempFieldValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.FieldValue)))
                                {
                                    TempFieldValue = 0;
                                }
                                else
                                {
                                    TempFieldValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.FieldValue)).TotalMinutes);
                                }

                                double TempTotalValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.TotalValue)))
                                {
                                    TempTotalValue = 0;
                                }
                                else
                                {
                                    TempTotalValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.TotalValue)).TotalMinutes);
                                }

                                e.TotalValue = TempTotalValue + TempFieldValue;
                                if (e.TotalValue != null)
                                {
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    e.TotalValue = ConvertfloattoTimespan(Convert.ToString(e.TotalValue));

                                    #endregion

                                }
                                #endregion
                            }

                        }
                    }
                }
                if (e.SummaryItem.FieldName == "UiTempoperationTimePlant2Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPWays temp = (ERMSOPWays)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                #region Time changes 28 11 2022
                                TimeSpan temp3 = TimeSpan.Parse(e.FieldValue.ToString());
                                double TempFieldValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.FieldValue)))
                                {
                                    TempFieldValue = 0;
                                }
                                else
                                {
                                    TempFieldValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.FieldValue)).TotalMinutes);
                                }

                                double TempTotalValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.TotalValue)))
                                {
                                    TempTotalValue = 0;
                                }
                                else
                                {
                                    TempTotalValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.TotalValue)).TotalMinutes);
                                }

                                e.TotalValue = TempTotalValue + TempFieldValue;
                                if (e.TotalValue != null)
                                {
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    e.TotalValue = ConvertfloattoTimespan(Convert.ToString(e.TotalValue));

                                    #endregion

                                }
                                #endregion
                            }

                        }

                    }
                }
                if (e.SummaryItem.FieldName == "UiTempoperationTimePlant3Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPWays temp = (ERMSOPWays)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                #region Time changes 28 11 2022
                                TimeSpan temp3 = TimeSpan.Parse(e.FieldValue.ToString());
                                double TempFieldValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.FieldValue)))
                                {
                                    TempFieldValue = 0;
                                }
                                else
                                {
                                    TempFieldValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.FieldValue)).TotalMinutes);
                                }

                                double TempTotalValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.TotalValue)))
                                {
                                    TempTotalValue = 0;
                                }
                                else
                                {
                                    TempTotalValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.TotalValue)).TotalMinutes);
                                }

                                e.TotalValue = TempTotalValue + TempFieldValue;
                                if (e.TotalValue != null)
                                {
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    e.TotalValue = ConvertfloattoTimespan(Convert.ToString(e.TotalValue));

                                    #endregion

                                }
                                #endregion
                            }

                        }

                    }
                }
                if (e.SummaryItem.FieldName == "UiTempoperationTimePlant4Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPWays temp = (ERMSOPWays)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                #region Time changes 28 11 2022
                                TimeSpan temp3 = TimeSpan.Parse(e.FieldValue.ToString());
                                double TempFieldValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.FieldValue)))
                                {
                                    TempFieldValue = 0;
                                }
                                else
                                {
                                    TempFieldValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.FieldValue)).TotalMinutes);
                                }

                                double TempTotalValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.TotalValue)))
                                {
                                    TempTotalValue = 0;
                                }
                                else
                                {
                                    TempTotalValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.TotalValue)).TotalMinutes);
                                }

                                e.TotalValue = TempTotalValue + TempFieldValue;
                                if (e.TotalValue != null)
                                {
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    e.TotalValue = ConvertfloattoTimespan(Convert.ToString(e.TotalValue));

                                    #endregion

                                }
                                #endregion
                            }

                        }
                    }
                }
                if (e.SummaryItem.FieldName == "UiTempoperationTimePlant5Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPWays temp = (ERMSOPWays)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                #region Time changes 28 11 2022
                                TimeSpan temp3 = TimeSpan.Parse(e.FieldValue.ToString());
                                double TempFieldValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.FieldValue)))
                                {
                                    TempFieldValue = 0;
                                }
                                else
                                {
                                    TempFieldValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.FieldValue)).TotalMinutes);
                                }

                                double TempTotalValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.TotalValue)))
                                {
                                    TempTotalValue = 0;
                                }
                                else
                                {
                                    TempTotalValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.TotalValue)).TotalMinutes);
                                }

                                e.TotalValue = TempTotalValue + TempFieldValue;
                                if (e.TotalValue != null)
                                {
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    e.TotalValue = ConvertfloattoTimespan(Convert.ToString(e.TotalValue));

                                    #endregion

                                }
                                #endregion
                            }

                        }
                    }
                }
                #endregion

                GeosApplication.Instance.Logger.Log("Method WayCustomSummaryCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {

                GeosApplication.Instance.Logger.Log(string.Format("Error in method WayCustomSummaryCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

            }
        }

        private void WayTreeListViewLoadedCommandAction(RoutedEventArgs obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method WayTreeListViewLoadedCommandAction ...", category: Category.Info, priority: Priority.Low);

                DetectiontreeListControlInstance = (TreeListControl)((DevExpress.Xpf.Grid.TreeListView)obj.OriginalSource).DataControl;

                GeosApplication.Instance.Logger.Log("Method WayTreeListViewLoadedCommandAction() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in WayTreeListViewLoadedCommandAction() Method " + ex.Message, category: Category.Info, priority: Priority.Low);
            }
        }
        #endregion

        #region GEOS2-3666
        private void OnDragRecordOverSparepartsGrid(DragRecordOverEventArgs e)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method OnDragRecordOverSparepartsGrid()...", category: Category.Info, priority: Priority.Low);
                #region Rajashri
                //Rajshri [Geos2-5629]
                Int64 targetParentid = 0;
                Int64 idparentValue = 0;
                int TempCount = 0;//[GEOS2-5629][gulab lakade][16 07 2024]
                DevExpress.Xpf.Grid.TreeListView TempWayTree = (DevExpress.Xpf.Grid.TreeListView)e.Source;
                DevExpress.Xpf.Grid.TreeListControl TempNode = (DevExpress.Xpf.Grid.TreeListControl)TempWayTree.Parent;

                var currentItem = TempNode.CurrentItem as Emdep.Geos.Data.Common.ERM.ERMSOPSpareParts;
                if (currentItem != null)
                {
                    idparentValue = Convert.ToInt64(currentItem.IdParent);
                    TempCount = SparePartsMenulist.Where(x => x.ParentName == currentItem.KeyName).ToList().Count();//[GEOS2-5629][gulab lakade][16 07 2024]
                }
                var targetrecord = e.TargetRecord as Emdep.Geos.Data.Common.ERM.ERMSOPSpareParts;
                if (targetrecord != null)
                {
                    targetParentid = Convert.ToInt64(targetrecord.IdParent);
                }
                #endregion
                if ((e.IsFromOutside) && typeof(WorkOperationByStages).IsAssignableFrom(e.GetRecordType()))
                {
                    e.Effects = DragDropEffects.Copy;
                    e.Handled = true;
                }
                #region Aishwarya
                else if ((e.IsFromOutside) && typeof(ERMSOPSpareParts).IsAssignableFrom(e.GetRecordType()))
                {
                    e.Effects = DragDropEffects.Copy;
                    e.Handled = true;
                    IsEnabled = true;
                }
                else if ((e.IsFromOutside) && typeof(ERMSOPSpareParts).IsAssignableFrom(e.GetRecordType()) && e.TargetRecord == null)
                {
                    e.Effects = DragDropEffects.Copy;
                    e.Handled = true;
                }
                else if (e.DropPosition == DropPosition.Inside && typeof(ERMSOPSpareParts).IsAssignableFrom(e.GetRecordType()))
                {
                    e.Effects = DragDropEffects.None;
                    e.Handled = false;
                }
                else if (typeof(ERMSOPSpareParts).IsAssignableFrom(e.GetRecordType()) && (e.DropPosition == DropPosition.Before || e.DropPosition == DropPosition.After))
                {


                    #region Rajashri
                    if (idparentValue == targetParentid)
                    {
                        // start [GEOS2-5629][gulab lakade][16 07 2024]
                        if (TempCount == 0)
                        {
                            e.Effects = DragDropEffects.Move;
                            e.Handled = true;
                            IsModulesequence = true;
                        }
                        else
                        {
                            e.Effects = DragDropEffects.None;
                            e.Handled = false;
                        }
                        //end [GEOS2-5629][gulab lakade][16 07 2024]
                    }
                    else
                    {
                        e.Effects = DragDropEffects.None;
                        e.Handled = false;
                    }
                    #endregion
                }
                #endregion
                GeosApplication.Instance.Logger.Log("Method OnDragRecordOverSparepartsGrid()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method OnDragRecordOverModuleGrid()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }

        }
        private void DropRecordSparepartsGrid(DropRecordEventArgs e)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method DropRecordSparepartsGrid()...", category: Category.Info, priority: Priority.Low);

                if ((e.IsFromOutside) && e.TargetRecord != null && typeof(WorkOperationByStages).IsAssignableFrom(e.GetRecordType()))
                {
                    e.Effects = DragDropEffects.Copy;
                    CompleteDropRecorSparePartGrid(e);  //GEOS2-4033 Spare Part Gulab Lakade
                    e.Handled = true;
                }
                else if ((e.IsFromOutside) && typeof(WorkOperationByStages).IsAssignableFrom(e.GetRecordType()) && e.TargetRecord == null)
                {
                    e.Effects = DragDropEffects.Copy;
                    CompleteDropRecorSparePartGrid(e);  //GEOS2-4033 Spare Part Gulab Lakade
                    e.Handled = true;
                }
                else if (e.DropPosition == DropPosition.Inside && typeof(WorkOperationByStages).IsAssignableFrom(e.GetRecordType()))
                {
                    e.Effects = DragDropEffects.None;
                    e.Handled = false;
                }
                else if (typeof(WorkOperationByStages).IsAssignableFrom(e.GetRecordType()) && (e.DropPosition == DropPosition.Before || e.DropPosition == DropPosition.After))
                {
                    e.Effects = DragDropEffects.Move;
                    e.Handled = false;
                }
                else if (typeof(ERMSOPSpareParts).IsAssignableFrom(e.GetRecordType()) && (e.DropPosition == DropPosition.Before || e.DropPosition == DropPosition.After))
                {
                    var tragetPosition_var = e.TargetRecord.GetType().GetProperty("SparepartPosition").GetValue(e.TargetRecord);
                    DevExpress.Xpf.Grid.TreeListView originsource = (DevExpress.Xpf.Grid.TreeListView)e.OriginalSource;
                    var SPosition_var = (originsource.FocusedRow.GetType().GetProperty("SparepartPosition").GetValue(originsource.FocusedRow));
                    UInt32 SPosition = Convert.ToUInt32(SPosition_var);
                    UInt32 tragetPosition = Convert.ToUInt32(tragetPosition_var);
                    var TempTargetKeyName = e.TargetRecord.GetType().GetProperty("KeyName").GetValue(e.TargetRecord);//[GEOS2-5629][gulab lakade][16 07 2024]
                    var TempChangeKeyName = (originsource.FocusedRow.GetType().GetProperty("KeyName").GetValue(originsource.FocusedRow));//[GEOS2-5629][gulab lakade][16 07 2024]
                    string TargetKeyName = Convert.ToString(TempTargetKeyName);//[GEOS2-5629][gulab lakade][16 07 2024]
                    string ChangeKeyName = Convert.ToString(TempChangeKeyName);//[GEOS2-5629][gulab lakade][16 07 2024]
                    if (e.DropPosition == DropPosition.Before)
                    {

                        var TempChangesrecord = SparePartsMenulist.Where(x => x.SparepartPosition == SPosition && x.KeyName == ChangeKeyName).FirstOrDefault();

                        var TempBeforerecord = SparePartsMenulist.Where(x => x.SparepartPosition == tragetPosition && x.KeyName == TargetKeyName).FirstOrDefault();
                        if (tragetPosition < SPosition)
                        {
                            UInt32 pos = Convert.ToUInt32(tragetPosition);
                            foreach (var update in SparePartsMenulist.Where(x => x.SparepartPosition >= tragetPosition).OrderBy(a => a.SparepartPosition).ToList())
                            {
                                //start[GEOS2-5629][gulab lakade][16 07 2024]
                                int TempCount = 0;
                                TempCount = SparePartsMenulist.Where(x => x.ParentName == update.KeyName).ToList().Count();//[GEOS2-5629][gulab lakade][16 07 2024]
                                if (TempCount == 0)
                                {
                                    if (update.IdworkOperationByStage == TempChangesrecord.IdworkOperationByStage)
                                    {
                                        update.SparepartPosition = Convert.ToUInt32(tragetPosition);
                                        // break;
                                    }
                                    else
                                    {
                                        if (Convert.ToUInt32(tragetPosition) == Convert.ToUInt32(pos))
                                        {
                                            pos++;
                                        }
                                        update.SparepartPosition = pos;
                                        pos++;
                                    }

                                }
                                //end[GEOS2-5629][gulab lakade][16 07 2024]
                            }
                        }
                        else
                        {
                            UInt32 pos = Convert.ToUInt32(SPosition);

                            foreach (var update in SparePartsMenulist.Where(x => x.SparepartPosition >= SPosition).OrderBy(a => a.SparepartPosition).ToList())
                            {

                                //start[GEOS2-5629][gulab lakade][16 07 2024]
                                int TempCount = 0;
                                TempCount = SparePartsMenulist.Where(x => x.ParentName == update.KeyName).ToList().Count();//[GEOS2-5629][gulab lakade][16 07 2024]
                                if (TempCount == 0)
                                {
                                    if (update.IdworkOperationByStage == TempChangesrecord.IdworkOperationByStage)
                                    {
                                        update.SparepartPosition = Convert.ToUInt32(tragetPosition - 1);
                                        // break;
                                    }
                                    else
                                    {
                                        if (pos == 0)
                                        {
                                            pos = 1;
                                        }
                                        if (pos == Convert.ToUInt32(tragetPosition - 1))
                                        {
                                            pos++;
                                        }
                                        update.SparepartPosition = pos;
                                        pos++;
                                    }
                                }
                                //end[GEOS2-5629][gulab lakade][16 07 2024]

                            }
                        }



                    }
                    else if (e.DropPosition == DropPosition.After)
                    {
                        var TempChangesrecord = SparePartsMenulist.Where(x => x.SparepartPosition == SPosition && x.KeyName == ChangeKeyName).FirstOrDefault();

                        var TempBeforerecord = SparePartsMenulist.Where(x => x.SparepartPosition == tragetPosition && x.KeyName == TargetKeyName).FirstOrDefault();
                        if (tragetPosition < SPosition)
                        {
                            UInt32 pos = Convert.ToUInt32(tragetPosition);
                            foreach (var update in SparePartsMenulist.Where(x => x.SparepartPosition >= tragetPosition).OrderBy(a => a.SparepartPosition).ToList())
                            {

                                //start[GEOS2-5629][gulab lakade][16 07 2024]
                                int TempCount = 0;
                                TempCount = SparePartsMenulist.Where(x => x.ParentName == update.KeyName).ToList().Count();//[GEOS2-5629][gulab lakade][16 07 2024]
                                if (TempCount == 0)
                                {
                                    if (update.IdworkOperationByStage == TempChangesrecord.IdworkOperationByStage)
                                    {
                                        update.SparepartPosition = Convert.ToUInt32(tragetPosition);
                                        //break;
                                    }
                                    else
                                    {
                                        if (Convert.ToUInt32(tragetPosition) == Convert.ToUInt32(pos))
                                        {
                                            pos++;
                                        }
                                        update.SparepartPosition = pos;
                                        pos++;
                                    }
                                }
                                //end[GEOS2-5629][gulab lakade][16 07 2024]
                            }
                        }
                        else
                        {

                            UInt32 pos = Convert.ToUInt32(SPosition);
                            foreach (var update in SparePartsMenulist.Where(x => x.SparepartPosition >= SPosition).OrderBy(a => a.SparepartPosition).ToList())
                            {
                                //start[GEOS2-5629][gulab lakade][16 07 2024]
                                int TempCount = 0;
                                TempCount = SparePartsMenulist.Where(x => x.ParentName == update.KeyName).ToList().Count();//[GEOS2-5629][gulab lakade][16 07 2024]
                                if (TempCount == 0)
                                {
                                    if (update.IdworkOperationByStage == TempChangesrecord.IdworkOperationByStage)
                                    {
                                        update.SparepartPosition = Convert.ToUInt32(tragetPosition);
                                        //break;
                                    }
                                    else
                                    {
                                        if (pos == 0)
                                        {
                                            pos = 1;
                                        }
                                        if (pos == Convert.ToUInt32(tragetPosition))
                                        {
                                            pos++;
                                        }
                                        update.SparepartPosition = pos;
                                        pos++;
                                    }
                                }
                                //end[GEOS2-5629][gulab lakade][16 07 2024]
                            }
                        }
                    }

                    var TmpSparepart = SparePartsMenulist.OrderBy(a => a.SparepartPosition).ToList();
                    SparePartsMenulist = new ObservableCollection<ERMSOPSpareParts>(TmpSparepart);
                    e.Effects = DragDropEffects.Move;
                    e.Handled = true;
                    IsModulesequence = true;
                }
                //GEOS2 - 4033 Spare Part Gulab Lakade
                //CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("SODDropRecordMessage").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                GeosApplication.Instance.Logger.Log("Method DropRecordSparepartsGrid()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method OnDragRecordOverModuleGrid()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }

        }
        private void CompleteRecordDragDropSparepartsGrid(CompleteRecordDragDropEventArgs e)
        {
            e.Handled = true;
            IsModulesequence = false;
            IsEnabledSaveButton = true;
            // e.Handled = true;
            //FillmoduleGridColumn();
            int wocount = WorkOperationMenulist.ToList().Count();
        }
        #endregion

        #region GEOS2-3662
        private void OnDragRecordOverStructuresGrid(DragRecordOverEventArgs e)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method OnDragRecordOverStructuresGrid()...", category: Category.Info, priority: Priority.Low);
                #region Rajashri
                //Rajshri [Geos2-5629]
                Int64 targetParentid = 0;
                Int64 idparentValue = 0;
                int TempCount = 0;//[GEOS2-5629][gulab lakade][16 07 2024]
                DevExpress.Xpf.Grid.TreeListView TempWayTree = (DevExpress.Xpf.Grid.TreeListView)e.Source;
                DevExpress.Xpf.Grid.TreeListControl TempNode = (DevExpress.Xpf.Grid.TreeListControl)TempWayTree.Parent;

                var currentItem = TempNode.CurrentItem as Emdep.Geos.Data.Common.ERM.ERMSOPStructures;
                if (currentItem != null)
                {
                    idparentValue = Convert.ToInt64(currentItem.IdParent);
                    TempCount = StructureMenulist.Where(x => x.ParentName == currentItem.KeyName).ToList().Count();//[GEOS2-5629][gulab lakade][16 07 2024]
                }
                var targetrecord = e.TargetRecord as Emdep.Geos.Data.Common.ERM.ERMSOPStructures;
                if (targetrecord != null)
                {
                    targetParentid = Convert.ToInt64(targetrecord.IdParent);
                }
                #endregion
                if ((e.IsFromOutside) && typeof(WorkOperationByStages).IsAssignableFrom(e.GetRecordType()))
                {
                    e.Effects = DragDropEffects.Copy;
                    e.Handled = true;
                }
                #region Aishwarya
                else if ((e.IsFromOutside) && typeof(ERMSOPStructures).IsAssignableFrom(e.GetRecordType()))
                {
                    e.Effects = DragDropEffects.Copy;
                    e.Handled = true;
                    IsEnabled = true;
                }
                else if ((e.IsFromOutside) && typeof(ERMSOPStructures).IsAssignableFrom(e.GetRecordType()) && e.TargetRecord == null)
                {
                    e.Effects = DragDropEffects.Copy;
                    e.Handled = true;
                }
                else if (e.DropPosition == DropPosition.Inside && typeof(ERMSOPStructures).IsAssignableFrom(e.GetRecordType()))
                {
                    e.Effects = DragDropEffects.None;
                    e.Handled = false;
                }
                else if (typeof(ERMSOPStructures).IsAssignableFrom(e.GetRecordType()) && (e.DropPosition == DropPosition.Before || e.DropPosition == DropPosition.After))
                {


                    #region Rajashri
                    if (idparentValue == targetParentid)
                    {
                        // start [GEOS2-5629][gulab lakade][16 07 2024]
                        if (TempCount == 0)
                        {
                            e.Effects = DragDropEffects.Move;
                            e.Handled = true;
                            IsModulesequence = true;
                        }
                        else
                        {
                            e.Effects = DragDropEffects.None;
                            e.Handled = false;
                        }
                        //end [GEOS2-5629][gulab lakade][16 07 2024]
                    }
                    else
                    {
                        e.Effects = DragDropEffects.None;
                        e.Handled = false;
                    }
                    #endregion
                }
                #endregion
                else
                {
                    e.Effects = DragDropEffects.None;
                    e.Handled = false;
                }
                GeosApplication.Instance.Logger.Log("Method OnDragRecordOverStructuresGrid()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method OnDragRecordOverStructuresGrid()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }

        }
        private void DropRecordStructuresGrid(DropRecordEventArgs e)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method DropRecordStructuresGrid()...", category: Category.Info, priority: Priority.Low);

                if ((e.IsFromOutside) && e.TargetRecord != null && typeof(WorkOperationByStages).IsAssignableFrom(e.GetRecordType()))
                {
                    e.Effects = DragDropEffects.Copy;
                    CompleteDropRecordStructureGrid(e);
                    e.Handled = true;
                }
                else if ((e.IsFromOutside) && typeof(WorkOperationByStages).IsAssignableFrom(e.GetRecordType()) && e.TargetRecord == null)
                {
                    e.Effects = DragDropEffects.Copy;
                    CompleteDropRecordStructureGrid(e);
                    e.Handled = true;
                }
                else if (e.DropPosition == DropPosition.Inside && typeof(WorkOperationByStages).IsAssignableFrom(e.GetRecordType()))
                {
                    e.Effects = DragDropEffects.None;
                    e.Handled = false;
                }
                else if (typeof(WorkOperationByStages).IsAssignableFrom(e.GetRecordType()) && (e.DropPosition == DropPosition.Before || e.DropPosition == DropPosition.After))
                {
                    e.Effects = DragDropEffects.Move;
                    e.Handled = false;
                }

                else if (typeof(ERMSOPStructures).IsAssignableFrom(e.GetRecordType()) && (e.DropPosition == DropPosition.Before || e.DropPosition == DropPosition.After))
                {
                    var tragetPosition_var = e.TargetRecord.GetType().GetProperty("StructurePosition").GetValue(e.TargetRecord);
                    DevExpress.Xpf.Grid.TreeListView originsource = (DevExpress.Xpf.Grid.TreeListView)e.OriginalSource;
                    var SPosition_var = (originsource.FocusedRow.GetType().GetProperty("StructurePosition").GetValue(originsource.FocusedRow));
                    UInt32 SPosition = Convert.ToUInt32(SPosition_var);
                    UInt32 tragetPosition = Convert.ToUInt32(tragetPosition_var);
                    var TempTargetKeyName = e.TargetRecord.GetType().GetProperty("KeyName").GetValue(e.TargetRecord);//[GEOS2-5629][gulab lakade][16 07 2024]
                    var TempChangeKeyName = (originsource.FocusedRow.GetType().GetProperty("KeyName").GetValue(originsource.FocusedRow));//[GEOS2-5629][gulab lakade][16 07 2024]
                    string TargetKeyName = Convert.ToString(TempTargetKeyName);//[GEOS2-5629][gulab lakade][16 07 2024]
                    string ChangeKeyName = Convert.ToString(TempChangeKeyName);//[GEOS2-5629][gulab lakade][16 07 2024]
                    if (e.DropPosition == DropPosition.Before)
                    {

                        var TempChangesrecord = StructureMenulist.Where(x => x.StructurePosition == SPosition && x.KeyName == ChangeKeyName).FirstOrDefault();

                        var TempBeforerecord = StructureMenulist.Where(x => x.StructurePosition == tragetPosition && x.KeyName == TargetKeyName).FirstOrDefault();
                        if (tragetPosition < SPosition)
                        {
                            UInt32 pos = Convert.ToUInt32(tragetPosition);
                            foreach (var update in StructureMenulist.Where(x => x.StructurePosition >= tragetPosition).OrderBy(a => a.StructurePosition).ToList())
                            {
                                //start[GEOS2-5629][gulab lakade][16 07 2024]
                                int TempCount = 0;
                                TempCount = StructureMenulist.Where(x => x.ParentName == update.KeyName).ToList().Count();//[GEOS2-5629][gulab lakade][16 07 2024]
                                if (TempCount == 0)
                                {
                                    if (update.IdworkOperationByStage == TempChangesrecord.IdworkOperationByStage)
                                    {
                                        update.StructurePosition = Convert.ToUInt32(tragetPosition);
                                        // break;
                                    }
                                    else
                                    {
                                        if (Convert.ToUInt32(tragetPosition) == Convert.ToUInt32(pos))
                                        {
                                            pos++;
                                        }
                                        update.StructurePosition = pos;
                                        pos++;
                                    }
                                }
                                //end[GEOS2-5629][gulab lakade][16 07 2024]

                            }
                        }
                        else
                        {
                            UInt32 pos = Convert.ToUInt32(SPosition);

                            foreach (var update in StructureMenulist.Where(x => x.StructurePosition >= SPosition).OrderBy(a => a.StructurePosition).ToList())
                            {
                                //start[GEOS2-5629][gulab lakade][16 07 2024]
                                int TempCount = 0;
                                TempCount = StructureMenulist.Where(x => x.ParentName == update.KeyName).ToList().Count();//[GEOS2-5629][gulab lakade][16 07 2024]
                                if (TempCount == 0)
                                {
                                    if (update.IdworkOperationByStage == TempChangesrecord.IdworkOperationByStage)
                                    {
                                        update.StructurePosition = Convert.ToUInt32(tragetPosition - 1);
                                        // break;
                                    }
                                    else
                                    {
                                        if (pos == 0)
                                        {
                                            pos = 1;
                                        }
                                        if (pos == Convert.ToUInt32(tragetPosition - 1))
                                        {
                                            pos++;
                                        }
                                        update.StructurePosition = pos;
                                        pos++;
                                    }
                                }
                                //end[GEOS2-5629][gulab lakade][16 07 2024]

                            }
                        }



                    }
                    else if (e.DropPosition == DropPosition.After)
                    {
                        var TempChangesrecord = StructureMenulist.Where(x => x.StructurePosition == SPosition && x.KeyName == ChangeKeyName).FirstOrDefault();

                        var TempBeforerecord = StructureMenulist.Where(x => x.StructurePosition == tragetPosition && x.KeyName == TargetKeyName).FirstOrDefault();
                        if (tragetPosition < SPosition)
                        {
                            UInt32 pos = Convert.ToUInt32(tragetPosition);
                            foreach (var update in StructureMenulist.Where(x => x.StructurePosition >= tragetPosition).OrderBy(a => a.StructurePosition).ToList())
                            {
                                //start[GEOS2-5629][gulab lakade][16 07 2024]
                                int TempCount = 0;
                                TempCount = StructureMenulist.Where(x => x.ParentName == update.KeyName).ToList().Count();//[GEOS2-5629][gulab lakade][16 07 2024]
                                if (TempCount == 0)
                                {
                                    if (update.IdworkOperationByStage == TempChangesrecord.IdworkOperationByStage)
                                    {
                                        update.StructurePosition = Convert.ToUInt32(tragetPosition);
                                        //break;
                                    }
                                    else
                                    {
                                        if (Convert.ToUInt32(tragetPosition) == Convert.ToUInt32(pos))
                                        {
                                            pos++;
                                        }
                                        update.StructurePosition = pos;
                                        pos++;
                                    }
                                }
                                //end[GEOS2-5629][gulab lakade][16 07 2024]
                            }
                        }
                        else
                        {

                            UInt32 pos = Convert.ToUInt32(SPosition);
                            foreach (var update in StructureMenulist.Where(x => x.StructurePosition >= SPosition).OrderBy(a => a.StructurePosition).ToList())
                            {
                                //start[GEOS2-5629][gulab lakade][16 07 2024]
                                int TempCount = 0;
                                TempCount = StructureMenulist.Where(x => x.ParentName == update.KeyName).ToList().Count();//[GEOS2-5629][gulab lakade][16 07 2024]
                                if (TempCount == 0)
                                {

                                    if (update.IdworkOperationByStage == TempChangesrecord.IdworkOperationByStage)
                                    {
                                        update.StructurePosition = Convert.ToUInt32(tragetPosition);
                                        //break;
                                    }
                                    else
                                    {
                                        if (pos == 0)
                                        {
                                            pos = 1;
                                        }
                                        if (pos == Convert.ToUInt32(tragetPosition))
                                        {
                                            pos++;
                                        }
                                        update.StructurePosition = pos;
                                        pos++;
                                    }
                                }
                                //end[GEOS2-5629][gulab lakade][16 07 2024]
                            }
                        }
                    }

                    var TmpStructure = StructureMenulist.OrderBy(a => a.StructurePosition).ToList();
                    StructureMenulist = new ObservableCollection<ERMSOPStructures>(TmpStructure);
                    e.Effects = DragDropEffects.Move;
                    e.Handled = true;
                    IsModulesequence = true;
                }
                //  CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("SODDropRecordMessage").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);

                GeosApplication.Instance.Logger.Log("Method DropRecordStructuresGrid()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method DropRecordStructuresGrid()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }

        }
        private void CompleteRecordDragDropStructuresGrid(CompleteRecordDragDropEventArgs e)
        {
            e.Handled = true;
            IsModulesequence = false;
            IsEnabledSaveButton = true;
            // e.Handled = true;
            //FillmoduleGridColumn();
            int wocount = WorkOperationMenulist.ToList().Count();
        }
        #endregion

        #region GEOS2-3855 gulab lakade


        private Visibility isAccordionControlVisibleLogs;
        public Visibility IsAccordionControlVisibleLogs
        {
            get { return isAccordionControlVisibleLogs; }
            set
            {
                isAccordionControlVisibleLogs = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsAccordionControlVisibleLogs"));
            }
        }
        //List<StandardOperationsDictionarySupplement> lstStandardOperationsDictionarySupplement_Cloned = new List<StandardOperationsDictionarySupplement>();
        List<LogentriesbyStandardOperationsDictionary> tempLstStandardOperationsDictionaryChangeLogList = new List<LogentriesbyStandardOperationsDictionary>();

        public void AddChangedStandardOperationsDictionaryLogDetails(string LogValue)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method AddChangedStandardOperationsDictionaryLogDetails()...", category: Category.Info, priority: Priority.Low);
                try
                {
                    var temp = newList;
                    if (LogValue == "New")
                    {
                        #region GEOS2-3854 gulab lakade
                        string log = "Standard Operations Dictionary " + Convert.ToString(SelectedSODCode) + " has been added.";
                        StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                        #endregion
                    }
                    else if (LogValue == "Update")
                    {

                        #region GEOS2-3855 Add Remove Plant
                        if (SelectedPlant != null && ClonedSOD.PlantList != null)
                        {
                            var Addplant = SelectedPlant.Select(x => ((Site)x).Name).Except(ClonedSOD.PlantList.Select(a => a.Name)).ToList();
                            if (Addplant.Count > 0)
                            {
                                foreach (var item in Addplant)
                                {
                                    string log = "The Plant " + Convert.ToString(item) + " has been added.";
                                    StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });

                                }
                            }
                            var Removeplant = ClonedSOD.PlantList.Select(a => a.Name).Except(SelectedPlant.Select(x => ((Site)x).Name)).ToList();
                            if (Removeplant.Count > 0)
                            {

                                foreach (var item in Removeplant)
                                {

                                    string log = "The Plant " + Convert.ToString(item) + " has been removed.";
                                    StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });

                                }
                            }

                        }
                        #endregion
                        #region  GEOS2-3855 Add Update Supplement

                        List<UInt32> idSites = SelectedPlant.Select(i => ((Site)i).IdSite).ToList();
                        LstStandardOperationsDictionarySupplement.Where(i => !idSites.Contains(Convert.ToUInt32(i.IdPlant))).ToList().ForEach(i => i.TransactionOperation = ModelBase.TransactionOperations.Delete);

                        //LstStandardOperationsDictionarySupplement = LstStandardOperationsDictionarySupplement.Where(i => i.TransactionOperation != ModelBase.TransactionOperations.Modify).ToList();

                        //Rupali Sarode 15Sept2022
                        var tempListForStandardOperationsDictionarySupplement = LstStandardOperationsDictionarySupplement.Where(i => i.TransactionOperation != ModelBase.TransactionOperations.Modify).ToList();

                        foreach (var item in tempListForStandardOperationsDictionarySupplement)
                        {
                            string log = string.Empty;
                            string TransactionOperation = Convert.ToString(item.TransactionOperation);
                            string PlantName = Convert.ToString(item.PlantName);
                            string ValueName = supplements.Where(x => x.IdLookupValue == item.IdLookupValue).FirstOrDefault().Value.ToString();
                            string PlantValue = Convert.ToString(item.PlantValue);
                            string oldplantvalue = string.Empty;
                            //if (Convert.ToString(TransactionOperation) == "Update")
                            //{
                            //    var Oldplantvalue = ClonedSOD.LstStandardOperationsDictionarySupplement.Where(x => x.IdLookupValue == item.IdLookupValue && x.IdPlant == item.IdPlant).FirstOrDefault().PlantValue;
                            //    oldplantvalue = Convert.ToString(Oldplantvalue);
                            //}

                            if (Convert.ToString(TransactionOperation) == "Update" || Convert.ToString(TransactionOperation) == "Delete") // Rupali Sarode 15Sep2022
                            {
                                var Oldplantvalue = ClonedSOD.LstStandardOperationsDictionarySupplement.Where(x => x.IdLookupValue == item.IdLookupValue && x.IdPlant == item.IdPlant).FirstOrDefault().PlantValue;
                                oldplantvalue = Convert.ToString(Oldplantvalue);
                            }

                            if (Convert.ToString(TransactionOperation) == "Add")
                            {
                                log = "In " + ValueName + " for " + PlantName + " value " + PlantValue + " has been Added.";
                                //log = "In " + ValueName + " for " + PlantName + " value " + PlantValue + " has been Added.";
                            }
                            else if (Convert.ToString(TransactionOperation) == "Update")
                            {
                                log = "In " + ValueName + " for " + PlantName + " value changed from " + Convert.ToString(oldplantvalue) + " to " + PlantValue + ".";
                            }
                            else if (Convert.ToString(TransactionOperation) == "Delete")
                            {
                                // log = "In " + ValueName + " for " + PlantName + " value " + PlantValue + " has been deleted.";

                                // Rupali Sarode 15Sep2022
                                if (!string.IsNullOrEmpty(Convert.ToString(oldplantvalue)) && Convert.ToInt16(oldplantvalue) != 0)
                                    log = "In " + ValueName + " for " + PlantName + " value " + Convert.ToString(oldplantvalue) + " has been deleted.";
                            }

                            if (!string.IsNullOrEmpty(log))
                            {
                                StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });

                            }

                        }
                        #endregion

                        //#region GEOS2-3854  Update Language gulab lakade
                        //if (oldSelectedLanguage != LanguageSelected.TwoLetterISOLanguage)
                        //{
                        //    string log = "The Language has been changed from " + Convert.ToString(oldSelectedLanguage) + " to " + Convert.ToString(LanguageSelected.TwoLetterISOLanguage) + ".";
                        //    oldSelectedLanguage = LanguageSelected.TwoLetterISOLanguage;
                        //    StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                        //}
                        //#endregion

                        #region GEOS2-3854  Update name and Description gulab lakade
                        #region Name
                        if (IsCheckedAllLanguages == true)
                        {
                            //if ((Name_en == Name_es && Name_en == Name_fr && Name_en == Name_pt && Name_en == Name_ro && Name_en == Name_ru && Name_en == Name_zh) )
                            //{
                            if ((Name_en != ClonedSOD.Name_es || Name_en != ClonedSOD.Name_fr || Name_en != ClonedSOD.Name_pt || Name_en != ClonedSOD.Name_ro || Name_en != ClonedSOD.Name_ru || Name_en != ClonedSOD.Name_zh))
                            {
                                string log = string.Empty;
                                if (!string.IsNullOrEmpty(Name_en) && !string.IsNullOrEmpty(ClonedSOD.Name))
                                {
                                    log = "The Name for all language has been changed from " + Convert.ToString(ClonedSOD.Name) + " to " + Convert.ToString(Name) + ".";
                                }
                                else
                                    if (string.IsNullOrEmpty(Name_en) && !string.IsNullOrEmpty(ClonedSOD.Name))
                                {
                                    log = "The Name for all language has been changed from " + Convert.ToString(ClonedSOD.Name) + " to None.";
                                }
                                else
                                    if (!string.IsNullOrEmpty(Name_en) && string.IsNullOrEmpty(ClonedSOD.Name))
                                {
                                    log = "The Name for all language has been changed from None to " + Convert.ToString(Name) + ".";
                                }
                                if (!string.IsNullOrEmpty(log))
                                {
                                    StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                }

                            }

                            //}

                        }
                        else
                        {
                            if (Name_en != ClonedSOD.Name)
                            {
                                string log = string.Empty;
                                if (!string.IsNullOrEmpty(Name) && !string.IsNullOrEmpty(ClonedSOD.Name))
                                {
                                    log = "The Name EN has been changed from " + Convert.ToString(ClonedSOD.Name) + " to " + Convert.ToString(Name) + ".";
                                }
                                else
                                    if (string.IsNullOrEmpty(Name))
                                {
                                    log = "The Name EN has been changed from " + Convert.ToString(ClonedSOD.Name) + " to None.";
                                }
                                else
                                    if (string.IsNullOrEmpty(ClonedSOD.Name))
                                {
                                    log = "The Name EN has been changed from None to " + Convert.ToString(Name) + ".";
                                }
                                if (!string.IsNullOrEmpty(log))
                                {
                                    StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                }
                            }

                            if (Name_es != ClonedSOD.Name_es)
                            {
                                string log = string.Empty;
                                if (!string.IsNullOrEmpty(Name_es) && !string.IsNullOrEmpty(ClonedSOD.Name_es))
                                {
                                    log = "The Name ES has been changed from " + Convert.ToString(ClonedSOD.Name_es) + " to " + Convert.ToString(Name_es) + ".";
                                }
                                else
                                    if (string.IsNullOrEmpty(Name_es))
                                {
                                    log = "The Name ES has been changed from " + Convert.ToString(ClonedSOD.Name_es) + " to None.";
                                }
                                else
                                    if (string.IsNullOrEmpty(ClonedSOD.Name_es))
                                {
                                    log = "The Name ES has been changed from None to " + Convert.ToString(Name_es) + ".";
                                }
                                if (!string.IsNullOrEmpty(log))
                                {
                                    StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                }
                            }

                            if (Name_fr != ClonedSOD.Name_fr)
                            {
                                string log = string.Empty;
                                if (!string.IsNullOrEmpty(Name_fr) && !string.IsNullOrEmpty(ClonedSOD.Name_fr))
                                {
                                    log = "The Name FR has been changed from " + Convert.ToString(ClonedSOD.Name_fr) + " to " + Convert.ToString(Name_fr) + ".";
                                }
                                else
                                    if (string.IsNullOrEmpty(Name_fr))
                                {
                                    log = "The Name FR has been changed from " + Convert.ToString(ClonedSOD.Name_fr) + " to None.";
                                }
                                else
                                    if (string.IsNullOrEmpty(ClonedSOD.Name_fr))
                                {
                                    log = "The Name FR has been changed from None to " + Convert.ToString(Name_fr) + ".";
                                }
                                if (!string.IsNullOrEmpty(log))
                                {
                                    StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                }
                            }

                            if (Name_pt != ClonedSOD.Name_pt)
                            {
                                string log = string.Empty;
                                if (!string.IsNullOrEmpty(Name_pt) && !string.IsNullOrEmpty(ClonedSOD.Name_pt))
                                {
                                    log = "The Name PT has been changed from " + Convert.ToString(ClonedSOD.Name_pt) + " to " + Convert.ToString(Name_pt) + ".";
                                }
                                else
                                    if (string.IsNullOrEmpty(Name_pt))
                                {
                                    log = "The Name PT has been changed from " + Convert.ToString(ClonedSOD.Name_pt) + " to None.";
                                }
                                else
                                    if (string.IsNullOrEmpty(ClonedSOD.Name_pt))
                                {
                                    log = "The Name PT has been changed from None to " + Convert.ToString(Name_pt) + ".";
                                }
                                if (!string.IsNullOrEmpty(log))
                                {
                                    StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                }
                            }

                            if (Name_ro != ClonedSOD.Name_ro)
                            {
                                string log = string.Empty;
                                if (!string.IsNullOrEmpty(Name_ro) && !string.IsNullOrEmpty(ClonedSOD.Name_ro))
                                {
                                    log = "The Name RO has been changed from " + Convert.ToString(ClonedSOD.Name_ro) + " to " + Convert.ToString(Name_ro) + ".";
                                }
                                else
                                    if (string.IsNullOrEmpty(Name_ro))
                                {
                                    log = "The Name RO has been changed from " + Convert.ToString(ClonedSOD.Name_ro) + " to None.";
                                }
                                else
                                    if (string.IsNullOrEmpty(ClonedSOD.Name_ro))
                                {
                                    log = "The Name RO has been changed from None to " + Convert.ToString(Name_ro) + ".";
                                }
                                if (!string.IsNullOrEmpty(log))
                                {
                                    StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                }
                            }

                            if (Name_ru != ClonedSOD.Name_ru)
                            {
                                string log = string.Empty;
                                if (!string.IsNullOrEmpty(Name_ru) && !string.IsNullOrEmpty(ClonedSOD.Name_ru))
                                {
                                    log = "The Name RU has been changed from " + Convert.ToString(ClonedSOD.Name_ru) + " to " + Convert.ToString(Name_ru) + ".";
                                }
                                else
                                    if (string.IsNullOrEmpty(Name_ru))
                                {
                                    log = "The Name RU has been changed from " + Convert.ToString(ClonedSOD.Name_ru) + " to None.";
                                }
                                else
                                    if (string.IsNullOrEmpty(ClonedSOD.Name_ru))
                                {
                                    log = "The Name RU has been changed from None to " + Convert.ToString(Name_ru) + ".";
                                }
                                if (!string.IsNullOrEmpty(log))
                                {
                                    StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                }
                            }

                            if (Name_zh != ClonedSOD.Name_zh)
                            {
                                string log = string.Empty;
                                if (!string.IsNullOrEmpty(Name_zh) && !string.IsNullOrEmpty(ClonedSOD.Name_zh))
                                {
                                    log = "The Name ZH has been changed from " + Convert.ToString(ClonedSOD.Name_zh) + " to " + Convert.ToString(Name_zh) + ".";
                                }
                                else
                                    if (string.IsNullOrEmpty(Name_zh))
                                {
                                    log = "The Name ZH has been changed from " + Convert.ToString(ClonedSOD.Name_zh) + " to None.";
                                }
                                else
                                    if (string.IsNullOrEmpty(ClonedSOD.Name_zh))
                                {
                                    log = "The Name ZH has been changed from None to " + Convert.ToString(Name_zh) + ".";
                                }
                                if (!string.IsNullOrEmpty(log))
                                {
                                    StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                }
                            }
                        }
                        #endregion

                        #region Description
                        if (IsCheckedAllLanguages == true)
                        {
                            if (Description_en != ClonedSOD.Description_es || Description_en != ClonedSOD.Description_fr || Description_en != ClonedSOD.Description_pt || Description_en != ClonedSOD.Description_ro || Description_en != ClonedSOD.Description_ru || Description_en != ClonedSOD.Description_zh)
                            {
                                string log = string.Empty;
                                if (!string.IsNullOrEmpty(Convert.ToString(ClonedSOD.Description)) && !string.IsNullOrEmpty(Convert.ToString(Description)))
                                {
                                    log = "The Description for all language has been changed from " + Convert.ToString(ClonedSOD.Description) + " to " + Convert.ToString(Description) + ".";
                                }
                                else
                                if (string.IsNullOrEmpty(Convert.ToString(ClonedSOD.Description)) && !string.IsNullOrEmpty(Convert.ToString(Description)))
                                {
                                    log = "The Description for all language has been changed from None to " + Convert.ToString(Description) + ".";
                                }
                                else
                                    if (!string.IsNullOrEmpty(Convert.ToString(ClonedSOD.Description)) && string.IsNullOrEmpty(Convert.ToString(Description)))
                                {
                                    log = "The Description for all language has been changed from " + Convert.ToString(ClonedSOD.Description) + " to None.";
                                }
                                if (!string.IsNullOrEmpty(log))
                                {
                                    StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                }
                            }

                        }
                        else
                        {
                            if (Description_en != ClonedSOD.Description)
                            {
                                string log = string.Empty;
                                if (!string.IsNullOrEmpty(Description) && !string.IsNullOrEmpty(ClonedSOD.Description))
                                {
                                    log = "The Description EN has been changed from " + Convert.ToString(ClonedSOD.Description) + " to " + Convert.ToString(Description) + ".";
                                }
                                else
                                    if (string.IsNullOrEmpty(Description))
                                {
                                    log = "The Description EN has been changed from " + Convert.ToString(ClonedSOD.Description) + " to None.";
                                }
                                else
                                    if (string.IsNullOrEmpty(ClonedSOD.Description))
                                {
                                    log = "The Description EN has been changed from None to " + Convert.ToString(Description) + ".";
                                }
                                if (!string.IsNullOrEmpty(log))
                                {
                                    StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                }
                            }

                            if (Description_es != ClonedSOD.Description_es)
                            {
                                string log = string.Empty;
                                if (!string.IsNullOrEmpty(Description_es) && !string.IsNullOrEmpty(ClonedSOD.Description_es))
                                {
                                    log = "The Description ES has been changed from " + Convert.ToString(ClonedSOD.Description_es) + " to " + Convert.ToString(Description_es) + ".";
                                }
                                else
                                    if (string.IsNullOrEmpty(Description_es))
                                {
                                    log = "The Description ES has been changed from " + Convert.ToString(ClonedSOD.Description_es) + " to None.";
                                }
                                else
                                    if (string.IsNullOrEmpty(ClonedSOD.Description_es))
                                {
                                    log = "The Description ES has been changed from None to " + Convert.ToString(Description_es) + ".";
                                }
                                if (!string.IsNullOrEmpty(log))
                                {
                                    StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                }
                            }

                            if (Description_fr != ClonedSOD.Description_fr)
                            {
                                string log = string.Empty;
                                if (!string.IsNullOrEmpty(Description_fr) && !string.IsNullOrEmpty(ClonedSOD.Description_fr))
                                {
                                    log = "The Description FR has been changed from " + Convert.ToString(ClonedSOD.Description_fr) + " to " + Convert.ToString(Description_fr) + ".";
                                }
                                else
                                    if (string.IsNullOrEmpty(Description_fr))
                                {
                                    log = "The Description FR has been changed from " + Convert.ToString(ClonedSOD.Description_fr) + " to None.";
                                }
                                else
                                    if (string.IsNullOrEmpty(ClonedSOD.Description_fr))
                                {
                                    log = "The Description FR has been changed from None to " + Convert.ToString(Description_fr) + ".";
                                }
                                if (!string.IsNullOrEmpty(log))
                                {
                                    StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                }
                            }
                            if (Description_pt != ClonedSOD.Description_pt)
                            {
                                string log = string.Empty;
                                if (!string.IsNullOrEmpty(Description_pt) && !string.IsNullOrEmpty(ClonedSOD.Description_pt))
                                {
                                    log = "The Description PT has been changed from " + Convert.ToString(ClonedSOD.Description_pt) + " to " + Convert.ToString(Description_pt) + ".";
                                }
                                else
                                    if (string.IsNullOrEmpty(Description_pt))
                                {
                                    log = "The Description PT has been changed from " + Convert.ToString(ClonedSOD.Description_pt) + " to None.";
                                }
                                else
                                    if (string.IsNullOrEmpty(ClonedSOD.Description_pt))
                                {
                                    log = "The Description PT has been changed from None to " + Convert.ToString(Description_pt) + ".";
                                }
                                if (!string.IsNullOrEmpty(log))
                                {
                                    StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                }
                            }

                            if (Description_ro != ClonedSOD.Description_ro)
                            {
                                string log = string.Empty;
                                if (!string.IsNullOrEmpty(Description_ro) && !string.IsNullOrEmpty(ClonedSOD.Description_ro))
                                {
                                    log = "The Description RO has been changed from " + Convert.ToString(ClonedSOD.Description_ro) + " to " + Convert.ToString(Description_ro) + ".";
                                }
                                else
                                    if (string.IsNullOrEmpty(Description_ro))
                                {
                                    log = "The Description RO has been changed from " + Convert.ToString(ClonedSOD.Description_ro) + " to None.";
                                }
                                else
                                    if (string.IsNullOrEmpty(ClonedSOD.Description_ro))
                                {
                                    log = "The Description RO has been changed from None to " + Convert.ToString(Description_ro) + ".";
                                }
                                if (!string.IsNullOrEmpty(log))
                                {
                                    StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                }
                            }

                            if (Description_ru != ClonedSOD.Description_ru)
                            {
                                string log = string.Empty;
                                if (!string.IsNullOrEmpty(Description_ru) && !string.IsNullOrEmpty(ClonedSOD.Description_ru))
                                {
                                    log = "The Description RU has been changed from " + Convert.ToString(ClonedSOD.Description_ru) + " to " + Convert.ToString(Description_ru) + ".";
                                }
                                else
                                    if (string.IsNullOrEmpty(Description_ru))
                                {
                                    log = "The Description RU has been changed from " + Convert.ToString(ClonedSOD.Description_ru) + " to None.";
                                }
                                else
                                    if (string.IsNullOrEmpty(ClonedSOD.Description_ru))
                                {
                                    log = "The Description RU has been changed from None to " + Convert.ToString(Description_ru) + ".";
                                }
                                if (!string.IsNullOrEmpty(log))
                                {
                                    StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                }
                            }

                            if (Description_zh != ClonedSOD.Description_zh)
                            {
                                string log = string.Empty;
                                if (!string.IsNullOrEmpty(Description_zh) && !string.IsNullOrEmpty(ClonedSOD.Description_zh))
                                {
                                    log = "The Description ZH has been changed from " + Convert.ToString(ClonedSOD.Description_zh) + " to " + Convert.ToString(Description_zh) + ".";
                                }
                                else
                                    if (string.IsNullOrEmpty(Description_zh))
                                {
                                    log = "The Description ZH has been changed from " + Convert.ToString(ClonedSOD.Description_zh) + " to None.";
                                }
                                else
                                    if (string.IsNullOrEmpty(ClonedSOD.Description_zh))
                                {
                                    log = "The Description ZH has been changed from None to " + Convert.ToString(Description_zh) + ".";
                                }
                                if (!string.IsNullOrEmpty(log))
                                {
                                    StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                }
                            }
                        }
                        #endregion
                        //if ((!string.IsNullOrEmpty(Name)) && ((Name != Tempname) && (!string.IsNullOrEmpty(Tempname))))
                        //{
                        //    string log = "The Name has been changed from " + Convert.ToString(Tempname) + " to " + Convert.ToString(Name) + ".";
                        //    StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                        //    Tempname = Convert.ToString(Name);
                        //}

                        //if ((!string.IsNullOrEmpty(Description)) && (Description != Tempdescription) && (!string.IsNullOrEmpty(Tempdescription)))
                        //{
                        //    string log = "The Description has been changed from " + Convert.ToString(Tempdescription) + " to " + Convert.ToString(Description) + ".";
                        //    StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                        //    Tempdescription = Convert.ToString(Description);
                        //}
                        #endregion
                        #region GEOS2-3854  Update Status gulab lakade

                        if (!string.IsNullOrEmpty(Convert.ToString(SelectedStatus.Value)) && (!string.IsNullOrEmpty(Convert.ToString(SelectedOriginalStatus.Value))) && (Convert.ToString(SelectedStatus.Value) != Convert.ToString(SelectedOriginalStatus.Value)))
                        {
                            string log = "The Status has been changed from " + Convert.ToString(Convert.ToString(SelectedOriginalStatus.Value)) + " to " + Convert.ToString(SelectedStatus.Value) + ".";
                            StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                        }
                        #endregion

                        #region GEOS2-3854  Update Effective date gulab lakade

                        if ((Convert.ToString(EffectiveDate) != Convert.ToString(ClonedSOD.EffectiveDate)))
                        {
                            string log = string.Empty;
                            if (!string.IsNullOrEmpty(Convert.ToString(EffectiveDate)) && (!string.IsNullOrEmpty(Convert.ToString(ClonedSOD.EffectiveDate))))
                            {
                                if (Convert.ToString(ClonedSOD.EffectiveDate.ToString("dd-MM-yyyy")) == "01-01-0001")
                                {
                                    DateTime Effectivedate = Convert.ToDateTime(EffectiveDate);
                                    log = "The Effective Date has been changed from None to " + Effectivedate.ToString("dd-MM-yyyy") + ".";
                                }
                                else
                                {
                                    DateTime Effectivedate = Convert.ToDateTime(EffectiveDate);
                                    log = "The Effective Date has been changed from " + Convert.ToString(ClonedSOD.EffectiveDate.ToString("dd-MM-yyyy")) + " to " + Effectivedate.ToString("dd-MM-yyyy") + ".";
                                }

                            }
                            else
                                if (string.IsNullOrEmpty(Convert.ToString(EffectiveDate)) && !string.IsNullOrEmpty(Convert.ToString(ClonedSOD.EffectiveDate)))
                            {
                                if (Convert.ToString(ClonedSOD.EffectiveDate.ToString("dd-MM-yyyy")) != "01-01-0001")
                                {
                                    log = "The Effective Date has been changed from " + Convert.ToString(ClonedSOD.EffectiveDate.ToString("dd-MM-yyyy")) + " to None.";
                                }

                            }
                            else
                                if (string.IsNullOrEmpty(Convert.ToString(ClonedSOD.EffectiveDate)))
                            {
                                if (Convert.ToString(EffectiveDate) != "01-01-0001" || !string.IsNullOrEmpty(Convert.ToString(EffectiveDate)))
                                {
                                    DateTime Effectivedate = Convert.ToDateTime(EffectiveDate);
                                    log = "The Effective Date has been changed from None to " + Effectivedate.ToString("dd-MM-yyyy") + ".";
                                }
                            }
                            if (!string.IsNullOrEmpty(log))
                            {
                                StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                            }

                        }
                        #endregion

                        #region GEOS2-3854  Update Effective date gulab lakade

                        if ((Convert.ToString(ExpiryDate) != Convert.ToString(ClonedSOD.ExpiryDate)))
                        {
                            string log = string.Empty;
                            if (!string.IsNullOrEmpty(Convert.ToString(ExpiryDate)))
                            {
                                if (Convert.ToString(ClonedSOD.ExpiryDate.ToString("dd-MM-yyyy")) == "01-01-0001")
                                {
                                    DateTime Expirydate = Convert.ToDateTime(ExpiryDate);
                                    log = "The Expiry Date has been changed from None to " + Expirydate.ToString("dd-MM-yyyy") + ".";
                                }
                                else
                                {
                                    DateTime Expirydate = Convert.ToDateTime(ExpiryDate);
                                    log = "The Expiry Date has been changed from " + Convert.ToString(Convert.ToString(ClonedSOD.ExpiryDate.ToString("dd-MM-yyyy"))) + " to " + Expirydate.ToString("dd-MM-yyyy") + ".";
                                }

                            }
                            else
                            if (string.IsNullOrEmpty(Convert.ToString(ExpiryDate)))
                            {
                                if (Convert.ToString(ClonedSOD.ExpiryDate.ToString("dd-MM-yyyy")) != "01-01-0001")
                                {
                                    log = "The Expiry Date has been changed from " + Convert.ToString(Convert.ToString(ClonedSOD.ExpiryDate.ToString("dd-MM-yyyy"))) + " to None.";
                                }

                            }
                            else
                                if (string.IsNullOrEmpty(Convert.ToString(ClonedSOD.ExpiryDate)))
                            {
                                if (Convert.ToString(ExpiryDate) != "01-01-0001" || !string.IsNullOrEmpty(Convert.ToString(ExpiryDate)))
                                {
                                    DateTime Expirydate = Convert.ToDateTime(ExpiryDate);
                                    log = "The Expiry Date has been changed from None to " + Expirydate.ToString("dd-MM-yyyy") + ".";
                                }


                            }

                            if (!string.IsNullOrEmpty(log))
                            {
                                StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                            }
                        }
                        #endregion

                        // moduleLogs(standardOperationsDictionaryModulesList);
                    }

                }
                catch (Exception ex) { }
                try
                {
                    if (Saveselecteditem == "module")
                        moduleLogs();

                    #region GEOS2-3857  Add Log for Detection, Option and Ways Rupali Sarode  
                    if (Saveselecteditem == "Detection")
                        DetectionLog();
                    if (Saveselecteditem == "Option")
                        OptionLog();
                    if (Saveselecteditem == "Ways")
                        WaysLog();

                    #endregion

                    #region GEOS2-3861 Add Log for Structure
                    if (Saveselecteditem == "Structure")
                        StructureLog();
                    #endregion

                    if (Saveselecteditem == "SparePart")
                        SparePartLog();
                }
                catch (Exception ex) { }

                GeosApplication.Instance.Logger.Log("Method AddChangedStandardOperationsDictionaryLogDetails()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an Error in Method AddChangedStandardOperationsDictionaryLogDetails()........" + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        private void HideLogPanel(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method HideLogPanel ...", category: Category.Info, priority: Priority.Low);

                if (IsAccordionControlVisibleLogs == Visibility.Collapsed)
                    IsAccordionControlVisibleLogs = Visibility.Visible;
                else
                    IsAccordionControlVisibleLogs = Visibility.Collapsed;
                GeosApplication.Instance.Logger.Log("Method HideLogPanel()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method HideLogPanel()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        #endregion
        #endregion

        #region GEOS2-3954 Gulab lakade Time format HH:mm:ss
        //public TimeSpan ConvertfloattoTimespan(string observedtime)
        //{
        //    TimeSpan UITempobservedTime;
        //    try
        //    {
        //        #region GEOS2-3954 Time format HH:MM:SS

        //        string tempd = Convert.ToString(observedtime);
        //        string[] parts = new string[2];
        //        int i1 = 0;
        //        int i2 = 0;
        //        if (tempd.Contains("."))
        //        {
        //            parts = tempd.Split('.');
        //            i1 = int.Parse(parts[0]);
        //            i2 = int.Parse(parts[1]);
        //            i1 = (i1 * 60) + i2;
        //        }
        //        else
        //        {
        //            parts = tempd.Split('.');
        //            i1 = int.Parse(parts[0]);
        //            i1 = (i1 * 60);
        //        }



        //        UITempobservedTime = TimeSpan.FromSeconds(i1);
        //        int ts1 = UITempobservedTime.Hours;
        //        int ts2 = UITempobservedTime.Minutes;
        //        int ts3 = UITempobservedTime.Seconds;


        //        #endregion
        //        return UITempobservedTime;
        //    }
        //    catch (Exception ex)
        //    {
        //        UITempobservedTime = TimeSpan.FromSeconds(0);
        //        return UITempobservedTime;
        //    }

        //}

        //public TimeSpan ConvertfloattoTimespanForNormalTime(string Normaltime)
        //{
        //    TimeSpan UITempNormalTime;
        //    try
        //    {
        //        #region GEOS2-3954 Time format HH:MM:SS

        //        string temnormaltime = Convert.ToString(Normaltime);
        //        string[] NormaltimeArr = new string[2];
        //        int nt1 = 0;
        //        int nt2 = 0;
        //        if (temnormaltime.Contains("."))
        //        {
        //            NormaltimeArr = temnormaltime.Split('.');
        //            nt1 = int.Parse(NormaltimeArr[0]);
        //            nt2 = int.Parse(NormaltimeArr[1]);
        //            nt1 = (nt1 * 60) + nt2;
        //        }
        //        else
        //        {
        //            NormaltimeArr = temnormaltime.Split('.');
        //            nt1 = int.Parse(NormaltimeArr[0]);
        //            nt1 = (nt1 * 60);
        //        }

        //        UITempNormalTime = TimeSpan.FromSeconds(nt1);

        //        #endregion
        //        return UITempNormalTime;
        //    }
        //    catch (Exception ex)
        //    {
        //        UITempNormalTime = TimeSpan.FromSeconds(0);
        //        return UITempNormalTime;
        //    }

        //}
        //public String ConvertTimespantoFloat(String observedtime)
        //{
        //    string[] NormaltimeArr = new string[2];
        //    int nt1 = 0;
        //    int nt2 = 0;
        //    int nt3 = 0;
        //    if (observedtime.Contains(":"))
        //    {
        //        NormaltimeArr = observedtime.Split(':');
        //        nt1 = int.Parse(NormaltimeArr[0]);
        //        nt2 = int.Parse(NormaltimeArr[1]);
        //        nt3 = int.Parse(NormaltimeArr[2]);
        //        nt1 = (nt1 * 60) + nt2;
        //    }
        //    string tempstring = Convert.ToString(nt1) + "." + Convert.ToString(nt3);
        //    #region GEOS2-3954 Time format HH:MM:SS
        //    //int TempOTDay = observedtime.Days;
        //    //int TempOTHours = observedtime.Hours;
        //    //int TempOTminute = observedtime.Minutes;
        //    //int TempOTSecond = observedtime.Seconds;
        //    //string tempstring = Convert.ToString(((TempOTDay * 24) + TempOTHours) * 60 + TempOTminute) + "." + TempOTSecond;
        //    //float tempfloat = float.Parse(tempstring);
        //    // float tempfloat = float.Parse(Convert.ToString(UITempobservedTime.TotalMinutes));
        //    //ObservedTime = tempfloat;

        //    //int TempNTDay = UITempNormalTime.Days;
        //    //int TempNTHours = UITempNormalTime.Hours;
        //    //int TempNTminute = UITempNormalTime.Minutes;
        //    //int TempNTSecond = UITempNormalTime.Seconds;
        //    //string tempNTstring = Convert.ToString(((TempNTDay * 24) + TempNTHours) * 60 + TempNTminute) + "." + TempNTSecond;
        //    //float tempNTfloat = float.Parse(tempNTstring);
        //    // NormalTime = tempNTfloat;
        //    #endregion
        //    return tempstring;
        //}
        public TimeSpan ConvertfloattoTimespanlog(string observedtime)
        {
            TimeSpan UITempobservedTime;
            try
            {
                //UITempobservedTime = TimeSpan.FromMinutes(Convert.ToDouble(observedtime));

                #region [GEOS2-5008][gulab lakade][1 11 2023]
                UITempobservedTime = TimeSpan.FromMinutes(Convert.ToDouble(observedtime));
                if (UITempobservedTime.Milliseconds >= 600)
                {

                    TimeSpan Second = TimeSpan.FromMilliseconds(1000);
                    UITempobservedTime = UITempobservedTime.Add(Second);
                    UITempobservedTime = UITempobservedTime.Add(-TimeSpan.FromMilliseconds(UITempobservedTime.Milliseconds));

                }
                else
                {
                    UITempobservedTime = UITempobservedTime.Add(-TimeSpan.FromMilliseconds(UITempobservedTime.Milliseconds));
                }

                #endregion
                return UITempobservedTime;
            }
            catch (Exception ex)
            {
                UITempobservedTime = TimeSpan.FromMinutes(0);
                return UITempobservedTime;
            }
            //TimeSpan UITempobservedTime;
            //try
            //{
            //    GeosApplication.Instance.Logger.Log("Method ConvertfloattoTimespanlog()...", category: Category.Info, priority: Priority.Low);

            //    UITempobservedTime = TimeSpan.FromMinutes(Convert.ToDouble(observedtime));
            //    return new TimeSpan(UITempobservedTime.Hours, UITempobservedTime.Minutes, UITempobservedTime.Seconds);


            //}
            //catch (Exception ex)
            //{
            //    UITempobservedTime = TimeSpan.FromMinutes(0);
            //    return UITempobservedTime;
            //}
        }
        public TimeSpan ConvertfloattoTimespan(string observedtime)
        {
            TimeSpan UITempobservedTime;
            try
            {
                //UITempobservedTime = TimeSpan.FromMinutes(Convert.ToDouble(observedtime));

                #region [GEOS2-5008][gulab lakade][1 11 2023]
                UITempobservedTime = TimeSpan.FromMinutes(Convert.ToDouble(observedtime));
                if (UITempobservedTime.Milliseconds >= 600)
                {

                    TimeSpan Second = TimeSpan.FromMilliseconds(1000);
                    UITempobservedTime = UITempobservedTime.Add(Second);
                    UITempobservedTime = UITempobservedTime.Add(-TimeSpan.FromMilliseconds(UITempobservedTime.Milliseconds));

                }
                else
                {
                    UITempobservedTime = UITempobservedTime.Add(-TimeSpan.FromMilliseconds(UITempobservedTime.Milliseconds));
                }

                #endregion
                return UITempobservedTime;
            }
            catch (Exception ex)
            {
                UITempobservedTime = TimeSpan.FromMinutes(0);
                return UITempobservedTime;
            }
            //try
            //{
            //    #region GEOS2-3954 Time format HH:MM:SS
            //    var currentculter = CultureInfo.CurrentCulture;
            //    string culterseparator = currentculter.NumberFormat.NumberDecimalSeparator.ToString();
            //    string tempd = Convert.ToString(observedtime);
            //    string[] parts = new string[2];
            //    int i1 = 0;
            //    int i2 = 0;
            //    if (tempd.Contains(culterseparator))
            //    {
            //        parts = tempd.Split(Convert.ToChar(culterseparator));
            //        i1 = int.Parse(parts[0]);
            //        i2 = int.Parse(parts[1]);

            //        if (Convert.ToString(parts[1]).Length == 1)
            //        {
            //            i1 = (i1 * 60) + i2 * 10;
            //        }
            //        else
            //        {
            //            i1 = (i1 * 60) + i2;
            //        }

            //    }
            //    else
            //    {
            //        parts = tempd.Split(Convert.ToChar(culterseparator));
            //        i1 = int.Parse(parts[0]);
            //        i1 = (i1 * 60);
            //    }



            //    UITempobservedTime = TimeSpan.FromSeconds(i1);
            //    int ts1 = UITempobservedTime.Hours;
            //    int ts2 = UITempobservedTime.Minutes;
            //    int ts3 = UITempobservedTime.Seconds;


            //    #endregion
            //    return UITempobservedTime;
            //}
            //catch (Exception ex)
            //{
            //    UITempobservedTime = TimeSpan.FromSeconds(0);
            //    return UITempobservedTime;
            //}

        }

        public TimeSpan ConvertfloattoTimespanForNormalTime(string Normaltime)
        {
            TimeSpan UITempNormalTime;
            try
            {
                //UITempNormalTime = TimeSpan.FromMinutes(Convert.ToDouble(Normaltime));

                #region [GEOS2-5008][gulab lakade][1 11 2023]
                UITempNormalTime = TimeSpan.FromMinutes(Convert.ToDouble(Normaltime));
                if (UITempNormalTime.Milliseconds >= 600)
                {

                    TimeSpan Second = TimeSpan.FromMilliseconds(1000);
                    UITempNormalTime = UITempNormalTime.Add(Second);
                    UITempNormalTime = UITempNormalTime.Add(-TimeSpan.FromMilliseconds(UITempNormalTime.Milliseconds));

                }
                else
                {
                    UITempNormalTime = UITempNormalTime.Add(-TimeSpan.FromMilliseconds(UITempNormalTime.Milliseconds));
                }

                #endregion
                return UITempNormalTime;
            }
            catch (Exception ex)
            {
                UITempNormalTime = TimeSpan.FromMinutes(0);
                return UITempNormalTime;
            }
            //try
            //{
            //    var currentculter = CultureInfo.CurrentCulture;
            //    string culterseparator = currentculter.NumberFormat.NumberDecimalSeparator.ToString();
            //    #region GEOS2-3954 Time format HH:MM:SS

            //    string temnormaltime = Convert.ToString(Normaltime);
            //    string[] NormaltimeArr = new string[2];
            //    int nt1 = 0;
            //    int nt2 = 0;
            //    if (temnormaltime.Contains(culterseparator))
            //    {
            //        //char[] culterseparatorarr =Convert.ToChar(culterseparator);
            //        NormaltimeArr = temnormaltime.Split(Convert.ToChar(culterseparator));
            //        nt1 = int.Parse(NormaltimeArr[0]);
            //        nt2 = int.Parse(NormaltimeArr[1]);
            //        if (Convert.ToString(NormaltimeArr[1]).Length == 1)
            //        {
            //            nt1 = (nt1 * 60) + nt2 * 10;
            //        }
            //        else
            //        {
            //            nt1 = (nt1 * 60) + nt2;
            //        }

            //    }
            //    else
            //    {
            //        NormaltimeArr = temnormaltime.Split(Convert.ToChar(culterseparator));
            //        nt1 = int.Parse(NormaltimeArr[0]);
            //        nt1 = (nt1 * 60);
            //    }

            //    UITempNormalTime = TimeSpan.FromSeconds(nt1);

            //    #endregion
            //    return UITempNormalTime;
            //}
            //catch (Exception ex)
            //{
            //    UITempNormalTime = TimeSpan.FromSeconds(0);
            //    return UITempNormalTime;
            //}

        }
        public float? ConvertTimespantoFloat(TimeSpan observedtime)
        {
            float? tempstring;
            try
            {
                tempstring = (float?)Math.Round(Convert.ToDouble(observedtime.TotalMinutes), 2);
                return tempstring;
            }
            catch (Exception ex)
            {
                return tempstring = 0;
            }
            //try
            //{
            //    var currentculter = CultureInfo.CurrentCulture;
            //    string culterseparator = currentculter.NumberFormat.NumberDecimalSeparator.ToString();
            //    string[] tempDaysHours;
            //    int tempDays = 0;
            //    int tempHours = 0;


            //    string[] NormaltimeArr = new string[2];
            //    int nt1 = 0;
            //    int nt2 = 0;
            //    int nt3 = 0;
            //    if (observedtime.Contains(":"))
            //    {
            //        NormaltimeArr = observedtime.Split(':');
            //        #region [GEOS2-3882][Rupali Sarode][14-11-2022]
            //        if (NormaltimeArr[0].Contains(culterseparator))
            //        {
            //            tempDaysHours = NormaltimeArr[0].Split(Convert.ToChar(culterseparator));
            //            if (tempDaysHours.Count() > 0)
            //            {
            //                tempHours = Convert.ToInt32(tempDaysHours[0]) * 24 + Convert.ToInt32(tempDaysHours[1]);
            //                nt1 = tempHours;
            //            }
            //        }
            //        else
            //        {
            //            nt1 = int.Parse(NormaltimeArr[0]);
            //        }
            //        #endregion [GEOS2-3882][Rupali Sarode][14-11-2022]

            //        nt2 = int.Parse(NormaltimeArr[1]);
            //        nt3 = int.Parse(NormaltimeArr[2]);
            //        nt1 = (nt1 * 60) + nt2;
            //    }
            //    //string tempstring = string.Empty;
            //    if (Convert.ToString(nt3).Length == 1)
            //    {
            //        tempstring = Convert.ToString(nt1) + culterseparator + "0" + Convert.ToString(nt3);
            //    }
            //    else
            //    {
            //        tempstring = Convert.ToString(nt1) + culterseparator + Convert.ToString(nt3);
            //    }
            //    #region GEOS2-3954 Time format HH:MM:SS
            //    //int TempOTDay = observedtime.Days;
            //    //int TempOTHours = observedtime.Hours;
            //    //int TempOTminute = observedtime.Minutes;
            //    //int TempOTSecond = observedtime.Seconds;
            //    //string tempstring = Convert.ToString(((TempOTDay  24) + TempOTHours)  60 + TempOTminute) + "." + TempOTSecond;
            //    //float tempfloat = float.Parse(tempstring);
            //    // float tempfloat = float.Parse(Convert.ToString(UITempobservedTime.TotalMinutes));
            //    //ObservedTime = tempfloat;

            //    //int TempNTDay = UITempNormalTime.Days;
            //    //int TempNTHours = UITempNormalTime.Hours;
            //    //int TempNTminute = UITempNormalTime.Minutes;
            //    //int TempNTSecond = UITempNormalTime.Seconds;
            //    //string tempNTstring = Convert.ToString(((TempNTDay  24) + TempNTHours)  60 + TempNTminute) + "." + TempNTSecond;
            //    //float tempNTfloat = float.Parse(tempNTstring);
            //    // NormalTime = tempNTfloat;
            //    #endregion
            //    return tempstring;
            //}
            //catch (Exception ex)
            //{
            //    return tempstring;

            //}
        }
        public string ConvertTimespantoFloat1(string observedtime)
        {
            string tempstring = string.Empty;
            //try
            //{
            //    tempstring = Convert.ToString(Math.Round(Convert.ToDouble(observedtime.TotalMinutes), 2));
            //    return tempstring;
            //}
            //catch (Exception ex)
            //{
            //    return tempstring;
            //}
            try
            {
                var currentculter = CultureInfo.CurrentCulture;
                string culterseparator = currentculter.NumberFormat.NumberDecimalSeparator.ToString();
                string[] tempDaysHours;
                int tempDays = 0;
                int tempHours = 0;


                string[] NormaltimeArr = new string[2];
                int nt1 = 0;
                int nt2 = 0;
                int nt3 = 0;
                if (observedtime.Contains(":"))
                {
                    NormaltimeArr = observedtime.Split(':');
                    #region [GEOS2-3882][Rupali Sarode][14-11-2022]
                    if (NormaltimeArr[0].Contains(culterseparator))
                    {
                        tempDaysHours = NormaltimeArr[0].Split(Convert.ToChar(culterseparator));
                        if (tempDaysHours.Count() > 0)
                        {
                            tempHours = Convert.ToInt32(tempDaysHours[0]) * 24 + Convert.ToInt32(tempDaysHours[1]);
                            nt1 = tempHours;
                        }
                    }
                    else
                    {
                        nt1 = int.Parse(NormaltimeArr[0]);
                    }
                    #endregion [GEOS2-3882][Rupali Sarode][14-11-2022]

                    nt2 = int.Parse(NormaltimeArr[1]);
                    nt3 = int.Parse(NormaltimeArr[2]);
                    nt1 = (nt1 * 60) + nt2;
                }
                //string tempstring = string.Empty;
                if (Convert.ToString(nt3).Length == 1)
                {
                    tempstring = Convert.ToString(nt1) + culterseparator + "0" + Convert.ToString(nt3);
                }
                else
                {
                    tempstring = Convert.ToString(nt1) + culterseparator + Convert.ToString(nt3);
                }
                #region GEOS2-3954 Time format HH:MM:SS
                //int TempOTDay = observedtime.Days;
                //int TempOTHours = observedtime.Hours;
                //int TempOTminute = observedtime.Minutes;
                //int TempOTSecond = observedtime.Seconds;
                //string tempstring = Convert.ToString(((TempOTDay  24) + TempOTHours)  60 + TempOTminute) + "." + TempOTSecond;
                //float tempfloat = float.Parse(tempstring);
                // float tempfloat = float.Parse(Convert.ToString(UITempobservedTime.TotalMinutes));
                //ObservedTime = tempfloat;

                //int TempNTDay = UITempNormalTime.Days;
                //int TempNTHours = UITempNormalTime.Hours;
                //int TempNTminute = UITempNormalTime.Minutes;
                //int TempNTSecond = UITempNormalTime.Seconds;
                //string tempNTstring = Convert.ToString(((TempNTDay  24) + TempNTHours)  60 + TempNTminute) + "." + TempNTSecond;
                //float tempNTfloat = float.Parse(tempNTstring);
                // NormalTime = tempNTfloat;
                #endregion
                return tempstring;
            }
            catch (Exception ex)
            {
                return tempstring;

            }
        }
        #endregion

        #region GEOS2-4033 Spare Part Gulab Lakade
        private List<ERMSOPSpareParts> tempWorkOperationClonedSpareParts = new List<ERMSOPSpareParts>();

        private string selectedItemSparePartGroup;
        public string SelectedItemSparePartGroup
        {
            get
            {
                return selectedItemSparePartGroup;
            }
            set
            {
                selectedItemSparePartGroup = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedItemSparePartGroup"));
            }
        }
        private Visibility isAccordionControlVisibleSpareparts;
        public Visibility IsAccordionControlVisibleSpareparts
        {
            get { return isAccordionControlVisibleSpareparts; }
            set
            {
                isAccordionControlVisibleSpareparts = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsAccordionControlVisibleSpareparts"));
            }
        }

        private List<ERMSparePartsGroups> sparePartsGroups;
        public List<ERMSparePartsGroups> SparePartsGroups
        {
            get { return sparePartsGroups; }
            set
            {
                sparePartsGroups = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SparePartsGroups"));
            }
        }

        private object selectedItemOldSparePart;
        public virtual object SelectedItemOldSparePart
        {
            get { return selectedItemOldSparePart; }
            set
            {
                selectedItemOldSparePart = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedItemOldSparePart"));
            }
        }

        private object selectedItemSparePart;
        public virtual object SelectedItemSparePart
        {
            get { return selectedItemSparePart; }
            set
            {
                selectedItemSparePart = value;
                #region [GEOS2-4830][gulab lakade][07 12 2023]
                if (selectedItemSparePart != null)
                {
                    //string tempobj = Convert.ToString(selectedItemSparePart);
                    //var temp = SparePartsGroups.Where(x => tempobj.Contains(x.Name)).ToList();
                    //if(temp.Count()==0)
                    //{
                    RetrieveWorkOperationsBySparePart();
                    //}

                }
                #endregion
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedItemSparePart"));
            }
        }

        ObservableCollection<DetectionGroupWithSpareParts> detectionGroupWithSpareParts;
        public ObservableCollection<DetectionGroupWithSpareParts> DetectionGroupWithSpareParts
        {
            get { return detectionGroupWithSpareParts; }
            set
            {
                detectionGroupWithSpareParts = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DetectionGroupWithSpareParts"));
            }
        }

        private object selectedItemOldcloneSparePart;
        public virtual object SelectedItemOldcloneSparePart
        {
            get { return selectedItemOldcloneSparePart; }
            set
            {
                selectedItemOldcloneSparePart = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedItemOldcloneSparePart"));
            }
        }

        ObservableCollection<ERMSOPSpareParts> sparePartsMenulist;
        public ObservableCollection<ERMSOPSpareParts> SparePartsMenulist
        {
            get { return sparePartsMenulist; }
            set
            {
                sparePartsMenulist = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SparePartsMenulist"));
            }
        }

        ERMSOPSpareParts selectedSparePartsMenuItem;
        public ERMSOPSpareParts SelectedSparePartsMenuItem
        {
            get { return selectedSparePartsMenuItem; }
            set
            {
                selectedSparePartsMenuItem = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedSparePartsMenuItem"));
            }
        }



        ObservableCollection<ERMSOPSpareParts> sparePartMenulistCloned;
        public ObservableCollection<ERMSOPSpareParts> SparePartMenulistCloned
        {
            get { return sparePartMenulistCloned; }
            set
            {
                sparePartMenulistCloned = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SparePartMenulistCloned"));
            }
        }
        ObservableCollection<WorkOperationByStages> operationMenuSparePartlistCloned = new ObservableCollection<WorkOperationByStages>();

        private WorkOperationByStages selectedSparePartWorkOperationMenulist;
        public WorkOperationByStages SelectedSparePartWorkOperationMenulist
        {
            get { return selectedSparePartWorkOperationMenulist; }
            set
            {
                selectedSparePartWorkOperationMenulist = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedSparePartWorkOperationMenulist"));
            }

        }
        private ObservableCollection<WorkOperationByStages> workOperationSparePartMenulist;
        public ObservableCollection<WorkOperationByStages> WorkOperationSparePartMenulist
        {
            get
            {
                return workOperationSparePartMenulist;
            }

            set
            {
                workOperationSparePartMenulist = value;
                OnPropertyChanged(new PropertyChangedEventArgs("WorkOperationSparePartMenulist"));
            }
        }

        private ObservableCollection<TreeListColumn> columnsSparePartForSupplements;
        public ObservableCollection<TreeListColumn> ColumnsSparePartForSupplements
        {
            get { return columnsSparePartForSupplements; }
            set
            {
                columnsSparePartForSupplements = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ColumnsSparePartForSupplements"));
            }
        }

        private ObservableCollection<TreeListColumn> columnsSparePartOperationTime;
        public ObservableCollection<TreeListColumn> ColumnsSparePartOperationTime
        {
            get { return columnsSparePartOperationTime; }
            set
            {
                columnsSparePartOperationTime = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ColumnsSparePartOperationTime"));
            }
        }
        private void HideSparePartPanel(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method HideSparePartPanel ...", category: Category.Info, priority: Priority.Low);

                if (IsAccordionControlVisibleSpareparts == Visibility.Collapsed)
                    IsAccordionControlVisibleSpareparts = Visibility.Visible;
                else
                    IsAccordionControlVisibleSpareparts = Visibility.Collapsed;
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method HideSparePartPanel()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        // changes check

        List<StandardOperationsDictionarySparePart> tempLstStandardOperationsDictionarySparePart = new List<StandardOperationsDictionarySparePart>();
        ObservableCollection<ERMSOPSpareParts> SparePartList = new ObservableCollection<ERMSOPSpareParts>();
        ObservableCollection<WorkOperationByStages> operationSparePartMenulist = new ObservableCollection<WorkOperationByStages>();
        int duplicateItemloopSparePart = 0;
        private void RetrieveWorkOperationsBySparePart()
        {
            Saveselecteditem = "SparePart";
            GeosApplication.Instance.Logger.Log("Method RetrieveWorkOperationsBySparePart()...", category: Category.Info, priority: Priority.Low);
            if (!DXSplashScreen.IsActive)
            {
                DXSplashScreen.Show(x =>
                {
                    Window win = new Window()
                    {
                        ShowActivated = false,
                        WindowStyle = WindowStyle.None,
                        ResizeMode = ResizeMode.NoResize,
                        AllowsTransparency = true,
                        Background = new SolidColorBrush(Colors.Transparent),
                        ShowInTaskbar = false,
                        Topmost = true,
                        SizeToContent = SizeToContent.WidthAndHeight,
                        WindowStartupLocation = WindowStartupLocation.CenterScreen,
                    };
                    WindowFadeAnimationBehavior.SetEnableAnimation(win, true);
                    win.Topmost = false;
                    return win;
                }, x =>
                {
                    return new SplashScreenView() { DataContext = new SplashScreenViewModel() };
                }, null, null);
            }
            if (ISSavechanges == true)
            {
                return;
            }
            if (IsEnabledSaveButton && SaveButtonVisibility == Visibility.Visible)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                MessageBoxResult MessageBoxResult = MessageBoxResult = CustomMessageBox.Show(string.Format(Application.Current.Resources["ArticleGridUpdateWarning"].ToString()), "Yellow", CustomMessageBox.MessageImagePath.Warning, MessageBoxButton.YesNo);
                if (MessageBoxResult == MessageBoxResult.Yes)
                {
                    if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }
                    ISSavechanges = true;
                    IsEnabledSaveButton = false;
                    SelectedItemOldcloneSparePart = SelectedItemSparePart;
                    SelectedItemSparePart = SelectedItemOldSparePart;
                    var tempSelectedItemSparePart = SelectedItemOldcloneSparePart;
                    SaveButtonCommandAction();
                    ISSavechanges = false;
                    SelectedItemSparePart = tempSelectedItemSparePart;
                    if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }

                    SelectedItem = SelectedItemOld;
                    if (SelectedItemOldclone != null)
                        SelectedItem = SelectedItemOldclone;

                    SelectedItemDetection = SelectedItemOldDetection;
                    if (SelectedItemOldcloneDetection != null)
                        SelectedItemDetection = SelectedItemOldcloneDetection;

                    ////GEOS2-3838 -Way
                    SelectedItemWay = SelectedItemOldWay;
                    if (SelectedItemOldcloneWay != null)
                        SelectedItemWay = SelectedItemOldcloneWay;

                    //[GEOS2-3601] - Structure
                    SelectedItemStructures = SelectedItemOldStructure;
                    if (SelectedItemOldcloneStructure != null)
                        SelectedItemStructures = SelectedItemOldcloneStructure;

                    SelectedItemOption = SelectedItemOldOption;
                    if (SelectedItemOldcloneOption != null)
                        SelectedItemOption = SelectedItemOldcloneOption;

                }
                #region [GEOS2-3925][Rupali Sarode][29-11-2022]
                if (MessageBoxResult == MessageBoxResult.No)
                {
                    TmpModuleMenulist = null;
                    TmpDetectionMenulist = null;
                    TmpOptionMenulist = null;
                    TmpStructureMenulist = null;
                    TmpWayMenulist = null;
                    TmpSparePartsMenulist = null;
                    TmpIdCPType = 0;
                    TmpIdDetection = 0; //[GEOS2-3922][Rupali Sarode][07-11-2022]
                    TmpIdOption = 0;
                    TmpIdWayType = 0;
                    TmpIdStructure = 0;
                    TmpIdSpareParts = 0;
                }
                #endregion

            }
            if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
            if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }
            ObservableCollection<ERMSOPSpareParts> SparePartsMenulistTemp = new ObservableCollection<ERMSOPSpareParts>();//[GEOS2-4830][gulab lakade][07 12 2023]
            SelectedItemOldSparePart = SelectedItemSparePart;
            IsEnabledSaveButton = false;
            ModuleMenulistupdated = new ObservableCollection<ERMSOPModule>();
            try
            {

                if (SelectedItemSparePart is ERMSpareParts)
                {

                    ERMSpareParts ermSpareParts = (ERMSpareParts)SelectedItemSparePart;
                    //DetectionMenulist = null;

                    List<StandardOperationsDictionarySparePart> tempStandardOperationsDictionarySparePart = tempLstStandardOperationsDictionarySparePart.Where(w => w.IdDetection == Convert.ToUInt64(ermSpareParts.IdDetection)).ToList();
                    SparePartsMenulist = new ObservableCollection<ERMSOPSpareParts>();
                    operationSparePartMenulist = new ObservableCollection<WorkOperationByStages>();
                    duplicateItemloopSparePart = 0;
                    duplicateItemloop = 0;
                    if (tempStandardOperationsDictionarySparePart.Count() > 0)
                    {
                        foreach (var eRMSOPSparePart in tempStandardOperationsDictionarySparePart)
                        {
                            if (eRMSOPSparePart != null)
                            {
                                List<WorkOperationByStages> tempSparePartList = WorkOperationMenulist.Where(w => w.IdworkOperationByStage == Convert.ToInt32(eRMSOPSparePart.IdWorkoperation) && w.Name == eRMSOPSparePart.WorkOperationName).ToList();  //[Cut  work operation not work properly.][gulab lakade][24 01 2023]
                                if (tempSparePartList != null)
                                    foreach (WorkOperationByStages item in tempSparePartList)
                                    {
                                        if (item.IdStatus == 1536)//[gulablakade][10.08.2022][GEOS2-3837]
                                        {
                                            item.IsInactiveWorkOperation = true;
                                            item.IsReadOnly = true;
                                        }
                                        WorkOperationByStages ParentName = WorkOperationMenulist.Where(w => w.KeyName.Equals(item.ParentName)).FirstOrDefault();
                                        if (ParentName != null)
                                        {
                                            if (!operationSparePartMenulist.Any(a => a.KeyName.Equals(ParentName.KeyName)))
                                                operationSparePartMenulist.Add(ParentName);
                                        }
                                        duplicateItemloopSparePart = 0;
                                        duplicateItemloop = 0;
                                        GetAllTreeListSparePart(item, WorkOperationMenulist);
                                    }

                            }

                        }
                    }
                    #region ModuleMenulist
                    WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                    #region [GEOS2-4830][gulab lakade][07 12 2023]
                    if (AllSupplementsBoxMenu != null)
                    {
                        var listadoDuplicadas = from c in AllSupplementsBoxMenu
                                                join c2 in AllSupplementsBoxMenu on c.Item2 equals c2.Item2
                                                where c != c2
                                                select c;

                        var SparePartSandardOperationTime = listadoDuplicadas.FirstOrDefault();
                        if (SparePartSandardOperationTime != null)
                        {
                            var templist = listadoDuplicadas.Where(a => a.Item2 == SparePartSandardOperationTime.Item2);
                            listadoDuplicadas = templist;
                        }

                        var tempSupplementsBoxMenu = AllSupplementsBoxMenu;

                        ColumnsSparePartForSupplements = new ObservableCollection<TreeListColumn>();
                        ColumnsSparePartForSupplements.Add(new TreeListColumn()
                        {
                            FieldName = "SparePartStandardSupplements",
                            Header = "Standard",
                            HeaderToolTip = "Standard",
                            AllowCellMerge = false,
                            Width = 150,    //gulab lakade not show supplement proper
                            AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                            Visible = true,
                            ReadOnly = false,
                            FixedWidth = false
                        });

                        ColumnsSparePartOperationTime = new ObservableCollection<TreeListColumn>();
                        ColumnsSparePartOperationTime.Add(new TreeListColumn()
                        {
                            FieldName = "UiTempStandardOperationTimeName",
                            Header = "Standard",
                            HeaderToolTip = "Standard",
                            AllowCellMerge = false,
                            Width = 150,    //not show StandardOperationTime proper
                            AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                            Visible = true,
                            ReadOnly = false,
                            FixedWidth = false
                        });

                        int Supplimentcount = 1;
                        var ColumnsSparePartList = tempSupplementsBoxMenu.Where(p => !listadoDuplicadas.Any(p2 => p2.Item1 == p.Item1));
                        foreach (var item in ColumnsSparePartList)
                        {
                            if (Supplimentcount == 5)
                            {
                                ColumnsSparePartForSupplements.Add(new TreeListColumn()
                                {
                                    FieldName = "SparePartSupplementPlant" + Supplimentcount + "Value",
                                    Header = "Others",
                                    HeaderToolTip = "Others",
                                    AllowCellMerge = false,
                                    Width = 60,
                                    AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                    Visible = true,
                                    ReadOnly = false,
                                    FixedWidth = false
                                });
                                ColumnsSparePartOperationTime.Add(new TreeListColumn()
                                {
                                    FieldName = "UiTempoperationTimePlant" + Supplimentcount + "Value",
                                    Header = "Others",
                                    HeaderToolTip = "Others",
                                    AllowCellMerge = false,
                                    Width = 60,
                                    AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                    Visible = true,
                                    ReadOnly = false,
                                    FixedWidth = false
                                });
                                break;
                            }
                            if (Supplimentcount == 5)
                            {
                                break;
                            }
                            ColumnsSparePartForSupplements.Add(new TreeListColumn()
                            {
                                FieldName = "SparePartSupplementPlant" + Supplimentcount + "Value",
                                Header = item.Item1,
                                HeaderToolTip = item.Item1,
                                AllowCellMerge = false,
                                Width = 60,
                                AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                Visible = true,
                                ReadOnly = false,
                                FixedWidth = false
                            });

                            ColumnsSparePartOperationTime.Add(new TreeListColumn()
                            {
                                FieldName = "UiTempoperationTimePlant" + Supplimentcount + "Value",
                                Header = item.Item1,
                                HeaderToolTip = item.Item1,
                                AllowCellMerge = false,
                                Width = 60,
                                AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                Visible = true,
                                ReadOnly = false,
                                FixedWidth = false
                            });
                            Supplimentcount = Supplimentcount + 1;
                        }
                        #endregion
                        bool FlagAddItemModule = false; //[GEOS2-5135][Rupali Sarode][18-12-2023]

                        foreach (WorkOperationByStages Module in operationSparePartMenulist)
                        {
                            FlagAddItemModule = true; //[GEOS2-5135][Rupali Sarode][18-12-2023]

                            if (operationSparePartMenulist.Any(a => a.IdworkOperationByStage == Convert.ToInt64(Module.IdworkOperationByStage))
                                && operationSparePartMenulist.Any(a => a.Name.Trim().Equals(Module.Name.Trim()))
                                )
                            {
                                StandardOperationsDictionarySparePart standardOperationsDictionarySparePart = tempLstStandardOperationsDictionarySparePart.Where(w => w.IdWorkoperation == Convert.ToUInt64(Module.IdworkOperationByStage) && Module.Parent != null
                                && w.IdDetection == Convert.ToUInt64(ermSpareParts.IdDetection)).FirstOrDefault();
                                #region  [GEOS2-5135][Rupali Sarode][18-12-2023]
                                // If it is child & only active then add
                                List<WorkOperationByStages> childListInActiveDraft = operationSparePartMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(Module.KeyName)).ToList();

                                if (childListInActiveDraft.Count == 0)
                                {
                                    if (Module.IdStatus == 1535)
                                    {
                                        FlagAddItemModule = true;
                                    }
                                    else
                                        FlagAddItemModule = false;
                                }
                                else // If it is parent and does not contain any active child, then do not include it
                                if (childListInActiveDraft.Count > 0)
                                {
                                    //List<WorkOperationByStages> childListInParent = operationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(Module.KeyName)).ToList();
                                    foreach (WorkOperationByStages objChild in childListInActiveDraft)
                                    {
                                        List<WorkOperationByStages> GrandChildListInActiveDraft = new List<WorkOperationByStages>();
                                        GrandChildListInActiveDraft = operationSparePartMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(objChild.KeyName)).ToList();
                                        if (GrandChildListInActiveDraft.Count == 0)
                                        { // If it is child and Active
                                            if (objChild.IdStatus == 1535)
                                            {
                                                FlagAddItemModule = true;
                                                break;
                                            }
                                            else
                                            {
                                                FlagAddItemModule = false;
                                            }

                                        }
                                        else
                                        {
                                            if (GrandChildListInActiveDraft.Count > 0)
                                            {
                                                if (GrandChildListInActiveDraft.Where(i => i.IdStatus == 1535).Count() > 0)
                                                {
                                                    FlagAddItemModule = true;
                                                    break;
                                                }
                                                else
                                                {
                                                    FlagAddItemModule = false;
                                                }
                                            }
                                        }
                                    }
                                }
                                #endregion  [GEOS2-5135][Rupali Sarode][18-12-2023]
                                if (FlagAddItemModule == true)  //[GEOS2-5135][Rupali Sarode][18-12-2023]
                                { //[GEOS2-5135][Rupali Sarode][18-12-2023]

                                    ERMSOPSpareParts eRMSOPSparePart = new ERMSOPSpareParts();
                                    if (standardOperationsDictionarySparePart != null)
                                        eRMSOPSparePart.IdDetection = standardOperationsDictionarySparePart.IdDetection;
                                    eRMSOPSparePart.Name = Module.Name;
                                    eRMSOPSparePart.IdworkOperationByStage = Module.IdworkOperationByStage;
                                    eRMSOPSparePart.IdSequence = Module.IdSequence;
                                    eRMSOPSparePart.IdStatus = Module.IdStatus;
                                    eRMSOPSparePart.Status = Module.Status;
                                    eRMSOPSparePart.Code = Module.Name;
                                    eRMSOPSparePart.Parent = Module.Parent;
                                    eRMSOPSparePart.IdParent = Module.IdParent;
                                    eRMSOPSparePart.KeyName = Module.KeyName;
                                    eRMSOPSparePart.ParentName = Module.ParentName;
                                    #region [GEOS2-5629][gulab lakade][15 07 2024]
                                    if (standardOperationsDictionarySparePart != null)
                                    {
                                        eRMSOPSparePart.Position = Convert.ToUInt32(standardOperationsDictionarySparePart.Position);
                                        eRMSOPSparePart.SparepartPosition = Convert.ToUInt32(standardOperationsDictionarySparePart.Position);//[GEOS2-5629][gulab lakade][10 07 2024]

                                    }
                                    else
                                    {
                                        eRMSOPSparePart.Position = Module.Position;
                                        eRMSOPSparePart.SparepartPosition = Module.Position; //[GEOS2-5629][gulab lakade][10 07 2024]
                                    }
                                    #endregion

                                    eRMSOPSparePart.WorkOperation_count = Module.WorkOperation_count;
                                    eRMSOPSparePart.WorkOperation_count_original = Module.WorkOperation_count_original;
                                    eRMSOPSparePart.NameWithWorkOperationCount = Module.NameWithWorkOperationCount;

                                    eRMSOPSparePart.IsInactiveWorkOperation = Module.IsInactiveWorkOperation;
                                    eRMSOPSparePart.IsReadOnly = Module.IsReadOnly;

                                    if (!GetStages.Any(a => a.Code.Equals(eRMSOPSparePart.Name)))
                                    {
                                        var tempActivity = tempLstStandardOperationsDictionarySparePart.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPSparePart.IdworkOperationByStage)
                                         && w.IdDetection == Convert.ToUInt64(eRMSOPSparePart.IdDetection)).Select(s => s.Activity).DefaultIfEmpty(null).FirstOrDefault();
                                        var tempObservedTime = tempLstStandardOperationsDictionarySparePart.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPSparePart.IdworkOperationByStage)
                                         && w.IdDetection == Convert.ToUInt64(eRMSOPSparePart.IdDetection)).Select(s => s.ObservedTime).DefaultIfEmpty(null).FirstOrDefault();
                                        #region Geos2 4078 SparePart Store/ Save in the SDO tables the Observed time, Activity

                                        var tempSparepart = tempLstStandardOperationsDictionarySparePart.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPSparePart.IdworkOperationByStage)
                                        && w.IdDetection == Convert.ToUInt64(eRMSOPSparePart.IdDetection)).FirstOrDefault();

                                        if (tempSparepart != null)
                                        {
                                            if (tempSparepart.IdWorkoperation == Convert.ToUInt64(eRMSOPSparePart.IdworkOperationByStage) && (tempSparepart.Activity == null || tempSparepart.Activity == 0))
                                            {
                                                tempActivity = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == Module.IdworkOperationByStage && a.KeyName == Module.KeyName).Select(b => b.Activity).FirstOrDefault(); //[Cut  work operation not work properly.][gulab lakade][24 01 2023]
                                            }
                                            if (tempSparepart.IdWorkoperation == Convert.ToUInt64(eRMSOPSparePart.IdworkOperationByStage) && (tempSparepart.ObservedTime == null || tempSparepart.ObservedTime == 0))
                                            {
                                                tempObservedTime = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == Module.IdworkOperationByStage && a.KeyName == Module.KeyName).Select(b => b.ObservedTime).FirstOrDefault(); //[Cut  work operation not work properly.][gulab lakade][24 01 2023]
                                            }
                                        }
                                        #endregion
                                        if (tempActivity != null)
                                            eRMSOPSparePart.SparePartActivity = Math.Round((double)tempActivity, 2);


                                        if (tempObservedTime != null)
                                        {
                                            eRMSOPSparePart.SparePartObservedTime = Math.Round((double)tempObservedTime, 2);
                                            #region [GEOS2-3954][Rupali Sarode]
                                            //eRMSOPSparePart.UITempSparePartObservedTime = ConvertfloattoTimespan(Convert.ToString (eRMSOPSparePart.SparePartObservedTime));
                                            //    eRMSOPSparePart.UITempSparePartObservedTime = tempLstStandardOperationsDictionarySparePart.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPSparePart.IdworkOperationByStage)
                                            //&& w.IdDetection == Convert.ToUInt64(eRMSOPSparePart.IdDetection)).Select(s => s.UITempSparePartObservedTime).FirstOrDefault();

                                            //eRMSOPSparePart.SparePartNormalTime = Math.Round(Convert.ToDouble(eRMSOPSparePart.SparePartObservedTime * eRMSOPSparePart.SparePartActivity / 100), 2);

                                            #region [GEOS2-5008][gulab lakade][1 11 2023]
                                            //eRMSOPSparePart.UITempSparePartObservedTime = TimeSpan.FromMinutes(Convert.ToDouble(tempObservedTime));
                                            eRMSOPSparePart.UITempSparePartObservedTime = ConvertfloattoTimespan(Convert.ToString(Convert.ToDouble(tempObservedTime)));
                                            #endregion
                                            #endregion
                                        }


                                        eRMSOPSparePart.SparePartNormalTime = Math.Round(Convert.ToDouble(eRMSOPSparePart.SparePartObservedTime * eRMSOPSparePart.SparePartActivity / 100), 2);
                                        #region [GEOS2-3954][Rupali Sarode]
                                        eRMSOPSparePart.UITempSparePartNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(eRMSOPSparePart.SparePartNormalTime));
                                        #endregion


                                        //[GEOS2-3933][Rupali Sarode][22/09/2022]
                                        eRMSOPSparePart.WORemarks = Module.WORemarks == null ? "" : Module.WORemarks.Trim();

                                        //[GEOS2-3933][Rupali Sarode][26/09/2022]
                                        var tempRemarks = tempLstStandardOperationsDictionarySparePart.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPSparePart.IdworkOperationByStage)
                                        && w.IdDetection == Convert.ToUInt64(eRMSOPSparePart.IdDetection)).Select(s => s.Remarks).DefaultIfEmpty(null).FirstOrDefault();

                                        eRMSOPSparePart.Remarks = tempRemarks == null ? "" : tempRemarks.Trim();
                                    }


                                    if (GetStages.Any(a => a != null && a.Code.Trim().Equals(Module.Name.Trim())))
                                    {
                                        eRMSOPSparePart.IsDeleteButton = false;
                                        eRMSOPSparePart.IsDeleteButtonVisibility = Visibility.Hidden;
                                        eRMSOPSparePart.IsReadOnly = true;
                                        eRMSOPSparePart.IsValidateOnTextInput = false;
                                        Module.IsCurrentWorkOperation = true;
                                    }
                                    else
                                    {
                                        Module.IsCurrentWorkOperation = true;
                                        eRMSOPSparePart.IsReadOnly = false;
                                        eRMSOPSparePart.IsValidateOnTextInput = true;
                                    }
                                    if (Module.IdStatus == 1536)
                                    {
                                        eRMSOPSparePart.IsInactiveWorkOperation = true;
                                        eRMSOPSparePart.IsReadOnly = true;
                                    }
                                    #region [GEOS2-4830][gulab lakade][07 12 2023]
                                    if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(eRMSOPSparePart.Name.Trim())))
                                    {
                                        if (SparePartSandardOperationTime != null)
                                            eRMSOPSparePart.SparePartStandardSupplements = (float?)SparePartSandardOperationTime.Item2;
                                        if (tempSupplementsBoxMenu.Any(p => !listadoDuplicadas.Any(p2 => p2.Item1 == p.Item1)))
                                        {
                                            eRMSOPSparePart.AllSupplementsBoxMenu = AllSupplementsBoxMenu;
                                            List<float?> lst = new List<float?>();

                                            var a = ColumnsSparePartList.ToList();
                                            for (int i = 0; i < a.Count(); i++)
                                            {
                                                lst.Add((float?)a[i].Item2);
                                            }

                                            if (ColumnsSparePartList.Count() == 1)
                                            {
                                                eRMSOPSparePart.SparePartSupplementPlant1Value = (float?)lst[0];
                                            }
                                            else if (ColumnsSparePartList.Count() == 2)
                                            {
                                                eRMSOPSparePart.SparePartSupplementPlant1Value = (float?)lst[0];
                                                eRMSOPSparePart.SparePartSupplementPlant2Value = (float?)lst[1];
                                            }
                                            else if (ColumnsSparePartList.Count() == 3)
                                            {
                                                eRMSOPSparePart.SparePartSupplementPlant1Value = (float?)lst[0];
                                                eRMSOPSparePart.SparePartSupplementPlant2Value = (float?)lst[1];
                                                eRMSOPSparePart.SparePartSupplementPlant3Value = (float?)lst[2];
                                            }
                                            else if (ColumnsSparePartList.Count() == 4)
                                            {
                                                eRMSOPSparePart.SparePartSupplementPlant1Value = (float?)lst[0];
                                                eRMSOPSparePart.SparePartSupplementPlant2Value = (float?)lst[1];
                                                eRMSOPSparePart.SparePartSupplementPlant3Value = (float?)lst[2];
                                                eRMSOPSparePart.SparePartSupplementPlant4Value = (float?)lst[3];
                                            }
                                            else if (ColumnsSparePartList.Count() == 5)
                                            {
                                                eRMSOPSparePart.SparePartSupplementPlant1Value = (float?)lst[0];
                                                eRMSOPSparePart.SparePartSupplementPlant2Value = (float?)lst[1];
                                                eRMSOPSparePart.SparePartSupplementPlant3Value = (float?)lst[2];
                                                eRMSOPSparePart.SparePartSupplementPlant4Value = (float?)lst[3];
                                                eRMSOPSparePart.SparePartSupplementPlant5Value = (float?)lst[4];
                                            }
                                            else
                                            {
                                                eRMSOPSparePart.SparePartSupplementPlant1Value = (float?)lst[0];
                                                eRMSOPSparePart.SparePartSupplementPlant2Value = (float?)lst[1];
                                                eRMSOPSparePart.SparePartSupplementPlant3Value = (float?)lst[2];
                                                eRMSOPSparePart.SparePartSupplementPlant4Value = (float?)lst[3];
                                                eRMSOPSparePart.SparePartSupplementPlant5Value = 0;
                                                if (ColumnsSparePartList.Count() > 5)
                                                {
                                                    for (int q = 4; q < ColumnsSparePartList.Count(); q++)
                                                    {
                                                        if (eRMSOPSparePart.SparePartSupplementPlant5Value == null)
                                                            eRMSOPSparePart.SparePartSupplementPlant5Value = 0;
                                                        eRMSOPSparePart.SparePartSupplementPlant5Value = eRMSOPSparePart.SparePartSupplementPlant5Value + (float?)lst[q];
                                                    }
                                                }


                                            }

                                        }

                                        if (SparePartSandardOperationTime != null)
                                            eRMSOPSparePart.SparePartStandardOperationTime = (float?)Math.Round(Convert.ToDouble(eRMSOPSparePart.SparePartNormalTime * (1 + (SparePartSandardOperationTime.Item2 / 100))), 2);

                                        eRMSOPSparePart.SparePartOperationTimePlant1Value = (float?)Math.Round(Convert.ToDouble(eRMSOPSparePart.SparePartNormalTime * (1 + (Convert.ToDouble(eRMSOPSparePart.SparePartSupplementPlant1Value) / 100))), 2);
                                        eRMSOPSparePart.SparePartOperationTimePlant2Value = (float?)Math.Round(Convert.ToDouble(eRMSOPSparePart.SparePartNormalTime * (1 + (Convert.ToDouble(eRMSOPSparePart.SparePartSupplementPlant2Value) / 100))), 2);
                                        eRMSOPSparePart.SparePartOperationTimePlant3Value = (float?)Math.Round(Convert.ToDouble(eRMSOPSparePart.SparePartNormalTime * (1 + (Convert.ToDouble(eRMSOPSparePart.SparePartSupplementPlant3Value) / 100))), 2);
                                        eRMSOPSparePart.SparePartOperationTimePlant4Value = (float?)Math.Round(Convert.ToDouble(eRMSOPSparePart.SparePartNormalTime * (1 + (Convert.ToDouble(eRMSOPSparePart.SparePartSupplementPlant4Value) / 100))), 2);
                                        eRMSOPSparePart.SparePartOperationTimePlant5Value = (float?)Math.Round(Convert.ToDouble(eRMSOPSparePart.SparePartNormalTime * (1 + (Convert.ToDouble(eRMSOPSparePart.SparePartSupplementPlant5Value) / 100))), 2);
                                        #region GEOS2-3954 Show the WorkOperations and SOD Time in the format: MM:SS or HH:MM:SS
                                        try
                                        {
                                            eRMSOPSparePart.UiTempStandardOperationTimeName = ConvertfloattoTimespan(Convert.ToString(eRMSOPSparePart.SparePartStandardOperationTime));
                                            eRMSOPSparePart.UiTempoperationTimePlant1Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPSparePart.SparePartOperationTimePlant1Value));
                                            eRMSOPSparePart.UiTempoperationTimePlant2Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPSparePart.SparePartOperationTimePlant2Value));
                                            eRMSOPSparePart.UiTempoperationTimePlant3Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPSparePart.SparePartOperationTimePlant3Value));
                                            eRMSOPSparePart.UiTempoperationTimePlant4Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPSparePart.SparePartOperationTimePlant4Value));
                                            eRMSOPSparePart.UiTempoperationTimePlant5Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPSparePart.SparePartOperationTimePlant5Value));
                                        }
                                        catch (Exception ex)
                                        {
                                            GeosApplication.Instance.Logger.Log(string.Format("Error in Method RetrieveWorkOperationsBySparePart() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                        }
                                        #endregion
                                    }

                                    #endregion
                                    try
                                    {
                                        if (!SparePartsMenulistTemp.Any(a => a.KeyName.Equals(Module.KeyName)))
                                            SparePartsMenulistTemp.Add(eRMSOPSparePart);
                                    }
                                    catch (Exception ex)
                                    {

                                    }
                                } //[GEOS2-5135][Rupali Sarode][18-12-2023]

                            }
                        }
                    }//[GEOS2-4830][gulab lakade][07 12 2023]

                    #region GEOS2-3860 Rupali Sarode
                    //var tempWorkOperationMenulist2 = SparePartsMenulistTemp.OrderBy(x => x.Position).ToList();
                    var tempWorkOperationMenulist2 = SparePartsMenulistTemp.OrderBy(x => x.SparepartPosition).ToList();//[GEOS2-5629][gulab lakade][15 07 2024]
                    tempWorkOperationClonedSpareParts = new List<ERMSOPSpareParts>();
                    tempWorkOperationClonedSpareParts.AddRange(tempWorkOperationMenulist2);
                    #endregion

                    //List<ERMSOPSpareParts> tempWorkOperationSparePartMenulist = SparePartsMenulistTemp.OrderBy(x => x.Position).ToList();
                    List<ERMSOPSpareParts> tempWorkOperationSparePartMenulist = SparePartsMenulistTemp.OrderBy(x => x.SparepartPosition).ToList();//[GEOS2-5629][gulab lakade][15 07 2024]
                    SparePartsMenulistTemp.Clear();
                    SparePartsMenulistTemp.AddRange(tempWorkOperationSparePartMenulist);
                    tempWorkOperationSparePartMenulist.Clear();
                    if (SparePartsMenulistTemp != null)
                    {
                        var tempSparePartMenulist = SparePartsMenulistTemp.ToList();
                        for (int i = 0; i < tempSparePartMenulist.Count; i++)
                        {
                            if (GetStages.Any(a => a.Code.Equals(tempSparePartMenulist[i].Name)))
                            {
                                List<ERMSOPSpareParts> childList = SparePartsMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(tempSparePartMenulist[i].KeyName)).ToList();
                                if (childList.Count == 0)
                                {
                                    List<WorkOperationByStages> tempWOList = WorkOperationMenulist.Where(w => w.KeyName == tempSparePartMenulist[i].KeyName).ToList();
                                    if (tempWOList != null)
                                        tempWOList.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                                    SparePartsMenulistTemp.Remove(tempSparePartMenulist[i]);
                                }
                            }
                        }
                    }
                    #endregion
                }
                #region TemplateWithCPTypes
                else if (SelectedItemSparePart is DetectionGroupWithSpareParts)
                {
                    SparePartsMenulistTemp = null;
                    workOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                    #region GEOS2-3860 Rupali Sarode
                    SelectedItemSparePartGroup = Convert.ToString(SelectedItemSparePart.ToString());
                    #endregion
                }
                #endregion
                #region RND
                #region calculation
                #region [GEOS2-4830][gulab lakade][07 12 2023]
                //if (SparePartsMenulistTemp != null)
                //    //foreach (ERMSOPDetection itemERMSOPDetection in DetectionMenulist)
                //    for (int d = 0; d < SparePartsMenulistTemp.Count(); d++)
                //    {
                //        WorkOperationMenulist.Where(w => w.KeyName == SparePartsMenulistTemp[d].KeyName).ToList().ForEach(f => f.IsCurrentWorkOperation = true);
                //        var listCount = SparePartsMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(SparePartsMenulistTemp[d].KeyName) && w.IsInactiveWorkOperation == false).ToList();
                //        if (listCount != null)
                //            if (listCount.Count() > 0)
                //            {
                //                // decimal a = listCount.Sum(s => s.SparePartObservedTime);

                //                SparePartsMenulistTemp[d].SparePartObservedTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.SparePartObservedTime)), 2);
                //                SparePartsMenulistTemp[d].SparePartNormalTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.SparePartNormalTime)), 2);

                //                //[GEOS2-3954][Rupali Sarode]
                //                SparePartsMenulistTemp[d].UITempSparePartObservedTime = ConvertfloattoTimespan(Convert.ToString(Convert.ToDouble(listCount.Sum(s => s.SparePartObservedTime))));
                //                SparePartsMenulistTemp[d].UITempSparePartNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(Convert.ToDouble(listCount.Sum(s => s.SparePartNormalTime))));

                //                SparePartsMenulistTemp[d].IsReadOnly = true;
                //            }
                //    }
                #endregion
                if (SparePartsMenulistTemp != null)
                    for (int d = 0; d < SparePartsMenulistTemp.Count(); d++)
                    {
                        WorkOperationMenulist.Where(w => w.KeyName == SparePartsMenulistTemp[d].KeyName).ToList().ForEach(f => f.IsCurrentWorkOperation = true);
                        //[GEOS2-5135][Rupali Sarode][19-12-2023]
                        //var listCount = SparePartsMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(SparePartsMenulistTemp[d].KeyName) && w.IsInactiveWorkOperation == false).ToList();
                        var listCount = SparePartsMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(SparePartsMenulistTemp[d].KeyName)).ToList();
                        if (listCount != null)
                            if (listCount.Count() > 0)
                            {
                                SparePartsMenulistTemp[d].SparePartObservedTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.SparePartObservedTime)), 2);
                                SparePartsMenulistTemp[d].SparePartNormalTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.SparePartNormalTime)), 2);

                                //[GEOS2-3954][Rupali Sarode]
                                SparePartsMenulistTemp[d].UITempSparePartObservedTime = ConvertfloattoTimespan(Convert.ToString(listCount.Sum(s => s.SparePartObservedTime)));
                                SparePartsMenulistTemp[d].UITempSparePartNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(listCount.Sum(s => s.SparePartNormalTime)));

                                SparePartsMenulistTemp[d].IsReadOnly = true;
                            }
                    }

                if (SparePartsMenulistTemp != null)
                    //foreach (ERMSOPDetection itemERMSOPDetection in DetectionMenulist)
                    for (int d = 0; d < SparePartsMenulistTemp.Count(); d++)
                    {
                        if (GetStages.Any(a => a.Code.Equals(SparePartsMenulistTemp[d].Name)))
                        {
                            ObservableCollection<ERMSOPSpareParts> ActivitySum = new ObservableCollection<ERMSOPSpareParts>();
                            ObservableCollection<ERMSOPSpareParts> TempActivitySum = new ObservableCollection<ERMSOPSpareParts>();
                            int x = 1;
                            Loop:
                            x++;
                            if (x < 10)
                            {
                                if (ActivitySum.Count == 0)
                                {
                                    SparePartsMenulistTemp[d].SparePartObservedTime = 0;
                                    SparePartsMenulistTemp[d].SparePartNormalTime = 0;

                                    //[GEOS2-3954][Rupali Sarode]
                                    SparePartsMenulistTemp[d].UITempSparePartObservedTime = ConvertfloattoTimespan(Convert.ToString(SparePartsMenulistTemp[d].SparePartObservedTime));
                                    SparePartsMenulistTemp[d].UITempSparePartNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(SparePartsMenulistTemp[d].SparePartNormalTime));
                                    //[GEOS2-5135][Rupali Sarode][18-12-2023]
                                    // var ActivitySumList = SparePartsMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(SparePartsMenulistTemp[d].KeyName) && w.IsInactiveWorkOperation == false).ToList();
                                    var ActivitySumList = SparePartsMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(SparePartsMenulistTemp[d].KeyName)).ToList();
                                    ActivitySum.AddRange(ActivitySumList);
                                }
                                else
                                {
                                    //foreach (var item in ActivitySum)
                                    //{
                                    //    var ActivitySumList = DetectionMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(item.KeyName)).ToList();
                                    //    if (ActivitySumList != null && ActivitySumList.Count > 0)
                                    //    {

                                    //        foreach (var itemActivity in ActivitySumList)
                                    //        {
                                    //            if (!ActivitySum.Any(ac => ac.KeyName.Equals(itemActivity.KeyName)))
                                    //            {
                                    //                TempActivitySum.Add(itemActivity);
                                    //            }

                                    //        }

                                    //    }

                                    //}
                                    //ActivitySum.AddRange(TempActivitySum);
                                }


                                goto Loop;
                            }

                            double? ObservedTime = 0;
                            double? NormalTime = 0;
                            float? StandardTime = 0;
                            float? OperationTimePlant1Value = 0;
                            float? OperationTimePlant2Value = 0;
                            float? OperationTimePlant3Value = 0;
                            float? OperationTimePlant4Value = 0;
                            float? OperationTimePlant5Value = 0;
                            var tempDistinctList = ActivitySum.Select(xa => xa.KeyName).Distinct().ToList();
                            foreach (var item in tempDistinctList)
                            {
                                if (SparePartsMenulistTemp[d].SparePartObservedTime == null)
                                    SparePartsMenulistTemp[d].SparePartObservedTime = 0;
                                double? tempObservedTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.SparePartObservedTime).FirstOrDefault();
                                if (tempObservedTime != null)
                                {
                                    ObservedTime = Math.Round(Convert.ToDouble(ObservedTime + tempObservedTime), 2);
                                    //[GEOS2-3954][Rupali Sarode]
                                    SparePartsMenulistTemp[d].UITempSparePartObservedTime = ConvertfloattoTimespan(Convert.ToString(ObservedTime));
                                }
                                if (SparePartsMenulistTemp[d].SparePartNormalTime == null)
                                    SparePartsMenulistTemp[d].SparePartNormalTime = 0;
                                double? tempNormalTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.SparePartNormalTime).FirstOrDefault();
                                if (tempNormalTime != null)
                                {
                                    NormalTime = Math.Round(Convert.ToDouble(NormalTime + tempNormalTime), 2);
                                    SparePartsMenulistTemp[d].UITempSparePartNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(NormalTime));
                                }

                            }
                            SparePartsMenulistTemp[d].SparePartObservedTime = ObservedTime;
                            SparePartsMenulistTemp[d].SparePartNormalTime = NormalTime;

                            //[GEOS2-3954][Rupali Sarode]
                            SparePartsMenulistTemp[d].UITempSparePartObservedTime = ConvertfloattoTimespan(Convert.ToString(ObservedTime));
                            SparePartsMenulistTemp[d].UITempSparePartNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(NormalTime));

                            //DetectionMenulist[d].DetectionNormalTime = Math.Round(Convert.ToDouble(ObservedTime * DetectionMenulist[d].DetectionActivity / 100), 2);
                            #region PlantValue


                            foreach (var item in tempDistinctList)
                            {
                                if (SparePartsMenulistTemp[d].SparePartStandardOperationTime == null)
                                    SparePartsMenulistTemp[d].SparePartStandardOperationTime = 0;
                                float? tempStandardTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.SparePartStandardOperationTime).FirstOrDefault();
                                if (tempStandardTime != null)
                                    StandardTime = StandardTime + tempStandardTime;

                                if (SparePartsMenulistTemp[d].SparePartOperationTimePlant1Value == null)
                                    SparePartsMenulistTemp[d].SparePartOperationTimePlant1Value = 0;
                                float? tempOperationTimePlant1Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.SparePartOperationTimePlant1Value).FirstOrDefault();
                                if (tempOperationTimePlant1Value != null)
                                    OperationTimePlant1Value = OperationTimePlant1Value + tempOperationTimePlant1Value;

                                if (SparePartsMenulistTemp[d].SparePartOperationTimePlant2Value == null)
                                    SparePartsMenulistTemp[d].SparePartOperationTimePlant2Value = 0;
                                float? tempOperationTimePlant2Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.SparePartOperationTimePlant2Value).FirstOrDefault();
                                if (tempOperationTimePlant2Value != null)
                                    OperationTimePlant2Value = OperationTimePlant2Value + tempOperationTimePlant2Value;

                                if (SparePartsMenulistTemp[d].SparePartOperationTimePlant3Value == null)
                                    SparePartsMenulistTemp[d].SparePartOperationTimePlant3Value = 0;
                                float? tempOperationTimePlant3Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.SparePartOperationTimePlant3Value).FirstOrDefault();
                                if (tempOperationTimePlant3Value != null)
                                    OperationTimePlant3Value = OperationTimePlant3Value + tempOperationTimePlant3Value;

                                if (SparePartsMenulistTemp[d].SparePartOperationTimePlant4Value == null)
                                    SparePartsMenulistTemp[d].SparePartOperationTimePlant4Value = 0;
                                float? tempOperationTimePlant4Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.SparePartOperationTimePlant4Value).FirstOrDefault();
                                if (tempOperationTimePlant4Value != null)
                                    OperationTimePlant4Value = OperationTimePlant4Value + tempOperationTimePlant4Value;

                                if (SparePartsMenulistTemp[d].SparePartOperationTimePlant5Value == null)
                                    SparePartsMenulistTemp[d].SparePartOperationTimePlant5Value = 0;
                                float? tempOperationTimePlant5Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.SparePartOperationTimePlant5Value).FirstOrDefault();
                                if (tempOperationTimePlant5Value != null)
                                    OperationTimePlant5Value = OperationTimePlant5Value + tempOperationTimePlant5Value;
                            }
                            #endregion
                            SparePartsMenulistTemp[d].SparePartStandardOperationTime = (float?)Math.Round(Convert.ToDouble(StandardTime), 2);
                            SparePartsMenulistTemp[d].SparePartOperationTimePlant1Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant1Value), 2);
                            SparePartsMenulistTemp[d].SparePartOperationTimePlant2Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant2Value), 2);
                            SparePartsMenulistTemp[d].SparePartOperationTimePlant3Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant3Value), 2);
                            SparePartsMenulistTemp[d].SparePartOperationTimePlant4Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant4Value), 2);
                            SparePartsMenulistTemp[d].SparePartOperationTimePlant5Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant5Value), 2);
                            #region GEOS2-3954 Show the WorkOperations and SOD Time in the format: MM:SS or HH:MM:SS
                            try
                            {
                                SparePartsMenulistTemp[d].UiTempStandardOperationTimeName = ConvertfloattoTimespan(Convert.ToString(SparePartsMenulistTemp[d].SparePartStandardOperationTime));
                                SparePartsMenulistTemp[d].UiTempoperationTimePlant1Value = ConvertfloattoTimespan(Convert.ToString(SparePartsMenulistTemp[d].SparePartOperationTimePlant1Value));
                                SparePartsMenulistTemp[d].UiTempoperationTimePlant2Value = ConvertfloattoTimespan(Convert.ToString(SparePartsMenulistTemp[d].SparePartOperationTimePlant2Value));
                                SparePartsMenulistTemp[d].UiTempoperationTimePlant3Value = ConvertfloattoTimespan(Convert.ToString(SparePartsMenulistTemp[d].SparePartOperationTimePlant3Value));
                                SparePartsMenulistTemp[d].UiTempoperationTimePlant4Value = ConvertfloattoTimespan(Convert.ToString(SparePartsMenulistTemp[d].SparePartOperationTimePlant4Value));
                                SparePartsMenulistTemp[d].UiTempoperationTimePlant5Value = ConvertfloattoTimespan(Convert.ToString(SparePartsMenulistTemp[d].SparePartOperationTimePlant5Value));
                            }
                            catch (Exception ex)
                            {
                                GeosApplication.Instance.Logger.Log(string.Format("Error in Method RetrieveWorkOperationsBySparePart() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            }
                            #endregion
                        }
                    }
                #endregion              
                SparePartsMenulist = SparePartsMenulistTemp;
                #endregion
                // FillSparePartGridColumn(); //[GEOS2-4830][gulab lakade][07 12 2023]


                //SparePartCustomSummarycalculation();//[GEOS2-4830][gulab lakade][07 12 2023]
                //if (ModuleMenulist != null)
                //    ModuleMenulistCloned = ModuleMenulist;
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Method RetrieveWorkOperationsBySparePart()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log(string.Format("Error in method RetrieveWorkOperationsBySparePart() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }



        private void CompleteDropRecorSparePartGrid(DropRecordEventArgs e)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method CompleteDropRecorSparePartGrid()...", category: Category.Info, priority: Priority.Low);

                Saveselecteditem = "SparePart";  //[GEOS2-4108][Rupali Sarode][3-1-2022]
                ObservableCollection<ERMSOPSpareParts> SparePartsMenulistTemp = new ObservableCollection<ERMSOPSpareParts>();//[GEOS2-4830][gulab lakade][07 12 2023]
                string WOWithStatusMessage = string.Empty;  // [GEOS2-5020][Rupali Sarode][29-11-2023]
                if (!DXSplashScreen.IsActive)
                {
                    DXSplashScreen.Show(x =>
                    {
                        Window win = new Window()
                        {
                            ShowActivated = false,
                            WindowStyle = WindowStyle.None,
                            ResizeMode = ResizeMode.NoResize,
                            AllowsTransparency = true,
                            Background = new SolidColorBrush(Colors.Transparent),
                            ShowInTaskbar = false,
                            Topmost = true,
                            SizeToContent = SizeToContent.WidthAndHeight,
                            WindowStartupLocation = WindowStartupLocation.CenterScreen,
                        };
                        WindowFadeAnimationBehavior.SetEnableAnimation(win, true);
                        win.Topmost = false;
                        return win;
                    }, x =>
                    {
                        return new SplashScreenView() { DataContext = new SplashScreenViewModel() };
                    }, null, null);
                }

                if (SelectedItemSparePart is ERMSpareParts)
                {

                    IsEnabledSaveButton = true;
                    SaveButtonVisibility = Visibility.Visible;
                    duplicateItemloopSparePart = 0;
                    if ((e.IsFromOutside) && typeof(WorkOperationByStages).IsAssignableFrom(e.GetRecordType()))
                    {
                        //WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                        var data = (RecordDragDropData)e.Data.GetData(typeof(RecordDragDropData));
                        List<WorkOperationByStages> found = new List<WorkOperationByStages>();
                        List<WorkOperationByStages> TempfoundAllrecords = new List<WorkOperationByStages>();
                        List<WorkOperationByStages> records = data.Records.OfType<WorkOperationByStages>().ToList();
                        operationSparePartMenulist = new ObservableCollection<WorkOperationByStages>();
                        int count = 0;
                        if (SparePartsMenulist == null)
                        {
                            SparePartsMenulist = new ObservableCollection<ERMSOPSpareParts>();
                        }
                        if (SparePartsMenulist.Count() > 0)
                        {
                            SparePartsMenulistTemp = SparePartsMenulist;
                        }

                        if (records.Any(a => a.Name.Equals("All")))
                        {
                            #region ALL
                            found = new List<WorkOperationByStages>();
                            operationSparePartMenulist = new ObservableCollection<WorkOperationByStages>();
                            operationSparePartMenulist.AddRange(WorkOperationMenulist.Where(w => !w.Name.Equals("All")));
                            #endregion
                        }
                        else
                        {

                            for (int r = 0; r < records.Count(); r++)
                            {
                                if (!SparePartsMenulistTemp.Any(a => a.Name.Equals(records[r].Name)))
                                {
                                    //if (records[r].IdStatus != 1536)
                                    //{
                                    records[r].IsCurrentWorkOperation = true;
                                    //DetectionMenulist.Add(JsonConvert.DeserializeObject<ERMSOPDetection>(JsonConvert.SerializeObject(records[r])));
                                    if (!operationSparePartMenulist.Any(a => a.KeyName.Equals(records[r].KeyName)))
                                        operationSparePartMenulist.Add(records[r]);
                                    //}


                                }

                                if (GetStages.Any(a => a != null && a.Code.Trim().Equals(records[r].Name.Trim())))
                                {
                                    found.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(records[r].KeyName)).ToList());
                                    int x = 0;
                                    Loop:
                                    x++;
                                    if (x < 4)
                                    {
                                        for (int i = 0; i < found.Count(); i++)
                                        {
                                            TempfoundAllrecords.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(found[i].KeyName)).ToList());
                                        }
                                        for (int i = 0; i < TempfoundAllrecords.Count(); i++)
                                        {
                                            if (!found.Any(a => a != null && a.KeyName.Trim().Equals(TempfoundAllrecords[i].KeyName.Trim())))
                                                found.Add(TempfoundAllrecords[i]);
                                        }
                                        goto Loop;
                                    }

                                }
                                else
                                {
                                    found.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(records[r].KeyName)).ToList());
                                    for (int i = 0; i < found.Count(); i++)
                                    {
                                        TempfoundAllrecords.AddRange(WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(found[i].KeyName)).ToList());
                                    }
                                    for (int i = 0; i < TempfoundAllrecords.Count(); i++)
                                    {
                                        if (!found.Any(a => a != null && a.KeyName.Trim().Equals(TempfoundAllrecords[i].KeyName.Trim())))
                                            found.Add(TempfoundAllrecords[i]);
                                    }
                                    for (int i = 0; i < records.Where(a => a.IdworkOperationByStage > 0).Count(); i++)
                                    {
                                        if (!found.Any(a => a != null && a.KeyName.Trim().Equals(records[i].KeyName.Trim())))
                                            found.AddRange(WorkOperationMenulist.Where(s => s.IdworkOperationByStage == records[i].IdworkOperationByStage).ToList());
                                        if (found.Count() != 0)
                                        {
                                            count++;
                                        }
                                    }
                                }

                            }
                        }


                        if (count > 0)
                        {
                            for (int i = 0; i < found.Count(); i++)
                            {
                                if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(found[i].Name.Trim())))
                                {
                                    duplicateItemloopSparePart = 0;
                                    GetAllTreeListSparePart(found[i], WorkOperationMenulist);
                                }

                            }
                        }
                        else
                        {

                            if (!records.Any(a => a.Name.Equals("All")))
                                foreach (WorkOperationByStages item in found)
                                {
                                    duplicateItemloopSparePart = 0;
                                    GetAllTreeListSparePart(item, WorkOperationMenulist);
                                }
                        }
                        if (!records.Any(a => a.Name.Equals("All")))
                            if (operationSparePartMenulist != null)
                            {
                                var tempModuleMenulist = operationSparePartMenulist.ToList();
                                for (int i = 0; i < tempModuleMenulist.Count; i++)
                                {
                                    if (GetStages.Any(a => a.Code.Equals(tempModuleMenulist[i].Name)))
                                    {
                                        List<WorkOperationByStages> childList = operationSparePartMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(tempModuleMenulist[i].KeyName)).ToList();
                                        if (childList.Count == 0)
                                        {
                                            operationSparePartMenulist.Remove(tempModuleMenulist[i]);
                                        }
                                    }
                                }
                            }



                        #region [GEOS2-5020][Rupali Sarode][29-11-2023]
                        List<string> WOWithStatusList;

                        WOWithStatusList = new List<string>();
                        string WOStausForChild = string.Empty;

                        List<WorkOperationByStages> WOChilds = operationSparePartMenulist.Where(i => i.ParentName != null && i.ParentName == records[0].KeyName).ToList();
                        if (WOChilds != null)
                        {
                            if (WOChilds.Count == 0) //If dropped item is child
                            {
                                if (records[0].Name != "All")
                                {
                                    int WOIdStatus = operationSparePartMenulist.Where(i => i.Name == records[0].Name).FirstOrDefault().IdStatus;
                                    if (WOIdStatus > 0 && WOIdStatus != 1535)
                                    {
                                        if (WOIdStatus == 1536) WOStausForChild = "in inactive status";
                                        if (WOIdStatus == 1537) WOStausForChild = "in draft status";

                                        if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                                        CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("AddEditSODDragOnlyActiveWO").ToString() + "\n" + "Work operation '" + records[0].Name + "' is " + WOStausForChild), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                                        return;
                                    }
                                }

                            }
                        }

                        #endregion [GEOS2-5020][Rupali Sarode][29-11-2023]

                        #region commonCode

                        bool FlagAddItemToList; // [GEOS2-5020][Rupali Sarode][29-11-2023]

                        #region [GEOS2-4830][gulab lakade][07 12 2023]
                        if (AllSupplementsBoxMenu != null)
                        {
                            var listadoDuplicadas = from c in AllSupplementsBoxMenu
                                                    join c2 in AllSupplementsBoxMenu on c.Item2 equals c2.Item2
                                                    where c != c2
                                                    select c;

                            var SparePartSandardOperationTime = listadoDuplicadas.FirstOrDefault();
                            if (SparePartSandardOperationTime != null)
                            {
                                var templist = listadoDuplicadas.Where(a => a.Item2 == SparePartSandardOperationTime.Item2);
                                listadoDuplicadas = templist;
                            }

                            var tempSupplementsBoxMenu = AllSupplementsBoxMenu;

                            ColumnsSparePartForSupplements = new ObservableCollection<TreeListColumn>();
                            ColumnsSparePartForSupplements.Add(new TreeListColumn()
                            {
                                FieldName = "SparePartStandardSupplements",
                                Header = "Standard",
                                HeaderToolTip = "Standard",
                                AllowCellMerge = false,
                                Width = 150,    //gulab lakade not show supplement proper
                                AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                Visible = true,
                                ReadOnly = false,
                                FixedWidth = false
                            });

                            ColumnsSparePartOperationTime = new ObservableCollection<TreeListColumn>();
                            ColumnsSparePartOperationTime.Add(new TreeListColumn()
                            {
                                FieldName = "UiTempStandardOperationTimeName",
                                Header = "Standard",
                                HeaderToolTip = "Standard",
                                AllowCellMerge = false,
                                Width = 150,    //not show StandardOperationTime proper
                                AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                Visible = true,
                                ReadOnly = false,
                                FixedWidth = false
                            });

                            int Supllimentcount = 1;
                            var ColumnsSparePartList = tempSupplementsBoxMenu.Where(p => !listadoDuplicadas.Any(p2 => p2.Item1 == p.Item1));
                            foreach (var item in ColumnsSparePartList)
                            {
                                if (Supllimentcount == 5)
                                {
                                    ColumnsSparePartForSupplements.Add(new TreeListColumn()
                                    {
                                        FieldName = "SparePartSupplementPlant" + Supllimentcount + "Value",
                                        Header = "Others",
                                        HeaderToolTip = "Others",
                                        AllowCellMerge = false,
                                        Width = 60,
                                        AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                        Visible = true,
                                        ReadOnly = false,
                                        FixedWidth = false
                                    });
                                    ColumnsSparePartOperationTime.Add(new TreeListColumn()
                                    {
                                        FieldName = "UiTempoperationTimePlant" + Supllimentcount + "Value",
                                        Header = "Others",
                                        HeaderToolTip = "Others",
                                        AllowCellMerge = false,
                                        Width = 60,
                                        AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                        Visible = true,
                                        ReadOnly = false,
                                        FixedWidth = false
                                    });
                                    break;
                                }
                                if (Supllimentcount == 5)
                                {
                                    break;
                                }
                                ColumnsSparePartForSupplements.Add(new TreeListColumn()
                                {
                                    FieldName = "SparePartSupplementPlant" + Supllimentcount + "Value",
                                    Header = item.Item1,
                                    HeaderToolTip = item.Item1,
                                    AllowCellMerge = false,
                                    Width = 60,
                                    AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                    Visible = true,
                                    ReadOnly = false,
                                    FixedWidth = false
                                });

                                ColumnsSparePartOperationTime.Add(new TreeListColumn()
                                {
                                    FieldName = "UiTempoperationTimePlant" + Supllimentcount + "Value",
                                    Header = item.Item1,
                                    HeaderToolTip = item.Item1,
                                    AllowCellMerge = false,
                                    Width = 60,
                                    AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                    Visible = true,
                                    ReadOnly = false,
                                    FixedWidth = false
                                });
                                Supllimentcount = Supllimentcount + 1;
                            }

                            #endregion
                            foreach (WorkOperationByStages SparePart in WorkOperationMenulist)
                            {
                                FlagAddItemToList = true; //[GEOS2-5020][Rupali Sarode][29-11-2023]

                                //if (SparePart.IdStatus != 1536)
                                if (operationSparePartMenulist.Any(a => a.IdworkOperationByStage == Convert.ToInt64(SparePart.IdworkOperationByStage))
                                   && operationSparePartMenulist.Any(a => a.IdStage == SparePart.IdStage)
                                && operationSparePartMenulist.Any(a => a.Name.Trim().Equals(SparePart.Name.Trim()))
                                )
                                {
                                    //[GEOS2-5020][Rupali Sarode][30-11-2023] 
                                    List<WorkOperationByStages> TempWOChilds = new List<WorkOperationByStages>();
                                    TempWOChilds = operationSparePartMenulist.Where(i => i.ParentName == SparePart.KeyName).ToList();

                                    if (GetStages.Any(a => a.Code.Equals(SparePart.Name)))
                                    //If it is stage and only one parent is selected which is inactive/draft, then do not add such a stage to list
                                    {
                                        List<WorkOperationByStages> childListInActiveDraft = operationSparePartMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(SparePart.KeyName)).ToList();

                                        if (childListInActiveDraft.Count > 0)
                                        {
                                            foreach (WorkOperationByStages objChild in childListInActiveDraft)
                                            {
                                                List<WorkOperationByStages> GrandChildListInActiveDraft = new List<WorkOperationByStages>();
                                                GrandChildListInActiveDraft = operationSparePartMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(objChild.KeyName)).ToList();
                                                if (GrandChildListInActiveDraft.Count == 0)
                                                { // If it is child and Active
                                                    if (objChild.IdStatus == 1535)
                                                    {
                                                        FlagAddItemToList = true;
                                                        break;
                                                    }
                                                    else
                                                    {
                                                        FlagAddItemToList = false;
                                                    }

                                                }
                                                else
                                                {
                                                    if (GrandChildListInActiveDraft.Count > 0)
                                                    {
                                                        if (GrandChildListInActiveDraft.Where(i => i.IdStatus == 1535).Count() > 0)
                                                        {
                                                            FlagAddItemToList = true;
                                                            break;
                                                        }
                                                        else
                                                        {
                                                            FlagAddItemToList = false;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    else if (TempWOChilds.Count() > 0 && (TempWOChilds.Count() == TempWOChilds.Where(i => i.IdStatus != 1535).Count()))
                                    // All children are in inactive/draft status
                                    {
                                        // do not add such parent to list in grid
                                        FlagAddItemToList = false;
                                    }
                                    //}
                                    else
                                    if (TempWOChilds.Count == 0 && SparePart.IdStatus != 1535)
                                    // If child is inactive/draft, do not add it.
                                    // If Parent is inactive/draft, add it only if it has inactive/draft child(s).
                                    {
                                        if (string.IsNullOrEmpty(WOWithStatusMessage))
                                        {
                                            if (SparePart.IdStatus == 1536)
                                                WOWithStatusMessage = "Work operation '" + SparePart.Name + "' is " + "in inactive status";
                                            else if (SparePart.IdStatus == 1537)
                                                WOWithStatusMessage = "Work operation '" + SparePart.Name + "' is " + "in draft status";
                                        }
                                        else
                                        {
                                            if (SparePart.IdStatus == 1536)
                                                WOWithStatusMessage = WOWithStatusMessage + "\n" + "Work operation '" + SparePart.Name + "' is " + "in inactive status";
                                            else if (SparePart.IdStatus == 1537)
                                                WOWithStatusMessage = WOWithStatusMessage + "\n" + "Work operation '" + SparePart.Name + "' is " + "in draft status";
                                        }
                                        FlagAddItemToList = false;

                                    }

                                    //if (SparePart.IdStatus != 1536 && SparePart.IdStatus != 1537) //[GEOS2-5020][Rupali Sarode][30-11-2023]
                                    //{
                                    ERMSOPSpareParts eRMSOPSparePart = new ERMSOPSpareParts();
                                    eRMSOPSparePart.Name = SparePart.Name;
                                    eRMSOPSparePart.IdworkOperationByStage = SparePart.IdworkOperationByStage;
                                    eRMSOPSparePart.IdSequence = SparePart.IdSequence;
                                    eRMSOPSparePart.IdStatus = SparePart.IdStatus;
                                    eRMSOPSparePart.Status = SparePart.Status;
                                    eRMSOPSparePart.Code = SparePart.Name;
                                    eRMSOPSparePart.Parent = SparePart.Parent;
                                    eRMSOPSparePart.IdParent = SparePart.IdParent;
                                    eRMSOPSparePart.KeyName = SparePart.KeyName;
                                    eRMSOPSparePart.ParentName = SparePart.ParentName;
                                    eRMSOPSparePart.Position = SparePart.Position;

                                    #region [GEOS2-5629][gulab lakade][16 07 2024]
                                    if (SparePartsMenulistTemp != null)
                                    {
                                        if (SparePart.ParentName == null)
                                        {
                                            eRMSOPSparePart.SparepartPosition = SparePart.Position;
                                        }
                                        else
                                        {
                                            #region [gulab lakade][beta changes][01082024]
                                            if (SparePartsMenulistTemp.Count() == 0)
                                            {
                                                if (SparePart.Position == 1)
                                                {
                                                    eRMSOPSparePart.SparepartPosition = SparePart.Position;
                                                }
                                                else
                                                {
                                                    eRMSOPSparePart.SparepartPosition = 1;
                                                }

                                            }
                                            else
                                            {
                                                #endregion
                                                var TempModule = SparePartsMenulistTemp.Where(x => x.KeyName == SparePart.KeyName).FirstOrDefault();
                                                if (TempModule != null)
                                                {
                                                    eRMSOPSparePart.SparepartPosition = TempModule.SparepartPosition;
                                                }
                                                else
                                                {
                                                    if (SparePartsMenulistTemp.Where(x => x.ParentName == SparePart.ParentName).FirstOrDefault() == null)
                                                    {
                                                        var maxpos = SparePartsMenulistTemp.Max(a => a.SparepartPosition);
                                                        eRMSOPSparePart.SparepartPosition = maxpos + 1;
                                                    }
                                                    else
                                                    {
                                                        var maxpos = SparePartsMenulistTemp.Where(x => x.ParentName == SparePart.ParentName).Max(a => a.SparepartPosition);
                                                        eRMSOPSparePart.SparepartPosition = maxpos + 1;
                                                    }

                                                }
                                            }
                                        }//[gulab lakade][beta changes][01082024]

                                    }
                                    #endregion
                                    eRMSOPSparePart.WorkOperation_count = SparePart.WorkOperation_count;
                                    eRMSOPSparePart.WorkOperation_count_original = SparePart.WorkOperation_count_original;
                                    eRMSOPSparePart.NameWithWorkOperationCount = SparePart.NameWithWorkOperationCount;

                                    ERMSpareParts tIdDetection = (ERMSpareParts)SelectedItemSparePart;  //[GEOS2-3859][Rupali Sarode][29-11-2022]
                                    eRMSOPSparePart.IdDetection = (ulong)tIdDetection.IdDetection; //[GEOS2-3859][Rupali Sarode][29-11-2022]

                                    eRMSOPSparePart.SparePartActivity = SparePart.Activity;
                                    if (eRMSOPSparePart.SparePartActivity != 0)
                                        eRMSOPSparePart.SparePartActivity = Math.Round((double)SparePart.Activity, 2);
                                    if (eRMSOPSparePart.SparePartActivity == 0)
                                        eRMSOPSparePart.SparePartActivity = null;

                                    eRMSOPSparePart.SparePartNormalTime = SparePart.NormalTime;
                                    eRMSOPSparePart.SparePartObservedTime = SparePart.ObservedTime;

                                    if (SparePart.NormalTime != null)
                                    {
                                        eRMSOPSparePart.SparePartNormalTime = Math.Round((double)SparePart.NormalTime, 2);
                                        #region [GEOS2-3954][Rupali Sarode]
                                        eRMSOPSparePart.UITempSparePartNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(eRMSOPSparePart.SparePartNormalTime));
                                        #endregion
                                    }

                                    if (SparePart.ObservedTime != null)
                                    {
                                        eRMSOPSparePart.SparePartObservedTime = Math.Round((double)SparePart.ObservedTime, 2);
                                        #region [GEOS2-3954][Rupali Sarode]
                                        eRMSOPSparePart.UITempSparePartObservedTime = ConvertfloattoTimespan(eRMSOPSparePart.SparePartObservedTime.ToString());
                                        #endregion
                                    }


                                    //eRMSOPSparePart.SparePartActivity = SparePart.Activity;
                                    //if (eRMSOPSparePart.SparePartActivity != 0)
                                    //    eRMSOPSparePart.SparePartActivity = Math.Round((double)SparePart.Activity, 2);
                                    //if (eRMSOPSparePart.SparePartActivity == 0)
                                    //    eRMSOPSparePart.SparePartActivity = null;

                                    //[GEOS2-3933][Rupali Sarode][22/09/2022]
                                    eRMSOPSparePart.WORemarks = SparePart.WORemarks == null ? "" : SparePart.WORemarks.Trim();

                                    if (GetStages.Any(a => a != null && a.Code.Trim().Equals(SparePart.Name.Trim())))
                                    {
                                        SparePart.IsCurrentWorkOperation = true;
                                        eRMSOPSparePart.IsDeleteButton = false;
                                        eRMSOPSparePart.IsDeleteButtonVisibility = Visibility.Hidden;
                                        eRMSOPSparePart.IsValidateOnTextInput = false;
                                    }
                                    else
                                    {
                                        SparePart.IsCurrentWorkOperation = true;

                                        eRMSOPSparePart.IsValidateOnTextInput = true;
                                    }
                                    if (SparePart.IdStatus == 1536)
                                    {
                                        eRMSOPSparePart.IsInactiveWorkOperation = true;
                                    }
                                    #region [GEOS2-4830][gulab lakade][07 12 2023]
                                    if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(eRMSOPSparePart.Name.Trim())))
                                    {
                                        if (SparePartSandardOperationTime != null)
                                            eRMSOPSparePart.SparePartStandardSupplements = (float?)SparePartSandardOperationTime.Item2;
                                        if (tempSupplementsBoxMenu.Any(p => !listadoDuplicadas.Any(p2 => p2.Item1 == p.Item1)))
                                        {
                                            eRMSOPSparePart.AllSupplementsBoxMenu = AllSupplementsBoxMenu;
                                            List<float?> lst = new List<float?>();

                                            var a = ColumnsSparePartList.ToList();
                                            for (int i = 0; i < a.Count(); i++)
                                            {
                                                lst.Add((float?)a[i].Item2);
                                            }

                                            if (ColumnsSparePartList.Count() == 1)
                                            {
                                                eRMSOPSparePart.SparePartSupplementPlant1Value = (float?)lst[0];
                                            }
                                            else if (ColumnsSparePartList.Count() == 2)
                                            {
                                                eRMSOPSparePart.SparePartSupplementPlant1Value = (float?)lst[0];
                                                eRMSOPSparePart.SparePartSupplementPlant2Value = (float?)lst[1];
                                            }
                                            else if (ColumnsSparePartList.Count() == 3)
                                            {
                                                eRMSOPSparePart.SparePartSupplementPlant1Value = (float?)lst[0];
                                                eRMSOPSparePart.SparePartSupplementPlant2Value = (float?)lst[1];
                                                eRMSOPSparePart.SparePartSupplementPlant3Value = (float?)lst[2];
                                            }
                                            else if (ColumnsSparePartList.Count() == 4)
                                            {
                                                eRMSOPSparePart.SparePartSupplementPlant1Value = (float?)lst[0];
                                                eRMSOPSparePart.SparePartSupplementPlant2Value = (float?)lst[1];
                                                eRMSOPSparePart.SparePartSupplementPlant3Value = (float?)lst[2];
                                                eRMSOPSparePart.SparePartSupplementPlant4Value = (float?)lst[3];
                                            }
                                            else if (ColumnsSparePartList.Count() == 5)
                                            {
                                                eRMSOPSparePart.SparePartSupplementPlant1Value = (float?)lst[0];
                                                eRMSOPSparePart.SparePartSupplementPlant2Value = (float?)lst[1];
                                                eRMSOPSparePart.SparePartSupplementPlant3Value = (float?)lst[2];
                                                eRMSOPSparePart.SparePartSupplementPlant4Value = (float?)lst[3];
                                                eRMSOPSparePart.SparePartSupplementPlant5Value = (float?)lst[4];
                                            }
                                            else
                                            {
                                                eRMSOPSparePart.SparePartSupplementPlant1Value = (float?)lst[0];
                                                eRMSOPSparePart.SparePartSupplementPlant2Value = (float?)lst[1];
                                                eRMSOPSparePart.SparePartSupplementPlant3Value = (float?)lst[2];
                                                eRMSOPSparePart.SparePartSupplementPlant4Value = (float?)lst[3];
                                                eRMSOPSparePart.SparePartSupplementPlant5Value = 0;
                                                if (ColumnsSparePartList.Count() > 5)
                                                {
                                                    for (int q = 4; q < ColumnsSparePartList.Count(); q++)
                                                    {
                                                        if (eRMSOPSparePart.SparePartSupplementPlant5Value == null)
                                                            eRMSOPSparePart.SparePartSupplementPlant5Value = 0;
                                                        eRMSOPSparePart.SparePartSupplementPlant5Value = eRMSOPSparePart.SparePartSupplementPlant5Value + (float?)lst[q];
                                                    }
                                                }


                                            }

                                        }

                                        if (SparePartSandardOperationTime != null)
                                            eRMSOPSparePart.SparePartStandardOperationTime = (float?)Math.Round(Convert.ToDouble(eRMSOPSparePart.SparePartNormalTime * (1 + (SparePartSandardOperationTime.Item2 / 100))), 2);

                                        eRMSOPSparePart.SparePartOperationTimePlant1Value = (float?)Math.Round(Convert.ToDouble(eRMSOPSparePart.SparePartNormalTime * (1 + (Convert.ToDouble(eRMSOPSparePart.SparePartSupplementPlant1Value) / 100))), 2);
                                        eRMSOPSparePart.SparePartOperationTimePlant2Value = (float?)Math.Round(Convert.ToDouble(eRMSOPSparePart.SparePartNormalTime * (1 + (Convert.ToDouble(eRMSOPSparePart.SparePartSupplementPlant2Value) / 100))), 2);
                                        eRMSOPSparePart.SparePartOperationTimePlant3Value = (float?)Math.Round(Convert.ToDouble(eRMSOPSparePart.SparePartNormalTime * (1 + (Convert.ToDouble(eRMSOPSparePart.SparePartSupplementPlant3Value) / 100))), 2);
                                        eRMSOPSparePart.SparePartOperationTimePlant4Value = (float?)Math.Round(Convert.ToDouble(eRMSOPSparePart.SparePartNormalTime * (1 + (Convert.ToDouble(eRMSOPSparePart.SparePartSupplementPlant4Value) / 100))), 2);
                                        eRMSOPSparePart.SparePartOperationTimePlant5Value = (float?)Math.Round(Convert.ToDouble(eRMSOPSparePart.SparePartNormalTime * (1 + (Convert.ToDouble(eRMSOPSparePart.SparePartSupplementPlant5Value) / 100))), 2);
                                        #region GEOS2-3954 Show the WorkOperations and SOD Time in the format: MM:SS or HH:MM:SS
                                        try
                                        {
                                            eRMSOPSparePart.UiTempStandardOperationTimeName = ConvertfloattoTimespan(Convert.ToString(eRMSOPSparePart.SparePartStandardOperationTime));
                                            eRMSOPSparePart.UiTempoperationTimePlant1Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPSparePart.SparePartOperationTimePlant1Value));
                                            eRMSOPSparePart.UiTempoperationTimePlant2Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPSparePart.SparePartOperationTimePlant2Value));
                                            eRMSOPSparePart.UiTempoperationTimePlant3Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPSparePart.SparePartOperationTimePlant3Value));
                                            eRMSOPSparePart.UiTempoperationTimePlant4Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPSparePart.SparePartOperationTimePlant4Value));
                                            eRMSOPSparePart.UiTempoperationTimePlant5Value = ConvertfloattoTimespan(Convert.ToString(eRMSOPSparePart.SparePartOperationTimePlant5Value));
                                        }
                                        catch (Exception ex)
                                        {
                                            GeosApplication.Instance.Logger.Log(string.Format("Error in Method CompleteDropRecorSparePartGrid() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                        }
                                        #endregion
                                    }

                                    #endregion
                                    try
                                    {
                                        //if (!SparePartsMenulistTemp.Any(a => a.KeyName.Equals(SparePart.KeyName)))
                                        if (!SparePartsMenulistTemp.Any(a => a.KeyName.Equals(SparePart.KeyName)) && FlagAddItemToList == true)  //  [GEOS2-5020][Rupali Sarode][29-11-2023]
                                        {
                                            SparePartsMenulistTemp.Add(eRMSOPSparePart);
                                        }

                                    }
                                    catch (Exception ex)
                                    {

                                    }
                                    //}
                                }
                            }
                        }/// [GEOS2-4830][gulab lakade][07 12 2023]
                        #endregion
                    }
                    //List<ERMSOPSpareParts> tempWorkOperationSparePartMenulist = SparePartsMenulistTemp.OrderBy(x => x.Position).ToList();
                    List<ERMSOPSpareParts> tempWorkOperationSparePartMenulist = SparePartsMenulistTemp.OrderBy(x => x.SparepartPosition).ToList();
                    SparePartsMenulistTemp.Clear();
                    SparePartsMenulistTemp.AddRange(tempWorkOperationSparePartMenulist);
                    tempWorkOperationSparePartMenulist.Clear();
                    #region RND
                    #region calculation
                    #region [GEOS2-4830][gulab lakade][07 12 2023]
                    //if (SparePartsMenulistTemp != null)
                    //    //foreach (ERMSOPDetection itemERMSOPDetection in DetectionMenulist)
                    //    for (int d = 0; d < SparePartsMenulistTemp.Count(); d++)
                    //    {
                    //        WorkOperationMenulist.Where(w => w.KeyName == SparePartsMenulistTemp[d].KeyName).ToList().ForEach(f => f.IsCurrentWorkOperation = true);
                    //        var listCount = SparePartsMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(SparePartsMenulistTemp[d].KeyName) && w.IsInactiveWorkOperation == false).ToList();
                    //        if (listCount != null)
                    //            if (listCount.Count() > 0)
                    //            {
                    //                // decimal a = listCount.Sum(s => s.SparePartObservedTime);

                    //                SparePartsMenulistTemp[d].SparePartObservedTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.SparePartObservedTime)), 2);
                    //                SparePartsMenulistTemp[d].SparePartNormalTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.SparePartNormalTime)), 2);

                    //                //[GEOS2-3954][Rupali Sarode]
                    //                SparePartsMenulistTemp[d].UITempSparePartObservedTime = ConvertfloattoTimespan(Convert.ToString(Convert.ToDouble(listCount.Sum(s => s.SparePartObservedTime))));
                    //                SparePartsMenulistTemp[d].UITempSparePartNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(Convert.ToDouble(listCount.Sum(s => s.SparePartNormalTime))));

                    //                SparePartsMenulistTemp[d].IsReadOnly = true;
                    //            }
                    //    }
                    #endregion
                    if (SparePartsMenulistTemp != null)
                        for (int d = 0; d < SparePartsMenulistTemp.Count(); d++)
                        {
                            WorkOperationMenulist.Where(w => w.KeyName == SparePartsMenulistTemp[d].KeyName).ToList().ForEach(f => f.IsCurrentWorkOperation = true);
                            //[GEOS2-5135][Rupali Sarode][18-12-2023]
                            //var listCount = SparePartsMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(SparePartsMenulistTemp[d].KeyName) && w.IsInactiveWorkOperation == false).ToList();
                            var listCount = SparePartsMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(SparePartsMenulistTemp[d].KeyName)).ToList();
                            if (listCount != null)
                                if (listCount.Count() > 0)
                                {
                                    SparePartsMenulistTemp[d].SparePartObservedTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.SparePartObservedTime)), 2);
                                    SparePartsMenulistTemp[d].SparePartNormalTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.SparePartNormalTime)), 2);

                                    //[GEOS2-3954][Rupali Sarode]
                                    SparePartsMenulistTemp[d].UITempSparePartObservedTime = ConvertfloattoTimespan(Convert.ToString(listCount.Sum(s => s.SparePartObservedTime)));
                                    SparePartsMenulistTemp[d].UITempSparePartNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(listCount.Sum(s => s.SparePartNormalTime)));

                                    SparePartsMenulistTemp[d].IsReadOnly = true;
                                }
                        }

                    if (SparePartsMenulistTemp != null)
                        //foreach (ERMSOPDetection itemERMSOPDetection in DetectionMenulist)
                        for (int d = 0; d < SparePartsMenulistTemp.Count(); d++)
                        {
                            if (GetStages.Any(a => a.Code.Equals(SparePartsMenulistTemp[d].Name)))
                            {
                                ObservableCollection<ERMSOPSpareParts> ActivitySum = new ObservableCollection<ERMSOPSpareParts>();
                                ObservableCollection<ERMSOPSpareParts> TempActivitySum = new ObservableCollection<ERMSOPSpareParts>();
                                int x = 1;
                                Loop:
                                x++;
                                if (x < 10)
                                {
                                    if (ActivitySum.Count == 0)
                                    {
                                        SparePartsMenulistTemp[d].SparePartObservedTime = 0;
                                        SparePartsMenulistTemp[d].SparePartNormalTime = 0;

                                        //[GEOS2-3954][Rupali Sarode]
                                        SparePartsMenulistTemp[d].UITempSparePartObservedTime = ConvertfloattoTimespan(Convert.ToString(SparePartsMenulistTemp[d].SparePartObservedTime));
                                        SparePartsMenulistTemp[d].UITempSparePartNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(SparePartsMenulistTemp[d].SparePartNormalTime));
                                        //[GEOS2-5135][Rupali Sarode][18-12-2023]
                                        //var ActivitySumList = SparePartsMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(SparePartsMenulistTemp[d].KeyName) && w.IsInactiveWorkOperation == false).ToList();
                                        var ActivitySumList = SparePartsMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(SparePartsMenulistTemp[d].KeyName)).ToList();
                                        ActivitySum.AddRange(ActivitySumList);
                                    }
                                    else
                                    {
                                        //foreach (var item in ActivitySum)
                                        //{
                                        //    var ActivitySumList = DetectionMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(item.KeyName)).ToList();
                                        //    if (ActivitySumList != null && ActivitySumList.Count > 0)
                                        //    {

                                        //        foreach (var itemActivity in ActivitySumList)
                                        //        {
                                        //            if (!ActivitySum.Any(ac => ac.KeyName.Equals(itemActivity.KeyName)))
                                        //            {
                                        //                TempActivitySum.Add(itemActivity);
                                        //            }

                                        //        }

                                        //    }

                                        //}
                                        //ActivitySum.AddRange(TempActivitySum);
                                    }


                                    goto Loop;
                                }

                                double? ObservedTime = 0;
                                double? NormalTime = 0;
                                float? StandardTime = 0;
                                float? OperationTimePlant1Value = 0;
                                float? OperationTimePlant2Value = 0;
                                float? OperationTimePlant3Value = 0;
                                float? OperationTimePlant4Value = 0;
                                float? OperationTimePlant5Value = 0;
                                var tempDistinctList = ActivitySum.Select(xa => xa.KeyName).Distinct().ToList();
                                foreach (var item in tempDistinctList)
                                {
                                    if (SparePartsMenulistTemp[d].SparePartObservedTime == null)
                                        SparePartsMenulistTemp[d].SparePartObservedTime = 0;
                                    double? tempObservedTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.SparePartObservedTime).FirstOrDefault();
                                    if (tempObservedTime != null)
                                    {
                                        ObservedTime = Math.Round(Convert.ToDouble(ObservedTime + tempObservedTime), 2);
                                        //[GEOS2-3954][Rupali Sarode]
                                        SparePartsMenulistTemp[d].UITempSparePartObservedTime = ConvertfloattoTimespan(Convert.ToString(ObservedTime));
                                    }
                                    if (SparePartsMenulistTemp[d].SparePartNormalTime == null)
                                        SparePartsMenulistTemp[d].SparePartNormalTime = 0;
                                    double? tempNormalTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.SparePartNormalTime).FirstOrDefault();
                                    if (tempNormalTime != null)
                                    {
                                        NormalTime = Math.Round(Convert.ToDouble(NormalTime + tempNormalTime), 2);
                                        SparePartsMenulistTemp[d].UITempSparePartNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(NormalTime));
                                    }

                                }
                                SparePartsMenulistTemp[d].SparePartObservedTime = ObservedTime;
                                SparePartsMenulistTemp[d].SparePartNormalTime = NormalTime;

                                //[GEOS2-3954][Rupali Sarode]
                                SparePartsMenulistTemp[d].UITempSparePartObservedTime = ConvertfloattoTimespan(Convert.ToString(ObservedTime));
                                SparePartsMenulistTemp[d].UITempSparePartNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(NormalTime));

                                //DetectionMenulist[d].DetectionNormalTime = Math.Round(Convert.ToDouble(ObservedTime * DetectionMenulist[d].DetectionActivity / 100), 2);
                                #region PlantValue


                                foreach (var item in tempDistinctList)
                                {
                                    if (SparePartsMenulistTemp[d].SparePartStandardOperationTime == null)
                                        SparePartsMenulistTemp[d].SparePartStandardOperationTime = 0;
                                    float? tempStandardTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.SparePartStandardOperationTime).FirstOrDefault();
                                    if (tempStandardTime != null)
                                        StandardTime = StandardTime + tempStandardTime;

                                    if (SparePartsMenulistTemp[d].SparePartOperationTimePlant1Value == null)
                                        SparePartsMenulistTemp[d].SparePartOperationTimePlant1Value = 0;
                                    float? tempOperationTimePlant1Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.SparePartOperationTimePlant1Value).FirstOrDefault();
                                    if (tempOperationTimePlant1Value != null)
                                        OperationTimePlant1Value = OperationTimePlant1Value + tempOperationTimePlant1Value;

                                    if (SparePartsMenulistTemp[d].SparePartOperationTimePlant2Value == null)
                                        SparePartsMenulistTemp[d].SparePartOperationTimePlant2Value = 0;
                                    float? tempOperationTimePlant2Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.SparePartOperationTimePlant2Value).FirstOrDefault();
                                    if (tempOperationTimePlant2Value != null)
                                        OperationTimePlant2Value = OperationTimePlant2Value + tempOperationTimePlant2Value;

                                    if (SparePartsMenulistTemp[d].SparePartOperationTimePlant3Value == null)
                                        SparePartsMenulistTemp[d].SparePartOperationTimePlant3Value = 0;
                                    float? tempOperationTimePlant3Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.SparePartOperationTimePlant3Value).FirstOrDefault();
                                    if (tempOperationTimePlant3Value != null)
                                        OperationTimePlant3Value = OperationTimePlant3Value + tempOperationTimePlant3Value;

                                    if (SparePartsMenulistTemp[d].SparePartOperationTimePlant4Value == null)
                                        SparePartsMenulistTemp[d].SparePartOperationTimePlant4Value = 0;
                                    float? tempOperationTimePlant4Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.SparePartOperationTimePlant4Value).FirstOrDefault();
                                    if (tempOperationTimePlant4Value != null)
                                        OperationTimePlant4Value = OperationTimePlant4Value + tempOperationTimePlant4Value;

                                    if (SparePartsMenulistTemp[d].SparePartOperationTimePlant5Value == null)
                                        SparePartsMenulistTemp[d].SparePartOperationTimePlant5Value = 0;
                                    float? tempOperationTimePlant5Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.SparePartOperationTimePlant5Value).FirstOrDefault();
                                    if (tempOperationTimePlant5Value != null)
                                        OperationTimePlant5Value = OperationTimePlant5Value + tempOperationTimePlant5Value;
                                }
                                #endregion
                                SparePartsMenulistTemp[d].SparePartStandardOperationTime = (float?)Math.Round(Convert.ToDouble(StandardTime), 2);
                                SparePartsMenulistTemp[d].SparePartOperationTimePlant1Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant1Value), 2);
                                SparePartsMenulistTemp[d].SparePartOperationTimePlant2Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant2Value), 2);
                                SparePartsMenulistTemp[d].SparePartOperationTimePlant3Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant3Value), 2);
                                SparePartsMenulistTemp[d].SparePartOperationTimePlant4Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant4Value), 2);
                                SparePartsMenulistTemp[d].SparePartOperationTimePlant5Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant5Value), 2);
                                #region GEOS2-3954 Show the WorkOperations and SOD Time in the format: MM:SS or HH:MM:SS
                                try
                                {
                                    SparePartsMenulistTemp[d].UiTempStandardOperationTimeName = ConvertfloattoTimespan(Convert.ToString(SparePartsMenulistTemp[d].SparePartStandardOperationTime));
                                    SparePartsMenulistTemp[d].UiTempoperationTimePlant1Value = ConvertfloattoTimespan(Convert.ToString(SparePartsMenulistTemp[d].SparePartOperationTimePlant1Value));
                                    SparePartsMenulistTemp[d].UiTempoperationTimePlant2Value = ConvertfloattoTimespan(Convert.ToString(SparePartsMenulistTemp[d].SparePartOperationTimePlant2Value));
                                    SparePartsMenulistTemp[d].UiTempoperationTimePlant3Value = ConvertfloattoTimespan(Convert.ToString(SparePartsMenulistTemp[d].SparePartOperationTimePlant3Value));
                                    SparePartsMenulistTemp[d].UiTempoperationTimePlant4Value = ConvertfloattoTimespan(Convert.ToString(SparePartsMenulistTemp[d].SparePartOperationTimePlant4Value));
                                    SparePartsMenulistTemp[d].UiTempoperationTimePlant5Value = ConvertfloattoTimespan(Convert.ToString(SparePartsMenulistTemp[d].SparePartOperationTimePlant5Value));
                                }
                                catch (Exception ex)
                                {
                                    GeosApplication.Instance.Logger.Log(string.Format("Error in Method SparePartCustomSummarycalculation() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                }
                                #endregion
                            }
                        }
                    #endregion
                    SparePartsMenulist = SparePartsMenulistTemp;
                    #endregion
                    //FillSparePartGridColumn();/// [GEOS2-4830][gulab lakade][07 12 2023]
                    // SparePartCustomSummarycalculation();/// [GEOS2-4830][gulab lakade][07 12 2023]
                    FlagToDragDrop = true; //[GEOS2-3925][Rupali Sarode]
                    e.Handled = true;

                    if (!string.IsNullOrEmpty(WOWithStatusMessage)) //  [GEOS2-5020][Rupali Sarode][29-11-2023]
                    {
                        if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                        CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("AddEditSODDragOnlyActiveWO").ToString() + "\n" + WOWithStatusMessage), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                    }

                }
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Method CompleteDropRecorSparePartGrid()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in Method CompleteDropRecorSparePartGrid()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }







        //private int GetSecondsFromTime(string tempd)
        //{
        //    int i1 = 0;
        //    int i2 = 0;

        //    try
        //    {
        //        string[] parts = new string[2];
        //        if (tempd.Contains("."))
        //        {
        //            parts = tempd.Split('.');
        //            i1 = int.Parse(parts[0]);
        //            i2 = int.Parse(parts[1]);
        //            i1 = (i1 * 60) + i2;
        //        }
        //        else
        //        {
        //            parts = tempd.Split('.');
        //            i1 = int.Parse(parts[0]);
        //            i1 = (i1 * 60);
        //        }

        //        return i1;
        //    }
        //    catch (Exception ex)
        //    {
        //        return i1;

        //    }
        //}

        //private float GetSecondsFromTimeFormat(TimeSpan vTime)
        //{
        //    float tempfloat = 0;
        //    try
        //    {
        //        int TempOTDay = vTime.Days;
        //        int TempOTHours = vTime.Hours;
        //        int TempOTminute = vTime.Minutes;
        //        int TempOTSecond = vTime.Seconds;
        //        string tempstring = Convert.ToString(((TempOTDay * 24) + TempOTHours) * 60 + TempOTminute) + "." + TempOTSecond;
        //        tempfloat = float.Parse(tempstring);
        //        return tempfloat;
        //    }
        //    catch (Exception ex)
        //    {
        //        return tempfloat;
        //    }
        //}


        private void FillSparePartGridColumn()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillSparePartGridColumn()...", category: Category.Info, priority: Priority.Low);


                if (AllSupplementsBoxMenu != null)
                {
                    var listadoDuplicadas = from c in AllSupplementsBoxMenu
                                            join c2 in AllSupplementsBoxMenu on c.Item2 equals c2.Item2
                                            where c != c2
                                            select c;

                    var SparePartSandardOperationTime = listadoDuplicadas.FirstOrDefault();
                    if (SparePartSandardOperationTime != null)
                    {
                        var templist = listadoDuplicadas.Where(a => a.Item2 == SparePartSandardOperationTime.Item2);
                        listadoDuplicadas = templist;
                    }

                    var tempSupplementsBoxMenu = AllSupplementsBoxMenu;

                    ColumnsSparePartForSupplements = new ObservableCollection<TreeListColumn>();
                    ColumnsSparePartForSupplements.Add(new TreeListColumn()
                    {
                        FieldName = "SparePartStandardSupplements",
                        Header = "Standard",
                        HeaderToolTip = "Standard",
                        AllowCellMerge = false,
                        Width = 150,    //gulab lakade not show supplement proper
                        AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                        Visible = true,
                        ReadOnly = false,
                        FixedWidth = false
                    });

                    ColumnsSparePartOperationTime = new ObservableCollection<TreeListColumn>();
                    ColumnsSparePartOperationTime.Add(new TreeListColumn()
                    {
                        FieldName = "UiTempStandardOperationTimeName",
                        Header = "Standard",
                        HeaderToolTip = "Standard",
                        AllowCellMerge = false,
                        Width = 150,    //not show StandardOperationTime proper
                        AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                        Visible = true,
                        ReadOnly = false,
                        FixedWidth = false
                    });

                    int count = 1;
                    var ColumnsSparePartList = tempSupplementsBoxMenu.Where(p => !listadoDuplicadas.Any(p2 => p2.Item1 == p.Item1));
                    foreach (var item in ColumnsSparePartList)
                    {
                        if (count == 5)
                        {
                            ColumnsSparePartForSupplements.Add(new TreeListColumn()
                            {
                                FieldName = "SparePartSupplementPlant" + count + "Value",
                                Header = "Others",
                                HeaderToolTip = "Others",
                                AllowCellMerge = false,
                                Width = 60,
                                AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                Visible = true,
                                ReadOnly = false,
                                FixedWidth = false
                            });
                            ColumnsSparePartOperationTime.Add(new TreeListColumn()
                            {
                                FieldName = "UiTempoperationTimePlant" + count + "Value",
                                Header = "Others",
                                HeaderToolTip = "Others",
                                AllowCellMerge = false,
                                Width = 60,
                                AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                                Visible = true,
                                ReadOnly = false,
                                FixedWidth = false
                            });
                            break;
                        }
                        if (count == 5)
                        {
                            break;
                        }
                        ColumnsSparePartForSupplements.Add(new TreeListColumn()
                        {
                            FieldName = "SparePartSupplementPlant" + count + "Value",
                            Header = item.Item1,
                            HeaderToolTip = item.Item1,
                            AllowCellMerge = false,
                            Width = 60,
                            AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                            Visible = true,
                            ReadOnly = false,
                            FixedWidth = false
                        });

                        ColumnsSparePartOperationTime.Add(new TreeListColumn()
                        {
                            FieldName = "UiTempoperationTimePlant" + count + "Value",
                            Header = item.Item1,
                            HeaderToolTip = item.Item1,
                            AllowCellMerge = false,
                            Width = 60,
                            AllowEditing = DevExpress.Utils.DefaultBoolean.False,
                            Visible = true,
                            ReadOnly = false,
                            FixedWidth = false
                        });
                        count = count + 1;
                    }


                    if (SparePartsMenulist != null)

                        for (int d = 0; d < SparePartsMenulist.Count(); d++)
                        {
                            if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(SparePartsMenulist[d].Name.Trim())))
                            {
                                if (SparePartSandardOperationTime != null)
                                    SparePartsMenulist[d].SparePartStandardSupplements = (float?)SparePartSandardOperationTime.Item2;
                                if (tempSupplementsBoxMenu.Any(p => !listadoDuplicadas.Any(p2 => p2.Item1 == p.Item1)))
                                {
                                    SparePartsMenulist[d].AllSupplementsBoxMenu = AllSupplementsBoxMenu;
                                    List<float?> lst = new List<float?>();

                                    var a = ColumnsSparePartList.ToList();
                                    for (int i = 0; i < a.Count(); i++)
                                    {
                                        lst.Add((float?)a[i].Item2);
                                    }

                                    if (ColumnsSparePartList.Count() == 1)
                                    {
                                        SparePartsMenulist[d].SparePartSupplementPlant1Value = (float?)lst[0];
                                    }
                                    else if (ColumnsSparePartList.Count() == 2)
                                    {
                                        SparePartsMenulist[d].SparePartSupplementPlant1Value = (float?)lst[0];
                                        SparePartsMenulist[d].SparePartSupplementPlant2Value = (float?)lst[1];
                                    }
                                    else if (ColumnsSparePartList.Count() == 3)
                                    {
                                        SparePartsMenulist[d].SparePartSupplementPlant1Value = (float?)lst[0];
                                        SparePartsMenulist[d].SparePartSupplementPlant2Value = (float?)lst[1];
                                        SparePartsMenulist[d].SparePartSupplementPlant3Value = (float?)lst[2];
                                    }
                                    else if (ColumnsSparePartList.Count() == 4)
                                    {
                                        SparePartsMenulist[d].SparePartSupplementPlant1Value = (float?)lst[0];
                                        SparePartsMenulist[d].SparePartSupplementPlant2Value = (float?)lst[1];
                                        SparePartsMenulist[d].SparePartSupplementPlant3Value = (float?)lst[2];
                                        SparePartsMenulist[d].SparePartSupplementPlant4Value = (float?)lst[3];
                                    }
                                    else if (ColumnsSparePartList.Count() == 5)
                                    {
                                        SparePartsMenulist[d].SparePartSupplementPlant1Value = (float?)lst[0];
                                        SparePartsMenulist[d].SparePartSupplementPlant2Value = (float?)lst[1];
                                        SparePartsMenulist[d].SparePartSupplementPlant3Value = (float?)lst[2];
                                        SparePartsMenulist[d].SparePartSupplementPlant4Value = (float?)lst[3];
                                        SparePartsMenulist[d].SparePartSupplementPlant5Value = (float?)lst[4];
                                    }
                                    else
                                    {
                                        SparePartsMenulist[d].SparePartSupplementPlant1Value = (float?)lst[0];
                                        SparePartsMenulist[d].SparePartSupplementPlant2Value = (float?)lst[1];
                                        SparePartsMenulist[d].SparePartSupplementPlant3Value = (float?)lst[2];
                                        SparePartsMenulist[d].SparePartSupplementPlant4Value = (float?)lst[3];
                                        SparePartsMenulist[d].SparePartSupplementPlant5Value = 0;
                                        if (ColumnsSparePartList.Count() > 5)
                                        {
                                            for (int q = 4; q < ColumnsSparePartList.Count(); q++)
                                            {
                                                if (SparePartsMenulist[d].SparePartSupplementPlant5Value == null)
                                                    SparePartsMenulist[d].SparePartSupplementPlant5Value = 0;
                                                SparePartsMenulist[d].SparePartSupplementPlant5Value = SparePartsMenulist[d].SparePartSupplementPlant5Value + (float?)lst[q];
                                            }
                                        }


                                    }

                                }

                                if (SparePartSandardOperationTime != null)
                                    SparePartsMenulist[d].SparePartStandardOperationTime = (float?)Math.Round(Convert.ToDouble(SparePartsMenulist[d].SparePartNormalTime * (1 + (SparePartSandardOperationTime.Item2 / 100))), 2);

                                SparePartsMenulist[d].SparePartOperationTimePlant1Value = (float?)Math.Round(Convert.ToDouble(SparePartsMenulist[d].SparePartNormalTime * (1 + (Convert.ToDouble(SparePartsMenulist[d].SparePartSupplementPlant1Value) / 100))), 2);
                                SparePartsMenulist[d].SparePartOperationTimePlant2Value = (float?)Math.Round(Convert.ToDouble(SparePartsMenulist[d].SparePartNormalTime * (1 + (Convert.ToDouble(SparePartsMenulist[d].SparePartSupplementPlant2Value) / 100))), 2);
                                SparePartsMenulist[d].SparePartOperationTimePlant3Value = (float?)Math.Round(Convert.ToDouble(SparePartsMenulist[d].SparePartNormalTime * (1 + (Convert.ToDouble(SparePartsMenulist[d].SparePartSupplementPlant3Value) / 100))), 2);
                                SparePartsMenulist[d].SparePartOperationTimePlant4Value = (float?)Math.Round(Convert.ToDouble(SparePartsMenulist[d].SparePartNormalTime * (1 + (Convert.ToDouble(SparePartsMenulist[d].SparePartSupplementPlant4Value) / 100))), 2);
                                SparePartsMenulist[d].SparePartOperationTimePlant5Value = (float?)Math.Round(Convert.ToDouble(SparePartsMenulist[d].SparePartNormalTime * (1 + (Convert.ToDouble(SparePartsMenulist[d].SparePartSupplementPlant5Value) / 100))), 2);
                                #region GEOS2-3954 Show the WorkOperations and SOD Time in the format: MM:SS or HH:MM:SS
                                try
                                {
                                    SparePartsMenulist[d].UiTempStandardOperationTimeName = ConvertfloattoTimespan(Convert.ToString(SparePartsMenulist[d].SparePartStandardOperationTime));
                                    SparePartsMenulist[d].UiTempoperationTimePlant1Value = ConvertfloattoTimespan(Convert.ToString(SparePartsMenulist[d].SparePartOperationTimePlant1Value));
                                    SparePartsMenulist[d].UiTempoperationTimePlant2Value = ConvertfloattoTimespan(Convert.ToString(SparePartsMenulist[d].SparePartOperationTimePlant2Value));
                                    SparePartsMenulist[d].UiTempoperationTimePlant3Value = ConvertfloattoTimespan(Convert.ToString(SparePartsMenulist[d].SparePartOperationTimePlant3Value));
                                    SparePartsMenulist[d].UiTempoperationTimePlant4Value = ConvertfloattoTimespan(Convert.ToString(SparePartsMenulist[d].SparePartOperationTimePlant4Value));
                                    SparePartsMenulist[d].UiTempoperationTimePlant5Value = ConvertfloattoTimespan(Convert.ToString(SparePartsMenulist[d].SparePartOperationTimePlant5Value));
                                }
                                catch (Exception ex)
                                {
                                    GeosApplication.Instance.Logger.Log(string.Format("Error in Method FillSparePartGridColumn() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                }
                                #endregion
                            }
                        }

                }
                GeosApplication.Instance.Logger.Log("Method FillSparePartGridColumn()....executed successfully", category: Category.Info, priority: Priority.Low);


            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method FillSparePartGridColumn() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }



        private void GetAllTreeListSparePart(WorkOperationByStages StandardOperationsDictionaryModules, ObservableCollection<WorkOperationByStages> WorkOperationMenulist)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method GetAllTreeListSparePart()...", category: Category.Info, priority: Priority.Low);


                if (StandardOperationsDictionaryModules != null && StandardOperationsDictionaryModules.Name.ToLower() != "All".ToLower())
                {

                    if (Convert.ToInt32(StandardOperationsDictionaryModules.IdParent) == Convert.ToInt32(StandardOperationsDictionaryModules.IdStage))
                    {
                        if (!operationSparePartMenulist.Any(a => a.KeyName.Equals(StandardOperationsDictionaryModules.KeyName)))
                            operationSparePartMenulist.Add(StandardOperationsDictionaryModules);
                        if (StandardOperationsDictionaryModules.IdParent == null || StandardOperationsDictionaryModules.IdStage == 0)
                        {

                        }
                        else
                        {
                            WorkOperationByStages TempStagesList = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == Convert.ToInt32(StandardOperationsDictionaryModules.IdStage) &&
                            a.KeyName.Equals(("Stage_" + Convert.ToInt32(StandardOperationsDictionaryModules.IdStage)).ToString())).FirstOrDefault();
                            if (duplicateItemloopSparePart >= 20) { TempStagesList = null; }
                            GetAllTreeListSparePart(TempStagesList, WorkOperationMenulist);
                        }
                    }
                    else
                    {
                        if (operationSparePartMenulist.Any(a => a.IdworkOperationByStage == Convert.ToInt64(StandardOperationsDictionaryModules.IdworkOperationByStage)))
                        {
                            duplicateItemloopSparePart = duplicateItemloopSparePart + 1;
                            if (duplicateItemloopSparePart >= 20)
                            {
                                GetAllTreeListSparePart(null, WorkOperationMenulist);
                            }
                        }
                        else
                        {
                            if (!operationSparePartMenulist.Any(a => a.KeyName.Equals(StandardOperationsDictionaryModules.KeyName)))
                                operationSparePartMenulist.Add(StandardOperationsDictionaryModules);
                        }
                        List<WorkOperationByStages> TempList = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == Convert.ToInt32(StandardOperationsDictionaryModules.IdParent)).ToList();
                        if (duplicateItemloopSparePart >= 20) { TempList = null; }
                        if (TempList != null)
                            foreach (WorkOperationByStages itemWorkOperationByStages in TempList)
                            {
                                GetAllTreeListSparePart(itemWorkOperationByStages, WorkOperationMenulist);
                            }
                    }

                }
                GeosApplication.Instance.Logger.Log("Method GetAllTreeListSparePart()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method GetAllTreeListSparePart()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        private void FillSparePartGroupsMenulist()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillSparePartGroupsMenulist()...", category: Category.Info, priority: Priority.Low);

                SparePartsGroups = new List<ERMSparePartsGroups>(ERMService.GetAllSparePartGroups_V2460().ToList());
                SparePartsMenulistForGridLayout = new ObservableCollection<ERMSpareParts>(ERMService.GetAllSparePart_V2460().ToList());

                if (DetectionGroupWithSpareParts == null)
                    DetectionGroupWithSpareParts = new ObservableCollection<DetectionGroupWithSpareParts>();

                if (DetectionGroupWithSpareParts.Count() == 0)
                {
                    // Sort spare parts, placing "No group" last
                    SparePartsGroups = new List<ERMSparePartsGroups>(
                        SparePartsGroups
                            .OrderBy(sparePart => sparePart.Name == "NO GROUP")
                            .ThenBy(sparePart => sparePart.Name, new AlphanumericComparer())
                            .ToList()
                    );

                    foreach (var item in SparePartsGroups)
                    {
                        DetectionGroupWithSpareParts TempDetectionGroupWithSpareParts = new DetectionGroupWithSpareParts();
                        TempDetectionGroupWithSpareParts.SpareParts = SparePartsMenulistForGridLayout
                            .Where(w => w != null && w.IdGroup == item.IdGroup)
                            .OrderBy(sparePart => sparePart.Name, new AlphanumericComparer())  // Apply alphanumeric sorting
                            .ToList();

                        #region [28 12 2022]
                        foreach (var item1 in TempDetectionGroupWithSpareParts.SpareParts)
                        {
                            UInt64 Iddetection = Convert.ToUInt64(item1.IdDetection);
                            int SparePartTypecount = tempLstStandardOperationsDictionarySparePart
                                .Where(x => x.IdDetection == Iddetection)
                                .ToList()
                                .Count();
                            item1.Name = item1.Name + "  (" + SparePartTypecount + ")";
                        }
                        #endregion

                        TempDetectionGroupWithSpareParts.Name = item.Name + "  (" + TempDetectionGroupWithSpareParts.SpareParts.Count() + ")";
                        DetectionGroupWithSpareParts.Add(TempDetectionGroupWithSpareParts);
                    }
                }

                SelectedItemSparePart = DetectionGroupWithSpareParts.First();
                GeosApplication.Instance.Logger.Log("Method FillSparePartGroupsMenulist()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log($"Error in Method FillSparePartGroupsMenulist() - {ex.Message}", category: Category.Exception, priority: Priority.Low);
            }
        }



        List<StandardOperationsDictionarySparePart> standardOperationsDictionarySparePartDeleteList = new List<StandardOperationsDictionarySparePart>();
        List<ERMSOPSpareParts> ERMSOPSparePartDeleteList = new List<ERMSOPSpareParts>();
        List<ERMSOPSpareParts> ERMSOPSparePartDeleteParentList = new List<ERMSOPSpareParts>();

        private void ERMSOPSparePartDeleteAction(List<ERMSOPSpareParts> deletelist)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ERMSOPSparePartDeleteAction()...", category: Category.Info, priority: Priority.Low);

                foreach (ERMSOPSpareParts item in deletelist)
                {
                    if (!ERMSOPSparePartDeleteList.Any(a => a.KeyName.Equals(item.KeyName)))
                    {
                        ERMSOPSparePartDeleteList.Add(item);
                        WorkOperationMenulist.Where(w => w.IdworkOperationByStage == item.IdworkOperationByStage).ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                    }

                    List<ERMSOPSpareParts> isitemExist = SparePartsMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(item.KeyName)).ToList();
                    if (deletelist != null || deletelist.Count() > 0)
                    {
                        ERMSOPSparePartDeleteAction(isitemExist);
                    }
                }
                GeosApplication.Instance.Logger.Log("Method ERMSOPSparePartDeleteAction()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method ERMSOPSparePartDeleteAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

            }
        }
        private void ERMSOPSparePartDeleteParentAction(List<ERMSOPSpareParts> deleteParentlist)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ERMSOPSparePartDeleteParentAction()...", category: Category.Info, priority: Priority.Low);

                foreach (ERMSOPSpareParts item in deleteParentlist)
                {
                    if (!ERMSOPSparePartDeleteParentList.Any(a => a.KeyName.Equals(item.KeyName)))
                    {
                        ERMSOPSparePartDeleteParentList.Add(item);
                        SparePartsMenulist.Remove(item);
                        WorkOperationMenulist.Where(w => w.IdworkOperationByStage == item.IdworkOperationByStage).ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                    }
                    List<ERMSOPSpareParts> isitemExist = SparePartsMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(item.ParentName)).ToList();
                    if (isitemExist.Count == 0)
                    {
                        List<ERMSOPSpareParts> parentlist = SparePartsMenulist.Where(w => w.KeyName.Equals(item.ParentName)).ToList();
                        ERMSOPSparePartDeleteParentAction(parentlist);
                    }

                }
                GeosApplication.Instance.Logger.Log("Method ERMSOPSparePartDeleteParentAction()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method ERMSOPSparePartDeleteParentAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

            }
        }
        private void DeleteSparePartTreeListControlCommandAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method DeleteSparePartTreeListControlCommandAction()...", category: Category.Info, priority: Priority.Low);
                MessageBoxResult MessageBoxResult = CustomMessageBox.Show(String.Format(Application.Current.Resources["WorkOperationsDeleteMessage"].ToString()), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);

                if (MessageBoxResult == MessageBoxResult.Yes)
                {
                    operationMenulist = new ObservableCollection<WorkOperationByStages>();
                    ERMSOPSparePartDeleteList = new List<ERMSOPSpareParts>();
                    ERMSOPSparePartDeleteParentList = new List<ERMSOPSpareParts>();
                    IsEnabledSaveButton = true;
                    SaveButtonVisibility = Visibility.Visible;
                    StandardOperationsDictionary tempSelectedStandardOperationsDictionary = new StandardOperationsDictionary();
                    tempSelectedStandardOperationsDictionary.IdStandardOperationsDictionary = tempLstStandardOperationsDictionarySparePart.Select(w => w.IdStandardOperationsDictionary).FirstOrDefault();
                    ERMSOPSpareParts MainRow = ((ERMSOPSpareParts)obj);
                    StandardOperationsDictionarySparePart standardOperationsDictionarySparePart = new StandardOperationsDictionarySparePart();
                    if (MainRow != null)
                    {
                        ObservableCollection<ERMSOPSpareParts> SparePartsMenulistTemp = new ObservableCollection<ERMSOPSpareParts>();
                        SparePartsMenulistTemp = SparePartsMenulist;
                        #region GEOS2-4046 Gulab Lakade
                        List<ERMSOPSpareParts> found = new List<ERMSOPSpareParts>();
                        if (!found.Any(a => a != null && a.KeyName.Trim().Equals(MainRow.KeyName.Trim())))
                            found.AddRange(SparePartsMenulistTemp.Where(s => s.IdworkOperationByStage == MainRow.IdworkOperationByStage).ToList());

                        for (int i = 0; i < found.Count(); i++)
                        {

                            standardOperationsDictionarySparePart.IdWorkoperation = Convert.ToUInt32(MainRow.IdworkOperationByStage);
                            if (SelectedItemSparePart is ERMSpareParts)
                            {
                                ERMSpareParts eRMSpareParts = (ERMSpareParts)SelectedItemSparePart;
                                standardOperationsDictionarySparePart.IdDetection = (UInt64)eRMSpareParts.IdDetection;
                            }
                            standardOperationsDictionarySparePart.ObservedTime = (float?)found[i].SparePartObservedTime;
                            #region [GEOS2-3954][Rupali Sarode]
                            standardOperationsDictionarySparePart.UITempSparePartObservedTime = ConvertfloattoTimespan(Convert.ToString(found[i].SparePartObservedTime));
                            #endregion
                            standardOperationsDictionarySparePart.Activity = (float?)found[i].SparePartActivity;

                            SparePartsMenulistTemp.Remove(found[i]);
                            WorkOperationMenulist.Where(w => w.IdworkOperationByStage == found[i].IdworkOperationByStage).ToList().ForEach(f => f.IsCurrentWorkOperation = false);

                            standardOperationsDictionarySparePartDeleteList.Add(standardOperationsDictionarySparePart);
                            List<ERMSOPSpareParts> deletelist = SparePartsMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(found[i].KeyName)).ToList();
                            if (deletelist != null)
                            {
                                ERMSOPSparePartDeleteAction(deletelist);
                            }
                            if (ERMSOPSparePartDeleteList != null)
                                foreach (ERMSOPSpareParts item in ERMSOPSparePartDeleteList)
                                {
                                    StandardOperationsDictionarySparePart standardOperationsDictionary = new StandardOperationsDictionarySparePart();
                                    standardOperationsDictionary.IdWorkoperation = Convert.ToUInt32(item.IdworkOperationByStage);
                                    if (SelectedItemSparePart is ERMSpareParts)
                                    {
                                        ERMSpareParts eRMSpareParts = (ERMSpareParts)SelectedItemSparePart;
                                        standardOperationsDictionary.IdDetection = (UInt64)eRMSpareParts.IdDetection;
                                    }
                                    standardOperationsDictionary.ObservedTime = (float?)item.SparePartObservedTime;
                                    #region [GEOS2-3954][Rupali Sarode]
                                    standardOperationsDictionary.UITempSparePartObservedTime = ConvertfloattoTimespan(Convert.ToString(item.SparePartObservedTime));
                                    #endregion
                                    standardOperationsDictionary.Activity = (float?)item.SparePartActivity;
                                    SparePartsMenulistTemp.Remove(item);
                                    standardOperationsDictionarySparePartDeleteList.Add(standardOperationsDictionary);
                                }

                            List<ERMSOPSpareParts> deleteParentlist = SparePartsMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(found[i].ParentName)).ToList();
                            if (deleteParentlist.Count == 0)
                            {
                                List<ERMSOPSpareParts> parentlist = SparePartsMenulistTemp.Where(w => w.KeyName.Equals(found[i].ParentName)).ToList();
                                ERMSOPSparePartDeleteParentAction(parentlist);
                            }
                            if (ERMSOPSparePartDeleteParentList != null)
                                foreach (ERMSOPSpareParts item in ERMSOPSparePartDeleteParentList)
                                {
                                    StandardOperationsDictionarySparePart standardOperationsDictionary = new StandardOperationsDictionarySparePart();
                                    standardOperationsDictionary.IdWorkoperation = Convert.ToUInt32(item.IdworkOperationByStage);
                                    if (SelectedItemSparePart is ERMSpareParts)
                                    {
                                        ERMSpareParts eRMSpareParts = (ERMSpareParts)SelectedItemSparePart;
                                        standardOperationsDictionary.IdDetection = (UInt64)eRMSpareParts.IdDetection;
                                    }
                                    standardOperationsDictionary.ObservedTime = (float?)item.SparePartObservedTime;
                                    #region [GEOS2-3954][Rupali Sarode]
                                    standardOperationsDictionary.UITempSparePartObservedTime = ConvertfloattoTimespan(Convert.ToString(item.SparePartObservedTime));
                                    #endregion

                                    standardOperationsDictionary.Activity = (float?)item.SparePartActivity;
                                    SparePartsMenulistTemp.Remove(item);
                                    standardOperationsDictionarySparePartDeleteList.Add(standardOperationsDictionary);
                                }
                            var tempSparePartMenulist = SparePartsMenulistTemp.ToList();
                            foreach (ERMSOPSpareParts itemRemove in tempSparePartMenulist)
                            {
                                if (GetStages.Any(a => a.Code.Equals(itemRemove.Name)))
                                {
                                    List<ERMSOPSpareParts> childList = SparePartsMenulistTemp.Where(w => w.ParentName != null && w.ParentName.Equals(itemRemove.KeyName)).ToList();
                                    if (childList.Count == 0)
                                    {
                                        SparePartsMenulistTemp.Remove(itemRemove);
                                    }
                                }

                            }
                        }
                        #endregion
                        SparePartsMenulist = new ObservableCollection<ERMSOPSpareParts>();
                        SparePartsMenulist = SparePartsMenulistTemp;
                    }
                    CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("WorkOperationDeletedSuccess").ToString()), Application.Current.Resources["PopUpSuccessColor"].ToString(), CustomMessageBox.MessageImagePath.Ok, MessageBoxButton.OK);
                }
                GeosApplication.Instance.Logger.Log("Method DeleteSparePartTreeListControlCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in DeleteSparePartTreeListControlCommandAction() Method " + ex.Detail.ErrorMessage, category: Category.Info, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in DeleteSparePartTreeListControlCommandAction() Method - ServiceUnexceptedException " + ex.Message, category: Category.Info, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method DeleteModuleTreeListControlCommandAction()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        private void SparePartCustomSummarycalculation()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method SparePartCustomSummarycalculation()...", category: Category.Info, priority: Priority.Low);

                #region calculation
                #region [GEOS2-4830][gulab lakade][07 12 2023]
                //if (SparePartsMenulist != null)
                //    //foreach (ERMSOPDetection itemERMSOPDetection in DetectionMenulist)
                //    for (int d = 0; d < SparePartsMenulist.Count(); d++)
                //    {
                //        WorkOperationMenulist.Where(w => w.KeyName == SparePartsMenulist[d].KeyName).ToList().ForEach(f => f.IsCurrentWorkOperation = true);
                //        var listCount = SparePartsMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(SparePartsMenulist[d].KeyName) && w.IsInactiveWorkOperation == false).ToList();
                //        if (listCount != null)
                //            if (listCount.Count() > 0)
                //            {
                //                // decimal a = listCount.Sum(s => s.SparePartObservedTime);

                //                SparePartsMenulist[d].SparePartObservedTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.SparePartObservedTime)), 2);
                //                SparePartsMenulist[d].SparePartNormalTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.SparePartNormalTime)), 2);

                //                //[GEOS2-3954][Rupali Sarode]
                //                SparePartsMenulist[d].UITempSparePartObservedTime = ConvertfloattoTimespan(Convert.ToString(Convert.ToDouble(listCount.Sum(s => s.SparePartObservedTime))));
                //                SparePartsMenulist[d].UITempSparePartNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(Convert.ToDouble(listCount.Sum(s => s.SparePartNormalTime))));

                //                SparePartsMenulist[d].IsReadOnly = true;
                //            }
                //    }
                #endregion
                if (SparePartsMenulist != null)
                    for (int d = 0; d < SparePartsMenulist.Count(); d++)
                    {
                        WorkOperationMenulist.Where(w => w.KeyName == SparePartsMenulist[d].KeyName).ToList().ForEach(f => f.IsCurrentWorkOperation = true);
                        //[GEOS2-5135][Rupali Sarode][18-12-2023]
                        //var listCount = SparePartsMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(SparePartsMenulist[d].KeyName) && w.IsInactiveWorkOperation == false).ToList();
                        var listCount = SparePartsMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(SparePartsMenulist[d].KeyName)).ToList();

                        if (listCount != null)
                            if (listCount.Count() > 0)
                            {
                                SparePartsMenulist[d].SparePartObservedTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.SparePartObservedTime)), 2);
                                SparePartsMenulist[d].SparePartNormalTime = Math.Round(Convert.ToDouble(listCount.Sum(s => s.SparePartNormalTime)), 2);

                                //[GEOS2-3954][Rupali Sarode]
                                SparePartsMenulist[d].UITempSparePartObservedTime = ConvertfloattoTimespan(Convert.ToString(listCount.Sum(s => s.SparePartObservedTime)));
                                SparePartsMenulist[d].UITempSparePartNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(listCount.Sum(s => s.SparePartNormalTime)));

                                SparePartsMenulist[d].IsReadOnly = true;
                            }
                    }

                if (SparePartsMenulist != null)
                    //foreach (ERMSOPDetection itemERMSOPDetection in DetectionMenulist)
                    for (int d = 0; d < SparePartsMenulist.Count(); d++)
                    {
                        if (GetStages.Any(a => a.Code.Equals(SparePartsMenulist[d].Name)))
                        {
                            ObservableCollection<ERMSOPSpareParts> ActivitySum = new ObservableCollection<ERMSOPSpareParts>();
                            ObservableCollection<ERMSOPSpareParts> TempActivitySum = new ObservableCollection<ERMSOPSpareParts>();
                            int x = 1;
                            Loop:
                            x++;
                            if (x < 10)
                            {
                                if (ActivitySum.Count == 0)
                                {
                                    SparePartsMenulist[d].SparePartObservedTime = 0;
                                    SparePartsMenulist[d].SparePartNormalTime = 0;

                                    //[GEOS2-3954][Rupali Sarode]
                                    SparePartsMenulist[d].UITempSparePartObservedTime = ConvertfloattoTimespan(Convert.ToString(SparePartsMenulist[d].SparePartObservedTime));
                                    SparePartsMenulist[d].UITempSparePartNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(SparePartsMenulist[d].SparePartNormalTime));
                                    //[GEOS2-5135][Rupali Sarode][18-12-2023]
                                    // var ActivitySumList = SparePartsMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(SparePartsMenulist[d].KeyName) && w.IsInactiveWorkOperation == false).ToList();
                                    var ActivitySumList = SparePartsMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(SparePartsMenulist[d].KeyName)).ToList();
                                    ActivitySum.AddRange(ActivitySumList);
                                }
                                else
                                {
                                    //foreach (var item in ActivitySum)
                                    //{
                                    //    var ActivitySumList = DetectionMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(item.KeyName)).ToList();
                                    //    if (ActivitySumList != null && ActivitySumList.Count > 0)
                                    //    {

                                    //        foreach (var itemActivity in ActivitySumList)
                                    //        {
                                    //            if (!ActivitySum.Any(ac => ac.KeyName.Equals(itemActivity.KeyName)))
                                    //            {
                                    //                TempActivitySum.Add(itemActivity);
                                    //            }

                                    //        }

                                    //    }

                                    //}
                                    //ActivitySum.AddRange(TempActivitySum);
                                }


                                goto Loop;
                            }

                            double? ObservedTime = 0;
                            double? NormalTime = 0;
                            float? StandardTime = 0;
                            float? OperationTimePlant1Value = 0;
                            float? OperationTimePlant2Value = 0;
                            float? OperationTimePlant3Value = 0;
                            float? OperationTimePlant4Value = 0;
                            float? OperationTimePlant5Value = 0;
                            var tempDistinctList = ActivitySum.Select(xa => xa.KeyName).Distinct().ToList();
                            foreach (var item in tempDistinctList)
                            {
                                if (SparePartsMenulist[d].SparePartObservedTime == null)
                                    SparePartsMenulist[d].SparePartObservedTime = 0;
                                double? tempObservedTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.SparePartObservedTime).FirstOrDefault();
                                if (tempObservedTime != null)
                                {
                                    ObservedTime = Math.Round(Convert.ToDouble(ObservedTime + tempObservedTime), 2);
                                    //[GEOS2-3954][Rupali Sarode]
                                    SparePartsMenulist[d].UITempSparePartObservedTime = ConvertfloattoTimespan(Convert.ToString(ObservedTime));
                                }
                                if (SparePartsMenulist[d].SparePartNormalTime == null)
                                    SparePartsMenulist[d].SparePartNormalTime = 0;
                                double? tempNormalTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.SparePartNormalTime).FirstOrDefault();
                                if (tempNormalTime != null)
                                {
                                    NormalTime = Math.Round(Convert.ToDouble(NormalTime + tempNormalTime), 2);
                                    SparePartsMenulist[d].UITempSparePartNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(NormalTime));
                                }

                            }
                            SparePartsMenulist[d].SparePartObservedTime = ObservedTime;
                            SparePartsMenulist[d].SparePartNormalTime = NormalTime;

                            //[GEOS2-3954][Rupali Sarode]
                            SparePartsMenulist[d].UITempSparePartObservedTime = ConvertfloattoTimespan(Convert.ToString(ObservedTime));
                            SparePartsMenulist[d].UITempSparePartNormalTime = ConvertfloattoTimespanForNormalTime(Convert.ToString(NormalTime));

                            //DetectionMenulist[d].DetectionNormalTime = Math.Round(Convert.ToDouble(ObservedTime * DetectionMenulist[d].DetectionActivity / 100), 2);
                            #region PlantValue


                            foreach (var item in tempDistinctList)
                            {
                                if (SparePartsMenulist[d].SparePartStandardOperationTime == null)
                                    SparePartsMenulist[d].SparePartStandardOperationTime = 0;
                                float? tempStandardTime = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.SparePartStandardOperationTime).FirstOrDefault();
                                if (tempStandardTime != null)
                                    StandardTime = StandardTime + tempStandardTime;

                                if (SparePartsMenulist[d].SparePartOperationTimePlant1Value == null)
                                    SparePartsMenulist[d].SparePartOperationTimePlant1Value = 0;
                                float? tempOperationTimePlant1Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.SparePartOperationTimePlant1Value).FirstOrDefault();
                                if (tempOperationTimePlant1Value != null)
                                    OperationTimePlant1Value = OperationTimePlant1Value + tempOperationTimePlant1Value;

                                if (SparePartsMenulist[d].SparePartOperationTimePlant2Value == null)
                                    SparePartsMenulist[d].SparePartOperationTimePlant2Value = 0;
                                float? tempOperationTimePlant2Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.SparePartOperationTimePlant2Value).FirstOrDefault();
                                if (tempOperationTimePlant2Value != null)
                                    OperationTimePlant2Value = OperationTimePlant2Value + tempOperationTimePlant2Value;

                                if (SparePartsMenulist[d].SparePartOperationTimePlant3Value == null)
                                    SparePartsMenulist[d].SparePartOperationTimePlant3Value = 0;
                                float? tempOperationTimePlant3Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.SparePartOperationTimePlant3Value).FirstOrDefault();
                                if (tempOperationTimePlant3Value != null)
                                    OperationTimePlant3Value = OperationTimePlant3Value + tempOperationTimePlant3Value;

                                if (SparePartsMenulist[d].SparePartOperationTimePlant4Value == null)
                                    SparePartsMenulist[d].SparePartOperationTimePlant4Value = 0;
                                float? tempOperationTimePlant4Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.SparePartOperationTimePlant4Value).FirstOrDefault();
                                if (tempOperationTimePlant4Value != null)
                                    OperationTimePlant4Value = OperationTimePlant4Value + tempOperationTimePlant4Value;

                                if (SparePartsMenulist[d].SparePartOperationTimePlant5Value == null)
                                    SparePartsMenulist[d].SparePartOperationTimePlant5Value = 0;
                                float? tempOperationTimePlant5Value = ActivitySum.Where(w => w.KeyName.Equals(item)).Select(s => s.SparePartOperationTimePlant5Value).FirstOrDefault();
                                if (tempOperationTimePlant5Value != null)
                                    OperationTimePlant5Value = OperationTimePlant5Value + tempOperationTimePlant5Value;
                            }
                            #endregion
                            SparePartsMenulist[d].SparePartStandardOperationTime = (float?)Math.Round(Convert.ToDouble(StandardTime), 2);
                            SparePartsMenulist[d].SparePartOperationTimePlant1Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant1Value), 2);
                            SparePartsMenulist[d].SparePartOperationTimePlant2Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant2Value), 2);
                            SparePartsMenulist[d].SparePartOperationTimePlant3Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant3Value), 2);
                            SparePartsMenulist[d].SparePartOperationTimePlant4Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant4Value), 2);
                            SparePartsMenulist[d].SparePartOperationTimePlant5Value = (float?)Math.Round(Convert.ToDouble(OperationTimePlant5Value), 2);
                            #region GEOS2-3954 Show the WorkOperations and SOD Time in the format: MM:SS or HH:MM:SS
                            try
                            {
                                SparePartsMenulist[d].UiTempStandardOperationTimeName = ConvertfloattoTimespan(Convert.ToString(SparePartsMenulist[d].SparePartStandardOperationTime));
                                SparePartsMenulist[d].UiTempoperationTimePlant1Value = ConvertfloattoTimespan(Convert.ToString(SparePartsMenulist[d].SparePartOperationTimePlant1Value));
                                SparePartsMenulist[d].UiTempoperationTimePlant2Value = ConvertfloattoTimespan(Convert.ToString(SparePartsMenulist[d].SparePartOperationTimePlant2Value));
                                SparePartsMenulist[d].UiTempoperationTimePlant3Value = ConvertfloattoTimespan(Convert.ToString(SparePartsMenulist[d].SparePartOperationTimePlant3Value));
                                SparePartsMenulist[d].UiTempoperationTimePlant4Value = ConvertfloattoTimespan(Convert.ToString(SparePartsMenulist[d].SparePartOperationTimePlant4Value));
                                SparePartsMenulist[d].UiTempoperationTimePlant5Value = ConvertfloattoTimespan(Convert.ToString(SparePartsMenulist[d].SparePartOperationTimePlant5Value));
                            }
                            catch (Exception ex)
                            {
                                GeosApplication.Instance.Logger.Log(string.Format("Error in Method SparePartCustomSummarycalculation() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            }
                            #endregion
                        }
                    }
                #endregion              

                GeosApplication.Instance.Logger.Log("Method SparePartCustomSummarycalculation()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log(string.Format("Error in method SparePartCustomSummarycalculation() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

            }

        }


        // change check

        private void SparePartGridParentMenuTreeList_CellValueChangedCommandAction(object sender)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method SparePartGridParentMenuTreeList_CellValueChangedCommandAction()...", category: Category.Info, priority: Priority.Low);

                if (sender is DevExpress.Xpf.Grid.TreeList.TreeListCellValueChangedEventArgs)
                {
                    if (sender != null)
                    {
                        FlagToDragDrop = true;
                        IsEnabledSaveButton = true;
                        SaveButtonVisibility = Visibility.Visible;
                        TreeListCellValueChangedEventArgs obj = (TreeListCellValueChangedEventArgs)sender;
                        if (!obj.Cell.Property.Equals("Remarks"))  //[GEOS2-4108][Rupali Sarode][6-1-2023]
                        {

                            if (obj.Value != null)
                            {

                                #region [GEOS2-3954] [Rupali Sarode] Time format HH:mm:ss

                                //float tempnewvalue = float.Parse(ConvertTimespantoFloat(Convert.ToString(obj.Value)));
                                //double? NewValue = 0;

                                //if (Convert.ToString(obj.Value).Contains(":"))
                                //    NewValue = Math.Round(Convert.ToDouble(string.IsNullOrEmpty(tempnewvalue.ToString()) ? 0 : tempnewvalue), 2);
                                //else
                                //    NewValue = Math.Round(Convert.ToDouble(string.IsNullOrEmpty(obj.Value.ToString()) ? 0 : obj.Value), 2);

                                double? NewValue;
                                if (obj.Cell.Property.Equals("UITempSparePartObservedTime"))
                                {
                                    //tempnewvalue = ConvertTimespantoFloat(TimeSpan.FromMinutes(Convert.ToDouble(obj.Value)));
                                    NewValue = Math.Round(Convert.ToDouble(TimeSpan.Parse(Convert.ToString(obj.Value)).TotalMinutes), 2); // ConvertTimespantoFloat(TimeSpan.Parse(obj.Value));
                                }
                                else
                                {
                                    NewValue = Math.Round(Convert.ToDouble(Convert.ToString(obj.Value)), 2);
                                }
                                if (NewValue != null)
                                {
                                    //if (obj.Cell.Property.Equals("UITempSparePartObservedTime"))
                                    //    NewValueTime = string.IsNullOrEmpty(obj.Value.ToString()) ? TimeSpan.FromSeconds(0) : TimeSpan.Parse(obj.Value.ToString());
                                    //else
                                    //    NewValue = Math.Round(Convert.ToDouble(string.IsNullOrEmpty(obj.Value.ToString()) ? 0 : obj.Value), 2);

                                    if (NewValue != null)
                                        if (obj.Cell.Property.Equals("ObservedTime"))
                                        {
                                            SparePartsMenulist.Where(w => w.IdworkOperationByStage == SelectedSparePartsMenuItem.IdworkOperationByStage).ToList().ForEach(f => f.SparePartObservedTime = NewValue);
                                        }
                                        else if (obj.Cell.Property.Equals("Activity"))
                                        {
                                            SparePartsMenulist.Where(w => w.IdworkOperationByStage == SelectedSparePartsMenuItem.IdworkOperationByStage).ToList().ForEach(f => f.SparePartActivity = NewValue);
                                        }
                                        else if (obj.Cell.Property.Equals("UITempSparePartObservedTime"))
                                        {
                                            try
                                            {
                                                SparePartsMenulist.Where(w => w.IdworkOperationByStage == SelectedSparePartsMenuItem.IdworkOperationByStage).ToList().ForEach(f => f.UITempSparePartObservedTime = ConvertfloattoTimespan(Convert.ToString(NewValue)));
                                                SparePartsMenulist.Where(w => w.IdworkOperationByStage == SelectedSparePartsMenuItem.IdworkOperationByStage).ToList().ForEach(f => f.SparePartObservedTime = NewValue);
                                            }
                                            catch (Exception ex)
                                            { }

                                        }
                                }
                                #endregion
                            }
                        }

                        if (!obj.Cell.Property.Equals("Remarks"))  //[GEOS2-4108][Rupali Sarode][6-1-2023]
                            SparePartCustomSummarycalculation();
                    }
                }
                GeosApplication.Instance.Logger.Log("Method SparePartGridParentMenuTreeList_CellValueChangedCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log(string.Format("Error in method SparePartsGridParentMenuTreeList_CellValueChangedCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }


        private void SparePartGridParentMenuTreeList_CellValueChangingCommandAction(object sender)
        {

        }

        private void SparePartCustomSummaryCommandAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method SparePartCustomSummaryCommandAction()...", category: Category.Info, priority: Priority.Low);

                TreeListCustomSummaryEventArgs e = (TreeListCustomSummaryEventArgs)obj;
                if (e.SummaryItem.FieldName == "SparePartObservedTime")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPSpareParts temp = (ERMSOPSpareParts)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                if (e.TotalValue != null)
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);

                            }

                        }

                    }
                }

                if (e.SummaryItem.FieldName == "UITempSparePartObservedTime")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPSpareParts temp = (ERMSOPSpareParts)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                //e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                //if (e.TotalValue != null)
                                //    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);

                                #region Time changes 28 11 2022
                                TimeSpan temp3 = TimeSpan.Parse(e.FieldValue.ToString());
                                double TempFieldValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.FieldValue)))
                                {
                                    TempFieldValue = 0;
                                }
                                else
                                {
                                    TempFieldValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.FieldValue)).TotalMinutes);
                                }

                                double TempTotalValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.TotalValue)))
                                {
                                    TempTotalValue = 0;
                                }
                                else
                                {
                                    TempTotalValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.TotalValue)).TotalMinutes);
                                }

                                e.TotalValue = TempTotalValue + TempFieldValue;
                                if (e.TotalValue != null)
                                {
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    e.TotalValue = ConvertfloattoTimespan(Convert.ToString(e.TotalValue));

                                    #endregion

                                }
                                #endregion
                            }

                        }

                    }
                }


                if (e.SummaryItem.FieldName == "SparePartNormalTime")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPSpareParts temp = (ERMSOPSpareParts)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                if (e.TotalValue != null)
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                            }

                        }

                    }
                }

                if (e.SummaryItem.FieldName == "UITempSparePartNormalTime")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPSpareParts temp = (ERMSOPSpareParts)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                //e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                //if (e.TotalValue != null)
                                //    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);

                                #region Time changes 28 11 2022
                                TimeSpan temp3 = TimeSpan.Parse(e.FieldValue.ToString());
                                double TempFieldValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.FieldValue)))
                                {
                                    TempFieldValue = 0;
                                }
                                else
                                {
                                    TempFieldValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.FieldValue)).TotalMinutes);
                                }

                                double TempTotalValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.TotalValue)))
                                {
                                    TempTotalValue = 0;
                                }
                                else
                                {
                                    TempTotalValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.TotalValue)).TotalMinutes);
                                }

                                e.TotalValue = TempTotalValue + TempFieldValue;
                                if (e.TotalValue != null)
                                {
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    e.TotalValue = ConvertfloattoTimespan(Convert.ToString(e.TotalValue));

                                    #endregion

                                }
                                #endregion

                            }

                        }

                    }
                }

                if (e.SummaryItem.FieldName == "SparePartStandardOperationTime")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPSpareParts temp = (ERMSOPSpareParts)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                if (e.TotalValue != null)
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                            }

                        }

                    }
                }
                if (e.SummaryItem.FieldName == "SparePartOperationTimePlant1Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPSpareParts temp = (ERMSOPSpareParts)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                if (e.TotalValue != null)
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                            }

                        }

                    }
                }


                if (e.SummaryItem.FieldName == "SparePartOperationTimePlant2Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPSpareParts temp = (ERMSOPSpareParts)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {

                                e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                if (e.TotalValue != null)
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                            }

                        }

                    }
                }


                if (e.SummaryItem.FieldName == "SparePartOperationTimePlant3Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPSpareParts temp = (ERMSOPSpareParts)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {

                                e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                if (e.TotalValue != null)
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                            }

                        }

                    }
                }

                if (e.SummaryItem.FieldName == "SparePartOperationTimePlant4Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPSpareParts temp = (ERMSOPSpareParts)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {

                                e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                if (e.TotalValue != null)
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                            }

                        }

                    }
                }

                if (e.SummaryItem.FieldName == "SparePartOperationTimePlant5Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPSpareParts temp = (ERMSOPSpareParts)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {

                                e.TotalValue = Convert.ToDouble(e.TotalValue) + Convert.ToDouble(e.FieldValue);
                                if (e.TotalValue != null)
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                            }

                        }

                    }
                }


                #region GEOS2-3954 Show the WorkOperations and SOD Time in the format: MM:SS or HH:MM:SS
                if (e.SummaryItem.FieldName == "UiTempStandardOperationTimeName")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {

                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPSpareParts temp = (ERMSOPSpareParts)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                #region Time changes 28 11 2022
                                TimeSpan temp3 = TimeSpan.Parse(e.FieldValue.ToString());
                                double TempFieldValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.FieldValue)))
                                {
                                    TempFieldValue = 0;
                                }
                                else
                                {
                                    TempFieldValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.FieldValue)).TotalMinutes);
                                }

                                double TempTotalValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.TotalValue)))
                                {
                                    TempTotalValue = 0;
                                }
                                else
                                {
                                    TempTotalValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.TotalValue)).TotalMinutes);
                                }

                                e.TotalValue = TempTotalValue + TempFieldValue;
                                if (e.TotalValue != null)
                                {
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    e.TotalValue = ConvertfloattoTimespan(Convert.ToString(e.TotalValue));

                                    #endregion

                                }
                                #endregion
                            }
                        }

                    }
                }


                if (e.SummaryItem.FieldName == "UiTempoperationTimePlant1Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPSpareParts temp = (ERMSOPSpareParts)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                #region Time changes 28 11 2022
                                TimeSpan temp3 = TimeSpan.Parse(e.FieldValue.ToString());
                                double TempFieldValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.FieldValue)))
                                {
                                    TempFieldValue = 0;
                                }
                                else
                                {
                                    TempFieldValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.FieldValue)).TotalMinutes);
                                }

                                double TempTotalValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.TotalValue)))
                                {
                                    TempTotalValue = 0;
                                }
                                else
                                {
                                    TempTotalValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.TotalValue)).TotalMinutes);
                                }

                                e.TotalValue = TempTotalValue + TempFieldValue;
                                if (e.TotalValue != null)
                                {
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    e.TotalValue = ConvertfloattoTimespan(Convert.ToString(e.TotalValue));

                                    #endregion

                                }
                                #endregion
                            }

                        }
                    }
                }
                if (e.SummaryItem.FieldName == "UiTempoperationTimePlant2Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPSpareParts temp = (ERMSOPSpareParts)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                #region Time changes 28 11 2022
                                TimeSpan temp3 = TimeSpan.Parse(e.FieldValue.ToString());
                                double TempFieldValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.FieldValue)))
                                {
                                    TempFieldValue = 0;
                                }
                                else
                                {
                                    TempFieldValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.FieldValue)).TotalMinutes);
                                }

                                double TempTotalValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.TotalValue)))
                                {
                                    TempTotalValue = 0;
                                }
                                else
                                {
                                    TempTotalValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.TotalValue)).TotalMinutes);
                                }

                                e.TotalValue = TempTotalValue + TempFieldValue;
                                if (e.TotalValue != null)
                                {
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    e.TotalValue = ConvertfloattoTimespan(Convert.ToString(e.TotalValue));

                                    #endregion

                                }
                                #endregion
                            }

                        }

                    }
                }
                if (e.SummaryItem.FieldName == "UiTempoperationTimePlant3Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPSpareParts temp = (ERMSOPSpareParts)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                #region Time changes 28 11 2022
                                TimeSpan temp3 = TimeSpan.Parse(e.FieldValue.ToString());
                                double TempFieldValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.FieldValue)))
                                {
                                    TempFieldValue = 0;
                                }
                                else
                                {
                                    TempFieldValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.FieldValue)).TotalMinutes);
                                }

                                double TempTotalValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.TotalValue)))
                                {
                                    TempTotalValue = 0;
                                }
                                else
                                {
                                    TempTotalValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.TotalValue)).TotalMinutes);
                                }

                                e.TotalValue = TempTotalValue + TempFieldValue;
                                if (e.TotalValue != null)
                                {
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    e.TotalValue = ConvertfloattoTimespan(Convert.ToString(e.TotalValue));

                                    #endregion

                                }
                                #endregion
                            }

                        }

                    }
                }
                if (e.SummaryItem.FieldName == "UiTempoperationTimePlant4Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPSpareParts temp = (ERMSOPSpareParts)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                #region Time changes 28 11 2022
                                TimeSpan temp3 = TimeSpan.Parse(e.FieldValue.ToString());
                                double TempFieldValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.FieldValue)))
                                {
                                    TempFieldValue = 0;
                                }
                                else
                                {
                                    TempFieldValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.FieldValue)).TotalMinutes);
                                }

                                double TempTotalValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.TotalValue)))
                                {
                                    TempTotalValue = 0;
                                }
                                else
                                {
                                    TempTotalValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.TotalValue)).TotalMinutes);
                                }

                                e.TotalValue = TempTotalValue + TempFieldValue;
                                if (e.TotalValue != null)
                                {
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    e.TotalValue = ConvertfloattoTimespan(Convert.ToString(e.TotalValue));

                                    #endregion

                                }
                                #endregion
                            }

                        }
                    }
                }

                if (e.SummaryItem.FieldName == "UiTempoperationTimePlant5Value")
                {
                    if (e.SummaryProcess == CustomSummaryProcess.Calculate)
                    {
                        if (e.FieldValue != null && e.Node != null)
                        {
                            ERMSOPSpareParts temp = (ERMSOPSpareParts)(e.Node.Content);
                            if (GetStages.Any(a => a != null && a.Code.Trim().Equals(temp.Name.Trim())))
                            {
                                #region Time changes 28 11 2022
                                TimeSpan temp3 = TimeSpan.Parse(e.FieldValue.ToString());
                                double TempFieldValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.FieldValue)))
                                {
                                    TempFieldValue = 0;
                                }
                                else
                                {
                                    TempFieldValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.FieldValue)).TotalMinutes);
                                }

                                double TempTotalValue = 0;
                                if (string.IsNullOrEmpty(Convert.ToString(e.TotalValue)))
                                {
                                    TempTotalValue = 0;
                                }
                                else
                                {
                                    TempTotalValue = Convert.ToDouble(TimeSpan.Parse(Convert.ToString(e.TotalValue)).TotalMinutes);
                                }

                                e.TotalValue = TempTotalValue + TempFieldValue;
                                if (e.TotalValue != null)
                                {
                                    e.TotalValue = Math.Round(Convert.ToDouble(e.TotalValue), 2);
                                    #region GEOS2-3954 gulab lakade Time format HH:mm:ss
                                    e.TotalValue = ConvertfloattoTimespan(Convert.ToString(e.TotalValue));

                                    #endregion

                                }
                                #endregion
                            }

                        }
                    }
                }
                #endregion

                GeosApplication.Instance.Logger.Log("Method SparePartCustomSummaryCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {

                GeosApplication.Instance.Logger.Log(string.Format("Error in method SparePartCustomSummaryCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

            }
        }

        private void SparePartTreeListViewLoadedCommandAction(RoutedEventArgs obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method SparePartTreeListViewLoadedCommandAction ...", category: Category.Info, priority: Priority.Low);

                DetectiontreeListControlInstance = (TreeListControl)((DevExpress.Xpf.Grid.TreeListView)obj.OriginalSource).DataControl;

                GeosApplication.Instance.Logger.Log("Method SparePartTreeListViewLoadedCommandAction() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in SparePartTreeListViewLoadedCommandAction() Method " + ex.Message, category: Category.Info, priority: Priority.Low);
            }
        }
        //End change 











        #endregion



        private void moduleLogs()
        {
            try
            {
                //List<StandardOperationsDictionaryModules> standardOperationsDictionaryModulesList;
                GeosApplication.Instance.Logger.Log("Method moduleLogs()...", category: Category.Info, priority: Priority.Low);

                ProductTypes productTypes = (ProductTypes)SelectedItem;
                string Template = Convert.ToString(productTypes.Template);
                var IdCpTypeForDelete = productTypes.IdCPType;
                string subTemplate = Convert.ToString(productTypes.Name);
                string SODoldRemarks = string.Empty;
                string SODnewRemarks = string.Empty;

                //[GEOS2-4108][Rupali Sarode][3-1-2022]
                ObservableCollection<ProductTypes> ProductTypesMenulistForGridLayoutForLog;

                ProductTypesMenulistForGridLayoutForLog = new ObservableCollection<ProductTypes>(ERMService.GetAllProductTypes_V2270().ToList().Where(a => a.Template == null || a.Template.IdTemplate != 24).ToList());

                #region GEOS2-3856 Add Log for Modules
                if (ModuleMenulist != null && ModuleMenulist.Count > 0)
                {
                    try
                    {
                        string ParentName = string.Empty;
                        ulong tIdCpType = 0; //[GEOS2-3909][Rupali Sarode][10-11-2022]
                        var temp = tempWorkOperationClonedModule;
                        var temp2 = ModuleMenulist;
                        string childs = string.Empty;

                        //[Rupali Sarode][02-12-2022]
                        //var Newworkoperationlist = ModuleMenulist.Except(tempWorkOperationClonedModule).ToList();

                        var Newworkoperationlist = ModuleMenulist.Where(x => !tempWorkOperationClonedModule.Any(y => y.IdworkOperationByStage == x.IdworkOperationByStage
                        && y.IdCpType == x.IdCpType)).ToList();

                        if (Newworkoperationlist.Count > 0)
                        {
                            for (int i = 0; i < Newworkoperationlist.Count; i++)
                            {
                                if (GetStages.Any(a => a.Code.Equals(Newworkoperationlist[i].Name)))
                                {
                                }
                                else
                                {
                                    //if (Newworkoperationlist[i].IdStatus != 1536)
                                    //{

                                    //[Rupali Sarode][02-12-2022]
                                    //List<ERMSOPModule> childList = Newworkoperationlist.Where(w => w.ParentName != null && w.ParentName.Equals(Newworkoperationlist[i].KeyName)).ToList();
                                    List<WorkOperationByStages> childList = WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(Newworkoperationlist[i].KeyName)).ToList();
                                    if (childList.Count == 0)
                                    {
                                        if (string.IsNullOrEmpty(childs))
                                        {
                                            childs = Newworkoperationlist[i].Name.Trim();
                                            tIdCpType = Convert.ToUInt64(Newworkoperationlist[i].IdCpType);
                                        }
                                        else
                                            childs = childs + ", " + Newworkoperationlist[i].Name.Trim();
                                    }
                                    // }
                                }
                            }
                            string log = string.Empty;
                            if (!string.IsNullOrEmpty(childs))
                            {
                                // TemplateWithCPTypes.ProductTypesMenu
                                //[GEOS2-3909][Rupali Sarode][09-11-2022]
                                //log = "In Module " + Convert.ToString(subTemplate) + " " + Convert.ToString(childs) + " has been added.";
                                string cpTypeName = string.Empty;

                                //  cpTypeName = TemplateWithCPTypes.Where(x => x.ProductTypesMenu.Where(i => i.IdCPType i.IdCPType == 1) == 1).ToList();
                                //cpTypeName = TemplateWithCPTypes.Where(x => x.ProductTypesMenu.Where(i => i.IdCPType == Convert.ToUInt64(Newworkoperationlist[0].IdCpType)).Select (s => s.Name).FirstOrDefault());


                                //cpTypeName = ProductTypesMenulistForGridLayout.Where(x => x.IdCPType == tIdCpType).Select(y => y.Name).FirstOrDefault().ToString();


                                cpTypeName = ProductTypesMenulistForGridLayoutForLog.Where(x => x.IdCPType == tIdCpType).Select(y => y.Name).FirstOrDefault().ToString();

                                if (!string.IsNullOrEmpty(cpTypeName))
                                {
                                    log = "In Module " + Convert.ToString(cpTypeName) + " " + Convert.ToString(childs) + " has been added.";
                                    StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                }
                            }
                        }



                        //if (Newworkoperationlist.Count > 0)
                        //{

                        //    //string Name = string.Empty;
                        //    var AddNewworkoperation = Newworkoperationlist.Where(x => x.IdParent == null).ToList();
                        //    List<string> templist = new List<string>();

                        //    if (AddNewworkoperation.Count > 0)
                        //    {
                        //        string oldparent = string.Empty;
                        //        string tempName = string.Empty;
                        //        foreach (var Parentitem in AddNewworkoperation)
                        //        {


                        //            string Keyname = Convert.ToString(Parentitem.KeyName);
                        //            ParentName = Convert.ToString(Parentitem.Name);
                        //            //tempName = tempName + ParentName;

                        //            if (!string.IsNullOrEmpty(Keyname))
                        //            {
                        //                var parent = Newworkoperationlist.Where(x => x.ParentName == Keyname && x.IdStatus != 1536).ToList();

                        //                if (parent == null)
                        //                {

                        //                }
                        //                else
                        //                {
                        //                    foreach (var itemchild in parent)
                        //                    {
                        //                        //tempName = tempName + ", " + Convert.ToString(itemchild.Name);
                        //                        var child = Newworkoperationlist.Where(x => x.ParentName == itemchild.KeyName && x.IdStatus != 1536).ToList();

                        //                        if (child.Count == 0)
                        //                        {
                        //                            if (itemchild.IdStatus != 1536)
                        //                            {

                        //                                if (!string.IsNullOrEmpty(tempName))
                        //                                {
                        //                                    tempName = tempName + ", " + Convert.ToString(itemchild.Name);
                        //                                }
                        //                                else
                        //                                {
                        //                                    tempName = tempName + " " + Convert.ToString(itemchild.Name);
                        //                                }

                        //                            }

                        //                        }
                        //                        else
                        //                        {
                        //                            foreach (var itemchild1 in child)
                        //                            {
                        //                                //tempName = tempName + ", " + Convert.ToString(itemchild1.Name);
                        //                                var child1 = Newworkoperationlist.Where(x => x.ParentName == itemchild1.KeyName && x.IdStatus != 1536).ToList();
                        //                                if (child1.Count == 0)
                        //                                {
                        //                                    if (itemchild1.IdStatus != 1536)
                        //                                    {
                        //                                        //if (itemchild1.IsInactiveWorkOperation == false)
                        //                                        if (!string.IsNullOrEmpty(tempName))
                        //                                        {
                        //                                            tempName = tempName + ", " + Convert.ToString(itemchild1.Name);
                        //                                        }
                        //                                        else
                        //                                        {
                        //                                            tempName = tempName + " " + Convert.ToString(itemchild1.Name);
                        //                                        }
                        //                                    }
                        //                                }
                        //                                else
                        //                                {
                        //                                    foreach (var itemchild2 in child1)
                        //                                    {
                        //                                        //tempName = tempName + ", " + Convert.ToString(itemchild2.Name);
                        //                                        var child2 = Newworkoperationlist.Where(x => x.ParentName == itemchild2.KeyName && x.IdStatus != 1536).ToList();
                        //                                        if (child2.Count == 0)
                        //                                        {
                        //                                            if (itemchild2.IdStatus != 1536)     //  && itemchild2.IsInactiveWorkOperation == false
                        //                                            {
                        //                                                if (!string.IsNullOrEmpty(tempName))
                        //                                                {
                        //                                                    tempName = tempName + ", " + Convert.ToString(itemchild2.Name);
                        //                                                }
                        //                                                else
                        //                                                {
                        //                                                    tempName = tempName + " " + Convert.ToString(itemchild2.Name);
                        //                                                }
                        //                                            }
                        //                                        }
                        //                                        else
                        //                                        {
                        //                                            foreach (var itemchild3 in child2)
                        //                                            {
                        //                                                //tempName = tempName + ", " + Convert.ToString(itemchild3.Name);
                        //                                                var child3 = Newworkoperationlist.Where(x => x.ParentName == itemchild3.KeyName && x.IdStatus != 1536).ToList();
                        //                                                if (child3.Count == 0)
                        //                                                {
                        //                                                    if (itemchild3.IdStatus != 1536)     //&& itemchild3.IsInactiveWorkOperation == false
                        //                                                    {
                        //                                                        if (!string.IsNullOrEmpty(tempName))
                        //                                                        {
                        //                                                            tempName = tempName + ", " + Convert.ToString(itemchild3.Name);
                        //                                                        }
                        //                                                        else
                        //                                                        {
                        //                                                            tempName = tempName + " " + Convert.ToString(itemchild3.Name);
                        //                                                        }
                        //                                                    }
                        //                                                }
                        //                                                else
                        //                                                {
                        //                                                    foreach (var itemchild4 in child3)
                        //                                                    {
                        //                                                        //tempName = tempName + ", " + Convert.ToString(itemchild3.Name);
                        //                                                        var child4 = Newworkoperationlist.Where(x => x.ParentName == itemchild4.KeyName).ToList();
                        //                                                        if (child4.Count == 0)
                        //                                                        {
                        //                                                            if (itemchild4.IdStatus != 1536)
                        //                                                            {
                        //                                                                if (!string.IsNullOrEmpty(tempName))
                        //                                                                {
                        //                                                                    tempName = tempName + ", " + Convert.ToString(itemchild4.Name);
                        //                                                                }
                        //                                                                else
                        //                                                                {
                        //                                                                    tempName = tempName + " " + Convert.ToString(itemchild4.Name);
                        //                                                                }
                        //                                                            }
                        //                                                        }
                        //                                                    }
                        //                                                }
                        //                                            }
                        //                                        }
                        //                                    }
                        //                                }

                        //                            }
                        //                        }

                        //                    }
                        //                }

                        //            }
                        //            else
                        //            {

                        //            }
                        //            if (!string.IsNullOrEmpty(tempName))
                        //            {
                        //                string log = "In Module " + Convert.ToString(subTemplate) + " " + Convert.ToString(tempName) + " has been added.";
                        //                tempName = "";
                        //                StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                        //            }

                        //        }
                        //    }
                        //    else
                        //    {
                        //        string tempName = string.Empty;
                        //        foreach (var item in Newworkoperationlist)
                        //        {
                        //            if (string.IsNullOrEmpty(tempName))
                        //            {
                        //                tempName = tempName + " " + Convert.ToString(item.Name);
                        //            }
                        //            else
                        //            {
                        //                tempName = tempName + ", " + Convert.ToString(item.Name);
                        //            }

                        //        }
                        //        string log = "In Module " + Convert.ToString(subTemplate) + " " + Convert.ToString(tempName) + " has been added.";
                        //        tempName = "";
                        //        StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                        //    }
                        //}

                        string ModuleNameForEditLog = string.Empty;

                        //// update module work operation value
                        foreach (ERMSOPModule eRMSOPModule in ModuleMenulist)
                        {
                            //try
                            //{


                            //    var parent = ModuleMenulist.Where(x => x.KeyName == eRMSOPModule.ParentName).FirstOrDefault();
                            //    if (parent != null)
                            //    {
                            //        int i = 1;
                            //        String Keyname = Convert.ToString(parent.KeyName);
                            //        ParentName = Convert.ToString(parent.Name);
                            //        //string 
                            //        while (i > 0)
                            //        {
                            //            if (!string.IsNullOrEmpty(Keyname))
                            //            {
                            //                parent = ModuleMenulist.Where(x => x.KeyName == parent.ParentName).FirstOrDefault();

                            //                if (parent == null)
                            //                {
                            //                    i = 0;
                            //                }
                            //                else
                            //                {
                            //                    Keyname = Convert.ToString(parent.KeyName);
                            //                    ParentName = Convert.ToString(parent.Name);
                            //                    i = 1;
                            //                }

                            //            }
                            //            else
                            //            {
                            //                i = 0;
                            //            }
                            //        }
                            //    }
                            //}
                            //catch (Exception ex) { }

                            if (string.IsNullOrEmpty(ModuleNameForEditLog) && eRMSOPModule.IdCpType != 0)
                                ModuleNameForEditLog = ProductTypesMenulistForGridLayoutForLog.Where(x => (byte)x.IdCPType == eRMSOPModule.IdCpType).Select(y => y.Name).FirstOrDefault().ToString();

                            WorkOperationByStages workOperationByStages = WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(eRMSOPModule.KeyName)).FirstOrDefault();
                            StandardOperationsDictionaryModules ISERMSOPModuleValueUpdated = tempLstStandardOperationsDictionaryModules.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage) && w.IdCpTypeNew == eRMSOPModule.IdCpType).FirstOrDefault();
                            ERMSOPModule oldworkoperationstages = tempWorkOperationClonedModule.Where(x => x.Code != eRMSOPModule.Code).FirstOrDefault();
                            if (ISERMSOPModuleValueUpdated != null)
                            {
                                #region [GEOS2-4071][Rupali Sarode][10-12-2022]

                                if (ISERMSOPModuleValueUpdated.IdWorkoperation == Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage) && (ISERMSOPModuleValueUpdated.Activity == null || ISERMSOPModuleValueUpdated.Activity == 0))
                                {
                                    ISERMSOPModuleValueUpdated.Activity = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == eRMSOPModule.IdworkOperationByStage).Select(b => b.Activity).FirstOrDefault();
                                }
                                if (ISERMSOPModuleValueUpdated.IdWorkoperation == Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage) && (ISERMSOPModuleValueUpdated.ObservedTime == null || ISERMSOPModuleValueUpdated.ObservedTime == 0))
                                {
                                    ISERMSOPModuleValueUpdated.ObservedTime = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == eRMSOPModule.IdworkOperationByStage).Select(b => b.ObservedTime).FirstOrDefault();
                                }
                                #endregion
                                if (workOperationByStages != null)
                                {
                                    if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(workOperationByStages.Name.Trim())))
                                    {

                                    }
                                    else
                                    {

                                        if (ISERMSOPModuleValueUpdated.Activity != eRMSOPModule.Activity ||
                                            Math.Round(Convert.ToDouble(ISERMSOPModuleValueUpdated.ObservedTime), 2) != Math.Round(Convert.ToDouble(eRMSOPModule.ObservedTime), 2)
                                            || ISERMSOPModuleValueUpdated.Position != eRMSOPModule.ModulePosition)
                                        {
                                            if (ISERMSOPModuleValueUpdated.Activity != eRMSOPModule.Activity)
                                            {


                                                string Name = eRMSOPModule.Name;
                                                //string log = "In Module " + Convert.ToString(subTemplate) + " " + Convert.ToString(eRMSOPModule.Name) + " Activity Time changed from " + ISERMSOPModuleValueUpdated.Activity + " to " + Convert.ToString(eRMSOPModule.Activity) + ".";
                                                if (!string.IsNullOrEmpty(ModuleNameForEditLog))  //[Rupali Sarode][02-12-2022]
                                                {

                                                    string log = "In Module " + Convert.ToString(ModuleNameForEditLog) + " " + Convert.ToString(eRMSOPModule.Name) + " Activity Time changed from " + ISERMSOPModuleValueUpdated.Activity + " to " + Convert.ToString(eRMSOPModule.Activity) + ".";

                                                    //string log = Convert.ToString(eRMSOPModule.Name) + " of work operation " + Convert.ToString(ParentName) + " Activity Time updated from " + ISERMSOPModuleValueUpdated.Activity + " to " + Convert.ToString(eRMSOPModule.Activity) + " in module " + Convert.ToString(subTemplate) + " sub group of " + Convert.ToString(Template) + " groups.";
                                                    //string log = "Template- " + Convert.ToString(Template) + " subTemplate- " + Convert.ToString(subTemplate) + " Work Operation- " + Convert.ToString(ParentName) + " child -" + Convert.ToString(eRMSOPModule.Name) + " Activity time- " + Convert.ToString(eRMSOPModule.Activity) + " has been updated.";
                                                    StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                                }
                                            }

                                            if (
                                                Math.Round(Convert.ToDouble(ISERMSOPModuleValueUpdated.ObservedTime), 2) != Math.Round(Convert.ToDouble(eRMSOPModule.ObservedTime), 2)
                                                )
                                            {


                                                string Name = eRMSOPModule.Name;
                                                //string log = "In Module " + Convert.ToString(subTemplate) + " " + Convert.ToString(eRMSOPModule.Name) + " Observed Time changed from " + ISERMSOPModuleValueUpdated.ObservedTime + " to " + Convert.ToString(eRMSOPModule.ObservedTime) + ".";
                                                #region GEOS2-3954 time change
                                                string OldObservedTime = Convert.ToString(ConvertfloattoTimespanlog(Convert.ToString(ISERMSOPModuleValueUpdated.ObservedTime)));
                                                string CurrentObervedTime = Convert.ToString(new TimeSpan(eRMSOPModule.UITempobservedTime.Hours, eRMSOPModule.UITempobservedTime.Minutes, eRMSOPModule.UITempobservedTime.Seconds));
                                                if (!string.IsNullOrEmpty(ModuleNameForEditLog))  //[Rupali Sarode][02-12-2022]
                                                {
                                                    //string log = "In Module " + Convert.ToString(subTemplate) + " " + Convert.ToString(eRMSOPModule.Name) + " Observed Time changed from " + OldObservedTime + " to " + Convert.ToString(eRMSOPModule.UITempobservedTime) + ".";
                                                    string log = "In Module " + Convert.ToString(ModuleNameForEditLog) + " " + Convert.ToString(eRMSOPModule.Name) + " Observed Time changed from " + OldObservedTime + " to " + CurrentObervedTime + ".";
                                                    #endregion

                                                    //string log = Convert.ToString(eRMSOPModule.Name) + " of work operation " + Convert.ToString(ParentName) + " Observed Time updated from " + ISERMSOPModuleValueUpdated.ObservedTime + " to " + Convert.ToString(eRMSOPModule.ObservedTime) + " in module " + Convert.ToString(subTemplate) + " sub groups of " + Convert.ToString(Template) + " groups.";
                                                    //string log = "Template- " + Convert.ToString(Template) + " subTemplate- " + Convert.ToString(subTemplate) + " Work Operation- " + Convert.ToString(ParentName) + " child -" + Convert.ToString(eRMSOPModule.Name) + " observed Time- " + Convert.ToString(eRMSOPModule.ObservedTime) + " has been updated.";
                                                    StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                                }
                                            }

                                            #region rajashri GEOS2-5629 module changelog of position 
                                            var OldPosition = ClonedSOD.LstStandardOperationsDictionaryModules.Where(x => x.IdCpTypeNew == eRMSOPModule.IdCpType && x.IdWorkoperation == Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage)).FirstOrDefault();
                                            
                                                var Newpos = UpdatedSOD.LstStandardOperationsDictionaryModules.Where(x => x.IdCpTypeNew == eRMSOPModule.IdCpType && x.IdWorkoperation == Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage)).FirstOrDefault();
                                                if (Newpos != null)
                                                {
                                                if (OldPosition != null)
                                                {
                                                    if (Newpos.Position != OldPosition.ModulePosition)
                                                    {
                                                        string Name = eRMSOPModule.Name;
                                                        if (OldPosition.ModulePosition == null)
                                                        {
                                                            if (!string.IsNullOrEmpty(ModuleNameForEditLog))
                                                            {
                                                                string log = "The order of Module in " + Convert.ToString(ModuleNameForEditLog) + " " + Convert.ToString(eRMSOPModule.Name) + " has been changed from " + "None" + " to " + Convert.ToString(Newpos.ModulePosition) + ".";
                                                                StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                                            }
                                                        }
                                                        else
                                                        {

                                                            if (!string.IsNullOrEmpty(ModuleNameForEditLog))
                                                            {
                                                                string log = "The order of Module in " + Convert.ToString(ModuleNameForEditLog) + " " + Convert.ToString(eRMSOPModule.Name) + " has been changed from " + Convert.ToString(OldPosition.ModulePosition) + " to " + Newpos.Position + ".";
                                                                StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                                            }
                                                        }
                                                    }
                                                }
                                                else
                                                {
                                                    if (!string.IsNullOrEmpty(ModuleNameForEditLog))
                                                    {
                                                        string log = "The order of Module in " + Convert.ToString(ModuleNameForEditLog) + " " + Convert.ToString(eRMSOPModule.Name) + " has been changed from " + "None" + " to " + Convert.ToString(Newpos.ModulePosition) + ".";
                                                        StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                                    }
                                                }
                                            }
                                           

                                            #endregion
                                        }

                                        AddRemarksLogs(ISERMSOPModuleValueUpdated.Remarks, eRMSOPModule.Remarks, "Module", ModuleNameForEditLog, eRMSOPModule.Name);
                                        //AddRemarksLogs(ISERMSOPModuleValueUpdated.Remarks, eRMSOPModule.Remarks, "Module", subTemplate, eRMSOPModule.Name);

                                        //string oldRemarks = string.Empty;
                                        //string newRemarks = string.Empty;

                                        //oldRemarks = ISERMSOPModuleValueUpdated.Remarks == null ? "" :  ISERMSOPModuleValueUpdated.Remarks.ToLower().Trim();
                                        //newRemarks = eRMSOPModule.Remarks == null ? "" : eRMSOPModule.Remarks.ToLower().Trim();
                                        //if (oldRemarks != newRemarks)
                                        //{
                                        //    string Name = eRMSOPModule.Name;
                                        //    if (string.IsNullOrEmpty(oldRemarks) && !string.IsNullOrEmpty(newRemarks))
                                        //    {

                                        //        string log = "In Module " + Convert.ToString(subTemplate) + " " + Convert.ToString(eRMSOPModule.Name) + " Remark " + eRMSOPModule.Remarks.Trim() + " has been added.";
                                        //        StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                        //    }
                                        //    else if (!string.IsNullOrEmpty(oldRemarks) && string.IsNullOrEmpty(newRemarks))
                                        //    {

                                        //        string log = "In Module " + Convert.ToString(subTemplate) + " " + Convert.ToString(eRMSOPModule.Name) + " Remark " + ISERMSOPModuleValueUpdated.Remarks.Trim() + " has been deleted.";
                                        //        StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                        //    }

                                        //    else
                                        //    {
                                        //        string log = "In Module " + Convert.ToString(subTemplate) + " " + Convert.ToString(eRMSOPModule.Name) + " Remark is changed from " + ISERMSOPModuleValueUpdated.Remarks.Trim() + " to " + eRMSOPModule.Remarks.Trim() + " has been deleted.";
                                        //        StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });

                                        //    }
                                        //}



                                    }
                                }
                                else
                                {

                                    //if (ISERMSOPModuleValueUpdated.Activity != eRMSOPModule.Activity ||
                                    //       Math.Round(Convert.ToDouble(ISERMSOPModuleValueUpdated.ObservedTime), 2) != Math.Round(Convert.ToDouble(eRMSOPModule.ObservedTime), 2)
                                    //       )
                                    if (ISERMSOPModuleValueUpdated.Activity != eRMSOPModule.Activity ||
                                           Math.Round(Convert.ToDouble(ISERMSOPModuleValueUpdated.ObservedTime), 2) != Math.Round(Convert.ToDouble(eRMSOPModule.ObservedTime), 2)
                                           || ISERMSOPModuleValueUpdated.Position != eRMSOPModule.ModulePosition)

                                    {
                                        if (ISERMSOPModuleValueUpdated.Activity != eRMSOPModule.Activity)
                                        {


                                            string Name = eRMSOPModule.Name;

                                            if (!string.IsNullOrEmpty(ModuleNameForEditLog))  //[Rupali Sarode][02-12-2022]
                                            {
                                                //string log = "In Module " + Convert.ToString(subTemplate) + " " + Convert.ToString(eRMSOPModule.Name) + " Activity Time changed from " + ISERMSOPModuleValueUpdated.Activity + " to " + Convert.ToString(eRMSOPModule.Activity) + ".";

                                                string log = "In Module " + Convert.ToString(ModuleNameForEditLog) + " " + Convert.ToString(eRMSOPModule.Name) + " Activity Time changed from " + ISERMSOPModuleValueUpdated.Activity + " to " + Convert.ToString(eRMSOPModule.Activity) + ".";
                                                //string log = Convert.ToString(eRMSOPModule.Name) + " of work operation " + Convert.ToString(ParentName) + " Activity Time updated from " + ISERMSOPModuleValueUpdated.Activity + " to " + Convert.ToString(eRMSOPModule.Activity) + " in module " + Convert.ToString(subTemplate) + " sub group of " + Convert.ToString(Template) + " groups.";
                                                //string log = "Template- " + Convert.ToString(Template) + " subTemplate- " + Convert.ToString(subTemplate) + " Work Operation- " + Convert.ToString(ParentName) + " child -" + Convert.ToString(eRMSOPModule.Name) +  " Activity time- " + Convert.ToString(eRMSOPModule.Activity) + " has been updated.";
                                                StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                            }
                                        }
                                        if (
                                            Math.Round(Convert.ToDouble(ISERMSOPModuleValueUpdated.ObservedTime), 2) != Math.Round(Convert.ToDouble(eRMSOPModule.ObservedTime), 2)
                                            )
                                        {


                                            string Name = eRMSOPModule.Name;
                                            //string log = "In Module " + Convert.ToString(subTemplate) + " " + Convert.ToString(eRMSOPModule.Name) + " Observed Time changed from " + ISERMSOPModuleValueUpdated.ObservedTime + " to " + Convert.ToString(eRMSOPModule.ObservedTime) + ".";

                                            #region GEOS2-3954 time change
                                            string OldObservedTime = Convert.ToString(ConvertfloattoTimespanlog(Convert.ToString(ISERMSOPModuleValueUpdated.ObservedTime)));
                                            string CurrentObervedTime = Convert.ToString(new TimeSpan(eRMSOPModule.UITempobservedTime.Hours, eRMSOPModule.UITempobservedTime.Minutes, eRMSOPModule.UITempobservedTime.Seconds));
                                            if (!string.IsNullOrEmpty(ModuleNameForEditLog))  //[Rupali Sarode][02-12-2022]
                                            {

                                                //string log = "In Module " + Convert.ToString(subTemplate) + " " + Convert.ToString(eRMSOPModule.Name) + " Observed Time changed from " + OldObservedTime + " to " + Convert.ToString(eRMSOPModule.UITempobservedTime) + ".";
                                                string log = "In Module " + Convert.ToString(ModuleNameForEditLog) + " " + Convert.ToString(eRMSOPModule.Name) + " Observed Time changed from " + OldObservedTime + " to " + CurrentObervedTime + ".";
                                                #endregion

                                                //string log = Convert.ToString(eRMSOPModule.Name) + " of work operation " + Convert.ToString(ParentName) + " Observed Time updated from " + ISERMSOPModuleValueUpdated.ObservedTime + " to " + Convert.ToString(eRMSOPModule.ObservedTime) + " in module " + Convert.ToString(subTemplate) + " sub groups of " + Convert.ToString(Template) + " groups.";
                                                //string log = "Template- " + Convert.ToString(Template) + " subTemplate- " + Convert.ToString(subTemplate) + " Work Operation- " + Convert.ToString(eRMSOPModule.ParentName) + " child -" + Convert.ToString(eRMSOPModule.Name) + " observed Time- " + Convert.ToString(eRMSOPModule.ObservedTime) + " has been updated.";
                                                StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                            }
                                        }

                                        #region rajashri GEOS2-5629 module changelog of position
                                        var OldPosition = ClonedSOD.LstStandardOperationsDictionaryModules.Where(x => x.IdCpTypeNew == eRMSOPModule.IdCpType && x.IdWorkoperation == Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage)).FirstOrDefault();
                                      
                                            var Newpos = UpdatedSOD.LstStandardOperationsDictionaryModules.Where(x => x.IdCpTypeNew == eRMSOPModule.IdCpType && x.IdWorkoperation == Convert.ToUInt64(eRMSOPModule.IdworkOperationByStage)).FirstOrDefault();
                                            if (Newpos != null)
                                            {
                                            if (OldPosition != null)
                                            {

                                                if (Newpos.Position != OldPosition.ModulePosition)
                                                {
                                                    string Name = eRMSOPModule.Name;
                                                    if (OldPosition.ModulePosition == null)
                                                    {
                                                        if (!string.IsNullOrEmpty(ModuleNameForEditLog))
                                                        {
                                                            string log = "The order of modules in " + Convert.ToString(ModuleNameForEditLog) + " " + Convert.ToString(eRMSOPModule.Name) + " has been changed from " + "None" + " to " + Convert.ToString(Newpos.ModulePosition) + ".";
                                                            StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                                        }
                                                    }
                                                    else
                                                    {

                                                        if (!string.IsNullOrEmpty(ModuleNameForEditLog))
                                                        {
                                                            string log = "The order of modules in " + Convert.ToString(ModuleNameForEditLog) + " " + Convert.ToString(eRMSOPModule.Name) + " has been changed from " + Convert.ToString(OldPosition.ModulePosition) + " to " + Newpos.Position + ".";
                                                            StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                                        }
                                                    }
                                                }
                                            }
                                            else
                                            {
                                                if (!string.IsNullOrEmpty(ModuleNameForEditLog))
                                                {
                                                    string log = "The order of modules in " + Convert.ToString(ModuleNameForEditLog) + " " + Convert.ToString(eRMSOPModule.Name) + " has been changed from " + "None" + " to " + Convert.ToString(Newpos.ModulePosition) + ".";
                                                    StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                                }
                                            }
                                        }
                                        
                                        #endregion
                                    }


                                    //AddRemarksLogs(ISERMSOPModuleValueUpdated.Remarks, eRMSOPModule.Remarks, "Module", subTemplate, eRMSOPModule.Name);
                                    AddRemarksLogs(ISERMSOPModuleValueUpdated.Remarks, eRMSOPModule.Remarks, "Module", ModuleNameForEditLog, eRMSOPModule.Name);

                                    //if (oldRemarks != newRemarks)
                                    //{
                                    //    string Name = eRMSOPModule.Name;
                                    //    if (string.IsNullOrEmpty(oldRemarks) && !string.IsNullOrEmpty(newRemarks))
                                    //    {
                                    //        string log = "In Module " + Convert.ToString(subTemplate) + " " + Convert.ToString(eRMSOPModule.Name) + " Remark " + eRMSOPModule.Remarks.Trim() + " has been added.";
                                    //        StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                    //    }
                                    //    else if (!string.IsNullOrEmpty(oldRemarks) && string.IsNullOrEmpty(newRemarks))
                                    //    {
                                    //        string log = "In Module " + Convert.ToString(subTemplate) + " " + Convert.ToString(eRMSOPModule.Name) + " Remark " + ISERMSOPModuleValueUpdated.Remarks.Trim() + " has been deleted.";
                                    //        StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                    //    }

                                    //    else
                                    //    {
                                    //        string log = "In Module " + Convert.ToString(subTemplate) + " " + Convert.ToString(eRMSOPModule.Name) + " Remark is changed from " + ISERMSOPModuleValueUpdated.Remarks.Trim() + " to " + eRMSOPModule.Remarks.Trim() + ".";
                                    //        StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });

                                    //    }
                                    //}

                                }
                            }
                        }
                    }
                    catch (Exception ex) { }
                }

                #endregion

                try
                {
                    if (standardOperationsDictionaryModulesDeleteList.Count() > 0)
                    {
                        string childs = string.Empty;
                        //string oldcheckparent = string.Empty;
                        string log = string.Empty;
                        string cpTypeNameForDelete = string.Empty;
                        var deleteworkoperationlist = tempWorkOperationClonedModule.Except(ModuleMenulist).ToList();

                        if (deleteworkoperationlist.Count > 0)
                        {
                            for (int i = 0; i < deleteworkoperationlist.Count; i++)
                            {
                                if (GetStages.Any(a => a.Code.Equals(deleteworkoperationlist[i].Name)))
                                {
                                }
                                else
                                {
                                    //if (deleteworkoperationlist[i].IdStatus != 1536)
                                    //{
                                    List<ERMSOPModule> childList = deleteworkoperationlist.Where(w => w.ParentName != null && w.ParentName.Equals(deleteworkoperationlist[i].KeyName)).ToList();
                                    //List<ERMSOPModule> childList = deleteworkoperationlist.Where(w => w.ParentName != null && w.ParentName.Equals(deleteworkoperationlist[i].KeyName) && deleteworkoperationlist[i].IdStatus != 1536).ToList();
                                    if (childList.Count == 0)
                                    {
                                        if (string.IsNullOrEmpty(childs))
                                        {
                                            childs = deleteworkoperationlist[i].Name.Trim();
                                        }
                                        else
                                            childs = childs + ", " + deleteworkoperationlist[i].Name.Trim();
                                    }
                                    // }
                                }
                            }

                            if (!string.IsNullOrEmpty(childs))
                            {
                                cpTypeNameForDelete = ProductTypesMenulistForGridLayoutForLog.Where(x => x.IdCPType == IdCpTypeForDelete).Select(y => y.Name).FirstOrDefault().ToString();

                                //log = "In Module " + Convert.ToString(subTemplate) + " " + Convert.ToString(childs) + " has been deleted.";
                                log = "In Module " + Convert.ToString(cpTypeNameForDelete) + " " + Convert.ToString(childs) + " has been deleted.";

                                //string log = Convert.ToString(deleteparent.Name) + " in module " + Convert.ToString(subTemplate) + " sub groups of " + Convert.ToString(Template) + " groups has been deleted.";
                                StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                            }
                        }


                    }
                }
                catch (Exception ex)
                {

                }
                GeosApplication.Instance.Logger.Log("Method moduleLogs()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method moduleLogs() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

            }
        }

        private void AddRemarksLogs(string oldRemarks, string newRemarks, string SOPtype, string strSubTemplate, string SOPtypeName)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method AddRemarksLogs()...", category: Category.Info, priority: Priority.Low);


                string SODoldRemarks = string.Empty;
                string SODnewRemarks = string.Empty;

                SODoldRemarks = oldRemarks;
                SODnewRemarks = newRemarks;

                oldRemarks = oldRemarks == null ? "" : oldRemarks.ToLower().Trim();
                newRemarks = newRemarks == null ? "" : newRemarks.ToLower().Trim();

                if (oldRemarks != newRemarks)
                {
                    string Name = SOPtypeName;
                    if (string.IsNullOrEmpty(oldRemarks) && !string.IsNullOrEmpty(newRemarks))
                    {
                        string log = "In " + SOPtype + " " + Convert.ToString(strSubTemplate) + " " + Convert.ToString(SOPtypeName) + " Remarks " + SODnewRemarks + " has been added.";
                        StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                    }
                    else if (!string.IsNullOrEmpty(oldRemarks) && string.IsNullOrEmpty(newRemarks))
                    {
                        string log = "In " + SOPtype + " " + Convert.ToString(strSubTemplate) + " " + Convert.ToString(SOPtypeName) + " Remarks " + SODoldRemarks + " has been deleted.";
                        StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                    }

                    else
                    {
                        string log = "In " + SOPtype + " " + Convert.ToString(strSubTemplate) + " " + Convert.ToString(SOPtypeName) + " Remarks changed from " + SODoldRemarks + " to " + SODnewRemarks + ".";
                        StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });

                    }
                }
                GeosApplication.Instance.Logger.Log("Method AddRemarksLogs()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {

                GeosApplication.Instance.Logger.Log(string.Format("Error in method AddRemarksLogs() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

            }
        }

        #region GEOS2 - 3857 Add Modify And Remove Detection Rupali Sarode
        private void DetectionLog()
        {

            try
            {
                GeosApplication.Instance.Logger.Log("Method DetectionLog()...", category: Category.Info, priority: Priority.Low);


                //   tempLstStandardOperationsDictionaryDetection
                //ProductTypes productTypes = (ProductTypes)SelectedItem;
                ERMDetections ermDetections = (ERMDetections)SelectedItemDetection;

                //[GEOS2-4108][Rupali Sarode][3-1-2022]
                ObservableCollection<ERMDetections> DetectionsMenulistForGridLayoutForLog;
                int IdDetectionForDelete = ermDetections.IdDetection;

                DetectionsMenulistForGridLayoutForLog = new ObservableCollection<ERMDetections>(ERMService.GetAllDetections_V2280().ToList());

                string Template = Convert.ToString(SelectedItemDetectionGroup);

                string subTemplate = Convert.ToString(ermDetections.Name);
                string SODoldRemarks = string.Empty;
                string SODnewRemarks = string.Empty;

                if (DetectionMenulist != null && DetectionMenulist.Count > 0)
                {
                    try
                    {
                        string ParentName = string.Empty;
                        ulong tIdDetection = 0; //[GEOS2-3922][Rupali Sarode][10-11-2022]
                        var temp = tempWorkOperationClonedDetection;
                        string childs = string.Empty;
                        // var temp2 = ModuleMenulist;

                        //[GOES2-3925][Rupali Sarode][02-12-2022]

                        //var Newworkoperationlist = DetectionMenulist.Except(tempWorkOperationClonedDetection).ToList();
                        var Newworkoperationlist = DetectionMenulist.Where(x => !tempWorkOperationClonedDetection.Any(y => y.IdworkOperationByStage == x.IdworkOperationByStage
                        && y.IdDetection == x.IdDetection)).ToList();


                        if (Newworkoperationlist.Count > 0)
                        {
                            for (int i = 0; i < Newworkoperationlist.Count; i++)
                            {
                                if (GetStages.Any(a => a.Code.Equals(Newworkoperationlist[i].Name)))
                                {
                                }
                                else
                                {
                                    //if (Newworkoperationlist[i].IdStatus != 1536)
                                    //{

                                    //List<ERMSOPDetection> childList = Newworkoperationlist.Where(w => w.ParentName != null && w.ParentName.Equals(Newworkoperationlist[i].KeyName)).ToList();
                                    List<WorkOperationByStages> childList = WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(Newworkoperationlist[i].KeyName)).ToList();
                                    if (childList.Count == 0)
                                    {
                                        if (string.IsNullOrEmpty(childs))
                                        {
                                            childs = Newworkoperationlist[i].Name.Trim();
                                            tIdDetection = Convert.ToUInt64(Newworkoperationlist[i].IdDetection); //[GEOS2-3922][Rupali Sarode][10-11-2022]
                                        }
                                        else
                                            childs = childs + ", " + Newworkoperationlist[i].Name.Trim();
                                    }
                                    // }
                                }
                            }
                            string log = string.Empty;
                            if (!string.IsNullOrEmpty(childs))
                            {
                                //[GEOS2-3922][Rupali Sarode][10-11-2022]
                                //log = "In Detection " + Convert.ToString(subTemplate) + " " + Convert.ToString(childs) + " has been added.";
                                string cpTypeName = string.Empty;
                                //cpTypeName = DetectionsMenulistForGridLayout.Where(x => x.IdDetection == Convert.ToInt32(tIdDetection)).Select(y => y.Name).FirstOrDefault().ToString();

                                cpTypeName = DetectionsMenulistForGridLayoutForLog.Where(x => x.IdDetection == Convert.ToInt32(tIdDetection)).Select(y => y.Name).FirstOrDefault().ToString();

                                if (!string.IsNullOrEmpty(cpTypeName))
                                {
                                    log = "In Detection " + Convert.ToString(cpTypeName) + " " + Convert.ToString(childs) + " has been added.";
                                    //string log = Convert.ToString(deleteparent.Name) + " in module " + Convert.ToString(subTemplate) + " sub groups of " + Convert.ToString(Template) + " groups has been deleted.";

                                    StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                }
                            }
                        }



                        //if (Newworkoperationlist.Count > 0)
                        //{

                        //    //string Name = string.Empty;
                        //    var AddNewworkoperation = Newworkoperationlist.Where(x => x.IdParent == null).ToList();
                        //    List<string> templist = new List<string>();

                        //    if (AddNewworkoperation.Count > 0)
                        //    {
                        //        string oldparent = string.Empty;
                        //        string tempName = string.Empty;
                        //        foreach (var Parentitem in AddNewworkoperation)
                        //        {


                        //            string Keyname = Convert.ToString(Parentitem.KeyName);
                        //            ParentName = Convert.ToString(Parentitem.Name);
                        //            //tempName = tempName + ParentName;

                        //            if (!string.IsNullOrEmpty(Keyname))
                        //            {
                        //                var parent = Newworkoperationlist.Where(x => x.ParentName == Keyname && x.IdStatus != 1536).ToList();

                        //                if (parent == null)
                        //                {

                        //                }
                        //                else
                        //                {
                        //                    foreach (var itemchild in parent)
                        //                    {
                        //                        //tempName = tempName + ", " + Convert.ToString(itemchild.Name);
                        //                        var child = Newworkoperationlist.Where(x => x.ParentName == itemchild.KeyName && x.IdStatus != 1536).ToList();

                        //                        if (child.Count == 0)
                        //                        {
                        //                            if (itemchild.IdStatus != 1536)
                        //                            {

                        //                                if (!string.IsNullOrEmpty(tempName))
                        //                                {
                        //                                    tempName = tempName + ", " + Convert.ToString(itemchild.Name);
                        //                                }
                        //                                else
                        //                                {
                        //                                    tempName = tempName + " " + Convert.ToString(itemchild.Name);
                        //                                }

                        //                            }

                        //                        }
                        //                        else
                        //                        {
                        //                            foreach (var itemchild1 in child)
                        //                            {
                        //                                //tempName = tempName + ", " + Convert.ToString(itemchild1.Name);
                        //                                var child1 = Newworkoperationlist.Where(x => x.ParentName == itemchild1.KeyName && x.IdStatus != 1536).ToList();
                        //                                if (child1.Count == 0)
                        //                                {
                        //                                    if (itemchild1.IdStatus != 1536)
                        //                                    {
                        //                                        //if (itemchild1.IsInactiveWorkOperation == false)
                        //                                        if (!string.IsNullOrEmpty(tempName))
                        //                                        {
                        //                                            tempName = tempName + ", " + Convert.ToString(itemchild1.Name);
                        //                                        }
                        //                                        else
                        //                                        {
                        //                                            tempName = tempName + " " + Convert.ToString(itemchild1.Name);
                        //                                        }
                        //                                    }
                        //                                }
                        //                                else
                        //                                {
                        //                                    foreach (var itemchild2 in child1)
                        //                                    {
                        //                                        //tempName = tempName + ", " + Convert.ToString(itemchild2.Name);
                        //                                        var child2 = Newworkoperationlist.Where(x => x.ParentName == itemchild2.KeyName && x.IdStatus != 1536).ToList();
                        //                                        if (child2.Count == 0)
                        //                                        {
                        //                                            if (itemchild2.IdStatus != 1536)     //  && itemchild2.IsInactiveWorkOperation == false
                        //                                            {
                        //                                                if (!string.IsNullOrEmpty(tempName))
                        //                                                {
                        //                                                    tempName = tempName + ", " + Convert.ToString(itemchild2.Name);
                        //                                                }
                        //                                                else
                        //                                                {
                        //                                                    tempName = tempName + " " + Convert.ToString(itemchild2.Name);
                        //                                                }
                        //                                            }
                        //                                        }
                        //                                        else
                        //                                        {
                        //                                            foreach (var itemchild3 in child2)
                        //                                            {
                        //                                                //tempName = tempName + ", " + Convert.ToString(itemchild3.Name);
                        //                                                var child3 = Newworkoperationlist.Where(x => x.ParentName == itemchild3.KeyName && x.IdStatus != 1536).ToList();
                        //                                                if (child3.Count == 0)
                        //                                                {
                        //                                                    if (itemchild3.IdStatus != 1536)     //&& itemchild3.IsInactiveWorkOperation == false
                        //                                                    {
                        //                                                        if (!string.IsNullOrEmpty(tempName))
                        //                                                        {
                        //                                                            tempName = tempName + ", " + Convert.ToString(itemchild3.Name);
                        //                                                        }
                        //                                                        else
                        //                                                        {
                        //                                                            tempName = tempName + " " + Convert.ToString(itemchild3.Name);
                        //                                                        }
                        //                                                    }
                        //                                                }
                        //                                                else
                        //                                                {
                        //                                                    foreach (var itemchild4 in child3)
                        //                                                    {
                        //                                                        //tempName = tempName + ", " + Convert.ToString(itemchild3.Name);
                        //                                                        var child4 = Newworkoperationlist.Where(x => x.ParentName == itemchild4.KeyName).ToList();
                        //                                                        if (child4.Count == 0)
                        //                                                        {
                        //                                                            if (itemchild4.IdStatus != 1536)
                        //                                                            {
                        //                                                                if (!string.IsNullOrEmpty(tempName))
                        //                                                                {
                        //                                                                    tempName = tempName + ", " + Convert.ToString(itemchild4.Name);
                        //                                                                }
                        //                                                                else
                        //                                                                {
                        //                                                                    tempName = tempName + " " + Convert.ToString(itemchild4.Name);
                        //                                                                }
                        //                                                            }
                        //                                                        }
                        //                                                    }
                        //                                                }
                        //                                            }
                        //                                        }
                        //                                    }
                        //                                }

                        //                            }
                        //                        }

                        //                    }
                        //                }

                        //            }
                        //            else
                        //            {

                        //            }

                        //            string log = "In Detection " + Convert.ToString(subTemplate) + " " + Convert.ToString(tempName) + " has been added.";
                        //            tempName = "";
                        //            StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });


                        //        }
                        //    }
                        //}

                        string DetectionNameForEditLog = string.Empty;
                        foreach (ERMSOPDetection eRMSOPDetection in DetectionMenulist)
                        {
                            //try
                            //{
                            //    var parent = DetectionMenulist.Where(x => x.KeyName == eRMSOPDetection.ParentName).FirstOrDefault();
                            //    if (parent != null)
                            //    {
                            //        int i = 1;
                            //        String Keyname = Convert.ToString(parent.KeyName);
                            //        ParentName = Convert.ToString(parent.Name);
                            //        //string 
                            //        while (i > 0)
                            //        {
                            //            if (!string.IsNullOrEmpty(Keyname))
                            //            {
                            //                parent = DetectionMenulist.Where(x => x.KeyName == parent.ParentName).FirstOrDefault();

                            //                if (parent == null)
                            //                {
                            //                    i = 0;
                            //                }
                            //                else
                            //                {
                            //                    Keyname = Convert.ToString(parent.KeyName);
                            //                    ParentName = Convert.ToString(parent.Name);
                            //                    i = 1;
                            //                }

                            //            }
                            //            else
                            //            {
                            //                i = 0;
                            //            }
                            //        }
                            //    }
                            //}
                            //catch (Exception ex) { }

                            if (string.IsNullOrEmpty(DetectionNameForEditLog) && eRMSOPDetection.IdDetection != 0)

                                DetectionNameForEditLog = DetectionsMenulistForGridLayoutForLog.Where(x => (ulong)x.IdDetection == eRMSOPDetection.IdDetection).Select(y => y.Name).FirstOrDefault().ToString();

                            WorkOperationByStages workOperationByStages = WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(eRMSOPDetection.KeyName)).FirstOrDefault();
                            StandardOperationsDictionaryDetection ISERMSOPDetectionValueUpdated = tempLstStandardOperationsDictionaryDetection.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPDetection.IdworkOperationByStage) && w.IdDetection == eRMSOPDetection.IdDetection).FirstOrDefault();
                            ERMSOPDetection oldworkoperationstages = tempWorkOperationClonedDetection.Where(x => x.Code != eRMSOPDetection.Code).FirstOrDefault();
                            if (ISERMSOPDetectionValueUpdated != null)
                            {
                                #region [GEOS2-4073][Rupali Sarode][10-12-2022]

                                if (ISERMSOPDetectionValueUpdated.IdWorkoperation == Convert.ToUInt64(eRMSOPDetection.IdworkOperationByStage) && (ISERMSOPDetectionValueUpdated.Activity == null || ISERMSOPDetectionValueUpdated.Activity == 0))
                                {
                                    ISERMSOPDetectionValueUpdated.Activity = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == eRMSOPDetection.IdworkOperationByStage).Select(b => b.Activity).FirstOrDefault();
                                }
                                if (ISERMSOPDetectionValueUpdated.IdWorkoperation == Convert.ToUInt64(eRMSOPDetection.IdworkOperationByStage) && (ISERMSOPDetectionValueUpdated.ObservedTime == null || ISERMSOPDetectionValueUpdated.ObservedTime == 0))
                                {
                                    ISERMSOPDetectionValueUpdated.ObservedTime = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == eRMSOPDetection.IdworkOperationByStage).Select(b => b.ObservedTime).FirstOrDefault();
                                }
                                #endregion

                                if (workOperationByStages != null)
                                {
                                    if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(workOperationByStages.Name.Trim())))
                                    {

                                    }
                                    else
                                    {

                                        if (ISERMSOPDetectionValueUpdated.Activity != eRMSOPDetection.DetectionActivity || Math.Round(Convert.ToDouble(ISERMSOPDetectionValueUpdated.ObservedTime), 2) != Math.Round(Convert.ToDouble(eRMSOPDetection.DetectionObservedTime), 2) || ISERMSOPDetectionValueUpdated.Position != eRMSOPDetection.DetectionPosition)
                                        {
                                            if (ISERMSOPDetectionValueUpdated.Activity != eRMSOPDetection.DetectionActivity)
                                            {
                                                string Name = eRMSOPDetection.Name;
                                                //string log = "In Detection " + Convert.ToString(subTemplate) + " " + Convert.ToString(eRMSOPDetection.Name) + " Activity Time changed from " + ISERMSOPDetectionValueUpdated.Activity + " to " + Convert.ToString(eRMSOPDetection.DetectionActivity) + ".";
                                                if (!string.IsNullOrEmpty(DetectionNameForEditLog))
                                                {
                                                    string log = "In Detection " + Convert.ToString(DetectionNameForEditLog) + " " + Convert.ToString(eRMSOPDetection.Name) + " Activity Time changed from " + ISERMSOPDetectionValueUpdated.Activity + " to " + Convert.ToString(eRMSOPDetection.DetectionActivity) + ".";
                                                    //string log = Convert.ToString(eRMSOPDetection.Name) + " of work operation " + Convert.ToString(ParentName) + " Activity Time updated from " + ISERMSOPDetectionValueUpdated.Activity + " to " + Convert.ToString(eRMSOPDetection.DetectionActivity) + " in detection " + Convert.ToString(subTemplate) + " sub group of " + Convert.ToString(Template) + " groups.";
                                                    StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                                }
                                            }

                                            if (Math.Round(Convert.ToDouble(ISERMSOPDetectionValueUpdated.ObservedTime), 2) != Math.Round(Convert.ToDouble(eRMSOPDetection.DetectionObservedTime), 2))
                                            {
                                                string Name = eRMSOPDetection.Name;
                                                //string log = "In Detection " + Convert.ToString(subTemplate) + " " + Convert.ToString(eRMSOPDetection.Name) + " Observed Time changed from " + ISERMSOPDetectionValueUpdated.ObservedTime + " to " + Convert.ToString(eRMSOPDetection.DetectionObservedTime) + ".";
                                                #region GEOS2-3954 time change
                                                string OldObservedTime = Convert.ToString(ConvertfloattoTimespanlog(Convert.ToString(ISERMSOPDetectionValueUpdated.ObservedTime)));
                                                string CurrentObervedTime = Convert.ToString(new TimeSpan(eRMSOPDetection.UITempDetectionobservedTime.Hours, eRMSOPDetection.UITempDetectionobservedTime.Minutes, eRMSOPDetection.UITempDetectionobservedTime.Seconds));
                                                if (!string.IsNullOrEmpty(DetectionNameForEditLog))
                                                {
                                                    //string log = "In Detection " + Convert.ToString(subTemplate) + " " + Convert.ToString(eRMSOPDetection.Name) + " Observed Time changed from " + OldObservedTime + " to " + Convert.ToString(eRMSOPDetection.UITempDetectionobservedTime) + ".";
                                                    string log = "In Detection " + Convert.ToString(DetectionNameForEditLog) + " " + Convert.ToString(eRMSOPDetection.Name) + " Observed Time changed from " + OldObservedTime + " to " + CurrentObervedTime + ".";
                                                    #endregion

                                                    StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                                }
                                            }
                                            #region rajashri GEOS2-5629 Detection changelog of position 
                                            var OldPosition = ClonedSOD.LstStandardOperationsDictionaryDetection.Where(x => x.IdDetection == eRMSOPDetection.IdDetection && x.IdWorkoperation == Convert.ToUInt64(eRMSOPDetection.IdworkOperationByStage)).FirstOrDefault();

                                            var Newpos = UpdatedSOD.LstStandardOperationsDictionaryDetection.Where(x => x.IdDetection == eRMSOPDetection.IdDetection && x.IdWorkoperation == Convert.ToUInt64(eRMSOPDetection.IdworkOperationByStage)).FirstOrDefault();
                                            if (Newpos != null)
                                            {
                                                if (OldPosition != null)
                                                {

                                                    if (Newpos.Position != OldPosition.DetectionPosition)
                                                    {
                                                        string Name = eRMSOPDetection.Name;
                                                        if (OldPosition.Position == null)
                                                        {
                                                            if (!string.IsNullOrEmpty(DetectionNameForEditLog))
                                                            {
                                                                string log = "The order of Detection in " + Convert.ToString(DetectionNameForEditLog) + " " + Convert.ToString(eRMSOPDetection.Name) + " has been changed from " + "None" + " to " + Convert.ToString(Newpos.DetectionPosition) + ".";
                                                                StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                                            }
                                                        }
                                                        else
                                                        {

                                                            if (!string.IsNullOrEmpty(DetectionNameForEditLog))
                                                            {
                                                                string log = "The order of Detection in " + Convert.ToString(DetectionNameForEditLog) + " " + Convert.ToString(eRMSOPDetection.Name) + " has been changed from " + OldPosition.DetectionPosition + " to " + Convert.ToString(Newpos.Position) + ".";
                                                                StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                                            }
                                                        }
                                                    }
                                                }
                                                else
                                                {
                                                    if (!string.IsNullOrEmpty(DetectionNameForEditLog))
                                                    {
                                                        string log = "The order of Detection in " + Convert.ToString(DetectionNameForEditLog) + " " + Convert.ToString(eRMSOPDetection.Name) + " has been changed from " + "None" + " to " + Convert.ToString(Newpos.Position) + ".";
                                                        StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                                    }
                                                }
                                            }
                                            #endregion
                                        }

                                        //AddRemarksLogs(ISERMSOPDetectionValueUpdated.Remarks, eRMSOPDetection.Remarks, "Detection", subTemplate, eRMSOPDetection.Name);
                                        AddRemarksLogs(ISERMSOPDetectionValueUpdated.Remarks, eRMSOPDetection.Remarks, "Detection", DetectionNameForEditLog, eRMSOPDetection.Name);


                                    }
                                }
                                else
                                {

                                    if (ISERMSOPDetectionValueUpdated.Activity != eRMSOPDetection.DetectionActivity || Math.Round(Convert.ToDouble(ISERMSOPDetectionValueUpdated.ObservedTime), 2) != Math.Round(Convert.ToDouble(eRMSOPDetection.DetectionObservedTime), 2) || ISERMSOPDetectionValueUpdated.Position != eRMSOPDetection.DetectionPosition)
                                    {
                                        if (ISERMSOPDetectionValueUpdated.Activity != eRMSOPDetection.DetectionActivity)
                                        {
                                            string Name = eRMSOPDetection.Name;

                                            if (!string.IsNullOrEmpty(DetectionNameForEditLog))
                                            {
                                                //string log = "In Detection " + Convert.ToString(subTemplate) + " " + Convert.ToString(eRMSOPDetection.Name) + " Activity Time changed from " + ISERMSOPDetectionValueUpdated.Activity + " to " + Convert.ToString(eRMSOPDetection.DetectionActivity) + ".";

                                                string log = "In Detection " + Convert.ToString(DetectionNameForEditLog) + " " + Convert.ToString(eRMSOPDetection.Name) + " Activity Time changed from " + ISERMSOPDetectionValueUpdated.Activity + " to " + Convert.ToString(eRMSOPDetection.DetectionActivity) + ".";
                                                //string log = Convert.ToString(eRMSOPDetection.Name) + " of work operation " + Convert.ToString(ParentName) + " Activity Time updated from " + ISERMSOPDetectionValueUpdated.Activity + " to " + Convert.ToString(eRMSOPDetection.DetectionActivity) + " in detection " + Convert.ToString(subTemplate) + " sub group of " + Convert.ToString(Template) + " groups.";

                                                StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                            }
                                        }

                                        if (Math.Round(Convert.ToDouble(ISERMSOPDetectionValueUpdated.ObservedTime), 2) != Math.Round(Convert.ToDouble(eRMSOPDetection.DetectionObservedTime), 2))
                                        {
                                            string Name = eRMSOPDetection.Name;
                                            //string log = "In Detection " + Convert.ToString(subTemplate) + " " + Convert.ToString(eRMSOPDetection.Name) + " Observed Time changed from " + ISERMSOPDetectionValueUpdated.ObservedTime + " to " + Convert.ToString(eRMSOPDetection.DetectionObservedTime) + ".";
                                            //string log = Convert.ToString(eRMSOPDetection.Name) + " of work operation " + Convert.ToString(ParentName) + " Observed Time updated from " + ISERMSOPDetectionValueUpdated.ObservedTime + " to " + Convert.ToString(eRMSOPDetection.DetectionObservedTime) + " in detection " + Convert.ToString(subTemplate) + " sub groups of " + Convert.ToString(Template) + " groups.";
                                            #region GEOS2-3954 time change

                                            string OldObservedTime = Convert.ToString(ConvertfloattoTimespanlog(Convert.ToString(ISERMSOPDetectionValueUpdated.ObservedTime)));
                                            string CurrentObervedTime = Convert.ToString(new TimeSpan(eRMSOPDetection.UITempDetectionobservedTime.Hours, eRMSOPDetection.UITempDetectionobservedTime.Minutes, eRMSOPDetection.UITempDetectionobservedTime.Seconds));
                                            //string log = "In Detection " + Convert.ToString(subTemplate) + " " + Convert.ToString(eRMSOPDetection.Name) + " Observed Time changed from " + OldObservedTime + " to " + Convert.ToString(eRMSOPDetection.UITempDetectionobservedTime) + ".";
                                            if (!string.IsNullOrEmpty(DetectionNameForEditLog))
                                            {
                                                string log = "In Detection " + Convert.ToString(DetectionNameForEditLog) + " " + Convert.ToString(eRMSOPDetection.Name) + " Observed Time changed from " + OldObservedTime + " to " + CurrentObervedTime + ".";
                                                #endregion

                                                StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                            }
                                        }
                                        //#region rajashri GEOS2-5629 Detection changelog of position 
                                        //if (ISERMSOPDetectionValueUpdated.Position != eRMSOPDetection.DetectionPosition)
                                        //{
                                        //    string Name = eRMSOPDetection.Name;
                                        //    if (ISERMSOPDetectionValueUpdated.Position == null)
                                        //    {
                                        //        if (!string.IsNullOrEmpty(DetectionNameForEditLog))
                                        //        {
                                        //            string log = "The order of Detection in " + Convert.ToString(DetectionNameForEditLog) + " " + Convert.ToString(eRMSOPDetection.Name) + " has been changed from " + "None" + " to " + Convert.ToString(eRMSOPDetection.DetectionPosition) + ".";
                                        //            StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                        //        }
                                        //    }
                                        //    else
                                        //    {

                                        //        if (!string.IsNullOrEmpty(DetectionNameForEditLog))
                                        //        {
                                        //            string log = "The order of Detection in " + Convert.ToString(DetectionNameForEditLog) + " " + Convert.ToString(eRMSOPDetection.Name) + " has been changed from " + ISERMSOPDetectionValueUpdated.Position + " to " + Convert.ToString(eRMSOPDetection.DetectionPosition) + ".";
                                        //            StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                        //        }
                                        //    }
                                        //}
                                        //#endregion
                                        #region rajashri GEOS2-5629 Detection changelog of position 
                                        var OldPosition = ClonedSOD.LstStandardOperationsDictionaryDetection.Where(x => x.IdDetection == eRMSOPDetection.IdDetection && x.IdWorkoperation == Convert.ToUInt64(eRMSOPDetection.IdworkOperationByStage)).FirstOrDefault();

                                        var Newpos = UpdatedSOD.LstStandardOperationsDictionaryDetection.Where(x => x.IdDetection == eRMSOPDetection.IdDetection && x.IdWorkoperation == Convert.ToUInt64(eRMSOPDetection.IdworkOperationByStage)).FirstOrDefault();
                                        if (Newpos != null)
                                        {
                                            if (OldPosition != null)
                                            {

                                                if (Newpos.Position != OldPosition.DetectionPosition)
                                                {
                                                    string Name = eRMSOPDetection.Name;
                                                    if (OldPosition.Position == null)
                                                    {
                                                        if (!string.IsNullOrEmpty(DetectionNameForEditLog))
                                                        {
                                                            string log = "The order of Detection in " + Convert.ToString(DetectionNameForEditLog) + " " + Convert.ToString(eRMSOPDetection.Name) + " has been changed from " + "None" + " to " + Convert.ToString(Newpos.DetectionPosition) + ".";
                                                            StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                                        }
                                                    }
                                                    else
                                                    {

                                                        if (!string.IsNullOrEmpty(DetectionNameForEditLog))
                                                        {
                                                            string log = "The order of Detection in " + Convert.ToString(DetectionNameForEditLog) + " " + Convert.ToString(eRMSOPDetection.Name) + " has been changed from " + OldPosition.DetectionPosition + " to " + Convert.ToString(Newpos.Position) + ".";
                                                            StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                                        }
                                                    }
                                                }
                                            }
                                            else
                                            {
                                                if (!string.IsNullOrEmpty(DetectionNameForEditLog))
                                                {
                                                    string log = "The order of Detection in " + Convert.ToString(DetectionNameForEditLog) + " " + Convert.ToString(eRMSOPDetection.Name) + " has been changed from " + "None" + " to " + Convert.ToString(Newpos.Position) + ".";
                                                    StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                                }
                                            }
                                        }
                                        #endregion
                                    }


                                    //AddRemarksLogs(ISERMSOPDetectionValueUpdated.Remarks, eRMSOPDetection.Remarks, "Detection", subTemplate, eRMSOPDetection.Name);
                                    AddRemarksLogs(ISERMSOPDetectionValueUpdated.Remarks, eRMSOPDetection.Remarks, "Detection", DetectionNameForEditLog, eRMSOPDetection.Name);

                                }
                            }

                        }
                    }
                    catch (Exception ex) { }

                }

                try
                {


                    if (standardOperationsDictionaryDetectionDeleteList.Count() > 0)
                    {
                        string childs = string.Empty;
                        //string oldcheckparent = string.Empty;
                        string log = string.Empty;
                        string cpTypeNameForDelete = string.Empty;
                        var deleteworkoperationlist = tempWorkOperationClonedDetection.Except(DetectionMenulist).ToList();
                        // var AddNewworkoperation = Newworkoperationlist.Where(x => x.IdParent == null).FirstOrDefault();
                        if (deleteworkoperationlist.Count > 0)
                        {
                            for (int i = 0; i < deleteworkoperationlist.Count; i++)
                            {

                                if (GetStages.Any(a => a.Code.Equals(deleteworkoperationlist[i].Name)))
                                { }
                                else
                                {
                                    //if (deleteworkoperationlist[i].IdStatus != 1536)
                                    //{
                                    List<ERMSOPDetection> childList = deleteworkoperationlist.Where(w => w.ParentName != null && w.ParentName.Equals(deleteworkoperationlist[i].KeyName)).ToList();
                                    if (childList.Count == 0)
                                    {
                                        if (string.IsNullOrEmpty(childs))
                                        {
                                            childs = deleteworkoperationlist[i].Name.Trim();
                                        }
                                        else
                                            childs = childs + ", " + deleteworkoperationlist[i].Name.Trim();
                                    }
                                    // }
                                }
                            }

                            if (!string.IsNullOrEmpty(childs))
                            {

                                cpTypeNameForDelete = DetectionsMenulistForGridLayoutForLog.Where(x => x.IdDetection == Convert.ToInt32(IdDetectionForDelete)).Select(y => y.Name).FirstOrDefault().ToString();


                                log = "In Detection " + Convert.ToString(cpTypeNameForDelete) + " " + Convert.ToString(childs) + " has been deleted.";
                                //log = "In Detection " + Convert.ToString(subTemplate) + " " + Convert.ToString(childs) + " has been deleted.";
                                //string log = Convert.ToString(deleteparent.Name) + " in module " + Convert.ToString(subTemplate) + " sub groups of " + Convert.ToString(Template) + " groups has been deleted.";
                                StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                            }



                        }
                    }
                }
                catch (Exception ex)
                {
                }

                GeosApplication.Instance.Logger.Log("Method DetectionLog()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method DetectionLog() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

            }
        }

        private void OptionLog()
        {

            try
            {
                GeosApplication.Instance.Logger.Log("Method OptionLog()...", category: Category.Info, priority: Priority.Low);

                ERMOptions ermOptions = (ERMOptions)SelectedItemOption;
                int IdDetectionForDelete = ermOptions.IdDetection;
                string Template = Convert.ToString(SelectedItemOptionGroup);
                string subTemplate = Convert.ToString(ermOptions.Name);
                string SODoldRemarks = string.Empty;
                string SODnewRemarks = string.Empty;
                ObservableCollection<ERMOptions> OptionsMenulistForGridLayoutForLog;
                OptionsMenulistForGridLayoutForLog = new ObservableCollection<ERMOptions>(ERMService.GetAllOptions_V2300().ToList());

                if (OptionsMenulist != null && OptionsMenulist.Count > 0)
                {
                    try
                    {
                        string ParentName = string.Empty;
                        //var temp = tempWorkOperationClonedDetection;
                        // var temp2 = ModuleMenulist;
                        ulong tIdDetection = 0; //[GEOS2-3924][Rupali Sarode][22-11-2022]


                        //var Newworkoperationlist = OptionsMenulist.Except(tempWorkOperationClonedOptions).ToList();

                        //[GOES2-3925][Rupali Sarode][02-12-2022]
                        //var Newworkoperationlist = SparePartsMenulist.Except(tempWorkOperationClonedSpareParts).ToList();
                        var Newworkoperationlist = OptionsMenulist.Where(x => !tempWorkOperationClonedOptions.Any(y => y.IdworkOperationByStage == x.IdworkOperationByStage
                        && y.IdDetection == x.IdDetection)).ToList();

                        string childs = string.Empty;

                        if (Newworkoperationlist.Count > 0)
                        {
                            for (int i = 0; i < Newworkoperationlist.Count; i++)
                            {
                                if (GetStages.Any(a => a.Code.Equals(Newworkoperationlist[i].Name)))
                                {
                                }
                                else
                                {
                                    //if (Newworkoperationlist[i].IdStatus != 1536)
                                    //{
                                    //List<ERMSOPOptions> childList = Newworkoperationlist.Where(w => w.ParentName != null && w.ParentName.Equals(Newworkoperationlist[i].KeyName)).ToList();
                                    List<WorkOperationByStages> childList = WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(Newworkoperationlist[i].KeyName)).ToList();

                                    if (childList.Count == 0)
                                    {
                                        if (string.IsNullOrEmpty(childs))
                                        {
                                            childs = Newworkoperationlist[i].Name.Trim();
                                            tIdDetection = Convert.ToUInt64(Newworkoperationlist[i].IdDetection);
                                        }
                                        else
                                            childs = childs + ", " + Newworkoperationlist[i].Name.Trim();
                                    }
                                    // }
                                }
                            }
                            string log = string.Empty;
                            if (!string.IsNullOrEmpty(childs))
                            {
                                //[GEOS2-3924][Rupali Sarode][21-11-2022]
                                //log = "In Option " + Convert.ToString(subTemplate) + " " + Convert.ToString(childs) + " has been added.";

                                string cpTypeName = string.Empty;

                                cpTypeName = OptionsMenulistForGridLayoutForLog.Where(x => x.IdDetection == Convert.ToInt32(tIdDetection)).Select(y => y.Name).FirstOrDefault().ToString();

                                if (!string.IsNullOrEmpty(cpTypeName))
                                {
                                    log = "In Option " + Convert.ToString(cpTypeName) + " " + Convert.ToString(childs) + " has been added.";

                                    //string log = Convert.ToString(deleteparent.Name) + " in module " + Convert.ToString(subTemplate) + " sub groups of " + Convert.ToString(Template) + " groups has been deleted.";
                                    StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                }
                            }
                        }


                        //if (Newworkoperationlist.Count > 0)
                        //{

                        //    //string Name = string.Empty;
                        //    var AddNewworkoperation = Newworkoperationlist.Where(x => x.IdParent == null).ToList();
                        //    List<string> templist = new List<string>();

                        //    if (AddNewworkoperation.Count > 0)
                        //    {
                        //        string oldparent = string.Empty;
                        //        string tempName = string.Empty;
                        //        foreach (var Parentitem in AddNewworkoperation)
                        //        {


                        //            string Keyname = Convert.ToString(Parentitem.KeyName);
                        //            ParentName = Convert.ToString(Parentitem.Name);
                        //            //tempName = tempName + ParentName;

                        //            if (!string.IsNullOrEmpty(Keyname))
                        //            {
                        //                var parent = Newworkoperationlist.Where(x => x.ParentName == Keyname && x.IdStatus != 1536).ToList();

                        //                if (parent == null)
                        //                {

                        //                }
                        //                else
                        //                {
                        //                    foreach (var itemchild in parent)
                        //                    {
                        //                        //tempName = tempName + ", " + Convert.ToString(itemchild.Name);
                        //                        var child = Newworkoperationlist.Where(x => x.ParentName == itemchild.KeyName && x.IdStatus != 1536).ToList();

                        //                        if (child.Count == 0)
                        //                        {
                        //                            if (itemchild.IdStatus != 1536)
                        //                            {

                        //                                if (!string.IsNullOrEmpty(tempName))
                        //                                {
                        //                                    tempName = tempName + ", " + Convert.ToString(itemchild.Name);
                        //                                }
                        //                                else
                        //                                {
                        //                                    tempName = tempName + " " + Convert.ToString(itemchild.Name);
                        //                                }

                        //                            }

                        //                        }
                        //                        else
                        //                        {
                        //                            foreach (var itemchild1 in child)
                        //                            {
                        //                                //tempName = tempName + ", " + Convert.ToString(itemchild1.Name);
                        //                                var child1 = Newworkoperationlist.Where(x => x.ParentName == itemchild1.KeyName && x.IdStatus != 1536).ToList();
                        //                                if (child1.Count == 0)
                        //                                {
                        //                                    if (itemchild1.IdStatus != 1536)
                        //                                    {
                        //                                        //if (itemchild1.IsInactiveWorkOperation == false)
                        //                                        if (!string.IsNullOrEmpty(tempName))
                        //                                        {
                        //                                            tempName = tempName + ", " + Convert.ToString(itemchild1.Name);
                        //                                        }
                        //                                        else
                        //                                        {
                        //                                            tempName = tempName + " " + Convert.ToString(itemchild1.Name);
                        //                                        }
                        //                                    }
                        //                                }
                        //                                else
                        //                                {
                        //                                    foreach (var itemchild2 in child1)
                        //                                    {
                        //                                        //tempName = tempName + ", " + Convert.ToString(itemchild2.Name);
                        //                                        var child2 = Newworkoperationlist.Where(x => x.ParentName == itemchild2.KeyName && x.IdStatus != 1536).ToList();
                        //                                        if (child2.Count == 0)
                        //                                        {
                        //                                            if (itemchild2.IdStatus != 1536)     //  && itemchild2.IsInactiveWorkOperation == false
                        //                                            {
                        //                                                if (!string.IsNullOrEmpty(tempName))
                        //                                                {
                        //                                                    tempName = tempName + ", " + Convert.ToString(itemchild2.Name);
                        //                                                }
                        //                                                else
                        //                                                {
                        //                                                    tempName = tempName + " " + Convert.ToString(itemchild2.Name);
                        //                                                }
                        //                                            }
                        //                                        }
                        //                                        else
                        //                                        {
                        //                                            foreach (var itemchild3 in child2)
                        //                                            {
                        //                                                //tempName = tempName + ", " + Convert.ToString(itemchild3.Name);
                        //                                                var child3 = Newworkoperationlist.Where(x => x.ParentName == itemchild3.KeyName && x.IdStatus != 1536).ToList();
                        //                                                if (child3.Count == 0)
                        //                                                {
                        //                                                    if (itemchild3.IdStatus != 1536)     //&& itemchild3.IsInactiveWorkOperation == false
                        //                                                    {
                        //                                                        if (!string.IsNullOrEmpty(tempName))
                        //                                                        {
                        //                                                            tempName = tempName + ", " + Convert.ToString(itemchild3.Name);
                        //                                                        }
                        //                                                        else
                        //                                                        {
                        //                                                            tempName = tempName + " " + Convert.ToString(itemchild3.Name);
                        //                                                        }
                        //                                                    }
                        //                                                }
                        //                                                else
                        //                                                {
                        //                                                    foreach (var itemchild4 in child3)
                        //                                                    {
                        //                                                        //tempName = tempName + ", " + Convert.ToString(itemchild3.Name);
                        //                                                        var child4 = Newworkoperationlist.Where(x => x.ParentName == itemchild4.KeyName).ToList();
                        //                                                        if (child4.Count == 0)
                        //                                                        {
                        //                                                            if (itemchild4.IdStatus != 1536)
                        //                                                            {
                        //                                                                if (!string.IsNullOrEmpty(tempName))
                        //                                                                {
                        //                                                                    tempName = tempName + ", " + Convert.ToString(itemchild4.Name);
                        //                                                                }
                        //                                                                else
                        //                                                                {
                        //                                                                    tempName = tempName + " " + Convert.ToString(itemchild4.Name);
                        //                                                                }
                        //                                                            }
                        //                                                        }
                        //                                                    }
                        //                                                }
                        //                                            }
                        //                                        }
                        //                                    }
                        //                                }

                        //                            }
                        //                        }

                        //                    }
                        //                }

                        //            }
                        //            else
                        //            {

                        //            }

                        //            string log = "In Option " + Convert.ToString(subTemplate) + " " + Convert.ToString(tempName) + " has been added.";
                        //            tempName = "";
                        //            StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });


                        //        }
                        //    }
                        //}

                        string OptionNameForEditLog = string.Empty;
                        foreach (ERMSOPOptions eRMSOPOption in OptionsMenulist)
                        {
                            //try
                            //{
                            //    var parent = OptionsMenulist.Where(x => x.KeyName == eRMSOPOption.ParentName).FirstOrDefault();
                            //    if (parent != null)
                            //    {
                            //        int i = 1;
                            //        String Keyname = Convert.ToString(parent.KeyName);
                            //        ParentName = Convert.ToString(parent.Name);
                            //        //string 
                            //        while (i > 0)
                            //        {
                            //            if (!string.IsNullOrEmpty(Keyname))
                            //            {
                            //                parent = OptionsMenulist.Where(x => x.KeyName == parent.ParentName).FirstOrDefault();

                            //                if (parent == null)
                            //                {
                            //                    i = 0;
                            //                }
                            //                else
                            //                {
                            //                    Keyname = Convert.ToString(parent.KeyName);
                            //                    ParentName = Convert.ToString(parent.Name);
                            //                    i = 1;
                            //                }

                            //            }
                            //            else
                            //            {
                            //                i = 0;
                            //            }
                            //        }
                            //    }
                            //}
                            //catch (Exception ex) { }

                            if (string.IsNullOrEmpty(OptionNameForEditLog) && eRMSOPOption.IdDetection != 0)

                                OptionNameForEditLog = OptionsMenulistForGridLayoutForLog.Where(x => (ulong)x.IdDetection == eRMSOPOption.IdDetection).Select(y => y.Name).FirstOrDefault().ToString();

                            WorkOperationByStages workOperationByStages = WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(eRMSOPOption.KeyName)).FirstOrDefault();
                            StandardOperationsDictionaryOption ISERMSOPOptionValueUpdated = tempLstStandardOperationsDictionaryOption.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPOption.IdworkOperationByStage) && w.IdDetection == eRMSOPOption.IdDetection).FirstOrDefault();
                            ERMSOPOptions oldworkoperationstages = tempWorkOperationClonedOptions.Where(x => x.Code != eRMSOPOption.Code).FirstOrDefault();
                            if (ISERMSOPOptionValueUpdated != null)
                            {
                                #region [GEOS2-4083][Rupali Sarode][10-12-2022]

                                if (ISERMSOPOptionValueUpdated.IdWorkoperation == Convert.ToUInt64(eRMSOPOption.IdworkOperationByStage) && (ISERMSOPOptionValueUpdated.Activity == null || ISERMSOPOptionValueUpdated.Activity == 0))
                                {
                                    ISERMSOPOptionValueUpdated.Activity = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == eRMSOPOption.IdworkOperationByStage).Select(b => b.Activity).FirstOrDefault();
                                }
                                if (ISERMSOPOptionValueUpdated.IdWorkoperation == Convert.ToUInt64(eRMSOPOption.IdworkOperationByStage) && (ISERMSOPOptionValueUpdated.ObservedTime == null || ISERMSOPOptionValueUpdated.ObservedTime == 0))
                                {
                                    ISERMSOPOptionValueUpdated.ObservedTime = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == eRMSOPOption.IdworkOperationByStage).Select(b => b.ObservedTime).FirstOrDefault();
                                }
                                #endregion

                                if (workOperationByStages != null)
                                {
                                    if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(workOperationByStages.Name.Trim())))
                                    {

                                    }
                                    else
                                    {

                                        if (ISERMSOPOptionValueUpdated.Activity != eRMSOPOption.OptionActivity || Math.Round(Convert.ToDouble(ISERMSOPOptionValueUpdated.ObservedTime), 2) != Math.Round(Convert.ToDouble(eRMSOPOption.OptionObservedTime), 2) || ISERMSOPOptionValueUpdated.Position != eRMSOPOption.OptionPosition)
                                        {
                                            if (ISERMSOPOptionValueUpdated.Activity != eRMSOPOption.OptionActivity)
                                            {
                                                string Name = eRMSOPOption.Name;
                                                //string log = "In Option " + Convert.ToString(subTemplate) + " " + Convert.ToString(eRMSOPOption.Name) + " Activity Time changed from " + ISERMSOPOptionValueUpdated.Activity + " to " + Convert.ToString(eRMSOPOption.OptionActivity) + ".";
                                                if (!string.IsNullOrEmpty(OptionNameForEditLog))
                                                {
                                                    string log = "In Option " + Convert.ToString(OptionNameForEditLog) + " " + Convert.ToString(eRMSOPOption.Name) + " Activity Time changed from " + ISERMSOPOptionValueUpdated.Activity + " to " + Convert.ToString(eRMSOPOption.OptionActivity) + ".";
                                                    //string log = Convert.ToString(eRMSOPOption.Name) + " of work operation " + Convert.ToString(ParentName) + " Activity Time updated from " + ISERMSOPOptionValueUpdated.Activity + " to " + Convert.ToString(eRMSOPOption.OptionActivity) + " in option " + Convert.ToString(subTemplate) + " sub group of " + Convert.ToString(Template) + " groups.";

                                                    StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                                }
                                            }

                                            if (Math.Round(Convert.ToDouble(ISERMSOPOptionValueUpdated.ObservedTime), 2) != Math.Round(Convert.ToDouble(eRMSOPOption.OptionObservedTime), 2))
                                            {
                                                string Name = eRMSOPOption.Name;
                                                //string log = "In Option " + Convert.ToString(subTemplate) + " " + Convert.ToString(eRMSOPOption.Name) + " Observed Time changed from " + ISERMSOPOptionValueUpdated.ObservedTime + " to " + Convert.ToString(eRMSOPOption.OptionObservedTime) + ".";
                                                // string log = Convert.ToString(eRMSOPOption.Name) + " of work operation " + Convert.ToString(ParentName) + " Observed Time updated from " + ISERMSOPOptionValueUpdated.ObservedTime + " to " + Convert.ToString(eRMSOPOption.OptionObservedTime) + " in option " + Convert.ToString(subTemplate) + " sub groups of " + Convert.ToString(Template) + " groups.";
                                                #region [GEOS2-3954] [Rupali Sarode] time change
                                                string OldObservedTime = Convert.ToString(ConvertfloattoTimespanlog(Convert.ToString(ISERMSOPOptionValueUpdated.ObservedTime)));
                                                string CurrentObervedTime = Convert.ToString(new TimeSpan(eRMSOPOption.UITempOptionObservedTime.Hours, eRMSOPOption.UITempOptionObservedTime.Minutes, eRMSOPOption.UITempOptionObservedTime.Seconds));
                                                if (!string.IsNullOrEmpty(OptionNameForEditLog))
                                                {
                                                    //string log = "In Option " + Convert.ToString(subTemplate) + " " + Convert.ToString(eRMSOPOption.Name) + " Observed Time changed from " + OldObservedTime + " to " + Convert.ToString(eRMSOPOption.UITempOptionObservedTime) + ".";
                                                    string log = "In Option " + Convert.ToString(OptionNameForEditLog) + " " + Convert.ToString(eRMSOPOption.Name) + " Observed Time changed from " + OldObservedTime + " to " + CurrentObervedTime + ".";
                                                    #endregion

                                                    StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                                }
                                            }
                                            #region rajashri GEOS2-5629 module changelog of position
                                            var OldPosition = ClonedSOD.LstStandardOperationsDictionaryOption.Where(x => x.IdDetection == eRMSOPOption.IdDetection && x.IdWorkoperation == Convert.ToUInt64(eRMSOPOption.IdworkOperationByStage)).FirstOrDefault();

                                            var Newpos = UpdatedSOD.LstStandardOperationsDictionaryOption.Where(x => x.IdDetection == eRMSOPOption.IdDetection && x.IdWorkoperation == Convert.ToUInt64(eRMSOPOption.IdworkOperationByStage)).FirstOrDefault();
                                            if (Newpos != null)
                                            {
                                                if (OldPosition != null)
                                                {
                                                    if (Newpos.Position != OldPosition.OptionPosition)
                                                    {
                                                        string Name = eRMSOPOption.Name;
                                                        if (OldPosition.OptionPosition == null)
                                                        {
                                                            if (!string.IsNullOrEmpty(OptionNameForEditLog))
                                                            {
                                                                string log = "The order of Option in " + Convert.ToString(OptionNameForEditLog) + " " + Convert.ToString(eRMSOPOption.Name) + " has been changed from " + "None" + " to " + Convert.ToString(Newpos.Position) + ".";
                                                                StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                                            }
                                                        }
                                                        else
                                                        {

                                                            if (!string.IsNullOrEmpty(OptionNameForEditLog))
                                                            {
                                                                string log = "The order of Option in " + Convert.ToString(OptionNameForEditLog) + " " + Convert.ToString(eRMSOPOption.Name) + " has been changed from " + OldPosition.OptionPosition + " to " + Convert.ToString(Newpos.Position) + ".";
                                                                StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                                            }
                                                        }
                                                    }
                                                }
                                                else
                                                {
                                                    if (!string.IsNullOrEmpty(OptionNameForEditLog))
                                                    {
                                                        string log = "The order of Option in " + Convert.ToString(OptionNameForEditLog) + " " + Convert.ToString(eRMSOPOption.Name) + " has been changed from " + "None" + " to " + Convert.ToString(Newpos.Position) + ".";
                                                        StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                                    }
                                                }
                                            }
                                            #endregion
                                        }

                                        //AddRemarksLogs(ISERMSOPOptionValueUpdated.Remarks, eRMSOPOption.Remarks, "Option", subTemplate, eRMSOPOption.Name);
                                        AddRemarksLogs(ISERMSOPOptionValueUpdated.Remarks, eRMSOPOption.Remarks, "Option", OptionNameForEditLog, eRMSOPOption.Name);


                                    }
                                }
                                else
                                {
                                    if (ISERMSOPOptionValueUpdated.Activity != eRMSOPOption.OptionActivity || Math.Round(Convert.ToDouble(ISERMSOPOptionValueUpdated.ObservedTime), 2) != Math.Round(Convert.ToDouble(eRMSOPOption.OptionObservedTime), 2) || ISERMSOPOptionValueUpdated.Position != eRMSOPOption.OptionPosition)
                                    {
                                        if (ISERMSOPOptionValueUpdated.Activity != eRMSOPOption.OptionActivity)
                                        {
                                            string Name = eRMSOPOption.Name;
                                            if (!string.IsNullOrEmpty(OptionNameForEditLog))
                                            {
                                                //string log = "In Option " + Convert.ToString(subTemplate) + " " + Convert.ToString(eRMSOPOption.Name) + " Activity Time changed from " + ISERMSOPOptionValueUpdated.Activity + " to " + Convert.ToString(eRMSOPOption.OptionActivity) + ".";
                                                string log = "In Option " + Convert.ToString(OptionNameForEditLog) + " " + Convert.ToString(eRMSOPOption.Name) + " Activity Time changed from " + ISERMSOPOptionValueUpdated.Activity + " to " + Convert.ToString(eRMSOPOption.OptionActivity) + ".";
                                                //string log = Convert.ToString(eRMSOPOption.Name) + " of work operation " + Convert.ToString(ParentName) + " Activity Time updated from " + ISERMSOPOptionValueUpdated.Activity + " to " + Convert.ToString(eRMSOPOption.OptionActivity) + " in option " + Convert.ToString(subTemplate) + " sub group of " + Convert.ToString(Template) + " groups.";
                                                StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                            }
                                        }

                                        if (Math.Round(Convert.ToDouble(ISERMSOPOptionValueUpdated.ObservedTime), 2) != Math.Round(Convert.ToDouble(eRMSOPOption.OptionObservedTime), 2))
                                        {
                                            string Name = eRMSOPOption.Name;
                                            //string log = "In Option " + Convert.ToString(subTemplate) + " " + Convert.ToString(eRMSOPOption.Name) + " Observed Time changed from " + ISERMSOPOptionValueUpdated.ObservedTime + " to " + Convert.ToString(eRMSOPOption.OptionObservedTime) + ".";
                                            //string log = Convert.ToString(eRMSOPOption.Name) + " of work operation " + Convert.ToString(ParentName) + " Observed Time updated from " + ISERMSOPOptionValueUpdated.ObservedTime + " to " + Convert.ToString(eRMSOPOption.OptionObservedTime) + " in option " + Convert.ToString(subTemplate) + " sub groups of " + Convert.ToString(Template) + " groups.";
                                            //string log = "Template- " + Convert.ToString(Template) + " subTemplate- " + Convert.ToString(subTemplate) + " Work Operation- " + Convert.ToString(eRMSOPModule.ParentName) + " child -" + Convert.ToString(eRMSOPModule.Name) + " observed Time- " + Convert.ToString(eRMSOPModule.ObservedTime) + " has been updated.";
                                            #region [GEOS2-3954] [Rupali Sarode] time change
                                            string OldObservedTime = Convert.ToString(ConvertfloattoTimespanlog(Convert.ToString(ISERMSOPOptionValueUpdated.ObservedTime)));
                                            string CurrentObervedTime = Convert.ToString(new TimeSpan(eRMSOPOption.UITempOptionObservedTime.Hours, eRMSOPOption.UITempOptionObservedTime.Minutes, eRMSOPOption.UITempOptionObservedTime.Seconds));
                                            if (!string.IsNullOrEmpty(OptionNameForEditLog))
                                            {
                                                //string log = "In Option " + Convert.ToString(subTemplate) + " " + Convert.ToString(eRMSOPOption.Name) + " Observed Time changed from " + OldObservedTime + " to " + Convert.ToString(eRMSOPOption.UITempOptionObservedTime) + ".";
                                                string log = "In Option " + Convert.ToString(OptionNameForEditLog) + " " + Convert.ToString(eRMSOPOption.Name) + " Observed Time changed from " + OldObservedTime + " to " + CurrentObervedTime + ".";
                                                #endregion
                                                StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                            }
                                        }
                                        //#region rajashri GEOS2-5629 module changelog of position 
                                        //if (ISERMSOPOptionValueUpdated.Position != eRMSOPOption.OptionPosition)
                                        //{
                                        //    string Name = eRMSOPOption.Name;
                                        //    if (ISERMSOPOptionValueUpdated.Position == null)
                                        //    {
                                        //        if (!string.IsNullOrEmpty(OptionNameForEditLog))
                                        //        {
                                        //            string log = "The order of Option in " + Convert.ToString(OptionNameForEditLog) + " " + Convert.ToString(eRMSOPOption.Name) + " has been changed from " + "None" + " to " + Convert.ToString(eRMSOPOption.OptionPosition) + ".";
                                        //            StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                        //        }
                                        //    }
                                        //    else
                                        //    {

                                        //        if (!string.IsNullOrEmpty(OptionNameForEditLog))
                                        //        {
                                        //            string log = "The order of Option in " + Convert.ToString(OptionNameForEditLog) + " " + Convert.ToString(eRMSOPOption.Name) + " has been changed from " + ISERMSOPOptionValueUpdated.Position + " to " + Convert.ToString(eRMSOPOption.OptionPosition) + ".";
                                        //            StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                        //        }
                                        //    }
                                        //}
                                        //#endregion
                                        #region rajashri GEOS2-5629 module changelog of position
                                        var OldPosition = ClonedSOD.LstStandardOperationsDictionaryOption.Where(x => x.IdDetection == eRMSOPOption.IdDetection && x.IdWorkoperation == Convert.ToUInt64(eRMSOPOption.IdworkOperationByStage)).FirstOrDefault();

                                        var Newpos = UpdatedSOD.LstStandardOperationsDictionaryOption.Where(x => x.IdDetection == eRMSOPOption.IdDetection && x.IdWorkoperation == Convert.ToUInt64(eRMSOPOption.IdworkOperationByStage)).FirstOrDefault();
                                        if (Newpos != null)
                                        {
                                            if (OldPosition != null)
                                            {
                                                if (Newpos.Position != OldPosition.OptionPosition)
                                                {
                                                    string Name = eRMSOPOption.Name;
                                                    if (OldPosition.OptionPosition == null)
                                                    {
                                                        if (!string.IsNullOrEmpty(OptionNameForEditLog))
                                                        {
                                                            string log = "The order of Option in " + Convert.ToString(OptionNameForEditLog) + " " + Convert.ToString(eRMSOPOption.Name) + " has been changed from " + "None" + " to " + Convert.ToString(Newpos.Position) + ".";
                                                            StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                                        }
                                                    }
                                                    else
                                                    {

                                                        if (!string.IsNullOrEmpty(OptionNameForEditLog))
                                                        {
                                                            string log = "The order of Option in " + Convert.ToString(OptionNameForEditLog) + " " + Convert.ToString(eRMSOPOption.Name) + " has been changed from " + OldPosition.OptionPosition + " to " + Convert.ToString(Newpos.Position) + ".";
                                                            StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                                        }
                                                    }
                                                }
                                            }
                                            else
                                            {
                                                if (!string.IsNullOrEmpty(OptionNameForEditLog))
                                                {
                                                    string log = "The order of Option in " + Convert.ToString(OptionNameForEditLog) + " " + Convert.ToString(eRMSOPOption.Name) + " has been changed from " + "None" + " to " + Convert.ToString(Newpos.Position) + ".";
                                                    StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                                }
                                            }
                                        }
                                        #endregion
                                    }

                                    //AddRemarksLogs(ISERMSOPOptionValueUpdated.Remarks, eRMSOPOption.Remarks, "Option", subTemplate, eRMSOPOption.Name);
                                    AddRemarksLogs(ISERMSOPOptionValueUpdated.Remarks, eRMSOPOption.Remarks, "Option", OptionNameForEditLog, eRMSOPOption.Name);

                                }
                            }

                        }
                    }
                    catch (Exception ex) { }

                }

                try
                {
                    if (standardOperationsDictionaryOptionDeleteList.Count() > 0)
                    {
                        string childs = string.Empty;
                        //string oldcheckparent = string.Empty;
                        string cpTypeNameForDelete = string.Empty;
                        string log = string.Empty;
                        var deleteworkoperationlist = tempWorkOperationClonedOptions.Except(OptionsMenulist).ToList();
                        // var AddNewworkoperation = Newworkoperationlist.Where(x => x.IdParent == null).FirstOrDefault();
                        if (deleteworkoperationlist.Count > 0)
                        {
                            for (int i = 0; i < deleteworkoperationlist.Count; i++)
                            {
                                if (GetStages.Any(a => a.Code.Equals(deleteworkoperationlist[i].Name)))
                                { }
                                else
                                {
                                    //if (deleteworkoperationlist[i].IdStatus != 1536)
                                    //{
                                    List<ERMSOPOptions> childList = deleteworkoperationlist.Where(w => w.ParentName != null && w.ParentName.Equals(deleteworkoperationlist[i].KeyName)).ToList();
                                    if (childList.Count == 0)
                                    {
                                        if (string.IsNullOrEmpty(childs))
                                        {
                                            childs = deleteworkoperationlist[i].Name.Trim();
                                        }
                                        else
                                            childs = childs + "," + deleteworkoperationlist[i].Name.Trim();
                                    }
                                    // }
                                }
                            }

                            if (!string.IsNullOrEmpty(childs))
                            {
                                cpTypeNameForDelete = OptionsMenulistForGridLayoutForLog.Where(x => x.IdDetection == Convert.ToInt32(IdDetectionForDelete)).Select(y => y.Name).FirstOrDefault().ToString();

                                log = "In Option " + Convert.ToString(cpTypeNameForDelete) + " " + Convert.ToString(childs) + " has been deleted.";
                                // log = "In Option " + Convert.ToString(subTemplate) + " " + Convert.ToString(childs) + " has been deleted.";
                                //string log = Convert.ToString(deleteparent.Name) + " in module " + Convert.ToString(subTemplate) + " sub groups of " + Convert.ToString(Template) + " groups has been deleted.";
                                StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                            }

                        }
                    }

                }
                catch (Exception ex)
                {
                }
                GeosApplication.Instance.Logger.Log("Method OptionLog()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method OptionLog() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

            }
        }

        private void WaysLog()
        {

            try
            {
                GeosApplication.Instance.Logger.Log("Method WaysLog()...", category: Category.Info, priority: Priority.Low);

                ERMWays ermWays = (ERMWays)SelectedItemWay;
                int IdDetectionForDelete = ermWays.IdDetection;
                //string Template = Convert.ToString(SelectedItemWaysGroup);
                string subTemplate = Convert.ToString(ermWays.Name);
                string SODoldRemarks = string.Empty;
                string SODnewRemarks = string.Empty;
                ObservableCollection<ERMWays> WaysMenulistForGridLayoutForLog;
                WaysMenulistForGridLayoutForLog = new ObservableCollection<ERMWays>(ERMService.GetAllWays_V2301().ToList());

                if (WaysMenulist != null && WaysMenulist.Count > 0)
                {
                    try
                    {
                        string ParentName = string.Empty;

                        //var Newworkoperationlist = WaysMenulist.Except(tempWorkOperationClonedWays).ToList();

                        //[GOES2-3925][Rupali Sarode][02-12-2022]

                        var Newworkoperationlist = WaysMenulist.Where(x => !tempWorkOperationClonedWays.Any(y => y.IdworkOperationByStage == x.IdworkOperationByStage
                        && y.IdDetection == x.IdDetection)).ToList();

                        string childs = string.Empty;
                        ulong tWayIdCpType = 0; //[GEOS2-3923][sdeshpande][17-11-2022]

                        if (Newworkoperationlist.Count > 0)
                        {
                            for (int i = 0; i < Newworkoperationlist.Count; i++)
                            {
                                if (GetStages.Any(a => a.Code.Equals(Newworkoperationlist[i].Name)))
                                {
                                }
                                else
                                {
                                    // if (Newworkoperationlist[i].IdStatus != 1536)
                                    //{
                                    //List<ERMSOPWays> childList = Newworkoperationlist.Where(w => w.ParentName != null && w.ParentName.Equals(Newworkoperationlist[i].KeyName)).ToList();
                                    List<WorkOperationByStages> childList = WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(Newworkoperationlist[i].KeyName)).ToList();
                                    if (childList.Count == 0)
                                    {
                                        if (string.IsNullOrEmpty(childs))
                                        {
                                            childs = Newworkoperationlist[i].Name.Trim();
                                            tWayIdCpType = Newworkoperationlist[i].IdDetection; //[GEOS2-3923][sdeshpande][17-11-2022]
                                        }
                                        else
                                            childs = childs + ", " + Newworkoperationlist[i].Name.Trim();
                                    }
                                    //}
                                }
                            }
                            string log = string.Empty;
                            if (!string.IsNullOrEmpty(childs))
                            {
                                //log = "In Ways " + Convert.ToString(subTemplate) + " " + Convert.ToString(childs) + " has been added.";
                                string cpWaysTypeName = string.Empty;
                                //cpWaysTypeName = Convert.ToString(WaysMenulistForGridLayout.Where(x => Convert.ToUInt64(x.IdDetection) == tWayIdCpType).Select(y => y.Name).FirstOrDefault());
                                cpWaysTypeName = Convert.ToString(WaysMenulistForGridLayoutForLog.Where(x => Convert.ToUInt64(x.IdDetection) == tWayIdCpType).Select(y => y.Name).FirstOrDefault());
                                if (!string.IsNullOrEmpty(cpWaysTypeName))
                                {
                                    log = "In Ways " + Convert.ToString(cpWaysTypeName) + " " + Convert.ToString(childs) + " has been added.";
                                    StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                }
                            }
                        }


                        string WaysNameForEditLog = string.Empty;

                        foreach (ERMSOPWays eRMSOPWay in WaysMenulist)
                        {
                            if (string.IsNullOrEmpty(WaysNameForEditLog) && eRMSOPWay.IdDetection != 0)

                                WaysNameForEditLog = WaysMenulistForGridLayoutForLog.Where(x => (ulong)x.IdDetection == eRMSOPWay.IdDetection).Select(y => y.Name).FirstOrDefault().ToString();


                            WorkOperationByStages workOperationByStages = WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(eRMSOPWay.KeyName)).FirstOrDefault();
                            StandardOperationsDictionaryWays ISERMSOPWaysValueUpdated = tempLstStandardOperationsDictionaryWay.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPWay.IdworkOperationByStage) && w.IdDetection == eRMSOPWay.IdDetection).FirstOrDefault();
                            ERMSOPWays oldworkoperationstages = tempWorkOperationClonedWays.Where(x => x.Code != eRMSOPWay.Code).FirstOrDefault();
                            if (ISERMSOPWaysValueUpdated != null)
                            {
                                #region Geos2 4077 Ways Store/ Save in the SDO tables the Observed time, Activity

                                if (ISERMSOPWaysValueUpdated.IdWorkoperation == Convert.ToUInt64(eRMSOPWay.IdworkOperationByStage) && (ISERMSOPWaysValueUpdated.Activity == null || ISERMSOPWaysValueUpdated.Activity == 0))
                                {
                                    ISERMSOPWaysValueUpdated.Activity = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == eRMSOPWay.IdworkOperationByStage).Select(b => b.Activity).FirstOrDefault();
                                }
                                if (ISERMSOPWaysValueUpdated.IdWorkoperation == Convert.ToUInt64(eRMSOPWay.IdworkOperationByStage) && (ISERMSOPWaysValueUpdated.ObservedTime == null || ISERMSOPWaysValueUpdated.ObservedTime == 0))
                                {
                                    ISERMSOPWaysValueUpdated.ObservedTime = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == eRMSOPWay.IdworkOperationByStage).Select(b => b.ObservedTime).FirstOrDefault();
                                }
                                #endregion

                                if (workOperationByStages != null)//
                                {

                                    if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(workOperationByStages.Name.Trim())))
                                    {

                                    }
                                    else
                                    {

                                        if (ISERMSOPWaysValueUpdated.Activity != eRMSOPWay.WayActivity || Math.Round(Convert.ToDouble(ISERMSOPWaysValueUpdated.ObservedTime), 2) != Math.Round(Convert.ToDouble(eRMSOPWay.WayObservedTime), 2) || ISERMSOPWaysValueUpdated.Position != eRMSOPWay.WayPosition)
                                        {
                                            if (ISERMSOPWaysValueUpdated.Activity != eRMSOPWay.WayActivity)
                                            {
                                                string Name = eRMSOPWay.Name;

                                                if (!string.IsNullOrEmpty(WaysNameForEditLog))
                                                {
                                                    //string log = "In Ways " + Convert.ToString(subTemplate) + " " + Convert.ToString(eRMSOPWay.Name) + " Activity Time changed from " + ISERMSOPWaysValueUpdated.Activity + " to " + Convert.ToString(eRMSOPWay.WayActivity) + ".";
                                                    string log = "In Ways " + Convert.ToString(WaysNameForEditLog) + " " + Convert.ToString(eRMSOPWay.Name) + " Activity Time changed from " + ISERMSOPWaysValueUpdated.Activity + " to " + Convert.ToString(eRMSOPWay.WayActivity) + ".";
                                                    StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                                }
                                            }

                                            if (Math.Round(Convert.ToDouble(ISERMSOPWaysValueUpdated.ObservedTime), 2) != Math.Round(Convert.ToDouble(eRMSOPWay.WayObservedTime), 2))
                                            {
                                                string Name = eRMSOPWay.Name;
                                                //string log = "In Ways " + Convert.ToString(subTemplate) + " " + Convert.ToString(eRMSOPWay.Name) + " Observed Time changed from " + ISERMSOPWaysValueUpdated.ObservedTime + " to " + Convert.ToString(eRMSOPWay.WayObservedTime) + ".";
                                                #region [GEOS2-3954] [Rupali Sarode] time change
                                                string OldObservedTime = Convert.ToString(ConvertfloattoTimespanlog(Convert.ToString(ISERMSOPWaysValueUpdated.ObservedTime)));
                                                string CurrentObervedTime = Convert.ToString(new TimeSpan(eRMSOPWay.UITempWaysObservedTime.Hours, eRMSOPWay.UITempWaysObservedTime.Minutes, eRMSOPWay.UITempWaysObservedTime.Seconds));
                                                if (!string.IsNullOrEmpty(WaysNameForEditLog))
                                                {
                                                    //string log = "In Ways " + Convert.ToString(subTemplate) + " " + Convert.ToString(eRMSOPWay.Name) + " Observed Time changed from " + OldObservedTime + " to " + Convert.ToString(eRMSOPWay.UITempWaysObservedTime) + ".";
                                                    string log = "In Ways " + Convert.ToString(WaysNameForEditLog) + " " + Convert.ToString(eRMSOPWay.Name) + " Observed Time changed from " + OldObservedTime + " to " + CurrentObervedTime + ".";
                                                    #endregion
                                                    StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                                }
                                            }
                                            #region rajashri GEOS2-5629 Ways changelog of position 
                                            var OldPosition = ClonedSOD.LstStandardOperationsDictionaryWay.Where(x => x.IdDetection == eRMSOPWay.IdDetection && x.IdWorkoperation == Convert.ToUInt64(eRMSOPWay.IdworkOperationByStage)).FirstOrDefault();

                                            var Newpos = UpdatedSOD.LstStandardOperationsDictionaryWay.Where(x => x.IdDetection == eRMSOPWay.IdDetection && x.IdWorkoperation == Convert.ToUInt64(eRMSOPWay.IdworkOperationByStage)).FirstOrDefault();
                                            if (Newpos != null)
                                            {
                                                if (OldPosition != null)
                                                {

                                                    if (Newpos.Position != OldPosition.WayPosition)
                                                    {
                                                        string Name = eRMSOPWay.Name;
                                                        if (OldPosition.WayPosition == null)
                                                        {
                                                            if (!string.IsNullOrEmpty(WaysNameForEditLog))
                                                            {
                                                                string log = "The order of Ways in " + Convert.ToString(WaysNameForEditLog) + " " + Convert.ToString(eRMSOPWay.Name) + " has been changed from " + "None" + " to " + Convert.ToString(Newpos.Position) + ".";
                                                                StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                                            }
                                                        }
                                                        else
                                                        {

                                                            if (!string.IsNullOrEmpty(WaysNameForEditLog))
                                                            {
                                                                string log = "The order of Ways in " + Convert.ToString(WaysNameForEditLog) + " " + Convert.ToString(eRMSOPWay.Name) + " has been changed from " + OldPosition.WayPosition + " to " + Convert.ToString(Newpos.Position) + ".";
                                                                StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                                            }
                                                        }
                                                    }
                                                }
                                                else
                                                {
                                                    if (!string.IsNullOrEmpty(WaysNameForEditLog))
                                                    {
                                                        string log = "The order of Ways in " + Convert.ToString(WaysNameForEditLog) + " " + Convert.ToString(eRMSOPWay.Name) + " has been changed from " + "None" + " to " + Convert.ToString(Newpos.Position) + ".";
                                                        StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                                    }
                                                }
                                            }
                                            #endregion
                                        }

                                        //AddRemarksLogs(ISERMSOPWaysValueUpdated.Remarks, eRMSOPWay.Remarks, "Ways", subTemplate, eRMSOPWay.Name);
                                        AddRemarksLogs(ISERMSOPWaysValueUpdated.Remarks, eRMSOPWay.Remarks, "Ways", WaysNameForEditLog, eRMSOPWay.Name);

                                    }
                                }
                                else
                                {
                                    if (ISERMSOPWaysValueUpdated.Activity != eRMSOPWay.WayActivity || Math.Round(Convert.ToDouble(ISERMSOPWaysValueUpdated.ObservedTime), 2) != Math.Round(Convert.ToDouble(eRMSOPWay.WayObservedTime), 2) || ISERMSOPWaysValueUpdated.Position != eRMSOPWay.WayPosition)
                                    {
                                        if (ISERMSOPWaysValueUpdated.Activity != eRMSOPWay.WayActivity)
                                        {
                                            string Name = eRMSOPWay.Name;
                                            if (!string.IsNullOrEmpty(WaysNameForEditLog))
                                            {
                                                //string log = "In Ways " + Convert.ToString(subTemplate) + " " + Convert.ToString(eRMSOPWay.Name) + " Activity Time changed from " + ISERMSOPWaysValueUpdated.Activity + " to " + Convert.ToString(eRMSOPWay.WayActivity) + ".";
                                                string log = "In Ways " + Convert.ToString(WaysNameForEditLog) + " " + Convert.ToString(eRMSOPWay.Name) + " Activity Time changed from " + ISERMSOPWaysValueUpdated.Activity + " to " + Convert.ToString(eRMSOPWay.WayActivity) + ".";
                                                StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                            }
                                        }

                                        if (Math.Round(Convert.ToDouble(ISERMSOPWaysValueUpdated.ObservedTime), 2) != Math.Round(Convert.ToDouble(eRMSOPWay.WayObservedTime), 2))
                                        {
                                            string Name = eRMSOPWay.Name;
                                            //string log = "In Ways " + Convert.ToString(subTemplate) + " " + Convert.ToString(eRMSOPWay.Name) + " Observed Time changed from " + ISERMSOPWaysValueUpdated.ObservedTime + " to " + Convert.ToString(eRMSOPWay.WayObservedTime) + ".";
                                            #region [GEOS2-3954] [Rupali Sarode] time change
                                            string OldObservedTime = Convert.ToString(ConvertfloattoTimespanlog(Convert.ToString(ISERMSOPWaysValueUpdated.ObservedTime)));
                                            string CurrentObervedTime = Convert.ToString(new TimeSpan(eRMSOPWay.UITempWaysObservedTime.Hours, eRMSOPWay.UITempWaysObservedTime.Minutes, eRMSOPWay.UITempWaysObservedTime.Seconds));
                                            if (!string.IsNullOrEmpty(WaysNameForEditLog))
                                            {
                                                string log = "In Ways " + Convert.ToString(WaysNameForEditLog) + " " + Convert.ToString(eRMSOPWay.Name) + " Observed Time changed from " + OldObservedTime + " to " + CurrentObervedTime + ".";
                                                #endregion
                                                StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                            }
                                        }
                                        //#region rajashri GEOS2-5629 Ways changelog of position 
                                        //if (ISERMSOPWaysValueUpdated.Position != eRMSOPWay.WayPosition)
                                        //{
                                        //    string Name = eRMSOPWay.Name;
                                        //    if (ISERMSOPWaysValueUpdated.Position == null)
                                        //    {
                                        //        if (!string.IsNullOrEmpty(WaysNameForEditLog))
                                        //        {
                                        //            string log = "The order of Ways in " + Convert.ToString(WaysNameForEditLog) + " " + Convert.ToString(eRMSOPWay.Name) + " has been changed from " + "None" + " to " + Convert.ToString(eRMSOPWay.WayPosition) + ".";
                                        //            StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                        //        }
                                        //    }
                                        //    else
                                        //    {

                                        //        if (!string.IsNullOrEmpty(WaysNameForEditLog))
                                        //        {
                                        //            string log = "The order of Ways in " + Convert.ToString(WaysNameForEditLog) + " " + Convert.ToString(eRMSOPWay.Name) + " has been changed from " + ISERMSOPWaysValueUpdated.Position + " to " + Convert.ToString(eRMSOPWay.WayPosition) + ".";
                                        //            StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                        //        }
                                        //    }
                                        //}
                                        //#endregion

                                        #region rajashri GEOS2-5629 Ways changelog of position 
                                        var OldPosition = ClonedSOD.LstStandardOperationsDictionaryWay.Where(x => x.IdDetection == eRMSOPWay.IdDetection && x.IdWorkoperation == Convert.ToUInt64(eRMSOPWay.IdworkOperationByStage)).FirstOrDefault();

                                        var Newpos = UpdatedSOD.LstStandardOperationsDictionaryWay.Where(x => x.IdDetection == eRMSOPWay.IdDetection && x.IdWorkoperation == Convert.ToUInt64(eRMSOPWay.IdworkOperationByStage)).FirstOrDefault();
                                        if (Newpos != null)
                                        {
                                            if (OldPosition != null)
                                            {

                                                if (Newpos.Position != OldPosition.WayPosition)
                                                {
                                                    string Name = eRMSOPWay.Name;
                                                    if (OldPosition.WayPosition == null)
                                                    {
                                                        if (!string.IsNullOrEmpty(WaysNameForEditLog))
                                                        {
                                                            string log = "The order of Ways in " + Convert.ToString(WaysNameForEditLog) + " " + Convert.ToString(eRMSOPWay.Name) + " has been changed from " + "None" + " to " + Convert.ToString(Newpos.Position) + ".";
                                                            StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                                        }
                                                    }
                                                    else
                                                    {

                                                        if (!string.IsNullOrEmpty(WaysNameForEditLog))
                                                        {
                                                            string log = "The order of Ways in " + Convert.ToString(WaysNameForEditLog) + " " + Convert.ToString(eRMSOPWay.Name) + " has been changed from " + OldPosition.WayPosition + " to " + Convert.ToString(Newpos.Position) + ".";
                                                            StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                                        }
                                                    }
                                                }
                                            }
                                            else
                                            {
                                                if (!string.IsNullOrEmpty(WaysNameForEditLog))
                                                {
                                                    string log = "The order of Ways in " + Convert.ToString(WaysNameForEditLog) + " " + Convert.ToString(eRMSOPWay.Name) + " has been changed from " + "None" + " to " + Convert.ToString(Newpos.Position) + ".";
                                                    StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                                }
                                            }
                                        }
                                        #endregion
                                    }

                                    //AddRemarksLogs(ISERMSOPWaysValueUpdated.Remarks, eRMSOPWay.Remarks, "Ways", subTemplate, eRMSOPWay.Name);
                                    AddRemarksLogs(ISERMSOPWaysValueUpdated.Remarks, eRMSOPWay.Remarks, "Ways", WaysNameForEditLog, eRMSOPWay.Name);

                                }
                            }


                        }
                    }
                    catch (Exception ex) { }

                }

                try
                {
                    if (standardOperationsDictionaryWayDeleteList.Count() > 0)
                    {
                        string childs = string.Empty;
                        string oldcheckparent = string.Empty;
                        string cpWaysTypeNameForDelete = string.Empty;
                        string log = string.Empty;
                        var deleteworkoperationlist = tempWorkOperationClonedWays.Except(WaysMenulist).ToList();
                        //var AddNewworkoperation = Newworkoperationlist.Where(x => x.IdParent == null).FirstOrDefault();
                        if (deleteworkoperationlist.Count > 0)
                        {
                            for (int i = 0; i < deleteworkoperationlist.Count; i++)
                            {
                                if (GetStages.Any(a => a.Code.Equals(deleteworkoperationlist[i].Name)))
                                { }
                                else
                                {
                                    //if (deleteworkoperationlist[i].IdStatus != 1536)
                                    //{
                                    List<ERMSOPWays> childList = deleteworkoperationlist.Where(w => w.ParentName != null && w.ParentName.Equals(deleteworkoperationlist[i].KeyName)).ToList();
                                    if (childList.Count == 0)
                                    {
                                        if (string.IsNullOrEmpty(childs))
                                        {
                                            childs = deleteworkoperationlist[i].Name.Trim();
                                        }
                                        else
                                            childs = childs + ", " + deleteworkoperationlist[i].Name.Trim();
                                    }
                                    //}
                                }
                            }

                            if (!string.IsNullOrEmpty(childs))
                            {
                                cpWaysTypeNameForDelete = Convert.ToString(WaysMenulistForGridLayoutForLog.Where(x => x.IdDetection == IdDetectionForDelete).Select(y => y.Name).FirstOrDefault());

                                log = "In Ways " + Convert.ToString(cpWaysTypeNameForDelete) + " " + Convert.ToString(childs) + " has been deleted.";
                                //log = "In Ways " + Convert.ToString(subTemplate) + " " + Convert.ToString(childs) + " has been deleted.";
                                //  string log = Convert.ToString(deleteparent.Name) + " in module " + Convert.ToString(subTemplate) + " sub groups of " + Convert.ToString(Template) + " groups has been deleted.";
                                StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                            }

                        }
                    }

                }
                catch (Exception ex)
                {
                }

                GeosApplication.Instance.Logger.Log("Method WaysLog()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method WaysLog() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

            }
        }


        private void StructureLog()
        {

            try
            {
                GeosApplication.Instance.Logger.Log("Method StructureLog()...", category: Category.Info, priority: Priority.Low);

                ERMStructures ermStructure = (ERMStructures)SelectedItemStructures;
                var IdCPTypeForStructForDelete = ermStructure.IdCPType;
                //string Template = Convert.ToString(SelectedItemWaysGroup);
                string subTemplate = Convert.ToString(ermStructure.Name);
                string SODoldRemarks = string.Empty;
                string SODnewRemarks = string.Empty;
                //[GEOS2-4108][Rupali Sarode][3-1-2022]
                ObservableCollection<ERMStructures> StructureMenulistForGridLayoutForLog;
                StructureMenulistForGridLayoutForLog = new ObservableCollection<ERMStructures>(ERMService.GetAllStructures_V2320().ToList());

                if (StructureMenulist != null && StructureMenulist.Count > 0)
                {
                    try
                    {
                        string ParentName = string.Empty;
                        ulong tIdCpTypeStruct = 0; //[GEOS2-3926][Rupali Sarode][25-11-2022]


                        //[GOES2-3925][Rupali Sarode][02-12-2022]
                        //var Newworkoperationlist = StructureMenulist.Except(tempWorkOperationClonedStructure).ToList();
                        var Newworkoperationlist = StructureMenulist.Where(x => !tempWorkOperationClonedStructure.Any(y => y.IdworkOperationByStage == x.IdworkOperationByStage
                        && y.IdCpType == x.IdCpType)).ToList();

                        string childs = string.Empty;

                        if (Newworkoperationlist.Count > 0)
                        {
                            for (int i = 0; i < Newworkoperationlist.Count; i++)
                            {
                                if (GetStages.Any(a => a.Code.Equals(Newworkoperationlist[i].Name)))
                                {
                                }
                                else
                                {
                                    // if (Newworkoperationlist[i].IdStatus != 1536)
                                    //{
                                    //[Rupali Sarode][02-12-2022]

                                    // List<ERMSOPStructures> childList = Newworkoperationlist.Where(w => w.ParentName != null && w.ParentName.Equals(Newworkoperationlist[i].KeyName)).ToList();
                                    List<WorkOperationByStages> childList = WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(Newworkoperationlist[i].KeyName)).ToList();

                                    if (childList.Count == 0)
                                    {
                                        if (string.IsNullOrEmpty(childs))
                                        {
                                            childs = Newworkoperationlist[i].Name.Trim();
                                            tIdCpTypeStruct = Convert.ToUInt64(Newworkoperationlist[i].IdCpType);
                                        }
                                        else
                                            childs = childs + ", " + Newworkoperationlist[i].Name.Trim();
                                    }
                                    //}
                                }
                            }
                            string log = string.Empty;
                            if (!string.IsNullOrEmpty(childs))
                            {

                                //log = "In Structures " + Convert.ToString(subTemplate) + " " + Convert.ToString(childs) + " has been added.";
                                string StructureName = string.Empty;

                                //StructureName = StructureMenulistForGridLayout.Where(x => x.IdCPType == tIdCpTypeStruct).Select(y => y.Name).FirstOrDefault().ToString();
                                StructureName = StructureMenulistForGridLayoutForLog.Where(x => x.IdCPType == tIdCpTypeStruct).Select(y => y.Name).FirstOrDefault().ToString();


                                if (!string.IsNullOrEmpty(StructureName))
                                {
                                    log = "In Structures " + Convert.ToString(StructureName) + " " + Convert.ToString(childs) + " has been added.";
                                    StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                }
                            }
                        }


                        string StructureNameForEditLog = string.Empty;

                        foreach (ERMSOPStructures eRMSOPStructure in StructureMenulist)
                        {
                            if (string.IsNullOrEmpty(StructureNameForEditLog) && eRMSOPStructure.IdCpType != 0)

                                StructureNameForEditLog = StructureMenulistForGridLayoutForLog.Where(x => (byte)x.IdCPType == eRMSOPStructure.IdCpType).Select(y => y.Name).FirstOrDefault().ToString();

                            WorkOperationByStages workOperationByStages = WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(eRMSOPStructure.KeyName)).FirstOrDefault();
                            StandardOperationsDictionaryStructures ISERMSOPStructureValueUpdated = tempLstStandardOperationsDictionaryStructures.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPStructure.IdworkOperationByStage) && w.IdCpTypeNew == eRMSOPStructure.IdCpType).FirstOrDefault();
                            ERMSOPStructures oldworkoperationstages = tempWorkOperationClonedStructure.Where(x => x.Code != eRMSOPStructure.Code).FirstOrDefault();
                            if (ISERMSOPStructureValueUpdated != null)
                            {
                                #region Geos2 4079 Structure Store/ Save in the SDO tables the Observed time, Activity

                                if (ISERMSOPStructureValueUpdated.IdWorkoperation == Convert.ToUInt64(eRMSOPStructure.IdworkOperationByStage) && (ISERMSOPStructureValueUpdated.Activity == null || ISERMSOPStructureValueUpdated.Activity == 0))
                                {
                                    ISERMSOPStructureValueUpdated.Activity = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == eRMSOPStructure.IdworkOperationByStage).Select(b => b.Activity).FirstOrDefault();
                                }
                                if (ISERMSOPStructureValueUpdated.IdWorkoperation == Convert.ToUInt64(eRMSOPStructure.IdworkOperationByStage) && (ISERMSOPStructureValueUpdated.ObservedTime == null || ISERMSOPStructureValueUpdated.ObservedTime == 0))
                                {
                                    ISERMSOPStructureValueUpdated.ObservedTime = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == eRMSOPStructure.IdworkOperationByStage).Select(b => b.ObservedTime).FirstOrDefault();
                                }
                                #endregion
                                if (workOperationByStages != null)
                                {
                                    if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(workOperationByStages.Name.Trim())))
                                    {

                                    }
                                    else
                                    {

                                        if (ISERMSOPStructureValueUpdated.Activity != eRMSOPStructure.StructureActivity || Math.Round(Convert.ToDouble(ISERMSOPStructureValueUpdated.ObservedTime), 2) != Math.Round(Convert.ToDouble(eRMSOPStructure.StructureObservedTime), 2) || ISERMSOPStructureValueUpdated.Position != eRMSOPStructure.StructurePosition)
                                        {
                                            if (ISERMSOPStructureValueUpdated.Activity != eRMSOPStructure.StructureActivity)
                                            {
                                                string Name = eRMSOPStructure.Name;
                                                //string log = "In Structures " + Convert.ToString(subTemplate) + " " + Convert.ToString(eRMSOPStructure.Name) + " Activity Time changed from " + ISERMSOPStructureValueUpdated.Activity + " to " + Convert.ToString(eRMSOPStructure.StructureActivity) + ".";
                                                if (!string.IsNullOrEmpty(StructureNameForEditLog))
                                                {
                                                    string log = "In Structures " + Convert.ToString(StructureNameForEditLog) + " " + Convert.ToString(eRMSOPStructure.Name) + " Activity Time changed from " + ISERMSOPStructureValueUpdated.Activity + " to " + Convert.ToString(eRMSOPStructure.StructureActivity) + ".";
                                                    StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                                }
                                            }

                                            if (Math.Round(Convert.ToDouble(ISERMSOPStructureValueUpdated.ObservedTime), 2) != Math.Round(Convert.ToDouble(eRMSOPStructure.StructureObservedTime), 2))
                                            {
                                                string Name = eRMSOPStructure.Name;
                                                //string log = "In Structures " + Convert.ToString(subTemplate) + " " + Convert.ToString(eRMSOPStructure.Name) + " Observed Time changed from " + ISERMSOPStructureValueUpdated.ObservedTime + " to " + Convert.ToString(eRMSOPStructure.StructureObservedTime) + ".";
                                                #region [GEOS2-3954] [Rupali Sarode] time change
                                                string OldObservedTime = Convert.ToString(ConvertfloattoTimespanlog(Convert.ToString(ISERMSOPStructureValueUpdated.ObservedTime)));
                                                string CurrentObervedTime = Convert.ToString(new TimeSpan(eRMSOPStructure.UITempStructureObservedTime.Hours, eRMSOPStructure.UITempStructureObservedTime.Minutes, eRMSOPStructure.UITempStructureObservedTime.Seconds));
                                                if (!string.IsNullOrEmpty(StructureNameForEditLog))
                                                {
                                                    //string log = "In Structures " + Convert.ToString(subTemplate) + " " + Convert.ToString(eRMSOPStructure.Name) + " Observed Time changed from " + OldObservedTime + " to " + Convert.ToString(eRMSOPStructure.UITempStructureObservedTime) + ".";
                                                    string log = "In Structures " + Convert.ToString(StructureNameForEditLog) + " " + Convert.ToString(eRMSOPStructure.Name) + " Observed Time changed from " + OldObservedTime + " to " + CurrentObervedTime + ".";
                                                    #endregion
                                                    StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                                }
                                            }
                                            #region rajashri GEOS2-5629 strucutre changelog of position 
                                            var OldPosition = ClonedSOD.LstStandardOperationsDictionaryStructure.Where(x => x.IdCpTypeNew == eRMSOPStructure.IdCpType && x.IdWorkoperation == Convert.ToUInt64(eRMSOPStructure.IdworkOperationByStage)).FirstOrDefault();

                                            var Newpos = UpdatedSOD.LstStandardOperationsDictionaryStructure.Where(x => x.IdCpTypeNew == eRMSOPStructure.IdCpType && x.IdWorkoperation == Convert.ToUInt64(eRMSOPStructure.IdworkOperationByStage)).FirstOrDefault();
                                            if (Newpos != null)
                                            {
                                                if (OldPosition != null)
                                                {
                                                    if (Newpos.Position != OldPosition.StructurePosition)
                                                    {
                                                        string Name = eRMSOPStructure.Name;
                                                        if (OldPosition.Position == null)
                                                        {
                                                            if (!string.IsNullOrEmpty(StructureNameForEditLog))
                                                            {
                                                                string log = "The order of Structure in " + Convert.ToString(StructureNameForEditLog) + " " + Convert.ToString(eRMSOPStructure.Name) + " has been changed from " + "None" + " to " + Convert.ToString(Newpos.Position) + ".";
                                                                StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                                            }
                                                        }
                                                        else
                                                        {

                                                            if (!string.IsNullOrEmpty(StructureNameForEditLog))
                                                            {
                                                                string log = "The order of Structure in " + Convert.ToString(StructureNameForEditLog) + " " + Convert.ToString(eRMSOPStructure.Name) + " has been changed from " + OldPosition.StructurePosition + " to " + Convert.ToString(Newpos.Position) + ".";
                                                                StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                                            }
                                                        }
                                                    }
                                                }
                                                else
                                                {
                                                    if (!string.IsNullOrEmpty(StructureNameForEditLog))
                                                    {
                                                        string log = "The order of Structure in " + Convert.ToString(StructureNameForEditLog) + " " + Convert.ToString(eRMSOPStructure.Name) + " has been changed from " + "None" + " to " + Convert.ToString(Newpos.Position) + ".";
                                                        StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                                    }
                                                }
                                            }
                                            #endregion
                                        }

                                        //AddRemarksLogs(ISERMSOPStructureValueUpdated.Remarks, eRMSOPStructure.Remarks, "Structures", subTemplate, eRMSOPStructure.Name);
                                        AddRemarksLogs(ISERMSOPStructureValueUpdated.Remarks, eRMSOPStructure.Remarks, "Structures", StructureNameForEditLog, eRMSOPStructure.Name);


                                    }
                                }
                                else
                                {
                                    if (ISERMSOPStructureValueUpdated.Activity != eRMSOPStructure.StructureActivity || Math.Round(Convert.ToDouble(ISERMSOPStructureValueUpdated.ObservedTime), 2) != Math.Round(Convert.ToDouble(eRMSOPStructure.StructureObservedTime), 2) || ISERMSOPStructureValueUpdated.Position != eRMSOPStructure.StructurePosition)
                                    {
                                        if (ISERMSOPStructureValueUpdated.Activity != eRMSOPStructure.StructureActivity)
                                        {
                                            string Name = eRMSOPStructure.Name;
                                            if (!string.IsNullOrEmpty(StructureNameForEditLog))
                                            {
                                                //string log = "In Structures " + Convert.ToString(subTemplate) + " " + Convert.ToString(eRMSOPStructure.Name) + " Activity Time changed from " + ISERMSOPStructureValueUpdated.Activity + " to " + Convert.ToString(eRMSOPStructure.StructureActivity) + ".";
                                                string log = "In Structures " + Convert.ToString(StructureNameForEditLog) + " " + Convert.ToString(eRMSOPStructure.Name) + " Activity Time changed from " + ISERMSOPStructureValueUpdated.Activity + " to " + Convert.ToString(eRMSOPStructure.StructureActivity) + ".";

                                                StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                            }
                                        }

                                        if (Math.Round(Convert.ToDouble(ISERMSOPStructureValueUpdated.ObservedTime), 2) != Math.Round(Convert.ToDouble(eRMSOPStructure.StructureObservedTime), 2))
                                        {
                                            string Name = eRMSOPStructure.Name;
                                            // string log = "In Structures " + Convert.ToString(subTemplate) + " " + Convert.ToString(eRMSOPStructure.Name) + " Observed Time changed from " + ISERMSOPStructureValueUpdated.ObservedTime + " to " + Convert.ToString(eRMSOPStructure.StructureObservedTime) + ".";
                                            #region [GEOS2-3954] [Rupali Sarode] time change
                                            string OldObservedTime = Convert.ToString(ConvertfloattoTimespanlog(Convert.ToString(ISERMSOPStructureValueUpdated.ObservedTime)));
                                            string CurrentObervedTime = Convert.ToString(new TimeSpan(eRMSOPStructure.UITempStructureObservedTime.Hours, eRMSOPStructure.UITempStructureObservedTime.Minutes, eRMSOPStructure.UITempStructureObservedTime.Seconds));
                                            if (!string.IsNullOrEmpty(StructureNameForEditLog))
                                            {
                                                //string log = "In Structures " + Convert.ToString(subTemplate) + " " + Convert.ToString(eRMSOPStructure.Name) + " Observed Time changed from " + OldObservedTime + " to " + Convert.ToString(eRMSOPStructure.UITempStructureObservedTime) + ".";
                                                string log = "In Structures " + Convert.ToString(StructureNameForEditLog) + " " + Convert.ToString(eRMSOPStructure.Name) + " Observed Time changed from " + OldObservedTime + " to " + CurrentObervedTime + ".";
                                                #endregion
                                                StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                            }
                                        }
                                        //#region rajashri GEOS2-5629 strucutre changelog of position 
                                        //if (ISERMSOPStructureValueUpdated.Position != eRMSOPStructure.StructurePosition)
                                        //{
                                        //    string Name = eRMSOPStructure.Name;
                                        //    if (ISERMSOPStructureValueUpdated.Position == null)
                                        //    {
                                        //        if (!string.IsNullOrEmpty(StructureNameForEditLog))
                                        //        {
                                        //            string log = "The order of Structure in " + Convert.ToString(StructureNameForEditLog) + " " + Convert.ToString(eRMSOPStructure.Name) + " has been changed from " + "None" + " to " + Convert.ToString(eRMSOPStructure.StructurePosition) + ".";
                                        //            StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                        //        }
                                        //    }
                                        //    else
                                        //    {

                                        //        if (!string.IsNullOrEmpty(StructureNameForEditLog))
                                        //        {
                                        //            string log = "The order of Structure in " + Convert.ToString(StructureNameForEditLog) + " " + Convert.ToString(eRMSOPStructure.Name) + " has been changed from " + ISERMSOPStructureValueUpdated.Position + " to " + Convert.ToString(eRMSOPStructure.StructurePosition) + ".";
                                        //            StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                        //        }
                                        //    }
                                        //}
                                        //#endregion

                                        #region rajashri GEOS2-5629 strucutre changelog of position 
                                        var OldPosition = ClonedSOD.LstStandardOperationsDictionaryStructure.Where(x => x.IdCpTypeNew == eRMSOPStructure.IdCpType && x.IdWorkoperation == Convert.ToUInt64(eRMSOPStructure.IdworkOperationByStage)).FirstOrDefault();

                                        var Newpos = UpdatedSOD.LstStandardOperationsDictionaryStructure.Where(x => x.IdCpTypeNew == eRMSOPStructure.IdCpType && x.IdWorkoperation == Convert.ToUInt64(eRMSOPStructure.IdworkOperationByStage)).FirstOrDefault();
                                        if (Newpos != null)
                                        {
                                            if (OldPosition != null)
                                            {
                                                if (Newpos.Position != OldPosition.StructurePosition)
                                                {
                                                    string Name = eRMSOPStructure.Name;
                                                    if (OldPosition.Position == null)
                                                    {
                                                        if (!string.IsNullOrEmpty(StructureNameForEditLog))
                                                        {
                                                            string log = "The order of Structure in " + Convert.ToString(StructureNameForEditLog) + " " + Convert.ToString(eRMSOPStructure.Name) + " has been changed from " + "None" + " to " + Convert.ToString(Newpos.Position) + ".";
                                                            StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                                        }
                                                    }
                                                    else
                                                    {

                                                        if (!string.IsNullOrEmpty(StructureNameForEditLog))
                                                        {
                                                            string log = "The order of Structure in " + Convert.ToString(StructureNameForEditLog) + " " + Convert.ToString(eRMSOPStructure.Name) + " has been changed from " + OldPosition.StructurePosition + " to " + Convert.ToString(Newpos.Position) + ".";
                                                            StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                                        }
                                                    }
                                                }
                                            }
                                            else
                                            {
                                                if (!string.IsNullOrEmpty(StructureNameForEditLog))
                                                {
                                                    string log = "The order of Structure in " + Convert.ToString(StructureNameForEditLog) + " " + Convert.ToString(eRMSOPStructure.Name) + " has been changed from " + "None" + " to " + Convert.ToString(Newpos.Position) + ".";
                                                    StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                                }
                                            }
                                        }
                                        #endregion
                                    }

                                    //AddRemarksLogs(ISERMSOPStructureValueUpdated.Remarks, eRMSOPStructure.Remarks, "Structures", subTemplate, eRMSOPStructure.Name);
                                    AddRemarksLogs(ISERMSOPStructureValueUpdated.Remarks, eRMSOPStructure.Remarks, "Structures", StructureNameForEditLog, eRMSOPStructure.Name);

                                }
                            }

                        }
                    }
                    catch (Exception ex) { }

                }

                try
                {
                    if (standardOperationsDictionaryStructureDeleteList.Count() > 0)
                    {
                        string childs = string.Empty;
                        string oldcheckparent = string.Empty;
                        string StructureNameForDelete = string.Empty;
                        string log = string.Empty;
                        var deleteworkoperationlist = tempWorkOperationClonedStructure.Except(StructureMenulist).ToList();
                        //var AddNewworkoperation = Newworkoperationlist.Where(x => x.IdParent == null).FirstOrDefault();
                        if (deleteworkoperationlist.Count > 0)
                        {
                            for (int i = 0; i < deleteworkoperationlist.Count; i++)
                            {
                                if (GetStages.Any(a => a.Code.Equals(deleteworkoperationlist[i].Name)))
                                { }
                                else
                                {
                                    //if (deleteworkoperationlist[i].IdStatus != 1536)
                                    //{
                                    List<ERMSOPStructures> childList = deleteworkoperationlist.Where(w => w.ParentName != null && w.ParentName.Equals(deleteworkoperationlist[i].KeyName)).ToList();
                                    if (childList.Count == 0)
                                    {
                                        if (string.IsNullOrEmpty(childs))
                                        {
                                            childs = deleteworkoperationlist[i].Name.Trim();
                                        }
                                        else
                                            childs = childs + ", " + deleteworkoperationlist[i].Name.Trim();
                                    }
                                    //}
                                }
                            }

                            if (!string.IsNullOrEmpty(childs))
                            {
                                StructureNameForDelete = StructureMenulistForGridLayoutForLog.Where(x => x.IdCPType == IdCPTypeForStructForDelete).Select(y => y.Name).FirstOrDefault().ToString();

                                log = "In Structures " + Convert.ToString(StructureNameForDelete) + " " + Convert.ToString(childs) + " has been deleted.";

                                //log = "In Structures " + Convert.ToString(subTemplate) + " " + Convert.ToString(childs) + " has been deleted.";
                                //  string log = Convert.ToString(deleteparent.Name) + " in module " + Convert.ToString(subTemplate) + " sub groups of " + Convert.ToString(Template) + " groups has been deleted.";
                                StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                            }

                        }
                    }

                }
                catch (Exception ex)
                {
                }

                GeosApplication.Instance.Logger.Log("Method StructureLog()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method StructureLog() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

            }
        }
        #endregion

        private void SparePartLog()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method SparePartLog()...", category: Category.Info, priority: Priority.Low);

                ERMSpareParts ermSparePart = (ERMSpareParts)SelectedItemSparePart;
                int idDetectionForDelete = ermSparePart.IdDetection;

                string subTemplate = Convert.ToString(ermSparePart.Name);
                string SODoldRemarks = string.Empty;
                string SODnewRemarks = string.Empty;
                //[GEOS2-4108][Rupali Sarode][3-1-2022]
                ObservableCollection<ERMSpareParts> SparePartsMenulistForGridLayoutForLog;
                SparePartsMenulistForGridLayoutForLog = new ObservableCollection<ERMSpareParts>(ERMService.GetAllSparePart_V2340().ToList());

                if (SparePartsMenulist != null && SparePartsMenulist.Count > 0)
                {
                    try
                    {
                        string ParentName = string.Empty;
                        ulong tIdDetection = 0;
                        string childs = string.Empty;
                        var Newworkoperationlist12 = SparePartsMenulist.Except(tempWorkOperationClonedSpareParts).ToList();

                        //[GOES2-3925][Rupali Sarode][02-12-2022]
                        //var Newworkoperationlist = SparePartsMenulist.Except(tempWorkOperationClonedSpareParts).ToList();
                        var Newworkoperationlist = SparePartsMenulist.Where(x => !tempWorkOperationClonedSpareParts.Any(y => y.IdworkOperationByStage == x.IdworkOperationByStage
                        && y.IdDetection == x.IdDetection)).ToList();


                        if (Newworkoperationlist.Count > 0)
                        {
                            for (int i = 0; i < Newworkoperationlist.Count; i++)
                            {
                                if (GetStages.Any(a => a.Code.Equals(Newworkoperationlist[i].Name)))
                                {
                                }
                                else
                                {
                                    //if (Newworkoperationlist[i].IdStatus != 1536)
                                    //{

                                    //[Rupali Sarode][02-12-2022]
                                    //List<ERMSOPSpareParts> childList = Newworkoperationlist.Where(w => w.ParentName != null && w.ParentName.Equals(Newworkoperationlist[i].KeyName)).ToList();
                                    List<WorkOperationByStages> childList = WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(Newworkoperationlist[i].KeyName)).ToList();


                                    if (childList.Count == 0)
                                    {
                                        if (string.IsNullOrEmpty(childs))
                                        {
                                            childs = Newworkoperationlist[i].Name.Trim();
                                            tIdDetection = Convert.ToUInt64(Newworkoperationlist[i].IdDetection);
                                        }
                                        else
                                            childs = childs + ", " + Newworkoperationlist[i].Name.Trim();
                                    }
                                    // }
                                }
                            }
                            string log = string.Empty;
                            if (!string.IsNullOrEmpty(childs))
                            {

                                string SparePartName = string.Empty;

                                //SparePartName = SparePartsMenulistForGridLayout.Where(x => (ulong)x.IdDetection == tIdDetection).Select(y => y.Name).FirstOrDefault().ToString();
                                SparePartName = SparePartsMenulistForGridLayoutForLog.Where(x => (ulong)x.IdDetection == tIdDetection).Select(y => y.Name).FirstOrDefault().ToString();

                                if (!string.IsNullOrEmpty(SparePartName))  //[GOES2-3925][Rupali Sarode][02-12-2022]
                                {
                                    log = "In Spareparts " + Convert.ToString(SparePartName) + " " + Convert.ToString(childs) + " has been added.";
                                    StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                }
                            }
                        }

                        string SparePartNameForEditLog = string.Empty;

                        foreach (ERMSOPSpareParts eRMSOPSpareParts in SparePartsMenulist)
                        {


                            if (string.IsNullOrEmpty(SparePartNameForEditLog) && eRMSOPSpareParts.IdDetection != 0)

                                SparePartNameForEditLog = SparePartsMenulistForGridLayoutForLog.Where(x => (ulong)x.IdDetection == eRMSOPSpareParts.IdDetection).Select(y => y.Name).FirstOrDefault().ToString();


                            WorkOperationByStages workOperationByStages = WorkOperationMenulist.Where(w => w.ParentName != null && w.ParentName.Equals(eRMSOPSpareParts.KeyName)).FirstOrDefault();
                            StandardOperationsDictionarySparePart ISERMSOPSparePartValueUpdated = tempLstStandardOperationsDictionarySparePart.Where(w => w.IdWorkoperation == Convert.ToUInt64(eRMSOPSpareParts.IdworkOperationByStage) && w.IdDetection == eRMSOPSpareParts.IdDetection).FirstOrDefault();
                            ERMSOPSpareParts oldworkoperationstages = tempWorkOperationClonedSpareParts.Where(x => x.Code != eRMSOPSpareParts.Code).FirstOrDefault();
                            if (ISERMSOPSparePartValueUpdated != null)
                            {
                                #region Geos2 4078 Spareparts Store/ Save in the SDO tables the Observed time, Activity
                                if (ISERMSOPSparePartValueUpdated.IdWorkoperation == Convert.ToUInt64(eRMSOPSpareParts.IdworkOperationByStage) && (ISERMSOPSparePartValueUpdated.Activity == null || ISERMSOPSparePartValueUpdated.Activity == 0))
                                {
                                    ISERMSOPSparePartValueUpdated.Activity = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == eRMSOPSpareParts.IdworkOperationByStage).Select(b => b.Activity).FirstOrDefault();
                                }
                                if (ISERMSOPSparePartValueUpdated.IdWorkoperation == Convert.ToUInt64(eRMSOPSpareParts.IdworkOperationByStage) && (ISERMSOPSparePartValueUpdated.ObservedTime == null || ISERMSOPSparePartValueUpdated.ObservedTime == 0))
                                {
                                    ISERMSOPSparePartValueUpdated.ObservedTime = WorkOperationMenulist.Where(a => a.IdworkOperationByStage == eRMSOPSpareParts.IdworkOperationByStage).Select(b => b.ObservedTime).FirstOrDefault();
                                }
                                #endregion
                                if (workOperationByStages != null)
                                {
                                    if (!GetStages.Any(a => a != null && a.Code.Trim().Equals(workOperationByStages.Name.Trim())))
                                    {

                                    }
                                    else
                                    {

                                        if (ISERMSOPSparePartValueUpdated.Activity != eRMSOPSpareParts.SparePartActivity ||
                                            Math.Round(Convert.ToDouble(ISERMSOPSparePartValueUpdated.ObservedTime), 2) != Math.Round(Convert.ToDouble(eRMSOPSpareParts.SparePartObservedTime), 2)
                                           || ISERMSOPSparePartValueUpdated.Position != eRMSOPSpareParts.SparepartPosition)
                                        {
                                            if (ISERMSOPSparePartValueUpdated.Activity != eRMSOPSpareParts.SparePartActivity)
                                            {


                                                string Name = eRMSOPSpareParts.Name;
                                                //string log = "In Spareparts " + Convert.ToString(subTemplate) + " " + Convert.ToString(eRMSOPSpareParts.Name) + " Activity Time changed from " + ISERMSOPSparePartValueUpdated.Activity + " to " + Convert.ToString(eRMSOPSpareParts.SparePartActivity) + ".";
                                                if (!string.IsNullOrEmpty(SparePartNameForEditLog))
                                                {
                                                    string log = "In Spareparts " + Convert.ToString(SparePartNameForEditLog) + " " + Convert.ToString(eRMSOPSpareParts.Name) + " Activity Time changed from " + ISERMSOPSparePartValueUpdated.Activity + " to " + Convert.ToString(eRMSOPSpareParts.SparePartActivity) + ".";
                                                    StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                                }
                                            }

                                            if (
                                                Math.Round(Convert.ToDouble(ISERMSOPSparePartValueUpdated.ObservedTime), 2) != Math.Round(Convert.ToDouble(eRMSOPSpareParts.SparePartObservedTime), 2)
                                                )
                                            {

                                                string Name = eRMSOPSpareParts.Name;

                                                #region GEOS2-3954 time change
                                                string OldObservedTime = Convert.ToString(ConvertfloattoTimespanlog(Convert.ToString(ISERMSOPSparePartValueUpdated.ObservedTime)));
                                                string CurrentObervedTime = Convert.ToString(new TimeSpan(eRMSOPSpareParts.UITempSparePartObservedTime.Hours, eRMSOPSpareParts.UITempSparePartObservedTime.Minutes, eRMSOPSpareParts.UITempSparePartObservedTime.Seconds));
                                                //string log = "In Spareparts " + Convert.ToString(subTemplate) + " " + Convert.ToString(eRMSOPSpareParts.Name) + " Observed Time changed from " + OldObservedTime + " to " + Convert.ToString(eRMSOPSpareParts.UITempSparePartObservedTime) + ".";
                                                if (!string.IsNullOrEmpty(SparePartNameForEditLog))  //[GOES2-3925][Rupali Sarode][02-12-2022]
                                                {
                                                    string log = "In Spareparts " + Convert.ToString(SparePartNameForEditLog) + " " + Convert.ToString(eRMSOPSpareParts.Name) + " Observed Time changed from " + OldObservedTime + " to " + CurrentObervedTime + ".";
                                                    #endregion
                                                    StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                                }
                                            }
                                            #region rajashri GEOS2-5629 module changelog of position 
                                            var OldPosition = ClonedSOD.LstStandardOperationsDictionarySparePart.Where(x => x.IdDetection == eRMSOPSpareParts.IdDetection && x.IdWorkoperation == Convert.ToUInt64(eRMSOPSpareParts.IdworkOperationByStage)).FirstOrDefault();

                                            var Newpos = UpdatedSOD.LstStandardOperationsDictionarySparePart.Where(x => x.IdDetection == eRMSOPSpareParts.IdDetection && x.IdWorkoperation == Convert.ToUInt64(eRMSOPSpareParts.IdworkOperationByStage)).FirstOrDefault();
                                            if (Newpos != null)
                                            {
                                                if (OldPosition != null)
                                                {
                                                    if (Newpos.Position != OldPosition.SparepartPosition)
                                                    {
                                                        string Name = eRMSOPSpareParts.Name;
                                                        if (OldPosition.SparepartPosition == null)
                                                        {
                                                            if (!string.IsNullOrEmpty(SparePartNameForEditLog))
                                                            {
                                                                string log = "The order of spare parts in " + Convert.ToString(SparePartNameForEditLog) + " " + Convert.ToString(eRMSOPSpareParts.Name) + " has been changed from " + "None" + " to " + Convert.ToString(Newpos.Position) + ".";
                                                                StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                                            }
                                                        }
                                                        else
                                                        {

                                                            if (!string.IsNullOrEmpty(SparePartNameForEditLog))
                                                            {
                                                                string log = "The order of spare parts in " + Convert.ToString(SparePartNameForEditLog) + " " + Convert.ToString(eRMSOPSpareParts.Name) + " has been changed from " + OldPosition.SparepartPosition + " to " + Convert.ToString(Newpos.Position) + ".";
                                                                StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                                            }
                                                        }
                                                    }
                                                }
                                                else
                                                {
                                                    if (!string.IsNullOrEmpty(SparePartNameForEditLog))
                                                    {
                                                        string log = "The order of spare parts in " + Convert.ToString(SparePartNameForEditLog) + " " + Convert.ToString(eRMSOPSpareParts.Name) + " has been changed from " + "None" + " to " + Convert.ToString(Newpos.Position) + ".";
                                                        StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                                    }
                                                }
                                            }
                                            #endregion
                                        }


                                        //AddRemarksLogs(ISERMSOPSparePartValueUpdated.Remarks, eRMSOPSpareParts.Remarks, "Spareparts", subTemplate, eRMSOPSpareParts.Name);
                                        AddRemarksLogs(ISERMSOPSparePartValueUpdated.Remarks, eRMSOPSpareParts.Remarks, "Spareparts", SparePartNameForEditLog, eRMSOPSpareParts.Name);

                                    }
                                }
                                else
                                {
                                    if (ISERMSOPSparePartValueUpdated != null)
                                    {

                                        if (ISERMSOPSparePartValueUpdated.Activity != eRMSOPSpareParts.SparePartActivity ||
                                               Math.Round(Convert.ToDouble(ISERMSOPSparePartValueUpdated.ObservedTime), 2) != Math.Round(Convert.ToDouble(eRMSOPSpareParts.SparePartObservedTime), 2)
                                               || ISERMSOPSparePartValueUpdated.Position != eRMSOPSpareParts.SparepartPosition)
                                        {
                                            if (ISERMSOPSparePartValueUpdated.Activity != eRMSOPSpareParts.SparePartActivity)
                                            {


                                                string Name = eRMSOPSpareParts.Name;

                                                //string log = "In Spareparts " + Convert.ToString(subTemplate) + " " + Convert.ToString(eRMSOPSpareParts.Name) + " Activity Time changed from " + ISERMSOPSparePartValueUpdated.Activity + " to " + Convert.ToString(eRMSOPSpareParts.SparePartActivity) + ".";
                                                if (!string.IsNullOrEmpty(SparePartNameForEditLog))
                                                {
                                                    string log = "In Spareparts " + Convert.ToString(SparePartNameForEditLog) + " " + Convert.ToString(eRMSOPSpareParts.Name) + " Activity Time changed from " + ISERMSOPSparePartValueUpdated.Activity + " to " + Convert.ToString(eRMSOPSpareParts.SparePartActivity) + ".";
                                                    StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                                }
                                            }
                                            if (
                                                Math.Round(Convert.ToDouble(ISERMSOPSparePartValueUpdated.ObservedTime), 2) != Math.Round(Convert.ToDouble(eRMSOPSpareParts.SparePartObservedTime), 2)
                                                )
                                            {


                                                string Name = eRMSOPSpareParts.Name;

                                                #region GEOS2-3954 time change

                                                string OldObservedTime = Convert.ToString(ConvertfloattoTimespanlog(Convert.ToString(ISERMSOPSparePartValueUpdated.ObservedTime)));
                                                string CurrentObervedTime = Convert.ToString(new TimeSpan(eRMSOPSpareParts.UITempSparePartObservedTime.Hours, eRMSOPSpareParts.UITempSparePartObservedTime.Minutes, eRMSOPSpareParts.UITempSparePartObservedTime.Seconds));
                                                if (!string.IsNullOrEmpty(SparePartNameForEditLog))
                                                {
                                                    string log = "In Spareparts " + Convert.ToString(SparePartNameForEditLog) + " " + Convert.ToString(eRMSOPSpareParts.Name) + " Observed Time changed from " + OldObservedTime + " to " + CurrentObervedTime + ".";

                                                    #endregion

                                                    StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                                }

                                            }
                                            //#region rajashri GEOS2-5629 module changelog of position 
                                            //if (ISERMSOPSparePartValueUpdated.Position != eRMSOPSpareParts.SparepartPosition)
                                            //{
                                            //    string Name = eRMSOPSpareParts.Name;
                                            //    if (ISERMSOPSparePartValueUpdated.Position == null)
                                            //    {
                                            //        if (!string.IsNullOrEmpty(SparePartNameForEditLog))
                                            //        {
                                            //            string log = "The order of spare parts in " + Convert.ToString(SparePartNameForEditLog) + " " + Convert.ToString(eRMSOPSpareParts.Name) + " has been changed from " + "None" + " to " + Convert.ToString(eRMSOPSpareParts.SparepartPosition) + ".";
                                            //            StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                            //        }
                                            //    }
                                            //    else
                                            //    {

                                            //        if (!string.IsNullOrEmpty(SparePartNameForEditLog))
                                            //        {
                                            //            string log = "The order of spare parts in " + Convert.ToString(SparePartNameForEditLog) + " " + Convert.ToString(eRMSOPSpareParts.Name) + " has been changed from " + ISERMSOPSparePartValueUpdated.Position + " to " + Convert.ToString(eRMSOPSpareParts.SparepartPosition) + ".";
                                            //            StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                            //        }
                                            //    }
                                            //}
                                            //#endregion

                                            #region rajashri GEOS2-5629 module changelog of position 
                                            var OldPosition = ClonedSOD.LstStandardOperationsDictionarySparePart.Where(x => x.IdDetection == eRMSOPSpareParts.IdDetection && x.IdWorkoperation == Convert.ToUInt64(eRMSOPSpareParts.IdworkOperationByStage)).FirstOrDefault();

                                            var Newpos = UpdatedSOD.LstStandardOperationsDictionarySparePart.Where(x => x.IdDetection == eRMSOPSpareParts.IdDetection && x.IdWorkoperation == Convert.ToUInt64(eRMSOPSpareParts.IdworkOperationByStage)).FirstOrDefault();
                                            if (Newpos != null)
                                            {
                                                if (OldPosition != null)
                                                {
                                                    if (Newpos.Position != OldPosition.SparepartPosition)
                                                    {
                                                        string Name = eRMSOPSpareParts.Name;
                                                        if (OldPosition.SparepartPosition == null)
                                                        {
                                                            if (!string.IsNullOrEmpty(SparePartNameForEditLog))
                                                            {
                                                                string log = "The order of spare parts in " + Convert.ToString(SparePartNameForEditLog) + " " + Convert.ToString(eRMSOPSpareParts.Name) + " has been changed from " + "None" + " to " + Convert.ToString(Newpos.Position) + ".";
                                                                StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                                            }
                                                        }
                                                        else
                                                        {

                                                            if (!string.IsNullOrEmpty(SparePartNameForEditLog))
                                                            {
                                                                string log = "The order of spare parts in " + Convert.ToString(SparePartNameForEditLog) + " " + Convert.ToString(eRMSOPSpareParts.Name) + " has been changed from " + OldPosition.SparepartPosition + " to " + Convert.ToString(Newpos.Position) + ".";
                                                                StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                                            }
                                                        }
                                                    }
                                                }
                                                else
                                                {
                                                    if (!string.IsNullOrEmpty(SparePartNameForEditLog))
                                                    {
                                                        string log = "The order of spare parts in " + Convert.ToString(SparePartNameForEditLog) + " " + Convert.ToString(eRMSOPSpareParts.Name) + " has been changed from " + "None" + " to " + Convert.ToString(Newpos.Position) + ".";
                                                        StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                                                    }
                                                }
                                            }
                                            #endregion
                                        }

                                        // AddRemarksLogs(ISERMSOPSparePartValueUpdated.Remarks, eRMSOPSpareParts.Remarks, "Spareparts", subTemplate, eRMSOPSpareParts.Name);
                                        AddRemarksLogs(ISERMSOPSparePartValueUpdated.Remarks, eRMSOPSpareParts.Remarks, "Spareparts", SparePartNameForEditLog, eRMSOPSpareParts.Name);

                                    }
                                }
                            }

                        }
                    }
                    catch (Exception ex) { }
                }



                try
                {
                    if (standardOperationsDictionarySparePartDeleteList.Count() > 0)
                    {
                        string childs = string.Empty;
                        string SparePartNameForDelete = string.Empty;
                        string log = string.Empty;
                        var deleteworkoperationlist = tempWorkOperationClonedSpareParts.Except(SparePartsMenulist).ToList();

                        if (deleteworkoperationlist.Count > 0)
                        {
                            for (int i = 0; i < deleteworkoperationlist.Count; i++)
                            {
                                if (GetStages.Any(a => a.Code.Equals(deleteworkoperationlist[i].Name)))
                                {
                                }
                                else
                                {
                                    //if (deleteworkoperationlist[i].IdStatus != 1536)
                                    //{
                                    List<ERMSOPSpareParts> childList = deleteworkoperationlist.Where(w => w.ParentName != null && w.ParentName.Equals(deleteworkoperationlist[i].KeyName)).ToList();

                                    if (childList.Count == 0)
                                    {
                                        if (string.IsNullOrEmpty(childs))
                                        {
                                            childs = deleteworkoperationlist[i].Name.Trim();
                                        }
                                        else
                                            childs = childs + ", " + deleteworkoperationlist[i].Name.Trim();
                                    }

                                }
                            }

                            if (!string.IsNullOrEmpty(childs))
                            {
                                SparePartNameForDelete = SparePartsMenulistForGridLayoutForLog.Where(x => x.IdDetection == idDetectionForDelete).Select(y => y.Name).FirstOrDefault().ToString();

                                log = "In Spareparts " + Convert.ToString(SparePartNameForDelete) + " " + Convert.ToString(childs) + " has been deleted.";
                                //log = "In Spareparts " + Convert.ToString(subTemplate) + " " + Convert.ToString(childs) + " has been deleted.";
                                StandardOperationsDictionaryChangeLogList.Add(new LogentriesbyStandardOperationsDictionary() { Idstandardoperationsdictionary = idStandardOperationsDictionary, Datetime = GeosApplication.Instance.ServerDateTime, IdUser = GeosApplication.Instance.ActiveUser.IdUser, Comments = log });
                            }
                        }
                    }
                }
                catch (Exception ex)
                {
                }

                GeosApplication.Instance.Logger.Log("Method SparePartLog()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method SparePartLog() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

            }
        }



        #region Validation

        bool allowValidation = false;

        string EnableValidationAndGetError()
        {
            allowValidation = true;
            string error = ((IDataErrorInfo)this).Error;
            if (!string.IsNullOrEmpty(error))
            {
                return error;
            }
            return null;
        }

        string IDataErrorInfo.Error
        {
            get
            {
                if (!allowValidation) return null;
                IDataErrorInfo me = (IDataErrorInfo)this;

                string error =
                me[BindableBase.GetPropertyName(() => Name)] +
                me[BindableBase.GetPropertyName(() => InformationError)];


                if (!string.IsNullOrEmpty(error))
                    return "Please check inputted data.";

                return null;
            }
        }

        string IDataErrorInfo.this[string columnName]
        {
            get
            {
                if (!allowValidation) return null;

                string name = BindableBase.GetPropertyName(() => Name);
                string headerInformtionError = BindableBase.GetPropertyName(() => InformationError);

                if (columnName == name)
                {
                    return AddEditSODValidation.GetErrorMessage(name, Name);
                }

                if (columnName == headerInformtionError)
                {
                    return AddEditSODValidation.GetErrorMessage(headerInformtionError, InformationError);
                }



                return null;
            }
        }

        #endregion
        #region [GEOS2-4910][gulab lakade][05 10 2023]
        private void TabSelectionChangingCommandAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method TabSelectionChangingCommandAction()...", category: Category.Info, priority: Priority.Low);
                if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }
                DevExpress.Xpf.Core.TabControlSelectionChangedEventArgs item = (DevExpress.Xpf.Core.TabControlSelectionChangedEventArgs)obj;
                int SelectedTabIndex = item.NewSelectedIndex;
                DevExpress.Xpf.Core.DXTabItem Selectedtab = (DevExpress.Xpf.Core.DXTabItem)item.NewSelectedItem;
                SelectedTabName = Convert.ToString(Selectedtab.Header);

                DevExpress.Xpf.Core.DXTabItem Oldtab = (DevExpress.Xpf.Core.DXTabItem)item.OldSelectedItem;

                if (Oldtab != null)
                {
                    OldTabName = Convert.ToString(Oldtab.Header);
                }

                //WorkOperationMenulist.ToList().ForEach(a => a.IsCurrentWorkOperation = false);
                WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                switch (SelectedTabName)
                {
                    case "Modules":
                        //if (operationMenulist != null && operationMenulist.Count() > 0)
                        //{
                        //    List<string> TempKeyNameList = operationMenulist.Select(a => a.KeyName).ToList();
                        //    if (TempKeyNameList.Count > 0)
                        //    {
                        //        WorkOperationMenulist.Where(x => TempKeyNameList.Contains(x.KeyName)).ToList().ForEach(a => a.IsCurrentWorkOperation = true);
                        //    }

                        //}
                        if (ModuleMenulist != null && ModuleMenulist.Count() > 0)
                        {
                            List<string> TempKeyNameList = ModuleMenulist.Select(a => a.KeyName).ToList();
                            if (TempKeyNameList.Count > 0)
                            {
                                WorkOperationMenulist.Where(x => TempKeyNameList.Contains(x.KeyName)).ToList().ForEach(a => a.IsCurrentWorkOperation = true);
                            }

                        }
                        break;
                    case "Detections":
                        //if (operationDetectionMenulist != null && operationDetectionMenulist.Count() > 0)
                        //{
                        //    List<string> TempKeyNameList = operationDetectionMenulist.Select(a => a.KeyName).ToList();
                        //    if (TempKeyNameList.Count > 0)
                        //    {
                        //        WorkOperationMenulist.Where(x => TempKeyNameList.Contains(x.KeyName)).ToList().ForEach(a => a.IsCurrentWorkOperation = true);
                        //    }

                        //}
                        if (DetectionMenulist != null && DetectionMenulist.Count() > 0)
                        {
                            List<string> TempKeyNameList = DetectionMenulist.Select(a => a.KeyName).ToList();
                            if (TempKeyNameList.Count > 0)
                            {
                                WorkOperationMenulist.Where(x => TempKeyNameList.Contains(x.KeyName)).ToList().ForEach(a => a.IsCurrentWorkOperation = true);
                            }

                        }
                        break;
                    case "Ways":
                        //if (operationWayMenulist != null && operationWayMenulist.Count() > 0)
                        //{
                        //    List<string> TempKeyNameList = operationWayMenulist.Select(a => a.KeyName).ToList();
                        //    if (TempKeyNameList.Count > 0)
                        //    {
                        //        WorkOperationMenulist.Where(x => TempKeyNameList.Contains(x.KeyName)).ToList().ForEach(a => a.IsCurrentWorkOperation = true);
                        //    }

                        //}
                        if (WaysMenulist != null && WaysMenulist.Count() > 0)
                        {
                            List<string> TempKeyNameList = WaysMenulist.Select(a => a.KeyName).ToList();
                            if (TempKeyNameList.Count > 0)
                            {
                                WorkOperationMenulist.Where(x => TempKeyNameList.Contains(x.KeyName)).ToList().ForEach(a => a.IsCurrentWorkOperation = true);
                            }

                        }
                        break;
                    case "Options":
                        //if (operationOptionMenulist != null && operationOptionMenulist.Count() > 0)
                        //{
                        //    List<string> TempKeyNameList = operationOptionMenulist.Select(a => a.KeyName).ToList();
                        //    if (TempKeyNameList.Count > 0)
                        //    {
                        //        WorkOperationMenulist.Where(x => TempKeyNameList.Contains(x.KeyName)).ToList().ForEach(a => a.IsCurrentWorkOperation = true);
                        //    }

                        //}
                        if (OptionsMenulist != null && OptionsMenulist.Count() > 0)
                        {
                            List<string> TempKeyNameList = OptionsMenulist.Select(a => a.KeyName).ToList();
                            if (TempKeyNameList.Count > 0)
                            {
                                WorkOperationMenulist.Where(x => TempKeyNameList.Contains(x.KeyName)).ToList().ForEach(a => a.IsCurrentWorkOperation = true);
                            }

                        }
                        break;

                    case "Spareparts":
                        //if (operationSparePartMenulist != null && operationSparePartMenulist.Count() > 0)
                        //{
                        //    List<string> TempKeyNameList = operationSparePartMenulist.Select(a => a.KeyName).ToList();
                        //    if (TempKeyNameList.Count > 0)
                        //    {
                        //        WorkOperationMenulist.Where(x => TempKeyNameList.Contains(x.KeyName)).ToList().ForEach(a => a.IsCurrentWorkOperation = true);
                        //    }

                        //}
                        if (SparePartsMenulist != null && SparePartsMenulist.Count() > 0)
                        {
                            List<string> TempKeyNameList = SparePartsMenulist.Select(a => a.KeyName).ToList();
                            if (TempKeyNameList.Count > 0)
                            {
                                WorkOperationMenulist.Where(x => TempKeyNameList.Contains(x.KeyName)).ToList().ForEach(a => a.IsCurrentWorkOperation = true);
                            }

                        }
                        break;
                    case "Structures":
                        //if (operationStructureMenulist != null && operationStructureMenulist.Count() > 0)
                        //{
                        //    List<string> TempKeyNameList = operationStructureMenulist.Select(a => a.KeyName).ToList();
                        //    if (TempKeyNameList.Count > 0)
                        //    {
                        //        WorkOperationMenulist.Where(x => TempKeyNameList.Contains(x.KeyName)).ToList().ForEach(a => a.IsCurrentWorkOperation = true);
                        //    }

                        //}
                        if (StructureMenulist != null && StructureMenulist.Count() > 0)
                        {
                            List<string> TempKeyNameList = StructureMenulist.Select(a => a.KeyName).ToList();
                            if (TempKeyNameList.Count > 0)
                            {
                                WorkOperationMenulist.Where(x => TempKeyNameList.Contains(x.KeyName)).ToList().ForEach(a => a.IsCurrentWorkOperation = true);
                            }

                        }
                        break;
                    default:
                        //WorkOperationMenulist.ToList().ForEach(f => f.IsCurrentWorkOperation = false);
                        break;
                }

                GeosApplication.Instance.Logger.Log("Method TabSelectionChangingCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log(string.Format("Error in method TabSelectionChangingCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

            }
        }
        #endregion


        #region [GEOS2-4994][Rupali Sarode][23-11-2023]
        private void ExportToExcel(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ExportToExcel()...", category: Category.Info, priority: Priority.Low);
                string TimePart = string.Empty;
                string DatePart = string.Empty;
                DatePart = DateTime.Now.ToShortDateString().Replace("/", "");
                DatePart = DatePart.Replace("-", "");
                DatePart = DatePart.Replace(".", "");

                TimePart = DateTime.Now.ToShortTimeString().Replace(":", "");
                TimePart = TimePart.Replace(" AM", "");
                TimePart = TimePart.Replace(" PM", "");

                SaveFileDialog saveFile = new SaveFileDialog();
                saveFile.DefaultExt = "xlsx";
                // saveFile.FileName = "ERMHistory_" + SelectedSODCode + "_" + DateTime.Now.ToString("MMddyyyy_hhmm");
                saveFile.FileName = "ERMHistory_" + SelectedSODCode + "_" + DatePart + "_" + TimePart;
                saveFile.Filter = "Excel Files (.xlsx)|*.xlsx|All Files (*.*)|*.*";
                saveFile.FilterIndex = 1;
                saveFile.Title = "Save Excel Report";
                DialogResult = (bool)saveFile.ShowDialog();

                if (!DialogResult)
                {
                    ResultFileName = string.Empty;
                }
                else
                {

                    if (!DXSplashScreen.IsActive)
                    {
                        DXSplashScreen.Show(x =>
                        {
                            Window win = new Window()
                            {
                                ShowActivated = false,
                                WindowStyle = WindowStyle.None,
                                ResizeMode = ResizeMode.NoResize,
                                AllowsTransparency = true,
                                Background = new SolidColorBrush(Colors.Transparent),
                                ShowInTaskbar = false,
                                Topmost = true,
                                SizeToContent = SizeToContent.WidthAndHeight,
                                WindowStartupLocation = WindowStartupLocation.CenterScreen,
                            };
                            WindowFadeAnimationBehavior.SetEnableAnimation(win, true);
                            win.Topmost = false;
                            return win;
                        }, x =>
                        {
                            return new SplashScreenView() { DataContext = new SplashScreenViewModel() };
                        }, null, null);
                    }
                    ResultFileName = (saveFile.FileName);
                    TableView ChangeLogTableView = ((TableView)obj);
                    ChangeLogTableView.ShowTotalSummary = false;
                    ChangeLogTableView.ShowFixedTotalSummary = false;
                    ChangeLogTableView.ExportToXlsx(ResultFileName);

                    //Wrap Text

                    var workbook = new Workbook();

                    workbook.LoadDocument(ResultFileName, DocumentFormat.Xlsx);
                    Worksheet worksheet = workbook.Worksheets[0];

                    workbook.BeginUpdate();

                    workbook.Worksheets[0].Columns[1].Width = 450;
                    workbook.Worksheets[0].Columns[2].Alignment.WrapText = true;
                    workbook.Worksheets[0].Columns[2].Alignment.Vertical = SpreadsheetVerticalAlignment.Top;
                    workbook.EndUpdate();

                    workbook.SaveDocument(ResultFileName);

                    //

                    if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                    System.Diagnostics.Process.Start(ResultFileName);
                    ChangeLogTableView.ShowTotalSummary = false;
                    ChangeLogTableView.ShowFixedTotalSummary = true;
                }
                GeosApplication.Instance.Logger.Log("Method ExportToExcel()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method ExportToExcel()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        #endregion


        #endregion
    }
}
