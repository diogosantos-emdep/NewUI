using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Linq;
using Emdep.Geos.Modules.PLM.Views;
using Emdep.Geos.UI.Common;
using DevExpress.Xpf.Core;
using System.Windows;
using System.Windows.Media;
using DevExpress.Mvvm.UI;
using Prism.Logging;
using System.Windows.Input;
using DevExpress.Mvvm;
using System.Collections.ObjectModel;
using Emdep.Geos.Services.Contracts;
using Emdep.Geos.UI.ServiceProcess;
using Emdep.Geos.Data.Common.PLM;
using Emdep.Geos.Data.Common.PCM;
using System.ServiceModel;
using Emdep.Geos.UI.CustomControls;
using DevExpress.Xpf.Grid;
using Emdep.Geos.Data.Common.Epc;
using Emdep.Geos.Data.Common;
using Emdep.Geos.Modules.PLM.CommonClasses;
using DevExpress.Xpf.LayoutControl;
using Emdep.Geos.Utility;
using System.Data;
using Emdep.Geos.UI.Helper;
using System.Collections;
using Microsoft.Win32;
using Emdep.Geos.UI.Validations;
using DevExpress.Xpf.Editors;
using System.IO;
using DevExpress.Xpf.Core.Serialization;
using System.Windows.Media.Imaging;
using Emdep.Geos.Data.Common.SynchronizationClass;
using Newtonsoft.Json;
using DevExpress.Spreadsheet;
using DevExpress.Xpf.Printing;
using DevExpress.XtraPrinting;
using DevExpress.Export.Xl;
using Emdep.Geos.UI.Commands;
using Emdep.Geos.Modules.PCM;
using Emdep.Geos.Modules.PCM.ViewModels;
using DevExpress.Data.Filtering;
using System.Text;
using System.Threading.Tasks;
using System.Collections.Concurrent;
namespace Emdep.Geos.Modules.PLM.ViewModels
{
    class AddEditBasePriceViewModel : ViewModelBase, INotifyPropertyChanged, IDataErrorInfo
    {
        #region Service
        IPCMService PCMService = new PCMServiceController(GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString());
        IPLMService PLMService = new PLMServiceController(GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString());
        ICrmService crmControl = new CrmServiceController(GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString());
        IWorkbenchStartUp WorkbenchService = new WorkbenchServiceController(GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString());
        IGeosRepositoryService geosService = new GeosRepositoryServiceController(GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString());

        IGeosRepositoryService GeosRepositoryServiceController = new GeosRepositoryServiceController(GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString());

        //IPCMService PCMService = new PCMServiceController("localhost:6699");
        //IPLMService PLMService = new PLMServiceController("localhost:6699");
        private INavigationService Service { get { return this.GetService<INavigationService>(); } }
        #endregion

        #region Events
        public event EventHandler RequestClose;

        public event PropertyChangedEventHandler PropertyChanged;
        public void OnPropertyChanged(PropertyChangedEventArgs e)
        {
            if (PropertyChanged != null)
            {
                PropertyChanged(this, e);
            }
        }



        #endregion

        #region Declarations

        string tempDirectory = Path.Combine(Path.GetTempPath(), "EmdepExportToXLSX");

        private double dialogHeight;
        private double dialogWidth;

        private ObservableCollection<Language> languages;
        private Language languageSelected;

        private string description;
        private string description_en;
        private string description_es;
        private string description_fr;
        private string description_pt;
        private string description_ro;
        private string description_ru;
        private string description_zh;

        private string name;
        private string name_en;
        private string name_es;
        private string name_fr;
        private string name_pt;
        private string name_ro;
        private string name_ru;
        private string name_zh;

        private string remark;
        private string remark_en;
        private string remark_es;
        private string remark_fr;
        private string remark_pt;
        private string remark_ro;
        private string remark_ru;
        private string remark_zh;

        MaximizedElementPosition maximizedElementPosition;

        private string windowHeader;
        private bool isNew;
        MaximizedElementPosition selectedAppearanceItem;
        private ObservableCollection<Site> plantList;
        private List<object> selectedPlant;
        private List<object> selectedPlant_Copy;
        private ObservableCollection<Currency> currencyList;
        private object selectedCurrency;


        private ObservableCollection<Currency> saleCurrencyList;
        private List<object> selectedSaleCurrency;
        private List<object> selectedSaleCurrency_Copy;
        private object selectedSaleCurrencyObj;


        private List<LookupValue> statusList;
        private int selectedStatusIndex;
        private int selectedExchangeRateIndex;
        private LookupValue selectedStatus;

        private ObservableCollection<string> basePriceCodeList;
        private string selectedBasePriceCode;

        private bool isCheckedAllLanguages;
        private bool isNewBasePriceSave;
        private ulong idBasePriceList;

        private bool IsCopyName;
        private bool IsCopyDescription;
        private bool IsCopyRemark;

        private BasePrice clonedBasePrice;

        private DateTime creationDate;
        private DateTime? expiryDate;
        private DateTime? effectiveDate;
        private DateTime? lastUpdated;

        private ObservableCollection<PCMArticleCategory> articleMenuList;
        private PCMArticleCategory selectedArticle;

        DataTable dtArticle;
        DataTable dtArticleCopy;

        private ObservableCollection<Emdep.Geos.UI.Helper.Column> columns;
        private ObservableCollection<BandItem> bands = new ObservableCollection<BandItem>();
        private ObservableCollection<BandItem> detectionBands = new ObservableCollection<BandItem>();
        private List<LookupValue> logicList;
        private LookupValue selectedLogic;

        private ObservableCollection<BasePriceListByItem> articleList;
        private ObservableCollection<BasePriceListByItem> detectionList;

        private List<ArticleCostPrice> articleCostPriceList;
        private List<CurrencyConversion> currencyConversionList;

        private List<Site> article_PlantList;
        private List<Currency> article_CurrencyList;
        private List<Currency> detection_CurrencyList;

        private bool isCalculateArticleCostButtonEnabled;

        private bool isCalculated;
        private ObservableCollection<BasePriceLogEntry> basePriceChangeLogList;
        private BasePriceLogEntry selectedBasePriceChangeLog;
        private bool isAll;

        private string allCurrenies;
        private List<BasePriceListByPlantCurrency> plantCurrencyList;
        private List<BasePriceListByPlantCurrency> plantCurrencyListwithIsChecked;
        private ObservableCollection<BasePriceListByPlantCurrency> bplPlantCurrencyList;
        private List<object> unSelectedSaleCurrency;
        private List<BasePriceListByPlantCurrency> OriginalPlantCurrencyList;
        private ObservableCollection<BandItem> bandsTemplete = new ObservableCollection<BandItem>();
        private ObservableCollection<BandItem> detectionBandTemplate = new ObservableCollection<BandItem>();
        private DataTable dttable;
        private DataTable dttableCopy;


        private Visibility isDuplicateBasePriceButtonVisible;
        private bool isDuplicateBasePriceButtonEnabled;
        private string duplicateCode;

        public bool isDuplicateCliked = false;
        public bool IsDuplicateSave = false;
        private List<CustomerPrice> cpList;
        private bool isUpdatedBasePriceSave;

        public BasePrice DuplicatedBasePriceObject { get; set; }


        private string basePriceOldCode;
        private DataTable dtDetection;
        private DataTable dtDetectionCopy;
        private ObservableCollection<BPLDetection> detectionMenulist;
        private BPLDetection selectedDetection;

        private object selectedCurrency_Copy;
        private bool isPlantAddedOrRemove;
        private bool isSaleCurrencyAddedOrRemove;
        private bool isCurrencyAddedOrRemove;

        private List<UInt64> addArticles;
        private List<UInt64> addDetections;
        private List<Articles> deleteArticles;
        private List<Detections> deleteDetetions;

        private List<CurrencyConversion> currencyConversionList_ByPreviousDate;
        private List<LookupValue> exchangeRateList;
        private LookupValue selectedExchangeRate;
        private string error = string.Empty;
        private string informationError;

        private bool isArticleColumnChooserVisible;
        private bool isDetectionColumnChooserVisible;
        private bool isFirstTimeLoad;
        private bool isSwitch;
        private List<CustomerPriceListByItem> deleteFromCPL;

        private bool? oldIsCheckedAllLanguages = null;
        private DateTime? oldEffectiveDate;
        private DateTime? oldExpiryDate;
        private string oldName;
        private string oldName_en;//[Sudhir.Jangra][GEOS2-4905]
        private string oldName_es;//[Sudhir.Jangra][GEOS2-4905]
        private string oldName_fr;//[Sudhir.Jangra][GEOS2-4905]
        private string oldName_pt;//[Sudhir.Jangra][GEOS2-4905]
        private string oldName_ro;//[Sudhir.Jangra][GEOS2-4905]
        private string oldName_ru;//[Sudhir.Jangra][GEOS2-4905]
        private string oldName_zh;//[Sudhir.Jangra][GEOS2-4905]

        private string oldDescription;//[Sudhir.Jangra][GEOS2-4905]
        private string oldDescription_en;//[Sudhir.Jangra][GEOS2-4905]
        private string oldDescription_es;//[Sudhir.Jangra][GEOS2-4905]
        private string oldDescription_fr;//[Sudhir.Jangra][GEOS2-4905]
        private string oldDescription_pt;//[Sudhir.Jangra][GEOS2-4905]
        private string oldDescription_ro;//[Sudhir.Jangra][GEOS2-4905]
        private string oldDescription_ru;//[Sudhir.Jangra][GEOS2-4905]
        private string oldDescription_zh;//[Sudhir.Jangra][GEOS2-4905]
        private string oldRemark;
        private string oldSelectedLanguage;
        private bool isEnabledSaveButton;
        private bool isEnabledAcceptButton;
        private bool isUserPermission;
        private bool isSaveButtonClicked;
        private Visibility saveButtonVisibility;
        private Visibility exportPriceListButtonVisibility;
        private bool isInitializeFirstTime;

        private List<CustomerPriceListByItem> deleteDetectionFromCPL;
        private List<CustomerPriceListByItem> deleteCurrencyFromCPL;
        private bool inActiveStatus;
        private List<GeosAppSetting> geosAppSettingList;

        private ITokenService tokenService;
        private TableView articleTableView = null;
        private TableView detectionsTableView = null;
        private List<Articles> articlesUpdateGrid;
        private TableView moduleTableView = null;
        private ObservableCollection<BPLDocument> optionWayDetectionSparePartFilesList;
        private ObservableCollection<BPLDocument> fourOptionWayDetectionSparePartFilesList;
        private BPLDocument selectedOptionWayDetectionSparePartFile;
        private string reference;
        private string isAttachmentScrollVisible = "Disabled";//[Sudhir.Jangra][GEOS2-1960][13/03/2023]



        private ObservableCollection<BasePriceLogEntry> commentList;//[Sudhir.Jangra][GEOS2-4935]
        private string commentText;//[Sudhir.Jangra][GEOS2-4935]
        private DateTime? commentDateTimeText;//[Sudhir.Jangra][GEOS2-4935]
        private string commentFullNameText;//[Sudhir.Jangra][GEOS2-4935]
        private byte[] userProfileImageByte;//[Sudhir.Jangra][GEOS2-4935]
        private List<BasePriceLogEntry> addCommentsList;//[Sudhir.jangra][GEOS2-4935]
        private BasePriceLogEntry selectedComment;//[Sudhir.jangra][GEOSS2-4935]
        private ObservableCollection<BasePriceLogEntry> deleteCommentsList;//[Sudhir.Jangra][GEOS2-4935]
        private bool isDeleted;//[Sudhir.Jangra][GEOS2-4935]
        private List<BasePriceLogEntry> updatedCommentList;//[Sudhir.Jangra][GEOS2-4935]

        #endregion

        #region Properties
        #region GEOS2-3126
        private ObservableCollection<PCMArticleCategory> articleMenuListtemp;
        public ObservableCollection<PCMArticleCategory> ArticleMenuListtemp
        {
            get
            {
                return articleMenuListtemp;
            }

            set
            {
                articleMenuListtemp = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ArticleMenuListtemp"));
            }
        }
        //[Sudhir.Jangra][GEOS2-3126][21/12/2022]
        private ObservableCollection<BPLDetection> detectionMenuListtemp;
        public ObservableCollection<BPLDetection> DetectionMenuListtemp
        {
            get
            {
                return detectionMenuListtemp;
            }

            set
            {
                detectionMenuListtemp = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DetectionMenuListtemp"));
            }
        }
        #endregion

        public List<GeosAppSetting> GeosAppSettingList
        {
            get
            {
                return geosAppSettingList;
            }

            set
            {
                geosAppSettingList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("GeosAppSettingList"));
            }
        }

        public string BPLArticleGridSettingFilePath = GeosApplication.Instance.UserSettingFolderName + "BPLArticleGridSetting.Xml";

        public string BPLDetectionGridSettingFilePath = GeosApplication.Instance.UserSettingFolderName + "BPLDetectionGridSetting.Xml";

        public string BPLModuleGridSettingFilePath = GeosApplication.Instance.UserSettingFolderName + "BPLModuleGridSetting.Xml";
        public BasePrice NewBasePrice { get; set; }
        public BasePrice UpdatedItem { get; set; }


        public double DialogHeight
        {
            get { return dialogHeight; }
            set
            {
                dialogHeight = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DialogHeight"));
            }
        }

        public double DialogWidth
        {
            get { return dialogWidth; }
            set
            {
                dialogWidth = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DialogWidth"));
            }
        }

        public ObservableCollection<Language> Languages
        {
            get { return languages; }
            set
            {
                languages = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Languages"));
            }
        }

        public Language LanguageSelected
        {
            get
            {
                return languageSelected;
            }
            set
            {
                languageSelected = value;
                OnPropertyChanged(new PropertyChangedEventArgs("LanguageSelected"));
            }
        }

        public string Description
        {
            get { return description; }
            set
            {
                description = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Description"));
            }
        }

        public string Description_en
        {
            get
            {
                return description_en;
            }
            set
            {
                description_en = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Description_en"));
            }
        }

        public string Description_es
        {
            get
            {
                return description_es;
            }
            set
            {
                description_es = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Description_es"));
            }
        }

        public string Description_fr
        {
            get
            {
                return description_fr;
            }
            set
            {
                description_fr = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Description_fr"));
            }
        }

        public string Description_pt
        {
            get
            {
                return description_pt;
            }
            set
            {
                description_pt = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Description_pt"));
            }
        }

        public string Description_ro
        {
            get
            {
                return description_ro;
            }
            set
            {
                description_ro = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Description_ro"));
            }
        }

        public string Description_ru
        {
            get
            {
                return description_ru;
            }
            set
            {
                description_ru = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Description_ru"));
            }
        }

        public string Description_zh
        {
            get
            {
                return description_zh;
            }
            set
            {
                description_zh = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Description_zh"));
            }
        }

        public string Name
        {
            get
            {
                return name;
            }
            set
            {
                name = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Name"));
            }
        }

        public string Name_en
        {
            get
            {
                return name_en;
            }
            set
            {
                name_en = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Name_en"));
            }
        }

        public string Name_es
        {
            get
            {
                return name_es;
            }
            set
            {
                name_es = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Name_es"));
            }
        }

        public string Name_fr
        {
            get
            {
                return name_fr;
            }
            set
            {
                name_fr = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Name_fr"));
            }
        }

        public string Name_pt
        {
            get
            {
                return name_pt;
            }
            set
            {
                name_pt = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Name_pt"));
            }
        }

        public string Name_ro
        {
            get
            {
                return name_ro;
            }
            set
            {
                name_ro = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Name_ro"));
            }
        }

        public string Name_ru
        {
            get
            {
                return name_ru;
            }
            set
            {
                name_ru = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Name_ru"));
            }
        }

        public string Name_zh
        {
            get
            {
                return name_zh;
            }
            set
            {
                name_zh = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Name_zh"));
            }
        }

        public MaximizedElementPosition MaximizedElementPosition
        {
            get { return maximizedElementPosition; }
            set
            {
                maximizedElementPosition = value;
                OnPropertyChanged(new PropertyChangedEventArgs("MaximizedElementPosition"));
            }
        }

        public string WindowHeader
        {
            get
            {
                return windowHeader;
            }
            set
            {
                windowHeader = value;
                OnPropertyChanged(new PropertyChangedEventArgs("WindowHeader"));
            }
        }

        public bool IsNew
        {
            get
            {
                return isNew;
            }

            set
            {
                isNew = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsNew"));
            }
        }

        public MaximizedElementPosition SelectedAppearanceItem
        {
            get { return selectedAppearanceItem; }
            set
            {
                selectedAppearanceItem = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedAppearanceItem"));
            }
        }

        public ObservableCollection<Site> PlantList
        {
            get
            {
                return plantList;
            }

            set
            {
                plantList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("PlantList"));
            }
        }

        public List<object> SelectedPlant
        {
            get
            {
                return selectedPlant;
            }

            set
            {
                selectedPlant = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedPlant"));
            }
        }

        public List<object> SelectedPlant_Copy
        {
            get
            {
                return selectedPlant_Copy;
            }

            set
            {
                selectedPlant_Copy = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedPlant_Copy"));
            }
        }

        public ObservableCollection<Currency> CurrencyList
        {
            get
            {
                return currencyList;
            }

            set
            {
                currencyList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("CurrencyList"));
            }
        }

        public object SelectedCurrency
        {
            get
            {
                return selectedCurrency;
            }

            set
            {
                selectedCurrency = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedCurrency"));
            }
        }

        public List<LookupValue> StatusList
        {
            get { return statusList; }
            set
            {
                statusList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("StatusList"));
            }
        }

        public List<LookupValue> ExchangeRateList
        {
            get { return exchangeRateList; }
            set
            {
                exchangeRateList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ExchangeRateList"));
            }
        }

        public LookupValue SelectedExchangeRate
        {
            get { return selectedExchangeRate; }
            set
            {
                selectedExchangeRate = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedExchangeRate"));
            }
        }

        public int SelectedStatusIndex
        {
            get { return selectedStatusIndex; }
            set
            {
                selectedStatusIndex = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedStatusIndex"));
            }
        }

        public int SelectedExchangeRateIndex
        {
            get { return selectedExchangeRateIndex; }
            set
            {
                selectedExchangeRateIndex = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedExchangeRateIndex"));
            }
        }

        public LookupValue SelectedStatus
        {
            get { return selectedStatus; }
            set
            {
                selectedStatus = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedStatus"));
            }
        }

        public ObservableCollection<Currency> SaleCurrencyList
        {
            get
            {
                return saleCurrencyList;
            }
            set
            {
                saleCurrencyList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SaleCurrencyList"));
            }
        }

        public List<object> SelectedSaleCurrency
        {
            get
            {
                return selectedSaleCurrency;
            }
            set
            {
                selectedSaleCurrency = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedSaleCurrency"));
            }
        }

        public List<object> SelectedSaleCurrency_Copy
        {
            get
            {
                return selectedSaleCurrency_Copy;
            }
            set
            {
                selectedSaleCurrency_Copy = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedSaleCurrency_Copy"));
            }
        }
        public object SelectedSaleCurrencyObj
        {
            get
            {
                return selectedSaleCurrencyObj;
            }

            set
            {
                selectedSaleCurrencyObj = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedSaleCurrencyObj"));
            }
        }

        public ObservableCollection<string> BasePriceCodeList
        {
            get
            {
                return basePriceCodeList;
            }
            set
            {
                basePriceCodeList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("BasePriceCodeList"));
            }
        }

        public string SelectedBasePriceCode
        {
            get
            {
                return selectedBasePriceCode;
            }
            set
            {
                selectedBasePriceCode = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedBasePriceCode"));
            }
        }

        public bool IsCheckedAllLanguages
        {
            get
            {
                return isCheckedAllLanguages;
            }
            set
            {
                isCheckedAllLanguages = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsCheckedAllLanguages"));
            }
        }

        public string Remark
        {
            get
            {
                return remark;
            }

            set
            {
                remark = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Remark"));
            }
        }

        public string Remark_en
        {
            get
            {
                return remark_en;
            }

            set
            {
                remark_en = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Remark_en"));
            }
        }

        public string Remark_es
        {
            get
            {
                return remark_es;
            }

            set
            {
                remark_es = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Remark_es"));
            }
        }

        public string Remark_fr
        {
            get
            {
                return remark_fr;
            }

            set
            {
                remark_fr = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Remark_fr"));
            }
        }

        public string Remark_pt
        {
            get
            {
                return remark_pt;
            }

            set
            {
                remark_pt = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Remark_pt"));
            }
        }

        public string Remark_ro
        {
            get
            {
                return remark_ro;
            }

            set
            {
                remark_ro = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Remark_ro"));
            }
        }

        public string Remark_ru
        {
            get
            {
                return remark_ru;
            }

            set
            {
                remark_ru = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Remark_ru"));
            }
        }

        public string Remark_zh
        {
            get
            {
                return remark_zh;
            }

            set
            {
                remark_zh = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Remark_zh"));
            }
        }

        public bool IsNewBasePriceSave
        {
            get
            {
                return isNewBasePriceSave;
            }

            set
            {
                isNewBasePriceSave = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsNewBasePriceSave"));
            }
        }

        public ulong IdBasePriceList
        {
            get
            {
                return idBasePriceList;
            }

            set
            {
                idBasePriceList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IdBasePriceList"));
            }
        }

        public BasePrice ClonedBasePrice
        {
            get
            {
                return clonedBasePrice;
            }
            set
            {
                clonedBasePrice = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ClonedBasePrice"));
            }
        }

        public DateTime CreationDate
        {
            get
            {
                return creationDate;
            }
            set
            {
                creationDate = value;
                OnPropertyChanged(new PropertyChangedEventArgs("CreationDate"));
            }
        }

        public DateTime? ExpiryDate
        {
            get
            {
                return expiryDate;
            }
            set
            {
                expiryDate = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ExpiryDate"));
            }
        }

        public DateTime? EffectiveDate
        {
            get
            {
                return effectiveDate;
            }
            set
            {
                effectiveDate = value;
                OnPropertyChanged(new PropertyChangedEventArgs("EffectiveDate"));
            }
        }

        public DateTime? LastUpdated
        {
            get
            {
                return lastUpdated;
            }
            set
            {
                lastUpdated = value;
                OnPropertyChanged(new PropertyChangedEventArgs("LastUpdated"));
            }
        }
        public ObservableCollection<PCMArticleCategory> ArticleMenuList
        {
            get
            {
                return articleMenuList;
            }

            set
            {
                articleMenuList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ArticleMenuList"));
            }
        }



        public PCMArticleCategory SelectedArticle
        {
            get
            {
                return selectedArticle;
            }

            set
            {
                selectedArticle = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedArticle"));
            }
        }

        public DataTable DtArticle
        {
            get { return dtArticle; }
            set
            {
                dtArticle = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DtArticle"));
            }
        }
        public DataTable DtArticleCopy
        {
            get { return dtArticleCopy; }
            set
            {
                dtArticleCopy = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DtArticleCopy"));
            }
        }
        //[nsatpute][GEOS2-7894][01.08.2025]
        private ObservableCollection<PriceListItem> articleItems;
        public ObservableCollection<PriceListItem> ArticleItems
        {
            get => articleItems;
            set
            {
                articleItems = value;
                OnPropertyChanged(new PropertyChangedEventArgs(nameof(ArticleItems)));
            }
        }
        private ObservableCollection<ModuleItem> moduleItems;
        public ObservableCollection<ModuleItem> ModuleItems
        {
            get => moduleItems;
            set
            {
                moduleItems = value;
                OnPropertyChanged(new PropertyChangedEventArgs(nameof(ModuleItems)));
            }
        }

        private ObservableCollection<DetectionItem> detectionItems;
        public ObservableCollection<DetectionItem> DetectionItems
        {
            get => detectionItems;
            set
            {
                detectionItems = value;
                OnPropertyChanged(new PropertyChangedEventArgs(nameof(DetectionItems)));
            }
        }



        public ObservableCollection<Emdep.Geos.UI.Helper.Column> Columns
        {
            get { return columns; }
            set
            {
                columns = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Columns"));
            }
        }
        public ObservableCollection<BandItem> Bands
        {
            get { return bands; }
            set
            {
                bands = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Bands"));
            }
        }

        public ObservableCollection<BandItem> DetectionBands
        {
            get { return detectionBands; }
            set
            {
                detectionBands = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DetectionBands"));
            }
        }

        public ObservableCollection<Summary> TotalSummary { get; private set; }
        public List<LookupValue> LogicList
        {
            get
            {
                return logicList;
            }

            set
            {
                logicList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("LogicList"));
            }
        }

        public LookupValue SelectedLogic
        {
            get
            {
                return selectedLogic;
            }
            set
            {
                selectedLogic = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedLogic"));
            }
        }

        public ObservableCollection<BasePriceListByItem> ArticleList
        {
            get
            {
                return articleList;
            }

            set
            {
                articleList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ArticleList"));
            }
        }

        public ObservableCollection<BasePriceListByItem> DetectionList
        {
            get { return detectionList; }
            set
            {
                detectionList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DetectionList"));
            }
        }
        public List<ArticleCostPrice> ArticleCostPriceList
        {
            get
            {
                return articleCostPriceList;
            }

            set
            {
                articleCostPriceList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ArticleCostPriceList"));
            }
        }

        public List<CurrencyConversion> CurrencyConversionList
        {
            get
            {
                return currencyConversionList;
            }

            set
            {
                currencyConversionList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("CurrencyConversionList"));
            }
        }

        public List<Site> Article_PlantList1
        {
            get
            {
                return article_PlantList;
            }
            set
            {
                article_PlantList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Article_PlantList"));
            }
        }
        public List<Currency> Article_CurrencyList1
        {
            get
            {
                return article_CurrencyList;
            }
            set
            {
                article_CurrencyList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Article_CurrencyList"));
            }
        }
        public List<Currency> Detection_CurrencyList1
        {
            get
            {
                return detection_CurrencyList;
            }
            set
            {
                detection_CurrencyList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Detection_CurrencyList"));
            }
        }


        public bool IsCalculateArticleCostButtonEnabled
        {
            get
            {
                return isCalculateArticleCostButtonEnabled;
            }

            set
            {
                isCalculateArticleCostButtonEnabled = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsCalculateArticleCostButtonEnabled"));
            }
        }

        public bool IsCalculated
        {
            get
            {
                return isCalculated;
            }

            set
            {
                isCalculated = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsCalculated"));
            }
        }

        public ObservableCollection<BasePriceLogEntry> BasePriceChangeLogList
        {
            get
            {
                return basePriceChangeLogList;
            }

            set
            {
                basePriceChangeLogList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("BasePriceChangeLogList"));
            }
        }

        public BasePriceLogEntry SelectedBasePriceChangeLog
        {
            get
            {
                return selectedBasePriceChangeLog;
            }

            set
            {
                selectedBasePriceChangeLog = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedBasePriceChangeLog"));
            }
        }

        public bool IsAll
        {
            get
            {
                return isAll;
            }

            set
            {
                isAll = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsAll"));
            }
        }

        public List<object> UnSelectedSaleCurrency
        {
            get
            {
                return unSelectedSaleCurrency;
            }
            set
            {
                unSelectedSaleCurrency = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedSaleCurrency"));
            }
        }

        public DataTable Dttable
        {
            get { return dttable; }
            set
            {
                dttable = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Dttable"));
            }
        }
        public DataTable DtTableCopy
        {
            get { return dttableCopy; }
            set
            {
                dttableCopy = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DtTableCopy"));
            }
        }

        public ObservableCollection<BandItem> BandsTemplete
        {
            get { return bandsTemplete; }
            set
            {
                bandsTemplete = value;
                OnPropertyChanged(new PropertyChangedEventArgs("BandsTemplete"));
            }
        }
        public ObservableCollection<BandItem> DetectionBandTemplate
        {
            get { return detectionBandTemplate; }
            set
            {
                detectionBandTemplate = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DetectionBandTemplate"));
            }
        }
        public List<BasePriceListByPlantCurrency> PlantCurrencyList
        {
            get
            {
                return plantCurrencyList;
            }
            set
            {
                plantCurrencyList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("PlantCurrencyList"));
            }
        }

        public List<BasePriceListByPlantCurrency> PlantCurrencyListWithIsChecked
        {
            get
            {
                return plantCurrencyListwithIsChecked;
            }
            set
            {
                plantCurrencyListwithIsChecked = value;
                OnPropertyChanged(new PropertyChangedEventArgs("PlantCurrencyListWithIsChecked"));
            }
        }
        public ObservableCollection<BasePriceListByPlantCurrency> BPLPlantCurrencyList
        {
            get
            {
                return bplPlantCurrencyList;
            }
            set
            {
                bplPlantCurrencyList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("BPLPlantCurrencyList"));
            }
        }

        public Visibility IsDuplicateBasePriceButtonVisible
        {
            get
            {
                return isDuplicateBasePriceButtonVisible;
            }

            set
            {
                isDuplicateBasePriceButtonVisible = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsDuplicateBasePriceButtonVisible"));
            }
        }

        public bool IsDuplicateBasePriceButtonEnabled
        {
            get
            {
                return isDuplicateBasePriceButtonEnabled;
            }

            set
            {
                isDuplicateBasePriceButtonEnabled = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsDuplicateBasePriceButtonEnabled"));
            }
        }

        public string DuplicateCode
        {
            get
            {
                return duplicateCode;
            }

            set
            {
                duplicateCode = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DuplicateCode"));
            }
        }

        public List<BasePriceLogEntry> ChangedLogsEntries { get; set; }
        public List<CustomerPriceLogEntry> CPLChangedLogsEntries { get; set; }
        public virtual bool DialogResult { get; set; }
        public virtual string ResultFileName { get; set; }

        public List<CustomerPrice> CPList
        {
            get
            {
                return cpList;
            }
            set
            {
                cpList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("CPList"));
            }
        }

        public LookupValue SelectedOriginalStatus { get; set; }

        public bool IsUpdatedBasePriceSave
        {
            get
            {
                return isUpdatedBasePriceSave;
            }

            set
            {
                isUpdatedBasePriceSave = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsUpdatedBasePriceSave"));
            }
        }
        public string BasePriceOldCode
        {
            get
            {
                return basePriceOldCode;
            }

            set
            {
                basePriceOldCode = value;
                OnPropertyChanged(new PropertyChangedEventArgs("BasePriceOldCode"));
            }
        }


        public ObservableCollection<BPLDetection> DetectionMenulist
        {
            get
            {
                return detectionMenulist;
            }

            set
            {
                detectionMenulist = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DetectionMenulist"));
            }
        }

        public BPLDetection SelectedDetection
        {
            get
            {
                return selectedDetection;
            }

            set
            {
                selectedDetection = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedDetection"));
            }
        }
        public DataTable DtDetection
        {
            get { return dtDetection; }
            set
            {
                dtDetection = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DtDetection"));
            }
        }

        public DataTable DtDetectionCopy
        {
            get { return dtDetectionCopy; }
            set
            {
                dtDetectionCopy = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DtDetectionCopy"));
            }
        }

        public object SelectedCurrency_Copy
        {
            get
            {
                return selectedCurrency_Copy;
            }

            set
            {
                selectedCurrency_Copy = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedCurrency_Copy"));
            }
        }

        public bool IsPlantAddedOrRemove
        {
            get
            {
                return isPlantAddedOrRemove;
            }

            set
            {
                isPlantAddedOrRemove = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsPlantAddedOrRemove"));
            }
        }

        public bool IsSaleCurrencyAddedOrRemove
        {
            get
            {
                return isSaleCurrencyAddedOrRemove;
            }

            set
            {
                isSaleCurrencyAddedOrRemove = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsSaleCurrencyAddedOrRemove"));
            }
        }

        public bool IsCurrencyAddedOrRemove
        {
            get
            {
                return isCurrencyAddedOrRemove;
            }

            set
            {
                isCurrencyAddedOrRemove = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsCurrencyAddedOrRemove"));
            }
        }

        public List<UInt64> AddArticles
        {
            get
            {
                return addArticles;
            }

            set
            {
                addArticles = value;
                OnPropertyChanged(new PropertyChangedEventArgs("AddArticles"));
            }
        }

        public List<UInt64> AddDetections
        {
            get
            {
                return addDetections;
            }

            set
            {
                addDetections = value;
                OnPropertyChanged(new PropertyChangedEventArgs("AddDetections"));
            }
        }


        public List<Articles> DeleteArticles
        {
            get
            {
                return deleteArticles;
            }

            set
            {
                deleteArticles = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DeleteArticles"));
            }
        }

        public List<Detections> DeleteDetections
        {
            get { return deleteDetetions; }
            set
            {
                deleteDetetions = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DeleteDetections"));
            }
        }

        public List<CurrencyConversion> CurrencyConversionList_ByPreviousDate1
        {
            get
            {
                return currencyConversionList_ByPreviousDate;
            }

            set
            {
                currencyConversionList_ByPreviousDate = value;
                OnPropertyChanged(new PropertyChangedEventArgs("CurrencyConversionList_ByPreviousDate1"));
            }
        }

        public string InformationError
        {
            get { return informationError; }
            set
            {
                informationError = value;
                OnPropertyChanged(new PropertyChangedEventArgs("InformationError"));
            }
        }


        public bool IsArticleColumnChooserVisible
        {
            get { return isArticleColumnChooserVisible; }
            set
            {
                isArticleColumnChooserVisible = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsArticleColumnChooserVisible"));
            }
        }


        public bool IsDetectionColumnChooserVisible
        {
            get { return isDetectionColumnChooserVisible; }
            set
            {
                isDetectionColumnChooserVisible = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsDetectionColumnChooserVisible"));
            }
        }

        private bool isModuleColumnChooserVisible;
        public bool IsModuleColumnChooserVisible
        {
            get { return isModuleColumnChooserVisible; }
            set
            {
                isModuleColumnChooserVisible = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsModuleColumnChooserVisible"));
            }
        }

        public bool IsFirstTimeLoad
        {
            get
            {
                return isFirstTimeLoad;
            }

            set
            {
                isFirstTimeLoad = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsFirstTimeLoad"));
            }
        }

        public bool IsSwitch
        {
            get
            {
                return isSwitch;
            }

            set
            {
                isSwitch = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsSwitch"));
            }
        }


        public List<CustomerPriceListByItem> DeleteFromCPL
        {
            get
            {
                return deleteFromCPL;
            }

            set
            {
                deleteFromCPL = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DeleteFromCPL"));
            }
        }

        public bool IsUserPermission
        {
            get
            {
                return isUserPermission;
            }

            set
            {
                isUserPermission = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsUserPermission"));
            }
        }

        public bool IsEnabledAcceptButton
        {
            get { return isEnabledAcceptButton; }
            set
            {
                isEnabledAcceptButton = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsEnabledAcceptButton"));
            }
        }

        public bool IsEnabledSaveButton
        {
            get { return isEnabledSaveButton; }
            set
            {
                if (GeosApplication.Instance.IsPLMPermissionChange == true && IsUserPermission == true)
                {
                    isEnabledSaveButton = value;
                }
                else if (!isEnabledSaveButton)
                {
                    isEnabledSaveButton = false;
                }
                OnPropertyChanged(new PropertyChangedEventArgs("IsEnabledSaveButton"));
            }
        }
        public Visibility SaveButtonVisibility
        {
            get { return saveButtonVisibility; }
            set { saveButtonVisibility = value; OnPropertyChanged(new PropertyChangedEventArgs("SaveButtonVisibility")); }
        }

        public Visibility ExportPriceListButtonVisibility
        {
            get { return exportPriceListButtonVisibility; }
            set { exportPriceListButtonVisibility = value; OnPropertyChanged(new PropertyChangedEventArgs("ExportPriceListButtonVisibility")); }
        }

        public List<CustomerPriceListByItem> DeleteDetectionFromCPL
        {
            get
            {
                return deleteDetectionFromCPL;
            }

            set
            {
                deleteDetectionFromCPL = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DeleteDetectionFromCPL"));
            }
        }

        public List<CustomerPriceListByItem> DeleteCurrencyFromCPL
        {
            get
            {
                return deleteCurrencyFromCPL;
            }

            set
            {
                deleteCurrencyFromCPL = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DeleteCurrencyFromCPL"));
            }
        }
        public bool InActiveStatus
        {
            get
            {
                return inActiveStatus;
            }

            set
            {
                inActiveStatus = value;
                OnPropertyChanged(new PropertyChangedEventArgs("InActiveStatus"));
            }
        }

        public List<Articles> ArticlesUpdatedGrid
        {
            get
            {
                return articlesUpdateGrid;
            }

            set
            {
                articlesUpdateGrid = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ArticlesUpdatedGrid"));
            }
        }

        public ObservableCollection<BPLDocument> OptionWayDetectionSparePartFilesList
        {
            get
            {
                return optionWayDetectionSparePartFilesList;
            }

            set
            {
                optionWayDetectionSparePartFilesList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("OptionWayDetectionSparePartFilesList"));
            }
        }

        public ObservableCollection<BPLDocument> FourOptionWayDetectionSparePartFilesList
        {
            get
            {
                return fourOptionWayDetectionSparePartFilesList;
            }

            set
            {
                fourOptionWayDetectionSparePartFilesList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("FourOptionWayDetectionSparePartFilesList"));
            }
        }

        public BPLDocument SelectedOptionWayDetectionSparePartFile
        {
            get
            {
                return selectedOptionWayDetectionSparePartFile;
            }

            set
            {
                selectedOptionWayDetectionSparePartFile = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedOptionWayDetectionSparePartFile"));
            }
        }

        public string Reference
        {
            get
            {
                return reference;
            }

            set
            {
                reference = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Reference"));
            }
        }

        //[Sudhir.Jangra][GEOS2-1960][13/03/2023]
        public string IsAttachmentScrollVisible
        {
            get { return isAttachmentScrollVisible; }
            set
            {
                isAttachmentScrollVisible = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsAttachmentScrollVisible"));
            }
        }
        #region GEOS2-2889
        //Shubham[skadam] GEOS2-2889 [ Modules + Attachments ]- Duplicate the base price list [#PLM05] 24 04 2023
        #endregion
        bool isDuplicated = false;
        public bool IsDuplicated
        {
            get
            {
                return isDuplicated;
            }

            set
            {
                isDuplicated = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsDuplicated"));
            }
        }
        List<BPLDocument> duplicatedPLMArticleAttachmentList;
        public List<BPLDocument> DuplicatedPLMArticleAttachmentList
        {
            get
            {
                return duplicatedPLMArticleAttachmentList;
            }

            set
            {
                duplicatedPLMArticleAttachmentList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DuplicatedPLMArticleAttachmentList"));
            }
        }

        //[Sudhir.jangra][GEOS2-4935]
        public ObservableCollection<BasePriceLogEntry> CommentsList
        {
            get { return commentList; }
            set
            {
                commentList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("CommentsList"));
            }
        }

        //[Sudhir.jangra][GEOS2-4935]
        public string CommentText
        {
            get { return commentText; }
            set
            {
                commentText = value;
                OnPropertyChanged(new PropertyChangedEventArgs("CommentText"));
            }
        }

        //[Sudhir.Jangra][GEOS2-4935]
        public DateTime? CommentDateTimeText
        {
            get { return commentDateTimeText; }
            set
            {
                commentDateTimeText = value;
                OnPropertyChanged(new PropertyChangedEventArgs("CommentDateTimeText"));
            }
        }

        //[Sudhir.Jangra][GEOS2-4935]
        public string CommentFullNameText
        {
            get { return commentFullNameText; }
            set
            {
                commentFullNameText = value;
                OnPropertyChanged(new PropertyChangedEventArgs("CommentFullNameText"));
            }
        }

        //[Sudhir.Jangra][GEOS2-4935]
        public byte[] UserProfileImageByte
        {
            get { return userProfileImageByte; }
            set
            {
                userProfileImageByte = value;
                OnPropertyChanged(new PropertyChangedEventArgs("UserProfileImageByte"));
            }
        }

        public List<BasePriceLogEntry> AddCommentsList
        {
            get { return addCommentsList; }
            set
            {
                addCommentsList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("AddCommentsList"));
            }
        }

        //[Sudhir.Jangra][GEOS2-4935]
        public BasePriceLogEntry SelectedComment
        {
            get { return selectedComment; }
            set
            {
                selectedComment = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedComment"));
            }
        }

        //[Sudhir.jangra][GEOS2-4935]
        public ObservableCollection<BasePriceLogEntry> DeleteCommentsList
        {
            get { return deleteCommentsList; }
            set
            {
                deleteCommentsList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DeleteCommentsList"));
            }
        }

        //[Sudhir.Jangra][GEOS2-4935]
        public bool IsDeleted
        {
            get { return isDeleted; }
            set
            {
                isDeleted = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsDeleted"));
            }
        }

        //[Sudhir.jangra][GEOS2-4935]
        public List<BasePriceLogEntry> UpdatedCommentsList
        {
            get { return updatedCommentList; }
            set
            {
                updatedCommentList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("UpdatedCommentsList"));
            }
        }
        //[nsatpute][GEOS2-7894][01.08.2025]
        public Dictionary<string, double?> CurrencyConversionRates { get; set; } = new Dictionary<string, double?>();
        public Dictionary<string, double?> CurrencyValues { get; set; } = new Dictionary<string, double?>();

        #endregion

        #region ICommands

        public ICommand EscapeButtonCommand { get; set; }
        public ICommand CancelButtonCommand { get; set; }
        public ICommand ChangeLanguageCommand { get; set; }
        public ICommand ChangeNameCommand { get; set; }
        public ICommand ChangeDescriptionCommand { get; set; }
        public ICommand ChangeRemarkCommand { get; set; }
        public ICommand UncheckedCopyNameDescriptionCommand { get; set; }

        public ICommand AcceptButtonCommand { get; set; }

        public ICommand ShowReferenceViewCommand { get; set; }
        public ICommand ShowDescriptionViewCommand { get; set; }
        public ICommand ChangePlantCommand { get; set; }
        public ICommand ChangeCurrencyCommand { get; set; }
        public ICommand ChangeExchangeRateCommand { get; set; }
        public ICommand ChangeSaleCurrencyCommand { get; set; }

        public ICommand CommandOnDragRecordOverArticleGrid { get; set; }
        public ICommand CommandOnDragRecordOverDetectionGrid { get; set; }
        public ICommand CommandDropRecordArticleGrid { get; set; }
        public ICommand CommandDropRecordDetectionGrid { get; set; }
        public ICommand CommandCompleteRecordDragDropArticleGrid { get; set; }
        public ICommand CommandCompleteRecordDragDropDetectionGrid { get; set; }
        public ICommand DeleteArticleCommand { get; set; }
        public ICommand DeleteDetectionCommand { get; set; }
        public ICommand RuleValueChangedCommand { get; set; }
        public ICommand RuleValueChangedDetectionCommand { get; set; }
        public ICommand CalculateArticleCostCommand { get; set; }

        public ICommand ExportToExcelCommand { get; set; }
        public ICommand ExportToExcelPriceListDetailsCommand { get; set; }
        public ICommand AllButtonCommand { get; set; }
        public ICommand PlantCurrencyCheckBoxCellValueChangingCommand { get; set; }

        public ICommand DuplicateBasePriceCommand { get; set; }


        public ICommand ArticleGridControlLoadedCommand { get; set; }
        public ICommand ArticleItemListTableViewLoadedCommand { get; set; }
        public ICommand DetectionGridControlLoadedCommand { get; set; }
        public ICommand DetectionItemListTableViewLoadedCommand { get; set; }


        public ICommand ShowingEditorCommand { get; set; }
        public ICommand PastingFromClipBoardCommond { get; set; }
        public ICommand PastingFromClipBoardDetectionCommond { get; set; }
        public ICommand ArticleGridControlUnloadedCommand { get; set; }
        public ICommand DetectionGridControlUnloadedCommand { get; set; }
        public ICommand PasteInSearchControlCommand { get; set; }

        public ICommand AddFileCommand { get; set; }
        public ICommand EditFileCommand { get; set; }

        public ICommand SaveButtonCommand { get; set; }
        public ICommand ChangeStatusCommand { get; set; }
        public ICommand ChangeEffectiveDateCommand { get; set; }
        public ICommand ChangeExpiryDateCommand { get; set; }
        public ICommand ChangeCheckAllLanguagesCommand { get; set; }

        public ICommand EditArticleCommand { get; set; }

        public ICommand DetectionsDoubleClickCommand { get; set; }

        public ICommand OpenPDFDocumentCommand { get; set; }
        public ICommand DeleteFileCommand { get; set; }

        //[Sudhir.Jangra][01/12/2022][GEOS2-2855]
        public ICommand addAllModuleViewCommand { get; set; }
        public ICommand addAllArticleViewCommand { get; set; }
        public ICommand addAllDetectionViewCommand { get; set; }
        #region GEOS2-3272
        // shubham[skadam] GEOS2-3272 Custom filters in the BPL and CPL grid [#PLM39] 01 12 2022
        public ICommand FilterEditorCreatedCommand { get; set; }
        public ICommand CommandShowFilterPopupClick { get; set; }
        public ICommand CustomCellAppearanceCommand { get; set; }
        public ICommand TableView_ShownEditorCommand { get; set; }
        public ICommand CommandFilterStatusTileClick { get; set; }
        public ICommand CommandTileBarClickDoubleClick { get; set; }

        public ICommand DetectionFilterEditorCreatedCommand { get; set; }
        public ICommand DetectionCommandShowFilterPopupClick { get; set; }
        public ICommand DetectionCustomCellAppearanceCommand { get; set; }
        public ICommand DetectionTableView_ShownEditorCommand { get; set; }
        public ICommand DetectionCommandFilterStatusTileClick { get; set; }
        public ICommand DetectionCommandTileBarClickDoubleClick { get; set; }
        #endregion

        #region  GEOS2-2886
        public ICommand CommandOnDragRecordOverModuleGrid { get; set; }
        public ICommand CommandDropRecordModuleGrid { get; set; }
        public ICommand CommandCompleteRecordDragDropModuleGrid { get; set; }
        public ICommand RuleValueChangedModuleCommand { get; set; }
        public ICommand DeleteModuleCommand { get; set; }

        public ICommand ModuleTableView_ShownEditorCommand { get; set; }
        public ICommand ModuleGridControlUnloadedCommand { get; set; }
        public ICommand PastingFromClipBoardModuleCommond { get; set; }
        public ICommand ModuleGridControlLoadedCommand { get; set; }

        public ICommand ModulesDoubleClickCommand { get; set; }
        #endregion


        //Shubham[skadam] GEOS2-4424 Need to add "Add ALL" button in module tab in BPL. 29 08 2023
        //Shubham[skadam] GEOS2-4784 Need to add custom filter option in module same as article/detection. 29 08 2023
        //Shubham[skadam] GEOS2-4785 No additional data so remove [0] this in tree menu in article, detection & module  left tree in BPL menu 29 08 2023
        //Shubham[skadam] GEOS2-4786 (JLR) The exported XLS Price List (BPL and CPL) must have the sheet with the modules. 29 08 2023
        //Shubham[skadam] GEOS2-4424 Some changes in  Module tab in BPL (3/3) 28 08 2023
        public ICommand ModuleFilterEditorCreatedCommand { get; set; }
        public ICommand ModuleCommandShowFilterPopupClick { get; set; }
        public ICommand ModuleCommandFilterStatusTileClick { get; set; }
        public ICommand ModuleCommandTileBarClickDoubleClick { get; set; }

        //public ICommand ModuleCustomCellAppearanceCommand { get; set; }
        //public ICommand ModuleTableView_ShownEditorCommand { get; set; }

        public ICommand AddCommentsCommand { get; set; }//[Sudhir.jangra][GEOS2-4935][21/11/2023]

        public ICommand DeleteCommentRowCommand { get; set; }//[Sudhir.Jangra][GEOS2-4935]

        public ICommand CommentsGridDoubleClickCommand { get; set; }//[Sudhir.Jangra][GEOS2-4935]
        #endregion

        #region Constructor

        public AddEditBasePriceViewModel()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Constructor AddBasePriceViewModel ...", category: Category.Info, priority: Priority.Low);

                Directory.CreateDirectory(tempDirectory);

                //DialogWidth = System.Windows.SystemParameters.WorkArea.Width - 10;
                //DialogHeight = System.Windows.SystemParameters.WorkArea.Height - 110;

                DialogWidth = System.Windows.SystemParameters.WorkArea.Width - 20;
                DialogHeight = System.Windows.SystemParameters.WorkArea.Height - 90;

                if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }

                EscapeButtonCommand = new DelegateCommand<object>(CloseWindow);
                CancelButtonCommand = new DelegateCommand<object>(CloseWindow);

                ChangeLanguageCommand = new DelegateCommand<object>(RetrieveDescriptionByLanguge);
                ChangeNameCommand = new DelegateCommand<object>(SetNameToLanguage);
                ChangeDescriptionCommand = new DelegateCommand<object>(SetDescriptionToLanguage);
                ChangeRemarkCommand = new DelegateCommand<object>(SetRemarkToLanguage);
                UncheckedCopyNameDescriptionCommand = new DelegateCommand<object>(UncheckedCopyNameDescription);
                ShowReferenceViewCommand = new DelegateCommand<object>(ShowReferenceViewCommandAction);
                ShowDescriptionViewCommand = new DelegateCommand<object>(ShowDescriptionViewCommandAction);

                AcceptButtonCommand = new DelegateCommand<object>(AcceptButtonCommandAction);
                ChangePlantCommand = new DelegateCommand<object>(ChangePlantCommandAction);
                ChangeCurrencyCommand = new DelegateCommand<object>(ChangeCurrencyCommandAction);
                ChangeExchangeRateCommand = new DelegateCommand<object>(ChangeExchangeRateCommandAction);
                ChangeSaleCurrencyCommand = new DelegateCommand<object>(ChangeSaleCurrencyCommandAction);

                CommandOnDragRecordOverArticleGrid = new DelegateCommand<DragRecordOverEventArgs>(OnDragRecordOverArticleGrid);
                CommandOnDragRecordOverDetectionGrid = new DelegateCommand<DragRecordOverEventArgs>(OnDragRecordOverDetectionGrid);
                CommandDropRecordArticleGrid = new DelegateCommand<DropRecordEventArgs>(DropRecordArticleGrid);
                CommandDropRecordDetectionGrid = new DelegateCommand<DropRecordEventArgs>(DropRecordDetectionGrid);
                CommandCompleteRecordDragDropArticleGrid = new DelegateCommand<CompleteRecordDragDropEventArgs>(CompleteRecordDragDropArticleGrid);
                CommandCompleteRecordDragDropDetectionGrid = new DelegateCommand<CompleteRecordDragDropEventArgs>(CompleteRecordDragDropDetectionGrid);
                DeleteArticleCommand = new DelegateCommand<object>(DeleteArticleCommandAction);
                DeleteDetectionCommand = new DelegateCommand<object>(DeleteDetectionCommandAction);
                RuleValueChangedCommand = new DelegateCommand<object>(RuleValueChangedCommandAction);
                RuleValueChangedDetectionCommand = new DelegateCommand<object>(RuleValueDetectionChangedCommandAction);
                CalculateArticleCostCommand = new DelegateCommand<object>(CalculateArticleCostCommandAction);
                ExportToExcelCommand = new DelegateCommand<object>(ExportToExcel);
                ExportToExcelPriceListDetailsCommand = new DelegateCommand<object>(ExportToExcelPriceListDetails);
                AllButtonCommand = new DelegateCommand<object>(AllButtonClickAction);
                PlantCurrencyCheckBoxCellValueChangingCommand = new DelegateCommand<object>(PlantCurrencyCheckBoxCellValueChangingCommandAction);

                DuplicateBasePriceCommand = new DelegateCommand<object>(DuplicateBasePriceCommandAction);

                addAllModuleViewCommand = new DelegateCommand<object>(addAllModuleViewCommandAction);//[sudhir.jangra][01/12/2022][GEOS2-2855][Add All button added]
                addAllArticleViewCommand = new DelegateCommand<object>(addAllArticleViewCommandAction);//[sudhir.jangra][01/12/2022][GEOS2-2855][Add All button added]
                addAllDetectionViewCommand = new DelegateCommand<object>(addAllDetectionViewCommandAction);//[sudhir.jangra][01/12/2022][GEOS2-2855][Add All button added]
                                                                                                           //[nsatpute][GEOS2-7894][01.08.2025]
                ArticleGridControlLoadedCommand = new DelegateCommand<object>(async (obj) => ArticleGridControlLoadedAction(obj));
                DetectionGridControlLoadedCommand = new DelegateCommand<object>(async (obj) => DetectionGridControlLoadedAction(obj));
                ArticleItemListTableViewLoadedCommand = new DelegateCommand<object>(ArticleItemListTableViewLoadedAction);
                DetectionItemListTableViewLoadedCommand = new DelegateCommand<object>(DetectionItemListTableViewLoadedAction);

                ShowingEditorCommand = new DelegateCommand<object>(ShowingEditorCommandAction);
                PastingFromClipBoardCommond = new DelegateCommand<object>(PastingFromClipBoardCommondAction);
                PastingFromClipBoardDetectionCommond = new DelegateCommand<object>(PastingFromClipBoardDetectionCommondAction);
                //[nsatpute][GEOS2-7894][01.08.2025]
                ArticleGridControlUnloadedCommand = new DelegateCommand<object>(async (obj) => ArticleGridControlUnloadedAction(obj));
                DetectionGridControlUnloadedCommand = new DelegateCommand<object>(async (obj) => DetectionGridControlUnloadedAction(obj));
                PasteInSearchControlCommand = new DelegateCommand<object>(PasteInSearchControlCommandAction);
                DeleteFileCommand = new DelegateCommand<object>(DelateAttachmentFile);
                AddFileCommand = new DelegateCommand<object>(AddFile);
                EditFileCommand = new DelegateCommand<object>(EditFile);
                SaveButtonCommand = new DelegateCommand(SaveButtonCommandAction);
                ChangeStatusCommand = new DelegateCommand<object>(ChangeStatusCommandAction);
                ChangeEffectiveDateCommand = new DelegateCommand(ChangeEffectiveDateCommandAction);
                ChangeExpiryDateCommand = new DelegateCommand(ChangeExpiryDateCommandAction);
                ChangeCheckAllLanguagesCommand = new DelegateCommand(ChangeCheckAllLanguagesCommandAction);
                EditArticleCommand = new RelayCommand(new Action<object>(EditArticleAction));
                DetectionsDoubleClickCommand = new RelayCommand(new Action<object>(EditDetectionItem));
                OpenPDFDocumentCommand = new RelayCommand(new Action<object>(OpenPDFDocument));

                AddCommentsCommand = new RelayCommand(new Action<object>(AddCommentsCommandAction));//[Sudhir.Jangra][GEOS2-4935]
                DeleteCommentRowCommand = new RelayCommand(new Action<object>(DeleteCommentRowCommandAction));//[Sudhir.Jangra][GEOS2-4935]
                CommentsGridDoubleClickCommand = new RelayCommand(new Action<object>(CommentDoubleClickCommandAction));//[Sudhir.Jangra][GEOS2-4935]


                SaveButtonVisibility = Visibility.Visible;

                IsCalculateArticleCostButtonEnabled = false;
                IsCalculated = true;
                isInitializeFirstTime = true;

                if (GeosApplication.Instance.UserSettings != null && GeosApplication.Instance.UserSettings.ContainsKey("PLM_Appearance"))
                {
                    if (string.IsNullOrEmpty(GeosApplication.Instance.UserSettings["PLM_Appearance"].ToString()))
                    {
                        SelectedAppearanceItem = (MaximizedElementPosition)Enum.Parse(typeof(MaximizedElementPosition), "Right", true);
                    }
                    else
                    {
                        SelectedAppearanceItem = (MaximizedElementPosition)Enum.Parse(typeof(MaximizedElementPosition), GeosApplication.Instance.UserSettings["PLM_Appearance"].ToString(), true);
                    }
                }
                else
                {
                    SelectedAppearanceItem = (MaximizedElementPosition)Enum.Parse(typeof(MaximizedElementPosition), "Right", true);
                }
                // shubham[skadam] GEOS2-3272 Custom filters in the BPL and CPL grid [#PLM39] 01 12 2022
                try
                {
                    FilterEditorCreatedCommand = new DelegateCommand<FilterEditorEventArgs>(FilterEditorCreatedCommandAction);
                    CommandShowFilterPopupClick = new DelegateCommand<FilterPopupEventArgs>(CustomShowFilterPopup);
                    CommandFilterStatusTileClick = new DelegateCommand<object>(CommandFilterStatusTileClickAction);
                    CommandTileBarClickDoubleClick = new DelegateCommand<object>(CommandTileBarClickDoubleClickAction);
                    DetectionFilterEditorCreatedCommand = new DelegateCommand<FilterEditorEventArgs>(DetectionFilterEditorCreatedCommandAction);
                    DetectionCommandShowFilterPopupClick = new DelegateCommand<FilterPopupEventArgs>(DetectionCustomShowFilterPopup);
                    DetectionCommandFilterStatusTileClick = new DelegateCommand<object>(DetectionCommandFilterStatusTileClickAction);
                    DetectionCommandTileBarClickDoubleClick = new DelegateCommand<object>(DetectionCommandTileBarClickDoubleClickAction);
                }
                catch (Exception ex)
                {
                }

                try
                {
                    #region  GEOS2-2886
                    CommandOnDragRecordOverModuleGrid = new DelegateCommand<DragRecordOverEventArgs>(OnDragRecordOverModuleGrid);
                    CommandDropRecordModuleGrid = new DelegateCommand<DropRecordEventArgs>(DropRecordModuleGrid);
                    CommandCompleteRecordDragDropModuleGrid = new DelegateCommand<CompleteRecordDragDropEventArgs>(CompleteRecordDragDropModuleGrid);
                    DeleteModuleCommand = new DelegateCommand<object>(DeleteModuleCommandAction);
                    RuleValueChangedModuleCommand = new DelegateCommand<object>(RuleValueModuleChangedCommandAction);
                    //[nsatpute][GEOS2-7894][01.08.2025]
                    ModuleGridControlUnloadedCommand = new DelegateCommand<object>(async (obj) => ModuleGridControlUnloadedAction(obj));
                    PastingFromClipBoardModuleCommond = new DelegateCommand<object>(PastingFromClipBoardModuleCommondAction);
                    ModuleGridControlLoadedCommand = new DelegateCommand<object>(async (obj) => ModuleGridControlLoadedAction(obj));
                    ModulesDoubleClickCommand = new RelayCommand(new Action<object>(EditModuleAction));
                    #endregion
                }
                catch (Exception ex)
                {
                }
                //Shubham[skadam] GEOS2-4424 Need to add "Add ALL" button in module tab in BPL. 29 08 2023
                //Shubham[skadam] GEOS2-4784 Need to add custom filter option in module same as article/detection. 29 08 2023
                //Shubham[skadam] GEOS2-4784 GEOS2-4785 No additional data so remove [0] this in tree menu in article, detection & module  left tree in BPL menu 29 08 2023
                //Shubham[skadam] GEOS2-4786 (JLR) The exported XLS Price List (BPL and CPL) must have the sheet with the modules. 29 08 2023
                //Shubham[skadam] GEOS2-4424 Some changes in  Module tab in BPL (3/3) 28 08 2023
                try
                {
                    ModuleFilterEditorCreatedCommand = new DelegateCommand<FilterEditorEventArgs>(ModuleFilterEditorCreatedCommandAction);
                    ModuleCommandShowFilterPopupClick = new DelegateCommand<FilterPopupEventArgs>(ModuleCustomShowFilterPopup);
                    ModuleCommandFilterStatusTileClick = new DelegateCommand<object>(ModuleCommandFilterStatusTileClickAction);
                    ModuleCommandTileBarClickDoubleClick = new DelegateCommand<object>(ModuleCommandTileBarClickDoubleClickAction);
                }
                catch (Exception ex)
                {

                }
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }

                GeosApplication.Instance.Logger.Log("Constructor AddBasePriceViewModel() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log(string.Format("Error in Constructor AddBasePriceViewModel() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }

        }

        #endregion

        #region Methods

        public void Init(string selectedHeader)
        {
            MaximizedElementPosition = PLMCommon.Instance.SetMaximizedElementPosition();
            ExportPriceListButtonVisibility = Visibility.Hidden;
            SaveMyPreference();

            FillLanguages();
            GetPlants();
            GetCurrencies();
            GetSaleCurrencies_Add();
            GetLatestBasePriceCode();
            FillStatusList();
            FillExchangeRateList();
            FillReferenceView();
            FillDetectionsMenuList();

            AddColumnsToArticleDataTable();
            AddColumnsToDetectionDataTable();
            AddColumnsToModuleDataTable();
            AddEditColumnsToPlantsDataTable();
            FillLogicList();

            FillArticleCostPriceList();
            FillCurrencyConversionList_All();

            IsEnabledAcceptButton = true;
            EffectiveDate = new DateTime(DateTime.Now.Year + 1, 01, 01);
            ExpiryDate = new DateTime(DateTime.Now.Year + 1, 12, 31);
            //Shubham[skadam] GEOS2-2885 [Only Modules ] - Search the Article categories (and sub-categories), Modules and Detection (DOWS) in BPL [3/3][#PLM09]  15 03 2023
            FillModuleMenuList();
            CommentsList = new ObservableCollection<BasePriceLogEntry>();
        }

        private void ChangeCheckAllLanguagesCommandAction()
        {
            if (oldIsCheckedAllLanguages != null && oldIsCheckedAllLanguages != IsCheckedAllLanguages)
            { oldIsCheckedAllLanguages = IsCheckedAllLanguages; if (!isDuplicateCliked) IsEnabledSaveButton = true; }
        }

        //[001][cpatil][GEOS2-3564][23-02-2022]
        private void EditArticleAction(object obj)
        {
            try
            {
                if (GeosApplication.Instance.ActiveUser.UserPermissions.Any(p => p.IdPermission == 33))
                {
                    GeosApplication.Instance.Logger.Log(string.Format("Method EditArticleAction()..."), category: Category.Info, priority: Priority.Low);



                    if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<Views.SplashScreenView>(); }

                    TableView detailView = (TableView)obj;
                    GridControl gridControl = (detailView).Grid;


                    UInt32 idArticle = Convert.ToUInt32(((System.Data.DataRowView)detailView.DataControl.CurrentItem).Row.ItemArray[6]);
                    Emdep.Geos.Modules.PCM.Views.EditPCMArticleView editPCMArticleView = new Emdep.Geos.Modules.PCM.Views.EditPCMArticleView();
                    Emdep.Geos.Modules.PCM.ViewModels.EditPCMArticleViewModel editPCMArticleViewModel = new Emdep.Geos.Modules.PCM.ViewModels.EditPCMArticleViewModel();
                    EventHandler handle = delegate { editPCMArticleView.Close(); };
                    editPCMArticleViewModel.RequestClose += handle;
                    editPCMArticleViewModel.IsNew = false;
                    bool status = IsArticleColumnChooserVisible;
                    IsArticleColumnChooserVisible = false;
                    if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<Views.SplashScreenView>(); }
                    editPCMArticleViewModel.PLMEditInit(idArticle);
                    editPCMArticleView.DataContext = editPCMArticleViewModel;
                    var ownerInfo = (detailView as FrameworkElement);
                    editPCMArticleView.Owner = Window.GetWindow(ownerInfo);
                    if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                    editPCMArticleView.ShowDialog();
                    if (editPCMArticleViewModel.IsSave == true)
                    {
                        ArticleGridValueUpdated(idArticle, editPCMArticleViewModel);
                    }

                    if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }


                    GeosApplication.Instance.Logger.Log(string.Format("Method EditArticleAction()....executed successfully"), category: Category.Info, priority: Priority.Low);
                }
                else
                {
                    CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("PLMEditArticleInformation").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                }
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log(string.Format("Error in method EditArticleAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        //[001][cpatil][GEOS2-3564][23-02-2022]
        private void EditDetectionItem(object obj)
        {
            try
            {
                if (GeosApplication.Instance.ActiveUser.UserPermissions.Any(p => p.IdPermission == 33))
                {
                    GeosApplication.Instance.Logger.Log("Method EditDetectionItem()...", category: Category.Info, priority: Priority.Low);

                    if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }


                    if (obj == null) return;

                    DetectionDetails detections = null;

                    if (obj is TableView)
                    {
                        TableView detailView = (TableView)obj;

                        UInt32 idDetection = Convert.ToUInt32(((System.Data.DataRowView)detailView.DataControl.CurrentItem).Row.ItemArray[6]);
                        string detectionTypeName = Convert.ToString(((System.Data.DataRowView)detailView.DataControl.CurrentItem).Row.ItemArray[2]);
                        UInt32 idDetectionType = 0;
                        //Emdep.Geos.Modules.PCM.Views.EditDetectionView addEditOptionsDetectionsViews = new Emdep.Geos.Modules.PCM.Views.EditDetectionView();
                        //Emdep.Geos.Modules.PCM.ViewModels.EditDetectionViewModel addEditOptionsDetectionsViewModels = new Emdep.Geos.Modules.PCM.ViewModels.EditDetectionViewModel();

                        if (DetectionMenulist.Any(dml => dml.DetectionTypeName == detectionTypeName))
                        {
                            idDetectionType = DetectionMenulist.Where(dml => dml.DetectionTypeName == detectionTypeName).FirstOrDefault().IdDetectionType;
                        }

                        if (idDetection > 0)
                        {
                            bool status = IsDetectionColumnChooserVisible;
                            IsDetectionColumnChooserVisible = false;

                            if (idDetectionType == 2 || idDetectionType == 3)
                            {
                                Emdep.Geos.Modules.PCM.Views.EditDetectionView addEditOptionsDetectionsView = new Emdep.Geos.Modules.PCM.Views.EditDetectionView();
                                Emdep.Geos.Modules.PCM.ViewModels.EditDetectionViewModel addEditOptionsDetectionsViewModel = new Emdep.Geos.Modules.PCM.ViewModels.EditDetectionViewModel();
                                EventHandler handle = delegate { addEditOptionsDetectionsView.Close(); };
                                addEditOptionsDetectionsViewModel.RequestClose += handle;

                                addEditOptionsDetectionsViewModel.IsNew = false;
                                addEditOptionsDetectionsViewModel.IsSelectedTestReadOnly = true;
                                addEditOptionsDetectionsViewModel.IsStackPanelVisible = Visibility.Visible;

                                if (idDetectionType == 2)
                                {
                                    addEditOptionsDetectionsViewModel.WindowHeader = System.Windows.Application.Current.FindResource("EditDetectionHeader").ToString();
                                    addEditOptionsDetectionsViewModel.EditInit(System.Windows.Application.Current.FindResource("CaptionDetections").ToString());
                                    addEditOptionsDetectionsViewModel.PLMEditInitDetections(idDetection);


                                }
                                else if (idDetectionType == 3)
                                {
                                    addEditOptionsDetectionsViewModel.WindowHeader = System.Windows.Application.Current.FindResource("EditOptionHeader").ToString();
                                    addEditOptionsDetectionsViewModel.EditInit(System.Windows.Application.Current.FindResource("CaptionOptions").ToString());
                                    addEditOptionsDetectionsViewModel.PLMEditInitDetections(idDetection);

                                }
                                addEditOptionsDetectionsView.DataContext = addEditOptionsDetectionsViewModel;
                                var ownerInfo = (detailView as FrameworkElement);
                                addEditOptionsDetectionsView.Owner = Window.GetWindow(ownerInfo);
                                addEditOptionsDetectionsView.ShowDialog();

                                if (addEditOptionsDetectionsViewModel.IsWaySave == true || addEditOptionsDetectionsViewModel.IsSparepartSave || addEditOptionsDetectionsViewModel.IsOptionSave || addEditOptionsDetectionsViewModel.IsDetectionSave)
                                {
                                    DetectionGridValueUpdated(idDetection, addEditOptionsDetectionsViewModel);
                                }

                            }

                            else if (idDetectionType == 1 || idDetectionType == 4)
                            {
                                Emdep.Geos.Modules.PCM.Views.EditDetectionView addOptionWayDetectionSparePartView = new Emdep.Geos.Modules.PCM.Views.EditDetectionView();
                                Emdep.Geos.Modules.PCM.ViewModels.EditDetectionViewModel addOptionWayDetectionSparePartViewModel = new Emdep.Geos.Modules.PCM.ViewModels.EditDetectionViewModel();
                                EventHandler handleWaysSparePart = delegate { addOptionWayDetectionSparePartView.Close(); };
                                addOptionWayDetectionSparePartViewModel.RequestClose += handleWaysSparePart;

                                addOptionWayDetectionSparePartViewModel.IsNew = false;
                                //addOptionWayDetectionSparePartViewModel.IsStackPanelVisible = Visibility.Hidden;
                                addOptionWayDetectionSparePartViewModel.IsSelectedTestReadOnly = true;


                                if (idDetectionType == 1)
                                {
                                    addOptionWayDetectionSparePartViewModel.IsStackPanelVisible = Visibility.Hidden;
                                    addOptionWayDetectionSparePartViewModel.WindowHeader = System.Windows.Application.Current.FindResource("EditWayHeader").ToString();
                                    addOptionWayDetectionSparePartViewModel.EditInit(System.Windows.Application.Current.FindResource("CaptionWay").ToString());
                                    addOptionWayDetectionSparePartViewModel.PLMEditInitWaysAndSparepart(idDetection);

                                }

                                else if (idDetectionType == 4)
                                {
                                    addOptionWayDetectionSparePartViewModel.IsStackPanelVisible = Visibility.Visible;
                                    addOptionWayDetectionSparePartViewModel.WindowHeader = System.Windows.Application.Current.FindResource("EditSparePartHeader").ToString();
                                    addOptionWayDetectionSparePartViewModel.EditInit(System.Windows.Application.Current.FindResource("CaptionSpareParts").ToString());
                                    addOptionWayDetectionSparePartViewModel.PLMEditInitWaysAndSparepart(idDetection);
                                }
                                addOptionWayDetectionSparePartView.DataContext = addOptionWayDetectionSparePartViewModel;
                                var ownerInfo = (detailView as FrameworkElement);
                                addOptionWayDetectionSparePartView.Owner = Window.GetWindow(ownerInfo);
                                addOptionWayDetectionSparePartView.ShowDialog();

                                if (addOptionWayDetectionSparePartViewModel.IsSparepartSave || addOptionWayDetectionSparePartViewModel.IsDetectionSave || addOptionWayDetectionSparePartViewModel.IsWaySave || addOptionWayDetectionSparePartViewModel.IsOptionSave)
                                {
                                    DetectionGridValueUpdated(idDetection, addOptionWayDetectionSparePartViewModel);
                                }
                            }

                        }


                    }

                    if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                    // FillDetectionData();
                    GeosApplication.Instance.Logger.Log("Method EditDetectionItem()....executed successfully", category: Category.Info, priority: Priority.Low);
                }
                else
                {
                    CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("PLMEditArticleInformation").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                }
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method EditDetectionItem()..", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void EditModuleAction(object obj)
        {
            try
            {
                if (GeosApplication.Instance.ActiveUser.UserPermissions.Any(p => p.IdPermission == 33))
                {
                    GeosApplication.Instance.Logger.Log(string.Format("Method EditModuleAction()..."), category: Category.Info, priority: Priority.Low);
                    if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<Views.SplashScreenView>(); }

                    TableView detailView = (TableView)obj;
                    GridControl gridControl = (detailView).Grid;

                    DataRowView dr = (System.Data.DataRowView)detailView.DataControl.CurrentItem;
                    int IdCPType = Convert.ToInt32(dr.Row["IdCPType"].ToString());
                    string Template = Convert.ToString(dr.Row["Type"].ToString());
                    BasePriceListByItem basePriceListByItem = ModuleList.Where(w => w.IdCPType == IdCPType).FirstOrDefault();
                    int IdTemplate = 0;
                    if (basePriceListByItem == null)
                    {
                        IdTemplate = ModuleMenulist.FirstOrDefault(f => f.IdCPType == Convert.ToUInt64(IdCPType)).IdTemplate;
                    }
                    else
                    {
                        IdTemplate = basePriceListByItem.ProductType.Template.IdTemplate;
                    }
                    Emdep.Geos.Modules.PCM.Views.ProductTypeView productTypeView = new Emdep.Geos.Modules.PCM.Views.ProductTypeView();
                    Emdep.Geos.Modules.PCM.ViewModels.ProductTypeViewModel productTypeViewModel = new Emdep.Geos.Modules.PCM.ViewModels.ProductTypeViewModel();
                    PCM.Views.EditProductTypeView editProductTypeView = new PCM.Views.EditProductTypeView();
                    EditProductTypeViewModel editProductTypeViewModel = new EditProductTypeViewModel();
                    EventHandler handle = delegate { editProductTypeView.Close(); };
                    editProductTypeViewModel.RequestClose += handle;
                    editProductTypeView.DataContext = editProductTypeViewModel;

                    editProductTypeViewModel.ProductTypeItem = new ProductTypes();

                    editProductTypeViewModel.ProductTypeItem.IdCPType = (ulong)IdCPType;
                    editProductTypeViewModel.ProductTypeItem.IdTemplate = (byte)IdTemplate;
                    int IdScope = 1635;
                    editProductTypeViewModel.Init(IdScope);
                    editProductTypeViewModel.SelectedTemplate = editProductTypeViewModel.TemplatesMenuList.FirstOrDefault(x => x.IdTemplate == IdTemplate);
                    var ownerInfo = (detailView as FrameworkElement);
                    editProductTypeView.Owner = Window.GetWindow(ownerInfo);
                    editProductTypeViewModel.isEnabledCancelButton = false;
                    editProductTypeView.ShowDialog();
                    if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                    GeosApplication.Instance.Logger.Log(string.Format("Method EditModuleAction()....executed successfully"), category: Category.Info, priority: Priority.Low);
                }
                else
                {
                    CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("PLMEditModulesInformation").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                }
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log(string.Format("Error in method EditModuleAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        //[001][cpatil][GEOS2-3331][26-10-2021]
        private async void AcceptButtonCommandAction(object obj)
        {
            GeosApplication.Instance.Logger.Log(string.Format("Method AcceptButtonCommandAction()..."), category: Category.Info, priority: Priority.Low);
            try
            {
                InformationError = null;
                string error = EnableValidationAndGetError();
                PropertyChanged(this, new PropertyChangedEventArgs("Name"));
                if (string.IsNullOrEmpty(error))
                    InformationError = null;
                else
                    InformationError = "";

                if (error != null)
                {
                    return;
                }


                if (SelectedPlant.Count == 0)
                {
                    CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("PlantMandatoryValidationBPL").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                    GeosApplication.Instance.Logger.Log("Method AcceptButtonCommandAction()...atleast one plant.", category: Category.Info, priority: Priority.Low);
                    return;
                }
                if (selectedSaleCurrency.Count == 0)
                {
                    CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("CurrencyMandatoryValidationBPL").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                    GeosApplication.Instance.Logger.Log("Method AcceptButtonCommandAction()...atleast one sale price.", category: Category.Info, priority: Priority.Low);
                    return;
                }
                if (EffectiveDate > ExpiryDate)
                {
                    CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("EffectiveAndExpiryValidationBPL").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                    GeosApplication.Instance.Logger.Log("Method AcceptButtonCommandAction()...Expiry date must be equal or greater than effective date.", category: Category.Info, priority: Priority.Low);
                    return;
                }
                if (PlantCurrencyListWithIsChecked != null && PlantCurrencyListWithIsChecked.Count > 0)
                {
                    if (PlantCurrencyListWithIsChecked.Any(x => x.CurrenciesName == null || x.CurrenciesName == string.Empty))
                    {
                        BasePriceListByPlantCurrency bpl = PlantCurrencyListWithIsChecked.Where(x => x.CurrenciesName == null || x.CurrenciesName == string.Empty).FirstOrDefault();
                        CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("BasePriceCurrenciesNotSelected").ToString(), bpl.PlantName), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                        return;
                    }
                }
                if (IsNew)
                {
                    #region New
                    NewBasePrice = new BasePrice();

                    //if ((!IsCalculated))
                    //{
                    //    CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("CalculationIsMandatory").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                    //    return;
                    //}
                    if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }

                    if (IsCheckedAllLanguages == true)
                    {
                        NewBasePrice.Name = Name;
                        NewBasePrice.Name_es = Name;
                        NewBasePrice.Name_fr = Name;
                        NewBasePrice.Name_pt = Name;
                        NewBasePrice.Name_ro = Name;
                        NewBasePrice.Name_ru = Name;
                        NewBasePrice.Name_zh = Name;
                        NewBasePrice.Description = Description == null ? "" : Description;
                        NewBasePrice.Description_es = Description == null ? "" : Description;
                        NewBasePrice.Description_fr = Description == null ? "" : Description;
                        NewBasePrice.Description_pt = Description == null ? "" : Description;
                        NewBasePrice.Description_ro = Description == null ? "" : Description;
                        NewBasePrice.Description_ru = Description == null ? "" : Description;
                        NewBasePrice.Description_zh = Description == null ? "" : Description == null ? "" : Description;
                        NewBasePrice.Remark = Remark == null ? "" : Remark;
                        NewBasePrice.Remark_es = Remark == null ? "" : Remark;
                        NewBasePrice.Remark_fr = Remark == null ? "" : Remark;
                        NewBasePrice.Remark_pt = Remark == null ? "" : Remark;
                        NewBasePrice.Remark_ro = Remark == null ? "" : Remark;
                        NewBasePrice.Remark_ru = Remark == null ? "" : Remark;
                        NewBasePrice.Remark_zh = Remark == null ? "" : Remark;
                    }
                    else
                    {
                        NewBasePrice.Name = Name_en == null ? "" : Name_en;
                        NewBasePrice.Name_es = Name_es == null ? "" : Name_es;
                        NewBasePrice.Name_fr = Name_fr == null ? "" : Name_fr;
                        NewBasePrice.Name_pt = Name_pt == null ? "" : Name_pt;
                        NewBasePrice.Name_ro = Name_ro == null ? "" : Name_ro;
                        NewBasePrice.Name_ru = Name_ru == null ? "" : Name_ru;
                        NewBasePrice.Name_zh = Name_zh == null ? "" : Name_zh;
                        NewBasePrice.Description = Description_en == null ? "" : Description_en;
                        NewBasePrice.Description_es = Description_es == null ? "" : Description_es;
                        NewBasePrice.Description_fr = Description_fr == null ? "" : Description_fr;
                        NewBasePrice.Description_pt = Description_pt == null ? "" : Description_pt;
                        NewBasePrice.Description_ro = Description_ro == null ? "" : Description_ro;
                        NewBasePrice.Description_ru = Description_ru == null ? "" : Description_ru;
                        NewBasePrice.Description_zh = Description_zh == null ? "" : Description_zh;
                        NewBasePrice.Remark = Remark == null ? "" : Remark;
                        NewBasePrice.Remark_es = Remark_es == null ? "" : Remark_es;
                        NewBasePrice.Remark_fr = Remark_fr == null ? "" : Remark_fr;
                        NewBasePrice.Remark_pt = Remark_pt == null ? "" : Remark_pt;
                        NewBasePrice.Remark_ro = Remark_ro == null ? "" : Remark_ro;
                        NewBasePrice.Remark_ru = Remark_ru == null ? "" : Remark_ru;
                        NewBasePrice.Remark_zh = Remark_zh == null ? "" : Remark_zh;
                    }

                    NewBasePrice.Code = SelectedBasePriceCode;

                    if (ExpiryDate != null)
                        NewBasePrice.ExpiryDate = Convert.ToDateTime(ExpiryDate);

                    if (EffectiveDate != null)
                        NewBasePrice.EffectiveDate = Convert.ToDateTime(EffectiveDate);

                    NewBasePrice.IdStatus = (uint)SelectedStatus.IdLookupValue;
                    NewBasePrice.IdExchangeRateUpdateType = (int)SelectedExchangeRate.IdLookupValue;
                    NewBasePrice.IdCurrency = ((Currency)SelectedCurrency).IdCurrency;
                    NewBasePrice.PlantList = new List<Site>();
                    NewBasePrice.CurrencyList = new List<Currency>();
                    foreach (Site site in SelectedPlant)
                    {
                        NewBasePrice.PlantList.Add(site);
                    }
                    foreach (Currency cur in SelectedSaleCurrency)
                    {
                        NewBasePrice.CurrencyList.Add(cur);
                    }
                    NewBasePrice.BasePriceListItems = new List<BasePriceListByItem>();

                    NewBasePrice.PlantCurrencyList = new List<BasePriceListByPlantCurrency>();

                    if (DtArticle == null)
                    {
                        DtArticle = new DataTable();
                    }

                    List<BasePriceListByItem> ArticleListFor_Save = new List<BasePriceListByItem>();
                    foreach (DataRow row in DtArticle.Rows)
                    {

                        BasePriceListByItem basePriceListByItem = new BasePriceListByItem();
                        basePriceListByItem.IdArticle = Convert.ToUInt64(row["IdArticle"]);
                        if (row["MaxCost_1"] != null && row["MaxCost_1"] != "" && row["MaxCost_1"] != DBNull.Value)
                            basePriceListByItem.MaxCost = float.Parse(row["MaxCost_1"].ToString());
                        basePriceListByItem.IdRule = Convert.ToInt32(row["Logic"]);
                        if (row["Value"] != null && row["Value"] != "" && row["value"] != DBNull.Value)
                            basePriceListByItem.RuleValue = float.Parse(row["Value"].ToString());
                        basePriceListByItem.Version = 1;
                        if (row["CurrencyConversionDate"] != DBNull.Value && row["CurrencyConversionDate"] != "" && row["CurrencyConversionDate"] != null)
                            basePriceListByItem.CurrencyConversionDate_New = Convert.ToDateTime(row["CurrencyConversionDate"]);

                        ArticleListFor_Save.Add(basePriceListByItem);
                    }

                    NewBasePrice.BasePriceListItems = ArticleListFor_Save;

                    if (DtDetection == null)
                    {
                        DtDetection = new DataTable();
                    }

                    List<BasePriceListByItem> DetectionListFor_Save = new List<BasePriceListByItem>();
                    foreach (DataRow row in DtDetection.Rows)
                    {
                        BasePriceListByItem basePriceListByItem = new BasePriceListByItem();
                        basePriceListByItem.IdDetection = Convert.ToUInt32(row["IdDetection"]);
                        if (row["MaxCost_1"] != null && row["MaxCost_1"] != "" && row["MaxCost_1"] != DBNull.Value)
                            basePriceListByItem.MaxCost = float.Parse(row["MaxCost_1"].ToString());
                        basePriceListByItem.IdRule = Convert.ToInt32(row["Logic"]);
                        if (row["Value"] != null && row["Value"] != "" && row["value"] != DBNull.Value)
                            basePriceListByItem.RuleValue = float.Parse(row["Value"].ToString());
                        basePriceListByItem.Version = 1;

                        if (row["CurrencyConversionDate"] != DBNull.Value && row["CurrencyConversionDate"] != "" && row["CurrencyConversionDate"] != null)
                            basePriceListByItem.CurrencyConversionDate_New = Convert.ToDateTime(row["CurrencyConversionDate"]);

                        DetectionListFor_Save.Add(basePriceListByItem);
                    }

                    NewBasePrice.AddDetectionList = DetectionListFor_Save;

                    #region GEOS2-2886
                    //Shubham[skadam] GEOS2-2886 [Only Modules ] - Able to  add and access to the tab Modules/Detection /Articles a Base Price List [3/3] [#PLM07] 28 03 2023
                    try
                    {
                        if (DtModule == null)
                        {
                            DtModule = new DataTable();
                        }
                        List<BasePriceListByItem> ModuleListFor_Save = new List<BasePriceListByItem>();
                        foreach (DataRow row in DtModule.Rows)
                        {
                            BasePriceListByItem basePriceListByItem = new BasePriceListByItem();
                            basePriceListByItem.IdCPType = Convert.ToUInt32(row["IdCPType"]);
                            if (row["MaxCost_1"] != null && row["MaxCost_1"] != "" && row["MaxCost_1"] != DBNull.Value)
                                basePriceListByItem.MaxCost = float.Parse(row["MaxCost_1"].ToString());
                            basePriceListByItem.IdRule = Convert.ToInt32(row["Logic"]);
                            if (row["Value"] != null && row["Value"] != "" && row["value"] != DBNull.Value)
                                basePriceListByItem.RuleValue = float.Parse(row["Value"].ToString());
                            basePriceListByItem.Version = 1;

                            if (row["CurrencyConversionDate"] != DBNull.Value && row["CurrencyConversionDate"] != "" && row["CurrencyConversionDate"] != null)
                                basePriceListByItem.CurrencyConversionDate_New = Convert.ToDateTime(row["CurrencyConversionDate"]);

                            ModuleListFor_Save.Add(basePriceListByItem);
                        }
                        NewBasePrice.AddModuleList = ModuleListFor_Save;
                    }
                    catch (Exception)
                    {
                    }
                    #endregion
                    if (Dttable == null)
                    {
                        Dttable = new DataTable();
                    }
                    List<BasePriceListByPlantCurrency> BPLPlantCurrencyList1 = new List<BasePriceListByPlantCurrency>();
                    foreach (DataRow row1 in Dttable.Rows)
                    {
                        BasePriceListByPlantCurrency BPLPlantCurrency = new BasePriceListByPlantCurrency();
                        BPLPlantCurrency.IdPlant = SelectedPlant.Cast<Site>().Where(a => a.Name == row1["Plant"].ToString()).Select(x => x.IdSite).FirstOrDefault();
                        if (SelectedPlant.Cast<Site>().Any(x => x.Name == row1["Plant"].ToString()))
                        {
                            foreach (Currency cur in SelectedSaleCurrency)
                            {
                                BasePriceListByPlantCurrency BPLPlantCurrency1 = new BasePriceListByPlantCurrency()
                                {
                                    CurrencyName = cur.Name,
                                    IdCurrency = cur.IdCurrency,
                                    PlantName = row1["Plant"].ToString(),
                                    IdPlant = SelectedPlant.Cast<Site>().Where(a => a.Name == row1["Plant"].ToString()).Select(x => x.IdSite).FirstOrDefault(),
                                    PlantbyCurrency = Convert.ToByte(row1[cur.Name]),
                                    TransactionOperation = ModelBase.TransactionOperations.Add
                                };

                                BPLPlantCurrencyList1.Add(BPLPlantCurrency1);
                            }
                        }
                    }
                    NewBasePrice.PlantCurrencyList = BPLPlantCurrencyList1;

                    NewBasePrice.CreationDate = DateTime.Now;
                    NewBasePrice.IdCreator = (uint)GeosApplication.Instance.ActiveUser.IdUser;

                    BasePriceLogEntry tempBasePriceLogEntry = new BasePriceLogEntry();
                    tempBasePriceLogEntry.IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser;
                    tempBasePriceLogEntry.UserName = GeosApplication.Instance.ActiveUser.FullName;
                    tempBasePriceLogEntry.Datetime = GeosApplication.Instance.ServerDateTime;
                    tempBasePriceLogEntry.Comments = string.Format(System.Windows.Application.Current.FindResource("BasePriceChnageLog").ToString(), NewBasePrice.Name.Trim());

                    BasePriceChangeLogList = new ObservableCollection<BasePriceLogEntry>();
                    BasePriceChangeLogList.Add(tempBasePriceLogEntry);
                    AddChangeLogList(BPLPlantCurrencyList1);



                    #region GEOS2-4935
                    //foreach (var item in CommentsList)
                    //{
                    //    BasePriceChangeLogList.Add(new BasePriceLogEntry()
                    //    {
                    //        IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser,
                    //        Datetime = GeosApplication.Instance.ServerDateTime,
                    //        UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName,
                    //        Comments = string.Format(System.Windows.Application.Current.FindResource("BasePriceChangeLogForComment").ToString(),
                    //           item.Comments)

                    //    });
                    //}

                    #endregion
                    NewBasePrice.BasePriceCommentsList = CommentsList.ToList();
                    NewBasePrice.BasePriceCommentsList.ForEach(x => x.People.OwnerImage = null);

                    NewBasePrice.LogList = BasePriceChangeLogList.ToList();

                    if (isDuplicateCliked)
                    {
                        BasePriceLogEntry tempBasePriceLogEntry_new = new BasePriceLogEntry();
                        tempBasePriceLogEntry_new.IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser;
                        tempBasePriceLogEntry_new.UserName = GeosApplication.Instance.ActiveUser.FullName;
                        tempBasePriceLogEntry_new.Datetime = GeosApplication.Instance.ServerDateTime;
                        tempBasePriceLogEntry_new.Comments = string.Format(System.Windows.Application.Current.FindResource("BasePriceChnageLogDuplicated").ToString(), NewBasePrice.Code.Trim(), NewBasePrice.Name.Trim(), BasePriceOldCode.Trim(), ClonedBasePrice.Name.Trim());

                        BasePriceChangeLogList = new ObservableCollection<BasePriceLogEntry>();
                        BasePriceChangeLogList.Add(tempBasePriceLogEntry_new);
                        NewBasePrice.LogList = BasePriceChangeLogList.ToList();

                        IsDuplicateSave = true;
                        //CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("BasePriceDuplicatedSuccess").ToString()), Application.Current.Resources["PopUpSuccessColor"].ToString(), CustomMessageBox.MessageImagePath.Ok, MessageBoxButton.OK);
                    }
                    else
                    {
                        IsDuplicateSave = false;
                    }

                    if (NewBasePrice.CurrencyList != null)
                        NewBasePrice.CurrencyList.ForEach(x => x.CurrencyIconImage = null);
                    if (NewBasePrice.CurrencyList_Cloned != null)
                        NewBasePrice.CurrencyList_Cloned.ForEach(x => x.CurrencyIconImage = null);
                    if (NewBasePrice.AddCurrencyList != null)
                        NewBasePrice.AddCurrencyList.ForEach(x => x.CurrencyIconImage = null);
                    if (NewBasePrice.UpdateCurrencyList != null)
                        NewBasePrice.UpdateCurrencyList.ForEach(x => x.CurrencyIconImage = null);

                    /// Attchment Files
                    NewBasePrice.PLMArticleAttachmentList = new List<BPLDocument>();

                    // Delete Article Attachment file
                    //foreach (BPLDocument item in ClonedBasePrice.PLMArticleAttachmentList)
                    //{

                    //    if (OptionWayDetectionSparePartFilesList != null && !OptionWayDetectionSparePartFilesList.Any(x => x.IdBasepricedoc == item.IdBasepricedoc))
                    //    {
                    //        BPLDocument bplDoc = (BPLDocument)item.Clone();
                    //        bplDoc.TransactionOperation = ModelBase.TransactionOperations.Delete;
                    //        NewBasePrice.PLMArticleAttachmentList.Add(bplDoc);
                    //        BasePriceChangeLogList.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("PCMArticleChangeLogFilesDelete").ToString(), item.OriginalFileName) });
                    //    }
                    //}

                    //Added Article Attachment file
                    // OptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>();
                    #region GEOS2-2889
                    //Shubham[skadam] GEOS2-2889 [ Modules + Attachments ]- Duplicate the base price list [#PLM05] 24 04 2023
                    if (IsDuplicated)
                    {
                        if (DuplicatedPLMArticleAttachmentList == null)
                        {
                            DuplicatedPLMArticleAttachmentList = new List<BPLDocument>();
                        }
                        foreach (BPLDocument item in DuplicatedPLMArticleAttachmentList)
                        {
                            BPLDocument bplDoc = (BPLDocument)item.Clone();
                            bplDoc.TransactionOperation = ModelBase.TransactionOperations.Add;
                            NewBasePrice.PLMArticleAttachmentList.Add(bplDoc);
                            BasePriceLogEntry testBasePriceLogEntry = new BasePriceLogEntry();
                            testBasePriceLogEntry.IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser;
                            testBasePriceLogEntry.UserName = GeosApplication.Instance.ActiveUser.FullName;
                            testBasePriceLogEntry.Datetime = GeosApplication.Instance.ServerDateTime;
                            testBasePriceLogEntry.Comments = string.Format(System.Windows.Application.Current.FindResource("PCMArticleChangeLogFilesAdd").ToString(), item.OriginalFileName);
                            BasePriceChangeLogList.Add(testBasePriceLogEntry);
                            NewBasePrice.LogList = BasePriceChangeLogList.ToList();
                            IsDuplicated = false;
                        }
                    }
                    #endregion
                    else
                    {
                        if (OptionWayDetectionSparePartFilesList != null)
                        {
                            foreach (BPLDocument item in OptionWayDetectionSparePartFilesList)
                            {
                                //if (!ClonedBasePrice.PLMArticleAttachmentList.Any(x => x.IdBasepricedoc == item.IdBasepricedoc))
                                //{

                                BPLDocument bplDoc = (BPLDocument)item.Clone();
                                bplDoc.TransactionOperation = ModelBase.TransactionOperations.Add;
                                NewBasePrice.PLMArticleAttachmentList.Add(bplDoc);
                                //  ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("PCMArticleChangeLogFilesAdd").ToString(), item.OriginalFileName) });
                                //}

                                BasePriceLogEntry testBasePriceLogEntry = new BasePriceLogEntry();
                                testBasePriceLogEntry.IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser;
                                testBasePriceLogEntry.UserName = GeosApplication.Instance.ActiveUser.FullName;
                                testBasePriceLogEntry.Datetime = GeosApplication.Instance.ServerDateTime;
                                testBasePriceLogEntry.Comments = string.Format(System.Windows.Application.Current.FindResource("PCMArticleChangeLogFilesAdd").ToString(), item.OriginalFileName);
                                BasePriceChangeLogList.Add(testBasePriceLogEntry);
                                NewBasePrice.LogList = BasePriceChangeLogList.ToList();
                            }
                        }
                    }
                    // NewBasePrice = PLMService.AddBasePrice_V2150(NewBasePrice);
                    //NewBasePrice = PLMService.AddBasePrice_V2340(NewBasePrice);
                    //Shubham[skadam] GEOS2-2886 [Only Modules ] - Able to  add and access to the tab Modules/Detection /Articles a Base Price List [3/3] [#PLM07] 28 03 2023
                    //  NewBasePrice = PLMService.AddBasePrice_V2370(NewBasePrice);

                    //[Sudhir.Jangra][GEOS2-4935]
                    NewBasePrice = PLMService.AddBasePrice_V2470(NewBasePrice);



                    if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }

                    CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("BasePriceAddedSuccess").ToString()), Application.Current.Resources["PopUpSuccessColor"].ToString(), CustomMessageBox.MessageImagePath.Ok, MessageBoxButton.OK);
                    IsNewBasePriceSave = true;
                    IsUpdatedBasePriceSave = false;
                    IsDuplicated = false;
                    DuplicatedPLMArticleAttachmentList = new List<BPLDocument>();
                    #region synchronization
                    //[001] Added code for synchronization
                    if (GeosApplication.Instance.IsPLMPermissionNameECOS_Synchronization == true)
                    {
                        GeosAppSettingList = WorkbenchService.GetSelectedGeosAppSettings("59,60,61");
                        if (GeosAppSettingList != null && GeosAppSettingList.Count != 0)
                        {
                            if (GeosAppSettingList.Any(i => i.IdAppSetting == 59) && GeosAppSettingList.Any(i => i.IdAppSetting == 60) && GeosAppSettingList.Any(i => i.IdAppSetting == 61) && NewBasePrice.IdStatus == 223)
                            {
                                if ((!string.IsNullOrEmpty((GeosAppSettingList[0].DefaultValue))) && (!string.IsNullOrEmpty((GeosAppSettingList[1].DefaultValue))) && (!string.IsNullOrEmpty((GeosAppSettingList[2].DefaultValue))))    //(!string.IsNullOrEmpty((GeosAppSettingList[0].DefaultValue))) // && (GeosAppSettingList[1].DefaultValue)))  //.Where(i => i.IdAppSetting == 57).Select(x => x.DefaultValue)))) // && (GeosAppSettingList[1].DefaultValue))) // Where(i => i.IdAppSetting == 57).FirstOrDefault().DefaultValue.to)
                                {
                                    #region synchronization Code
                                    try
                                    {
                                        MessageBoxResult MessageBoxResult = MessageBoxResult = CustomMessageBox.Show(string.Format(Application.Current.Resources["ECOSSynchronizationWarningMessage"].ToString()), "Yellow", CustomMessageBox.MessageImagePath.Warning, MessageBoxButton.YesNo);
                                        if (MessageBoxResult == MessageBoxResult.Yes)
                                        {

                                            if (!DXSplashScreen.IsActive)
                                            {
                                                DXSplashScreen.Show(x =>
                                                {
                                                    Window win = new Window()
                                                    {
                                                        Focusable = true,
                                                        ShowActivated = false,
                                                        WindowStyle = WindowStyle.None,
                                                        ResizeMode = ResizeMode.NoResize,
                                                        AllowsTransparency = false,
                                                        Background = new SolidColorBrush(Colors.Transparent),
                                                        ShowInTaskbar = false,
                                                        Topmost = false,
                                                        SizeToContent = SizeToContent.WidthAndHeight,
                                                        WindowStartupLocation = WindowStartupLocation.CenterScreen,
                                                    };
                                                    WindowFadeAnimationBehavior.SetEnableAnimation(win, true);
                                                    return win;
                                                }, x =>
                                                {
                                                    return new SplashScreenView() { DataContext = new SplashScreenViewModel() };
                                                }, null, null);
                                            }
                                            GeosApplication.Instance.SplashScreenMessage = "Synchronization is running";
                                            APIErrorDetailForErrorFalse valuesErrorFalse = new APIErrorDetailForErrorFalse();
                                            APIErrorDetail values = new APIErrorDetail();
                                            List<ErrorDetails> LstErrorDetail = new List<ErrorDetails>();
                                            tokenService = new AuthTokenService();
                                            if (GeosAppSettingList.Any(i => i.IdAppSetting == 59))
                                            {
                                                string[] tokeninformations = GeosAppSettingList.Where(i => i.IdAppSetting == 59).FirstOrDefault().DefaultValue.Split(';');
                                                if (tokeninformations.Count() >= 2)
                                                {

                                                    if (NewBasePrice.BasePriceListItems != null && NewBasePrice.BasePriceListItems.Count > 0 && DtArticle != null && DtArticle.Rows.Count > 0)
                                                    {

                                                        string references = string.Join(",", DtArticle.AsEnumerable().Select(s => s.Field<string>("Reference")).ToList());

                                                        if (GeosAppSettingList.Any(i => i.IdAppSetting == 61))
                                                        {

                                                            foreach (BasePriceListByPlantCurrency itemPlantCurrency in NewBasePrice.PlantCurrencyList.Where(i => i.PlantbyCurrency == 1).Distinct())
                                                            {
                                                                List<ErrorDetails> TempLstErrorDetail = await PLMService.IsPLMAddEditBasePriceSynchronization(GeosAppSettingList, itemPlantCurrency, DtArticle);

                                                                foreach (ErrorDetails item in TempLstErrorDetail)
                                                                {
                                                                    if (item != null && item.Error == string.Empty)
                                                                    {
                                                                        GeosApplication.Instance.SplashScreenMessage = "Articles Synchronization is Done for plant " + itemPlantCurrency.PlantName + " and currency " + itemPlantCurrency.CurrencyName + "";
                                                                    }
                                                                    else
                                                                    {
                                                                        if (item != null && item.Error != null)
                                                                        {
                                                                            GeosApplication.Instance.SplashScreenMessage = "Articles Synchronization is failed for plant " + itemPlantCurrency.PlantName + " and currency " + itemPlantCurrency.CurrencyName + "";
                                                                            ErrorDetails errorDetails = new ErrorDetails();
                                                                            errorDetails.CompanyName = itemPlantCurrency.PlantName;
                                                                            errorDetails.CurrencyName = itemPlantCurrency.CurrencyName;
                                                                            errorDetails.Error = values.Message._Message;
                                                                            LstErrorDetail.Add(errorDetails);
                                                                        }
                                                                    }
                                                                }

                                                            }
                                                        }
                                                    }
                                                    if (NewBasePrice.AddDetectionList != null && NewBasePrice.AddDetectionList.Count > 0)
                                                    {
                                                        if (GeosAppSettingList.Any(i => i.IdAppSetting == 60))
                                                        {
                                                            foreach (BasePriceListByPlantCurrency itemPlantCurrency in NewBasePrice.PlantCurrencyList.Where(i => i.PlantbyCurrency == 1).Distinct())
                                                            {

                                                                List<ErrorDetails> TempLstErrorDetail = await PLMService.IsPLMAddEditBasePriceSynchronization(GeosAppSettingList, itemPlantCurrency, DtArticle);
                                                                foreach (ErrorDetails item in TempLstErrorDetail)
                                                                {
                                                                    if (item != null && item.Error == string.Empty)
                                                                    {
                                                                        GeosApplication.Instance.SplashScreenMessage = "Detections Synchronization is done for plant " + itemPlantCurrency.PlantName + " and currency " + itemPlantCurrency.CurrencyName + "";
                                                                    }
                                                                    else
                                                                    {
                                                                        if (item != null && item.Error != null)
                                                                        {
                                                                            GeosApplication.Instance.SplashScreenMessage = "Detections Synchronization is failed for plant " + itemPlantCurrency.PlantName + " and currency " + itemPlantCurrency.CurrencyName + "";
                                                                            ErrorDetails errorDetails = new ErrorDetails();
                                                                            errorDetails.CompanyName = itemPlantCurrency.PlantName;
                                                                            errorDetails.CurrencyName = itemPlantCurrency.CurrencyName;
                                                                            errorDetails.Error = values.Message._Message;
                                                                            LstErrorDetail.Add(errorDetails);
                                                                        }
                                                                    }
                                                                }

                                                            }


                                                        }
                                                    }
                                                    if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                                                    if (LstErrorDetail != null && LstErrorDetail.Count > 0)
                                                    {
                                                        String FinalMessage = null;
                                                        string msg = string.Empty;
                                                        foreach (ErrorDetails item in LstErrorDetail)
                                                        {

                                                            if (string.IsNullOrEmpty(FinalMessage))
                                                                FinalMessage = string.Format(System.Windows.Application.Current.FindResource("PLMSynchronizationFailedForFollowingReasons").ToString() + System.Environment.NewLine + string.Format(System.Windows.Application.Current.FindResource("PLMSynchronizationFailedCompanyCurrency").ToString(), item.CompanyName, item.CurrencyName, item.Error));
                                                            else
                                                                FinalMessage += System.Environment.NewLine + string.Format(System.Windows.Application.Current.FindResource("PLMSynchronizationFailedCompanyCurrency").ToString(), item.CompanyName, item.CurrencyName, item.Error);

                                                        }
                                                        if (!string.IsNullOrEmpty(FinalMessage))
                                                        {
                                                            CustomMessageBox.Show(FinalMessage, "Red", CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                                                        }
                                                    }
                                                    else
                                                    {
                                                        CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("ECOSSynchronizationSuccess").ToString()), Application.Current.Resources["PopUpSuccessColor"].ToString(), CustomMessageBox.MessageImagePath.Ok, MessageBoxButton.OK);
                                                    }

                                                }
                                            }
                                        }

                                        GeosApplication.Instance.Logger.Log(string.Format("Method Init()....executed AcceptButtonCommandAction"), category: Category.Info, priority: Priority.Low);
                                    }
                                    catch (Exception ex)
                                    {
                                        GeosApplication.Instance.SplashScreenMessage = "Synchronization failed";
                                        if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                                        CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("ECOSSynchronizationFailed").ToString(), ex.Message), "Red", CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);

                                    }
                                    GeosApplication.Instance.SplashScreenMessage = string.Empty;
                                    #endregion
                                }
                            }
                        }
                    }
                    #endregion
                    RequestClose(null, null);
                    #endregion
                }
                else
                {
                    #region Updated
                    UpdatedItem = new BasePrice();
                    ChangedLogsEntries = new List<BasePriceLogEntry>();
                    CPLChangedLogsEntries = new List<CustomerPriceLogEntry>();
                    List<CustomerPriceListByItem> _customerPriceListByItem = new List<CustomerPriceListByItem>();

                    //if (!IsCalculated)
                    //{
                    //    CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("CalculationIsMandatory").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                    //    return;
                    //}
                    if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }
                    #region information
                    UpdatedItem.IdBasePriceList = IdBasePriceList;
                    if (IsCheckedAllLanguages == true)
                    {
                        UpdatedItem.Name = Name;
                        UpdatedItem.Name_es = Name;
                        UpdatedItem.Name_fr = Name;
                        UpdatedItem.Name_pt = Name;
                        UpdatedItem.Name_ro = Name;
                        UpdatedItem.Name_ru = Name;
                        UpdatedItem.Name_zh = Name;
                        UpdatedItem.Description = Description == null ? "" : Description;
                        UpdatedItem.Description_es = Description == null ? "" : Description;
                        UpdatedItem.Description_fr = Description == null ? "" : Description;
                        UpdatedItem.Description_pt = Description == null ? "" : Description;
                        UpdatedItem.Description_ro = Description == null ? "" : Description;
                        UpdatedItem.Description_ru = Description == null ? "" : Description;
                        UpdatedItem.Description_zh = Description == null ? "" : Description == null ? "" : Description;
                        UpdatedItem.Remark = Remark == null ? "" : Remark;
                        UpdatedItem.Remark_es = Remark == null ? "" : Remark;
                        UpdatedItem.Remark_fr = Remark == null ? "" : Remark;
                        UpdatedItem.Remark_pt = Remark == null ? "" : Remark;
                        UpdatedItem.Remark_ro = Remark == null ? "" : Remark;
                        UpdatedItem.Remark_ru = Remark == null ? "" : Remark;
                        UpdatedItem.Remark_zh = Remark == null ? "" : Remark;
                    }
                    else
                    {
                        UpdatedItem.Name = Name_en == null ? "" : Name_en;
                        UpdatedItem.Name_es = Name_es == null ? "" : Name_es;
                        UpdatedItem.Name_fr = Name_fr == null ? "" : Name_fr;
                        UpdatedItem.Name_pt = Name_pt == null ? "" : Name_pt;
                        UpdatedItem.Name_ro = Name_ro == null ? "" : Name_ro;
                        UpdatedItem.Name_ru = Name_ru == null ? "" : Name_ru;
                        UpdatedItem.Name_zh = Name_zh == null ? "" : Name_zh;
                        UpdatedItem.Description = Description_en == null ? "" : Description_en;
                        UpdatedItem.Description_es = Description_es == null ? "" : Description_es;
                        UpdatedItem.Description_fr = Description_fr == null ? "" : Description_fr;
                        UpdatedItem.Description_pt = Description_pt == null ? "" : Description_pt;
                        UpdatedItem.Description_ro = Description_ro == null ? "" : Description_ro;
                        UpdatedItem.Description_ru = Description_ru == null ? "" : Description_ru;
                        UpdatedItem.Description_zh = Description_zh == null ? "" : Description_zh;
                        UpdatedItem.Remark = Remark_en == null ? "" : Remark_en;
                        UpdatedItem.Remark_es = Remark_es == null ? "" : Remark_es;
                        UpdatedItem.Remark_fr = Remark_fr == null ? "" : Remark_fr;
                        UpdatedItem.Remark_pt = Remark_pt == null ? "" : Remark_pt;
                        UpdatedItem.Remark_ro = Remark_ro == null ? "" : Remark_ro;
                        UpdatedItem.Remark_ru = Remark_ru == null ? "" : Remark_ru;
                        UpdatedItem.Remark_zh = Remark_zh == null ? "" : Remark_zh;
                    }

                    //if (isDuplicateCliked)
                    //{
                    //    UpdatedItem.Code = DuplicateCode;
                    //}
                    //else
                    //{
                    UpdatedItem.Code = SelectedBasePriceCode;
                    //}

                    if (ExpiryDate != null)
                        UpdatedItem.ExpiryDate = Convert.ToDateTime(ExpiryDate);

                    if (EffectiveDate != null)
                        UpdatedItem.EffectiveDate = Convert.ToDateTime(EffectiveDate);

                    UpdatedItem.IdStatus = (uint)SelectedStatus.IdLookupValue;
                    UpdatedItem.IdExchangeRateUpdateType = (int)SelectedExchangeRate.IdLookupValue;
                    UpdatedItem.IdCurrency = ((Currency)SelectedCurrency).IdCurrency;
                    UpdatedItem.Currency = ((Currency)SelectedCurrency);

                    #endregion

                    #region plant and sale currency

                    if (IsCurrencyAddedOrRemove == true || IsPlantAddedOrRemove == true || IsSaleCurrencyAddedOrRemove == true)
                    {
                        //add/remove plant 
                        UpdatedItem.PlantList = new List<Site>();
                        UpdatedItem.PlantList_Cloned = ClonedBasePrice.PlantList;
                        UpdatedItem.DeletePlantList = new List<Site>();
                        UpdatedItem.AddPlantList = new List<Site>();

                        foreach (Site site in SelectedPlant)
                        {
                            UpdatedItem.PlantList.Add(site);
                        }
                        foreach (Site temp in UpdatedItem.PlantList_Cloned)
                        {
                            if (!UpdatedItem.PlantList.Any(x => x.IdSite == temp.IdSite))
                            {
                                Site site_dlt = (Site)temp.Clone();
                                site_dlt.TransactionOperation = ModelBase.TransactionOperations.Delete;
                                UpdatedItem.DeletePlantList.Add(site_dlt);
                                ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogPlantDelete").ToString(), temp.Name) });
                            }
                        }
                        foreach (Site temp1 in UpdatedItem.PlantList)
                        {
                            if (!UpdatedItem.PlantList_Cloned.Any(x => x.IdSite == temp1.IdSite))
                            {
                                Site site_add = (Site)temp1.Clone();
                                site_add.TransactionOperation = ModelBase.TransactionOperations.Add;
                                UpdatedItem.AddPlantList.Add(site_add);
                                ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogPlantAdd").ToString(), temp1.Name) });
                            }
                        }

                        //add/remove sale currency
                        UpdatedItem.CurrencyList = new List<Currency>();
                        UpdatedItem.CurrencyList_Cloned = ClonedBasePrice.CurrencyList;
                        UpdatedItem.DeleteCurrencyList = new List<Currency>();
                        UpdatedItem.AddCurrencyList = new List<Currency>();

                        foreach (Currency cur in SelectedSaleCurrency)
                        {
                            UpdatedItem.CurrencyList.Add(cur);
                        }
                        foreach (Currency temp in UpdatedItem.CurrencyList_Cloned)
                        {
                            if (!UpdatedItem.CurrencyList.Any(x => x.IdCurrency == temp.IdCurrency))
                            {
                                Currency Currency_dlt = (Currency)temp.Clone();
                                Currency_dlt.TransactionOperation = ModelBase.TransactionOperations.Delete;
                                UpdatedItem.DeleteCurrencyList.Add(Currency_dlt);
                                ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogSaleCurrencyDelete").ToString(), temp.Name) });
                            }
                        }
                        foreach (Currency temp1 in UpdatedItem.CurrencyList)
                        {
                            if (!UpdatedItem.CurrencyList_Cloned.Any(x => x.IdCurrency == temp1.IdCurrency))
                            {
                                Currency Currency_add = (Currency)temp1.Clone();
                                Currency_add.TransactionOperation = ModelBase.TransactionOperations.Add;
                                UpdatedItem.AddCurrencyList.Add(Currency_add);
                                ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogSaleCurrencyAdd").ToString(), temp1.Name) });
                            }
                        }
                    }


                    //[18-08-21][adhatkar]
                    if (DeleteCurrencyFromCPL == null)
                        DeleteCurrencyFromCPL = new List<CustomerPriceListByItem>();

                    foreach (CustomerPriceListByItem item in DeleteCurrencyFromCPL)
                    {
                        string referenceNo = CurrencyList.FirstOrDefault(a => a.IdCurrency == item.BasePriceListCurrency).Name;
                        CPLChangedLogsEntries.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, IdCustomerPriceList = item.IdCustomerPriceList, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogSaleCurrencyGridDeleteFromBPL").ToString(), referenceNo) });
                    }
                    #endregion

                    #region delete articles
                    UpdatedItem.DeleteArticleList = new List<Articles>();
                    if (DeleteArticles != null)
                    {
                        foreach (Articles dltArt in DeleteArticles)
                        {
                            if (ClonedBasePrice.BasePriceListItems.Any(a => a.IdArticle == dltArt.IdArticle))
                            {
                                dltArt.TransactionOperation = ModelBase.TransactionOperations.Delete;
                                UpdatedItem.DeleteArticleList.Add(dltArt);
                                string referenceNo = string.Empty;
                                referenceNo = ClonedBasePrice.BasePriceListItems.FirstOrDefault(a => a.IdArticle == dltArt.IdArticle).ArticleData.Reference;
                                ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogArticleGridDelete").ToString(), referenceNo) });
                            }
                        }
                    }

                    //[10-08-21][adhatkar]
                    if (DeleteFromCPL == null)
                        DeleteFromCPL = new List<CustomerPriceListByItem>();

                    foreach (CustomerPriceListByItem item in DeleteFromCPL)
                    {
                        string referenceNo = ArticleList.FirstOrDefault(a => a.IdArticle == item.IdArticle).ArticleData.Reference;
                        CPLChangedLogsEntries.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, IdCustomerPriceList = item.IdCustomerPriceList, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogArticleGridDeleteFromBPL").ToString(), referenceNo) });
                    }

                    #endregion

                    #region delete Detections
                    UpdatedItem.DeleteDetectionList = new List<Detections>();

                    if (DeleteDetections != null)
                    {
                        foreach (Detections deleteDetection in DeleteDetections)
                        {
                            if (ClonedBasePrice.BasePriceListDetections.Any(a => a.IdDetection == deleteDetection.IdDetections))
                            {
                                deleteDetection.TransactionOperation = ModelBase.TransactionOperations.Delete;
                                UpdatedItem.DeleteDetectionList.Add(deleteDetection);
                                string referenceNo = string.Empty;
                                if (ClonedBasePrice.BasePriceListDetections.FirstOrDefault(a => a.IdDetection == deleteDetection.IdDetections) != null)
                                {
                                    if (string.IsNullOrEmpty(ClonedBasePrice.BasePriceListDetections.FirstOrDefault(a => a.IdDetection == deleteDetection.IdDetections).Detection.Code))
                                        referenceNo = ClonedBasePrice.BasePriceListDetections.FirstOrDefault(a => a.IdDetection == deleteDetection.IdDetections).Detection.Name;
                                    else
                                        referenceNo = ClonedBasePrice.BasePriceListDetections.FirstOrDefault(a => a.IdDetection == deleteDetection.IdDetections).Detection.Code;

                                    ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogDetectionGridDelete").ToString(), referenceNo) });
                                }
                            }
                        }
                    }


                    //[10-08-21][adhatkar]
                    if (DeleteDetectionFromCPL == null)
                        DeleteDetectionFromCPL = new List<CustomerPriceListByItem>();

                    foreach (CustomerPriceListByItem item in DeleteDetectionFromCPL)
                    {
                        string referenceNo = string.Empty;
                        if (string.IsNullOrEmpty(DetectionList.FirstOrDefault(a => a.IdDetection == item.IdDetection).Detection.Code))
                            referenceNo = DetectionList.FirstOrDefault(a => a.IdDetection == item.IdDetection).Detection.Name;
                        else
                            referenceNo = DetectionList.FirstOrDefault(a => a.IdDetection == item.IdDetection).Detection.Code;
                        CPLChangedLogsEntries.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, IdCustomerPriceList = item.IdCustomerPriceList, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogDetectionGridDeleteFromBPL").ToString(), referenceNo) });
                    }




                    #endregion

                    #region delete Modules
                    //Shubham[skadam] GEOS2-2886 [Only Modules ] - Able to  add and access to the tab Modules/Detection /Articles a Base Price List [3/3] [#PLM07] 28 03 2023
                    UpdatedItem.DeleteModuleList = new List<BPLModule>();

                    if (DeleteModules != null)
                    {
                        foreach (BPLModule deleteModules in DeleteModules)
                        {
                            if (ClonedBasePrice.BasePriceListModules != null)
                                if (ClonedBasePrice.BasePriceListModules.Any(a => a.IdCPType == deleteModules.IdCPType))
                                {
                                    deleteModules.TransactionOperation = ModelBase.TransactionOperations.Delete;
                                    UpdatedItem.DeleteModuleList.Add(deleteModules);
                                    string referenceNo = string.Empty;
                                    if (ClonedBasePrice.BasePriceListModules.FirstOrDefault(a => a.IdCPType == deleteModules.IdCPType) != null)
                                    {
                                        if (string.IsNullOrEmpty(ClonedBasePrice.BasePriceListModules.FirstOrDefault(a => a.IdCPType == deleteModules.IdCPType).ProductType.Code))
                                            referenceNo = ClonedBasePrice.BasePriceListModules.FirstOrDefault(a => a.IdCPType == deleteModules.IdCPType).ProductType.Name;
                                        else
                                            referenceNo = ClonedBasePrice.BasePriceListModules.FirstOrDefault(a => a.IdCPType == deleteModules.IdCPType).ProductType.Code;

                                        ChangedLogsEntries.Add(new BasePriceLogEntry()
                                        {
                                            IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser,
                                            Datetime = GeosApplication.Instance.ServerDateTime,
                                            UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName,
                                            Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogModuleGridDeleteFromBPL").ToString(),
                                            referenceNo)
                                        });
                                    }
                                }
                        }
                    }



                    if (DeleteModuleFromCPL == null)
                        DeleteModuleFromCPL = new List<CustomerPriceListByItem>();

                    if (ModuleList == null)
                    {
                        ModuleList = new ObservableCollection<BasePriceListByItem>();
                    }
                    foreach (CustomerPriceListByItem item in DeleteModuleFromCPL)
                    {
                        string referenceNo = string.Empty;
                        if (string.IsNullOrEmpty(ModuleList.FirstOrDefault(a => a.IdCPType == item.IdCPType).ProductType.Code))
                            referenceNo = ModuleList.FirstOrDefault(a => a.IdCPType == item.IdCPType).ProductType.Name;
                        else
                            referenceNo = ModuleList.FirstOrDefault(a => a.IdCPType == item.IdCPType).ProductType.Code;
                        CPLChangedLogsEntries.Add(new CustomerPriceLogEntry()
                        {
                            IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser,
                            Datetime = GeosApplication.Instance.ServerDateTime,
                            UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName,
                            IdCustomerPriceList = item.IdCustomerPriceList,
                            Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogModuleGridDeleteFromBPL").ToString(), referenceNo)
                        });
                    }

                    #endregion

                    #region articles

                    DataColumn[] columns = DtArticleCopy.Columns.Cast<DataColumn>().ToArray();
                    DataRow[] foundChecked = DtArticleCopy.AsEnumerable().Where(row => columns.Any(col => row["IsUpdatedRow"].ToString() == "True")).ToArray();

                    if (foundChecked.Length > 0 || IsPlantAddedOrRemove == true || IsCurrencyAddedOrRemove == true || IsSaleCurrencyAddedOrRemove == true)
                    {
                        UpdatedItem.AddArticleList = new List<BasePriceListByItem>();
                        UpdatedItem.UpdateArticleList = new List<BasePriceListByItem>();
                        if (AddArticles == null)
                            AddArticles = new List<ulong>();


                        foreach (DataRow row in foundChecked)
                        {
                            //add articles
                            if (AddArticles.Any(a => a == Convert.ToUInt64(row["IdArticle"])))
                            {
                                BasePriceListByItem basePriceListByItem = new BasePriceListByItem();
                                basePriceListByItem.IdArticle = Convert.ToUInt64(row["IdArticle"]);
                                if (row["MaxCost_1"] != null && row["MaxCost_1"] != DBNull.Value)
                                    basePriceListByItem.MaxCost = float.Parse(row["MaxCost_1"].ToString());
                                basePriceListByItem.IdRule = Convert.ToInt32(row["Logic"]);
                                if (row["Value"] != null && row["value"] != DBNull.Value)
                                    basePriceListByItem.RuleValue = float.Parse(row["Value"].ToString());
                                basePriceListByItem.Version = 1;
                                if (row["CurrencyConversionDate"] != DBNull.Value && row["CurrencyConversionDate"] != null)
                                    basePriceListByItem.CurrencyConversionDate_New = Convert.ToDateTime(row["CurrencyConversionDate"]);
                                UpdatedItem.AddArticleList.Add(basePriceListByItem);

                                string referenceNo = ArticleMenuList.FirstOrDefault(a => a.IdArticle == Convert.ToUInt64(row["IdArticle"])).Reference;
                                ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogArticleGridAdd").ToString(), referenceNo) });
                            }

                            //update article, plant, sale currency
                            if (DeleteArticles == null)
                                DeleteArticles = new List<Articles>();

                            if (ClonedBasePrice.BasePriceListItems.Any(a => a.IdArticle == Convert.ToUInt64(row["IdArticle"])) && !DeleteArticles.Any(a => a.IdArticle == Convert.ToUInt64(row["IdArticle"])))
                            {
                                BasePriceListByItem oldUpdated = ClonedBasePrice.BasePriceListItems.FirstOrDefault(x => x.IdArticle == Convert.ToUInt64(row["IdArticle"]));

                                if (row["Value"] == DBNull.Value)
                                    row["Value"] = 0;

                                //update article
                                if (oldUpdated.IdRule != Convert.ToInt32(row["Logic"])
                                    || oldUpdated.RuleValue != float.Parse(row["Value"].ToString()))
                                {
                                    BasePriceListByItem Article = new BasePriceListByItem();
                                    Article.IdArticle = Convert.ToUInt64(row["IdArticle"]);
                                    if (row["MaxCost_1"] != null && row["MaxCost_1"] != DBNull.Value)
                                        Article.MaxCost = float.Parse(row["MaxCost_1"].ToString());
                                    Article.IdRule = Convert.ToInt32(row["Logic"]);
                                    if (row["Value"] != null && row["value"] != DBNull.Value)
                                        Article.RuleValue = float.Parse(row["Value"].ToString());

                                    Article.Version = 1;

                                    if (row["CurrencyConversionDate"] != DBNull.Value && row["CurrencyConversionDate"] != null)
                                        Article.CurrencyConversionDate_New = Convert.ToDateTime(row["CurrencyConversionDate"]);

                                    Article.TransactionOperation = ModelBase.TransactionOperations.Update;
                                    UpdatedItem.UpdateArticleList.Add(Article);

                                    string ReferenceNo = ArticleMenuList.FirstOrDefault(a => a.IdArticle == oldUpdated.IdArticle).Reference;
                                    if (oldUpdated.IdRule != Convert.ToInt32(row["Logic"]))
                                    {
                                        string newRuleLogic = LogicList.FirstOrDefault(a => a.IdLookupValue == Convert.ToInt32(row["Logic"])).Value;
                                        string oldRuleLogic = LogicList.FirstOrDefault(a => a.IdLookupValue == oldUpdated.IdRule).Value;
                                        ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogArticleGridRuleLogic").ToString(), oldRuleLogic, newRuleLogic, ReferenceNo) });
                                    }

                                    if (oldUpdated.RuleValue != float.Parse(row["Value"].ToString()))
                                    {
                                        ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogArticleGridRuleValue").ToString(), oldUpdated.RuleValue, float.Parse(row["Value"].ToString()), ReferenceNo) });
                                    }
                                }

                                if (Convert.ToInt32(row["Logic"]) == 308 && Convert.ToDouble(row["Value"]) <= 0)
                                    row["Value"] = DBNull.Value;
                            }
                        }
                    }
                    #endregion

                    #region Detections

                    DataColumn[] _columns = DtDetectionCopy.Columns.Cast<DataColumn>().ToArray();
                    DataRow[] _foundChecked = DtDetectionCopy.AsEnumerable().Where(row1 => _columns.Any(col => row1["IsUpdatedRow"].ToString() == "True")).ToArray();

                    if (_foundChecked.Length > 0 || IsCurrencyAddedOrRemove == true || IsSaleCurrencyAddedOrRemove == true)
                    {
                        UpdatedItem.AddDetectionList = new List<BasePriceListByItem>();
                        UpdatedItem.UpdateDetectionList = new List<BasePriceListByItem>();

                        if (AddDetections == null)
                            AddDetections = new List<ulong>();

                        foreach (DataRow row in _foundChecked)
                        {
                            //add detections
                            if (AddDetections.Any(a => a == Convert.ToUInt64(row["IdDetection"])))
                            {
                                BasePriceListByItem basePriceListByItem = new BasePriceListByItem();
                                basePriceListByItem.IdDetection = Convert.ToUInt32(row["IdDetection"]);
                                if (row["MaxCost_1"] != null && row["MaxCost_1"] != DBNull.Value)
                                    basePriceListByItem.MaxCost = float.Parse(row["MaxCost_1"].ToString());
                                basePriceListByItem.IdRule = Convert.ToInt32(row["Logic"]);
                                if (row["Value"] != null && row["value"] != DBNull.Value)
                                    basePriceListByItem.RuleValue = float.Parse(row["Value"].ToString());
                                basePriceListByItem.Version = 1;

                                if (row["CurrencyConversionDate"] != DBNull.Value && row["CurrencyConversionDate"] != null)
                                    basePriceListByItem.CurrencyConversionDate_New = Convert.ToDateTime(row["CurrencyConversionDate"]);

                                UpdatedItem.AddDetectionList.Add(basePriceListByItem);

                                string referenceNo = DetectionMenulist.FirstOrDefault(a => a.IdDetection == Convert.ToUInt64(row["IdDetection"])).Name;
                                ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogDetectionGridAdd").ToString(), referenceNo) });
                            }

                            //update detection, plant, sale currency
                            if (DeleteDetections == null)
                                DeleteDetections = new List<Detections>();

                            if (ClonedBasePrice.BasePriceListDetections.Any(a => a.IdDetection == Convert.ToUInt64(row["IdDetection"])) && !DeleteDetections.Any(a => a.IdDetections == Convert.ToUInt64(row["IdDetection"])))
                            {
                                BasePriceListByItem oldUpdated = ClonedBasePrice.BasePriceListDetections.FirstOrDefault(x => x.IdDetection == Convert.ToUInt64(row["IdDetection"]));

                                //update detection
                                if (row["MaxCost_1"] == DBNull.Value || row["MaxCost_1"] == null)
                                    row["MaxCost_1"] = 0;

                                if (row["Value"] == DBNull.Value)
                                    row["Value"] = 0;

                                if (oldUpdated.IdRule != Convert.ToInt32(row["Logic"]) || oldUpdated.MaxCost != float.Parse(row["MaxCost_1"].ToString())
                                    || oldUpdated.RuleValue != float.Parse(row["Value"].ToString()))
                                {
                                    BasePriceListByItem detection = new BasePriceListByItem();
                                    detection.IdDetection = Convert.ToUInt32(row["IdDetection"]);
                                    detection.MaxCost = float.Parse(row["MaxCost_1"].ToString());
                                    detection.IdRule = Convert.ToInt32(row["Logic"]);
                                    if (row["Value"] != null && row["value"] != DBNull.Value)
                                        detection.RuleValue = float.Parse(row["Value"].ToString());

                                    detection.Version = 1;
                                    if (row["CurrencyConversionDate"] != DBNull.Value && row["CurrencyConversionDate"] != null)
                                        detection.CurrencyConversionDate_New = Convert.ToDateTime(row["CurrencyConversionDate"]);

                                    detection.TransactionOperation = ModelBase.TransactionOperations.Update;
                                    UpdatedItem.UpdateDetectionList.Add(detection);

                                    string ReferenceNo = DetectionMenulist.FirstOrDefault(a => a.IdDetection == oldUpdated.IdDetection).Name;
                                    if (oldUpdated.IdRule != Convert.ToInt32(row["Logic"]))
                                    {
                                        string newRuleLogic = LogicList.FirstOrDefault(a => a.IdLookupValue == Convert.ToInt32(row["Logic"])).Value;
                                        string oldRuleLogic = LogicList.FirstOrDefault(a => a.IdLookupValue == oldUpdated.IdRule).Value;
                                        ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogDetectionGridRuleLogic").ToString(), oldRuleLogic, newRuleLogic, ReferenceNo) });
                                    }

                                    if (oldUpdated.RuleValue != float.Parse(row["Value"].ToString()))
                                    {
                                        ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogDetectionGridRuleValue").ToString(), oldUpdated.RuleValue, float.Parse(row["Value"].ToString()), ReferenceNo) });
                                    }
                                }

                                if (Convert.ToInt32(row["Logic"]) == 308 && Convert.ToDouble(row["Value"]) <= 0)
                                    row["Value"] = DBNull.Value;
                            }
                        }
                    }
                    #endregion

                    #region Modules
                    //Shubham[skadam] GEOS2-2886 [Only Modules ] - Able to  add and access to the tab Modules/Detection /Articles a Base Price List [3/3] [#PLM07] 28 03 2023
                    DataColumn[] _columnsModule = DtModuleCopy.Columns.Cast<DataColumn>().ToArray();
                    DataRow[] _foundCheckedModule = DtModuleCopy.AsEnumerable().Where(row1 => _columns.Any(col => row1["IsUpdatedRow"].ToString() == "True")).ToArray();

                    if (_foundCheckedModule.Length > 0 || IsCurrencyAddedOrRemove == true || IsSaleCurrencyAddedOrRemove == true)
                    {
                        UpdatedItem.AddModuleList = new List<BasePriceListByItem>();
                        UpdatedItem.UpdateModuleList = new List<BasePriceListByItem>();

                        if (AddModules == null)
                            AddModules = new List<ulong>();

                        foreach (DataRow row in _foundCheckedModule)
                        {
                            //add Modules
                            if (AddModules.Any(a => a == Convert.ToUInt64(row["IdCPType"])))
                            {
                                BasePriceListByItem basePriceListByItem = new BasePriceListByItem();
                                basePriceListByItem.IdCPType = Convert.ToUInt32(row["IdCPType"]);
                                if (row["MaxCost_1"] != null && row["MaxCost_1"] != DBNull.Value)
                                    basePriceListByItem.MaxCost = float.Parse(row["MaxCost_1"].ToString());
                                basePriceListByItem.IdRule = Convert.ToInt32(row["Logic"]);
                                if (row["Value"] != null && row["value"] != DBNull.Value)
                                    basePriceListByItem.RuleValue = float.Parse(row["Value"].ToString());
                                basePriceListByItem.Version = 1;

                                if (row["CurrencyConversionDate"] != DBNull.Value && row["CurrencyConversionDate"] != null)
                                    basePriceListByItem.CurrencyConversionDate_New = Convert.ToDateTime(row["CurrencyConversionDate"]);

                                UpdatedItem.AddModuleList.Add(basePriceListByItem);

                                string referenceNo1 = ModuleMenulist.FirstOrDefault(a => a.IdCPType == Convert.ToUInt64(row["IdCPType"])).Name;
                                string referenceNo = referenceNo1;
                                if (referenceNo1.IndexOf("[", StringComparison.CurrentCultureIgnoreCase) != -1)
                                {
                                    referenceNo = referenceNo1.Remove(referenceNo1.LastIndexOf("[") - 0);
                                }
                                else
                                {
                                    referenceNo = referenceNo1;
                                }
                                ChangedLogsEntries.Add(new BasePriceLogEntry()
                                {
                                    IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser,
                                    Datetime = GeosApplication.Instance.ServerDateTime,
                                    UserName = GeosApplication.Instance.ActiveUser.FirstName + " "
                                    + GeosApplication.Instance.ActiveUser.LastName,
                                    Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogModuleGridAdd").ToString(), referenceNo)
                                });
                            }

                            //update Modules, plant, sale currency
                            if (DeleteModules == null)
                                DeleteModules = new List<BPLModule>();
                            if (ClonedBasePrice.BasePriceListModules != null)
                                if (ClonedBasePrice.BasePriceListModules.Any(a => a.IdCPType == Convert.ToUInt64(row["IdCPType"])) &&
                                    !DeleteModules.Any(a => a.IdCPType == Convert.ToUInt64(row["IdCPType"])))
                                {
                                    BasePriceListByItem oldUpdated = ClonedBasePrice.BasePriceListModules.FirstOrDefault(x => x.IdCPType == Convert.ToUInt64(row["IdCPType"]));

                                    //update Module
                                    if (row["MaxCost_1"] == DBNull.Value || row["MaxCost_1"] == null)
                                        row["MaxCost_1"] = 0;

                                    if (row["Value"] == DBNull.Value)
                                        row["Value"] = 0;

                                    if (oldUpdated.IdRule != Convert.ToInt32(row["Logic"]) || oldUpdated.MaxCost != float.Parse(row["MaxCost_1"].ToString())
                                        || oldUpdated.RuleValue != float.Parse(row["Value"].ToString()))
                                    {
                                        BasePriceListByItem module = new BasePriceListByItem();
                                        module.IdCPType = Convert.ToUInt32(row["IdCPType"]);
                                        module.MaxCost = float.Parse(row["MaxCost_1"].ToString());
                                        module.IdRule = Convert.ToInt32(row["Logic"]);
                                        if (row["Value"] != null && row["value"] != DBNull.Value)
                                            module.RuleValue = float.Parse(row["Value"].ToString());

                                        module.Version = 1;
                                        if (row["CurrencyConversionDate"] != DBNull.Value && row["CurrencyConversionDate"] != null)
                                            module.CurrencyConversionDate_New = Convert.ToDateTime(row["CurrencyConversionDate"]);

                                        module.TransactionOperation = ModelBase.TransactionOperations.Update;
                                        UpdatedItem.UpdateModuleList.Add(module);

                                        string ReferenceNo1 = ModuleMenulist.FirstOrDefault(a => a.IdCPType == oldUpdated.IdCPType).Name;
                                        //string ReferenceNo = ReferenceNo1.Remove(ReferenceNo1.LastIndexOf("[") - 1);
                                        string ReferenceNo = ReferenceNo1;
                                        if (ReferenceNo1.IndexOf("[", StringComparison.CurrentCultureIgnoreCase) != -1)
                                        {
                                            ReferenceNo = ReferenceNo1.Remove(ReferenceNo1.LastIndexOf("[") - 0);
                                        }
                                        else
                                        {
                                            ReferenceNo = ReferenceNo1;
                                        }
                                        if (oldUpdated.IdRule != Convert.ToInt32(row["Logic"]))
                                        {
                                            string newRuleLogic = LogicList.FirstOrDefault(a => a.IdLookupValue == Convert.ToInt32(row["Logic"])).Value;
                                            string oldRuleLogic = LogicList.FirstOrDefault(a => a.IdLookupValue == oldUpdated.IdRule).Value;
                                            ChangedLogsEntries.Add(new BasePriceLogEntry()
                                            {
                                                IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser,
                                                Datetime = GeosApplication.Instance.ServerDateTime,
                                                UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName,
                                                Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogModuleGridRuleLogic").ToString(),
                                                oldRuleLogic, newRuleLogic, ReferenceNo)
                                            });
                                        }

                                        if (oldUpdated.RuleValue != float.Parse(row["Value"].ToString()))
                                        {
                                            ChangedLogsEntries.Add(new BasePriceLogEntry()
                                            {
                                                IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser,
                                                Datetime = GeosApplication.Instance.ServerDateTime,
                                                UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName,
                                                Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogModuleGridRuleValue").ToString(),
                                                oldUpdated.RuleValue, float.Parse(row["Value"].ToString()), ReferenceNo)
                                            });
                                        }
                                    }

                                    if (Convert.ToInt32(row["Logic"]) == 308 && Convert.ToDouble(row["Value"]) <= 0)
                                        row["Value"] = DBNull.Value;
                                }
                        }
                    }
                    #endregion
                    #region plantAndCurrency with Checkbox

                    /// Update the BPLPlantCurrencyList 
                    List<BasePriceListByPlantCurrency> BPLPlantCurrencyList1 = new List<BasePriceListByPlantCurrency>();
                    foreach (DataRow row1 in Dttable.Rows)
                    {
                        if (SelectedPlant.Cast<Site>().Any(x => x.Name == row1["Plant"].ToString()))
                        {
                            foreach (Currency cur in SelectedSaleCurrency)
                            {
                                BasePriceListByPlantCurrency BPLPlantCurrency1 = new BasePriceListByPlantCurrency()
                                {
                                    CurrencyName = cur.Name,
                                    IdCurrency = cur.IdCurrency,
                                    PlantName = row1["Plant"].ToString(),
                                    IdPlant = SelectedPlant.Cast<Site>().Where(a => a.Name == row1["Plant"].ToString()).Select(x => x.IdSite).FirstOrDefault(),
                                    PlantbyCurrency = Convert.ToByte(row1[cur.Name]),
                                    TransactionOperation = ModelBase.TransactionOperations.Update
                                };
                                BPLPlantCurrencyList1.Add(BPLPlantCurrency1);
                            }
                        }
                    }
                    UpdatedItem.PlantCurrencyList = BPLPlantCurrencyList1;

                    #endregion
                    // Delete Article Attachment file
                    foreach (BPLDocument item in ClonedBasePrice.PLMArticleAttachmentList)
                    {
                        if (OptionWayDetectionSparePartFilesList != null && !OptionWayDetectionSparePartFilesList.Any(x => x.IdBasepricedoc == item.IdBasepricedoc))
                        {
                            if (UpdatedItem.PLMArticleAttachmentList == null)
                            {
                                UpdatedItem.PLMArticleAttachmentList = new List<BPLDocument>();
                            }
                            BPLDocument bplDoc = (BPLDocument)item.Clone();
                            bplDoc.TransactionOperation = ModelBase.TransactionOperations.Delete;
                            UpdatedItem.PLMArticleAttachmentList.Add(bplDoc);
                            ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("PCMArticleChangeLogFilesDelete").ToString(), item.OriginalFileName) });
                        }
                    }

                    //Add Article Attachment file [rdixit][GEOS2-2512][30.11.2022]
                    if (OptionWayDetectionSparePartFilesList != null)
                    {
                        foreach (BPLDocument item in OptionWayDetectionSparePartFilesList)
                        {
                            if (!ClonedBasePrice.PLMArticleAttachmentList.Any(x => x.IdBasepricedoc == item.IdBasepricedoc))
                            {
                                if (UpdatedItem.PLMArticleAttachmentList == null)
                                {
                                    UpdatedItem.PLMArticleAttachmentList = new List<BPLDocument>();
                                }
                                BPLDocument bplDoc = (BPLDocument)item.Clone();
                                bplDoc.TransactionOperation = ModelBase.TransactionOperations.Add;
                                UpdatedItem.PLMArticleAttachmentList.Add(bplDoc);
                                ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("PCMArticleChangeLogFilesAdd").ToString(), item.OriginalFileName) });
                            }
                        }
                    }


                    //Updated Article Attachment file
                    foreach (BPLDocument originalArticle in ClonedBasePrice.PLMArticleAttachmentList)
                    {
                        if (OptionWayDetectionSparePartFilesList != null && OptionWayDetectionSparePartFilesList.Any(x => x.IdBasepricedoc == originalArticle.IdBasepricedoc))
                        {
                            BPLDocument bPLAttachedDocUpdated = OptionWayDetectionSparePartFilesList.FirstOrDefault(x => x.IdBasepricedoc == originalArticle.IdBasepricedoc);
                            //if (originalArticle.ArticleDocumentType == null)
                            //    originalArticle.ArticleDocumentType = new ArticleDocumentType();

                            //if (bPLAttachedDocUpdated.ArticleDocumentType == null)
                            //    bPLAttachedDocUpdated.ArticleDocumentType = new ArticleDocumentType();

                            if ((bPLAttachedDocUpdated.SavedFileName != originalArticle.SavedFileName) || (bPLAttachedDocUpdated.OriginalFileName != originalArticle.OriginalFileName) || (bPLAttachedDocUpdated.Description != originalArticle.Description) || (bPLAttachedDocUpdated.IsShareWithCustomer != originalArticle.IsShareWithCustomer) || (bPLAttachedDocUpdated.ArticleDocumentType.DocumentType != originalArticle.ArticleDocumentType.DocumentType) || (bPLAttachedDocUpdated.PLMArticleFileInBytes != originalArticle.PLMArticleFileInBytes))
                            {
                                BPLDocument bplAttachedDoc = (BPLDocument)bPLAttachedDocUpdated.Clone();
                                bplAttachedDoc.ModifiedBy = Convert.ToInt32(GeosApplication.Instance.ActiveUser.IdUser);
                                bplAttachedDoc.TransactionOperation = ModelBase.TransactionOperations.Update;
                                if (UpdatedItem.PLMArticleAttachmentList == null)
                                {
                                    UpdatedItem.PLMArticleAttachmentList = new List<BPLDocument>();
                                }
                                UpdatedItem.PLMArticleAttachmentList.Add(bplAttachedDoc);

                                if ((bPLAttachedDocUpdated.OriginalFileName != originalArticle.OriginalFileName))
                                {
                                    if (string.IsNullOrEmpty(bPLAttachedDocUpdated.OriginalFileName))
                                        ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("PCMArticleChangeLogFilesNameUpdate").ToString(), "None", originalArticle.OriginalFileName) });
                                    else
                                    {
                                        ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("PCMArticleChangeLogFilesNameUpdate").ToString(), originalArticle.OriginalFileName, bPLAttachedDocUpdated.OriginalFileName) });
                                    }
                                }
                                if ((bPLAttachedDocUpdated.Description != originalArticle.Description))
                                {
                                    if (string.IsNullOrEmpty(bPLAttachedDocUpdated.Description))
                                        ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("PCMArticleChangeLogDescriptionUpdate").ToString(), originalArticle.Description, "None") });
                                    else
                                    {
                                        if (string.IsNullOrEmpty(originalArticle.Description))
                                            ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("PCMArticleChangeLogDescriptionUpdate").ToString(), "None", bPLAttachedDocUpdated.Description) });
                                        else
                                            ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("PCMArticleChangeLogDescriptionUpdate").ToString(), originalArticle.Description, bPLAttachedDocUpdated.Description) });
                                    }
                                }
                                if ((bPLAttachedDocUpdated.IsShareWithCustomer != originalArticle.IsShareWithCustomer))
                                {

                                    ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("PCMArticleChangeLogFilesIsSharedWithCustomerUpdate").ToString(), originalArticle.Description, (originalArticle.IsShareWithCustomer == 0 ? "OFF" : "ON"), (bPLAttachedDocUpdated.IsShareWithCustomer == 0 ? "OFF" : "ON")) });


                                }

                                if (bPLAttachedDocUpdated.ArticleDocumentType.DocumentType != originalArticle.ArticleDocumentType.DocumentType)
                                {

                                    ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("PCMArticleChangeLogFilesDocumentTypeUpdate").ToString(), originalArticle.Description, originalArticle.ArticleDocumentType.DocumentType, bPLAttachedDocUpdated.ArticleDocumentType.DocumentType) });


                                }
                            }
                        }
                    }
                    #region GEOS2-4935 [Sudhir.Jangra]
                    UpdatedItem.BasePriceCommentsList = new List<BasePriceLogEntry>();
                    //Deleted Comments
                    foreach (BasePriceLogEntry itemComments in ClonedBasePrice.BasePriceCommentsList)
                    {
                        if (!CommentsList.Any(x => x.IdLogEntryByBasePriceList == itemComments.IdLogEntryByBasePriceList) && itemComments.IdLogEntryByBasePriceList != 0)
                        {
                            BasePriceLogEntry comments = (BasePriceLogEntry)itemComments.Clone();
                            comments.TransactionOperation = ModelBase.TransactionOperations.Delete;
                            UpdatedItem.BasePriceCommentsList.Add(comments);

                            //ChangedLogsEntries.Add(new BasePriceLogEntry()
                            //{
                            //    IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser,
                            //    Datetime = GeosApplication.Instance.ServerDateTime,
                            //    UserName = GeosApplication.Instance.ActiveUser.FirstName +
                            //                    " " + GeosApplication.Instance.ActiveUser.LastName,
                            //    Comments = string.Format(System.Windows.Application.Current.FindResource("BasePriceChangeLogForCommentDeleted").ToString(),
                            //                   comments.Comments)
                            //});


                        }
                    }

                    //Added Comments
                    foreach (BasePriceLogEntry itemComments in CommentsList)
                    {
                        if (!ClonedBasePrice.BasePriceCommentsList.Any(x => x.IdLogEntryByBasePriceList == itemComments.IdLogEntryByBasePriceList))
                        {
                            BasePriceLogEntry comments = (BasePriceLogEntry)itemComments.Clone();
                            comments.TransactionOperation = ModelBase.TransactionOperations.Add;
                            UpdatedItem.BasePriceCommentsList.Add(comments);
                            //ChangedLogsEntries.Add(new BasePriceLogEntry()
                            //{
                            //    IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser,
                            //    Datetime = GeosApplication.Instance.ServerDateTime,
                            //    UserName = GeosApplication.Instance.ActiveUser.FirstName +
                            //                   " " + GeosApplication.Instance.ActiveUser.LastName,
                            //    Comments = string.Format(System.Windows.Application.Current.FindResource("BasePriceChangeLogForComment").ToString(),
                            //         comments.Comments)
                            //});
                        }
                    }


                    //Update Comments
                    foreach (BasePriceLogEntry originalComments in ClonedBasePrice.BasePriceCommentsList)
                    {
                        if (CommentsList.Any(x => x.IdLogEntryByBasePriceList == originalComments.IdLogEntryByBasePriceList))
                        {
                            BasePriceLogEntry commentsUpdated = CommentsList.FirstOrDefault(x => x.IdLogEntryByBasePriceList == originalComments.IdLogEntryByBasePriceList);
                            if (commentsUpdated.Comments != originalComments.Comments)
                            {
                                string originalComment;
                                if (originalComments.Comments == null)
                                {
                                    originalComment = string.Empty;
                                }
                                else
                                {
                                    originalComment = originalComments.Comments;
                                }
                                BasePriceLogEntry comments = (BasePriceLogEntry)commentsUpdated.Clone();
                                comments.ModifiedBy = Convert.ToUInt32(GeosApplication.Instance.ActiveUser.IdUser);
                                comments.ModifiedDate = DateTime.Now;
                                comments.TransactionOperation = ModelBase.TransactionOperations.Update;
                                UpdatedItem.BasePriceCommentsList.Add(comments);


                                //using (var productTypeCommentEntry = new BasePriceLogEntry
                                //{
                                //    IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser,
                                //    Datetime = GeosApplication.Instance.ServerDateTime,
                                //    UserName = GeosApplication.Instance.ActiveUser.FirstName +
                                //          " " + GeosApplication.Instance.ActiveUser.LastName,
                                //    Comments = string.Format(System.Windows.Application.Current.FindResource("BasePriceChangeLogForCommentUpdate").ToString(),
                                // originalComments.Comments, originalComments.Comments, comments.Comments)
                                //})
                                //{
                                //    ChangedLogsEntries.Add(productTypeCommentEntry);
                                //}


                            }
                        }
                    }
                    #endregion


                    UpdatedItem.BasePriceCommentsList.ForEach(x => x.People.OwnerImage = null);

                    AddChangedLogsDetails();
                    AddChangeLogList(BPLPlantCurrencyList1);

                    UpdatedItem.LogList = ChangedLogsEntries.ToList();
                    UpdatedItem.ModificationDate = DateTime.Now;
                    UpdatedItem.IdModifier = (uint)GeosApplication.Instance.ActiveUser.IdUser;
                    UpdatedItem.CPLlogList = CPLChangedLogsEntries;
                    UpdatedItem.CustomerPriceListItems = DeleteFromCPL;
                    UpdatedItem.CustomerPriceListDetections = DeleteDetectionFromCPL;
                    UpdatedItem.CustomerPriceListSaleCurrencies = DeleteCurrencyFromCPL;
                    UpdatedItem.Code = SelectedBasePriceCode;
                    // declared image sources to add removed image sources	
                    ImageSource iSource;
                    List<ImageSource> aCListSource = new List<ImageSource>();
                    List<ImageSource> cListSource = new List<ImageSource>();
                    List<ImageSource> cListClonedSource = new List<ImageSource>();
                    List<ImageSource> uCListSource = new List<ImageSource>();
                    if (UpdatedItem.AddCurrencyList != null)
                    {
                        foreach (var item in UpdatedItem.AddCurrencyList)
                            aCListSource.Add(item.CurrencyIconImage);
                        UpdatedItem.AddCurrencyList.ForEach(x => x.CurrencyIconImage = null);
                    }
                    iSource = UpdatedItem.Currency.CurrencyIconImage;
                    UpdatedItem.Currency.CurrencyIconImage = null;
                    if (UpdatedItem.CurrencyList != null)
                    {
                        foreach (var item in UpdatedItem.CurrencyList)
                            cListSource.Add(item.CurrencyIconImage);
                        UpdatedItem.CurrencyList.ForEach(x => x.CurrencyIconImage = null);
                    }
                    if (UpdatedItem.CurrencyList_Cloned != null)
                    {
                        foreach (var item in UpdatedItem.CurrencyList_Cloned)
                            cListClonedSource.Add(item.CurrencyIconImage);
                        UpdatedItem.CurrencyList_Cloned.ForEach(x => x.CurrencyIconImage = null);
                    }
                    if (UpdatedItem.UpdateCurrencyList != null)
                    {
                        foreach (var item in UpdatedItem.UpdateCurrencyList)
                            uCListSource.Add(item.CurrencyIconImage);
                        UpdatedItem.UpdateCurrencyList.ForEach(x => x.CurrencyIconImage = null);
                    }
                    //IsUpdatedBasePriceSave = PLMService.UpdateBasePrice_V2180(UpdatedItem);
                    //IsUpdatedBasePriceSave = PLMService.UpdateBasePrice_V2340(UpdatedItem);
                    //Shubham[skadam] GEOS2-2886 [Only Modules ] - Able to  add and access to the tab Modules/Detection /Articles a Base Price List [3/3] [#PLM07] 28 03 2023
                    //  IsUpdatedBasePriceSave = PLMService.UpdateBasePrice_V2370(UpdatedItem);
                    // add removed image sources if save button clicked	


                    //[Sudhir.Jangra][GEOS2-4935]
                    IsUpdatedBasePriceSave = PLMService.UpdateBasePrice_V2470(UpdatedItem);


                    if (SaveButtonVisibility == Visibility.Visible && isSaveButtonClicked)
                    {
                        //BasePrice temp_ = (PLMService.GetBasePriceDetailById_V2340(UpdatedItem.IdBasePriceList));
                        BasePrice temp_ = (PLMService.GetBasePriceDetailById_V2370(UpdatedItem.IdBasePriceList));
                        ClonedBasePrice = (BasePrice)temp_.Clone();

                        if (ClonedBasePrice.IdStatus == 224)
                            InActiveStatus = true;
                        else
                            InActiveStatus = false;

                        if (DtArticle != null && DtArticle.Rows.Count > 0)
                        {
                            var updatedRowsDtArticle = DtArticle.Select("IsUpdatedRow = True");
                            foreach (var item in updatedRowsDtArticle)
                                item["IsUpdatedRow"] = false;
                        }
                        if (DtDetection != null && DtDetection.Rows.Count > 0)
                        {
                            var updatedRowsDtDetection = DtDetection.Select("IsUpdatedRow = True");
                            foreach (var item in updatedRowsDtDetection)
                                item["IsUpdatedRow"] = false;
                        }
                        if (DtModule != null && DtModule.Rows.Count > 0)
                        {
                            var updatedRowsDtModule = DtModule.Select("IsUpdatedRow = True");
                            foreach (var item in updatedRowsDtModule)
                                item["IsUpdatedRow"] = false;
                        }
                        UpdatedItem.Currency.CurrencyIconImage = iSource;
                        var i = 0;
                        foreach (var item in aCListSource)
                            UpdatedItem.AddCurrencyList[i++].CurrencyIconImage = item;
                        i = 0;
                        foreach (var item in cListSource)
                            UpdatedItem.CurrencyList[i++].CurrencyIconImage = item;
                        i = 0;
                        foreach (var item in cListClonedSource)
                            UpdatedItem.CurrencyList_Cloned[i++].CurrencyIconImage = item;
                        i = 0;
                        foreach (var item in uCListSource)
                            UpdatedItem.UpdateCurrencyList[i++].CurrencyIconImage = item;
                        AddArticles = new List<ulong>();
                        DeleteArticles = new List<Articles>();
                        AddDetections = new List<ulong>();
                        DeleteDetections = new List<Detections>();
                        AddModules = new List<ulong>();
                        DeleteModules = new List<BPLModule>();
                    }


                    if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }

                    CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("BasePriceUpdateSuccess").ToString()), Application.Current.Resources["PopUpSuccessColor"].ToString(), CustomMessageBox.MessageImagePath.Ok, MessageBoxButton.OK);
                    #region synchronization
                    //[001] Added code for synchronization
                    if (GeosApplication.Instance.IsPLMPermissionNameECOS_Synchronization == true)
                    {
                        GeosAppSettingList = WorkbenchService.GetSelectedGeosAppSettings("59,60,61");
                        if (GeosAppSettingList != null && GeosAppSettingList.Count != 0)
                        {
                            if (GeosAppSettingList.Any(i => i.IdAppSetting == 59) && GeosAppSettingList.Any(i => i.IdAppSetting == 60) && GeosAppSettingList.Any(i => i.IdAppSetting == 61) && UpdatedItem.IdStatus == 223)
                            {
                                if ((!string.IsNullOrEmpty((GeosAppSettingList[0].DefaultValue))) && (!string.IsNullOrEmpty((GeosAppSettingList[1].DefaultValue))) && (!string.IsNullOrEmpty((GeosAppSettingList[2].DefaultValue))))    //(!string.IsNullOrEmpty((GeosAppSettingList[0].DefaultValue))) // && (GeosAppSettingList[1].DefaultValue)))  //.Where(i => i.IdAppSetting == 57).Select(x => x.DefaultValue)))) // && (GeosAppSettingList[1].DefaultValue))) // Where(i => i.IdAppSetting == 57).FirstOrDefault().DefaultValue.to)
                                {

                                    #region synchronization Code
                                    try
                                    {
                                        MessageBoxResult MessageBoxResult = MessageBoxResult = CustomMessageBox.Show(string.Format(Application.Current.Resources["ECOSSynchronizationWarningMessage"].ToString()), "Yellow", CustomMessageBox.MessageImagePath.Warning, MessageBoxButton.YesNo);
                                        if (MessageBoxResult == MessageBoxResult.Yes)
                                        {
                                            List<Articles> LstArticles = PCMService.GetAllStatusPCMArticles();
                                            if (!DXSplashScreen.IsActive)
                                            {
                                                DXSplashScreen.Show(x =>
                                                {
                                                    Window win = new Window()
                                                    {
                                                        Focusable = true,
                                                        ShowActivated = false,
                                                        WindowStyle = WindowStyle.None,
                                                        ResizeMode = ResizeMode.NoResize,
                                                        AllowsTransparency = false,
                                                        Background = new SolidColorBrush(Colors.Transparent),
                                                        ShowInTaskbar = false,
                                                        Topmost = false,
                                                        SizeToContent = SizeToContent.WidthAndHeight,
                                                        WindowStartupLocation = WindowStartupLocation.CenterScreen,
                                                    };
                                                    WindowFadeAnimationBehavior.SetEnableAnimation(win, true);
                                                    return win;
                                                }, x =>
                                                {
                                                    return new SplashScreenView() { DataContext = new SplashScreenViewModel() };
                                                }, null, null);
                                            }
                                            GeosApplication.Instance.SplashScreenMessage = "Synchronization is running";



                                            APIErrorDetailForErrorFalse valuesErrorFalse = new APIErrorDetailForErrorFalse();
                                            APIErrorDetail values = new APIErrorDetail();
                                            List<ErrorDetails> LstErrorDetail = new List<ErrorDetails>();
                                            tokenService = new AuthTokenService();
                                            if (GeosAppSettingList.Any(i => i.IdAppSetting == 59))
                                            {

                                                string[] tokeninformations = GeosAppSettingList.Where(i => i.IdAppSetting == 59).FirstOrDefault().DefaultValue.Split(';');
                                                if (tokeninformations.Count() >= 2)
                                                {

                                                    List<string> articlesSynchronization = new List<string>();
                                                    List<Site> plantSynchronization = new List<Site>();
                                                    List<Currency> currencySynchronization = new List<Currency>();

                                                    if (UpdatedItem.AddArticleList != null && UpdatedItem.AddArticleList.Count > 0)
                                                    {
                                                        foreach (BasePriceListByItem item in UpdatedItem.AddArticleList)
                                                        {
                                                            if (LstArticles.Any(i => i.IdArticle == item.IdArticle))
                                                                if (!articlesSynchronization.Any(asy => asy.ToUpper() == LstArticles.Where(i => i.IdArticle == item.IdArticle).FirstOrDefault().Reference.ToUpper()))
                                                                    articlesSynchronization.Add(LstArticles.Where(i => i.IdArticle == item.IdArticle).FirstOrDefault().Reference);
                                                        }
                                                    }
                                                    if (UpdatedItem.UpdateArticleList != null && UpdatedItem.UpdateArticleList.Count > 0)
                                                    {
                                                        foreach (BasePriceListByItem item in UpdatedItem.UpdateArticleList)
                                                        {
                                                            if (LstArticles.Any(i => i.IdArticle == item.IdArticle))
                                                                if (!articlesSynchronization.Any(asy => asy.ToUpper() == LstArticles.Where(i => i.IdArticle == item.IdArticle).FirstOrDefault().Reference.ToUpper()))
                                                                    articlesSynchronization.Add(LstArticles.Where(i => i.IdArticle == item.IdArticle).FirstOrDefault().Reference);
                                                        }
                                                    }
                                                    if (UpdatedItem.DeleteArticleList != null && UpdatedItem.DeleteArticleList.Count > 0)
                                                    {
                                                        foreach (Articles item in UpdatedItem.DeleteArticleList)
                                                        {
                                                            if (LstArticles.Any(i => i.IdArticle == item.IdArticle))
                                                                if (!articlesSynchronization.Any(asy => asy.ToUpper() == LstArticles.Where(i => i.IdArticle == item.IdArticle).FirstOrDefault().Reference.ToUpper()))
                                                                    articlesSynchronization.Add(LstArticles.Where(i => i.IdArticle == item.IdArticle).FirstOrDefault().Reference);
                                                        }
                                                    }


                                                    if (articlesSynchronization != null && articlesSynchronization.Count > 0 && UpdatedItem.PlantCurrencyList.Where(i => i.PlantbyCurrency == 1).ToList() != null && UpdatedItem.PlantCurrencyList.Where(i => i.PlantbyCurrency == 1).ToList().Count > 0)
                                                    {
                                                        string references = string.Join(",", articlesSynchronization.ToArray());

                                                        if (GeosAppSettingList.Any(i => i.IdAppSetting == 61))
                                                        {

                                                            foreach (BasePriceListByPlantCurrency itemBasePriceListByPlantCurrency in UpdatedItem.PlantCurrencyList.Where(i => i.PlantbyCurrency == 1).Distinct())
                                                            {
                                                                GeosApplication.Instance.SplashScreenMessage = "Articles Synchronization is running for plant " + itemBasePriceListByPlantCurrency.PlantName + " and currency " + itemBasePriceListByPlantCurrency.CurrencyName + "";
                                                                List<ErrorDetails> TempLstErrorDetail = await PLMService.IsPLMUpdateEditBasePriceSynchronization(GeosAppSettingList, itemBasePriceListByPlantCurrency, LstArticles);

                                                                foreach (ErrorDetails item in TempLstErrorDetail)
                                                                {
                                                                    if (item != null && item.Error == string.Empty)
                                                                    {
                                                                        GeosApplication.Instance.SplashScreenMessage = "Articles Synchronization is Done for plant " + itemBasePriceListByPlantCurrency.PlantName + " and currency " + itemBasePriceListByPlantCurrency.CurrencyName + "";
                                                                    }
                                                                    else
                                                                    {
                                                                        if (item != null && item.Error != null)
                                                                        {
                                                                            GeosApplication.Instance.SplashScreenMessage = "Articles Synchronization is failed for plant " + itemBasePriceListByPlantCurrency.PlantName + " and currency " + itemBasePriceListByPlantCurrency.CurrencyName + "";
                                                                            ErrorDetails errorDetails = new ErrorDetails();
                                                                            errorDetails.CompanyName = itemBasePriceListByPlantCurrency.PlantName;
                                                                            errorDetails.CurrencyName = itemBasePriceListByPlantCurrency.CurrencyName;
                                                                            errorDetails.Error = values.Message._Message;
                                                                            LstErrorDetail.Add(errorDetails);
                                                                        }
                                                                    }
                                                                }


                                                            }




                                                        }
                                                    }
                                                    if ((UpdatedItem.AddDetectionList != null && UpdatedItem.AddDetectionList.Count > 0) || (UpdatedItem.UpdateDetectionList != null && UpdatedItem.UpdateDetectionList.Count > 0) || (UpdatedItem.DeleteDetectionList != null && UpdatedItem.DeleteDetectionList.Count > 0))
                                                    {
                                                        if (GeosAppSettingList.Any(i => i.IdAppSetting == 60))
                                                        {
                                                            foreach (BasePriceListByPlantCurrency itemBasePriceListByPlantCurrency in UpdatedItem.PlantCurrencyList.Distinct())
                                                            {
                                                                GeosApplication.Instance.SplashScreenMessage = "Detections Synchronization is running for plant " + itemBasePriceListByPlantCurrency.PlantName + " and currency " + itemBasePriceListByPlantCurrency.CurrencyName + "";

                                                                List<ErrorDetails> TempLstErrorDetail = await PLMService.IsPLMUpdateEditBasePriceSynchronization(GeosAppSettingList, itemBasePriceListByPlantCurrency, LstArticles);

                                                                foreach (ErrorDetails item in TempLstErrorDetail)
                                                                {
                                                                    if (item != null && item.Error == string.Empty)
                                                                    {
                                                                        GeosApplication.Instance.SplashScreenMessage = "Detections Synchronization is done for plant " + itemBasePriceListByPlantCurrency.PlantName + " and currency " + itemBasePriceListByPlantCurrency.CurrencyName + "";
                                                                    }
                                                                    else
                                                                    {
                                                                        if (item != null && item.Error != null)
                                                                        {
                                                                            GeosApplication.Instance.SplashScreenMessage = "Detections Synchronization is failed for plant " + itemBasePriceListByPlantCurrency.PlantName + " and currency " + itemBasePriceListByPlantCurrency.CurrencyName + "";
                                                                            ErrorDetails errorDetails = new ErrorDetails();
                                                                            errorDetails.CompanyName = itemBasePriceListByPlantCurrency.PlantName;
                                                                            errorDetails.CurrencyName = itemBasePriceListByPlantCurrency.CurrencyName;
                                                                            errorDetails.Error = values.Message._Message;
                                                                            LstErrorDetail.Add(errorDetails);
                                                                        }
                                                                    }
                                                                }




                                                            }


                                                        }
                                                    }
                                                    if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                                                    if (LstErrorDetail != null && LstErrorDetail.Count > 0)
                                                    {
                                                        String FinalMessage = null;
                                                        string msg = string.Empty;
                                                        foreach (ErrorDetails item in LstErrorDetail)
                                                        {

                                                            if (string.IsNullOrEmpty(FinalMessage))
                                                                FinalMessage = string.Format(System.Windows.Application.Current.FindResource("PLMSynchronizationFailedForFollowingReasons").ToString() + System.Environment.NewLine + string.Format(System.Windows.Application.Current.FindResource("PLMSynchronizationFailedCompanyCurrency").ToString(), item.CompanyName, item.CurrencyName, item.Error));
                                                            else
                                                                FinalMessage += System.Environment.NewLine + string.Format(System.Windows.Application.Current.FindResource("PLMSynchronizationFailedCompanyCurrency").ToString(), item.CompanyName, item.CurrencyName, item.Error);

                                                        }
                                                        if (!string.IsNullOrEmpty(FinalMessage))
                                                        {
                                                            CustomMessageBox.Show(FinalMessage, "Red", CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                                                        }
                                                    }
                                                    else
                                                    {
                                                        CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("ECOSSynchronizationSuccess").ToString()), Application.Current.Resources["PopUpSuccessColor"].ToString(), CustomMessageBox.MessageImagePath.Ok, MessageBoxButton.OK);
                                                    }

                                                }
                                            }
                                        }

                                        GeosApplication.Instance.Logger.Log(string.Format("Method Init()....executed AcceptButtonCommandAction"), category: Category.Info, priority: Priority.Low);
                                    }
                                    catch (Exception ex)
                                    {
                                        GeosApplication.Instance.SplashScreenMessage = "Synchronization failed";
                                        if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                                        CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("ECOSSynchronizationFailed").ToString(), ex.Message), "Red", CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);

                                    }
                                    GeosApplication.Instance.SplashScreenMessage = string.Empty;
                                    #endregion                           

                                }
                            }
                        }
                    }
                    #endregion
                    if (SaveButtonVisibility == Visibility.Visible && !isSaveButtonClicked)
                    {

                        RequestClose(null, null);
                        isEnabledSaveButton = false;
                    }

                    #endregion
                }
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Method AcceptButtonCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log(string.Format("Error in method AcceptButtonCommandAction() - {0}", ex.Detail.ErrorMessage), category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }

                GeosApplication.Instance.Logger.Log(string.Format("Error in method AcceptButtonCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }

                GeosApplication.Instance.Logger.Log(string.Format("Error in method AcceptButtonCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void SaveButtonCommandAction()
        {
            isSaveButtonClicked = true;
            AcceptButtonCommandAction(null);
            IsEnabledSaveButton = false;
            isSaveButtonClicked = false;
        }

        private void AddChangeLogList(List<BasePriceListByPlantCurrency> plantCurrency)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method AddChangeLogList()...", category: Category.Info, priority: Priority.Low);

                if (plantCurrency == null)
                    plantCurrency = new List<BasePriceListByPlantCurrency>();

                List<string> plants = new List<string>();
                List<string> currency = new List<string>();
                if (IsNew)
                {
                    foreach (Site eachPlant in SelectedPlant)
                    {
                        currency = plantCurrency.Where(x => x.PlantbyCurrency == 1 && x.PlantName == eachPlant.Name).Select(x => x.CurrencyName).ToList();
                        allCurrenies = string.Join(", ", currency);
                        BasePriceChangeLogList.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("BasePriceChangeLogAdd").ToString(), eachPlant.Name, allCurrenies) });
                        currency.Clear();
                        allCurrenies = string.Empty;
                    }
                }
                else
                {
                    List<string> originalCurriencyList = new List<string>();
                    List<string> originalPlantsList = new List<string>();
                    string removeCurrency = string.Empty;
                    foreach (Site plant in SelectedPlant)
                    {
                        allCurrenies = string.Empty;
                        List<BasePriceListByPlantCurrency> originalforEachPlant = new List<BasePriceListByPlantCurrency>();
                        List<BasePriceListByPlantCurrency> modifiedforEachPlant = new List<BasePriceListByPlantCurrency>();
                        originalforEachPlant = ClonedBasePrice.PlantCurrencyList.Where(x => x.PlantName == plant.Name).ToList();
                        modifiedforEachPlant = plantCurrency.Where(x => x.PlantName == plant.Name).ToList();
                        if (!originalforEachPlant.Any(x => x.PlantName == plant.Name))
                        {
                            currency = plantCurrency.Where(x => x.PlantbyCurrency == 1 && x.PlantName == plant.Name).Select(x => x.CurrencyName).ToList();

                            allCurrenies = string.Join(", ", currency);
                            ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("BasePriceChangeLogAdd").ToString(), plant.Name, allCurrenies) });
                            currency.Clear();
                            allCurrenies = string.Empty;
                        }
                        else
                        {
                            foreach (Currency cur in SelectedSaleCurrency)
                            {
                                originalCurriencyList = ClonedBasePrice.PlantCurrencyList.Where(x => x.PlantName == plant.Name).Select(x => x.CurrencyName).ToList();
                                bool checkCurrency = originalforEachPlant.Any(x => x.CurrencyName == cur.Name);
                                if (!checkCurrency)
                                {
                                    currency = plantCurrency.Where(x => x.PlantName == plant.Name).Select(x => x.CurrencyName).ToList();

                                    foreach (string eachCur in currency)
                                    {
                                        int isCheckCurrency = plantCurrency.Where(x => x.CurrencyName == cur.Name && x.PlantName == plant.Name).Select(x => x.PlantbyCurrency).FirstOrDefault();
                                        if (!originalCurriencyList.Contains(eachCur))
                                        {
                                            if (isCheckCurrency == 1)
                                            {
                                                if (string.IsNullOrEmpty(allCurrenies))
                                                    allCurrenies = eachCur;
                                                else
                                                    allCurrenies += ", " + eachCur;
                                            }
                                        }
                                    }
                                    if (!string.IsNullOrEmpty(allCurrenies))
                                    {
                                        if (!plants.Contains(plant.Name))
                                        {
                                            plants.Add(plant.Name);
                                            ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("BasePriceChangeLogAdd").ToString(), plant.Name, allCurrenies) });
                                        }
                                        else
                                        {
                                            string message = string.Format(System.Windows.Application.Current.FindResource("BasePriceChangeLogAdd").ToString(), plant.Name, allCurrenies);
                                            if (!ChangedLogsEntries.Any(x => x.Comments == message))
                                            {
                                                ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("BasePriceChangeLogAdd").ToString(), plant.Name, allCurrenies) });
                                            }
                                        }
                                    }
                                    currency.Clear();
                                    allCurrenies = string.Empty;
                                    removeCurrency = string.Empty;
                                }
                                else
                                {
                                    if (!plants.Contains(plant.Name))
                                    {
                                        foreach (string cur1 in originalCurriencyList)
                                        {
                                            int isOriginalcheckplantbycurrency1 = ClonedBasePrice.PlantCurrencyList.Where(x => x.CurrencyName == cur1 && x.PlantName == plant.Name).Select(x => x.PlantbyCurrency).FirstOrDefault();
                                            int isModifiedcheckplantbycurrency1 = plantCurrency.Where(x => x.CurrencyName == cur1 && x.PlantName == plant.Name).Select(x => x.PlantbyCurrency).FirstOrDefault();
                                            if (!isOriginalcheckplantbycurrency1.Equals(isModifiedcheckplantbycurrency1))    //(!checkPlantByCurrency1)
                                            {
                                                if (isModifiedcheckplantbycurrency1 == 0)
                                                {
                                                    if (string.IsNullOrEmpty(removeCurrency))
                                                        removeCurrency = cur1;
                                                    else
                                                        removeCurrency += ", " + cur1;
                                                }
                                                else
                                                {
                                                    if (string.IsNullOrEmpty(allCurrenies))
                                                        allCurrenies = cur1;
                                                    else
                                                        allCurrenies += ", " + cur1;
                                                }
                                            }

                                        }
                                        if (!plants.Contains(plant.Name))
                                        {
                                            plants.Add(plant.Name);
                                        }
                                        if (!string.IsNullOrEmpty(removeCurrency))
                                        {
                                            ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("BasePriceChangeLogRemove").ToString(), plant.Name, removeCurrency) });
                                        }
                                        if (!string.IsNullOrEmpty(allCurrenies))
                                        {
                                            ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("BasePriceChangeLogAdd").ToString(), plant.Name, allCurrenies) });
                                        }
                                        currency.Clear();
                                        allCurrenies = string.Empty;
                                        removeCurrency = string.Empty;
                                    }
                                }
                            }
                            List<string> currenciey = new List<string>();
                            currenciey = ClonedBasePrice.PlantCurrencyList.Where(x => x.PlantName == plant.Name).Select(x => x.CurrencyName).ToList();
                            foreach (string cur in currenciey)
                            {
                                if (!SelectedSaleCurrency.Cast<Currency>().Any(x => x.Name == cur))
                                {
                                    if (string.IsNullOrEmpty(removeCurrency))
                                        removeCurrency = cur;
                                    else
                                        removeCurrency += ", " + cur;
                                }

                            }
                            if (!string.IsNullOrEmpty(removeCurrency))
                            {
                                if (!plants.Contains(plant.Name))
                                {
                                    plants.Add(plant.Name);
                                    ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("BasePriceChangeLogRemove").ToString(), plant.Name, removeCurrency) });
                                }
                            }
                            currency.Clear();
                            removeCurrency = string.Empty;
                            allCurrenies = string.Empty;
                        }
                    }

                    plants.Clear();
                    foreach (BasePriceListByPlantCurrency original in ClonedBasePrice.PlantCurrencyList)
                    {
                        if (!plantCurrency.Any(x => x.PlantName == original.PlantName) && !plants.Contains(original.PlantName))
                        {
                            currency = ClonedBasePrice.PlantCurrencyList.Where(x => x.PlantName == original.PlantName && x.PlantbyCurrency == 1).Select(x => x.CurrencyName).Distinct().ToList();

                            removeCurrency = string.Join(", ", currency);
                            ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("BasePriceChangeLogRemove").ToString(), original.PlantName, removeCurrency) });
                            currency.Clear();
                            allCurrenies = string.Empty;
                            removeCurrency = string.Empty;
                            plants.Add(original.PlantName);
                        }
                    }
                }
                GeosApplication.Instance.Logger.Log("Method AddChangeLogList()... Executed Successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method AddChangeLogList()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        //GEOS2-6688 PCM- Improve performance to open BPL grid and any BPL
        public void EditInitAsync(string selectedHeader)
        {
            try
            {
                DateTime start = DateTime.Now;
                GeosApplication.Instance.Logger.Log(string.Format("Method EditInitNew..."), category: Category.Info, priority: Priority.Low);
                MaximizedElementPosition = PLMCommon.Instance.SetMaximizedElementPosition();
                //PLMService = new PLMServiceController("localhost:6699");
                FillLanguages();
                GetPlants();
                GetCurrencies();
                GetSaleCurrencies();
                //GetLatestBasePriceCode();
                FillStatusList();
                //FillExchangeRateList();

                //FillReferenceView();
                //FillDetectionsMenuList();

                //FillLogicList();
                ////Shubham[skadam] GEOS2-2885 [Only Modules ] - Search the Article categories (and sub-categories), Modules and Detection (DOWS) in BPL [3/3][#PLM09]  15 03 2023
                //FillModuleMenuList();

                DateTime end = DateTime.Now;
                TimeSpan timeDifference = end - start;
                GeosApplication.Instance.Logger.Log("Method EditInitAsync() executed successfully " + $"Total Seconds: {timeDifference.TotalSeconds}", category: Category.Info, priority: Priority.Low);
                GeosApplication.Instance.Logger.Log(string.Format("Method EditInitAsync()....executed successfully"), category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method EditInitAsync() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method EditInitAsync() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method EditInitAsync() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        public void EditInit(string selectedHeader)
        {
            try
            {
                GeosApplication.Instance.Logger.Log(string.Format("Method EditInit..."), category: Category.Info, priority: Priority.Low);
                MaximizedElementPosition = PLMCommon.Instance.SetMaximizedElementPosition();
                //PLMService = new PLMServiceController("localhost:6699");
                FillLanguages();
                GetPlants();
                GetCurrencies();
                GetSaleCurrencies();
                GetLatestBasePriceCode();
                FillStatusList();
                FillExchangeRateList();

                FillReferenceView();
                FillDetectionsMenuList();

                FillLogicList();
                //Shubham[skadam] GEOS2-2885 [Only Modules ] - Search the Article categories (and sub-categories), Modules and Detection (DOWS) in BPL [3/3][#PLM09]  15 03 2023
                FillModuleMenuList();
                GeosApplication.Instance.Logger.Log(string.Format("Method EditInit()....executed successfully"), category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method EditInit() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method EditInit() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method EditInit() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        //GEOS2-6688 PCM- Improve performance to open BPL grid and any BPL
        public async Task LoadAllDataInBackground()
        {

            try
            {
                GeosApplication.Instance.Logger.Log("Method LoadAllDataInBackground() started", category: Category.Info, priority: Priority.Low);

                // Execute all async operations
                await System.Threading.Tasks.Task.WhenAll(
                    FillLanguagesAsync(),
                    GetCurrenciesAsync(),
                    GetSaleCurrenciesAsync(),
                    GetPlantsAsync(),
                    GetLatestBasePriceCodeAsync(),
                    FillStatusListAsync(),
                    FillExchangeRateListAsync(),
                    FillReferenceViewAsync(),
                    FillDetectionsMenuListAsync(),
                    FillLogicListAsync(),
                    FillModuleMenuListAsync(),
                    FillCurrencyConversionList_AllAsync()
                );

                GeosApplication.Instance.Logger.Log("Method LoadAllDataInBackground() completed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                // Log error on background thread
                GeosApplication.Instance.Logger.Log($"Error in method LoadAllDataInBackground() - {ex.Message}", category: Category.Exception, priority: Priority.Low);

                // Show error message on UI thread if needed
                System.Windows.Application.Current.Dispatcher.Invoke(() =>
                {
                    try
                    {
                        CustomMessageBox.Show($"Error loading data: {ex.Message}",
                            Application.Current.Resources["PopUpWarningColor"].ToString(),
                            CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                    }
                    catch (Exception uiEx)
                    {
                        GeosApplication.Instance.Logger.Log($"Error showing message box: {uiEx.Message}", category: Category.Exception, priority: Priority.Low);
                    }
                });
            }
        }

        public void LoadArticleCostPriceListAsyncDataInBackground(byte IdCurrency)
        {
            // Fire-and-forget with error logging
            _ = System.Threading.Tasks.Task.Run(async () =>
            {
                try
                {
                    await System.Threading.Tasks.Task.WhenAll(
                       FillArticleCostPriceListAsync(IdCurrency)
                    );
                }
                catch (Exception ex)
                {
                    GeosApplication.Instance.Logger.Log(string.Format("Error in method LoadAllDataInBackground() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                }
            });
        }

        public void FillArticleDetectionModuleAsyncDataDataInBackground()
        {
            // Fire-and-forget with error logging
            _ = System.Threading.Tasks.Task.Run(async () =>
            {
                try
                {
                    await System.Threading.Tasks.Task.WhenAll(
                        AddColumnsToArticleDataTableAsync(),
                        AddColumnsToDetectionDataTableAsync(),
                        AddColumnsToModuleDataTableAsync(),
                        AddEditColumnsToPlantsDataTableAsync(),
                        FillArticleDataAsync(),
                        FillDetectionDataAsync(),
                        FillModuleDataAsync()
                        );
                }
                catch (Exception ex)
                {
                    GeosApplication.Instance.Logger.Log(string.Format("Error in method LoadAllDataInBackground() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                }
            });
        }

        public void FillMenuListDataInBackground(BasePrice temp)
        {
            // Fire-and-forget with error logging
            _ = System.Threading.Tasks.Task.Run(async () =>
            {
                try
                {
                    await System.Threading.Tasks.Task.WhenAll(FillMenuListDataAsync(temp));
                }
                catch (Exception ex)
                {
                    GeosApplication.Instance.Logger.Log(string.Format("Error in method LoadAllDataInBackground() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                }
            });
        }
        // Your concurrent method runner

        public async Task LoadAllDataAsync()
        {
            // Start all tasks immediately
            // var task1 = FillLanguagesAsync();
            // var task2 = GetCurrenciesAsync();
            // var task3 = GetSaleCurrenciesAsync();
            // var task4 = GetPlantsAsync();
            //// var task5 = FillArticleCostPriceListAsync();
            // var task6 = GetLatestBasePriceCodeAsync();
            // var task7 = FillStatusListAsync();
            // var task8 = FillExchangeRateListAsync();
            // var task9 = FillReferenceViewAsync();
            // var task10 = FillDetectionsMenuListAsync();
            // var task11 = FillLogicListAsync();
            // var task12 = FillModuleMenuListAsync();
            //await System.Threading.Tasks.Task.WhenAll(
            //    FillLanguagesAsync(),
            //    GetCurrenciesAsync(),
            //    GetSaleCurrenciesAsync(),
            //    GetPlantsAsync(),
            //    //FillArticleCostPriceListAsync(),
            //    GetLatestBasePriceCodeAsync(),
            //    FillStatusListAsync(),
            //    FillExchangeRateListAsync(),
            //    FillReferenceViewAsync(),
            //    FillDetectionsMenuListAsync(),
            //    FillLogicListAsync(),
            //    FillModuleMenuListAsync()
            //);
        }
        //GEOS2-6688 PCM- Improve performance to open BPL grid and any BPL
        // Sample async instance methods
        private async Task GetCurrenciesAsync()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method GetCurrenciesAsync()...", category: Category.Info, priority: Priority.Low);
                //CurrencyList = new ObservableCollection<Currency>(PLMService.GetCurrencies_V2160());
                //[pramod.misal][16.04.2025][GEOS2-6688]
                if (PLMCommon.Instance.CurrencyList == null || PLMCommon.Instance.CurrencyList?.Count == 0)
                {
                    PLMCommon.Instance.CurrencyList = new ObservableCollection<Currency>(PLMService.GetCurrencies_V2160());
                    //CurrencyList = PLMCommon.Instance.CurrencyList;
                }
                if (PLMCommon.Instance.CurrencyList != null)
                {
                    CurrencyList = PLMCommon.Instance.CurrencyList;
                }

                if (CurrencyList != null)
                {
                    foreach (var bpItem in CurrencyList.GroupBy(tpa => tpa.Name))
                    {
                        ImageSource currencyFlagImage = ByteArrayToBitmapImage(bpItem.ToList().FirstOrDefault().CurrencyIconbytes);
                        bpItem.ToList().Where(oti => oti.Name == bpItem.Key).ToList().ForEach(oti => oti.CurrencyIconImage = currencyFlagImage);

                    }
                }
                GeosApplication.Instance.Logger.Log("Method GetCurrenciesAsync()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in GetCurrenciesAsync() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in GetCurrenciesAsync() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method GetCurrenciesAsync() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        //GEOS2-6688 PCM- Improve performance to open BPL grid and any BPL
        private async Task GetSaleCurrenciesAsync()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method GetSaleCurrencies()...", category: Category.Info, priority: Priority.Low);
                //[pramod.misal][16.04.2025][GEOS2-6688]
                if (PLMCommon.Instance.SaleCurrencyList == null || PLMCommon.Instance.SaleCurrencyList?.Count == 0)
                {
                    //PLMCommon.Instance.SaleCurrencyList = new ObservableCollection<Currency>(PLMService.GetCurrencies_V2160());
                    PLMCommon.Instance.SaleCurrencyList = PLMCommon.Instance.CurrencyList;
                }
                if (PLMCommon.Instance.SaleCurrencyList != null)
                {
                    SaleCurrencyList = PLMCommon.Instance.SaleCurrencyList;
                }
                if (SaleCurrencyList != null)
                {
                    foreach (var bpItem in SaleCurrencyList.GroupBy(tpa => tpa.Name))
                    {
                        ImageSource currencyFlagImage = ByteArrayToBitmapImage(bpItem.ToList().FirstOrDefault().CurrencyIconbytes);
                        bpItem.ToList().Where(oti => oti.Name == bpItem.Key).ToList().ForEach(oti => oti.CurrencyIconImage = currencyFlagImage);

                    }
                }
                GeosApplication.Instance.Logger.Log("Method GetSaleCurrencies()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (FaultException<ServiceException> ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in GetSaleCurrencies() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in GetSaleCurrencies() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method GetCurrencies() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        //GEOS2-6688 PCM- Improve performance to open BPL grid and any BPL
        private async Task GetPlantsAsync()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method GetPlantsAsync()...", category: Category.Info, priority: Priority.Low);
                //[pramod.misal][16.04.2025][GEOS2-6688]
                if (PLMCommon.Instance.PlantList == null || PLMCommon.Instance.PlantList?.Count == 0)
                {
                    PLMCommon.Instance.PlantList = new ObservableCollection<Site>(PLMService.GetPlants_V2120());

                }
                if (PLMCommon.Instance.PlantList != null)
                {
                    PlantList = PLMCommon.Instance.PlantList;
                }
                GeosApplication.Instance.Logger.Log("Method GetPlantsAsync()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in GetPlantsAsync() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in GetPlantsAsync() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method GetPlantsAsync() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        //GEOS2-6688 PCM- Improve performance to open BPL grid and any BPL
        public async Task FillLanguagesAsync()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillLanguagesAsync()...", category: Category.Info, priority: Priority.Low);
                //[pramod.misal][16.04.2025][GEOS2-6688]
                if (PLMCommon.Instance.Languages == null || PLMCommon.Instance.Languages?.Count == 0)
                {
                    //Languages = new ObservableCollection<Language>(PLMService.GetLanguages());
                    PLMCommon.Instance.Languages = new ObservableCollection<Language>(PLMService.GetLanguages());

                }
                if (PLMCommon.Instance.Languages != null)
                {
                    Languages = PLMCommon.Instance.Languages;
                    LanguageSelected = Languages.FirstOrDefault();
                }
                GeosApplication.Instance.Logger.Log("Method FillLanguagesAsync()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (FaultException<ServiceException> ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillLanguagesAsync() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillLanguagesAsync() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method FillLanguagesAsync() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        //GEOS2-6688 PCM- Improve performance to open BPL grid and any BPL
        private async Task FillArticleCostPriceListAsync()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillArticleCostPriceList ...", category: Category.Info, priority: Priority.Low);
                if (PLMCommon.Instance.ArticleCostPriceList == null | PLMCommon.Instance.ArticleCostPriceList?.Count == 0)
                {
                    PLMCommon.Instance.ArticleCostPriceList = new List<ArticleCostPrice>(PLMService.GetArticleCostPricesByCurrency_V2160(((Currency)SelectedCurrency).IdCurrency));
                    ArticleCostPriceList = PLMCommon.Instance.ArticleCostPriceList;
                }
                else
                {
                    ArticleCostPriceList = PLMCommon.Instance.ArticleCostPriceList;
                }
                //ArticleCostPriceList = new List<ArticleCostPrice>(PLMService.GetArticleCostPricesByCurrency_V2160(((Currency)SelectedCurrency).IdCurrency));
                GeosApplication.Instance.Logger.Log("Method FillArticleCostPriceList() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in FillArticleCostPriceList() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), "Red", CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in FillArticleCostPriceList() Method - ServiceUnexceptedException " + ex.Message, category: Category.Info, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillArticleCostPriceList() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        //GEOS2-6688 PCM- Improve performance to open BPL grid and any BPL
        private async Task FillArticleCostPriceListAsync(byte IdCurrency)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillArticleCostPriceListAsync ...", category: Category.Info, priority: Priority.Low);
                ArticleCostPriceList = new List<ArticleCostPrice>();
                DateTime start = DateTime.Now;
                ArticleCostPriceList = new List<ArticleCostPrice>(PLMService.GetArticleCostPricesByCurrency_V2160(IdCurrency));
                DateTime end = DateTime.Now;
                TimeSpan timeDifference = end - start;
                //PLMService = new PLMServiceController(GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString());
                GeosApplication.Instance.Logger.Log("Method FillArticleCostPriceListAsync() executed successfully " + $"Total Seconds: {timeDifference.TotalSeconds}", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in FillArticleCostPriceList() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), "Red", CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in FillArticleCostPriceListAsync() Method - ServiceUnexceptedException " + ex.Message, category: Category.Info, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillArticleCostPriceListAsync() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        //GEOS2-6688 PCM- Improve performance to open BPL grid and any BPL
        private async Task GetLatestBasePriceCodeAsync()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method GetLatestBasePriceCode()...", category: Category.Info, priority: Priority.Low);

                //if (!isDuplicateCliked)
                //    SelectedBasePriceCode = PLMService.GetLatestBasePriceCode();
                //else
                //    DuplicateCode = PLMService.GetLatestBasePriceCode();


                //[pramod.misal][16.04.2025][GEOS2-6688]
                if (PLMCommon.Instance.SelectedBasePriceCode == null)
                {
                    if (!isDuplicateCliked)
                    {
                        PLMCommon.Instance.SelectedBasePriceCode = PLMService.GetLatestBasePriceCode();
                    }
                    else
                    {
                        PLMCommon.Instance.DuplicateCode = PLMService.GetLatestBasePriceCode();

                    }

                }

                if (PLMCommon.Instance.SelectedBasePriceCode != null)
                {
                    SelectedBasePriceCode = PLMCommon.Instance.SelectedBasePriceCode;

                }
                if (PLMCommon.Instance.DuplicateCode != null)
                {
                    DuplicateCode = PLMCommon.Instance.DuplicateCode;
                }


                GeosApplication.Instance.Logger.Log("Method GetLatestBasePriceCode()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (FaultException<ServiceException> ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in GetLatestBasePriceCode() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in GetLatestBasePriceCode() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method GetLatestBasePriceCode() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        //GEOS2-6688 PCM- Improve performance to open BPL grid and any BPL
        private async Task FillStatusListAsync()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillStatusListAsync()...", category: Category.Info, priority: Priority.Low);

                //[pramod.misal][16.04.2025][GEOS2-6688]
                if (PLMCommon.Instance.TempStatusList == null || PLMCommon.Instance.TempStatusList?.Count == 0)
                {
                    PLMCommon.Instance.TempStatusList = PCMService.GetLookupValues(45);

                }
                if (PLMCommon.Instance.TempStatusList != null)
                {
                    IList<LookupValue> tempStatusList = PLMCommon.Instance.TempStatusList;
                    StatusList = new List<LookupValue>();
                    StatusList = new List<LookupValue>(tempStatusList);
                }
                GeosApplication.Instance.Logger.Log("Method FillStatusListAsync()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillStatusListAsync() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillStatusListAsync() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method FillStatusListAsync() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        //GEOS2-6688 PCM- Improve performance to open BPL grid and any BPL
        private async Task FillExchangeRateListAsync()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillExchangeRateListAsync()...", category: Category.Info, priority: Priority.Low);

                //IList<LookupValue> tempExchangeRateList = PCMService.GetLookupValues(75); // need to check Lookup key and values
                //ExchangeRateList = new List<LookupValue>();
                //ExchangeRateList = new List<LookupValue>(tempExchangeRateList.Where(inUseOption => inUseOption.InUse == true));

                //SelectedExchangeRate = ExchangeRateList.FirstOrDefault();
                //SelectedExchangeRateIndex = ExchangeRateList.FindIndex(x => x.IdLookupValue == SelectedExchangeRate.IdLookupValue);

                //[pramod.misal][16.04.2025][GEOS2-6688]
                if (PLMCommon.Instance.TempExchangeRateList == null || PLMCommon.Instance.TempExchangeRateList?.Count == 0)
                {
                    PLMCommon.Instance.TempExchangeRateList = PCMService.GetLookupValues(75);

                }
                if (PLMCommon.Instance.TempExchangeRateList != null)
                {
                    IList<LookupValue> tempExchangeRateList = PLMCommon.Instance.TempExchangeRateList;
                    ExchangeRateList = new List<LookupValue>();
                    ExchangeRateList = new List<LookupValue>(tempExchangeRateList.Where(inUseOption => inUseOption.InUse == true));
                }
                GeosApplication.Instance.Logger.Log("Method FillExchangeRateListAsync()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillExchangeRateListAsync() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillExchangeRateListAsync() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method FillExchangeRateListAsync() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        //GEOS2-6688 PCM- Improve performance to open BPL grid and any BPL
        private async Task FillReferenceViewAsync()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillReferenceView()...", category: Category.Info, priority: Priority.Low);

                //ArticleMenuList = new ObservableCollection<PCMArticleCategory>(PLMService.GetPCMArticlesWithCategoryForReference_V2160());
                #region GEOS2-3126 [Gulab lakade]

                //[pramod.misal][16.04.2025][GEOS2-6688]
                if (PLMCommon.Instance.ArticleMenuListtemp == null || PLMCommon.Instance.ArticleMenuListtemp?.Count == 0)
                {   //ArticleMenuListtemp = new ObservableCollection<PCMArticleCategory>(PLMService.GetPCMArticlesWithCategoryForReference_V2160());
                    PLMCommon.Instance.ArticleMenuListtemp = new ObservableCollection<PCMArticleCategory>(PLMService.GetPCMArticlesWithCategoryForReference_V2160());

                }
                if (PLMCommon.Instance.ArticleMenuListtemp != null)
                {
                    ArticleMenuListtemp = PLMCommon.Instance.ArticleMenuListtemp;
                }
                ObservableCollection<PCMArticleCategory> ArticleMenuListtemp1 = new ObservableCollection<PCMArticleCategory>();
                if (ArticleMenuListtemp.Count > 0)
                {

                    foreach (var item in ArticleMenuListtemp)
                    {
                        PCMArticleCategory ArticleMenuList1 = new PCMArticleCategory();
                        ArticleMenuList1.IdArticle = item.IdArticle;
                        int Count = ArticleMenuListtemp.Where(x => x.ParentName == item.KeyName && x.IsBPLArticle_Current == false).ToList().Count;
                        if (Count != 0)
                        {
                            ArticleMenuList1.Name = item.Name + "[" + Count + "]";
                        }
                        else
                        {
                            ArticleMenuList1.Name = item.Name;
                        }

                        ArticleMenuList1.NameWithArticleCount = item.NameWithArticleCount;
                        ArticleMenuList1.ParentName = item.ParentName;
                        ArticleMenuList1.KeyName = item.KeyName;
                        ArticleMenuList1.Reference = item.Reference;
                        ArticleMenuList1.StatusHtmlColor = item.StatusHtmlColor;
                        ArticleMenuList1.IdPCMArticleCategory = item.IdPCMArticleCategory;
                        ArticleMenuList1.IsBPLArticle = item.IsBPLArticle;
                        ArticleMenuList1.IsBPLArticle_Current = item.IsBPLArticle_Current;
                        ArticleMenuListtemp1.Add(ArticleMenuList1);
                    }
                    ArticleMenuList = new ObservableCollection<PCMArticleCategory>();
                    ArticleMenuList.AddRange(ArticleMenuListtemp1);
                }
                #endregion




                if (DtArticle == null)
                {
                    DtArticle = new DataTable();
                }

                foreach (DataRow row in DtArticle.Rows)
                {
                    ArticleMenuList.Where(a => a.IdArticle == Convert.ToUInt64(row["IdArticle"])).ToList().ForEach(b => b.IsBPLArticle_Current = true);
                }

                SelectedArticle = new PCMArticleCategory();
            }
            catch (FaultException<ServiceException> ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillReferenceView() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillReferenceView() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method FillReferenceView() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        //GEOS2-6688 PCM- Improve performance to open BPL grid and any BPL
        public async Task FillDetectionsMenuListAsync()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillDetectionsMenuList()...", category: Category.Info, priority: Priority.Low);
                //[001] Service method changed
                //  DetectionMenulist = new ObservableCollection<BPLDetection>(PLMService.GetAllDetections_V2220());
                #region Geos2-3126 [Sudhir jangra] [21/12/2022]


                //[pramod.misal][16.04.2025][GEOS2-6688]
                if (PLMCommon.Instance.DetectionMenuListtemp == null || PLMCommon.Instance.DetectionMenuListtemp?.Count == 0)
                {
                    //DetectionMenuListtemp = new ObservableCollection<BPLDetection>(PLMService.GetAllDetections_V2220());
                    PLMCommon.Instance.DetectionMenuListtemp = new ObservableCollection<BPLDetection>(PLMService.GetAllDetections_V2220());


                }
                if (PLMCommon.Instance.DetectionMenuListtemp != null)
                {
                    DetectionMenuListtemp = PLMCommon.Instance.DetectionMenuListtemp;
                }



                #region Old code
                //ObservableCollection<BPLDetection> DetectionMenuListtemp1 = new ObservableCollection<BPLDetection>();
                if (DetectionMenuListtemp.Count > 0)
                {
                    // Step 1: Precompute counts
                    var parentNameCounts = DetectionMenuListtemp
                                .Where(x => !x.IsBPLArticle_Current && x.ParentName != null)
                                .GroupBy(x => x.ParentName)
                                .ToDictionary(g => g.Key, g => g.Count());

                    ObservableCollection<BPLDetection> DetectionMenuListtemp1 = new ObservableCollection<BPLDetection>();

                    if (DetectionMenuListtemp.Count > 0)
                    {
                        foreach (var item in DetectionMenuListtemp)
                        {
                            BPLDetection DetectionMenuList1 = new BPLDetection();
                            DetectionMenuList1.IdDetection = item.IdDetection;

                            // Step 2: Use dictionary lookup
                            int Count = parentNameCounts.ContainsKey(item.KeyName) ? parentNameCounts[item.KeyName] : 0;
                            DetectionMenuList1.Name = Count != 0 ? item.Name + "[" + Count + "]" : item.Name;

                            DetectionMenuList1.ParentName = item.ParentName;
                            DetectionMenuList1.KeyName = item.KeyName;
                            DetectionMenuList1.Description = item.Description;
                            DetectionMenuList1.DetectionTypeName = item.DetectionTypeName;
                            DetectionMenuList1.IdDetectionType = item.IdDetectionType;
                            DetectionMenuList1.IdGroup = item.IdGroup;
                            DetectionMenuList1.Code = item.Code;
                            DetectionMenuList1.StatusHtmlColor = item.StatusHtmlColor;
                            DetectionMenuList1.IsBPLArticle_Current = item.IsBPLArticle_Current;

                            DetectionMenuListtemp1.Add(DetectionMenuList1);
                        }

                        // Step 3: Assign directly with constructor
                        DetectionMenulist = new ObservableCollection<BPLDetection>(DetectionMenuListtemp1);
                    }

                }
                #endregion
                #endregion

                if (DtDetection == null)
                {
                    DtDetection = new DataTable();
                }
                foreach (DataRow row in DtDetection.Rows)
                {
                    DetectionMenulist.Where(a => a.IdDetection == Convert.ToUInt64(row["IdDetection"])).ToList().ForEach(b => b.IsBPLArticle_Current = true);
                }
                SelectedDetection = new BPLDetection();

                GeosApplication.Instance.Logger.Log("Method FillDetectionsMenuList()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (FaultException<ServiceException> ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillDetectionsMenuList() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillDetectionsMenuList() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method FillDetectionsMenuList() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        //GEOS2-6688 PCM- Improve performance to open BPL grid and any BPL
        private async Task FillLogicListAsync()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillLogicListAsync ...", category: Category.Info, priority: Priority.Low);

                //[pramod.misal][16.04.2025][GEOS2-6688]
                if (PLMCommon.Instance.TempLogicList == null || PLMCommon.Instance.TempLogicList?.Count == 0)
                {
                    PLMCommon.Instance.TempLogicList = PCMService.GetLookupValues(63);

                }
                if (PLMCommon.Instance.TempLogicList != null)
                {
                    IList<LookupValue> tempLogicList = PLMCommon.Instance.TempLogicList;
                    LogicList = new List<LookupValue>();
                    LogicList = new List<LookupValue>(tempLogicList);
                }
                GeosApplication.Instance.Logger.Log("Method FillLogicListAsync() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in FillLogicListAsync() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), "Red", CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in FillLogicListAsync() Method - ServiceUnexceptedException " + ex.Message, category: Category.Info, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillLogicListAsync() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        //GEOS2-6688 PCM- Improve performance to open BPL grid and any BPL
        private async Task FillModuleMenuListAsync()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillModuleMenuList()...", category: Category.Info, priority: Priority.Low);

                //ModuleMenulist = new ObservableCollection<ProductTypesTemplate>(PCMService.GetProductTypesWithTemplate());
                //PCMService = new PCMServiceController("localhost:6699");
                //ObservableCollection<BPLModule> ModuleMenuListtemp = new ObservableCollection<BPLModule>(PCMService.GetProductTypesWithTemplate_V2370());

                //ModuleMenulist = new ObservableCollection<BPLModule>(PCMService.GetProductTypesWithTemplate_V2370());
                //SelectedModule = ModuleMenulist.FirstOrDefault();

                //[pramod.misal][16.04.2025][GEOS2-6688]
                if (PLMCommon.Instance.ModuleMenuListtemp == null || PLMCommon.Instance.ModuleMenuListtemp?.Count == 0)
                {
                    PLMCommon.Instance.ModuleMenuListtemp = new ObservableCollection<BPLModule>(PCMService.GetProductTypesWithTemplate_V2370());

                }
                if (PLMCommon.Instance.ModuleMenuListtemp != null)
                {
                    ObservableCollection<BPLModule> ModuleMenuListtemp = new ObservableCollection<BPLModule>(PLMCommon.Instance.ModuleMenuListtemp);

                    #region BPLModule Old code
                    // ObservableCollection<BPLModule> ModuleMenuListtemp1 = new ObservableCollection<BPLModule>();
                    var childCountByParent = ModuleMenuListtemp
                              .Where(x => x.Parent != null && !x.IsBPLdModule_Current)
                              .GroupBy(x => x.Parent)
                              .ToDictionary(g => g.Key, g => g.Count());

                    // Use Select to create the new list efficiently
                    var ModuleMenuListtemp1 = ModuleMenuListtemp.Select(item =>
                    {
                        return new BPLModule
                        {
                            IdCPType = item.IdCPType,
                            Name = childCountByParent.TryGetValue(item.Key, out int count) && count > 0
                                ? $"{item.Name}[{count}]"
                                : item.Name,
                            Parent = item.Parent,
                            Key = item.Key,
                            TemplateName = item.TemplateName,
                            IdTemplate = item.IdTemplate,
                            StatusHtmlColor = item.StatusHtmlColor,
                            StatusAbbreviation = item.StatusAbbreviation,
                            IsBPLdModule_Current = item.IsBPLdModule_Current,
                            ProductType = item.ProductType
                        };
                    }).ToList();

                    // Set the final observable collection
                    ModuleMenulist = new ObservableCollection<BPLModule>(ModuleMenuListtemp1);

                    #endregion

                    SelectedModule = ModuleMenulist.FirstOrDefault();
                }

                GeosApplication.Instance.Logger.Log("Method FillModuleMenuList()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillModuleMenuList() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillModuleMenuList() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method FillModuleMenuList() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        //GEOS2-6688 PCM- Improve performance to open BPL grid and any BPL
        private async Task FillCurrencyConversionList_AllAsync()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillCurrencyConversionList_AllAsync ...", category: Category.Info, priority: Priority.Low);
                if (PLMCommon.Instance.CurrencyConversionList == null || PLMCommon.Instance.CurrencyConversionList.Count == 0)
                {
                    PLMCommon.Instance.CurrencyConversionList = new List<CurrencyConversion>(PLMService.GetCurrencyConversionsDetailsByLatestDate());
                }
                CurrencyConversionList = PLMCommon.Instance.CurrencyConversionList;
                GeosApplication.Instance.Logger.Log("Method FillCurrencyConversionList_AllAsync() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in FillCurrencyConversionList_AllAsync() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), "Red", CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in FillCurrencyConversionList_AllAsync() Method - ServiceUnexceptedException " + ex.Message, category: Category.Info, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillCurrencyConversionList_AllAsync() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        //GEOS2-6688 PCM- Improve performance to open BPL grid and any BPL
        public async Task AddColumnsArticleDetectionModuleAsyncData()
        {
            try
            {
                DateTime start = DateTime.Now;
                // Step 1: Add columns in parallel
                await System.Threading.Tasks.Task.WhenAll(
                    AddColumnsToArticleDataTableAsync(),
                    AddColumnsToDetectionDataTableAsync(),
                    AddColumnsToModuleDataTableAsync(),
                    AddEditColumnsToPlantsDataTableAsync()
                );
                DateTime end = DateTime.Now;
                TimeSpan timeDifference = end - start;
                GeosApplication.Instance.Logger.Log("Method AddColumnsArticleDetectionModuleAsyncData " + $"Total Seconds: {timeDifference.TotalSeconds}", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method AddColumnsArticleDetectionModuleAsyncData() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        //GEOS2-6688 PCM- Improve performance to open BPL grid and any BPL
        //GEOS2-6688 PCM- Improve performance to open BPL grid and any BPL
        public async Task FillArticleDetectionModuleAsyncData()
        {
            try
            {
                DateTime start = DateTime.Now;
                //[nsatpute][GEOS2-7894][06.08.2025]

                await System.Threading.Tasks.Task.WhenAll(
                    FillArticleDataAsync(),
                    FillDetectionDataAsync(),
                    FillModuleDataAsync()
                );
                DateTime end = DateTime.Now;
                TimeSpan timeDifference = end - start;
                GeosApplication.Instance.SplashScreenMessage = string.Empty;
                GeosApplication.Instance.Logger.Log("Method FillArticleDetectionModuleAsyncData " + $"Total Seconds: {timeDifference.TotalSeconds}", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) DXSplashScreen.Close();
                GeosApplication.Instance.SplashScreenMessage = string.Empty;
                GeosApplication.Instance.Logger.Log(string.Format("Error in method FillArticleDetectionModuleAsyncData() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        //GEOS2-6688 PCM- Improve performance to open BPL grid and any BPL
        private async Task AddColumnsToArticleDataTableAsync()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method AddColumnsToArticleDataTable ...", category: Category.Info, priority: Priority.Low);
                if (SelectedSaleCurrency == null)
                    SelectedSaleCurrency = new List<object>();

                if (SelectedPlant == null)
                    SelectedPlant = new List<object>();

                if (SelectedCurrency == null)
                {
                    SelectedCurrency = new object();
                    SelectedCurrency_Copy = new object();
                }

                if (Bands.Count > 0)
                {
                    foreach (BandItem bandItem in Bands)
                    {

                        if (bandItem.BandHeader == "Plant")
                        {
                            foreach (Site plant in SelectedPlant)
                            {
                                if (!bandItem.Columns.Any(a => a.HeaderText == plant.Name))
                                {
                                    string fieldName = plant.Name;
                                    DtArticleCopy.Columns.Add(fieldName, typeof(double));
                                    bandItem.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = fieldName, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });
                                }
                            }
                            List<ColumnItem> columns = new List<ColumnItem>(bandItem.Columns);
                            if (bandItem.Columns.Count != SelectedPlant.Count)
                            {
                                foreach (ColumnItem columnItem in columns.ToList())
                                {
                                    if (!SelectedPlant.Cast<Site>().Any(a => a.Name == columnItem.HeaderText))
                                    {
                                        string fieldName = columnItem.HeaderText;
                                        DtArticleCopy.Columns.Remove(fieldName);
                                        bandItem.Columns.Remove(columnItem);
                                    }
                                }
                            }
                        }
                        else if (bandItem.BandHeader == "Max Cost")
                        {
                            if (((Currency)SelectedCurrency).Name != bandItem.Columns.FirstOrDefault().HeaderText)
                            {
                                string fieldName = bandItem.Columns.FirstOrDefault().ColumnFieldName;
                                DtArticleCopy.Columns.Remove(fieldName);
                                bandItem.Columns.Remove(bandItem.Columns.FirstOrDefault());

                                string fieldName2 = "MaxCost_1";
                                DtArticleCopy.Columns.Add(fieldName2, typeof(double));
                                bandItem.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName2, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });

                            }
                        }
                        else if (bandItem.BandHeader == "Sale Price")
                        {
                            foreach (Currency currency in SelectedSaleCurrency)
                            {
                                if (!bandItem.Columns.Any(a => a.HeaderText == currency.Name))
                                {
                                    string fieldName = currency.Name;
                                    DtArticleCopy.Columns.Add(fieldName, typeof(double));
                                    bandItem.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = fieldName, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                    DtArticleCopy.Columns.Add("CurrencyConversionRate_" + currency.Name, typeof(double));
                                }
                            }
                            List<ColumnItem> columns = new List<ColumnItem>(bandItem.Columns);
                            if (bandItem.Columns.Count != SelectedSaleCurrency.Count)
                            {
                                foreach (ColumnItem columnItem in columns.ToList())
                                {
                                    if (!SelectedSaleCurrency.Cast<Currency>().Any(a => a.Name == columnItem.HeaderText))
                                    {
                                        string fieldName = columnItem.HeaderText;
                                        DtArticleCopy.Columns.Remove(fieldName);
                                        bandItem.Columns.Remove(columnItem);

                                        DtArticleCopy.Columns.Remove("CurrencyConversionRate_" + fieldName);
                                    }
                                }
                            }
                            if (!SelectedSaleCurrency.Cast<Currency>().Any(a => a.Name == ((Currency)SelectedCurrency).Name))
                            {
                                SelectedSaleCurrency.Add(SaleCurrencyList.FirstOrDefault(a => a.Name == ((Currency)SelectedCurrency).Name));
                                SelectedSaleCurrency = new List<object>(SelectedSaleCurrency);
                                string fieldName = "Common_Cur";
                                DtArticleCopy.Columns.Remove(fieldName);
                                DtArticleCopy.Columns.Add(fieldName, typeof(double));
                                bandItem.Columns.Remove(bandItem.Columns.FirstOrDefault(a => a.ColumnFieldName == fieldName));
                                bandItem.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });

                                DtArticleCopy.Columns.Remove("CurrencyConversionRate_" + fieldName);
                                DtArticleCopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));


                                string fieldName1 = ((Currency)SelectedCurrency_Copy).Name;
                                DtArticleCopy.Columns.Add(fieldName1, typeof(double));
                                bandItem.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName1, HeaderText = fieldName1, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                DtArticleCopy.Columns.Add("CurrencyConversionRate_" + fieldName1, typeof(double));


                                SelectedSaleCurrency_Copy = SelectedSaleCurrency;
                            }
                        }
                    }

                    // reorder by common currency
                    BandItem item = Bands.FirstOrDefault(a => a.BandHeader == "Sale Price");
                    if (item.Columns.FirstOrDefault().HeaderText != ((Currency)SelectedCurrency).Name)
                    {
                        int count = 0;
                        foreach (Currency item1 in SelectedSaleCurrency.Cast<Currency>())
                        {
                            if (count == 0)
                            {
                                count = 1;
                                //string fieldName = ((Currency)SelectedCurrency).Name;
                                string fieldName = "Common_Cur";
                                DtArticleCopy.Columns.Remove(fieldName);
                                DtArticleCopy.Columns.Add(fieldName, typeof(double));
                                item.Columns.Remove(item.Columns.FirstOrDefault(a => a.ColumnFieldName == fieldName));
                                item.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                DtArticleCopy.Columns.Remove("CurrencyConversionRate_" + fieldName);
                                DtArticleCopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));


                                if (DtArticleCopy.Columns.Contains(((Currency)SelectedCurrency).Name))
                                    DtArticleCopy.Columns.Remove(((Currency)SelectedCurrency).Name);

                                if (DtArticleCopy.Columns.Contains("CurrencyConversionRate_" + ((Currency)SelectedCurrency).Name))
                                    DtArticleCopy.Columns.Remove("CurrencyConversionRate_" + ((Currency)SelectedCurrency).Name);

                                item.Columns.Remove(item.Columns.FirstOrDefault(a => a.ColumnFieldName == ((Currency)SelectedCurrency).Name));

                                if (item1.Name != ((Currency)SelectedCurrency).Name)
                                {
                                    string fieldName1 = item1.Name;
                                    if (DtArticleCopy.Columns.Contains(fieldName1))
                                        DtArticleCopy.Columns.Remove(fieldName1);

                                    DtArticleCopy.Columns.Add(fieldName1, typeof(double));
                                    item.Columns.Remove(item.Columns.FirstOrDefault(a => a.ColumnFieldName == fieldName1));
                                    item.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName1, HeaderText = fieldName1, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });

                                    if (DtArticleCopy.Columns.Contains("CurrencyConversionRate_" + fieldName1))
                                        DtArticleCopy.Columns.Remove("CurrencyConversionRate_" + fieldName1);

                                    DtArticleCopy.Columns.Add("CurrencyConversionRate_" + fieldName1, typeof(double));
                                }
                            }
                            else
                            {
                                if (item1.Name != ((Currency)SelectedCurrency).Name)
                                {
                                    string fieldName = item1.Name;
                                    if (DtArticleCopy.Columns.Contains(fieldName))
                                        DtArticleCopy.Columns.Remove(fieldName);

                                    DtArticleCopy.Columns.Add(fieldName, typeof(double));
                                    item.Columns.Remove(item.Columns.FirstOrDefault(a => a.ColumnFieldName == fieldName));
                                    item.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = fieldName, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });

                                    if (DtArticleCopy.Columns.Contains("CurrencyConversionRate_" + fieldName))
                                        DtArticleCopy.Columns.Remove("CurrencyConversionRate_" + fieldName);

                                    DtArticleCopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));
                                }
                            }
                        }
                    }
                    Bands = new ObservableCollection<BandItem>(Bands);
                }
                else
                {
                    Bands.Clear();
                    BandItem band1 = new BandItem() { BandName = "all", AllowBandMove = false, FixedStyle = FixedStyle.Left, Visible = true, AllowMoving = DevExpress.Utils.DefaultBoolean.False };
                    band1.Columns = new ObservableCollection<ColumnItem>();
                    band1.Columns.Add(new ColumnItem() { ColumnFieldName = "IsChecked", HeaderText = " ", Width = 30, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    band1.Columns.Add(new ColumnItem() { ColumnFieldName = "Reference", HeaderText = "Reference", Width = 100, IsVertical = false, Settings = SettingsType.Default, Visible = true });

                    Bands.Add(band1);
                    BandItem band2 = new BandItem() { BandName = "all1", Visible = true };
                    band2.Columns = new ObservableCollection<ColumnItem>();
                    band2.Columns.Add(new ColumnItem() { ColumnFieldName = "Name", HeaderText = "Name", Width = 350, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    band2.Columns.Add(new ColumnItem() { ColumnFieldName = "Category", HeaderText = "Category", Width = 100, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    band2.Columns.Add(new ColumnItem() { ColumnFieldName = "STAT", HeaderText = "STAT", Width = 40, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    //  band2.Columns.Add(new ColumnItem() { ColumnFieldName = "HtmlColor", HeaderText = "HtmlColor", Width = 10, Visible = false, IsVertical = false, Settings = SettingsType.Hidden });

                    Bands.Add(band2);

                    DtArticleCopy = new DataTable();
                    DtArticleCopy.Columns.Add("IsChecked", typeof(bool));
                    DtArticleCopy.Columns.Add("Reference", typeof(string));
                    DtArticleCopy.Columns.Add("Category", typeof(string));
                    DtArticleCopy.Columns.Add("STAT", typeof(string));
                    DtArticleCopy.Columns.Add("HtmlColor", typeof(string));
                    DtArticleCopy.Columns.Add("Name", typeof(string));
                    DtArticleCopy.Columns.Add("IdArticle", typeof(UInt32));
                    DtArticleCopy.Columns.Add("CurrencyConversionDate", typeof(DateTime));
                    DtArticleCopy.Columns.Add("IsColor", typeof(bool)).DefaultValue = false;
                    DtArticleCopy.Columns.Add("IsUpdatedRow", typeof(bool)).DefaultValue = false;
                    DtArticleCopy.Columns.Add("SaleCurrencyConversionDate", typeof(string));


                    //plant
                    BandItem band3 = new BandItem() { BandName = "plant", BandHeader = "Plant", Visible = true };
                    band3.Columns = new ObservableCollection<ColumnItem>();

                    foreach (Site plant in SelectedPlant)
                    {
                        string fieldName = plant.Name;
                        DtArticleCopy.Columns.Add(fieldName, typeof(double));
                        band3.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = fieldName, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });
                    }

                    Bands.Add(band3);
                    //max cost
                    BandItem band4 = new BandItem() { BandName = "max Cost", BandHeader = "Max Cost", Visible = true };
                    band4.Columns = new ObservableCollection<ColumnItem>();
                    string fieldName2 = "MaxCost_1"; //[nsatpute][GEOS2-7894][01.08.2025]
                    DtArticleCopy.Columns.Add(fieldName2, typeof(double));
                    band4.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName2, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });

                    Bands.Add(band4);
                    //rule
                    BandItem band5 = new BandItem() { BandName = "rule", BandHeader = "Rule", Visible = true };
                    band5.Columns = new ObservableCollection<ColumnItem>();

                    string fieldName3 = "Value";
                    DtArticleCopy.Columns.Add("Value", typeof(float));
                    band5.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName3, HeaderText = fieldName3, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });

                    string fieldName4 = "Logic";
                    DtArticleCopy.Columns.Add(fieldName4, typeof(int));
                    band5.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName4, HeaderText = fieldName4, Width = 50, Visible = true, IsVertical = false, Settings = SettingsType.Default });


                    Bands.Add(band5);

                    //Sale Currency
                    BandItem band6 = new BandItem() { BandName = "sale Price", BandHeader = "Sale Price", Visible = true };
                    band6.Columns = new ObservableCollection<ColumnItem>();
                    int count = 0;
                    foreach (Currency currency in SelectedSaleCurrency)
                    {
                        // code modified for reorder by common currency 
                        if (count == 0)
                        {
                            count = 1;
                            string fieldName = "Common_Cur";
                            DtArticleCopy.Columns.Add(fieldName, typeof(double));
                            band6.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                            DtArticleCopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));

                            if (currency.Name != ((Currency)SelectedCurrency).Name)
                            {
                                string fieldName1 = currency.Name;
                                DtArticleCopy.Columns.Add(fieldName1, typeof(double));
                                band6.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName1, HeaderText = fieldName1, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                DtArticleCopy.Columns.Add("CurrencyConversionRate_" + fieldName1, typeof(double));
                            }
                        }
                        else
                        {
                            if (currency.Name != ((Currency)SelectedCurrency).Name)
                            {
                                string fieldName1 = currency.Name;
                                DtArticleCopy.Columns.Add(fieldName1, typeof(double));
                                band6.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName1, HeaderText = fieldName1, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                DtArticleCopy.Columns.Add("CurrencyConversionRate_" + fieldName1, typeof(double));
                            }
                        }
                    }

                    //Profit
                    BandItem band7 = new BandItem() { BandName = "all2", Visible = true };
                    band7.Columns = new ObservableCollection<ColumnItem>();
                    string fieldName5 = "Profit";
                    DtArticleCopy.Columns.Add(fieldName5, typeof(double));
                    band7.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName5, HeaderText = "Profit", Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });

                    //Cost Margin
                    BandItem band8 = new BandItem() { BandName = "all3", Visible = true };
                    band8.Columns = new ObservableCollection<ColumnItem>();
                    string fieldName6 = "CostMargin";
                    DtArticleCopy.Columns.Add(fieldName6, typeof(double));
                    band8.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName6, HeaderText = "Cost Margin", Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });

                    BandItem band9 = new BandItem() { BandName = "all4", AllowBandMove = false, Visible = true, AllowMoving = DevExpress.Utils.DefaultBoolean.False };
                    band9.Columns = new ObservableCollection<ColumnItem>();
                    band9.Columns.Add(new ColumnItem() { ColumnFieldName = "Delete", HeaderText = " ", Width = 50, IsVertical = false, Settings = SettingsType.Default, Visible = true });



                    Bands.Add(band6);
                    Bands.Add(band7);
                    Bands.Add(band8);
                    Bands.Add(band9);
                    Bands = new ObservableCollection<BandItem>(Bands);
                }
                GeosApplication.Instance.Logger.Log("Method AddColumnsToArticleDataTable executed Successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in AddColumnsToArticleDataTable() method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), "Red", CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in AddColumnsToArticleDataTable() Method - ServiceUnexceptedException " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in AddColumnsToArticleDataTable() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        //GEOS2-6688 PCM- Improve performance to open BPL grid and any BPL
        private async Task AddColumnsToDetectionDataTableAsync()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method AddColumnsToDetectionDataTable ...", category: Category.Info, priority: Priority.Low);
                if (SelectedSaleCurrency == null)
                    SelectedSaleCurrency = new List<object>();

                if (SelectedCurrency == null)
                {
                    SelectedCurrency = new List<object>();
                }

                if (DetectionBands.Count > 0)
                {
                    foreach (BandItem bandItem in DetectionBands)
                    {
                        if (bandItem.BandHeader == "Max Cost")
                        {
                            if (((Currency)SelectedCurrency).Name != bandItem.Columns.FirstOrDefault().HeaderText)
                            {
                                string fieldName = bandItem.Columns.FirstOrDefault().ColumnFieldName;
                                DtDetectionCopy.Columns.Remove(fieldName);
                                bandItem.Columns.Remove(bandItem.Columns.FirstOrDefault());

                                string fieldName2 = "MaxCost_1";
                                DtDetectionCopy.Columns.Add(fieldName2, typeof(double));
                                bandItem.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName2, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.MaxCost });

                            }
                        }
                        else if (bandItem.BandHeader == "Sale Price")
                        {
                            foreach (Currency currency in SelectedSaleCurrency)
                            {
                                if (!bandItem.Columns.Any(a => a.HeaderText == currency.Name))
                                {
                                    string fieldName = currency.Name;
                                    DtDetectionCopy.Columns.Add(fieldName, typeof(double));
                                    bandItem.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = fieldName, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                    DtDetectionCopy.Columns.Add("CurrencyConversionRate_" + currency.Name, typeof(double));
                                }
                            }
                            List<ColumnItem> columns = new List<ColumnItem>(bandItem.Columns);
                            if (bandItem.Columns.Count != SelectedSaleCurrency.Count)
                            {
                                foreach (ColumnItem columnItem in columns.ToList())
                                {
                                    if (!SelectedSaleCurrency.Cast<Currency>().Any(a => a.Name == columnItem.HeaderText))
                                    {
                                        string fieldName = columnItem.HeaderText;
                                        DtDetectionCopy.Columns.Remove(fieldName);
                                        bandItem.Columns.Remove(columnItem);

                                        DtDetectionCopy.Columns.Remove("CurrencyConversionRate_" + fieldName);
                                    }
                                }
                            }
                            if (!SelectedSaleCurrency.Cast<Currency>().Any(a => a.Name == ((Currency)SelectedCurrency).Name))
                            {
                                SelectedSaleCurrency.Add(SaleCurrencyList.FirstOrDefault(a => a.Name == ((Currency)SelectedCurrency).Name));
                                SelectedSaleCurrency = new List<object>(SelectedSaleCurrency);
                                string fieldName = "Common_Cur";
                                DtDetectionCopy.Columns.Remove(fieldName);
                                DtDetectionCopy.Columns.Add(fieldName, typeof(double));
                                bandItem.Columns.Remove(bandItem.Columns.FirstOrDefault(a => a.ColumnFieldName == fieldName));
                                bandItem.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });

                                DtDetectionCopy.Columns.Remove("CurrencyConversionRate_" + fieldName);
                                DtDetectionCopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));


                                string fieldName1 = ((Currency)SelectedCurrency_Copy).Name;
                                DtDetectionCopy.Columns.Add(fieldName1, typeof(double));
                                bandItem.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName1, HeaderText = fieldName1, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                DtDetectionCopy.Columns.Add("CurrencyConversionRate_" + fieldName1, typeof(double));

                                SelectedSaleCurrency_Copy = SelectedSaleCurrency;
                            }
                        }
                    }

                    // reorder by common currency
                    BandItem item = DetectionBands.FirstOrDefault(a => a.BandHeader == "Sale Price");
                    if (item.Columns.FirstOrDefault().HeaderText != ((Currency)SelectedCurrency).Name)
                    {
                        int count = 0;
                        foreach (Currency item1 in SelectedSaleCurrency.Cast<Currency>())
                        {
                            if (count == 0)
                            {
                                count = 1;
                                //string fieldName = ((Currency)SelectedCurrency).Name;
                                string fieldName = "Common_Cur";
                                DtDetectionCopy.Columns.Remove(fieldName);
                                DtDetectionCopy.Columns.Add(fieldName, typeof(double));
                                item.Columns.Remove(item.Columns.FirstOrDefault(a => a.ColumnFieldName == fieldName));
                                item.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                DtDetectionCopy.Columns.Remove("CurrencyConversionRate_" + fieldName);
                                DtDetectionCopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));

                                if (DtDetectionCopy.Columns.Contains(((Currency)SelectedCurrency).Name))
                                    DtDetectionCopy.Columns.Remove(((Currency)SelectedCurrency).Name);

                                if (DtDetectionCopy.Columns.Contains("CurrencyConversionRate_" + ((Currency)SelectedCurrency).Name))
                                    DtDetectionCopy.Columns.Remove("CurrencyConversionRate_" + ((Currency)SelectedCurrency).Name);

                                item.Columns.Remove(item.Columns.FirstOrDefault(a => a.ColumnFieldName == ((Currency)SelectedCurrency).Name));

                                if (item1.Name != ((Currency)SelectedCurrency).Name)
                                {
                                    string fieldName1 = item1.Name;
                                    if (DtDetectionCopy.Columns.Contains(fieldName1))
                                        DtDetectionCopy.Columns.Remove(fieldName1);

                                    DtDetectionCopy.Columns.Add(fieldName1, typeof(double));
                                    item.Columns.Remove(item.Columns.FirstOrDefault(a => a.ColumnFieldName == fieldName1));
                                    item.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName1, HeaderText = fieldName1, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });

                                    if (DtDetectionCopy.Columns.Contains("CurrencyConversionRate_" + fieldName1))
                                        DtDetectionCopy.Columns.Remove("CurrencyConversionRate_" + fieldName1);

                                    DtDetectionCopy.Columns.Add("CurrencyConversionRate_" + fieldName1, typeof(double));
                                }
                            }
                            else
                            {
                                if (item1.Name != ((Currency)SelectedCurrency).Name)
                                {
                                    string fieldName = item1.Name;
                                    if (DtDetectionCopy.Columns.Contains(fieldName))
                                        DtDetectionCopy.Columns.Remove(fieldName);

                                    DtDetectionCopy.Columns.Add(fieldName, typeof(double));
                                    item.Columns.Remove(item.Columns.FirstOrDefault(a => a.ColumnFieldName == fieldName));
                                    item.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = fieldName, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });

                                    if (DtDetectionCopy.Columns.Contains("CurrencyConversionRate_" + fieldName))
                                        DtDetectionCopy.Columns.Remove("CurrencyConversionRate_" + fieldName);

                                    DtDetectionCopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));
                                }
                            }
                        }
                    }
                    DetectionBands = new ObservableCollection<BandItem>(DetectionBands);
                }
                else
                {
                    DetectionBands.Clear();
                    DtDetectionCopy = new DataTable();

                    BandItem band1 = new BandItem() { BandName = "all5", AllowBandMove = false, FixedStyle = FixedStyle.Left, Visible = true, AllowMoving = DevExpress.Utils.DefaultBoolean.False };
                    band1.Columns = new ObservableCollection<ColumnItem>();
                    band1.Columns.Add(new ColumnItem() { ColumnFieldName = "IsChecked", HeaderText = " ", Width = 50, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    band1.Columns.Add(new ColumnItem() { ColumnFieldName = "Code", HeaderText = "Code", Width = 100, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    DetectionBands.Add(band1);

                    BandItem band2 = new BandItem() { BandName = "all6", Visible = true };
                    band2.Columns = new ObservableCollection<ColumnItem>();
                    band2.Columns.Add(new ColumnItem() { ColumnFieldName = "Name", HeaderText = "Name", Width = 350, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    band2.Columns.Add(new ColumnItem() { ColumnFieldName = "Type", HeaderText = "Type", Width = 100, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    band2.Columns.Add(new ColumnItem() { ColumnFieldName = "STAT", HeaderText = "STAT", Width = 40, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    //  band2.Columns.Add(new ColumnItem() { ColumnFieldName = "HtmlColor", HeaderText = "HtmlColor", Width = 10, Visible = false, IsVertical = false, Settings = SettingsType.Hidden });

                    DetectionBands.Add(band2);

                    DtDetectionCopy.Columns.Add("IsChecked", typeof(bool));
                    DtDetectionCopy.Columns.Add("Code", typeof(string));
                    DtDetectionCopy.Columns.Add("Type", typeof(string));
                    DtDetectionCopy.Columns.Add("STAT", typeof(string));
                    DtDetectionCopy.Columns.Add("HtmlColor", typeof(string));
                    DtDetectionCopy.Columns.Add("Name", typeof(string));
                    DtDetectionCopy.Columns.Add("IdDetection", typeof(UInt32));
                    DtDetectionCopy.Columns.Add("CurrencyConversionDate", typeof(DateTime));
                    DtDetectionCopy.Columns.Add("IsColor", typeof(bool)).DefaultValue = false;
                    DtDetectionCopy.Columns.Add("IsUpdatedRow", typeof(bool)).DefaultValue = false;
                    DtDetectionCopy.Columns.Add("SaleCurrencyConversionDate", typeof(string));


                    //Max Cost
                    BandItem band3 = new BandItem() { BandName = "max Cost", BandHeader = "Max Cost", Visible = true };
                    band3.Columns = new ObservableCollection<ColumnItem>();
                    string fieldName2 = "MaxCost_1";
                    DtDetectionCopy.Columns.Add(fieldName2, typeof(double));
                    band3.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName2, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.MaxCost });
                    DetectionBands.Add(band3);

                    //rule
                    BandItem band4 = new BandItem() { BandName = "rule", BandHeader = "Rule", Visible = true };
                    band4.Columns = new ObservableCollection<ColumnItem>();

                    string fieldName3 = "Value";
                    DtDetectionCopy.Columns.Add("Value", typeof(float));
                    band4.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName3, HeaderText = fieldName3, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });

                    string fieldName4 = "Logic";
                    DtDetectionCopy.Columns.Add(fieldName4, typeof(int));
                    band4.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName4, HeaderText = fieldName4, Width = 50, Visible = true, IsVertical = false, Settings = SettingsType.Default });

                    DetectionBands.Add(band4);

                    //Sale Currency
                    BandItem band5 = new BandItem() { BandName = "sale Price", BandHeader = "Sale Price", Visible = true };
                    band5.Columns = new ObservableCollection<ColumnItem>();
                    int count = 0;
                    foreach (Currency currency in SelectedSaleCurrency)
                    {
                        // code modified for reorder by common currency 
                        if (count == 0)
                        {
                            count = 1;
                            string fieldName = "Common_Cur";
                            DtDetectionCopy.Columns.Add(fieldName, typeof(double));
                            band5.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                            DtDetectionCopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));

                            if (currency.Name != ((Currency)SelectedCurrency).Name)
                            {
                                string fieldName1 = currency.Name;
                                DtDetectionCopy.Columns.Add(fieldName1, typeof(double));
                                band5.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName1, HeaderText = fieldName1, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                DtDetectionCopy.Columns.Add("CurrencyConversionRate_" + fieldName1, typeof(double));
                            }
                        }
                        else
                        {
                            if (currency.Name != ((Currency)SelectedCurrency).Name)
                            {
                                string fieldName1 = currency.Name;
                                DtDetectionCopy.Columns.Add(fieldName1, typeof(double));
                                band5.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName1, HeaderText = fieldName1, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                DtDetectionCopy.Columns.Add("CurrencyConversionRate_" + fieldName1, typeof(double));
                            }
                        }
                    }

                    DetectionBands.Add(band5);

                    //Profit
                    BandItem band6 = new BandItem() { BandName = "all7", Visible = true };
                    band6.Columns = new ObservableCollection<ColumnItem>();
                    string fieldName5 = "Profit";
                    DtDetectionCopy.Columns.Add(fieldName5, typeof(double));
                    band6.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName5, HeaderText = "Profit", Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });
                    DetectionBands.Add(band6);

                    //Cost Margin
                    BandItem band7 = new BandItem() { BandName = "all8", Visible = true };
                    band7.Columns = new ObservableCollection<ColumnItem>();
                    string fieldName6 = "CostMargin";
                    DtDetectionCopy.Columns.Add(fieldName6, typeof(double));
                    band7.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName6, HeaderText = "Cost Margin", Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });
                    DetectionBands.Add(band7);

                    // Delete Button
                    BandItem band8 = new BandItem() { BandName = "all9", AllowBandMove = false, Visible = true, AllowMoving = DevExpress.Utils.DefaultBoolean.False };
                    band8.Columns = new ObservableCollection<ColumnItem>();
                    band8.Columns.Add(new ColumnItem() { ColumnFieldName = "Delete", HeaderText = " ", Width = 50, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    DetectionBands.Add(band8);

                    DetectionBands = new ObservableCollection<BandItem>(DetectionBands);
                }
                GeosApplication.Instance.Logger.Log("Method AddColumnsToDetectionDataTable executed Successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in AddColumnsToDetectionDataTable() method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), "Red", CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in AddColumnsToDetectionDataTable() Method - ServiceUnexceptedException " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in AddColumnsToDetectionDataTable() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        //GEOS2-6688 PCM- Improve performance to open BPL grid and any BPL
        private async Task AddColumnsToModuleDataTableAsync()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method AddColumnsToModuleDataTable ...", category: Category.Info, priority: Priority.Low);
                if (SelectedSaleCurrency == null)
                    SelectedSaleCurrency = new List<object>();

                if (SelectedCurrency == null)
                {
                    SelectedCurrency = new List<object>();
                }

                if (ModuleBands.Count > 0)
                {
                    foreach (BandItem bandItem in ModuleBands)
                    {
                        if (bandItem.BandHeader == "Max Cost")
                        {
                            if (((Currency)SelectedCurrency).Name != bandItem.Columns.FirstOrDefault().HeaderText)
                            {
                                string fieldName = bandItem.Columns.FirstOrDefault().ColumnFieldName;
                                DtModuleCopy.Columns.Remove(fieldName);
                                bandItem.Columns.Remove(bandItem.Columns.FirstOrDefault());

                                string fieldName2 = "MaxCost_1";
                                DtModuleCopy.Columns.Add(fieldName2, typeof(double));
                                bandItem.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName2, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.MaxCost });

                            }
                        }
                        else if (bandItem.BandHeader == "Sale Price")
                        {
                            foreach (Currency currency in SelectedSaleCurrency)
                            {
                                if (!bandItem.Columns.Any(a => a.HeaderText == currency.Name))
                                {
                                    string fieldName = currency.Name;
                                    DtModuleCopy.Columns.Add(fieldName, typeof(double));
                                    bandItem.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = fieldName, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                    DtModuleCopy.Columns.Add("CurrencyConversionRate_" + currency.Name, typeof(double));
                                }
                            }
                            List<ColumnItem> columns = new List<ColumnItem>(bandItem.Columns);
                            if (bandItem.Columns.Count != SelectedSaleCurrency.Count)
                            {
                                foreach (ColumnItem columnItem in columns.ToList())
                                {
                                    if (!SelectedSaleCurrency.Cast<Currency>().Any(a => a.Name == columnItem.HeaderText))
                                    {
                                        string fieldName = columnItem.HeaderText;
                                        DtModuleCopy.Columns.Remove(fieldName);
                                        bandItem.Columns.Remove(columnItem);

                                        DtModuleCopy.Columns.Remove("CurrencyConversionRate_" + fieldName);
                                    }
                                }
                            }
                            if (!SelectedSaleCurrency.Cast<Currency>().Any(a => a.Name == ((Currency)SelectedCurrency).Name))
                            {
                                SelectedSaleCurrency.Add(SaleCurrencyList.FirstOrDefault(a => a.Name == ((Currency)SelectedCurrency).Name));
                                SelectedSaleCurrency = new List<object>(SelectedSaleCurrency);
                                string fieldName = "Common_Cur";
                                DtModuleCopy.Columns.Remove(fieldName);
                                DtModuleCopy.Columns.Add(fieldName, typeof(double));
                                bandItem.Columns.Remove(bandItem.Columns.FirstOrDefault(a => a.ColumnFieldName == fieldName));
                                bandItem.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });

                                DtModuleCopy.Columns.Remove("CurrencyConversionRate_" + fieldName);
                                DtModuleCopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));


                                string fieldName1 = ((Currency)SelectedCurrency_Copy).Name;
                                DtModuleCopy.Columns.Add(fieldName1, typeof(double));
                                bandItem.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName1, HeaderText = fieldName1, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                DtModuleCopy.Columns.Add("CurrencyConversionRate_" + fieldName1, typeof(double));

                                SelectedSaleCurrency_Copy = SelectedSaleCurrency;
                            }
                        }
                    }

                    // reorder by common currency
                    BandItem item = ModuleBands.FirstOrDefault(a => a.BandHeader == "Sale Price");
                    if (item.Columns.FirstOrDefault().HeaderText != ((Currency)SelectedCurrency).Name)
                    {
                        int count = 0;
                        foreach (Currency item1 in SelectedSaleCurrency.Cast<Currency>())
                        {
                            if (count == 0)
                            {
                                count = 1;
                                //string fieldName = ((Currency)SelectedCurrency).Name;
                                string fieldName = "Common_Cur";
                                DtModuleCopy.Columns.Remove(fieldName);
                                DtModuleCopy.Columns.Add(fieldName, typeof(double));
                                item.Columns.Remove(item.Columns.FirstOrDefault(a => a.ColumnFieldName == fieldName));
                                item.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                DtModuleCopy.Columns.Remove("CurrencyConversionRate_" + fieldName);
                                DtModuleCopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));

                                if (DtModuleCopy.Columns.Contains(((Currency)SelectedCurrency).Name))
                                    DtModuleCopy.Columns.Remove(((Currency)SelectedCurrency).Name);

                                if (DtModuleCopy.Columns.Contains("CurrencyConversionRate_" + ((Currency)SelectedCurrency).Name))
                                    DtModuleCopy.Columns.Remove("CurrencyConversionRate_" + ((Currency)SelectedCurrency).Name);

                                item.Columns.Remove(item.Columns.FirstOrDefault(a => a.ColumnFieldName == ((Currency)SelectedCurrency).Name));

                                if (item1.Name != ((Currency)SelectedCurrency).Name)
                                {
                                    string fieldName1 = item1.Name;
                                    if (DtModuleCopy.Columns.Contains(fieldName1))
                                        DtModuleCopy.Columns.Remove(fieldName1);

                                    DtModuleCopy.Columns.Add(fieldName1, typeof(double));
                                    item.Columns.Remove(item.Columns.FirstOrDefault(a => a.ColumnFieldName == fieldName1));
                                    item.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName1, HeaderText = fieldName1, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });

                                    if (DtModuleCopy.Columns.Contains("CurrencyConversionRate_" + fieldName1))
                                        DtModuleCopy.Columns.Remove("CurrencyConversionRate_" + fieldName1);

                                    DtModuleCopy.Columns.Add("CurrencyConversionRate_" + fieldName1, typeof(double));
                                }
                            }
                            else
                            {
                                if (item1.Name != ((Currency)SelectedCurrency).Name)
                                {
                                    string fieldName = item1.Name;
                                    if (DtModuleCopy.Columns.Contains(fieldName))
                                        DtModuleCopy.Columns.Remove(fieldName);

                                    DtModuleCopy.Columns.Add(fieldName, typeof(double));
                                    item.Columns.Remove(item.Columns.FirstOrDefault(a => a.ColumnFieldName == fieldName));
                                    item.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = fieldName, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });

                                    if (DtModuleCopy.Columns.Contains("CurrencyConversionRate_" + fieldName))
                                        DtModuleCopy.Columns.Remove("CurrencyConversionRate_" + fieldName);

                                    DtModuleCopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));
                                }
                            }
                        }
                    }
                    ModuleBands = new ObservableCollection<BandItem>(ModuleBands);
                }
                else
                {
                    ModuleBands.Clear();
                    DtModuleCopy = new DataTable();

                    BandItem band1 = new BandItem() { BandName = "all5", AllowBandMove = false, FixedStyle = FixedStyle.Left, Visible = true, AllowMoving = DevExpress.Utils.DefaultBoolean.False };
                    band1.Columns = new ObservableCollection<ColumnItem>();
                    band1.Columns.Add(new ColumnItem() { ColumnFieldName = "IsChecked", HeaderText = " ", Width = 50, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    band1.Columns.Add(new ColumnItem() { ColumnFieldName = "Code", HeaderText = "Code", Width = 100, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    ModuleBands.Add(band1);

                    BandItem band2 = new BandItem() { BandName = "all6", Visible = true };
                    band2.Columns = new ObservableCollection<ColumnItem>();
                    band2.Columns.Add(new ColumnItem() { ColumnFieldName = "Name", HeaderText = "Name", Width = 350, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    band2.Columns.Add(new ColumnItem() { ColumnFieldName = "Type", HeaderText = "Template", Width = 100, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    band2.Columns.Add(new ColumnItem() { ColumnFieldName = "STAT", HeaderText = "STAT", Width = 40, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    //  band2.Columns.Add(new ColumnItem() { ColumnFieldName = "HtmlColor", HeaderText = "HtmlColor", Width = 10, Visible = false, IsVertical = false, Settings = SettingsType.Hidden });

                    ModuleBands.Add(band2);

                    DtModuleCopy.Columns.Add("IsChecked", typeof(bool));
                    DtModuleCopy.Columns.Add("Code", typeof(string));
                    DtModuleCopy.Columns.Add("Type", typeof(string));
                    DtModuleCopy.Columns.Add("STAT", typeof(string));
                    DtModuleCopy.Columns.Add("HtmlColor", typeof(string));
                    DtModuleCopy.Columns.Add("Name", typeof(string));
                    DtModuleCopy.Columns.Add("IdCPType", typeof(UInt32));
                    DtModuleCopy.Columns.Add("CurrencyConversionDate", typeof(DateTime));
                    DtModuleCopy.Columns.Add("IsColor", typeof(bool)).DefaultValue = false;
                    DtModuleCopy.Columns.Add("IsUpdatedRow", typeof(bool)).DefaultValue = false;
                    DtModuleCopy.Columns.Add("SaleCurrencyConversionDate", typeof(string));


                    //Max Cost
                    BandItem band3 = new BandItem() { BandName = "max Cost", BandHeader = "Max Cost", Visible = true };
                    band3.Columns = new ObservableCollection<ColumnItem>();
                    string fieldName2 = "MaxCost_1";
                    DtModuleCopy.Columns.Add(fieldName2, typeof(double));
                    band3.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName2, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.MaxCost });
                    ModuleBands.Add(band3);

                    //rule
                    BandItem band4 = new BandItem() { BandName = "rule", BandHeader = "Rule", Visible = true };
                    band4.Columns = new ObservableCollection<ColumnItem>();

                    string fieldName3 = "Value";
                    DtModuleCopy.Columns.Add("Value", typeof(float));
                    band4.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName3, HeaderText = fieldName3, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });

                    string fieldName4 = "Logic";
                    DtModuleCopy.Columns.Add(fieldName4, typeof(int));
                    band4.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName4, HeaderText = fieldName4, Width = 50, Visible = true, IsVertical = false, Settings = SettingsType.Default });

                    ModuleBands.Add(band4);

                    //Sale Currency
                    BandItem band5 = new BandItem() { BandName = "sale Price", BandHeader = "Sale Price", Visible = true };
                    band5.Columns = new ObservableCollection<ColumnItem>();
                    int count = 0;
                    foreach (Currency currency in SelectedSaleCurrency)
                    {
                        // code modified for reorder by common currency 
                        if (count == 0)
                        {
                            count = 1;
                            string fieldName = "Common_Cur";
                            DtModuleCopy.Columns.Add(fieldName, typeof(double));
                            band5.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                            DtModuleCopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));

                            if (currency.Name != ((Currency)SelectedCurrency).Name)
                            {
                                string fieldName1 = currency.Name;
                                DtModuleCopy.Columns.Add(fieldName1, typeof(double));
                                band5.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName1, HeaderText = fieldName1, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                DtModuleCopy.Columns.Add("CurrencyConversionRate_" + fieldName1, typeof(double));
                            }
                        }
                        else
                        {
                            if (currency.Name != ((Currency)SelectedCurrency).Name)
                            {
                                string fieldName1 = currency.Name;
                                DtModuleCopy.Columns.Add(fieldName1, typeof(double));
                                band5.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName1, HeaderText = fieldName1, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                DtModuleCopy.Columns.Add("CurrencyConversionRate_" + fieldName1, typeof(double));
                            }
                        }
                    }

                    ModuleBands.Add(band5);

                    //Profit
                    BandItem band6 = new BandItem() { BandName = "all7", Visible = true };
                    band6.Columns = new ObservableCollection<ColumnItem>();
                    string fieldName5 = "Profit";
                    DtModuleCopy.Columns.Add(fieldName5, typeof(double));
                    band6.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName5, HeaderText = "Profit", Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });
                    ModuleBands.Add(band6);

                    //Cost Margin
                    BandItem band7 = new BandItem() { BandName = "all8", Visible = true };
                    band7.Columns = new ObservableCollection<ColumnItem>();
                    string fieldName6 = "CostMargin";
                    DtModuleCopy.Columns.Add(fieldName6, typeof(double));
                    band7.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName6, HeaderText = "Cost Margin", Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });
                    ModuleBands.Add(band7);

                    // Delete Button
                    BandItem band8 = new BandItem() { BandName = "all9", AllowBandMove = false, Visible = true, AllowMoving = DevExpress.Utils.DefaultBoolean.False };
                    band8.Columns = new ObservableCollection<ColumnItem>();
                    band8.Columns.Add(new ColumnItem() { ColumnFieldName = "Delete", HeaderText = " ", Width = 50, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    ModuleBands.Add(band8);

                    ModuleBands = new ObservableCollection<BandItem>(ModuleBands);
                }
                GeosApplication.Instance.Logger.Log("Method AddColumnsToModuleDataTable executed Successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in AddColumnsToModuleDataTable() method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), "Red", CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in AddColumnsToModuleDataTable() Method - ServiceUnexceptedException " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in AddColumnsToModuleDataTable() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        //GEOS2-6688 PCM- Improve performance to open BPL grid and any BPL
        private async Task AddEditColumnsToPlantsDataTableAsync()
        {
            #region Try Block
            try
            {
                GeosApplication.Instance.Logger.Log("Method AddEditColumnsToPlantsDataTable()...", category: Category.Info, priority: Priority.Low);
                if (SelectedSaleCurrency == null)
                    SelectedSaleCurrency = new List<object>();
                if (SelectedPlant == null)
                    SelectedPlant = new List<object>();
                if (SelectedCurrency == null)
                {
                    SelectedCurrency = new object();
                    SelectedCurrency_Copy = new object();
                }
                #region When we Create a new BPL
                if (IsNew)
                {
                    if (BandsTemplete.Count > 0)
                    {
                        DataRow dr;
                        DataTable dtcopy = new DataTable();
                        dtcopy = Dttable;
                        int eachRow = 0;
                        foreach (Site plant in SelectedPlant)
                        {
                            bool exists = dtcopy.Rows.Cast<DataRow>().Select(x => x.ItemArray[0]).Contains(plant.Name);
                            if (!exists)
                            {
                                dr = dtcopy.NewRow();
                                foreach (BandItem bandItem in BandsTemplete)
                                {
                                    if (bandItem.BandHeader == "Plant")
                                    {
                                        dr["Plant"] = plant.Name;
                                    }
                                    else
                                    {
                                        string currencyValue = AddColumnsToSaleCurrencyDataTable(plant.Name, bandItem.BandHeader);
                                        if (!string.IsNullOrEmpty(currencyValue))
                                        {
                                            dr[currencyValue] = true;
                                        }
                                    }
                                }
                                dtcopy.Rows.Add(dr);
                            }
                            else
                            {

                                int totalRowCount = dtcopy.Rows.Count;
                                foreach (Currency currency in SelectedSaleCurrency)
                                {
                                    bool isThere = dtcopy.Columns.Cast<DataColumn>().Select(x => x.ColumnName).Contains(currency.Name);
                                    if (!isThere)
                                    {
                                        BandItem item2 = new BandItem() { BandName = currency.Name, BandHeader = currency.Name };
                                        dtcopy.Columns.Add(currency.Name, typeof(bool));
                                        item2.Columns = new ObservableCollection<ColumnItem>();
                                        item2.Columns.Add(new ColumnItem() { ColumnFieldName = currency.Name, Width = 100, IsVertical = false, Settings = SettingsType.Default, Visible = true, ImageSrc = currency.CurrencyIconImage });
                                        BandsTemplete.Add(item2);
                                    }
                                }
                                if (eachRow < totalRowCount)
                                {
                                    DataRow data = Dttable.Rows[eachRow];
                                    int ColumnCount = SelectedSaleCurrency.Count;
                                    int eachColumnPosition = 0;
                                    foreach (BandItem item3 in BandsTemplete)
                                    {
                                        bool IsExists = dtcopy.Columns.Cast<DataColumn>().Select(x => x.ColumnName).Contains(item3.BandHeader);
                                        if (item3.BandHeader != "Plant")
                                        {
                                            string currencyValue1 = AddColumnsToSaleCurrencyDataTable(plant.Name, item3.BandHeader);
                                            if (dtcopy.Rows[eachRow][eachColumnPosition].ToString() == null || dtcopy.Rows[eachRow][eachColumnPosition].ToString() == string.Empty)
                                            {
                                                data[currencyValue1] = true;
                                            }
                                        }
                                        if (!SelectedPlant.Cast<Site>().Any(a => a.Name == data["Plant"].ToString()))
                                        {
                                            dtcopy.Rows.Remove(data);
                                            totalRowCount = dtcopy.Rows.Count;
                                            break;
                                        }

                                        eachColumnPosition++;
                                        /// when we change the SelectedCurrency in the Information
                                        #region 
                                        if (!SelectedSaleCurrency.Cast<Currency>().Any(a => a.Name == ((Currency)SelectedCurrency).Name) || !Dttable.Columns.Cast<DataColumn>().Select(x => x.ColumnName).Contains(((Currency)SelectedCurrency).Name))
                                        {
                                            SelectedSaleCurrency.Add(SaleCurrencyList.FirstOrDefault(a => a.Name == ((Currency)SelectedCurrency).Name));
                                            SelectedSaleCurrency = new List<object>(SelectedSaleCurrency);
                                            string fieldName = ((Currency)SelectedCurrency).Name;
                                            Dttable.Columns.Add(fieldName, typeof(double));
                                            item3.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });
                                            SelectedSaleCurrency_Copy = SelectedSaleCurrency;
                                            Dttable.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));
                                        }
                                        #endregion
                                    }
                                    eachRow++;
                                }
                            }
                        }
                        DataRow[] found = dtcopy.Select();
                        foreach (DataRow row1 in found)
                        {
                            if (!SelectedPlant.Cast<Site>().Any(a => a.Name == row1["Plant"].ToString()))
                            {
                                dtcopy.Rows.Remove(row1);
                            }
                        }
                        bool _check = false;
                        foreach (Currency cur1 in SelectedSaleCurrency)
                        {
                            if (dtcopy.Columns.Cast<DataColumn>().Any(x => x.ColumnName == cur1.Name))
                            {
                                _check = true;
                                break;
                            }
                        }
                        if (_check)
                        {
                            ObservableCollection<BandItem> SaleCurrencyCollection = new ObservableCollection<BandItem>();
                            foreach (Currency currency1 in SelectedSaleCurrency)
                            {
                                bool isThere = dtcopy.Columns.Cast<DataColumn>().Select(x => x.ColumnName).Contains(currency1.Name);
                                if (!isThere)
                                {
                                    BandItem item2 = new BandItem() { BandName = currency1.Name, BandHeader = currency1.Name };
                                    dtcopy.Columns.Add(currency1.Name, typeof(bool));
                                    item2.Columns = new ObservableCollection<ColumnItem>();
                                    item2.Columns.Add(new ColumnItem() { ColumnFieldName = currency1.Name, Width = 100, IsVertical = false, Settings = SettingsType.Default, Visible = true, ImageSrc = currency1.CurrencyIconImage });
                                    BandsTemplete.Add(item2);
                                }
                            }
                            foreach (BandItem bi in BandsTemplete)
                            {
                                List<ColumnItem> columns = new List<ColumnItem>(bi.Columns);
                                foreach (ColumnItem columnItem in columns.ToList())
                                {
                                    bool isDeleted = false;
                                    if (!SelectedSaleCurrency.Cast<Currency>().Any(a => a.Name == columnItem.ColumnFieldName) && columns[0].ColumnFieldName != "Plant" && columns[0].ColumnFieldName != ((Currency)SelectedCurrency).Name)
                                    {
                                        string fieldName = columns[0].ColumnFieldName;
                                        dtcopy.Columns.Remove(fieldName);
                                        bi.Columns.Remove(columns[0]);
                                        dtcopy.AcceptChanges();
                                        isDeleted = true;
                                    }
                                    if (isDeleted)
                                    {
                                        SaleCurrencyCollection.Add(bi);
                                    }
                                }
                                if (!SelectedSaleCurrency.Cast<Currency>().Any(a => a.Name == ((Currency)SelectedCurrency).Name) || !dtcopy.Columns.Cast<DataColumn>().Select(x => x.ColumnName).Contains(((Currency)SelectedCurrency).Name))
                                {
                                    SelectedSaleCurrency.Add(SaleCurrencyList.FirstOrDefault(a => a.Name == ((Currency)SelectedCurrency).Name));
                                    SelectedSaleCurrency = new List<object>(SelectedSaleCurrency);
                                    string fieldName = ((Currency)SelectedCurrency).Name;
                                    dtcopy.Columns.Add(fieldName, typeof(bool));
                                    bi.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default, ImageSrc = ((Currency)SelectedCurrency).CurrencyIconImage });
                                    SelectedSaleCurrency_Copy = SelectedSaleCurrency;
                                    dtcopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));
                                }
                            }
                            foreach (BandItem band1 in SaleCurrencyCollection)
                            {
                                BandsTemplete.Remove(band1);
                            }
                        }
                        Dttable = dtcopy;
                    }
                    #region Add New Base Price List Columns for Plant and Currency
                    else
                    {
                        /// Plant
                        BandsTemplete.Clear();
                        Dttable = new DataTable();
                        BandItem item1 = new BandItem() { BandName = "Plant", BandHeader = "Plant" };
                        Dttable.Columns.Add("Plant", typeof(string));
                        item1.Columns = new ObservableCollection<ColumnItem>();
                        item1.Columns.Add(new ColumnItem() { ColumnFieldName = "Plant", Width = 100, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                        BandsTemplete.Add(item1);
                        /// Sale Currency
                        foreach (Currency currency in SelectedSaleCurrency)
                        {
                            BandItem item2 = new BandItem();
                            string fieldName = currency.Name;
                            Dttable.Columns.Add(fieldName, typeof(bool));
                            item2.BandHeader = fieldName;
                            item2.Columns = new ObservableCollection<ColumnItem>();
                            item2.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default, ImageSrc = currency.CurrencyIconImage });
                            BandsTemplete.Add(item2);
                        }
                    }
                    #endregion
                    PlantCurrencyListWithIsChecked = new List<BasePriceListByPlantCurrency>();

                    foreach (DataRow dr in Dttable.Rows)
                    {
                        BasePriceListByPlantCurrency item = new BasePriceListByPlantCurrency();
                        item.PlantName = dr["Plant"].ToString();
                        if (!PlantCurrencyListWithIsChecked.Any(a => a.PlantName == item.PlantName))
                        {
                            foreach (Currency cur in SelectedSaleCurrency)
                            {
                                if (dr[cur.Name].ToString() == "True")
                                {
                                    if (string.IsNullOrEmpty(item.CurrenciesName))
                                    {
                                        item.CurrenciesName = cur.Name;
                                    }
                                    else
                                    {
                                        if (!item.CurrenciesName.Contains(cur.Name))
                                            item.CurrenciesName += " " + cur.Name;
                                    }
                                }
                            }
                            PlantCurrencyListWithIsChecked.Add(item);
                        }
                    }
                }
                #endregion
                #endregion
                #region Edit the BPL List and Update or Delete
                else
                {
                    DataRow dr1;
                    #region BandTemplete count not equal to 0
                    if (BandsTemplete.Count > 0)
                    {
                        DataRow dr;
                        DataTable dTableCopy = new DataTable();
                        int eachRow = 0;
                        dTableCopy = Dttable;

                        foreach (Site plant in SelectedPlant)
                        {
                            bool exists = dTableCopy.Rows.Cast<DataRow>().Select(x => x.ItemArray[0]).Contains(plant.Name);
                            if (!exists)
                            {
                                dr = dTableCopy.NewRow();
                                foreach (BandItem bandItem in BandsTemplete)
                                {
                                    if (bandItem.BandHeader == "Plant")
                                    {
                                        dr["Plant"] = plant.Name;
                                    }
                                    else
                                    {
                                        string currencyValue = AddColumnsToSaleCurrencyDataTable(plant.Name, bandItem.BandHeader);
                                        if (!string.IsNullOrEmpty(currencyValue))
                                        {
                                            dr[currencyValue] = true;
                                        }
                                    }
                                }
                                dTableCopy.Rows.Add(dr);
                            }
                            else
                            {
                                int totalRowCount = dTableCopy.Rows.Count;
                                foreach (Currency currency in SelectedSaleCurrency)
                                {
                                    bool isThere = dTableCopy.Columns.Cast<DataColumn>().Select(x => x.ColumnName).Contains(currency.Name);
                                    if (!isThere)
                                    {
                                        BandItem item2 = new BandItem() { BandName = currency.Name, BandHeader = currency.Name };
                                        dTableCopy.Columns.Add(currency.Name, typeof(bool));
                                        item2.Columns = new ObservableCollection<ColumnItem>();
                                        item2.Columns.Add(new ColumnItem() { ColumnFieldName = currency.Name, Width = 100, IsVertical = false, Settings = SettingsType.Default, Visible = true, ImageSrc = currency.CurrencyIconImage });
                                        BandsTemplete.Add(item2);
                                    }
                                }
                                if (eachRow < totalRowCount)
                                {
                                    DataRow data = dTableCopy.Rows[eachRow];
                                    int ColumnCount = SelectedSaleCurrency.Count;
                                    int eachColumnPosition = 0;
                                    foreach (BandItem item3 in BandsTemplete)
                                    {
                                        bool IsExists = dTableCopy.Columns.Cast<DataColumn>().Select(x => x.ColumnName).Contains(item3.BandHeader);
                                        if (item3.BandHeader != "Plant")
                                        {
                                            string currencyValue1 = AddColumnsToSaleCurrencyDataTable(plant.Name, item3.BandHeader);
                                            if (dTableCopy.Rows[eachRow][eachColumnPosition].ToString() == null || dTableCopy.Rows[eachRow][eachColumnPosition].ToString() == string.Empty)
                                            {
                                                data[currencyValue1] = true;
                                            }
                                        }
                                        eachColumnPosition++;
                                        /// when we change the SelectedCurrency in the Information
                                        #region 

                                        #endregion
                                    }
                                    eachRow++;
                                }
                            }
                        }
                        DataRow[] found = dTableCopy.Select();
                        foreach (DataRow row1 in found)
                        {
                            if (!SelectedPlant.Cast<Site>().Any(a => a.Name == row1["Plant"].ToString()))
                            {
                                dTableCopy.Rows.Remove(row1);
                            }
                        }
                        bool _check = false;
                        foreach (Currency cur1 in SelectedSaleCurrency)
                        {
                            if (dTableCopy.Columns.Cast<DataColumn>().Any(x => x.ColumnName == cur1.Name))
                            {
                                _check = true;
                                break;
                            }
                        }
                        if (_check)
                        {
                            ObservableCollection<BandItem> SaleCurrencyCollection = new ObservableCollection<BandItem>();
                            foreach (Currency currency1 in SelectedSaleCurrency)
                            {
                                bool isThere = dTableCopy.Columns.Cast<DataColumn>().Select(x => x.ColumnName).Contains(currency1.Name);
                                if (!isThere)
                                {
                                    BandItem item2 = new BandItem() { BandName = currency1.Name, BandHeader = currency1.Name };
                                    dTableCopy.Columns.Add(currency1.Name, typeof(bool));
                                    item2.Columns = new ObservableCollection<ColumnItem>();
                                    item2.Columns.Add(new ColumnItem() { ColumnFieldName = currency1.Name, Width = 100, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                                    BandsTemplete.Add(item2);
                                }
                            }
                            foreach (BandItem bi in BandsTemplete)
                            {
                                List<ColumnItem> columns = new List<ColumnItem>(bi.Columns);
                                foreach (ColumnItem columnItem in columns.ToList())
                                {
                                    bool isDeleted = false;
                                    if (!SelectedSaleCurrency.Cast<Currency>().Any(a => a.Name == columnItem.ColumnFieldName) && columns[0].ColumnFieldName != "Plant" && columns[0].ColumnFieldName != ((Currency)SelectedCurrency).Name)
                                    {
                                        string fieldName = columns[0].ColumnFieldName;
                                        dTableCopy.Columns.Remove(fieldName);
                                        bi.Columns.Remove(columns[0]);
                                        dTableCopy.AcceptChanges();
                                        isDeleted = true;
                                    }
                                    if (isDeleted)
                                    {
                                        SaleCurrencyCollection.Add(bi);
                                    }
                                }
                                if (!SelectedSaleCurrency.Cast<Currency>().Any(a => a.Name == ((Currency)SelectedCurrency).Name) || !dTableCopy.Columns.Cast<DataColumn>().Select(x => x.ColumnName).Contains(((Currency)SelectedCurrency).Name))
                                {
                                    SelectedSaleCurrency.Add(SaleCurrencyList.FirstOrDefault(a => a.Name == ((Currency)SelectedCurrency).Name));
                                    SelectedSaleCurrency = new List<object>(SelectedSaleCurrency);
                                    string fieldName = ((Currency)SelectedCurrency).Name;
                                    dTableCopy.Columns.Add(fieldName, typeof(bool));
                                    bi.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });
                                    SelectedSaleCurrency_Copy = SelectedSaleCurrency;
                                    dTableCopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));
                                }
                            }
                            foreach (BandItem band1 in SaleCurrencyCollection)
                            {
                                BandsTemplete.Remove(band1);
                            }
                        }
                        Dttable = dTableCopy;
                    }
                    #endregion
                    #region Get the Base Price List Columns for Plant and Currency from service Calls
                    else
                    {
                        /// Create Plant Template
                        BandsTemplete.Clear();
                        Dttable = new DataTable();
                        BandItem item1 = new BandItem() { BandName = "Plant", BandHeader = "Plant" };
                        Dttable.Columns.Add("Plant", typeof(string));
                        item1.Columns = new ObservableCollection<ColumnItem>();
                        item1.Columns.Add(new ColumnItem() { ColumnFieldName = "Plant", Width = 100, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                        BandsTemplete.Add(item1);
                        /// Create Sale Currency Template
                        foreach (Currency currency in SelectedSaleCurrency)
                        {
                            BandItem item2 = new BandItem();
                            string fieldName = currency.Name;
                            Dttable.Columns.Add(fieldName, typeof(bool));
                            item2.BandName = fieldName;
                            item2.BandHeader = fieldName;
                            item2.Columns = new ObservableCollection<ColumnItem>();
                            item2.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default, ImageSrc = currency.CurrencyIconImage });
                            BandsTemplete.Add(item2);
                        }
                        /// Fill the DataTable with records
                        foreach (Site plant in SelectedPlant)
                        {
                            if (!Dttable.Rows.Cast<DataRow>().Select(x => x.ItemArray[0]).Contains(plant.Name))
                            {
                                dr1 = Dttable.NewRow();
                                dr1["Plant"] = plant.Name;
                                foreach (Currency cur in SelectedSaleCurrency)
                                {
                                    if (PlantCurrencyList.FirstOrDefault(x => x.IdPlant == plant.IdSite && x.IdCurrency == cur.IdCurrency) == null)
                                    {
                                        dr1[cur.Name] = Convert.ToBoolean(0);
                                    }
                                    else
                                    {
                                        byte val = PlantCurrencyList.FirstOrDefault(x => x.IdPlant == plant.IdSite && x.IdCurrency == cur.IdCurrency).PlantbyCurrency;
                                        dr1[cur.Name] = Convert.ToBoolean(val);
                                    }
                                }
                                Dttable.Rows.Add(dr1);
                            }
                        }
                    }
                    #endregion

                    PlantCurrencyListWithIsChecked = new List<BasePriceListByPlantCurrency>();

                    foreach (DataRow dr in Dttable.Rows)
                    {
                        BasePriceListByPlantCurrency item = new BasePriceListByPlantCurrency();
                        item.PlantName = dr["Plant"].ToString();
                        if (!PlantCurrencyListWithIsChecked.Any(a => a.PlantName == item.PlantName))
                        {
                            foreach (Currency cur in SelectedSaleCurrency)
                            {
                                if (dr[cur.Name].ToString() == "True")
                                {
                                    if (string.IsNullOrEmpty(item.CurrenciesName))
                                    {
                                        item.CurrenciesName = cur.Name;
                                    }
                                    else
                                    {
                                        if (!item.CurrenciesName.Contains(cur.Name))
                                            item.CurrenciesName += ", " + cur.Name;
                                    }
                                }
                            }
                            PlantCurrencyListWithIsChecked.Add(item);
                        }
                    }

                }
                #endregion
                GeosApplication.Instance.Logger.Log("Method AddEditColumnsToPlantsDataTable()... Executed Successfully", category: Category.Info, priority: Priority.Low);
            }

            #region Catch Block
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in AddEditColumnsToPlantsDataTable() method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), "Red", CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in AddEditColumnsToPlantsDataTable() Method - ServiceUnexceptedException " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in AddEditColumnsToPlantsDataTable() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
            #endregion
        }
        //[nsatpute][GEOS2-7894][01.08.2025]
        private async Task FillDetectionDataAsync()
        {
            const string methodName = "FillDetectionData";
            GeosApplication.Instance.Logger.Log($"Method {methodName} started...", Category.Info, Priority.Low);
            try
            {
                DetectionList = DetectionList ?? new ObservableCollection<BasePriceListByItem>();

                if (DetectionList.Count > 0)
                {
                    var selectedCurrency = (Currency)SelectedCurrency;
                    int selectedCurrencyId = selectedCurrency.IdCurrency;
                    var firstCurrencyConversion = CurrencyConversionList.FirstOrDefault();
                    DateTime? currencyConversionDate = firstCurrencyConversion?.LastUpdate;
                    bool useExchangeRate = SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509;
                    string lastUpdatedDisplay = "Updated currency rate on : " + Convert.ToDateTime(LastUpdated).ToString("dd/MM/yyyy");

                    // Thread-safe collection to accumulate results
                    var items = new ConcurrentBag<DetectionItem>();

                    await Task.Run(() =>
                    {
                        Parallel.ForEach(DetectionList, detection =>
                        {
                            try
                            {
                                var model = new DetectionItem
                                {
                                    IsChecked = false,
                                    Code = string.IsNullOrEmpty(detection?.Detection?.Code) ? "---" : detection?.Detection?.Code,
                                    Type = detection.Detection.DetectionTypes.Name,
                                    STAT = detection.Detection.StatusAbbreviation,
                                    HtmlColor = detection.Detection.StatusHtmlColor,
                                    Name = detection.Detection.Name,
                                    IdDetection = detection.IdDetection,
                                    Logic = detection.IdRule,
                                    Value = detection.RuleValue
                                };

                                // Apply value rules
                                switch (detection.IdRule)
                                {
                                    case 1518:
                                        model.Value = 0.0;
                                        break;
                                    case 308 when detection.RuleValue == 0:
                                        model.Value = null;
                                        break;
                                    case 0:
                                        model.Value = null;
                                        break;
                                    default:
                                        model.Value = detection.RuleValue;
                                        break;
                                }

                                model.MaxCost_1 = detection.MaxCost;
                                if (double.IsNaN(model.MaxCost_1) || model.MaxCost_1 == null)
                                {
                                    model.MaxCost_1 = 0;
                                }

                                if (model.Logic == 0)
                                {
                                    model.Logic = 308; // Default
                                }

                                model.CurrencyConversionDate = currencyConversionDate;

                                // Calculate Common_Cur and fill currency conversions
                                ProcessCurrencyConversionsDetectionItem(model, model.MaxCost_1, selectedCurrencyId, useExchangeRate, currencyConversionDate);

                                double sellPriceValue = model.Common_Cur;
                                model.Profit = CalculateBasePriceProfitValue(model.MaxCost_1, sellPriceValue);
                                model.CostMargin = CalculateBasePriceCostMarginValue(model.MaxCost_1, sellPriceValue);

                                // Set sale currency conversion date display
                                if (model.CurrencyConversionDate.HasValue)
                                {
                                    var date = model.CurrencyConversionDate.Value;
                                    if (useExchangeRate)
                                        model.SaleCurrencyConversionDate = lastUpdatedDisplay;
                                    else
                                    {
                                        DateTime firstOfMonth = new DateTime(date.Year, date.Month, 1);
                                        model.SaleCurrencyConversionDate = "Updated currency rate on : " + firstOfMonth.ToString("dd/MM/yyyy");
                                    }
                                }

                                items.Add(model);
                            }
                            catch (Exception ex)
                            {
                                GeosApplication.Instance.SplashScreenMessage = string.Empty;
                                GeosApplication.Instance.Logger.Log($"Error in {methodName} for detection {detection.IdCPType}: {ex.Message}",
                                    Category.Exception, Priority.Low);
                            }
                        });
                    });

                    DetectionItems = new ObservableCollection<DetectionItem>(items.OrderBy(i => i.Code));
                    DtDetection = DtDetectionCopy = ConvertDetectionListToDataTable(DetectionItems);
                    GeosApplication.Instance.SplashScreenMessage = string.Empty;
                }
                GeosApplication.Instance.Logger.Log($"Method {methodName}() executed successfully", Category.Info, Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                HandleServiceException(ex, methodName);
            }
            catch (ServiceUnexceptedException ex)
            {
                HandleUnexpectedServiceException(ex, methodName);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log($"Error in {methodName}(): {ex.Message}", Category.Exception, Priority.Low);
            }
        }

        //[nsatpute][GEOS2-7894][01.08.2025]
        private void ProcessCurrencyConversionsDetectionItem(DetectionItem model, double maxCost, int selectedCurrencyId, bool useExchangeRate, DateTime? conversionDate)
        {
            if (!conversionDate.HasValue)
            {
                model.Common_Cur = 0;
                model.CurrencyConversionRates.Clear();
                model.CurrencyValues.Clear();
                return;
            }

            model.CurrencyConversionRates.Clear();
            model.CurrencyValues.Clear();

            int logic = model.Logic;
            double inputValue = model.Value ?? 0d;
            double costValue = model.MaxCost_1;
            var lastCurrencyConversion = CurrencyConversionList.FirstOrDefault();
            var lastUpdateDate = lastCurrencyConversion?.LastUpdate.Date ?? DateTime.Now;
            var costPriceLookup = ArticleCostPriceList
                 .GroupBy(x => (x.IdCompany, x.IdArticle))
                 .ToDictionary(g => g.Key, g => g.First());

            var currencyConvLookup = CurrencyConversionList
                .GroupBy(x => (x.Idcurrencyfrom, x.Idcurrencyto, x.LastUpdate.Date))
                .ToDictionary(g => g.Key, g => g.First());
            switch (logic)
            {
                case 307: // Cost + %
                    {
                        model.Common_Cur = costValue + (costValue * inputValue / 100d);
                        foreach (Currency currency in SelectedSaleCurrency)
                        {
                            var convKey = ((byte)selectedCurrencyId, (byte)currency.IdCurrency, lastUpdateDate);
                            if (currencyConvLookup.TryGetValue(convKey, out var conversion))
                            {
                                double? convRate = useExchangeRate
                                    ? conversion.ExchangeRate
                                    : conversion.LastMonthAVGRate;

                                if (currency.IdCurrency == selectedCurrencyId)
                                {
                                    model.CurrencyConversionRates["CurrencyConversionRate_Common_Cur"] = convRate;
                                    if (convRate.HasValue)
                                    {
                                        model.Common_Cur = model.Common_Cur * convRate.Value;
                                        model.CurrencyValues[currency.Name] = convRate.HasValue
                                       ? model.Common_Cur * convRate.Value
                                       : (double?)null;
                                    }
                                }
                                else
                                {
                                    model.CurrencyConversionRates["CurrencyConversionRate_" + currency.Name] = convRate;

                                    model.CurrencyValues[currency.Name] = convRate.HasValue
                                        ? model.Common_Cur * convRate.Value
                                        : (double?)null;

                                }
                            }
                        }
                    }
                    break;
                case 308: // Specific value or blank
                    model.Common_Cur = model.Value == null ? 0d : inputValue;
                    {
                        if (inputValue == null || inputValue <= 0)
                        {

                            foreach (Currency currency in SelectedSaleCurrency)
                            {
                                var convKey = ((byte)selectedCurrencyId, (byte)currency.IdCurrency, lastUpdateDate);
                                if (currencyConvLookup.TryGetValue(convKey, out var conversion))
                                {
                                    string rateKey = currency.IdCurrency == selectedCurrencyId
                                        ? "CurrencyConversionRate_Common_Cur"
                                        : "CurrencyConversionRate_" + currency.Name;

                                    model.CurrencyConversionRates[rateKey] = useExchangeRate
                                        ? conversion.ExchangeRate
                                        : conversion.LastMonthAVGRate;
                                }
                                model.CurrencyValues[currency.Name] = null;
                            }
                        }
                        else
                        {
                            model.Common_Cur = inputValue;
                            foreach (Currency currency in SelectedSaleCurrency)
                            {
                                var convKey = ((byte)selectedCurrencyId, (byte)currency.IdCurrency, lastUpdateDate);
                                if (currencyConvLookup.TryGetValue(convKey, out var conversion))
                                {
                                    double? convRate = useExchangeRate
                                        ? conversion.ExchangeRate
                                        : conversion.LastMonthAVGRate;

                                    if (currency.IdCurrency == selectedCurrencyId)
                                    {
                                        model.CurrencyConversionRates["CurrencyConversionRate_Common_Cur"] = convRate;
                                        if (convRate.HasValue)
                                        {
                                            model.Common_Cur = model.Common_Cur * convRate.Value;
                                            model.CurrencyValues[currency.Name] = convRate.HasValue
                                           ? model.Common_Cur * convRate.Value
                                           : (double?)null;
                                        }
                                    }
                                    else
                                    {
                                        model.CurrencyConversionRates["CurrencyConversionRate_" + currency.Name] = convRate;
                                        model.CurrencyValues[currency.Name] = convRate.HasValue
                                            ? model.Common_Cur * convRate.Value
                                            : (double?)null;
                                    }
                                }
                            }
                        }
                    }
                    break;
                case 1518: // All zeros
                    model.Common_Cur = 0d;
                    {
                        foreach (Currency currency in SelectedSaleCurrency)
                        {
                            var convKey = ((byte)selectedCurrencyId, (byte)currency.IdCurrency, lastUpdateDate);
                            if (currencyConvLookup.TryGetValue(convKey, out var conversion))
                            {
                                string rateKey = currency.IdCurrency == selectedCurrencyId
                                    ? "CurrencyConversionRate_Common_Cur"
                                    : "CurrencyConversionRate_" + currency.Name;

                                model.CurrencyConversionRates[rateKey] = useExchangeRate
                                    ? conversion.ExchangeRate
                                    : conversion.LastMonthAVGRate;
                            }
                            model.CurrencyValues[currency.Name] = 0;
                        }
                    }
                    break;
                case 309: // Cost + value
                    model.Common_Cur = (model.Value == null || model.Value == 0) ? costValue : costValue + inputValue;
                    foreach (Currency currency in SelectedSaleCurrency)
                    {
                        var convKey = ((byte)selectedCurrencyId, (byte)currency.IdCurrency, lastUpdateDate);
                        if (currencyConvLookup.TryGetValue(convKey, out var conversion))
                        {
                            double? convRate = useExchangeRate
                                ? conversion.ExchangeRate
                                : conversion.LastMonthAVGRate;

                            if (currency.IdCurrency == selectedCurrencyId)
                            {
                                model.CurrencyConversionRates["CurrencyConversionRate_Common_Cur"] = convRate;
                                if (convRate.HasValue)
                                {
                                    model.Common_Cur = model.Common_Cur * convRate.Value;
                                }
                                model.CurrencyValues[currency.Name] = convRate.HasValue
                                  ? model.Common_Cur * convRate.Value
                                  : (double?)null;
                            }
                            else
                            {
                                model.CurrencyConversionRates["CurrencyConversionRate_" + currency.Name] = convRate;
                                model.CurrencyValues[currency.Name] = convRate.HasValue
                                    ? model.Common_Cur * convRate.Value
                                    : (double?)null;
                            }
                        }
                    }
                    break;
                default:
                    model.Common_Cur = 0d;
                    break;
            }

        }

        //[nsatpute][GEOS2-7894][01.08.2025]
        private async Task ProcessDetectionItemAsync(BasePriceListByItem detection, int selectedCurrencyId,
            DateTime? currencyConversionDate, bool useExchangeRate, string lastUpdatedDisplay)
        {
            try
            {
                var dr = DtDetectionCopy.NewRow();

                // Set basic detection info
                SetBasicDetectionInfo(dr, detection);

                // Process rule-specific values
                ProcessRuleValues(dr, detection);

                // Set currency conversion date and handle null costs
                dr["CurrencyConversionDate"] = currencyConversionDate != null ? (object)currencyConversionDate : DBNull.Value;

                // Handle float (non-nullable) MaxCost
                float maxCostValue = detection.MaxCost; // Assuming MaxCost is float
                dr["MaxCost_1"] = maxCostValue != 0 ? (object)maxCostValue : (object)0;

                // Process currency conversions based on rule logic
                await ProcessCurrencyConversionsAsync(dr, selectedCurrencyId, currencyConversionDate,
                    useExchangeRate, maxCostValue != 0 ? maxCostValue : 0);

                // Calculate financial metrics
                CalculateFinancialMetrics(dr, maxCostValue != 0 ? maxCostValue : 0);

                // Set conversion date display
                SetConversionDateDisplay(dr, useExchangeRate, lastUpdatedDisplay, currencyConversionDate);

                DtDetectionCopy.Rows.Add(dr);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error processing detection {0}: {1}", detection.IdDetection, ex.Message),
                    Category.Exception, Priority.Low);
            }
        }
        //[nsatpute][GEOS2-7894][01.08.2025]
        private void SetBasicDetectionInfo(DataRow dr, BasePriceListByItem detection)
        {
            dr["IsChecked"] = false;
            dr["Code"] = string.IsNullOrEmpty(detection.Detection.Code) ? "---" : detection.Detection.Code;
            dr["Type"] = detection.Detection.DetectionTypes.Name;
            dr["STAT"] = detection.Detection.StatusAbbreviation;
            dr["HtmlColor"] = detection.Detection.StatusHtmlColor;
            dr["Name"] = detection.Detection.Name;
            dr["IdDetection"] = detection.IdDetection;
            dr["Logic"] = detection.IdRule;
            dr["Value"] = detection.RuleValue != 0 ? (object)detection.RuleValue : DBNull.Value;
        }
        //[nsatpute][GEOS2-7894][01.08.2025]
        private void ProcessRuleValues(DataRow dr, BasePriceListByItem detection)
        {
            if (detection.IdRule == 1518)
            {
                dr["Value"] = 0;
            }
            else if (detection.IdRule == 308 && detection.RuleValue == 0)
            {
                dr["Value"] = DBNull.Value;
            }
            else if (detection.IdRule == 0)
            {
                dr["Value"] = DBNull.Value;
            }

            // Default logic if null
            if (dr["Logic"] == DBNull.Value)
            {
                dr["Logic"] = 308;
            }
        }
        //[nsatpute][GEOS2-7894][01.08.2025]
        private async Task ProcessCurrencyConversionsAsync(DataRow dr, int selectedCurrencyId,
            DateTime? currencyConversionDate, bool useExchangeRate, float maxCost)
        {
            if (!(dr["Logic"] is int ruleId))
                return;
            if (!currencyConversionDate.HasValue)
                return;

            var commonCurValue = CalculateCommonCurrencyValue(dr, maxCost, ruleId);
            dr["Common_Cur"] = commonCurValue.HasValue ? (object)commonCurValue.Value : DBNull.Value;

            foreach (Currency currency in SelectedSaleCurrency)
            {
                await ProcessSingleCurrencyConversionAsync(dr, currency, selectedCurrencyId,
                    currencyConversionDate.Value, useExchangeRate, ruleId);
            }
        }
        //[nsatpute][GEOS2-7894][01.08.2025]
        private double? CalculateCommonCurrencyValue(DataRow dr, float maxCost, int ruleId)
        {
            switch (ruleId)
            {
                case 307:
                    return CalculatePercentageBasedValue(dr, maxCost);
                case 308:
                    return CalculateFixedValueWithChecks(dr);
                case 1518:
                    return 0;
                case 309:
                    return CalculateCostPlusValue(dr, maxCost);
                default:
                    return null;
            }
        }

        private double CalculatePercentageBasedValue(DataRow dr, float maxCost)
        {
            if (dr["Value"] == DBNull.Value)
                dr["Value"] = 0;
            return maxCost + (maxCost * (Convert.ToDouble(dr["Value"]) / 100));
        }

        private double? CalculateFixedValueWithChecks(DataRow dr)
        {
            if (dr["Value"] == DBNull.Value || (dr["Value"] != null && Convert.ToDouble(dr["Value"]) <= 0))
                return null;

            return dr["Value"] != DBNull.Value ? Convert.ToDouble(dr["Value"]) : (double?)null;
        }

        private double CalculateCostPlusValue(DataRow dr, float maxCost)
        {
            return dr["Value"] == DBNull.Value ? maxCost : maxCost + Convert.ToDouble(dr["Value"]);
        }

        private async Task ProcessSingleCurrencyConversionAsync(DataRow dr, Currency currency,
            int selectedCurrencyId, DateTime conversionDate, bool useExchangeRate, int ruleId)
        {
            bool isPrimaryCurrency = currency.IdCurrency == selectedCurrencyId;
            string rateField = isPrimaryCurrency
                ? "CurrencyConversionRate_Common_Cur"
                : string.Format("CurrencyConversionRate_{0}", currency.Name);

            var conversion = await FindCurrencyConversionAsync(selectedCurrencyId, currency.IdCurrency, conversionDate);
            if (conversion == null)
                return;

            dr[rateField] = useExchangeRate ? conversion.ExchangeRate : conversion.LastMonthAVGRate;

            if (isPrimaryCurrency)
            {
                dr["Common_Cur"] = ApplyConversion(dr["Common_Cur"], dr[rateField]);
            }
            else
            {
                dr[currency.Name] = ApplyConversion(dr["Common_Cur"], dr[rateField]);
            }
        }

        private Task<CurrencyConversion> FindCurrencyConversionAsync(int fromCurrency, int toCurrency, DateTime date)
        {
            return Task.Run(() =>
                CurrencyConversionList.FirstOrDefault(x =>
                    x.Idcurrencyfrom == Convert.ToByte(fromCurrency) &&
                    x.Idcurrencyto == toCurrency &&
                    x.LastUpdate.Date == date.Date));
        }

        private void CalculateFinancialMetrics(DataRow dr, float maxCost)
        {
            double sellPriceValue = dr["Common_Cur"] != DBNull.Value
                ? Convert.ToDouble(dr["Common_Cur"])
                : 0.00;

            dr["Profit"] = CalculateBasePriceProfitValue(maxCost, sellPriceValue);
            dr["CostMargin"] = CalculateBasePriceCostMarginValue(maxCost, sellPriceValue);
        }

        private void SetConversionDateDisplay(DataRow dr, bool useExchangeRate,
            string lastUpdatedDisplay, DateTime? currencyConversionDate)
        {
            if (dr["CurrencyConversionDate"] == DBNull.Value)
                return;

            if (useExchangeRate)
            {
                dr["SaleCurrencyConversionDate"] = lastUpdatedDisplay;
            }
            else if (currencyConversionDate.HasValue)
            {
                var dtCurrencyConversionDate = new DateTime(currencyConversionDate.Value.Year, currencyConversionDate.Value.Month, 1);
                dr["SaleCurrencyConversionDate"] = "Updated currency rate on : " + dtCurrencyConversionDate.ToString("dd/MM/yyyy");
            }
        }

        private void HandleServiceException(FaultException<ServiceException> ex, string methodName)
        {
            if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime)
            {
                DXSplashScreen.Close();
            }

            GeosApplication.Instance.Logger.Log(string.Format("Error in {0}(): {1}", methodName, ex.Detail.ErrorMessage),
                Category.Exception, Priority.Low);

            CustomMessageBox.Show(
                GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null),
                "Red",
                CustomMessageBox.MessageImagePath.NotOk,
                MessageBoxButton.OK);
        }
        //[nsatpute][GEOS2-7894][01.08.2025]
        private void HandleUnexpectedServiceException(ServiceUnexceptedException ex, string methodName)
        {
            if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime)
            {
                DXSplashScreen.Close();
            }

            GeosApplication.Instance.Logger.Log(string.Format("Error in {0}(): {1}", methodName, ex.Message),
                Category.Info, Priority.Low);

            GeosApplication.Instance.ExceptionHandlingOperation(
                ex.ExceptionType,
                GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(),
                null);
        }
        //[nsatpute][GEOS2-7894][01.08.2025]
        private async Task FillArticleDataAsync()
        {
            try
            {
                if (ArticleList.Count() > 0)
                {
                    var costPriceLookup = ArticleCostPriceList
                        .GroupBy(x => (x.IdCompany, x.IdArticle))
                        .ToDictionary(g => g.Key, g => g.First());

                    var currencyConvLookup = CurrencyConversionList
                        .GroupBy(x => (x.Idcurrencyfrom, x.Idcurrencyto, x.LastUpdate.Date))
                        .ToDictionary(g => g.Key, g => g.First());

                    var selectedCurrencyId = ((Currency)SelectedCurrency).IdCurrency;
                    var useExchangeRate = SelectedExchangeRate?.IdLookupValue == 1509;
                    var lastCurrencyConversion = CurrencyConversionList.FirstOrDefault();
                    var lastUpdateDate = lastCurrencyConversion?.LastUpdate.Date ?? DateTime.Now;

                    // Thread-safe collection
                    var items = new ConcurrentBag<PriceListItem>();

                    // Parallelize processing (you can control degree of parallelism, etc)
                    await Task.Run(() => Parallel.ForEach(ArticleList, article =>
                    {
                        try
                        {
                            var model = new PriceListItem
                            {
                                IsChecked = false,
                                Reference = article.ArticleData.Reference,
                                Category = article.ArticleData.PcmArticleCategory.Name,
                                STAT = article.ArticleData.PcmArticleCategory.StatusAbbreviation,
                                HtmlColor = article.ArticleData.PcmArticleCategory.StatusHtmlColor,
                                Name = article.ArticleData.Description,
                                IdArticle = Convert.ToUInt64(article.IdArticle),
                                Logic = article.IdRule,
                                Value = article.RuleValue
                            };

                            // Value logic
                            if (article.IdRule == 1518) model.Value = 0;
                            else if (article.IdRule == 308 && article.RuleValue == 0) model.Value = null;
                            else if (article.IdRule == 0) model.Value = null;
                            else model.Value = article.RuleValue;

                            // Cost Calculation (Max cost among plants)
                            double maxCost = 0d;
                            bool maxCostSet = false;
                            foreach (Site plant in SelectedPlant)
                            {
                                var key = (plant.IdSite, Convert.ToUInt32(article.IdArticle));
                                double plantCost = 0;
                                if (costPriceLookup.TryGetValue(key, out var cost))
                                    plantCost = cost.ArticleCostValue;

                                model.PlantCosts[plant.Name] = plantCost;
                                if (!maxCostSet || plantCost > maxCost)
                                {
                                    maxCost = plantCost;
                                    maxCostSet = true;
                                }
                            }
                            model.MaxCost_1 = maxCostSet ? maxCost : 0d;

                            // Currency conversion date
                            model.CurrencyConversionDate = lastCurrencyConversion?.LastUpdate;

                            // Main business logic for CommonCur
                            double inputValue = (model.Value ?? 0d);
                            int logic = article.IdRule;
                            double costValue = model.MaxCost_1;

                            switch (logic)
                            {
                                case 307: // Cost + %
                                    {
                                        model.Common_Cur = costValue + (costValue * inputValue / 100d);
                                        foreach (Currency currency in SelectedSaleCurrency)
                                        {
                                            var convKey = ((byte)selectedCurrencyId, (byte)currency.IdCurrency, lastUpdateDate);
                                            if (currencyConvLookup.TryGetValue(convKey, out var conversion))
                                            {
                                                double? convRate = useExchangeRate
                                                    ? conversion.ExchangeRate
                                                    : conversion.LastMonthAVGRate;

                                                if (currency.IdCurrency == selectedCurrencyId)
                                                {
                                                    model.CurrencyConversionRates["CurrencyConversionRate_Common_Cur"] = convRate;
                                                    if (convRate.HasValue)
                                                    {
                                                        model.Common_Cur = model.Common_Cur * convRate.Value;
                                                        model.CurrencyValues[currency.Name] = convRate.HasValue
                                                       ? model.Common_Cur * convRate.Value
                                                       : (double?)null;
                                                    }
                                                }
                                                else
                                                {
                                                    model.CurrencyConversionRates["CurrencyConversionRate_" + currency.Name] = convRate;

                                                    model.CurrencyValues[currency.Name] = convRate.HasValue
                                                        ? model.Common_Cur * convRate.Value
                                                        : (double?)null;

                                                }
                                            }
                                        }
                                    }
                                    break;
                                case 308: // Specific value or blank
                                    model.Common_Cur = model.Value == null ? 0d : inputValue;
                                    {
                                        if (inputValue == null || inputValue <= 0)
                                        {

                                            foreach (Currency currency in SelectedSaleCurrency)
                                            {
                                                var convKey = ((byte)selectedCurrencyId, (byte)currency.IdCurrency, lastUpdateDate);
                                                if (currencyConvLookup.TryGetValue(convKey, out var conversion))
                                                {
                                                    string rateKey = currency.IdCurrency == selectedCurrencyId
                                                        ? "CurrencyConversionRate_Common_Cur"
                                                        : "CurrencyConversionRate_" + currency.Name;

                                                    model.CurrencyConversionRates[rateKey] = useExchangeRate
                                                        ? conversion.ExchangeRate
                                                        : conversion.LastMonthAVGRate;
                                                }
                                                model.CurrencyValues[currency.Name] = null;
                                            }
                                        }
                                        else
                                        {
                                            model.Common_Cur = inputValue;
                                            foreach (Currency currency in SelectedSaleCurrency)
                                            {
                                                var convKey = ((byte)selectedCurrencyId, (byte)currency.IdCurrency, lastUpdateDate);
                                                if (currencyConvLookup.TryGetValue(convKey, out var conversion))
                                                {
                                                    double? convRate = useExchangeRate
                                                        ? conversion.ExchangeRate
                                                        : conversion.LastMonthAVGRate;

                                                    if (currency.IdCurrency == selectedCurrencyId)
                                                    {
                                                        model.CurrencyConversionRates["CurrencyConversionRate_Common_Cur"] = convRate;
                                                        if (convRate.HasValue)
                                                        {
                                                            model.Common_Cur = model.Common_Cur * convRate.Value;
                                                            model.CurrencyValues[currency.Name] = convRate.HasValue
                                                           ? model.Common_Cur * convRate.Value
                                                           : (double?)null;
                                                        }
                                                    }
                                                    else
                                                    {
                                                        model.CurrencyConversionRates["CurrencyConversionRate_" + currency.Name] = convRate;
                                                        model.CurrencyValues[currency.Name] = convRate.HasValue
                                                            ? model.Common_Cur * convRate.Value
                                                            : (double?)null;
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    break;
                                case 1518: // All zeros
                                    model.Common_Cur = 0d;
                                    {
                                        foreach (Currency currency in SelectedSaleCurrency)
                                        {
                                            var convKey = ((byte)selectedCurrencyId, (byte)currency.IdCurrency, lastUpdateDate);
                                            if (currencyConvLookup.TryGetValue(convKey, out var conversion))
                                            {
                                                string rateKey = currency.IdCurrency == selectedCurrencyId
                                                    ? "CurrencyConversionRate_Common_Cur"
                                                    : "CurrencyConversionRate_" + currency.Name;

                                                model.CurrencyConversionRates[rateKey] = useExchangeRate
                                                    ? conversion.ExchangeRate
                                                    : conversion.LastMonthAVGRate;
                                            }
                                            model.CurrencyValues[currency.Name] = 0;
                                        }
                                    }
                                    break;
                                case 309: // Cost + value
                                    model.Common_Cur = (model.Value == null || model.Value == 0) ? costValue : costValue + inputValue;
                                    foreach (Currency currency in SelectedSaleCurrency)
                                    {
                                        var convKey = ((byte)selectedCurrencyId, (byte)currency.IdCurrency, lastUpdateDate);
                                        if (currencyConvLookup.TryGetValue(convKey, out var conversion))
                                        {
                                            double? convRate = useExchangeRate
                                                ? conversion.ExchangeRate
                                                : conversion.LastMonthAVGRate;

                                            if (currency.IdCurrency == selectedCurrencyId)
                                            {
                                                model.CurrencyConversionRates["CurrencyConversionRate_Common_Cur"] = convRate;
                                                if (convRate.HasValue)
                                                {
                                                    model.Common_Cur = model.Common_Cur * convRate.Value;
                                                }
                                                model.CurrencyValues[currency.Name] = convRate.HasValue
                                                  ? model.Common_Cur * convRate.Value
                                                  : (double?)null;
                                            }
                                            else
                                            {
                                                model.CurrencyConversionRates["CurrencyConversionRate_" + currency.Name] = convRate;
                                                model.CurrencyValues[currency.Name] = convRate.HasValue
                                                    ? model.Common_Cur * convRate.Value
                                                    : (double?)null;
                                            }
                                        }
                                    }
                                    break;
                                default:
                                    model.Common_Cur = 0d;
                                    break;
                            }

                            // Profit and CostMargin Calculations
                            double sellPrice = model.Common_Cur;
                            model.Profit = CalculateBasePriceProfitValue(costValue, sellPrice);
                            model.CostMargin = CalculateBasePriceCostMarginValue(costValue, sellPrice);

                            // SaleCurrencyConversionDate formatting
                            if (model.CurrencyConversionDate != null)
                            {
                                var dat = model.CurrencyConversionDate.Value;
                                if (useExchangeRate)
                                    model.SaleCurrencyConversionDate = $"Updated currency rate on : {LastUpdated:dd/MM/yyyy}";
                                else
                                    model.SaleCurrencyConversionDate = $"Updated currency rate on : {new DateTime(dat.Year, dat.Month, 1):dd/MM/yyyy}";
                            }

                            items.Add(model);
                        }
                        catch (Exception ex)
                        {
                            GeosApplication.Instance.Logger.Log(
                                $"Error in FillArticleDataAsync for article {article.IdArticle}: {ex.Message}",
                                Category.Exception, Priority.Low);
                        }
                    }));

                    // After parallelism, assign (on main thread)
                    ArticleItems = new ObservableCollection<PriceListItem>(items.OrderBy(i => i.Reference)); // Or any requirement
                    DtArticle = DtArticleCopy = ConvertToDataTable(ArticleItems);
                }
                GeosApplication.Instance.Logger.Log($"Method FillArticleDataAsync executed successfully", Category.Info, Priority.Low);
                GeosApplication.Instance.SplashScreenMessage = string.Empty;
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime)
                    DXSplashScreen.Close();

                GeosApplication.Instance.Logger.Log($"Error in FillArticleDataAsync: {ex.Detail.ErrorMessage}", Category.Exception, Priority.Low);

                CustomMessageBox.Show(
                    GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null),
                    "Red", CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime)
                    DXSplashScreen.Close();
                GeosApplication.Instance.Logger.Log($"Error inFillArticleDataAsync: {ex.Message}", Category.Info, Priority.Low);

                GeosApplication.Instance.ExceptionHandlingOperation(
                    ex.ExceptionType,
                    GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(),
                    null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log($"Error in FillArticleDataAsync: {ex.Message}", Category.Exception, Priority.Low);
            }
        }
        //[nsatpute][GEOS2-7894][01.08.2025]
        private object ApplyConversion(object value, object rate)
        {
            if (value == DBNull.Value || rate == DBNull.Value)
                return DBNull.Value;

            try
            {
                return Convert.ToDouble(value) * Convert.ToDouble(rate);
            }
            catch
            {
                return DBNull.Value;
            }
        }
        //[nsatpute][GEOS2-7894][01.08.2025]
        private async Task FillModuleDataAsync()
        {
            const string methodName = "FillModuleData";
            GeosApplication.Instance.Logger.Log($"Method {methodName} started...", Category.Info, Priority.Low);

            try
            {
                // Defensive init
                ModuleList = ModuleList ?? new ObservableCollection<BasePriceListByItem>();
                if (ModuleList.Count() > 0)
                {
                    var currencyConversion = CurrencyConversionList.FirstOrDefault();
                    DateTime? conversionDate = currencyConversion != null ? currencyConversion.LastUpdate : (DateTime?)null;
                    bool useExchangeRate = SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509;
                    var selectedCurrencyId = ((Currency)SelectedCurrency).IdCurrency;
                    DateTime? lastUpdated = LastUpdated;

                    var items = new ConcurrentBag<ModuleItem>();

                    await Task.Run(() =>
                    {
                        Parallel.ForEach(ModuleList, module =>
                        {
                            try
                            {
                                var model = new ModuleItem();

                                // --- Basic Info
                                model.IsChecked = false;
                                model.Code = string.IsNullOrEmpty(module.ProductType.Code) ? "---" : module.ProductType.Code;
                                model.Type = module.ProductType.Template.Name;
                                model.STAT = module.ProductType.StatusAbbreviation;
                                model.HtmlColor = module.ProductType.StatusHtmlColor;
                                model.Name = module.ProductType.Name;
                                model.IdCPType = module.IdCPType;
                                model.Logic = module.IdRule;
                                model.MaxCost_1 = module.MaxCost;
                                if (model.MaxCost_1 == null)
                                    model.MaxCost_1 = 0;
                                model.CurrencyConversionDate = conversionDate;

                                // Make sure dictionaries are initialized
                                model.CurrencyConversionRates = new Dictionary<string, double?>();
                                model.CurrencyValues = new Dictionary<string, double?>();

                                double? value = null;
                                double commonCur = 0;

                                // --- Per-logic calculation: Value & Common_Cur ---
                                switch (module.IdRule)
                                {
                                    case 1518:
                                        value = 0;
                                        commonCur = 0;
                                        break;

                                    case 308:
                                        // Value: null if RuleValue == 0 or 0, else as set
                                        value = module.RuleValue == 0 ? (double?)null : module.RuleValue;
                                        // For 308: if Value is null or <=0, commonCur is 0, else Value
                                        if (!value.HasValue || value.Value <= 0)
                                            commonCur = 0;
                                        else
                                            commonCur = value.Value;
                                        break;

                                    case 307:
                                        value = module.RuleValue;
                                        commonCur = module.MaxCost + (module.MaxCost * (value ?? 0) / 100.0);
                                        break;

                                    case 309:
                                        value = module.RuleValue;
                                        commonCur = (!value.HasValue) ? module.MaxCost : (module.MaxCost + value.Value);
                                        break;

                                    default:
                                        value = module.RuleValue;
                                        commonCur = module.MaxCost;
                                        break;
                                }

                                model.Value = value;
                                model.Common_Cur = commonCur;

                                double inputValue = (model.Value ?? 0d);
                                int logic = module.IdRule;
                                double costValue = model.MaxCost_1;
                                var lastCurrencyConversion = CurrencyConversionList.FirstOrDefault();
                                var lastUpdateDate = lastCurrencyConversion?.LastUpdate.Date ?? DateTime.Now;
                                var currencyConvLookup = CurrencyConversionList
                                 .GroupBy(x => (x.Idcurrencyfrom, x.Idcurrencyto, x.LastUpdate.Date))
                                 .ToDictionary(g => g.Key, g => g.First());
                                switch (logic)
                                {
                                    case 307: // Cost + %
                                        {
                                            model.Common_Cur = costValue + (costValue * inputValue / 100d);
                                            foreach (Currency currency in SelectedSaleCurrency)
                                            {
                                                var convKey = ((byte)selectedCurrencyId, (byte)currency.IdCurrency, lastUpdateDate);
                                                if (currencyConvLookup.TryGetValue(convKey, out var conversion))
                                                {
                                                    double? convRate = useExchangeRate
                                                        ? conversion.ExchangeRate
                                                        : conversion.LastMonthAVGRate;

                                                    if (currency.IdCurrency == selectedCurrencyId)
                                                    {
                                                        model.CurrencyConversionRates["CurrencyConversionRate_Common_Cur"] = convRate;
                                                        if (convRate.HasValue)
                                                        {
                                                            model.Common_Cur = model.Common_Cur * convRate.Value;
                                                            model.CurrencyValues[currency.Name] = convRate.HasValue
                                                           ? model.Common_Cur * convRate.Value
                                                           : (double?)null;
                                                        }
                                                    }
                                                    else
                                                    {
                                                        model.CurrencyConversionRates["CurrencyConversionRate_" + currency.Name] = convRate;

                                                        model.CurrencyValues[currency.Name] = convRate.HasValue
                                                            ? model.Common_Cur * convRate.Value
                                                            : (double?)null;

                                                    }
                                                }
                                            }
                                        }
                                        break;
                                    case 308: // Specific value or blank
                                        model.Common_Cur = model.Value == null ? 0d : inputValue;
                                        {
                                            if (inputValue == null || inputValue <= 0)
                                            {

                                                foreach (Currency currency in SelectedSaleCurrency)
                                                {
                                                    var convKey = ((byte)selectedCurrencyId, (byte)currency.IdCurrency, lastUpdateDate);
                                                    if (currencyConvLookup.TryGetValue(convKey, out var conversion))
                                                    {
                                                        string rateKey = currency.IdCurrency == selectedCurrencyId
                                                            ? "CurrencyConversionRate_Common_Cur"
                                                            : "CurrencyConversionRate_" + currency.Name;

                                                        model.CurrencyConversionRates[rateKey] = useExchangeRate
                                                            ? conversion.ExchangeRate
                                                            : conversion.LastMonthAVGRate;
                                                    }
                                                    model.CurrencyValues[currency.Name] = null;
                                                }
                                            }
                                            else
                                            {
                                                model.Common_Cur = inputValue;
                                                foreach (Currency currency in SelectedSaleCurrency)
                                                {
                                                    var convKey = ((byte)selectedCurrencyId, (byte)currency.IdCurrency, lastUpdateDate);
                                                    if (currencyConvLookup.TryGetValue(convKey, out var conversion))
                                                    {
                                                        double? convRate = useExchangeRate
                                                            ? conversion.ExchangeRate
                                                            : conversion.LastMonthAVGRate;

                                                        if (currency.IdCurrency == selectedCurrencyId)
                                                        {
                                                            model.CurrencyConversionRates["CurrencyConversionRate_Common_Cur"] = convRate;
                                                            if (convRate.HasValue)
                                                            {
                                                                model.Common_Cur = model.Common_Cur * convRate.Value;
                                                                model.CurrencyValues[currency.Name] = convRate.HasValue
                                                               ? model.Common_Cur * convRate.Value
                                                               : (double?)null;
                                                            }
                                                        }
                                                        else
                                                        {
                                                            model.CurrencyConversionRates["CurrencyConversionRate_" + currency.Name] = convRate;
                                                            model.CurrencyValues[currency.Name] = convRate.HasValue
                                                                ? model.Common_Cur * convRate.Value
                                                                : (double?)null;
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                        break;
                                    case 1518: // All zeros
                                        model.Common_Cur = 0d;
                                        {
                                            foreach (Currency currency in SelectedSaleCurrency)
                                            {
                                                var convKey = ((byte)selectedCurrencyId, (byte)currency.IdCurrency, lastUpdateDate);
                                                if (currencyConvLookup.TryGetValue(convKey, out var conversion))
                                                {
                                                    string rateKey = currency.IdCurrency == selectedCurrencyId
                                                        ? "CurrencyConversionRate_Common_Cur"
                                                        : "CurrencyConversionRate_" + currency.Name;

                                                    model.CurrencyConversionRates[rateKey] = useExchangeRate
                                                        ? conversion.ExchangeRate
                                                        : conversion.LastMonthAVGRate;
                                                }
                                                model.CurrencyValues[currency.Name] = 0;
                                            }
                                        }
                                        break;
                                    case 309: // Cost + value
                                        model.Common_Cur = (model.Value == null || model.Value == 0) ? costValue : costValue + inputValue;
                                        foreach (Currency currency in SelectedSaleCurrency)
                                        {
                                            var convKey = ((byte)selectedCurrencyId, (byte)currency.IdCurrency, lastUpdateDate);
                                            if (currencyConvLookup.TryGetValue(convKey, out var conversion))
                                            {
                                                double? convRate = useExchangeRate
                                                    ? conversion.ExchangeRate
                                                    : conversion.LastMonthAVGRate;

                                                if (currency.IdCurrency == selectedCurrencyId)
                                                {
                                                    model.CurrencyConversionRates["CurrencyConversionRate_Common_Cur"] = convRate;
                                                    if (convRate.HasValue)
                                                    {
                                                        model.Common_Cur = model.Common_Cur * convRate.Value;
                                                    }
                                                    model.CurrencyValues[currency.Name] = convRate.HasValue
                                                      ? model.Common_Cur * convRate.Value
                                                      : (double?)null;
                                                }
                                                else
                                                {
                                                    model.CurrencyConversionRates["CurrencyConversionRate_" + currency.Name] = convRate;
                                                    model.CurrencyValues[currency.Name] = convRate.HasValue
                                                        ? model.Common_Cur * convRate.Value
                                                        : (double?)null;
                                                }
                                            }
                                        }
                                        break;
                                    default:
                                        model.Common_Cur = 0d;
                                        break;
                                }

                                // --- set per-item profit & cost margin ---
                                double sellPriceValue = model.Common_Cur;
                                model.Profit = CalculateBasePriceProfitValue(model.MaxCost_1, sellPriceValue);
                                model.CostMargin = CalculateBasePriceCostMarginValue(model.MaxCost_1, sellPriceValue);

                                // --- Set SaleCurrencyConversionDate ---
                                if (model.CurrencyConversionDate.HasValue)
                                {
                                    var date = model.CurrencyConversionDate.Value;
                                    if (useExchangeRate && lastUpdated.HasValue)
                                        model.SaleCurrencyConversionDate = "Updated currency rate on : " + lastUpdated.Value.ToString("dd/MM/yyyy");
                                    else
                                    {
                                        var dtCurrencyConversionDate = new DateTime(date.Year, date.Month, 1);
                                        model.SaleCurrencyConversionDate = "Updated currency rate on : " + dtCurrencyConversionDate.ToString("dd/MM/yyyy");
                                    }
                                }

                                items.Add(model);
                            }
                            catch (Exception ex)
                            {
                                GeosApplication.Instance.Logger.Log(
                                    $"Error in {methodName} for module {module.IdCPType}: {ex.Message}",
                                    Category.Exception, Priority.Low);
                            }
                        });
                    });

                    ModuleItems = new ObservableCollection<ModuleItem>(items.OrderBy(i => i.Code));
                    DtModule = DtModuleCopy = ConvertModuleItemsToDataTable(ModuleItems);
                }
                GeosApplication.Instance.Logger.Log($"Method {methodName}() executed successfully", Category.Info, Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime)
                    DXSplashScreen.Close();

                GeosApplication.Instance.Logger.Log(
                    $"Error in {methodName}(): {ex.Detail.ErrorMessage}",
                    Category.Exception, Priority.Low);

                CustomMessageBox.Show(
                    GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null),
                    "Red", CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime)
                    DXSplashScreen.Close();

                GeosApplication.Instance.Logger.Log(
                    $"Error in {methodName}(): {ex.Message}",
                    Category.Info, Priority.Low);

                GeosApplication.Instance.ExceptionHandlingOperation(
                    ex.ExceptionType,
                    GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(),
                    null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(
                    $"Error in {methodName}(): {ex.Message}",
                    Category.Exception, Priority.Low);
            }
        }


        //[nsatpute][GEOS2-7894][01.08.2025]
        private void ProcessCurrencyConversionsModuleItem(ModuleItem model, double maxCost, int selectedCurrencyId, bool useExchangeRate, DateTime? conversionDate)
        {
            if (conversionDate == null)
            {
                // No conversion date, clear values and exit
                model.Common_Cur = 0;
                model.CurrencyConversionRates.Clear();
                model.CurrencyValues.Clear();
                return;
            }

            // Begin with computing Common_Cur if not already set - but typically caller sets this before.
            // This method only handles applying conversion rates.

            // Clear previous values (in case reused)
            model.CurrencyConversionRates.Clear();
            model.CurrencyValues.Clear();

            // For each currency in the sales currency list
            foreach (Currency currency in SelectedSaleCurrency)
            {
                // Find matching currency conversion record
                CurrencyConversion conversion = CurrencyConversionList.FirstOrDefault(x =>
                    x.Idcurrencyfrom == (byte)selectedCurrencyId &&
                    x.Idcurrencyto == currency.IdCurrency &&
                    x.LastUpdate.Date == conversionDate.Value.Date);

                double? conversionRate = null;

                if (conversion != null)
                {
                    conversionRate = useExchangeRate ? conversion.ExchangeRate : conversion.LastMonthAVGRate;
                }

                // Key used for rates and values dictionary — "Common_Cur" for base currency conversion rate, otherwise currency name
                string rateKey = currency.IdCurrency == selectedCurrencyId ? "Common_Cur" : currency.Name;

                // Store the conversion rate (or null)
                if (model.CurrencyConversionRates.ContainsKey(rateKey))
                {
                    model.CurrencyConversionRates["CurrencyConversionRate_" + rateKey] = conversionRate;
                }
                else
                {
                    model.CurrencyConversionRates.Add("CurrencyConversionRate_" + rateKey, conversionRate);
                }

                // Calculate converted value if possible
                if (conversionRate.HasValue && model.Common_Cur != 0)
                {
                    double convertedValue = model.Common_Cur * conversionRate.Value;

                    if (model.CurrencyValues.ContainsKey(currency.Name))
                    {
                        model.CurrencyValues[currency.Name] = convertedValue;
                    }
                    else
                    {
                        model.CurrencyValues.Add(currency.Name, convertedValue);
                    }
                }
                else
                {
                    // Conversion rate or Common_Cur missing: set null
                    if (model.CurrencyValues.ContainsKey(currency.Name))
                    {
                        model.CurrencyValues[currency.Name] = null;
                    }
                    else
                    {
                        model.CurrencyValues.Add(currency.Name, null);
                    }
                }
            }
        }
        private async Task FillMenuListDataAsync(BasePrice temp)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillMenuListDataAsync ...", category: Category.Info, priority: Priority.Low);
                DateTime start = DateTime.Now;
                //set gray color
                foreach (BasePriceListByItem article in ArticleList)
                {
                    ArticleMenuList.Where(a => a.IdArticle == article.IdArticle).ToList().ForEach(b => b.IsBPLArticle_Current = true);

                }


                #region GEOS2-3126 [Gulab lakade]
                ObservableCollection<PCMArticleCategory> ArticleMenuListtemp1 = new ObservableCollection<PCMArticleCategory>();
                foreach (PCMArticleCategory item in ArticleMenuList)
                {
                    string TempName = item.Name.Remove(item.Name.LastIndexOf("[") + 1);
                    int t = ArticleMenuList.Where(x => x.ParentName == item.KeyName && x.IsBPLArticle_Current == false).ToList().Count;
                    PCMArticleCategory ArticleMenuList1 = new PCMArticleCategory();
                    ArticleMenuList1.IdArticle = item.IdArticle;
                    //Shubham[skadam] GEOS2-4784 GEOS2-4785 No additional data so remove [0] this in tree menu in article, detection & module  left tree in BPL menu 29 08 2023
                    try
                    {
                        Int64 Count = ArticleMenuList.Where(x => x.ParentName == item.KeyName && x.IsBPLArticle_Current == false).ToList().Count;
                        if (Count != 0)
                        {
                            ArticleMenuList1.Name = TempName + Count + "]";
                        }
                        else
                        {
                            if (!string.IsNullOrEmpty(TempName))
                            {
                                ArticleMenuList1.Name = TempName.Remove(TempName.Length - 1);
                            }
                            else
                            {
                                if (!string.IsNullOrEmpty(item.Name))
                                {
                                    ArticleMenuList1.Name = item.Name;
                                }
                                else
                                {
                                    ArticleMenuList1.Name = "";
                                }
                            }
                        }
                    }
                    catch (Exception ex) { }
                    ArticleMenuList1.NameWithArticleCount = item.NameWithArticleCount;
                    ArticleMenuList1.ParentName = item.ParentName;
                    ArticleMenuList1.KeyName = item.KeyName;
                    ArticleMenuList1.Reference = item.Reference;
                    ArticleMenuList1.StatusHtmlColor = item.StatusHtmlColor;
                    ArticleMenuList1.IdPCMArticleCategory = item.IdPCMArticleCategory;
                    ArticleMenuList1.IsBPLArticle = item.IsBPLArticle;
                    ArticleMenuList1.IsBPLArticle_Current = item.IsBPLArticle_Current;
                    ArticleMenuListtemp1.Add(ArticleMenuList1);
                }
                ArticleMenuList = new ObservableCollection<PCMArticleCategory>();
                ArticleMenuList.AddRange(ArticleMenuListtemp1);
                #endregion
                //[Sudhir.Jangra][GEOS2-3126][21/12/2022]

                //set gray color for Detections
                foreach (BasePriceListByItem detection in DetectionList)
                {
                    DetectionMenulist.Where(a => a.IdDetection == detection.IdDetection).ToList().ForEach(b => b.IsBPLArticle_Current = true);
                }
                #region GEOS2-3126 [Sudhir Jangra]

                ObservableCollection<BPLDetection> DetectionMenuListtemp1 = new ObservableCollection<BPLDetection>();

                foreach (BPLDetection item in DetectionMenulist)
                {
                    string TempName = item.Name.Remove(item.Name.LastIndexOf("[") + 1);
                    int t = DetectionMenulist.Where(x => x.ParentName == item.KeyName && x.IsBPLArticle_Current == false).ToList().Count;
                    BPLDetection DetectionMenuList1 = new BPLDetection();
                    DetectionMenuList1.IdDetection = item.IdDetection;
                    //Shubham[skadam] GEOS2-4784 GEOS2-4785 No additional data so remove [0] this in tree menu in article, detection & module  left tree in BPL menu 29 08 2023
                    try
                    {
                        Int64 Count = DetectionMenulist.Where(x => x.ParentName == item.KeyName && x.IsBPLArticle_Current == false).ToList().Count;
                        if (Count != 0)
                        {
                            DetectionMenuList1.Name = TempName + Count + "]";
                        }
                        else
                        {
                            if (!string.IsNullOrEmpty(TempName))
                            {
                                DetectionMenuList1.Name = TempName.Remove(TempName.Length - 1);
                            }
                            else
                            {
                                if (!string.IsNullOrEmpty(item.Name))
                                {
                                    DetectionMenuList1.Name = item.Name;
                                }
                                else
                                {
                                    DetectionMenuList1.Name = "";
                                }
                            }
                        }
                    }
                    catch (Exception ex) { }
                    DetectionMenuList1.ParentName = item.ParentName;
                    DetectionMenuList1.KeyName = item.KeyName;
                    DetectionMenuList1.Description = item.Description;
                    DetectionMenuList1.DetectionTypeName = item.DetectionTypeName;
                    DetectionMenuList1.IdDetectionType = item.IdDetectionType;
                    DetectionMenuList1.IdGroup = item.IdGroup;
                    DetectionMenuList1.Code = item.Code;
                    DetectionMenuList1.StatusHtmlColor = item.StatusHtmlColor;
                    DetectionMenuList1.IsBPLArticle_Current = item.IsBPLArticle_Current;
                    DetectionMenuListtemp1.Add(DetectionMenuList1);
                }
                DetectionMenulist = new ObservableCollection<BPLDetection>();
                DetectionMenulist.AddRange(DetectionMenuListtemp1);
                #endregion

                try
                {
                    //set gray color for Module
                    foreach (BasePriceListByItem detection in ModuleList)
                    {
                        ModuleMenulist.Where(a => a.IdCPType == detection.IdCPType).ToList().ForEach(b => b.IsBPLdModule_Current = true);
                    }
                    #region BPLModule
                    ObservableCollection<BPLModule> ModuleMenuListtemp1 = new ObservableCollection<BPLModule>();
                    foreach (BPLModule item in ModuleMenulist)
                    {
                        string TempName = item.Name.Remove(item.Name.LastIndexOf("[") + 1);
                        int t = ModuleMenulist.Where(x => x.Parent == item.Key && x.IsBPLdModule_Current == false).ToList().Count;
                        BPLModule ModuleMenuList1 = new BPLModule();
                        ModuleMenuList1.IdCPType = item.IdCPType;
                        //Shubham[skadam] GEOS2-4784 GEOS2-4785 No additional data so remove [0] this in tree menu in article, detection & module  left tree in BPL menu 29 08 2023
                        try
                        {
                            Int64 Count = ModuleMenulist.Where(x => x.Parent == item.Key && x.IsBPLdModule_Current == false).ToList().Count;
                            if (Count != 0)
                            {
                                ModuleMenuList1.Name = TempName + Count + "]";
                            }
                            else
                            {
                                if (!string.IsNullOrEmpty(TempName))
                                {
                                    ModuleMenuList1.Name = TempName.Remove(TempName.Length - 1);
                                }
                                else
                                {
                                    if (!string.IsNullOrEmpty(item.Name))
                                    {
                                        ModuleMenuList1.Name = item.Name;
                                    }
                                    else
                                    {
                                        ModuleMenuList1.Name = "";
                                    }
                                }
                            }
                        }
                        catch (Exception ex) { }
                        ModuleMenuList1.Parent = item.Parent;
                        ModuleMenuList1.Key = item.Key;
                        ModuleMenuList1.TemplateName = item.TemplateName;
                        ModuleMenuList1.IdTemplate = item.IdTemplate;
                        ModuleMenuList1.StatusHtmlColor = item.StatusHtmlColor;
                        ModuleMenuList1.StatusAbbreviation = item.StatusAbbreviation;
                        ModuleMenuList1.IsBPLdModule_Current = item.IsBPLdModule_Current;
                        ModuleMenuList1.ProductType = item.ProductType;
                        ModuleMenuListtemp1.Add(ModuleMenuList1);
                    }
                    ModuleMenulist = new ObservableCollection<BPLModule>();
                    ModuleMenulist.AddRange(ModuleMenuListtemp1);
                    #endregion
                }
                catch (Exception ex)
                {
                }
                if (temp.LogList != null)
                {
                    BasePriceChangeLogList = new ObservableCollection<BasePriceLogEntry>();

                    BasePriceChangeLogList.AddRange(temp.LogList);
                    if (BasePriceChangeLogList.Count > 0)
                        SelectedBasePriceChangeLog = BasePriceChangeLogList.FirstOrDefault();
                }
                // shubham[skadam] GEOS2-3272 Custom filters in the BPL and CPL grid [#PLM39] 01 12 2022
                try
                {
                    //FillFilterTileBar();
                    AddCustomSetting();
                    //DetectionFillFilterTileBar();
                    DetectionAddCustomSetting();
                    ModuleAddCustomSetting();
                }
                catch (Exception ex)
                {
                }
                DateTime end = DateTime.Now;
                TimeSpan timeDifference = end - start;
                GeosApplication.Instance.Logger.Log("Method FillMenuListDataAsync() executed successfully " + $"Total Seconds: {timeDifference.TotalSeconds}", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillMenuListDataAsync() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        public void EditInitBasePrice(BasePrice tempBasePrice)
        {
            try
            {
                //DateTime start = DateTime.Now;
                IsEnabledAcceptButton = true;
                GeosApplication.Instance.Logger.Log(string.Format("Method EditInitBasePrice..."), category: Category.Info, priority: Priority.Low);
                ExportPriceListButtonVisibility = Visibility.Visible;

                if (tempBasePrice.IdPermission == "62")
                {
                    IsUserPermission = true;
                    if (GeosApplication.Instance.IsPLMPermissionChange == true)
                        IsEnabledAcceptButton = IsDuplicateBasePriceButtonEnabled = true;
                }
                else if (tempBasePrice.IdPermission == "50")
                {
                    IsUserPermission = false;
                    if (GeosApplication.Instance.IsPLMPermissionChange == false)
                        IsEnabledAcceptButton = IsDuplicateBasePriceButtonEnabled = false;
                }
                //  BasePrice temp = (PLMService.GetBasePriceDetailById_V2180(tempBasePrice.IdBasePriceList));
                //BasePrice temp = (PLMService.GetBasePriceDetailById_V2340(tempBasePrice.IdBasePriceList));
                // BasePrice temp = (PLMService.GetBasePriceDetailById_V2370(tempBasePrice.IdBasePriceList));

                //[Sudhir.Jangra][GEOS2-4935]
                DateTime startGetBasePriceDetailById_V2470 = DateTime.Now;
                //BasePrice temp = (PLMService.GetBasePriceDetailById_V2470(tempBasePrice.IdBasePriceList));
                //Shubham[skadam] GEOS2-6688 PCM- Improve performance to open BPL grid and any BPL
                //PLMService = new PLMServiceController("localhost:6699");
                BasePrice temp = (PLMService.GetBasePriceDetailById_V2640(tempBasePrice.IdBasePriceList));
                DateTime endGetBasePriceDetailById = DateTime.Now;
                TimeSpan timeDifferenceGetBasePriceDetailById = endGetBasePriceDetailById - startGetBasePriceDetailById_V2470;
                GeosApplication.Instance.Logger.Log("Method GetBasePriceDetailById " + $"Total Seconds: {timeDifferenceGetBasePriceDetailById.TotalSeconds}", category: Category.Info, priority: Priority.Low);

                CommentsList = new ObservableCollection<BasePriceLogEntry>(temp.BasePriceCommentsList.OrderByDescending(x => x.Datetime));
                if (CommentsList?.Count > 0)
                {
                    CommentText = CommentsList.FirstOrDefault().Comments;
                    CommentDateTimeText = CommentsList.FirstOrDefault().Datetime;
                    CommentFullNameText = CommentsList.FirstOrDefault().UserName;

                    //CommentText = CommentsList[CommentsList.Count - 1].Comments;
                    //CommentDateTimeText = CommentsList[CommentsList.Count - 1].Datetime;
                    //CommentFullNameText = CommentsList[CommentsList.Count - 1].UserName;
                }
                else
                {
                    CommentText = string.Empty; // or some default value if there are no comments
                    CommentDateTimeText = null;
                    CommentFullNameText = string.Empty;
                }

                SetUserProfileImage(CommentsList);



                ClonedBasePrice = (BasePrice)temp.Clone();

                if (ClonedBasePrice.IdStatus == 224)
                    InActiveStatus = true;
                else
                    InActiveStatus = false;

                IdBasePriceList = temp.IdBasePriceList;
                SelectedBasePriceCode = temp.Code;

                Description = temp.Description;
                oldDescription = string.IsNullOrEmpty(Description) ? "" : Description;
                Description_en = temp.Description;
                oldDescription_en = string.IsNullOrEmpty(Description_en) ? "" : Description_en;
                Description_es = temp.Description_es;
                oldDescription_es = string.IsNullOrEmpty(Description_es) ? "" : Description_es;
                Description_fr = temp.Description_fr;
                oldDescription_fr = string.IsNullOrEmpty(Description_fr) ? "" : Description_fr;
                Description_pt = temp.Description_pt;
                oldDescription_pt = string.IsNullOrEmpty(Description_pt) ? "" : Description_pt;
                Description_ro = temp.Description_ro;
                oldDescription_ro = string.IsNullOrEmpty(Description_ro) ? "" : Description_ro;
                Description_ru = temp.Description_ru;
                oldDescription_ru = string.IsNullOrEmpty(Description_ru) ? "" : Description_ru;
                Description_zh = temp.Description_zh;
                oldDescription_zh = string.IsNullOrEmpty(Description_zh) ? "" : Description_zh;

                Name = temp.Name;
                oldName = string.IsNullOrEmpty(Name) ? "" : Name;
                Name_en = temp.Name;
                oldName_en = string.IsNullOrEmpty(Name_en) ? "" : Name_en;
                Name_es = temp.Name_es;
                oldName_es = string.IsNullOrEmpty(Name_es) ? "" : Name_es;
                Name_fr = temp.Name_fr;
                oldName_fr = string.IsNullOrEmpty(Name_fr) ? "" : Name_fr;
                Name_pt = temp.Name_pt;
                oldName_pt = string.IsNullOrEmpty(Name_pt) ? "" : Name_pt;
                Name_ro = temp.Name_ro;
                oldName_ro = string.IsNullOrEmpty(Name_ro) ? "" : Name_ro;
                Name_ru = temp.Name_ru;
                oldName_ru = string.IsNullOrEmpty(Name_ru) ? "" : Name_ru;
                Name_zh = temp.Name_zh;
                oldName_zh = string.IsNullOrEmpty(Name_zh) ? "" : Name_zh;

                Remark = temp.Remark;
                oldRemark = string.IsNullOrEmpty(Remark) ? "" : Remark;
                Remark_en = temp.Remark;
                Remark_es = temp.Remark_es;
                Remark_fr = temp.Remark_fr;
                Remark_pt = temp.Remark_pt;
                Remark_ro = temp.Remark_ro;
                Remark_ru = temp.Remark_ru;
                Remark_zh = temp.Remark_zh;

                CreationDate = temp.CreationDate;
                if (temp.ExpiryDate != DateTime.MinValue)
                {
                    ExpiryDate = temp.ExpiryDate;
                }
                if (temp.EffectiveDate != DateTime.MinValue)
                {
                    EffectiveDate = temp.EffectiveDate;
                }
                if (temp.LastUpdated != DateTime.MinValue)
                {
                    LastUpdated = temp.LastUpdated;
                }

                if (PlantList != null)
                {
                    if (SelectedPlant == null)
                        SelectedPlant = new List<object>();
                    foreach (Site plant in temp.PlantList)
                    {
                        SelectedPlant.Add(PlantList.FirstOrDefault(a => a.IdSite == plant.IdSite));
                    }
                }
                SelectedPlant = new List<object>(SelectedPlant);
                SelectedPlant_Copy = new List<object>(SelectedPlant);

                //SaleCurrency
                if (SaleCurrencyList != null)
                {
                    if (SelectedSaleCurrency == null)
                        SelectedSaleCurrency = new List<object>();
                    foreach (Currency plant in temp.CurrencyList)
                    {
                        SelectedSaleCurrency.Add(SaleCurrencyList.FirstOrDefault(a => a.IdCurrency == plant.IdCurrency));
                    }
                }
                SelectedSaleCurrency = new List<object>(SelectedSaleCurrency);
                SelectedSaleCurrency_Copy = new List<object>(SelectedSaleCurrency);

                if (PlantCurrencyList == null)
                {
                    PlantCurrencyList = new List<BasePriceListByPlantCurrency>();
                }
                PlantCurrencyList = temp.PlantCurrencyList;
                PlantCurrencyListWithIsChecked = new List<BasePriceListByPlantCurrency>();

                if (CurrencyList != null)
                {
                    SelectedCurrency = CurrencyList.FirstOrDefault(x => x.IdCurrency == temp.IdCurrency);
                    SelectedCurrency_Copy = SelectedCurrency;
                }

                if (StatusList != null)
                    SelectedStatus = StatusList.FirstOrDefault(x => x.IdLookupValue == temp.IdStatus);

                if (ExchangeRateList != null)
                {
                    if (temp.IdExchangeRateUpdateType == null)
                    {
                        SelectedExchangeRate = ExchangeRateList.FirstOrDefault();
                    }
                    else
                    {
                        SelectedExchangeRate = ExchangeRateList.FirstOrDefault(x => x.IdLookupValue == temp.IdExchangeRateUpdateType);
                    }
                    if (SelectedExchangeRate != null)
                    {
                        SelectedExchangeRateIndex = ExchangeRateList.FindIndex(x => x.IdLookupValue == SelectedExchangeRate.IdLookupValue);
                    }
                }


                SelectedOriginalStatus = SelectedStatus;

                if (Name_en == Name_es && Name_en == Name_fr && Name_en == Name_pt && Name_en == Name_ro && Name_en == Name_ru && Name_en == Name_zh)
                {
                    IsCopyName = true;
                }
                if (Description_en == Description_es && Description_en == Description_fr && Description_en == Description_pt && Description_en == Description_ro && Description_en == Description_ru && Description_en == Description_zh)
                {
                    IsCopyDescription = true;
                }

                if (Remark_en == Remark_es && Remark_en == Remark_fr && Remark_en == Remark_pt && Remark_en == Remark_ro && Remark_en == Remark_ru && Remark_en == Remark_zh)
                {
                    IsCopyRemark = true;
                }

                if (IsCopyName == true && IsCopyDescription == true && IsCopyRemark == true)
                {
                    IsCheckedAllLanguages = true;
                }
                else
                {
                    IsCheckedAllLanguages = false;
                }
                oldIsCheckedAllLanguages = IsCheckedAllLanguages;
                //FillArticleCostPriceList();
                //DateTime startFill = DateTime.Now;
                //FillArticleCostPriceListNew();
                FillCurrencyConversionList_All();
                ArticleList = new ObservableCollection<BasePriceListByItem>(temp.BasePriceListItems);
                DetectionList = new ObservableCollection<BasePriceListByItem>(temp.BasePriceListDetections);
                ModuleList = new ObservableCollection<BasePriceListByItem>(temp.BasePriceListModules);
                AddColumnsArticleDetectionModuleAsyncData();
                FillArticleCostPriceListNew();
                FillArticleDetectionModuleAsyncData();
                //DateTime endFill = DateTime.Now;
                //TimeSpan timeDifferenceFill = endFill - startFill;
                //GeosApplication.Instance.Logger.Log("Method FillAsyncData " + $"Total Seconds: {timeDifferenceFill.TotalSeconds}", category: Category.Info, priority: Priority.Low);
                /*
                var tasks=new List<System.Threading.Tasks.Task>();
                tasks.Add(System.Threading.Tasks.Task.Run(() => FillArticleCostPriceListNew()));
                tasks.Add(System.Threading.Tasks.Task.Run(() => FillCurrencyConversionList_All()));
                tasks.Add(System.Threading.Tasks.Task.Run(() => AddColumnsToArticleDataTable()));
                tasks.Add(System.Threading.Tasks.Task.Run(() => AddColumnsToDetectionDataTable()));
                tasks.Add(System.Threading.Tasks.Task.Run(() => AddColumnsToModuleDataTable()));
                tasks.Add(System.Threading.Tasks.Task.Run(() => AddEditColumnsToPlantsDataTable()));
                tasks.Add(System.Threading.Tasks.Task.Run(() => FillArticleData()));
                tasks.Add(System.Threading.Tasks.Task.Run(() => FillDetectionData()));
                tasks.Add(System.Threading.Tasks.Task.Run(() => FillModuleData()));
                System.Threading.Tasks.Task.WaitAll(tasks.ToArray());
                */
                /*
                AddColumnsToArticleDataTable();
                AddColumnsToDetectionDataTable();
                AddColumnsToModuleDataTable();
                AddEditColumnsToPlantsDataTable();
                FillArticleData();
                FillDetectionData();
                FillModuleData();

                //Attachment(temp);
                //SetGrayColor(temp);
                //Customfilters();

                //var tasks = new List<Task>();
                //tasks.Add(Task.Run(() => Attachment(temp)));
                //tasks.Add(Task.Run(() => SetGrayColor(temp)));
                //tasks.Add(Task.Run(() => Customfilters()));
                //Task.WaitAll(tasks.ToArray());
                */
                foreach (DataRow dr in Dttable.Rows)
                {
                    BasePriceListByPlantCurrency item = new BasePriceListByPlantCurrency();

                    item.PlantName = dr["Plant"].ToString();
                    if (!PlantCurrencyListWithIsChecked.Any(a => a.PlantName == item.PlantName))
                    {
                        foreach (Currency cur in SelectedSaleCurrency)
                        {
                            if (dr[cur.Name].ToString() == "True")
                            {
                                if (string.IsNullOrEmpty(item.CurrenciesName))
                                {
                                    item.CurrenciesName = cur.Name;
                                }
                                else
                                {
                                    if (!item.CurrenciesName.Contains(cur.Name))
                                        item.CurrenciesName += " " + cur.Name;
                                }
                            }
                        }
                        PlantCurrencyListWithIsChecked.Add(item);
                    }
                }
                //   Attachment
                OptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>(temp.PLMArticleAttachmentList);
                OptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn));
                if (OptionWayDetectionSparePartFilesList.Count > 0)
                    SelectedOptionWayDetectionSparePartFile = OptionWayDetectionSparePartFilesList.FirstOrDefault();
                if (GeosApplication.Instance.PCMAttachment != null)//[Sudhir.Jangra][Geos2-1960][06/03/2023]
                {
                    if (GeosApplication.Instance.PCMAttachment != "4" && GeosApplication.Instance.PCMAttachment != "3"
                        && GeosApplication.Instance.PCMAttachment != "2" && GeosApplication.Instance.PCMAttachment != "1")
                    {
                        if (OptionWayDetectionSparePartFilesList.Count() >= 5)
                        {
                            IsAttachmentScrollVisible = "Visible";
                        }
                        else
                        {
                            IsAttachmentScrollVisible = "Disabled";
                        }
                    }
                    else
                    {
                        IsAttachmentScrollVisible = "Disabled";
                    }
                    if (GeosApplication.Instance.PCMAttachment == "1")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(1).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "2")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(2).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "3")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(3).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "4")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(4).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "5")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(5).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "6")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(6).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "7")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(7).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "8")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(8).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "9")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(9).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "10")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(10).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "11")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(11).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "12")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(12).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "13")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(13).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "14")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(14).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "15")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(15).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "16")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(16).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "17")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(17).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "18")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(18).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "19")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(19).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "20")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(20).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "All")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).ToList());
                    }
                }

                //FillMenuListDataInBackground(temp);

                //set gray color
                foreach (BasePriceListByItem article in ArticleList)
                {
                    ArticleMenuList.Where(a => a.IdArticle == article.IdArticle).ToList().ForEach(b => b.IsBPLArticle_Current = true);
                }


                #region GEOS2-3126 [Gulab lakade]
                ObservableCollection<PCMArticleCategory> ArticleMenuListtemp1 = new ObservableCollection<PCMArticleCategory>();
                foreach (PCMArticleCategory item in ArticleMenuList)
                {
                    string TempName = item.Name.Remove(item.Name.LastIndexOf("[") + 1);
                    int t = ArticleMenuList.Where(x => x.ParentName == item.KeyName && x.IsBPLArticle_Current == false).ToList().Count;
                    PCMArticleCategory ArticleMenuList1 = new PCMArticleCategory();
                    ArticleMenuList1.IdArticle = item.IdArticle;
                    //Shubham[skadam] GEOS2-4784 GEOS2-4785 No additional data so remove [0] this in tree menu in article, detection & module  left tree in BPL menu 29 08 2023
                    try
                    {
                        Int64 Count = ArticleMenuList.Where(x => x.ParentName == item.KeyName && x.IsBPLArticle_Current == false).ToList().Count;
                        if (Count != 0)
                        {
                            ArticleMenuList1.Name = TempName + Count + "]";
                        }
                        else
                        {
                            if (!string.IsNullOrEmpty(TempName))
                            {
                                ArticleMenuList1.Name = TempName.Remove(TempName.Length - 1);
                            }
                            else
                            {
                                if (!string.IsNullOrEmpty(item.Name))
                                {
                                    ArticleMenuList1.Name = item.Name;
                                }
                                else
                                {
                                    ArticleMenuList1.Name = "";
                                }
                            }
                        }
                    }
                    catch (Exception ex) { }
                    ArticleMenuList1.NameWithArticleCount = item.NameWithArticleCount;
                    ArticleMenuList1.ParentName = item.ParentName;
                    ArticleMenuList1.KeyName = item.KeyName;
                    ArticleMenuList1.Reference = item.Reference;
                    ArticleMenuList1.StatusHtmlColor = item.StatusHtmlColor;
                    ArticleMenuList1.IdPCMArticleCategory = item.IdPCMArticleCategory;
                    ArticleMenuList1.IsBPLArticle = item.IsBPLArticle;
                    ArticleMenuList1.IsBPLArticle_Current = item.IsBPLArticle_Current;
                    ArticleMenuListtemp1.Add(ArticleMenuList1);
                }
                ArticleMenuList = new ObservableCollection<PCMArticleCategory>();
                ArticleMenuList.AddRange(ArticleMenuListtemp1);
                #endregion
                //[Sudhir.Jangra][GEOS2-3126][21/12/2022]

                //set gray color for Detections
                foreach (BasePriceListByItem detection in DetectionList)
                {
                    DetectionMenulist.Where(a => a.IdDetection == detection.IdDetection).ToList().ForEach(b => b.IsBPLArticle_Current = true);
                }
                #region GEOS2-3126 [Sudhir Jangra]

                ObservableCollection<BPLDetection> DetectionMenuListtemp1 = new ObservableCollection<BPLDetection>();

                foreach (BPLDetection item in DetectionMenulist)
                {
                    string TempName = item.Name.Remove(item.Name.LastIndexOf("[") + 1);
                    int t = DetectionMenulist.Where(x => x.ParentName == item.KeyName && x.IsBPLArticle_Current == false).ToList().Count;
                    BPLDetection DetectionMenuList1 = new BPLDetection();
                    DetectionMenuList1.IdDetection = item.IdDetection;
                    //Shubham[skadam] GEOS2-4784 GEOS2-4785 No additional data so remove [0] this in tree menu in article, detection & module  left tree in BPL menu 29 08 2023
                    try
                    {
                        Int64 Count = DetectionMenulist.Where(x => x.ParentName == item.KeyName && x.IsBPLArticle_Current == false).ToList().Count;
                        if (Count != 0)
                        {
                            DetectionMenuList1.Name = TempName + Count + "]";
                        }
                        else
                        {
                            if (!string.IsNullOrEmpty(TempName))
                            {
                                DetectionMenuList1.Name = TempName.Remove(TempName.Length - 1);
                            }
                            else
                            {
                                if (!string.IsNullOrEmpty(item.Name))
                                {
                                    DetectionMenuList1.Name = item.Name;
                                }
                                else
                                {
                                    DetectionMenuList1.Name = "";
                                }
                            }
                        }
                    }
                    catch (Exception ex) { }
                    DetectionMenuList1.ParentName = item.ParentName;
                    DetectionMenuList1.KeyName = item.KeyName;
                    DetectionMenuList1.Description = item.Description;
                    DetectionMenuList1.DetectionTypeName = item.DetectionTypeName;
                    DetectionMenuList1.IdDetectionType = item.IdDetectionType;
                    DetectionMenuList1.IdGroup = item.IdGroup;
                    DetectionMenuList1.Code = item.Code;
                    DetectionMenuList1.StatusHtmlColor = item.StatusHtmlColor;
                    DetectionMenuList1.IsBPLArticle_Current = item.IsBPLArticle_Current;
                    DetectionMenuListtemp1.Add(DetectionMenuList1);
                }
                DetectionMenulist = new ObservableCollection<BPLDetection>();
                DetectionMenulist.AddRange(DetectionMenuListtemp1);
                #endregion

                try
                {
                    //set gray color for Module
                    foreach (BasePriceListByItem detection in ModuleList)
                    {
                        ModuleMenulist.Where(a => a.IdCPType == detection.IdCPType).ToList().ForEach(b => b.IsBPLdModule_Current = true);
                    }
                    #region BPLModule
                    ObservableCollection<BPLModule> ModuleMenuListtemp1 = new ObservableCollection<BPLModule>();
                    foreach (BPLModule item in ModuleMenulist)
                    {
                        string TempName = item.Name.Remove(item.Name.LastIndexOf("[") + 1);
                        int t = ModuleMenulist.Where(x => x.Parent == item.Key && x.IsBPLdModule_Current == false).ToList().Count;
                        BPLModule ModuleMenuList1 = new BPLModule();
                        ModuleMenuList1.IdCPType = item.IdCPType;
                        //Shubham[skadam] GEOS2-4784 GEOS2-4785 No additional data so remove [0] this in tree menu in article, detection & module  left tree in BPL menu 29 08 2023
                        try
                        {
                            Int64 Count = ModuleMenulist.Where(x => x.Parent == item.Key && x.IsBPLdModule_Current == false).ToList().Count;
                            if (Count != 0)
                            {
                                ModuleMenuList1.Name = TempName + Count + "]";
                            }
                            else
                            {
                                if (!string.IsNullOrEmpty(TempName))
                                {
                                    ModuleMenuList1.Name = TempName.Remove(TempName.Length - 1);
                                }
                                else
                                {
                                    if (!string.IsNullOrEmpty(item.Name))
                                    {
                                        ModuleMenuList1.Name = item.Name;
                                    }
                                    else
                                    {
                                        ModuleMenuList1.Name = "";
                                    }
                                }
                            }
                        }
                        catch (Exception ex) { }
                        ModuleMenuList1.Parent = item.Parent;
                        ModuleMenuList1.Key = item.Key;
                        ModuleMenuList1.TemplateName = item.TemplateName;
                        ModuleMenuList1.IdTemplate = item.IdTemplate;
                        ModuleMenuList1.StatusHtmlColor = item.StatusHtmlColor;
                        ModuleMenuList1.StatusAbbreviation = item.StatusAbbreviation;
                        ModuleMenuList1.IsBPLdModule_Current = item.IsBPLdModule_Current;
                        ModuleMenuList1.ProductType = item.ProductType;
                        ModuleMenuListtemp1.Add(ModuleMenuList1);
                    }
                    ModuleMenulist = new ObservableCollection<BPLModule>();
                    ModuleMenulist.AddRange(ModuleMenuListtemp1);
                    #endregion
                }
                catch (Exception ex)
                {
                }
                if (temp.LogList != null)
                {
                    BasePriceChangeLogList = new ObservableCollection<BasePriceLogEntry>();

                    BasePriceChangeLogList.AddRange(temp.LogList);
                    if (BasePriceChangeLogList.Count > 0)
                        SelectedBasePriceChangeLog = BasePriceChangeLogList.FirstOrDefault();
                }
                // shubham[skadam] GEOS2-3272 Custom filters in the BPL and CPL grid [#PLM39] 01 12 2022
                try
                {
                    //FillFilterTileBar();
                    AddCustomSetting();
                    //DetectionFillFilterTileBar();
                    DetectionAddCustomSetting();
                    ModuleAddCustomSetting();
                }
                catch (Exception ex)
                {
                }
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.SplashScreenMessage = "";
                GeosApplication.Instance.Logger.Log(string.Format("Method EditInitBasePrice()....executed successfully"), category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in EditInitBasePrice() Method " + ex.Detail.ErrorMessage, category: Category.Info, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in EditInitBasePrice() Method - ServiceUnexceptedException " + ex.Message, category: Category.Info, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString(), null);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in Method EditInitBasePrice()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }

        }

        public void Attachment(BasePrice temp)
        {
            try
            {
                foreach (DataRow dr in Dttable.Rows)
                {
                    BasePriceListByPlantCurrency item = new BasePriceListByPlantCurrency();

                    item.PlantName = dr["Plant"].ToString();
                    if (!PlantCurrencyListWithIsChecked.Any(a => a.PlantName == item.PlantName))
                    {
                        foreach (Currency cur in SelectedSaleCurrency)
                        {
                            if (dr[cur.Name].ToString() == "True")
                            {
                                if (string.IsNullOrEmpty(item.CurrenciesName))
                                {
                                    item.CurrenciesName = cur.Name;
                                }
                                else
                                {
                                    if (!item.CurrenciesName.Contains(cur.Name))
                                        item.CurrenciesName += " " + cur.Name;
                                }
                            }
                        }
                        PlantCurrencyListWithIsChecked.Add(item);
                    }
                }
                //   Attachment
                OptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>(temp.PLMArticleAttachmentList);
                OptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn));
                if (OptionWayDetectionSparePartFilesList.Count > 0)
                    SelectedOptionWayDetectionSparePartFile = OptionWayDetectionSparePartFilesList.FirstOrDefault();
                if (GeosApplication.Instance.PCMAttachment != null)//[Sudhir.Jangra][Geos2-1960][06/03/2023]
                {
                    if (GeosApplication.Instance.PCMAttachment != "4" && GeosApplication.Instance.PCMAttachment != "3"
                        && GeosApplication.Instance.PCMAttachment != "2" && GeosApplication.Instance.PCMAttachment != "1")
                    {
                        if (OptionWayDetectionSparePartFilesList.Count() >= 5)
                        {
                            IsAttachmentScrollVisible = "Visible";
                        }
                        else
                        {
                            IsAttachmentScrollVisible = "Disabled";
                        }
                    }
                    else
                    {
                        IsAttachmentScrollVisible = "Disabled";
                    }
                    if (GeosApplication.Instance.PCMAttachment == "1")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(1).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "2")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(2).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "3")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(3).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "4")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(4).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "5")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(5).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "6")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(6).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "7")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(7).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "8")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(8).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "9")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(9).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "10")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(10).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "11")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(11).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "12")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(12).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "13")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(13).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "14")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(14).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "15")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(15).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "16")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(16).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "17")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(17).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "18")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(18).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "19")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(19).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "20")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(20).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "All")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).ToList());
                    }
                }
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method Attachment()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        public void SetGrayColor(BasePrice temp)
        {
            DateTime startcolor = DateTime.Now;
            //set gray color
            foreach (BasePriceListByItem article in ArticleList)
            {
                ArticleMenuList.Where(a => a.IdArticle == article.IdArticle).ToList().ForEach(b => b.IsBPLArticle_Current = true);

            }


            #region GEOS2-3126 [Gulab lakade]
            ObservableCollection<PCMArticleCategory> ArticleMenuListtemp1 = new ObservableCollection<PCMArticleCategory>();
            foreach (PCMArticleCategory item in ArticleMenuList)
            {
                string TempName = item.Name.Remove(item.Name.LastIndexOf("[") + 1);
                int t = ArticleMenuList.Where(x => x.ParentName == item.KeyName && x.IsBPLArticle_Current == false).ToList().Count;
                PCMArticleCategory ArticleMenuList1 = new PCMArticleCategory();
                ArticleMenuList1.IdArticle = item.IdArticle;
                //Shubham[skadam] GEOS2-4784 GEOS2-4785 No additional data so remove [0] this in tree menu in article, detection & module  left tree in BPL menu 29 08 2023
                try
                {
                    Int64 Count = ArticleMenuList.Where(x => x.ParentName == item.KeyName && x.IsBPLArticle_Current == false).ToList().Count;
                    if (Count != 0)
                    {
                        ArticleMenuList1.Name = TempName + Count + "]";
                    }
                    else
                    {
                        if (!string.IsNullOrEmpty(TempName))
                        {
                            ArticleMenuList1.Name = TempName.Remove(TempName.Length - 1);
                        }
                        else
                        {
                            if (!string.IsNullOrEmpty(item.Name))
                            {
                                ArticleMenuList1.Name = item.Name;
                            }
                            else
                            {
                                ArticleMenuList1.Name = "";
                            }
                        }
                    }
                }
                catch (Exception ex) { }
                ArticleMenuList1.NameWithArticleCount = item.NameWithArticleCount;
                ArticleMenuList1.ParentName = item.ParentName;
                ArticleMenuList1.KeyName = item.KeyName;
                ArticleMenuList1.Reference = item.Reference;
                ArticleMenuList1.StatusHtmlColor = item.StatusHtmlColor;
                ArticleMenuList1.IdPCMArticleCategory = item.IdPCMArticleCategory;
                ArticleMenuList1.IsBPLArticle = item.IsBPLArticle;
                ArticleMenuList1.IsBPLArticle_Current = item.IsBPLArticle_Current;
                ArticleMenuListtemp1.Add(ArticleMenuList1);
            }
            ArticleMenuList = new ObservableCollection<PCMArticleCategory>();
            ArticleMenuList.AddRange(ArticleMenuListtemp1);
            #endregion
            //[Sudhir.Jangra][GEOS2-3126][21/12/2022]

            //set gray color for Detections
            foreach (BasePriceListByItem detection in DetectionList)
            {
                DetectionMenulist.Where(a => a.IdDetection == detection.IdDetection).ToList().ForEach(b => b.IsBPLArticle_Current = true);
            }
            #region GEOS2-3126 [Sudhir Jangra]

            ObservableCollection<BPLDetection> DetectionMenuListtemp1 = new ObservableCollection<BPLDetection>();

            foreach (BPLDetection item in DetectionMenulist)
            {
                string TempName = item.Name.Remove(item.Name.LastIndexOf("[") + 1);
                int t = DetectionMenulist.Where(x => x.ParentName == item.KeyName && x.IsBPLArticle_Current == false).ToList().Count;
                BPLDetection DetectionMenuList1 = new BPLDetection();
                DetectionMenuList1.IdDetection = item.IdDetection;
                //Shubham[skadam] GEOS2-4784 GEOS2-4785 No additional data so remove [0] this in tree menu in article, detection & module  left tree in BPL menu 29 08 2023
                try
                {
                    Int64 Count = DetectionMenulist.Where(x => x.ParentName == item.KeyName && x.IsBPLArticle_Current == false).ToList().Count;
                    if (Count != 0)
                    {
                        DetectionMenuList1.Name = TempName + Count + "]";
                    }
                    else
                    {
                        if (!string.IsNullOrEmpty(TempName))
                        {
                            DetectionMenuList1.Name = TempName.Remove(TempName.Length - 1);
                        }
                        else
                        {
                            if (!string.IsNullOrEmpty(item.Name))
                            {
                                DetectionMenuList1.Name = item.Name;
                            }
                            else
                            {
                                DetectionMenuList1.Name = "";
                            }
                        }
                    }
                }
                catch (Exception ex) { }
                DetectionMenuList1.ParentName = item.ParentName;
                DetectionMenuList1.KeyName = item.KeyName;
                DetectionMenuList1.Description = item.Description;
                DetectionMenuList1.DetectionTypeName = item.DetectionTypeName;
                DetectionMenuList1.IdDetectionType = item.IdDetectionType;
                DetectionMenuList1.IdGroup = item.IdGroup;
                DetectionMenuList1.Code = item.Code;
                DetectionMenuList1.StatusHtmlColor = item.StatusHtmlColor;
                DetectionMenuList1.IsBPLArticle_Current = item.IsBPLArticle_Current;
                DetectionMenuListtemp1.Add(DetectionMenuList1);
            }
            DetectionMenulist = new ObservableCollection<BPLDetection>();
            DetectionMenulist.AddRange(DetectionMenuListtemp1);
            #endregion
            try
            {
                //set gray color for Module
                foreach (BasePriceListByItem detection in ModuleList)
                {
                    ModuleMenulist.Where(a => a.IdCPType == detection.IdCPType).ToList().ForEach(b => b.IsBPLdModule_Current = true);
                }
                #region BPLModule
                ObservableCollection<BPLModule> ModuleMenuListtemp1 = new ObservableCollection<BPLModule>();
                foreach (BPLModule item in ModuleMenulist)
                {
                    string TempName = item.Name.Remove(item.Name.LastIndexOf("[") + 1);
                    int t = ModuleMenulist.Where(x => x.Parent == item.Key && x.IsBPLdModule_Current == false).ToList().Count;
                    BPLModule ModuleMenuList1 = new BPLModule();
                    ModuleMenuList1.IdCPType = item.IdCPType;
                    //Shubham[skadam] GEOS2-4784 GEOS2-4785 No additional data so remove [0] this in tree menu in article, detection & module  left tree in BPL menu 29 08 2023
                    try
                    {
                        Int64 Count = ModuleMenulist.Where(x => x.Parent == item.Key && x.IsBPLdModule_Current == false).ToList().Count;
                        if (Count != 0)
                        {
                            ModuleMenuList1.Name = TempName + Count + "]";
                        }
                        else
                        {
                            if (!string.IsNullOrEmpty(TempName))
                            {
                                ModuleMenuList1.Name = TempName.Remove(TempName.Length - 1);
                            }
                            else
                            {
                                if (!string.IsNullOrEmpty(item.Name))
                                {
                                    ModuleMenuList1.Name = item.Name;
                                }
                                else
                                {
                                    ModuleMenuList1.Name = "";
                                }
                            }
                        }
                    }
                    catch (Exception ex) { }
                    ModuleMenuList1.Parent = item.Parent;
                    ModuleMenuList1.Key = item.Key;
                    ModuleMenuList1.TemplateName = item.TemplateName;
                    ModuleMenuList1.IdTemplate = item.IdTemplate;
                    ModuleMenuList1.StatusHtmlColor = item.StatusHtmlColor;
                    ModuleMenuList1.StatusAbbreviation = item.StatusAbbreviation;
                    ModuleMenuList1.IsBPLdModule_Current = item.IsBPLdModule_Current;
                    ModuleMenuList1.ProductType = item.ProductType;
                    ModuleMenuListtemp1.Add(ModuleMenuList1);
                }
                ModuleMenulist = new ObservableCollection<BPLModule>();
                ModuleMenulist.AddRange(ModuleMenuListtemp1);
                #endregion
            }
            catch (Exception ex)
            {
            }
            if (temp.LogList != null)
            {
                BasePriceChangeLogList = new ObservableCollection<BasePriceLogEntry>();

                BasePriceChangeLogList.AddRange(temp.LogList);
                if (BasePriceChangeLogList.Count > 0)
                    SelectedBasePriceChangeLog = BasePriceChangeLogList.FirstOrDefault();
            }
            DateTime endcolor = DateTime.Now;
            TimeSpan timeDifferencecolor = endcolor - startcolor;
            GeosApplication.Instance.Logger.Log("Method color " + $"Total Seconds: {timeDifferencecolor.TotalSeconds}", category: Category.Info, priority: Priority.Low);
        }
        public void Customfilters()
        {
            // shubham[skadam] GEOS2-3272 Custom filters in the BPL and CPL grid [#PLM39] 01 12 2022
            try
            {
                //FillFilterTileBar();
                AddCustomSetting();
                //DetectionFillFilterTileBar();
                DetectionAddCustomSetting();
                ModuleAddCustomSetting();
            }
            catch (Exception ex)
            {

            }
        }

        private void ShowDescriptionViewCommandAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ShowDescriptionViewCommandAction()...", category: Category.Info, priority: Priority.Low);

                if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }
                FillArticleMenuList();

                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Error in ShowDescriptionViewCommandAction() Method " + ex.Detail.ErrorMessage, category: Category.Info, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Error in ShowDescriptionViewCommandAction() Method - ServiceUnexceptedException " + ex.Message, category: Category.Info, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString(), null);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Error in ShowDescriptionViewCommandAction()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        private void ShowReferenceViewCommandAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ShowReferenceViewCommandAction()...", category: Category.Info, priority: Priority.Low);

                if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }
                FillReferenceView();
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Error in ShowReferenceViewCommandAction() Method " + ex.Detail.ErrorMessage, category: Category.Info, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Error in ShowReferenceViewCommandAction() Method - ServiceUnexceptedException " + ex.Message, category: Category.Info, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString(), null);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Error in ShowReferenceViewCommandAction()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        private void SetMaximizedElement()
        {
            if (GeosApplication.Instance.UserSettings != null && GeosApplication.Instance.UserSettings.ContainsKey("PLM_Appearance"))
            {
                if (string.IsNullOrEmpty(GeosApplication.Instance.UserSettings["PLM_Appearance"].ToString()))
                {
                    SelectedAppearanceItem = (MaximizedElementPosition)Enum.Parse(typeof(MaximizedElementPosition), "Right", true);
                }
                else
                {
                    SelectedAppearanceItem = (MaximizedElementPosition)Enum.Parse(typeof(MaximizedElementPosition), GeosApplication.Instance.UserSettings["PLM_Appearance"].ToString(), true);
                }
            }
            else
            {
                SelectedAppearanceItem = (MaximizedElementPosition)Enum.Parse(typeof(MaximizedElementPosition), "Right", true);
            }
        }

        private void FillStatusList()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillStatusList()...", category: Category.Info, priority: Priority.Low);

                //IList<LookupValue> tempStatusList = PCMService.GetLookupValues(45);
                //StatusList = new List<LookupValue>();
                //StatusList = new List<LookupValue>(tempStatusList);
                //SelectedStatus = StatusList.FirstOrDefault(x => x.IdLookupValue == 225);
                //SelectedStatusIndex = StatusList.FindIndex(x => x.IdLookupValue == 225);

                //[pramod.misal][16.04.2025][GEOS2-6688]
                if (PLMCommon.Instance.TempStatusList == null || PLMCommon.Instance.TempStatusList?.Count == 0)
                {
                    PLMCommon.Instance.TempStatusList = PCMService.GetLookupValues(45);

                }
                if (PLMCommon.Instance.TempStatusList != null)
                {
                    IList<LookupValue> tempStatusList = PLMCommon.Instance.TempStatusList;
                    StatusList = new List<LookupValue>();
                    StatusList = new List<LookupValue>(tempStatusList);
                }

                SelectedStatus = StatusList.FirstOrDefault(x => x.IdLookupValue == 225);
                SelectedStatusIndex = StatusList.FindIndex(x => x.IdLookupValue == 225);

                GeosApplication.Instance.Logger.Log("Method FillStatusList()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillStatusList() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillStatusList() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method FillStatusList() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void FillExchangeRateList()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillExchangeRateList()...", category: Category.Info, priority: Priority.Low);

                //IList<LookupValue> tempExchangeRateList = PCMService.GetLookupValues(75); // need to check Lookup key and values
                //ExchangeRateList = new List<LookupValue>();
                //ExchangeRateList = new List<LookupValue>(tempExchangeRateList.Where(inUseOption => inUseOption.InUse == true));

                //SelectedExchangeRate = ExchangeRateList.FirstOrDefault();
                //SelectedExchangeRateIndex = ExchangeRateList.FindIndex(x => x.IdLookupValue == SelectedExchangeRate.IdLookupValue);

                //[pramod.misal][16.04.2025][GEOS2-6688]
                if (PLMCommon.Instance.TempExchangeRateList == null || PLMCommon.Instance.TempExchangeRateList?.Count == 0)
                {
                    PLMCommon.Instance.TempExchangeRateList = PCMService.GetLookupValues(75);

                }
                if (PLMCommon.Instance.TempExchangeRateList != null)
                {
                    IList<LookupValue> tempExchangeRateList = PLMCommon.Instance.TempExchangeRateList;
                    ExchangeRateList = new List<LookupValue>();
                    ExchangeRateList = new List<LookupValue>(tempExchangeRateList.Where(inUseOption => inUseOption.InUse == true));
                }
                SelectedExchangeRate = ExchangeRateList.FirstOrDefault();
                SelectedExchangeRateIndex = ExchangeRateList.FindIndex(x => x.IdLookupValue == SelectedExchangeRate.IdLookupValue);


                GeosApplication.Instance.Logger.Log("Method FillExchangeRateList()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillExchangeRateList() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillExchangeRateList() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method FillExchangeRateList() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void GetLatestBasePriceCode()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method GetLatestBasePriceCode()...", category: Category.Info, priority: Priority.Low);

                //if (!isDuplicateCliked)
                //    SelectedBasePriceCode = PLMService.GetLatestBasePriceCode();
                //else
                //    DuplicateCode = PLMService.GetLatestBasePriceCode();


                //[pramod.misal][16.04.2025][GEOS2-6688]
                if (PLMCommon.Instance.SelectedBasePriceCode == null)
                {
                    if (!isDuplicateCliked)
                    {
                        PLMCommon.Instance.SelectedBasePriceCode = PLMService.GetLatestBasePriceCode();
                    }
                    else
                    {
                        PLMCommon.Instance.DuplicateCode = PLMService.GetLatestBasePriceCode();

                    }

                }

                if (PLMCommon.Instance.SelectedBasePriceCode != null)
                {
                    SelectedBasePriceCode = PLMCommon.Instance.SelectedBasePriceCode;

                }
                if (PLMCommon.Instance.DuplicateCode != null)
                {
                    DuplicateCode = PLMCommon.Instance.DuplicateCode;
                }


                GeosApplication.Instance.Logger.Log("Method GetLatestBasePriceCode()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (FaultException<ServiceException> ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in GetLatestBasePriceCode() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in GetLatestBasePriceCode() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method GetLatestBasePriceCode() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void GetCurrencies()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method GetCurrencies()...", category: Category.Info, priority: Priority.Low);
                //CurrencyList = new ObservableCollection<Currency>(PLMService.GetCurrencies_V2160());
                //[pramod.misal][16.04.2025][GEOS2-6688]
                if (PLMCommon.Instance.CurrencyList == null || PLMCommon.Instance.CurrencyList?.Count == 0)
                {
                    PLMCommon.Instance.CurrencyList = new ObservableCollection<Currency>(PLMService.GetCurrencies_V2160());
                    //CurrencyList = PLMCommon.Instance.CurrencyList;
                }
                if (PLMCommon.Instance.CurrencyList != null)
                {
                    CurrencyList = PLMCommon.Instance.CurrencyList;
                }

                if (CurrencyList != null)
                {
                    foreach (var bpItem in CurrencyList.GroupBy(tpa => tpa.Name))
                    {
                        ImageSource currencyFlagImage = ByteArrayToBitmapImage(bpItem.ToList().FirstOrDefault().CurrencyIconbytes);
                        bpItem.ToList().Where(oti => oti.Name == bpItem.Key).ToList().ForEach(oti => oti.CurrencyIconImage = currencyFlagImage);

                    }
                }
                SelectedCurrency = CurrencyList.FirstOrDefault();
                SelectedCurrency_Copy = SelectedCurrency;


                GeosApplication.Instance.Logger.Log("Method GetCurrencies()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (FaultException<ServiceException> ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in GetCurrencies() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in GetCurrencies() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method GetCurrencies() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void GetSaleCurrencies()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method GetSaleCurrencies()...", category: Category.Info, priority: Priority.Low);

                #region OLD code
                //SaleCurrencyList = new ObservableCollection<Currency>(PLMService.GetCurrencies_V2160());
                //if (SaleCurrencyList != null)
                //{
                //    foreach (var bpItem in SaleCurrencyList.GroupBy(tpa => tpa.Name))
                //    {
                //        ImageSource currencyFlagImage = ByteArrayToBitmapImage(bpItem.ToList().FirstOrDefault().CurrencyIconbytes);
                //        bpItem.ToList().Where(oti => oti.Name == bpItem.Key).ToList().ForEach(oti => oti.CurrencyIconImage = currencyFlagImage);

                //    }
                //}
                #endregion

                //[pramod.misal][16.04.2025][GEOS2-6688]
                if (PLMCommon.Instance.SaleCurrencyList == null || PLMCommon.Instance.SaleCurrencyList?.Count == 0)
                {
                    //PLMCommon.Instance.SaleCurrencyList = new ObservableCollection<Currency>(PLMService.GetCurrencies_V2160());
                    PLMCommon.Instance.SaleCurrencyList = PLMCommon.Instance.CurrencyList;


                }
                if (PLMCommon.Instance.SaleCurrencyList != null)
                {
                    SaleCurrencyList = PLMCommon.Instance.SaleCurrencyList;
                }

                if (SaleCurrencyList != null)
                {
                    foreach (var bpItem in SaleCurrencyList.GroupBy(tpa => tpa.Name))
                    {
                        ImageSource currencyFlagImage = ByteArrayToBitmapImage(bpItem.ToList().FirstOrDefault().CurrencyIconbytes);
                        bpItem.ToList().Where(oti => oti.Name == bpItem.Key).ToList().ForEach(oti => oti.CurrencyIconImage = currencyFlagImage);

                    }
                }


                GeosApplication.Instance.Logger.Log("Method GetSaleCurrencies()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (FaultException<ServiceException> ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in GetSaleCurrencies() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in GetSaleCurrencies() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method GetCurrencies() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        private void GetSaleCurrencies_Add()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method GetSaleCurrencies()...", category: Category.Info, priority: Priority.Low);

                SaleCurrencyList = new ObservableCollection<Currency>(PLMService.GetCurrencies_V2160());
                SelectedSaleCurrency = new List<object>();
                SelectedSaleCurrency.Add(SaleCurrencyList.FirstOrDefault(a => a.Name == ((Currency)SelectedCurrency).Name));
                SelectedSaleCurrency = new List<object>(SelectedSaleCurrency);
                SelectedSaleCurrency_Copy = new List<object>(SelectedSaleCurrency);
                if (SaleCurrencyList != null)
                {
                    foreach (var bpItem in SaleCurrencyList.GroupBy(tpa => tpa.Name))
                    {
                        ImageSource currencyFlagImage = ByteArrayToBitmapImage(bpItem.ToList().FirstOrDefault().CurrencyIconbytes);
                        bpItem.ToList().Where(oti => oti.Name == bpItem.Key).ToList().ForEach(oti => oti.CurrencyIconImage = currencyFlagImage);

                    }
                }
                GeosApplication.Instance.Logger.Log("Method GetSaleCurrencies()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (FaultException<ServiceException> ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in GetSaleCurrencies() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in GetSaleCurrencies() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method GetCurrencies() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void GetPlants()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method GetPlants()...", category: Category.Info, priority: Priority.Low);
                //[pramod.misal][16.04.2025][GEOS2-6688]
                if (PLMCommon.Instance.PlantList == null || PLMCommon.Instance.PlantList?.Count == 0)
                {
                    PLMCommon.Instance.PlantList = new ObservableCollection<Site>(PLMService.GetPlants_V2120());

                }
                if (PLMCommon.Instance.PlantList != null)
                {
                    PlantList = PLMCommon.Instance.PlantList;
                }


                GeosApplication.Instance.Logger.Log("Method GetPlants()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (FaultException<ServiceException> ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in GetPlants() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in GetPlants() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method GetPlants() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        public void SaveMyPreference()
        {
            //Appearance

            List<Tuple<string, string>> userConfigurations = new List<Tuple<string, string>>();

            if (GeosApplication.Instance.UserSettings != null && GeosApplication.Instance.UserSettings.ContainsKey("PLM_Appearance"))
            {
                GeosApplication.Instance.UserSettings["PLM_Appearance"] = SelectedAppearanceItem.ToString();
            }

            foreach (KeyValuePair<string, string> setting in GeosApplication.Instance.UserSettings)
            {
                userConfigurations.Add(new Tuple<string, string>(setting.Key.ToString(), setting.Value.ToString()));
            }

            ApplicationOperation.CreateNewSetting(userConfigurations, GeosApplication.Instance.UserSettingFilePath, "UserSettings");
            GeosApplication.Instance.SelectedPrinter = Convert.ToString(GeosApplication.Instance.UserSettings["SelectedPrinter"]);
            GeosApplication.Instance.LabelPrinter = Convert.ToString(GeosApplication.Instance.UserSettings["LabelPrinter"]);
            GeosApplication.Instance.LabelPrinterModel = Convert.ToString(GeosApplication.Instance.UserSettings["LabelPrinterModel"]);
            GeosApplication.Instance.ParallelPort = Convert.ToString(GeosApplication.Instance.UserSettings["ParallelPort"]);

            PLMCommon.Instance.PLM_Appearance = SelectedAppearanceItem.ToString();
        }

        private void RetrieveDescriptionByLanguge(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method RetrieveDescriptionByLanguge()...", category: Category.Info, priority: Priority.Low);

                if (IsCheckedAllLanguages == false)
                {
                    if (LanguageSelected.TwoLetterISOLanguage == "EN")
                    {
                        Description = Description_en;
                        Name = Name_en;
                        Remark = Remark_en;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "ES")
                    {
                        Description = Description_es;
                        Name = Name_es;
                        Remark = Remark_es;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "FR")
                    {
                        Description = Description_fr;
                        Name = Name_fr;
                        Remark = Remark_fr;

                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "PT")
                    {
                        Description = Description_pt;
                        Name = Name_pt;
                        Remark = Remark_pt;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "RO")
                    {
                        Description = Description_ro;
                        Name = Name_ro;
                        Remark = Remark_ro;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "RU")
                    {
                        Description = Description_ru;
                        Name = Name_ru;
                        Remark = Remark_ru;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "ZH")
                    {
                        Description = Description_zh;
                        Name = Name_zh;
                        Remark = Remark_zh;
                    }
                }
                if (oldSelectedLanguage == null)
                {
                    oldSelectedLanguage = LanguageSelected.TwoLetterISOLanguage;
                }
                else
                {
                    if (oldSelectedLanguage != LanguageSelected.TwoLetterISOLanguage)
                    { oldSelectedLanguage = LanguageSelected.TwoLetterISOLanguage; }
                }
                GeosApplication.Instance.Logger.Log("Method RetrieveDescriptionByLanguge()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method RetrieveDescriptionByLanguge()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        private void SetNameToLanguage(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log(string.Format("Method SetNameToLanguage..."), category: Category.Info, priority: Priority.Low);

                if (IsCheckedAllLanguages == false)
                {
                    if (string.IsNullOrEmpty(Name))
                    {
                        InformationError = string.Empty; ;
                        PropertyChanged(this, new PropertyChangedEventArgs("InformationError"));
                    }
                    else
                    {
                        InformationError = null;
                        PropertyChanged(this, new PropertyChangedEventArgs("InformationError"));
                    }
                    if (LanguageSelected.TwoLetterISOLanguage == "EN")
                    {
                        Name_en = Name;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "ES")
                    {
                        Name_es = Name;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "FR")
                    {
                        Name_fr = Name;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "PT")
                    {
                        Name_pt = Name;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "RO")
                    {
                        Name_ro = Name;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "RU")
                    {
                        Name_ru = Name;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "ZH")
                    {
                        Name_zh = Name;
                    }
                }
                if (IsCheckedAllLanguages == false)
                {
                    if ((oldName_en != Name_en && Name_en != "" && !string.IsNullOrEmpty(Name_en)) ||
                   (oldName_es != Name_es && Name_es != "" && !string.IsNullOrEmpty(Name_es)) || (oldName_fr != Name_fr && Name_fr != "" && !string.IsNullOrEmpty(Name_fr)) ||
                  (oldName_pt != Name_pt && Name_pt != "" && !string.IsNullOrEmpty(Name_pt)) || (oldName_ro != Name_ro && Name_ro != "" && !string.IsNullOrEmpty(Name_ro)) ||
                  (oldName_ru != Name_ru && Name_ru != "" && !string.IsNullOrEmpty(Name_ru)) || (oldName_zh != Name_zh && Name_zh != "" && !string.IsNullOrEmpty(Name_zh)))
                    {
                        IsEnabledSaveButton = true;
                    }
                    else
                    {
                        IsEnabledSaveButton = false;
                    }
                }
                else
                {
                    if ((oldName_en != Name && Name != "" && !string.IsNullOrEmpty(Name)) ||
                  (oldName_es != Name_es && Name_es != "" && !string.IsNullOrEmpty(Name_es)) || (oldName_fr != Name_fr && Name_fr != "" && !string.IsNullOrEmpty(Name_fr)) ||
                 (oldName_pt != Name_pt && Name_pt != "" && !string.IsNullOrEmpty(Name_pt)) || (oldName_ro != Name_ro && Name_ro != "" && !string.IsNullOrEmpty(Name_ro)) ||
                 (oldName_ru != Name_ru && Name_ru != "" && !string.IsNullOrEmpty(Name_ru)) || (oldName_zh != Name_zh && Name_zh != "" && !string.IsNullOrEmpty(Name_zh)))
                    {
                        IsEnabledSaveButton = true;
                    }
                    else
                    {
                        IsEnabledSaveButton = false;
                    }
                }
                //if (oldName == null)
                //{
                //    oldName = Name;
                //}
                //else
                //{
                //    if (oldName != Name && Name!=""&&!string.IsNullOrEmpty(Name))
                //    { oldName = Name; if (!isDuplicateCliked) IsEnabledSaveButton = true; }
                //}
                GeosApplication.Instance.Logger.Log(string.Format("Method SetNameToLanguage()....executed successfully"), category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method SetNameToLanguage() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void SetDescriptionToLanguage(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log(string.Format("Method SetDescriptionToLanguage..."), category: Category.Info, priority: Priority.Low);

                if (IsCheckedAllLanguages == false)
                {
                    if (LanguageSelected.TwoLetterISOLanguage == "EN")
                    {
                        Description_en = Description;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "ES")
                    {
                        Description_es = Description;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "FR")
                    {
                        Description_fr = Description;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "PT")
                    {
                        Description_pt = Description;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "RO")
                    {
                        Description_ro = Description;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "RU")
                    {
                        Description_ru = Description;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "ZH")
                    {
                        Description_zh = Description;
                    }
                }
                if (IsCheckedAllLanguages == false)
                {
                    if ((oldDescription_en != Description_en && Description_en != "" && !string.IsNullOrEmpty(Description_en)) ||
                    (oldDescription_es != Description_es && Description_es != "" && !string.IsNullOrEmpty(Description_es)) || (oldDescription_fr != Description_fr && Description_fr != "" && !string.IsNullOrEmpty(Description_fr)) ||
                   (oldDescription_pt != Description_pt && Description_pt != "" && !string.IsNullOrEmpty(Description_pt)) || (oldDescription_ro != Description_ro && Description_ro != "" && !string.IsNullOrEmpty(Description_ro)) ||
                            (oldDescription_ru != Description_ru && Description_ru != "" && !string.IsNullOrEmpty(Description_ru)) || (oldDescription_zh != Description_zh && Description_zh != "" && !string.IsNullOrEmpty(Description_zh)))
                    {
                        IsEnabledSaveButton = true;
                    }
                    else
                    {
                        IsEnabledSaveButton = false;
                    }
                }
                else
                {
                    if ((oldDescription_en != Description && Description != "" && !string.IsNullOrEmpty(Description)) ||
                    (oldDescription_es != Description_es && Description_es != "" && !string.IsNullOrEmpty(Description_es)) || (oldDescription_fr != Description_fr && Description_fr != "" && !string.IsNullOrEmpty(Description_fr)) ||
                   (oldDescription_pt != Description_pt && Description_pt != "" && !string.IsNullOrEmpty(Description_pt)) || (oldDescription_ro != Description_ro && Description_ro != "" && !string.IsNullOrEmpty(Description_ro)) ||
                            (oldDescription_ru != Description_ru && Description_ru != "" && !string.IsNullOrEmpty(Description_ru)) || (oldDescription_zh != Description_zh && Description_zh != "" && !string.IsNullOrEmpty(Description_zh)))
                    {
                        IsEnabledSaveButton = true;
                    }
                    else
                    {
                        IsEnabledSaveButton = false;
                    }
                }
                //if (oldDescription == null)
                //{
                //    oldDescription = Description;
                //}
                //else
                //{
                //    if (oldDescription != Description &&Description!=""&&!string.IsNullOrEmpty(Description))
                //    { oldDescription = Description; if (!isDuplicateCliked) IsEnabledSaveButton = true; }
                //}
                GeosApplication.Instance.Logger.Log(string.Format("Method SetDescriptionToLanguage()....executed successfully"), category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method SetDescriptionToLanguage() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void SetRemarkToLanguage(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log(string.Format("Method SetRemarkToLanguage..."), category: Category.Info, priority: Priority.Low);

                if (IsCheckedAllLanguages == false)
                {
                    if (LanguageSelected.TwoLetterISOLanguage == "EN")
                    {
                        Remark_en = Remark;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "ES")
                    {
                        Remark_es = Remark;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "FR")
                    {
                        Remark_fr = Remark;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "PT")
                    {
                        Remark_pt = Remark;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "RO")
                    {
                        Remark_ro = Remark;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "RU")
                    {
                        Remark_ru = Remark;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "ZH")
                    {
                        Remark_zh = Remark;
                    }
                }
                if (oldRemark == null)
                {
                    oldRemark = Remark;
                }
                else
                {
                    if (oldRemark != Remark && Remark != "" && !string.IsNullOrEmpty(Remark))
                    { oldRemark = Remark; if (!isDuplicateCliked) IsEnabledSaveButton = true; }
                }
                GeosApplication.Instance.Logger.Log(string.Format("Method SetRemarkToLanguage()....executed successfully"), category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method SetRemarkToLanguage() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void UncheckedCopyNameDescription(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log(string.Format("Method UncheckedCopyNameDescription..."), category: Category.Info, priority: Priority.Low);

                if (LanguageSelected.TwoLetterISOLanguage == "EN")
                {
                    Name = Name_en;
                    Description = Description_en;
                    Remark = Remark_en;
                }
                else if (LanguageSelected.TwoLetterISOLanguage == "ES")
                {
                    Name = Name_es;
                    Description = Description_es;
                    Remark = Remark_es;
                }
                else if (LanguageSelected.TwoLetterISOLanguage == "FR")
                {
                    Name = Name_fr;
                    Description = Description_fr;
                    Remark = Remark_fr;
                }
                else if (LanguageSelected.TwoLetterISOLanguage == "PT")
                {
                    Name = Name_pt;
                    Description = Description_pt;
                    Remark = Remark_pt;
                }
                else if (LanguageSelected.TwoLetterISOLanguage == "RO")
                {
                    Name = Name_ro;
                    Description = Description_ro;
                    Remark = Remark_ro;
                }
                else if (LanguageSelected.TwoLetterISOLanguage == "RU")
                {
                    Name = Name_ru;
                    Description = Description_ru;
                    Remark = Remark_ru;
                }
                else if (LanguageSelected.TwoLetterISOLanguage == "ZH")
                {
                    Name = Name_zh;
                    Description = Description_zh;
                    Remark = Remark_zh;
                }
                GeosApplication.Instance.Logger.Log(string.Format("Method UncheckedCopyNameDescription()....executed successfully"), category: Category.Info, priority: Priority.Low);
            }

            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method UncheckedCopyNameDescription() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        public void FillLanguages()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillLanguages()...", category: Category.Info, priority: Priority.Low);
                //[pramod.misal][16.04.2025][GEOS2-6688]
                if (PLMCommon.Instance.Languages == null || PLMCommon.Instance.Languages?.Count == 0)
                {
                    //Languages = new ObservableCollection<Language>(PLMService.GetLanguages());
                    PLMCommon.Instance.Languages = new ObservableCollection<Language>(PLMService.GetLanguages());

                }
                if (PLMCommon.Instance.Languages != null)
                {
                    Languages = PLMCommon.Instance.Languages;
                    LanguageSelected = Languages.FirstOrDefault();
                }



                GeosApplication.Instance.Logger.Log("Method FillLanguages()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (FaultException<ServiceException> ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillLanguages() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillLanguages() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method FillLanguages() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void CloseWindow(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method CloseWindow()...", category: Category.Info, priority: Priority.Low);
                if (IsEnabledSaveButton && SaveButtonVisibility == Visibility.Visible)
                {
                    MessageBoxResult MessageBoxResult = MessageBoxResult = CustomMessageBox.Show(string.Format(Application.Current.Resources["ArticleGridUpdateWarning"].ToString()), "Yellow", CustomMessageBox.MessageImagePath.Warning, MessageBoxButton.YesNo);
                    if (MessageBoxResult == MessageBoxResult.Yes)
                    {
                        AcceptButtonCommandAction(null);
                    }
                }
                //IsEnabledSaveButton = false;
                RequestClose(null, null);

                GeosApplication.Instance.Logger.Log("Method CloseWindow()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method CloseWindow() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        private void FillArticleMenuList()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillArticleMenuList()...", category: Category.Info, priority: Priority.Low);

                ArticleMenuList = new ObservableCollection<PCMArticleCategory>(PLMService.GetPCMArticlesWithCategory_V2160());
                if (DtArticle == null)
                {
                    DtArticle = new DataTable();
                }
                foreach (DataRow row in DtArticle.Rows)
                {
                    ArticleMenuList.Where(a => a.IdArticle == Convert.ToUInt64(row["IdArticle"])).ToList().ForEach(b => b.IsBPLArticle_Current = true);
                }
                SelectedArticle = new PCMArticleCategory();
                GeosApplication.Instance.Logger.Log("Method FillArticleMenuList()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillArticleMenuList() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillArticleMenuList() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method FillArticleMenuList() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void FillReferenceView()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillReferenceView()...", category: Category.Info, priority: Priority.Low);

                //ArticleMenuList = new ObservableCollection<PCMArticleCategory>(PLMService.GetPCMArticlesWithCategoryForReference_V2160());
                #region GEOS2-3126 [Gulab lakade]

                //[pramod.misal][16.04.2025][GEOS2-6688]
                if (PLMCommon.Instance.ArticleMenuListtemp == null || PLMCommon.Instance.ArticleMenuListtemp?.Count == 0)
                {   //ArticleMenuListtemp = new ObservableCollection<PCMArticleCategory>(PLMService.GetPCMArticlesWithCategoryForReference_V2160());
                    PLMCommon.Instance.ArticleMenuListtemp = new ObservableCollection<PCMArticleCategory>(PLMService.GetPCMArticlesWithCategoryForReference_V2160());

                }
                if (PLMCommon.Instance.ArticleMenuListtemp != null)
                {
                    ArticleMenuListtemp = PLMCommon.Instance.ArticleMenuListtemp;
                }
                ObservableCollection<PCMArticleCategory> ArticleMenuListtemp1 = new ObservableCollection<PCMArticleCategory>();
                if (ArticleMenuListtemp.Count > 0)
                {

                    foreach (var item in ArticleMenuListtemp)
                    {
                        PCMArticleCategory ArticleMenuList1 = new PCMArticleCategory();
                        ArticleMenuList1.IdArticle = item.IdArticle;
                        int Count = ArticleMenuListtemp.Where(x => x.ParentName == item.KeyName && x.IsBPLArticle_Current == false).ToList().Count;
                        if (Count != 0)
                        {
                            ArticleMenuList1.Name = item.Name + "[" + Count + "]";
                        }
                        else
                        {
                            ArticleMenuList1.Name = item.Name;
                        }

                        ArticleMenuList1.NameWithArticleCount = item.NameWithArticleCount;
                        ArticleMenuList1.ParentName = item.ParentName;
                        ArticleMenuList1.KeyName = item.KeyName;
                        ArticleMenuList1.Reference = item.Reference;
                        ArticleMenuList1.StatusHtmlColor = item.StatusHtmlColor;
                        ArticleMenuList1.IdPCMArticleCategory = item.IdPCMArticleCategory;
                        ArticleMenuList1.IsBPLArticle = item.IsBPLArticle;
                        ArticleMenuList1.IsBPLArticle_Current = item.IsBPLArticle_Current;
                        ArticleMenuListtemp1.Add(ArticleMenuList1);
                    }
                    ArticleMenuList = new ObservableCollection<PCMArticleCategory>();
                    ArticleMenuList.AddRange(ArticleMenuListtemp1);
                }
                #endregion




                if (DtArticle == null)
                {
                    DtArticle = new DataTable();
                }

                foreach (DataRow row in DtArticle.Rows)
                {
                    ArticleMenuList.Where(a => a.IdArticle == Convert.ToUInt64(row["IdArticle"])).ToList().ForEach(b => b.IsBPLArticle_Current = true);
                }

                SelectedArticle = new PCMArticleCategory();




            }
            catch (FaultException<ServiceException> ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillReferenceView() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillReferenceView() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method FillReferenceView() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }


        //[Sudhir.Jangra][01/12/2022][GEOS2-2855]
        private void addAllModuleViewCommandAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method AddAllModuleViewCommandAction()...", category: Category.Info, priority: Priority.Low);
                if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }
                FillAddAllModuleView();
                ModuleAddCustomSetting();
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Error in AddAllModuleViewCommandAction() Method " + ex.Detail.ErrorMessage, category: Category.Info, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Error in AddAllModuleViewCommandAction() Method - ServiceUnexceptedException " + ex.Message, category: Category.Info, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString(), null);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Error in AddAllModuleViewCommandAction()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        private void addAllArticleViewCommandAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method AddAllArticleViewCommandAction()...", category: Category.Info, priority: Priority.Low);
                if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }
                FillAddAllArticleView();
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Error in AddAllArticleViewCommandAction() Method " + ex.Detail.ErrorMessage, category: Category.Info, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Error in AddAllArticleViewCommandAction() Method - ServiceUnexceptedException " + ex.Message, category: Category.Info, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString(), null);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Error in AddAllArticleViewCommandAction()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        private void addAllDetectionViewCommandAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method AddAllDetectionViewCommandAction()...", category: Category.Info, priority: Priority.Low);
                if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }
                FillAddAllDetectionView();
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Error in AddAllDetectionViewCommandAction() Method " + ex.Detail.ErrorMessage, category: Category.Info, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Error in AddAllDetectionViewCommandAction() Method - ServiceUnexceptedException " + ex.Message, category: Category.Info, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString(), null);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Error in AddAllDetectionViewCommandAction()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        private void ChangePlantCommandAction(object obj)
        {
            try
            {
                if (obj == null)
                    return;
                GeosApplication.Instance.Logger.Log("Method ChangePlantCommandAction()...", category: Category.Info, priority: Priority.Low);

                if (((DevExpress.Xpf.Editors.ClosePopupEventArgs)obj).CloseMode == DevExpress.Xpf.Editors.PopupCloseMode.Normal && SelectedPlant != SelectedPlant_Copy)
                {
                    if (ClonedBasePrice != null && isDuplicateCliked == false && ClonedBasePrice.IdStatus == 224)
                    {
                        CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("CantChangeValidation").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                        SelectedPlant = SelectedPlant_Copy;
                        return;
                    }

                    if (DtArticle != null && DtArticle.Rows.Count > 0)
                    {
                        IsCalculateArticleCostButtonEnabled = true;
                        IsCalculated = false;
                    }
                    if (SelectedPlant == null)
                        SelectedPlant = new List<object>();

                    int removeCount = 0;

                    foreach (BandItem bandItem in Bands)
                    {
                        if (bandItem.BandHeader == "Plant")
                        {
                            List<ColumnItem> columns = new List<ColumnItem>(bandItem.Columns);

                            if (bandItem.Columns.Count != SelectedPlant.Count)
                            {
                                foreach (ColumnItem columnItem in columns.ToList())
                                {
                                    if (!SelectedPlant.Cast<Site>().Any(a => a.Name == columnItem.HeaderText))
                                    {
                                        removeCount++;
                                    }
                                }
                            }
                        }
                    }
                    if (removeCount > 0)
                    {
                        MessageBoxResult MessageBoxResult = CustomMessageBox.Show(Application.Current.Resources["RemoveBPLPlant"].ToString(), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                        if (MessageBoxResult == MessageBoxResult.No)
                        {
                            SelectedPlant = SelectedPlant_Copy;
                            return;
                        }
                    }
                    if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }
                    AddColumnsToArticleDataTable();
                    AddEditColumnsToPlantsDataTable();
                    CalculateBasePriceArticlesByLogicValue();
                    SelectedPlant_Copy = SelectedPlant;
                    IsPlantAddedOrRemove = true;
                    if (!isDuplicateCliked) IsEnabledSaveButton = true;
                }
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Method ChangePlantCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log(string.Format("Error in method ChangePlantCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        private void ChangeCurrencyCommandAction(object obj)
        {
            try
            {
                if (((Currency)SelectedCurrency_Copy).IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                    return;

                if (ClonedBasePrice != null && isDuplicateCliked == false && ClonedBasePrice.IdStatus == 224)
                {
                    CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("CantChangeValidation").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                    SelectedCurrency = SelectedCurrency_Copy;
                    return;
                }
                else if (ClonedBasePrice != null && isDuplicateCliked == false && ClonedBasePrice.IsBPLExistInCPL == true)
                {
                    string CPLCodes = PLMService.GetCustomerPriceCodesByBPL(ClonedBasePrice.IdBasePriceList);
                    CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("CantChangeWithCPLValidation").ToString(), CPLCodes), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                    SelectedCurrency = SelectedCurrency_Copy;
                    return;
                }
                else if (ClonedBasePrice != null && isDuplicateCliked == false && ClonedBasePrice.IdStatus == 223)
                {
                    CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("CantChangeActiveValidation").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                    SelectedCurrency = SelectedCurrency_Copy;
                    return;
                }

                GeosApplication.Instance.Logger.Log("Method ChangeCurrencyCommandAction()...", category: Category.Info, priority: Priority.Low);
                if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }

                if (DtArticle != null && DtArticle.Rows.Count > 0)
                {
                    IsCalculateArticleCostButtonEnabled = true;
                    IsCalculated = false;
                }

                AddColumnsToArticleDataTable();
                AddColumnsToDetectionDataTable();
                AddColumnsToModuleDataTable();
                AddEditColumnsToPlantsDataTable();
                FillArticleCostPriceList();
                CalculateBasePriceArticlesByLogicValue();
                CalculateBasePriceDetectionsByLogicValue();
                SelectedCurrency_Copy = SelectedCurrency;
                IsCurrencyAddedOrRemove = true;
                if (!isDuplicateCliked) IsEnabledSaveButton = true;

                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Method ChangeCurrencyCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log(string.Format("Error in method ChangeCurrencyCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void ChangeExchangeRateCommandAction(object obj)
        {
            try
            {
                ComboBoxEdit value = (ComboBoxEdit)((System.Windows.RoutedEventArgs)obj).OriginalSource;

                if (value.EditText == SelectedExchangeRate.Value)
                {
                    return;
                }

                MessageBoxResult MessageBoxResult = CustomMessageBox.Show(Application.Current.Resources["ExchangeRateForBPLSalePrice"].ToString(), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                if (MessageBoxResult == MessageBoxResult.No)
                {
                    SelectedExchangeRate = ExchangeRateList.FirstOrDefault(a => a.Value == value.EditText);
                    return;
                }

                GeosApplication.Instance.Logger.Log("Method ChangeCurrencyCommandAction()...", category: Category.Info, priority: Priority.Low);
                if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }

                if (DtArticle != null && DtArticle.Rows.Count > 0)
                {
                    IsCalculateArticleCostButtonEnabled = true;
                    IsCalculated = false;
                }

                FillCurrencyConversionList_All();
                CalculateBasePriceArticlesByLogicValue(true);
                CalculateBasePriceDetectionsByLogicValue();

                if (!isDuplicateCliked) IsEnabledSaveButton = true;

                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Method ChangeExchangeRateCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log(string.Format("Error in method ChangeExchangeRateCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void ChangeSaleCurrencyCommandAction(object obj)
        {
            try
            {
                if (obj == null)
                    return;

                GeosApplication.Instance.Logger.Log("Method ChangeSaleCurrencyCommandAction()...", category: Category.Info, priority: Priority.Low);
                if (((DevExpress.Xpf.Editors.ClosePopupEventArgs)obj).CloseMode == DevExpress.Xpf.Editors.PopupCloseMode.Normal && SelectedSaleCurrency != SelectedSaleCurrency_Copy)
                {
                    if (ClonedBasePrice != null && isDuplicateCliked == false && ClonedBasePrice.IdStatus == 224)
                    {
                        CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("CantChangeValidation").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                        SelectedSaleCurrency = SelectedSaleCurrency_Copy;
                        return;
                    }

                    if (DtArticle != null && DtArticle.Rows.Count > 0)
                    {
                        IsCalculateArticleCostButtonEnabled = true;
                        IsCalculated = false;
                    }

                    if (SelectedSaleCurrency == null)
                        SelectedSaleCurrency = new List<object>();

                    if (DeleteCurrencyFromCPL == null)
                        DeleteCurrencyFromCPL = new List<CustomerPriceListByItem>();

                    int removeCount = 0;
                    List<string> IdCurrencies = new List<string>();

                    foreach (BandItem bandItem in Bands)
                    {
                        if (bandItem.BandHeader == "Sale Price")
                        {
                            List<ColumnItem> columns = new List<ColumnItem>(bandItem.Columns);
                            foreach (ColumnItem columnItem in columns.ToList())
                            {
                                if (!SelectedSaleCurrency.Cast<Currency>().Any(a => a.Name == columnItem.HeaderText))
                                {
                                    IdCurrencies.Add(CurrencyList.FirstOrDefault(a => a.Name == columnItem.HeaderText).IdCurrency.ToString());
                                    removeCount++;
                                }
                            }
                        }
                    }
                    if (removeCount > 0)
                    {
                        if (!SelectedSaleCurrency.Cast<Currency>().Any(a => a.Name == ((Currency)SelectedCurrency).Name))
                        {
                            CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("RemoveCommonBPLSalePrice").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                            SelectedSaleCurrency = SelectedSaleCurrency_Copy;
                            return;
                        }
                        CPList = new List<CustomerPrice>(PLMService.GetCustomerPriceIFExistCurrencies(IdBasePriceList, string.Join(",", IdCurrencies.Select(a => a.ToString()))));

                        if (CPList != null && CPList.Count > 0)
                        {

                            List<string> CPLCodes = CPList.Select(x => x.Code).Distinct().ToList();
                            List<string> ReferencesList = new List<string>();
                            foreach (string id in IdCurrencies)
                            {
                                ReferencesList.Add(CurrencyList.FirstOrDefault(a => a.IdCurrency == Convert.ToUInt32(id)).Name);
                            }

                            MessageBoxResult result1 = CustomMessageBox.Show(string.Format(Application.Current.Resources["DeleteBPLAndCPLSaleCurrencyList"].ToString(), string.Join(", ", ReferencesList), System.Environment.NewLine, string.Join(System.Environment.NewLine, CPLCodes), System.Environment.NewLine), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                            if (result1 == MessageBoxResult.Yes)
                            {
                                foreach (CustomerPrice deleteCPL in CPList)
                                {
                                    foreach (Currency item in deleteCPL.CurrencyList)
                                    {
                                        CustomerPriceListByItem currency = new CustomerPriceListByItem();
                                        currency.IdCustomerPriceList = deleteCPL.IdCustomerPriceList;
                                        currency.BasePriceListCurrency = item.IdCurrency;
                                        DeleteCurrencyFromCPL.Add(currency);
                                    }
                                }
                            }
                            else
                            {
                                SelectedSaleCurrency = SelectedSaleCurrency_Copy;
                                return;
                            }
                        }
                        else
                        {
                            MessageBoxResult MessageBoxResult = CustomMessageBox.Show(Application.Current.Resources["RemoveBPLSalePrice"].ToString(), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                            if (MessageBoxResult == MessageBoxResult.No)
                            {
                                SelectedSaleCurrency = SelectedSaleCurrency_Copy;
                                return;
                            }
                        }
                    }

                    if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }
                    AddColumnsToArticleDataTable();
                    AddColumnsToDetectionDataTable();
                    AddColumnsToModuleDataTable();
                    AddEditColumnsToPlantsDataTable();
                    CalculateBasePriceArticlesByLogicValue();
                    CalculateBasePriceDetectionsByLogicValue();
                    SelectedSaleCurrency_Copy = SelectedSaleCurrency;
                    IsSaleCurrencyAddedOrRemove = true;
                    if (!isDuplicateCliked) IsEnabledSaveButton = true;
                }
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Method ChangeSaleCurrencyCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log(string.Format("Error in method ChangeSaleCurrencyCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void AddEditColumnsToPlantsDataTable()
        {
            #region Try Block
            try
            {
                GeosApplication.Instance.Logger.Log("Method AddEditColumnsToPlantsDataTable()...", category: Category.Info, priority: Priority.Low);
                if (SelectedSaleCurrency == null)
                    SelectedSaleCurrency = new List<object>();
                if (SelectedPlant == null)
                    SelectedPlant = new List<object>();
                if (SelectedCurrency == null)
                {
                    SelectedCurrency = new object();
                    SelectedCurrency_Copy = new object();
                }
                #region When we Create a new BPL
                if (IsNew)
                {
                    if (BandsTemplete.Count > 0)
                    {
                        DataRow dr;
                        DataTable dtcopy = new DataTable();
                        dtcopy = Dttable;
                        int eachRow = 0;
                        foreach (Site plant in SelectedPlant)
                        {
                            bool exists = dtcopy.Rows.Cast<DataRow>().Select(x => x.ItemArray[0]).Contains(plant.Name);
                            if (!exists)
                            {
                                dr = dtcopy.NewRow();
                                foreach (BandItem bandItem in BandsTemplete)
                                {
                                    if (bandItem.BandHeader == "Plant")
                                    {
                                        dr["Plant"] = plant.Name;
                                    }
                                    else
                                    {
                                        string currencyValue = AddColumnsToSaleCurrencyDataTable(plant.Name, bandItem.BandHeader);
                                        if (!string.IsNullOrEmpty(currencyValue))
                                        {
                                            dr[currencyValue] = true;
                                        }
                                    }
                                }
                                dtcopy.Rows.Add(dr);
                            }
                            else
                            {

                                int totalRowCount = dtcopy.Rows.Count;
                                foreach (Currency currency in SelectedSaleCurrency)
                                {
                                    bool isThere = dtcopy.Columns.Cast<DataColumn>().Select(x => x.ColumnName).Contains(currency.Name);
                                    if (!isThere)
                                    {
                                        BandItem item2 = new BandItem() { BandName = currency.Name, BandHeader = currency.Name };
                                        dtcopy.Columns.Add(currency.Name, typeof(bool));
                                        item2.Columns = new ObservableCollection<ColumnItem>();
                                        item2.Columns.Add(new ColumnItem() { ColumnFieldName = currency.Name, Width = 100, IsVertical = false, Settings = SettingsType.Default, Visible = true, ImageSrc = currency.CurrencyIconImage });
                                        BandsTemplete.Add(item2);
                                    }
                                }
                                if (eachRow < totalRowCount)
                                {
                                    DataRow data = Dttable.Rows[eachRow];
                                    int ColumnCount = SelectedSaleCurrency.Count;
                                    int eachColumnPosition = 0;
                                    foreach (BandItem item3 in BandsTemplete)
                                    {
                                        bool IsExists = dtcopy.Columns.Cast<DataColumn>().Select(x => x.ColumnName).Contains(item3.BandHeader);
                                        if (item3.BandHeader != "Plant")
                                        {
                                            string currencyValue1 = AddColumnsToSaleCurrencyDataTable(plant.Name, item3.BandHeader);
                                            if (dtcopy.Rows[eachRow][eachColumnPosition].ToString() == null || dtcopy.Rows[eachRow][eachColumnPosition].ToString() == string.Empty)
                                            {
                                                data[currencyValue1] = true;
                                            }
                                        }
                                        if (!SelectedPlant.Cast<Site>().Any(a => a.Name == data["Plant"].ToString()))
                                        {
                                            dtcopy.Rows.Remove(data);
                                            totalRowCount = dtcopy.Rows.Count;
                                            break;
                                        }

                                        eachColumnPosition++;
                                        /// when we change the SelectedCurrency in the Information
                                        #region 
                                        if (!SelectedSaleCurrency.Cast<Currency>().Any(a => a.Name == ((Currency)SelectedCurrency).Name) || !Dttable.Columns.Cast<DataColumn>().Select(x => x.ColumnName).Contains(((Currency)SelectedCurrency).Name))
                                        {
                                            SelectedSaleCurrency.Add(SaleCurrencyList.FirstOrDefault(a => a.Name == ((Currency)SelectedCurrency).Name));
                                            SelectedSaleCurrency = new List<object>(SelectedSaleCurrency);
                                            string fieldName = ((Currency)SelectedCurrency).Name;
                                            Dttable.Columns.Add(fieldName, typeof(double));
                                            item3.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });
                                            SelectedSaleCurrency_Copy = SelectedSaleCurrency;
                                            Dttable.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));
                                        }
                                        #endregion
                                    }
                                    eachRow++;
                                }
                            }
                        }
                        DataRow[] found = dtcopy.Select();
                        foreach (DataRow row1 in found)
                        {
                            if (!SelectedPlant.Cast<Site>().Any(a => a.Name == row1["Plant"].ToString()))
                            {
                                dtcopy.Rows.Remove(row1);
                            }
                        }
                        bool _check = false;
                        foreach (Currency cur1 in SelectedSaleCurrency)
                        {
                            if (dtcopy.Columns.Cast<DataColumn>().Any(x => x.ColumnName == cur1.Name))
                            {
                                _check = true;
                                break;
                            }
                        }
                        if (_check)
                        {
                            ObservableCollection<BandItem> SaleCurrencyCollection = new ObservableCollection<BandItem>();
                            foreach (Currency currency1 in SelectedSaleCurrency)
                            {
                                bool isThere = dtcopy.Columns.Cast<DataColumn>().Select(x => x.ColumnName).Contains(currency1.Name);
                                if (!isThere)
                                {
                                    BandItem item2 = new BandItem() { BandName = currency1.Name, BandHeader = currency1.Name };
                                    dtcopy.Columns.Add(currency1.Name, typeof(bool));
                                    item2.Columns = new ObservableCollection<ColumnItem>();
                                    item2.Columns.Add(new ColumnItem() { ColumnFieldName = currency1.Name, Width = 100, IsVertical = false, Settings = SettingsType.Default, Visible = true, ImageSrc = currency1.CurrencyIconImage });
                                    BandsTemplete.Add(item2);
                                }
                            }
                            foreach (BandItem bi in BandsTemplete)
                            {
                                List<ColumnItem> columns = new List<ColumnItem>(bi.Columns);
                                foreach (ColumnItem columnItem in columns.ToList())
                                {
                                    bool isDeleted = false;
                                    if (!SelectedSaleCurrency.Cast<Currency>().Any(a => a.Name == columnItem.ColumnFieldName) && columns[0].ColumnFieldName != "Plant" && columns[0].ColumnFieldName != ((Currency)SelectedCurrency).Name)
                                    {
                                        string fieldName = columns[0].ColumnFieldName;
                                        dtcopy.Columns.Remove(fieldName);
                                        bi.Columns.Remove(columns[0]);
                                        dtcopy.AcceptChanges();
                                        isDeleted = true;
                                    }
                                    if (isDeleted)
                                    {
                                        SaleCurrencyCollection.Add(bi);
                                    }
                                }
                                if (!SelectedSaleCurrency.Cast<Currency>().Any(a => a.Name == ((Currency)SelectedCurrency).Name) || !dtcopy.Columns.Cast<DataColumn>().Select(x => x.ColumnName).Contains(((Currency)SelectedCurrency).Name))
                                {
                                    SelectedSaleCurrency.Add(SaleCurrencyList.FirstOrDefault(a => a.Name == ((Currency)SelectedCurrency).Name));
                                    SelectedSaleCurrency = new List<object>(SelectedSaleCurrency);
                                    string fieldName = ((Currency)SelectedCurrency).Name;
                                    dtcopy.Columns.Add(fieldName, typeof(bool));
                                    bi.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default, ImageSrc = ((Currency)SelectedCurrency).CurrencyIconImage });
                                    SelectedSaleCurrency_Copy = SelectedSaleCurrency;
                                    dtcopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));
                                }
                            }
                            foreach (BandItem band1 in SaleCurrencyCollection)
                            {
                                BandsTemplete.Remove(band1);
                            }
                        }
                        Dttable = dtcopy;
                    }
                    #region Add New Base Price List Columns for Plant and Currency
                    else
                    {
                        /// Plant
                        BandsTemplete.Clear();
                        Dttable = new DataTable();
                        BandItem item1 = new BandItem() { BandName = "Plant", BandHeader = "Plant" };
                        Dttable.Columns.Add("Plant", typeof(string));
                        item1.Columns = new ObservableCollection<ColumnItem>();
                        item1.Columns.Add(new ColumnItem() { ColumnFieldName = "Plant", Width = 100, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                        BandsTemplete.Add(item1);
                        /// Sale Currency
                        foreach (Currency currency in SelectedSaleCurrency)
                        {
                            BandItem item2 = new BandItem();
                            string fieldName = currency.Name;
                            Dttable.Columns.Add(fieldName, typeof(bool));
                            item2.BandHeader = fieldName;
                            item2.Columns = new ObservableCollection<ColumnItem>();
                            item2.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default, ImageSrc = currency.CurrencyIconImage });
                            BandsTemplete.Add(item2);
                        }
                    }
                    #endregion
                    PlantCurrencyListWithIsChecked = new List<BasePriceListByPlantCurrency>();

                    foreach (DataRow dr in Dttable.Rows)
                    {
                        BasePriceListByPlantCurrency item = new BasePriceListByPlantCurrency();
                        item.PlantName = dr["Plant"].ToString();
                        if (!PlantCurrencyListWithIsChecked.Any(a => a.PlantName == item.PlantName))
                        {
                            foreach (Currency cur in SelectedSaleCurrency)
                            {
                                if (dr[cur.Name].ToString() == "True")
                                {
                                    if (string.IsNullOrEmpty(item.CurrenciesName))
                                    {
                                        item.CurrenciesName = cur.Name;
                                    }
                                    else
                                    {
                                        if (!item.CurrenciesName.Contains(cur.Name))
                                            item.CurrenciesName += " " + cur.Name;
                                    }
                                }
                            }
                            PlantCurrencyListWithIsChecked.Add(item);
                        }
                    }
                }
                #endregion
                #endregion
                #region Edit the BPL List and Update or Delete
                else
                {
                    DataRow dr1;
                    #region BandTemplete count not equal to 0
                    if (BandsTemplete.Count > 0)
                    {
                        DataRow dr;
                        DataTable dTableCopy = new DataTable();
                        int eachRow = 0;
                        dTableCopy = Dttable;

                        foreach (Site plant in SelectedPlant)
                        {
                            bool exists = dTableCopy.Rows.Cast<DataRow>().Select(x => x.ItemArray[0]).Contains(plant.Name);
                            if (!exists)
                            {
                                dr = dTableCopy.NewRow();
                                foreach (BandItem bandItem in BandsTemplete)
                                {
                                    if (bandItem.BandHeader == "Plant")
                                    {
                                        dr["Plant"] = plant.Name;
                                    }
                                    else
                                    {
                                        string currencyValue = AddColumnsToSaleCurrencyDataTable(plant.Name, bandItem.BandHeader);
                                        if (!string.IsNullOrEmpty(currencyValue))
                                        {
                                            dr[currencyValue] = true;
                                        }
                                    }
                                }
                                dTableCopy.Rows.Add(dr);
                            }
                            else
                            {
                                int totalRowCount = dTableCopy.Rows.Count;
                                foreach (Currency currency in SelectedSaleCurrency)
                                {
                                    bool isThere = dTableCopy.Columns.Cast<DataColumn>().Select(x => x.ColumnName).Contains(currency.Name);
                                    if (!isThere)
                                    {
                                        BandItem item2 = new BandItem() { BandName = currency.Name, BandHeader = currency.Name };
                                        dTableCopy.Columns.Add(currency.Name, typeof(bool));
                                        item2.Columns = new ObservableCollection<ColumnItem>();
                                        item2.Columns.Add(new ColumnItem() { ColumnFieldName = currency.Name, Width = 100, IsVertical = false, Settings = SettingsType.Default, Visible = true, ImageSrc = currency.CurrencyIconImage });
                                        BandsTemplete.Add(item2);
                                    }
                                }
                                if (eachRow < totalRowCount)
                                {
                                    DataRow data = dTableCopy.Rows[eachRow];
                                    int ColumnCount = SelectedSaleCurrency.Count;
                                    int eachColumnPosition = 0;
                                    foreach (BandItem item3 in BandsTemplete)
                                    {
                                        bool IsExists = dTableCopy.Columns.Cast<DataColumn>().Select(x => x.ColumnName).Contains(item3.BandHeader);
                                        if (item3.BandHeader != "Plant")
                                        {
                                            string currencyValue1 = AddColumnsToSaleCurrencyDataTable(plant.Name, item3.BandHeader);
                                            if (dTableCopy.Rows[eachRow][eachColumnPosition].ToString() == null || dTableCopy.Rows[eachRow][eachColumnPosition].ToString() == string.Empty)
                                            {
                                                data[currencyValue1] = true;
                                            }
                                        }
                                        eachColumnPosition++;
                                        /// when we change the SelectedCurrency in the Information
                                        #region 

                                        #endregion
                                    }
                                    eachRow++;
                                }
                            }
                        }
                        DataRow[] found = dTableCopy.Select();
                        foreach (DataRow row1 in found)
                        {
                            if (!SelectedPlant.Cast<Site>().Any(a => a.Name == row1["Plant"].ToString()))
                            {
                                dTableCopy.Rows.Remove(row1);
                            }
                        }
                        bool _check = false;
                        foreach (Currency cur1 in SelectedSaleCurrency)
                        {
                            if (dTableCopy.Columns.Cast<DataColumn>().Any(x => x.ColumnName == cur1.Name))
                            {
                                _check = true;
                                break;
                            }
                        }
                        if (_check)
                        {
                            ObservableCollection<BandItem> SaleCurrencyCollection = new ObservableCollection<BandItem>();
                            foreach (Currency currency1 in SelectedSaleCurrency)
                            {
                                bool isThere = dTableCopy.Columns.Cast<DataColumn>().Select(x => x.ColumnName).Contains(currency1.Name);
                                if (!isThere)
                                {
                                    BandItem item2 = new BandItem() { BandName = currency1.Name, BandHeader = currency1.Name };
                                    dTableCopy.Columns.Add(currency1.Name, typeof(bool));
                                    item2.Columns = new ObservableCollection<ColumnItem>();
                                    item2.Columns.Add(new ColumnItem() { ColumnFieldName = currency1.Name, Width = 100, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                                    BandsTemplete.Add(item2);
                                }
                            }
                            foreach (BandItem bi in BandsTemplete)
                            {
                                List<ColumnItem> columns = new List<ColumnItem>(bi.Columns);
                                foreach (ColumnItem columnItem in columns.ToList())
                                {
                                    bool isDeleted = false;
                                    if (!SelectedSaleCurrency.Cast<Currency>().Any(a => a.Name == columnItem.ColumnFieldName) && columns[0].ColumnFieldName != "Plant" && columns[0].ColumnFieldName != ((Currency)SelectedCurrency).Name)
                                    {
                                        string fieldName = columns[0].ColumnFieldName;
                                        dTableCopy.Columns.Remove(fieldName);
                                        bi.Columns.Remove(columns[0]);
                                        dTableCopy.AcceptChanges();
                                        isDeleted = true;
                                    }
                                    if (isDeleted)
                                    {
                                        SaleCurrencyCollection.Add(bi);
                                    }
                                }
                                if (!SelectedSaleCurrency.Cast<Currency>().Any(a => a.Name == ((Currency)SelectedCurrency).Name) || !dTableCopy.Columns.Cast<DataColumn>().Select(x => x.ColumnName).Contains(((Currency)SelectedCurrency).Name))
                                {
                                    SelectedSaleCurrency.Add(SaleCurrencyList.FirstOrDefault(a => a.Name == ((Currency)SelectedCurrency).Name));
                                    SelectedSaleCurrency = new List<object>(SelectedSaleCurrency);
                                    string fieldName = ((Currency)SelectedCurrency).Name;
                                    dTableCopy.Columns.Add(fieldName, typeof(bool));
                                    bi.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });
                                    SelectedSaleCurrency_Copy = SelectedSaleCurrency;
                                    dTableCopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));
                                }
                            }
                            foreach (BandItem band1 in SaleCurrencyCollection)
                            {
                                BandsTemplete.Remove(band1);
                            }
                        }
                        Dttable = dTableCopy;
                    }
                    #endregion
                    #region Get the Base Price List Columns for Plant and Currency from service Calls
                    else
                    {
                        /// Create Plant Template
                        BandsTemplete.Clear();
                        Dttable = new DataTable();
                        BandItem item1 = new BandItem() { BandName = "Plant", BandHeader = "Plant" };
                        Dttable.Columns.Add("Plant", typeof(string));
                        item1.Columns = new ObservableCollection<ColumnItem>();
                        item1.Columns.Add(new ColumnItem() { ColumnFieldName = "Plant", Width = 100, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                        BandsTemplete.Add(item1);
                        /// Create Sale Currency Template
                        foreach (Currency currency in SelectedSaleCurrency)
                        {
                            BandItem item2 = new BandItem();
                            string fieldName = currency.Name;
                            Dttable.Columns.Add(fieldName, typeof(bool));
                            item2.BandName = fieldName;
                            item2.BandHeader = fieldName;
                            item2.Columns = new ObservableCollection<ColumnItem>();
                            item2.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default, ImageSrc = currency.CurrencyIconImage });
                            BandsTemplete.Add(item2);
                        }
                        /// Fill the DataTable with records
                        foreach (Site plant in SelectedPlant)
                        {
                            if (!Dttable.Rows.Cast<DataRow>().Select(x => x.ItemArray[0]).Contains(plant.Name))
                            {
                                dr1 = Dttable.NewRow();
                                dr1["Plant"] = plant.Name;
                                foreach (Currency cur in SelectedSaleCurrency)
                                {
                                    if (PlantCurrencyList.FirstOrDefault(x => x.IdPlant == plant.IdSite && x.IdCurrency == cur.IdCurrency) == null)
                                    {
                                        dr1[cur.Name] = Convert.ToBoolean(0);
                                    }
                                    else
                                    {
                                        byte val = PlantCurrencyList.FirstOrDefault(x => x.IdPlant == plant.IdSite && x.IdCurrency == cur.IdCurrency).PlantbyCurrency;
                                        dr1[cur.Name] = Convert.ToBoolean(val);
                                    }
                                }
                                Dttable.Rows.Add(dr1);
                            }
                        }
                    }
                    #endregion

                    PlantCurrencyListWithIsChecked = new List<BasePriceListByPlantCurrency>();

                    foreach (DataRow dr in Dttable.Rows)
                    {
                        BasePriceListByPlantCurrency item = new BasePriceListByPlantCurrency();
                        item.PlantName = dr["Plant"].ToString();
                        if (!PlantCurrencyListWithIsChecked.Any(a => a.PlantName == item.PlantName))
                        {
                            foreach (Currency cur in SelectedSaleCurrency)
                            {
                                if (dr[cur.Name].ToString() == "True")
                                {
                                    if (string.IsNullOrEmpty(item.CurrenciesName))
                                    {
                                        item.CurrenciesName = cur.Name;
                                    }
                                    else
                                    {
                                        if (!item.CurrenciesName.Contains(cur.Name))
                                            item.CurrenciesName += ", " + cur.Name;
                                    }
                                }
                            }
                            PlantCurrencyListWithIsChecked.Add(item);
                        }
                    }

                }
                #endregion
                GeosApplication.Instance.Logger.Log("Method AddEditColumnsToPlantsDataTable()... Executed Successfully", category: Category.Info, priority: Priority.Low);
            }

            #region Catch Block
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in AddEditColumnsToPlantsDataTable() method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), "Red", CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in AddEditColumnsToPlantsDataTable() Method - ServiceUnexceptedException " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in AddEditColumnsToPlantsDataTable() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
            #endregion
        }


        private void ChangeStatusCommandAction(object obj)
        {
            ComboBoxEdit value = ((System.Windows.RoutedEventArgs)obj).OriginalSource as ComboBoxEdit;

            if (ClonedBasePrice != null && isDuplicateCliked == false && value.DisplayText == SelectedStatus.Value)
            {
                return;
            }

            if (ClonedBasePrice != null && isDuplicateCliked == false && ClonedBasePrice.IsBPLExistInCPL == true)
            {
                string CPLCodes = PLMService.GetCustomerPriceCodesByBPL(ClonedBasePrice.IdBasePriceList);
                CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("CantChangeWithCPLValidation").ToString(), CPLCodes), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                SelectedStatus = StatusList.FirstOrDefault(x => x.IdLookupValue == ClonedBasePrice.Status.IdLookupValue);
                return;
            }
            if (!isDuplicateCliked) IsEnabledSaveButton = true;
        }
        private void ChangeEffectiveDateCommandAction()
        {
            if (oldEffectiveDate == null)
            {
                oldEffectiveDate = EffectiveDate;
            }
            else
            {
                if (oldEffectiveDate != EffectiveDate)
                {
                    oldEffectiveDate = EffectiveDate;
                    if (!isDuplicateCliked) IsEnabledSaveButton = true;
                }
            }
        }
        private void ChangeExpiryDateCommandAction()
        {
            if (oldExpiryDate == null)
            {
                oldExpiryDate = ExpiryDate;
            }
            else
            {
                if (oldExpiryDate != expiryDate)
                {
                    oldExpiryDate = ExpiryDate;
                    if (!isDuplicateCliked) IsEnabledSaveButton = true;
                }
            }
        }

        private string AddColumnsToSaleCurrencyDataTable(string plantName, string currencyName)
        {
            string CurrencyValue = string.Empty;

            #region Try Block
            try
            {
                GeosApplication.Instance.Logger.Log("Method AddColumnsToSaleCurrencyDataTable()...", category: Category.Info, priority: Priority.Low);
                if (SelectedSaleCurrency == null)
                    SelectedSaleCurrency = new List<object>();
                if (BandsTemplete.Count > 0)
                {
                    string[] columnNames = Dttable.Columns.Cast<DataColumn>().Select(a => a.ColumnName).ToArray();
                    if (columnNames.Contains(currencyName))
                    {
                        CurrencyValue = currencyName;
                    }
                }
                GeosApplication.Instance.Logger.Log("Method AddColumnsToSaleCurrencyDataTable()... Executed Successfully", category: Category.Info, priority: Priority.Low);
            }
            #endregion
            #region Catch Block
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in AddColumnsToSaleCurrencyDataTable() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), "Red", CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in AddColumnsToSaleCurrencyDataTable() Method - ServiceUnexceptedException " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in AddColumnsToSaleCurrencyDataTable() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
            #endregion
            return CurrencyValue;
        }

        private void CalculateArticleCostCommandAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method CalculateArticleCostCommandAction()...", category: Category.Info, priority: Priority.Low);
                if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }
                CalculateBasePriceArticlesByLogicValue();
                if (DtArticle != null && DtArticle.Rows.Count > 0)
                {
                    IsCalculateArticleCostButtonEnabled = false;
                    IsCalculated = true;
                }
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Method CalculateArticleCostCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method CalculateArticleCostCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void OnDragRecordOverArticleGrid(DragRecordOverEventArgs e)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method OnDragRecordOverArticleGrid()...", category: Category.Info, priority: Priority.Low);
                if ((e.IsFromOutside) && typeof(PCMArticleCategory).IsAssignableFrom(e.GetRecordType()))
                {
                    var data = (RecordDragDropData)e.Data.GetData(typeof(RecordDragDropData));
                    List<PCMArticleCategory> record = data.Records.OfType<PCMArticleCategory>().ToList();
                    int count = 0;
                    foreach (PCMArticleCategory article in record.Where(a => a.IdArticle > 0))
                    {
                        DataRow[] found = DtArticleCopy.Select("IdArticle = '" + article.IdArticle + "'");
                        if (found.Length == 0)
                        {
                            count++;
                        }
                    }
                    if (count > 0)
                    {
                        if (ClonedBasePrice != null && isDuplicateCliked == false && ClonedBasePrice.IdStatus == 224)
                        {
                            e.Effects = DragDropEffects.None;
                            e.Handled = false;
                            CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("CantAddArticleValidation").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                            return;
                        }
                        e.Effects = DragDropEffects.Copy;
                        e.Handled = true;
                    }
                    else
                    {
                        e.Effects = DragDropEffects.None;
                        e.Handled = false;
                    }

                }
                GeosApplication.Instance.Logger.Log("Method OnDragRecordOverArticleGrid()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method OnDragRecordOverArticleGrid() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void OnDragRecordOverDetectionGrid(DragRecordOverEventArgs e)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method OnDragRecordOverDetectionGrid()...", category: Category.Info, priority: Priority.Low);
                if ((e.IsFromOutside) && typeof(BPLDetection).IsAssignableFrom(e.GetRecordType()))
                {


                    var data = (RecordDragDropData)e.Data.GetData(typeof(RecordDragDropData));
                    List<BPLDetection> record = data.Records.OfType<BPLDetection>().ToList();
                    int count = 0;
                    foreach (BPLDetection detect in record.Where(a => a.IdDetection > 0))
                    {
                        DataRow[] found = DtDetectionCopy.Select("IdDetection = '" + detect.IdDetection + "'");
                        if (found.Length == 0)
                        {
                            count++;
                        }
                    }
                    if (count > 0)
                    {
                        if (ClonedBasePrice != null && isDuplicateCliked == false && ClonedBasePrice.IdStatus == 224)
                        {
                            e.Effects = DragDropEffects.None;
                            e.Handled = false;
                            CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("CantAdddetectionValidation").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                            return;
                        }

                        e.Effects = DragDropEffects.Copy;
                        e.Handled = true;
                    }
                    else
                    {
                        e.Effects = DragDropEffects.None;
                        e.Handled = false;
                    }

                }
                GeosApplication.Instance.Logger.Log("Method OnDragRecordOverDetectionGrid()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method OnDragRecordOverDetectionGrid() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void FillCurrencyConversionList_All()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillCurrencyConversionList_All ...", category: Category.Info, priority: Priority.Low);
                if (PLMCommon.Instance.CurrencyConversionList == null || PLMCommon.Instance.CurrencyConversionList.Count == 0)
                {
                    PLMCommon.Instance.CurrencyConversionList = new List<CurrencyConversion>(PLMService.GetCurrencyConversionsDetailsByLatestDate());
                }
                CurrencyConversionList = PLMCommon.Instance.CurrencyConversionList;
                GeosApplication.Instance.Logger.Log("Method FillCurrencyConversionList_All() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in FillCurrencyConversionList_All() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), "Red", CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in FillCurrencyConversionList_All() Method - ServiceUnexceptedException " + ex.Message, category: Category.Info, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillCurrencyConversionList_All() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        private void DropRecordArticleGrid(DropRecordEventArgs e)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method DropRecordArticleGrid()...", category: Category.Info, priority: Priority.Low);

                double MaxCost;
                double SellPriceValue = 0.00;

                if ((e.IsFromOutside) && typeof(PCMArticleCategory).IsAssignableFrom(e.GetRecordType()))
                {
                    var data = (RecordDragDropData)e.Data.GetData(typeof(RecordDragDropData));
                    List<PCMArticleCategory> records = data.Records.OfType<PCMArticleCategory>().ToList();

                    if (CurrencyConversionList == null)
                        CurrencyConversionList = new List<CurrencyConversion>();

                    foreach (PCMArticleCategory record in records.Where(a => a.IdArticle > 0))
                    {
                        if (DtArticleCopy == null)
                            DtArticleCopy = new DataTable();
                        DataRow[] found = DtArticleCopy.Select("IdArticle = '" + record.IdArticle + "'");
                        if (found.Length == 0)
                        {

                            if (AddArticles == null)
                                AddArticles = new List<UInt64>();

                            AddArticles.Add(record.IdArticle);

                            IsCalculateArticleCostButtonEnabled = true;
                            IsCalculated = false;
                            if (DtArticleCopy == null)
                                DtArticleCopy = new DataTable();
                            DataRow dr = DtArticleCopy.NewRow();
                            dr["IsChecked"] = false;
                            dr["Reference"] = record.Reference;
                            dr["Name"] = record.Description;
                            dr["IdArticle"] = record.IdArticle;
                            dr["Category"] = record.CategoryName;
                            dr["STAT"] = record.StatusAbbreviation;
                            dr["HtmlColor"] = record.StatusHtmlColor;
                            dr["Logic"] = 308;

                            dr["IsUpdatedRow"] = true;

                            //set gray color
                            ArticleMenuList.Where(a => a.IdArticle == record.IdArticle).ToList().ForEach(b => b.IsBPLArticle_Current = true);

                            double Cost_Value = 0;
                            dr["MaxCost_1"] = DBNull.Value;

                            List<ArticleCostPrice> PlantRecordsForGetCurrencyDate = new List<ArticleCostPrice>();

                            foreach (Site plant in SelectedPlant)
                            {
                                ArticleCostPrice Cost = ArticleCostPriceList.FirstOrDefault(a => a.IdCompany == plant.IdSite && a.IdArticle == Convert.ToUInt32(dr["IdArticle"]));
                                if (Cost == null)
                                {
                                    Cost = new ArticleCostPrice();
                                }
                                else
                                {
                                    PlantRecordsForGetCurrencyDate.Add(Cost);
                                }
                                dr[plant.Name] = Cost.ArticleCostValue;
                                if (dr["MaxCost_1"] == DBNull.Value)
                                {
                                    dr["MaxCost_1"] = Cost.ArticleCostValue;
                                    Cost_Value = Cost.ArticleCostValue;
                                }
                                if (Cost_Value < Cost.ArticleCostValue)
                                {
                                    dr["MaxCost_1"] = Cost.ArticleCostValue;
                                    Cost_Value = Cost.ArticleCostValue;
                                }
                            }

                            if (dr["MaxCost_1"] == DBNull.Value)
                            {
                                dr["MaxCost_1"] = 0;
                            }

                            dr["CurrencyConversionDate"] = CurrencyConversionList.FirstOrDefault().LastUpdate;


                            foreach (Currency currency in SelectedSaleCurrency)
                            {
                                if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                    dr["Common_Cur"] = DBNull.Value;
                                else
                                    dr[currency.Name] = DBNull.Value;

                                if (dr["CurrencyConversionDate"] != DBNull.Value)
                                {
                                    CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                    if (CurConversion1 != null)
                                    {
                                        if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                            else
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                        }
                                        else
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.ExchangeRate;
                                            else
                                                dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.LastMonthAVGRate;
                                        }
                                    }
                                }
                            }
                            if (CurrencyList.Count > 0)
                            {
                                if (!CurrencyList.Any(x => x.IdCurrency == ((Currency)SelectedCurrency).IdCurrency))
                                    SellPriceValue = 0.00;
                                else
                                    SellPriceValue = Convert.ToDouble(CurrencyList.Where(x => x.IdCurrency == ((Currency)SelectedCurrency).IdCurrency).Select(x => x.SellPriceValue).FirstOrDefault());
                            }

                            if (PlantRecordsForGetCurrencyDate.Count > 0)
                                MaxCost = Convert.ToDouble(PlantRecordsForGetCurrencyDate.Max(x => x.ArticleCostValue));
                            else
                                MaxCost = 0.00;

                            dr["Profit"] = Convert.ToDouble(CalculateBasePriceProfitValue(MaxCost, SellPriceValue));

                            dr["CostMargin"] = Convert.ToDouble(CalculateBasePriceCostMarginValue(MaxCost, SellPriceValue));
                            if (dr["CurrencyConversionDate"] != DBNull.Value)
                            {
                                if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                {
                                    dr["SaleCurrencyConversionDate"] = "Updated currency rate on : " + Convert.ToDateTime(dr["CurrencyConversionDate"]).ToString("dd/MM/yyyy");
                                }
                                else
                                {
                                    DateTime dtCurrencyConversionDate = new DateTime(Convert.ToDateTime(dr["CurrencyConversionDate"]).Year, Convert.ToDateTime(dr["CurrencyConversionDate"]).Month, 1);
                                    dr["SaleCurrencyConversionDate"] = "Updated currency rate on : " + dtCurrencyConversionDate.ToString("dd/MM/yyyy");
                                }
                            }

                            DtArticleCopy.Rows.Add(dr);


                            e.Handled = true;
                            if (!isDuplicateCliked) IsEnabledSaveButton = true;
                        }
                    }
                    #region GEOS2-3126 [Gulab lakade]
                    ObservableCollection<PCMArticleCategory> ArticleMenuListtemp1 = new ObservableCollection<PCMArticleCategory>();
                    foreach (PCMArticleCategory item in ArticleMenuList)
                    {
                        string TempName = item.Name.Remove(item.Name.LastIndexOf("[") + 1);
                        int t = ArticleMenuList.Where(x => x.ParentName == item.KeyName && x.IsBPLArticle_Current == false).ToList().Count;
                        PCMArticleCategory ArticleMenuList1 = new PCMArticleCategory();
                        ArticleMenuList1.IdArticle = item.IdArticle;
                        //Shubham[skadam] GEOS2-4784 GEOS2-4785 No additional data so remove [0] this in tree menu in article, detection & module  left tree in BPL menu 29 08 2023
                        // ArticleMenuList1.Name = TempName + ArticleMenuList.Where(x => x.ParentName == item.KeyName && x.IsBPLArticle_Current == false).ToList().Count + "]";
                        try
                        {
                            Int64 Count = ArticleMenuList.Where(x => x.ParentName == item.KeyName && x.IsBPLArticle_Current == false).ToList().Count;
                            if (Count != 0)
                            {
                                ArticleMenuList1.Name = TempName + Count + "]";
                            }
                            else
                            {
                                if (!string.IsNullOrEmpty(TempName))
                                {
                                    ArticleMenuList1.Name = TempName.Remove(TempName.Length - 1);
                                }
                                else
                                {
                                    if (!string.IsNullOrEmpty(item.Name))
                                    {
                                        ArticleMenuList1.Name = item.Name;
                                    }
                                    else
                                    {
                                        ArticleMenuList1.Name = "";
                                    }
                                }
                            }
                        }
                        catch (Exception ex) { }
                        ArticleMenuList1.NameWithArticleCount = item.NameWithArticleCount;
                        ArticleMenuList1.ParentName = item.ParentName;
                        ArticleMenuList1.KeyName = item.KeyName;
                        ArticleMenuList1.Reference = item.Reference;
                        ArticleMenuList1.StatusHtmlColor = item.StatusHtmlColor;
                        ArticleMenuList1.IdPCMArticleCategory = item.IdPCMArticleCategory;
                        ArticleMenuList1.IsBPLArticle = item.IsBPLArticle;
                        ArticleMenuList1.IsBPLArticle_Current = item.IsBPLArticle_Current;
                        ArticleMenuListtemp1.Add(ArticleMenuList1);
                    }
                    ArticleMenuList = new ObservableCollection<PCMArticleCategory>();
                    ArticleMenuList.AddRange(ArticleMenuListtemp1);
                    #endregion
                    DtArticle = DtArticleCopy;
                }
                GeosApplication.Instance.Logger.Log("Method DropRecordArticleGrid()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method DropRecordArticleGrid() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        //[cpatil][001][25-02-2022][GEOS2-3564]
        private void DropRecordDetectionGrid(DropRecordEventArgs e)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method DropRecordDetectionGrid()...", category: Category.Info, priority: Priority.Low);

                double MaxCost = 0.00;
                double SellPriceValue = 0.00;

                if ((e.IsFromOutside) && typeof(BPLDetection).IsAssignableFrom(e.GetRecordType()))
                {
                    var data = (RecordDragDropData)e.Data.GetData(typeof(RecordDragDropData));
                    List<BPLDetection> records = data.Records.OfType<BPLDetection>().ToList();

                    if (DtDetectionCopy == null)
                        DtDetectionCopy = new DataTable();

                    foreach (BPLDetection record in records.Where(a => a.IdDetection > 0))
                    {
                        if (DtDetectionCopy == null)
                            DtDetectionCopy = new DataTable();
                        DataRow[] found = DtDetectionCopy.Select("IdDetection = '" + record.IdDetection + "'");
                        if (found.Length == 0)
                        {
                            if (AddDetections == null)
                                AddDetections = new List<UInt64>();

                            AddDetections.Add(record.IdDetection);

                            DataRow dr = DtDetectionCopy.NewRow();
                            dr["IsChecked"] = false;
                            if (string.IsNullOrEmpty(record.Code)) //[001]
                                dr["Code"] = "---";
                            else
                                dr["Code"] = record.Code;
                            //dr["Code"] = record.Code;
                            dr["Name"] = record.Name;
                            dr["IdDetection"] = record.IdDetection;
                            dr["Type"] = record.DetectionTypeName;
                            dr["Logic"] = 308;
                            dr["IsUpdatedRow"] = true;
                            dr["STAT"] = record.StatusAbbreviation;
                            dr["HtmlColor"] = record.StatusHtmlColor;
                            //set gray color
                            DetectionMenulist.Where(a => a.IdDetection == record.IdDetection).ToList().ForEach(b => b.IsBPLArticle_Current = true);

                            //double Cost_Value = 0;
                            dr["MaxCost_1"] = 0;

                            dr["CurrencyConversionDate"] = CurrencyConversionList.FirstOrDefault().LastUpdate;



                            foreach (Currency currency in SelectedSaleCurrency)
                            {
                                if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                    dr["Common_Cur"] = DBNull.Value;
                                else
                                    dr[currency.Name] = DBNull.Value;

                                if (dr["CurrencyConversionDate"] != DBNull.Value)
                                {
                                    CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                    if (CurConversion1 != null)
                                    {
                                        if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                            else
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                        }
                                        else
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.ExchangeRate;
                                            else
                                                dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.LastMonthAVGRate;
                                        }
                                    }
                                }
                            }

                            if (CurrencyList.Count > 0)
                            {
                                if (!CurrencyList.Any(x => x.IdCurrency == ((Currency)SelectedCurrency).IdCurrency))
                                    SellPriceValue = 0.00;
                                else
                                    SellPriceValue = Convert.ToDouble(CurrencyList.Where(x => x.IdCurrency == ((Currency)SelectedCurrency).IdCurrency).Select(x => x.SellPriceValue).FirstOrDefault());
                            }

                            MaxCost = (double)dr["MaxCost_1"];

                            dr["Profit"] = Convert.ToDouble(CalculateBasePriceProfitValue(MaxCost, SellPriceValue));

                            dr["CostMargin"] = Convert.ToDouble(CalculateBasePriceCostMarginValue(MaxCost, SellPriceValue));
                            if (dr["CurrencyConversionDate"] != DBNull.Value)
                            {
                                if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                {
                                    dr["SaleCurrencyConversionDate"] = "Updated currency rate on : " + Convert.ToDateTime(dr["CurrencyConversionDate"]).ToString("dd/MM/yyyy");
                                }
                                else
                                {
                                    DateTime dtCurrencyConversionDate = new DateTime(Convert.ToDateTime(dr["CurrencyConversionDate"]).Year, Convert.ToDateTime(dr["CurrencyConversionDate"]).Month, 1);
                                    dr["SaleCurrencyConversionDate"] = "Updated currency rate on : " + dtCurrencyConversionDate.ToString("dd/MM/yyyy");
                                }
                            }
                            DtDetectionCopy.Rows.Add(dr);


                            e.Handled = true;
                            if (!isDuplicateCliked) IsEnabledSaveButton = true;
                        }
                    }
                    #region GEOS2-3126 [Sudhir Jangra] [21/12/2022]
                    ObservableCollection<BPLDetection> DetectionMenuListtemp1 = new ObservableCollection<BPLDetection>();
                    foreach (BPLDetection item in DetectionMenulist)
                    {
                        string TempName = item.Name.Remove(item.Name.LastIndexOf("[") + 1);
                        int t = DetectionMenulist.Where(x => x.ParentName == item.KeyName && x.IsBPLArticle_Current == false).ToList().Count;
                        BPLDetection DetectionMenuList1 = new BPLDetection();
                        DetectionMenuList1.IdDetection = item.IdDetection;
                        //Shubham[skadam] GEOS2-4784 GEOS2-4785 No additional data so remove [0] this in tree menu in article, detection & module  left tree in BPL menu 29 08 2023
                        //DetectionMenuList1.Name = TempName + DetectionMenulist.Where(x => x.ParentName == item.KeyName && x.IsBPLArticle_Current == false).ToList().Count + "]";
                        try
                        {
                            Int64 Count = DetectionMenulist.Where(x => x.ParentName == item.KeyName && x.IsBPLArticle_Current == false).ToList().Count;
                            if (Count != 0)
                            {
                                DetectionMenuList1.Name = TempName + Count + "]";
                            }
                            else
                            {
                                if (!string.IsNullOrEmpty(TempName))
                                {
                                    DetectionMenuList1.Name = TempName.Remove(TempName.Length - 1);
                                }
                                else
                                {
                                    if (!string.IsNullOrEmpty(item.Name))
                                    {
                                        DetectionMenuList1.Name = item.Name;
                                    }
                                    else
                                    {
                                        DetectionMenuList1.Name = "";
                                    }
                                }
                            }
                        }
                        catch (Exception ex) { }
                        DetectionMenuList1.ParentName = item.ParentName;
                        DetectionMenuList1.KeyName = item.KeyName;
                        DetectionMenuList1.Description = item.Description;
                        DetectionMenuList1.DetectionTypeName = item.DetectionTypeName;
                        DetectionMenuList1.IdDetectionType = item.IdDetectionType;
                        DetectionMenuList1.IdGroup = item.IdGroup;
                        DetectionMenuList1.Code = item.Code;
                        DetectionMenuList1.StatusHtmlColor = item.StatusHtmlColor;
                        DetectionMenuList1.IsBPLArticle_Current = item.IsBPLArticle_Current;
                        DetectionMenuListtemp1.Add(DetectionMenuList1);
                    }
                    DetectionMenulist = new ObservableCollection<BPLDetection>();
                    DetectionMenulist.AddRange(DetectionMenuListtemp1);

                    #endregion
                    DtDetection = DtDetectionCopy;
                }
                GeosApplication.Instance.Logger.Log("Method DropRecordDetectionGrid()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method DropRecordDetectionGrid() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void CompleteRecordDragDropArticleGrid(CompleteRecordDragDropEventArgs e)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method CompleteRecordDragDropArticleGrid()...", category: Category.Info, priority: Priority.Low);
                e.Handled = false;
                GeosApplication.Instance.Logger.Log("Method CompleteRecordDragDropArticleGrid()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method CompleteRecordDragDropArticleGrid() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void CompleteRecordDragDropDetectionGrid(CompleteRecordDragDropEventArgs e)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method CompleteRecordDragDropDetectionGrid()...", category: Category.Info, priority: Priority.Low);
                e.Handled = false;
                GeosApplication.Instance.Logger.Log("Method CompleteRecordDragDropDetectionGrid()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method CompleteRecordDragDropDetectionGrid() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void DeleteArticleCommandAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method DeleteArticleCommandAction()...", category: Category.Info, priority: Priority.Low);

                DataColumn[] columns = DtArticleCopy.Columns.Cast<DataColumn>().ToArray();

                DataRow[] foundChecked = DtArticleCopy.AsEnumerable().Where(row => columns.Any(col => row["IsChecked"].ToString() == "True")).ToArray();
                DataRow MainRow = ((System.Data.DataRowView)obj).Row;
                CPList = new List<CustomerPrice>();

                if (ClonedBasePrice != null && isDuplicateCliked == false && ClonedBasePrice.IdStatus == 224)
                {
                    CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("CantDeleteArticleValidation").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                    return;
                }

                if (DeleteArticles == null)
                    DeleteArticles = new List<Articles>();

                if (foundChecked.Length > 0 && MainRow["IsChecked"].ToString() != "False")
                {
                    string commaSeparatedString = String.Join(",", foundChecked.AsEnumerable().Select(x => x.Field<uint>("IdArticle").ToString()).ToArray());
                    CPList.AddRange(new List<CustomerPrice>(PLMService.GetCustomerPriceIFExistItem_V2120(IdBasePriceList, commaSeparatedString)));

                    if (CPList.Count > 0)
                    {

                        if (DeleteFromCPL == null)
                            DeleteFromCPL = new List<CustomerPriceListByItem>();

                        List<string> CPLCodes = CPList.Select(x => x.Code).Distinct().ToList();
                        List<string> CPLNames = new List<string>();
                        List<string> ReferencesList = new List<string>();
                        foreach (string cp in CPLCodes)
                        {
                            CPLNames.Add(cp + "-" + (CPList.Where(x => x.Code == cp).Select(x => x.Name).FirstOrDefault()));
                        }

                        foreach (DataRow dr in foundChecked)
                            ReferencesList.Add(ArticleMenuList.Where(x => x.IdArticle == (uint)dr["IdArticle"]).Select(x => x.Reference).FirstOrDefault());

                        MessageBoxResult result1 = CustomMessageBox.Show(string.Format(Application.Current.Resources["DeleteBPLAndCPLArticleList"].ToString(), string.Join(", ", ReferencesList), System.Environment.NewLine, string.Join(System.Environment.NewLine, CPLNames), System.Environment.NewLine), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                        if (result1 == MessageBoxResult.Yes)
                        {
                            if (foundChecked.Length > 0)
                            {
                                foreach (DataRow dr in foundChecked)
                                {
                                    ArticleMenuList.Where(a => a.IdArticle == (uint)dr["IdArticle"]).ToList().ForEach(b => b.IsBPLArticle_Current = false);
                                    Articles art = new Articles();
                                    art.IdArticle = (uint)dr["IdArticle"];
                                    DeleteArticles.Add(art);
                                    DtArticleCopy.Rows.Remove(dr);
                                }



                                foreach (CustomerPrice deleteCPL in CPList)
                                {
                                    foreach (CustomerPriceListByItem item in deleteCPL.CustomerPriceListItems)
                                    {
                                        CustomerPriceListByItem article = new CustomerPriceListByItem();
                                        article.IdCustomerPriceList = deleteCPL.IdCustomerPriceList;
                                        article.IdArticle = item.IdArticle;
                                        DeleteFromCPL.Add(article);
                                    }
                                }

                            }
                            DtArticle = DtArticleCopy;
                            if (!isDuplicateCliked) IsEnabledSaveButton = true;
                        }
                    }
                    else
                    {
                        MessageBoxResult result1 = CustomMessageBox.Show(Application.Current.Resources["DeleteBPLArticleMessage"].ToString(), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                        if (result1 == MessageBoxResult.Yes)
                        {
                            if (foundChecked.Length > 0)
                            {
                                foreach (DataRow dr in foundChecked)
                                {
                                    ArticleMenuList.Where(a => a.IdArticle == (uint)dr["IdArticle"]).ToList().ForEach(b => b.IsBPLArticle_Current = false);
                                    Articles art = new Articles();
                                    art.IdArticle = (uint)dr["IdArticle"];
                                    DeleteArticles.Add(art);
                                    DtArticleCopy.Rows.Remove(dr);
                                }
                            }
                            DtArticle = DtArticleCopy;
                            if (!isDuplicateCliked) IsEnabledSaveButton = true;
                        }
                    }
                }
                else
                {
                    PCMArticleCategory pCMArticleCategory = ArticleMenuList.Where(a => a.IdArticle == (uint)((System.Data.DataRowView)obj).Row["IdArticle"]).FirstOrDefault();
                    CPList = new List<CustomerPrice>(PLMService.GetCustomerPriceIFExistItem_V2120(IdBasePriceList, pCMArticleCategory.IdArticle.ToString()));
                    if (CPList.Count > 0)
                    {
                        if (DeleteFromCPL == null)
                            DeleteFromCPL = new List<CustomerPriceListByItem>();

                        List<string> CPLCodes = CPList.Select(x => x.Code).Distinct().ToList();
                        List<string> CPLNames = new List<string>();
                        foreach (string cp in CPLCodes)
                        {
                            CPLNames.Add(cp + "-" + (CPList.Where(x => x.Code == cp).Select(x => x.Name).FirstOrDefault()));
                        }
                        string reference = MainRow["Reference"].ToString();
                        MessageBoxResult result2 = CustomMessageBox.Show(string.Format(Application.Current.Resources["DeleteBPLAndCPLArticleList"].ToString(), reference, System.Environment.NewLine, string.Join(System.Environment.NewLine, CPLNames), System.Environment.NewLine), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                        if (result2 == MessageBoxResult.Yes)
                        {
                            if (obj != null)
                            {
                                //remove set gray color
                                ArticleMenuList.Where(a => a.IdArticle == (uint)((System.Data.DataRowView)obj).Row["IdArticle"]).ToList().ForEach(b => b.IsBPLArticle_Current = false);
                                Articles art = new Articles();
                                art.IdArticle = (uint)((System.Data.DataRowView)obj).Row["IdArticle"];
                                DeleteArticles.Add(art);
                                DtArticleCopy.Rows.Remove(((System.Data.DataRowView)obj).Row);

                                foreach (CustomerPrice deleteCPL in CPList)
                                {
                                    foreach (CustomerPriceListByItem item in deleteCPL.CustomerPriceListItems)
                                    {
                                        CustomerPriceListByItem article = new CustomerPriceListByItem();
                                        article.IdCustomerPriceList = deleteCPL.IdCustomerPriceList;
                                        article.IdArticle = item.IdArticle;
                                        DeleteFromCPL.Add(article);
                                    }
                                }
                            }
                            if (!isDuplicateCliked) IsEnabledSaveButton = true;
                        }
                    }
                    else
                    {
                        MessageBoxResult MessageBoxResult = CustomMessageBox.Show(Application.Current.Resources["DeleteBPLArticleMessageSelected"].ToString(), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                        if (MessageBoxResult == MessageBoxResult.Yes)
                        {
                            if (obj != null)
                            {
                                //remove set gray color
                                ArticleMenuList.Where(a => a.IdArticle == (uint)((System.Data.DataRowView)obj).Row["IdArticle"]).ToList().ForEach(b => b.IsBPLArticle_Current = false);
                                Articles art = new Articles();
                                art.IdArticle = (uint)((System.Data.DataRowView)obj).Row["IdArticle"];
                                DeleteArticles.Add(art);
                                DtArticleCopy.Rows.Remove(((System.Data.DataRowView)obj).Row);
                            }
                            DtArticle = DtArticleCopy;
                            if (!isDuplicateCliked) IsEnabledSaveButton = true;
                        }
                    }
                }
                #region GEOS2-3126 [Gulab lakade]
                ObservableCollection<PCMArticleCategory> ArticleMenuListtemp1 = new ObservableCollection<PCMArticleCategory>();
                foreach (PCMArticleCategory item in ArticleMenuList)
                {
                    string TempName = item.Name.Remove(item.Name.LastIndexOf("[") + 1);
                    int t = ArticleMenuList.Where(x => x.ParentName == item.KeyName && x.IsBPLArticle_Current == false).ToList().Count;
                    PCMArticleCategory ArticleMenuList1 = new PCMArticleCategory();
                    ArticleMenuList1.IdArticle = item.IdArticle;
                    //Shubham[skadam] GEOS2-4784 GEOS2-4785 No additional data so remove [0] this in tree menu in article, detection & module  left tree in BPL menu 29 08 2023
                    //ArticleMenuList1.Name = TempName + ArticleMenuList.Where(x => x.ParentName == item.KeyName && x.IsBPLArticle_Current == false).ToList().Count + "]";
                    try
                    {
                        Int64 Count = ArticleMenuList.Where(x => x.ParentName == item.KeyName && x.IsBPLArticle_Current == false).ToList().Count;
                        if (Count != 0)
                        {
                            ArticleMenuList1.Name = TempName + Count + "]";
                        }
                        else
                        {
                            if (!string.IsNullOrEmpty(TempName))
                            {
                                ArticleMenuList1.Name = TempName.Remove(TempName.Length - 1);
                            }
                            else
                            {
                                if (!string.IsNullOrEmpty(item.Name))
                                {
                                    ArticleMenuList1.Name = item.Name;
                                }
                                else
                                {
                                    ArticleMenuList1.Name = "";
                                }
                            }
                        }
                    }
                    catch (Exception ex) { }
                    ArticleMenuList1.NameWithArticleCount = item.NameWithArticleCount;
                    ArticleMenuList1.ParentName = item.ParentName;
                    ArticleMenuList1.KeyName = item.KeyName;
                    ArticleMenuList1.Reference = item.Reference;
                    ArticleMenuList1.StatusHtmlColor = item.StatusHtmlColor;
                    ArticleMenuList1.IdPCMArticleCategory = item.IdPCMArticleCategory;
                    ArticleMenuList1.IsBPLArticle = item.IsBPLArticle;
                    ArticleMenuList1.IsBPLArticle_Current = item.IsBPLArticle_Current;
                    ArticleMenuListtemp1.Add(ArticleMenuList1);
                }
                ArticleMenuList = new ObservableCollection<PCMArticleCategory>();
                ArticleMenuList.AddRange(ArticleMenuListtemp1);
                #endregion

                GeosApplication.Instance.Logger.Log("Method DeleteArticleCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method DeleteArticleCommandAction()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        private void DeleteDetectionCommandAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method DeleteDetectionCommandAction()...", category: Category.Info, priority: Priority.Low);

                DataColumn[] columns = DtDetectionCopy.Columns.Cast<DataColumn>().ToArray();

                DataRow[] foundChecked = DtDetectionCopy.AsEnumerable().Where(row => columns.Any(col => row["IsChecked"].ToString() == "True")).ToArray();
                DataRow MainRow = ((System.Data.DataRowView)obj).Row;
                CPList = new List<CustomerPrice>();

                if (ClonedBasePrice != null && isDuplicateCliked == false && ClonedBasePrice.IdStatus == 224)
                {
                    CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("CantDeletedetectionValidation").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                    return;
                }

                if (DeleteDetections == null)
                    DeleteDetections = new List<Detections>();

                if (foundChecked.Length > 0 && MainRow["IsChecked"].ToString() != "False")
                {
                    string commaSeparatedString = String.Join(",", foundChecked.AsEnumerable().Select(x => x.Field<uint>("IdDetection").ToString()).ToArray());
                    CPList.AddRange(new List<CustomerPrice>(PLMService.GetCustomerPriceIFExistDetections(IdBasePriceList, commaSeparatedString)));

                    if (CPList.Count > 0)
                    {
                        if (DeleteDetectionFromCPL == null)
                            DeleteDetectionFromCPL = new List<CustomerPriceListByItem>();

                        List<string> CPLCodes = CPList.Select(x => x.Code).Distinct().ToList();
                        List<string> CPLNames = new List<string>();
                        List<string> ReferencesList = new List<string>();
                        foreach (string cp in CPLCodes)
                        {
                            CPLNames.Add(cp + "-" + (CPList.Where(x => x.Code == cp).Select(x => x.Name).FirstOrDefault()));
                        }

                        foreach (DataRow dr in foundChecked)
                        {
                            if (string.IsNullOrEmpty(DetectionMenulist.Where(x => x.IdDetection == (uint)dr["IdDetection"]).Select(x => x.Code).FirstOrDefault()))
                                ReferencesList.Add(DetectionMenulist.Where(x => x.IdDetection == (uint)dr["IdDetection"]).Select(x => x.Name).FirstOrDefault());
                            else
                                ReferencesList.Add(DetectionMenulist.Where(x => x.IdDetection == (uint)dr["IdDetection"]).Select(x => x.Code).FirstOrDefault());
                        }

                        MessageBoxResult result1 = CustomMessageBox.Show(string.Format(Application.Current.Resources["DeleteBPLAndCPLDetectionList"].ToString(), string.Join(", ", ReferencesList), System.Environment.NewLine, string.Join(System.Environment.NewLine, CPLNames), System.Environment.NewLine), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                        if (result1 == MessageBoxResult.Yes)
                        {
                            if (foundChecked.Length > 0)
                            {
                                foreach (DataRow dr in foundChecked)
                                {
                                    DetectionMenulist.Where(a => a.IdDetection == (uint)dr["IdDetection"]).ToList().ForEach(b => b.IsBPLArticle_Current = false);
                                    Detections det = new Detections();
                                    det.IdDetections = (uint)dr["IdDetection"];
                                    DeleteDetections.Add(det);
                                    DtDetectionCopy.Rows.Remove(dr);
                                }

                                foreach (CustomerPrice deleteCPL in CPList)
                                {
                                    foreach (CustomerPriceListByItem item in deleteCPL.CustomerPriceListItems)
                                    {
                                        CustomerPriceListByItem detection = new CustomerPriceListByItem();
                                        detection.IdCustomerPriceList = deleteCPL.IdCustomerPriceList;
                                        detection.IdDetection = item.IdDetection;
                                        DeleteDetectionFromCPL.Add(detection);
                                    }
                                }
                            }
                            DtDetection = DtDetectionCopy;
                            if (!isDuplicateCliked) IsEnabledSaveButton = true;
                        }
                    }
                    else
                    {
                        MessageBoxResult result1 = CustomMessageBox.Show(Application.Current.Resources["DeleteBPLDetectionMessage"].ToString(), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                        if (result1 == MessageBoxResult.Yes)
                        {
                            if (foundChecked.Length > 0)
                            {
                                foreach (DataRow dr in foundChecked)
                                {
                                    DetectionMenulist.Where(a => a.IdDetection == (uint)dr["IdDetection"]).ToList().ForEach(b => b.IsBPLArticle_Current = false);
                                    Detections det = new Detections();
                                    det.IdDetections = (uint)dr["IdDetection"];
                                    DeleteDetections.Add(det);
                                    DtDetectionCopy.Rows.Remove(dr);
                                }
                            }
                            DtDetection = DtDetectionCopy;
                            if (!isDuplicateCliked) IsEnabledSaveButton = true;
                        }
                    }
                }
                else
                {
                    BPLDetection bplDetection = DetectionMenulist.Where(a => a.IdDetection == (uint)((System.Data.DataRowView)obj).Row["IdDetection"]).FirstOrDefault();
                    if (bplDetection != null)
                        CPList = new List<CustomerPrice>(PLMService.GetCustomerPriceIFExistDetections(IdBasePriceList, bplDetection.IdDetection.ToString()));
                    else
                        CPList = new List<CustomerPrice>(PLMService.GetCustomerPriceIFExistDetections(IdBasePriceList, ((System.Data.DataRowView)obj).Row["IdDetection"].ToString()));
                    if (CPList.Count > 0)
                    {
                        if (DeleteDetectionFromCPL == null)
                            DeleteDetectionFromCPL = new List<CustomerPriceListByItem>();

                        List<string> CPLCodes = CPList.Select(x => x.Code).Distinct().ToList();
                        List<string> CPLNames = new List<string>();
                        foreach (string cp in CPLCodes)
                        {
                            CPLNames.Add(cp + "-" + (CPList.Where(x => x.Code == cp).Select(x => x.Name).FirstOrDefault()));
                        }
                        string reference = string.Empty;
                        if (string.IsNullOrEmpty(MainRow["Code"].ToString()))
                            reference = MainRow["Name"].ToString();
                        else
                            reference = MainRow["Code"].ToString();

                        MessageBoxResult result2 = CustomMessageBox.Show(string.Format(Application.Current.Resources["DeleteBPLAndCPLDetectionList"].ToString(), reference, System.Environment.NewLine, string.Join(System.Environment.NewLine, CPLNames), System.Environment.NewLine), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                        if (result2 == MessageBoxResult.Yes)
                        {
                            if (obj != null)
                            {
                                if (bplDetection != null)
                                {
                                    //remove set gray color
                                    DetectionMenulist.Where(a => a.IdDetection == (uint)((System.Data.DataRowView)obj).Row["IdDetection"]).ToList().ForEach(b => b.IsBPLArticle_Current = false);
                                }
                                Detections det = new Detections();
                                det.IdDetections = (uint)((System.Data.DataRowView)obj).Row["IdDetection"];
                                DeleteDetections.Add(det);
                                DtDetectionCopy.Rows.Remove(((System.Data.DataRowView)obj).Row);

                                foreach (CustomerPrice deleteCPL in CPList)
                                {
                                    foreach (CustomerPriceListByItem item in deleteCPL.CustomerPriceListItems)
                                    {
                                        CustomerPriceListByItem detection = new CustomerPriceListByItem();
                                        detection.IdCustomerPriceList = deleteCPL.IdCustomerPriceList;
                                        detection.IdDetection = item.IdDetection;
                                        DeleteDetectionFromCPL.Add(detection);
                                    }
                                }
                            }
                            if (!isDuplicateCliked) IsEnabledSaveButton = true;
                        }
                    }
                    else
                    {
                        MessageBoxResult MessageBoxResult = CustomMessageBox.Show(Application.Current.Resources["DeleteBPLDetectionMessageSelected"].ToString(), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                        if (MessageBoxResult == MessageBoxResult.Yes)
                        {
                            if (obj != null)
                            {
                                if (DetectionMenulist.Any(a => a.IdDetection == (uint)((System.Data.DataRowView)obj).Row["IdDetection"]))
                                {
                                    //remove set gray color
                                    DetectionMenulist.Where(a => a.IdDetection == (uint)((System.Data.DataRowView)obj).Row["IdDetection"]).ToList().ForEach(b => b.IsBPLArticle_Current = false);
                                }
                                Detections det = new Detections();
                                det.IdDetections = (uint)((System.Data.DataRowView)obj).Row["IdDetection"];
                                DeleteDetections.Add(det);
                                DtDetectionCopy.Rows.Remove(((System.Data.DataRowView)obj).Row);
                            }
                            DtDetection = DtDetectionCopy;
                            if (!isDuplicateCliked) IsEnabledSaveButton = true;
                        }
                    }
                }
                #region Geos2-3126 [Sudhir Jangra] [21/12/2022]
                ObservableCollection<BPLDetection> DetectionMenuListtemp1 = new ObservableCollection<BPLDetection>();
                foreach (BPLDetection item in DetectionMenulist)
                {
                    string TempName = item.Name.Remove(item.Name.LastIndexOf("[") + 1);
                    int t = DetectionMenulist.Where(x => x.ParentName == item.KeyName && x.IsBPLArticle_Current == false).ToList().Count;
                    BPLDetection DetectionMenuList1 = new BPLDetection();
                    DetectionMenuList1.IdDetection = item.IdDetection;
                    //Shubham[skadam] GEOS2-4784 GEOS2-4785 No additional data so remove [0] this in tree menu in article, detection & module  left tree in BPL menu 29 08 2023
                    //DetectionMenuList1.Name = TempName + DetectionMenulist.Where(x => x.ParentName == item.KeyName && x.IsBPLArticle_Current == false).ToList().Count + "]";
                    try
                    {
                        Int64 Count = DetectionMenulist.Where(x => x.ParentName == item.KeyName && x.IsBPLArticle_Current == false).ToList().Count;
                        if (Count != 0)
                        {
                            DetectionMenuList1.Name = TempName + Count + "]";
                        }
                        else
                        {
                            if (!string.IsNullOrEmpty(TempName))
                            {
                                DetectionMenuList1.Name = TempName.Remove(TempName.Length - 1);
                            }
                            else
                            {
                                if (!string.IsNullOrEmpty(item.Name))
                                {
                                    DetectionMenuList1.Name = item.Name;
                                }
                                else
                                {
                                    DetectionMenuList1.Name = "";
                                }
                            }
                        }
                    }
                    catch (Exception ex) { }
                    DetectionMenuList1.ParentName = item.ParentName;
                    DetectionMenuList1.KeyName = item.KeyName;
                    DetectionMenuList1.Description = item.Description;
                    DetectionMenuList1.DetectionTypeName = item.DetectionTypeName;
                    DetectionMenuList1.IdDetectionType = item.IdDetectionType;
                    DetectionMenuList1.IdGroup = item.IdGroup;
                    DetectionMenuList1.Code = item.Code;
                    DetectionMenuList1.StatusHtmlColor = item.StatusHtmlColor;
                    DetectionMenuList1.IsBPLArticle_Current = item.IsBPLArticle_Current;
                    DetectionMenuListtemp1.Add(DetectionMenuList1);
                }
                DetectionMenulist = new ObservableCollection<BPLDetection>();
                DetectionMenulist.AddRange(DetectionMenuListtemp1);
                #endregion

                GeosApplication.Instance.Logger.Log("Method DeleteDetectionCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method DeleteDetectionCommandAction()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        private void RuleValueChangedCommandAction(object obj)
        {
            try
            {
                if (obj == null)
                    return;

                double MaxCost = 0.00;
                double SellPriceValue = 0.00;
                if (((DevExpress.Xpf.Grid.CellValueEventArgs)obj).Column.FieldName == "Value" || ((DevExpress.Xpf.Grid.CellValueEventArgs)obj).Column.FieldName == "Logic")
                {
                    IsCalculateArticleCostButtonEnabled = true;
                    IsCalculated = false;
                    DataColumn[] columns = DtArticleCopy.Columns.Cast<DataColumn>().ToArray();
                    DataRow[] foundChecked = DtArticleCopy.AsEnumerable().Where(row => columns.Any(col => row["IsChecked"].ToString() == "True")).ToArray();

                    DataRow MainRow = ((System.Data.DataRowView)((DevExpress.Xpf.Grid.RowEventArgs)obj).Row).Row;

                    if (foundChecked.Length > 0 && MainRow["IsChecked"].ToString() != "False")
                    {
                        for (int j = 0; j < foundChecked.Length; j++)
                        {
                            foundChecked[j].BeginEdit();

                            if (foundChecked[j]["MaxCost_1"] == DBNull.Value)
                            {
                                foundChecked[j]["MaxCost_1"] = 0;
                            }
                            if (MainRow["Value"] == DBNull.Value)
                            {
                                MainRow["Value"] = 0;
                            }
                            if (MainRow["Value"] != DBNull.Value && MainRow["IsChecked"].ToString() != "False")
                            {
                                foundChecked[j]["Value"] = MainRow["Value"];
                                foundChecked[j]["Logic"] = MainRow["Logic"];
                                foundChecked[j]["IsColor"] = true;
                                foundChecked[j]["IsUpdatedRow"] = true;


                                if (Convert.ToInt32(foundChecked[j]["Logic"]) == 307)
                                {
                                    if (foundChecked[j]["MaxCost_1"] == DBNull.Value)
                                    {
                                        foundChecked[j]["MaxCost_1"] = 0;
                                    }
                                    if (MainRow["Value"] == DBNull.Value)
                                    {
                                        MainRow["Value"] = 0;
                                    }
                                    foundChecked[j]["Common_Cur"] = Convert.ToDouble(foundChecked[j]["MaxCost_1"]) + (Convert.ToDouble(foundChecked[j]["MaxCost_1"]) * (Convert.ToDouble(foundChecked[j]["Value"]) / 100));

                                    foreach (Currency cur in SelectedSaleCurrency)
                                    {
                                        if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            if (foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != null && foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != "")
                                                foundChecked[j]["Common_Cur"] = Convert.ToDouble(foundChecked[j]["Common_Cur"]) * Convert.ToDouble(foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"]);
                                            else
                                                foundChecked[j]["Common_Cur"] = DBNull.Value;
                                        }
                                        else
                                        {
                                            if (foundChecked[j]["CurrencyConversionRate_" + cur.Name] != DBNull.Value && foundChecked[j]["CurrencyConversionRate_" + cur.Name] != null && foundChecked[j]["CurrencyConversionRate_" + cur.Name] != "")
                                                foundChecked[j][cur.Name] = Convert.ToDouble(foundChecked[j]["Common_Cur"]) * Convert.ToDouble(foundChecked[j]["CurrencyConversionRate_" + cur.Name]);
                                            else
                                                foundChecked[j][cur.Name] = DBNull.Value;
                                        }
                                    }
                                }

                                else if (Convert.ToInt32(foundChecked[j]["Logic"]) == 308)
                                {
                                    if (foundChecked[j]["Value"] == null || foundChecked[j]["Value"] == DBNull.Value)
                                    {
                                        foundChecked[j]["Value"] = DBNull.Value;

                                        foreach (Currency cur in SelectedSaleCurrency)
                                        {
                                            if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                foundChecked[j]["Common_Cur"] = DBNull.Value;
                                            }
                                            else
                                            {
                                                foundChecked[j][cur.Name] = DBNull.Value;
                                            }
                                        }
                                    }
                                    else if (foundChecked[j]["Value"] != null && Convert.ToDouble(foundChecked[j]["Value"]) <= 0)
                                    {
                                        foundChecked[j]["Value"] = DBNull.Value;

                                        foreach (Currency cur in SelectedSaleCurrency)
                                        {
                                            if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                foundChecked[j]["Common_Cur"] = DBNull.Value;
                                            }
                                            else
                                            {
                                                foundChecked[j][cur.Name] = DBNull.Value;
                                            }
                                        }
                                    }
                                    else
                                    {
                                        if (foundChecked[j]["MaxCost_1"] == DBNull.Value)
                                        {
                                            foundChecked[j]["MaxCost_1"] = 0;
                                        }
                                        if (MainRow["Value"] == DBNull.Value)
                                        {
                                            MainRow["Value"] = 0;
                                        }

                                        foundChecked[j]["Common_Cur"] = foundChecked[j]["Value"];

                                        foreach (Currency cur in SelectedSaleCurrency)
                                        {
                                            if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                if (foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != null && foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != "")
                                                    foundChecked[j]["Common_Cur"] = Convert.ToDouble(foundChecked[j]["Common_Cur"]) * Convert.ToDouble(foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"]);
                                                else
                                                    foundChecked[j]["Common_Cur"] = DBNull.Value;
                                            }
                                            else
                                            {
                                                if (foundChecked[j]["CurrencyConversionRate_" + cur.Name] != DBNull.Value && foundChecked[j]["CurrencyConversionRate_" + cur.Name] != null && foundChecked[j]["CurrencyConversionRate_" + cur.Name] != "")
                                                    foundChecked[j][cur.Name] = Convert.ToDouble(foundChecked[j]["Common_Cur"]) * Convert.ToDouble(foundChecked[j]["CurrencyConversionRate_" + cur.Name]);
                                                else
                                                    foundChecked[j][cur.Name] = DBNull.Value;
                                            }
                                        }
                                    }
                                }
                                else if (Convert.ToInt32(foundChecked[j]["Logic"]) == 1518)
                                {
                                    if (foundChecked[j]["Value"] == null || foundChecked[j]["Value"] == DBNull.Value)
                                    {
                                        foundChecked[j]["Value"] = 0;

                                        foreach (Currency cur in SelectedSaleCurrency)
                                        {
                                            if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                foundChecked[j]["Common_Cur"] = 0;
                                            }
                                            else
                                            {
                                                foundChecked[j][cur.Name] = 0;
                                            }
                                        }
                                    }
                                    else if (foundChecked[j]["Value"] != null && Convert.ToInt32(foundChecked[j]["Value"]) >= 0)
                                    {
                                        foundChecked[j]["Value"] = 0;

                                        foreach (Currency cur in SelectedSaleCurrency)
                                        {
                                            if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                foundChecked[j]["Common_Cur"] = 0;
                                            }
                                            else
                                            {
                                                foundChecked[j][cur.Name] = 0;
                                            }
                                        }
                                    }

                                }

                                else if (Convert.ToInt32(foundChecked[j]["Logic"]) == 309)
                                {
                                    if (foundChecked[j]["MaxCost_1"] == DBNull.Value)
                                    {
                                        foundChecked[j]["MaxCost_1"] = 0;
                                    }
                                    if (MainRow["Value"] == DBNull.Value)
                                    {
                                        MainRow["Value"] = 0;
                                    }
                                    foundChecked[j]["Common_Cur"] = Convert.ToDouble(foundChecked[j]["MaxCost_1"]) + (Convert.ToDouble(foundChecked[j]["Value"]));

                                    foreach (Currency cur in SelectedSaleCurrency)
                                    {
                                        if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            if (foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != null && foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != "")
                                                foundChecked[j]["Common_Cur"] = Convert.ToDouble(foundChecked[j]["Common_Cur"]) * Convert.ToDouble(foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"]);
                                            else
                                                foundChecked[j]["Common_Cur"] = DBNull.Value;
                                        }
                                        else
                                        {
                                            if (foundChecked[j]["CurrencyConversionRate_" + cur.Name] != DBNull.Value && foundChecked[j]["CurrencyConversionRate_" + cur.Name] != null && foundChecked[j]["CurrencyConversionRate_" + cur.Name] != "")
                                                foundChecked[j][cur.Name] = Convert.ToDouble(foundChecked[j]["Common_Cur"]) * Convert.ToDouble(foundChecked[j]["CurrencyConversionRate_" + cur.Name]);
                                            else
                                                foundChecked[j][cur.Name] = DBNull.Value;
                                        }
                                    }
                                }

                                if (foundChecked[j]["Common_Cur"] != DBNull.Value)
                                    SellPriceValue = Convert.ToDouble(foundChecked[j]["Common_Cur"]);

                                if (foundChecked[j]["MaxCost_1"] != DBNull.Value)
                                    MaxCost = Convert.ToDouble(foundChecked[j]["MaxCost_1"]);

                                foundChecked[j]["Profit"] = Convert.ToDouble(CalculateBasePriceProfitValue(MaxCost, SellPriceValue));
                                foundChecked[j]["CostMargin"] = Convert.ToDouble(CalculateBasePriceCostMarginValue(MaxCost, SellPriceValue));
                            }
                        }
                    }
                    else
                    {
                        DataRow Row = ((System.Data.DataRowView)((DevExpress.Xpf.Grid.RowEventArgs)obj).Row).Row;
                        Row["IsColor"] = true;
                        Row["IsUpdatedRow"] = true;

                        if (Convert.ToInt32(Row["Logic"]) == 307)
                        {
                            if (Row["MaxCost_1"] == DBNull.Value)
                            {
                                Row["MaxCost_1"] = 0;
                            }
                            if (MainRow["Value"] == DBNull.Value)
                            {
                                MainRow["Value"] = 0;
                            }
                            Row["Common_Cur"] = Convert.ToDouble(Row["MaxCost_1"]) + ((Convert.ToDouble(Row["MaxCost_1"]) * (Convert.ToDouble(Row["Value"]) / 100)));

                            foreach (Currency cur in SelectedSaleCurrency)
                            {
                                if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                {
                                    if (Row["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && Row["CurrencyConversionRate_" + "Common_Cur"] != null && Row["CurrencyConversionRate_" + "Common_Cur"] != "")
                                    {
                                        Row["Common_Cur"] = Convert.ToDouble(Row["Common_Cur"]) * Convert.ToDouble(Row["CurrencyConversionRate_" + "Common_Cur"]);
                                    }
                                    else
                                        Row["Common_Cur"] = DBNull.Value;
                                }
                                else
                                {
                                    if (Row["CurrencyConversionRate_" + cur.Name] != DBNull.Value && Row["CurrencyConversionRate_" + cur.Name] != null && Row["CurrencyConversionRate_" + cur.Name] != "")
                                    {
                                        Row[cur.Name] = Convert.ToDouble(Row["Common_Cur"]) * Convert.ToDouble(Row["CurrencyConversionRate_" + cur.Name]);
                                    }
                                    else
                                        Row[cur.Name] = DBNull.Value;
                                }
                            }
                        }
                        else if (Convert.ToInt32(Row["Logic"]) == 308)
                        {
                            if (Row["Value"] == null || Row["Value"] == DBNull.Value)
                            {
                                Row["Value"] = DBNull.Value;

                                foreach (Currency cur in SelectedSaleCurrency)
                                {
                                    if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        Row["Common_Cur"] = DBNull.Value;
                                    else
                                        Row[cur.Name] = DBNull.Value;
                                }
                            }
                            else if (Row["Value"] != null && Convert.ToDouble(Row["Value"]) <= 0)
                            {
                                Row["Value"] = DBNull.Value;

                                foreach (Currency cur in SelectedSaleCurrency)
                                {
                                    if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        Row["Common_Cur"] = DBNull.Value;
                                    else
                                        Row[cur.Name] = DBNull.Value;
                                }
                            }
                            else
                            {

                                if (Row["MaxCost_1"] == DBNull.Value)
                                {
                                    Row["MaxCost_1"] = 0;
                                }
                                if (MainRow["Value"] == DBNull.Value)
                                {
                                    MainRow["Value"] = 0;
                                }

                                Row["Common_Cur"] = Row["Value"];
                                foreach (Currency cur in SelectedSaleCurrency)
                                {
                                    if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                    {
                                        if (Row["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && Row["CurrencyConversionRate_" + "Common_Cur"] != null && Row["CurrencyConversionRate_" + "Common_Cur"] != "")
                                        {
                                            Row["Common_Cur"] = Convert.ToDouble(Row["Common_Cur"]) * Convert.ToDouble(Row["CurrencyConversionRate_" + "Common_Cur"]);
                                        }
                                        else
                                            Row["Common_Cur"] = DBNull.Value;
                                    }
                                    else
                                    {
                                        if (Row["CurrencyConversionRate_" + cur.Name] != DBNull.Value && Row["CurrencyConversionRate_" + cur.Name] != null && Row["CurrencyConversionRate_" + cur.Name] != "")
                                        {
                                            Row[cur.Name] = Convert.ToDouble(Row["Common_Cur"]) * Convert.ToDouble(Row["CurrencyConversionRate_" + cur.Name]);
                                        }
                                        else
                                            Row[cur.Name] = DBNull.Value;
                                    }
                                }
                            }
                        }
                        else if (Convert.ToInt32(Row["Logic"]) == 1518)
                        {
                            if (Row["Value"] == null || Row["Value"] == DBNull.Value)
                            {
                                Row["Value"] = 0;

                                foreach (Currency cur in SelectedSaleCurrency)
                                {
                                    if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        Row["Common_Cur"] = 0;
                                    else
                                        Row[cur.Name] = 0;
                                }
                            }
                            else if (Row["Value"] != null)
                            {
                                Row["Value"] = 0;

                                foreach (Currency cur in SelectedSaleCurrency)
                                {
                                    if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        Row["Common_Cur"] = 0;
                                    else
                                        Row[cur.Name] = 0;
                                }
                            }
                        }

                        else if (Convert.ToInt32(Row["Logic"]) == 309)
                        {
                            if (Row["MaxCost_1"] == DBNull.Value)
                            {
                                Row["MaxCost_1"] = 0;
                            }
                            if (MainRow["Value"] == DBNull.Value)
                            {
                                MainRow["Value"] = 0;
                            }
                            Row["Common_Cur"] = Convert.ToDouble(Row["MaxCost_1"]) + (Convert.ToDouble(Row["Value"]));

                            foreach (Currency cur in SelectedSaleCurrency)
                            {
                                if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                {
                                    if (Row["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && Row["CurrencyConversionRate_" + "Common_Cur"] != null && Row["CurrencyConversionRate_" + "Common_Cur"] != "")
                                    {
                                        Row["Common_Cur"] = Convert.ToDouble(Row["Common_Cur"]) * Convert.ToDouble(Row["CurrencyConversionRate_" + "Common_Cur"]);
                                    }
                                    else
                                        Row["Common_Cur"] = DBNull.Value;
                                }
                                else
                                {
                                    if (Row["CurrencyConversionRate_" + cur.Name] != DBNull.Value && Row["CurrencyConversionRate_" + cur.Name] != null && Row["CurrencyConversionRate_" + cur.Name] != "")
                                    {
                                        Row[cur.Name] = Convert.ToDouble(Row["Common_Cur"]) * Convert.ToDouble(Row["CurrencyConversionRate_" + cur.Name]);
                                    }
                                    else
                                        Row[cur.Name] = DBNull.Value;
                                }
                            }
                        }
                        if (Row["Common_Cur"] != DBNull.Value)
                            SellPriceValue = Convert.ToDouble(Row["Common_Cur"]);

                        if (Row["MaxCost_1"] != DBNull.Value)
                            MaxCost = Convert.ToDouble(Row["MaxCost_1"]);

                        Row["Profit"] = Convert.ToDouble(CalculateBasePriceProfitValue(MaxCost, SellPriceValue));
                        Row["CostMargin"] = Convert.ToDouble(CalculateBasePriceCostMarginValue(MaxCost, SellPriceValue));
                    }
                    DtArticle.AcceptChanges();
                    if (!isDuplicateCliked) IsEnabledSaveButton = true;
                }
                GeosApplication.Instance.Logger.Log("Method RuleValueChangedCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method RuleValueChangedCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        private void RuleValueDetectionChangedCommandAction(object obj)
        {
            try
            {
                if (obj == null)
                    return;

                double MaxCost = 0.00;
                double SellPriceValue = 0.00;

                GeosApplication.Instance.Logger.Log("Method RuleValueDetectionChangedCommandAction()....", category: Category.Info, priority: Priority.Low);

                if (((DevExpress.Xpf.Grid.CellValueEventArgs)obj).Column.FieldName == "Value" || ((DevExpress.Xpf.Grid.CellValueEventArgs)obj).Column.FieldName == "Logic" || ((DevExpress.Xpf.Grid.CellValueEventArgs)obj).Column.FieldName.Contains("_1"))
                {
                    IsCalculateArticleCostButtonEnabled = true;
                    IsCalculated = false;
                    DataColumn[] columns = DtDetectionCopy.Columns.Cast<DataColumn>().ToArray();
                    DataRow[] foundChecked = DtDetectionCopy.AsEnumerable().Where(row => columns.Any(col => row["IsChecked"].ToString() == "True")).ToArray();

                    DataRow MainRow = ((System.Data.DataRowView)((DevExpress.Xpf.Grid.RowEventArgs)obj).Row).Row;

                    if (foundChecked.Length > 0 && MainRow["IsChecked"].ToString() != "False")
                    {
                        for (int j = 0; j < foundChecked.Length; j++)
                        {
                            foundChecked[j].BeginEdit();

                            if (((DevExpress.Xpf.Grid.CellValueEventArgs)obj).Column.FieldName.Contains("_1"))
                            {
                                if (MainRow["MaxCost_1"] == DBNull.Value)
                                {
                                    MainRow["MaxCost_1"] = 0;
                                }
                                foundChecked[j]["MaxCost_1"] = MainRow["MaxCost_1"];
                            }
                            else
                            {
                                if (foundChecked[j]["MaxCost_1"] == DBNull.Value)
                                {
                                    foundChecked[j]["MaxCost_1"] = 0;
                                }
                            }
                            if (((DevExpress.Xpf.Grid.CellValueEventArgs)obj).Column.FieldName == "Value")
                            {
                                if (MainRow["Value"] == DBNull.Value)
                                {
                                    MainRow["Value"] = 0;
                                }
                                foundChecked[j]["Value"] = MainRow["Value"];
                            }
                            else
                            {
                                if (foundChecked[j]["Value"] == DBNull.Value)
                                {
                                    foundChecked[j]["Value"] = 0;
                                }
                            }

                            if (((DevExpress.Xpf.Grid.CellValueEventArgs)obj).Column.FieldName == "Logic")
                            {
                                if (MainRow["Logic"] == DBNull.Value)
                                {
                                    MainRow["Logic"] = 308;
                                }
                                foundChecked[j]["Logic"] = MainRow["Logic"];
                            }
                            else
                            {
                                if (foundChecked[j]["Logic"] == DBNull.Value)
                                {
                                    foundChecked[j]["Logic"] = 308;
                                }
                            }

                            if (MainRow["IsChecked"].ToString() != "False")
                            {
                                foundChecked[j]["IsColor"] = true;
                                foundChecked[j]["IsUpdatedRow"] = true;

                                if (Convert.ToInt32(foundChecked[j]["Logic"]) == 307)
                                {
                                    foundChecked[j]["Common_Cur"] = Convert.ToDouble(foundChecked[j]["MaxCost_1"]) + (Convert.ToDouble(foundChecked[j]["MaxCost_1"]) * (Convert.ToDouble(foundChecked[j]["Value"]) / 100));

                                    foreach (Currency cur in SelectedSaleCurrency)
                                    {
                                        if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            if (foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != null && foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != "")
                                                foundChecked[j]["Common_Cur"] = Convert.ToDouble(foundChecked[j]["Common_Cur"]) * Convert.ToDouble(foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"]);
                                            else
                                                foundChecked[j]["Common_Cur"] = DBNull.Value;
                                        }
                                        else
                                        {
                                            if (foundChecked[j]["CurrencyConversionRate_" + cur.Name] != DBNull.Value && foundChecked[j]["CurrencyConversionRate_" + cur.Name] != null && foundChecked[j]["CurrencyConversionRate_" + cur.Name] != "")
                                                foundChecked[j][cur.Name] = Convert.ToDouble(foundChecked[j]["Common_Cur"]) * Convert.ToDouble(foundChecked[j]["CurrencyConversionRate_" + cur.Name]);
                                            else
                                                foundChecked[j][cur.Name] = DBNull.Value;
                                        }
                                    }

                                }

                                else if (Convert.ToInt32(foundChecked[j]["Logic"]) == 308)
                                {
                                    if (foundChecked[j]["Value"] == null || foundChecked[j]["Value"] == DBNull.Value)
                                    {
                                        foundChecked[j]["Value"] = DBNull.Value;

                                        foreach (Currency cur in SelectedSaleCurrency)
                                        {
                                            if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                foundChecked[j]["Common_Cur"] = DBNull.Value;
                                            }
                                            else
                                            {
                                                foundChecked[j][cur.Name] = DBNull.Value;
                                            }
                                        }
                                    }
                                    else if (foundChecked[j]["Value"] != null && Convert.ToDouble(foundChecked[j]["Value"]) <= 0)
                                    {
                                        foundChecked[j]["Value"] = DBNull.Value;

                                        foreach (Currency cur in SelectedSaleCurrency)
                                        {
                                            if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                foundChecked[j]["Common_Cur"] = DBNull.Value;
                                            }
                                            else
                                            {
                                                foundChecked[j][cur.Name] = DBNull.Value;
                                            }
                                        }
                                    }
                                    else
                                    {
                                        foundChecked[j]["Common_Cur"] = foundChecked[j]["Value"];

                                        foreach (Currency cur in SelectedSaleCurrency)
                                        {
                                            if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                if (foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != null && foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != "")
                                                    foundChecked[j]["Common_Cur"] = Convert.ToDouble(foundChecked[j]["Common_Cur"]) * Convert.ToDouble(foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"]);
                                                else
                                                    foundChecked[j]["Common_Cur"] = DBNull.Value;
                                            }
                                            else
                                            {
                                                if (foundChecked[j]["CurrencyConversionRate_" + cur.Name] != DBNull.Value && foundChecked[j]["CurrencyConversionRate_" + cur.Name] != null && foundChecked[j]["CurrencyConversionRate_" + cur.Name] != "")
                                                    foundChecked[j][cur.Name] = Convert.ToDouble(foundChecked[j]["Common_Cur"]) * Convert.ToDouble(foundChecked[j]["CurrencyConversionRate_" + cur.Name]);
                                                else
                                                    foundChecked[j][cur.Name] = DBNull.Value;
                                            }
                                        }
                                    }
                                }
                                else if (Convert.ToInt32(foundChecked[j]["Logic"]) == 1518)
                                {


                                    if (foundChecked[j]["Value"] == null || foundChecked[j]["Value"] == DBNull.Value)
                                    {
                                        foundChecked[j]["Value"] = 0;

                                        foreach (Currency cur in SelectedSaleCurrency)
                                        {
                                            if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                foundChecked[j]["Common_Cur"] = 0;
                                            }
                                            else
                                            {
                                                foundChecked[j][cur.Name] = 0;
                                            }
                                        }
                                    }
                                    else if (foundChecked[j]["Value"] != null)
                                    {
                                        foundChecked[j]["Value"] = 0;

                                        foreach (Currency cur in SelectedSaleCurrency)
                                        {
                                            if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                foundChecked[j]["Common_Cur"] = 0;
                                            }
                                            else
                                            {
                                                foundChecked[j][cur.Name] = 0;
                                            }
                                        }
                                    }

                                }

                                else if (Convert.ToInt32(foundChecked[j]["Logic"]) == 309)
                                {
                                    foundChecked[j]["Common_Cur"] = Convert.ToDouble(foundChecked[j]["MaxCost_1"]) + (Convert.ToDouble(foundChecked[j]["Value"]));

                                    foreach (Currency cur in SelectedSaleCurrency)
                                    {
                                        if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            if (foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != null && foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != "")
                                                foundChecked[j]["Common_Cur"] = Convert.ToDouble(foundChecked[j]["Common_Cur"]) * Convert.ToDouble(foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"]);
                                            else
                                                foundChecked[j]["Common_Cur"] = DBNull.Value;
                                        }
                                        else
                                        {
                                            if (foundChecked[j]["CurrencyConversionRate_" + cur.Name] != DBNull.Value && foundChecked[j]["CurrencyConversionRate_" + cur.Name] != null && foundChecked[j]["CurrencyConversionRate_" + cur.Name] != "")
                                                foundChecked[j][cur.Name] = Convert.ToDouble(foundChecked[j]["Common_Cur"]) * Convert.ToDouble(foundChecked[j]["CurrencyConversionRate_" + cur.Name]);
                                            else
                                                foundChecked[j][cur.Name] = DBNull.Value;
                                        }
                                    }
                                }

                                if (foundChecked[j]["Common_Cur"] != DBNull.Value)
                                    SellPriceValue = Convert.ToDouble(foundChecked[j]["Common_Cur"]);

                                if (foundChecked[j]["MaxCost_1"] != DBNull.Value)
                                    MaxCost = Convert.ToDouble(foundChecked[j]["MaxCost_1"]);

                                foundChecked[j]["Profit"] = Convert.ToDouble(CalculateBasePriceProfitValue(MaxCost, SellPriceValue));
                                foundChecked[j]["CostMargin"] = Convert.ToDouble(CalculateBasePriceCostMarginValue(MaxCost, SellPriceValue));
                            }
                        }
                    }
                    else
                    {
                        DataRow Row = ((System.Data.DataRowView)((DevExpress.Xpf.Grid.RowEventArgs)obj).Row).Row;
                        Row["IsColor"] = true;
                        Row["IsUpdatedRow"] = true;

                        if (Row["MaxCost_1"] == DBNull.Value)
                        {
                            Row["MaxCost_1"] = 0;
                        }
                        if (Row["Value"] == DBNull.Value)
                        {
                            Row["Value"] = 0;
                        }

                        if (Row["Logic"] == DBNull.Value)
                        {
                            Row["Logic"] = 308;
                        }

                        if (Convert.ToInt32(Row["Logic"]) == 307)
                        {
                            Row["Common_Cur"] = Convert.ToDouble(Row["MaxCost_1"]) + ((Convert.ToDouble(Row["MaxCost_1"]) * (Convert.ToDouble(Row["Value"]) / 100)));

                            foreach (Currency cur in SelectedSaleCurrency)
                            {
                                if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                {
                                    if (Row["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && Row["CurrencyConversionRate_" + "Common_Cur"] != null && Row["CurrencyConversionRate_" + "Common_Cur"] != "")
                                    {
                                        Row["Common_Cur"] = Convert.ToDouble(Row["Common_Cur"]) * Convert.ToDouble(Row["CurrencyConversionRate_" + "Common_Cur"]);
                                    }
                                    else
                                        Row["Common_Cur"] = DBNull.Value;
                                }
                                else
                                {
                                    if (Row["CurrencyConversionRate_" + cur.Name] != DBNull.Value && Row["CurrencyConversionRate_" + cur.Name] != null && Row["CurrencyConversionRate_" + cur.Name] != "")
                                    {
                                        Row[cur.Name] = Convert.ToDouble(Row["Common_Cur"]) * Convert.ToDouble(Row["CurrencyConversionRate_" + cur.Name]);
                                    }
                                    else
                                        Row[cur.Name] = DBNull.Value;
                                }
                            }
                        }
                        else if (Convert.ToInt32(Row["Logic"]) == 308)
                        {
                            if (Row["Value"] == null || Row["Value"] == DBNull.Value)
                            {
                                Row["Value"] = DBNull.Value;

                                foreach (Currency cur in SelectedSaleCurrency)
                                {
                                    if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        Row["Common_Cur"] = DBNull.Value;
                                    else
                                        Row[cur.Name] = DBNull.Value;
                                }
                            }
                            else if (Row["Value"] != null && Convert.ToDouble(Row["Value"]) <= 0)
                            {
                                Row["Value"] = DBNull.Value;

                                foreach (Currency cur in SelectedSaleCurrency)
                                {
                                    if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        Row["Common_Cur"] = DBNull.Value;
                                    else
                                        Row[cur.Name] = DBNull.Value;
                                }
                            }
                            else
                            {
                                Row["Common_Cur"] = Row["Value"];
                                foreach (Currency cur in SelectedSaleCurrency)
                                {
                                    if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                    {
                                        if (Row["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && Row["CurrencyConversionRate_" + "Common_Cur"] != null && Row["CurrencyConversionRate_" + "Common_Cur"] != "")
                                        {
                                            Row["Common_Cur"] = Convert.ToDouble(Row["Common_Cur"]) * Convert.ToDouble(Row["CurrencyConversionRate_" + "Common_Cur"]);
                                        }
                                        else
                                            Row["Common_Cur"] = DBNull.Value;
                                    }
                                    else
                                    {
                                        if (Row["CurrencyConversionRate_" + cur.Name] != DBNull.Value && Row["CurrencyConversionRate_" + cur.Name] != null && Row["CurrencyConversionRate_" + cur.Name] != "")
                                        {
                                            Row[cur.Name] = Convert.ToDouble(Row["Common_Cur"]) * Convert.ToDouble(Row["CurrencyConversionRate_" + cur.Name]);
                                        }
                                        else
                                            Row[cur.Name] = DBNull.Value;
                                    }
                                }
                            }
                        }
                        else if (Convert.ToInt32(Row["Logic"]) == 1518)
                        {

                            if (Row["Value"] == null || Row["Value"] == DBNull.Value)
                            {
                                Row["Value"] = 0;

                                foreach (Currency cur in SelectedSaleCurrency)
                                {
                                    if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        Row["Common_Cur"] = 0;
                                    else
                                        Row[cur.Name] = 0;
                                }
                            }
                            else if (Row["Value"] != null)
                            {
                                Row["Value"] = 0;

                                foreach (Currency cur in SelectedSaleCurrency)
                                {
                                    if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        Row["Common_Cur"] = 0;
                                    else
                                        Row[cur.Name] = 0;
                                }
                            }

                        }
                        else if (Convert.ToInt32(Row["Logic"]) == 309)
                        {
                            Row["Common_Cur"] = Convert.ToDouble(Row["MaxCost_1"]) + (Convert.ToDouble(Row["Value"]));

                            foreach (Currency cur in SelectedSaleCurrency)
                            {
                                if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                {
                                    if (Row["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && Row["CurrencyConversionRate_" + "Common_Cur"] != null && Row["CurrencyConversionRate_" + "Common_Cur"] != "")
                                    {
                                        Row["Common_Cur"] = Convert.ToDouble(Row["Common_Cur"]) * Convert.ToDouble(Row["CurrencyConversionRate_" + "Common_Cur"]);
                                    }
                                    else
                                        Row["Common_Cur"] = DBNull.Value;
                                }
                                else
                                {
                                    if (Row["CurrencyConversionRate_" + cur.Name] != DBNull.Value && Row["CurrencyConversionRate_" + cur.Name] != null && Row["CurrencyConversionRate_" + cur.Name] != "")
                                    {
                                        Row[cur.Name] = Convert.ToDouble(Row["Common_Cur"]) * Convert.ToDouble(Row["CurrencyConversionRate_" + cur.Name]);
                                    }
                                    else
                                        Row[cur.Name] = DBNull.Value;
                                }
                            }
                        }
                        if (Row["Common_Cur"] != DBNull.Value)
                            SellPriceValue = Convert.ToDouble(Row["Common_Cur"]);

                        if (Row["MaxCost_1"] != DBNull.Value)
                            MaxCost = Convert.ToDouble(Row["MaxCost_1"]);

                        Row["Profit"] = Convert.ToDouble(CalculateBasePriceProfitValue(MaxCost, SellPriceValue));
                        Row["CostMargin"] = Convert.ToDouble(CalculateBasePriceCostMarginValue(MaxCost, SellPriceValue));
                    }
                    DtDetection.AcceptChanges();
                    if (!isDuplicateCliked) IsEnabledSaveButton = true;
                }

                GeosApplication.Instance.Logger.Log("Method RuleValueDetectionChangedCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method RuleValueDetectionChangedCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void AddChangedLogsDetails()
        {
            GeosApplication.Instance.Logger.Log("Method AddChangedLogsDetails ...", category: Category.Info, priority: Priority.Low);
            try
            {
                if (ChangedLogsEntries == null)
                    ChangedLogsEntries = new List<BasePriceLogEntry>();

                UpdatedItem.Name = UpdatedItem.Name.Trim();
                //for Name
                if (ClonedBasePrice.Name != UpdatedItem.Name)
                {
                    if (string.IsNullOrEmpty(UpdatedItem.Name))
                        ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogName").ToString(), ClonedBasePrice.Name, "None") });
                    else
                    {
                        if (string.IsNullOrEmpty(ClonedBasePrice.Name))
                            ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogName").ToString(), "None", Name) });
                        else
                            ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogName").ToString(), ClonedBasePrice.Name, UpdatedItem.Name) });
                    }
                }
                UpdatedItem.Name_es = UpdatedItem.Name_es.Trim();
                if (ClonedBasePrice.Name_es != UpdatedItem.Name_es)
                {
                    if (string.IsNullOrEmpty(UpdatedItem.Name_es))
                        ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogNameES").ToString(), ClonedBasePrice.Name_es, "None") });
                    else
                    {
                        if (string.IsNullOrEmpty(ClonedBasePrice.Name_es))
                            ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogNameES").ToString(), "None", UpdatedItem.Name_es) });
                        else
                            ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogNameES").ToString(), ClonedBasePrice.Name_es, UpdatedItem.Name_es) });
                    }
                }
                UpdatedItem.Name_fr = UpdatedItem.Name_fr.Trim();
                if (ClonedBasePrice.Name_fr != UpdatedItem.Name_fr)
                {
                    if (string.IsNullOrEmpty(UpdatedItem.Name_fr))
                        ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogNameFR").ToString(), ClonedBasePrice.Name_fr, "None") });
                    else
                    {
                        if (string.IsNullOrEmpty(ClonedBasePrice.Name_fr))
                            ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogNameFR").ToString(), "None", UpdatedItem.Name_fr) });
                        else
                            ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogNameFR").ToString(), ClonedBasePrice.Name_fr, UpdatedItem.Name_fr) });
                    }
                }
                UpdatedItem.Name_pt = UpdatedItem.Name_pt.Trim();
                if (ClonedBasePrice.Name_pt != UpdatedItem.Name_pt)
                {
                    if (string.IsNullOrEmpty(UpdatedItem.Name_pt))
                        ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogNamePT").ToString(), ClonedBasePrice.Name_pt, "None") });
                    else
                    {
                        if (string.IsNullOrEmpty(ClonedBasePrice.Name_pt))
                            ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogNamePT").ToString(), "None", UpdatedItem.Name_pt) });
                        else
                            ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogNamePT").ToString(), ClonedBasePrice.Name_pt, UpdatedItem.Name_pt) });
                    }
                }
                UpdatedItem.Name_ro = UpdatedItem.Name_ro.Trim();
                if (ClonedBasePrice.Name_ro != UpdatedItem.Name_ro)
                {
                    if (string.IsNullOrEmpty(UpdatedItem.Name_ro))
                        ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogNameRO").ToString(), ClonedBasePrice.Name_ro, "None") });
                    else
                    {
                        if (string.IsNullOrEmpty(ClonedBasePrice.Name_ro))
                            ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogNameRO").ToString(), "None", UpdatedItem.Name_ro) });
                        else
                            ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogNameRO").ToString(), ClonedBasePrice.Name_ro, UpdatedItem.Name_ro) });
                    }
                }
                UpdatedItem.Name_ru = UpdatedItem.Name_ru.Trim();
                if (ClonedBasePrice.Name_ru != UpdatedItem.Name_ru)
                {
                    if (string.IsNullOrEmpty(UpdatedItem.Name_ru))
                        ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogNameRU").ToString(), ClonedBasePrice.Name_ru, "None") });
                    else
                    {
                        if (string.IsNullOrEmpty(Name_ru))
                            ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogNameRU").ToString(), "None", UpdatedItem.Name_ru) });
                        else
                            ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogNameRU").ToString(), ClonedBasePrice.Name_ru, UpdatedItem.Name_ru) });
                    }
                }
                UpdatedItem.Name_zh = UpdatedItem.Name_zh.Trim();
                if (ClonedBasePrice.Name_zh != UpdatedItem.Name_zh)
                {
                    if (string.IsNullOrEmpty(UpdatedItem.Name_zh))
                        ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogNameZH").ToString(), ClonedBasePrice.Name_zh, "None") });
                    else
                    {
                        if (string.IsNullOrEmpty(ClonedBasePrice.Name_zh))
                            ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogNameZH").ToString(), "None", UpdatedItem.Name_zh) });
                        else
                            ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogNameZH").ToString(), ClonedBasePrice.Name_zh, UpdatedItem.Name_zh) });
                    }
                }

                //For Exchange Rate
                if (ClonedBasePrice.ExchangeRateUpdateType.IdLookupValue != UpdatedItem.IdExchangeRateUpdateType)
                {
                    LookupValue tempExchangeRate = ExchangeRateList.FirstOrDefault(x => x.IdLookupValue == UpdatedItem.IdExchangeRateUpdateType);
                    if (tempExchangeRate != null)
                        ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogExchangeRate").ToString(), ClonedBasePrice.ExchangeRateUpdateType.Value, tempExchangeRate.Value) });
                }

                //for Description
                UpdatedItem.Description = UpdatedItem.Description.Trim();
                if (ClonedBasePrice.Description != UpdatedItem.Description)
                {
                    if (string.IsNullOrEmpty(UpdatedItem.Description))
                        ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogDescription").ToString(), ClonedBasePrice.Description, "None") });
                    else
                    {
                        if (string.IsNullOrEmpty(ClonedBasePrice.Description))
                            ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogDescription").ToString(), "None", UpdatedItem.Description) });
                        else
                            ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogDescription").ToString(), ClonedBasePrice.Description, UpdatedItem.Description) });
                    }
                }
                UpdatedItem.Description_es = UpdatedItem.Description_es.Trim();
                if (ClonedBasePrice.Description_es != UpdatedItem.Description_es)
                {
                    if (string.IsNullOrEmpty(UpdatedItem.Description_es))
                        ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogDescriptionES").ToString(), ClonedBasePrice.Description_es, "None") });
                    else
                    {
                        if (string.IsNullOrEmpty(ClonedBasePrice.Description_es))
                            ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogDescriptionES").ToString(), "None", UpdatedItem.Description_es) });
                        else
                            ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogDescriptionES").ToString(), ClonedBasePrice.Description_es, UpdatedItem.Description_es) });
                    }
                }
                UpdatedItem.Description_fr = UpdatedItem.Description_fr.Trim();
                if (ClonedBasePrice.Description_fr != UpdatedItem.Description_fr)
                {
                    if (string.IsNullOrEmpty(UpdatedItem.Description_fr))
                        ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogDescriptionFR").ToString(), ClonedBasePrice.Description_es, "None") });
                    else
                    {
                        if (string.IsNullOrEmpty(ClonedBasePrice.Description_fr))
                            ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogDescriptionFR").ToString(), "None", UpdatedItem.Description_fr) });
                        else
                            ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogDescriptionFR").ToString(), ClonedBasePrice.Description_fr, UpdatedItem.Description_fr) });
                    }
                }
                UpdatedItem.Description_pt = UpdatedItem.Description_pt.Trim();
                if (ClonedBasePrice.Description_pt != UpdatedItem.Description_pt)
                {
                    if (string.IsNullOrEmpty(UpdatedItem.Description_pt))
                        ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("ProductTypeChangeLogDescriptionPT").ToString(), ClonedBasePrice.Description_pt, "None") });
                    else
                    {
                        if (string.IsNullOrEmpty(ClonedBasePrice.Description_pt))
                            ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogDescriptionPT").ToString(), "None", UpdatedItem.Description_pt) });
                        else
                            ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogDescriptionPT").ToString(), ClonedBasePrice.Description_pt, UpdatedItem.Description_pt) });
                    }
                }
                UpdatedItem.Description_ro = UpdatedItem.Description_ro.Trim();
                if (ClonedBasePrice.Description_ro != UpdatedItem.Description_ro)
                {
                    if (string.IsNullOrEmpty(UpdatedItem.Description_ro))
                        ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogDescriptionRO").ToString(), ClonedBasePrice.Description_ro, "None") });
                    else
                    {
                        if (string.IsNullOrEmpty(ClonedBasePrice.Description_ro))
                            ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogDescriptionRO").ToString(), "None", UpdatedItem.Description_ro) });
                        else
                            ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogDescriptionRO").ToString(), ClonedBasePrice.Description_ro, UpdatedItem.Description_ro) });
                    }
                }
                UpdatedItem.Description_ru = UpdatedItem.Description_ru.Trim();
                if (ClonedBasePrice.Description_ru != UpdatedItem.Description_ru)
                {
                    if (string.IsNullOrEmpty(UpdatedItem.Description_ru))
                        ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogDescriptionRU").ToString(), ClonedBasePrice.Description_ru, "None") });
                    else
                    {
                        if (string.IsNullOrEmpty(ClonedBasePrice.Description_ru))
                            ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogDescriptionRU").ToString(), "None", UpdatedItem.Description_ru) });
                        else
                            ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogDescriptionRU").ToString(), ClonedBasePrice.Description_ru, UpdatedItem.Description_ru) });
                    }
                }
                UpdatedItem.Description_zh = UpdatedItem.Description_zh.Trim();
                if (ClonedBasePrice.Description_zh != UpdatedItem.Description_zh)
                {
                    if (string.IsNullOrEmpty(UpdatedItem.Description_zh))
                        ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogDescriptionZH").ToString(), ClonedBasePrice.Description_ru, "None") });
                    else
                    {
                        if (string.IsNullOrEmpty(ClonedBasePrice.Description_zh))
                            ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogDescriptionZH").ToString(), "None", UpdatedItem.Description_zh) });
                        else
                            ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogDescriptionZH").ToString(), ClonedBasePrice.Description_zh, UpdatedItem.Description_zh) });
                    }
                }

                //for Remark
                UpdatedItem.Remark = UpdatedItem.Remark.Trim();
                if (ClonedBasePrice.Remark != UpdatedItem.Remark)
                {
                    if (string.IsNullOrEmpty(UpdatedItem.Remark))
                        ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogRemark").ToString(), ClonedBasePrice.Remark, "None") });
                    else
                    {
                        if (string.IsNullOrEmpty(ClonedBasePrice.Remark))
                            ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogRemark").ToString(), "None", UpdatedItem.Remark) });
                        else
                            ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogRemark").ToString(), ClonedBasePrice.Remark, UpdatedItem.Remark) });
                    }
                }
                UpdatedItem.Remark_es = UpdatedItem.Remark_es.Trim();
                if (ClonedBasePrice.Remark_es != UpdatedItem.Remark_es)
                {
                    if (string.IsNullOrEmpty(UpdatedItem.Remark_es))
                        ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogRemarkES").ToString(), ClonedBasePrice.Remark_es, "None") });
                    else
                    {
                        if (string.IsNullOrEmpty(ClonedBasePrice.Remark_es))
                            ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogRemarkES").ToString(), "None", UpdatedItem.Remark_es) });
                        else
                            ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogRemarkES").ToString(), ClonedBasePrice.Remark_es, UpdatedItem.Remark_es) });
                    }
                }
                UpdatedItem.Remark_fr = UpdatedItem.Remark_fr.Trim();
                if (ClonedBasePrice.Remark_fr != UpdatedItem.Remark_fr)
                {
                    if (string.IsNullOrEmpty(UpdatedItem.Remark_fr))
                        ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogRemarkFR").ToString(), ClonedBasePrice.Remark_fr, "None") });
                    else
                    {
                        if (string.IsNullOrEmpty(ClonedBasePrice.Remark_fr))
                            ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogRemarkFR").ToString(), "None", UpdatedItem.Remark_fr) });
                        else
                            ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogRemarkFR").ToString(), ClonedBasePrice.Remark_fr, UpdatedItem.Remark_fr) });
                    }
                }
                UpdatedItem.Remark_pt = UpdatedItem.Remark_pt.Trim();
                if (ClonedBasePrice.Remark_pt != UpdatedItem.Remark_pt)
                {
                    if (string.IsNullOrEmpty(UpdatedItem.Remark_pt))
                        ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogRemarkPT").ToString(), ClonedBasePrice.Remark_pt, "None") });
                    else
                    {
                        if (string.IsNullOrEmpty(ClonedBasePrice.Remark_pt))
                            ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogRemarkPT").ToString(), "None", UpdatedItem.Remark_pt) });
                        else
                            ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogRemarkPT").ToString(), ClonedBasePrice.Remark_pt, UpdatedItem.Remark_pt) });
                    }
                }
                UpdatedItem.Remark_ro = UpdatedItem.Remark_ro.Trim();
                if (ClonedBasePrice.Remark_ro != UpdatedItem.Remark_ro)
                {
                    if (string.IsNullOrEmpty(UpdatedItem.Remark_ro))
                        ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogRemarkRO").ToString(), ClonedBasePrice.Remark_ro, "None") });
                    else
                    {
                        if (string.IsNullOrEmpty(ClonedBasePrice.Remark_ro))
                            ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogRemarkRO").ToString(), "None", UpdatedItem.Remark_ro) });
                        else
                            ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogRemarkRO").ToString(), ClonedBasePrice.Remark_ro, UpdatedItem.Remark_ro) });
                    }
                }
                UpdatedItem.Remark_ru = UpdatedItem.Remark_ru.Trim();
                if (ClonedBasePrice.Remark_ru != UpdatedItem.Remark_ru)
                {
                    if (string.IsNullOrEmpty(UpdatedItem.Remark_ru))
                        ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogRemarkRU").ToString(), ClonedBasePrice.Remark_ru, "None") });
                    else
                    {
                        if (string.IsNullOrEmpty(ClonedBasePrice.Remark_ru))
                            ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogRemarkRU").ToString(), "None", UpdatedItem.Remark_ru) });
                        else
                            ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogRemarkRU").ToString(), ClonedBasePrice.Remark_ru, UpdatedItem.Remark_ru) });
                    }
                }
                UpdatedItem.Remark_zh = UpdatedItem.Remark_zh.Trim();
                if (ClonedBasePrice.Remark_zh != UpdatedItem.Remark_zh)
                {
                    if (string.IsNullOrEmpty(UpdatedItem.Remark_zh))
                        ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogRemarkZH").ToString(), ClonedBasePrice.Remark_zh, "None") });
                    else
                    {
                        if (string.IsNullOrEmpty(ClonedBasePrice.Remark_zh))
                            ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogRemarkZH").ToString(), "None", UpdatedItem.Remark_zh) });
                        else
                            ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogRemarkZH").ToString(), ClonedBasePrice.Remark_zh, UpdatedItem.Remark_zh) });
                    }
                }



                //for Effective Date
                if (ClonedBasePrice.EffectiveDate != UpdatedItem.EffectiveDate)
                {
                    ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogEffectiveDate").ToString(), ClonedBasePrice.EffectiveDate.ToShortDateString(), UpdatedItem.EffectiveDate.ToShortDateString()) });
                }

                //for  Expiry Date
                if (ClonedBasePrice.ExpiryDate != UpdatedItem.ExpiryDate)
                {
                    ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogExpiryDate").ToString(), ClonedBasePrice.ExpiryDate.ToShortDateString(), UpdatedItem.ExpiryDate.ToShortDateString()) });
                }

                //Status
                if (ClonedBasePrice.Status.IdLookupValue != UpdatedItem.IdStatus)
                {
                    LookupValue tempStatus = StatusList.FirstOrDefault(x => x.IdLookupValue == UpdatedItem.IdStatus);
                    if (tempStatus != null)
                        ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogStatus").ToString(), ClonedBasePrice.Status.Value, tempStatus.Value) });
                }


                //For currency
                if (ClonedBasePrice.Currency.IdCurrency != UpdatedItem.IdCurrency)
                {
                    ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogCurrency").ToString(), ClonedBasePrice.Currency.Name, UpdatedItem.Currency.Name) });
                }
                //atttachment


                GeosApplication.Instance.Logger.Log("Method AddChangedLogsDetails()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method AddChangedLogsDetails()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }

        }

        private void ExportToExcel(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ExportToExcel()...", category: Category.Info, priority: Priority.Low);

                SaveFileDialog saveFile = new SaveFileDialog();
                saveFile.DefaultExt = "xlsx";
                saveFile.FileName = "PLMHistory_" + SelectedBasePriceCode + "_" + DateTime.Now.ToString("MMddyyyy_hhmm");
                saveFile.Filter = "Excel Files (.xlsx)|*.xlsx|All Files (*.*)|*.*";
                saveFile.FilterIndex = 1;
                saveFile.Title = "Save Excel Report";
                DialogResult = (bool)saveFile.ShowDialog();

                if (!DialogResult)
                {
                    ResultFileName = string.Empty;
                }
                else
                {
                    if (!DXSplashScreen.IsActive)
                    {
                        DXSplashScreen.Show(x =>
                        {
                            Window win = new Window()
                            {
                                ShowActivated = false,
                                WindowStyle = WindowStyle.None,
                                ResizeMode = ResizeMode.NoResize,
                                AllowsTransparency = true,
                                Background = new SolidColorBrush(Colors.Transparent),
                                ShowInTaskbar = false,
                                Topmost = true,
                                SizeToContent = SizeToContent.WidthAndHeight,
                                WindowStartupLocation = WindowStartupLocation.CenterScreen,
                            };
                            WindowFadeAnimationBehavior.SetEnableAnimation(win, true);
                            win.Topmost = false;
                            return win;
                        }, x =>
                        {
                            return new SplashScreenView() { DataContext = new SplashScreenViewModel() };
                        }, null, null);
                    }
                    ResultFileName = (saveFile.FileName);
                    TableView ChangeLogTableView = ((TableView)obj);
                    ChangeLogTableView.ShowTotalSummary = false;
                    ChangeLogTableView.ShowFixedTotalSummary = false;
                    ChangeLogTableView.ExportToXlsx(ResultFileName);

                    if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                    System.Diagnostics.Process.Start(ResultFileName);
                    ChangeLogTableView.ShowTotalSummary = false;
                    ChangeLogTableView.ShowFixedTotalSummary = true;
                }
                GeosApplication.Instance.Logger.Log("Method ExportToExcel()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method ExportToExcel()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }


        private void ExportToExcelPriceListDetails(object obj)
        {
            Workbook workbook = new Workbook();
            FileStream stream = null;
            try
            {
                GeosApplication.Instance.Logger.Log("Method ExportToExcelPriceListDetails()...", category: Category.Info, priority: Priority.Low);

                SaveFileDialog saveFile = new SaveFileDialog();
                saveFile.DefaultExt = "xlsx";
                saveFile.FileName = SelectedBasePriceCode + "_" + DateTime.Now.ToString("MMddyyyy_hhmm");
                saveFile.Filter = "Excel Files (.xlsx)|*.xlsx|All Files (*.*)|*.*";
                saveFile.FilterIndex = 1;
                saveFile.Title = "Save Excel Report";
                DialogResult = (bool)saveFile.ShowDialog();

                if (!DialogResult)
                {
                    ResultFileName = string.Empty;
                }
                else
                {
                    if (!DXSplashScreen.IsActive)
                    {
                        DXSplashScreen.Show(x =>
                        {
                            Window win = new Window()
                            {
                                ShowActivated = false,
                                WindowStyle = WindowStyle.None,
                                ResizeMode = ResizeMode.NoResize,
                                AllowsTransparency = true,
                                Background = new SolidColorBrush(Colors.Transparent),
                                ShowInTaskbar = false,
                                Topmost = true,
                                SizeToContent = SizeToContent.WidthAndHeight,
                                WindowStartupLocation = WindowStartupLocation.CenterScreen,
                            };
                            WindowFadeAnimationBehavior.SetEnableAnimation(win, true);
                            win.Topmost = false;
                            return win;
                        }, x =>
                        {
                            return new SplashScreenView() { DataContext = new SplashScreenViewModel() };
                        }, null, null);
                    }
                    GeosApplication.Instance.SplashScreenMessage = "Exporting data to an Excel file...";
                    ResultFileName = (saveFile.FileName);

                    ExportTableView(this.articleTableView, "articleTableView");
                    ExportTableView(this.detectionsTableView, "detectionsTableView");
                    ExportTableView(this.moduleTableView, "moduleTableView");

                    byte[] excelTemplateInByte = geosService.GetBPLDetailsExcel(@"\PLM_BPL_Details.xlsx");

                    if (excelTemplateInByte == null) throw new Exception("Template file not found.");

                    workbook.LoadDocument(excelTemplateInByte, DocumentFormat.Xlsm); // PLM.Properties.Resources.PLM_BPL_Details

                    var articleTableViewFilePath = tempDirectory + @"\\" + "articleTableView" + ".xlsx";
                    var detectionsTableViewFilePath = tempDirectory + @"\\" + "detectionsTableView" + ".xlsx";
                    var modulesTableViewFilePath = tempDirectory + @"\\" + "moduleTableView" + ".xlsx";

                    Workbook workbookArticleTableViewFile = new Workbook();
                    Workbook workbookDetectionsTableViewFile = new Workbook();
                    Workbook workbookModulesTableViewFile = new Workbook();

                    workbookArticleTableViewFile.LoadDocument(articleTableViewFilePath, DocumentFormat.Xlsm);
                    workbookDetectionsTableViewFile.LoadDocument(detectionsTableViewFilePath, DocumentFormat.Xlsm);
                    workbookModulesTableViewFile.LoadDocument(modulesTableViewFilePath, DocumentFormat.Xlsm);

                    var worksheetHeader = workbook.Worksheets["Header"];
                    var worksheetArticlesTable = workbook.Worksheets["Articles"];
                    var worksheetDetectionsTable = workbook.Worksheets["Detections"];
                    try
                    {
                        var worksheetModulesTable = workbook.Worksheets["Modules"];
                    }
                    catch (Exception ex)
                    {
                    }
                    // ReplaceTextByValueOf_ArticlesGrid
                    var cellFound1 = workbook.Search("ReplaceTextByValueOf_ArticlesGrid", new SearchOptions { MatchEntireCellContents = true }).FirstOrDefault();
                    var cellRange1 = workbookArticleTableViewFile.Worksheets[0].Range.FromLTRB(0, 0, dtArticle.Columns.Count + 10, dtArticle.Rows.Count + 10);

                    if (cellFound1 != null) cellFound1.CopyFrom(cellRange1, PasteSpecial.All);
                    worksheetArticlesTable.FreezePanes(cellFound1.RowIndex + 1, cellFound1.ColumnIndex);

                    int ColumnOfFirstEmptyCellInTheRow = 0;
                    for (int i = 0; i < 1000; i++)
                    {
                        var cellDisplayText = worksheetArticlesTable[cellFound1.RowIndex + 1, 0][0, i].DisplayText;
                        if (string.IsNullOrEmpty(cellDisplayText))
                        {
                            ColumnOfFirstEmptyCellInTheRow = i - 1;
                            break;
                        }
                    }
                    if (ColumnOfFirstEmptyCellInTheRow > 0)
                    {
                        var cellRangeForFilter = worksheetArticlesTable.Range.FromLTRB(cellFound1.ColumnIndex, cellFound1.RowIndex + 1, ColumnOfFirstEmptyCellInTheRow, cellFound1.RowIndex + 1);
                        worksheetArticlesTable.AutoFilter.Apply(cellRangeForFilter);
                    }
                    cellRange1 = null;

                    // ReplaceTextByValueOf_DetectionsGrid
                    var cellsFound2 = workbook.Search("ReplaceTextByValueOf_DetectionsGrid", new SearchOptions { MatchEntireCellContents = true }).FirstOrDefault();
                    var cellRange2 = workbookDetectionsTableViewFile.Worksheets[0].Range.FromLTRB(0, 0, DtDetection.Columns.Count + 10, DtDetection.Rows.Count + 10);

                    if (cellsFound2 != null) cellsFound2.CopyFrom(cellRange2, PasteSpecial.All);
                    worksheetDetectionsTable.FreezePanes(cellsFound2.RowIndex + 1, cellsFound2.ColumnIndex);

                    ColumnOfFirstEmptyCellInTheRow = 0;
                    for (int i = 0; i < 1000; i++)
                    {
                        var cellDisplayText = worksheetDetectionsTable[cellsFound2.RowIndex + 1, 0][0, i].DisplayText;
                        if (string.IsNullOrEmpty(cellDisplayText))
                        {
                            ColumnOfFirstEmptyCellInTheRow = i - 1;
                            break;
                        }
                    }
                    if (ColumnOfFirstEmptyCellInTheRow > 0)
                    {
                        var cellRangeForFilter = worksheetDetectionsTable.Range.FromLTRB(cellsFound2.ColumnIndex, cellsFound2.RowIndex + 1, ColumnOfFirstEmptyCellInTheRow, cellsFound2.RowIndex + 1);
                        worksheetDetectionsTable.AutoFilter.Apply(cellRangeForFilter);
                    }
                    cellRange2 = null;

                    try
                    {
                        var worksheetModulesTable = workbook.Worksheets["Modules"];
                        // ReplaceTextByValueOf_ModulesGrid
                        var cellFound3 = workbook.Search("ReplaceTextByValueOf_ModulesGrid", new SearchOptions { MatchEntireCellContents = true }).FirstOrDefault();
                        var cellRange3 = workbookModulesTableViewFile.Worksheets[0].Range.FromLTRB(0, 0, DtModule.Columns.Count + 10, DtModule.Rows.Count + 10);

                        if (cellFound3 != null) cellFound3.CopyFrom(cellRange3, PasteSpecial.All);
                        worksheetModulesTable.FreezePanes(cellFound3.RowIndex + 1, cellFound3.ColumnIndex);

                        ColumnOfFirstEmptyCellInTheRow = 0;
                        for (int i = 0; i < 1000; i++)
                        {
                            var cellDisplayText = worksheetModulesTable[cellFound3.RowIndex + 1, 0][0, i].DisplayText;
                            if (string.IsNullOrEmpty(cellDisplayText))
                            {
                                ColumnOfFirstEmptyCellInTheRow = i - 1;
                                break;
                            }
                        }
                        if (ColumnOfFirstEmptyCellInTheRow > 0)
                        {
                            var cellRangeForFilter = worksheetModulesTable.Range.FromLTRB(cellFound3.ColumnIndex, cellFound3.RowIndex + 1, ColumnOfFirstEmptyCellInTheRow, cellFound3.RowIndex + 1);
                            worksheetModulesTable.AutoFilter.Apply(cellRangeForFilter);
                        }
                        cellRange3 = null;

                    }
                    catch (Exception ex)
                    {

                    }
                    string commaSeperatedSelectedPlants = string.Empty;
                    if (SelectedPlant != null)
                    {
                        commaSeperatedSelectedPlants = string.Join(";", SelectedPlant.Cast<Site>().Select(x => x.Name).ToArray());
                    }
                    string commaSeperatedSelectedSaleCurrencies = string.Empty;
                    if (SelectedSaleCurrency != null)
                    {
                        commaSeperatedSelectedSaleCurrencies = string.Join(";", SelectedSaleCurrency.Cast<Currency>().Select(x => x.Name).ToArray());
                    }

                    Dictionary<string, string> DictReplaceTextByValue = new Dictionary<string, string>
                    {
                        { "ReplaceTextByValueOf_Code", SelectedBasePriceCode },
                        { "ReplaceTextByValueOf_Plant", commaSeperatedSelectedPlants },
                        { "ReplaceTextByValueOf_Currency", (SelectedCurrency!=null?((Currency)SelectedCurrency).Name:string.Empty)},
                        { "ReplaceTextByValueOf_SaleCurrency", commaSeperatedSelectedSaleCurrencies },
                        { "ReplaceTextByValueOf_Status", (SelectedStatus!=null?SelectedStatus.Value:string.Empty)},
                        { "ReplaceTextByValueOf_ExchangeRate", (SelectedExchangeRate!=null?SelectedExchangeRate.Value:string.Empty) },
                        { "ReplaceTextByValueOf_EffectiveDate", (EffectiveDate!=null?EffectiveDate.Value.ToString("dd/MM/yyyy"):string.Empty) },
                        { "ReplaceTextByValueOf_ExpiryDate", (ExpiryDate!=null?ExpiryDate.Value.ToString("dd/MM/yyyy"):string.Empty) },
                        { "ReplaceTextByValueOf_LastUpdate",(LastUpdated!=null?LastUpdated.Value.ToString("dd/MM/yyyy"):string.Empty)},
                        { "ReplaceTextByValueOf_NameEN",IsCheckedAllLanguages?Name:Name_en },
                        { "ReplaceTextByValueOf_NameES",IsCheckedAllLanguages?Name:Name_es},
                        { "ReplaceTextByValueOf_NameFR",IsCheckedAllLanguages?Name:Name_fr },
                        { "ReplaceTextByValueOf_NamePT",IsCheckedAllLanguages?Name:Name_pt },
                        { "ReplaceTextByValueOf_NameRO",IsCheckedAllLanguages?Name:Name_ro },
                        { "ReplaceTextByValueOf_NameRU",IsCheckedAllLanguages?Name:Name_ru },
                        { "ReplaceTextByValueOf_NameZH",IsCheckedAllLanguages?Name:Name_zh },
                        { "ReplaceTextByValueOf_DescriptionEN",IsCheckedAllLanguages?Description:Description_en },
                        { "ReplaceTextByValueOf_DescriptionES",IsCheckedAllLanguages?Description:Description_es },
                        { "ReplaceTextByValueOf_DescriptionFR",IsCheckedAllLanguages?Description:Description_fr },
                        { "ReplaceTextByValueOf_DescriptionPT",IsCheckedAllLanguages?Description:Description_pt },
                        { "ReplaceTextByValueOf_DescriptionRO",IsCheckedAllLanguages?Description:Description_ro },
                        { "ReplaceTextByValueOf_DescriptionRU",IsCheckedAllLanguages?Description:Description_ru },
                        { "ReplaceTextByValueOf_DescriptionZH",IsCheckedAllLanguages?Description:Description_zh },
                        { "ReplaceTextByValueOf_RemarksEN",IsCheckedAllLanguages?Remark:Remark_en },
                        { "ReplaceTextByValueOf_RemarksES",IsCheckedAllLanguages?Remark:Remark_es },
                        { "ReplaceTextByValueOf_RemarksFR",IsCheckedAllLanguages?Remark:Remark_fr },
                        { "ReplaceTextByValueOf_RemarksPT",IsCheckedAllLanguages?Remark:Remark_pt },
                        { "ReplaceTextByValueOf_RemarksRO",IsCheckedAllLanguages?Remark:Remark_ro },
                        { "ReplaceTextByValueOf_RemarksRU",IsCheckedAllLanguages?Remark:Remark_ru },
                        { "ReplaceTextByValueOf_RemarksZH",IsCheckedAllLanguages?Remark:Remark_zh }

                    };

                    using (stream = new FileStream(ResultFileName, FileMode.Create, FileAccess.ReadWrite))
                    {
                        foreach (var itemReplaceTextByValue in DictReplaceTextByValue)
                        {
                            var cellsFound = workbook.Search(itemReplaceTextByValue.Key, new SearchOptions { MatchEntireCellContents = true });

                            if (cellsFound != null)
                            {
                                foreach (var itemcellFound in cellsFound)
                                {
                                    itemcellFound.SetValueFromText(itemReplaceTextByValue.Value);
                                }
                            }
                        }

                        foreach (var itemWorksheet in workbook.Worksheets)
                        {
                            itemWorksheet.Columns.AutoFit(0, 100);

                            for (int i = 0; i < 20; i++)
                            {
                                if (itemWorksheet.Columns[i].Width > 1200)
                                {
                                    itemWorksheet.Columns[i].Width = 1200;
                                }
                            }

                        }
                        workbook.Worksheets.ActiveWorksheet = workbook.Worksheets[0];
                        workbook.Worksheets[0].Cells["A1"].Select();
                        workbook.SaveDocument(stream, DocumentFormat.Xlsx);
                    }
                    System.Diagnostics.Process.Start(ResultFileName);

                    if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                    GeosApplication.Instance.SplashScreenMessage = string.Empty;
                }
                GeosApplication.Instance.Logger.Log("Method ExportToExcelPriceListDetails()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in Method ExportToExcelPriceListDetails()...." + ex.Message + GeosApplication.createExceptionDetailsMsg(ex), category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show("Failed to Generate Excel.", Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
        }

        private void ExportTableView(TableView tableView, string fileName)
        {
            try
            {
                if (tableView != null)
                {
                    var gridColumnDelete = tableView.Grid.Columns.GetColumnByFieldName("Delete");
                    var gridColumnIsChecked = tableView.Grid.Columns.GetColumnByFieldName("IsChecked");

                    var BandDeleteVisible = gridColumnDelete.ParentBand.Visible;
                    var ColumnIsCheckedVisible = gridColumnIsChecked.Visible;
                    gridColumnDelete.ParentBand.Visible = false;
                    gridColumnDelete.Visible = false;
                    gridColumnDelete.AllowPrinting = false;
                    gridColumnIsChecked.Visible = false;

                    var ShowTotalSummaryValue = tableView.ShowTotalSummary;
                    var ShowFixedTotalSummary = tableView.ShowFixedTotalSummary;
                    tableView.ShowTotalSummary = false;
                    tableView.ShowFixedTotalSummary = false;

                    XlsxExportOptionsEx options = new XlsxExportOptionsEx();
                    options.CustomizeCell += Options_CustomizeCell;
                    tableView.ExportToXlsx(tempDirectory + @"\\" + fileName + ".xlsx", options); //  + DateTime.Now.ToString("MMddyyyy_hhmm")

                    gridColumnDelete.ParentBand.Visible = BandDeleteVisible;
                    gridColumnDelete.Visible = BandDeleteVisible;
                    gridColumnIsChecked.Visible = ColumnIsCheckedVisible;

                    tableView.ShowTotalSummary = ShowTotalSummaryValue;
                    tableView.ShowFixedTotalSummary = ShowFixedTotalSummary;
                }
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method ExportTableView()...." + ex.Message + GeosApplication.createExceptionDetailsMsg(ex), category: Category.Exception, priority: Priority.Low);
                throw ex;
            }
        }

        private void Options_CustomizeCell(DevExpress.Export.CustomizeCellEventArgs e)
        {
            try
            {
                if (e.ColumnFieldName == "Logic")
                {
                    int cellValue;
                    var conversionSuccess = int.TryParse(e.Value.ToString(), out cellValue);
                    if (conversionSuccess && LogicList != null)
                    {
                        var item = LogicList.Where(x => x.IdLookupValue == cellValue).FirstOrDefault();
                        if (item != null) e.Value = item.Value.ToString();
                    }
                }

                e.Formatting.Alignment = new XlCellAlignment() { WrapText = true };
                e.Handled = true;
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method Options_CustomizeCell()...." + ex.Message + GeosApplication.createExceptionDetailsMsg(ex), category: Category.Exception, priority: Priority.Low);
                throw ex;
            }
        }

        private void AllButtonClickAction(object obj)
        {
            try
            {
                if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }
                IsAll = true;
                TableView detailview = (TableView)obj;
                detailview.PageSize = DtArticle.Rows.Count;
                detailview.UpdateLayout();
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method AllButtonClickAction()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }

        }

        private void DuplicateBasePriceCommandAction(object obj)
        {
            try
            {
                if (isDuplicateCliked == true)
                    return;

                isDuplicateCliked = true;
                NewBasePrice = new BasePrice();
                BasePriceOldCode = ClonedBasePrice.Code;
                GetLatestBasePriceCode();
                if (DuplicateCode == null)
                    DuplicateCode = PLMService.GetLatestBasePriceCode();
                #region New

                NewBasePrice = ClonedBasePrice;
                NewBasePrice.Code = DuplicateCode;
                NewBasePrice.CreationDate = DateTime.Now;
                NewBasePrice.IdCreator = (uint)GeosApplication.Instance.ActiveUser.IdUser;
                NewBasePrice.IdBasePriceList = IdBasePriceList;

                NewBasePrice.IdStatus = 225;
                #region GEOS2-2889
                //Shubham[skadam] GEOS2-2889 [ Modules + Attachments ]- Duplicate the base price list [#PLM05] 24 04 2023
                NewBasePrice.Name = "Duplicated_" + NewBasePrice.Name;
                bool isDuplicatedArticleAttachment = true;
                if (NewBasePrice.PLMArticleAttachmentList == null)
                {
                    NewBasePrice.PLMArticleAttachmentList = new List<BPLDocument>();
                }
                if (DuplicatedPLMArticleAttachmentList == null)
                {
                    DuplicatedPLMArticleAttachmentList = new List<BPLDocument>();
                }
                if (NewBasePrice.PLMArticleAttachmentList.Count() != 0)
                {
                    MessageBoxResult MessageBoxResult = MessageBoxResult = CustomMessageBox.Show(string.Format(Application.Current.Resources["PLMDuplicatedAttachment"].ToString()), "Yellow", CustomMessageBox.MessageImagePath.Warning, MessageBoxButton.YesNo);
                    if (MessageBoxResult == MessageBoxResult.Yes)
                    {
                        isDuplicatedArticleAttachment = false;
                        foreach (BPLDocument attachment in NewBasePrice.PLMArticleAttachmentList)
                        {
                            try
                            {
                                byte[] temp = geosService.GetArticleAttachmentFile(Name, attachment.SavedFileName);
                                attachment.PLMArticleFileInBytes = temp;
                                DuplicatedPLMArticleAttachmentList.Add(attachment);
                            }
                            catch (Exception ex)
                            {
                            }
                        }
                    }
                }
                IsDuplicated = true;
                #endregion
                BasePriceLogEntry tempBasePriceLogEntry = new BasePriceLogEntry();
                tempBasePriceLogEntry.IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser;
                tempBasePriceLogEntry.UserName = GeosApplication.Instance.ActiveUser.FullName;
                tempBasePriceLogEntry.Datetime = GeosApplication.Instance.ServerDateTime;
                tempBasePriceLogEntry.Comments = string.Format(System.Windows.Application.Current.FindResource("BasePriceChnageLogDuplicated").ToString(), NewBasePrice.Code.Trim(), NewBasePrice.Name.Trim(), BasePriceOldCode.Trim(), ClonedBasePrice.Name.Trim());

                BasePriceChangeLogList = new ObservableCollection<BasePriceLogEntry>();
                BasePriceChangeLogList.Add(tempBasePriceLogEntry);
                NewBasePrice.LogList = BasePriceChangeLogList.ToList();

                IdBasePriceList = NewBasePrice.IdBasePriceList;


                SelectedBasePriceCode = NewBasePrice.Code;

                ClonedBasePrice = (BasePrice)NewBasePrice.Clone();

                if (ClonedBasePrice.IdStatus == 224)
                    InActiveStatus = true;
                else
                    InActiveStatus = false;

                DtArticleCopy = new DataTable();
                DtArticle = new DataTable();
                Dttable = new DataTable();
                DtTableCopy = new DataTable();
                DtDetectionCopy = new DataTable();
                DtDetection = new DataTable();
                Bands = new ObservableCollection<BandItem>();
                BandsTemplete = new ObservableCollection<BandItem>();

                DetectionBands = new ObservableCollection<BandItem>();
                DetectionBandTemplate = new ObservableCollection<BandItem>();

                //Shubham[skadam] GEOS2-2886 [Only Modules ] - Able to  add and access to the tab Modules/Detection /Articles a Base Price List [3/3] [#PLM07] 21 03 2023
                DtModuleCopy = new DataTable();
                DtModule = new DataTable();
                ModuleBands = new ObservableCollection<BandItem>();

                SelectedPlant = new List<object>();
                SelectedSaleCurrency = new List<object>();
                PlantCurrencyList = new List<BasePriceListByPlantCurrency>();

                EditInitBasePrice_Duplicate(NewBasePrice);

                DuplicatedBasePriceObject = NewBasePrice;

                IsNew = true;
                IsEnabledSaveButton = false;
                SaveButtonVisibility = Visibility.Collapsed;
                if (isDuplicatedArticleAttachment)
                {
                    OptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>();
                    NewBasePrice.PLMArticleAttachmentList = new List<BPLDocument>();
                    SelectedOptionWayDetectionSparePartFile = new BPLDocument();
                    FourOptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>();
                }
                CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("BasePriceDuplicatedSuccess").ToString()), Application.Current.Resources["PopUpSuccessColor"].ToString(),
                    CustomMessageBox.MessageImagePath.Ok, MessageBoxButton.OK);
                #endregion


            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method AllButtonClickAction()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }

        }

        public void EditInitBasePrice_Duplicate(BasePrice temp)
        {
            try
            {
                GeosApplication.Instance.Logger.Log(string.Format("Method EditInitBasePrice_Duplicate..."), category: Category.Info, priority: Priority.Low);

                IdBasePriceList = temp.IdBasePriceList;
                SelectedBasePriceCode = temp.Code;


                Description = temp.Description;
                Description_en = temp.Description;
                Description_es = temp.Description_es;
                Description_fr = temp.Description_fr;
                Description_pt = temp.Description_pt;
                Description_ro = temp.Description_ro;
                Description_ru = temp.Description_ru;
                Description_zh = temp.Description_zh;

                Name = temp.Name;
                Name_en = temp.Name;
                Name_es = temp.Name_es;
                Name_fr = temp.Name_fr;
                Name_pt = temp.Name_pt;
                Name_ro = temp.Name_ro;
                Name_ru = temp.Name_ru;
                Name_zh = temp.Name_zh;

                Remark = temp.Remark;
                Remark_en = temp.Remark;
                Remark_es = temp.Remark_es;
                Remark_fr = temp.Remark_fr;
                Remark_pt = temp.Remark_pt;
                Remark_ro = temp.Remark_ro;
                Remark_ru = temp.Remark_ru;
                Remark_zh = temp.Remark_zh;

                CreationDate = temp.CreationDate;
                if (temp.ExpiryDate != DateTime.MinValue)
                {
                    ExpiryDate = temp.ExpiryDate;
                }
                if (temp.EffectiveDate != DateTime.MinValue)
                {
                    EffectiveDate = temp.EffectiveDate;
                }
                if (temp.LastUpdated != DateTime.MinValue)
                {
                    LastUpdated = temp.LastUpdated;
                }

                if (PlantList != null)
                {
                    if (SelectedPlant == null)
                        SelectedPlant = new List<object>();
                    foreach (Site plant in temp.PlantList)
                    {
                        SelectedPlant.Add(PlantList.FirstOrDefault(a => a.IdSite == plant.IdSite));
                    }
                }
                SelectedPlant = new List<object>(SelectedPlant);
                SelectedPlant_Copy = new List<object>(SelectedPlant);

                //SaleCurrency
                if (SaleCurrencyList != null)
                {
                    if (SelectedSaleCurrency == null)
                        SelectedSaleCurrency = new List<object>();
                    foreach (Currency plant in temp.CurrencyList)
                    {
                        SelectedSaleCurrency.Add(SaleCurrencyList.FirstOrDefault(a => a.IdCurrency == plant.IdCurrency));
                    }
                }
                SelectedSaleCurrency = new List<object>(SelectedSaleCurrency);
                SelectedSaleCurrency_Copy = new List<object>(SelectedSaleCurrency);

                if (PlantCurrencyList == null)
                {
                    PlantCurrencyList = new List<BasePriceListByPlantCurrency>();
                }
                PlantCurrencyList = temp.PlantCurrencyList;
                PlantCurrencyListWithIsChecked = new List<BasePriceListByPlantCurrency>();

                if (CurrencyList != null)
                {
                    SelectedCurrency = CurrencyList.FirstOrDefault(x => x.IdCurrency == temp.IdCurrency);
                    SelectedCurrency_Copy = SelectedCurrency;
                }

                if (StatusList != null)
                    SelectedStatus = StatusList.FirstOrDefault(x => x.IdLookupValue == temp.IdStatus);

                SelectedOriginalStatus = SelectedStatus;
                if (GeosApplication.Instance.IsPLMPermissionChange)
                    IsDuplicateBasePriceButtonEnabled = true;
                else
                    IsDuplicateBasePriceButtonEnabled = false;
                //  IsDuplicateBasePriceButtonEnabled = true;

                if (Name_en == Name_es && Name_en == Name_fr && Name_en == Name_pt && Name_en == Name_ro && Name_en == Name_ru && Name_en == Name_zh)
                {
                    IsCopyName = true;
                }
                if (Description_en == Description_es && Description_en == Description_fr && Description_en == Description_pt && Description_en == Description_ro && Description_en == Description_ru && Description_en == Description_zh)
                {
                    IsCopyDescription = true;
                }

                if (Remark_en == Remark_es && Remark_en == Remark_fr && Remark_en == Remark_pt && Remark_en == Remark_ro && Remark_en == Remark_ru && Remark_en == Remark_zh)
                {
                    IsCopyRemark = true;
                }

                if (IsCopyName == true && IsCopyDescription == true && IsCopyRemark == true)
                {
                    IsCheckedAllLanguages = true;
                }
                else
                {
                    IsCheckedAllLanguages = false;
                }

                oldIsCheckedAllLanguages = IsCheckedAllLanguages;

                FillArticleCostPriceList();
                ArticleList = new ObservableCollection<BasePriceListByItem>(temp.BasePriceListItems);
                DetectionList = new ObservableCollection<BasePriceListByItem>(temp.BasePriceListDetections);
                ModuleList = new ObservableCollection<BasePriceListByItem>(temp.BasePriceListModules);

                AddColumnsToArticleDataTable();
                AddColumnsToDetectionDataTable();
                AddColumnsToModuleDataTable();
                AddEditColumnsToPlantsDataTable();
                FillArticleData();
                FillDetectionData();
                FillModuleData();
                foreach (DataRow dr in Dttable.Rows)
                {
                    BasePriceListByPlantCurrency item = new BasePriceListByPlantCurrency();

                    item.PlantName = dr["Plant"].ToString();
                    if (!PlantCurrencyListWithIsChecked.Any(a => a.PlantName == item.PlantName))
                    {
                        foreach (Currency cur in SelectedSaleCurrency)
                        {
                            if (dr[cur.Name].ToString() == "True")
                            {
                                if (string.IsNullOrEmpty(item.CurrenciesName))
                                {
                                    item.CurrenciesName = cur.Name;
                                }
                                else
                                {
                                    if (!item.CurrenciesName.Contains(cur.Name))
                                        item.CurrenciesName += " " + cur.Name;
                                }
                            }
                        }
                        PlantCurrencyListWithIsChecked.Add(item);
                    }
                }
                BandsTemplete = new ObservableCollection<BandItem>(BandsTemplete);
                Dttable.AcceptChanges();
                //set gray color
                foreach (BasePriceListByItem article in ArticleList)
                {
                    ArticleMenuList.Where(a => a.IdArticle == article.IdArticle).ToList().ForEach(b => b.IsBPLArticle_Current = true);
                }

                //set gray color for Detections
                foreach (BasePriceListByItem detection in DetectionList)
                {
                    DetectionMenulist.Where(a => a.IdDetection == detection.IdDetection).ToList().ForEach(b => b.IsBPLArticle_Current = true);
                }

                if (temp.LogList != null)
                {
                    BasePriceChangeLogList = new ObservableCollection<BasePriceLogEntry>();

                    BasePriceChangeLogList.AddRange(temp.LogList);
                    if (BasePriceChangeLogList.Count > 0)
                        SelectedBasePriceChangeLog = BasePriceChangeLogList.FirstOrDefault();
                }
                GeosApplication.Instance.Logger.Log(string.Format("Method EditInitBasePrice_Duplicate()....executed successfully"), category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in EditInitBasePrice_Duplicate() Method " + ex.Detail.ErrorMessage, category: Category.Info, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in EditInitBasePrice_Duplicate() Method - ServiceUnexceptedException " + ex.Message, category: Category.Info, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method EditInitBasePrice_Duplicate()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }

        }
        //[001][cpatil[GEOS2-3211][09-12-2021]
        public void FillDetectionsMenuList()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillDetectionsMenuList()...", category: Category.Info, priority: Priority.Low);
                //[001] Service method changed
                //  DetectionMenulist = new ObservableCollection<BPLDetection>(PLMService.GetAllDetections_V2220());
                #region Geos2-3126 [Sudhir jangra] [21/12/2022]


                //[pramod.misal][16.04.2025][GEOS2-6688]
                if (PLMCommon.Instance.DetectionMenuListtemp == null || PLMCommon.Instance.DetectionMenuListtemp?.Count == 0)
                {
                    //DetectionMenuListtemp = new ObservableCollection<BPLDetection>(PLMService.GetAllDetections_V2220());
                    PLMCommon.Instance.DetectionMenuListtemp = new ObservableCollection<BPLDetection>(PLMService.GetAllDetections_V2220());


                }
                if (PLMCommon.Instance.DetectionMenuListtemp != null)
                {
                    DetectionMenuListtemp = PLMCommon.Instance.DetectionMenuListtemp;
                }



                #region Old code
                //ObservableCollection<BPLDetection> DetectionMenuListtemp1 = new ObservableCollection<BPLDetection>();
                if (DetectionMenuListtemp.Count > 0)
                {
                    // Step 1: Precompute counts
                    var parentNameCounts = DetectionMenuListtemp
                                .Where(x => !x.IsBPLArticle_Current && x.ParentName != null)
                                .GroupBy(x => x.ParentName)
                                .ToDictionary(g => g.Key, g => g.Count());

                    ObservableCollection<BPLDetection> DetectionMenuListtemp1 = new ObservableCollection<BPLDetection>();

                    if (DetectionMenuListtemp.Count > 0)
                    {
                        foreach (var item in DetectionMenuListtemp)
                        {
                            BPLDetection DetectionMenuList1 = new BPLDetection();
                            DetectionMenuList1.IdDetection = item.IdDetection;

                            // Step 2: Use dictionary lookup
                            int Count = parentNameCounts.ContainsKey(item.KeyName) ? parentNameCounts[item.KeyName] : 0;
                            DetectionMenuList1.Name = Count != 0 ? item.Name + "[" + Count + "]" : item.Name;

                            DetectionMenuList1.ParentName = item.ParentName;
                            DetectionMenuList1.KeyName = item.KeyName;
                            DetectionMenuList1.Description = item.Description;
                            DetectionMenuList1.DetectionTypeName = item.DetectionTypeName;
                            DetectionMenuList1.IdDetectionType = item.IdDetectionType;
                            DetectionMenuList1.IdGroup = item.IdGroup;
                            DetectionMenuList1.Code = item.Code;
                            DetectionMenuList1.StatusHtmlColor = item.StatusHtmlColor;
                            DetectionMenuList1.IsBPLArticle_Current = item.IsBPLArticle_Current;

                            DetectionMenuListtemp1.Add(DetectionMenuList1);
                        }

                        // Step 3: Assign directly with constructor
                        DetectionMenulist = new ObservableCollection<BPLDetection>(DetectionMenuListtemp1);
                    }

                }
                #endregion

                #region new code
                //if (DetectionMenuListtemp.Count > 0)
                //{
                //    ObservableCollection<BPLDetection> DetectionMenuListtemp1 = new ObservableCollection<BPLDetection>();

                //    foreach (var item in DetectionMenuListtemp)
                //    {
                //        var count = DetectionMenuListtemp.Count(x => x.ParentName == item.KeyName && !x.IsBPLArticle_Current == false);
                //        var newDetection = (BPLDetection)item.Clone(); // Assuming BPLModule implements ICloneable
                //        if (count != 0)
                //        {
                //            newDetection.Name = item.Name + "[" + count + "]";
                //        }
                //        else
                //        {
                //            newDetection.Name = item.Name;
                //        }
                //        newDetection.Name = count != 0 ? $"{item.Name}[{count}]" : item.Name;
                //        DetectionMenuListtemp1.Add(newDetection);
                //    }
                //    DetectionMenulist = new ObservableCollection<BPLDetection>(DetectionMenuListtemp1);
                //}

                #endregion
                #endregion

                if (DtDetection == null)
                {
                    DtDetection = new DataTable();
                }
                foreach (DataRow row in DtDetection.Rows)
                {
                    DetectionMenulist.Where(a => a.IdDetection == Convert.ToUInt64(row["IdDetection"])).ToList().ForEach(b => b.IsBPLArticle_Current = true);
                }
                SelectedDetection = new BPLDetection();

                GeosApplication.Instance.Logger.Log("Method FillDetectionsMenuList()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (FaultException<ServiceException> ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillDetectionsMenuList() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillDetectionsMenuList() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method FillDetectionsMenuList() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        public ImageSource ByteArrayToBitmapImage(byte[] byteArrayIn)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method convert byteArrayToImage ...", category: Category.Info, priority: Priority.Low);

                if (byteArrayIn == null || byteArrayIn.Length == 0) return null;
                var image = new BitmapImage();
                using (var mem = new System.IO.MemoryStream(byteArrayIn))
                {
                    mem.Position = 0;
                    image.BeginInit();
                    image.CreateOptions = BitmapCreateOptions.PreservePixelFormat;
                    image.CacheOption = BitmapCacheOption.OnLoad;
                    image.UriSource = null;
                    image.StreamSource = mem;
                    image.EndInit();
                }

                image.Freeze();
                GeosApplication.Instance.Logger.Log("Method byteArrayToImage() executed successfully", category: Category.Info, priority: Priority.Low);

                return image;
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in byteArrayToImage() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }

            return null;
        }

        private void AddFile(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method AddFile()...", category: Category.Info, priority: Priority.Low);

                AddEditAttachmentFileInPLMView addEditAttachmentFileInPLMView = new AddEditAttachmentFileInPLMView();
                AddEditAttachmentFileInPLMArticleViewModel addEditAttachmentFileInPLMArticleViewModel = new AddEditAttachmentFileInPLMArticleViewModel();
                EventHandler handle = delegate { addEditAttachmentFileInPLMView.Close(); };
                addEditAttachmentFileInPLMArticleViewModel.RequestClose += handle;
                addEditAttachmentFileInPLMArticleViewModel.WindowHeader = System.Windows.Application.Current.FindResource("AddFileHeader").ToString();
                addEditAttachmentFileInPLMArticleViewModel.IsNew = true;
                addEditAttachmentFileInPLMArticleViewModel.Init();

                addEditAttachmentFileInPLMView.DataContext = addEditAttachmentFileInPLMArticleViewModel;
                var ownerInfo = (obj as FrameworkElement);
                addEditAttachmentFileInPLMView.Owner = Window.GetWindow(ownerInfo);
                addEditAttachmentFileInPLMView.ShowDialog();

                if (addEditAttachmentFileInPLMArticleViewModel.IsSave)
                {
                    if (OptionWayDetectionSparePartFilesList == null)
                        OptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>();

                    IsEnabledSaveButton = true;
                    addEditAttachmentFileInPLMArticleViewModel.SelectedBasicPriceFile.ModifiedIn = Emdep.Geos.UI.Common.GeosApplication.Instance.ServerDateTime.Date.Date;
                    OptionWayDetectionSparePartFilesList.Add(addEditAttachmentFileInPLMArticleViewModel.SelectedBasicPriceFile);
                    SelectedOptionWayDetectionSparePartFile = addEditAttachmentFileInPLMArticleViewModel.SelectedBasicPriceFile;
                    FourOptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>(OptionWayDetectionSparePartFilesList.OrderByDescending(x => x.ModifiedIn).Take(4).ToList());
                }
                GeosApplication.Instance.Logger.Log("Method AddFile()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method AddFile() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void EditFile(object obj)
        {
            try
            {


                GeosApplication.Instance.Logger.Log("Method EditFile()...", category: Category.Info, priority: Priority.Low);
                TableView detailView = (TableView)obj;
                BPLDocument bPLAttachedDoc = (BPLDocument)detailView.DataControl.CurrentItem;
                AddEditAttachmentFileInPLMView addEditAttachmentFileInPLMView = new AddEditAttachmentFileInPLMView();
                AddEditAttachmentFileInPLMArticleViewModel addEditAttachmentFileInPLMArticleViewModel = new AddEditAttachmentFileInPLMArticleViewModel();
                EventHandler handle = delegate { addEditAttachmentFileInPLMView.Close(); };
                addEditAttachmentFileInPLMArticleViewModel.RequestClose += handle;
                addEditAttachmentFileInPLMArticleViewModel.WindowHeader = System.Windows.Application.Current.FindResource("EditFileHeader").ToString();
                addEditAttachmentFileInPLMArticleViewModel.IsNew = false;
                addEditAttachmentFileInPLMArticleViewModel.ClearAllProperties();
                addEditAttachmentFileInPLMArticleViewModel.EditInit(bPLAttachedDoc);
                addEditAttachmentFileInPLMView.DataContext = addEditAttachmentFileInPLMArticleViewModel;
                var ownerInfo = (detailView as FrameworkElement);
                addEditAttachmentFileInPLMView.Owner = Window.GetWindow(ownerInfo);
                addEditAttachmentFileInPLMView.ShowDialog();

                if (addEditAttachmentFileInPLMArticleViewModel.IsSave == true)
                {

                    SelectedOptionWayDetectionSparePartFile.IdAttachmentType = addEditAttachmentFileInPLMArticleViewModel.BPLSelectedType.IdLookupValue;
                    SelectedOptionWayDetectionSparePartFile.OriginalFileName = addEditAttachmentFileInPLMArticleViewModel.FileName;
                    SelectedOptionWayDetectionSparePartFile.Description = addEditAttachmentFileInPLMArticleViewModel.Description;
                    SelectedOptionWayDetectionSparePartFile.PLMArticleFileInBytes = addEditAttachmentFileInPLMArticleViewModel.FileInBytes;
                    SelectedOptionWayDetectionSparePartFile.SavedFileName = addEditAttachmentFileInPLMArticleViewModel.ArticleSavedFileName;
                    SelectedOptionWayDetectionSparePartFile.ModifiedIn = addEditAttachmentFileInPLMArticleViewModel.UpdatedDate; ;
                    SelectedOptionWayDetectionSparePartFile.ArticleDocumentType = new ArticleDocumentType();
                    SelectedOptionWayDetectionSparePartFile.ArticleDocumentType.DocumentType = addEditAttachmentFileInPLMArticleViewModel.BPLSelectedType.Value;
                    SelectedOptionWayDetectionSparePartFile.IsShareWithCustomer = addEditAttachmentFileInPLMArticleViewModel.IsShareWithCustomer;
                    IsEnabledSaveButton = true;
                }

                GeosApplication.Instance.Logger.Log("Method EditFile()....executed successfully", category: Category.Info, priority: Priority.Low);


            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method EditFile() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void OpenPDFDocument(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method OpenPDFDocument()...", category: Category.Info, priority: Priority.Low);

                // Open PDF in another window
                DocumentView documentView = new DocumentView();
                DocumentViewModel documentViewModel = new DocumentViewModel();
                SelectedOptionWayDetectionSparePartFile = (BPLDocument)obj;

                documentViewModel.OpenBPLPdf(SelectedOptionWayDetectionSparePartFile, obj, Name);
                if (documentViewModel.IsPresent)
                {
                    documentView.DataContext = documentViewModel;
                    documentView.Show();
                }
                IsEnabledSaveButton = true;
                GeosApplication.Instance.Logger.Log("Method OpenPDFDocument()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in OpenPDFDocument() Method " + ex.Detail.ErrorMessage, category: Category.Info, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in OpenPDFDocument() Method - ServiceUnexceptedException " + ex.Message, category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method OpenPDFDocument()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        private void DelateAttachmentFile(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method DelateAttachmentFile()...", category: Category.Info, priority: Priority.Low);
                MessageBoxResult MessageBoxResult = CustomMessageBox.Show(Application.Current.Resources["DeleteDocumentMessage"].ToString(), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);

                if (MessageBoxResult == MessageBoxResult.Yes)
                {
                    OptionWayDetectionSparePartFilesList.Remove(SelectedOptionWayDetectionSparePartFile);
                    OptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>(OptionWayDetectionSparePartFilesList);
                    SelectedOptionWayDetectionSparePartFile = OptionWayDetectionSparePartFilesList.FirstOrDefault();
                    FourOptionWayDetectionSparePartFilesList = new ObservableCollection<BPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.IdBasepricedoc).Take(4).ToList());
                }
                IsEnabledSaveButton = true;
                GeosApplication.Instance.Logger.Log("Method DelateAttachmentFile()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method DelateAttachmentFile()...." + ex.Message, category: Category.Exception, priority: Priority.Low);

            }
        }
        //[sudhir.jangra][GEOS2-2855][01/12/2022][Add All button added]
        //Shubham[skadam] GEOS2-4424 Need to add "Add ALL" button in module tab in BPL. 29 08 2023
        //Shubham[skadam] GEOS2-4784 Need to add custom filter option in module same as article/detection. 29 08 2023
        //Shubham[skadam] GEOS2-4784 GEOS2-4785 No additional data so remove [0] this in tree menu in article, detection & module  left tree in BPL menu 29 08 2023
        //Shubham[skadam] GEOS2-4786 (JLR) The exported XLS Price List (BPL and CPL) must have the sheet with the modules. 29 08 2023
        private void FillAddAllModuleView()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillAddAllModuleView()...", category: Category.Info, priority: Priority.Low);
                int count = 0;
                foreach (BPLModule Module in ModuleMenulist.Where(x => x.IdCPType > 0 && x.IsBPLdModule_Current != true))
                {
                    DataRow[] found = dtModuleCopy.Select("IdCPType = '" + Module.IdCPType + "'");
                    if (found.Length == 0)
                    {
                        count++;
                    }

                    if (count > 0)
                    {
                        double MaxCost = 0.00;
                        double SellPriceValue = 0.00;
                        if (AddModules == null)
                            AddModules = new List<UInt64>();

                        AddModules.Add(Module.IdCPType);

                        DataRow dr = DtModuleCopy.NewRow();
                        dr["IsChecked"] = false;
                        if (Module.ProductType != null)
                        {
                            if (string.IsNullOrEmpty(Module.ProductType.Reference)) //[001]
                                dr["Code"] = "---";
                            else
                                dr["Code"] = Module.ProductType.Reference;
                        }
                        else
                        {
                            dr["Code"] = "---";
                        }
                        // dr["Name"] = record.Name;
                        dr["Name"] = Module.Name;
                        dr["IdCPType"] = Module.IdCPType;
                        dr["Type"] = Module.TemplateName;
                        dr["Logic"] = 308;
                        dr["IsUpdatedRow"] = true;
                        dr["STAT"] = Module.StatusAbbreviation;
                        dr["HtmlColor"] = Module.StatusHtmlColor;
                        //set gray color

                        ModuleMenulist.Where(a => a.IdCPType == Module.IdCPType).ToList().ForEach(b => b.IsBPLdModule_Current = true);

                        //double Cost_Value = 0;
                        dr["MaxCost_1"] = 0;

                        dr["CurrencyConversionDate"] = CurrencyConversionList.FirstOrDefault().LastUpdate;

                        foreach (Currency currency in SelectedSaleCurrency)
                        {
                            if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                dr["Common_Cur"] = DBNull.Value;
                            else
                                dr[currency.Name] = DBNull.Value;

                            if (dr["CurrencyConversionDate"] != DBNull.Value)
                            {
                                CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                if (CurConversion1 != null)
                                {
                                    if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                    {
                                        if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                            dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                        else
                                            dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                    }
                                    else
                                    {
                                        if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                            dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.ExchangeRate;
                                        else
                                            dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.LastMonthAVGRate;
                                    }
                                }
                            }
                        }

                        if (CurrencyList.Count > 0)
                        {
                            if (!CurrencyList.Any(x => x.IdCurrency == ((Currency)SelectedCurrency).IdCurrency))
                                SellPriceValue = 0.00;
                            else
                                SellPriceValue = Convert.ToDouble(CurrencyList.Where(x => x.IdCurrency == ((Currency)SelectedCurrency).IdCurrency).Select(x => x.SellPriceValue).FirstOrDefault());
                        }

                        MaxCost = (double)dr["MaxCost_1"];

                        dr["Profit"] = Convert.ToDouble(CalculateBasePriceProfitValue(MaxCost, SellPriceValue));

                        dr["CostMargin"] = Convert.ToDouble(CalculateBasePriceCostMarginValue(MaxCost, SellPriceValue));
                        if (dr["CurrencyConversionDate"] != DBNull.Value)
                        {
                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                            {
                                dr["SaleCurrencyConversionDate"] = "Updated currency rate on : " + Convert.ToDateTime(dr["CurrencyConversionDate"]).ToString("dd/MM/yyyy");
                            }
                            else
                            {
                                DateTime dtCurrencyConversionDate = new DateTime(Convert.ToDateTime(dr["CurrencyConversionDate"]).Year, Convert.ToDateTime(dr["CurrencyConversionDate"]).Month, 1);
                                dr["SaleCurrencyConversionDate"] = "Updated currency rate on : " + dtCurrencyConversionDate.ToString("dd/MM/yyyy");
                            }
                        }
                        DtModuleCopy.Rows.Add(dr);

                        if (!isDuplicateCliked) IsEnabledSaveButton = true;
                    }
                }
                DtModule = DtModuleCopy;
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method FillAddAllModuleView() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        private void FillAddAllArticleView()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillAddAllView()...", category: Category.Info, priority: Priority.Low);
                int count = 0;
                foreach (PCMArticleCategory article in ArticleMenuList.Where(x => x.IdArticle > 0 && x.IsBPLArticle_Current != true))
                {
                    DataRow[] found = dtArticleCopy.Select("IdArticle = '" + article.IdArticle + "'");
                    if (found.Length == 0)
                    {
                        count++;
                    }

                    if (count > 0)
                    {
                        double MaxCost;
                        double SellPriceValue = 0.00;
                        if (CurrencyConversionList == null)
                            CurrencyConversionList = new List<CurrencyConversion>();
                        if (DtArticleCopy == null)
                            DtArticleCopy = new DataTable();
                        if (AddArticles == null)
                            AddArticles = new List<UInt64>();
                        AddArticles.Add(article.IdArticle);
                        IsCalculateArticleCostButtonEnabled = true;
                        IsCalculated = false;
                        if (DtArticleCopy == null)
                            DtArticleCopy = new DataTable();
                        DataRow dr = DtArticleCopy.NewRow();
                        dr["IsChecked"] = false;
                        dr["Reference"] = article.Reference;
                        dr["Name"] = article.Description;
                        dr["IdArticle"] = article.IdArticle;
                        dr["Category"] = article.CategoryName;
                        dr["STAT"] = article.StatusAbbreviation;
                        dr["HtmlColor"] = article.StatusHtmlColor;
                        dr["Logic"] = 308;
                        dr["IsUpdatedRow"] = true;
                        //set gray color
                        ArticleMenuList.Where(a => a.IdArticle == article.IdArticle).ToList().ForEach(b => b.IsBPLArticle_Current = true);
                        double Cost_Value = 0;
                        dr["MaxCost_1"] = DBNull.Value;
                        List<ArticleCostPrice> PlantRecordsForGetCurrencyDate = new List<ArticleCostPrice>();
                        foreach (Site plant in SelectedPlant)
                        {
                            ArticleCostPrice Cost = ArticleCostPriceList.FirstOrDefault(a => a.IdCompany == plant.IdSite && a.IdArticle == Convert.ToUInt32(dr["IdArticle"]));
                            if (Cost == null)
                            {
                                Cost = new ArticleCostPrice();
                            }
                            else
                            {
                                PlantRecordsForGetCurrencyDate.Add(Cost);
                            }
                            dr[plant.Name] = Cost.ArticleCostValue;
                            if (dr["MaxCost_1"] == DBNull.Value)
                            {
                                dr["MaxCost_1"] = Cost.ArticleCostValue;
                                Cost_Value = Cost.ArticleCostValue;
                            }
                            if (Cost_Value < Cost.ArticleCostValue)
                            {
                                dr["MaxCost_1"] = Cost.ArticleCostValue;
                                Cost_Value = Cost.ArticleCostValue;
                            }
                        }
                        if (dr["MaxCost_1"] == DBNull.Value)
                        {
                            dr["MaxCost_1"] = 0;
                        }
                        dr["CurrencyConversionDate"] = CurrencyConversionList.FirstOrDefault().LastUpdate;
                        foreach (Currency currency in SelectedSaleCurrency)
                        {
                            if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                dr["Common_Cur"] = DBNull.Value;
                            else
                                dr[currency.Name] = DBNull.Value;

                            if (dr["CurrencyConversionDate"] != DBNull.Value)
                            {
                                CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                if (CurConversion1 != null)
                                {
                                    if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                    {
                                        if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                            dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                        else
                                            dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                    }
                                    else
                                    {
                                        if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                            dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.ExchangeRate;
                                        else
                                            dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.LastMonthAVGRate;
                                    }
                                }
                            }
                        }
                        if (CurrencyList.Count > 0)
                        {
                            if (!CurrencyList.Any(x => x.IdCurrency == ((Currency)SelectedCurrency).IdCurrency))
                                SellPriceValue = 0.00;
                            else
                                SellPriceValue = Convert.ToDouble(CurrencyList.Where(x => x.IdCurrency == ((Currency)SelectedCurrency).IdCurrency).Select(x => x.SellPriceValue).FirstOrDefault());
                        }
                        if (PlantRecordsForGetCurrencyDate.Count > 0)
                            MaxCost = Convert.ToDouble(PlantRecordsForGetCurrencyDate.Max(x => x.ArticleCostValue));
                        else
                            MaxCost = 0.00;
                        dr["Profit"] = Convert.ToDouble(CalculateBasePriceProfitValue(MaxCost, SellPriceValue));
                        dr["CostMargin"] = Convert.ToDouble(CalculateBasePriceCostMarginValue(MaxCost, SellPriceValue));
                        if (dr["CurrencyConversionDate"] != DBNull.Value)
                        {
                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                            {
                                dr["SaleCurrencyConversionDate"] = "Updated currency rate on : " + Convert.ToDateTime(dr["CurrencyConversionDate"]).ToString("dd/MM/yyyy");
                            }
                            else
                            {
                                DateTime dtCurrencyConversionDate = new DateTime(Convert.ToDateTime(dr["CurrencyConversionDate"]).Year, Convert.ToDateTime(dr["CurrencyConversionDate"]).Month, 1);
                                dr["SaleCurrencyConversionDate"] = "Updated currency rate on : " + dtCurrencyConversionDate.ToString("dd/MM/yyyy");
                            }
                        }
                        DtArticleCopy.Rows.Add(dr);
                        if (!isDuplicateCliked) IsEnabledSaveButton = true;
                    }

                }
                #region GEOS2-3126 [Sudhir Jangra] [22/12/2022]
                ObservableCollection<PCMArticleCategory> ArticleMenuListtemp1 = new ObservableCollection<PCMArticleCategory>();
                foreach (PCMArticleCategory item in ArticleMenuList)
                {
                    string TempName = item.Name.Remove(item.Name.LastIndexOf("[") + 1);
                    int t = ArticleMenuList.Where(x => x.ParentName == item.KeyName && x.IsBPLArticle_Current == false).ToList().Count;
                    PCMArticleCategory ArticleMenuList1 = new PCMArticleCategory();
                    ArticleMenuList1.IdArticle = item.IdArticle;
                    //Shubham[skadam] GEOS2-4784 GEOS2-4785 No additional data so remove [0] this in tree menu in article, detection & module  left tree in BPL menu 29 08 2023
                    //ArticleMenuList1.Name = TempName + ArticleMenuList.Where(x => x.ParentName == item.KeyName && x.IsBPLArticle_Current == false).ToList().Count + "]";
                    try
                    {
                        Int64 Count = ArticleMenuList.Where(x => x.ParentName == item.KeyName && x.IsBPLArticle_Current == false).ToList().Count;
                        if (Count != 0)
                        {
                            ArticleMenuList1.Name = TempName + Count + "]";
                        }
                        else
                        {
                            if (!string.IsNullOrEmpty(TempName))
                            {
                                ArticleMenuList1.Name = TempName.Remove(TempName.Length - 1);
                            }
                            else
                            {
                                if (!string.IsNullOrEmpty(item.Name))
                                {
                                    ArticleMenuList1.Name = item.Name;
                                }
                                else
                                {
                                    ArticleMenuList1.Name = "";
                                }
                            }
                        }
                    }
                    catch (Exception ex) { }
                    ArticleMenuList1.NameWithArticleCount = item.NameWithArticleCount;
                    ArticleMenuList1.ParentName = item.ParentName;
                    ArticleMenuList1.KeyName = item.KeyName;
                    ArticleMenuList1.Reference = item.Reference;
                    ArticleMenuList1.StatusHtmlColor = item.StatusHtmlColor;
                    ArticleMenuList1.IdPCMArticleCategory = item.IdPCMArticleCategory;
                    ArticleMenuList1.IsBPLArticle = item.IsBPLArticle;
                    ArticleMenuList1.IsBPLArticle_Current = item.IsBPLArticle_Current;
                    ArticleMenuListtemp1.Add(ArticleMenuList1);
                }
                ArticleMenuList = new ObservableCollection<PCMArticleCategory>();
                ArticleMenuList.AddRange(ArticleMenuListtemp1);
                #endregion
                DtArticle = DtArticleCopy;
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method FillAddAllView() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        private void FillAddAllDetectionView()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillAddAllDetectionView()...", category: Category.Info, priority: Priority.Low);
                int count = 0;
                foreach (BPLDetection detection in DetectionMenulist.Where(x => x.IdDetection > 0 && x.IsBPLArticle_Current != true))
                {
                    DataRow[] found = dtDetectionCopy.Select("IdDetection = '" + detection.IdDetection + "'");
                    if (found.Length == 0)
                    {
                        count++;
                    }

                    if (count > 0)
                    {
                        double MaxCost = 0.00;
                        double SellPriceValue = 0.00;
                        if (AddDetections == null)
                            AddDetections = new List<UInt64>();

                        AddDetections.Add(detection.IdDetection);

                        DataRow dr = DtDetectionCopy.NewRow();
                        dr["IsChecked"] = false;
                        if (string.IsNullOrEmpty(detection.Code))
                            dr["Code"] = "---";
                        else
                            dr["Code"] = detection.Code;

                        dr["Name"] = detection.Name;
                        dr["IdDetection"] = detection.IdDetection;
                        dr["Type"] = detection.DetectionTypeName;
                        dr["Logic"] = 308;
                        dr["IsUpdatedRow"] = true;
                        dr["STAT"] = detection.StatusAbbreviation;
                        dr["HtmlColor"] = detection.StatusHtmlColor;

                        DetectionMenulist.Where(a => a.IdDetection == detection.IdDetection).ToList().ForEach(b => b.IsBPLArticle_Current = true);

                        dr["MaxCost_1"] = 0;

                        dr["CurrencyConversionDate"] = CurrencyConversionList.FirstOrDefault().LastUpdate;



                        foreach (Currency currency in SelectedSaleCurrency)
                        {
                            if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                dr["Common_Cur"] = DBNull.Value;
                            else
                                dr[currency.Name] = DBNull.Value;

                            if (dr["CurrencyConversionDate"] != DBNull.Value)
                            {
                                CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                if (CurConversion1 != null)
                                {
                                    if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                    {
                                        if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                            dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                        else
                                            dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                    }
                                    else
                                    {
                                        if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                            dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.ExchangeRate;
                                        else
                                            dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.LastMonthAVGRate;
                                    }
                                }
                            }
                        }

                        if (CurrencyList.Count > 0)
                        {
                            if (!CurrencyList.Any(x => x.IdCurrency == ((Currency)SelectedCurrency).IdCurrency))
                                SellPriceValue = 0.00;
                            else
                                SellPriceValue = Convert.ToDouble(CurrencyList.Where(x => x.IdCurrency == ((Currency)SelectedCurrency).IdCurrency).Select(x => x.SellPriceValue).FirstOrDefault());
                        }

                        MaxCost = (double)dr["MaxCost_1"];

                        dr["Profit"] = Convert.ToDouble(CalculateBasePriceProfitValue(MaxCost, SellPriceValue));

                        dr["CostMargin"] = Convert.ToDouble(CalculateBasePriceCostMarginValue(MaxCost, SellPriceValue));
                        if (dr["CurrencyConversionDate"] != DBNull.Value)
                        {
                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                            {
                                dr["SaleCurrencyConversionDate"] = "Updated currency rate on : " + Convert.ToDateTime(dr["CurrencyConversionDate"]).ToString("dd/MM/yyyy");
                            }
                            else
                            {
                                DateTime dtCurrencyConversionDate = new DateTime(Convert.ToDateTime(dr["CurrencyConversionDate"]).Year, Convert.ToDateTime(dr["CurrencyConversionDate"]).Month, 1);
                                dr["SaleCurrencyConversionDate"] = "Updated currency rate on : " + dtCurrencyConversionDate.ToString("dd/MM/yyyy");
                            }
                        }
                        DtDetectionCopy.Rows.Add(dr);



                        if (!isDuplicateCliked) IsEnabledSaveButton = true;
                    }

                }
                #region GEOS2-3126 [Sudhir Jangra]
                ObservableCollection<BPLDetection> DetectionMenuListtemp1 = new ObservableCollection<BPLDetection>();
                foreach (BPLDetection item in DetectionMenulist)
                {
                    string TempName = item.Name.Remove(item.Name.LastIndexOf("[") + 1);
                    int t = DetectionMenulist.Where(x => x.ParentName == item.KeyName && x.IsBPLArticle_Current == false).ToList().Count;
                    BPLDetection DetectionMenuList1 = new BPLDetection();
                    DetectionMenuList1.IdDetection = item.IdDetection;
                    //Shubham[skadam] GEOS2-4784 GEOS2-4785 No additional data so remove [0] this in tree menu in article, detection & module  left tree in BPL menu 29 08 2023
                    // DetectionMenuList1.Name = TempName + DetectionMenulist.Where(x => x.ParentName == item.KeyName && x.IsBPLArticle_Current == false).ToList().Count + "]";
                    try
                    {
                        Int64 Count = DetectionMenulist.Where(x => x.ParentName == item.KeyName && x.IsBPLArticle_Current == false).ToList().Count;
                        if (Count != 0)
                        {
                            DetectionMenuList1.Name = TempName + Count + "]";
                        }
                        else
                        {
                            if (!string.IsNullOrEmpty(TempName))
                            {
                                DetectionMenuList1.Name = TempName.Remove(TempName.Length - 1);
                            }
                            else
                            {
                                if (!string.IsNullOrEmpty(item.Name))
                                {
                                    DetectionMenuList1.Name = item.Name;
                                }
                                else
                                {
                                    DetectionMenuList1.Name = "";
                                }
                            }
                        }
                    }
                    catch (Exception ex) { }
                    DetectionMenuList1.ParentName = item.ParentName;
                    DetectionMenuList1.Description = item.Description;
                    DetectionMenuList1.DetectionTypeName = item.DetectionTypeName;
                    DetectionMenuList1.IdDetectionType = item.IdDetectionType;
                    DetectionMenuList1.IdGroup = item.IdGroup;
                    DetectionMenuList1.KeyName = item.KeyName;
                    DetectionMenuList1.Code = item.Code;
                    DetectionMenuList1.StatusHtmlColor = item.StatusHtmlColor;
                    DetectionMenuList1.IsBPLArticle_Current = item.IsBPLArticle_Current;
                    DetectionMenuListtemp1.Add(DetectionMenuList1);
                }
                DetectionMenulist = new ObservableCollection<BPLDetection>();
                DetectionMenulist.AddRange(DetectionMenuListtemp1);
                #endregion
                DtDetection = DtDetectionCopy;
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method FillAddAllDetectionView() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }


        //[Sudhir.Jangra][GEOS2-4935][21/11/2023]
        private void AddCommentsCommandAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method AddFile()...", category: Category.Info, priority: Priority.Low);
                GridControl gridControlView = (GridControl)obj;
                AddEditCommentsPLMView addCommentsView = new AddEditCommentsPLMView();
                AddEditCommentsPLMViewModel addCommentsViewModel = new AddEditCommentsPLMViewModel();
                EventHandler handle = delegate { addCommentsView.Close(); };
                addCommentsViewModel.RequestClose += handle;
                addCommentsViewModel.WindowHeader = System.Windows.Application.Current.FindResource("AddCommentsHeader").ToString();
                var ownerInfo = (gridControlView as FrameworkElement);
                addCommentsView.Owner = Window.GetWindow(ownerInfo);
                //addCommentsViewModel.IsNew = true;
                //addCommentsViewModel.Init();

                addCommentsView.DataContext = addCommentsViewModel;
                addCommentsView.ShowDialog();
                if (addCommentsViewModel.SelectedComment != null)
                {

                    if (CommentsList == null)
                        CommentsList = new ObservableCollection<BasePriceLogEntry>();

                    //  addCommentsViewModel.SelectedComment.IdCPType = contacts.IdArticleSupplier;

                    if (AddCommentsList == null)
                        AddCommentsList = new List<BasePriceLogEntry>();

                    AddCommentsList.Add(new BasePriceLogEntry()
                    {
                        IdUser = addCommentsViewModel.SelectedComment.IdUser,
                        // IdCPType = addCommentsViewModel.SelectedComment.IdCPType,
                        Comments = addCommentsViewModel.SelectedComment.Comments
                    });
                    CommentsList.Add(addCommentsViewModel.SelectedComment);
                    SelectedComment = addCommentsViewModel.SelectedComment;
                    CommentText = SelectedComment.Comments;
                    CommentDateTimeText = DateTime.Now;
                    CommentFullNameText = GeosApplication.Instance.ActiveUser.FullName;
                }
                GeosApplication.Instance.Logger.Log("Method AddFile()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method AddFile() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        //[Sudhir.Jangra][GEOS2-4935]
        public void DeleteCommentRowCommandAction(object parameter)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method convert DeleteCommentCommandAction ...", category: Category.Info, priority: Priority.Low);
                BasePriceLogEntry commentObject = (BasePriceLogEntry)parameter;
                if (commentObject.IdUser == GeosApplication.Instance.ActiveUser.IdUser)
                {
                    bool result = false;

                    MessageBoxResult MessageBoxResult = CustomMessageBox.Show(Application.Current.Resources["DeleteBasePriceComment"].ToString(), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);

                    if (MessageBoxResult == MessageBoxResult.Yes)
                    {
                        if (CommentsList != null && CommentsList?.Count > 0)
                        {
                            BasePriceLogEntry Comment = (BasePriceLogEntry)commentObject;

                            CommentsList.Remove(Comment);

                            if (DeleteCommentsList == null)
                                DeleteCommentsList = new ObservableCollection<BasePriceLogEntry>();

                            DeleteCommentsList.Add(new BasePriceLogEntry()
                            {
                                IdUser = Comment.IdUser,
                                //  IdCPType = Comment.IdCPType,
                                Comments = Comment.Comments,
                                //  IdLogEntryByCptype = Comment.IdLogEntryByCptype

                            });
                            CommentsList = new ObservableCollection<BasePriceLogEntry>(CommentsList);

                            IsDeleted = true;
                            if (CommentsList?.Count > 0)
                            {
                                CommentText = CommentsList[CommentsList.Count - 1].Comments;
                                CommentDateTimeText = CommentsList[CommentsList.Count - 1].Datetime;
                                CommentFullNameText = CommentsList[CommentsList.Count - 1].People.FullName;
                            }
                            else
                            {
                                CommentText = string.Empty;
                                CommentDateTimeText = null;
                                CommentFullNameText = string.Empty;
                            }
                        }
                    }
                }
                else
                {
                    CustomMessageBox.Show(Application.Current.Resources["PLMDeleteProductTypeCommentNotAllowed"].ToString(), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                }

                GeosApplication.Instance.Logger.Log("Method DeleteCommentCommandAction() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method DeleteCommentRowCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }

        }


        //[Sudhir.Jangra][GEOS2-4935]
        private void CommentDoubleClickCommandAction(object obj)
        {
            GeosApplication.Instance.Logger.Log("Method CommentDoubleClickCommandAction()...", category: Category.Info, priority: Priority.Low);
            BasePriceLogEntry logcomments = (BasePriceLogEntry)obj;
            if (logcomments.IdUser == GeosApplication.Instance.ActiveUser.IdUser)
            {
                AddEditCommentsPLMView editCommentsView = new AddEditCommentsPLMView();
                AddEditCommentsPLMViewModel editCommentsViewModel = new AddEditCommentsPLMViewModel();
                EventHandler handle = delegate { editCommentsView.Close(); };
                editCommentsViewModel.RequestClose += handle;
                editCommentsViewModel.WindowHeader = System.Windows.Application.Current.FindResource("EditCommentsHeader").ToString();
                editCommentsViewModel.NewItemComment = SelectedComment.Comments;
                // editCommentsViewModel.IdLogEntryByCpType = SelectedComment.IdLogEntryByCptype;
                editCommentsView.DataContext = editCommentsViewModel;
                editCommentsView.ShowDialog();

                if (editCommentsViewModel.SelectedComment != null)
                {
                    SelectedComment.Comments = editCommentsViewModel.NewItemComment;
                    CommentsList.FirstOrDefault(s => s.IdLogEntryByBasePriceList == SelectedComment.IdLogEntryByBasePriceList).Comments = editCommentsViewModel.NewItemComment;
                    CommentsList.FirstOrDefault(s => s.IdLogEntryByBasePriceList == SelectedComment.IdLogEntryByBasePriceList).Datetime = GeosApplication.Instance.ServerDateTime;

                    if (UpdatedCommentsList == null)
                        UpdatedCommentsList = new List<BasePriceLogEntry>();

                    // editCommentsViewModel.SelectedComment.IdCPType = SelectedContacts.;
                    UpdatedCommentsList.Add(new BasePriceLogEntry()
                    {
                        IdUser = SelectedComment.IdUser,
                        IdBasePriceList = SelectedComment.IdBasePriceList,
                        Comments = SelectedComment.Comments,
                        Datetime = GeosApplication.Instance.ServerDateTime,
                        IdLogEntryByBasePriceList = SelectedComment.IdLogEntryByBasePriceList
                    });
                }
            }
            else
            {
                CustomMessageBox.Show(Application.Current.Resources["EditProductTypeCommentNotAllowed"].ToString(), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }

        }

        //[Sudhir.jangra][GEOS2-4935]
        private void SetUserProfileImage(ObservableCollection<BasePriceLogEntry> CommentsList)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method SetUserProfileImage ...", category: Category.Info, priority: Priority.Low);

                foreach (var item in CommentsList)
                {
                    UserProfileImageByte = GeosRepositoryServiceController.GetUserProfileImageWithoutException(item.People.Login);

                    if (UserProfileImageByte != null)
                        item.People.OwnerImage = ByteArrayToBitmapImage(UserProfileImageByte);
                    else
                    {
                        if (ApplicationThemeHelper.ApplicationThemeName == "BlackAndBlue")
                        {
                            //if (item.People.IdPersonGender == 1)
                            //    item.People.OwnerImage = GetImage("/Emdep.Geos.Modules.Crm;component/Assets/Images/FemaleUser_White.png");
                            //else if (item.People.IdPersonGender == 2)
                            //    item.People.OwnerImage = GetImage("/Emdep.Geos.Modules.Crm;component/Assets/Images/MaleUser_White.png");
                            //else if (item.People.IdPersonGender == null)
                            item.People.OwnerImage = GetImage("/Emdep.Geos.Modules.Crm;component/Assets/Images/wUnknownGender.png");

                        }
                        else
                        {
                            //if (item.People.IdPersonGender == 1)
                            //    item.People.OwnerImage = GetImage("/Emdep.Geos.Modules.Crm;component/Assets/Images/FemaleUser_Blue.png");
                            //else if (item.People.IdPersonGender == 2)
                            //    item.People.OwnerImage = GetImage("/Emdep.Geos.Modules.Crm;component/Assets/Images/MaleUser_Blue.png");
                            //else if (item.People.IdPersonGender == null)
                            item.People.OwnerImage = GetImage("/Emdep.Geos.Modules.Crm;component/Assets/Images/blueUnknownGender.png");
                        }
                    }
                }

                GeosApplication.Instance.Logger.Log("Method SetUserProfileImage() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in SetUserProfileImage() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), "Red", CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in SetUserProfileImage() Method - ServiceUnexceptedException " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in SetUserProfileImage() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        //[Sudhir.Jangra][GEOS2-4935]
        BitmapImage GetImage(string path)
        {
            //return new BitmapImage(new Uri(path, UriKind.Relative));
            BitmapImage image = new BitmapImage();
            image.BeginInit();
            image.UriSource = new Uri(path, UriKind.RelativeOrAbsolute);
            image.EndInit();
            return image;
        }

        ////[Sudhir.Jangra][GEOS2-4935]
        ///// <summary>
        ///// This method is for to convert from Bytearray to ImageSource
        ///// </summary>
        ///// <param name="byteArrayIn"></param>
        ///// <returns></returns>
        //public ImageSource ByteArrayToBitmapImage(byte[] byteArrayIn)
        //{
        //    try
        //    {
        //        GeosApplication.Instance.Logger.Log("Method convert byteArrayToImage ...", category: Category.Info, priority: Priority.Low);

        //        if (byteArrayIn == null || byteArrayIn.Length == 0) return null;
        //        var image = new BitmapImage();
        //        using (var mem = new System.IO.MemoryStream(byteArrayIn))
        //        {
        //            mem.Position = 0;
        //            image.BeginInit();
        //            image.CreateOptions = BitmapCreateOptions.PreservePixelFormat;
        //            image.CacheOption = BitmapCacheOption.OnLoad;
        //            image.UriSource = null;
        //            image.StreamSource = mem;
        //            image.EndInit();
        //        }

        //        image.Freeze();
        //        GeosApplication.Instance.Logger.Log("Method byteArrayToImage() executed successfully", category: Category.Info, priority: Priority.Low);

        //        return image;
        //    }
        //    catch (Exception ex)
        //    {
        //        GeosApplication.Instance.Logger.Log("Get an error in byteArrayToImage() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
        //    }

        //    return null;
        //}


        #endregion

        #region Bands
        private void AddColumnsToArticleDataTable()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method AddColumnsToArticleDataTable ...", category: Category.Info, priority: Priority.Low);
                if (SelectedSaleCurrency == null)
                    SelectedSaleCurrency = new List<object>();

                if (SelectedPlant == null)
                    SelectedPlant = new List<object>();

                if (SelectedCurrency == null)
                {
                    SelectedCurrency = new object();
                    SelectedCurrency_Copy = new object();
                }

                if (Bands.Count > 0)
                {
                    foreach (BandItem bandItem in Bands)
                    {

                        if (bandItem.BandHeader == "Plant")
                        {
                            foreach (Site plant in SelectedPlant)
                            {
                                if (!bandItem.Columns.Any(a => a.HeaderText == plant.Name))
                                {
                                    string fieldName = plant.Name;
                                    DtArticleCopy.Columns.Add(fieldName, typeof(double));
                                    bandItem.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = fieldName, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });
                                }
                            }
                            List<ColumnItem> columns = new List<ColumnItem>(bandItem.Columns);
                            if (bandItem.Columns.Count != SelectedPlant.Count)
                            {
                                foreach (ColumnItem columnItem in columns.ToList())
                                {
                                    if (!SelectedPlant.Cast<Site>().Any(a => a.Name == columnItem.HeaderText))
                                    {
                                        string fieldName = columnItem.HeaderText;
                                        DtArticleCopy.Columns.Remove(fieldName);
                                        bandItem.Columns.Remove(columnItem);
                                    }
                                }
                            }
                        }
                        else if (bandItem.BandHeader == "Max Cost")
                        {
                            if (((Currency)SelectedCurrency).Name != bandItem.Columns.FirstOrDefault().HeaderText)
                            {
                                string fieldName = bandItem.Columns.FirstOrDefault().ColumnFieldName;
                                DtArticleCopy.Columns.Remove(fieldName);
                                bandItem.Columns.Remove(bandItem.Columns.FirstOrDefault());

                                string fieldName2 = "MaxCost_1";
                                DtArticleCopy.Columns.Add(fieldName2, typeof(double));
                                bandItem.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName2, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });

                            }
                        }
                        else if (bandItem.BandHeader == "Sale Price")
                        {
                            foreach (Currency currency in SelectedSaleCurrency)
                            {
                                if (!bandItem.Columns.Any(a => a.HeaderText == currency.Name))
                                {
                                    string fieldName = currency.Name;
                                    DtArticleCopy.Columns.Add(fieldName, typeof(double));
                                    bandItem.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = fieldName, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                    DtArticleCopy.Columns.Add("CurrencyConversionRate_" + currency.Name, typeof(double));
                                }
                            }
                            List<ColumnItem> columns = new List<ColumnItem>(bandItem.Columns);
                            if (bandItem.Columns.Count != SelectedSaleCurrency.Count)
                            {
                                foreach (ColumnItem columnItem in columns.ToList())
                                {
                                    if (!SelectedSaleCurrency.Cast<Currency>().Any(a => a.Name == columnItem.HeaderText))
                                    {
                                        string fieldName = columnItem.HeaderText;
                                        DtArticleCopy.Columns.Remove(fieldName);
                                        bandItem.Columns.Remove(columnItem);

                                        DtArticleCopy.Columns.Remove("CurrencyConversionRate_" + fieldName);
                                    }
                                }
                            }
                            if (!SelectedSaleCurrency.Cast<Currency>().Any(a => a.Name == ((Currency)SelectedCurrency).Name))
                            {
                                SelectedSaleCurrency.Add(SaleCurrencyList.FirstOrDefault(a => a.Name == ((Currency)SelectedCurrency).Name));
                                SelectedSaleCurrency = new List<object>(SelectedSaleCurrency);
                                string fieldName = "Common_Cur";
                                DtArticleCopy.Columns.Remove(fieldName);
                                DtArticleCopy.Columns.Add(fieldName, typeof(double));
                                bandItem.Columns.Remove(bandItem.Columns.FirstOrDefault(a => a.ColumnFieldName == fieldName));
                                bandItem.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });

                                DtArticleCopy.Columns.Remove("CurrencyConversionRate_" + fieldName);
                                DtArticleCopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));


                                string fieldName1 = ((Currency)SelectedCurrency_Copy).Name;
                                DtArticleCopy.Columns.Add(fieldName1, typeof(double));
                                bandItem.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName1, HeaderText = fieldName1, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                DtArticleCopy.Columns.Add("CurrencyConversionRate_" + fieldName1, typeof(double));


                                SelectedSaleCurrency_Copy = SelectedSaleCurrency;
                            }
                        }
                    }

                    // reorder by common currency
                    BandItem item = Bands.FirstOrDefault(a => a.BandHeader == "Sale Price");
                    if (item.Columns.FirstOrDefault().HeaderText != ((Currency)SelectedCurrency).Name)
                    {
                        int count = 0;
                        foreach (Currency item1 in SelectedSaleCurrency.Cast<Currency>())
                        {
                            if (count == 0)
                            {
                                count = 1;
                                //string fieldName = ((Currency)SelectedCurrency).Name;
                                string fieldName = "Common_Cur";
                                DtArticleCopy.Columns.Remove(fieldName);
                                DtArticleCopy.Columns.Add(fieldName, typeof(double));
                                item.Columns.Remove(item.Columns.FirstOrDefault(a => a.ColumnFieldName == fieldName));
                                item.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                DtArticleCopy.Columns.Remove("CurrencyConversionRate_" + fieldName);
                                DtArticleCopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));


                                if (DtArticleCopy.Columns.Contains(((Currency)SelectedCurrency).Name))
                                    DtArticleCopy.Columns.Remove(((Currency)SelectedCurrency).Name);

                                if (DtArticleCopy.Columns.Contains("CurrencyConversionRate_" + ((Currency)SelectedCurrency).Name))
                                    DtArticleCopy.Columns.Remove("CurrencyConversionRate_" + ((Currency)SelectedCurrency).Name);

                                item.Columns.Remove(item.Columns.FirstOrDefault(a => a.ColumnFieldName == ((Currency)SelectedCurrency).Name));

                                if (item1.Name != ((Currency)SelectedCurrency).Name)
                                {
                                    string fieldName1 = item1.Name;
                                    if (DtArticleCopy.Columns.Contains(fieldName1))
                                        DtArticleCopy.Columns.Remove(fieldName1);

                                    DtArticleCopy.Columns.Add(fieldName1, typeof(double));
                                    item.Columns.Remove(item.Columns.FirstOrDefault(a => a.ColumnFieldName == fieldName1));
                                    item.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName1, HeaderText = fieldName1, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });

                                    if (DtArticleCopy.Columns.Contains("CurrencyConversionRate_" + fieldName1))
                                        DtArticleCopy.Columns.Remove("CurrencyConversionRate_" + fieldName1);

                                    DtArticleCopy.Columns.Add("CurrencyConversionRate_" + fieldName1, typeof(double));
                                }
                            }
                            else
                            {
                                if (item1.Name != ((Currency)SelectedCurrency).Name)
                                {
                                    string fieldName = item1.Name;
                                    if (DtArticleCopy.Columns.Contains(fieldName))
                                        DtArticleCopy.Columns.Remove(fieldName);

                                    DtArticleCopy.Columns.Add(fieldName, typeof(double));
                                    item.Columns.Remove(item.Columns.FirstOrDefault(a => a.ColumnFieldName == fieldName));
                                    item.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = fieldName, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });

                                    if (DtArticleCopy.Columns.Contains("CurrencyConversionRate_" + fieldName))
                                        DtArticleCopy.Columns.Remove("CurrencyConversionRate_" + fieldName);

                                    DtArticleCopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));
                                }
                            }
                        }
                    }
                    Bands = new ObservableCollection<BandItem>(Bands);
                }
                else
                {
                    Bands.Clear();
                    BandItem band1 = new BandItem() { BandName = "all", AllowBandMove = false, FixedStyle = FixedStyle.Left, Visible = true, AllowMoving = DevExpress.Utils.DefaultBoolean.False };
                    band1.Columns = new ObservableCollection<ColumnItem>();
                    band1.Columns.Add(new ColumnItem() { ColumnFieldName = "IsChecked", HeaderText = " ", Width = 30, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    band1.Columns.Add(new ColumnItem() { ColumnFieldName = "Reference", HeaderText = "Reference", Width = 100, IsVertical = false, Settings = SettingsType.Default, Visible = true });

                    Bands.Add(band1);
                    BandItem band2 = new BandItem() { BandName = "all1", Visible = true };
                    band2.Columns = new ObservableCollection<ColumnItem>();
                    band2.Columns.Add(new ColumnItem() { ColumnFieldName = "Name", HeaderText = "Name", Width = 350, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    band2.Columns.Add(new ColumnItem() { ColumnFieldName = "Category", HeaderText = "Category", Width = 100, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    band2.Columns.Add(new ColumnItem() { ColumnFieldName = "STAT", HeaderText = "STAT", Width = 40, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    //  band2.Columns.Add(new ColumnItem() { ColumnFieldName = "HtmlColor", HeaderText = "HtmlColor", Width = 10, Visible = false, IsVertical = false, Settings = SettingsType.Hidden });

                    Bands.Add(band2);

                    DtArticleCopy = new DataTable();
                    DtArticleCopy.Columns.Add("IsChecked", typeof(bool));
                    DtArticleCopy.Columns.Add("Reference", typeof(string));
                    DtArticleCopy.Columns.Add("Category", typeof(string));
                    DtArticleCopy.Columns.Add("STAT", typeof(string));
                    DtArticleCopy.Columns.Add("HtmlColor", typeof(string));
                    DtArticleCopy.Columns.Add("Name", typeof(string));
                    DtArticleCopy.Columns.Add("IdArticle", typeof(UInt32));
                    DtArticleCopy.Columns.Add("CurrencyConversionDate", typeof(DateTime));
                    DtArticleCopy.Columns.Add("IsColor", typeof(bool)).DefaultValue = false;
                    DtArticleCopy.Columns.Add("IsUpdatedRow", typeof(bool)).DefaultValue = false;
                    DtArticleCopy.Columns.Add("SaleCurrencyConversionDate", typeof(string));


                    //plant
                    BandItem band3 = new BandItem() { BandName = "plant", BandHeader = "Plant", Visible = true };
                    band3.Columns = new ObservableCollection<ColumnItem>();

                    foreach (Site plant in SelectedPlant)
                    {
                        string fieldName = plant.Name;
                        DtArticleCopy.Columns.Add(fieldName, typeof(double));
                        band3.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = fieldName, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });
                    }

                    Bands.Add(band3);
                    //max cost
                    BandItem band4 = new BandItem() { BandName = "max Cost", BandHeader = "Max Cost", Visible = true };
                    band4.Columns = new ObservableCollection<ColumnItem>();
                    string fieldName2 = "MaxCost_1";
                    DtArticleCopy.Columns.Add(fieldName2, typeof(double));
                    band4.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName2, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });

                    Bands.Add(band4);
                    //rule
                    BandItem band5 = new BandItem() { BandName = "rule", BandHeader = "Rule", Visible = true };
                    band5.Columns = new ObservableCollection<ColumnItem>();

                    string fieldName3 = "Value";
                    DtArticleCopy.Columns.Add("Value", typeof(float));
                    band5.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName3, HeaderText = fieldName3, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });

                    string fieldName4 = "Logic";
                    DtArticleCopy.Columns.Add(fieldName4, typeof(int));
                    band5.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName4, HeaderText = fieldName4, Width = 50, Visible = true, IsVertical = false, Settings = SettingsType.Default });


                    Bands.Add(band5);

                    //Sale Currency
                    BandItem band6 = new BandItem() { BandName = "sale Price", BandHeader = "Sale Price", Visible = true };
                    band6.Columns = new ObservableCollection<ColumnItem>();
                    int count = 0;
                    foreach (Currency currency in SelectedSaleCurrency)
                    {
                        // code modified for reorder by common currency 
                        if (count == 0)
                        {
                            count = 1;
                            string fieldName = "Common_Cur";
                            DtArticleCopy.Columns.Add(fieldName, typeof(double));
                            band6.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                            DtArticleCopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));

                            if (currency.Name != ((Currency)SelectedCurrency).Name)
                            {
                                string fieldName1 = currency.Name;
                                DtArticleCopy.Columns.Add(fieldName1, typeof(double));
                                band6.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName1, HeaderText = fieldName1, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                DtArticleCopy.Columns.Add("CurrencyConversionRate_" + fieldName1, typeof(double));
                            }
                        }
                        else
                        {
                            if (currency.Name != ((Currency)SelectedCurrency).Name)
                            {
                                string fieldName1 = currency.Name;
                                DtArticleCopy.Columns.Add(fieldName1, typeof(double));
                                band6.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName1, HeaderText = fieldName1, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                DtArticleCopy.Columns.Add("CurrencyConversionRate_" + fieldName1, typeof(double));
                            }
                        }
                    }

                    //Profit
                    BandItem band7 = new BandItem() { BandName = "all2", Visible = true };
                    band7.Columns = new ObservableCollection<ColumnItem>();
                    string fieldName5 = "Profit";
                    DtArticleCopy.Columns.Add(fieldName5, typeof(double));
                    band7.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName5, HeaderText = "Profit", Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });

                    //Cost Margin
                    BandItem band8 = new BandItem() { BandName = "all3", Visible = true };
                    band8.Columns = new ObservableCollection<ColumnItem>();
                    string fieldName6 = "CostMargin";
                    DtArticleCopy.Columns.Add(fieldName6, typeof(double));
                    band8.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName6, HeaderText = "Cost Margin", Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });

                    BandItem band9 = new BandItem() { BandName = "all4", AllowBandMove = false, Visible = true, AllowMoving = DevExpress.Utils.DefaultBoolean.False };
                    band9.Columns = new ObservableCollection<ColumnItem>();
                    band9.Columns.Add(new ColumnItem() { ColumnFieldName = "Delete", HeaderText = " ", Width = 50, IsVertical = false, Settings = SettingsType.Default, Visible = true });



                    Bands.Add(band6);
                    Bands.Add(band7);
                    Bands.Add(band8);
                    Bands.Add(band9);
                    Bands = new ObservableCollection<BandItem>(Bands);
                }
                GeosApplication.Instance.Logger.Log("Method AddColumnsToArticleDataTable executed Successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in AddColumnsToArticleDataTable() method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), "Red", CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in AddColumnsToArticleDataTable() Method - ServiceUnexceptedException " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in AddColumnsToArticleDataTable() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        private void AddColumnsToDetectionDataTable()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method AddColumnsToDetectionDataTable ...", category: Category.Info, priority: Priority.Low);
                if (SelectedSaleCurrency == null)
                    SelectedSaleCurrency = new List<object>();

                if (SelectedCurrency == null)
                {
                    SelectedCurrency = new List<object>();
                }

                if (DetectionBands.Count > 0)
                {
                    foreach (BandItem bandItem in DetectionBands)
                    {
                        if (bandItem.BandHeader == "Max Cost")
                        {
                            if (((Currency)SelectedCurrency).Name != bandItem.Columns.FirstOrDefault().HeaderText)
                            {
                                string fieldName = bandItem.Columns.FirstOrDefault().ColumnFieldName;
                                DtDetectionCopy.Columns.Remove(fieldName);
                                bandItem.Columns.Remove(bandItem.Columns.FirstOrDefault());

                                string fieldName2 = "MaxCost_1";
                                DtDetectionCopy.Columns.Add(fieldName2, typeof(double));
                                bandItem.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName2, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.MaxCost });

                            }
                        }
                        else if (bandItem.BandHeader == "Sale Price")
                        {
                            foreach (Currency currency in SelectedSaleCurrency)
                            {
                                if (!bandItem.Columns.Any(a => a.HeaderText == currency.Name))
                                {
                                    string fieldName = currency.Name;
                                    DtDetectionCopy.Columns.Add(fieldName, typeof(double));
                                    bandItem.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = fieldName, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                    DtDetectionCopy.Columns.Add("CurrencyConversionRate_" + currency.Name, typeof(double));
                                }
                            }
                            List<ColumnItem> columns = new List<ColumnItem>(bandItem.Columns);
                            if (bandItem.Columns.Count != SelectedSaleCurrency.Count)
                            {
                                foreach (ColumnItem columnItem in columns.ToList())
                                {
                                    if (!SelectedSaleCurrency.Cast<Currency>().Any(a => a.Name == columnItem.HeaderText))
                                    {
                                        string fieldName = columnItem.HeaderText;
                                        DtDetectionCopy.Columns.Remove(fieldName);
                                        bandItem.Columns.Remove(columnItem);

                                        DtDetectionCopy.Columns.Remove("CurrencyConversionRate_" + fieldName);
                                    }
                                }
                            }
                            if (!SelectedSaleCurrency.Cast<Currency>().Any(a => a.Name == ((Currency)SelectedCurrency).Name))
                            {
                                SelectedSaleCurrency.Add(SaleCurrencyList.FirstOrDefault(a => a.Name == ((Currency)SelectedCurrency).Name));
                                SelectedSaleCurrency = new List<object>(SelectedSaleCurrency);
                                string fieldName = "Common_Cur";
                                DtDetectionCopy.Columns.Remove(fieldName);
                                DtDetectionCopy.Columns.Add(fieldName, typeof(double));
                                bandItem.Columns.Remove(bandItem.Columns.FirstOrDefault(a => a.ColumnFieldName == fieldName));
                                bandItem.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });

                                DtDetectionCopy.Columns.Remove("CurrencyConversionRate_" + fieldName);
                                DtDetectionCopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));


                                string fieldName1 = ((Currency)SelectedCurrency_Copy).Name;
                                DtDetectionCopy.Columns.Add(fieldName1, typeof(double));
                                bandItem.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName1, HeaderText = fieldName1, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                DtDetectionCopy.Columns.Add("CurrencyConversionRate_" + fieldName1, typeof(double));

                                SelectedSaleCurrency_Copy = SelectedSaleCurrency;
                            }
                        }
                    }

                    // reorder by common currency
                    BandItem item = DetectionBands.FirstOrDefault(a => a.BandHeader == "Sale Price");
                    if (item.Columns.FirstOrDefault().HeaderText != ((Currency)SelectedCurrency).Name)
                    {
                        int count = 0;
                        foreach (Currency item1 in SelectedSaleCurrency.Cast<Currency>())
                        {
                            if (count == 0)
                            {
                                count = 1;
                                //string fieldName = ((Currency)SelectedCurrency).Name;
                                string fieldName = "Common_Cur";
                                DtDetectionCopy.Columns.Remove(fieldName);
                                DtDetectionCopy.Columns.Add(fieldName, typeof(double));
                                item.Columns.Remove(item.Columns.FirstOrDefault(a => a.ColumnFieldName == fieldName));
                                item.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                DtDetectionCopy.Columns.Remove("CurrencyConversionRate_" + fieldName);
                                DtDetectionCopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));

                                if (DtDetectionCopy.Columns.Contains(((Currency)SelectedCurrency).Name))
                                    DtDetectionCopy.Columns.Remove(((Currency)SelectedCurrency).Name);

                                if (DtDetectionCopy.Columns.Contains("CurrencyConversionRate_" + ((Currency)SelectedCurrency).Name))
                                    DtDetectionCopy.Columns.Remove("CurrencyConversionRate_" + ((Currency)SelectedCurrency).Name);

                                item.Columns.Remove(item.Columns.FirstOrDefault(a => a.ColumnFieldName == ((Currency)SelectedCurrency).Name));

                                if (item1.Name != ((Currency)SelectedCurrency).Name)
                                {
                                    string fieldName1 = item1.Name;
                                    if (DtDetectionCopy.Columns.Contains(fieldName1))
                                        DtDetectionCopy.Columns.Remove(fieldName1);

                                    DtDetectionCopy.Columns.Add(fieldName1, typeof(double));
                                    item.Columns.Remove(item.Columns.FirstOrDefault(a => a.ColumnFieldName == fieldName1));
                                    item.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName1, HeaderText = fieldName1, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });

                                    if (DtDetectionCopy.Columns.Contains("CurrencyConversionRate_" + fieldName1))
                                        DtDetectionCopy.Columns.Remove("CurrencyConversionRate_" + fieldName1);

                                    DtDetectionCopy.Columns.Add("CurrencyConversionRate_" + fieldName1, typeof(double));
                                }
                            }
                            else
                            {
                                if (item1.Name != ((Currency)SelectedCurrency).Name)
                                {
                                    string fieldName = item1.Name;
                                    if (DtDetectionCopy.Columns.Contains(fieldName))
                                        DtDetectionCopy.Columns.Remove(fieldName);

                                    DtDetectionCopy.Columns.Add(fieldName, typeof(double));
                                    item.Columns.Remove(item.Columns.FirstOrDefault(a => a.ColumnFieldName == fieldName));
                                    item.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = fieldName, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });

                                    if (DtDetectionCopy.Columns.Contains("CurrencyConversionRate_" + fieldName))
                                        DtDetectionCopy.Columns.Remove("CurrencyConversionRate_" + fieldName);

                                    DtDetectionCopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));
                                }
                            }
                        }
                    }
                    DetectionBands = new ObservableCollection<BandItem>(DetectionBands);
                }
                else
                {
                    DetectionBands.Clear();
                    DtDetectionCopy = new DataTable();

                    BandItem band1 = new BandItem() { BandName = "all5", AllowBandMove = false, FixedStyle = FixedStyle.Left, Visible = true, AllowMoving = DevExpress.Utils.DefaultBoolean.False };
                    band1.Columns = new ObservableCollection<ColumnItem>();
                    band1.Columns.Add(new ColumnItem() { ColumnFieldName = "IsChecked", HeaderText = " ", Width = 50, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    band1.Columns.Add(new ColumnItem() { ColumnFieldName = "Code", HeaderText = "Code", Width = 100, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    DetectionBands.Add(band1);

                    BandItem band2 = new BandItem() { BandName = "all6", Visible = true };
                    band2.Columns = new ObservableCollection<ColumnItem>();
                    band2.Columns.Add(new ColumnItem() { ColumnFieldName = "Name", HeaderText = "Name", Width = 350, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    band2.Columns.Add(new ColumnItem() { ColumnFieldName = "Type", HeaderText = "Type", Width = 100, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    band2.Columns.Add(new ColumnItem() { ColumnFieldName = "STAT", HeaderText = "STAT", Width = 40, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    //  band2.Columns.Add(new ColumnItem() { ColumnFieldName = "HtmlColor", HeaderText = "HtmlColor", Width = 10, Visible = false, IsVertical = false, Settings = SettingsType.Hidden });

                    DetectionBands.Add(band2);

                    DtDetectionCopy.Columns.Add("IsChecked", typeof(bool));
                    DtDetectionCopy.Columns.Add("Code", typeof(string));
                    DtDetectionCopy.Columns.Add("Type", typeof(string));
                    DtDetectionCopy.Columns.Add("STAT", typeof(string));
                    DtDetectionCopy.Columns.Add("HtmlColor", typeof(string));
                    DtDetectionCopy.Columns.Add("Name", typeof(string));
                    DtDetectionCopy.Columns.Add("IdDetection", typeof(UInt32));
                    DtDetectionCopy.Columns.Add("CurrencyConversionDate", typeof(DateTime));
                    DtDetectionCopy.Columns.Add("IsColor", typeof(bool)).DefaultValue = false;
                    DtDetectionCopy.Columns.Add("IsUpdatedRow", typeof(bool)).DefaultValue = false;
                    DtDetectionCopy.Columns.Add("SaleCurrencyConversionDate", typeof(string));


                    //Max Cost
                    BandItem band3 = new BandItem() { BandName = "max Cost", BandHeader = "Max Cost", Visible = true };
                    band3.Columns = new ObservableCollection<ColumnItem>();
                    string fieldName2 = "MaxCost_1";
                    DtDetectionCopy.Columns.Add(fieldName2, typeof(double));
                    band3.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName2, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.MaxCost });
                    DetectionBands.Add(band3);

                    //rule
                    BandItem band4 = new BandItem() { BandName = "rule", BandHeader = "Rule", Visible = true };
                    band4.Columns = new ObservableCollection<ColumnItem>();

                    string fieldName3 = "Value";
                    DtDetectionCopy.Columns.Add("Value", typeof(float));
                    band4.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName3, HeaderText = fieldName3, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });

                    string fieldName4 = "Logic";
                    DtDetectionCopy.Columns.Add(fieldName4, typeof(int));
                    band4.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName4, HeaderText = fieldName4, Width = 50, Visible = true, IsVertical = false, Settings = SettingsType.Default });

                    DetectionBands.Add(band4);

                    //Sale Currency
                    BandItem band5 = new BandItem() { BandName = "sale Price", BandHeader = "Sale Price", Visible = true };
                    band5.Columns = new ObservableCollection<ColumnItem>();
                    int count = 0;
                    foreach (Currency currency in SelectedSaleCurrency)
                    {
                        // code modified for reorder by common currency 
                        if (count == 0)
                        {
                            count = 1;
                            string fieldName = "Common_Cur";
                            DtDetectionCopy.Columns.Add(fieldName, typeof(double));
                            band5.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                            DtDetectionCopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));

                            if (currency.Name != ((Currency)SelectedCurrency).Name)
                            {
                                string fieldName1 = currency.Name;
                                DtDetectionCopy.Columns.Add(fieldName1, typeof(double));
                                band5.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName1, HeaderText = fieldName1, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                DtDetectionCopy.Columns.Add("CurrencyConversionRate_" + fieldName1, typeof(double));
                            }
                        }
                        else
                        {
                            if (currency.Name != ((Currency)SelectedCurrency).Name)
                            {
                                string fieldName1 = currency.Name;
                                DtDetectionCopy.Columns.Add(fieldName1, typeof(double));
                                band5.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName1, HeaderText = fieldName1, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                DtDetectionCopy.Columns.Add("CurrencyConversionRate_" + fieldName1, typeof(double));
                            }
                        }
                    }

                    DetectionBands.Add(band5);

                    //Profit
                    BandItem band6 = new BandItem() { BandName = "all7", Visible = true };
                    band6.Columns = new ObservableCollection<ColumnItem>();
                    string fieldName5 = "Profit";
                    DtDetectionCopy.Columns.Add(fieldName5, typeof(double));
                    band6.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName5, HeaderText = "Profit", Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });
                    DetectionBands.Add(band6);

                    //Cost Margin
                    BandItem band7 = new BandItem() { BandName = "all8", Visible = true };
                    band7.Columns = new ObservableCollection<ColumnItem>();
                    string fieldName6 = "CostMargin";
                    DtDetectionCopy.Columns.Add(fieldName6, typeof(double));
                    band7.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName6, HeaderText = "Cost Margin", Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });
                    DetectionBands.Add(band7);

                    // Delete Button
                    BandItem band8 = new BandItem() { BandName = "all9", AllowBandMove = false, Visible = true, AllowMoving = DevExpress.Utils.DefaultBoolean.False };
                    band8.Columns = new ObservableCollection<ColumnItem>();
                    band8.Columns.Add(new ColumnItem() { ColumnFieldName = "Delete", HeaderText = " ", Width = 50, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    DetectionBands.Add(band8);

                    DetectionBands = new ObservableCollection<BandItem>(DetectionBands);
                }
                GeosApplication.Instance.Logger.Log("Method AddColumnsToDetectionDataTable executed Successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in AddColumnsToDetectionDataTable() method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), "Red", CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in AddColumnsToDetectionDataTable() Method - ServiceUnexceptedException " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in AddColumnsToDetectionDataTable() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        private void FillArticleData()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillArticleData ...", category: Category.Info, priority: Priority.Low);
                double SellPriceValue = 0;
                if (DtArticleCopy == null)
                    DtArticleCopy = new DataTable();

                for (int j = 0; j < ArticleList.Count; j++)
                {
                    try
                    {
                        DataRow dr = DtArticleCopy.NewRow();
                        dr["IsChecked"] = false;
                        dr["Reference"] = ArticleList[j].ArticleData.Reference;
                        dr["Category"] = ArticleList[j].ArticleData.PcmArticleCategory.Name;
                        dr["STAT"] = ArticleList[j].ArticleData.PcmArticleCategory.StatusAbbreviation;
                        dr["HtmlColor"] = ArticleList[j].ArticleData.PcmArticleCategory.StatusHtmlColor;
                        dr["Name"] = ArticleList[j].ArticleData.Description;
                        dr["IdArticle"] = ArticleList[j].IdArticle;
                        dr["Logic"] = ArticleList[j].IdRule;
                        dr["Value"] = ArticleList[j].RuleValue;
                        if (ArticleList[j].IdRule == 1518)
                        {
                            dr["Value"] = 0;
                        }
                        else if (ArticleList[j].IdRule == 308)
                        {
                            if (ArticleList[j].RuleValue == 0)
                            {
                                dr["Value"] = DBNull.Value;
                            }
                        }
                        else
                        {
                            if (ArticleList[j].IdRule == 0)
                            {
                                dr["Value"] = DBNull.Value;
                            }
                        }
                        // dr["MaxCost_1"] = ArticleList[j].MaxCost;
                        double Cost_Value = 0;

                        foreach (Site plant in SelectedPlant)
                        {
                            ArticleCostPrice Cost = ArticleCostPriceList.FirstOrDefault(a => a.IdCompany == plant.IdSite && a.IdArticle == Convert.ToUInt32(dr["IdArticle"]));
                            if (Cost == null)
                            {
                                Cost = new ArticleCostPrice();
                            }
                            dr[plant.Name] = Cost.ArticleCostValue;

                            if (dr["MaxCost_1"] == DBNull.Value)
                            {
                                dr["MaxCost_1"] = Cost.ArticleCostValue;
                                Cost_Value = Cost.ArticleCostValue;
                            }
                            if (Cost_Value < Cost.ArticleCostValue)
                            {
                                dr["MaxCost_1"] = Cost.ArticleCostValue;
                                Cost_Value = Cost.ArticleCostValue;
                            }
                        }

                        dr["MaxCost_1"] = Cost_Value;

                        dr["CurrencyConversionDate"] = CurrencyConversionList.FirstOrDefault().LastUpdate;

                        if (dr["MaxCost_1"] == DBNull.Value)
                        {
                            dr["MaxCost_1"] = 0;
                        }

                        if (Convert.ToInt32(dr["Logic"]) == 307)
                        {
                            if (dr["Value"] == DBNull.Value)
                                dr["Value"] = 0;
                            dr["Common_Cur"] = Convert.ToDouble(dr["MaxCost_1"]) + ((Convert.ToDouble(dr["MaxCost_1"]) * (Convert.ToDouble(dr["Value"]) / 100)));

                            foreach (Currency currency in SelectedSaleCurrency)
                            {
                                if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                {
                                    CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                    if (CurConversion1 != null)
                                    {
                                        if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                            dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                        else
                                            dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                    }

                                    if (dr["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && dr["CurrencyConversionRate_" + "Common_Cur"] != null && dr["CurrencyConversionRate_" + "Common_Cur"] != "")
                                    {
                                        dr["Common_Cur"] = Convert.ToDouble(dr["Common_Cur"]) * Convert.ToDouble(dr["CurrencyConversionRate_" + "Common_Cur"]);
                                    }
                                    else
                                        dr["Common_Cur"] = DBNull.Value;
                                }
                                else
                                {
                                    CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                    if (CurConversion1 != null)
                                    {
                                        if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                            dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.ExchangeRate;
                                        else
                                            dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.LastMonthAVGRate;
                                    }

                                    if (dr["CurrencyConversionRate_" + currency.Name] != DBNull.Value && dr["CurrencyConversionRate_" + currency.Name] != null && dr["CurrencyConversionRate_" + currency.Name] != "")
                                    {
                                        dr[currency.Name] = Convert.ToDouble(dr["Common_Cur"]) * Convert.ToDouble(dr["CurrencyConversionRate_" + currency.Name]);
                                    }
                                    else
                                        dr[currency.Name] = DBNull.Value;
                                }

                            }
                        }
                        else if (Convert.ToInt32(dr["Logic"]) == 308)
                        {
                            if (dr["Value"] == null || dr["Value"] == DBNull.Value)
                            {
                                dr["Value"] = DBNull.Value;

                                dr["Common_Cur"] = DBNull.Value;

                                foreach (Currency cur in SelectedSaleCurrency)
                                {
                                    if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                    {
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == cur.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                            else
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                        }

                                        dr["Common_Cur"] = DBNull.Value;
                                    }
                                    else
                                    {
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == cur.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                dr["CurrencyConversionRate_" + cur.Name] = CurConversion1.ExchangeRate;
                                            else
                                                dr["CurrencyConversionRate_" + cur.Name] = CurConversion1.LastMonthAVGRate;
                                        }

                                        dr[cur.Name] = DBNull.Value;
                                    }
                                }
                            }
                            else if (dr["Value"] != null && Convert.ToDouble(dr["Value"]) <= 0)
                            {
                                dr["Value"] = DBNull.Value;

                                dr["Common_Cur"] = DBNull.Value;

                                foreach (Currency cur in SelectedSaleCurrency)
                                {
                                    if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                    {
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == cur.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                            else
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                        }

                                        dr["Common_Cur"] = DBNull.Value;
                                    }
                                    else
                                    {
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == cur.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                dr["CurrencyConversionRate_" + cur.Name] = CurConversion1.ExchangeRate;
                                            else
                                                dr["CurrencyConversionRate_" + cur.Name] = CurConversion1.LastMonthAVGRate;
                                        }

                                        dr[cur.Name] = DBNull.Value;
                                    }
                                }
                            }
                            else
                            {
                                dr["Common_Cur"] = dr["Value"];
                                foreach (Currency currency in SelectedSaleCurrency)
                                {
                                    if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                    {
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                            else
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                        }
                                        if (dr["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && dr["CurrencyConversionRate_" + "Common_Cur"] != null && dr["CurrencyConversionRate_" + "Common_Cur"] != "")
                                        {
                                            dr["Common_Cur"] = Convert.ToDouble(dr["Common_Cur"]) * Convert.ToDouble(dr["CurrencyConversionRate_" + "Common_Cur"]);
                                        }
                                        else
                                            dr["Common_Cur"] = DBNull.Value;
                                    }
                                    else
                                    {
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.ExchangeRate;
                                            else
                                                dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.LastMonthAVGRate;
                                        }
                                        if (dr["CurrencyConversionRate_" + currency.Name] != DBNull.Value && dr["CurrencyConversionRate_" + currency.Name] != null && dr["CurrencyConversionRate_" + currency.Name] != "")
                                        {
                                            dr[currency.Name] = Convert.ToDouble(dr["Common_Cur"]) * Convert.ToDouble(dr["CurrencyConversionRate_" + currency.Name]);
                                        }
                                        else
                                            dr[currency.Name] = DBNull.Value;
                                    }
                                }
                            }
                        }
                        else if (Convert.ToInt32(dr["Logic"]) == 1518)
                        {
                            if (dr["Value"] == null || dr["Value"] == DBNull.Value)
                            {
                                dr["Value"] = 0;
                            }
                            dr["Common_Cur"] = 0;
                            foreach (Currency currency in SelectedSaleCurrency)
                            {
                                if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                {
                                    CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                    if (CurConversion1 != null)
                                    {
                                        if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                            dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                        else
                                            dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                    }

                                    dr["Common_Cur"] = 0;
                                }
                                else
                                {
                                    CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                    if (CurConversion1 != null)
                                    {
                                        if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                            dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.ExchangeRate;
                                        else
                                            dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.LastMonthAVGRate;
                                    }

                                    dr[currency.Name] = 0;
                                }
                            }
                        }
                        else if (Convert.ToInt32(dr["Logic"]) == 309)
                        {
                            if (dr["Value"] == DBNull.Value)
                                dr["Common_Cur"] = Convert.ToDouble(dr["MaxCost_1"]);
                            else
                                dr["Common_Cur"] = Convert.ToDouble(dr["MaxCost_1"]) + (Convert.ToDouble(dr["Value"]));

                            foreach (Currency currency in SelectedSaleCurrency)
                            {
                                if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                {
                                    CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                    if (CurConversion1 != null)
                                    {
                                        if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                            dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                        else
                                            dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                    }

                                    if (dr["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && dr["CurrencyConversionRate_" + "Common_Cur"] != null && dr["CurrencyConversionRate_" + "Common_Cur"] != "")
                                    {
                                        dr["Common_Cur"] = Convert.ToDouble(dr["Common_Cur"]) * Convert.ToDouble(dr["CurrencyConversionRate_" + "Common_Cur"]);
                                    }
                                    else
                                        dr["Common_Cur"] = DBNull.Value;
                                }
                                else
                                {
                                    CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                    if (CurConversion1 != null)
                                    {
                                        if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                            dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.ExchangeRate;
                                        else
                                            dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.LastMonthAVGRate;
                                    }

                                    if (dr["CurrencyConversionRate_" + currency.Name] != DBNull.Value && dr["CurrencyConversionRate_" + currency.Name] != null && dr["CurrencyConversionRate_" + currency.Name] != "")
                                    {
                                        dr[currency.Name] = Convert.ToDouble(dr["Common_Cur"]) * Convert.ToDouble(dr["CurrencyConversionRate_" + currency.Name]);
                                    }
                                    else
                                        dr[currency.Name] = DBNull.Value;
                                }
                            }
                        }


                        if (dr["Common_Cur"] != DBNull.Value)
                            SellPriceValue = Convert.ToDouble(dr["Common_Cur"]);
                        else
                            SellPriceValue = 0.00;



                        dr["Profit"] = Convert.ToDouble(CalculateBasePriceProfitValue(Cost_Value, SellPriceValue));

                        dr["CostMargin"] = Convert.ToDouble(CalculateBasePriceCostMarginValue(Cost_Value, SellPriceValue));
                        if (dr["CurrencyConversionDate"] != DBNull.Value)
                        {
                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                            {
                                // dr["SaleCurrencyConversionDate"] = "Updated currency rate on : " + Convert.ToDateTime(dr["CurrencyConversionDate"]).ToString("dd/MM/yyyy");
                                dr["SaleCurrencyConversionDate"] = "Updated currency rate on : " + Convert.ToDateTime(LastUpdated).ToString("dd/MM/yyyy");
                            }
                            else
                            {
                                DateTime dtCurrencyConversionDate = new DateTime(Convert.ToDateTime(dr["CurrencyConversionDate"]).Year, Convert.ToDateTime(dr["CurrencyConversionDate"]).Month, 1);
                                dr["SaleCurrencyConversionDate"] = "Updated currency rate on : " + dtCurrencyConversionDate.ToString("dd/MM/yyyy");
                            }
                        }
                        DtArticleCopy.Rows.Add(dr);
                        DtArticle = DtArticleCopy;
                    }
                    catch (Exception ex)
                    {
                        GeosApplication.Instance.Logger.Log("Get an error in FillArticleData() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
                    }
                }
                GeosApplication.Instance.Logger.Log("Method FillArticleData() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in FillArticleData() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), "Red", CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in FillArticleData() Method - ServiceUnexceptedException " + ex.Message, category: Category.Info, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillArticleData() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        //[cpatil][001][25-02-2022][GEOS2-3564]
        private void FillDetectionData()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillDetectionData ...", category: Category.Info, priority: Priority.Low);
                double SellPriceValue = 0;

                if (DtDetectionCopy == null)
                    DtDetectionCopy = new DataTable();
                if (DetectionList == null)
                    DetectionList = new ObservableCollection<BasePriceListByItem>();

                for (int j = 0; j < DetectionList.Count; j++)
                {
                    try
                    {
                        DataRow dr = DtDetectionCopy.NewRow();
                        dr["IsChecked"] = false;

                        if (string.IsNullOrEmpty(DetectionList[j].Detection.Code)) //[001]
                            dr["Code"] = "---";
                        else
                            dr["Code"] = DetectionList[j].Detection.Code;

                        dr["Type"] = DetectionList[j].Detection.DetectionTypes.Name;
                        dr["STAT"] = DetectionList[j].Detection.StatusAbbreviation;
                        dr["HtmlColor"] = DetectionList[j].Detection.StatusHtmlColor;
                        dr["Name"] = DetectionList[j].Detection.Name;
                        dr["IdDetection"] = DetectionList[j].IdDetection;
                        dr["Logic"] = DetectionList[j].IdRule;
                        dr["Value"] = DetectionList[j].RuleValue;
                        if (DetectionList[j].IdRule == 1518)
                        {
                            dr["Value"] = 0;
                        }
                        else if (DetectionList[j].IdRule == 308)
                        {
                            if (DetectionList[j].RuleValue == 0)
                            {
                                dr["Value"] = DBNull.Value;
                            }
                        }
                        else
                        {
                            if (DetectionList[j].IdRule == 0)
                            {
                                dr["Value"] = DBNull.Value;
                            }
                        }
                        dr["MaxCost_1"] = DetectionList[j].MaxCost;

                        dr["CurrencyConversionDate"] = CurrencyConversionList.FirstOrDefault().LastUpdate;

                        if (dr["MaxCost_1"] == DBNull.Value)
                        {
                            dr["MaxCost_1"] = 0;
                        }

                        if (dr["Logic"] == DBNull.Value)
                        {
                            dr["Logic"] = 308;
                        }

                        if (Convert.ToInt32(dr["Logic"]) == 307)
                        {
                            if (dr["Value"] == DBNull.Value)
                                dr["Value"] = 0;
                            dr["Common_Cur"] = Convert.ToDouble(dr["MaxCost_1"]) + ((Convert.ToDouble(dr["MaxCost_1"]) * (Convert.ToDouble(dr["Value"]) / 100)));

                            foreach (Currency currency in SelectedSaleCurrency)
                            {
                                if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                {
                                    CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                    if (CurConversion1 != null)
                                    {
                                        if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                            dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                        else
                                            dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                    }

                                    if (dr["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && dr["CurrencyConversionRate_" + "Common_Cur"] != null && dr["CurrencyConversionRate_" + "Common_Cur"] != "")
                                    {
                                        dr["Common_Cur"] = Convert.ToDouble(dr["Common_Cur"]) * Convert.ToDouble(dr["CurrencyConversionRate_" + "Common_Cur"]);
                                    }
                                    else
                                        dr["Common_Cur"] = DBNull.Value;
                                }
                                else
                                {
                                    CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                    if (CurConversion1 != null)
                                    {
                                        if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                            dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.ExchangeRate;
                                        else
                                            dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.LastMonthAVGRate;
                                    }

                                    if (dr["CurrencyConversionRate_" + currency.Name] != DBNull.Value && dr["CurrencyConversionRate_" + currency.Name] != null && dr["CurrencyConversionRate_" + currency.Name] != "")
                                    {
                                        dr[currency.Name] = Convert.ToDouble(dr["Common_Cur"]) * Convert.ToDouble(dr["CurrencyConversionRate_" + currency.Name]);
                                    }
                                    else
                                        dr[currency.Name] = DBNull.Value;
                                }

                            }
                        }
                        else if (Convert.ToInt32(dr["Logic"]) == 308)
                        {
                            if (dr["Value"] == null || dr["Value"] == DBNull.Value)
                            {
                                dr["Value"] = DBNull.Value;

                                dr["Common_Cur"] = DBNull.Value;

                                foreach (Currency cur in SelectedSaleCurrency)
                                {
                                    if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                    {
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == cur.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                            else
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                        }

                                        dr["Common_Cur"] = DBNull.Value;
                                    }
                                    else
                                    {
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == cur.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                dr["CurrencyConversionRate_" + cur.Name] = CurConversion1.ExchangeRate;
                                            else
                                                dr["CurrencyConversionRate_" + cur.Name] = CurConversion1.LastMonthAVGRate;
                                        }

                                        dr[cur.Name] = DBNull.Value;
                                    }
                                }
                            }
                            else if (dr["Value"] != null && Convert.ToDouble(dr["Value"]) <= 0)
                            {
                                dr["Value"] = DBNull.Value;

                                dr["Common_Cur"] = DBNull.Value;

                                foreach (Currency cur in SelectedSaleCurrency)
                                {
                                    if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                    {
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == cur.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                            else
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                        }

                                        dr["Common_Cur"] = DBNull.Value;
                                    }
                                    else
                                    {
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == cur.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                dr["CurrencyConversionRate_" + cur.Name] = CurConversion1.ExchangeRate;
                                            else
                                                dr["CurrencyConversionRate_" + cur.Name] = CurConversion1.LastMonthAVGRate;
                                        }

                                        dr[cur.Name] = DBNull.Value;
                                    }
                                }
                            }
                            else
                            {
                                dr["Common_Cur"] = dr["Value"];
                                foreach (Currency currency in SelectedSaleCurrency)
                                {
                                    if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                    {
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                            else
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                        }
                                        if (dr["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && dr["CurrencyConversionRate_" + "Common_Cur"] != null && dr["CurrencyConversionRate_" + "Common_Cur"] != "")
                                        {
                                            dr["Common_Cur"] = Convert.ToDouble(dr["Common_Cur"]) * Convert.ToDouble(dr["CurrencyConversionRate_" + "Common_Cur"]);
                                        }
                                        else
                                            dr["Common_Cur"] = DBNull.Value;
                                    }
                                    else
                                    {
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.ExchangeRate;
                                            else
                                                dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.LastMonthAVGRate;
                                        }
                                        if (dr["CurrencyConversionRate_" + currency.Name] != DBNull.Value && dr["CurrencyConversionRate_" + currency.Name] != null && dr["CurrencyConversionRate_" + currency.Name] != "")
                                        {
                                            dr[currency.Name] = Convert.ToDouble(dr["Common_Cur"]) * Convert.ToDouble(dr["CurrencyConversionRate_" + currency.Name]);
                                        }
                                        else
                                            dr[currency.Name] = DBNull.Value;
                                    }
                                }
                            }
                        }
                        else if (Convert.ToInt32(dr["Logic"]) == 1518)
                        {
                            if (dr["Value"] == null || dr["Value"] == DBNull.Value)
                            {
                                dr["Value"] = 0;
                            }
                            dr["Common_Cur"] = 0;
                            foreach (Currency currency in SelectedSaleCurrency)
                            {
                                if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                {
                                    CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                    if (CurConversion1 != null)
                                    {
                                        if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                            dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                        else
                                            dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                    }

                                    dr["Common_Cur"] = 0;
                                }
                                else
                                {
                                    CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                    if (CurConversion1 != null)
                                    {
                                        if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                            dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.ExchangeRate;
                                        else
                                            dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.LastMonthAVGRate;
                                    }

                                    dr[currency.Name] = 0;
                                }
                            }
                        }
                        else if (Convert.ToInt32(dr["Logic"]) == 309)
                        {
                            if (dr["Value"] == DBNull.Value)
                                dr["Common_Cur"] = Convert.ToDouble(dr["MaxCost_1"]);
                            else
                                dr["Common_Cur"] = Convert.ToDouble(dr["MaxCost_1"]) + (Convert.ToDouble(dr["Value"]));

                            foreach (Currency currency in SelectedSaleCurrency)
                            {
                                if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                {
                                    CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                    if (CurConversion1 != null)
                                    {
                                        if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                            dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                        else
                                            dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                    }

                                    if (dr["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && dr["CurrencyConversionRate_" + "Common_Cur"] != null && dr["CurrencyConversionRate_" + "Common_Cur"] != "")
                                    {
                                        dr["Common_Cur"] = Convert.ToDouble(dr["Common_Cur"]) * Convert.ToDouble(dr["CurrencyConversionRate_" + "Common_Cur"]);
                                    }
                                    else
                                        dr["Common_Cur"] = DBNull.Value;
                                }
                                else
                                {
                                    CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                    if (CurConversion1 != null)
                                    {
                                        if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                            dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.ExchangeRate;
                                        else
                                            dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.LastMonthAVGRate;
                                    }

                                    if (dr["CurrencyConversionRate_" + currency.Name] != DBNull.Value && dr["CurrencyConversionRate_" + currency.Name] != null && dr["CurrencyConversionRate_" + currency.Name] != "")
                                    {
                                        dr[currency.Name] = Convert.ToDouble(dr["Common_Cur"]) * Convert.ToDouble(dr["CurrencyConversionRate_" + currency.Name]);
                                    }
                                    else
                                        dr[currency.Name] = DBNull.Value;
                                }
                            }
                        }


                        if (dr["Common_Cur"] != DBNull.Value)
                            SellPriceValue = Convert.ToDouble(dr["Common_Cur"]);
                        else
                            SellPriceValue = 0.00;

                        dr["Profit"] = Convert.ToDouble(CalculateBasePriceProfitValue(DetectionList[j].MaxCost, SellPriceValue));

                        dr["CostMargin"] = Convert.ToDouble(CalculateBasePriceCostMarginValue(DetectionList[j].MaxCost, SellPriceValue));
                        if (dr["CurrencyConversionDate"] != DBNull.Value)
                        {
                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                            {
                                //dr["SaleCurrencyConversionDate"] = "Updated currency rate on : " + Convert.ToDateTime(dr["CurrencyConversionDate"]).ToString("dd/MM/yyyy");
                                dr["SaleCurrencyConversionDate"] = "Updated currency rate on : " + Convert.ToDateTime(LastUpdated).ToString("dd/MM/yyyy");
                            }
                            else
                            {
                                DateTime dtCurrencyConversionDate = new DateTime(Convert.ToDateTime(dr["CurrencyConversionDate"]).Year, Convert.ToDateTime(dr["CurrencyConversionDate"]).Month, 1);
                                dr["SaleCurrencyConversionDate"] = "Updated currency rate on : " + dtCurrencyConversionDate.ToString("dd/MM/yyyy");
                            }
                        }
                        DtDetectionCopy.Rows.Add(dr);
                        DtDetection = DtDetectionCopy;
                    }
                    catch (Exception ex)
                    {
                        GeosApplication.Instance.Logger.Log("Get an error in FillDetectionData() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
                    }
                }
                GeosApplication.Instance.Logger.Log("Method FillDetectionData() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in FillDetectionData() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), "Red", CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in FillDetectionData() Method - ServiceUnexceptedException " + ex.Message, category: Category.Info, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillDetectionData() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        private void FillModuleData()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillDetectionData ...", category: Category.Info, priority: Priority.Low);
                double SellPriceValue = 0;

                if (DtModuleCopy == null)
                    DtModuleCopy = new DataTable();
                if (ModuleList == null)
                    ModuleList = new ObservableCollection<BasePriceListByItem>();

                for (int j = 0; j < ModuleList.Count; j++)
                {
                    try
                    {
                        DataRow dr = DtModuleCopy.NewRow();
                        dr["IsChecked"] = false;

                        if (string.IsNullOrEmpty(ModuleList[j].ProductType.Code)) //[001]
                            dr["Code"] = "---";
                        else
                            dr["Code"] = ModuleList[j].ProductType.Code;

                        dr["Type"] = ModuleList[j].ProductType.Template.Name;
                        dr["STAT"] = ModuleList[j].ProductType.StatusAbbreviation;
                        dr["HtmlColor"] = ModuleList[j].ProductType.StatusHtmlColor;
                        dr["Name"] = ModuleList[j].ProductType.Name;
                        dr["IdCPType"] = ModuleList[j].IdCPType;
                        dr["Logic"] = ModuleList[j].IdRule;
                        dr["Value"] = ModuleList[j].RuleValue;
                        if (ModuleList[j].IdRule == 1518)
                        {
                            dr["Value"] = 0;
                        }
                        else if (ModuleList[j].IdRule == 308)
                        {
                            if (ModuleList[j].RuleValue == 0)
                            {
                                dr["Value"] = DBNull.Value;
                            }
                        }
                        else
                        {
                            if (ModuleList[j].IdRule == 0)
                            {
                                dr["Value"] = DBNull.Value;
                            }
                        }
                        dr["MaxCost_1"] = ModuleList[j].MaxCost;

                        dr["CurrencyConversionDate"] = CurrencyConversionList.FirstOrDefault().LastUpdate;

                        if (dr["MaxCost_1"] == DBNull.Value)
                        {
                            dr["MaxCost_1"] = 0;
                        }

                        if (dr["Logic"] == DBNull.Value)
                        {
                            dr["Logic"] = 308;
                        }

                        if (Convert.ToInt32(dr["Logic"]) == 307)
                        {
                            if (dr["Value"] == DBNull.Value)
                                dr["Value"] = 0;
                            dr["Common_Cur"] = Convert.ToDouble(dr["MaxCost_1"]) + ((Convert.ToDouble(dr["MaxCost_1"]) * (Convert.ToDouble(dr["Value"]) / 100)));

                            foreach (Currency currency in SelectedSaleCurrency)
                            {
                                if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                {
                                    CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                    if (CurConversion1 != null)
                                    {
                                        if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                            dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                        else
                                            dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                    }

                                    if (dr["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && dr["CurrencyConversionRate_" + "Common_Cur"] != null && dr["CurrencyConversionRate_" + "Common_Cur"] != "")
                                    {
                                        dr["Common_Cur"] = Convert.ToDouble(dr["Common_Cur"]) * Convert.ToDouble(dr["CurrencyConversionRate_" + "Common_Cur"]);
                                    }
                                    else
                                        dr["Common_Cur"] = DBNull.Value;
                                }
                                else
                                {
                                    CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                    if (CurConversion1 != null)
                                    {
                                        if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                            dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.ExchangeRate;
                                        else
                                            dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.LastMonthAVGRate;
                                    }

                                    if (dr["CurrencyConversionRate_" + currency.Name] != DBNull.Value && dr["CurrencyConversionRate_" + currency.Name] != null && dr["CurrencyConversionRate_" + currency.Name] != "")
                                    {
                                        dr[currency.Name] = Convert.ToDouble(dr["Common_Cur"]) * Convert.ToDouble(dr["CurrencyConversionRate_" + currency.Name]);
                                    }
                                    else
                                        dr[currency.Name] = DBNull.Value;
                                }

                            }
                        }
                        else if (Convert.ToInt32(dr["Logic"]) == 308)
                        {
                            if (dr["Value"] == null || dr["Value"] == DBNull.Value)
                            {
                                dr["Value"] = DBNull.Value;

                                dr["Common_Cur"] = DBNull.Value;

                                foreach (Currency cur in SelectedSaleCurrency)
                                {
                                    if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                    {
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == cur.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                            else
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                        }

                                        dr["Common_Cur"] = DBNull.Value;
                                    }
                                    else
                                    {
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == cur.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                dr["CurrencyConversionRate_" + cur.Name] = CurConversion1.ExchangeRate;
                                            else
                                                dr["CurrencyConversionRate_" + cur.Name] = CurConversion1.LastMonthAVGRate;
                                        }

                                        dr[cur.Name] = DBNull.Value;
                                    }
                                }
                            }
                            else if (dr["Value"] != null && Convert.ToDouble(dr["Value"]) <= 0)
                            {
                                dr["Value"] = DBNull.Value;

                                dr["Common_Cur"] = DBNull.Value;

                                foreach (Currency cur in SelectedSaleCurrency)
                                {
                                    if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                    {
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == cur.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                            else
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                        }

                                        dr["Common_Cur"] = DBNull.Value;
                                    }
                                    else
                                    {
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == cur.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                dr["CurrencyConversionRate_" + cur.Name] = CurConversion1.ExchangeRate;
                                            else
                                                dr["CurrencyConversionRate_" + cur.Name] = CurConversion1.LastMonthAVGRate;
                                        }

                                        dr[cur.Name] = DBNull.Value;
                                    }
                                }
                            }
                            else
                            {
                                dr["Common_Cur"] = dr["Value"];
                                foreach (Currency currency in SelectedSaleCurrency)
                                {
                                    if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                    {
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                            else
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                        }
                                        if (dr["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && dr["CurrencyConversionRate_" + "Common_Cur"] != null && dr["CurrencyConversionRate_" + "Common_Cur"] != "")
                                        {
                                            dr["Common_Cur"] = Convert.ToDouble(dr["Common_Cur"]) * Convert.ToDouble(dr["CurrencyConversionRate_" + "Common_Cur"]);
                                        }
                                        else
                                            dr["Common_Cur"] = DBNull.Value;
                                    }
                                    else
                                    {
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.ExchangeRate;
                                            else
                                                dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.LastMonthAVGRate;
                                        }
                                        if (dr["CurrencyConversionRate_" + currency.Name] != DBNull.Value && dr["CurrencyConversionRate_" + currency.Name] != null && dr["CurrencyConversionRate_" + currency.Name] != "")
                                        {
                                            dr[currency.Name] = Convert.ToDouble(dr["Common_Cur"]) * Convert.ToDouble(dr["CurrencyConversionRate_" + currency.Name]);
                                        }
                                        else
                                            dr[currency.Name] = DBNull.Value;
                                    }
                                }
                            }
                        }
                        else if (Convert.ToInt32(dr["Logic"]) == 1518)
                        {
                            if (dr["Value"] == null || dr["Value"] == DBNull.Value)
                            {
                                dr["Value"] = 0;
                            }
                            dr["Common_Cur"] = 0;
                            foreach (Currency currency in SelectedSaleCurrency)
                            {
                                if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                {
                                    CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                    if (CurConversion1 != null)
                                    {
                                        if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                            dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                        else
                                            dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                    }

                                    dr["Common_Cur"] = 0;
                                }
                                else
                                {
                                    CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                    if (CurConversion1 != null)
                                    {
                                        if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                            dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.ExchangeRate;
                                        else
                                            dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.LastMonthAVGRate;
                                    }

                                    dr[currency.Name] = 0;
                                }
                            }
                        }
                        else if (Convert.ToInt32(dr["Logic"]) == 309)
                        {
                            if (dr["Value"] == DBNull.Value)
                                dr["Common_Cur"] = Convert.ToDouble(dr["MaxCost_1"]);
                            else
                                dr["Common_Cur"] = Convert.ToDouble(dr["MaxCost_1"]) + (Convert.ToDouble(dr["Value"]));

                            foreach (Currency currency in SelectedSaleCurrency)
                            {
                                if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                {
                                    CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                    if (CurConversion1 != null)
                                    {
                                        if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                            dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                        else
                                            dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                    }

                                    if (dr["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && dr["CurrencyConversionRate_" + "Common_Cur"] != null && dr["CurrencyConversionRate_" + "Common_Cur"] != "")
                                    {
                                        dr["Common_Cur"] = Convert.ToDouble(dr["Common_Cur"]) * Convert.ToDouble(dr["CurrencyConversionRate_" + "Common_Cur"]);
                                    }
                                    else
                                        dr["Common_Cur"] = DBNull.Value;
                                }
                                else
                                {
                                    CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                    if (CurConversion1 != null)
                                    {
                                        if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                            dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.ExchangeRate;
                                        else
                                            dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.LastMonthAVGRate;
                                    }

                                    if (dr["CurrencyConversionRate_" + currency.Name] != DBNull.Value && dr["CurrencyConversionRate_" + currency.Name] != null && dr["CurrencyConversionRate_" + currency.Name] != "")
                                    {
                                        dr[currency.Name] = Convert.ToDouble(dr["Common_Cur"]) * Convert.ToDouble(dr["CurrencyConversionRate_" + currency.Name]);
                                    }
                                    else
                                        dr[currency.Name] = DBNull.Value;
                                }
                            }
                        }


                        if (dr["Common_Cur"] != DBNull.Value)
                            SellPriceValue = Convert.ToDouble(dr["Common_Cur"]);
                        else
                            SellPriceValue = 0.00;

                        dr["Profit"] = Convert.ToDouble(CalculateBasePriceProfitValue(ModuleList[j].MaxCost, SellPriceValue));

                        dr["CostMargin"] = Convert.ToDouble(CalculateBasePriceCostMarginValue(ModuleList[j].MaxCost, SellPriceValue));
                        if (dr["CurrencyConversionDate"] != DBNull.Value)
                        {
                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                            {
                                //dr["SaleCurrencyConversionDate"] = "Updated currency rate on : " + Convert.ToDateTime(dr["CurrencyConversionDate"]).ToString("dd/MM/yyyy");
                                dr["SaleCurrencyConversionDate"] = "Updated currency rate on : " + Convert.ToDateTime(LastUpdated).ToString("dd/MM/yyyy");
                            }
                            else
                            {
                                DateTime dtCurrencyConversionDate = new DateTime(Convert.ToDateTime(dr["CurrencyConversionDate"]).Year, Convert.ToDateTime(dr["CurrencyConversionDate"]).Month, 1);
                                dr["SaleCurrencyConversionDate"] = "Updated currency rate on : " + dtCurrencyConversionDate.ToString("dd/MM/yyyy");
                            }
                        }
                        DtModuleCopy.Rows.Add(dr);
                        DtModule = DtModuleCopy;
                    }
                    catch (Exception ex)
                    {
                        GeosApplication.Instance.Logger.Log("Get an error in FillDetectionData() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
                    }
                }
                GeosApplication.Instance.Logger.Log("Method FillModuleData() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in FillModuleData() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), "Red", CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in FillModuleData() Method - ServiceUnexceptedException " + ex.Message, category: Category.Info, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillModuleData() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        private double CalculateBasePriceProfitValue(double MaxCost, double SellPriceValue)
        {
            double Profit = 0;
            try
            {
                //GeosApplication.Instance.Logger.Log("Method CalculateBasePriceArticlesProfitValue() ...", category: Category.Info, priority: Priority.Low);

                if ((SellPriceValue == 0 && MaxCost == 0) || (SellPriceValue == MaxCost) || (SellPriceValue == 0 && MaxCost > 0))
                    Profit = 0.00;
                else
                    Profit = Convert.ToDouble(((((SellPriceValue) - (MaxCost)) / (SellPriceValue)) * 100));

                Profit = Math.Round(Profit, 2);

                //GeosApplication.Instance.Logger.Log("Method CalculateBasePriceArticlesProfitValue() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in CalculateBasePriceArticlesProfitValue() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
            return Profit;
        }

        private double CalculateBasePriceCostMarginValue(double MaxCost, double SellPriceValue)
        {
            double CostMargin = 0;
            try
            {
                //GeosApplication.Instance.Logger.Log("Method CalculateBasePriceArticlesCostMarginValue() ...", category: Category.Info, priority: Priority.Low);

                if ((MaxCost == 0 && SellPriceValue == 0) || (MaxCost == SellPriceValue) || (MaxCost == 0 && SellPriceValue > 0))
                    CostMargin = 0.00;
                else
                    CostMargin = Convert.ToDouble(((((SellPriceValue) - (MaxCost)) / (MaxCost)) * 100));

                CostMargin = Math.Round(CostMargin, 2);

                //GeosApplication.Instance.Logger.Log("Method CalculateBasePriceArticlesCostMarginValue() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in CalculateBasePriceArticlesCostMarginValue() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
            return CostMargin;
        }

        private void FillLogicList()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillLogicList ...", category: Category.Info, priority: Priority.Low);

                #region Old code
                //IList<LookupValue> tempLogicList = PCMService.GetLookupValues(63);
                //LogicList = new List<LookupValue>();
                //LogicList = new List<LookupValue>(tempLogicList);
                //SelectedLogic = LogicList.FirstOrDefault();
                //SelectedStatusIndex = LogicList.FindIndex(x => x.IdLookupValue == 308);
                #endregion

                //[pramod.misal][16.04.2025][GEOS2-6688]
                if (PLMCommon.Instance.TempLogicList == null || PLMCommon.Instance.TempLogicList?.Count == 0)
                {
                    PLMCommon.Instance.TempLogicList = PCMService.GetLookupValues(63);

                }
                if (PLMCommon.Instance.TempLogicList != null)
                {
                    IList<LookupValue> tempLogicList = PLMCommon.Instance.TempLogicList;
                    LogicList = new List<LookupValue>();
                    LogicList = new List<LookupValue>(tempLogicList);
                }
                SelectedLogic = LogicList.FirstOrDefault();
                SelectedStatusIndex = LogicList.FindIndex(x => x.IdLookupValue == 308);


                GeosApplication.Instance.Logger.Log("Method FillLogicList() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in FillLogicList() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), "Red", CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in FillLogicList() Method - ServiceUnexceptedException " + ex.Message, category: Category.Info, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillLogicList() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        //GEOS2-6688 PCM- Improve performance to open BPL grid and any BPL
        private void FillArticleCostPriceListNew()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillArticleCostPriceListNew ...", category: Category.Info, priority: Priority.Low);
                //PLMService = new PLMServiceController("localhost:6699");
                DateTime start = DateTime.Now;
                if (ArticleCostPriceList == null)
                {
                    ArticleCostPriceList = new List<ArticleCostPrice>(PLMService.GetArticleCostPricesByCurrency_V2160(((Currency)SelectedCurrency).IdCurrency));
                }
                DateTime end = DateTime.Now;
                TimeSpan timeDifference = end - start;
                //PLMService = new PLMServiceController(GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString());
                GeosApplication.Instance.Logger.Log("Method FillArticleCostPriceListNew() executed successfully " + $"Total Seconds: {timeDifference.TotalSeconds}", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in FillArticleCostPriceListNew() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), "Red", CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in FillArticleCostPriceListNew() Method - ServiceUnexceptedException " + ex.Message, category: Category.Info, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillArticleCostPriceListNew() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }


        private void FillArticleCostPriceList()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillArticleCostPriceList ...", category: Category.Info, priority: Priority.Low);

                ArticleCostPriceList = new List<ArticleCostPrice>(PLMService.GetArticleCostPricesByCurrency_V2160(((Currency)SelectedCurrency).IdCurrency));
                GeosApplication.Instance.Logger.Log("Method FillArticleCostPriceList() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in FillArticleCostPriceList() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), "Red", CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in FillArticleCostPriceList() Method - ServiceUnexceptedException " + ex.Message, category: Category.Info, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillArticleCostPriceList() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        private void FillCurrencyConversionList(DateTime CurDate)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillCurrencyConversionList ...", category: Category.Info, priority: Priority.Low);

                CurrencyConversionList = new List<CurrencyConversion>(PLMService.GetCurrencyConversionsByCurrency_V2140(((Currency)SelectedCurrency).IdCurrency, CurDate));
                GeosApplication.Instance.Logger.Log("Method FillCurrencyConversionList() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in FillCurrencyConversionList() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), "Red", CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in FillCurrencyConversionList() Method - ServiceUnexceptedException " + ex.Message, category: Category.Info, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillCurrencyConversionList() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        public void CalculateBasePriceArticlesByLogicValue(bool isExchangeRate = false)
        {
            try
            {
                if (DtArticle != null && DtArticle.Rows.Count > 0)
                {
                    int IndexselectedCurrencyName_ = DtArticle.Columns.IndexOf("MaxCost_1");
                    int indexIdArticle = DtArticle.Columns.IndexOf("IdArticle");
                    int indexCurrencyConversionDate = DtArticle.Columns.IndexOf("CurrencyConversionDate");
                    int indexValue = DtArticle.Columns.IndexOf("Value");
                    int indexLogic = DtArticle.Columns.IndexOf("Logic");

                    int indexProfit = DtArticle.Columns.IndexOf("Profit");
                    int indexCost = DtArticle.Columns.IndexOf("CostMargin");

                    int indexTooltipDate = DtArticle.Columns.IndexOf("SaleCurrencyConversionDate");

                    int indexSelectedCurrency = DtArticle.Columns.IndexOf("Common_Cur");

                    List<CurrencyConversion> filterConversionDate = new List<CurrencyConversion>();
                    if (CurrencyConversionList != null && CurrencyConversionList.Count > 0)
                        filterConversionDate = CurrencyConversionList.Where(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency)).ToList();

                    int indexIsUpdatedRow = DtArticle.Columns.IndexOf("IsUpdatedRow");

                    for (int j = 0; j < DtArticle.Rows.Count; j++)
                    {
                        try
                        {


                            DtArticle.Rows[j].BeginEdit();
                            UInt64 idArticle = Convert.ToUInt64(DtArticle.Rows[j][indexIdArticle]);
                            double? value = null;
                            Int32? logic = null;
                            DateTime? indexCurrencyConversionDateValue = null;
                            double IndexselectedCurrencyName_Value = 0;
                            double indexSelectedCurrencyvalue = 0;
                            if (DtArticle.Rows[j][indexSelectedCurrency] != DBNull.Value)
                                indexSelectedCurrencyvalue = Convert.ToDouble(DtArticle.Rows[j][indexSelectedCurrency]);
                            if (DtArticle.Rows[j][indexValue] != DBNull.Value)
                                value = Convert.ToInt32(DtArticle.Rows[j][indexValue]);
                            if (DtArticle.Rows[j][indexLogic] != DBNull.Value)
                                logic = Convert.ToInt32(DtArticle.Rows[j][indexLogic]);
                            if (DtArticle.Rows[j][IndexselectedCurrencyName_] != DBNull.Value)
                                IndexselectedCurrencyName_Value = Convert.ToDouble(DtArticle.Rows[j][IndexselectedCurrencyName_]);
                            if (DtArticle.Rows[j][indexSelectedCurrency] != DBNull.Value)

                                DtArticle.Rows[j][indexIsUpdatedRow] = true;


                            if (logic == 1518)
                            {
                                value = 0;
                            }
                            else if (logic == 308)
                            {
                                if (value == 0)
                                {
                                    value = null;
                                }
                            }
                            else
                            {
                                if (logic == 0)
                                {
                                    value = null;
                                }
                            }

                            double Cost_Value = 0;
                            double SellPriceValue = 0.00;

                            if (isExchangeRate == false)
                            {
                                DtArticle.Rows[j][IndexselectedCurrencyName_] = DBNull.Value;

                                foreach (Site plant in SelectedPlant)
                                {
                                    ArticleCostPrice Cost = ArticleCostPriceList.FirstOrDefault(a => a.IdCompany == plant.IdSite && a.IdArticle == idArticle);
                                    if (Cost == null)
                                    {
                                        Cost = new ArticleCostPrice();
                                    }
                                    DtArticle.Rows[j][plant.Name] = Cost.ArticleCostValue;
                                    if (DtArticle.Rows[j][IndexselectedCurrencyName_] == DBNull.Value)
                                    {
                                        DtArticle.Rows[j][IndexselectedCurrencyName_] = Cost.ArticleCostValue;
                                        Cost_Value = Cost.ArticleCostValue;
                                    }
                                    if (Cost_Value < Cost.ArticleCostValue)
                                    {
                                        DtArticle.Rows[j][IndexselectedCurrencyName_] = Cost.ArticleCostValue;
                                        Cost_Value = Cost.ArticleCostValue;
                                    }
                                }

                                if (DtArticle.Rows[j][IndexselectedCurrencyName_] == DBNull.Value)
                                {
                                    DtArticle.Rows[j][IndexselectedCurrencyName_] = 0;
                                }

                                IndexselectedCurrencyName_Value = Cost_Value;
                            }
                            else
                            {
                                Cost_Value = IndexselectedCurrencyName_Value;
                            }

                            indexCurrencyConversionDateValue = CurrencyConversionList.FirstOrDefault().LastUpdate;
                            DtArticle.Rows[j][indexCurrencyConversionDate] = indexCurrencyConversionDateValue;


                            foreach (Currency currency in SelectedSaleCurrency)
                            {
                                if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                {
                                    Int32 IndexSelectedSaleCurrency = DtArticle.Columns.IndexOf("CurrencyConversionRate_" + "Common_Cur");
                                    Int32 IndexCurrencyName = DtArticle.Columns.IndexOf("Common_Cur");
                                    DtArticle.Rows[j][IndexCurrencyName] = DBNull.Value;
                                    CurrencyConversion CurConversion1 = null;
                                    if (indexCurrencyConversionDateValue != null)
                                    {
                                        CurConversion1 = filterConversionDate.FirstOrDefault(x => x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == indexCurrencyConversionDateValue.Value.Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (DtArticle.Rows[j][indexValue] != DBNull.Value)
                                                value = Convert.ToInt32(DtArticle.Rows[j][indexValue]);
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                DtArticle.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                            else
                                                DtArticle.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;

                                            if (value != null)
                                            {
                                                if (logic == 307)
                                                {
                                                    DtArticle.Rows[j][indexSelectedCurrency] = IndexselectedCurrencyName_Value + (IndexselectedCurrencyName_Value * (value / 100));
                                                    if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                        DtArticle.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtArticle.Rows[j][indexSelectedCurrency]) * CurConversion1.ExchangeRate;
                                                    else
                                                        DtArticle.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtArticle.Rows[j][indexSelectedCurrency]) * CurConversion1.LastMonthAVGRate;
                                                }
                                                else if (logic == 308)
                                                {
                                                    if (DtArticle.Rows[j][indexValue] == null || DtArticle.Rows[j][indexValue] == DBNull.Value)
                                                    {
                                                        DtArticle.Rows[j][indexValue] = DBNull.Value;

                                                        DtArticle.Rows[j][indexSelectedCurrency] = DBNull.Value;

                                                        DtArticle.Rows[j][IndexCurrencyName] = DBNull.Value;
                                                    }
                                                    else if (DtArticle.Rows[j][indexValue] != null && Convert.ToDouble(DtArticle.Rows[j][indexValue]) <= 0)
                                                    {
                                                        DtArticle.Rows[j][indexValue] = DBNull.Value;

                                                        DtArticle.Rows[j][indexSelectedCurrency] = DBNull.Value;

                                                        DtArticle.Rows[j][IndexCurrencyName] = DBNull.Value;
                                                    }
                                                    else
                                                    {
                                                        DtArticle.Rows[j][indexSelectedCurrency] = DtArticle.Rows[j][indexValue];
                                                        if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                            DtArticle.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtArticle.Rows[j][indexSelectedCurrency]) * CurConversion1.ExchangeRate;
                                                        else
                                                            DtArticle.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtArticle.Rows[j][indexSelectedCurrency]) * CurConversion1.LastMonthAVGRate;
                                                    }
                                                }
                                                else if (logic == 1518)
                                                {

                                                    if (DtArticle.Rows[j][indexValue] == null || DtArticle.Rows[j][indexValue] == DBNull.Value)
                                                    {
                                                        DtArticle.Rows[j][indexValue] = 0;

                                                        DtArticle.Rows[j][indexSelectedCurrency] = 0;

                                                        DtArticle.Rows[j][IndexCurrencyName] = 0;
                                                    }
                                                    else if (DtArticle.Rows[j][indexValue] != null)
                                                    {
                                                        DtArticle.Rows[j][indexValue] = 0;

                                                        DtArticle.Rows[j][indexSelectedCurrency] = 0;

                                                        DtArticle.Rows[j][IndexCurrencyName] = 0;
                                                    }

                                                }
                                                else if (logic == 309)
                                                {
                                                    DtArticle.Rows[j][indexSelectedCurrency] = IndexselectedCurrencyName_Value + (value);
                                                    if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                        DtArticle.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtArticle.Rows[j][indexSelectedCurrency]) * CurConversion1.ExchangeRate;
                                                    else
                                                        DtArticle.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtArticle.Rows[j][indexSelectedCurrency]) * CurConversion1.LastMonthAVGRate;
                                                }
                                            }
                                        }
                                    }
                                }
                                else
                                {
                                    Int32 IndexSelectedSaleCurrency = DtArticle.Columns.IndexOf("CurrencyConversionRate_" + currency.Name);
                                    Int32 IndexCurrencyName = DtArticle.Columns.IndexOf(currency.Name);
                                    DtArticle.Rows[j][IndexCurrencyName] = DBNull.Value;
                                    CurrencyConversion CurConversion1 = null;
                                    if (indexCurrencyConversionDateValue != null)
                                    {
                                        CurConversion1 = filterConversionDate.FirstOrDefault(x => x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == indexCurrencyConversionDateValue.Value.Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (DtArticle.Rows[j][indexValue] != DBNull.Value)
                                                value = Convert.ToInt32(DtArticle.Rows[j][indexValue]);
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                DtArticle.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                            else
                                                DtArticle.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;

                                            if (value != null)
                                            {
                                                if (logic == 307)
                                                {
                                                    DtArticle.Rows[j][indexSelectedCurrency] = IndexselectedCurrencyName_Value + (IndexselectedCurrencyName_Value * (value / 100));
                                                    if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                        DtArticle.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtArticle.Rows[j][indexSelectedCurrency]) * CurConversion1.ExchangeRate;
                                                    else
                                                        DtArticle.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtArticle.Rows[j][indexSelectedCurrency]) * CurConversion1.LastMonthAVGRate;
                                                }
                                                else if (logic == 308)
                                                {
                                                    if (DtArticle.Rows[j][indexValue] == null || DtArticle.Rows[j][indexValue] == DBNull.Value)
                                                    {
                                                        DtArticle.Rows[j][indexValue] = DBNull.Value;

                                                        DtArticle.Rows[j][indexSelectedCurrency] = DBNull.Value;

                                                        DtArticle.Rows[j][IndexCurrencyName] = DBNull.Value;
                                                    }
                                                    else if (DtArticle.Rows[j][indexValue] != null && Convert.ToDouble(DtArticle.Rows[j][indexValue]) <= 0)
                                                    {
                                                        DtArticle.Rows[j][indexValue] = DBNull.Value;

                                                        DtArticle.Rows[j][indexSelectedCurrency] = DBNull.Value;

                                                        DtArticle.Rows[j][IndexCurrencyName] = DBNull.Value;
                                                    }
                                                    else
                                                    {
                                                        DtArticle.Rows[j][indexSelectedCurrency] = DtArticle.Rows[j][indexValue];
                                                        if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                            DtArticle.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtArticle.Rows[j][indexSelectedCurrency]) * CurConversion1.ExchangeRate;
                                                        else
                                                            DtArticle.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtArticle.Rows[j][indexSelectedCurrency]) * CurConversion1.LastMonthAVGRate;
                                                    }
                                                }
                                                else if (logic == 1518)
                                                {

                                                    if (DtArticle.Rows[j][indexValue] == null || DtArticle.Rows[j][indexValue] == DBNull.Value)
                                                    {
                                                        DtArticle.Rows[j][indexValue] = 0;

                                                        DtArticle.Rows[j][indexSelectedCurrency] = 0;

                                                        DtArticle.Rows[j][IndexCurrencyName] = 0;
                                                    }
                                                    else if (DtArticle.Rows[j][indexValue] != null)
                                                    {
                                                        DtArticle.Rows[j][indexValue] = 0;

                                                        DtArticle.Rows[j][indexSelectedCurrency] = 0;

                                                        DtArticle.Rows[j][IndexCurrencyName] = 0;
                                                    }

                                                }
                                                else if (logic == 309)
                                                {
                                                    DtArticle.Rows[j][indexSelectedCurrency] = IndexselectedCurrencyName_Value + (value);
                                                    if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                        DtArticle.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtArticle.Rows[j][indexSelectedCurrency]) * CurConversion1.ExchangeRate;
                                                    else
                                                        DtArticle.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtArticle.Rows[j][indexSelectedCurrency]) * CurConversion1.LastMonthAVGRate;
                                                }
                                            }
                                        }
                                    }
                                }
                            }

                            if (DtArticle.Rows[j][indexSelectedCurrency] == DBNull.Value)
                            {
                                SellPriceValue = 0.00;
                            }
                            else
                            {
                                SellPriceValue = Convert.ToDouble(DtArticle.Rows[j][indexSelectedCurrency]);
                            }
                            DtArticle.Rows[j][indexProfit] = CalculateBasePriceProfitValue(Cost_Value, SellPriceValue);
                            DtArticle.Rows[j][indexCost] = CalculateBasePriceCostMarginValue(Cost_Value, SellPriceValue);

                            if (DtArticle.Rows[j][indexCurrencyConversionDate] != DBNull.Value)
                            {
                                if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                {
                                    DtArticle.Rows[j][indexTooltipDate] = "Updated currency rate on : " + Convert.ToDateTime(DtArticle.Rows[j][indexCurrencyConversionDate]).ToString("dd/MM/yyyy");
                                }
                                else
                                {
                                    DateTime dtCurrencyConversionDate = new DateTime(Convert.ToDateTime(DtArticle.Rows[j][indexCurrencyConversionDate]).Year, Convert.ToDateTime(DtArticle.Rows[j][indexCurrencyConversionDate]).Month, 1);
                                    DtArticle.Rows[j][indexTooltipDate] = "Updated currency rate on : " + dtCurrencyConversionDate.ToString("dd/MM/yyyy");
                                }
                            }
                        }
                        catch (Exception ex)
                        {

                            GeosApplication.Instance.Logger.Log(string.Format("Error in method CalculateBasePriceArticlesByLogicValue() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                        }
                    }

                    DtArticle.AcceptChanges();
                }
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method CalculateBasePriceArticlesByLogicValue() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        public void CalculateBasePriceDetectionsByLogicValue()
        {
            try
            {

                if (DtDetection != null && DtDetection.Rows.Count > 0)
                {
                    int IndexselectedCurrencyName_ = DtDetection.Columns.IndexOf("MaxCost_1");
                    int indexIdDetection = DtDetection.Columns.IndexOf("IdDetection");
                    int indexCurrencyConversionDate = DtDetection.Columns.IndexOf("CurrencyConversionDate");
                    int indexValue = DtDetection.Columns.IndexOf("Value");
                    int indexLogic = DtDetection.Columns.IndexOf("Logic");

                    int indexProfit = DtDetection.Columns.IndexOf("Profit");
                    int indexCost = DtDetection.Columns.IndexOf("CostMargin");
                    int indexIsUpdatedRow = DtDetection.Columns.IndexOf("IsUpdatedRow");
                    int indexTooltipDate = DtDetection.Columns.IndexOf("SaleCurrencyConversionDate");


                    int indexSelectedCurrency = DtDetection.Columns.IndexOf("Common_Cur");

                    List<CurrencyConversion> filterConversionDate = new List<CurrencyConversion>();
                    if (CurrencyConversionList != null && CurrencyConversionList.Count > 0)
                        filterConversionDate = CurrencyConversionList.Where(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency)).ToList();


                    for (int j = 0; j < DtDetection.Rows.Count; j++)
                    {
                        try
                        {
                            DtDetection.Rows[j].BeginEdit();
                            UInt64 idDetection = Convert.ToUInt64(DtDetection.Rows[j][indexIdDetection]);
                            double? value = null;
                            Int32? logic = null;
                            DateTime? indexCurrencyConversionDateValue = null;
                            double IndexselectedCurrencyName_Value = 0;
                            double IndexselectedCurrencyNameValue = 0;
                            double indexSelectedCurrencyvalue = 0;
                            if (DtDetection.Rows[j][indexSelectedCurrency] != DBNull.Value)
                                indexSelectedCurrencyvalue = Convert.ToDouble(DtDetection.Rows[j][indexSelectedCurrency]);
                            if (DtDetection.Rows[j][indexValue] != DBNull.Value)
                                value = Convert.ToInt32(DtDetection.Rows[j][indexValue]);
                            if (DtDetection.Rows[j][indexLogic] != DBNull.Value)
                                logic = Convert.ToInt32(DtDetection.Rows[j][indexLogic]);
                            if (DtDetection.Rows[j][IndexselectedCurrencyName_] != DBNull.Value)
                                IndexselectedCurrencyName_Value = Convert.ToDouble(DtDetection.Rows[j][IndexselectedCurrencyName_]);
                            if (DtDetection.Rows[j][indexSelectedCurrency] != DBNull.Value)
                                IndexselectedCurrencyNameValue = Convert.ToDouble(DtDetection.Rows[j][indexSelectedCurrency]);

                            DtDetection.Rows[j][indexIsUpdatedRow] = true;

                            if (logic == 1518)
                            {
                                value = 0;
                            }
                            else if (logic == 308)
                            {
                                if (value == 0)
                                {
                                    value = null;
                                }
                            }
                            else
                            {
                                if (logic == 0)
                                {
                                    value = null;
                                }
                            }

                            double Cost_Value = 0;
                            double SellPriceValue = 0.00;

                            indexCurrencyConversionDateValue = CurrencyConversionList.FirstOrDefault().LastUpdate;
                            DtDetection.Rows[j][indexCurrencyConversionDate] = indexCurrencyConversionDateValue;


                            Cost_Value = IndexselectedCurrencyName_Value;

                            foreach (Currency currency in SelectedSaleCurrency)
                            {
                                if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                {
                                    Int32 IndexSelectedSaleCurrency = DtDetection.Columns.IndexOf("CurrencyConversionRate_" + "Common_Cur");
                                    Int32 IndexCurrencyName = DtDetection.Columns.IndexOf("Common_Cur");
                                    DtDetection.Rows[j][IndexCurrencyName] = DBNull.Value;
                                    CurrencyConversion CurConversion1 = null;
                                    if (indexCurrencyConversionDateValue != null)
                                    {
                                        CurConversion1 = filterConversionDate.FirstOrDefault(x => x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == indexCurrencyConversionDateValue.Value.Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (DtDetection.Rows[j][indexValue] != DBNull.Value)
                                                value = Convert.ToInt32(DtDetection.Rows[j][indexValue]);
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                DtDetection.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                            else
                                                DtDetection.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                            if (value != null)
                                            {
                                                if (logic == 307)
                                                {
                                                    DtDetection.Rows[j][indexSelectedCurrency] = IndexselectedCurrencyName_Value + (IndexselectedCurrencyName_Value * (value / 100));
                                                    if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                        DtDetection.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtDetection.Rows[j][indexSelectedCurrency]) * CurConversion1.ExchangeRate;
                                                    else
                                                        DtDetection.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtDetection.Rows[j][indexSelectedCurrency]) * CurConversion1.LastMonthAVGRate;
                                                }
                                                else if (logic == 308)
                                                {
                                                    if (DtDetection.Rows[j][indexValue] == null || DtDetection.Rows[j][indexValue] == DBNull.Value)
                                                    {
                                                        DtDetection.Rows[j][indexValue] = DBNull.Value;

                                                        DtDetection.Rows[j][indexSelectedCurrency] = DBNull.Value;

                                                        DtDetection.Rows[j][IndexCurrencyName] = DBNull.Value;
                                                    }
                                                    else if (DtDetection.Rows[j][indexValue] != null && Convert.ToDouble(DtDetection.Rows[j][indexValue]) <= 0)
                                                    {
                                                        DtDetection.Rows[j][indexValue] = DBNull.Value;

                                                        DtDetection.Rows[j][indexSelectedCurrency] = DBNull.Value;

                                                        DtDetection.Rows[j][IndexCurrencyName] = DBNull.Value;
                                                    }
                                                    else
                                                    {
                                                        DtDetection.Rows[j][indexSelectedCurrency] = DtDetection.Rows[j][indexValue];
                                                        if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                            DtDetection.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtDetection.Rows[j][indexSelectedCurrency]) * CurConversion1.ExchangeRate;
                                                        else
                                                            DtDetection.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtDetection.Rows[j][indexSelectedCurrency]) * CurConversion1.LastMonthAVGRate;
                                                    }
                                                }
                                                else if (logic == 1518)
                                                {

                                                    if (DtDetection.Rows[j][indexValue] == null || DtDetection.Rows[j][indexValue] == DBNull.Value)
                                                    {
                                                        DtDetection.Rows[j][indexValue] = 0;

                                                        DtDetection.Rows[j][indexSelectedCurrency] = 0;

                                                        DtDetection.Rows[j][IndexCurrencyName] = 0;
                                                    }
                                                    else if (DtDetection.Rows[j][indexValue] != null)
                                                    {
                                                        DtDetection.Rows[j][indexValue] = 0;

                                                        DtDetection.Rows[j][indexSelectedCurrency] = 0;

                                                        DtDetection.Rows[j][IndexCurrencyName] = 0;
                                                    }

                                                }
                                                else if (logic == 309)
                                                {
                                                    DtDetection.Rows[j][indexSelectedCurrency] = IndexselectedCurrencyName_Value + (value);
                                                    if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                        DtDetection.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtDetection.Rows[j][indexSelectedCurrency]) * CurConversion1.ExchangeRate;
                                                    else
                                                        DtDetection.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtDetection.Rows[j][indexSelectedCurrency]) * CurConversion1.LastMonthAVGRate;
                                                }
                                            }
                                        }
                                    }
                                }
                                else
                                {
                                    Int32 IndexSelectedSaleCurrency = DtDetection.Columns.IndexOf("CurrencyConversionRate_" + currency.Name);
                                    Int32 IndexCurrencyName = DtDetection.Columns.IndexOf(currency.Name);
                                    DtDetection.Rows[j][IndexCurrencyName] = DBNull.Value;
                                    CurrencyConversion CurConversion1 = null;
                                    if (indexCurrencyConversionDateValue != null)
                                    {
                                        CurConversion1 = filterConversionDate.FirstOrDefault(x => x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == indexCurrencyConversionDateValue.Value.Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (DtDetection.Rows[j][indexValue] != DBNull.Value)
                                                value = Convert.ToInt32(DtDetection.Rows[j][indexValue]);
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                DtDetection.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                            else
                                                DtDetection.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                            if (value != null)
                                            {
                                                if (logic == 307)
                                                {
                                                    DtDetection.Rows[j][indexSelectedCurrency] = IndexselectedCurrencyName_Value + (IndexselectedCurrencyName_Value * (value / 100));
                                                    if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                        DtDetection.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtDetection.Rows[j][indexSelectedCurrency]) * CurConversion1.ExchangeRate;
                                                    else
                                                        DtDetection.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtDetection.Rows[j][indexSelectedCurrency]) * CurConversion1.LastMonthAVGRate;
                                                }
                                                else if (logic == 308)
                                                {
                                                    if (DtDetection.Rows[j][indexValue] == null || DtDetection.Rows[j][indexValue] == DBNull.Value)
                                                    {
                                                        DtDetection.Rows[j][indexValue] = DBNull.Value;

                                                        DtDetection.Rows[j][indexSelectedCurrency] = DBNull.Value;

                                                        DtDetection.Rows[j][IndexCurrencyName] = DBNull.Value;
                                                    }
                                                    else if (DtDetection.Rows[j][indexValue] != null && Convert.ToDouble(DtDetection.Rows[j][indexValue]) <= 0)
                                                    {
                                                        DtDetection.Rows[j][indexValue] = DBNull.Value;

                                                        DtDetection.Rows[j][indexSelectedCurrency] = DBNull.Value;

                                                        DtDetection.Rows[j][IndexCurrencyName] = DBNull.Value;
                                                    }
                                                    else
                                                    {
                                                        DtDetection.Rows[j][indexSelectedCurrency] = DtDetection.Rows[j][indexValue];
                                                        if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                            DtDetection.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtDetection.Rows[j][indexSelectedCurrency]) * CurConversion1.ExchangeRate;
                                                        else
                                                            DtDetection.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtDetection.Rows[j][indexSelectedCurrency]) * CurConversion1.LastMonthAVGRate;
                                                    }
                                                }
                                                else if (logic == 1518)
                                                {

                                                    if (DtDetection.Rows[j][indexValue] == null || DtDetection.Rows[j][indexValue] == DBNull.Value)
                                                    {
                                                        DtDetection.Rows[j][indexValue] = 0;

                                                        DtDetection.Rows[j][indexSelectedCurrency] = 0;

                                                        DtDetection.Rows[j][IndexCurrencyName] = 0;
                                                    }
                                                    else if (DtDetection.Rows[j][indexValue] != null)
                                                    {
                                                        DtDetection.Rows[j][indexValue] = 0;

                                                        DtDetection.Rows[j][indexSelectedCurrency] = 0;

                                                        DtDetection.Rows[j][IndexCurrencyName] = 0;
                                                    }

                                                }
                                                else if (logic == 309)
                                                {
                                                    DtDetection.Rows[j][indexSelectedCurrency] = IndexselectedCurrencyName_Value + (value);
                                                    if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                        DtDetection.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtDetection.Rows[j][indexSelectedCurrency]) * CurConversion1.ExchangeRate;
                                                    else
                                                        DtDetection.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtDetection.Rows[j][indexSelectedCurrency]) * CurConversion1.LastMonthAVGRate;
                                                }
                                            }
                                        }
                                    }
                                }
                            }

                            if (DtDetection.Rows[j][indexSelectedCurrency] == DBNull.Value)
                            {
                                SellPriceValue = 0.00;
                            }
                            else
                            {
                                SellPriceValue = Convert.ToDouble(DtDetection.Rows[j][indexSelectedCurrency]);
                            }
                            DtDetection.Rows[j][indexProfit] = CalculateBasePriceProfitValue(Cost_Value, SellPriceValue);
                            DtDetection.Rows[j][indexCost] = CalculateBasePriceCostMarginValue(Cost_Value, SellPriceValue);

                            if (DtDetection.Rows[j][indexCurrencyConversionDate] != DBNull.Value)
                            {
                                if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                {
                                    DtDetection.Rows[j][indexTooltipDate] = "Updated currency rate on : " + Convert.ToDateTime(DtDetection.Rows[j][indexCurrencyConversionDate]).ToString("dd/MM/yyyy");
                                }
                                else
                                {
                                    DateTime dtCurrencyConversionDate = new DateTime(Convert.ToDateTime(DtDetection.Rows[j][indexCurrencyConversionDate]).Year, Convert.ToDateTime(DtDetection.Rows[j][indexCurrencyConversionDate]).Month, 1);
                                    DtDetection.Rows[j][indexTooltipDate] = "Updated currency rate on : " + dtCurrencyConversionDate.ToString("dd/MM/yyyy");
                                }
                            }
                        }
                        catch (Exception ex)
                        {
                            GeosApplication.Instance.Logger.Log(string.Format("Error in method CalculateBasePriceDetectionsByLogicValue() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                        }
                    }

                    DtDetection.AcceptChanges();
                }

            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method CalculateBasePriceDetectionsByLogicValue() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void PlantCurrencyCheckBoxCellValueChangingCommandAction(object obj)
        {
            PlantCurrencyListWithIsChecked = new List<BasePriceListByPlantCurrency>();
            foreach (DataRow dr in Dttable.Rows)
            {
                BasePriceListByPlantCurrency item = new BasePriceListByPlantCurrency();

                item.PlantName = dr["Plant"].ToString();
                if (!PlantCurrencyListWithIsChecked.Any(a => a.PlantName == item.PlantName))
                {
                    foreach (Currency cur in SelectedSaleCurrency)
                    {
                        if (dr[cur.Name].ToString() == "True")
                        {

                            if (string.IsNullOrEmpty(item.CurrenciesName))
                            {
                                item.CurrenciesName = cur.Name;
                            }
                            else
                            {
                                if (!item.CurrenciesName.Contains(cur.Name))
                                    item.CurrenciesName += " " + cur.Name;
                            }
                        }
                    }
                    PlantCurrencyListWithIsChecked.Add(item);
                }
            }
            if (!isDuplicateCliked) IsEnabledSaveButton = true;
        }


        private void ShowingEditorCommandAction(object e)
        {
            try
            {
                GridColumn col = (GridColumn)((DevExpress.Xpf.Grid.EditorEventArgsBase)e).Column;
                if (col.FieldName == "IsChecked")
                {
                    DataRow row = ((System.Data.DataRowView)((DevExpress.Xpf.Grid.ShowingEditorEventArgs)e).Row).Row;
                    if (row["IsChecked"] != DBNull.Value && Convert.ToBoolean(row["IsChecked"]) == false)
                        row["IsChecked"] = true;
                    else
                        row["IsChecked"] = false;
                }
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method ShowingEditorCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }


        private void PastingFromClipBoardCommondAction(object obj)
        {
            try
            {
                var view = (TableView)((System.Windows.RoutedEventArgs)obj).OriginalSource;
                var grid = (MyGridControl)view.Grid;
                var clipboardData = Clipboard.GetText();

                if (clipboardData != null)
                {
                    string[] rows = clipboardData.Split(new char[] { '\r', '\n' }, StringSplitOptions.RemoveEmptyEntries);
                    var selectedCells = view.GetSelectedCells();

                    if (rows.Length == 0 || selectedCells.Count == 0)
                    {
                        return;
                    }
                    if (selectedCells.ToList().Where(a => a.Column.FieldName == "Value").Count() > 0)
                    {
                        int count = 0;
                        foreach (var selectedCell in selectedCells.ToList().Where(a => a.Column.FieldName == "Value").ToList())
                        {
                            if (rows.Length > count)
                            {
                                double numericValue;
                                bool isNumber = double.TryParse(rows[count].ToString(), out numericValue);
                                if (isNumber == true)
                                    grid.SetCellValue(selectedCell.RowHandle, selectedCell.Column, Convert.ToDouble(rows[count]));
                            }
                            count++;
                        }
                    }
                }
                ((System.Windows.RoutedEventArgs)obj).Handled = true;
                view.CommitEditing();
                if (!isDuplicateCliked) IsEnabledSaveButton = true;
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method PastingFromClipBoardCommondAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }


        private void PastingFromClipBoardDetectionCommondAction(object obj)
        {
            try
            {
                var view = (TableView)((System.Windows.RoutedEventArgs)obj).OriginalSource;
                var grid = view.Grid;
                var clipboardData = Clipboard.GetText();

                if (clipboardData != null)
                {
                    string[] rows = clipboardData.Split(new char[] { '\r', '\n' }, StringSplitOptions.RemoveEmptyEntries);
                    var selectedCells = view.GetSelectedCells();

                    if (rows.Length == 0 || selectedCells.Count == 0)
                    {
                        return;
                    }
                    if (selectedCells.ToList().Where(a => a.Column.FieldName.Contains("_1")).Count() > 0)
                    {
                        int count = 0;
                        foreach (var selectedCell in selectedCells.ToList().Where(a => a.Column.FieldName.Contains("_1")).ToList())
                        {
                            if (rows.Length > count)
                            {
                                double numericValue;
                                bool isNumber = double.TryParse(rows[count].ToString(), out numericValue);
                                if (isNumber == true)
                                    grid.SetCellValue(selectedCell.RowHandle, selectedCell.Column, Convert.ToDouble(rows[count]));
                            }
                            count++;
                        }
                    }
                    if (selectedCells.ToList().Where(a => a.Column.FieldName == "Value").Count() > 0)
                    {
                        int count = 0;
                        foreach (var selectedCell in selectedCells.ToList().Where(a => a.Column.FieldName == "Value").ToList())
                        {
                            if (rows.Length > count)
                            {
                                double numericValue;
                                bool isNumber = double.TryParse(rows[count].ToString(), out numericValue);
                                if (isNumber == true)
                                    grid.SetCellValue(selectedCell.RowHandle, selectedCell.Column, Convert.ToDouble(rows[count]));
                            }
                            count++;
                        }
                    }
                }
                ((System.Windows.RoutedEventArgs)obj).Handled = true;
                view.CommitEditing();
                if (!isDuplicateCliked) IsEnabledSaveButton = true;
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method PastingFromClipBoardDetectionCommondAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        //Shubham[skadam] GEOS2-2886 [Only Modules ] - Able to  add and access to the tab Modules/Detection /Articles a Base Price List [3/3] [#PLM07] 21 03 2023
        private void PastingFromClipBoardModuleCommondAction(object obj)
        {
            try
            {
                var view = (TableView)((System.Windows.RoutedEventArgs)obj).OriginalSource;
                var grid = (MyGridControl)view.Grid;
                var clipboardData = Clipboard.GetText();

                if (clipboardData != null)
                {
                    string[] rows = clipboardData.Split(new char[] { '\r', '\n' }, StringSplitOptions.RemoveEmptyEntries);
                    var selectedCells = view.GetSelectedCells();

                    if (rows.Length == 0 || selectedCells.Count == 0)
                    {
                        return;
                    }
                    if (selectedCells.ToList().Where(a => a.Column.FieldName == "Value").Count() > 0)
                    {
                        int count = 0;
                        foreach (var selectedCell in selectedCells.ToList().Where(a => a.Column.FieldName == "Value").ToList())
                        {
                            if (rows.Length > count)
                            {
                                double numericValue;
                                bool isNumber = double.TryParse(rows[count].ToString(), out numericValue);
                                if (isNumber == true)
                                    grid.SetCellValue(selectedCell.RowHandle, selectedCell.Column, Convert.ToDouble(rows[count]));
                            }
                            count++;
                        }
                    }
                }
                ((System.Windows.RoutedEventArgs)obj).Handled = true;
                view.CommitEditing();
                if (!isDuplicateCliked) IsEnabledSaveButton = true;
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method PastingFromClipBoardModuleCommondAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void PasteInSearchControlCommandAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method PasteInSearchControlCommandAction...", category: Category.Info, priority: Priority.Low);
                GridControl gridControl = obj as GridControl;
                TableView tableView = (TableView)gridControl.View;
                var clipboardData = Clipboard.GetText();
                if (clipboardData != null)
                {
                    string[] rows = clipboardData.Split(new char[] { '\r', '\n' }, StringSplitOptions.RemoveEmptyEntries);
                    if (rows.Length > 0)
                    {
                        string search = string.Join(" ", rows.Select(a => a.ToString()));
                        tableView.SearchString = search;
                    }
                }
                GeosApplication.Instance.Logger.Log("Method PasteInSearchControlCommandAction executed successfully...", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Error on PasteInSearchControlCommandAction() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        private void ArticleGridValueUpdated(UInt32 idArticle, EditPCMArticleViewModel editPCMArticleViewModel)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ArticleGridValueUpadated...", category: Category.Info, priority: Priority.Low);
                //DataRow MainRow = new DataRow()

                if (DtArticle == null)
                {
                    DtArticle = new DataTable();
                }
                else
                {

                    foreach (DataRow row in (from row in DtArticle.AsEnumerable() where row.Field<UInt32>("idArticle") == idArticle select row))
                    {

                        if (UInt32.Parse(row["idArticle"].ToString()) == idArticle)
                        {
                            row["Reference"] = (object)editPCMArticleViewModel.Reference;
                            row["Name"] = (object)editPCMArticleViewModel.Description;
                            row["Category"] = (object)editPCMArticleViewModel.SelectedCategory.Name;
                            row["STAT"] = (object)editPCMArticleViewModel.SelectedStatus.Abbreviation;
                            row["HtmlColor"] = (object)editPCMArticleViewModel.SelectedStatus.HtmlColor;
                            row["Logic"] = (object)editPCMArticleViewModel.SelectedIncludedPLMArticlePrice.IdRule;
                            row["Value"] = (object)editPCMArticleViewModel.SelectedIncludedPLMArticlePrice.RuleValue;


                        }
                    }
                    //List<BasePriceListByPlantCurrency> BPLPlantCurrencyList1 = new List<BasePriceListByPlantCurrency>();
                    //AddChangedLogsDetails();
                    //AddChangeLogList(BPLPlantCurrencyList1);



                }
                GeosApplication.Instance.Logger.Log("Method ArticleGridValueUpadated executed successfully...", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Error on ArticleGridValueUpadated() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        private void DetectionGridValueUpdated(UInt32 idDetection, EditDetectionViewModel addEditOptionsDetectionsViewModel)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ArticleGridValueUpadated...", category: Category.Info, priority: Priority.Low);
                //DataRow MainRow = new DataRow()

                if (DtDetection == null)
                {
                    DtDetection = new DataTable();
                }
                else
                {

                    foreach (DataRow row in (from row in DtDetection.AsEnumerable() where row.Field<UInt32>("idDetection") == idDetection select row))
                    {

                        if (UInt32.Parse(row["idDetection"].ToString()) == idDetection)
                        {
                            row["Code"] = (object)addEditOptionsDetectionsViewModel.Code;
                            row["Name"] = (object)addEditOptionsDetectionsViewModel.Name;
                            row["Type"] = (object)addEditOptionsDetectionsViewModel.Type;
                            row["STAT"] = (object)addEditOptionsDetectionsViewModel.SelectedStatus.Abbreviation;
                            row["HtmlColor"] = (object)addEditOptionsDetectionsViewModel.SelectedStatus.HtmlColor;
                            row["Logic"] = (object)addEditOptionsDetectionsViewModel.SelectedIncludedPLMDetectionPrice.IdRule;
                            row["Value"] = (object)addEditOptionsDetectionsViewModel.SelectedIncludedPLMDetectionPrice.RuleValue;


                        }
                    }
                    //List<BasePriceListByPlantCurrency> BPLPlantCurrencyList1 = new List<BasePriceListByPlantCurrency>();
                    //AddChangedLogsDetails();
                    //AddChangeLogList(BPLPlantCurrencyList1);


                }
                GeosApplication.Instance.Logger.Log("Method ArticleGridValueUpadated executed successfully...", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Error on ArticleGridValueUpadated() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        #endregion

        #region Validation

        bool allowValidation = false;

        string EnableValidationAndGetError()
        {
            allowValidation = true;
            string error = ((IDataErrorInfo)this).Error;
            if (!string.IsNullOrEmpty(error))
            {
                return error;
            }
            return null;
        }

        string IDataErrorInfo.Error
        {
            get
            {
                if (!allowValidation) return null;
                IDataErrorInfo me = (IDataErrorInfo)this;

                string error =
                me[BindableBase.GetPropertyName(() => Name)] +
                me[BindableBase.GetPropertyName(() => InformationError)];


                if (!string.IsNullOrEmpty(error))
                    return "Please check inputted data.";

                return null;
            }
        }

        string IDataErrorInfo.this[string columnName]
        {
            get
            {
                if (!allowValidation) return null;

                string name = BindableBase.GetPropertyName(() => Name);
                string headerInformtionError = BindableBase.GetPropertyName(() => InformationError);

                if (columnName == name)
                {
                    return AddEditBasePriceValidation.GetErrorMessage(name, Name);
                }

                if (columnName == headerInformtionError)
                {
                    return AddEditBasePriceValidation.GetErrorMessage(headerInformtionError, InformationError);
                }



                return null;
            }
        }

        #endregion

        #region Column Chooser
        //[nsatpute][GEOS2-7894][01.08.2025]
        private async Task ArticleGridControlLoadedAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ArticleGridControlLoadedAction...", category: Category.Info, priority: Priority.Low);
                {
                    int visibleFalseColumn = 0;
                    GridControl gridControl = obj as GridControl;

                    TableView tableView = (TableView)gridControl.View;
                    articleTableView = tableView;

                    gridControl.BeginInit();

                    if (File.Exists(BPLArticleGridSettingFilePath))
                    {
                        gridControl.RestoreLayoutFromXml(BPLArticleGridSettingFilePath);
                    }

                    //This code for save grid layout.
                    gridControl.SaveLayoutToXml(BPLArticleGridSettingFilePath);
                    foreach (BandItem band in ((Emdep.Geos.UI.Helper.MyGridControl)gridControl).BandsSource)
                    {
                        if (!band.Visible)
                        {
                            visibleFalseColumn++;
                        }
                    }
                    var list = gridControl.Columns.Where(a => Convert.ToString(((DevExpress.Xpf.Grid.BaseColumn)(a.Parent)).Header) == "Sale Price").ToList().OrderBy(x => x.VisibleIndex).ToList();

                    if (list.Count > 0)
                    {
                        if (((Currency)SelectedCurrency).Name != Convert.ToString(list.FirstOrDefault().Header))
                        {
                            int commonindex = list.FirstOrDefault(a => Convert.ToString(a.Header) == ((Currency)SelectedCurrency).Name).VisibleIndex;
                            int firstindex = list.FirstOrDefault().VisibleIndex;

                            list.Where(a => a.VisibleIndex == firstindex).ToList().ForEach(a => { a.VisibleIndex = commonindex; });
                            list.Where(a => Convert.ToString(a.Header) == ((Currency)SelectedCurrency).Name).ToList().ForEach(a => { a.VisibleIndex = firstindex; });
                        }
                    }

                    foreach (GridColumn column in gridControl.Columns)
                    {
                        DependencyPropertyDescriptor descriptor = DependencyPropertyDescriptor.FromProperty(GridColumn.VisibleProperty, typeof(GridColumn));
                        if (descriptor != null)
                        {
                            descriptor.AddValueChanged(column, ArticleVisibleChanged);
                        }

                        DependencyPropertyDescriptor descriptorColumnPosition = DependencyPropertyDescriptor.FromProperty(GridColumn.VisibleIndexProperty, typeof(GridColumn));
                        if (descriptorColumnPosition != null)
                        {
                            descriptorColumnPosition.AddValueChanged(column, ArticleVisibleIndexChanged);
                        }

                        if (!column.Visible)
                        {
                            visibleFalseColumn++;
                        }

                    }

                    if (visibleFalseColumn > 0)
                    {
                        IsArticleColumnChooserVisible = true;
                    }
                    else
                    {
                        IsArticleColumnChooserVisible = false;
                    }

                    IsDetectionColumnChooserVisible = false;

                    gridControl.EndInit();
                    tableView.SearchString = null;
                    tableView.ShowGroupPanel = false;

                    IsSwitch = false;
                }
                try
                {
                    SelectedTileBarItem = null;
                    DetectionSelectedTileBarItem = null;
                    ModuleSelectedTileBarItem = null;
                }
                catch (Exception ex)
                {

                }
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Method ArticleGridControlLoadedAction executed successfully...", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Error on ArticleGridControlLoadedAction() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        //Shubham[skadam] GEOS2-2886 [Only Modules ] - Able to  add and access to the tab Modules/Detection /Articles a Base Price List [3/3] [#PLM07] 21 03 2023
        //[nsatpute][GEOS2-7894][01.08.2025]
        private async Task ModuleGridControlLoadedAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ModuleGridControlLoadedAction...", category: Category.Info, priority: Priority.Low);
                {
                    int visibleFalseColumn = 0;
                    GridControl gridControl = obj as GridControl;

                    TableView tableView = (TableView)gridControl.View;
                    moduleTableView = tableView;

                    gridControl.BeginInit();

                    if (File.Exists(BPLModuleGridSettingFilePath))
                    {
                        gridControl.RestoreLayoutFromXml(BPLModuleGridSettingFilePath);
                    }

                    //This code for save grid layout.
                    gridControl.SaveLayoutToXml(BPLModuleGridSettingFilePath);
                    foreach (BandItem band in ((Emdep.Geos.UI.Helper.MyGridControl)gridControl).BandsSource)
                    {
                        if (!band.Visible)
                        {
                            visibleFalseColumn++;
                        }
                    }
                    var list = gridControl.Columns.Where(a => Convert.ToString(((DevExpress.Xpf.Grid.BaseColumn)(a.Parent)).Header) == "Sale Price").ToList().OrderBy(x => x.VisibleIndex).ToList();

                    if (list.Count > 0)
                    {
                        if (((Currency)SelectedCurrency).Name != Convert.ToString(list.FirstOrDefault().Header))
                        {
                            int commonindex = list.FirstOrDefault(a => Convert.ToString(a.Header) == ((Currency)SelectedCurrency).Name).VisibleIndex;
                            int firstindex = list.FirstOrDefault().VisibleIndex;

                            list.Where(a => a.VisibleIndex == firstindex).ToList().ForEach(a => { a.VisibleIndex = commonindex; });
                            list.Where(a => Convert.ToString(a.Header) == ((Currency)SelectedCurrency).Name).ToList().ForEach(a => { a.VisibleIndex = firstindex; });
                        }
                    }

                    foreach (GridColumn column in gridControl.Columns)
                    {
                        DependencyPropertyDescriptor descriptor = DependencyPropertyDescriptor.FromProperty(GridColumn.VisibleProperty, typeof(GridColumn));
                        if (descriptor != null)
                        {
                            descriptor.AddValueChanged(column, ModuleVisibleChanged);
                        }

                        DependencyPropertyDescriptor descriptorColumnPosition = DependencyPropertyDescriptor.FromProperty(GridColumn.VisibleIndexProperty, typeof(GridColumn));
                        if (descriptorColumnPosition != null)
                        {
                            descriptorColumnPosition.AddValueChanged(column, ModuleVisibleIndexChanged);
                        }

                        if (!column.Visible)
                        {
                            visibleFalseColumn++;
                        }

                    }

                    if (visibleFalseColumn > 0)
                    {
                        IsModuleColumnChooserVisible = true;
                    }
                    else
                    {
                        IsModuleColumnChooserVisible = false;
                    }

                    //IsDetectionColumnChooserVisible = false;
                    gridControl.EndInit();
                    tableView.SearchString = null;
                    tableView.ShowGroupPanel = false;

                    IsSwitch = false;
                }
                try
                {
                    SelectedTileBarItem = null;
                    DetectionSelectedTileBarItem = null;
                    ModuleSelectedTileBarItem = null;
                }
                catch (Exception ex)
                {

                }
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Method ModuleGridControlLoadedAction executed successfully...", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Error on ModuleGridControlLoadedAction() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        void ArticleVisibleChanged(object sender, EventArgs args)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ArticleVisibleChanged ...", category: Category.Info, priority: Priority.Low);

                GridColumn column = sender as GridColumn;

                if (column.ShowInColumnChooser)
                {
                    ((GridControl)((GridControlBand)((System.Windows.FrameworkContentElement)sender).Parent).Parent).SaveLayoutToXml(BPLArticleGridSettingFilePath);
                }

                if (column.Visible == false && this.articleTableView.ColumnChooserColumns.Count > 0)
                {
                    IsArticleColumnChooserVisible = true;
                }
                else
                {
                    IsArticleColumnChooserVisible = false;
                }

                GeosApplication.Instance.Logger.Log("Method ArticleVisibleChanged() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Error in ArticleVisibleChanged() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        //Shubham[skadam] GEOS2-2886 [Only Modules ] - Able to  add and access to the tab Modules/Detection /Articles a Base Price List [3/3] [#PLM07] 21 03 2023
        void ModuleVisibleChanged(object sender, EventArgs args)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ModuleVisibleChanged ...", category: Category.Info, priority: Priority.Low);

                GridColumn column = sender as GridColumn;

                if (column.ShowInColumnChooser)
                {
                    ((GridControl)((GridControlBand)((System.Windows.FrameworkContentElement)sender).Parent).Parent).SaveLayoutToXml(BPLModuleGridSettingFilePath);
                }

                if (column.Visible == false && this.moduleTableView.ColumnChooserColumns.Count > 0)
                {
                    IsModuleColumnChooserVisible = true;
                }
                else
                {
                    IsModuleColumnChooserVisible = false;
                }

                GeosApplication.Instance.Logger.Log("Method ModuleVisibleChanged() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Error in ModuleVisibleChanged() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        void ArticleVisibleIndexChanged(object sender, EventArgs args)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ArticleVisibleIndexChanged ...", category: Category.Info, priority: Priority.Low);
                GridColumn column = sender as GridColumn;
                if (((DevExpress.Xpf.Grid.ColumnBase)sender).ActualColumnChooserHeaderCaption.ToString() != "")
                {
                    ((GridControl)((GridControlBand)((System.Windows.FrameworkContentElement)sender).Parent).Parent).SaveLayoutToXml(BPLArticleGridSettingFilePath);
                }
                GeosApplication.Instance.Logger.Log("Method ArticleVisibleIndexChanged() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Error in ArticleVisibleIndexChanged() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        //Shubham[skadam] GEOS2-2886 [Only Modules ] - Able to  add and access to the tab Modules/Detection /Articles a Base Price List [3/3] [#PLM07] 21 03 2023
        void ModuleVisibleIndexChanged(object sender, EventArgs args)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ModuleVisibleIndexChanged ...", category: Category.Info, priority: Priority.Low);
                GridColumn column = sender as GridColumn;
                if (((DevExpress.Xpf.Grid.ColumnBase)sender).ActualColumnChooserHeaderCaption.ToString() != "")
                {
                    ((GridControl)((GridControlBand)((System.Windows.FrameworkContentElement)sender).Parent).Parent).SaveLayoutToXml(BPLModuleGridSettingFilePath);
                }
                GeosApplication.Instance.Logger.Log("Method ModuleVisibleIndexChanged() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Error in ModuleVisibleIndexChanged() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        private void ArticleItemListTableViewLoadedAction(object obj)
        {
            TableView tableView = obj as TableView;
            tableView.ColumnChooserState = new DefaultColumnChooserState
            {
                Location = new Point(20, 180),
                Size = new Size(250, 250)
            };
        }
        //[nsatpute][GEOS2-7894][01.08.2025]
        private async Task ArticleGridControlUnloadedAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ArticleGridControlUnloadedAction...", category: Category.Info, priority: Priority.Low);
                if (IsFirstTimeLoad == true)
                    return;
                GridControl gridControl = obj as GridControl;
                if (gridControl.Columns.Count() > 0)
                {
                    TableView tableView = (TableView)gridControl.View;
                    tableView.SearchString = string.Empty;
                    if (gridControl.GroupCount > 0)
                        gridControl.ClearGrouping();

                    gridControl.ClearSorting();
                    gridControl.FilterString = null;
                    gridControl.SaveLayoutToXml(BPLArticleGridSettingFilePath);
                }
                else
                {
                    IsFirstTimeLoad = true;
                    IsSwitch = true;
                }

                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Method ArticleGridControlUnloadedAction executed successfully...", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Error on ArticleGridControlUnloadedAction() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        //[nsatpute][GEOS2-7894][01.08.2025]
        private async Task DetectionGridControlLoadedAction(object obj)
        {
            try
            {
                if (IsSwitch == true)
                    return;

                GeosApplication.Instance.Logger.Log("Method DetectionGridControlLoadedAction...", category: Category.Info, priority: Priority.Low);
                {
                    int visibleFalseColumn = 0;
                    GridControl gridControl = obj as GridControl;
                    TableView tableView = (TableView)gridControl.View;
                    this.detectionsTableView = tableView;
                    gridControl.BeginInit();

                    if (File.Exists(BPLDetectionGridSettingFilePath))
                    {
                        gridControl.RestoreLayoutFromXml(BPLDetectionGridSettingFilePath);
                    }

                    //This code for save grid layout.
                    gridControl.SaveLayoutToXml(BPLDetectionGridSettingFilePath);

                    foreach (BandItem band in ((Emdep.Geos.UI.Helper.MyGridControl)gridControl).BandsSource)
                    {
                        if (!band.Visible)
                        {
                            visibleFalseColumn++;
                        }
                    }
                    var list = gridControl.Columns.Where(a => Convert.ToString(((DevExpress.Xpf.Grid.BaseColumn)(a.Parent)).Header) == "Sale Price").ToList().OrderBy(x => x.VisibleIndex).ToList();

                    if (list.Count > 0)
                    {
                        if (((Currency)SelectedCurrency).Name != Convert.ToString(list.FirstOrDefault().Header))
                        {
                            int commonindex = list.FirstOrDefault(a => Convert.ToString(a.Header) == ((Currency)SelectedCurrency).Name).VisibleIndex;
                            int firstindex = list.FirstOrDefault().VisibleIndex;

                            list.Where(a => a.VisibleIndex == firstindex).ToList().ForEach(a => { a.VisibleIndex = commonindex; });
                            list.Where(a => Convert.ToString(a.Header) == ((Currency)SelectedCurrency).Name).ToList().ForEach(a => { a.VisibleIndex = firstindex; });
                        }
                    }
                    foreach (GridColumn column in gridControl.Columns)
                    {
                        DependencyPropertyDescriptor descriptor = DependencyPropertyDescriptor.FromProperty(GridColumn.VisibleProperty, typeof(GridColumn));
                        if (descriptor != null)
                        {
                            descriptor.AddValueChanged(column, DetectionVisibleChanged);
                        }

                        DependencyPropertyDescriptor descriptorColumnPosition = DependencyPropertyDescriptor.FromProperty(GridColumn.VisibleIndexProperty, typeof(GridColumn));
                        if (descriptorColumnPosition != null)
                        {
                            descriptorColumnPosition.AddValueChanged(column, DetectionVisibleIndexChanged);
                        }

                        if (!column.Visible)
                        {
                            visibleFalseColumn++;
                        }
                    }

                    if (IsFirstTimeLoad == false)
                    {
                        if (visibleFalseColumn > 0)
                        {
                            IsDetectionColumnChooserVisible = true;
                        }
                        else
                        {
                            IsDetectionColumnChooserVisible = false;
                        }
                        IsArticleColumnChooserVisible = false;
                    }
                    IsFirstTimeLoad = false;
                    gridControl.EndInit();
                    tableView.SearchString = null;
                    tableView.ShowGroupPanel = false;
                }
                try
                {
                    SelectedTileBarItem = null;
                    DetectionSelectedTileBarItem = null;
                    ModuleSelectedTileBarItem = null;
                }
                catch (Exception ex)
                {
                }
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Method DetectionGridControlLoadedAction executed successfully...", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Error on DetectionGridControlLoadedAction() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        //Shubham[skadam] GEOS2-2886 [Only Modules ] - Able to  add and access to the tab Modules/Detection /Articles a Base Price List [3/3] [#PLM07] 21 03 2023
        //[nsatpute][GEOS2-7894][01.08.2025]
        private async Task ModuleGridControlUnloadedAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ModuleGridControlUnloadedAction...", category: Category.Info, priority: Priority.Low);
                if (IsFirstTimeLoad == true)
                    return;
                GridControl gridControl = obj as GridControl;
                if (gridControl.Columns.Count() > 0)
                {
                    TableView tableView = (TableView)gridControl.View;
                    tableView.SearchString = string.Empty;
                    if (gridControl.GroupCount > 0)
                        gridControl.ClearGrouping();

                    gridControl.ClearSorting();
                    gridControl.FilterString = null;
                    gridControl.SaveLayoutToXml(BPLModuleGridSettingFilePath);
                }
                else
                {
                    IsFirstTimeLoad = true;
                    IsSwitch = true;
                }

                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Method ModuleGridControlUnloadedAction executed successfully...", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Error on ModuleGridControlUnloadedAction() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        void DetectionVisibleChanged(object sender, EventArgs args)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method DetectionVisibleChanged ...", category: Category.Info, priority: Priority.Low);

                GridColumn column = sender as GridColumn;

                if (column.ShowInColumnChooser)
                {
                    ((GridControl)((GridControlBand)((System.Windows.FrameworkContentElement)sender).Parent).Parent).SaveLayoutToXml(BPLDetectionGridSettingFilePath);
                }

                if (column.Visible == false && this.detectionsTableView.ColumnChooserColumns.Count > 0)
                {
                    IsDetectionColumnChooserVisible = true;
                }
                else
                {
                    IsDetectionColumnChooserVisible = false;
                }

                GeosApplication.Instance.Logger.Log("Method DetectionVisibleChanged() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Error in DetectionVisibleChanged() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        void DetectionVisibleIndexChanged(object sender, EventArgs args)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method DetectionVisibleIndexChanged ...", category: Category.Info, priority: Priority.Low);
                GridColumn column = sender as GridColumn;
                if (((DevExpress.Xpf.Grid.ColumnBase)sender).ActualColumnChooserHeaderCaption.ToString() != "")
                {
                    ((GridControl)((GridControlBand)((System.Windows.FrameworkContentElement)sender).Parent).Parent).SaveLayoutToXml(BPLDetectionGridSettingFilePath);
                }
                GeosApplication.Instance.Logger.Log("Method DetectionVisibleIndexChanged() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Error in DetectionVisibleIndexChanged() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        private void DetectionItemListTableViewLoadedAction(object obj)
        {
            TableView tableView = obj as TableView;
            tableView.ColumnChooserState = new DefaultColumnChooserState
            {
                Location = new Point(20, 180),
                Size = new Size(250, 250)
            };
        }

        //[nsatpute][GEOS2-7894][01.08.2025]
        private async Task DetectionGridControlUnloadedAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method DetectionGridControlUnloadedAction...", category: Category.Info, priority: Priority.Low);
                GridControl gridControl = obj as GridControl;
                if (gridControl.Columns.Count() > 0)
                {
                    TableView tableView = (TableView)gridControl.View;
                    tableView.SearchString = string.Empty;
                    if (gridControl.GroupCount > 0)
                        gridControl.ClearGrouping();
                    gridControl.ClearSorting();
                    gridControl.FilterString = null;
                    gridControl.SaveLayoutToXml(BPLDetectionGridSettingFilePath);
                }
                else
                {
                    IsFirstTimeLoad = true;
                    IsSwitch = true;
                }
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Method DetectionGridControlUnloadedAction executed successfully...", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Error on DetectionGridControlUnloadedAction() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        #endregion
        #region GEOS2-3272
        private ObservableCollection<TileBarFilters> filterStatusListOfTile;
        private TileBarFilters selectedTileBarItem;
        private List<GridColumn> GridColumnList;
        private bool isEdit;
        TableView view;
        private bool isFilterEnabled;
        private string userSettingsKeyForArticle = "PLM_BasePriceArticle_Filter_";
        private string userSettingsKeyForDetection = "PLM_BasePriceDetection_Filter_";
        public bool IsEdit
        {
            get
            {
                return isEdit;
            }
            set
            {
                isEdit = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsEdit"));
            }
        }
        public string FilterStringCriteria { get; set; }
        public string FilterStringName { get; set; }
        string myFilterString;
        string height = "10";
        public string Height
        {
            get { return height; }
            set
            {
                height = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Height"));
            }
        }
        Dictionary<string, string> BasePriceArticleFilter = new Dictionary<string, string>();
        public string MyFilterString
        {
            get { return myFilterString; }
            set
            {
                myFilterString = value;
                OnPropertyChanged(new PropertyChangedEventArgs("MyFilterString"));
            }
        }
        public ObservableCollection<TileBarFilters> FilterStatusListOfTile
        {
            get { return filterStatusListOfTile; }
            set
            {
                filterStatusListOfTile = value;
                OnPropertyChanged(new PropertyChangedEventArgs("FilterStatusListOfTile"));
            }
        }
        public TileBarFilters SelectedTileBarItem
        {
            get { return selectedTileBarItem; }
            set
            {
                selectedTileBarItem = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedTileBarItem"));
            }
        }
        List<string> BPLArticleFilter = new List<string>();
        private void FilterEditorCreatedCommandAction(FilterEditorEventArgs obj)
        {
            try
            {
                BPLArticleFilter = new List<string>();
                obj.Handled = true;
                TableViewEx table = (TableViewEx)obj.OriginalSource;
                GridControl gridControl = (table).Grid;
                GridColumnList = gridControl.Columns.Where(x => x.Header != null).ToList();
                GridColumn column = GridColumnList.FirstOrDefault(x => x.Header.ToString().Equals("Status"));
                ShowFilterEditor(obj);
                if (BasePriceArticleFilter == null)
                    BasePriceArticleFilter = new Dictionary<string, string>();
                foreach (var Filter in GeosApplication.Instance.UserSettings)
                {
                    if (Filter.Key.StartsWith(userSettingsKeyForArticle))
                    {
                        if (!BasePriceArticleFilter.Any(a => a.Key == Filter.Key))
                            BasePriceArticleFilter.Add(Filter.Key, Filter.Value);
                        BPLArticleFilter.Add(Filter.Key.Replace(userSettingsKeyForArticle, ""));
                    }
                }
                //FillFilterTileBar();
                AddCustomSetting();
                SelectedTileBarItem = FilterStatusListOfTile.LastOrDefault();
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in FilterEditorCreatedCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        private void ShowFilterEditor(FilterEditorEventArgs e)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ShowFilterEditor()...", category: Category.Info, priority: Priority.Low);
                FilterEditorView filterEditorView = new FilterEditorView();
                FilterEditorViewModel filterEditorViewModel = new FilterEditorViewModel();
                string titleText = DevExpress.Xpf.Grid.GridControlLocalizer.Active.GetLocalizedString(GridControlStringId.FilterEditorTitle);
                if (IsEdit)
                {
                    filterEditorViewModel.FilterName = FilterStringName;
                    filterEditorViewModel.IsSave = true;
                    filterEditorViewModel.IsNew = false;
                    IsEdit = false;
                }
                else
                    filterEditorViewModel.IsNew = true;

                filterEditorViewModel.Init(e.FilterControl, FilterStatusListOfTile);
                filterEditorView.DataContext = filterEditorViewModel;
                EventHandler handle = delegate { filterEditorView.Close(); };
                filterEditorViewModel.RequestClose += handle;
                filterEditorView.Title = titleText;
                filterEditorView.Icon = DevExpress.Xpf.Core.Native.ImageHelper.CreateImageFromCoreEmbeddedResource("Editors.Images.FilterControl.filter.png");
                filterEditorView.Grid.Children.Add(e.FilterControl);
                filterEditorView.ShowDialog();

                if (filterEditorViewModel.IsDelete && !string.IsNullOrEmpty(filterEditorViewModel.FilterName) && filterEditorViewModel.IsSave)
                {
                    TileBarFilters tileBarItem = FilterStatusListOfTile.FirstOrDefault(x => x.Caption.Equals(FilterStringName));
                    if (tileBarItem != null)
                    {
                        FilterStatusListOfTile.Remove(tileBarItem);
                        List<Tuple<string, string>> lstUserConfiguration = new List<Tuple<string, string>>();
                        foreach (KeyValuePair<string, string> setting in GeosApplication.Instance.UserSettings)
                        {
                            string key = setting.Key;

                            if (setting.Key.Contains(userSettingsKeyForArticle))
                                key = setting.Key.Replace(userSettingsKeyForArticle, "");

                            if (!key.Equals(tileBarItem.Caption))
                                lstUserConfiguration.Add(new Tuple<string, string>(setting.Key.ToString(), setting.Value.ToString()));
                        }
                        ApplicationOperation.CreateNewSetting(lstUserConfiguration, GeosApplication.Instance.UserSettingFilePath, "UserSettings");
                        GeosApplication.Instance.UserSettings = ApplicationOperation.GetSetting(GeosApplication.Instance.UserSettingFilePath);
                    }
                }
                else if (filterEditorViewModel.FilterName != null && !string.IsNullOrEmpty(filterEditorViewModel.FilterName) && filterEditorViewModel.IsSave && !filterEditorViewModel.IsNew && filterEditorViewModel.IsCancel)
                {
                    TileBarFilters tileBarItem = FilterStatusListOfTile.FirstOrDefault(x => x.Caption.Equals(FilterStringName));
                    if (tileBarItem != null)
                    {
                        GridColumn column = GridColumnList.FirstOrDefault(x => x.Header.ToString() != null);
                        DevExpress.Xpf.Grid.GridControlBand gridControl = ((DevExpress.Xpf.Grid.GridControlBand)((System.Windows.FrameworkContentElement)(GridColumn)column).Parent);
                        int rowCount = 0;
                        if (FilterStatusListOfTile == null)
                            FilterStatusListOfTile = new ObservableCollection<TileBarFilters>();
                        FilterStringName = filterEditorViewModel.FilterName;
                        string filterCaption = tileBarItem.Caption;
                        tileBarItem.Caption = userSettingsKeyForArticle + filterEditorViewModel.FilterName;
                        tileBarItem.EntitiesCount = rowCount;
                        tileBarItem.EntitiesCountVisibility = Visibility.Visible;
                        tileBarItem.FilterCriteria = filterEditorViewModel.FilterCriteria;
                        List<Tuple<string, string>> lstUserConfiguration = new List<Tuple<string, string>>();
                        foreach (KeyValuePair<string, string> setting in GeosApplication.Instance.UserSettings)
                        {
                            string key = setting.Key;

                            if (setting.Key.Contains(userSettingsKeyForArticle))
                                key = setting.Key.Replace(userSettingsKeyForArticle, "");

                            if (!key.Equals(filterCaption))
                                lstUserConfiguration.Add(new Tuple<string, string>(setting.Key.ToString(), setting.Value.ToString()));
                            else
                                lstUserConfiguration.Add(new Tuple<string, string>(tileBarItem.Caption, tileBarItem.FilterCriteria));
                        }
                        ApplicationOperation.CreateNewSetting(lstUserConfiguration, GeosApplication.Instance.UserSettingFilePath, "UserSettings");
                        GeosApplication.Instance.UserSettings = ApplicationOperation.GetSetting(GeosApplication.Instance.UserSettingFilePath);
                    }
                }
                else if (filterEditorViewModel.FilterName != null && !string.IsNullOrEmpty(filterEditorViewModel.FilterName) && filterEditorViewModel.IsSave && filterEditorViewModel.IsNew && filterEditorViewModel.IsCancel)
                {
                    GridColumn column = GridColumnList.FirstOrDefault(x => x.Header.ToString() != null);
                    DevExpress.Xpf.Grid.GridControlBand gridControl = ((DevExpress.Xpf.Grid.GridControlBand)((System.Windows.FrameworkContentElement)(GridColumn)column).Parent);
                    int rowCount = 0;
                    if (FilterStatusListOfTile == null)
                        FilterStatusListOfTile = new ObservableCollection<TileBarFilters>();
                    FilterStatusListOfTile.Add(new TileBarFilters()
                    {
                        Caption = filterEditorViewModel.FilterName,
                        Id = 0,
                        BackColor = null,
                        ForeColor = null,
                        EntitiesCountVisibility = Visibility.Visible,
                        FilterCriteria = filterEditorViewModel.FilterCriteria,
                        EntitiesCount = rowCount,
                        Height = 58,
                        width = 188
                    });
                    SelectedTileBarItem = FilterStatusListOfTile.LastOrDefault();
                    string filterName = userSettingsKeyForArticle + filterEditorViewModel.FilterName;
                    GeosApplication.Instance.UserSettings[filterName] = filterEditorViewModel.FilterCriteria;
                    ApplicationOperation.CreateNewSetting(GeosApplication.Instance.UserSettings, GeosApplication.Instance.UserSettingFilePath, "UserSettings");
                    GeosApplication.Instance.UserSettings = ApplicationOperation.GetSetting(GeosApplication.Instance.UserSettingFilePath);
                }
                GeosApplication.Instance.Logger.Log("Method ShowFilterEditor() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method ShowFilterEditor() " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        public void FillFilterTileBar()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillFilterTileBar()...", category: Category.Info, priority: Priority.Low);
                FilterStatusListOfTile = new ObservableCollection<TileBarFilters>();
                ObservableCollection<GeosStatus> tempStatusList = new ObservableCollection<GeosStatus>();
                int _id = 1;

                if (DtArticle != null)
                {
                    var DtArticleList = Dttable.AsEnumerable().ToList();
                    FilterStatusListOfTile.Add(new TileBarFilters()
                    {
                        Caption = (System.Windows.Application.Current.FindResource("BPLViewTileBarCaption").ToString()),
                        Id = 0,
                        BackColor = null,
                        ForeColor = null,
                        EntitiesCount = DtArticle.Rows.Count,
                        EntitiesCountVisibility = Visibility.Visible,
                        Height = 58,
                        width = 188
                    });

                    foreach (var item in tempStatusList)
                    {
                        FilterStatusListOfTile.Add(new TileBarFilters()
                        {
                            Caption = item.Name,
                            Id = _id++,
                            IdOfferStatusType = item.IdOfferStatusType,
                            BackColor = item.HtmlColor,
                            ForeColor = item.HtmlColor,
                            EntitiesCount = (DtArticleList.Where(x => (int)x.ItemArray[34] == item.IdOfferStatusType).ToList()).Count,
                            EntitiesCountVisibility = Visibility.Visible,
                            Height = 58,
                            width = 188
                        });
                    }
                }

                if (FilterStatusListOfTile.Count > 0)
                    SelectedTileBarItem = FilterStatusListOfTile[0];

                GeosApplication.Instance.Logger.Log("Method FillFilterTileBar() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method FillFilterTileBar() " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        private void AddCustomSetting()
        {
            try
            {
                DataTable tempDtArticle = new DataTable();
                FilterStatusListOfTile = new ObservableCollection<TileBarFilters>();
                GeosApplication.Instance.Logger.Log("Method AddCustomSetting()...", category: Category.Info, priority: Priority.Low);
                List<KeyValuePair<string, string>> tempUserSettings = GeosApplication.Instance.UserSettings.Where(x => x.Key.Contains(userSettingsKeyForArticle)).ToList();
                if (tempUserSettings != null && tempUserSettings.Count > 0)
                {
                    FilterStatusListOfTile.Add(
                    new TileBarFilters()
                    {
                        Caption = "ALL",
                        Id = 0,
                        BackColor = null,
                        ForeColor = null,
                        FilterCriteria = null,
                        EntitiesCount = DtArticle.Rows.Count,
                        EntitiesCountVisibility = Visibility.Visible,
                        Height = 58,
                        width = 188
                    });
                }
                if (DtArticle != null)
                {
                    tempDtArticle = DtArticle;
                    foreach (DataRow dtitem in tempDtArticle.Rows)
                    {
                        DataRow DataRow = (DataRow)dtitem;
                        for (int i = 0; i < dtitem.ItemArray.Count(); i++)
                        {
                            if (dtitem.ItemArray[i] is double)
                            {
                                //DataRow.ItemArray[i] = Math.Round((double)dtitem.ItemArray[i], 2);
                                double ItemArray = Math.Round((double)dtitem.ItemArray[i], 2);
                                DataRow.SetField(i, ItemArray);
                            }
                        }
                    }
                }
                foreach (var item in tempUserSettings)
                {
                    if (DtArticle != null)
                    {

                        int count = 0;
                        string filter = item.Value;
                        CriteriaOperator op = CriteriaOperator.Parse(filter);
                        try
                        {
                            count = DtArticle.Select(CriteriaToWhereClauseHelper.GetDataSetWhere(op)).ToList().Count;
                        }
                        catch (Exception ex)
                        {
                            try
                            {
                                if (op != null)
                                {
                                    dynamic criteriaOperatorobj = op;
                                    if (criteriaOperatorobj.OperatorType is DevExpress.Data.Filtering.FunctionOperatorType)
                                    {
                                        if (criteriaOperatorobj.OperatorType == DevExpress.Data.Filtering.FunctionOperatorType.StartsWith)
                                        {
                                            var criteriaOperator = criteriaOperatorobj.Operands;
                                            DevExpress.Data.Filtering.OperandProperty operandProperty = criteriaOperator[0];
                                            op = CriteriaOperator.Parse("[" + operandProperty.PropertyName + "]" + '=' + criteriaOperator[1].Value);
                                            count = DtArticle.Select(CriteriaToWhereClauseHelper.GetDataSetWhere(op)).ToList().Count;
                                        }
                                    }
                                }
                            }
                            catch (Exception exc) { }
                            //GeosApplication.Instance.Logger.Log(string.Format("Error in Method AddCustomSetting() {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                        }

                        FilterStatusListOfTile.Add(
                            new TileBarFilters()
                            {
                                Caption = item.Key.Replace(userSettingsKeyForArticle, ""),
                                Id = 0,
                                BackColor = null,
                                ForeColor = null,
                                FilterCriteria = item.Value,
                                EntitiesCount = count,
                                EntitiesCountVisibility = Visibility.Visible,
                                Height = 58,
                                width = 188
                            });
                    }
                }

                GeosApplication.Instance.Logger.Log("Method AddCustomSetting() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method AddCustomSetting() " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        private void CustomShowFilterPopup(FilterPopupEventArgs e)
        {

            try
            {
                GeosApplication.Instance.Logger.Log(" Method CustomShowFilterPopup ...", category: Category.Info, priority: Priority.Low);

                GeosApplication.Instance.Logger.Log("Method CustomShowFilterPopup() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in CustomShowFilterPopup() method " + ex.Message, category: Category.Info, priority: Priority.Low);
            }
        }
        private void CommandFilterStatusTileClickAction(object obj)
        {
            try
            {
                System.Windows.Controls.SelectionChangedEventArgs Filter = (System.Windows.Controls.SelectionChangedEventArgs)obj;
                GeosApplication.Instance.Logger.Log("Method CommandFilterStatusTileClickAction()...", category: Category.Info, priority: Priority.Low);
                if (Filter.AddedItems.Count != 0)
                {
                    long statusIdType = ((TileBarFilters)((object[])((System.Windows.Controls.SelectionChangedEventArgs)obj).AddedItems)[0]).IdOfferStatusType;
                    string FilterString = ((TileBarFilters)((object[])((System.Windows.Controls.SelectionChangedEventArgs)obj).AddedItems)[0]).FilterCriteria;
                    FilterStringName = ((TileBarFilters)((object[])((System.Windows.Controls.SelectionChangedEventArgs)obj).AddedItems)[0]).Caption;
                    MyFilterString = FilterString;
                }
                GeosApplication.Instance.Logger.Log("Method CommandFilterStatusTileClickAction() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method CommandFilterStatusTileClickAction() " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        private void CommandTileBarClickDoubleClickAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method CommandTileBarClickDoubleClickAction()...", category: Category.Info, priority: Priority.Low);
                //if (FilterStatusListOfTile.Count >= 2)
                //{
                foreach (var item in FilterStatusListOfTile)
                {
                    if (FilterStringName != null)
                    {
                        if (FilterStringName.Equals(item.Caption))
                        {
                            //return;
                        }
                    }
                }
                //}
                if (FilterStringName.Equals(System.Windows.Application.Current.FindResource("BPLViewCustomFilter").ToString()) || FilterStringName.Equals(System.Windows.Application.Current.FindResource("BPLViewTileBarCaption").ToString()))
                {
                    return;
                }

                TableViewEx table = (TableViewEx)obj;
                GridControl gridControl = (table).Grid;
                GridColumnList = gridControl.Columns.Where(x => x.Header != null).ToList();
                GridColumn column = GridColumnList.FirstOrDefault(x => x.Header.ToString().Equals("Status"));
                IsEdit = true;
                table.ShowFilterEditor(column);
                GeosApplication.Instance.Logger.Log("Method CommandTileBarClickDoubleClickAction() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method CommandTileBarClickDoubleClickAction() " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        #region GEOS2-3272_Detection
        private ObservableCollection<TileBarFilters> DetectionfilterStatusListOfTile;
        private TileBarFilters DetectionselectedTileBarItem;
        private List<GridColumn> DetectionGridColumnList;
        private bool DetectionisEdit;
        TableView Detectionview;
        private bool DetectionisFilterEnabled;
        public bool DetectionIsEdit
        {
            get
            {
                return DetectionisEdit;
            }
            set
            {
                DetectionisEdit = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DetectionIsEdit"));
            }
        }
        public string DetectionFilterStringCriteria { get; set; }
        public string DetectionFilterStringName { get; set; }
        string detectionmyFilterString;
        string Detectionheight = "10";
        public string DetectionHeight
        {
            get { return Detectionheight; }
            set
            {
                Detectionheight = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DetectionHeight"));
            }
        }
        Dictionary<string, string> DetectionBasePriceArticleFilter = new Dictionary<string, string>();
        public string DetectionMyFilterString
        {
            get { return detectionmyFilterString; }
            set
            {
                detectionmyFilterString = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DetectionMyFilterString"));
            }
        }
        public ObservableCollection<TileBarFilters> DetectionFilterStatusListOfTile
        {
            get { return DetectionfilterStatusListOfTile; }
            set
            {
                DetectionfilterStatusListOfTile = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DetectionFilterStatusListOfTile"));
            }
        }
        public TileBarFilters DetectionSelectedTileBarItem
        {
            get { return DetectionselectedTileBarItem; }
            set
            {
                DetectionselectedTileBarItem = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DetectionSelectedTileBarItem"));
            }
        }
        List<string> DetectionBPLArticleFilter = new List<string>();
        private void DetectionFilterEditorCreatedCommandAction(FilterEditorEventArgs obj)
        {
            try
            {
                DetectionBPLArticleFilter = new List<string>();
                obj.Handled = true;
                TableViewEx table = (TableViewEx)obj.OriginalSource;
                GridControl gridControl = (table).Grid;
                GridColumnList = gridControl.Columns.Where(x => x.Header != null).ToList();
                GridColumn column = GridColumnList.FirstOrDefault(x => x.Header.ToString().Equals("Status"));
                DetectionShowFilterEditor(obj);
                if (DetectionBasePriceArticleFilter == null)
                    DetectionBasePriceArticleFilter = new Dictionary<string, string>();
                foreach (var Filter in GeosApplication.Instance.UserSettings)
                {
                    if (Filter.Key.StartsWith(userSettingsKeyForDetection))
                    {
                        if (!DetectionBasePriceArticleFilter.Any(a => a.Key == Filter.Key))
                            DetectionBasePriceArticleFilter.Add(Filter.Key, Filter.Value);
                        DetectionBPLArticleFilter.Add(Filter.Key.Replace(userSettingsKeyForDetection, ""));
                    }
                }
                //DetectionFillFilterTileBar();
                DetectionAddCustomSetting();
                DetectionSelectedTileBarItem = DetectionFilterStatusListOfTile.LastOrDefault();
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in DetectionFilterEditorCreatedCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        private void DetectionShowFilterEditor(FilterEditorEventArgs e)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method DetectionShowFilterEditor()...", category: Category.Info, priority: Priority.Low);
                FilterEditorView filterEditorView = new FilterEditorView();
                FilterEditorViewModel filterEditorViewModel = new FilterEditorViewModel();
                string titleText = DevExpress.Xpf.Grid.GridControlLocalizer.Active.GetLocalizedString(GridControlStringId.FilterEditorTitle);
                if (IsEdit)
                {
                    filterEditorViewModel.FilterName = DetectionFilterStringName;
                    filterEditorViewModel.IsSave = true;
                    filterEditorViewModel.IsNew = false;
                    IsEdit = false;
                }
                else
                    filterEditorViewModel.IsNew = true;

                filterEditorViewModel.Init(e.FilterControl, DetectionFilterStatusListOfTile);
                filterEditorView.DataContext = filterEditorViewModel;
                EventHandler handle = delegate { filterEditorView.Close(); };
                filterEditorViewModel.RequestClose += handle;
                filterEditorView.Title = titleText;
                filterEditorView.Icon = DevExpress.Xpf.Core.Native.ImageHelper.CreateImageFromCoreEmbeddedResource("Editors.Images.FilterControl.filter.png");
                filterEditorView.Grid.Children.Add(e.FilterControl);
                filterEditorView.ShowDialog();

                if (filterEditorViewModel.IsDelete && !string.IsNullOrEmpty(filterEditorViewModel.FilterName) && filterEditorViewModel.IsSave)
                {
                    TileBarFilters tileBarItem = DetectionFilterStatusListOfTile.FirstOrDefault(x => x.Caption.Equals(DetectionFilterStringName));
                    if (tileBarItem != null)
                    {
                        DetectionFilterStatusListOfTile.Remove(tileBarItem);
                        List<Tuple<string, string>> lstUserConfiguration = new List<Tuple<string, string>>();
                        foreach (KeyValuePair<string, string> setting in GeosApplication.Instance.UserSettings)
                        {
                            string key = setting.Key;

                            if (setting.Key.Contains(userSettingsKeyForDetection))
                                key = setting.Key.Replace(userSettingsKeyForDetection, "");

                            if (!key.Equals(tileBarItem.Caption))
                                lstUserConfiguration.Add(new Tuple<string, string>(setting.Key.ToString(), setting.Value.ToString()));
                        }
                        ApplicationOperation.CreateNewSetting(lstUserConfiguration, GeosApplication.Instance.UserSettingFilePath, "UserSettings");
                        GeosApplication.Instance.UserSettings = ApplicationOperation.GetSetting(GeosApplication.Instance.UserSettingFilePath);
                    }
                }
                else if (filterEditorViewModel.FilterName != null && !string.IsNullOrEmpty(filterEditorViewModel.FilterName) && filterEditorViewModel.IsSave && !filterEditorViewModel.IsNew && filterEditorViewModel.IsCancel)
                {
                    TileBarFilters tileBarItem = DetectionFilterStatusListOfTile.FirstOrDefault(x => x.Caption.Equals(DetectionFilterStringName));
                    if (tileBarItem != null)
                    {
                        GridColumn column = GridColumnList.FirstOrDefault(x => x.Header.ToString() != null);
                        DevExpress.Xpf.Grid.GridControlBand gridControl = ((DevExpress.Xpf.Grid.GridControlBand)((System.Windows.FrameworkContentElement)(GridColumn)column).Parent);
                        int rowCount = 0;
                        if (DetectionFilterStatusListOfTile == null)
                            DetectionFilterStatusListOfTile = new ObservableCollection<TileBarFilters>();
                        DetectionFilterStringName = userSettingsKeyForDetection + filterEditorViewModel.FilterName;
                        string filterCaption = tileBarItem.Caption;
                        tileBarItem.Caption = DetectionFilterStringName;
                        tileBarItem.EntitiesCount = rowCount;
                        tileBarItem.EntitiesCountVisibility = Visibility.Visible;
                        tileBarItem.FilterCriteria = filterEditorViewModel.FilterCriteria;
                        List<Tuple<string, string>> lstUserConfiguration = new List<Tuple<string, string>>();
                        foreach (KeyValuePair<string, string> setting in GeosApplication.Instance.UserSettings)
                        {
                            string key = setting.Key;

                            if (setting.Key.Contains(userSettingsKeyForDetection))
                                key = setting.Key.Replace(userSettingsKeyForDetection, "");

                            if (!key.Equals(filterCaption))
                                lstUserConfiguration.Add(new Tuple<string, string>(setting.Key.ToString(), setting.Value.ToString()));
                            else
                                lstUserConfiguration.Add(new Tuple<string, string>(tileBarItem.Caption, tileBarItem.FilterCriteria));
                        }
                        ApplicationOperation.CreateNewSetting(lstUserConfiguration, GeosApplication.Instance.UserSettingFilePath, "UserSettings");
                        GeosApplication.Instance.UserSettings = ApplicationOperation.GetSetting(GeosApplication.Instance.UserSettingFilePath);
                    }
                }
                else if (filterEditorViewModel.FilterName != null && !string.IsNullOrEmpty(filterEditorViewModel.FilterName) && filterEditorViewModel.IsSave && filterEditorViewModel.IsNew && filterEditorViewModel.IsCancel)
                {
                    GridColumn column = GridColumnList.FirstOrDefault(x => x.Header.ToString() != null);
                    DevExpress.Xpf.Grid.GridControlBand gridControl = ((DevExpress.Xpf.Grid.GridControlBand)((System.Windows.FrameworkContentElement)(GridColumn)column).Parent);
                    int rowCount = 0;
                    if (DetectionFilterStatusListOfTile == null)
                        DetectionFilterStatusListOfTile = new ObservableCollection<TileBarFilters>();
                    DetectionFilterStatusListOfTile.Add(new TileBarFilters()
                    {
                        Caption = filterEditorViewModel.FilterName,
                        Id = 0,
                        BackColor = null,
                        ForeColor = null,
                        EntitiesCountVisibility = Visibility.Visible,
                        FilterCriteria = filterEditorViewModel.FilterCriteria,
                        EntitiesCount = rowCount,
                        Height = 37,
                        width = 188
                    });
                    DetectionSelectedTileBarItem = DetectionFilterStatusListOfTile.LastOrDefault();
                    string filterName = userSettingsKeyForDetection + filterEditorViewModel.FilterName;
                    GeosApplication.Instance.UserSettings[filterName] = filterEditorViewModel.FilterCriteria;
                    ApplicationOperation.CreateNewSetting(GeosApplication.Instance.UserSettings, GeosApplication.Instance.UserSettingFilePath, "UserSettings");
                    GeosApplication.Instance.UserSettings = ApplicationOperation.GetSetting(GeosApplication.Instance.UserSettingFilePath);
                }
                GeosApplication.Instance.Logger.Log("Method DetectionShowFilterEditor() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method DetectionShowFilterEditor() " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        public void DetectionFillFilterTileBar()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method DetectionFillFilterTileBar()...", category: Category.Info, priority: Priority.Low);
                DetectionFilterStatusListOfTile = new ObservableCollection<TileBarFilters>();
                ObservableCollection<GeosStatus> tempStatusList = new ObservableCollection<GeosStatus>();
                int _id = 1;

                if (DtDetection != null)
                {
                    var DtDetectionList = Dttable.AsEnumerable().ToList();
                    DetectionFilterStatusListOfTile.Add(new TileBarFilters()
                    {
                        Caption = (System.Windows.Application.Current.FindResource("BPLViewTileBarCaption").ToString()),
                        Id = 0,
                        BackColor = null,
                        ForeColor = null,
                        EntitiesCount = DtArticle.Rows.Count,
                        EntitiesCountVisibility = Visibility.Visible,
                        Height = 58,
                        width = 188
                    });

                    foreach (var item in tempStatusList)
                    {
                        DetectionFilterStatusListOfTile.Add(new TileBarFilters()
                        {
                            Caption = item.Name,
                            Id = _id++,
                            IdOfferStatusType = item.IdOfferStatusType,
                            BackColor = item.HtmlColor,
                            ForeColor = item.HtmlColor,
                            EntitiesCount = (DtDetectionList.Where(x => (int)x.ItemArray[34] == item.IdOfferStatusType).ToList()).Count,
                            EntitiesCountVisibility = Visibility.Visible,
                            Height = 58,
                            width = 188
                        });
                    }
                }

                if (DetectionFilterStatusListOfTile.Count > 0)
                    DetectionSelectedTileBarItem = DetectionFilterStatusListOfTile[0];

                GeosApplication.Instance.Logger.Log("Method DetectionFillFilterTileBar() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method DetectionFillFilterTileBar() " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        private void DetectionAddCustomSetting()
        {
            try
            {
                DataTable tempDtDetection = new DataTable();
                DetectionFilterStatusListOfTile = new ObservableCollection<TileBarFilters>();
                GeosApplication.Instance.Logger.Log("Method DetectionAddCustomSetting()...", category: Category.Info, priority: Priority.Low);
                List<KeyValuePair<string, string>> tempUserSettings = GeosApplication.Instance.UserSettings.Where(x => x.Key.Contains(userSettingsKeyForDetection)).ToList();
                if (tempUserSettings != null && tempUserSettings.Count > 0)
                {
                    DetectionFilterStatusListOfTile.Add(
                    new TileBarFilters()
                    {
                        Caption = "ALL",
                        Id = 0,
                        BackColor = null,
                        ForeColor = null,
                        FilterCriteria = null,
                        EntitiesCount = DtDetection.Rows.Count,
                        EntitiesCountVisibility = Visibility.Visible,
                        Height = 58,
                        width = 188
                    });
                }
                if (DtDetection != null)
                {
                    tempDtDetection = DtDetection;
                    foreach (DataRow dtitem in tempDtDetection.Rows)
                    {
                        DataRow DataRow = (DataRow)dtitem;
                        for (int i = 0; i < dtitem.ItemArray.Count(); i++)
                        {
                            if (dtitem.ItemArray[i] is double)
                            {
                                //DataRow.ItemArray[i] = Math.Round((double)dtitem.ItemArray[i], 2);
                                double ItemArray = Math.Round((double)dtitem.ItemArray[i], 2);
                                DataRow.SetField(i, ItemArray);
                            }
                        }
                    }
                }
                foreach (var item in tempUserSettings)
                {
                    if (DtDetection != null)
                    {

                        int count = 0;
                        string filter = item.Value;
                        CriteriaOperator op = CriteriaOperator.Parse(filter);
                        try
                        {
                            count = DtDetection.Select(CriteriaToWhereClauseHelper.GetDataSetWhere(op)).ToList().Count;
                        }
                        catch (Exception ex)
                        {
                            try
                            {
                                if (op != null)
                                {
                                    dynamic criteriaOperatorobj = op;
                                    if (criteriaOperatorobj.OperatorType is DevExpress.Data.Filtering.FunctionOperatorType)
                                    {
                                        if (criteriaOperatorobj.OperatorType == DevExpress.Data.Filtering.FunctionOperatorType.StartsWith)
                                        {
                                            var criteriaOperator = criteriaOperatorobj.Operands;
                                            DevExpress.Data.Filtering.OperandProperty operandProperty = criteriaOperator[0];
                                            op = CriteriaOperator.Parse("[" + operandProperty.PropertyName + "]" + '=' + criteriaOperator[1].Value);
                                            count = DtArticle.Select(CriteriaToWhereClauseHelper.GetDataSetWhere(op)).ToList().Count;
                                        }
                                    }
                                }
                            }
                            catch (Exception exc) { }
                            //GeosApplication.Instance.Logger.Log(string.Format("Error in Method AddCustomSetting() {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                        }

                        DetectionFilterStatusListOfTile.Add(
                            new TileBarFilters()
                            {
                                Caption = item.Key.Replace(userSettingsKeyForDetection, ""),
                                Id = 0,
                                BackColor = null,
                                ForeColor = null,
                                FilterCriteria = item.Value,
                                EntitiesCount = count,
                                EntitiesCountVisibility = Visibility.Visible,
                                Height = 58,
                                width = 188
                            });
                    }
                }

                GeosApplication.Instance.Logger.Log("Method DetectionAddCustomSetting() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method DetectionAddCustomSetting() " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        private void DetectionCustomShowFilterPopup(FilterPopupEventArgs e)
        {

            try
            {
                GeosApplication.Instance.Logger.Log(" Method DetectionCustomShowFilterPopup ...", category: Category.Info, priority: Priority.Low);

                GeosApplication.Instance.Logger.Log("Method DetectionCustomShowFilterPopup() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in DetectionCustomShowFilterPopup() method " + ex.Message, category: Category.Info, priority: Priority.Low);
            }
        }
        private void DetectionCommandFilterStatusTileClickAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method DetectionCommandFilterStatusTileClickAction()...", category: Category.Info, priority: Priority.Low);
                System.Windows.Controls.SelectionChangedEventArgs Filter = (System.Windows.Controls.SelectionChangedEventArgs)obj;
                if (Filter.AddedItems.Count != 0)
                {
                    long statusIdType = ((TileBarFilters)((object[])((System.Windows.Controls.SelectionChangedEventArgs)obj).AddedItems)[0]).IdOfferStatusType;
                    string FilterString = ((TileBarFilters)((object[])((System.Windows.Controls.SelectionChangedEventArgs)obj).AddedItems)[0]).FilterCriteria;
                    DetectionFilterStringName = ((TileBarFilters)((object[])((System.Windows.Controls.SelectionChangedEventArgs)obj).AddedItems)[0]).Caption;
                    DetectionMyFilterString = FilterString;
                }
                GeosApplication.Instance.Logger.Log("Method DetectionCommandFilterStatusTileClickAction() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method DetectionCommandFilterStatusTileClickAction() " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        private void DetectionCommandTileBarClickDoubleClickAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method DetectionCommandTileBarClickDoubleClickAction()...", category: Category.Info, priority: Priority.Low);
                foreach (var item in FilterStatusListOfTile)
                {
                    if (DetectionFilterStringName != null)
                    {
                        if (DetectionFilterStringName.Equals(item.Caption))
                        {
                            //return;
                        }
                    }
                }

                if (DetectionFilterStringName.Equals(System.Windows.Application.Current.FindResource("BPLViewCustomFilter").ToString()) || DetectionFilterStringName.Equals(System.Windows.Application.Current.FindResource("BPLViewTileBarCaption").ToString()))
                {
                    return;
                }

                TableViewEx table = (TableViewEx)obj;
                GridControl gridControl = (table).Grid;
                DetectionGridColumnList = gridControl.Columns.Where(x => x.Header != null).ToList();
                GridColumn column = DetectionGridColumnList.FirstOrDefault(x => x.Header.ToString().Equals("Status"));
                IsEdit = true;
                table.ShowFilterEditor(column);
                GeosApplication.Instance.Logger.Log("Method DetectionCommandTileBarClickDoubleClickAction() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method DetectionCommandTileBarClickDoubleClickAction() " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        #endregion
        #endregion

        #region GEOS2-2885
        //Shubham[skadam] GEOS2-2885 [Only Modules ] - Search the Article categories (and sub-categories), Modules and Detection (DOWS) in BPL [3/3][#PLM09]  15 03 2023
        private ObservableCollection<BPLModule> moduleMenuList;
        private BPLModule selectedModule;
        public ObservableCollection<BPLModule> ModuleMenulist
        {
            get
            {
                return moduleMenuList;
            }

            set
            {
                moduleMenuList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ModuleMenulist"));
            }
        }

        public BPLModule SelectedModule
        {
            get
            {
                return selectedModule;
            }

            set
            {
                selectedModule = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedModule"));
            }
        }
        private void FillModuleMenuList()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillModuleMenuList()...", category: Category.Info, priority: Priority.Low);

                //ModuleMenulist = new ObservableCollection<ProductTypesTemplate>(PCMService.GetProductTypesWithTemplate());
                //PCMService = new PCMServiceController("localhost:6699");
                //ObservableCollection<BPLModule> ModuleMenuListtemp = new ObservableCollection<BPLModule>(PCMService.GetProductTypesWithTemplate_V2370());
                #region BPLModule
                //ObservableCollection<BPLModule> ModuleMenuListtemp1 = new ObservableCollection<BPLModule>();
                //if (ModuleMenuListtemp.Count > 0)
                //{
                //    foreach (BPLModule item in ModuleMenuListtemp)
                //    {
                //        BPLModule ModuleMenuList1 = new BPLModule();
                //        ModuleMenuList1.IdCPType = item.IdCPType;
                //        int count = ModuleMenuListtemp.Where(x => x.Parent == item.Key && x.IsBPLdModule_Current == false).ToList().Count;
                //        if (count != 0)
                //        {
                //            ModuleMenuList1.Name = item.Name + "[" + count + "]";
                //        }
                //        else
                //        {
                //            ModuleMenuList1.Name = item.Name;
                //        }
                //        ModuleMenuList1.Parent = item.Parent;
                //        ModuleMenuList1.Key = item.Key;
                //        //ModuleMenuList1.Description = item.Description;
                //        ModuleMenuList1.TemplateName = item.TemplateName;
                //        ModuleMenuList1.IdTemplate = item.IdTemplate;
                //        // ModuleMenuList1.IdGroup = item.IdGroup;
                //        // ModuleMenuList1.Code = item.Code;
                //        ModuleMenuList1.StatusHtmlColor = item.StatusHtmlColor;
                //        ModuleMenuList1.StatusAbbreviation = item.StatusAbbreviation;
                //        ModuleMenuList1.IsBPLdModule_Current = item.IsBPLdModule_Current;
                //        ModuleMenuList1.ProductType = item.ProductType;
                //        ModuleMenuListtemp1.Add(ModuleMenuList1);
                //    }
                //    ModuleMenulist = new ObservableCollection<BPLModule>();
                //    ModuleMenulist.AddRange(ModuleMenuListtemp1);
                //}

                #endregion


                //ModuleMenulist = new ObservableCollection<BPLModule>(PCMService.GetProductTypesWithTemplate_V2370());
                //SelectedModule = ModuleMenulist.FirstOrDefault();

                //[pramod.misal][16.04.2025][GEOS2-6688]
                if (PLMCommon.Instance.ModuleMenuListtemp == null || PLMCommon.Instance.ModuleMenuListtemp?.Count == 0)
                {
                    PLMCommon.Instance.ModuleMenuListtemp = new ObservableCollection<BPLModule>(PCMService.GetProductTypesWithTemplate_V2370());

                }
                if (PLMCommon.Instance.ModuleMenuListtemp != null)
                {
                    ObservableCollection<BPLModule> ModuleMenuListtemp = new ObservableCollection<BPLModule>(PLMCommon.Instance.ModuleMenuListtemp);

                    #region BPLModule Old code
                    // ObservableCollection<BPLModule> ModuleMenuListtemp1 = new ObservableCollection<BPLModule>();
                    var childCountByParent = ModuleMenuListtemp
                              .Where(x => x.Parent != null && !x.IsBPLdModule_Current)
                              .GroupBy(x => x.Parent)
                              .ToDictionary(g => g.Key, g => g.Count());

                    // Use Select to create the new list efficiently
                    var ModuleMenuListtemp1 = ModuleMenuListtemp.Select(item =>
                    {
                        return new BPLModule
                        {
                            IdCPType = item.IdCPType,
                            Name = childCountByParent.TryGetValue(item.Key, out int count) && count > 0
                                ? $"{item.Name}[{count}]"
                                : item.Name,
                            Parent = item.Parent,
                            Key = item.Key,
                            TemplateName = item.TemplateName,
                            IdTemplate = item.IdTemplate,
                            StatusHtmlColor = item.StatusHtmlColor,
                            StatusAbbreviation = item.StatusAbbreviation,
                            IsBPLdModule_Current = item.IsBPLdModule_Current,
                            ProductType = item.ProductType
                        };
                    }).ToList();

                    // Set the final observable collection
                    ModuleMenulist = new ObservableCollection<BPLModule>(ModuleMenuListtemp1);

                    #endregion

                    #region BPLModule  

                    #endregion



                    SelectedModule = ModuleMenulist.FirstOrDefault();
                }

                GeosApplication.Instance.Logger.Log("Method FillModuleMenuList()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillModuleMenuList() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillModuleMenuList() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method FillModuleMenuList() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        #endregion

        #region GEOS2-2886
        //Shubham[skadam] GEOS2-2886 [Only Modules ] - Able to  add and access to the tab Modules/Detection /Articles a Base Price List [3/3] [#PLM07] 21 03 2023
        DataTable dtModule;
        public DataTable DtModule
        {
            get { return dtModule; }
            set
            {
                dtModule = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DtModule"));
            }
        }
        DataTable dtModuleCopy;
        public DataTable DtModuleCopy
        {
            get { return dtModuleCopy; }
            set
            {
                dtModuleCopy = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DtModuleCopy"));
            }
        }
        List<UInt64> addModules;
        public List<UInt64> AddModules
        {
            get
            {
                return addModules;
            }

            set
            {
                addModules = value;
                OnPropertyChanged(new PropertyChangedEventArgs("AddModules"));
            }
        }
        private ObservableCollection<BandItem> moduleBands = new ObservableCollection<BandItem>();
        public ObservableCollection<BandItem> ModuleBands
        {
            get { return moduleBands; }
            set
            {
                moduleBands = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ModuleBands"));
            }
        }

        List<BPLModule> deleteModules;
        public List<BPLModule> DeleteModules
        {
            get { return deleteModules; }
            set
            {
                deleteModules = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DeleteModules"));
            }
        }
        List<CustomerPriceListByItem> deleteModuleFromCPL;
        public List<CustomerPriceListByItem> DeleteModuleFromCPL
        {
            get
            {
                return deleteModuleFromCPL;
            }

            set
            {
                deleteModuleFromCPL = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DeleteModuleFromCPL"));
            }
        }
        ObservableCollection<BasePriceListByItem> moduleList;
        public ObservableCollection<BasePriceListByItem> ModuleList
        {
            get { return moduleList; }
            set
            {
                moduleList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ModuleList"));
            }
        }
        private void AddColumnsToModuleDataTable()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method AddColumnsToModuleDataTable ...", category: Category.Info, priority: Priority.Low);
                if (SelectedSaleCurrency == null)
                    SelectedSaleCurrency = new List<object>();

                if (SelectedCurrency == null)
                {
                    SelectedCurrency = new List<object>();
                }

                if (ModuleBands.Count > 0)
                {
                    foreach (BandItem bandItem in ModuleBands)
                    {
                        if (bandItem.BandHeader == "Max Cost")
                        {
                            if (((Currency)SelectedCurrency).Name != bandItem.Columns.FirstOrDefault().HeaderText)
                            {
                                string fieldName = bandItem.Columns.FirstOrDefault().ColumnFieldName;
                                DtModuleCopy.Columns.Remove(fieldName);
                                bandItem.Columns.Remove(bandItem.Columns.FirstOrDefault());

                                string fieldName2 = "MaxCost_1";
                                DtModuleCopy.Columns.Add(fieldName2, typeof(double));
                                bandItem.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName2, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.MaxCost });

                            }
                        }
                        else if (bandItem.BandHeader == "Sale Price")
                        {
                            foreach (Currency currency in SelectedSaleCurrency)
                            {
                                if (!bandItem.Columns.Any(a => a.HeaderText == currency.Name))
                                {
                                    string fieldName = currency.Name;
                                    DtModuleCopy.Columns.Add(fieldName, typeof(double));
                                    bandItem.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = fieldName, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                    DtModuleCopy.Columns.Add("CurrencyConversionRate_" + currency.Name, typeof(double));
                                }
                            }
                            List<ColumnItem> columns = new List<ColumnItem>(bandItem.Columns);
                            if (bandItem.Columns.Count != SelectedSaleCurrency.Count)
                            {
                                foreach (ColumnItem columnItem in columns.ToList())
                                {
                                    if (!SelectedSaleCurrency.Cast<Currency>().Any(a => a.Name == columnItem.HeaderText))
                                    {
                                        string fieldName = columnItem.HeaderText;
                                        DtModuleCopy.Columns.Remove(fieldName);
                                        bandItem.Columns.Remove(columnItem);

                                        DtModuleCopy.Columns.Remove("CurrencyConversionRate_" + fieldName);
                                    }
                                }
                            }
                            if (!SelectedSaleCurrency.Cast<Currency>().Any(a => a.Name == ((Currency)SelectedCurrency).Name))
                            {
                                SelectedSaleCurrency.Add(SaleCurrencyList.FirstOrDefault(a => a.Name == ((Currency)SelectedCurrency).Name));
                                SelectedSaleCurrency = new List<object>(SelectedSaleCurrency);
                                string fieldName = "Common_Cur";
                                DtModuleCopy.Columns.Remove(fieldName);
                                DtModuleCopy.Columns.Add(fieldName, typeof(double));
                                bandItem.Columns.Remove(bandItem.Columns.FirstOrDefault(a => a.ColumnFieldName == fieldName));
                                bandItem.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });

                                DtModuleCopy.Columns.Remove("CurrencyConversionRate_" + fieldName);
                                DtModuleCopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));


                                string fieldName1 = ((Currency)SelectedCurrency_Copy).Name;
                                DtModuleCopy.Columns.Add(fieldName1, typeof(double));
                                bandItem.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName1, HeaderText = fieldName1, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                DtModuleCopy.Columns.Add("CurrencyConversionRate_" + fieldName1, typeof(double));

                                SelectedSaleCurrency_Copy = SelectedSaleCurrency;
                            }
                        }
                    }

                    // reorder by common currency
                    BandItem item = ModuleBands.FirstOrDefault(a => a.BandHeader == "Sale Price");
                    if (item.Columns.FirstOrDefault().HeaderText != ((Currency)SelectedCurrency).Name)
                    {
                        int count = 0;
                        foreach (Currency item1 in SelectedSaleCurrency.Cast<Currency>())
                        {
                            if (count == 0)
                            {
                                count = 1;
                                //string fieldName = ((Currency)SelectedCurrency).Name;
                                string fieldName = "Common_Cur";
                                DtModuleCopy.Columns.Remove(fieldName);
                                DtModuleCopy.Columns.Add(fieldName, typeof(double));
                                item.Columns.Remove(item.Columns.FirstOrDefault(a => a.ColumnFieldName == fieldName));
                                item.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                DtModuleCopy.Columns.Remove("CurrencyConversionRate_" + fieldName);
                                DtModuleCopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));

                                if (DtModuleCopy.Columns.Contains(((Currency)SelectedCurrency).Name))
                                    DtModuleCopy.Columns.Remove(((Currency)SelectedCurrency).Name);

                                if (DtModuleCopy.Columns.Contains("CurrencyConversionRate_" + ((Currency)SelectedCurrency).Name))
                                    DtModuleCopy.Columns.Remove("CurrencyConversionRate_" + ((Currency)SelectedCurrency).Name);

                                item.Columns.Remove(item.Columns.FirstOrDefault(a => a.ColumnFieldName == ((Currency)SelectedCurrency).Name));

                                if (item1.Name != ((Currency)SelectedCurrency).Name)
                                {
                                    string fieldName1 = item1.Name;
                                    if (DtModuleCopy.Columns.Contains(fieldName1))
                                        DtModuleCopy.Columns.Remove(fieldName1);

                                    DtModuleCopy.Columns.Add(fieldName1, typeof(double));
                                    item.Columns.Remove(item.Columns.FirstOrDefault(a => a.ColumnFieldName == fieldName1));
                                    item.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName1, HeaderText = fieldName1, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });

                                    if (DtModuleCopy.Columns.Contains("CurrencyConversionRate_" + fieldName1))
                                        DtModuleCopy.Columns.Remove("CurrencyConversionRate_" + fieldName1);

                                    DtModuleCopy.Columns.Add("CurrencyConversionRate_" + fieldName1, typeof(double));
                                }
                            }
                            else
                            {
                                if (item1.Name != ((Currency)SelectedCurrency).Name)
                                {
                                    string fieldName = item1.Name;
                                    if (DtModuleCopy.Columns.Contains(fieldName))
                                        DtModuleCopy.Columns.Remove(fieldName);

                                    DtModuleCopy.Columns.Add(fieldName, typeof(double));
                                    item.Columns.Remove(item.Columns.FirstOrDefault(a => a.ColumnFieldName == fieldName));
                                    item.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = fieldName, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });

                                    if (DtModuleCopy.Columns.Contains("CurrencyConversionRate_" + fieldName))
                                        DtModuleCopy.Columns.Remove("CurrencyConversionRate_" + fieldName);

                                    DtModuleCopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));
                                }
                            }
                        }
                    }
                    ModuleBands = new ObservableCollection<BandItem>(ModuleBands);
                }
                else
                {
                    ModuleBands.Clear();
                    DtModuleCopy = new DataTable();

                    BandItem band1 = new BandItem() { BandName = "all5", AllowBandMove = false, FixedStyle = FixedStyle.Left, Visible = true, AllowMoving = DevExpress.Utils.DefaultBoolean.False };
                    band1.Columns = new ObservableCollection<ColumnItem>();
                    band1.Columns.Add(new ColumnItem() { ColumnFieldName = "IsChecked", HeaderText = " ", Width = 50, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    band1.Columns.Add(new ColumnItem() { ColumnFieldName = "Code", HeaderText = "Code", Width = 100, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    ModuleBands.Add(band1);

                    BandItem band2 = new BandItem() { BandName = "all6", Visible = true };
                    band2.Columns = new ObservableCollection<ColumnItem>();
                    band2.Columns.Add(new ColumnItem() { ColumnFieldName = "Name", HeaderText = "Name", Width = 350, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    band2.Columns.Add(new ColumnItem() { ColumnFieldName = "Type", HeaderText = "Template", Width = 100, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    band2.Columns.Add(new ColumnItem() { ColumnFieldName = "STAT", HeaderText = "STAT", Width = 40, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    //  band2.Columns.Add(new ColumnItem() { ColumnFieldName = "HtmlColor", HeaderText = "HtmlColor", Width = 10, Visible = false, IsVertical = false, Settings = SettingsType.Hidden });

                    ModuleBands.Add(band2);

                    DtModuleCopy.Columns.Add("IsChecked", typeof(bool));
                    DtModuleCopy.Columns.Add("Code", typeof(string));
                    DtModuleCopy.Columns.Add("Type", typeof(string));
                    DtModuleCopy.Columns.Add("STAT", typeof(string));
                    DtModuleCopy.Columns.Add("HtmlColor", typeof(string));
                    DtModuleCopy.Columns.Add("Name", typeof(string));
                    DtModuleCopy.Columns.Add("IdCPType", typeof(UInt32));
                    DtModuleCopy.Columns.Add("CurrencyConversionDate", typeof(DateTime));
                    DtModuleCopy.Columns.Add("IsColor", typeof(bool)).DefaultValue = false;
                    DtModuleCopy.Columns.Add("IsUpdatedRow", typeof(bool)).DefaultValue = false;
                    DtModuleCopy.Columns.Add("SaleCurrencyConversionDate", typeof(string));


                    //Max Cost
                    BandItem band3 = new BandItem() { BandName = "max Cost", BandHeader = "Max Cost", Visible = true };
                    band3.Columns = new ObservableCollection<ColumnItem>();
                    string fieldName2 = "MaxCost_1";
                    DtModuleCopy.Columns.Add(fieldName2, typeof(double));
                    band3.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName2, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.MaxCost });
                    ModuleBands.Add(band3);

                    //rule
                    BandItem band4 = new BandItem() { BandName = "rule", BandHeader = "Rule", Visible = true };
                    band4.Columns = new ObservableCollection<ColumnItem>();

                    string fieldName3 = "Value";
                    DtModuleCopy.Columns.Add("Value", typeof(float));
                    band4.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName3, HeaderText = fieldName3, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });

                    string fieldName4 = "Logic";
                    DtModuleCopy.Columns.Add(fieldName4, typeof(int));
                    band4.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName4, HeaderText = fieldName4, Width = 50, Visible = true, IsVertical = false, Settings = SettingsType.Default });

                    ModuleBands.Add(band4);

                    //Sale Currency
                    BandItem band5 = new BandItem() { BandName = "sale Price", BandHeader = "Sale Price", Visible = true };
                    band5.Columns = new ObservableCollection<ColumnItem>();
                    int count = 0;
                    foreach (Currency currency in SelectedSaleCurrency)
                    {
                        // code modified for reorder by common currency 
                        if (count == 0)
                        {
                            count = 1;
                            string fieldName = "Common_Cur";
                            DtModuleCopy.Columns.Add(fieldName, typeof(double));
                            band5.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                            DtModuleCopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));

                            if (currency.Name != ((Currency)SelectedCurrency).Name)
                            {
                                string fieldName1 = currency.Name;
                                DtModuleCopy.Columns.Add(fieldName1, typeof(double));
                                band5.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName1, HeaderText = fieldName1, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                DtModuleCopy.Columns.Add("CurrencyConversionRate_" + fieldName1, typeof(double));
                            }
                        }
                        else
                        {
                            if (currency.Name != ((Currency)SelectedCurrency).Name)
                            {
                                string fieldName1 = currency.Name;
                                DtModuleCopy.Columns.Add(fieldName1, typeof(double));
                                band5.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName1, HeaderText = fieldName1, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                DtModuleCopy.Columns.Add("CurrencyConversionRate_" + fieldName1, typeof(double));
                            }
                        }
                    }

                    ModuleBands.Add(band5);

                    //Profit
                    BandItem band6 = new BandItem() { BandName = "all7", Visible = true };
                    band6.Columns = new ObservableCollection<ColumnItem>();
                    string fieldName5 = "Profit";
                    DtModuleCopy.Columns.Add(fieldName5, typeof(double));
                    band6.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName5, HeaderText = "Profit", Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });
                    ModuleBands.Add(band6);

                    //Cost Margin
                    BandItem band7 = new BandItem() { BandName = "all8", Visible = true };
                    band7.Columns = new ObservableCollection<ColumnItem>();
                    string fieldName6 = "CostMargin";
                    DtModuleCopy.Columns.Add(fieldName6, typeof(double));
                    band7.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName6, HeaderText = "Cost Margin", Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });
                    ModuleBands.Add(band7);

                    // Delete Button
                    BandItem band8 = new BandItem() { BandName = "all9", AllowBandMove = false, Visible = true, AllowMoving = DevExpress.Utils.DefaultBoolean.False };
                    band8.Columns = new ObservableCollection<ColumnItem>();
                    band8.Columns.Add(new ColumnItem() { ColumnFieldName = "Delete", HeaderText = " ", Width = 50, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    ModuleBands.Add(band8);

                    ModuleBands = new ObservableCollection<BandItem>(ModuleBands);
                }
                GeosApplication.Instance.Logger.Log("Method AddColumnsToModuleDataTable executed Successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in AddColumnsToModuleDataTable() method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), "Red", CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in AddColumnsToModuleDataTable() Method - ServiceUnexceptedException " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in AddColumnsToModuleDataTable() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        private void AddColumnsToModuleDataTable01()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method AddColumnsToModuleDataTable ...", category: Category.Info, priority: Priority.Low);
                if (SelectedSaleCurrency == null)
                    SelectedSaleCurrency = new List<object>();

                if (SelectedPlant == null)
                    SelectedPlant = new List<object>();

                if (SelectedCurrency == null)
                {
                    SelectedCurrency = new object();
                    SelectedCurrency_Copy = new object();
                }

                if (ModuleBands.Count > 0)
                {
                    foreach (BandItem bandItem in ModuleBands)
                    {

                        if (bandItem.BandHeader == "Plant")
                        {
                            foreach (Site plant in SelectedPlant)
                            {
                                if (!bandItem.Columns.Any(a => a.HeaderText == plant.Name))
                                {
                                    string fieldName = plant.Name;
                                    DtModuleCopy.Columns.Add(fieldName, typeof(double));
                                    bandItem.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = fieldName, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });
                                }
                            }
                            List<ColumnItem> columns = new List<ColumnItem>(bandItem.Columns);
                            if (bandItem.Columns.Count != SelectedPlant.Count)
                            {
                                foreach (ColumnItem columnItem in columns.ToList())
                                {
                                    if (!SelectedPlant.Cast<Site>().Any(a => a.Name == columnItem.HeaderText))
                                    {
                                        string fieldName = columnItem.HeaderText;
                                        DtModuleCopy.Columns.Remove(fieldName);
                                        bandItem.Columns.Remove(columnItem);
                                    }
                                }
                            }
                        }
                        else if (bandItem.BandHeader == "Max Cost")
                        {
                            if (((Currency)SelectedCurrency).Name != bandItem.Columns.FirstOrDefault().HeaderText)
                            {
                                string fieldName = bandItem.Columns.FirstOrDefault().ColumnFieldName;
                                DtModuleCopy.Columns.Remove(fieldName);
                                bandItem.Columns.Remove(bandItem.Columns.FirstOrDefault());

                                string fieldName2 = "MaxCost_1";
                                DtModuleCopy.Columns.Add(fieldName2, typeof(double));
                                bandItem.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName2, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });

                            }
                        }
                        else if (bandItem.BandHeader == "Sale Price")
                        {
                            foreach (Currency currency in SelectedSaleCurrency)
                            {
                                if (!bandItem.Columns.Any(a => a.HeaderText == currency.Name))
                                {
                                    string fieldName = currency.Name;
                                    DtModuleCopy.Columns.Add(fieldName, typeof(double));
                                    bandItem.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = fieldName, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                    DtModuleCopy.Columns.Add("CurrencyConversionRate_" + currency.Name, typeof(double));
                                }
                            }
                            List<ColumnItem> columns = new List<ColumnItem>(bandItem.Columns);
                            if (bandItem.Columns.Count != SelectedSaleCurrency.Count)
                            {
                                foreach (ColumnItem columnItem in columns.ToList())
                                {
                                    if (!SelectedSaleCurrency.Cast<Currency>().Any(a => a.Name == columnItem.HeaderText))
                                    {
                                        string fieldName = columnItem.HeaderText;
                                        DtModuleCopy.Columns.Remove(fieldName);
                                        bandItem.Columns.Remove(columnItem);

                                        DtModuleCopy.Columns.Remove("CurrencyConversionRate_" + fieldName);
                                    }
                                }
                            }
                            if (!SelectedSaleCurrency.Cast<Currency>().Any(a => a.Name == ((Currency)SelectedCurrency).Name))
                            {
                                SelectedSaleCurrency.Add(SaleCurrencyList.FirstOrDefault(a => a.Name == ((Currency)SelectedCurrency).Name));
                                SelectedSaleCurrency = new List<object>(SelectedSaleCurrency);
                                string fieldName = "Common_Cur";
                                DtModuleCopy.Columns.Remove(fieldName);
                                DtModuleCopy.Columns.Add(fieldName, typeof(double));
                                bandItem.Columns.Remove(bandItem.Columns.FirstOrDefault(a => a.ColumnFieldName == fieldName));
                                bandItem.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });

                                DtModuleCopy.Columns.Remove("CurrencyConversionRate_" + fieldName);
                                DtModuleCopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));


                                string fieldName1 = ((Currency)SelectedCurrency_Copy).Name;
                                DtModuleCopy.Columns.Add(fieldName1, typeof(double));
                                bandItem.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName1, HeaderText = fieldName1, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                DtModuleCopy.Columns.Add("CurrencyConversionRate_" + fieldName1, typeof(double));


                                SelectedSaleCurrency_Copy = SelectedSaleCurrency;
                            }
                        }
                    }

                    // reorder by common currency
                    BandItem item = ModuleBands.FirstOrDefault(a => a.BandHeader == "Sale Price");
                    if (item.Columns.FirstOrDefault().HeaderText != ((Currency)SelectedCurrency).Name)
                    {
                        int count = 0;
                        foreach (Currency item1 in SelectedSaleCurrency.Cast<Currency>())
                        {
                            if (count == 0)
                            {
                                count = 1;
                                //string fieldName = ((Currency)SelectedCurrency).Name;
                                string fieldName = "Common_Cur";
                                DtModuleCopy.Columns.Remove(fieldName);
                                DtModuleCopy.Columns.Add(fieldName, typeof(double));
                                item.Columns.Remove(item.Columns.FirstOrDefault(a => a.ColumnFieldName == fieldName));
                                item.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                DtModuleCopy.Columns.Remove("CurrencyConversionRate_" + fieldName);
                                DtModuleCopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));


                                if (DtModuleCopy.Columns.Contains(((Currency)SelectedCurrency).Name))
                                    DtModuleCopy.Columns.Remove(((Currency)SelectedCurrency).Name);

                                if (DtModuleCopy.Columns.Contains("CurrencyConversionRate_" + ((Currency)SelectedCurrency).Name))
                                    DtModuleCopy.Columns.Remove("CurrencyConversionRate_" + ((Currency)SelectedCurrency).Name);

                                item.Columns.Remove(item.Columns.FirstOrDefault(a => a.ColumnFieldName == ((Currency)SelectedCurrency).Name));

                                if (item1.Name != ((Currency)SelectedCurrency).Name)
                                {
                                    string fieldName1 = item1.Name;
                                    if (DtModuleCopy.Columns.Contains(fieldName1))
                                        DtModuleCopy.Columns.Remove(fieldName1);

                                    DtModuleCopy.Columns.Add(fieldName1, typeof(double));
                                    item.Columns.Remove(item.Columns.FirstOrDefault(a => a.ColumnFieldName == fieldName1));
                                    item.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName1, HeaderText = fieldName1, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });

                                    if (DtModuleCopy.Columns.Contains("CurrencyConversionRate_" + fieldName1))
                                        DtModuleCopy.Columns.Remove("CurrencyConversionRate_" + fieldName1);

                                    DtModuleCopy.Columns.Add("CurrencyConversionRate_" + fieldName1, typeof(double));
                                }
                            }
                            else
                            {
                                if (item1.Name != ((Currency)SelectedCurrency).Name)
                                {
                                    string fieldName = item1.Name;
                                    if (DtModuleCopy.Columns.Contains(fieldName))
                                        DtModuleCopy.Columns.Remove(fieldName);

                                    DtModuleCopy.Columns.Add(fieldName, typeof(double));
                                    item.Columns.Remove(item.Columns.FirstOrDefault(a => a.ColumnFieldName == fieldName));
                                    item.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = fieldName, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });

                                    if (DtModuleCopy.Columns.Contains("CurrencyConversionRate_" + fieldName))
                                        DtModuleCopy.Columns.Remove("CurrencyConversionRate_" + fieldName);

                                    DtModuleCopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));
                                }
                            }
                        }
                    }
                    ModuleBands = new ObservableCollection<BandItem>(ModuleBands);
                }
                else
                {
                    DtModuleCopy = new DataTable();
                    ModuleBands.Clear();
                    BandItem band1 = new BandItem() { BandName = "all", AllowBandMove = false, FixedStyle = FixedStyle.Left, Visible = true, AllowMoving = DevExpress.Utils.DefaultBoolean.False };
                    band1.Columns = new ObservableCollection<ColumnItem>();
                    band1.Columns.Add(new ColumnItem() { ColumnFieldName = "IsChecked", HeaderText = " ", Width = 50, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    band1.Columns.Add(new ColumnItem() { ColumnFieldName = "Code", HeaderText = "Code", Width = 100, IsVertical = false, Settings = SettingsType.Default, Visible = true });

                    ModuleBands.Add(band1);
                    BandItem band2 = new BandItem() { BandName = "all1", Visible = true };
                    band2.Columns = new ObservableCollection<ColumnItem>();
                    band2.Columns.Add(new ColumnItem() { ColumnFieldName = "Name", HeaderText = "Name", Width = 350, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    band2.Columns.Add(new ColumnItem() { ColumnFieldName = "Type", HeaderText = "Template", Width = 100, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    band2.Columns.Add(new ColumnItem() { ColumnFieldName = "STAT", HeaderText = "STAT", Width = 40, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    //  band2.Columns.Add(new ColumnItem() { ColumnFieldName = "HtmlColor", HeaderText = "HtmlColor", Width = 10, Visible = false, IsVertical = false, Settings = SettingsType.Hidden });

                    ModuleBands.Add(band2);
                    DtModuleCopy = new DataTable();
                    DtModuleCopy.Columns.Add("IsChecked", typeof(bool));
                    DtModuleCopy.Columns.Add("Code", typeof(string));
                    DtModuleCopy.Columns.Add("Type", typeof(string));
                    DtModuleCopy.Columns.Add("STAT", typeof(string));
                    DtModuleCopy.Columns.Add("HtmlColor", typeof(string));
                    DtModuleCopy.Columns.Add("Name", typeof(string));
                    DtModuleCopy.Columns.Add("IdCPType", typeof(UInt32));
                    DtModuleCopy.Columns.Add("CurrencyConversionDate", typeof(DateTime));
                    DtModuleCopy.Columns.Add("IsColor", typeof(bool)).DefaultValue = false;
                    DtModuleCopy.Columns.Add("IsUpdatedRow", typeof(bool)).DefaultValue = false;
                    DtModuleCopy.Columns.Add("SaleCurrencyConversionDate", typeof(string));

                    //band2.Columns.Add(new ColumnItem() { ColumnFieldName = "Name", HeaderText = "Name", Width = 350, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    //band2.Columns.Add(new ColumnItem() { ColumnFieldName = "Category", HeaderText = "Category", Width = 100, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    //band2.Columns.Add(new ColumnItem() { ColumnFieldName = "STAT", HeaderText = "STAT", Width = 40, IsVertical = false, Settings = SettingsType.Default, Visible = true });

                    //ModuleBands.Add(band2);

                    //DtModuleCopy = new DataTable();
                    //DtModuleCopy.Columns.Add("IsChecked", typeof(bool));
                    //DtModuleCopy.Columns.Add("Reference", typeof(string));
                    //DtModuleCopy.Columns.Add("Category", typeof(string));
                    //DtModuleCopy.Columns.Add("STAT", typeof(string));
                    //DtModuleCopy.Columns.Add("HtmlColor", typeof(string));
                    //DtModuleCopy.Columns.Add("Name", typeof(string));
                    //DtModuleCopy.Columns.Add("IdArticle", typeof(UInt32));
                    //DtModuleCopy.Columns.Add("CurrencyConversionDate", typeof(DateTime));
                    //DtModuleCopy.Columns.Add("IsColor", typeof(bool)).DefaultValue = false;
                    //DtModuleCopy.Columns.Add("IsUpdatedRow", typeof(bool)).DefaultValue = false;
                    //DtModuleCopy.Columns.Add("SaleCurrencyConversionDate", typeof(string));


                    //plant
                    BandItem band3 = new BandItem() { BandName = "plant", BandHeader = "Plant", Visible = true };
                    band3.Columns = new ObservableCollection<ColumnItem>();

                    foreach (Site plant in SelectedPlant)
                    {
                        string fieldName = plant.Name;
                        DtModuleCopy.Columns.Add(fieldName, typeof(double));
                        band3.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = fieldName, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });
                    }

                    ModuleBands.Add(band3);
                    //max cost
                    BandItem band4 = new BandItem() { BandName = "max Cost", BandHeader = "Max Cost", Visible = true };
                    band4.Columns = new ObservableCollection<ColumnItem>();
                    string fieldName2 = "MaxCost_1";
                    DtModuleCopy.Columns.Add(fieldName2, typeof(double));
                    band4.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName2, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });

                    ModuleBands.Add(band4);
                    //rule
                    BandItem band5 = new BandItem() { BandName = "rule", BandHeader = "Rule", Visible = true };
                    band5.Columns = new ObservableCollection<ColumnItem>();

                    string fieldName3 = "Value";
                    DtModuleCopy.Columns.Add("Value", typeof(float));
                    band5.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName3, HeaderText = fieldName3, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });

                    string fieldName4 = "Logic";
                    DtModuleCopy.Columns.Add(fieldName4, typeof(int));
                    band5.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName4, HeaderText = fieldName4, Width = 50, Visible = true, IsVertical = false, Settings = SettingsType.Default });


                    ModuleBands.Add(band5);

                    //Sale Currency
                    BandItem band6 = new BandItem() { BandName = "sale Price", BandHeader = "Sale Price", Visible = true };
                    band6.Columns = new ObservableCollection<ColumnItem>();
                    int count = 0;
                    foreach (Currency currency in SelectedSaleCurrency)
                    {
                        // code modified for reorder by common currency 
                        if (count == 0)
                        {
                            count = 1;
                            string fieldName = "Common_Cur";
                            DtModuleCopy.Columns.Add(fieldName, typeof(double));
                            band6.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                            DtModuleCopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));

                            if (currency.Name != ((Currency)SelectedCurrency).Name)
                            {
                                string fieldName1 = currency.Name;
                                DtModuleCopy.Columns.Add(fieldName1, typeof(double));
                                band6.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName1, HeaderText = fieldName1, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                DtModuleCopy.Columns.Add("CurrencyConversionRate_" + fieldName1, typeof(double));
                            }
                        }
                        else
                        {
                            if (currency.Name != ((Currency)SelectedCurrency).Name)
                            {
                                string fieldName1 = currency.Name;
                                DtModuleCopy.Columns.Add(fieldName1, typeof(double));
                                band6.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName1, HeaderText = fieldName1, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                DtModuleCopy.Columns.Add("CurrencyConversionRate_" + fieldName1, typeof(double));
                            }
                        }
                    }

                    //Profit
                    BandItem band7 = new BandItem() { BandName = "all2", Visible = true };
                    band7.Columns = new ObservableCollection<ColumnItem>();
                    string fieldName5 = "Profit";
                    DtModuleCopy.Columns.Add(fieldName5, typeof(double));
                    band7.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName5, HeaderText = "Profit", Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });

                    //Cost Margin
                    BandItem band8 = new BandItem() { BandName = "all3", Visible = true };
                    band8.Columns = new ObservableCollection<ColumnItem>();
                    string fieldName6 = "CostMargin";
                    DtModuleCopy.Columns.Add(fieldName6, typeof(double));
                    band8.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName6, HeaderText = "Cost Margin", Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });

                    BandItem band9 = new BandItem() { BandName = "all4", AllowBandMove = false, Visible = true, AllowMoving = DevExpress.Utils.DefaultBoolean.False };
                    band9.Columns = new ObservableCollection<ColumnItem>();
                    band9.Columns.Add(new ColumnItem() { ColumnFieldName = "Delete", HeaderText = " ", Width = 50, IsVertical = false, Settings = SettingsType.Default, Visible = true });



                    ModuleBands.Add(band6);
                    ModuleBands.Add(band7);
                    ModuleBands.Add(band8);
                    ModuleBands.Add(band9);
                    ModuleBands = new ObservableCollection<BandItem>(ModuleBands);
                }
                GeosApplication.Instance.Logger.Log("Method AddColumnsToModuleDataTable executed Successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in AddColumnsToModuleDataTable() method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), "Red", CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in AddColumnsToModuleDataTable() Method - ServiceUnexceptedException " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in AddColumnsToModuleDataTable() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        private void OnDragRecordOverModuleGrid(DragRecordOverEventArgs e)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method OnDragRecordOverModuleGrid()...", category: Category.Info, priority: Priority.Low);
                if ((e.IsFromOutside) && typeof(BPLModule).IsAssignableFrom(e.GetRecordType()))
                {
                    var data = (RecordDragDropData)e.Data.GetData(typeof(RecordDragDropData));
                    List<BPLModule> record = data.Records.OfType<BPLModule>().ToList();
                    int count = 0;
                    foreach (BPLModule detect in record.Where(a => a.IdCPType > 0))
                    {
                        DataRow[] found = DtModuleCopy.Select("IdCPType = '" + detect.IdCPType + "'");
                        if (found.Length == 0)
                        {
                            count++;
                        }
                    }
                    if (count > 0)
                    {
                        if (ClonedBasePrice != null && isDuplicateCliked == false && ClonedBasePrice.IdStatus == 224)
                        {
                            e.Effects = DragDropEffects.None;
                            e.Handled = false;
                            CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("CantAdddetectionValidation").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                            return;
                        }

                        e.Effects = DragDropEffects.Copy;
                        e.Handled = true;
                    }
                    else
                    {
                        e.Effects = DragDropEffects.None;
                        e.Handled = false;
                    }

                }
                GeosApplication.Instance.Logger.Log("Method OnDragRecordOverModuleGrid()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method OnDragRecordOverModuleGrid() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        private void DropRecordModuleGrid(DropRecordEventArgs e)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method DropRecordModuleGrid()...", category: Category.Info, priority: Priority.Low);

                double MaxCost = 0.00;
                double SellPriceValue = 0.00;

                if ((e.IsFromOutside) && typeof(BPLModule).IsAssignableFrom(e.GetRecordType()))
                {
                    var data = (RecordDragDropData)e.Data.GetData(typeof(RecordDragDropData));
                    List<BPLModule> records = data.Records.OfType<BPLModule>().ToList();

                    if (DtModuleCopy == null)
                        DtModuleCopy = new DataTable();

                    foreach (BPLModule record in records.Where(a => a.IdCPType > 0))
                    {
                        if (DtModuleCopy == null)
                            DtModuleCopy = new DataTable();
                        DataRow[] found = DtModuleCopy.Select("IdCPType = '" + record.IdCPType + "'");
                        if (found.Length == 0)
                        {
                            if (AddModules == null)
                                AddModules = new List<ulong>();

                            AddModules.Add(record.IdCPType);

                            DataRow dr = DtModuleCopy.NewRow();
                            dr["IsChecked"] = false;
                            if (record.ProductType != null)
                            {
                                if (string.IsNullOrEmpty(record.ProductType.Reference)) //[001]
                                    dr["Code"] = "---";
                                else
                                    dr["Code"] = record.ProductType.Reference;
                            }
                            else
                            {
                                dr["Code"] = "---";
                            }

                            dr["Name"] = record.Name;
                            //dr["Name"] = record.Name.Remove(record.Name.LastIndexOf("[") - 0);
                            dr["IdCPType"] = record.IdCPType;
                            dr["Type"] = record.TemplateName;
                            dr["Logic"] = 308;
                            dr["IsUpdatedRow"] = true;
                            dr["STAT"] = record.StatusAbbreviation;
                            dr["HtmlColor"] = record.StatusHtmlColor;
                            //set gray color
                            ModuleMenulist.Where(a => a.IdCPType == record.IdCPType).ToList().ForEach(b => b.IsBPLdModule_Current = true);

                            //double Cost_Value = 0;
                            dr["MaxCost_1"] = 0;

                            dr["CurrencyConversionDate"] = CurrencyConversionList.FirstOrDefault().LastUpdate;

                            foreach (Currency currency in SelectedSaleCurrency)
                            {
                                if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                    dr["Common_Cur"] = DBNull.Value;
                                else
                                    dr[currency.Name] = DBNull.Value;

                                if (dr["CurrencyConversionDate"] != DBNull.Value)
                                {
                                    CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                    if (CurConversion1 != null)
                                    {
                                        if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                            else
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                        }
                                        else
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.ExchangeRate;
                                            else
                                                dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.LastMonthAVGRate;
                                        }
                                    }
                                }
                            }

                            if (CurrencyList.Count > 0)
                            {
                                if (!CurrencyList.Any(x => x.IdCurrency == ((Currency)SelectedCurrency).IdCurrency))
                                    SellPriceValue = 0.00;
                                else
                                    SellPriceValue = Convert.ToDouble(CurrencyList.Where(x => x.IdCurrency == ((Currency)SelectedCurrency).IdCurrency).Select(x => x.SellPriceValue).FirstOrDefault());
                            }

                            MaxCost = (double)dr["MaxCost_1"];

                            dr["Profit"] = Convert.ToDouble(CalculateBasePriceProfitValue(MaxCost, SellPriceValue));

                            dr["CostMargin"] = Convert.ToDouble(CalculateBasePriceCostMarginValue(MaxCost, SellPriceValue));
                            if (dr["CurrencyConversionDate"] != DBNull.Value)
                            {
                                if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                {
                                    dr["SaleCurrencyConversionDate"] = "Updated currency rate on : " + Convert.ToDateTime(dr["CurrencyConversionDate"]).ToString("dd/MM/yyyy");
                                }
                                else
                                {
                                    DateTime dtCurrencyConversionDate = new DateTime(Convert.ToDateTime(dr["CurrencyConversionDate"]).Year, Convert.ToDateTime(dr["CurrencyConversionDate"]).Month, 1);
                                    dr["SaleCurrencyConversionDate"] = "Updated currency rate on : " + dtCurrencyConversionDate.ToString("dd/MM/yyyy");
                                }
                            }
                            DtModuleCopy.Rows.Add(dr);


                            e.Handled = true;
                            if (!isDuplicateCliked) IsEnabledSaveButton = true;
                        }
                    }
                    #region BPLModule
                    ObservableCollection<BPLModule> ModuleMenuListtemp1 = new ObservableCollection<BPLModule>();
                    foreach (BPLModule item in ModuleMenulist)
                    {
                        string TempName = item.Name.Remove(item.Name.LastIndexOf("[") + 1);
                        int t = ModuleMenulist.Where(x => x.Parent == item.Key && x.IsBPLdModule_Current == false).ToList().Count;
                        BPLModule ModuleMenuList1 = new BPLModule();
                        ModuleMenuList1.IdCPType = item.IdCPType;
                        //Shubham[skadam] GEOS2-4784 GEOS2-4785 No additional data so remove [0] this in tree menu in article, detection & module  left tree in BPL menu 29 08 2023
                        //ModuleMenuList1.Name = TempName + ModuleMenulist.Where(x => x.Parent == item.Key && x.IsBPLdModule_Current == false).ToList().Count + "]";
                        try
                        {
                            Int64 Count = ModuleMenulist.Where(x => x.Parent == item.Key && x.IsBPLdModule_Current == false).ToList().Count;
                            if (Count != 0)
                            {
                                ModuleMenuList1.Name = TempName + Count + "]";
                            }
                            else
                            {
                                if (!string.IsNullOrEmpty(TempName))
                                {
                                    ModuleMenuList1.Name = TempName.Remove(TempName.Length - 1);
                                }
                                else
                                {
                                    if (!string.IsNullOrEmpty(item.Name))
                                    {
                                        ModuleMenuList1.Name = item.Name;
                                    }
                                    else
                                    {
                                        ModuleMenuList1.Name = "";
                                    }
                                }
                            }
                        }
                        catch (Exception ex) { }
                        ModuleMenuList1.Parent = item.Parent;
                        ModuleMenuList1.Key = item.Key;
                        //ModuleMenuList1.Description = item.Description;
                        ModuleMenuList1.TemplateName = item.TemplateName;
                        ModuleMenuList1.IdTemplate = item.IdTemplate;
                        // ModuleMenuList1.IdGroup = item.IdGroup;
                        // ModuleMenuList1.Code = item.Code;
                        ModuleMenuList1.StatusHtmlColor = item.StatusHtmlColor;
                        ModuleMenuList1.StatusAbbreviation = item.StatusAbbreviation;
                        ModuleMenuList1.IsBPLdModule_Current = item.IsBPLdModule_Current;
                        ModuleMenuList1.ProductType = item.ProductType;
                        ModuleMenuListtemp1.Add(ModuleMenuList1);
                    }
                    ModuleMenulist = new ObservableCollection<BPLModule>();
                    ModuleMenulist.AddRange(ModuleMenuListtemp1);

                    #endregion
                    DtModule = DtModuleCopy;
                    ModuleAddCustomSetting();
                }
                GeosApplication.Instance.Logger.Log("Method DropRecordModuleGrid()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method DropRecordModuleGrid() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void CompleteRecordDragDropModuleGrid(CompleteRecordDragDropEventArgs e)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method CompleteRecordDragDropModuleGrid()...", category: Category.Info, priority: Priority.Low);
                e.Handled = false;
                GeosApplication.Instance.Logger.Log("Method CompleteRecordDragDropModuleGrid()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method CompleteRecordDragDropModuleGrid() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void RuleValueModuleChangedCommandAction(object obj)
        {
            try
            {
                if (obj == null)
                    return;

                double MaxCost = 0.00;
                double SellPriceValue = 0.00;

                GeosApplication.Instance.Logger.Log("Method RuleValueDetectionChangedCommandAction()....", category: Category.Info, priority: Priority.Low);

                if (((DevExpress.Xpf.Grid.CellValueEventArgs)obj).Column.FieldName == "Value" || ((DevExpress.Xpf.Grid.CellValueEventArgs)obj).Column.FieldName == "Logic" || ((DevExpress.Xpf.Grid.CellValueEventArgs)obj).Column.FieldName.Contains("_1"))
                {
                    IsCalculateArticleCostButtonEnabled = true;
                    IsCalculated = false;
                    DataColumn[] columns = DtModuleCopy.Columns.Cast<DataColumn>().ToArray();
                    DataRow[] foundChecked = DtModuleCopy.AsEnumerable().Where(row => columns.Any(col => row["IsChecked"].ToString() == "True")).ToArray();

                    DataRow MainRow = ((System.Data.DataRowView)((DevExpress.Xpf.Grid.RowEventArgs)obj).Row).Row;

                    if (foundChecked.Length > 0 && MainRow["IsChecked"].ToString() != "False")
                    {
                        for (int j = 0; j < foundChecked.Length; j++)
                        {
                            foundChecked[j].BeginEdit();

                            if (((DevExpress.Xpf.Grid.CellValueEventArgs)obj).Column.FieldName.Contains("_1"))
                            {
                                if (MainRow["MaxCost_1"] == DBNull.Value)
                                {
                                    MainRow["MaxCost_1"] = 0;
                                }
                                foundChecked[j]["MaxCost_1"] = MainRow["MaxCost_1"];
                            }
                            else
                            {
                                if (foundChecked[j]["MaxCost_1"] == DBNull.Value)
                                {
                                    foundChecked[j]["MaxCost_1"] = 0;
                                }
                            }
                            if (((DevExpress.Xpf.Grid.CellValueEventArgs)obj).Column.FieldName == "Value")
                            {
                                if (MainRow["Value"] == DBNull.Value)
                                {
                                    MainRow["Value"] = 0;
                                }
                                foundChecked[j]["Value"] = MainRow["Value"];
                            }
                            else
                            {
                                if (foundChecked[j]["Value"] == DBNull.Value)
                                {
                                    foundChecked[j]["Value"] = 0;
                                }
                            }

                            if (((DevExpress.Xpf.Grid.CellValueEventArgs)obj).Column.FieldName == "Logic")
                            {
                                if (MainRow["Logic"] == DBNull.Value)
                                {
                                    MainRow["Logic"] = 308;
                                }
                                foundChecked[j]["Logic"] = MainRow["Logic"];
                            }
                            else
                            {
                                if (foundChecked[j]["Logic"] == DBNull.Value)
                                {
                                    foundChecked[j]["Logic"] = 308;
                                }
                            }

                            if (MainRow["IsChecked"].ToString() != "False")
                            {
                                foundChecked[j]["IsColor"] = true;
                                foundChecked[j]["IsUpdatedRow"] = true;

                                if (Convert.ToInt32(foundChecked[j]["Logic"]) == 307)
                                {
                                    foundChecked[j]["Common_Cur"] = Convert.ToDouble(foundChecked[j]["MaxCost_1"]) + (Convert.ToDouble(foundChecked[j]["MaxCost_1"]) * (Convert.ToDouble(foundChecked[j]["Value"]) / 100));

                                    foreach (Currency cur in SelectedSaleCurrency)
                                    {
                                        if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            if (foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != null && foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != "")
                                                foundChecked[j]["Common_Cur"] = Convert.ToDouble(foundChecked[j]["Common_Cur"]) * Convert.ToDouble(foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"]);
                                            else
                                                foundChecked[j]["Common_Cur"] = DBNull.Value;
                                        }
                                        else
                                        {
                                            if (foundChecked[j]["CurrencyConversionRate_" + cur.Name] != DBNull.Value && foundChecked[j]["CurrencyConversionRate_" + cur.Name] != null && foundChecked[j]["CurrencyConversionRate_" + cur.Name] != "")
                                                foundChecked[j][cur.Name] = Convert.ToDouble(foundChecked[j]["Common_Cur"]) * Convert.ToDouble(foundChecked[j]["CurrencyConversionRate_" + cur.Name]);
                                            else
                                                foundChecked[j][cur.Name] = DBNull.Value;
                                        }
                                    }

                                }

                                else if (Convert.ToInt32(foundChecked[j]["Logic"]) == 308)
                                {
                                    if (foundChecked[j]["Value"] == null || foundChecked[j]["Value"] == DBNull.Value)
                                    {
                                        foundChecked[j]["Value"] = DBNull.Value;

                                        foreach (Currency cur in SelectedSaleCurrency)
                                        {
                                            if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                foundChecked[j]["Common_Cur"] = DBNull.Value;
                                            }
                                            else
                                            {
                                                foundChecked[j][cur.Name] = DBNull.Value;
                                            }
                                        }
                                    }
                                    else if (foundChecked[j]["Value"] != null && Convert.ToDouble(foundChecked[j]["Value"]) <= 0)
                                    {
                                        foundChecked[j]["Value"] = DBNull.Value;

                                        foreach (Currency cur in SelectedSaleCurrency)
                                        {
                                            if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                foundChecked[j]["Common_Cur"] = DBNull.Value;
                                            }
                                            else
                                            {
                                                foundChecked[j][cur.Name] = DBNull.Value;
                                            }
                                        }
                                    }
                                    else
                                    {
                                        foundChecked[j]["Common_Cur"] = foundChecked[j]["Value"];

                                        foreach (Currency cur in SelectedSaleCurrency)
                                        {
                                            if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                if (foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != null && foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != "")
                                                    foundChecked[j]["Common_Cur"] = Convert.ToDouble(foundChecked[j]["Common_Cur"]) * Convert.ToDouble(foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"]);
                                                else
                                                    foundChecked[j]["Common_Cur"] = DBNull.Value;
                                            }
                                            else
                                            {
                                                if (foundChecked[j]["CurrencyConversionRate_" + cur.Name] != DBNull.Value && foundChecked[j]["CurrencyConversionRate_" + cur.Name] != null && foundChecked[j]["CurrencyConversionRate_" + cur.Name] != "")
                                                    foundChecked[j][cur.Name] = Convert.ToDouble(foundChecked[j]["Common_Cur"]) * Convert.ToDouble(foundChecked[j]["CurrencyConversionRate_" + cur.Name]);
                                                else
                                                    foundChecked[j][cur.Name] = DBNull.Value;
                                            }
                                        }
                                    }
                                }
                                else if (Convert.ToInt32(foundChecked[j]["Logic"]) == 1518)
                                {


                                    if (foundChecked[j]["Value"] == null || foundChecked[j]["Value"] == DBNull.Value)
                                    {
                                        foundChecked[j]["Value"] = 0;

                                        foreach (Currency cur in SelectedSaleCurrency)
                                        {
                                            if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                foundChecked[j]["Common_Cur"] = 0;
                                            }
                                            else
                                            {
                                                foundChecked[j][cur.Name] = 0;
                                            }
                                        }
                                    }
                                    else if (foundChecked[j]["Value"] != null)
                                    {
                                        foundChecked[j]["Value"] = 0;

                                        foreach (Currency cur in SelectedSaleCurrency)
                                        {
                                            if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                foundChecked[j]["Common_Cur"] = 0;
                                            }
                                            else
                                            {
                                                foundChecked[j][cur.Name] = 0;
                                            }
                                        }
                                    }

                                }

                                else if (Convert.ToInt32(foundChecked[j]["Logic"]) == 309)
                                {
                                    foundChecked[j]["Common_Cur"] = Convert.ToDouble(foundChecked[j]["MaxCost_1"]) + (Convert.ToDouble(foundChecked[j]["Value"]));

                                    foreach (Currency cur in SelectedSaleCurrency)
                                    {
                                        if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            if (foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != null && foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != "")
                                                foundChecked[j]["Common_Cur"] = Convert.ToDouble(foundChecked[j]["Common_Cur"]) * Convert.ToDouble(foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"]);
                                            else
                                                foundChecked[j]["Common_Cur"] = DBNull.Value;
                                        }
                                        else
                                        {
                                            if (foundChecked[j]["CurrencyConversionRate_" + cur.Name] != DBNull.Value && foundChecked[j]["CurrencyConversionRate_" + cur.Name] != null && foundChecked[j]["CurrencyConversionRate_" + cur.Name] != "")
                                                foundChecked[j][cur.Name] = Convert.ToDouble(foundChecked[j]["Common_Cur"]) * Convert.ToDouble(foundChecked[j]["CurrencyConversionRate_" + cur.Name]);
                                            else
                                                foundChecked[j][cur.Name] = DBNull.Value;
                                        }
                                    }
                                }

                                if (foundChecked[j]["Common_Cur"] != DBNull.Value)
                                    SellPriceValue = Convert.ToDouble(foundChecked[j]["Common_Cur"]);

                                if (foundChecked[j]["MaxCost_1"] != DBNull.Value)
                                    MaxCost = Convert.ToDouble(foundChecked[j]["MaxCost_1"]);

                                foundChecked[j]["Profit"] = Convert.ToDouble(CalculateBasePriceProfitValue(MaxCost, SellPriceValue));
                                foundChecked[j]["CostMargin"] = Convert.ToDouble(CalculateBasePriceCostMarginValue(MaxCost, SellPriceValue));
                            }
                        }
                    }
                    else
                    {
                        DataRow Row = ((System.Data.DataRowView)((DevExpress.Xpf.Grid.RowEventArgs)obj).Row).Row;
                        Row["IsColor"] = true;
                        Row["IsUpdatedRow"] = true;

                        if (Row["MaxCost_1"] == DBNull.Value)
                        {
                            Row["MaxCost_1"] = 0;
                        }
                        if (Row["Value"] == DBNull.Value)
                        {
                            Row["Value"] = 0;
                        }

                        if (Row["Logic"] == DBNull.Value)
                        {
                            Row["Logic"] = 308;
                        }

                        if (Convert.ToInt32(Row["Logic"]) == 307)
                        {
                            Row["Common_Cur"] = Convert.ToDouble(Row["MaxCost_1"]) + ((Convert.ToDouble(Row["MaxCost_1"]) * (Convert.ToDouble(Row["Value"]) / 100)));

                            foreach (Currency cur in SelectedSaleCurrency)
                            {
                                if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                {
                                    if (Row["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && Row["CurrencyConversionRate_" + "Common_Cur"] != null && Row["CurrencyConversionRate_" + "Common_Cur"] != "")
                                    {
                                        Row["Common_Cur"] = Convert.ToDouble(Row["Common_Cur"]) * Convert.ToDouble(Row["CurrencyConversionRate_" + "Common_Cur"]);
                                    }
                                    else
                                        Row["Common_Cur"] = DBNull.Value;
                                }
                                else
                                {
                                    if (Row["CurrencyConversionRate_" + cur.Name] != DBNull.Value && Row["CurrencyConversionRate_" + cur.Name] != null && Row["CurrencyConversionRate_" + cur.Name] != "")
                                    {
                                        Row[cur.Name] = Convert.ToDouble(Row["Common_Cur"]) * Convert.ToDouble(Row["CurrencyConversionRate_" + cur.Name]);
                                    }
                                    else
                                        Row[cur.Name] = DBNull.Value;
                                }
                            }
                        }
                        else if (Convert.ToInt32(Row["Logic"]) == 308)
                        {
                            if (Row["Value"] == null || Row["Value"] == DBNull.Value)
                            {
                                Row["Value"] = DBNull.Value;

                                foreach (Currency cur in SelectedSaleCurrency)
                                {
                                    if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        Row["Common_Cur"] = DBNull.Value;
                                    else
                                        Row[cur.Name] = DBNull.Value;
                                }
                            }
                            else if (Row["Value"] != null && Convert.ToDouble(Row["Value"]) <= 0)
                            {
                                Row["Value"] = DBNull.Value;

                                foreach (Currency cur in SelectedSaleCurrency)
                                {
                                    if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        Row["Common_Cur"] = DBNull.Value;
                                    else
                                        Row[cur.Name] = DBNull.Value;
                                }
                            }
                            else
                            {
                                Row["Common_Cur"] = Row["Value"];
                                foreach (Currency cur in SelectedSaleCurrency)
                                {
                                    if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                    {
                                        if (Row["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && Row["CurrencyConversionRate_" + "Common_Cur"] != null && Row["CurrencyConversionRate_" + "Common_Cur"] != "")
                                        {
                                            Row["Common_Cur"] = Convert.ToDouble(Row["Common_Cur"]) * Convert.ToDouble(Row["CurrencyConversionRate_" + "Common_Cur"]);
                                        }
                                        else
                                            Row["Common_Cur"] = DBNull.Value;
                                    }
                                    else
                                    {
                                        if (Row["CurrencyConversionRate_" + cur.Name] != DBNull.Value && Row["CurrencyConversionRate_" + cur.Name] != null && Row["CurrencyConversionRate_" + cur.Name] != "")
                                        {
                                            Row[cur.Name] = Convert.ToDouble(Row["Common_Cur"]) * Convert.ToDouble(Row["CurrencyConversionRate_" + cur.Name]);
                                        }
                                        else
                                            Row[cur.Name] = DBNull.Value;
                                    }
                                }
                            }
                        }
                        else if (Convert.ToInt32(Row["Logic"]) == 1518)
                        {

                            if (Row["Value"] == null || Row["Value"] == DBNull.Value)
                            {
                                Row["Value"] = 0;

                                foreach (Currency cur in SelectedSaleCurrency)
                                {
                                    if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        Row["Common_Cur"] = 0;
                                    else
                                        Row[cur.Name] = 0;
                                }
                            }
                            else if (Row["Value"] != null)
                            {
                                Row["Value"] = 0;

                                foreach (Currency cur in SelectedSaleCurrency)
                                {
                                    if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        Row["Common_Cur"] = 0;
                                    else
                                        Row[cur.Name] = 0;
                                }
                            }

                        }
                        else if (Convert.ToInt32(Row["Logic"]) == 309)
                        {
                            Row["Common_Cur"] = Convert.ToDouble(Row["MaxCost_1"]) + (Convert.ToDouble(Row["Value"]));

                            foreach (Currency cur in SelectedSaleCurrency)
                            {
                                if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                {
                                    if (Row["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && Row["CurrencyConversionRate_" + "Common_Cur"] != null && Row["CurrencyConversionRate_" + "Common_Cur"] != "")
                                    {
                                        Row["Common_Cur"] = Convert.ToDouble(Row["Common_Cur"]) * Convert.ToDouble(Row["CurrencyConversionRate_" + "Common_Cur"]);
                                    }
                                    else
                                        Row["Common_Cur"] = DBNull.Value;
                                }
                                else
                                {
                                    if (Row["CurrencyConversionRate_" + cur.Name] != DBNull.Value && Row["CurrencyConversionRate_" + cur.Name] != null && Row["CurrencyConversionRate_" + cur.Name] != "")
                                    {
                                        Row[cur.Name] = Convert.ToDouble(Row["Common_Cur"]) * Convert.ToDouble(Row["CurrencyConversionRate_" + cur.Name]);
                                    }
                                    else
                                        Row[cur.Name] = DBNull.Value;
                                }
                            }
                        }
                        if (Row["Common_Cur"] != DBNull.Value)
                            SellPriceValue = Convert.ToDouble(Row["Common_Cur"]);

                        if (Row["MaxCost_1"] != DBNull.Value)
                            MaxCost = Convert.ToDouble(Row["MaxCost_1"]);

                        Row["Profit"] = Convert.ToDouble(CalculateBasePriceProfitValue(MaxCost, SellPriceValue));
                        Row["CostMargin"] = Convert.ToDouble(CalculateBasePriceCostMarginValue(MaxCost, SellPriceValue));
                    }
                    DtModule.AcceptChanges();
                    if (!isDuplicateCliked) IsEnabledSaveButton = true;
                }

                GeosApplication.Instance.Logger.Log("Method RuleValueDetectionChangedCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method RuleValueDetectionChangedCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void DeleteModuleCommandAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method DeleteModuleCommandAction()...", category: Category.Info, priority: Priority.Low);

                DataColumn[] columns = DtModuleCopy.Columns.Cast<DataColumn>().ToArray();

                DataRow[] foundChecked = DtModuleCopy.AsEnumerable().Where(row => columns.Any(col => row["IsChecked"].ToString() == "True")).ToArray();
                DataRow MainRow = ((System.Data.DataRowView)obj).Row;
                CPList = new List<CustomerPrice>();

                if (ClonedBasePrice != null && isDuplicateCliked == false && ClonedBasePrice.IdStatus == 224)
                {
                    CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("CantDeleteModuleValidation").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                    return;
                }

                if (DeleteModules == null)
                    DeleteModules = new List<BPLModule>();

                if (foundChecked.Length > 0 && MainRow["IsChecked"].ToString() != "False")
                {
                    string commaSeparatedString = String.Join(",", foundChecked.AsEnumerable().Select(x => x.Field<uint>("IdCPType").ToString()).ToArray());
                    CPList.AddRange(new List<CustomerPrice>(PLMService.GetCustomerPriceIFExistDetections(IdBasePriceList, commaSeparatedString)));

                    if (CPList.Count > 0)
                    {
                        if (DeleteModuleFromCPL == null)
                            DeleteModuleFromCPL = new List<CustomerPriceListByItem>();

                        List<string> CPLCodes = CPList.Select(x => x.Code).Distinct().ToList();
                        List<string> CPLNames = new List<string>();
                        List<string> ReferencesList = new List<string>();
                        foreach (string cp in CPLCodes)
                        {
                            CPLNames.Add(cp + "-" + (CPList.Where(x => x.Code == cp).Select(x => x.Name).FirstOrDefault()));
                        }

                        foreach (DataRow dr in foundChecked)
                        {
                            if (string.IsNullOrEmpty(ModuleMenulist.Where(x => x.IdCPType == (uint)dr["IdCPType"]).Select(x => x.Name).FirstOrDefault()))
                                ReferencesList.Add(ModuleMenulist.Where(x => x.IdCPType == (uint)dr["IdCPType"]).Select(x => x.Name).FirstOrDefault());
                            else
                                ReferencesList.Add(ModuleMenulist.Where(x => x.IdCPType == (uint)dr["IdCPType"]).Select(x => x.Name).FirstOrDefault());
                        }

                        MessageBoxResult result1 = CustomMessageBox.Show(string.Format(Application.Current.Resources["DeleteBPLAndCPLDetectionList"].ToString(), string.Join(", ", ReferencesList), System.Environment.NewLine, string.Join(System.Environment.NewLine, CPLNames), System.Environment.NewLine), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                        if (result1 == MessageBoxResult.Yes)
                        {
                            if (foundChecked.Length > 0)
                            {
                                foreach (DataRow dr in foundChecked)
                                {
                                    ModuleMenulist.Where(a => a.IdCPType == (uint)dr["IdCPType"]).ToList().ForEach(b => b.IsBPLdModule_Current = false);
                                    BPLModule det = new BPLModule();
                                    det.IdCPType = (uint)dr["IdCPType"];
                                    DeleteModules.Add(det);
                                    DtModuleCopy.Rows.Remove(dr);
                                }

                                foreach (CustomerPrice deleteCPL in CPList)
                                {
                                    foreach (CustomerPriceListByItem item in deleteCPL.CustomerPriceListItems)
                                    {
                                        CustomerPriceListByItem module = new CustomerPriceListByItem();
                                        module.IdCustomerPriceList = deleteCPL.IdCustomerPriceList;
                                        module.IdCPType = item.IdCPType;
                                        DeleteModuleFromCPL.Add(module);
                                    }
                                }
                            }
                            DtModule = DtModuleCopy;
                            if (!isDuplicateCliked) IsEnabledSaveButton = true;
                        }
                    }
                    else
                    {
                        MessageBoxResult result1 = CustomMessageBox.Show(Application.Current.Resources["DeleteBPLModuleMessage"].ToString(), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                        if (result1 == MessageBoxResult.Yes)
                        {
                            if (foundChecked.Length > 0)
                            {
                                foreach (DataRow dr in foundChecked)
                                {
                                    ModuleMenulist.Where(a => a.IdCPType == (uint)dr["IdCPType"]).ToList().ForEach(b => b.IsBPLdModule_Current = false);
                                    BPLModule det = new BPLModule();
                                    det.IdCPType = (uint)dr["IdCPType"];
                                    DeleteModules.Add(det);
                                    DtModuleCopy.Rows.Remove(dr);
                                }
                            }
                            DtModule = DtModuleCopy;
                            if (!isDuplicateCliked) IsEnabledSaveButton = true;
                        }
                    }
                }
                else
                {
                    BPLModule bplModule = ModuleMenulist.Where(a => a.IdCPType == (uint)((System.Data.DataRowView)obj).Row["IdCPType"]).FirstOrDefault();
                    if (bplModule != null)
                        CPList = new List<CustomerPrice>(PLMService.GetCustomerPriceIFExistModules(IdBasePriceList, bplModule.IdCPType.ToString()));
                    else
                        CPList = new List<CustomerPrice>(PLMService.GetCustomerPriceIFExistModules(IdBasePriceList, ((System.Data.DataRowView)obj).Row["IdCPType"].ToString()));
                    if (CPList.Count > 0)
                    {
                        if (DeleteModuleFromCPL == null)
                            DeleteModuleFromCPL = new List<CustomerPriceListByItem>();

                        List<string> CPLCodes = CPList.Select(x => x.Code).Distinct().ToList();
                        List<string> CPLNames = new List<string>();
                        foreach (string cp in CPLCodes)
                        {
                            CPLNames.Add(cp + "-" + (CPList.Where(x => x.Code == cp).Select(x => x.Name).FirstOrDefault()));
                        }
                        string reference = string.Empty;
                        if (string.IsNullOrEmpty(MainRow["Code"].ToString()))
                            reference = MainRow["Name"].ToString();
                        else
                            reference = MainRow["Code"].ToString();

                        MessageBoxResult result2 = CustomMessageBox.Show(string.Format(Application.Current.Resources["DeleteBPLAndCPLModuleList"].ToString(), reference, System.Environment.NewLine, string.Join(System.Environment.NewLine, CPLNames), System.Environment.NewLine), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                        if (result2 == MessageBoxResult.Yes)
                        {
                            if (obj != null)
                            {
                                if (bplModule != null)
                                {
                                    //remove set gray color
                                    ModuleMenulist.Where(a => a.IdCPType == (uint)((System.Data.DataRowView)obj).Row["IdCPType"]).ToList().ForEach(b => b.IsBPLdModule_Current = false);
                                }
                                BPLModule det = new BPLModule();
                                det.IdCPType = (uint)((System.Data.DataRowView)obj).Row["IdCPType"];
                                DeleteModules.Add(det);
                                DtModuleCopy.Rows.Remove(((System.Data.DataRowView)obj).Row);

                                foreach (CustomerPrice deleteCPL in CPList)
                                {
                                    foreach (CustomerPriceListByItem item in deleteCPL.CustomerPriceListItems)
                                    {
                                        CustomerPriceListByItem module = new CustomerPriceListByItem();
                                        module.IdCustomerPriceList = deleteCPL.IdCustomerPriceList;
                                        module.IdCPType = item.IdCPType;
                                        DeleteModuleFromCPL.Add(module);
                                    }
                                }
                            }
                            if (!isDuplicateCliked) IsEnabledSaveButton = true;
                        }
                    }
                    else
                    {
                        MessageBoxResult MessageBoxResult = CustomMessageBox.Show(Application.Current.Resources["DeleteBPLModuleMessageSelected"].ToString(), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                        if (MessageBoxResult == MessageBoxResult.Yes)
                        {
                            if (obj != null)
                            {
                                if (ModuleMenulist.Any(a => a.IdCPType == (uint)((System.Data.DataRowView)obj).Row["IdCPType"]))
                                {
                                    //remove set gray color
                                    ModuleMenulist.Where(a => a.IdCPType == (uint)((System.Data.DataRowView)obj).Row["IdCPType"]).ToList().ForEach(b => b.IsBPLdModule_Current = false);
                                }
                                BPLModule det = new BPLModule();
                                det.IdCPType = (uint)((System.Data.DataRowView)obj).Row["IdCPType"];
                                DeleteModules.Add(det);
                                DtModuleCopy.Rows.Remove(((System.Data.DataRowView)obj).Row);
                            }
                            DtModule = DtModuleCopy;
                            if (!isDuplicateCliked) IsEnabledSaveButton = true;
                        }
                    }
                }
                #region BPLModule
                ObservableCollection<BPLModule> ModuleMenuListtemp1 = new ObservableCollection<BPLModule>();
                foreach (BPLModule item in ModuleMenulist)
                {
                    //string TempName = item.Name.Remove(item.Name.LastIndexOf("[") + 1);
                    string TempName = item.Name.Remove(item.Name.LastIndexOf("[") + 1);
                    int t = ModuleMenulist.Where(x => x.Parent == item.Key && x.IsBPLdModule_Current == false).ToList().Count;
                    BPLModule ModuleMenuList1 = new BPLModule();
                    ModuleMenuList1.IdCPType = item.IdCPType;
                    //Shubham[skadam] GEOS2-4784 GEOS2-4785 No additional data so remove [0] this in tree menu in article, detection & module  left tree in BPL menu 29 08 2023
                    // ModuleMenuList1.Name = TempName + ModuleMenulist.Where(x => x.Parent == item.Key && x.IsBPLdModule_Current == false).ToList().Count + "]";
                    try
                    {
                        Int64 Count = ModuleMenulist.Where(x => x.Parent == item.Key && x.IsBPLdModule_Current == false).ToList().Count;
                        if (Count != 0)
                        {
                            if (!string.IsNullOrEmpty(TempName))
                            {
                                ModuleMenuList1.Name = TempName + Count + "]";
                            }
                            else
                            {
                                if (!string.IsNullOrEmpty(item.Name))
                                {
                                    ModuleMenuList1.Name = item.Name;
                                }
                                else
                                {
                                    ModuleMenuList1.Name = "";
                                }
                            }

                        }
                        else
                        {
                            if (!string.IsNullOrEmpty(TempName))
                            {
                                ModuleMenuList1.Name = TempName.Remove(TempName.Length - 1);
                            }
                            else
                            {
                                if (!string.IsNullOrEmpty(item.Name))
                                {
                                    ModuleMenuList1.Name = item.Name;
                                }
                                else
                                {
                                    ModuleMenuList1.Name = "";
                                }
                            }
                        }
                    }
                    catch (Exception ex) { }
                    ModuleMenuList1.Parent = item.Parent;
                    ModuleMenuList1.Key = item.Key;
                    //ModuleMenuList1.Description = item.Description;
                    ModuleMenuList1.TemplateName = item.TemplateName;
                    ModuleMenuList1.IdTemplate = item.IdTemplate;
                    // ModuleMenuList1.IdGroup = item.IdGroup;
                    // ModuleMenuList1.Code = item.Code;
                    ModuleMenuList1.StatusHtmlColor = item.StatusHtmlColor;
                    ModuleMenuList1.StatusAbbreviation = item.StatusAbbreviation;
                    ModuleMenuList1.IsBPLdModule_Current = item.IsBPLdModule_Current;
                    ModuleMenuList1.ProductType = item.ProductType;
                    ModuleMenuListtemp1.Add(ModuleMenuList1);
                }
                ModuleMenulist = new ObservableCollection<BPLModule>();
                ModuleMenulist.AddRange(ModuleMenuListtemp1);
                #endregion
                GeosApplication.Instance.Logger.Log("Method DeleteModuleCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method DeleteModuleCommandAction()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }


        #endregion

        //Shubham[skadam] GEOS2-4424 Need to add "Add ALL" button in module tab in BPL. 29 08 2023
        //Shubham[skadam] GEOS2-4784 Need to add custom filter option in module same as article/detection. 29 08 2023
        //Shubham[skadam] GEOS2-4785 No additional data so remove [0] this in tree menu in article, detection & module  left tree in BPL menu 29 08 2023
        //Shubham[skadam] GEOS2-4786 (JLR) The exported XLS Price List (BPL and CPL) must have the sheet with the modules. 29 08 2023
        #region GEOS2-4424_Module
        //Shubham[skadam] GEOS2-4424 Some changes in  Module tab in BPL (3/3) 28 08 2023
        private string userSettingsKeyForModule = "PLM_BasePriceModule_Filter_";
        private ObservableCollection<TileBarFilters> ModulefilterStatusListOfTile;
        private TileBarFilters ModuleselectedTileBarItem;
        private List<GridColumn> ModuleGridColumnList;
        private bool ModuleisEdit;
        TableView Moduleview;
        private bool ModuleisFilterEnabled;
        public bool ModuleIsEdit
        {
            get
            {
                return ModuleisEdit;
            }
            set
            {
                ModuleisEdit = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ModuleIsEdit"));
            }
        }
        public string ModuleFilterStringCriteria { get; set; }
        public string ModuleFilterStringName { get; set; }
        string ModulemyFilterString;
        string Moduleheight = "10";
        public string ModuleHeight
        {
            get { return Moduleheight; }
            set
            {
                Moduleheight = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ModuleHeight"));
            }
        }
        Dictionary<string, string> ModuleBasePriceArticleFilter = new Dictionary<string, string>();
        public string ModuleMyFilterString
        {
            get { return ModulemyFilterString; }
            set
            {
                ModulemyFilterString = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ModuleMyFilterString"));
            }
        }
        public ObservableCollection<TileBarFilters> ModuleFilterStatusListOfTile
        {
            get { return ModulefilterStatusListOfTile; }
            set
            {
                ModulefilterStatusListOfTile = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ModuleFilterStatusListOfTile"));
            }
        }
        public TileBarFilters ModuleSelectedTileBarItem
        {
            get { return ModuleselectedTileBarItem; }
            set
            {
                ModuleselectedTileBarItem = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ModuleSelectedTileBarItem"));
            }
        }
        List<string> ModuleBPLArticleFilter = new List<string>();
        private void ModuleFilterEditorCreatedCommandAction(FilterEditorEventArgs obj)
        {
            try
            {
                ModuleBPLArticleFilter = new List<string>();
                obj.Handled = true;
                TableViewEx table = (TableViewEx)obj.OriginalSource;
                GridControl gridControl = (table).Grid;
                GridColumnList = gridControl.Columns.Where(x => x.Header != null).ToList();
                GridColumn column = GridColumnList.FirstOrDefault(x => x.Header.ToString().Equals("Status"));
                ModuleShowFilterEditor(obj);
                if (ModuleBasePriceArticleFilter == null)
                    ModuleBasePriceArticleFilter = new Dictionary<string, string>();
                foreach (var Filter in GeosApplication.Instance.UserSettings)
                {
                    if (Filter.Key.StartsWith(userSettingsKeyForModule))
                    {
                        if (!ModuleBasePriceArticleFilter.Any(a => a.Key == Filter.Key))
                            ModuleBasePriceArticleFilter.Add(Filter.Key, Filter.Value);
                        ModuleBPLArticleFilter.Add(Filter.Key.Replace(userSettingsKeyForModule, ""));
                    }
                }
                //ModuleFillFilterTileBar();
                ModuleAddCustomSetting();
                ModuleSelectedTileBarItem = ModuleFilterStatusListOfTile.LastOrDefault();
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in ModuleFilterEditorCreatedCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        private void ModuleShowFilterEditor(FilterEditorEventArgs e)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ModuleShowFilterEditor()...", category: Category.Info, priority: Priority.Low);
                FilterEditorView filterEditorView = new FilterEditorView();
                FilterEditorViewModel filterEditorViewModel = new FilterEditorViewModel();
                string titleText = DevExpress.Xpf.Grid.GridControlLocalizer.Active.GetLocalizedString(GridControlStringId.FilterEditorTitle);
                if (IsEdit)
                {
                    filterEditorViewModel.FilterName = ModuleFilterStringName;
                    filterEditorViewModel.IsSave = true;
                    filterEditorViewModel.IsNew = false;
                    IsEdit = false;
                }
                else
                    filterEditorViewModel.IsNew = true;

                filterEditorViewModel.Init(e.FilterControl, ModuleFilterStatusListOfTile);
                filterEditorView.DataContext = filterEditorViewModel;
                EventHandler handle = delegate { filterEditorView.Close(); };
                filterEditorViewModel.RequestClose += handle;
                filterEditorView.Title = titleText;
                filterEditorView.Icon = DevExpress.Xpf.Core.Native.ImageHelper.CreateImageFromCoreEmbeddedResource("Editors.Images.FilterControl.filter.png");
                filterEditorView.Grid.Children.Add(e.FilterControl);
                filterEditorView.ShowDialog();

                if (filterEditorViewModel.IsDelete && !string.IsNullOrEmpty(filterEditorViewModel.FilterName) && filterEditorViewModel.IsSave)
                {
                    TileBarFilters tileBarItem = ModuleFilterStatusListOfTile.FirstOrDefault(x => x.Caption.Equals(ModuleFilterStringName));
                    if (tileBarItem != null)
                    {
                        ModuleFilterStatusListOfTile.Remove(tileBarItem);
                        List<Tuple<string, string>> lstUserConfiguration = new List<Tuple<string, string>>();
                        foreach (KeyValuePair<string, string> setting in GeosApplication.Instance.UserSettings)
                        {
                            string key = setting.Key;

                            if (setting.Key.Contains(userSettingsKeyForModule))
                                key = setting.Key.Replace(userSettingsKeyForModule, "");

                            if (!key.Equals(tileBarItem.Caption))
                                lstUserConfiguration.Add(new Tuple<string, string>(setting.Key.ToString(), setting.Value.ToString()));
                        }
                        ApplicationOperation.CreateNewSetting(lstUserConfiguration, GeosApplication.Instance.UserSettingFilePath, "UserSettings");
                        GeosApplication.Instance.UserSettings = ApplicationOperation.GetSetting(GeosApplication.Instance.UserSettingFilePath);
                    }
                }
                else if (filterEditorViewModel.FilterName != null && !string.IsNullOrEmpty(filterEditorViewModel.FilterName) && filterEditorViewModel.IsSave && !filterEditorViewModel.IsNew && filterEditorViewModel.IsCancel)
                {
                    TileBarFilters tileBarItem = ModuleFilterStatusListOfTile.FirstOrDefault(x => x.Caption.Equals(ModuleFilterStringName));
                    if (tileBarItem != null)
                    {
                        GridColumn column = GridColumnList.FirstOrDefault(x => x.Header.ToString() != null);
                        DevExpress.Xpf.Grid.GridControlBand gridControl = ((DevExpress.Xpf.Grid.GridControlBand)((System.Windows.FrameworkContentElement)(GridColumn)column).Parent);
                        int rowCount = 0;
                        if (ModuleFilterStatusListOfTile == null)
                            ModuleFilterStatusListOfTile = new ObservableCollection<TileBarFilters>();
                        ModuleFilterStringName = userSettingsKeyForModule + filterEditorViewModel.FilterName;
                        string filterCaption = tileBarItem.Caption;
                        tileBarItem.Caption = ModuleFilterStringName;
                        tileBarItem.EntitiesCount = rowCount;
                        tileBarItem.EntitiesCountVisibility = Visibility.Visible;
                        tileBarItem.FilterCriteria = filterEditorViewModel.FilterCriteria;
                        List<Tuple<string, string>> lstUserConfiguration = new List<Tuple<string, string>>();
                        foreach (KeyValuePair<string, string> setting in GeosApplication.Instance.UserSettings)
                        {
                            string key = setting.Key;

                            if (setting.Key.Contains(userSettingsKeyForModule))
                                key = setting.Key.Replace(userSettingsKeyForModule, "");

                            if (!key.Equals(filterCaption))
                                lstUserConfiguration.Add(new Tuple<string, string>(setting.Key.ToString(), setting.Value.ToString()));
                            else
                                lstUserConfiguration.Add(new Tuple<string, string>(tileBarItem.Caption, tileBarItem.FilterCriteria));
                        }
                        ApplicationOperation.CreateNewSetting(lstUserConfiguration, GeosApplication.Instance.UserSettingFilePath, "UserSettings");
                        GeosApplication.Instance.UserSettings = ApplicationOperation.GetSetting(GeosApplication.Instance.UserSettingFilePath);
                    }
                }
                else if (filterEditorViewModel.FilterName != null && !string.IsNullOrEmpty(filterEditorViewModel.FilterName) && filterEditorViewModel.IsSave && filterEditorViewModel.IsNew && filterEditorViewModel.IsCancel)
                {
                    GridColumn column = GridColumnList.FirstOrDefault(x => x.Header.ToString() != null);
                    DevExpress.Xpf.Grid.GridControlBand gridControl = ((DevExpress.Xpf.Grid.GridControlBand)((System.Windows.FrameworkContentElement)(GridColumn)column).Parent);
                    int rowCount = 0;
                    if (ModuleFilterStatusListOfTile == null)
                        ModuleFilterStatusListOfTile = new ObservableCollection<TileBarFilters>();
                    ModuleFilterStatusListOfTile.Add(new TileBarFilters()
                    {
                        Caption = filterEditorViewModel.FilterName,
                        Id = 0,
                        BackColor = null,
                        ForeColor = null,
                        EntitiesCountVisibility = Visibility.Visible,
                        FilterCriteria = filterEditorViewModel.FilterCriteria,
                        EntitiesCount = rowCount,
                        Height = 58,
                        width = 188
                    });
                    ModuleSelectedTileBarItem = ModuleFilterStatusListOfTile.LastOrDefault();
                    string filterName = userSettingsKeyForModule + filterEditorViewModel.FilterName;
                    GeosApplication.Instance.UserSettings[filterName] = filterEditorViewModel.FilterCriteria;
                    ApplicationOperation.CreateNewSetting(GeosApplication.Instance.UserSettings, GeosApplication.Instance.UserSettingFilePath, "UserSettings");
                    GeosApplication.Instance.UserSettings = ApplicationOperation.GetSetting(GeosApplication.Instance.UserSettingFilePath);
                }
                GeosApplication.Instance.Logger.Log("Method ModuleShowFilterEditor() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method ModuleShowFilterEditor() " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        public void ModuleFillFilterTileBar()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ModuleFillFilterTileBar()...", category: Category.Info, priority: Priority.Low);
                ModuleFilterStatusListOfTile = new ObservableCollection<TileBarFilters>();
                ObservableCollection<GeosStatus> tempStatusList = new ObservableCollection<GeosStatus>();
                int _id = 1;

                if (DtModule != null)
                {
                    var DtModuleList = DtModule.AsEnumerable().ToList();
                    ModuleFilterStatusListOfTile.Add(new TileBarFilters()
                    {
                        Caption = (System.Windows.Application.Current.FindResource("BPLViewTileBarCaption").ToString()),
                        Id = 0,
                        BackColor = null,
                        ForeColor = null,
                        EntitiesCount = DtArticle.Rows.Count,
                        EntitiesCountVisibility = Visibility.Visible,
                        Height = 58,
                        width = 188
                    });

                    foreach (var item in tempStatusList)
                    {
                        ModuleFilterStatusListOfTile.Add(new TileBarFilters()
                        {
                            Caption = item.Name,
                            Id = _id++,
                            IdOfferStatusType = item.IdOfferStatusType,
                            BackColor = item.HtmlColor,
                            ForeColor = item.HtmlColor,
                            EntitiesCount = (DtModuleList.Where(x => (int)x.ItemArray[34] == item.IdOfferStatusType).ToList()).Count,
                            EntitiesCountVisibility = Visibility.Visible,
                            Height = 58,
                            width = 188
                        });
                    }
                }

                if (ModuleFilterStatusListOfTile.Count > 0)
                    ModuleSelectedTileBarItem = ModuleFilterStatusListOfTile[0];

                GeosApplication.Instance.Logger.Log("Method ModuleFillFilterTileBar() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method ModuleFillFilterTileBar() " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        private void ModuleAddCustomSetting()
        {
            try
            {
                DataTable tempDtModule = new DataTable();
                ModuleFilterStatusListOfTile = new ObservableCollection<TileBarFilters>();
                GeosApplication.Instance.Logger.Log("Method ModuleAddCustomSetting()...", category: Category.Info, priority: Priority.Low);
                List<KeyValuePair<string, string>> tempUserSettings = GeosApplication.Instance.UserSettings.Where(x => x.Key.Contains(userSettingsKeyForModule)).ToList();
                if (tempUserSettings != null && tempUserSettings.Count > 0)
                {
                    ModuleFilterStatusListOfTile.Add(
                    new TileBarFilters()
                    {
                        Caption = "ALL",
                        Id = 0,
                        BackColor = null,
                        ForeColor = null,
                        FilterCriteria = null,
                        EntitiesCount = DtModule.Rows.Count,
                        EntitiesCountVisibility = Visibility.Visible,
                        Height = 58,
                        width = 188
                    });
                }
                if (DtModule != null)
                {
                    tempDtModule = DtModule;
                    foreach (DataRow dtitem in tempDtModule.Rows)
                    {
                        DataRow DataRow = (DataRow)dtitem;
                        for (int i = 0; i < dtitem.ItemArray.Count(); i++)
                        {
                            if (dtitem.ItemArray[i] is double)
                            {
                                //DataRow.ItemArray[i] = Math.Round((double)dtitem.ItemArray[i], 2);
                                double ItemArray = Math.Round((double)dtitem.ItemArray[i], 2);
                                DataRow.SetField(i, ItemArray);
                            }
                        }
                    }
                }
                foreach (var item in tempUserSettings)
                {
                    if (DtModule != null)
                    {

                        int count = 0;
                        string filter = item.Value;
                        CriteriaOperator op = CriteriaOperator.Parse(filter);
                        try
                        {
                            count = DtModule.Select(CriteriaToWhereClauseHelper.GetDataSetWhere(op)).ToList().Count;
                        }
                        catch (Exception ex)
                        {
                            try
                            {
                                if (op != null)
                                {
                                    dynamic criteriaOperatorobj = op;
                                    if (criteriaOperatorobj.OperatorType is DevExpress.Data.Filtering.FunctionOperatorType)
                                    {
                                        if (criteriaOperatorobj.OperatorType == DevExpress.Data.Filtering.FunctionOperatorType.StartsWith)
                                        {
                                            var criteriaOperator = criteriaOperatorobj.Operands;
                                            DevExpress.Data.Filtering.OperandProperty operandProperty = criteriaOperator[0];
                                            op = CriteriaOperator.Parse("[" + operandProperty.PropertyName + "]" + '=' + criteriaOperator[1].Value);
                                            count = DtArticle.Select(CriteriaToWhereClauseHelper.GetDataSetWhere(op)).ToList().Count;
                                        }
                                    }
                                }
                            }
                            catch (Exception exc) { }
                            //GeosApplication.Instance.Logger.Log(string.Format("Error in Method AddCustomSetting() {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                        }

                        ModuleFilterStatusListOfTile.Add(
                            new TileBarFilters()
                            {
                                Caption = item.Key.Replace(userSettingsKeyForModule, ""),
                                Id = 0,
                                BackColor = null,
                                ForeColor = null,
                                FilterCriteria = item.Value,
                                EntitiesCount = count,
                                EntitiesCountVisibility = Visibility.Visible,
                                Height = 58,
                                width = 188
                            });
                    }
                }

                GeosApplication.Instance.Logger.Log("Method ModuleAddCustomSetting() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method ModuleAddCustomSetting() " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        private void ModuleCustomShowFilterPopup(FilterPopupEventArgs e)
        {

            try
            {
                GeosApplication.Instance.Logger.Log(" Method ModuleCustomShowFilterPopup ...", category: Category.Info, priority: Priority.Low);

                GeosApplication.Instance.Logger.Log("Method ModuleCustomShowFilterPopup() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in ModuleCustomShowFilterPopup() method " + ex.Message, category: Category.Info, priority: Priority.Low);
            }
        }
        private void ModuleCommandFilterStatusTileClickAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ModuleCommandFilterStatusTileClickAction()...", category: Category.Info, priority: Priority.Low);
                System.Windows.Controls.SelectionChangedEventArgs Filter = (System.Windows.Controls.SelectionChangedEventArgs)obj;
                if (Filter.AddedItems.Count != 0)
                {
                    long statusIdType = ((TileBarFilters)((object[])((System.Windows.Controls.SelectionChangedEventArgs)obj).AddedItems)[0]).IdOfferStatusType;
                    string FilterString = ((TileBarFilters)((object[])((System.Windows.Controls.SelectionChangedEventArgs)obj).AddedItems)[0]).FilterCriteria;
                    ModuleFilterStringName = ((TileBarFilters)((object[])((System.Windows.Controls.SelectionChangedEventArgs)obj).AddedItems)[0]).Caption;
                    ModuleMyFilterString = FilterString;
                }
                GeosApplication.Instance.Logger.Log("Method ModuleCommandFilterStatusTileClickAction() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method ModuleCommandFilterStatusTileClickAction() " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        private void ModuleCommandTileBarClickDoubleClickAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ModuleCommandTileBarClickDoubleClickAction()...", category: Category.Info, priority: Priority.Low);
                foreach (var item in FilterStatusListOfTile)
                {
                    if (ModuleFilterStringName != null)
                    {
                        if (ModuleFilterStringName.Equals(item.Caption))
                        {
                            //return;
                        }
                    }
                }

                if (ModuleFilterStringName.Equals(System.Windows.Application.Current.FindResource("BPLViewCustomFilter").ToString()) || ModuleFilterStringName.Equals(System.Windows.Application.Current.FindResource("BPLViewTileBarCaption").ToString()))
                {
                    return;
                }

                TableViewEx table = (TableViewEx)obj;
                GridControl gridControl = (table).Grid;
                ModuleGridColumnList = gridControl.Columns.Where(x => x.Header != null).ToList();
                GridColumn column = ModuleGridColumnList.FirstOrDefault(x => x.Header.ToString().Equals("Status"));
                IsEdit = true;
                table.ShowFilterEditor(column);
                GeosApplication.Instance.Logger.Log("Method ModuleCommandTileBarClickDoubleClickAction() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method ModuleCommandTileBarClickDoubleClickAction() " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        //[nsatpute][GEOS2-7894][01.08.2025]
        private DataTable ConvertToDataTable(ObservableCollection<PriceListItem> articleItems)
        {

            DataTable dt = new DataTable();

            // Helper function to add column if it doesn't exist
            void AddColumnIfNotExists(string columnName, Type type)
            {
                if (!dt.Columns.Contains(columnName))
                {
                    dt.Columns.Add(columnName, type);
                }
            }

            // Add fixed columns
            AddColumnIfNotExists("IsChecked", typeof(bool));
            AddColumnIfNotExists("Reference", typeof(string));
            AddColumnIfNotExists("Category", typeof(string));
            AddColumnIfNotExists("STAT", typeof(string));
            AddColumnIfNotExists("HtmlColor", typeof(string));
            AddColumnIfNotExists("Name", typeof(string));
            AddColumnIfNotExists("IdArticle", typeof(UInt32));
            AddColumnIfNotExists("Logic", typeof(int));
            AddColumnIfNotExists("Value", typeof(double));
            AddColumnIfNotExists("MaxCost_1", typeof(double));
            AddColumnIfNotExists("CurrencyConversionDate", typeof(DateTime));
            AddColumnIfNotExists("Common_Cur", typeof(double));
            AddColumnIfNotExists("Profit", typeof(double));
            AddColumnIfNotExists("CostMargin", typeof(double));
            AddColumnIfNotExists("SaleCurrencyConversionDate", typeof(string));

            dt.Columns.Add("IsColor", typeof(bool)).DefaultValue = false;
            dt.Columns.Add("IsUpdatedRow", typeof(bool)).DefaultValue = false;
            // Add dynamic columns from all items (handles cases where different items have different columns)
            var allPlantCostColumns = new HashSet<string>();
            var allCurrencyValueColumns = new HashSet<string>();
            var allConversionRateColumns = new HashSet<string>();

            // Collect all possible column names first
            foreach (var item in articleItems)
            {
                foreach (var plant in item.PlantCosts.Keys)
                {
                    allPlantCostColumns.Add(plant);
                }
                foreach (var currency in item.CurrencyValues.Keys)
                {
                    allCurrencyValueColumns.Add(currency);
                }
                foreach (var rate in item.CurrencyConversionRates.Keys)
                {
                    allConversionRateColumns.Add(rate);
                }
            }

            // Add dynamic columns
            foreach (var column in allPlantCostColumns)
            {
                AddColumnIfNotExists(column, typeof(double));
            }
            foreach (var column in allCurrencyValueColumns)
            {
                AddColumnIfNotExists(column, typeof(double));
            }
            foreach (var column in allConversionRateColumns)
            {
                AddColumnIfNotExists(column, typeof(double));
            }

            // Populate rows
            foreach (var item in articleItems)
            {
                DataRow row = dt.NewRow();

                // Fixed properties
                row["IsChecked"] = item.IsChecked;
                row["Reference"] = item.Reference;
                row["Category"] = item.Category;
                row["STAT"] = item.STAT;
                row["HtmlColor"] = item.HtmlColor;
                row["Name"] = item.Name;
                row["IdArticle"] = item.IdArticle;
                row["Logic"] = item.Logic;
                row["Value"] = item.Value ?? (object)DBNull.Value;
                row["MaxCost_1"] = item.MaxCost_1;
                row["CurrencyConversionDate"] = item.CurrencyConversionDate ?? (object)DBNull.Value;
                row["Profit"] = item.Profit;
                row["CostMargin"] = item.CostMargin;
                row["SaleCurrencyConversionDate"] = item.SaleCurrencyConversionDate;


                // Dynamic properties - Plant Costs
                foreach (var plant in item.PlantCosts)
                {
                    row[plant.Key] = plant.Value ?? (object)DBNull.Value;
                }

                // Dynamic properties - Currency Values
                foreach (var currency in item.CurrencyValues)
                {
                    if (currency.Key != ((Currency)SelectedCurrency).Name)
                    {
                        row[currency.Key] = currency.Value ?? (object)DBNull.Value;
                    }
                    else
                    {
                        row["Common_Cur"] = currency.Value ?? (object)DBNull.Value;
                    }
                }

                // Dynamic properties - Currency Values
                foreach (var currency in item.CurrencyConversionRates)
                {
                    if (currency.Key != ((Currency)SelectedCurrency).Name)
                        row[currency.Key] = currency.Value ?? (object)DBNull.Value;
                    else
                        row[currency.Key] = item.Common_Cur;

                }

                dt.Rows.Add(row);
            }
            GeosApplication.Instance.SplashScreenMessage = string.Empty;
            return dt;
        }
        //[nsatpute][GEOS2-7894][01.08.2025]
        private DataTable ConvertDetectionListToDataTable(ObservableCollection<DetectionItem> detectionList)
        {
            DataTable dt = new DataTable();

            // Helper function to add column if it doesn't exist
            void AddColumnIfNotExists(string columnName, Type type)
            {
                if (!dt.Columns.Contains(columnName))
                {
                    dt.Columns.Add(columnName, type);
                }
            }

            // Add fixed columns
            AddColumnIfNotExists("IsChecked", typeof(bool));
            AddColumnIfNotExists("Code", typeof(string));
            AddColumnIfNotExists("Type", typeof(string));
            AddColumnIfNotExists("STAT", typeof(string));
            AddColumnIfNotExists("HtmlColor", typeof(string));
            AddColumnIfNotExists("Name", typeof(string));
            AddColumnIfNotExists("IdCPType", typeof(uint));
            AddColumnIfNotExists("Logic", typeof(int));
            AddColumnIfNotExists("Value", typeof(double));
            AddColumnIfNotExists("MaxCost_1", typeof(double));
            AddColumnIfNotExists("CurrencyConversionDate", typeof(DateTime));
            AddColumnIfNotExists("Common_Cur", typeof(double));
            AddColumnIfNotExists("Profit", typeof(double));
            AddColumnIfNotExists("CostMargin", typeof(double));
            AddColumnIfNotExists("SaleCurrencyConversionDate", typeof(string));
            AddColumnIfNotExists("IdDetection", typeof(UInt32));
            dt.Columns.Add("IsColor", typeof(bool)).DefaultValue = false;
            dt.Columns.Add("IsUpdatedRow", typeof(bool)).DefaultValue = false;

            // Collect all possible dynamic column names
            var allConversionRateColumns = new HashSet<string>();
            var allCurrencyValueColumns = new HashSet<string>();

            foreach (var item in detectionList)
            {
                foreach (var rate in item.CurrencyConversionRates.Keys)
                {
                    if (rate == "CurrencyConversionRate_Common_Cur")
                        allConversionRateColumns.Add("CurrencyConversionRate_Common_Cur");
                    else
                        allConversionRateColumns.Add(rate);
                }
                foreach (var currency in item.CurrencyValues.Keys)
                {
                    allCurrencyValueColumns.Add(currency);
                }
            }

            // Add dynamic columns
            foreach (var column in allConversionRateColumns)
            {
                AddColumnIfNotExists(column, typeof(double));
            }
            foreach (var column in allCurrencyValueColumns)
            {
                AddColumnIfNotExists(column, typeof(double));
            }

            // Populate rows
            foreach (var item in detectionList)
            {
                DataRow row = dt.NewRow();

                // Fixed properties
                row["IsChecked"] = item.IsChecked;
                row["Code"] = item.Code;
                row["Type"] = item.Type;
                row["STAT"] = item.STAT;
                row["HtmlColor"] = item.HtmlColor;
                row["Name"] = item.Name;
                row["IdCPType"] = item.IdCPType ?? (object)DBNull.Value;
                row["Logic"] = item.Logic;
                row["Value"] = item.Value ?? (object)DBNull.Value;
                row["MaxCost_1"] = item.MaxCost_1;
                row["CurrencyConversionDate"] = item.CurrencyConversionDate ?? (object)DBNull.Value;
                row["Common_Cur"] = item.Common_Cur;
                row["Profit"] = item.Profit;
                row["CostMargin"] = item.CostMargin;
                row["SaleCurrencyConversionDate"] = item.SaleCurrencyConversionDate;
                row["IdDetection"] = item.IdDetection;
                // Dynamic properties - Conversion Rates
                foreach (var rate in item.CurrencyConversionRates)
                {
                    if (rate.Key == "CurrencyConversionRate_Common_Cur")
                        row["CurrencyConversionRate_Common_Cur"] = rate.Value ?? (object)DBNull.Value;
                    else
                        row[rate.Key] = rate.Value ?? (object)DBNull.Value;
                }

                foreach (var currency in item.CurrencyValues)
                {
                    if (currency.Key != ((Currency)SelectedCurrency).Name)
                    {
                        row[currency.Key] = currency.Value ?? (object)DBNull.Value;
                    }
                    else
                    {
                        row["Common_Cur"] = currency.Value ?? (object)DBNull.Value;
                    }
                }
                dt.Rows.Add(row);
            }
            GeosApplication.Instance.SplashScreenMessage = string.Empty;
            return dt;
        }
        //[nsatpute][GEOS2-7894][01.08.2025]
        private DataTable ConvertModuleItemsToDataTable(ObservableCollection<ModuleItem> moduleItems)
        {
            DataTable dt = new DataTable();

            // Helper function to add column if it doesn't exist
            void AddColumnIfNotExists(string columnName, Type type)
            {
                if (!dt.Columns.Contains(columnName))
                {
                    dt.Columns.Add(columnName, type);
                }
            }

            // Add fixed columns
            AddColumnIfNotExists("IsChecked", typeof(bool));
            AddColumnIfNotExists("Code", typeof(string));
            AddColumnIfNotExists("Type", typeof(string));
            AddColumnIfNotExists("STAT", typeof(string));
            AddColumnIfNotExists("HtmlColor", typeof(string));
            AddColumnIfNotExists("Name", typeof(string));
            AddColumnIfNotExists("IdCPType", typeof(uint));
            AddColumnIfNotExists("Logic", typeof(int));
            AddColumnIfNotExists("Value", typeof(double));
            AddColumnIfNotExists("MaxCost_1", typeof(double));
            AddColumnIfNotExists("CurrencyConversionDate", typeof(DateTime));
            AddColumnIfNotExists("Common_Cur", typeof(double));
            AddColumnIfNotExists("Profit", typeof(double));
            AddColumnIfNotExists("CostMargin", typeof(double));
            AddColumnIfNotExists("SaleCurrencyConversionDate", typeof(string));

            dt.Columns.Add("IsColor", typeof(bool)).DefaultValue = false;
            dt.Columns.Add("IsUpdatedRow", typeof(bool)).DefaultValue = false;

            // Collect all possible dynamic column names
            var allConversionRateColumns = new HashSet<string>();
            var allCurrencyValueColumns = new HashSet<string>();

            foreach (var item in moduleItems)
            {
                foreach (var rate in item.CurrencyConversionRates.Keys)
                {
                    if (rate == "CurrencyConversionRate_Common_Cur")
                        allConversionRateColumns.Add("CurrencyConversionRate_Common_Cur");
                    else
                        allConversionRateColumns.Add(rate);
                }
                foreach (var currency in item.CurrencyValues.Keys)
                {
                    allCurrencyValueColumns.Add(currency);
                }
            }

            // Add dynamic columns with prefixes to avoid conflicts
            foreach (var column in allConversionRateColumns)
            {
                AddColumnIfNotExists(column, typeof(double)); // CR = Conversion Rate
            }
            foreach (var column in allCurrencyValueColumns)
            {
                AddColumnIfNotExists(column, typeof(double)); // CV = Currency Value
            }

            // Populate rows
            foreach (var item in moduleItems)
            {
                DataRow row = dt.NewRow();

                // Fixed properties
                row["IsChecked"] = item.IsChecked;
                row["Code"] = item.Code;
                row["Type"] = item.Type;
                row["STAT"] = item.STAT;
                row["HtmlColor"] = item.HtmlColor;
                row["Name"] = item.Name;
                row["IdCPType"] = item.IdCPType ?? (object)DBNull.Value;
                row["Logic"] = item.Logic;
                row["Value"] = item.Value ?? (object)DBNull.Value;
                row["MaxCost_1"] = item.MaxCost_1;
                row["CurrencyConversionDate"] = item.CurrencyConversionDate ?? (object)DBNull.Value;
                row["Profit"] = item.Profit;
                row["CostMargin"] = item.CostMargin;
                row["SaleCurrencyConversionDate"] = item.SaleCurrencyConversionDate;

                // Dynamic properties - Conversion Rates
                foreach (var rate in item.CurrencyConversionRates)
                {
                    if (rate.Key == "CurrencyConversionRate_Common_Cur")
                        row["CurrencyConversionRate_Common_Cur"] = rate.Value ?? (object)DBNull.Value;
                    else
                        row[rate.Key] = rate.Value ?? (object)DBNull.Value;
                }

                foreach (var currency in item.CurrencyValues)
                {
                    if (currency.Key != ((Currency)SelectedCurrency).Name)
                    {
                        row[currency.Key] = currency.Value ?? (object)DBNull.Value;
                    }
                    else
                    {
                        row["Common_Cur"] = currency.Value ?? (object)DBNull.Value;
                    }
                }

                dt.Rows.Add(row);
            }
            GeosApplication.Instance.SplashScreenMessage = string.Empty;

            return dt;
        }
        #endregion
    }
}
