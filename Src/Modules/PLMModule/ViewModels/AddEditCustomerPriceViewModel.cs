using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using Emdep.Geos.Modules.PLM.Views;
using Emdep.Geos.UI.Common;
using DevExpress.Xpf.Core;
using System.Windows;
using System.Windows.Media;
using DevExpress.Mvvm.UI;
using Prism.Logging;
using System.Windows.Input;
using Emdep.Geos.UI.Commands;
using DevExpress.Mvvm;
using System.Collections.ObjectModel;
using Emdep.Geos.Services.Contracts;
using Emdep.Geos.UI.ServiceProcess;
using Emdep.Geos.Data.Common.PLM;
using Emdep.Geos.Data.Common.PCM;
using System.ServiceModel;
using Emdep.Geos.UI.CustomControls;
using DevExpress.Xpf.Grid;
using DevExpress.Xpf.Printing;
using DevExpress.XtraPrinting;
using DevExpress.Export.Xl;
using Emdep.Geos.Data.Common.Epc;
using Emdep.Geos.Data.Common;
using Emdep.Geos.Modules.PLM.CommonClasses;
using DevExpress.Xpf.LayoutControl;
using Emdep.Geos.Utility;
using System.Data;
using Emdep.Geos.UI.Helper;
using DevExpress.Data;
using System.Collections;
using Emdep.Geos.UI.Validations;
using DevExpress.Xpf.Editors;
using Microsoft.Win32;
using DevExpress.Utils.CommonDialogs.Internal;
using System.Windows.Media.Imaging;
using System.IO;
using Newtonsoft.Json;
using DevExpress.Spreadsheet;
using DevExpress.Xpf.Printing;
using DevExpress.XtraPrinting;
using DevExpress.Export.Xl;
using Emdep.Geos.Data.Common.SynchronizationClass;
using Emdep.Geos.Modules.PCM.ViewModels;
using DevExpress.Data.Filtering;
using System.Text;
using System.Collections.Concurrent;

namespace Emdep.Geos.Modules.PLM.ViewModels
{
    public class AddEditCustomerPriceViewModel : ViewModelBase, INotifyPropertyChanged, IDataErrorInfo
    {
        #region Service
        IPCMService PCMService = new PCMServiceController(GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString());
        IPLMService PLMService = new PLMServiceController(GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString());
        ICrmService crmControl = new CrmServiceController(GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString());
        IWorkbenchStartUp WorkbenchService = new WorkbenchServiceController(GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString());
        IGeosRepositoryService geosService = new GeosRepositoryServiceController(GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString());
       // IPLMService PLMService = new PLMServiceController("localhost:6699");
       // IPCMService PCMService = new PCMServiceController("localhost:6699");

        IGeosRepositoryService GeosRepositoryServiceController = new GeosRepositoryServiceController(GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString());

        private INavigationService Service { get { return this.GetService<INavigationService>(); } }
        #endregion

        #region Events
        public event EventHandler RequestClose;

        public event PropertyChangedEventHandler PropertyChanged;
        public void OnPropertyChanged(PropertyChangedEventArgs e)
        {
            if (PropertyChanged != null)
            {
                PropertyChanged(this, e);
            }
        }

        #endregion

        #region Declarations

        string tempDirectory = Path.Combine(Path.GetTempPath(), "EmdepExportToXLSX");
        private TableView articleTableView = null;
        private TableView detectionsTableView = null;
        private TableView moduleTableView = null;

        private double dialogHeight;
        private double dialogWidth;

        private ObservableCollection<Language> languages;
        private Language languageSelected;

        private string description;
        private string description_en;
        private string description_es;
        private string description_fr;
        private string description_pt;
        private string description_ro;
        private string description_ru;
        private string description_zh;

        private string name;
        private string name_en;
        private string name_es;
        private string name_fr;
        private string name_pt;
        private string name_ro;
        private string name_ru;
        private string name_zh;

        private string remark;
        private string remark_en;
        private string remark_es;
        private string remark_fr;
        private string remark_pt;
        private string remark_ro;
        private string remark_ru;
        private string remark_zh;

        MaximizedElementPosition maximizedElementPosition;

        private string windowHeader;
        private bool isNew;
        MaximizedElementPosition selectedAppearanceItem;
        private ObservableCollection<Site> plantList;
        private List<object> selectedPlant;
        private List<object> selectedPlant_Copy;
        private ObservableCollection<Currency> currencyList;
        private object selectedCurrency;


        private ObservableCollection<Currency> saleCurrencyList;
        private List<object> selectedSaleCurrency;
        private List<object> selectedSaleCurrency_Copy;
        private object selectedSaleCurrencyObj;


        private List<LookupValue> statusList;
        private int selectedStatusIndex;
        private LookupValue selectedStatus;

        private ObservableCollection<BasePrice> basePriceNameList;
        private BasePrice selectedBasePriceName;


        private string selectedCustomerPriceCode;

        private bool isCheckedAllLanguages;
        private bool isNewCustomerPriceSave;
        private ulong idBasePriceList;

        private bool IsCopyName;
        private bool IsCopyDescription;
        private bool IsCopyRemark;

        private BasePrice clonedBasePrice;

        private DateTime creationDate;
        private DateTime? expiryDate;
        private DateTime? effectiveDate;
        private DateTime? lastUpdated;

        private ObservableCollection<PCMArticleCategory> articleMenuList;
        private PCMArticleCategory selectedArticle;

        DataTable dtArticle;
        DataTable dtArticleCopy;

        private ObservableCollection<Emdep.Geos.UI.Helper.Column> columns;
        private ObservableCollection<BandItem> bands = new ObservableCollection<BandItem>();
        private List<LookupValue> logicList;
        private LookupValue selectedLogic;

        private ObservableCollection<CustomerPriceListByItem> articleList;

        private List<ArticleCostPrice> articleCostPriceList;
        private List<CurrencyConversion> currencyConversionList;

        private List<Site> article_PlantList;
        private List<Currency> article_CurrencyList;

        private bool isCalculateArticleCostButtonEnabled;

        private bool isCalculated;
        private string error = string.Empty;
        private string informationError;
        private string effectiveDateErrorMessage = string.Empty;
        private string expiryDateErrorMessage = string.Empty;

        private ulong idBasePrice;
        Int32? idExchangeRateUpdateType;
        private byte idCurrency;
        private string currencyName;
        private ImageSource currencyIcon;

        private CustomerPrice clonedCustomerPrice;
        private bool isEditCustmorPrice;
        private ulong idCustomerPriceList;
        private int selectedBasePriceNameIndex;
        public int Index;
        private int group;
        private int region;
        private int country;
        private int plant;
        private char? _SelectedLetter;
        private string filterStringForName;
        private ObservableCollection<char> _Letters;
        private bool isCellChecked;
        private bool isCheckedBasePrice;
        private bool isCheckedCustomerPrice;
        private Visibility isExportVisible;
        private string reference;
        public virtual bool DialogResult { get; set; }
        public virtual string ResultFileName { get; set; }
        private bool? isCheckedCustomer;
        private List<CPLCustomer> cplCustomerList;
        private List<CPLCustomer> cplCustomerList1;
        private List<CustomerPriceLogEntry> changeLogList;
        private ObservableCollection<CustomerPriceLogEntry> customerChangeLogList;
        private string RegionNames = string.Empty;
        private string CountryNames = string.Empty;
        private string PlantNames = string.Empty;
        private List<CPLCustomer> ModifiedCustomerList;
        private List<CPLCustomer> OriginalCustomerList;
        private ObservableCollection<CPLCustomer> selectedCustomersList;

        private List<Currency> article_CurrencyList_BPL;
        private List<Currency> detection_CurrencyList_BPL;
        private bool isAll;
        private BasePrice selectedBasePriceName_Copy;

        private List<CPLCustomer> cPLCustomersAll;
        private List<Currency> article_CurrencyList_ForCPL;
        private List<Currency> detection_CurrencyList_ForCPL;


        public string Groups { get; set; }
        public string Regions { get; set; }
        public string Countries { get; set; }
        public string Plants { get; set; }
        private string myFilterString;
        private ObservableCollection<BandItem> detectionBands = new ObservableCollection<BandItem>();
        private ObservableCollection<CustomerPriceListByItem> detectionList;
        private DataTable dtDetection;
        DataTable dtDetectionCopy;
        private List<BPLDetection> detectionMenulist;
        private BPLDetection selectedDetection;

        private List<Site> detection_PlantList;
        private List<Currency> detection_CurrencyList;

        private List<Articles> deleteArticles;
        private List<Detections> deleteDetetions;

        private bool isSaleCurrencyAddedOrRemove;
        int articleCount;
        int detectionCount;

        private List<CustomerPriceListByItem> savedArticles;
        private List<CustomerPriceListByItem> savedDetections;
        private LookupValue selectedExchangeRate;
        private List<CurrencyConversion> currencyConversionList_ByPreviousDate;

        private bool isArticleColumnChooserVisible;
        private bool isDetectionColumnChooserVisible;
        private bool isFirstTimeLoad;
        private bool isFirstTimeArticleLoad;
        private bool isFirstTimeDetectionLoad;

        private bool isSwitch;
        private object selectedCurrency_Copy;

        private string oldSelectedIndexValue;
        private bool? oldIsCheckedAllLanguages = null;
        private DateTime? oldEffectiveDate;
        private DateTime? oldExpiryDate;
        private string oldName;
        private string oldDescription;
        private string oldRemark;
        private bool isEnabledSaveButton;
        private bool isEnabledAcceptButton;
        private bool isSaveButtonClicked;
        private bool isUserPermission;
        private Visibility saveButtonVisibility;
        private Visibility exportPriceListButtonVisibility;

        private bool isArticleGrid;
        private string oldArticleNameGrid;
        private string oldDetectionNameGrid;
        private string oldSelectedStatus;

        private bool inActiveStatus;
        private List<GeosAppSetting> geosAppSettingList;

        private ITokenService tokenService;
        public List<DetectionTypes> LstDetectionType { get; set; }
        private ObservableCollection<CPLDocument> optionWayDetectionSparePartFilesList;
        private ObservableCollection<CPLDocument> fourOptionWayDetectionSparePartFilesList;
        private CPLDocument selectedOptionWayDetectionSparePartFile;

        private bool _isCPLArticleEnable;
        //[Sudhir.Jangra][GEOS2-3349][27/12/2022]
        #region Sudhir.Jangra GEOS2-3349 27/12/2022 
        private Visibility isDuplicateCustomerPriceButtonVisible;
        private bool isDuplicateCustomerPriceButtonEnabled;
        public bool isDuplicateClicked = false;
        private string customerPriceOldCode;
        private string duplicateCode;
        private ObservableCollection<BandItem> detectionBandTemplate;
        private ObservableCollection<BasePriceListByPlantCurrency> plantCurrencyList;
        private CustomerPrice duplicatedCustomerPriceObject;
        private LookupValue selectedOriginalStatus;
        private DataTable dtTable;
        private DataTable dtTableCopy;
        private List<BasePriceListByPlantCurrency> plantCurrencyListwithIsChecked;
        private ObservableCollection<BandItem> bandsTemplete;
        private CustomerPriceLogEntry selectedCustomerPriceChangeLog;
        public bool IsDuplicateSave = false;
        private List<UInt64> addArticles;//[Sudhir.Jangra][GEOS2-3349][28/12/2022]
        private List<UInt64> addDetections;//[Sudhir.Jangra][GEOS2-3349][28/12/2022]
        #endregion
        private string isAttachmentScrollVisible = "Disabled";//[Sudhir.Jangra][GEOS2-1960][13/03/2023]


        private ObservableCollection<CustomerPriceLogEntry> commentList;//[Sudhir.Jangra][GEOS2-4935]
        private string commentText;//[Sudhir.Jangra][GEOS2-4935]
        private DateTime? commentDateTimeText;//[Sudhir.Jangra][GEOS2-4935]
        private string commentFullNameText;//[Sudhir.Jangra][GEOS2-4935]
        private byte[] userProfileImageByte;//[Sudhir.Jangra][GEOS2-4935]
        private List<CustomerPriceLogEntry> addCommentsList;//[Sudhir.jangra][GEOS2-4935]
        private CustomerPriceLogEntry selectedComment;//[Sudhir.jangra][GEOSS2-4935]
        private ObservableCollection<CustomerPriceLogEntry> deleteCommentsList;//[Sudhir.Jangra][GEOS2-4935]
        private bool isDeleted;//[Sudhir.Jangra][GEOS2-4935]
        private List<CustomerPriceLogEntry> updatedCommentList;//[Sudhir.Jangra][GEOS2-4935]
        private BasePrice initialBasePrice; //[nsatpute][11.06.2025][GEOS2-6689]
        #endregion

        #region Properties
        public string CPLArticleGridSettingFilePath = GeosApplication.Instance.UserSettingFolderName + "CPLArticleGridSetting.Xml";

        public string CPLDetectionGridSettingFilePath = GeosApplication.Instance.UserSettingFolderName + "CPLDetectionGridSetting.Xml";

        public string CPLModuleGridSettingFilePath = GeosApplication.Instance.UserSettingFolderName + "CPLModuleGridSetting.Xml";
        public GridControl ArticleGrid { get; set; }
        public GridControl DetectionGrid { get; set; }
        public CustomerPrice NewPrice { get; set; }
        public CustomerPrice UpdatedItem { get; set; }

        public List<GeosAppSetting> GeosAppSettingList
        {
            get
            {
                return geosAppSettingList;
            }

            set
            {
                geosAppSettingList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("GeosAppSettingList"));
            }
        }

        public double DialogHeight
        {
            get { return dialogHeight; }
            set
            {
                dialogHeight = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DialogHeight"));
            }
        }

        public double DialogWidth
        {
            get { return dialogWidth; }
            set
            {
                dialogWidth = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DialogWidth"));
            }
        }

        public ObservableCollection<Language> Languages
        {
            get { return languages; }
            set
            {
                languages = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Languages"));
            }
        }

        public Language LanguageSelected
        {
            get
            {
                return languageSelected;
            }
            set
            {
                languageSelected = value;
                OnPropertyChanged(new PropertyChangedEventArgs("LanguageSelected"));
            }
        }

        public string Description
        {
            get { return description; }
            set
            {
                description = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Description"));
            }
        }

        public string Description_en
        {
            get
            {
                return description_en;
            }
            set
            {
                description_en = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Description_en"));
            }
        }

        public string Description_es
        {
            get
            {
                return description_es;
            }
            set
            {
                description_es = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Description_es"));
            }
        }

        public string Description_fr
        {
            get
            {
                return description_fr;
            }
            set
            {
                description_fr = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Description_fr"));
            }
        }

        public string Description_pt
        {
            get
            {
                return description_pt;
            }
            set
            {
                description_pt = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Description_pt"));
            }
        }

        public string Description_ro
        {
            get
            {
                return description_ro;
            }
            set
            {
                description_ro = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Description_ro"));
            }
        }

        public string Description_ru
        {
            get
            {
                return description_ru;
            }
            set
            {
                description_ru = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Description_ru"));
            }
        }

        public string Description_zh
        {
            get
            {
                return description_zh;
            }
            set
            {
                description_zh = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Description_zh"));
            }
        }

        public string Name
        {
            get
            {
                return name;
            }
            set
            {
                name = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Name"));
            }
        }

        public string Name_en
        {
            get
            {
                return name_en;
            }
            set
            {
                name_en = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Name_en"));
            }
        }

        public string Name_es
        {
            get
            {
                return name_es;
            }
            set
            {
                name_es = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Name_es"));
            }
        }

        public string Name_fr
        {
            get
            {
                return name_fr;
            }
            set
            {
                name_fr = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Name_fr"));
            }
        }

        public string Name_pt
        {
            get
            {
                return name_pt;
            }
            set
            {
                name_pt = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Name_pt"));
            }
        }

        public string Name_ro
        {
            get
            {
                return name_ro;
            }
            set
            {
                name_ro = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Name_ro"));
            }
        }

        public string Name_ru
        {
            get
            {
                return name_ru;
            }
            set
            {
                name_ru = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Name_ru"));
            }
        }

        public string Name_zh
        {
            get
            {
                return name_zh;
            }
            set
            {
                name_zh = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Name_zh"));
            }
        }

        public MaximizedElementPosition MaximizedElementPosition
        {
            get { return maximizedElementPosition; }
            set
            {
                maximizedElementPosition = value;
                OnPropertyChanged(new PropertyChangedEventArgs("MaximizedElementPosition"));
            }
        }

        public string WindowHeader
        {
            get
            {
                return windowHeader;
            }
            set
            {
                windowHeader = value;
                OnPropertyChanged(new PropertyChangedEventArgs("WindowHeader"));
            }
        }

        public bool IsNew
        {
            get
            {
                return isNew;
            }

            set
            {
                isNew = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsNew"));
            }
        }

        public MaximizedElementPosition SelectedAppearanceItem
        {
            get { return selectedAppearanceItem; }
            set
            {
                selectedAppearanceItem = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedAppearanceItem"));
            }
        }

        public ObservableCollection<Site> PlantList
        {
            get
            {
                return plantList;
            }

            set
            {
                plantList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("PlantList"));
            }
        }

        public List<object> SelectedPlant
        {
            get
            {
                return selectedPlant;
            }

            set
            {
                selectedPlant = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedPlant"));
            }
        }

        public List<object> SelectedPlant_Copy
        {
            get
            {
                return selectedPlant_Copy;
            }

            set
            {
                selectedPlant_Copy = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedPlant_Copy"));
            }
        }

        public ObservableCollection<Currency> CurrencyList
        {
            get
            {
                return currencyList;
            }

            set
            {
                currencyList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("CurrencyList"));
            }
        }

        public object SelectedCurrency
        {
            get
            {
                return selectedCurrency;
            }

            set
            {
                selectedCurrency = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedCurrency"));
            }
        }

        public List<LookupValue> StatusList
        {
            get { return statusList; }
            set
            {
                statusList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("StatusList"));
            }
        }

        public int SelectedStatusIndex
        {
            get { return selectedStatusIndex; }
            set
            {
                selectedStatusIndex = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedStatusIndex"));
            }
        }

        public LookupValue SelectedStatus
        {
            get { return selectedStatus; }
            set
            {
                selectedStatus = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedStatus"));
            }
        }

        public ObservableCollection<Currency> SaleCurrencyList
        {
            get
            {
                return saleCurrencyList;
            }
            set
            {
                saleCurrencyList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SaleCurrencyList"));
            }
        }

        public List<object> SelectedSaleCurrency
        {
            get
            {
                return selectedSaleCurrency;
            }
            set
            {
                selectedSaleCurrency = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedSaleCurrency"));
            }
        }

        public List<object> SelectedSaleCurrency_Copy
        {
            get
            {
                return selectedSaleCurrency_Copy;
            }
            set
            {
                selectedSaleCurrency_Copy = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedSaleCurrency_Copy"));
            }
        }
        public object SelectedSaleCurrencyObj
        {
            get
            {
                return selectedSaleCurrencyObj;
            }

            set
            {
                selectedSaleCurrencyObj = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedSaleCurrencyObj"));
            }
        }

        public ObservableCollection<BasePrice> BasePriceNameList
        {
            get
            {
                return basePriceNameList;
            }
            set
            {
                basePriceNameList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("BasePriceNameList"));
            }
        }

        public BasePrice SelectedBasePriceName
        {
            get
            {
                return selectedBasePriceName;
            }

            set
            {
                selectedBasePriceName = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedBasePriceName"));
            }
        }

        public string SelectedCustomerPriceCode
        {
            get
            {
                return selectedCustomerPriceCode;
            }
            set
            {
                selectedCustomerPriceCode = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedCustomerPriceCode"));
            }
        }

        public bool IsCheckedAllLanguages
        {
            get
            {
                return isCheckedAllLanguages;
            }
            set
            {
                isCheckedAllLanguages = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsCheckedAllLanguages"));
            }
        }

        public string Remark
        {
            get
            {
                return remark;
            }

            set
            {
                remark = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Remark"));
            }
        }

        public string Remark_en
        {
            get
            {
                return remark_en;
            }

            set
            {
                remark_en = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Remark_en"));
            }
        }

        public string Remark_es
        {
            get
            {
                return remark_es;
            }

            set
            {
                remark_es = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Remark_es"));
            }
        }

        public string Remark_fr
        {
            get
            {
                return remark_fr;
            }

            set
            {
                remark_fr = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Remark_fr"));
            }
        }

        public string Remark_pt
        {
            get
            {
                return remark_pt;
            }

            set
            {
                remark_pt = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Remark_pt"));
            }
        }

        public string Remark_ro
        {
            get
            {
                return remark_ro;
            }

            set
            {
                remark_ro = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Remark_ro"));
            }
        }

        public string Remark_ru
        {
            get
            {
                return remark_ru;
            }

            set
            {
                remark_ru = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Remark_ru"));
            }
        }

        public string Remark_zh
        {
            get
            {
                return remark_zh;
            }

            set
            {
                remark_zh = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Remark_zh"));
            }
        }

        public bool IsNewCustomerPriceSave
        {
            get
            {
                return isNewCustomerPriceSave;
            }

            set
            {
                isNewCustomerPriceSave = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsNewCustomerPriceSave"));
            }
        }

        public ulong IdBasePriceList
        {
            get
            {
                return idBasePriceList;
            }

            set
            {
                idBasePriceList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IdBasePriceList"));
            }
        }

        public BasePrice ClonedBasePrice
        {
            get
            {
                return clonedBasePrice;
            }
            set
            {
                clonedBasePrice = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ClonedBasePrice"));
            }
        }



        public DateTime CreationDate
        {
            get
            {
                return creationDate;
            }
            set
            {
                creationDate = value;
                OnPropertyChanged(new PropertyChangedEventArgs("CreationDate"));
            }
        }

        public DateTime? ExpiryDate
        {
            get
            {
                return expiryDate;
            }
            set
            {
                expiryDate = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ExpiryDate"));
            }
        }

        public DateTime? EffectiveDate
        {
            get
            {
                return effectiveDate;
            }
            set
            {
                effectiveDate = value;
                OnPropertyChanged(new PropertyChangedEventArgs("EffectiveDate"));
            }
        }

        public DateTime? LastUpdated
        {
            get
            {
                return lastUpdated;
            }
            set
            {
                lastUpdated = value;
                OnPropertyChanged(new PropertyChangedEventArgs("LastUpdated"));
            }
        }
        public ObservableCollection<PCMArticleCategory> ArticleMenuList
        {
            get
            {
                return articleMenuList;
            }

            set
            {
                articleMenuList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ArticleMenuList"));
            }
        }

        public PCMArticleCategory SelectedArticle
        {
            get
            {
                return selectedArticle;
            }

            set
            {
                selectedArticle = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedArticle"));
            }
        }

        public DataTable DtArticle
        {
            get { return dtArticle; }
            set
            {
                dtArticle = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DtArticle"));
            }
        }
        public DataTable DtArticleCopy
        {
            get { return dtArticleCopy; }
            set
            {
                dtArticleCopy = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DtArticleCopy"));
            }
        }
        public ObservableCollection<Emdep.Geos.UI.Helper.Column> Columns
        {
            get { return columns; }
            set
            {
                columns = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Columns"));
            }
        }
        public ObservableCollection<BandItem> Bands
        {
            get { return bands; }
            set
            {
                bands = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Bands"));
            }
        }

        public ObservableCollection<Summary> TotalSummary { get; private set; }
        public List<LookupValue> LogicList
        {
            get
            {
                return logicList;
            }

            set
            {
                logicList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("LogicList"));
            }
        }

        public LookupValue SelectedLogic
        {
            get
            {
                return selectedLogic;
            }
            set
            {
                selectedLogic = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedLogic"));
            }
        }

        public ObservableCollection<CustomerPriceListByItem> ArticleList
        {
            get
            {
                return articleList;
            }

            set
            {
                articleList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ArticleList"));
            }
        }
        public List<ArticleCostPrice> ArticleCostPriceList
        {
            get
            {
                return articleCostPriceList;
            }

            set
            {
                articleCostPriceList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ArticleCostPriceList"));
            }
        }

        public List<CurrencyConversion> CurrencyConversionList
        {
            get
            {
                return currencyConversionList;
            }

            set
            {
                currencyConversionList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("CurrencyConversionList"));
            }
        }

        public List<Site> Article_PlantList1
        {
            get
            {
                return article_PlantList;
            }
            set
            {
                article_PlantList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Article_PlantList"));
            }
        }
        public List<Currency> Article_CurrencyList1
        {
            get
            {
                return article_CurrencyList;
            }
            set
            {
                article_CurrencyList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Article_CurrencyList"));
            }
        }

        public bool IsCalculateArticleCostButtonEnabled
        {
            get
            {
                return isCalculateArticleCostButtonEnabled;
            }

            set
            {
                isCalculateArticleCostButtonEnabled = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsCalculateArticleCostButtonEnabled"));
            }
        }

        public bool IsCalculated
        {
            get
            {
                return isCalculated;
            }

            set
            {
                isCalculated = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsCalculated"));
            }
        }

        public string InformationError
        {
            get { return informationError; }
            set
            {
                informationError = value;
                OnPropertyChanged(new PropertyChangedEventArgs("InformationError"));
            }
        }

        public ulong IdBasePrice
        {
            get
            {
                return idBasePrice;
            }

            set
            {
                idBasePrice = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IdBasePrice"));
            }
        }

        public Int32? IdExchangeRateUpdateType
        {
            get { return idExchangeRateUpdateType; }
            set
            {
                idExchangeRateUpdateType = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IdExchangeRateUpdateType"));
            }
        }

        public byte IdCurrency
        {
            get
            {
                return idCurrency;
            }

            set
            {
                idCurrency = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IdCurrency"));
            }
        }

        public string CurrencyName
        {
            get
            {
                return currencyName;
            }

            set
            {
                currencyName = value;
                OnPropertyChanged(new PropertyChangedEventArgs("CurrencyName"));
            }
        }

        public ImageSource CurrencyIcon
        {
            get
            {
                return currencyIcon;
            }
            set
            {
                currencyIcon = value;
                OnPropertyChanged(new PropertyChangedEventArgs("CurrencyIcon"));
            }
        }

        public CustomerPrice ClonedCustomerPrice
        {
            get
            {
                return clonedCustomerPrice;
            }
            set
            {
                clonedCustomerPrice = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ClonedBasePrice"));
            }
        }

        public bool IsEditCustmorPrice
        {
            get
            {
                return isEditCustmorPrice;
            }

            set
            {
                isEditCustmorPrice = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsEditCustmorPrice"));
            }
        }

        public ulong IdCustomerPriceList
        {
            get
            {
                return idCustomerPriceList;
            }

            set
            {
                idCustomerPriceList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IdCustomerPriceList"));
            }
        }

        public int SelectedBasePriceNameIndex
        {
            get
            {
                return selectedBasePriceNameIndex;
            }

            set
            {
                selectedBasePriceNameIndex = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedBasePriceNameIndex"));
            }
        }

        public int Group
        {
            get
            {
                return group;
            }
            set
            {
                group = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Group"));
            }
        }
        public int Region
        {
            get
            {
                return region;
            }
            set
            {
                region = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Region"));
            }
        }
        public int Country
        {
            get
            {
                return country;
            }
            set
            {
                country = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Country"));
            }
        }
        public int Plant
        {
            get
            {
                return plant;
            }
            set
            {
                plant = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Plant"));
            }
        }
        public char? SelectedLetter
        {
            get { return this._SelectedLetter; }
            set
            {
                if (this._SelectedLetter != value)
                {
                    this._SelectedLetter = value;
                    OnPropertyChanged(new PropertyChangedEventArgs("SelectedLetter"));
                    if (this._SelectedLetter == null)
                    {
                        FilterStringForName = string.Empty;
                    }
                    else
                    {
                        FilterStringForName = "StartsWith([GroupName], '" + this.SelectedLetter + "')";
                    }
                }
            }
        }
        public string FilterStringForName
        {
            get { return filterStringForName; }
            set
            {
                filterStringForName = value;
                OnPropertyChanged(new PropertyChangedEventArgs("FilterStringForName"));
            }
        }
        public ObservableCollection<char> Letters
        {
            get
            {
                if (this._Letters == null)
                {
                    this._Letters = new ObservableCollection<char>();
                    char c = 'A';
                    while (c <= 'Z')
                    {
                        this._Letters.Add(c);
                        c++;
                    }
                }
                return this._Letters;
            }
            set
            {
                _Letters = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Letters"));
            }
        }
        public bool IsCellChecked
        {
            get
            {
                return isCellChecked;
            }
            set
            {
                isCellChecked = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsCellChecked"));
            }
        }
        public Visibility IsExportVisible
        {
            get
            {
                return isExportVisible;
            }
            set
            {
                isExportVisible = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsExportVisible"));
            }
        }
        public List<CPLCustomer> CPLCustomerList
        {
            get
            {
                return cplCustomerList;
            }
            set
            {
                cplCustomerList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("CPLCustomerList"));
            }
        }
        public string Reference
        {
            get { return reference; }
            set
            {
                reference = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Reference"));
            }
        }
        public bool? IsCheckedCustomer
        {
            get
            {
                return isCheckedCustomer;
            }
            set
            {
                isCheckedCustomer = value;
                if (IsCellChecked == false)
                {
                    if (isCheckedCustomer == true)
                    {
                        CPLCustomerList.ToList().ForEach(a => a.IsChecked = true);
                        CustomerHeaderClickCommandAction(null);
                    }
                    else
                    {
                        CPLCustomerList.ToList().ForEach(a => a.IsChecked = false);
                        CustomerHeaderClickCommandAction(null);
                    }
                }
                else
                {
                    IsCellChecked = false;
                }
                OnPropertyChanged(new PropertyChangedEventArgs("IsCheckedCustomer"));
            }
        }

        public List<CustomerPriceLogEntry> ChangeLogList
        {
            get
            {
                return changeLogList;
            }
            set
            {
                changeLogList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ChangeLogList"));
            }
        }

        public ObservableCollection<CustomerPriceLogEntry> CustomerChangeLogList
        {
            get
            {
                return customerChangeLogList;
            }
            set
            {
                customerChangeLogList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("CustomerChangeLogList"));
            }
        }

        public ObservableCollection<CPLCustomer> SelectedCustomersList
        {
            get
            {
                return selectedCustomersList;
            }

            set
            {
                selectedCustomersList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedCustomersList"));
            }
        }
        public List<Currency> Article_CurrencyList_BPL1
        {
            get
            {
                return article_CurrencyList_BPL;
            }
            set
            {
                article_CurrencyList_BPL = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Article_CurrencyList_BPL"));
            }
        }
        public List<Currency> Detection_CurrencyList_BPL1
        {
            get
            {
                return detection_CurrencyList_BPL;
            }
            set
            {
                detection_CurrencyList_BPL = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Detection_CurrencyList_BPL"));
            }
        }


        public bool IsAll
        {
            get
            {
                return isAll;
            }

            set
            {
                isAll = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsAll"));
            }
        }

        public BasePrice SelectedBasePriceName_Copy
        {
            get
            {
                return selectedBasePriceName_Copy;
            }

            set
            {
                selectedBasePriceName_Copy = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedBasePriceName_Copy"));
            }
        }

        public List<CPLCustomer> CPLCustomersAll
        {
            get
            {
                return cPLCustomersAll;
            }

            set
            {
                cPLCustomersAll = value;
                OnPropertyChanged(new PropertyChangedEventArgs("CPLCustomersAll"));
            }
        }

        public List<Currency> Article_CurrencyList_ForCPL1
        {
            get
            {
                return article_CurrencyList_ForCPL;
            }
            set
            {
                article_CurrencyList_ForCPL = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Article_CurrencyList_ForCPL"));
            }
        }

        public List<Currency> Detection_CurrencyList_ForCPL1
        {
            get
            {
                return detection_CurrencyList_ForCPL;
            }
            set
            {
                detection_CurrencyList_ForCPL = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Detection_CurrencyList_ForCPL"));
            }
        }


        public bool IsCheckedBasePrice
        {
            get
            {
                return isCheckedBasePrice;
            }
            set
            {
                isCheckedBasePrice = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsCheckedBasePrice"));
            }
        }

        public bool IsCheckedCustomerPrice
        {
            get
            {
                return isCheckedCustomerPrice;
            }
            set
            {
                isCheckedCustomerPrice = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsCheckedCustomerPrice"));
            }
        }

        public string MyFilterString
        {
            get { return myFilterString; }
            set
            {
                myFilterString = value;
                OnPropertyChanged(new PropertyChangedEventArgs("MyFilterString"));
            }
        }

        public List<BPLDetection> DetectionMenuList
        {
            get
            {
                return detectionMenulist;
            }

            set
            {
                detectionMenulist = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DetectionMenuList"));
            }
        }

        public BPLDetection SelectedDetection
        {
            get
            {
                return selectedDetection;
            }

            set
            {
                selectedDetection = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedDetection"));
            }
        }

        public DataTable DtDetection
        {
            get { return dtDetection; }
            set
            {
                dtDetection = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DtDetection"));
            }
        }

        public DataTable DtDetectionCopy
        {
            get { return dtDetectionCopy; }
            set
            {
                dtDetectionCopy = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DtDetectionCopy"));
            }
        }

        public ObservableCollection<BandItem> DetectionBands
        {
            get { return detectionBands; }
            set
            {
                detectionBands = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DetectionBands"));
            }
        }

        public ObservableCollection<CustomerPriceListByItem> DetectionList
        {
            get
            {
                return detectionList;
            }

            set
            {
                detectionList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DetectionList"));
            }
        }

        //public bool IsCPLArticleEnable
        //{
        //    get { return _isCPLArticleEnable; }
        //    set
        //    {
        //        _isCPLArticleEnable = value;
        //        OnPropertyChanged(new PropertyChangedEventArgs("IsCPLArticleEnable"));
        //    }
        //}

        //public bool IsCPLArticleDescriptionEnable
        //{
        //    get { return _isCPLArticleDescriptionEnable; }
        //    set
        //    {
        //        _isCPLArticleDescriptionEnable = value;
        //        OnPropertyChanged(new PropertyChangedEventArgs("IsCPLArticleDescriptionEnable"));
        //    }
        //}

        public List<Site> Detection_PlantList1
        {
            get
            {
                return detection_PlantList;
            }

            set
            {
                detection_PlantList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Detection_PlantList"));
            }
        }

        public List<Currency> Detection_CurrencyList1
        {
            get
            {
                return detection_CurrencyList;
            }

            set
            {
                detection_CurrencyList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Detection_CurrencyList"));
            }
        }
        public List<Articles> DeleteArticles
        {
            get
            {
                return deleteArticles;
            }

            set
            {
                deleteArticles = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DeleteArticles"));
            }
        }

        public List<Detections> DeleteDetections
        {
            get { return deleteDetetions; }
            set
            {
                deleteDetetions = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DeleteDetections"));
            }
        }

        public bool IsSaleCurrencyAddedOrRemove
        {
            get
            {
                return isSaleCurrencyAddedOrRemove;
            }

            set
            {
                isSaleCurrencyAddedOrRemove = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsSaleCurrencyAddedOrRemove"));
            }
        }

        public int ArticleCount
        {
            get
            {
                return articleCount;
            }

            set
            {
                articleCount = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ArticleCount"));
            }
        }

        public int DetectionCount
        {
            get
            {
                return detectionCount;
            }

            set
            {
                detectionCount = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DetectionCount"));
            }
        }
        public List<CustomerPriceListByItem> SavedArticles
        {
            get
            {
                return savedArticles;
            }

            set
            {
                savedArticles = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SavedArticles"));
            }
        }

        public List<CustomerPriceListByItem> SavedDetections
        {
            get
            {
                return savedDetections;
            }

            set
            {
                savedDetections = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SavedDetections"));
            }
        }

        public LookupValue SelectedExchangeRate
        {
            get { return selectedExchangeRate; }
            set
            {
                selectedExchangeRate = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedExchangeRate"));
            }
        }

        public List<CurrencyConversion> CurrencyConversionList_ByPreviousDate1
        {
            get
            {
                return currencyConversionList_ByPreviousDate;
            }

            set
            {
                currencyConversionList_ByPreviousDate = value;
                OnPropertyChanged(new PropertyChangedEventArgs("CurrencyConversionList_ByPreviousDate"));
            }
        }


        public bool IsArticleColumnChooserVisible
        {
            get { return isArticleColumnChooserVisible; }
            set
            {
                isArticleColumnChooserVisible = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsArticleColumnChooserVisible"));
            }
        }


        public bool IsDetectionColumnChooserVisible
        {
            get { return isDetectionColumnChooserVisible; }
            set
            {
                isDetectionColumnChooserVisible = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsDetectionColumnChooserVisible"));
            }
        }

        public bool IsFirstTimeLoad
        {
            get
            {
                return isFirstTimeLoad;
            }

            set
            {
                isFirstTimeLoad = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsFirstTimeLoad"));
            }
        }

        public bool IsFirstTimeArticleLoad
        {
            get
            {
                return isFirstTimeArticleLoad;
            }

            set
            {
                isFirstTimeArticleLoad = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsFirstTimeArticleLoad"));
            }
        }

        public bool IsFirstTimeDetectionLoad
        {
            get
            {
                return isFirstTimeDetectionLoad;
            }

            set
            {
                isFirstTimeDetectionLoad = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsFirstTimeDetectionLoad"));
            }
        }

        public bool IsSwitch
        {
            get
            {
                return isSwitch;
            }

            set
            {
                isSwitch = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsSwitch"));
            }
        }

        public object SelectedCurrency_Copy
        {
            get
            {
                return selectedCurrency_Copy;
            }

            set
            {
                selectedCurrency_Copy = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedCurrency_Copy"));
            }
        }

        public bool IsUserPermission
        {
            get
            {
                return isUserPermission;
            }

            set
            {
                isUserPermission = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsUserPermission"));
            }
        }

        public bool IsEnabledAcceptButton
        {
            get { return isEnabledAcceptButton; }
            set
            {
                isEnabledAcceptButton = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsEnabledAcceptButton"));
            }
        }
        //public bool IsEnabledAcceptButton
        //{
        //    get { return isEnabledAcceptButton; }
        //    set
        //    {
        //        isEnabledAcceptButton = value;
        //        OnPropertyChanged(new PropertyChangedEventArgs("IsEnabledAcceptButton"));
        //    }
        //}

        public bool IsEnabledSaveButton
        {
            get { return isEnabledSaveButton; }
            set
            {
                if (GeosApplication.Instance.IsPLMPermissionChange == true && IsUserPermission == true)
                {
                    isEnabledSaveButton = value;
                }
                else if (!isEnabledSaveButton)
                {
                    isEnabledSaveButton = false;
                }
                OnPropertyChanged(new PropertyChangedEventArgs("IsEnabledSaveButton"));
            }
        }
        public Visibility SaveButtonVisibility
        {
            get { return saveButtonVisibility; }
            set { saveButtonVisibility = value; OnPropertyChanged(new PropertyChangedEventArgs("SaveButtonVisibility")); }
        }

        public Visibility ExportPriceListButtonVisibility
        {
            get { return exportPriceListButtonVisibility; }
            set { exportPriceListButtonVisibility = value; OnPropertyChanged(new PropertyChangedEventArgs("ExportPriceListButtonVisibility")); }
        }

        public ObservableCollection<CPLDocument> OptionWayDetectionSparePartFilesList
        {
            get
            {
                return optionWayDetectionSparePartFilesList;
            }

            set
            {
                optionWayDetectionSparePartFilesList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("OptionWayDetectionSparePartFilesList"));
            }
        }

        public ObservableCollection<CPLDocument> FourOptionWayDetectionSparePartFilesList
        {
            get
            {
                return fourOptionWayDetectionSparePartFilesList;
            }

            set
            {
                fourOptionWayDetectionSparePartFilesList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("FourOptionWayDetectionSparePartFilesList"));
            }
        }

        public CPLDocument SelectedOptionWayDetectionSparePartFile
        {
            get
            {
                return selectedOptionWayDetectionSparePartFile;
            }

            set
            {
                selectedOptionWayDetectionSparePartFile = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedOptionWayDetectionSparePartFile"));
            }
        }

        public bool InActiveStatus
        {
            get
            {
                return inActiveStatus;
            }

            set
            {
                inActiveStatus = value;
                OnPropertyChanged(new PropertyChangedEventArgs("InActiveStatus"));
            }
        }

        //[Sudhir.jangra][GEOS2-3349][27/12/2022]
        #region Sudhir.Jangra GEOS2-3349 27/12/2022
        public Visibility IsDuplicateCustomerPriceButtonVisible
        {
            get { return isDuplicateCustomerPriceButtonVisible; }
            set
            {
                isDuplicateCustomerPriceButtonVisible = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsDuplicateCustomerPriceButtonVisible"));
            }
        }
        public bool IsDuplicateCustomerPriceButtonEnabled
        {
            get { return isDuplicateCustomerPriceButtonEnabled; }
            set
            {
                isDuplicateCustomerPriceButtonEnabled = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsDuplicateCustomerPriceButtonEnabled"));
            }
        }
        public string CustomerPriceOldCode
        {
            get { return customerPriceOldCode; }
            set
            {
                customerPriceOldCode = value;
                OnPropertyChanged(new PropertyChangedEventArgs("CustomerPriceOldCode"));
            }
        }
        public string DuplicateCode
        {
            get { return duplicateCode; }
            set
            {
                duplicateCode = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DuplicateCode"));
            }
        }
        public ObservableCollection<BandItem> DetectionBandTemplate
        {
            get { return detectionBandTemplate; }
            set
            {
                detectionBandTemplate = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DetectionBandTemplate"));
            }
        }
        public ObservableCollection<BasePriceListByPlantCurrency> PlantCurrencyList
        {
            get { return plantCurrencyList; }
            set
            {
                plantCurrencyList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("PlantCurrencyList"));
            }
        }
        public CustomerPrice DuplicatedCustomerPriceObject
        {
            get { return duplicatedCustomerPriceObject; }
            set
            {
                duplicatedCustomerPriceObject = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DuplicatedCustomerPriceObject"));
            }
        }
        public LookupValue SelectedOriginalStatus
        {
            get { return selectedOriginalStatus; }
            set
            {
                selectedOriginalStatus = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedOriginalStatus"));
            }
        }
        public DataTable DtTable
        {
            get { return dtTable; }
            set
            {
                dtTable = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DtTable"));
            }
        }
        public DataTable DtTableCopy
        {
            get { return dtTableCopy; }
            set
            {
                dtTableCopy = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DtTableCopy"));
            }
        }
        public List<BasePriceListByPlantCurrency> PlantCurrencyListWithIsChecked
        {
            get
            {
                return plantCurrencyListwithIsChecked;
            }
            set
            {
                plantCurrencyListwithIsChecked = value;
                OnPropertyChanged(new PropertyChangedEventArgs("PlantCurrencyListWithIsChecked"));
            }
        }
        public ObservableCollection<BandItem> BandsTemplete
        {
            get { return bandsTemplete; }
            set
            {
                bandsTemplete = value;
                OnPropertyChanged(new PropertyChangedEventArgs("BandsTemplete"));
            }
        }
        public CustomerPriceLogEntry SelectedCustomerPriceChangeLog
        {
            get { return selectedCustomerPriceChangeLog; }
            set
            {
                selectedCustomerPriceChangeLog = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedCustomerPriceChangeLog"));
            }
        }
        public string oldSelectedLanguage;
        public List<UInt64> AddArticles//[Sudhir.Jangra][GEOS2-3349][28/12/2022]
        {
            get { return addArticles; }
            set
            {
                addArticles = value;
                OnPropertyChanged(new PropertyChangedEventArgs("AddArticles"));
            }
        }
        public List<UInt64> AddDetections//[Sudhir.Jangra][GEOS2-3349][28/12/2022]
        {
            get { return addDetections; }
            set
            {
                addDetections = value;
                OnPropertyChanged(new PropertyChangedEventArgs("AddDetections"));
            }
        }
        #endregion


        //[Sudhir.Jangra][GEOS2-1960][13/03/2023]
        public string IsAttachmentScrollVisible
        {
            get { return isAttachmentScrollVisible; }
            set
            {
                isAttachmentScrollVisible = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsAttachmentScrollVisible"));
            }
        }



        //[Sudhir.jangra][GEOS2-4935]
        public ObservableCollection<CustomerPriceLogEntry> CommentsList
        {
            get { return commentList; }
            set
            {
                commentList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("CommentsList"));
            }
        }

        //[Sudhir.jangra][GEOS2-4935]
        public string CommentText
        {
            get { return commentText; }
            set
            {
                commentText = value;
                OnPropertyChanged(new PropertyChangedEventArgs("CommentText"));
            }
        }

        //[Sudhir.Jangra][GEOS2-4935]
        public DateTime? CommentDateTimeText
        {
            get { return commentDateTimeText; }
            set
            {
                commentDateTimeText = value;
                OnPropertyChanged(new PropertyChangedEventArgs("CommentDateTimeText"));
            }
        }

        //[Sudhir.Jangra][GEOS2-4935]
        public string CommentFullNameText
        {
            get { return commentFullNameText; }
            set
            {
                commentFullNameText = value;
                OnPropertyChanged(new PropertyChangedEventArgs("CommentFullNameText"));
            }
        }

        //[Sudhir.Jangra][GEOS2-4935]
        public byte[] UserProfileImageByte
        {
            get { return userProfileImageByte; }
            set
            {
                userProfileImageByte = value;
                OnPropertyChanged(new PropertyChangedEventArgs("UserProfileImageByte"));
            }
        }

        public List<CustomerPriceLogEntry> AddCommentsList
        {
            get { return addCommentsList; }
            set
            {
                addCommentsList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("AddCommentsList"));
            }
        }

        //[Sudhir.Jangra][GEOS2-4935]
        public CustomerPriceLogEntry SelectedComment
        {
            get { return selectedComment; }
            set
            {
                selectedComment = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedComment"));
            }
        }

        //[Sudhir.jangra][GEOS2-4935]
        public ObservableCollection<CustomerPriceLogEntry> DeleteCommentsList
        {
            get { return deleteCommentsList; }
            set
            {
                deleteCommentsList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DeleteCommentsList"));
            }
        }

        //[Sudhir.Jangra][GEOS2-4935]
        public bool IsDeleted
        {
            get { return isDeleted; }
            set
            {
                isDeleted = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsDeleted"));
            }
        }

        //[Sudhir.jangra][GEOS2-4935]
        public List<CustomerPriceLogEntry> UpdatedCommentsList
        {
            get { return updatedCommentList; }
            set
            {
                updatedCommentList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("UpdatedCommentsList"));
            }
        }
        #endregion

        #region ICommands
        public ICommand EscapeButtonCommand { get; set; }
        public ICommand CancelButtonCommand { get; set; }
        public ICommand ChangeLanguageCommand { get; set; }
        public ICommand ChangeNameCommand { get; set; }
        public ICommand ChangeDescriptionCommand { get; set; }
        public ICommand ChangeRemarkCommand { get; set; }
        public ICommand UncheckedCopyNameDescriptionCommand { get; set; }

        public ICommand AcceptButtonCommand { get; set; }

        public ICommand ShowReferenceViewCommand { get; set; }
        public ICommand ShowDescriptionViewCommand { get; set; }
        public ICommand ChangePlantCommand { get; set; }
        public ICommand ChangeCurrencyCommand { get; set; }
        public ICommand ChangeSaleCurrencyCommand { get; set; }

        public ICommand CommandOnDragRecordOverArticleGrid { get; set; }
        public ICommand CommandDropRecordArticleGrid { get; set; }
        public ICommand CommandCompleteRecordDragDropArticleGrid { get; set; }
        public ICommand DeleteArticleCommand { get; set; }
        public ICommand RuleValueChangedCommand { get; set; }
        public ICommand CalculateArticleCostCommand { get; set; }
        public ICommand OnEffectiveDateEditValueChangingCommand { get; set; }
        public ICommand BasePriceSelectedIndexChangedCommand { get; set; }
        public ICommand ForSelectAllCommand { get; set; }
        public ICommand SelectedItemChangedCommand { get; set; }
        public ICommand ExportToExcelCustomersCommand { get; set; }
        public ICommand ExportToExcelPriceListDetailsCommand { get; set; }
        public ICommand CustomerHeaderClickCommand { get; set; }
        public ICommand ArticleVisibleCustomerCommand { get; set; }
        public ICommand AllButtonCommand { get; set; }
        public ICommand AddCustomerCommand { get; set; }
        public ICommand EditCustomerCommand { get; set; }
        public ICommand DeleteCustomerCommand { get; set; }
        public ICommand ArticleDescriptionLinkedCommand { get; set; }
        public ICommand CommandShowBasePriceFilterPopupClick { get; set; }
        public ICommand CommandShowCustomerPriceFilterPopupClick { get; set; }
        public ICommand CommandOnDragRecordOverDetectionGrid { get; set; }
        public ICommand CommandDropRecordDetectionGrid { get; set; }
        public ICommand CommandCompleteRecordDragDropDetectionGrid { get; set; }
        public ICommand DeleteDetectionCommand { get; set; }
        public ICommand RuleValueChangedDetectionCommand { get; set; }
        public ICommand DetectionVisibleCustomerCommand { get; set; }
        public ICommand DetectionDescriptionLinkedCommand { get; set; }
        public ICommand ShowingEditorCommand { get; set; }
        public ICommand PastingFromClipBoardCommond { get; set; }


        public ICommand ArticleGridControlLoadedCommand { get; set; }
        public ICommand DetectionGridControlLoadedCommand { get; set; }

        public ICommand ArticleGridControlUnloadedCommand { get; set; }
        public ICommand DetectionGridControlUnloadedCommand { get; set; }


        public ICommand ArticleGridControlPropertyChangedCommand { get; set; }
        public ICommand DetectionGridControlPropertyChangedCommand { get; set; }
        public ICommand ChangeNameFromItemCommand { get; set; }
        public ICommand PasteInSearchControlCommand { get; set; }

        public ICommand ArticleDetectionNameValueChangedCommand { get; set; }

        public ICommand SaveButtonCommand { get; set; }
        public ICommand ChangeStatusCommand { get; set; }
        public ICommand ChangeEffectiveDateCommand { get; set; }
        public ICommand ChangeExpiryDateCommand { get; set; }
        public ICommand ChangeCheckAllLanguagesCommand { get; set; }

        public ICommand SelectionChangedArticleDetectionGridCommand { get; set; }
        public ICommand EditArticleCommand { get; set; }

        public ICommand DetectionsDoubleClickCommand { get; set; }

        public ICommand AddFileCommand { get; set; }
        public ICommand EditFileCommand { get; set; }
        public ICommand OpenPDFDocumentCommand { get; set; }
        public ICommand DeleteFileCommand { get; set; }
        //[Sudhir.Jangra][GEOS2-3349][27/12/2022]
        public ICommand DuplicateCustomerPriceCommand { get; set; }

        #region GEOS2-3272
        // shubham[skadam] GEOS2-3272 Custom filters in the BPL and CPL grid [#PLM39] 01 12 2022
        public ICommand FilterEditorCreatedCommand { get; set; }
        public ICommand CommandShowFilterPopupClick { get; set; }
        public ICommand CustomCellAppearanceCommand { get; set; }
        public ICommand TableView_ShownEditorCommand { get; set; }
        public ICommand CommandFilterStatusTileClick { get; set; }
        public ICommand CommandTileBarClickDoubleClick { get; set; }

        public ICommand DetectionFilterEditorCreatedCommand { get; set; }
        public ICommand DetectionCommandShowFilterPopupClick { get; set; }
        public ICommand DetectionCustomCellAppearanceCommand { get; set; }
        public ICommand DetectionTableView_ShownEditorCommand { get; set; }
        public ICommand DetectionCommandFilterStatusTileClick { get; set; }
        public ICommand DetectionCommandTileBarClickDoubleClick { get; set; }
        #endregion

        #region GEOS2-2885
        public ICommand ModuleVisibleCustomerCommand { get; set; }
        public ICommand RuleValueChangedModuleCommand { get; set; }
        public ICommand ModuleDescriptionLinkedCommand { get; set; }
        public ICommand ModuleGridControlLoadedCommand { get; set; }
        public ICommand ModuleGridControlUnloadedCommand { get; set; }
        public ICommand DeleteModuleCommand { get; set; }
        public ICommand ModulesDoubleClickCommand { get; set; }


        #endregion

        //Shubham[skadam] GEOS2-4424 Need to add "Add ALL" button in module tab in BPL. 29 08 2023
        //Shubham[skadam] GEOS2-4784 Need to add custom filter option in module same as article/detection. 29 08 2023
        //Shubham[skadam] GEOS2-4785 No additional data so remove [0] this in tree menu in article, detection & module  left tree in BPL menu 29 08 2023
        //Shubham[skadam] GEOS2-4786 (JLR) The exported XLS Price List (BPL and CPL) must have the sheet with the modules. 29 08 2023
        //Shubham[skadam] GEOS2-4424 Some changes in  Module tab in BPL (3/3) 28 08 2023
        public ICommand ModuleFilterEditorCreatedCommand { get; set; }
        public ICommand ModuleCommandShowFilterPopupClick { get; set; }
        public ICommand ModuleCommandFilterStatusTileClick { get; set; }
        public ICommand ModuleCommandTileBarClickDoubleClick { get; set; }
        //public ICommand ModuleCustomCellAppearanceCommand { get; set; }
        //public ICommand ModuleTableView_ShownEditorCommand { get; set; }


        public ICommand AddCommentsCommand { get; set; }//[Sudhir.jangra][GEOS2-4935][21/11/2023]

        public ICommand DeleteCommentRowCommand { get; set; }//[Sudhir.Jangra][GEOS2-4935]

        public ICommand CommentsGridDoubleClickCommand { get; set; }//[Sudhir.Jangra][GEOS2-4935]
        #endregion

        #region Constructor

        public AddEditCustomerPriceViewModel()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Constructor AddEditCustomerPriceViewModel ...", category: Category.Info, priority: Priority.Low);

                //DialogWidth = System.Windows.SystemParameters.WorkArea.Width - 10;
                //DialogHeight = System.Windows.SystemParameters.WorkArea.Height - 110;

                DialogWidth = System.Windows.SystemParameters.WorkArea.Width - 20;
                DialogHeight = System.Windows.SystemParameters.WorkArea.Height - 90;

                EscapeButtonCommand = new DelegateCommand<object>(CloseWindow);
                CancelButtonCommand = new DelegateCommand<object>(CloseWindow);

                ChangeLanguageCommand = new DelegateCommand<object>(RetrieveDescriptionByLanguge);
                ChangeNameCommand = new DelegateCommand<object>(SetNameToLanguage);
                ChangeDescriptionCommand = new DelegateCommand<object>(SetDescriptionToLanguage);
                ChangeRemarkCommand = new DelegateCommand<object>(SetRemarkToLanguage);
                UncheckedCopyNameDescriptionCommand = new DelegateCommand<object>(UncheckedCopyNameDescription);

                DeleteArticleCommand = new DelegateCommand<object>(DeleteArticleCommandAction);
                ForSelectAllCommand = new Prism.Commands.DelegateCommand<object>(SelectAllAction);
                SelectedItemChangedCommand = new DelegateCommand<object>(SelectedItemChangedCommandAction);
                ExportToExcelCustomersCommand = new DelegateCommand<object>(ExportToExcelCustomers);
                DuplicateCustomerPriceCommand = new DelegateCommand<object>(DuplicateCustomerPriceCommandAction);//[Sudhir.Jangra][GEOS2-3349][27/12/2022]
                ExportToExcelPriceListDetailsCommand = new DelegateCommand<object>(ExportToExcelPriceListDetails);
                CustomerHeaderClickCommand = new DelegateCommand<object>(CustomerHeaderClickCommandAction);

                AcceptButtonCommand = new DelegateCommand<object>(AcceptButtonCommandAction);


                AddCommentsCommand = new RelayCommand(new Action<object>(AddCommentsCommandAction));//[Sudhir.Jangra][GEOS2-4935]
                DeleteCommentRowCommand = new RelayCommand(new Action<object>(DeleteCommentRowCommandAction));//[Sudhir.Jangra][GEOS2-4935]
                CommentsGridDoubleClickCommand = new RelayCommand(new Action<object>(CommentDoubleClickCommandAction));//[Sudhir.Jangra][GEOS2-4935]


                OnEffectiveDateEditValueChangingCommand = new DelegateCommand<EditValueChangingEventArgs>(OnEffectiveDateEditValueChanging);
                BasePriceSelectedIndexChangedCommand = new DelegateCommand<object>(BasePriceSelectedIndexChangedCommandAction);

                ChangeSaleCurrencyCommand = new DelegateCommand<object>(ChangeSaleCurrencyCommandAction);
                RuleValueChangedCommand = new DelegateCommand<object>(RuleValueChangedCommandAction);
                CalculateArticleCostCommand = new DelegateCommand<object>(CalculateArticleCostCommandAction);

                ArticleVisibleCustomerCommand = new DelegateCommand<object>(ArticleVisibleCustomerCommandAction);
                AllButtonCommand = new DelegateCommand<object>(AllButtonClickAction);
                AddCustomerCommand = new DelegateCommand<object>(AddCustomerCommandAction);
                EditCustomerCommand = new DelegateCommand<object>(EditCustomerCommandAction);
                DeleteCustomerCommand = new DelegateCommand<object>(DeleteCustomerCommandAction);
                ArticleDescriptionLinkedCommand = new DelegateCommand<object>(ArticleDescriptionLinkedCommandAction);
                CommandShowBasePriceFilterPopupClick = new DelegateCommand<object>(ShowBasePriceFilterValue);
                CommandShowCustomerPriceFilterPopupClick = new DelegateCommand<object>(ShowCustomerPriceFilterValue);
                DeleteDetectionCommand = new DelegateCommand<object>(DeleteDetectionCommandAction);
                RuleValueChangedDetectionCommand = new DelegateCommand<object>(RuleValueChangedDetectionCommandAction);
                DetectionVisibleCustomerCommand = new DelegateCommand<object>(DetectionVisibleCustomerCommandAction);
                DetectionDescriptionLinkedCommand = new DelegateCommand<object>(DetectionDescriptionLinkedCommandAction);

                ShowingEditorCommand = new DelegateCommand<object>(ShowingEditorCommandAction);
                PastingFromClipBoardCommond = new DelegateCommand<object>(PastingFromClipBoardCommondAction);

                ArticleGridControlLoadedCommand = new DelegateCommand<object>(ArticleGridControlLoadedAction);
                DetectionGridControlLoadedCommand = new DelegateCommand<object>(DetectionGridControlLoadedAction);
                ArticleGridControlUnloadedCommand = new DelegateCommand<object>(ArticleGridControlUnloadedAction);
                DetectionGridControlUnloadedCommand = new DelegateCommand<object>(DetectionGridControlUnloadedAction);
                ArticleGridControlPropertyChangedCommand = new DelegateCommand<object>(ArticleGridControlPropertyChangedCommandAction);
                DetectionGridControlPropertyChangedCommand = new DelegateCommand<object>(DetectionGridControlPropertyChangedCommandAction);
                ChangeNameFromItemCommand = new DelegateCommand<object>(ChangeNameFromItemCommandAction);

                PasteInSearchControlCommand = new DelegateCommand<object>(PasteInSearchControlCommandAction);

                ArticleDetectionNameValueChangedCommand = new DelegateCommand<object>(ArticleDetectionNameValueChangedCommandAction);
                SaveButtonCommand = new DelegateCommand(SaveButtonCommandAction);
                ChangeStatusCommand = new DelegateCommand<object>(ChangeStatusCommandAction);
                ChangeEffectiveDateCommand = new DelegateCommand(ChangeEffectiveDateCommandAction);
                ChangeExpiryDateCommand = new DelegateCommand(ChangeExpiryDateCommandAction);
                ChangeCheckAllLanguagesCommand = new DelegateCommand(ChangeCheckAllLanguagesCommandAction);

                SelectionChangedArticleDetectionGridCommand = new DelegateCommand<object>(SelectionChangedArticleDetectionGridCommandAction);
                EditArticleCommand = new RelayCommand(new Action<object>(EditArticleAction));
                DetectionsDoubleClickCommand = new RelayCommand(new Action<object>(EditDetectionItem));
                AddFileCommand = new DelegateCommand<object>(AddFile);
                EditFileCommand = new DelegateCommand<object>(EditFile);
                OpenPDFDocumentCommand = new RelayCommand(new Action<object>(OpenPDFDocument));
                DeleteFileCommand = new DelegateCommand<object>(DeleteAttachmentFile);
                if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }

                if (GeosApplication.Instance.UserSettings != null && GeosApplication.Instance.UserSettings.ContainsKey("PLM_Appearance"))
                {
                    if (string.IsNullOrEmpty(GeosApplication.Instance.UserSettings["PLM_Appearance"].ToString()))
                    {
                        SelectedAppearanceItem = (MaximizedElementPosition)Enum.Parse(typeof(MaximizedElementPosition), "Right", true);
                    }
                    else
                    {
                        SelectedAppearanceItem = (MaximizedElementPosition)Enum.Parse(typeof(MaximizedElementPosition), GeosApplication.Instance.UserSettings["PLM_Appearance"].ToString(), true);
                    }
                }
                else
                {
                    SelectedAppearanceItem = (MaximizedElementPosition)Enum.Parse(typeof(MaximizedElementPosition), "Right", true);
                }
                IsCalculateArticleCostButtonEnabled = false;
                IsCalculated = true;
                SaveButtonVisibility = Visibility.Visible;
                // shubham[skadam] GEOS2-3272 Custom filters in the BPL and CPL grid [#PLM39] 01 12 2022
                try
                {
                    FilterEditorCreatedCommand = new DelegateCommand<FilterEditorEventArgs>(FilterEditorCreatedCommandAction);
                    CommandShowFilterPopupClick = new DelegateCommand<FilterPopupEventArgs>(CustomShowFilterPopup);
                    CommandFilterStatusTileClick = new DelegateCommand<object>(CommandFilterStatusTileClickAction);
                    CommandTileBarClickDoubleClick = new DelegateCommand<object>(CommandTileBarClickDoubleClickAction);
                    DetectionFilterEditorCreatedCommand = new DelegateCommand<FilterEditorEventArgs>(DetectionFilterEditorCreatedCommandAction);
                    DetectionCommandShowFilterPopupClick = new DelegateCommand<FilterPopupEventArgs>(DetectionCustomShowFilterPopup);
                    DetectionCommandFilterStatusTileClick = new DelegateCommand<object>(DetectionCommandFilterStatusTileClickAction);
                    DetectionCommandTileBarClickDoubleClick = new DelegateCommand<object>(DetectionCommandTileBarClickDoubleClickAction);
                }
                catch (Exception ex)
                {
                }

                try
                {
                    ModuleVisibleCustomerCommand = new DelegateCommand<object>(ModuleVisibleCustomerCommandAction);
                    RuleValueChangedModuleCommand = new DelegateCommand<object>(RuleValueChangedModuleCommandAction);
                    ModuleDescriptionLinkedCommand = new DelegateCommand<object>(ModuleDescriptionLinkedCommandAction);
                    ModuleGridControlLoadedCommand = new DelegateCommand<object>(ModuleGridControlLoadedAction);
                    ModuleGridControlUnloadedCommand = new DelegateCommand<object>(ModuleGridControlUnloadedAction);
                    DeleteModuleCommand = new DelegateCommand<object>(DeleteModuleCommandAction);
                    ModulesDoubleClickCommand = new RelayCommand(new Action<object>(EditModuleAction));
                }
                catch (Exception ex)
                {
                }

                //Shubham[skadam] GEOS2-4424 Need to add "Add ALL" button in module tab in BPL. 29 08 2023
                //Shubham[skadam] GEOS2-4784 Need to add custom filter option in module same as article/detection. 29 08 2023
                //Shubham[skadam] GEOS2-4785 No additional data so remove [0] this in tree menu in article, detection & module  left tree in BPL menu 29 08 2023
                //Shubham[skadam] GEOS2-4786 (JLR) The exported XLS Price List (BPL and CPL) must have the sheet with the modules. 29 08 2023
                //Shubham[skadam] GEOS2-4424 Some changes in  Module tab in BPL (3/3) 28 08 2023
                try
                {
                    ModuleFilterEditorCreatedCommand = new DelegateCommand<FilterEditorEventArgs>(ModuleFilterEditorCreatedCommandAction);
                    ModuleCommandShowFilterPopupClick = new DelegateCommand<FilterPopupEventArgs>(ModuleCustomShowFilterPopup);
                    ModuleCommandFilterStatusTileClick = new DelegateCommand<object>(ModuleCommandFilterStatusTileClickAction);
                    ModuleCommandTileBarClickDoubleClick = new DelegateCommand<object>(ModuleCommandTileBarClickDoubleClickAction);
                }
                catch (Exception ex)
                {

                }
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }

                GeosApplication.Instance.Logger.Log("Constructor AddEditCustomerPriceViewModel() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log(string.Format("Error in Constructor AddEditCustomerPriceViewModel() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }






        #endregion

        #region Methods

        /// <summary>
        /// Init Method is used for ti Initialize the CustomerPrice Window
        /// </summary>
        /// [001] [vsana][11-12-2020][GEOS2-2561][Assign the customer group/region/Country/plant to the Customer Price List [#PLM26]]
        /// <param name="selectedHeader"></param>
        public void Init(string selectedHeader)
        {
            MaximizedElementPosition = PLMCommon.Instance.SetMaximizedElementPosition();
            ExportPriceListButtonVisibility = Visibility.Hidden;
            SaveMyPreference();            
            FillLanguages();
            GetCurrencies();
            GetLatestCustomerPriceCode();
            FillStatusList();
            GetBasePriceNames();
            IsExportVisible = Visibility.Collapsed;
            SelectedCustomersList = new ObservableCollection<CPLCustomer>();
            FillLogicList();
            CPLCustomerList = new List<CPLCustomer>();
            GetCPLCustomerAll();            
            FillCurrencyConversionList_All();
            IsEnabledAcceptButton = true;
            CommentsList = new ObservableCollection<CustomerPriceLogEntry>();
        }
		//[nsatpute][28.05.2025][GEOS2-6689]
        public void InitAsync(string selectedHeader)
        {
            MaximizedElementPosition = PLMCommon.Instance.SetMaximizedElementPosition();
            ExportPriceListButtonVisibility = Visibility.Hidden;
            IsExportVisible = Visibility.Collapsed;
            SelectedCustomersList = new ObservableCollection<CPLCustomer>();
            CPLCustomerList = new List<CPLCustomer>();
            IsEnabledAcceptButton = true;
            CommentsList = new ObservableCollection<CustomerPriceLogEntry>();
            var tasks = new List<Task>
        {
            Task.Run(() => SaveMyPreference()),  
            Task.Run(() => FillLanguages()),
            Task.Run(() => GetCurrencies()),
            Task.Run(() => GetLatestCustomerPriceCode()),
            Task.Run(() => FillStatusList()),
            Task.Run(() => GetBasePriceNames()),
            Task.Run(() => FillLogicList()),
            Task.Run(() => GetCPLCustomerAll()),
            Task.Run(() => FillCurrencyConversionList_All())  
        };

            Task.WaitAll(tasks.ToArray());
        }

        /// <summary>
        /// EditInit Method is used for to Initialize the EditCustomerPrice Window
        /// </summary>
        /// [001] [vsana][11-12-2020][GEOS2-2561][Assign the customer group/region/Country/plant to the Customer Price List [#PLM26]]
        /// <param name="selectedHeader"></param>
        public void EditInit(string selectedHeader)
        {
            try
            {
                GeosApplication.Instance.Logger.Log(string.Format("Method EditInit..."), category: Category.Info, priority: Priority.Low);
                MaximizedElementPosition = PLMCommon.Instance.SetMaximizedElementPosition();

                FillLanguages();
                GetCurrencies();
                GetLatestCustomerPriceCode();
                FillStatusList();
                GetBasePriceNames();

                FillLogicList();
                GetCPLCustomerAll();
                //FillArticleCostPriceList();
                //FillCurrencyConversionList_All();
                try
                {
                    //Shubham[skadam] GEOS2-2885 [Only Modules ] - Search the Article categories (and sub-categories), Modules and Detection (DOWS) in BPL [3/3][#PLM09]  15 03 2023
                    //FillModuleMenuList();
                    //AddColumnsToModuleDataTable();
                }
                catch (Exception ex)
                {
                }
                GeosApplication.Instance.Logger.Log(string.Format("Method EditInit()....executed successfully"), category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method EditInit() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method EditInit() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method EditInit() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
		//[nsatpute][28.05.2025][GEOS2-6689]
		public void EditInitAsync(string selectedHeader)
        {
            try
            {
                GeosApplication.Instance.Logger.Log(string.Format("Method EditInitAsync..."), category: Category.Info, priority: Priority.Low);
                MaximizedElementPosition = PLMCommon.Instance.SetMaximizedElementPosition();

                var tasks = new List<Task>
                {                    
                    Task.Run(() => FillLanguages()),
                    Task.Run(() => GetCurrencies()),
                    Task.Run(() => GetLatestCustomerPriceCode()),
                    Task.Run(() => FillStatusList()),
                    Task.Run(() => GetBasePriceNames()),
                    Task.Run(() => FillLogicList()),
                    Task.Run(() => GetCPLCustomerAll())
                };
                Task.WaitAll(tasks.ToArray());

                GeosApplication.Instance.Logger.Log(string.Format("Method EditInitAsync()....executed successfully"), category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method EditInitAsync() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method EditInitAsync() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method EditInitAsync() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
		//[nsatpute][11.06.2025][GEOS2-6689]
        public void LoadBasePriceData(CustomerPrice selectedCustomerPrice)
        {
            try
            {
                GeosApplication.Instance.Logger.Log(string.Format("Method LoadBasePriceData..."), category: Category.Info, priority: Priority.Low);
                initialBasePrice = PLMService.GetBasePriceDetailById_ForCPL_V2650(selectedCustomerPrice.IdBasePriceList);                
                GeosApplication.Instance.Logger.Log(string.Format("Method LoadBasePriceData()....executed successfully"), category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method LoadBasePriceData() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method LoadBasePriceData() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method LoadBasePriceData() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        //[001][cpatil][GEOS2-3564][23-02-2022]
        private void EditArticleAction(object obj)
        {
            try
            {
                if (GeosApplication.Instance.ActiveUser.UserPermissions.Any(p => p.IdPermission == 33))
                {
                    GeosApplication.Instance.Logger.Log(string.Format("Method EditArticleAction()..."), category: Category.Info, priority: Priority.Low);



                    if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<Views.SplashScreenView>(); }

                    TableView detailView = (TableView)obj;
                    GridControl gridControl = (detailView).Grid;


                    UInt32 idArticle = Convert.ToUInt32(((System.Data.DataRowView)detailView.DataControl.CurrentItem).Row.ItemArray[7]);
                    Emdep.Geos.Modules.PCM.Views.EditPCMArticleView editPCMArticleView = new Emdep.Geos.Modules.PCM.Views.EditPCMArticleView();
                    Emdep.Geos.Modules.PCM.ViewModels.EditPCMArticleViewModel editPCMArticleViewModel = new Emdep.Geos.Modules.PCM.ViewModels.EditPCMArticleViewModel();
                    EventHandler handle = delegate { editPCMArticleView.Close(); };
                    editPCMArticleViewModel.RequestClose += handle;
                    editPCMArticleViewModel.IsNew = false;
                    bool status = IsArticleColumnChooserVisible;
                    IsArticleColumnChooserVisible = false;
                    if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<Views.SplashScreenView>(); }
                    editPCMArticleViewModel.PLMEditInit(idArticle);
                    editPCMArticleView.DataContext = editPCMArticleViewModel;
                    var ownerInfo = (detailView as FrameworkElement);
                    editPCMArticleView.Owner = Window.GetWindow(ownerInfo);
                    if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                    editPCMArticleView.ShowDialog();

                    if (editPCMArticleViewModel.IsSave == true)
                    {
                        ArticleGridValueUpdated(idArticle, editPCMArticleViewModel);
                    }

                    if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }


                    GeosApplication.Instance.Logger.Log(string.Format("Method EditArticleAction()....executed successfully"), category: Category.Info, priority: Priority.Low);
                }
                else
                {
                    CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("PLMEditArticleInformation").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                }
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log(string.Format("Error in method EditArticleAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        //[001][cpatil][GEOS2-3564][23-02-2022]
        private void EditDetectionItem(object obj)
        {
            try
            {
                if (GeosApplication.Instance.ActiveUser.UserPermissions.Any(p => p.IdPermission == 33))
                {
                    GeosApplication.Instance.Logger.Log("Method EditDetectionItem()...", category: Category.Info, priority: Priority.Low);

                    if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }


                    if (obj == null) return;

                    DetectionDetails detections = null;

                    if (obj is TableView)
                    {
                        TableView detailView = (TableView)obj;

                        UInt32 idDetection = Convert.ToUInt32(((System.Data.DataRowView)detailView.DataControl.CurrentItem).Row.ItemArray[7]);
                        string detectionTypeName = Convert.ToString(((System.Data.DataRowView)detailView.DataControl.CurrentItem).Row.ItemArray[3]);
                        UInt32 idDetectionType = 0;
                        if (LstDetectionType == null)
                        {
                            LstDetectionType = new List<DetectionTypes>();

                            LstDetectionType = PCMService.GetAllDetectionTypes();
                        }

                        if (LstDetectionType.Any(dml => dml.Name == detectionTypeName))
                        {
                            idDetectionType = LstDetectionType.Where(dml => dml.Name == detectionTypeName).FirstOrDefault().IdDetectionType;
                        }

                        if (idDetection > 0)
                        {
                            bool status = IsDetectionColumnChooserVisible;
                            IsDetectionColumnChooserVisible = false;

                            if (idDetectionType == 2 || idDetectionType == 3)
                            {
                                Emdep.Geos.Modules.PCM.Views.EditDetectionView addEditOptionsDetectionsView = new Emdep.Geos.Modules.PCM.Views.EditDetectionView();
                                Emdep.Geos.Modules.PCM.ViewModels.EditDetectionViewModel addEditOptionsDetectionsViewModel = new Emdep.Geos.Modules.PCM.ViewModels.EditDetectionViewModel();
                                EventHandler handle = delegate { addEditOptionsDetectionsView.Close(); };
                                addEditOptionsDetectionsViewModel.RequestClose += handle;

                                addEditOptionsDetectionsViewModel.IsNew = false;
                                addEditOptionsDetectionsViewModel.IsSelectedTestReadOnly = true;
                                addEditOptionsDetectionsViewModel.IsStackPanelVisible = Visibility.Visible;

                                if (idDetectionType == 2)
                                {
                                    addEditOptionsDetectionsViewModel.WindowHeader = System.Windows.Application.Current.FindResource("EditDetectionHeader").ToString();
                                    addEditOptionsDetectionsViewModel.EditInit(System.Windows.Application.Current.FindResource("CaptionDetections").ToString());
                                    addEditOptionsDetectionsViewModel.PLMEditInitDetections(idDetection);

                                }
                                else if (idDetectionType == 3)
                                {
                                    addEditOptionsDetectionsViewModel.WindowHeader = System.Windows.Application.Current.FindResource("EditOptionHeader").ToString();
                                    addEditOptionsDetectionsViewModel.EditInit(System.Windows.Application.Current.FindResource("CaptionOptions").ToString());
                                    addEditOptionsDetectionsViewModel.PLMEditInitDetections(idDetection);

                                }
                                addEditOptionsDetectionsView.DataContext = addEditOptionsDetectionsViewModel;
                                var ownerInfo = (detailView as FrameworkElement);
                                addEditOptionsDetectionsView.Owner = Window.GetWindow(ownerInfo);
                                addEditOptionsDetectionsView.ShowDialog();
                                if (addEditOptionsDetectionsViewModel.IsWaySave == true || addEditOptionsDetectionsViewModel.IsSparepartSave || addEditOptionsDetectionsViewModel.IsOptionSave || addEditOptionsDetectionsViewModel.IsDetectionSave)
                                {
                                    DetectionGridValueUpdated(idDetection, addEditOptionsDetectionsViewModel);
                                }


                            }

                            else if (idDetectionType == 1 || idDetectionType == 4)
                            {
                                Emdep.Geos.Modules.PCM.Views.EditDetectionView addOptionWayDetectionSparePartView = new Emdep.Geos.Modules.PCM.Views.EditDetectionView();
                                Emdep.Geos.Modules.PCM.ViewModels.EditDetectionViewModel addOptionWayDetectionSparePartViewModel = new Emdep.Geos.Modules.PCM.ViewModels.EditDetectionViewModel();
                                EventHandler handleWaysSparePart = delegate { addOptionWayDetectionSparePartView.Close(); };
                                addOptionWayDetectionSparePartViewModel.RequestClose += handleWaysSparePart;

                                addOptionWayDetectionSparePartViewModel.IsNew = false;
                                //addOptionWayDetectionSparePartViewModel.IsStackPanelVisible = Visibility.Hidden;
                                addOptionWayDetectionSparePartViewModel.IsSelectedTestReadOnly = true;


                                if (idDetectionType == 1)
                                {
                                    addOptionWayDetectionSparePartViewModel.IsStackPanelVisible = Visibility.Hidden;
                                    addOptionWayDetectionSparePartViewModel.WindowHeader = System.Windows.Application.Current.FindResource("EditWayHeader").ToString();
                                    addOptionWayDetectionSparePartViewModel.EditInit(System.Windows.Application.Current.FindResource("CaptionWay").ToString());
                                    addOptionWayDetectionSparePartViewModel.PLMEditInitWaysAndSparepart(idDetection);

                                }

                                else if (idDetectionType == 4)
                                {
                                    addOptionWayDetectionSparePartViewModel.IsStackPanelVisible = Visibility.Visible;
                                    addOptionWayDetectionSparePartViewModel.WindowHeader = System.Windows.Application.Current.FindResource("EditSparePartHeader").ToString();
                                    addOptionWayDetectionSparePartViewModel.EditInit(System.Windows.Application.Current.FindResource("CaptionSpareParts").ToString());
                                    addOptionWayDetectionSparePartViewModel.PLMEditInitWaysAndSparepart(idDetection);
                                }

                                addOptionWayDetectionSparePartView.DataContext = addOptionWayDetectionSparePartViewModel;
                                var ownerInfo = (detailView as FrameworkElement);
                                addOptionWayDetectionSparePartView.Owner = Window.GetWindow(ownerInfo);
                                addOptionWayDetectionSparePartView.ShowDialog();
                                if (addOptionWayDetectionSparePartViewModel.IsSparepartSave == true || addOptionWayDetectionSparePartViewModel.IsWaySave == true || addOptionWayDetectionSparePartViewModel.IsOptionSave == true || addOptionWayDetectionSparePartViewModel.IsDetectionSave == true)
                                {
                                    DetectionGridValueUpdated(idDetection, addOptionWayDetectionSparePartViewModel);
                                }
                            }



                        }
                    }

                    if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                    GeosApplication.Instance.Logger.Log("Method EditDetectionItem()....executed successfully", category: Category.Info, priority: Priority.Low);
                }
                else
                {
                    CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("PLMEditArticleInformation").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                }
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method EditDetectionItem()..", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
		//[nsatpute][28.05.2025][GEOS2-6689]
        public void FillArticleCostPriceList(byte idCurrency)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillArticleCostPriceList ...", category: Category.Info, priority: Priority.Low);
                //PLMService = new PLMServiceController("localhost:6699");
                ArticleCostPriceList = new List<ArticleCostPrice>(PLMService.GetArticleCostPricesByCurrency_V2650(idCurrency));
                GeosApplication.Instance.Logger.Log("Method FillArticleCostPriceList() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in FillArticleCostPriceList() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), "Red", CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in FillArticleCostPriceList() Method - ServiceUnexceptedException " + ex.Message, category: Category.Info, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillArticleCostPriceList() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        /// <summary>
        /// EditInitCustomerPrice method is used for intialize for EditCustomerPrice Window
        /// </summary>
        /// [001] [vsana][11-12-2020][GEOS2-2561][Assign the customer group/region/Country/plant to the Customer Price List [#PLM26]]
        /// <param name="tempCustomerPrice"></param>
        public void EditInitCustomerPrice(CustomerPrice tempCustomerPrice)
        {
            try
            {
                
                GeosApplication.Instance.Logger.Log(string.Format("Method EditInitCustomerPrice..."), category: Category.Info, priority: Priority.Low);
                ExportPriceListButtonVisibility = Visibility.Visible;
                //IsDuplicateCustomerPriceButtonVisible = Visibility.Hidden;
                if (tempCustomerPrice.IdPermission == "62")
                {
                    IsUserPermission = true;
                    if (GeosApplication.Instance.IsPLMPermissionChange == true)
                        // IsEnabledAcceptButton = true;
                        IsEnabledAcceptButton = IsDuplicateCustomerPriceButtonEnabled = true;//[Sudhir.Jangra][Geos2-3349][27/12/2022]
                }
                else if (tempCustomerPrice.IdPermission == "50")
                {
                    IsUserPermission = false;
                    if (GeosApplication.Instance.IsPLMPermissionChange == false)
                        // IsEnabledAcceptButton = false;
                        IsEnabledAcceptButton = IsDuplicateCustomerPriceButtonEnabled = false;//[Sudhir.jangra][GEOS2-3349][27/12/2022]
                }

                CPLCustomerList = new List<CPLCustomer>();

                //CustomerPrice temp = (PLMService.GetCustomerPricesById_V2160(tempCustomerPrice.IdCustomerPriceList));
                //CustomerPrice temp = (PLMService.GetCustomerPricesById_V2340(tempCustomerPrice.IdCustomerPriceList));
                //Shubham[skadam] GEOS2-3180 [Only Modules ] - SRN 2_5_8 Window in PCM to manage the  BPL/CPL price for Articles, Modules and DOWS [8 / 8] - Modules (Menu box, Grid and Change Log) 26 04 2023
                //CustomerPrice temp = (PLMService.GetCustomerPricesById_V2380(tempCustomerPrice.IdCustomerPriceList));

                //[Sudhir.Jangra][GEOS2-4935]
                //PLMService = new PLMServiceController("localhost:6699");
				//[nsatpute][28.05.2025][GEOS2-6689]
                CustomerPrice temp = (PLMService.GetCustomerPricesById_V2650(tempCustomerPrice.IdCustomerPriceList));

                CommentsList = new ObservableCollection<CustomerPriceLogEntry>(temp.CustomerPriceCommentsList.OrderByDescending(x => x.Datetime));
                if (CommentsList?.Count > 0)
                {
                    CommentText = CommentsList.FirstOrDefault().Comments;
                    CommentDateTimeText = CommentsList.FirstOrDefault().Datetime;
                    CommentFullNameText = CommentsList.FirstOrDefault().UserName;

                    //CommentText = CommentsList[CommentsList.Count - 1].Comments;
                    //CommentDateTimeText = CommentsList[CommentsList.Count - 1].Datetime;
                    //CommentFullNameText = CommentsList[CommentsList.Count - 1].UserName;
                }
                else
                {
                    CommentText = string.Empty; // or some default value if there are no comments
                    CommentDateTimeText = null;
                    CommentFullNameText = string.Empty;
                }

                SetUserProfileImage(CommentsList);



                OptionWayDetectionSparePartFilesList = new ObservableCollection<CPLDocument>(temp.PLMCustomerAttachmentList);
                FourOptionWayDetectionSparePartFilesList = new ObservableCollection<CPLDocument>(temp.PLMCustomerAttachmentList);
                if (temp.LogList != null)
                    ChangeLogList = new List<CustomerPriceLogEntry>(temp.LogList);

                if (temp.CustomerList != null)
                    CPLCustomerList = new List<CPLCustomer>(temp.CustomerList);

                List<CPLCustomer> IsCheckedList = CPLCustomerList.ToList();
                
                Group = (from x in IsCheckedList select x.GroupName).Distinct().Count();
                Region = (from x in IsCheckedList select x.RegionName).Distinct().Count();
                Country = (from x in IsCheckedList select x.Country.Name).Distinct().Count();
                Plant = (from x in IsCheckedList select x.Plant.Name).Distinct().Count();

                Groups = String.Join(", ", IsCheckedList.Select(a => a.GroupName).Distinct());
                Regions = String.Join(", ", IsCheckedList.Select(a => a.RegionName).Distinct());
                Countries = String.Join(", ", IsCheckedList.Select(a => a.Country.Name).Distinct());
                Plants = String.Join(", ", IsCheckedList.Select(a => a.Plant.Name).Distinct());

                IdCustomerPriceList = tempCustomerPrice.IdCustomerPriceList;
                ClonedCustomerPrice = (CustomerPrice)temp.Clone();

                if (ClonedCustomerPrice.IdStatus == 224)
                    InActiveStatus = true;
                else
                    InActiveStatus = false;

                SelectedCustomerPriceCode = temp.Code;
                Reference = SelectedCustomerPriceCode;
                //change for duplicate bpl
                SelectedBasePriceName = BasePriceNameList.FirstOrDefault(a => a.IdBasePriceList == temp.IdBasePriceList);
                
                SelectedBasePriceName_Copy = SelectedBasePriceName;

                Description = temp.Description;
                oldDescription = string.IsNullOrEmpty(Description) ? "" : Description;
                Description_en = temp.Description;
                Description_es = temp.Description_es;
                Description_fr = temp.Description_fr;
                Description_pt = temp.Description_pt;
                Description_ro = temp.Description_ro;
                Description_ru = temp.Description_ru;
                Description_zh = temp.Description_zh;

                Name = temp.Name;
                oldName = string.IsNullOrEmpty(Name) ? "" : Name;
                Name_en = temp.Name;
                Name_es = temp.Name_es;
                Name_fr = temp.Name_fr;
                Name_pt = temp.Name_pt;
                Name_ro = temp.Name_ro;
                Name_ru = temp.Name_ru;
                Name_zh = temp.Name_zh;

                Remark = temp.Remark;
                oldRemark = string.IsNullOrEmpty(Remark) ? "" : Remark;
                Remark_en = temp.Remark;
                Remark_es = temp.Remark_es;
                Remark_fr = temp.Remark_fr;
                Remark_pt = temp.Remark_pt;
                Remark_ro = temp.Remark_ro;
                Remark_ru = temp.Remark_ru;
                Remark_zh = temp.Remark_zh;

                IdCurrency = temp.IdCurrency;
                CurrencyName = temp.Currency.Name;

                temp.Currency.CurrencyIconImage = ByteArrayToBitmapImage(temp.Currency.CurrencyIconbytes);
                CurrencyIcon = temp.Currency.CurrencyIconImage;

                CreationDate = temp.CreationDate;
                if (temp.ExpiryDate != DateTime.MinValue)
                {
                    ExpiryDate = temp.ExpiryDate;
                }
                if (temp.EffectiveDate != DateTime.MinValue)
                {
                    EffectiveDate = temp.EffectiveDate;
                }
                if (temp.LastUpdated != DateTime.MinValue)
                {
                    LastUpdated = temp.LastUpdated;
                }
                LastUpdated = Emdep.Geos.UI.Common.GeosApplication.Instance.ServerDateTime.Date.Date;

                //SaleCurrency	
                SelectedArticle = new PCMArticleCategory();

                if (CurrencyList != null)
                {
                    SelectedCurrency = CurrencyList.FirstOrDefault(x => x.IdCurrency == temp.IdCurrency);
                    SelectedCurrency_Copy = SelectedCurrency;
                }

                if (StatusList != null)
                    SelectedStatus = StatusList.FirstOrDefault(x => x.IdLookupValue == temp.IdStatus);
                SelectedOriginalStatus = SelectedStatus;//[Sudhir.Jangra][GEOS2-3349][27/12/2022]
                if (Name_en == Name_es && Name_en == Name_fr && Name_en == Name_pt && Name_en == Name_ro && Name_en == Name_ru && Name_en == Name_zh)
                {
                    IsCopyName = true;
                }
                if (Description_en == Description_es && Description_en == Description_fr && Description_en == Description_pt && Description_en == Description_ro && Description_en == Description_ru && Description_en == Description_zh)
                {
                    IsCopyDescription = true;
                }

                if (Remark_en == Remark_es && Remark_en == Remark_fr && Remark_en == Remark_pt && Remark_en == Remark_ro && Remark_en == Remark_ru && Remark_en == Remark_zh)
                {
                    IsCopyRemark = true;
                }

                if (IsCopyName == true && IsCopyDescription == true && IsCopyRemark == true)
                {
                    IsCheckedAllLanguages = true;
                }
                else
                {
                    IsCheckedAllLanguages = false;
                }
                oldIsCheckedAllLanguages = IsCheckedAllLanguages;

                //SelectedPlant = new List<object>();
                //foreach (Site plant in temp.PlantList)
                //{
                //    SelectedPlant.Add(plant);
                //}

                //SelectedPlant = new List<object>(SelectedPlant);
                //SelectedPlant_Copy = new List<object>(SelectedPlant);

                //SelectedSaleCurrency = new List<object>();
                //foreach (byte IdCurrency in temp.CurrencyList.Select(a => a.IdCurrency).Distinct())
                //{
                //    SelectedSaleCurrency.Add(temp.CurrencyList.FirstOrDefault(a => a.IdCurrency == IdCurrency));
                //}
                //SelectedSaleCurrency = new List<object>(SelectedSaleCurrency);
                //SelectedSaleCurrency_Copy = new List<object>(SelectedSaleCurrency);

                //AddColumnsToArticleDataTable();
                //AddColumnsToDetectionDataTable();
                //   Attachment
                OptionWayDetectionSparePartFilesList = new ObservableCollection<CPLDocument>(temp.PLMCustomerAttachmentList);
                OptionWayDetectionSparePartFilesList = new ObservableCollection<CPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn));
                if (OptionWayDetectionSparePartFilesList.Count > 0)
                    SelectedOptionWayDetectionSparePartFile = OptionWayDetectionSparePartFilesList.FirstOrDefault();
                if (GeosApplication.Instance.PCMAttachment != null)//[Sudhir.Jangra][Geos2-1960][06/03/2023]
                {
                    if (GeosApplication.Instance.PCMAttachment != "4" && GeosApplication.Instance.PCMAttachment != "3"
                        && GeosApplication.Instance.PCMAttachment != "2" && GeosApplication.Instance.PCMAttachment != "1")
                    {
                        if (OptionWayDetectionSparePartFilesList.Count()>=5)
                        {
                            IsAttachmentScrollVisible = "Visible";
                        }
                        else
                        {
                            IsAttachmentScrollVisible = "Disabled";
                        }
                    }
                    else
                    {
                        IsAttachmentScrollVisible = "Disabled";
                    }
                    if (GeosApplication.Instance.PCMAttachment == "1")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<CPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(1).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "2")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<CPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(2).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "3")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<CPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(3).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "4")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<CPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(4).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "5")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<CPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(5).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "6")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<CPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(6).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "7")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<CPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(7).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "8")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<CPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(8).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "9")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<CPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(9).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "10")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<CPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(10).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "11")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<CPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(11).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "12")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<CPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(12).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "13")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<CPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(13).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "14")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<CPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(14).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "15")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<CPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(15).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "16")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<CPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(16).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "17")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<CPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(17).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "18")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<CPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(18).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "19")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<CPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(19).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "20")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<CPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).Take(20).ToList());
                    }
                    else if (GeosApplication.Instance.PCMAttachment == "All")
                    {
                        FourOptionWayDetectionSparePartFilesList = new ObservableCollection<CPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.ModifiedIn).ToList());
                    }
                }
                try
                {
                    //FillFilterTileBar();
                    AddCustomSetting();
                    //DetectionFillFilterTileBar();
                    DetectionAddCustomSetting();
                    //AddColumnsToModuleDataTable();
                    ModuleAddCustomSetting();
                }
                catch (Exception ex)
                {
                }
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }

                GeosApplication.Instance.Logger.Log(string.Format("Method EditInitCustomerPrice()....executed successfully"), category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in EditInitCustomerPrice() Method " + ex.Detail.ErrorMessage, category: Category.Info, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in EditInitCustomerPrice() Method - ServiceUnexceptedException " + ex.Message, category: Category.Info, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method EditInitCustomerPrice()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }

        }
		//[nsatpute][28.05.2025][GEOS2-6689]
        private void GetBasePriceNames()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method GetBasePriceNames()...", category: Category.Info, priority: Priority.Low);
                IPLMService PLMServiceLocalThread = new PLMServiceController(GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString());
                BasePriceNameList = new ObservableCollection<BasePrice>(PLMServiceLocalThread.GetBasePriceNames());
                BasePriceNameList.Insert(0, new BasePrice() { Name = "---", IdBasePriceList = 0 });
                SelectedBasePriceName = BasePriceNameList.FirstOrDefault();
                SelectedBasePriceName_Copy = SelectedBasePriceName;
                GeosApplication.Instance.Logger.Log("Method GetBasePriceNames()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (FaultException<ServiceException> ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in GetBasePriceNames() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in GetBasePriceNames() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method GetBasePriceNames() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        public void SaveMyPreference()
        {
            //Appearance

            List<Tuple<string, string>> userConfigurations = new List<Tuple<string, string>>();

            if (GeosApplication.Instance.UserSettings != null && GeosApplication.Instance.UserSettings.ContainsKey("PLM_Appearance"))
            {
                GeosApplication.Instance.UserSettings["PLM_Appearance"] = SelectedAppearanceItem.ToString();
            }

            foreach (KeyValuePair<string, string> setting in GeosApplication.Instance.UserSettings)
            {
                userConfigurations.Add(new Tuple<string, string>(setting.Key.ToString(), setting.Value.ToString()));
            }

            ApplicationOperation.CreateNewSetting(userConfigurations, GeosApplication.Instance.UserSettingFilePath, "UserSettings");
            GeosApplication.Instance.SelectedPrinter = Convert.ToString(GeosApplication.Instance.UserSettings["SelectedPrinter"]);
            GeosApplication.Instance.LabelPrinter = Convert.ToString(GeosApplication.Instance.UserSettings["LabelPrinter"]);
            GeosApplication.Instance.LabelPrinterModel = Convert.ToString(GeosApplication.Instance.UserSettings["LabelPrinterModel"]);
            GeosApplication.Instance.ParallelPort = Convert.ToString(GeosApplication.Instance.UserSettings["ParallelPort"]);

            PLMCommon.Instance.PLM_Appearance = SelectedAppearanceItem.ToString();
        }
		//[nsatpute][28.05.2025][GEOS2-6689]
        public void FillLanguages()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillLanguages()...", category: Category.Info, priority: Priority.Low);
                IPLMService PLMServiceLocalThread = new PLMServiceController(GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString());
                Languages = new ObservableCollection<Language>(PLMServiceLocalThread.GetLanguages());
                LanguageSelected = Languages.FirstOrDefault();

                GeosApplication.Instance.Logger.Log("Method FillLanguages()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (FaultException<ServiceException> ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillLanguages() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillLanguages() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method FillLanguages() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
		//[nsatpute][28.05.2025][GEOS2-6689]
        private void GetCurrencies()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method GetCurrencies()...", category: Category.Info, priority: Priority.Low);
                IPLMService PLMServiceLocalThread = new PLMServiceController(GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString());
                CurrencyList = new ObservableCollection<Currency>(PLMServiceLocalThread.GetCurrencies_V2160());
                if (CurrencyList != null)
                {
                    foreach (var bpItem in CurrencyList.GroupBy(tpa => tpa.Name))
                    {
                        ImageSource currencyFlagImage = ByteArrayToBitmapImage(bpItem.ToList().FirstOrDefault().CurrencyIconbytes);
                        bpItem.ToList().Where(oti => oti.Name == bpItem.Key).ToList().ForEach(oti => oti.CurrencyIconImage = currencyFlagImage);
                    }
                }
                SelectedCurrency = CurrencyList.FirstOrDefault();
                SelectedCurrency_Copy = SelectedCurrency;

                if (string.IsNullOrEmpty(CurrencyName))
                {
                    CurrencyName = "---";
                    CurrencyIcon = null;
                    SelectedCurrency = null;
                    SelectedCurrency_Copy = SelectedCurrency;
                }
                GeosApplication.Instance.Logger.Log("Method GetCurrencies()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in GetCurrencies() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in GetCurrencies() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method GetCurrencies() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
		//[nsatpute][28.05.2025][GEOS2-6689]
        private void GetLatestCustomerPriceCode()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method GetLatestCustomerPriceCode()...", category: Category.Info, priority: Priority.Low);
                IPLMService PLMServiceLocalThread = new PLMServiceController(GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString());
                if (!isDuplicateClicked)//[Sudhir.Jangra][GEOS2-3349][27/12/2022]
                {
                    SelectedCustomerPriceCode = PLMServiceLocalThread.GetLatestCustomerPriceCode();
                }
                else
                {
                    DuplicateCode = PLMServiceLocalThread.GetLatestCustomerPriceCode();
                }

                GeosApplication.Instance.Logger.Log("Method GetLatestCustomerPriceCode()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (FaultException<ServiceException> ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in GetLatestCustomerPriceCode() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in GetLatestCustomerPriceCode() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method GetLatestCustomerPriceCode() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
		//[nsatpute][28.05.2025][GEOS2-6689]
        private void FillStatusList()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillStatusList()...", category: Category.Info, priority: Priority.Low);
                IPCMService PCMServiceLocalThread = new PCMServiceController(GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString());
                IList<LookupValue> tempStatusList = PCMServiceLocalThread.GetLookupValues(45);
                StatusList = new List<LookupValue>();
                StatusList = new List<LookupValue>(tempStatusList);
                SelectedStatus = StatusList.FirstOrDefault(x => x.IdLookupValue == 225);
                SelectedStatusIndex = StatusList.FindIndex(x => x.IdLookupValue == 225);

                GeosApplication.Instance.Logger.Log("Method FillStatusList()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillStatusList() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillStatusList() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method FillStatusList() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void CloseWindow(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method CloseWindow()...", category: Category.Info, priority: Priority.Low);
                if (IsEnabledSaveButton && SaveButtonVisibility == Visibility.Visible)
                {
                    MessageBoxResult MessageBoxResult = MessageBoxResult = CustomMessageBox.Show(string.Format(Application.Current.Resources["ArticleGridUpdateWarning"].ToString()), "Yellow", CustomMessageBox.MessageImagePath.Warning, MessageBoxButton.YesNo);
                    if (MessageBoxResult == MessageBoxResult.Yes)
                    {
                        AcceptButtonCommandAction(null);
                    }
                }
                RequestClose(null, null);

                GeosApplication.Instance.Logger.Log("Method CloseWindow()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method CloseWindow() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void SaveButtonCommandAction()
        {
            isSaveButtonClicked = true;
            AcceptButtonCommandAction(null);
            IsEnabledSaveButton = false;
            isSaveButtonClicked = false;
        }

        private void RetrieveDescriptionByLanguge(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method RetrieveDescriptionByLanguge()...", category: Category.Info, priority: Priority.Low);

                if (IsCheckedAllLanguages == false)
                {
                    if (LanguageSelected.TwoLetterISOLanguage == "EN")
                    {
                        Description = Description_en;
                        Name = Name_en;
                        Remark = Remark_en;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "ES")
                    {
                        Description = Description_es;
                        Name = Name_es;
                        Remark = Remark_es;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "FR")
                    {
                        Description = Description_fr;
                        Name = Name_fr;
                        Remark = Remark_fr;

                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "PT")
                    {
                        Description = Description_pt;
                        Name = Name_pt;
                        Remark = Remark_pt;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "RO")
                    {
                        Description = Description_ro;
                        Name = Name_ro;
                        Remark = Remark_ro;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "RU")
                    {
                        Description = Description_ru;
                        Name = Name_ru;
                        Remark = Remark_ru;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "ZH")
                    {
                        Description = Description_zh;
                        Name = Name_zh;
                        Remark = Remark_zh;
                    }
                }
                GeosApplication.Instance.Logger.Log("Method RetrieveDescriptionByLanguge()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method RetrieveDescriptionByLanguge()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        private void SetNameToLanguage(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log(string.Format("Method SetNameToLanguage..."), category: Category.Info, priority: Priority.Low);

                if (IsCheckedAllLanguages == false)
                {
                    if (string.IsNullOrEmpty(Name))
                    {
                        InformationError = string.Empty; ;
                        PropertyChanged(this, new PropertyChangedEventArgs("InformationError"));
                    }
                    else
                    {
                        InformationError = null;
                        PropertyChanged(this, new PropertyChangedEventArgs("InformationError"));
                    }
                    if (LanguageSelected.TwoLetterISOLanguage == "EN")
                    {
                        Name_en = Name;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "ES")
                    {
                        Name_es = Name;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "FR")
                    {
                        Name_fr = Name;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "PT")
                    {
                        Name_pt = Name;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "RO")
                    {
                        Name_ro = Name;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "RU")
                    {
                        Name_ru = Name;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "ZH")
                    {
                        Name_zh = Name;
                    }
                }
                if (oldName == null)
                {
                    oldName = Name;
                }
                else
                {
                    if (oldName != Name&& Name != ""&&!string.IsNullOrEmpty(Name))
                    {
                        oldName = Name;
                        IsEnabledSaveButton = true;
                    }
                    else
                    {
                        IsEnabledSaveButton = false;
                    }
                }
                GeosApplication.Instance.Logger.Log(string.Format("Method SetNameToLanguage()....executed successfully"), category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method SetNameToLanguage() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void SetDescriptionToLanguage(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log(string.Format("Method SetDescriptionToLanguage..."), category: Category.Info, priority: Priority.Low);

                if (IsCheckedAllLanguages == false)
                {
                    if (LanguageSelected.TwoLetterISOLanguage == "EN")
                    {
                        Description_en = Description;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "ES")
                    {
                        Description_es = Description;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "FR")
                    {
                        Description_fr = Description;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "PT")
                    {
                        Description_pt = Description;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "RO")
                    {
                        Description_ro = Description;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "RU")
                    {
                        Description_ru = Description;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "ZH")
                    {
                        Description_zh = Description;
                    }
                }
                if (oldDescription == null)
                {
                    oldDescription = Description;
                }
                else
                {
                    if (oldDescription != Description)
                    { oldDescription = Description; IsEnabledSaveButton = true; }
                    else
                    {
                        IsEnabledSaveButton = false;
                    }
                }
                GeosApplication.Instance.Logger.Log(string.Format("Method SetDescriptionToLanguage()....executed successfully"), category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method SetDescriptionToLanguage() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void SetRemarkToLanguage(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log(string.Format("Method SetRemarkToLanguage..."), category: Category.Info, priority: Priority.Low);

                if (IsCheckedAllLanguages == false)
                {
                    if (LanguageSelected.TwoLetterISOLanguage == "EN")
                    {
                        Remark_en = Remark;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "ES")
                    {
                        Remark_es = Remark;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "FR")
                    {
                        Remark_fr = Remark;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "PT")
                    {
                        Remark_pt = Remark;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "RO")
                    {
                        Remark_ro = Remark;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "RU")
                    {
                        Remark_ru = Remark;
                    }
                    else if (LanguageSelected.TwoLetterISOLanguage == "ZH")
                    {
                        Remark_zh = Remark;
                    }
                }
                if (oldRemark == null)
                {
                    oldRemark = Remark;
                }
                else
                {
                    if (oldRemark != Remark)
                    { oldRemark = Remark; IsEnabledSaveButton = true; }
                }
                GeosApplication.Instance.Logger.Log(string.Format("Method SetRemarkToLanguage()....executed successfully"), category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method SetRemarkToLanguage() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void UncheckedCopyNameDescription(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log(string.Format("Method UncheckedCopyNameDescription..."), category: Category.Info, priority: Priority.Low);

                if (LanguageSelected.TwoLetterISOLanguage == "EN")
                {
                    Name = Name_en;
                    Description = Description_en;
                    Remark = Remark_en;
                }
                else if (LanguageSelected.TwoLetterISOLanguage == "ES")
                {
                    Name = Name_es;
                    Description = Description_es;
                    Remark = Remark_es;
                }
                else if (LanguageSelected.TwoLetterISOLanguage == "FR")
                {
                    Name = Name_fr;
                    Description = Description_fr;
                    Remark = Remark_fr;
                }
                else if (LanguageSelected.TwoLetterISOLanguage == "PT")
                {
                    Name = Name_pt;
                    Description = Description_pt;
                    Remark = Remark_pt;
                }
                else if (LanguageSelected.TwoLetterISOLanguage == "RO")
                {
                    Name = Name_ro;
                    Description = Description_ro;
                    Remark = Remark_ro;
                }
                else if (LanguageSelected.TwoLetterISOLanguage == "RU")
                {
                    Name = Name_ru;
                    Description = Description_ru;
                    Remark = Remark_ru;
                }
                else if (LanguageSelected.TwoLetterISOLanguage == "ZH")
                {
                    Name = Name_zh;
                    Description = Description_zh;
                    Remark = Remark_zh;
                }
                GeosApplication.Instance.Logger.Log(string.Format("Method UncheckedCopyNameDescription()....executed successfully"), category: Category.Info, priority: Priority.Low);
            }

            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method UncheckedCopyNameDescription() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void OnDragRecordOverArticleGrid(DragRecordOverEventArgs e)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method OnDragRecordOverArticleGrid()...", category: Category.Info, priority: Priority.Low);
                if ((e.IsFromOutside) && typeof(PCMArticleCategory).IsAssignableFrom(e.GetRecordType()))
                {
                    var data = (RecordDragDropData)e.Data.GetData(typeof(RecordDragDropData));
                    List<PCMArticleCategory> record = data.Records.OfType<PCMArticleCategory>().ToList();
                    int count = 0;
                    foreach (PCMArticleCategory article in record.Where(a => a.IdArticle > 0))
                    {
                        DataRow[] found = DtArticleCopy.Select("IdArticle = '" + article.IdArticle + "'");
                        if (found.Length == 0)
                        {
                            count++;
                        }
                    }
                    if (count > 0)
                    {
                        e.Effects = DragDropEffects.Copy;
                        e.Handled = true;
                    }
                    else
                    {
                        e.Effects = DragDropEffects.None;
                        e.Handled = false;
                    }

                }
                GeosApplication.Instance.Logger.Log("Method OnDragRecordOverArticleGrid()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method OnDragRecordOverArticleGrid() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        private void DropRecordArticleGrid(DropRecordEventArgs e)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method DropRecordArticleGrid()...", category: Category.Info, priority: Priority.Low);

                double SellPriceValue = 0.00;

                if ((e.IsFromOutside) && typeof(PCMArticleCategory).IsAssignableFrom(e.GetRecordType()))
                {
                    var data = (RecordDragDropData)e.Data.GetData(typeof(RecordDragDropData));
                    List<PCMArticleCategory> records = data.Records.OfType<PCMArticleCategory>().ToList();
                    foreach (PCMArticleCategory record in records.Where(a => a.IdArticle > 0))
                    {
                        if (DtArticleCopy == null)
                            DtArticleCopy = new DataTable();
                        DataRow[] found = DtArticleCopy.Select("IdArticle = '" + record.IdArticle + "'");
                        if (found.Length == 0)
                        {
                            IsCalculateArticleCostButtonEnabled = true;
                            IsCalculated = false;
                            if (DtArticleCopy == null)
                                DtArticleCopy = new DataTable();
                            DataRow dr = DtArticleCopy.NewRow();
                            dr["IsChecked"] = false;
                            dr["Reference"] = record.Reference;
                            record.Description = record.Description.Trim('\n');
                            dr["Name"] = record.Description;
                            dr["IdArticle"] = record.IdArticle;
                            dr["Category"] = record.CategoryName;
                            dr["Logic"] = 308;

                            dr["Name_Old"] = record.Description;
                            dr["Name_Changed"] = false;
                            dr["NameChanged"] = "Linked Description";
                            dr["Visible_Customer"] = true;
                            dr["VisibleCustomer"] = "Visible";
                            dr["Enable_VisibleCustomer"] = true;
                            dr["Enable_DescriptionLinked"] = true;


                            double Cost_Value = 0;
                            dr["MaxCost_1"] = DBNull.Value;

                            if (dr["Common_Cur"] != DBNull.Value)
                                SellPriceValue = Convert.ToDouble(dr["Common_Cur"]);
                            else
                                SellPriceValue = 0;

                            dr["Profit"] = Convert.ToDouble(CalculateCustomerPriceArticlesProfitValue(Cost_Value, SellPriceValue));
                            dr["CostMargin"] = Convert.ToDouble(CalculateCustomerPriceArticlesCostMarginValue(Cost_Value, SellPriceValue));
                            if (dr["CurrencyConversionDate"] != DBNull.Value)
                            {
                                //[rdixit][13.03.2023][GEOS2-3177]
                                if (SelectedExchangeRate != null)
                                {
                                    if (SelectedExchangeRate.IdLookupValue == 1509)
                                    {
                                        dr["SaleCurrencyConversionDate"] = "Updated currency rate on : " + DateTime.Now.ToString("dd/MM/yyyy");
                                    }
                                    else
                                    {
                                        dr["SaleCurrencyConversionDate"] = "Updated currency rate on : " + Convert.ToDateTime(dr["CurrencyConversionDate"]).ToString("dd/MM/yyyy");
                                    }
                                }
                                else
                                {
                                    dr["SaleCurrencyConversionDate"] = "Updated currency rate on : " + Convert.ToDateTime(dr["CurrencyConversionDate"]).ToString("dd/MM/yyyy");
                                }
                            }
                            DtArticleCopy.Rows.Add(dr);
                            DtArticle = DtArticleCopy;
                            e.Handled = true;
                        }
                    }
                    FilterBPLAndCPL();
                }
                GeosApplication.Instance.Logger.Log("Method DropRecordArticleGrid()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method DropRecordArticleGrid() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void CompleteRecordDragDropArticleGrid(CompleteRecordDragDropEventArgs e)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method CompleteRecordDragDropArticleGrid()...", category: Category.Info, priority: Priority.Low);

                e.Handled = true;

                GeosApplication.Instance.Logger.Log("Method CompleteRecordDragDropArticleGrid()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method CompleteRecordDragDropArticleGrid() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        private void DeleteArticleCommandAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method DeleteArticleCommandAction()...", category: Category.Info, priority: Priority.Low);
                DataColumn[] columns = DtArticleCopy.Columns.Cast<DataColumn>().ToArray();
                DataRow[] foundChecked = DtArticleCopy.AsEnumerable().Where(row => columns.Any(col => row["IsChecked"].ToString() == "True")).ToArray();
                DataRow MainRow = ((System.Data.DataRowView)obj).Row;

                //if (ClonedCustomerPrice != null && ClonedCustomerPrice.IdStatus == 224)
                //[Sudhir.Jangra][GEOS2-3349][27/12/2022]
                if (ClonedCustomerPrice != null && isDuplicateClicked == false && ClonedCustomerPrice.IdStatus == 224)
                {
                    CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("CantChangeCPLValidation").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                    return;
                }

                if (DeleteArticles == null)
                    DeleteArticles = new List<Articles>();
                if (foundChecked.Length > 0 && MainRow["IsChecked"].ToString() != "False")
                {
                    MessageBoxResult MessageBoxResult = CustomMessageBox.Show(Application.Current.Resources["DeleteBPLArticleMessage"].ToString(), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                    if (MessageBoxResult == MessageBoxResult.Yes)
                    {
                        if (foundChecked.Length > 0)
                        {
                            foreach (DataRow dr in foundChecked)
                            {
                                Articles art = new Articles();
                                art.IdArticle = (uint)dr["IdArticle"];
                                DeleteArticles.Add(art);
                                DtArticleCopy.Rows.Remove(dr);
                            }
                        }
                        DtArticle = DtArticleCopy;
                        IsEnabledSaveButton = true;
                    }
                }
                else
                {
                    MessageBoxResult MessageBoxResult = CustomMessageBox.Show(Application.Current.Resources["DeleteBPLArticleMessageSelected"].ToString(), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                    if (MessageBoxResult == MessageBoxResult.Yes)
                    {
                        if (obj != null)
                        {
                            Articles art = new Articles();
                            art.IdArticle = (uint)MainRow["IdArticle"];
                            DeleteArticles.Add(art);
                            DtArticleCopy.Rows.Remove(((System.Data.DataRowView)obj).Row);
                        }
                        DtArticle = DtArticleCopy;
                        IsEnabledSaveButton = true;
                    }
                }
                GeosApplication.Instance.Logger.Log("Method DeleteArticleCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method DeleteArticleCommandAction()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        /// <summary>
        /// Accept Method is to update all the changes to the Service Methods.
        /// </summary>
        /// [001] [vsana][11-12-2020][GEOS2-2561][Assign the customer group/region/Country/plant to the Customer Price List [#PLM26]]
        /// [002] [cpatil][26-10-2021][GEOS2-3332][Sr N 3 - Synchronization between PLM and ECOS [PLM#41]]
        /// <param name="obj"></param>
        private async void AcceptButtonCommandAction(object obj)
        {
            GeosApplication.Instance.Logger.Log(string.Format("Method AcceptButtonCommandAction()..."), category: Category.Info, priority: Priority.Low);
            try
            {
                CustomerChangeLogList = new ObservableCollection<CustomerPriceLogEntry>();

                InformationError = null;
                string error = EnableValidationAndGetError();
                PropertyChanged(this, new PropertyChangedEventArgs("Name"));
                PropertyChanged(this, new PropertyChangedEventArgs("EffectiveDate"));
                PropertyChanged(this, new PropertyChangedEventArgs("ExpiryDate"));
                PropertyChanged(this, new PropertyChangedEventArgs("SelectedBasePriceName"));

                if (string.IsNullOrEmpty(error))
                    InformationError = null;
                else
                    InformationError = "";

                if (error != null)
                {
                    return;
                }

                if (IsNew)
                {
                    #region New
                    if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }

                    NewPrice = new CustomerPrice();

                    //if ((!IsCalculated))
                    //{
                    //    CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("CalculationIsMandatory").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                    //    return;
                    //}

                    if (IsCheckedAllLanguages == true)
                    {
                        NewPrice.Name = Name;
                        NewPrice.Name_es = Name;
                        NewPrice.Name_fr = Name;
                        NewPrice.Name_pt = Name;
                        NewPrice.Name_ro = Name;
                        NewPrice.Name_ru = Name;
                        NewPrice.Name_zh = Name;
                        NewPrice.Description = Description == null ? "" : Description;
                        NewPrice.Description_es = Description == null ? "" : Description;
                        NewPrice.Description_fr = Description == null ? "" : Description;
                        NewPrice.Description_pt = Description == null ? "" : Description;
                        NewPrice.Description_ro = Description == null ? "" : Description;
                        NewPrice.Description_ru = Description == null ? "" : Description;
                        NewPrice.Description_zh = Description == null ? "" : Description == null ? "" : Description;
                        NewPrice.Remark = Remark == null ? "" : Remark;
                        NewPrice.Remark_es = Remark == null ? "" : Remark;
                        NewPrice.Remark_fr = Remark == null ? "" : Remark;
                        NewPrice.Remark_pt = Remark == null ? "" : Remark;
                        NewPrice.Remark_ro = Remark == null ? "" : Remark;
                        NewPrice.Remark_ru = Remark == null ? "" : Remark;
                        NewPrice.Remark_zh = Remark == null ? "" : Remark;
                    }
                    else
                    {
                        NewPrice.Name = Name_en == null ? "" : Name_en;
                        NewPrice.Name_es = Name_es == null ? "" : Name_es;
                        NewPrice.Name_fr = Name_fr == null ? "" : Name_fr;
                        NewPrice.Name_pt = Name_pt == null ? "" : Name_pt;
                        NewPrice.Name_ro = Name_ro == null ? "" : Name_ro;
                        NewPrice.Name_ru = Name_ru == null ? "" : Name_ru;
                        NewPrice.Name_zh = Name_zh == null ? "" : Name_zh;
                        NewPrice.Description = Description_en == null ? "" : Description_en;
                        NewPrice.Description_es = Description_es == null ? "" : Description_es;
                        NewPrice.Description_fr = Description_fr == null ? "" : Description_fr;
                        NewPrice.Description_pt = Description_pt == null ? "" : Description_pt;
                        NewPrice.Description_ro = Description_ro == null ? "" : Description_ro;
                        NewPrice.Description_ru = Description_ru == null ? "" : Description_ru;
                        NewPrice.Description_zh = Description_zh == null ? "" : Description_zh;
                        NewPrice.Remark = Remark == null ? "" : Remark;
                        NewPrice.Remark_es = Remark_es == null ? "" : Remark_es;
                        NewPrice.Remark_fr = Remark_fr == null ? "" : Remark_fr;
                        NewPrice.Remark_pt = Remark_pt == null ? "" : Remark_pt;
                        NewPrice.Remark_ro = Remark_ro == null ? "" : Remark_ro;
                        NewPrice.Remark_ru = Remark_ru == null ? "" : Remark_ru;
                        NewPrice.Remark_zh = Remark_zh == null ? "" : Remark_zh;
                    }
                    NewPrice.Code = SelectedCustomerPriceCode;
                    NewPrice.IdBasePriceList = SelectedBasePriceName.IdBasePriceList;
                    NewPrice.BasePriceName = SelectedBasePriceName.Name;

                    if (ExpiryDate != null)
                        NewPrice.ExpiryDate = Convert.ToDateTime(ExpiryDate);
                    if (EffectiveDate != null)
                        NewPrice.EffectiveDate = Convert.ToDateTime(EffectiveDate);
                    NewPrice.IdStatus = (uint)SelectedStatus.IdLookupValue;

                    NewPrice.IdCurrency = ((Currency)SelectedCurrency).IdCurrency;
                    NewPrice.CurrencyList = new List<Currency>();

                    foreach (Currency cur in SelectedSaleCurrency)
                    {
                        NewPrice.CurrencyList.Add(cur);
                    }

                    NewPrice.CustomerPriceListItems = new List<CustomerPriceListByItem>();
                    NewPrice.CustomerPriceListDetections = new List<CustomerPriceListByItem>();
                    NewPrice.Article_PlantList = new List<Site>();
                    NewPrice.Article_CurrencyList = new List<Currency>();

                    if (DtArticle == null)
                        DtArticle = new DataTable();

                    if (DtArticleCopy == null)
                        DtArticleCopy = new DataTable();

                    DataColumn[] columns = DtArticleCopy.Columns.Cast<DataColumn>().ToArray();
                    DataRow[] foundChecked = DtArticleCopy.AsEnumerable().Where(row => columns.Any(col => row["Logic"].ToString() != "0")).ToArray();
                    if (foundChecked.Length > 0)
                    {
                        List<CustomerPriceListByItem> ArticleListFor_Save = new List<CustomerPriceListByItem>();
                        foreach (DataRow row in foundChecked)
                        {
                            CustomerPriceListByItem customerPriceListByItem = new CustomerPriceListByItem();
                            customerPriceListByItem.IdArticle = Convert.ToUInt64(row["IdArticle"]);
                            if (row["BasePriceValue"] != null && row["BasePriceValue"] != "" && row["BasePriceValue"] != DBNull.Value)
                                customerPriceListByItem.BasePriceListValue = float.Parse(row["BasePriceValue"].ToString());

                            if (row["Visible_Customer"] != DBNull.Value && Convert.ToBoolean(row["Visible_Customer"]) == true)
                                customerPriceListByItem.VisibleToCustomer = 1;
                            else
                                customerPriceListByItem.VisibleToCustomer = 0;

                            if (row["Name_Changed"] != DBNull.Value && Convert.ToBoolean(row["Name_Changed"]) == true)
                            {
                                customerPriceListByItem.ItemCustomerDescription = row["Name"].ToString();
                                customerPriceListByItem.LinkedDescription = 0;
                            }
                            else
                            {
                                customerPriceListByItem.ItemCustomerDescription = null;
                                customerPriceListByItem.LinkedDescription = 1;
                            }

                            if (row["Logic"] != null && row["Logic"] != "" && row["Logic"] != DBNull.Value)
                                customerPriceListByItem.IdRule_New = Convert.ToInt32(row["Logic"]);
                            if (row["Value"] != null && row["Value"] != "" && row["value"] != DBNull.Value)
                                customerPriceListByItem.RuleValue_New = float.Parse(row["Value"].ToString());
                            customerPriceListByItem.Version = 1;

                            if (row["CurrencyConversionDate"] != DBNull.Value && row["CurrencyConversionDate"] != "" && row["CurrencyConversionDate"] != null)
                                customerPriceListByItem.CurrencyConversionDate_New = Convert.ToDateTime(row["CurrencyConversionDate"]);
                            ArticleListFor_Save.Add(customerPriceListByItem);//[Sudhir.Jangra][GEOS2-3349][27/12/2022]
                                                                             // NewPrice.CustomerPriceListItems.Add(customerPriceListByItem);
                        }
                        NewPrice.CustomerPriceListItems = ArticleListFor_Save;//[Sudhir.Jangra][GEOS2-3349][27/12/2022]

                    }

                    if (DtDetection == null)
                    {
                        DtDetection = new DataTable();
                    }
                    if (DtDetectionCopy == null)
                        DtDetectionCopy = new DataTable();

                    DataColumn[] columns_Detection = DtDetectionCopy.Columns.Cast<DataColumn>().ToArray();
                    DataRow[] foundChecked_Detection = DtDetectionCopy.AsEnumerable().Where(row => columns_Detection.Any(col => row["Logic"].ToString() != "0")).ToArray();

                    if (foundChecked_Detection.Length > 0)
                    {
                        List<CustomerPriceListByItem> DetectionListFor_Save = new List<CustomerPriceListByItem>();
                        foreach (DataRow row in foundChecked_Detection)
                        {
                            CustomerPriceListByItem customerPriceListByItem = new CustomerPriceListByItem();
                            customerPriceListByItem.IdDetection = Convert.ToUInt32(row["IdDetection"]);
                            if (row["BasePriceValue"] != null && row["BasePriceValue"] != "" && row["BasePriceValue"] != DBNull.Value)
                                customerPriceListByItem.BasePriceListValue = float.Parse(row["BasePriceValue"].ToString());

                            if (row["Visible_Customer"] != DBNull.Value && Convert.ToBoolean(row["Visible_Customer"]) == true)
                                customerPriceListByItem.VisibleToCustomer = 1;
                            else
                                customerPriceListByItem.VisibleToCustomer = 0;

                            if (row["Name_Changed"] != DBNull.Value && Convert.ToBoolean(row["Name_Changed"]) == true)
                            {
                                customerPriceListByItem.ItemCustomerDescription = row["Name"].ToString();
                                customerPriceListByItem.LinkedDescription = 0;
                            }
                            else
                            {
                                customerPriceListByItem.ItemCustomerDescription = null;
                                customerPriceListByItem.LinkedDescription = 1;
                            }

                            if (row["Logic"] != null && row["Logic"] != "" && row["Logic"] != DBNull.Value)
                                customerPriceListByItem.IdRule_New = Convert.ToInt32(row["Logic"]);
                            if (row["Value"] != null && row["Value"] != "" && row["value"] != DBNull.Value)
                                customerPriceListByItem.RuleValue_New = float.Parse(row["Value"].ToString());
                            customerPriceListByItem.Version = 1;

                            if (row["CurrencyConversionDate"] != DBNull.Value && row["CurrencyConversionDate"] != "" && row["CurrencyConversionDate"] != null)
                                customerPriceListByItem.CurrencyConversionDate_New = Convert.ToDateTime(row["CurrencyConversionDate"]);

                            // NewPrice.CustomerPriceListDetections.Add(customerPriceListByItem);
                            DetectionListFor_Save.Add(customerPriceListByItem);//[Sudhir.jangra][GEOS2-3349][27/12/2022]
                        }
                        NewPrice.AddDetectionList = DetectionListFor_Save;//[Sudhir.jangra][GEOS2-3349][27/12/2022]
                    }
                    try
                    {
                        #region Module
                        if (DtModule == null)
                        {
                            DtModule = new DataTable();
                        }
                        if (DtModuleCopy == null)
                            DtModuleCopy = new DataTable();

                        DataColumn[] columns_Module = DtModuleCopy.Columns.Cast<DataColumn>().ToArray();
                        DataRow[] foundChecked_Module = DtModuleCopy.AsEnumerable().Where(row => columns_Module.Any(col => row["Logic"].ToString() != "0")).ToArray();

                        if (foundChecked_Module.Length > 0)
                        {
                            List<CustomerPriceListByItem> ModuleListFor_Save = new List<CustomerPriceListByItem>();
                            foreach (DataRow row in foundChecked_Module)
                            {
                                CustomerPriceListByItem customerPriceListByItem = new CustomerPriceListByItem();
                                customerPriceListByItem.IdCPType = Convert.ToUInt32(row["IdCPType"]);
                                if (row["BasePriceValue"] != null && row["BasePriceValue"] != "" && row["BasePriceValue"] != DBNull.Value)
                                    customerPriceListByItem.BasePriceListValue = float.Parse(row["BasePriceValue"].ToString());

                                if (row["Visible_Customer"] != DBNull.Value && Convert.ToBoolean(row["Visible_Customer"]) == true)
                                    customerPriceListByItem.VisibleToCustomer = 1;
                                else
                                    customerPriceListByItem.VisibleToCustomer = 0;

                                if (row["Name_Changed"] != DBNull.Value && Convert.ToBoolean(row["Name_Changed"]) == true)
                                {
                                    customerPriceListByItem.ItemCustomerDescription = row["Name"].ToString();
                                    customerPriceListByItem.LinkedDescription = 0;
                                }
                                else
                                {
                                    customerPriceListByItem.ItemCustomerDescription = null;
                                    customerPriceListByItem.LinkedDescription = 1;
                                }

                                if (row["Logic"] != null && row["Logic"] != "" && row["Logic"] != DBNull.Value)
                                    customerPriceListByItem.IdRule_New = Convert.ToInt32(row["Logic"]);
                                if (row["Value"] != null && row["Value"] != "" && row["value"] != DBNull.Value)
                                    customerPriceListByItem.RuleValue_New = float.Parse(row["Value"].ToString());
                                customerPriceListByItem.Version = 1;

                                if (row["CurrencyConversionDate"] != DBNull.Value && row["CurrencyConversionDate"] != "" && row["CurrencyConversionDate"] != null)
                                    customerPriceListByItem.CurrencyConversionDate_New = Convert.ToDateTime(row["CurrencyConversionDate"]);

                                // NewPrice.CustomerPriceListModules.Add(customerPriceListByItem);
                                ModuleListFor_Save.Add(customerPriceListByItem);//[Sudhir.jangra][GEOS2-3349][27/12/2022]
                            }
                            NewPrice.AddModuleList = ModuleListFor_Save;//[Sudhir.jangra][GEOS2-3349][27/12/2022]
                        }
                        #endregion
                    }
                    catch (Exception ex)
                    {
                    }
                    NewPrice.CreationDate = DateTime.Now;
                    NewPrice.IdCreator = (uint)GeosApplication.Instance.ActiveUser.IdUser;

                    //[adhatkar] GEOS2-2817
                    NewPrice.CustomerList = CPLCustomerList;
                    NewPrice.PLMCustomerAttachmentList = new List<CPLDocument>();
                    if (OptionWayDetectionSparePartFilesList != null)
                    {
                        foreach (CPLDocument item in OptionWayDetectionSparePartFilesList)
                        {
                            //if (!ClonedBasePrice.PLMArticleAttachmentList.Any(x => x.IdBasepricedoc == item.IdBasepricedoc))
                            //{

                            CPLDocument cplDoc = (CPLDocument)item.Clone();
                            cplDoc.TransactionOperation = ModelBase.TransactionOperations.Add;
                            NewPrice.PLMCustomerAttachmentList.Add(cplDoc);
                            //  ChangedLogsEntries.Add(new BasePriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("PCMArticleChangeLogFilesAdd").ToString(), item.OriginalFileName) });
                            //}

                            CustomerPriceLogEntry testCustomerPriceLogEntry = new CustomerPriceLogEntry();
                            testCustomerPriceLogEntry.IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser;
                            testCustomerPriceLogEntry.UserName = GeosApplication.Instance.ActiveUser.FullName;
                            testCustomerPriceLogEntry.Datetime = GeosApplication.Instance.ServerDateTime;
                            testCustomerPriceLogEntry.Comments = string.Format(System.Windows.Application.Current.FindResource("PCMArticleChangeLogFilesAdd").ToString(), item.OriginalFileName);
                            CustomerChangeLogList.Add(testCustomerPriceLogEntry);
                            NewPrice.LogList = CustomerChangeLogList.ToList();
                        }
                    }
                    CustomerPriceLogEntry tempCustomerPriceLogEntry = new CustomerPriceLogEntry();
                    tempCustomerPriceLogEntry.IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser;
                    tempCustomerPriceLogEntry.UserName = GeosApplication.Instance.ActiveUser.FullName;
                    tempCustomerPriceLogEntry.Datetime = GeosApplication.Instance.ServerDateTime;
                    tempCustomerPriceLogEntry.Comments = string.Format(System.Windows.Application.Current.FindResource("CustomerPriceChnageLog").ToString(), NewPrice.Name.Trim());
                    CustomerChangeLogList.Add(tempCustomerPriceLogEntry);



                    #region GEOS2-4935
                    //foreach (var item in CommentsList)
                    //{
                    //    CustomerChangeLogList.Add(new CustomerPriceLogEntry()
                    //    {
                    //        IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser,
                    //        Datetime = GeosApplication.Instance.ServerDateTime,
                    //        UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName,
                    //        Comments = string.Format(System.Windows.Application.Current.FindResource("CustomerPriceChangeLogForComment").ToString(),
                    //           item.Comments)

                    //    });
                    //}

                    #endregion
                    NewPrice.CustomerPriceCommentsList = CommentsList.ToList();
                    NewPrice.CustomerPriceCommentsList.ForEach(x => x.People.OwnerImage = null);



                    if (isDuplicateClicked)
                    {
                        CustomerPriceLogEntry tempCustomerPriceLogEntry_new = new CustomerPriceLogEntry();
                        tempCustomerPriceLogEntry_new.IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser;
                        tempCustomerPriceLogEntry_new.UserName = GeosApplication.Instance.ActiveUser.FirstName;
                        tempCustomerPriceLogEntry_new.Datetime = GeosApplication.Instance.ServerDateTime;
                        tempCustomerPriceLogEntry_new.Comments = string.Format(System.Windows.Application.Current.FindResource("CustomerPriceChangeLogDuplicated").ToString(),
                            NewPrice.Code.Trim(), NewPrice.Name.Trim(), CustomerPriceOldCode.Trim(), ClonedCustomerPrice.Name.Trim());
                        CustomerChangeLogList = new ObservableCollection<CustomerPriceLogEntry>();
                        CustomerChangeLogList.Add(tempCustomerPriceLogEntry_new);
                        NewPrice.LogList = CustomerChangeLogList.ToList();
                        IsDuplicateSave = true;
                    }
                    else
                    {
                        IsDuplicateSave = false;
                    }
                    if (NewPrice.CurrencyList != null)
                        NewPrice.CurrencyList.ForEach(x => x.CurrencyIconImage = null);
                    if (NewPrice.CurrencyList_Cloned != null)
                        NewPrice.CurrencyList_Cloned.ForEach(x => x.CurrencyIconImage = null);
                    if (NewPrice.Article_CurrencyList != null)
                        NewPrice.Article_CurrencyList.ForEach(x => x.CurrencyIconImage = null);
                    NewPrice.LogList = CustomerChangeLogList.ToList();
                    NewPrice.CurrencyList.ForEach(x => x.CurrencyIconImage = null);
                    //NewPrice = PLMService.AddCustomerPrice_V2150(NewPrice);
                    //NewPrice = PLMService.AddCustomerPrice_V2340(NewPrice);
                    //Shubham[skadam] GEOS2-3180 [Only Modules ] - SRN 2_5_8 Window in PCM to manage the  BPL/CPL price for Articles, Modules and DOWS [8 / 8] - Modules (Menu box, Grid and Change Log) 26 04 2023
                   // NewPrice = PLMService.AddCustomerPrice_V2380(NewPrice);

                    //[Sudhir.Jangra][GEOS2-4935]
                    NewPrice = PLMService.AddCustomerPrice_V2470(NewPrice);



                    if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                    CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("CustomerPriceAddedSuccess").ToString()), Application.Current.Resources["PopUpSuccessColor"].ToString(), CustomMessageBox.MessageImagePath.Ok, MessageBoxButton.OK);
                    IsNewCustomerPriceSave = true;

                    #region synchronization
                    //[001] Added code for synchronization
                    if (GeosApplication.Instance.IsPLMPermissionNameECOS_Synchronization == true)
                    {
                        GeosAppSettingList = WorkbenchService.GetSelectedGeosAppSettings("59,60,61");
                        if (GeosAppSettingList != null && GeosAppSettingList.Count != 0)
                        {
                            if (GeosAppSettingList.Any(i => i.IdAppSetting == 59) && GeosAppSettingList.Any(i => i.IdAppSetting == 60) && GeosAppSettingList.Any(i => i.IdAppSetting == 61) && NewPrice.IdStatus == 223)
                            {
                                if ((!string.IsNullOrEmpty((GeosAppSettingList[0].DefaultValue))) && (!string.IsNullOrEmpty((GeosAppSettingList[1].DefaultValue))) && (!string.IsNullOrEmpty((GeosAppSettingList[2].DefaultValue))))    //(!string.IsNullOrEmpty((GeosAppSettingList[0].DefaultValue))) // && (GeosAppSettingList[1].DefaultValue)))  //.Where(i => i.IdAppSetting == 57).Select(x => x.DefaultValue)))) // && (GeosAppSettingList[1].DefaultValue))) // Where(i => i.IdAppSetting == 57).FirstOrDefault().DefaultValue.to)
                                {
                                    #region synchronization Code
                                    //var ownerInfo = (obj as FrameworkElement);

                                    try
                                    {
                                        MessageBoxResult MessageBoxResult = MessageBoxResult = CustomMessageBox.Show(string.Format(Application.Current.Resources["ECOSSynchronizationWarningMessage"].ToString()), "Yellow", CustomMessageBox.MessageImagePath.Warning, MessageBoxButton.YesNo);
                                        if (MessageBoxResult == MessageBoxResult.Yes)
                                        {

                                            if (!DXSplashScreen.IsActive)
                                            {
                                                DXSplashScreen.Show(x =>
                                                {
                                                    Window win = new Window()
                                                    {
                                                        Focusable = true,
                                                        ShowActivated = false,
                                                        WindowStyle = WindowStyle.None,
                                                        ResizeMode = ResizeMode.NoResize,
                                                        AllowsTransparency = false,
                                                        Background = new SolidColorBrush(Colors.Transparent),
                                                        ShowInTaskbar = false,
                                                        Topmost = false,
                                                        SizeToContent = SizeToContent.WidthAndHeight,
                                                        WindowStartupLocation = WindowStartupLocation.CenterScreen,
                                                    };
                                                    WindowFadeAnimationBehavior.SetEnableAnimation(win, true);
                                                    return win;
                                                }, x =>
                                                {
                                                    return new SplashScreenView() { DataContext = new SplashScreenViewModel() };
                                                }, null, null);
                                            }
                                            GeosApplication.Instance.SplashScreenMessage = "Synchronization is running";



                                            APIErrorDetailForErrorFalse valuesErrorFalse = new APIErrorDetailForErrorFalse();
                                            APIErrorDetail values = new APIErrorDetail();
                                            List<ErrorDetails> LstErrorDetail = new List<ErrorDetails>();
                                            tokenService = new AuthTokenService();
                                            if (GeosAppSettingList.Any(i => i.IdAppSetting == 59))
                                            {

                                                string[] tokeninformations = GeosAppSettingList.Where(i => i.IdAppSetting == 59).FirstOrDefault().DefaultValue.Split(';');
                                                if (tokeninformations.Count() >= 2)
                                                {



                                                    List<BPLPlantCurrencyDetail> BPLPlantCurrencyDetailList = new List<BPLPlantCurrencyDetail>();
                                                    BPLPlantCurrencyDetailList.AddRange(PLMService.GetBPLPlantCurrencyDetailByIdBPLAndIdCPL(0, "", NewPrice.IdCustomerPriceList.ToString(), "Detection"));
                                                    BPLPlantCurrencyDetailList.AddRange(PLMService.GetBPLPlantCurrencyDetailByIdBPLAndIdCPL(0, "", NewPrice.IdCustomerPriceList.ToString(), "Article"));

                                                    if (NewPrice.CustomerPriceListItems != null && NewPrice.CustomerPriceListItems.Count > 0 && DtArticle.AsEnumerable().Where(row => columns.Any(col => row["Logic"].ToString() != "0")).ToArray() != null && DtArticle.AsEnumerable().Where(row => columns.Any(col => row["Logic"].ToString() != "0")).ToList().Count > 0)
                                                    {

                                                        string references = string.Join(",", DtArticle.AsEnumerable().Where(row => columns.Any(col => row["Logic"].ToString() != "0")).Select(s => s.Field<string>("Reference")).ToList());

                                                        if (GeosAppSettingList.Any(i => i.IdAppSetting == 61))
                                                        {

                                                            foreach (BPLPlantCurrencyDetail itemBPLPlantCurrencyDetail in BPLPlantCurrencyDetailList.Distinct())
                                                            {


                                                                GeosApplication.Instance.SplashScreenMessage = "Articles Synchronization is running for plant " + itemBPLPlantCurrencyDetail.CompanyName + " and currency " + itemBPLPlantCurrencyDetail.CurrencyName + "";


                                                                List<ErrorDetails> TempLstErrorDetail = await PLMService.IsPLMAddEditCPLCustomerSynchronization(GeosAppSettingList, itemBPLPlantCurrencyDetail, columns, DtArticle);

                                                                foreach (ErrorDetails item in TempLstErrorDetail)
                                                                {
                                                                    if (item != null && item.Error == string.Empty)
                                                                    {
                                                                        GeosApplication.Instance.SplashScreenMessage = "Articles Synchronization is Done for plant " + itemBPLPlantCurrencyDetail.CompanyName + " and currency " + itemBPLPlantCurrencyDetail.CurrencyName + "";
                                                                    }
                                                                    else
                                                                    {
                                                                        if (item != null && item.Error != null)
                                                                        {
                                                                            GeosApplication.Instance.SplashScreenMessage = "Articles Synchronization is failed for plant " + itemBPLPlantCurrencyDetail.CompanyName + " and currency " + itemBPLPlantCurrencyDetail.CurrencyName + "";
                                                                            ErrorDetails errorDetails = new ErrorDetails();
                                                                            errorDetails.CompanyName = itemBPLPlantCurrencyDetail.CompanyName;
                                                                            errorDetails.CurrencyName = itemBPLPlantCurrencyDetail.CurrencyName;
                                                                            errorDetails.Error = values.Message._Message;
                                                                            LstErrorDetail.Add(errorDetails);
                                                                        }
                                                                    }
                                                                }


                                                            }


                                                        }
                                                    }
                                                    if (NewPrice.CustomerPriceListDetections != null && NewPrice.CustomerPriceListDetections.Count > 0)
                                                    {
                                                        if (GeosAppSettingList.Any(i => i.IdAppSetting == 60))
                                                        {
                                                            foreach (BPLPlantCurrencyDetail itemBPLPlantCurrencyDetail in BPLPlantCurrencyDetailList.Distinct())
                                                            {

                                                                GeosApplication.Instance.SplashScreenMessage = "Detections Synchronization is running for plant " + itemBPLPlantCurrencyDetail.CompanyName + " and currency " + itemBPLPlantCurrencyDetail.CurrencyName + "";
                                                                List<ErrorDetails> TempLstErrorDetail = await PLMService.IsPLMAddEditCPLCustomerSynchronization(GeosAppSettingList, itemBPLPlantCurrencyDetail, columns, DtArticle);

                                                                foreach (ErrorDetails item in TempLstErrorDetail)
                                                                {
                                                                    if (item != null && item.Error == string.Empty)
                                                                    {
                                                                        GeosApplication.Instance.SplashScreenMessage = "Detections Synchronization is done for plant " + itemBPLPlantCurrencyDetail.CompanyName + " and currency " + itemBPLPlantCurrencyDetail.CurrencyName + "";
                                                                    }
                                                                    else
                                                                    {
                                                                        if (item != null && item.Error != null)
                                                                        {
                                                                            GeosApplication.Instance.SplashScreenMessage = "Detections Synchronization is failed for plant " + itemBPLPlantCurrencyDetail.CompanyName + " and currency " + itemBPLPlantCurrencyDetail.CurrencyName + "";
                                                                            ErrorDetails errorDetails = new ErrorDetails();
                                                                            errorDetails.CompanyName = itemBPLPlantCurrencyDetail.CompanyName;
                                                                            errorDetails.CurrencyName = itemBPLPlantCurrencyDetail.CurrencyName;
                                                                            errorDetails.Error = values.Message._Message;
                                                                            LstErrorDetail.Add(errorDetails);
                                                                        }
                                                                    }
                                                                }

                                                            }


                                                        }
                                                    }

                                                    if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                                                    if (LstErrorDetail != null && LstErrorDetail.Count > 0)
                                                    {
                                                        String FinalMessage = null;
                                                        string msg = string.Empty;
                                                        foreach (ErrorDetails item in LstErrorDetail)
                                                        {

                                                            if (string.IsNullOrEmpty(FinalMessage))
                                                                FinalMessage = string.Format(System.Windows.Application.Current.FindResource("PLMSynchronizationFailedForFollowingReasons").ToString() + System.Environment.NewLine + string.Format(System.Windows.Application.Current.FindResource("PLMSynchronizationFailedCompanyCurrency").ToString(), item.CompanyName, item.CurrencyName, item.Error));
                                                            else
                                                                FinalMessage += System.Environment.NewLine + string.Format(System.Windows.Application.Current.FindResource("PLMSynchronizationFailedCompanyCurrency").ToString(), item.CompanyName, item.CurrencyName, item.Error);

                                                        }
                                                        if (!string.IsNullOrEmpty(FinalMessage))
                                                        {
                                                            CustomMessageBox.Show(FinalMessage, "Red", CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                                                        }
                                                    }
                                                    else
                                                    {
                                                        CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("ECOSSynchronizationSuccess").ToString()), Application.Current.Resources["PopUpSuccessColor"].ToString(), CustomMessageBox.MessageImagePath.Ok, MessageBoxButton.OK);
                                                    }

                                                }
                                            }
                                        }

                                        GeosApplication.Instance.Logger.Log(string.Format("Method Init()....executed AcceptButtonCommandAction"), category: Category.Info, priority: Priority.Low);
                                    }
                                    catch (Exception ex)
                                    {
                                        GeosApplication.Instance.SplashScreenMessage = "The Synchronization failed";
                                        if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                                        CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("ECOSSynchronizationFailed").ToString(), ex.Message), "Red", CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);

                                    }
                                    GeosApplication.Instance.SplashScreenMessage = string.Empty;
                                    #endregion

                                }
                            }
                        }
                    }
                    #endregion
                    RequestClose(null, null);

                    #endregion
                }
                else
                {
                    #region Updated
                    #region information
                    if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }
                    UpdatedItem = new CustomerPrice();

                    //if (!IsCalculated)
                    //{
                    //    CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("CalculationIsMandatory").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                    //    return;
                    //}

                    UpdatedItem.IdBasePriceList = SelectedBasePriceName.IdBasePriceList;
                    UpdatedItem.BasePriceName = SelectedBasePriceName.Name;
                    UpdatedItem.IdCustomerPriceList = IdCustomerPriceList;
                    UpdatedItem.IdBasePriceList_Cloned = ClonedCustomerPrice.IdBasePriceList;
                    if (IsCheckedAllLanguages == true)
                    {
                        UpdatedItem.Name = Name;
                        UpdatedItem.Name_es = Name;
                        UpdatedItem.Name_fr = Name;
                        UpdatedItem.Name_pt = Name;
                        UpdatedItem.Name_ro = Name;
                        UpdatedItem.Name_ru = Name;
                        UpdatedItem.Name_zh = Name;
                        UpdatedItem.Description = Description == null ? "" : Description;
                        UpdatedItem.Description_es = Description == null ? "" : Description;
                        UpdatedItem.Description_fr = Description == null ? "" : Description;
                        UpdatedItem.Description_pt = Description == null ? "" : Description;
                        UpdatedItem.Description_ro = Description == null ? "" : Description;
                        UpdatedItem.Description_ru = Description == null ? "" : Description;
                        UpdatedItem.Description_zh = Description == null ? "" : Description == null ? "" : Description;
                        UpdatedItem.Remark = Remark == null ? "" : Remark;
                        UpdatedItem.Remark_es = Remark == null ? "" : Remark;
                        UpdatedItem.Remark_fr = Remark == null ? "" : Remark;
                        UpdatedItem.Remark_pt = Remark == null ? "" : Remark;
                        UpdatedItem.Remark_ro = Remark == null ? "" : Remark;
                        UpdatedItem.Remark_ru = Remark == null ? "" : Remark;
                        UpdatedItem.Remark_zh = Remark == null ? "" : Remark;
                    }
                    else
                    {
                        UpdatedItem.Name = Name_en == null ? "" : Name_en;
                        UpdatedItem.Name_es = Name_es == null ? "" : Name_es;
                        UpdatedItem.Name_fr = Name_fr == null ? "" : Name_fr;
                        UpdatedItem.Name_pt = Name_pt == null ? "" : Name_pt;
                        UpdatedItem.Name_ro = Name_ro == null ? "" : Name_ro;
                        UpdatedItem.Name_ru = Name_ru == null ? "" : Name_ru;
                        UpdatedItem.Name_zh = Name_zh == null ? "" : Name_zh;
                        UpdatedItem.Description = Description_en == null ? "" : Description_en;
                        UpdatedItem.Description_es = Description_es == null ? "" : Description_es;
                        UpdatedItem.Description_fr = Description_fr == null ? "" : Description_fr;
                        UpdatedItem.Description_pt = Description_pt == null ? "" : Description_pt;
                        UpdatedItem.Description_ro = Description_ro == null ? "" : Description_ro;
                        UpdatedItem.Description_ru = Description_ru == null ? "" : Description_ru;
                        UpdatedItem.Description_zh = Description_zh == null ? "" : Description_zh;
                        UpdatedItem.Remark = Remark == null ? "" : Remark;
                        UpdatedItem.Remark_es = Remark_es == null ? "" : Remark_es;
                        UpdatedItem.Remark_fr = Remark_fr == null ? "" : Remark_fr;
                        UpdatedItem.Remark_pt = Remark_pt == null ? "" : Remark_pt;
                        UpdatedItem.Remark_ro = Remark_ro == null ? "" : Remark_ro;
                        UpdatedItem.Remark_ru = Remark_ru == null ? "" : Remark_ru;
                        UpdatedItem.Remark_zh = Remark_zh == null ? "" : Remark_zh;
                    }

                    UpdatedItem.Code = SelectedCustomerPriceCode;

                    if (ExpiryDate != null)
                        UpdatedItem.ExpiryDate = Convert.ToDateTime(ExpiryDate);
                    if (EffectiveDate != null)
                        UpdatedItem.EffectiveDate = Convert.ToDateTime(EffectiveDate);

                    #endregion

                    //old or new bpl
                    if (ClonedCustomerPrice.IdBasePriceList != SelectedBasePriceName.IdBasePriceList)
                    {
                        #region new bpl
                        UpdatedItem.CustomerPriceListItems = new List<CustomerPriceListByItem>();
                        UpdatedItem.CustomerPriceListDetections = new List<CustomerPriceListByItem>();
                        UpdatedItem.Article_PlantList = new List<Site>();
                        UpdatedItem.Article_CurrencyList = new List<Currency>();

                        if (DtArticle == null)
                            DtArticle = new DataTable();

                        if (DtArticleCopy == null)
                            DtArticleCopy = new DataTable();


                        UpdatedItem.CurrencyList = new List<Currency>();

                        foreach (Currency cur in SelectedSaleCurrency)
                        {
                            UpdatedItem.CurrencyList.Add(cur);
                        }

                        DataColumn[] columns = DtArticleCopy.Columns.Cast<DataColumn>().ToArray();
                        DataRow[] foundChecked = DtArticleCopy.AsEnumerable().Where(row => columns.Any(col => row["Logic"].ToString() != "0")).ToArray();
                        DataRow[] foundChecked1 = DtArticleCopy.AsEnumerable().Where(row => columns.Any(col => row["Logic"].ToString() == "0")).ToArray();
                        //  ArticleCount = DtArticleCopy.Rows.Count- foundChecked1.Length;
                        ArticleCount = foundChecked1.Length;
                        if (foundChecked1.Length > 0)
                        {
                            foreach (DataRow row in foundChecked1)
                            {
                                CustomerPriceListByItem customerPriceListByItem = new CustomerPriceListByItem();
                                customerPriceListByItem.IdArticle = Convert.ToUInt64(row["IdArticle"]);
                                if (row["BasePriceValue"] != null && row["BasePriceValue"] != "" && row["BasePriceValue"] != DBNull.Value)
                                    customerPriceListByItem.BasePriceListValue = float.Parse(row["BasePriceValue"].ToString());

                                if (row["Visible_Customer"] != DBNull.Value && Convert.ToBoolean(row["Visible_Customer"]) == true)
                                    customerPriceListByItem.VisibleToCustomer = 1;
                                else
                                    customerPriceListByItem.VisibleToCustomer = 0;

                                if (row["Name_Changed"] != DBNull.Value && Convert.ToBoolean(row["Name_Changed"]) == true)
                                {
                                    customerPriceListByItem.ItemCustomerDescription = row["Name"].ToString();
                                    customerPriceListByItem.LinkedDescription = 0;
                                }
                                else
                                {
                                    customerPriceListByItem.ItemCustomerDescription = null;
                                    customerPriceListByItem.LinkedDescription = 1;
                                }

                                if (row["Logic"] != null && row["Logic"] != "" && row["Logic"] != DBNull.Value)
                                    customerPriceListByItem.IdRule_New = Convert.ToInt32(row["Logic"]);
                                if (row["Value"] != null && row["Value"] != "" && row["value"] != DBNull.Value)
                                    customerPriceListByItem.RuleValue_New = float.Parse(row["Value"].ToString());
                                customerPriceListByItem.Version = 1;

                                if (row["CurrencyConversionDate"] != DBNull.Value && row["CurrencyConversionDate"] != "" && row["CurrencyConversionDate"] != null)
                                    customerPriceListByItem.CurrencyConversionDate_New = Convert.ToDateTime(row["CurrencyConversionDate"]);

                                UpdatedItem.CustomerPriceListItems.Add(customerPriceListByItem);
                            }
                        }

                        if (DtDetection == null)
                        {
                            DtDetection = new DataTable();
                        }
                        if (DtDetectionCopy == null)
                            DtDetectionCopy = new DataTable();

                        DataColumn[] columns_Detection = DtDetectionCopy.Columns.Cast<DataColumn>().ToArray();
                        DataRow[] foundChecked_Detection = DtDetectionCopy.AsEnumerable().Where(row => columns_Detection.Any(col => row["Logic"].ToString() != "0")).ToArray();
                        DataRow[] foundChecked_Detection1 = DtDetectionCopy.AsEnumerable().Where(row => columns_Detection.Any(col => row["Logic"].ToString() == "0")).ToArray();
                        //DetectionCount = DtDetectionCopy.Rows.Count - foundChecked_Detection1.Length;
                        DetectionCount = foundChecked_Detection1.Length;
                        if (foundChecked_Detection1.Length > 0)
                        {
                            foreach (DataRow row in foundChecked_Detection1)
                            {
                                CustomerPriceListByItem customerPriceListByItem = new CustomerPriceListByItem();
                                customerPriceListByItem.IdDetection = Convert.ToUInt32(row["IdDetection"]);
                                if (row["BasePriceValue"] != null && row["BasePriceValue"] != "" && row["BasePriceValue"] != DBNull.Value)
                                    customerPriceListByItem.BasePriceListValue = float.Parse(row["BasePriceValue"].ToString());

                                if (row["Visible_Customer"] != DBNull.Value && Convert.ToBoolean(row["Visible_Customer"]) == true)
                                    customerPriceListByItem.VisibleToCustomer = 1;
                                else
                                    customerPriceListByItem.VisibleToCustomer = 0;

                                if (row["Name_Changed"] != DBNull.Value && Convert.ToBoolean(row["Name_Changed"]) == true)
                                {
                                    customerPriceListByItem.ItemCustomerDescription = row["Name"].ToString();
                                    customerPriceListByItem.LinkedDescription = 0;
                                }
                                else
                                {
                                    customerPriceListByItem.ItemCustomerDescription = null;
                                    customerPriceListByItem.LinkedDescription = 1;
                                }

                                if (row["Logic"] != null && row["Logic"] != "" && row["Logic"] != DBNull.Value)
                                    customerPriceListByItem.IdRule_New = Convert.ToInt32(row["Logic"]);
                                if (row["Value"] != null && row["Value"] != "" && row["value"] != DBNull.Value)
                                    customerPriceListByItem.RuleValue_New = float.Parse(row["Value"].ToString());
                                customerPriceListByItem.Version = 1;


                                if (row["CurrencyConversionDate"] != DBNull.Value && row["CurrencyConversionDate"] != "" && row["CurrencyConversionDate"] != null)
                                    customerPriceListByItem.CurrencyConversionDate_New = Convert.ToDateTime(row["CurrencyConversionDate"]);

                                UpdatedItem.CustomerPriceListDetections.Add(customerPriceListByItem);
                            }
                        }

                        try
                        {
                            #region Module
                            if (DtModule == null)
                            {
                                DtModule = new DataTable();
                            }
                            if (DtModuleCopy == null)
                                DtModuleCopy = new DataTable();

                            DataColumn[] columns_Module = DtModuleCopy.Columns.Cast<DataColumn>().ToArray();
                            DataRow[] foundChecked_Module = DtModuleCopy.AsEnumerable().Where(row => columns_Module.Any(col => row["Logic"].ToString() != "0")).ToArray();
                            DataRow[] foundChecked_Module1 = DtModuleCopy.AsEnumerable().Where(row => columns_Module.Any(col => row["Logic"].ToString() == "0")).ToArray();
                            //ModuleCount = DtModuleCopy.Rows.Count - foundChecked_Module1.Length;
                            ModuleCount = foundChecked_Module1.Length;
                            if (foundChecked_Module1.Length > 0)
                            {
                                foreach (DataRow row in foundChecked_Module1)
                                {
                                    CustomerPriceListByItem customerPriceListByItem = new CustomerPriceListByItem();
                                    customerPriceListByItem.IdCPType = Convert.ToUInt32(row["IdCPType"]);
                                    if (row["BasePriceValue"] != null && row["BasePriceValue"] != "" && row["BasePriceValue"] != DBNull.Value)
                                        customerPriceListByItem.BasePriceListValue = float.Parse(row["BasePriceValue"].ToString());

                                    if (row["Visible_Customer"] != DBNull.Value && Convert.ToBoolean(row["Visible_Customer"]) == true)
                                        customerPriceListByItem.VisibleToCustomer = 1;
                                    else
                                        customerPriceListByItem.VisibleToCustomer = 0;

                                    if (row["Name_Changed"] != DBNull.Value && Convert.ToBoolean(row["Name_Changed"]) == true)
                                    {
                                        customerPriceListByItem.ItemCustomerDescription = row["Name"].ToString();
                                        customerPriceListByItem.LinkedDescription = 0;
                                    }
                                    else
                                    {
                                        customerPriceListByItem.ItemCustomerDescription = null;
                                        customerPriceListByItem.LinkedDescription = 1;
                                    }

                                    if (row["Logic"] != null && row["Logic"] != "" && row["Logic"] != DBNull.Value)
                                        customerPriceListByItem.IdRule_New = Convert.ToInt32(row["Logic"]);
                                    if (row["Value"] != null && row["Value"] != "" && row["value"] != DBNull.Value)
                                        customerPriceListByItem.RuleValue_New = float.Parse(row["Value"].ToString());
                                    customerPriceListByItem.Version = 1;


                                    if (row["CurrencyConversionDate"] != DBNull.Value && row["CurrencyConversionDate"] != "" && row["CurrencyConversionDate"] != null)
                                        customerPriceListByItem.CurrencyConversionDate_New = Convert.ToDateTime(row["CurrencyConversionDate"]);

                                    UpdatedItem.CustomerPriceListModules.Add(customerPriceListByItem);
                                }
                            }
                            #endregion
                        }
                        catch (Exception ex)
                        {

                        }
                        #endregion
                    }
                    else
                    {
                        #region old bpl
                        #region delete articles
                        UpdatedItem.DeleteArticleList = new List<Articles>();
                        if (DeleteArticles != null)
                        {
                            foreach (Articles dltArt in DeleteArticles)
                            {
                                if (ClonedCustomerPrice.CustomerPriceListItems.Any(a => a.IdArticle == dltArt.IdArticle))
                                {
                                    dltArt.TransactionOperation = ModelBase.TransactionOperations.Delete;
                                    UpdatedItem.DeleteArticleList.Add(dltArt);
                                    string referenceNo = string.Empty;
                                    referenceNo = ArticleList.FirstOrDefault(a => a.IdArticle == dltArt.IdArticle).ArticleData.Reference;
                                    CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogArticleGridDelete").ToString(), referenceNo) });
                                }
                            }
                        }

                        #endregion

                        #region delete Detections
                        UpdatedItem.DeleteDetectionList = new List<Detections>();

                        if (DeleteDetections != null)
                        {
                            foreach (Detections deleteDetection in DeleteDetections)
                            {
                                if (ClonedCustomerPrice.CustomerPriceListDetections.Any(a => a.IdDetection == deleteDetection.IdDetections))
                                {
                                    deleteDetection.TransactionOperation = ModelBase.TransactionOperations.Delete;
                                    UpdatedItem.DeleteDetectionList.Add(deleteDetection);
                                    string referenceNo = string.Empty;
                                    referenceNo = DetectionList.FirstOrDefault(a => a.IdDetection == deleteDetection.IdDetections).Detection.Name;
                                    CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogDetectionGridDelete").ToString(), referenceNo) });
                                }
                            }
                        }

                        #endregion

                        #region Add and Delete Currency
                        UpdatedItem.CurrencyList = new List<Currency>();
                        UpdatedItem.CurrencyList_Cloned = ClonedCustomerPrice.CurrencyList;
                        UpdatedItem.DeleteCurrencyList = new List<Currency>();
                        UpdatedItem.AddCurrencyList = new List<Currency>();

                        foreach (Currency cur in SelectedSaleCurrency)
                        {
                            UpdatedItem.CurrencyList.Add(cur);
                        }
                        foreach (Currency temp in UpdatedItem.CurrencyList_Cloned)
                        {
                            if (!UpdatedItem.CurrencyList.Any(x => x.IdCurrency == temp.IdCurrency))
                            {
                                Currency Currency_dlt = (Currency)temp.Clone();
                                Currency_dlt.TransactionOperation = ModelBase.TransactionOperations.Delete;
                                UpdatedItem.DeleteCurrencyList.Add(Currency_dlt);
                                CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogSaleCurrencyDelete").ToString(), temp.Name) });
                            }
                        }
                        foreach (Currency temp1 in UpdatedItem.CurrencyList)
                        {
                            if (!UpdatedItem.CurrencyList_Cloned.Any(x => x.IdCurrency == temp1.IdCurrency))
                            {
                                Currency Currency_add = (Currency)temp1.Clone();
                                Currency_add.TransactionOperation = ModelBase.TransactionOperations.Add;
                                UpdatedItem.AddCurrencyList.Add(Currency_add);
                                CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogSaleCurrencyAdd").ToString(), temp1.Name) });
                            }
                        }
                        #endregion

                        #region add and update articles

                        DataColumn[] columns = DtArticleCopy.Columns.Cast<DataColumn>().ToArray();
                        DataRow[] foundChecked = DtArticleCopy.AsEnumerable().Where(row => columns.Any(col => row["IsUpdatedRow"].ToString() == "True" && row["Logic"].ToString() != "0")).ToArray();
                        DataRow[] foundChecked1 = DtArticleCopy.AsEnumerable().Where(row => columns.Any(col => row["Logic"].ToString() == "0")).ToArray();
                        ArticleCount = DtArticleCopy.Rows.Count - foundChecked1.Length;

                        if (foundChecked.Length > 0 || IsSaleCurrencyAddedOrRemove == true)
                        {
                            UpdatedItem.AddArticleList = new List<CustomerPriceListByItem>();
                            UpdatedItem.UpdateArticleList = new List<CustomerPriceListByItem>();
                            UpdatedItem.UpdatePlantList = new List<Site>();
                            UpdatedItem.UpdateCurrencyList = new List<Currency>();

                            foreach (DataRow row in foundChecked)
                            {
                                //new plant and sale currency
                                if (UpdatedItem.AddCurrencyList == null)
                                    UpdatedItem.AddCurrencyList = new List<Currency>();

                                List<Currency> AddCurrencyList = new List<Currency>(UpdatedItem.AddCurrencyList.ToList());

                                //update article, plant, sale currency
                                if (DeleteArticles == null)
                                    DeleteArticles = new List<Articles>();

                                if (ClonedCustomerPrice.CustomerPriceListItems.Any(a => a.IdArticle == Convert.ToUInt64(row["IdArticle"])) && !DeleteArticles.Any(a => a.IdArticle == Convert.ToUInt64(row["IdArticle"])))
                                {
                                    CustomerPriceListByItem ItemUpdated = ClonedCustomerPrice.CustomerPriceListItems.FirstOrDefault(x => x.IdArticle == Convert.ToUInt64(row["IdArticle"]));

                                    if (row["Value"] == DBNull.Value)
                                        row["Value"] = 0;

                                    if (row["Logic"] == DBNull.Value)
                                        row["Logic"] = 0;

                                    byte VisibleToCustomer = 0;
                                    if (row["Visible_Customer"] != DBNull.Value && Convert.ToBoolean(row["Visible_Customer"]) == true)
                                        VisibleToCustomer = 1;
                                    else
                                        VisibleToCustomer = 0;

                                    byte LinkDescription = 0;
                                    if (row["Name_Changed"] != DBNull.Value && Convert.ToBoolean(row["Name_Changed"]) == true)
                                        LinkDescription = 0;
                                    else
                                        LinkDescription = 1;


                                    if (ItemUpdated.IdRule_New == null)
                                        ItemUpdated.IdRule_New = 0;

                                    //DateTime? CurrencyConversionDate = null;

                                    //if (row["CurrencyConversionDate"] != DBNull.Value && row["CurrencyConversionDate"] != null)
                                    //    CurrencyConversionDate = Convert.ToDateTime(row["CurrencyConversionDate"]);

                                    //update article
                                    //change on 15-07-21 [GEOS2-3020]
                                    if (ItemUpdated.IdRule_New != Convert.ToInt32(row["Logic"]) || ItemUpdated.RuleValue_New != float.Parse(row["Value"].ToString())
                                        || ItemUpdated.ItemCustomerDescription != row["Name"].ToString() || ItemUpdated.VisibleToCustomer != VisibleToCustomer
                                        || ItemUpdated.LinkedDescription != LinkDescription)//|| ItemUpdated.CurrencyConversionDate_New != CurrencyConversionDate
                                    {
                                        CustomerPriceListByItem Article = new CustomerPriceListByItem();
                                        Article.IdArticle = Convert.ToUInt64(row["IdArticle"]);
                                        Article.MaxCost = float.Parse(row["MaxCost_1"].ToString());
                                        Article.IdRule_New = Convert.ToInt32(row["Logic"]);

                                        if (row["Value"] != null && row["value"] != DBNull.Value)
                                            Article.RuleValue_New = float.Parse(row["Value"].ToString());

                                        if (row["Name_Changed"] != DBNull.Value && Convert.ToBoolean(row["Name_Changed"]) == true)
                                        {
                                            Article.ItemCustomerDescription = row["Name"].ToString();
                                            Article.LinkedDescription = 0;
                                        }
                                        else
                                        {
                                            Article.ItemCustomerDescription = null;
                                            Article.LinkedDescription = 1;
                                        }

                                        if (row["Visible_Customer"] != DBNull.Value && Convert.ToBoolean(row["Visible_Customer"]) == true)
                                            Article.VisibleToCustomer = 1;
                                        else
                                            Article.VisibleToCustomer = 0;

                                        if (row["BasePriceValue"] != null && row["BasePriceValue"] != "" && row["BasePriceValue"] != DBNull.Value)
                                            Article.BasePriceListValue = float.Parse(row["BasePriceValue"].ToString());

                                        if (row["CurrencyConversionDate"] != DBNull.Value && row["CurrencyConversionDate"] != null)
                                            Article.CurrencyConversionDate_New = Convert.ToDateTime(row["CurrencyConversionDate"]);

                                        Article.TransactionOperation = ModelBase.TransactionOperations.Update;
                                        UpdatedItem.UpdateArticleList.Add(Article);

                                        string ReferenceNo = ArticleList.FirstOrDefault(a => a.IdArticle == Article.IdArticle).ArticleData.Reference;

                                        //change on 14-07-21 [GEOS2-3020]
                                        if (ItemUpdated.IdRule_New != Convert.ToInt32(row["Logic"]))
                                        {
                                            string newRuleLogic = LogicList.FirstOrDefault(a => a.IdLookupValue == Convert.ToInt32(row["Logic"])).Value;
                                            string oldRuleLogic = LogicList.FirstOrDefault(a => a.IdLookupValue == ItemUpdated.IdRule_New).Value;
                                            if (Article.IdRule_New == 0)
                                                CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogArticleGridRuleLogic").ToString(), "None", newRuleLogic, ReferenceNo) });
                                            else
                                                CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogArticleGridRuleLogic").ToString(), oldRuleLogic, newRuleLogic, ReferenceNo) });
                                        }

                                        //change on 14-07-21 [GEOS2-3020]
                                        if (ItemUpdated.RuleValue_New != float.Parse(row["Value"].ToString()))
                                        {
                                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogArticleGridRuleValue").ToString(), ItemUpdated.RuleValue_New, Article.RuleValue_New, ReferenceNo) });
                                        }

                                        //change on 15-07-21 [GEOS2-3020]
                                        if (ItemUpdated.ItemCustomerDescription != row["Name"].ToString())
                                        {
                                            string name_old = ItemUpdated.ItemCustomerDescription;
                                            string name_new = row["Name"].ToString();

                                            if (name_old == "" || name_old == null)
                                                name_old = "None";

                                            if (name_new == "" || name_new == null)
                                                name_new = "None";

                                            if (name_old != name_new)
                                                CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogArticleGridDescription").ToString(), name_old, name_new, ReferenceNo) });
                                        }

                                        //change on 14-07-21 [GEOS2-3020]
                                        if (ItemUpdated.VisibleToCustomer != VisibleToCustomer)
                                        {
                                            bool old_visiblecustomer = false;
                                            bool new_visiblecustomer = false;

                                            if (ItemUpdated.VisibleToCustomer == 1)
                                                new_visiblecustomer = true;

                                            if (VisibleToCustomer == 1)
                                                old_visiblecustomer = true;

                                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogArticleGridVisibleToCustomer").ToString(), old_visiblecustomer, new_visiblecustomer, ReferenceNo) });
                                        }

                                        //change on 14-07-21 [GEOS2-3020]
                                        if (ItemUpdated.LinkedDescription != LinkDescription)
                                        {
                                            string old_descr = "Linked Description";
                                            string new_descr = "Linked Description";

                                            if (ItemUpdated.LinkedDescription == 0)
                                                new_descr = "Unlinked Description";

                                            if (LinkDescription == 0)
                                                old_descr = "Unlinked Description";

                                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogArticleGridLinked").ToString(), old_descr, new_descr, ReferenceNo) });
                                        }
                                    }

                                    if (Convert.ToInt32(row["Logic"]) == 308 && Convert.ToDouble(row["Value"]) <= 0)
                                        row["Value"] = DBNull.Value;
                                }
                                else
                                {
                                    CustomerPriceListByItem customerPriceListByItem = new CustomerPriceListByItem();
                                    customerPriceListByItem.IdArticle = Convert.ToUInt64(row["IdArticle"]);
                                    if (row["BasePriceValue"] != null && row["BasePriceValue"] != "" && row["BasePriceValue"] != DBNull.Value)
                                        customerPriceListByItem.BasePriceListValue = float.Parse(row["BasePriceValue"].ToString());

                                    if (row["Visible_Customer"] != DBNull.Value && Convert.ToBoolean(row["Visible_Customer"]) == true)
                                        customerPriceListByItem.VisibleToCustomer = 1;
                                    else
                                        customerPriceListByItem.VisibleToCustomer = 0;

                                    if (row["Name_Changed"] != DBNull.Value && Convert.ToBoolean(row["Name_Changed"]) == true)
                                    {
                                        customerPriceListByItem.ItemCustomerDescription = row["Name"].ToString();
                                        customerPriceListByItem.LinkedDescription = 0;
                                    }
                                    else
                                    {
                                        customerPriceListByItem.ItemCustomerDescription = null;
                                        customerPriceListByItem.LinkedDescription = 1;
                                    }

                                    if (row["Logic"] != null && row["Logic"] != "" && row["Logic"] != DBNull.Value)
                                        customerPriceListByItem.IdRule_New = Convert.ToInt32(row["Logic"]);
                                    if (row["Value"] != null && row["Value"] != "" && row["value"] != DBNull.Value)
                                        customerPriceListByItem.RuleValue_New = float.Parse(row["Value"].ToString());
                                    customerPriceListByItem.Version = 1;

                                    if (row["CurrencyConversionDate"] != DBNull.Value && row["CurrencyConversionDate"] != "" && row["CurrencyConversionDate"] != null)
                                        customerPriceListByItem.CurrencyConversionDate_New = Convert.ToDateTime(row["CurrencyConversionDate"]);

                                    UpdatedItem.AddArticleList.Add(customerPriceListByItem);

                                    string referenceNo = ArticleList.FirstOrDefault(a => a.IdArticle == Convert.ToUInt64(row["IdArticle"])).ArticleData.Reference;
                                    CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogArticleGridAdd").ToString(), referenceNo) });

                                }
                            }
                        }
                        #endregion

                        #region add and update detections

                        DataColumn[] columns_detection = DtDetectionCopy.Columns.Cast<DataColumn>().ToArray();
                        DataRow[] foundChecked_detection = DtDetectionCopy.AsEnumerable().Where(row => columns_detection.Any(col => row["IsUpdatedRow"].ToString() == "True" && row["Logic"].ToString() != "0")).ToArray();
                        DataRow[] foundChecked_Detection1 = DtDetectionCopy.AsEnumerable().Where(row => columns_detection.Any(col => row["Logic"].ToString() == "0")).ToArray();
                        DetectionCount = DtDetectionCopy.Rows.Count - foundChecked_Detection1.Length;

                        if (foundChecked_detection.Length > 0 || IsSaleCurrencyAddedOrRemove == true)
                        {
                            UpdatedItem.AddDetectionList = new List<CustomerPriceListByItem>();
                            UpdatedItem.UpdateDetectionList = new List<CustomerPriceListByItem>();
                            UpdatedItem.UpdateDetectionCurrencyList = new List<Currency>();

                            foreach (DataRow row in foundChecked_detection)
                            {
                                //new plant and sale currency
                                if (UpdatedItem.AddCurrencyList == null)
                                    UpdatedItem.AddCurrencyList = new List<Currency>();

                                List<Currency> AddCurrencyList = new List<Currency>(UpdatedItem.AddCurrencyList.ToList());

                                //update Detection, plant, sale currency
                                if (DeleteDetections == null)
                                    DeleteDetections = new List<Detections>();

                                if (ClonedCustomerPrice.CustomerPriceListDetections.Any(a => a.IdDetection == Convert.ToUInt64(row["IdDetection"])) && !DeleteDetections.Any(a => a.IdDetections == Convert.ToUInt64(row["IdDetection"])))
                                {
                                    CustomerPriceListByItem ItemUpdated = ClonedCustomerPrice.CustomerPriceListDetections.FirstOrDefault(x => x.IdDetection == Convert.ToUInt64(row["IdDetection"]));

                                    if (row["Value"] == DBNull.Value)
                                        row["Value"] = 0;

                                    byte VisibleToCustomer = 0;
                                    if (row["Visible_Customer"] != DBNull.Value && Convert.ToBoolean(row["Visible_Customer"]) == true)
                                        VisibleToCustomer = 1;
                                    else
                                        VisibleToCustomer = 0;

                                    byte LinkDescription = 0;
                                    if (row["Name_Changed"] != DBNull.Value && Convert.ToBoolean(row["Name_Changed"]) == true)
                                        LinkDescription = 0;
                                    else
                                        LinkDescription = 1;

                                    if (ItemUpdated.IdRule_New == null)
                                        ItemUpdated.IdRule_New = 0;
                                    //DateTime? CurrencyConversionDate = null;

                                    //if (row["CurrencyConversionDate"] != DBNull.Value && row["CurrencyConversionDate"] != null)
                                    //    CurrencyConversionDate = Convert.ToDateTime(row["CurrencyConversionDate"]);

                                    //update Detection
                                    //change on 15-07-21 [GEOS2-3020]
                                    if (ItemUpdated.IdRule != Convert.ToInt32(row["Logic"]) || ItemUpdated.RuleValue != float.Parse(row["Value"].ToString())
                                        || ItemUpdated.ItemCustomerDescription != row["Name"].ToString() || ItemUpdated.VisibleToCustomer != VisibleToCustomer
                                        || ItemUpdated.LinkedDescription != LinkDescription)//|| ItemUpdated.CurrencyConversionDate_New != CurrencyConversionDate
                                    {
                                        CustomerPriceListByItem Detection = new CustomerPriceListByItem();
                                        Detection.IdDetection = Convert.ToUInt32(row["IdDetection"]);
                                        Detection.MaxCost = float.Parse(row["MaxCost_1"].ToString());
                                        Detection.IdRule_New = Convert.ToInt32(row["Logic"]);
                                        if (row["Value"] != null && row["value"] != DBNull.Value)
                                            Detection.RuleValue_New = float.Parse(row["Value"].ToString());

                                        if (row["Name_Changed"] != DBNull.Value && Convert.ToBoolean(row["Name_Changed"]) == true)
                                        {
                                            Detection.ItemCustomerDescription = row["Name"].ToString();
                                            Detection.LinkedDescription = 0;
                                        }
                                        else
                                        {
                                            Detection.ItemCustomerDescription = null;
                                            Detection.LinkedDescription = 1;
                                        }

                                        if (row["Visible_Customer"] != DBNull.Value && Convert.ToBoolean(row["Visible_Customer"]) == true)
                                            Detection.VisibleToCustomer = 1;
                                        else
                                            Detection.VisibleToCustomer = 0;

                                        if (row["BasePriceValue"] != null && row["BasePriceValue"] != "" && row["BasePriceValue"] != DBNull.Value)
                                            Detection.BasePriceListValue = float.Parse(row["BasePriceValue"].ToString());

                                        if (row["CurrencyConversionDate"] != DBNull.Value && row["CurrencyConversionDate"] != null)
                                            Detection.CurrencyConversionDate_New = Convert.ToDateTime(row["CurrencyConversionDate"]);

                                        Detection.TransactionOperation = ModelBase.TransactionOperations.Update;
                                        UpdatedItem.UpdateDetectionList.Add(Detection);

                                        string ReferenceNo = DetectionList.FirstOrDefault(a => a.IdDetection == Detection.IdDetection).Detection.Name;

                                        //change on 14-07-21 [GEOS2-3020]
                                        if (ItemUpdated.IdRule != Convert.ToInt32(row["Logic"]))
                                        {
                                            string newRuleLogic = LogicList.FirstOrDefault(a => a.IdLookupValue == Convert.ToInt32(row["Logic"])).Value;
                                            string oldRuleLogic = LogicList.FirstOrDefault(a => a.IdLookupValue == ItemUpdated.IdRule).Value;
                                            if (ItemUpdated.IdRule == 0)
                                                CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogDetectionGridRuleLogic").ToString(), "None", newRuleLogic, ReferenceNo) });
                                            else
                                                CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogDetectionGridRuleLogic").ToString(), oldRuleLogic, newRuleLogic, ReferenceNo) });
                                        }

                                        //change on 14-07-21 [GEOS2-3020]
                                        if (ItemUpdated.RuleValue != float.Parse(row["Value"].ToString()))
                                        {
                                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogDetectionGridRuleValue").ToString(), ItemUpdated.RuleValue, Detection.RuleValue_New, ReferenceNo) });
                                        }
                                        //change on 15-07-21 [GEOS2-3020]
                                        if (ItemUpdated.ItemCustomerDescription != row["Name"].ToString())
                                        {
                                            string name_old = ItemUpdated.ItemCustomerDescription;
                                            string name_new = row["Name"].ToString();

                                            if (name_old == "" || name_old == null)
                                                name_old = "None";

                                            if (name_new == "" || name_new == null)
                                                name_new = "None";

                                            if (name_old != name_new)
                                                CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogDetectionGridDescription").ToString(), name_old, name_new, ReferenceNo) });
                                        }

                                        //change on 14-07-21 [GEOS2-3020]
                                        if (ItemUpdated.VisibleToCustomer != VisibleToCustomer)
                                        {
                                            bool old_visiblecustomer = false;
                                            bool new_visiblecustomer = false;

                                            if (ItemUpdated.VisibleToCustomer == 1)
                                                new_visiblecustomer = true;

                                            if (VisibleToCustomer == 1)
                                                old_visiblecustomer = true;

                                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogDetectionGridVisibleToCustomer").ToString(), old_visiblecustomer, new_visiblecustomer, ReferenceNo) });
                                        }

                                        //change on 14-07-21 [GEOS2-3020]
                                        if (ItemUpdated.LinkedDescription != LinkDescription)
                                        {
                                            string old_descr = "Linked Description";
                                            string new_descr = "Linked Description";

                                            if (ItemUpdated.LinkedDescription == 0)
                                                new_descr = "Unlinked Description";

                                            if (LinkDescription == 0)
                                                old_descr = "Unlinked Description";

                                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogDetectionGridLinked").ToString(), old_descr, new_descr, ReferenceNo) });
                                        }
                                    }
                                    if (Convert.ToInt32(row["Logic"]) == 308 && Convert.ToDouble(row["Value"]) <= 0)
                                        row["Value"] = DBNull.Value;
                                }
                                else
                                {
                                    CustomerPriceListByItem customerPriceListByItem = new CustomerPriceListByItem();
                                    customerPriceListByItem.IdDetection = Convert.ToUInt32(row["IdDetection"]);
                                    if (row["BasePriceValue"] != null && row["BasePriceValue"] != "" && row["BasePriceValue"] != DBNull.Value)
                                        customerPriceListByItem.BasePriceListValue = float.Parse(row["BasePriceValue"].ToString());

                                    if (row["Visible_Customer"] != DBNull.Value && Convert.ToBoolean(row["Visible_Customer"]) == true)
                                        customerPriceListByItem.VisibleToCustomer = 1;
                                    else
                                        customerPriceListByItem.VisibleToCustomer = 0;

                                    if (row["Name_Changed"] != DBNull.Value && Convert.ToBoolean(row["Name_Changed"]) == true)
                                    {
                                        customerPriceListByItem.ItemCustomerDescription = row["Name"].ToString();
                                        customerPriceListByItem.LinkedDescription = 0;
                                    }
                                    else
                                    {
                                        customerPriceListByItem.ItemCustomerDescription = null;
                                        customerPriceListByItem.LinkedDescription = 1;
                                    }

                                    if (row["Logic"] != null && row["Logic"] != "" && row["Logic"] != DBNull.Value)
                                        customerPriceListByItem.IdRule_New = Convert.ToInt32(row["Logic"]);
                                    if (row["Value"] != null && row["Value"] != "" && row["value"] != DBNull.Value)
                                        customerPriceListByItem.RuleValue_New = float.Parse(row["Value"].ToString());
                                    customerPriceListByItem.Version = 1;

                                    if (row["CurrencyConversionDate"] != DBNull.Value && row["CurrencyConversionDate"] != "" && row["CurrencyConversionDate"] != null)
                                        customerPriceListByItem.CurrencyConversionDate_New = Convert.ToDateTime(row["CurrencyConversionDate"]);

                                    UpdatedItem.AddDetectionList.Add(customerPriceListByItem);


                                    string referenceNo = row["Name"].ToString();
                                    CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogDetectionGridAdd").ToString(), referenceNo) });
                                }
                            }
                        }
                        #endregion

                        try
                        {
                            #region delete Module
                            UpdatedItem.DeleteModuleList = new List<BPLModule>();

                            if (DeleteModules != null)
                            {
                                foreach (BPLModule deleteModule in DeleteModules)
                                {
                                    try
                                    {
                                        if (ClonedCustomerPrice.CustomerPriceListModules.Any(a => a.IdCPType == deleteModule.IdCPType))
                                        {
                                            deleteModule.TransactionOperation = ModelBase.TransactionOperations.Delete;
                                            UpdatedItem.DeleteModuleList.Add(deleteModule);
                                            string referenceNo = string.Empty;
                                            referenceNo = ModuleList.FirstOrDefault(a => a.IdCPType == deleteModule.IdCPType).ProductType.Name;
                                            CustomerChangeLogList.Add(new CustomerPriceLogEntry()
                                            {
                                                IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser,
                                                Datetime = GeosApplication.Instance.ServerDateTime,
                                                UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName,
                                                Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogModuleGridDelete").ToString(),
                                                referenceNo)
                                            });
                                        }
                                    }
                                    catch (Exception ex)
                                    {
                                    }
                                }
                            }
                            #endregion

                            #region add and update Modules

                            DataColumn[] columns_Module = DtModuleCopy.Columns.Cast<DataColumn>().ToArray();
                            DataRow[] foundChecked_Module = DtModuleCopy.AsEnumerable().Where(row => columns_Module.Any(col => row["IsUpdatedRow"].ToString() == "True" && row["Logic"].ToString() != "0")).ToArray();
                            DataRow[] foundChecked_Module1 = DtModuleCopy.AsEnumerable().Where(row => columns_Module.Any(col => row["Logic"].ToString() == "0")).ToArray();
                            ModuleCount = DtModuleCopy.Rows.Count - foundChecked_Module1.Length;

                            if (foundChecked_Module.Length > 0 || IsSaleCurrencyAddedOrRemove == true)
                            {
                                UpdatedItem.AddModuleList = new List<CustomerPriceListByItem>();
                                UpdatedItem.UpdateModuleList = new List<CustomerPriceListByItem>();
                                UpdatedItem.UpdateModuleCurrencyList = new List<Currency>();

                                foreach (DataRow row in foundChecked_Module)
                                {
                                    //new plant and sale currency
                                    if (UpdatedItem.AddCurrencyList == null)
                                        UpdatedItem.AddCurrencyList = new List<Currency>();

                                    List<Currency> AddCurrencyList = new List<Currency>(UpdatedItem.AddCurrencyList.ToList());

                                    //update Module, plant, sale currency
                                    if (DeleteModules == null)
                                        DeleteModules = new List<BPLModule>();

                                    if (ClonedCustomerPrice.CustomerPriceListModules.Any(a => a.IdCPType == Convert.ToUInt64(row["IdCPType"])) && !DeleteModules.Any(a => a.IdCPType == Convert.ToUInt64(row["IdCPType"])))
                                    {
                                        CustomerPriceListByItem ItemUpdated = ClonedCustomerPrice.CustomerPriceListModules.FirstOrDefault(x => x.IdCPType == Convert.ToUInt64(row["IdCPType"]));

                                        if (row["Value"] == DBNull.Value)
                                            row["Value"] = 0;

                                        byte VisibleToCustomer = 0;
                                        if (row["Visible_Customer"] != DBNull.Value && Convert.ToBoolean(row["Visible_Customer"]) == true)
                                            VisibleToCustomer = 1;
                                        else
                                            VisibleToCustomer = 0;

                                        byte LinkDescription = 0;
                                        if (row["Name_Changed"] != DBNull.Value && Convert.ToBoolean(row["Name_Changed"]) == true)
                                            LinkDescription = 0;
                                        else
                                            LinkDescription = 1;

                                        if (ItemUpdated.IdRule_New == null)
                                            ItemUpdated.IdRule_New = 0;

                                        //update Module
                                        if (ItemUpdated.IdRule != Convert.ToInt32(row["Logic"]) || ItemUpdated.RuleValue != float.Parse(row["Value"].ToString())
                                            || ItemUpdated.ItemCustomerDescription != row["Name"].ToString() || ItemUpdated.VisibleToCustomer != VisibleToCustomer
                                            || ItemUpdated.LinkedDescription != LinkDescription)//|| ItemUpdated.CurrencyConversionDate_New != CurrencyConversionDate
                                        {
                                            CustomerPriceListByItem Module = new CustomerPriceListByItem();
                                            Module.IdCPType = Convert.ToUInt32(row["IdCPType"]);
                                            Module.MaxCost = float.Parse(row["MaxCost_1"].ToString());
                                            Module.IdRule_New = Convert.ToInt32(row["Logic"]);
                                            if (row["Value"] != null && row["value"] != DBNull.Value)
                                                Module.RuleValue_New = float.Parse(row["Value"].ToString());

                                            if (row["Name_Changed"] != DBNull.Value && Convert.ToBoolean(row["Name_Changed"]) == true)
                                            {
                                                Module.ItemCustomerDescription = row["Name"].ToString();
                                                Module.LinkedDescription = 0;
                                            }
                                            else
                                            {
                                                Module.ItemCustomerDescription = null;
                                                Module.LinkedDescription = 1;
                                            }

                                            if (row["Visible_Customer"] != DBNull.Value && Convert.ToBoolean(row["Visible_Customer"]) == true)
                                                Module.VisibleToCustomer = 1;
                                            else
                                                Module.VisibleToCustomer = 0;

                                            if (row["BasePriceValue"] != null && row["BasePriceValue"] != "" && row["BasePriceValue"] != DBNull.Value)
                                                Module.BasePriceListValue = float.Parse(row["BasePriceValue"].ToString());

                                            if (row["CurrencyConversionDate"] != DBNull.Value && row["CurrencyConversionDate"] != null)
                                                Module.CurrencyConversionDate_New = Convert.ToDateTime(row["CurrencyConversionDate"]);

                                            Module.TransactionOperation = ModelBase.TransactionOperations.Update;
                                            UpdatedItem.UpdateModuleList.Add(Module);

                                            string ReferenceNo = ModuleList.FirstOrDefault(a => a.IdCPType == Module.IdCPType).ProductType.Name;

                                            //change on 14-07-21 [GEOS2-3020]
                                            if (ItemUpdated.IdRule != Convert.ToInt32(row["Logic"]))
                                            {
                                                string newRuleLogic = LogicList.FirstOrDefault(a => a.IdLookupValue == Convert.ToInt32(row["Logic"])).Value;
                                                string oldRuleLogic = LogicList.FirstOrDefault(a => a.IdLookupValue == ItemUpdated.IdRule).Value;
                                                if (ItemUpdated.IdRule == 0)
                                                    CustomerChangeLogList.Add(new CustomerPriceLogEntry()
                                                    {
                                                        IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser,
                                                        Datetime = GeosApplication.Instance.ServerDateTime,
                                                        UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName,
                                                        Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogModuleGridRuleLogic").ToString(),
                                                        "None",
                                                        newRuleLogic, ReferenceNo)
                                                    });
                                                else
                                                    CustomerChangeLogList.Add(new CustomerPriceLogEntry()
                                                    {
                                                        IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser,
                                                        Datetime = GeosApplication.Instance.ServerDateTime,
                                                        UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName,
                                                        Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogModuleGridRuleLogic").ToString(),
                                                        oldRuleLogic,
                                                        newRuleLogic, ReferenceNo)
                                                    });
                                            }

                                            //change on 14-07-21 [GEOS2-3020]
                                            if (ItemUpdated.RuleValue != float.Parse(row["Value"].ToString()))
                                            {
                                                CustomerChangeLogList.Add(new CustomerPriceLogEntry()
                                                {
                                                    IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser,
                                                    Datetime = GeosApplication.Instance.ServerDateTime,
                                                    UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName,
                                                    Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogModuleGridRuleValue").ToString(),
                                                    ItemUpdated.RuleValue,
                                                    Module.RuleValue_New,
                                                    ReferenceNo)
                                                });
                                            }
                                            //change on 15-07-21 [GEOS2-3020]
                                            if (ItemUpdated.ItemCustomerDescription != row["Name"].ToString())
                                            {
                                                string name_old = ItemUpdated.ItemCustomerDescription;
                                                string name_new = row["Name"].ToString();

                                                if (name_old == "" || name_old == null)
                                                    name_old = "None";

                                                if (name_new == "" || name_new == null)
                                                    name_new = "None";

                                                if (name_old != name_new)
                                                    CustomerChangeLogList.Add(new CustomerPriceLogEntry()
                                                    {
                                                        IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser,
                                                        Datetime = GeosApplication.Instance.ServerDateTime,
                                                        UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName,
                                                        Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogModuleGridDescription").ToString(),
                                                        name_old,
                                                        name_new,
                                                        ReferenceNo)
                                                    });
                                            }

                                            //change on 14-07-21 [GEOS2-3020]
                                            if (ItemUpdated.VisibleToCustomer != VisibleToCustomer)
                                            {
                                                bool old_visiblecustomer = false;
                                                bool new_visiblecustomer = false;

                                                if (ItemUpdated.VisibleToCustomer == 1)
                                                    new_visiblecustomer = true;

                                                if (VisibleToCustomer == 1)
                                                    old_visiblecustomer = true;

                                                CustomerChangeLogList.Add(new CustomerPriceLogEntry()
                                                {
                                                    IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser,
                                                    Datetime = GeosApplication.Instance.ServerDateTime,
                                                    UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName,
                                                    Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogModuleGridVisibleToCustomer").ToString(),
                                                    old_visiblecustomer,
                                                    new_visiblecustomer,
                                                    ReferenceNo)
                                                });
                                            }

                                            //change on 14-07-21 [GEOS2-3020]
                                            if (ItemUpdated.LinkedDescription != LinkDescription)
                                            {
                                                string old_descr = "Linked Description";
                                                string new_descr = "Linked Description";

                                                if (ItemUpdated.LinkedDescription == 0)
                                                    new_descr = "Unlinked Description";

                                                if (LinkDescription == 0)
                                                    old_descr = "Unlinked Description";

                                                CustomerChangeLogList.Add(new CustomerPriceLogEntry()
                                                {
                                                    IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser,
                                                    Datetime = GeosApplication.Instance.ServerDateTime,
                                                    UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName,
                                                    Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogModuleGridLinked").ToString(),
                                                    old_descr, new_descr, ReferenceNo)
                                                });
                                            }
                                        }
                                        if (Convert.ToInt32(row["Logic"]) == 308 && Convert.ToDouble(row["Value"]) <= 0)
                                            row["Value"] = DBNull.Value;
                                    }
                                    else
                                    {
                                        CustomerPriceListByItem customerPriceListByItem = new CustomerPriceListByItem();
                                        customerPriceListByItem.IdCPType = Convert.ToUInt32(row["IdCPType"]);
                                        if (row["BasePriceValue"] != null && row["BasePriceValue"] != "" && row["BasePriceValue"] != DBNull.Value)
                                            customerPriceListByItem.BasePriceListValue = float.Parse(row["BasePriceValue"].ToString());

                                        if (row["Visible_Customer"] != DBNull.Value && Convert.ToBoolean(row["Visible_Customer"]) == true)
                                            customerPriceListByItem.VisibleToCustomer = 1;
                                        else
                                            customerPriceListByItem.VisibleToCustomer = 0;

                                        if (row["Name_Changed"] != DBNull.Value && Convert.ToBoolean(row["Name_Changed"]) == true)
                                        {
                                            customerPriceListByItem.ItemCustomerDescription = row["Name"].ToString();
                                            customerPriceListByItem.LinkedDescription = 0;
                                        }
                                        else
                                        {
                                            customerPriceListByItem.ItemCustomerDescription = null;
                                            customerPriceListByItem.LinkedDescription = 1;
                                        }

                                        if (row["Logic"] != null && row["Logic"] != "" && row["Logic"] != DBNull.Value)
                                            customerPriceListByItem.IdRule_New = Convert.ToInt32(row["Logic"]);
                                        if (row["Value"] != null && row["Value"] != "" && row["value"] != DBNull.Value)
                                            customerPriceListByItem.RuleValue_New = float.Parse(row["Value"].ToString());
                                        customerPriceListByItem.Version = 1;

                                        if (row["CurrencyConversionDate"] != DBNull.Value && row["CurrencyConversionDate"] != "" && row["CurrencyConversionDate"] != null)
                                            customerPriceListByItem.CurrencyConversionDate_New = Convert.ToDateTime(row["CurrencyConversionDate"]);

                                        UpdatedItem.AddModuleList.Add(customerPriceListByItem);


                                        string referenceNo = row["Name"].ToString();
                                        CustomerChangeLogList.Add(new CustomerPriceLogEntry()
                                        {
                                            IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser,
                                            Datetime = GeosApplication.Instance.ServerDateTime,
                                            UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName,
                                            Comments = string.Format(System.Windows.Application.Current.FindResource("EditBasePriceChangeLogModuleGridAdd").ToString(),
                                            referenceNo)
                                        });
                                    }
                                }
                            }
                            #endregion
                        }
                        catch (Exception ex)
                        {
                        }
                        #endregion
                    }


                    //[adhatkar] GEOS2-2817
                    //Customers
                    UpdatedItem.CustomerList = new List<CPLCustomer>();

                    // Delete Customer
                    foreach (CPLCustomer item in ClonedCustomerPrice.CustomerList)
                    {
                        if (CPLCustomerList != null && !CPLCustomerList.Any(x => x.IdCustomerPriceListCustomer == item.IdCustomerPriceListCustomer))
                        {
                            CPLCustomer CPLCustomer = (CPLCustomer)item.Clone();
                            CPLCustomer.TransactionOperation = ModelBase.TransactionOperations.Delete;
                            UpdatedItem.CustomerList.Add(CPLCustomer);
                        }
                    }

                    //Added Customer
                    if (CPLCustomerList != null)
                    {
                        foreach (CPLCustomer item in CPLCustomerList)
                        {
                            if (!ClonedCustomerPrice.CustomerList.Any(x => x.IdCustomerPriceListCustomer == item.IdCustomerPriceListCustomer))
                            {
                                CPLCustomer CPLCustomer = (CPLCustomer)item.Clone();
                                CPLCustomer.TransactionOperation = ModelBase.TransactionOperations.Add;
                                UpdatedItem.CustomerList.Add(CPLCustomer);
                            }
                        }
                    }

                    //Updated Customer
                    foreach (CPLCustomer originalCustomer in ClonedCustomerPrice.CustomerList)
                    {
                        if (CPLCustomerList != null && CPLCustomerList.Any(x => x.IdCustomerPriceListCustomer == originalCustomer.IdCustomerPriceListCustomer))
                        {
                            CPLCustomer CPLCustomerUpdated = CPLCustomerList.FirstOrDefault(x => x.IdCustomerPriceListCustomer == originalCustomer.IdCustomerPriceListCustomer);
                            if ((CPLCustomerUpdated.IdGroup != originalCustomer.IdGroup) || (CPLCustomerUpdated.IdRegion != originalCustomer.IdRegion) || (CPLCustomerUpdated.IdCountry != originalCustomer.IdCountry) || (CPLCustomerUpdated.IdPlant != originalCustomer.IdPlant))
                            {
                                CPLCustomer CPLCustomer = (CPLCustomer)CPLCustomerUpdated.Clone();
                                CPLCustomer.IdModifier = Convert.ToUInt32(GeosApplication.Instance.ActiveUser.IdUser);
                                CPLCustomer.TransactionOperation = ModelBase.TransactionOperations.Update;
                                UpdatedItem.CustomerList.Add(CPLCustomer);

                                CustomerChangeLogList.Add(new CustomerPriceLogEntry()
                                {
                                    IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser,
                                    Datetime = GeosApplication.Instance.ServerDateTime,
                                    UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName,
                                    Comments = string.Format(System.Windows.Application.Current.FindResource("CPLCustomerChangeLogUpdate").ToString(),
                                    originalCustomer.GroupName, originalCustomer.RegionName,
                                    originalCustomer.Country.Name, originalCustomer.Plant.Name,
                                    CPLCustomer.GroupName, CPLCustomer.RegionName,
                                    CPLCustomer.Country.Name, CPLCustomer.Plant.Name)
                                });
                            }
                        }
                    }
                    //customer change logs
                    //add
                    if (UpdatedItem.CustomerList.Count > 0)
                    {
                        var ListByGroup = UpdatedItem.CustomerList.Where(a => a.TransactionOperation == ModelBase.TransactionOperations.Add).GroupBy(x => x.GroupName, (key, g) => new { GroupName = key, List = g.ToList() });
                        foreach (var item in ListByGroup)
                        {
                            CustomerChangeLogList.Add(new CustomerPriceLogEntry()
                            {
                                IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser,
                                Datetime = GeosApplication.Instance.ServerDateTime,
                                UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName,
                                Comments = string.Format(System.Windows.Application.Current.FindResource("CustomerPriceChangeLogAdd").ToString(),
                                item.GroupName,
                                string.Join(",", item.List.Select(a => a.RegionName).Distinct()),
                                string.Join(",", item.List.Select(a => a.Country.Name).Distinct()),
                                string.Join(",", item.List.Select(a => a.Plant.Name).Distinct()))
                            });
                        }
                    }
                    //delete
                    if (UpdatedItem.CustomerList.Count > 0)
                    {
                        var ListByGroup = UpdatedItem.CustomerList.Where(a => a.TransactionOperation == ModelBase.TransactionOperations.Delete).GroupBy(x => x.GroupName, (key, g) => new { GroupName = key, List = g.ToList() });
                        foreach (var item in ListByGroup)
                        {
                            CustomerChangeLogList.Add(new CustomerPriceLogEntry()
                            {
                                IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser,
                                Datetime = GeosApplication.Instance.ServerDateTime,
                                UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName,
                                Comments = string.Format(System.Windows.Application.Current.FindResource("CustomerPriceChangeLogDelete").ToString(),
                                item.GroupName,
                                string.Join(",", item.List.Select(a => a.RegionName).Distinct()),
                                string.Join(",", item.List.Select(a => a.Country.Name).Distinct()),
                                string.Join(",", item.List.Select(a => a.Plant.Name).Distinct()))
                            });
                        }
                    }

                    // Delete Article Attachment file
                    foreach (CPLDocument item in ClonedCustomerPrice.PLMCustomerAttachmentList)
                    {

                        if (OptionWayDetectionSparePartFilesList != null && !OptionWayDetectionSparePartFilesList.Any(x => x.IdCustomerPriceListDoc == item.IdCustomerPriceListDoc))
                        {
                            if (UpdatedItem.PLMCustomerAttachmentList == null)
                            {
                                UpdatedItem.PLMCustomerAttachmentList = new List<CPLDocument>();
                            }
                            CPLDocument cplDoc = (CPLDocument)item.Clone();
                            cplDoc.TransactionOperation = ModelBase.TransactionOperations.Delete;
                            UpdatedItem.PLMCustomerAttachmentList.Add(cplDoc);
                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("PCMArticleChangeLogFilesDelete").ToString(), item.OriginalFileName) });
                        }
                    }

                    //Add Article Attachment file [rdixit][GEOS2-2512][30.11.2022]
                    if (OptionWayDetectionSparePartFilesList != null)
                    {
                        foreach (CPLDocument item in OptionWayDetectionSparePartFilesList)
                        {
                            if (!ClonedCustomerPrice.PLMCustomerAttachmentList.Any(x => x.IdCustomerPriceListDoc == item.IdCustomerPriceListDoc))
                            {
                                if (UpdatedItem.PLMCustomerAttachmentList == null)
                                {
                                    UpdatedItem.PLMCustomerAttachmentList = new List<CPLDocument>();
                                }
                                CPLDocument cplDoc = (CPLDocument)item.Clone();
                                cplDoc.TransactionOperation = ModelBase.TransactionOperations.Add;
                                UpdatedItem.PLMCustomerAttachmentList.Add(cplDoc);
                                CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("PCMArticleChangeLogFilesAdd").ToString(), item.OriginalFileName) });
                            }
                        }
                    }

                    //Updated Article Attachment file
                    foreach (CPLDocument originalArticle in ClonedCustomerPrice.PLMCustomerAttachmentList)
                    {
                        if (OptionWayDetectionSparePartFilesList != null && OptionWayDetectionSparePartFilesList.Any(x => x.IdCustomerPriceListDoc == originalArticle.IdCustomerPriceListDoc))
                        {
                            CPLDocument cPLAttachedDocUpdated = OptionWayDetectionSparePartFilesList.FirstOrDefault(x => x.IdCustomerPriceListDoc == originalArticle.IdCustomerPriceListDoc);


                            if ((cPLAttachedDocUpdated.SavedFileName != originalArticle.SavedFileName) || (cPLAttachedDocUpdated.OriginalFileName != originalArticle.OriginalFileName) || (cPLAttachedDocUpdated.Description != originalArticle.Description) || (cPLAttachedDocUpdated.IsShareWithCustomer != originalArticle.IsShareWithCustomer) || (cPLAttachedDocUpdated.ArticleDocumentType.DocumentType != originalArticle.ArticleDocumentType.DocumentType) || (cPLAttachedDocUpdated.PLMArticleFileInBytes != originalArticle.PLMArticleFileInBytes))
                            {
                                CPLDocument cplAttachedDoc = (CPLDocument)cPLAttachedDocUpdated.Clone();
                                cplAttachedDoc.ModifiedBy = Convert.ToInt32(GeosApplication.Instance.ActiveUser.IdUser);
                                cplAttachedDoc.TransactionOperation = ModelBase.TransactionOperations.Update;
                                if (UpdatedItem.PLMCustomerAttachmentList == null)
                                {
                                    UpdatedItem.PLMCustomerAttachmentList = new List<CPLDocument>();
                                }
                                UpdatedItem.PLMCustomerAttachmentList.Add(cplAttachedDoc);

                                if ((cPLAttachedDocUpdated.OriginalFileName != originalArticle.OriginalFileName))
                                {
                                    if (string.IsNullOrEmpty(cPLAttachedDocUpdated.OriginalFileName))
                                        CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("PCMArticleChangeLogFilesNameUpdate").ToString(), "None", originalArticle.OriginalFileName) });
                                    else
                                    {
                                        CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("PCMArticleChangeLogFilesNameUpdate").ToString(), originalArticle.OriginalFileName, cPLAttachedDocUpdated.OriginalFileName) });
                                    }
                                }


                                if ((cPLAttachedDocUpdated.Description != originalArticle.Description))
                                {
                                    if (string.IsNullOrEmpty(cPLAttachedDocUpdated.Description))
                                        CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("PCMArticleChangeLogDescriptionUpdate").ToString(), originalArticle.Description, "None") });
                                    else
                                    {
                                        if (string.IsNullOrEmpty(originalArticle.Description))
                                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("PCMArticleChangeLogDescriptionUpdate").ToString(), "None", cPLAttachedDocUpdated.Description) });
                                        else
                                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("PCMArticleChangeLogDescriptionUpdate").ToString(), originalArticle.Description, cPLAttachedDocUpdated.Description) });
                                    }
                                }
                                if ((cPLAttachedDocUpdated.IsShareWithCustomer != originalArticle.IsShareWithCustomer))
                                {

                                    CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("PCMArticleChangeLogFilesIsSharedWithCustomerUpdate").ToString(), originalArticle.Description, (originalArticle.IsShareWithCustomer == 0 ? "OFF" : "ON"), (cPLAttachedDocUpdated.IsShareWithCustomer == 0 ? "OFF" : "ON")) });

                                }

                                if (cPLAttachedDocUpdated.ArticleDocumentType.DocumentType != originalArticle.ArticleDocumentType.DocumentType)
                                {

                                    CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("PCMArticleChangeLogFilesDocumentTypeUpdate").ToString(), originalArticle.Description, originalArticle.ArticleDocumentType.DocumentType, cPLAttachedDocUpdated.ArticleDocumentType.DocumentType) });


                                }

                            }
                        }
                    }

                    UpdatedItem.IdCreator = (uint)GeosApplication.Instance.ActiveUser.IdUser;
                    UpdatedItem.IdStatus = (uint)SelectedStatus.IdLookupValue;
                    UpdatedItem.IdCurrency = IdCurrency;
                    UpdatedItem.ModificationDate = DateTime.Now;
                    UpdatedItem.IdModifier = (uint)GeosApplication.Instance.ActiveUser.IdUser;

                    AddChangedLogsDetails();
                    /// declared image sources to add removed image sources	
                    List<ImageSource> cListSource = new List<ImageSource>();
                    List<ImageSource> cListClonedSource = new List<ImageSource>();

                    //UpdatedItem.Currency.CurrencyIconImage = null;		
                    //  UpdatedItem.CurrencyList.ForEach(x => x.CurrencyIconImage = null);	
                    if (UpdatedItem.CurrencyList_Cloned != null)
                    {
                        foreach (var item in UpdatedItem.CurrencyList_Cloned)
                            cListClonedSource.Add(item.CurrencyIconImage);
                        UpdatedItem.CurrencyList_Cloned.ForEach(x => x.CurrencyIconImage = null);
                    }
                    // UpdatedItem.Currency.CurrencyIconImage = null;	
                    if (UpdatedItem.CurrencyList != null)
                    {
                        foreach (var item in UpdatedItem.CurrencyList)
                            cListSource.Add(item.CurrencyIconImage);
                        UpdatedItem.CurrencyList.ForEach(x => x.CurrencyIconImage = null);
                    }

                    if (UpdatedItem.AddCurrencyList != null)
                        UpdatedItem.AddCurrencyList.ForEach(x => x.CurrencyIconImage = null);


                    #region GEOS2-4935 [Sudhir.Jangra]
                    UpdatedItem.CustomerPriceCommentsList = new List<CustomerPriceLogEntry>();
                    //Deleted Comments
                    foreach (CustomerPriceLogEntry itemComments in ClonedCustomerPrice.CustomerPriceCommentsList)
                    {
                        if (!CommentsList.Any(x => x.IdLogEntryByCustomerPriceList == itemComments.IdLogEntryByCustomerPriceList) && itemComments.IdLogEntryByCustomerPriceList != 0)
                        {
                            CustomerPriceLogEntry comments = (CustomerPriceLogEntry)itemComments.Clone();
                            comments.TransactionOperation = ModelBase.TransactionOperations.Delete;
                            UpdatedItem.CustomerPriceCommentsList.Add(comments);

                            //CustomerChangeLogList.Add(new CustomerPriceLogEntry()
                            //{
                            //    IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser,
                            //    Datetime = GeosApplication.Instance.ServerDateTime,
                            //    UserName = GeosApplication.Instance.ActiveUser.FirstName +
                            //                    " " + GeosApplication.Instance.ActiveUser.LastName,
                            //    Comments = string.Format(System.Windows.Application.Current.FindResource("BasePriceChangeLogForCommentDeleted").ToString(),
                            //                   comments.Comments)
                            //});


                        }
                    }

                    //Added Comments
                    foreach (CustomerPriceLogEntry itemComments in CommentsList)
                    {
                        if (!ClonedCustomerPrice.CustomerPriceCommentsList.Any(x => x.IdLogEntryByCustomerPriceList == itemComments.IdLogEntryByCustomerPriceList))
                        {
                            CustomerPriceLogEntry comments = (CustomerPriceLogEntry)itemComments.Clone();
                            comments.TransactionOperation = ModelBase.TransactionOperations.Add;
                            UpdatedItem.CustomerPriceCommentsList.Add(comments);
                            //CustomerChangeLogList.Add(new CustomerPriceLogEntry()
                            //{
                            //    IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser,
                            //    Datetime = GeosApplication.Instance.ServerDateTime,
                            //    UserName = GeosApplication.Instance.ActiveUser.FirstName +
                            //                   " " + GeosApplication.Instance.ActiveUser.LastName,
                            //    Comments = string.Format(System.Windows.Application.Current.FindResource("BasePriceChangeLogForComment").ToString(),
                            //         comments.Comments)
                            //});
                        }
                    }


                    //Update Comments
                    foreach (CustomerPriceLogEntry originalComments in ClonedCustomerPrice.CustomerPriceCommentsList)
                    {
                        if (CommentsList.Any(x => x.IdLogEntryByCustomerPriceList == originalComments.IdLogEntryByCustomerPriceList))
                        {
                            CustomerPriceLogEntry commentsUpdated = CommentsList.FirstOrDefault(x => x.IdLogEntryByCustomerPriceList == originalComments.IdLogEntryByCustomerPriceList);
                            if (commentsUpdated.Comments != originalComments.Comments)
                            {
                                string originalComment;
                                if (originalComments.Comments == null)
                                {
                                    originalComment = string.Empty;
                                }
                                else
                                {
                                    originalComment = originalComments.Comments;
                                }
                                CustomerPriceLogEntry comments = (CustomerPriceLogEntry)commentsUpdated.Clone();
                                comments.ModifiedBy = Convert.ToUInt32(GeosApplication.Instance.ActiveUser.IdUser);
                                comments.ModifiedDate = DateTime.Now;
                                comments.Datetime = DateTime.Now;
                                comments.TransactionOperation = ModelBase.TransactionOperations.Update;
                                UpdatedItem.CustomerPriceCommentsList.Add(comments);


                                //using (var productTypeCommentEntry = new CustomerPriceLogEntry
                                //{
                                //    IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser,
                                //    Datetime = GeosApplication.Instance.ServerDateTime,
                                //    UserName = GeosApplication.Instance.ActiveUser.FirstName +
                                //          " " + GeosApplication.Instance.ActiveUser.LastName,
                                //    Comments = string.Format(System.Windows.Application.Current.FindResource("BasePriceChangeLogForCommentUpdate").ToString(),
                                // originalComments.Comments, originalComments.Comments, comments.Comments)
                                //})
                                //{
                                //    CustomerChangeLogList.Add(productTypeCommentEntry);
                                //}


                            }
                        }
                    }
                    #endregion


                    UpdatedItem.CustomerPriceCommentsList.ForEach(x => x.People.OwnerImage = null);

                    UpdatedItem.LogList = CustomerChangeLogList.ToList();
                    // IsNewCustomerPriceSave = PLMService.UpdateCustomerPrice_V2150(UpdatedItem);
                    // IsNewCustomerPriceSave = PLMService.UpdateCustomerPrice_V2340(UpdatedItem);
                    //Shubham[skadam] GEOS2-3180 [Only Modules ] - SRN 2_5_8 Window in PCM to manage the  BPL/CPL price for Articles, Modules and DOWS [8 / 8] - Modules (Menu box, Grid and Change Log) 26 04 2023
                   // IsNewCustomerPriceSave = PLMService.UpdateCustomerPrice_V2380(UpdatedItem);
                    //[Sudhir.Jangra][GEOS2-4935]

                    IsNewCustomerPriceSave = PLMService.UpdateCustomerPrice_V2470(UpdatedItem);


                    // add removed image sources if save button clicked	
                    if (SaveButtonVisibility == Visibility.Visible && isSaveButtonClicked)
                    {
                        //CustomerPrice temp_ = (PLMService.GetCustomerPricesById_V2340(UpdatedItem.IdCustomerPriceList));
                        //Shubham[skadam] GEOS2-3180 [Only Modules ] - SRN 2_5_8 Window in PCM to manage the  BPL/CPL price for Articles, Modules and DOWS [8 / 8] - Modules (Menu box, Grid and Change Log) 26 04 2023
                        CustomerPrice temp_ = (PLMService.GetCustomerPricesById_V2380(UpdatedItem.IdCustomerPriceList));
                        ClonedCustomerPrice = (CustomerPrice)temp_.Clone();

                        if (ClonedCustomerPrice.IdStatus == 224)
                            InActiveStatus = true;
                        else
                            InActiveStatus = false;

                        if (DtArticle != null && DtArticle.Rows.Count > 0)
                        {
                            var updatedRowsDtArticle = DtArticle.Select("IsUpdatedRow = True");
                            foreach (var item in updatedRowsDtArticle)
                            {
                                item["IsUpdatedRow"] = false;
                            }
                        }
                        if (DtDetection != null && DtDetection.Rows.Count > 0)
                        {
                            var updatedRowsDtDetection = DtDetection.Select("IsUpdatedRow = True");
                            foreach (var item in updatedRowsDtDetection)
                            {
                                item["IsUpdatedRow"] = false;
                            }
                        }
                        try
                        {
                            if (DtModule != null && DtModule.Rows.Count > 0)
                            {
                                var updatedRowsDtModule = DtModule.Select("IsUpdatedRow = True");
                                foreach (var item in updatedRowsDtModule)
                                {
                                    item["IsUpdatedRow"] = false;
                                }
                            }
                        }
                        catch (Exception ex)
                        {
                        }

                        var i = 0;
                        foreach (var item in cListSource)
                            UpdatedItem.CurrencyList[i++].CurrencyIconImage = item;
                        i = 0;
                        foreach (var item in cListClonedSource)
                            UpdatedItem.CurrencyList_Cloned[i++].CurrencyIconImage = item;
                        DeleteArticles = new List<Articles>();
                        DeleteDetections = new List<Detections>();
                        DeleteModules = new List<BPLModule>();
                    }
                    //var window = GetWindow(this);
                    //owned.Owner = this;
                    if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                    CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("CustomerPriceUpdateSuccess").ToString()), Application.Current.Resources["PopUpSuccessColor"].ToString(), CustomMessageBox.MessageImagePath.Ok, MessageBoxButton.OK);
                    #region synchronization
                    //[001] Added code for synchronization
                    if (GeosApplication.Instance.IsPLMPermissionNameECOS_Synchronization == true)
                    {
                        GeosAppSettingList = WorkbenchService.GetSelectedGeosAppSettings("59,60,61");
                        if (GeosAppSettingList != null && GeosAppSettingList.Count != 0)
                        {
                            if (GeosAppSettingList.Any(i => i.IdAppSetting == 59) && GeosAppSettingList.Any(i => i.IdAppSetting == 60) && GeosAppSettingList.Any(i => i.IdAppSetting == 61) && UpdatedItem.IdStatus == 223)
                            {
                                if ((!string.IsNullOrEmpty((GeosAppSettingList[0].DefaultValue))) && (!string.IsNullOrEmpty((GeosAppSettingList[1].DefaultValue))) && (!string.IsNullOrEmpty((GeosAppSettingList[2].DefaultValue))))    //(!string.IsNullOrEmpty((GeosAppSettingList[0].DefaultValue))) // && (GeosAppSettingList[1].DefaultValue)))  //.Where(i => i.IdAppSetting == 57).Select(x => x.DefaultValue)))) // && (GeosAppSettingList[1].DefaultValue))) // Where(i => i.IdAppSetting == 57).FirstOrDefault().DefaultValue.to)
                                {

                                    #region synchronization Code
                                    //var ownerInfo = (obj as FrameworkElement);

                                    try
                                    {
                                        MessageBoxResult MessageBoxResult = MessageBoxResult = CustomMessageBox.Show(string.Format(Application.Current.Resources["ECOSSynchronizationWarningMessage"].ToString()), "Yellow", CustomMessageBox.MessageImagePath.Warning, MessageBoxButton.YesNo);
                                        if (MessageBoxResult == MessageBoxResult.Yes)
                                        {
                                            List<Articles> LstArticles = PCMService.GetAllStatusPCMArticles();
                                            if (!DXSplashScreen.IsActive)
                                            {
                                                DXSplashScreen.Show(x =>
                                                {
                                                    Window win = new Window()
                                                    {
                                                        Focusable = true,
                                                        ShowActivated = false,
                                                        WindowStyle = WindowStyle.None,
                                                        ResizeMode = ResizeMode.NoResize,
                                                        AllowsTransparency = false,
                                                        Background = new SolidColorBrush(Colors.Transparent),
                                                        ShowInTaskbar = false,
                                                        Topmost = false,
                                                        SizeToContent = SizeToContent.WidthAndHeight,
                                                        WindowStartupLocation = WindowStartupLocation.CenterScreen,
                                                    };
                                                    WindowFadeAnimationBehavior.SetEnableAnimation(win, true);
                                                    return win;
                                                }, x =>
                                                {
                                                    return new SplashScreenView() { DataContext = new SplashScreenViewModel() };
                                                }, null, null);
                                            }
                                            GeosApplication.Instance.SplashScreenMessage = "Synchronization is running";



                                            APIErrorDetailForErrorFalse valuesErrorFalse = new APIErrorDetailForErrorFalse();
                                            APIErrorDetail values = new APIErrorDetail();
                                            List<ErrorDetails> LstErrorDetail = new List<ErrorDetails>();
                                            tokenService = new AuthTokenService();
                                            if (GeosAppSettingList.Any(i => i.IdAppSetting == 59))
                                            {

                                                string[] tokeninformations = GeosAppSettingList.Where(i => i.IdAppSetting == 59).FirstOrDefault().DefaultValue.Split(';');
                                                if (tokeninformations.Count() >= 2)
                                                {

                                                    List<string> articlesSynchronization = new List<string>();


                                                    if (UpdatedItem.AddArticleList != null && UpdatedItem.AddArticleList.Count > 0)
                                                    {
                                                        foreach (CustomerPriceListByItem item in UpdatedItem.AddArticleList)
                                                        {
                                                            if (LstArticles.Any(i => i.IdArticle == item.IdArticle))
                                                                if (!articlesSynchronization.Any(asy => asy.ToUpper() == LstArticles.Where(i => i.IdArticle == item.IdArticle).FirstOrDefault().Reference.ToUpper()))
                                                                    articlesSynchronization.Add(LstArticles.Where(i => i.IdArticle == item.IdArticle).FirstOrDefault().Reference);
                                                        }
                                                    }
                                                    if (UpdatedItem.UpdateArticleList != null && UpdatedItem.UpdateArticleList.Count > 0)
                                                    {
                                                        foreach (CustomerPriceListByItem item in UpdatedItem.UpdateArticleList)
                                                        {
                                                            if (LstArticles.Any(i => i.IdArticle == item.IdArticle))
                                                                if (!articlesSynchronization.Any(asy => asy.ToUpper() == LstArticles.Where(i => i.IdArticle == item.IdArticle).FirstOrDefault().Reference.ToUpper()))
                                                                    articlesSynchronization.Add(LstArticles.Where(i => i.IdArticle == item.IdArticle).FirstOrDefault().Reference);
                                                        }
                                                    }
                                                    if (UpdatedItem.DeleteArticleList != null && UpdatedItem.DeleteArticleList.Count > 0)
                                                    {
                                                        foreach (Articles item in UpdatedItem.DeleteArticleList)
                                                        {
                                                            if (LstArticles.Any(i => i.IdArticle == item.IdArticle))
                                                                if (!articlesSynchronization.Any(asy => asy.ToUpper() == LstArticles.Where(i => i.IdArticle == item.IdArticle).FirstOrDefault().Reference.ToUpper()))
                                                                    articlesSynchronization.Add(LstArticles.Where(i => i.IdArticle == item.IdArticle).FirstOrDefault().Reference);
                                                        }
                                                    }

                                                    List<BPLPlantCurrencyDetail> BPLPlantCurrencyDetailList = new List<BPLPlantCurrencyDetail>();
                                                    BPLPlantCurrencyDetailList.AddRange(PLMService.GetBPLPlantCurrencyDetailByIdBPLAndIdCPL(0, "", UpdatedItem.IdCustomerPriceList.ToString(), "Detection"));
                                                    BPLPlantCurrencyDetailList.AddRange(PLMService.GetBPLPlantCurrencyDetailByIdBPLAndIdCPL(0, "", UpdatedItem.IdCustomerPriceList.ToString(), "Article"));

                                                    if (articlesSynchronization != null && articlesSynchronization.Count > 0 && BPLPlantCurrencyDetailList != null && BPLPlantCurrencyDetailList.Count > 0)
                                                    {

                                                        string references = string.Join(",", articlesSynchronization.ToArray());

                                                        if (GeosAppSettingList.Any(i => i.IdAppSetting == 61))
                                                        {

                                                            foreach (BPLPlantCurrencyDetail itemBasePriceListByPlantCurrency in BPLPlantCurrencyDetailList)
                                                            {


                                                                GeosApplication.Instance.SplashScreenMessage = "Articles Synchronization is running for plant " + itemBasePriceListByPlantCurrency.CompanyName + " and currency " + itemBasePriceListByPlantCurrency.CurrencyName + "";
                                                                List<ErrorDetails> TempLstErrorDetail = await PLMService.IsPLMUpdateEditCPLCustomerSynchronization(GeosAppSettingList, itemBasePriceListByPlantCurrency, LstArticles);

                                                                foreach (ErrorDetails item in TempLstErrorDetail)
                                                                {
                                                                    if (item != null && item.Error == string.Empty)
                                                                    {
                                                                        GeosApplication.Instance.SplashScreenMessage = "Articles Synchronization is Done for plant " + itemBasePriceListByPlantCurrency.CompanyName + " and currency " + itemBasePriceListByPlantCurrency.CurrencyName + "";
                                                                    }
                                                                    else
                                                                    {
                                                                        if (item != null && item.Error != null)
                                                                        {
                                                                            GeosApplication.Instance.SplashScreenMessage = "Articles Synchronization is failed for plant " + itemBasePriceListByPlantCurrency.CompanyName + " and currency " + itemBasePriceListByPlantCurrency.CurrencyName + "";
                                                                            ErrorDetails errorDetails = new ErrorDetails();
                                                                            errorDetails.CompanyName = itemBasePriceListByPlantCurrency.CompanyName;
                                                                            errorDetails.CurrencyName = itemBasePriceListByPlantCurrency.CurrencyName;
                                                                            errorDetails.Error = values.Message._Message;
                                                                            LstErrorDetail.Add(errorDetails);
                                                                        }
                                                                    }
                                                                }

                                                            }




                                                        }
                                                    }
                                                    if ((UpdatedItem.AddDetectionList != null && UpdatedItem.AddDetectionList.Count > 0) || (UpdatedItem.UpdateDetectionList != null && UpdatedItem.UpdateDetectionList.Count > 0) || (UpdatedItem.DeleteDetectionList != null && UpdatedItem.DeleteDetectionList.Count > 0))
                                                    {
                                                        if (GeosAppSettingList.Any(i => i.IdAppSetting == 60))
                                                        {
                                                            foreach (BPLPlantCurrencyDetail itemBasePriceListByPlantCurrency in BPLPlantCurrencyDetailList)
                                                            {
                                                                GeosApplication.Instance.SplashScreenMessage = "Detections Synchronization is running for plant " + itemBasePriceListByPlantCurrency.CompanyName + " and currency " + itemBasePriceListByPlantCurrency.CurrencyName + "";

                                                                List<ErrorDetails> TempLstErrorDetail = await PLMService.IsPLMUpdateEditCPLCustomerSynchronization(GeosAppSettingList, itemBasePriceListByPlantCurrency, LstArticles);

                                                                foreach (ErrorDetails item in TempLstErrorDetail)
                                                                {
                                                                    if (item != null && item.Error == string.Empty)
                                                                    {
                                                                        GeosApplication.Instance.SplashScreenMessage = "Detections Synchronization is done for plant " + itemBasePriceListByPlantCurrency.CompanyName + " and currency " + itemBasePriceListByPlantCurrency.CurrencyName + "";
                                                                    }
                                                                    else
                                                                    {
                                                                        if (item != null && item.Error != null)
                                                                        {
                                                                            GeosApplication.Instance.SplashScreenMessage = "Detections Synchronization is failed for plant " + itemBasePriceListByPlantCurrency.CompanyName + " and currency " + itemBasePriceListByPlantCurrency.CurrencyName + "";
                                                                            ErrorDetails errorDetails = new ErrorDetails();
                                                                            errorDetails.CompanyName = itemBasePriceListByPlantCurrency.CompanyName;
                                                                            errorDetails.CurrencyName = itemBasePriceListByPlantCurrency.CurrencyName;
                                                                            errorDetails.Error = values.Message._Message;
                                                                            LstErrorDetail.Add(errorDetails);
                                                                        }
                                                                    }
                                                                }


                                                            }


                                                        }
                                                    }

                                                    if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                                                    if (LstErrorDetail != null && LstErrorDetail.Count > 0)
                                                    {
                                                        String FinalMessage = null;
                                                        string msg = string.Empty;
                                                        foreach (ErrorDetails item in LstErrorDetail)
                                                        {

                                                            if (string.IsNullOrEmpty(FinalMessage))
                                                                FinalMessage = string.Format(System.Windows.Application.Current.FindResource("PLMSynchronizationFailedForFollowingReasons").ToString() + System.Environment.NewLine + string.Format(System.Windows.Application.Current.FindResource("PLMSynchronizationFailedCompanyCurrency").ToString(), item.CompanyName, item.CurrencyName, item.Error));
                                                            else
                                                                FinalMessage += System.Environment.NewLine + string.Format(System.Windows.Application.Current.FindResource("PLMSynchronizationFailedCompanyCurrency").ToString(), item.CompanyName, item.CurrencyName, item.Error);

                                                        }
                                                        if (!string.IsNullOrEmpty(FinalMessage))
                                                        {
                                                            CustomMessageBox.Show(FinalMessage, "Red", CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                                                        }
                                                    }
                                                    else
                                                    {
                                                        CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("ECOSSynchronizationSuccess").ToString()), Application.Current.Resources["PopUpSuccessColor"].ToString(), CustomMessageBox.MessageImagePath.Ok, MessageBoxButton.OK);
                                                    }

                                                }
                                            }
                                        }

                                        GeosApplication.Instance.Logger.Log(string.Format("Method Init()....executed AcceptButtonCommandAction"), category: Category.Info, priority: Priority.Low);
                                    }
                                    catch (Exception ex)
                                    {
                                        GeosApplication.Instance.SplashScreenMessage = "Synchronization failed";
                                        if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                                        CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("ECOSSynchronizationFailed").ToString(), ex.Message), "Red", CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);

                                    }
                                    GeosApplication.Instance.SplashScreenMessage = string.Empty;
                                    #endregion


                                }
                            }
                        }
                    }
                    #endregion
                    if (SaveButtonVisibility == Visibility.Visible && !isSaveButtonClicked)
                        RequestClose(null, null);
                    #endregion
                }
                GeosApplication.Instance.Logger.Log("Method AcceptButtonCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log(string.Format("Error in method AcceptButtonCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log(string.Format("Error in method AcceptButtonCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log(string.Format("Error in method AcceptButtonCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        /// <summary>
        /// AddChangeLog Method is used when we create a New Customer List
        /// </summary>
        /// [001] [vsana][11-12-2020][GEOS2-2561][Assign the customer group/region/Country/plant to the Customer Price List [#PLM26]]
        /// <param name="CPLCustomers"></param>
        private void AddChangeLogList(List<CPLCustomer> CPLCustomers)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method AddChangeLogList()...", category: Category.Info, priority: Priority.Low);
                if (CPLCustomers == null)
                    CPLCustomers = new List<CPLCustomer>();

                var RegionListGroupByGroupName = CPLCustomers.GroupBy(x => x.GroupName, (key, g) => new { GroupName = key, RegionList = g.ToList() });
                foreach (var eachGroupName in RegionListGroupByGroupName)
                {
                    RegionNames = string.Join(", ", eachGroupName.RegionList.ToList().Select(a => a.RegionName));
                    CountryNames = GetCountryListByGroupName(eachGroupName.GroupName, CPLCustomers);
                    PlantNames = GetPlantListByGroupName(eachGroupName.GroupName, CPLCustomers);
                    CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("CustomerPriceChangeLogAdd").ToString(), eachGroupName.GroupName, RegionNames, CountryNames, PlantNames) });
                }
                GeosApplication.Instance.Logger.Log("Method AddChangeLogList()... Executed Successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method AddChangeLogList()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        /// <summary>
        /// GetCountryListByGroupName Method is used to get the CountryNames of the particlar GroupName
        /// </summary>
        /// [001] [vsana][11-12-2020][GEOS2-2561][Assign the customer group/region/Country/plant to the Customer Price List [#PLM26]]
        /// <param name="groupName"></param>
        /// <param name="CPLCustomers"></param>
        /// <returns></returns>
        private string GetCountryListByGroupName(string groupName, List<CPLCustomer> CPLCustomers)
        {
            string Countries = string.Empty;
            try
            {
                GeosApplication.Instance.Logger.Log("Method GetCountryListByGroupName()....", category: Category.Info, priority: Priority.Low);
                if (CPLCustomers == null)
                    CPLCustomers = new List<CPLCustomer>();

                #region When we create a New Customer Price List
                if (IsNew)
                {
                    List<CPLCustomer> listWithSameGroups = CPLCustomers.Where(x => x.GroupName == groupName).ToList();
                    var countriess = listWithSameGroups.GroupBy(x => x.Country.Name).ToList();
                    foreach (var eachList in countriess)
                    {
                        if (string.IsNullOrEmpty(Countries))
                            Countries = eachList.Key;
                        else
                            Countries += ", " + eachList.Key;
                    }
                }
                #endregion

                #region When we Edit Customer Price List
                else
                {
                    foreach (var eachDelete in CPLCustomers)
                    {
                        if (!ModifiedCustomerList.Any(a => a.RegionName == eachDelete.RegionName && a.GroupName == eachDelete.GroupName))
                        {
                            if (string.IsNullOrEmpty(Countries))
                                Countries = eachDelete.Country.Name;
                            else
                                Countries += ", " + eachDelete.Country.Name;
                        }

                        if (!OriginalCustomerList.Any(a => a.RegionName == eachDelete.RegionName && a.GroupName == eachDelete.GroupName))
                        {
                            if (string.IsNullOrEmpty(Countries))
                                Countries = eachDelete.Country.Name;
                            else
                                Countries += ", " + eachDelete.Country.Name;
                        }
                    }
                }
                #endregion

                GeosApplication.Instance.Logger.Log("Method GetCountryListByGroupName()... Executed Successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method GetCountryListByGroupName()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
            return Countries;
        }

        /// <summary>
        /// GetPlantListByGroupName Method is used to get the PlantNames of the particular GroupName
        /// </summary>
        /// [001] [vsana][11-12-2020][GEOS2-2561][Assign the customer group/region/Country/plant to the Customer Price List [#PLM26]]
        /// <param name="groupName"></param>
        /// <param name="CPLCustomers"></param>
        /// <returns></returns>
        private string GetPlantListByGroupName(string groupName, List<CPLCustomer> CPLCustomers)
        {
            string Plants = string.Empty;
            try
            {
                GeosApplication.Instance.Logger.Log("Method GetPlantListByGroupName()....", category: Category.Info, priority: Priority.Low);
                if (CPLCustomers == null)
                    CPLCustomers = new List<CPLCustomer>();

                #region When we create New Customer Price List
                if (IsNew)
                {
                    List<CPLCustomer> listWithSameGroups = CPLCustomers.Where(x => x.GroupName == groupName).ToList();
                    var plants = listWithSameGroups.GroupBy(x => x.Plant.Name).ToList();
                    foreach (var eachList in plants)
                    {
                        if (string.IsNullOrEmpty(Plants))
                            Plants = eachList.Key;
                        else
                            Plants += ", " + eachList.Key;
                    }
                }
                #endregion

                #region When we Edit Customer Price List
                else
                {
                    foreach (var eachAdd in CPLCustomers)
                    {
                        if (!ModifiedCustomerList.Any(a => a.RegionName == eachAdd.RegionName && a.GroupName == eachAdd.GroupName))
                        {
                            if (string.IsNullOrEmpty(Plants))
                                Plants = eachAdd.Plant.Name;
                            else
                                Plants += ", " + eachAdd.Plant.Name;
                        }
                        if (!OriginalCustomerList.Any(a => a.RegionName == eachAdd.RegionName && a.GroupName == eachAdd.GroupName))
                        {
                            if (string.IsNullOrEmpty(Plants))
                                Plants = eachAdd.Plant.Name;
                            else
                                Plants += ", " + eachAdd.Plant.Name;
                        }
                    }
                }
                #endregion

                GeosApplication.Instance.Logger.Log("Method GetPlantListByGroupName()... Executed Successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method GetPlantListByGroupName()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
            return Plants;
        }

        private void ChangeStatusCommandAction(object obj)
        {
            ComboBoxEdit value = ((System.Windows.RoutedEventArgs)obj).OriginalSource as ComboBoxEdit;

            //if (value.DisplayText == SelectedStatus.Value)
            //[Sudhir.Jangra][GEOS2-3349][27/12/2022]
            if (ClonedCustomerPrice != null && isDuplicateClicked == false && value.DisplayText == SelectedStatus.Value)
            {
                return;
            }
            if (ClonedCustomerPrice != null && isDuplicateClicked == false && ClonedBasePrice.IsBPLExistInCPL == true)
            {
                string CPLCodes = PLMService.GetCustomerPriceCodesByBPL(ClonedBasePrice.IdBasePriceList);
                CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("CantChangeWithCPLValidation").ToString(), CPLCodes), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                SelectedStatus = StatusList.FirstOrDefault(x => x.IdLookupValue == ClonedBasePrice.Status.IdLookupValue);
                return;
            }
            IsEnabledSaveButton = true;
            //if (oldSelectedStatus == null) oldSelectedStatus = SelectedStatus.Value;
            //if (SelectedStatus != null && SelectedStatus.Value != oldSelectedStatus)
            //{
            //oldSelectedStatus = SelectedStatus.Value;
            //}
        }
        private void ChangeEffectiveDateCommandAction()
        {
            if (oldEffectiveDate == null)
            {
                oldEffectiveDate = EffectiveDate;
            }
            else
            {
                if (oldEffectiveDate != EffectiveDate)
                {
                    oldEffectiveDate = EffectiveDate;
                    IsEnabledSaveButton = true;
                }
            }
        }
        private void ChangeExpiryDateCommandAction()
        {
            if (oldExpiryDate == null)
            {
                oldExpiryDate = ExpiryDate;
            }
            else
            {
                if (oldExpiryDate != expiryDate)
                {
                    oldExpiryDate = ExpiryDate;
                    IsEnabledSaveButton = true;
                }
            }
        }
        private void ChangeCheckAllLanguagesCommandAction()
        {
            if (oldIsCheckedAllLanguages != null && oldIsCheckedAllLanguages != IsCheckedAllLanguages)
            { oldIsCheckedAllLanguages = IsCheckedAllLanguages; IsEnabledSaveButton = true; }
        }

        private void SelectionChangedArticleDetectionGridCommandAction(object obj)
        {
            var tab = obj as DXTabControl;
            if (tab != null)
                isArticleGrid = tab.SelectedIndex == 0 ? true : false;
        }
        private void OnEffectiveDateEditValueChanging(EditValueChangingEventArgs obj)
        {
            try
            {
                if (EffectiveDate != null && ExpiryDate != null)
                {
                    if (EffectiveDate > ExpiryDate)
                    {
                        effectiveDateErrorMessage = System.Windows.Application.Current.FindResource("EffectiveAndExpiryValidationCPL").ToString();
                        expiryDateErrorMessage = System.Windows.Application.Current.FindResource("ExpiryValidationCPL").ToString();
                    }
                    else
                    {
                        effectiveDateErrorMessage = string.Empty;
                        expiryDateErrorMessage = string.Empty;
                        informationError = null;
                    }

                    error = EnableValidationAndGetError();
                    PropertyChanged(this, new PropertyChangedEventArgs("EffectiveDate"));
                    PropertyChanged(this, new PropertyChangedEventArgs("ExpiryDate"));
                    PropertyChanged(this, new PropertyChangedEventArgs("InformationError"));
                }
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Get an Error in Method OnEffectiveDateEditValueChanging() - {0}", ex.Message), category: Category.Info, priority: Priority.Low);
            }
        }
		//[nsatpute][28-05-2025][GEOS2-6689]
        private void BasePriceSelectedIndexChangedCommandAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method BasePriceSelectedIndexChangedCommandAction ...", category: Category.Info, priority: Priority.Low);
                ComboBoxEdit value = ((System.Windows.RoutedEventArgs)obj).OriginalSource as ComboBoxEdit;

                if (ClonedBasePrice != null && value.EditText == SelectedBasePriceName.Name)
                {
                    return;
                }

                if (SelectedBasePriceName.IdBasePriceList != 0)
                {
                    if (!DXSplashScreen.IsActive)
                    {
                        DXSplashScreen.Show(x =>
                        {
                            Window win = new Window()
                            {
                                ShowActivated = false,
                                WindowStyle = WindowStyle.None,
                                ResizeMode = ResizeMode.NoResize,
                                AllowsTransparency = true,
                                Background = new SolidColorBrush(Colors.Transparent),
                                ShowInTaskbar = false,
                                Topmost = true,
                                SizeToContent = SizeToContent.WidthAndHeight,
                                WindowStartupLocation = WindowStartupLocation.CenterScreen,
                            };
                            WindowFadeAnimationBehavior.SetEnableAnimation(win, true);
                            win.Topmost = false;
                            return win;
                        }, x =>
                        {
                            return new SplashScreenView() { DataContext = new SplashScreenViewModel() };
                        }, null, null);
                    }
                    //Shubham[skadam] GEOS2-4300 [ Only Modules ] Able to add and access to the tab Modules/Detections/Articles a Customer Price List [3/3] [#PLM25] 20 04 2023
                    //BasePrice temp = (PLMService.GetBasePriceDetailById_ForCPL_V2160(SelectedBasePriceName.IdBasePriceList));
                    BasePrice temp = new BasePrice();
                    if (initialBasePrice != null)
                    {
                        temp = (BasePrice)initialBasePrice.Clone();
                        initialBasePrice = null;
                    }
                    else
                    {
                        temp = (PLMService.GetBasePriceDetailById_ForCPL_V2650(SelectedBasePriceName.IdBasePriceList));
                        //[nsatpute][28.05.2025][GEOS2-6689]
                        if (CurrencyList != null)
                            SelectedCurrency = CurrencyList.FirstOrDefault(x => x.IdCurrency == temp.IdCurrency);
                        var tasks = new List<Task>() { Task.Run(() => FillArticleCostPriceList(((Currency)SelectedCurrency).IdCurrency)), Task.Run(() => FillCurrencyConversionList_All()) };
                        Task.WaitAll(tasks.ToArray());
                    }
                    ClonedBasePrice = (BasePrice)temp.Clone();
                    IdExchangeRateUpdateType = temp.IdExchangeRateUpdateType;
                    SelectedExchangeRate = temp.ExchangeRateUpdateType;
                    IdBasePrice = temp.IdBasePriceList;
                    SelectedBasePriceName.Name = temp.Name;
                    IdCurrency = temp.IdCurrency;
                    if (temp.Currency == null)
                        temp.Currency = new Currency();
                    CurrencyName = temp.Currency.Name;
                    temp.Currency.CurrencyIconImage = ByteArrayToBitmapImage(temp.Currency.CurrencyIconbytes);
                    CurrencyIcon = temp.Currency.CurrencyIconImage;

                    if (temp.ExpiryDate != DateTime.MinValue)
                    {
                        ExpiryDate = temp.ExpiryDate;
                    }
                    if (temp.EffectiveDate != DateTime.MinValue)
                    {
                        EffectiveDate = temp.EffectiveDate;
                    }

                    SaleCurrencyList = new ObservableCollection<Currency>(temp.CurrencyList);
                    if (SaleCurrencyList != null)
                    {
                        foreach (var bpItem in SaleCurrencyList.GroupBy(tpa => tpa.Name))
                        {
                            ImageSource currencyFlagImage = ByteArrayToBitmapImage(bpItem.ToList().FirstOrDefault().CurrencyIconbytes);
                            bpItem.ToList().Where(oti => oti.Name == bpItem.Key).ToList().ForEach(oti => oti.CurrencyIconImage = currencyFlagImage);
                        }
                    }
                    DtArticle = null;

                    SelectedArticle = new PCMArticleCategory();
                    //14-12-2020	
                    SelectedPlant = new List<object>();
                    foreach (Site plant in temp.PlantList)
                    {
                        SelectedPlant.Add(plant);
                    }
                    SelectedPlant = new List<object>(SelectedPlant);
                    SelectedPlant_Copy = new List<object>(SelectedPlant);

                    if (CurrencyList != null)
                        SelectedCurrency = CurrencyList.FirstOrDefault(x => x.IdCurrency == temp.IdCurrency);

                    IsCheckedBasePrice = true;
                    IsCheckedCustomerPrice = true;
                    MyFilterString = string.Empty;
		

                    if (WindowHeader == System.Windows.Application.Current.FindResource("EditCustomerPriceList").ToString() && ClonedCustomerPrice.IdBasePriceList == SelectedBasePriceName.IdBasePriceList)
                    {
                        SavedArticles = new List<CustomerPriceListByItem>(ClonedCustomerPrice.CustomerPriceListItems);
                        SavedDetections = new List<CustomerPriceListByItem>(ClonedCustomerPrice.CustomerPriceListDetections);

                        SavedModules = new List<CustomerPriceListByItem>(ClonedCustomerPrice.CustomerPriceListModules);

                        ArticleList = new ObservableCollection<CustomerPriceListByItem>(temp.BasePriceListItems_ForCPL);
                        DetectionList = new ObservableCollection<CustomerPriceListByItem>(temp.BasePriceListDetections_ForCPL);
                        ModuleList = new ObservableCollection<CustomerPriceListByItem>(temp.BasePriceListModules_ForCPL);

                        SelectedSaleCurrency = new List<object>();
                        foreach (byte IdCurrency in ClonedCustomerPrice.CurrencyList.Select(a => a.IdCurrency).Distinct())
                        {
                            SelectedSaleCurrency.Add(SaleCurrencyList.FirstOrDefault(a => a.IdCurrency == IdCurrency));
                        }
                        SelectedSaleCurrency = new List<object>(SelectedSaleCurrency);
                        SelectedSaleCurrency_Copy = new List<object>(SelectedSaleCurrency);
                        AddColumnsToArticleDataTable();
                        FillArticleData();
                                                
                        AddColumnsToDetectionDataTable();
                        FillDetectionData();
                        try
                        {
                            AddColumnsToModuleDataTable();
                            FillModuleData();
                        }
                        catch (Exception ex)
                        {
                        }
                    }
                    else
                    {
                        ArticleList = new ObservableCollection<CustomerPriceListByItem>(temp.BasePriceListItems_ForCPL);
                        DetectionList = new ObservableCollection<CustomerPriceListByItem>(temp.BasePriceListDetections_ForCPL);
                        ModuleList = new ObservableCollection<CustomerPriceListByItem>(temp.BasePriceListModules_ForCPL);

                        SelectedSaleCurrency = new List<object>();
                        foreach (Currency currency in SaleCurrencyList)
                        {
                            SelectedSaleCurrency.Add(currency);
                        }
                        SelectedSaleCurrency = new List<object>(SelectedSaleCurrency);
                        SelectedSaleCurrency_Copy = new List<object>(SelectedSaleCurrency);
                        AddColumnsToArticleDataTable();
                        FillArticleData();

                        AddColumnsToDetectionDataTable();
                        FillDetectionData();

                        try
                        {
                            AddColumnsToModuleDataTable();
                            FillModuleData();
                        }
                        catch (Exception ex)
                        {
                        }
                    }
                    SelectedCurrency_Copy = SelectedCurrency;
                }
                if (oldSelectedIndexValue == null)
                {
                    oldSelectedIndexValue = value.EditText;
                }
                else
                {
                    if (oldSelectedIndexValue != value.EditText)
                    {
                        oldSelectedIndexValue = value.EditText;
                        IsEnabledSaveButton = true;
                    }
                }

                if ((ArticleList != null && ArticleList.Count == 0) && (DetectionList != null && DetectionList.Count == 0))
                {
                    if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                }
                // shubham[skadam] GEOS2-3272 Custom filters in the BPL and CPL grid [#PLM39] 01 12 2022
                try
                {
                    //FillFilterTileBar();
                    AddCustomSetting();
                    //DetectionFillFilterTileBar();
                    DetectionAddCustomSetting();
                    ModuleAddCustomSetting();
                }
                catch (Exception ex)
                {
                }
                GeosApplication.Instance.Logger.Log("Method BasePriceSelectedIndexChangedCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }//[Sudhir.Jangra][GEOS-4105][29/12/2022]
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log(string.Format("Error in method BasePriceSelectedIndexChangedCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log(string.Format("Error in method BasePriceSelectedIndexChangedCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log(string.Format("Error in method BasePriceSelectedIndexChangedCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void AddColumnsToDetectionDataTableBySaleCurrency()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method AddColumnsToDetectionDataTableBySaleCurrency ...", category: Category.Info, priority: Priority.Low);
                if (SelectedSaleCurrency == null)
                    SelectedSaleCurrency = new List<object>();
                if (SelectedCurrency == null)
                    SelectedCurrency = new List<object>();

                if (DetectionBands.Count > 0)
                {
                    foreach (BandItem bandItem in DetectionBands)
                    {
                        if (bandItem.BandHeader == "Sale Price")
                        {
                            foreach (Currency currency in SelectedSaleCurrency)
                            {
                                if (!bandItem.Columns.Any(a => a.HeaderText == currency.Name))
                                {
                                    string fieldName = currency.Name;
                                    DtDetectionCopy.Columns.Add(fieldName, typeof(double));
                                    bandItem.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = fieldName, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                    DtDetectionCopy.Columns.Add("CurrencyConversionRate_" + currency.Name, typeof(double));
                                }
                            }
                            List<ColumnItem> columns = new List<ColumnItem>(bandItem.Columns);
                            if (bandItem.Columns.Count != SelectedSaleCurrency.Count)
                            {
                                foreach (ColumnItem columnItem in columns.ToList())
                                {
                                    if (!SelectedSaleCurrency.Cast<Currency>().Any(a => a.Name == columnItem.HeaderText))
                                    {
                                        string fieldName = columnItem.HeaderText;
                                        DtDetectionCopy.Columns.Remove(fieldName);
                                        bandItem.Columns.Remove(columnItem);

                                        DtDetectionCopy.Columns.Remove("CurrencyConversionRate_" + fieldName);
                                    }
                                }
                            }
                            if (!SelectedSaleCurrency.Cast<Currency>().Any(a => a.Name == ((Currency)SelectedCurrency).Name))
                            {
                                SelectedSaleCurrency.Add(SaleCurrencyList.FirstOrDefault(a => a.Name == ((Currency)SelectedCurrency).Name));
                                SelectedSaleCurrency = new List<object>(SelectedSaleCurrency);
                                string fieldName = "Common_Cur";
                                DtDetectionCopy.Columns.Remove(fieldName);
                                DtDetectionCopy.Columns.Add(fieldName, typeof(double));
                                bandItem.Columns.Remove(bandItem.Columns.FirstOrDefault(a => a.ColumnFieldName == fieldName));
                                bandItem.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });

                                DtDetectionCopy.Columns.Remove("CurrencyConversionRate_" + fieldName);
                                DtDetectionCopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));


                                string fieldName1 = ((Currency)SelectedCurrency_Copy).Name;
                                DtDetectionCopy.Columns.Add(fieldName1, typeof(double));
                                bandItem.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName1, HeaderText = fieldName1, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                DtDetectionCopy.Columns.Add("CurrencyConversionRate_" + fieldName1, typeof(double));

                                SelectedSaleCurrency_Copy = SelectedSaleCurrency;
                            }
                        }
                    }

                    // reorder by common currency
                    BandItem item = DetectionBands.FirstOrDefault(a => a.BandHeader == "Sale Price");
                    if (item.Columns.FirstOrDefault().HeaderText != ((Currency)SelectedCurrency).Name)
                    {
                        int count = 0;
                        foreach (Currency item1 in SelectedSaleCurrency.Cast<Currency>())
                        {
                            if (count == 0)
                            {
                                count = 1;
                                //string fieldName = ((Currency)SelectedCurrency).Name;
                                string fieldName = "Common_Cur";
                                DtDetectionCopy.Columns.Remove(fieldName);
                                DtDetectionCopy.Columns.Add(fieldName, typeof(double));
                                item.Columns.Remove(item.Columns.FirstOrDefault(a => a.ColumnFieldName == fieldName));
                                item.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                DtDetectionCopy.Columns.Remove("CurrencyConversionRate_" + fieldName);
                                DtDetectionCopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));

                                if (DtDetectionCopy.Columns.Contains(((Currency)SelectedCurrency).Name))
                                    DtDetectionCopy.Columns.Remove(((Currency)SelectedCurrency).Name);

                                if (DtDetectionCopy.Columns.Contains("CurrencyConversionRate_" + ((Currency)SelectedCurrency).Name))
                                    DtDetectionCopy.Columns.Remove("CurrencyConversionRate_" + ((Currency)SelectedCurrency).Name);

                                item.Columns.Remove(item.Columns.FirstOrDefault(a => a.ColumnFieldName == ((Currency)SelectedCurrency).Name));

                                if (item1.Name != ((Currency)SelectedCurrency).Name)
                                {
                                    string fieldName1 = item1.Name;
                                    if (DtDetectionCopy.Columns.Contains(fieldName1))
                                        DtDetectionCopy.Columns.Remove(fieldName1);

                                    DtDetectionCopy.Columns.Add(fieldName1, typeof(double));
                                    item.Columns.Remove(item.Columns.FirstOrDefault(a => a.ColumnFieldName == fieldName1));
                                    item.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName1, HeaderText = fieldName1, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });

                                    if (DtDetectionCopy.Columns.Contains("CurrencyConversionRate_" + fieldName1))
                                        DtDetectionCopy.Columns.Remove("CurrencyConversionRate_" + fieldName1);

                                    DtDetectionCopy.Columns.Add("CurrencyConversionRate_" + fieldName1, typeof(double));
                                }
                            }
                            else
                            {
                                if (item1.Name != ((Currency)SelectedCurrency).Name)
                                {
                                    string fieldName = item1.Name;
                                    if (DtDetectionCopy.Columns.Contains(fieldName))
                                        DtDetectionCopy.Columns.Remove(fieldName);

                                    DtDetectionCopy.Columns.Add(fieldName, typeof(double));
                                    item.Columns.Remove(item.Columns.FirstOrDefault(a => a.ColumnFieldName == fieldName));
                                    item.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = fieldName, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });

                                    if (DtDetectionCopy.Columns.Contains("CurrencyConversionRate_" + fieldName))
                                        DtDetectionCopy.Columns.Remove("CurrencyConversionRate_" + fieldName);

                                    DtDetectionCopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));
                                }
                            }
                        }
                    }

                    DetectionBands = new ObservableCollection<BandItem>(DetectionBands);
                }
                else
                {
                    DetectionBands.Clear();
                    BandItem band1 = new BandItem() { BandName = "All", AllowBandMove = false, FixedStyle = FixedStyle.Left, Visible = true, AllowMoving = DevExpress.Utils.DefaultBoolean.False };
                    band1.Columns = new ObservableCollection<ColumnItem>();
                    band1.Columns.Add(new ColumnItem() { ColumnFieldName = "IsChecked", HeaderText = " ", Width = 50, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    band1.Columns.Add(new ColumnItem() { ColumnFieldName = "Code", HeaderText = "Code", Width = 100, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    DetectionBands.Add(band1);

                    BandItem band2 = new BandItem() { BandName = "All1", BandHeader = "" };
                    band2.Columns = new ObservableCollection<ColumnItem>();
                    band2.Columns.Add(new ColumnItem() { ColumnFieldName = "Name", HeaderText = "Name", Width = 350, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    band2.Columns.Add(new ColumnItem() { ColumnFieldName = "Type", HeaderText = "Type", Width = 100, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    band2.Columns.Add(new ColumnItem() { ColumnFieldName = "STAT", HeaderText = "STAT", Width = 40, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    DetectionBands.Add(band2);


                    DtDetectionCopy = new DataTable();
                    DtDetectionCopy.Columns.Add("IsChecked", typeof(bool));
                    DtDetectionCopy.Columns.Add("Code", typeof(string));
                    DtDetectionCopy.Columns.Add("Type", typeof(string));
                    DtDetectionCopy.Columns.Add("Name", typeof(string));
                    DtDetectionCopy.Columns.Add("STAT", typeof(string));
                    DtDetectionCopy.Columns.Add("HtmlColor", typeof(string));
                    DtDetectionCopy.Columns.Add("IdDetection", typeof(UInt32));
                    DtDetectionCopy.Columns.Add("CurrencyConversionDate", typeof(DateTime));
                    DtDetectionCopy.Columns.Add("Name_Old", typeof(string));
                    DtDetectionCopy.Columns.Add("Name_Changed", typeof(bool));
                    DtDetectionCopy.Columns.Add("Visible_Customer", typeof(bool)).DefaultValue = false;
                    DtDetectionCopy.Columns.Add("Enable_VisibleCustomer", typeof(bool)).DefaultValue = false;
                    DtDetectionCopy.Columns.Add("Enable_DescriptionLinked", typeof(bool)).DefaultValue = false;
                    DtDetectionCopy.Columns.Add("Enable_Delete", typeof(bool)).DefaultValue = false;
                    DtDetectionCopy.Columns.Add("SaleCurrencyConversionDate", typeof(string));

                    //max cost	
                    BandItem band3 = new BandItem() { BandName = "max cost", BandHeader = "Max Cost" };
                    band3.Columns = new ObservableCollection<ColumnItem>();
                    string fieldName2 = "MaxCost_1";
                    DtDetectionCopy.Columns.Add(fieldName2, typeof(double));
                    band3.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName2, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });
                    //Base price	
                    BandItem band4 = new BandItem() { BandName = "base price", BandHeader = "Base Price" };
                    band4.Columns = new ObservableCollection<ColumnItem>();
                    string fieldName5 = "BasePriceValue";
                    DtDetectionCopy.Columns.Add(fieldName5, typeof(double));
                    band4.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName5, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });
                    DetectionBands.Add(band4);
                    //rule	
                    BandItem band5 = new BandItem() { BandName = "rule", BandHeader = "Rule" };
                    band5.Columns = new ObservableCollection<ColumnItem>();
                    string fieldName3 = "Value";
                    DtDetectionCopy.Columns.Add("Value", typeof(float));
                    band5.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName3, HeaderText = fieldName3, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });
                    string fieldName4 = "Logic";
                    DtDetectionCopy.Columns.Add(fieldName4, typeof(int));
                    band5.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName4, HeaderText = fieldName4, Width = 50, Visible = true, IsVertical = false, Settings = SettingsType.Default });
                    DetectionBands.Add(band5);
                    //Sale Currency	
                    BandItem band6 = new BandItem() { BandName = "sale price", BandHeader = "Sale Price" };
                    band6.Columns = new ObservableCollection<ColumnItem>();
                    int count = 0;
                    foreach (Currency currency in SelectedSaleCurrency)
                    {
                        // code modified for reorder by common currency 
                        if (count == 0)
                        {
                            count = 1;
                            string fieldName = "Common_Cur";
                            DtDetectionCopy.Columns.Add(fieldName, typeof(double));
                            band6.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                            DtDetectionCopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));

                            if (currency.Name != ((Currency)SelectedCurrency).Name)
                            {
                                string fieldName1 = currency.Name;
                                DtDetectionCopy.Columns.Add(fieldName1, typeof(double));
                                band6.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName1, HeaderText = fieldName1, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                DtDetectionCopy.Columns.Add("CurrencyConversionRate_" + fieldName1, typeof(double));
                            }
                        }
                        else
                        {
                            if (currency.Name != ((Currency)SelectedCurrency).Name)
                            {
                                string fieldName1 = currency.Name;
                                DtDetectionCopy.Columns.Add(fieldName1, typeof(double));
                                band6.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName1, HeaderText = fieldName1, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                DtDetectionCopy.Columns.Add("CurrencyConversionRate_" + fieldName1, typeof(double));
                            }
                        }
                    }
                    DetectionBands.Add(band6);
                    BandItem band7 = new BandItem() { BandName = "All2", AllowBandMove = false, Visible = true, AllowMoving = DevExpress.Utils.DefaultBoolean.False, AllowPrinting = false };
                    band7.Columns = new ObservableCollection<ColumnItem>();
                    band7.Columns.Add(new ColumnItem() { ColumnFieldName = "Delete", HeaderText = " ", Width = 50, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    DetectionBands.Add(band7);
                }
                DetectionBands = new ObservableCollection<BandItem>(DetectionBands);
                DtDetection = DtDetectionCopy;
                GeosApplication.Instance.Logger.Log("Method AddColumnsToDetectionDataTableBySaleCurrency executed Successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in AddColumnsToDetectionDataTableBySaleCurrency() method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), "Red", CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in AddColumnsToDetectionDataTableBySaleCurrency() Method - ServiceUnexceptedException " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in AddColumnsToDetectionDataTableBySaleCurrency() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        private void AddColumnsToDetectionDataTable()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method AddColumnsToDetectionDataTable ...", category: Category.Info, priority: Priority.Low);
                if (SelectedSaleCurrency == null)
                    SelectedSaleCurrency = new List<object>();
                if (SelectedCurrency == null)
                    SelectedCurrency = new List<object>();
                DetectionBands.Clear();
                BandItem band1 = new BandItem() { BandName = "All", AllowBandMove = false, FixedStyle = FixedStyle.Left, Visible = true, AllowMoving = DevExpress.Utils.DefaultBoolean.False };
                band1.Columns = new ObservableCollection<ColumnItem>();
                band1.Columns.Add(new ColumnItem() { ColumnFieldName = "IsChecked", HeaderText = " ", Width = 50, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                band1.Columns.Add(new ColumnItem() { ColumnFieldName = "VisibleCustomer", HeaderText = " ", Width = 40, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                band1.Columns.Add(new ColumnItem() { ColumnFieldName = "Code", HeaderText = "Code", Width = 100, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                DetectionBands.Add(band1);

                BandItem band2 = new BandItem() { BandName = "All1", BandHeader = "" };
                band2.Columns = new ObservableCollection<ColumnItem>();
                band2.Columns.Add(new ColumnItem() { ColumnFieldName = "Name", HeaderText = "Name", Width = 350, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                band2.Columns.Add(new ColumnItem() { ColumnFieldName = "NameChanged", HeaderText = " ", Width = 40, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                band2.Columns.Add(new ColumnItem() { ColumnFieldName = "Type", HeaderText = "Type", Width = 100, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                band2.Columns.Add(new ColumnItem() { ColumnFieldName = "STAT", HeaderText = "STAT", Width = 40, IsVertical = false, Settings = SettingsType.Default, Visible = true });

                DetectionBands.Add(band2);

                DtDetectionCopy = new DataTable();
                DtDetectionCopy.Columns.Add("IsChecked", typeof(bool));
                DtDetectionCopy.Columns.Add("VisibleCustomer", typeof(string));
                DtDetectionCopy.Columns.Add("Code", typeof(string));
                DtDetectionCopy.Columns.Add("Type", typeof(string));
                DtDetectionCopy.Columns.Add("STAT", typeof(string));
                DtDetectionCopy.Columns.Add("HtmlColor", typeof(string));
                DtDetectionCopy.Columns.Add("Name", typeof(string));
                DtDetectionCopy.Columns.Add("IdDetection", typeof(UInt32));
                DtDetectionCopy.Columns.Add("CurrencyConversionDate", typeof(DateTime));
                DtDetectionCopy.Columns.Add("Name_Old", typeof(string));
                DtDetectionCopy.Columns.Add("Name_Changed", typeof(bool));
                DtDetectionCopy.Columns.Add("Visible_Customer", typeof(bool)).DefaultValue = false;
                DtDetectionCopy.Columns.Add("Enable_VisibleCustomer", typeof(bool)).DefaultValue = false;
                DtDetectionCopy.Columns.Add("Enable_DescriptionLinked", typeof(bool)).DefaultValue = false;
                DtDetectionCopy.Columns.Add("IsColor", typeof(bool)).DefaultValue = false;
                DtDetectionCopy.Columns.Add("IsSalePriceValueColor", typeof(bool)).DefaultValue = false;
                DtDetectionCopy.Columns.Add("NameChanged", typeof(string)).DefaultValue = "Not Changed";
                DtDetectionCopy.Columns.Add("Enable_Delete", typeof(bool)).DefaultValue = false;
                DtDetectionCopy.Columns.Add("IsUpdatedRow", typeof(bool)).DefaultValue = false;
                DtDetectionCopy.Columns.Add("SaleCurrencyConversionDate", typeof(string));

                //max cost	
                BandItem band3 = new BandItem() { BandName = "max cost", BandHeader = "Max Cost" };
                band3.Columns = new ObservableCollection<ColumnItem>();
                string fieldName2 = "MaxCost_1";
                DtDetectionCopy.Columns.Add(fieldName2, typeof(double));
                band3.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName2, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.MaxCost });
                DetectionBands.Add(band3);
                //Base price	
                BandItem band4 = new BandItem() { BandName = "base price", BandHeader = "Base Price" };
                band4.Columns = new ObservableCollection<ColumnItem>();
                string fieldName5 = "BasePriceValue";
                DtDetectionCopy.Columns.Add(fieldName5, typeof(double));
                band4.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName5, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });
                DetectionBands.Add(band4);
                //rule	
                BandItem band5 = new BandItem() { BandName = "rule", BandHeader = "Rule" };
                band5.Columns = new ObservableCollection<ColumnItem>();
                string fieldName3 = "Value";
                DtDetectionCopy.Columns.Add("Value", typeof(float));
                band5.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName3, HeaderText = fieldName3, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });
                string fieldName4 = "Logic";
                DtDetectionCopy.Columns.Add(fieldName4, typeof(int));
                band5.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName4, HeaderText = fieldName4, Width = 50, Visible = true, IsVertical = false, Settings = SettingsType.Default });
                DetectionBands.Add(band5);
                //Sale Currency	
                BandItem band6 = new BandItem() { BandName = "sale price", BandHeader = "Sale Price" };
                band6.Columns = new ObservableCollection<ColumnItem>();
                int count = 0;
                foreach (Currency currency in SelectedSaleCurrency)
                {
                    // code modified for reorder by common currency 
                    if (count == 0)
                    {
                        count = 1;
                        string fieldName = "Common_Cur";
                        DtDetectionCopy.Columns.Add(fieldName, typeof(double));
                        band6.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                        DtDetectionCopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));

                        if (currency.Name != ((Currency)SelectedCurrency).Name)
                        {
                            string fieldName1 = currency.Name;
                            DtDetectionCopy.Columns.Add(fieldName1, typeof(double));
                            band6.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName1, HeaderText = fieldName1, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                            DtDetectionCopy.Columns.Add("CurrencyConversionRate_" + fieldName1, typeof(double));
                        }
                    }
                    else
                    {
                        if (currency.Name != ((Currency)SelectedCurrency).Name)
                        {
                            string fieldName1 = currency.Name;
                            DtDetectionCopy.Columns.Add(fieldName1, typeof(double));
                            band6.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName1, HeaderText = fieldName1, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                            DtDetectionCopy.Columns.Add("CurrencyConversionRate_" + fieldName1, typeof(double));
                        }
                    }
                }
                DetectionBands.Add(band6);

                // Profit
                BandItem band7 = new BandItem() { BandName = "All2", BandHeader = "" };
                band7.Columns = new ObservableCollection<ColumnItem>();
                band7.Columns.Add(new ColumnItem() { ColumnFieldName = "Profit", HeaderText = "Profit", Width = 100, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                DtDetectionCopy.Columns.Add("Profit", typeof(double));
                DetectionBands.Add(band7);

                // Cost Margin
                BandItem band8 = new BandItem() { BandName = "All3", BandHeader = "" };
                band8.Columns = new ObservableCollection<ColumnItem>();
                band8.Columns.Add(new ColumnItem() { ColumnFieldName = "CostMargin", HeaderText = "Cost Margin", Width = 100, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                DtDetectionCopy.Columns.Add("CostMargin", typeof(double));
                DetectionBands.Add(band8);

                BandItem band9 = new BandItem() { BandName = "All4", AllowBandMove = false, Visible = true, AllowMoving = DevExpress.Utils.DefaultBoolean.False, AllowPrinting = false };
                band9.Columns = new ObservableCollection<ColumnItem>();
                band9.Columns.Add(new ColumnItem() { ColumnFieldName = "Delete", HeaderText = " ", Width = 50, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                DetectionBands.Add(band9);

                DetectionBands = new ObservableCollection<BandItem>(DetectionBands);
                DtDetection = DtDetectionCopy;
                GeosApplication.Instance.Logger.Log("Method AddColumnsToDetectionDataTable executed Successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in AddColumnsToDetectionDataTable() method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), "Red", CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in AddColumnsToDetectionDataTable() Method - ServiceUnexceptedException " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in AddColumnsToDetectionDataTable() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }


        /// <summary>
        /// This method will unselect all the selected letters.
        /// [001] [vsana][11-12-2020][GEOS2-2561] Assign the customer group/ region/Country/ plant to the Customer Price List [#PLM26]
        /// </summary>
        private void SelectAllAction(object obj)
        {
            SelectedLetter = null;
        }

        /// <summary>
        /// This method will check the IsChecked true or false and update to the UI.
        /// [001] [vsana][11-12-2020][GEOS2-2561] Assign the customer group/ region/Country/ plant to the Customer Price List [#PLM26]
        /// </summary>
        private void SelectedItemChangedCommandAction(object obj)
        {
            if (WindowHeader != System.Windows.Application.Current.FindResource("AddCustomerPriceList").ToString())
            {
                List<CPLCustomer> List = new List<CPLCustomer>(ClonedCustomerPrice.CustomerList.Where(x => x.IsChecked == true).ToList());
                List<CPLCustomer> List1 = new List<CPLCustomer>(CPLCustomerList.Where(x => x.IsChecked == true).ToList());

                CPLCustomer customer = (CPLCustomer)obj;

                if (List.Any(a => a.IdGroup == customer.IdGroup && a.IdRegion == customer.IdRegion && a.IsChecked == customer.IsChecked) || List.Count() == List1.Count())
                {
                    HashSet<string> IdUniques = new HashSet<string>(List.Select(s => s.UniqueId));

                    var results = List1.Where(m => !IdUniques.Contains(m.UniqueId));
                    if (results.Count() > 0 || List1.Count() != List.Count())
                    {
                        IsExportVisible = Visibility.Collapsed;
                    }
                    else
                    {
                        IsExportVisible = Visibility.Visible;
                    }
                }
                else
                    IsExportVisible = Visibility.Collapsed;


                IsCellChecked = true;
                if (customer.IsChecked)
                {
                    IsCheckedCustomer = true;
                }
                else
                {
                    IsCheckedCustomer = false;
                }
                IsCellChecked = false;
            }
        }

        /// <summary>
        /// This method will Export the Customer List to Excel Sheet and Save the File in Local.
        /// [001] [vsana][11-12-2020][GEOS2-2561] Assign the customer group/ region/Country/ plant to the Customer Price List [#PLM26]
        /// </summary>
        private void ExportToExcelCustomers(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ExportToExcelCustomers()...", category: Category.Info, priority: Priority.Low);
                SaveFileDialog saveFile = new SaveFileDialog();
                saveFile.DefaultExt = "xlsx";
                saveFile.FileName = "Customers_" + Reference + "_" + DateTime.Now.ToString("MMddyyyy_hhmm");
                saveFile.Filter = "Excel Files (.xlsx)|*.xlsx|All Files (*.*)|*.*";
                saveFile.FilterIndex = 1;
                saveFile.Title = "Save Excel Report";
                DialogResult = (bool)saveFile.ShowDialog();
                if (!DialogResult)
                {
                    ResultFileName = string.Empty;
                }
                else
                {
                    if (!DXSplashScreen.IsActive)
                    {
                        DXSplashScreen.Show(x =>
                        {
                            Window win = new Window()
                            {
                                ShowActivated = false,
                                WindowStyle = WindowStyle.None,
                                ResizeMode = ResizeMode.NoResize,
                                AllowsTransparency = true,
                                Background = new SolidColorBrush(Colors.Transparent),
                                ShowInTaskbar = false,
                                Topmost = true,
                                SizeToContent = SizeToContent.WidthAndHeight,
                                WindowStartupLocation = WindowStartupLocation.CenterScreen,
                            };
                            WindowFadeAnimationBehavior.SetEnableAnimation(win, true);
                            win.Topmost = false;
                            return win;
                        }, x =>
                        {
                            return new SplashScreenView() { DataContext = new SplashScreenViewModel() };
                        }, null, null);
                    }
                    ResultFileName = (saveFile.FileName);
                    TableView tableView = ((TableView)obj);
                    tableView.ShowTotalSummary = false;

                    var SelectedList = ClonedCustomerPrice.CustomerList.ToList();
                    if (SelectedList == null)
                    {
                        if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                        return;
                    }
                    else
                    {
                        tableView.DataControl.ItemsSource = SelectedList;
                        tableView.ShowFixedTotalSummary = false;
                        tableView.ExportToXlsx(ResultFileName);
                        tableView.DataControl.ItemsSource = ClonedCustomerPrice.CustomerList;

                        if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                        System.Diagnostics.Process.Start(ResultFileName);
                        tableView.ShowTotalSummary = false;
                        tableView.ShowFixedTotalSummary = true;
                    }
                }
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method ExportToExcelCustomers()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
            GeosApplication.Instance.Logger.Log("Method ExportToExcelCustomers()....executed successfully", category: Category.Info, priority: Priority.Low);
        }


        private void ExportToExcelPriceListDetails(object obj)
        {
            Workbook workbook = new Workbook();
            FileStream stream = null;
            try
            {
                GeosApplication.Instance.Logger.Log("Method ExportToExcelPriceListDetails()...", category: Category.Info, priority: Priority.Low);

                SaveFileDialog saveFile = new SaveFileDialog();
                saveFile.DefaultExt = "xlsx";
                saveFile.FileName = SelectedCustomerPriceCode + "_" + DateTime.Now.ToString("MMddyyyy_hhmm");
                saveFile.Filter = "Excel Files (.xlsx)|*.xlsx|All Files (*.*)|*.*";
                saveFile.FilterIndex = 1;
                saveFile.Title = "Save Excel Report";
                DialogResult = (bool)saveFile.ShowDialog();

                if (!DialogResult)
                {
                    ResultFileName = string.Empty;
                }
                else
                {
                    if (!DXSplashScreen.IsActive)
                    {
                        DXSplashScreen.Show(x =>
                        {
                            Window win = new Window()
                            {
                                ShowActivated = false,
                                WindowStyle = WindowStyle.None,
                                ResizeMode = ResizeMode.NoResize,
                                AllowsTransparency = true,
                                Background = new SolidColorBrush(Colors.Transparent),
                                ShowInTaskbar = false,
                                Topmost = true,
                                SizeToContent = SizeToContent.WidthAndHeight,
                                WindowStartupLocation = WindowStartupLocation.CenterScreen,
                            };
                            WindowFadeAnimationBehavior.SetEnableAnimation(win, true);
                            win.Topmost = false;
                            return win;
                        }, x =>
                        {
                            return new SplashScreenView() { DataContext = new SplashScreenViewModel() };
                        }, null, null);
                    }
                    ResultFileName = (saveFile.FileName);

                    ExportTableView(this.articleTableView, "articleTableViewCPL");
                    ExportTableView(this.detectionsTableView, "detectionsTableViewCPL");
                    ExportTableView(this.moduleTableView, "modulesTableViewCPL");

                    byte[] excelTemplateInByte = geosService.GetBPLDetailsExcel(@"\PLM_CPL_Details.xlsx");

                    if (excelTemplateInByte == null) throw new Exception("Template file not found.");

                    workbook.LoadDocument(excelTemplateInByte, DocumentFormat.Xlsm); // PLM.Properties.Resources.PLM_BPL_Details

                    var articleTableViewFilePath = tempDirectory + @"\\" + "articleTableViewCPL" + ".xlsx";
                    var detectionsTableViewFilePath = tempDirectory + @"\\" + "detectionsTableViewCPL" + ".xlsx";
                    var modulesTableViewFilePath = tempDirectory + @"\\" + "modulesTableViewCPL" + ".xlsx";

                    Workbook workbookArticleTableViewFile = new Workbook();
                    Workbook workbookDetectionsTableViewFile = new Workbook();
                    Workbook workbookModulesTableViewFile = new Workbook();

                    workbookArticleTableViewFile.LoadDocument(articleTableViewFilePath, DocumentFormat.Xlsm);
                    workbookDetectionsTableViewFile.LoadDocument(detectionsTableViewFilePath, DocumentFormat.Xlsm);
                    workbookModulesTableViewFile.LoadDocument(modulesTableViewFilePath, DocumentFormat.Xlsm);

                    var worksheetHeader = workbook.Worksheets["Header"];
                    var worksheetArticlesTable = workbook.Worksheets["Articles"];
                    var worksheetDetectionsTable = workbook.Worksheets["Detections"];
                    var worksheetModulesTable = workbook.Worksheets["Modules"];
                    // ReplaceTextByValueOf_ArticlesGrid
                    var cellFound1 = workbook.Search("ReplaceTextByValueOf_ArticlesGrid", new SearchOptions { MatchEntireCellContents = true }).FirstOrDefault();

                    int ColumnBeforeFirstEmptyCellInTheRow = 0;
                    for (int i = 0; i < 1000; i++)
                    {
                        var cellDisplayText = workbookArticleTableViewFile.Worksheets[0][1, 0][0, i].DisplayText;
                        if (string.IsNullOrWhiteSpace(cellDisplayText))
                        {
                            ColumnBeforeFirstEmptyCellInTheRow = i - 1;
                            break;
                        }
                    }

                    var cellRange1 = workbookArticleTableViewFile.Worksheets[0].Range.FromLTRB(0, 0, ColumnBeforeFirstEmptyCellInTheRow, dtArticle.Rows.Count + 10);

                    if (cellFound1 != null) cellFound1.CopyFrom(cellRange1, PasteSpecial.All);
                    worksheetArticlesTable.FreezePanes(cellFound1.RowIndex + 1, cellFound1.ColumnIndex);

                    ColumnBeforeFirstEmptyCellInTheRow = 0;
                    for (int i = 0; i < 1000; i++)
                    {
                        var cellDisplayText = worksheetArticlesTable[cellFound1.RowIndex + 1, 0][0, i].DisplayText;
                        if (string.IsNullOrWhiteSpace(cellDisplayText))
                        {
                            ColumnBeforeFirstEmptyCellInTheRow = i - 1;
                            break;
                        }
                    }
                    if (ColumnBeforeFirstEmptyCellInTheRow > 0)
                    {
                        var cellRangeForFilter = worksheetArticlesTable.Range.FromLTRB(cellFound1.ColumnIndex, cellFound1.RowIndex + 1, ColumnBeforeFirstEmptyCellInTheRow, cellFound1.RowIndex + 1);
                        worksheetArticlesTable.AutoFilter.Apply(cellRangeForFilter);
                    }
                    cellRange1 = null;

                    // ReplaceTextByValueOf_DetectionsGrid
                    var cellsFound2 = workbook.Search("ReplaceTextByValueOf_DetectionsGrid", new SearchOptions { MatchEntireCellContents = true }).FirstOrDefault();

                    ColumnBeforeFirstEmptyCellInTheRow = 0;
                    for (int i = 0; i < 1000; i++)
                    {
                        var cellDisplayText = workbookDetectionsTableViewFile.Worksheets[0][1, 0][0, i].DisplayText;
                        if (string.IsNullOrWhiteSpace(cellDisplayText))
                        {
                            ColumnBeforeFirstEmptyCellInTheRow = i - 1;
                            break;
                        }
                    }
                    var cellRange2 = workbookDetectionsTableViewFile.Worksheets[0].Range.FromLTRB(0, 0, ColumnBeforeFirstEmptyCellInTheRow, DtDetection.Rows.Count + 10);

                    if (cellsFound2 != null) cellsFound2.CopyFrom(cellRange2, PasteSpecial.All);
                    worksheetDetectionsTable.FreezePanes(cellsFound2.RowIndex + 1, cellsFound2.ColumnIndex);

                    ColumnBeforeFirstEmptyCellInTheRow = 0;
                    for (int i = 0; i < 1000; i++)
                    {
                        var cellDisplayText = worksheetDetectionsTable[cellsFound2.RowIndex + 1, 0][0, i].DisplayText;
                        if (string.IsNullOrWhiteSpace(cellDisplayText))
                        {
                            ColumnBeforeFirstEmptyCellInTheRow = i - 1;
                            break;
                        }
                    }
                    if (ColumnBeforeFirstEmptyCellInTheRow > 0)
                    {
                        var cellRangeForFilter = worksheetDetectionsTable.Range.FromLTRB(cellsFound2.ColumnIndex, cellsFound2.RowIndex + 1, ColumnBeforeFirstEmptyCellInTheRow, cellsFound2.RowIndex + 1);
                        worksheetDetectionsTable.AutoFilter.Apply(cellRangeForFilter);
                    }
                    cellRange2 = null;

                    try
                    {
                        // ReplaceTextByValueOf_ModulesGrid
                        var cellsFound3 = workbook.Search("ReplaceTextByValueOf_ModulesGrid", new SearchOptions { MatchEntireCellContents = true }).FirstOrDefault();

                        ColumnBeforeFirstEmptyCellInTheRow = 0;
                        for (int i = 0; i < 1000; i++)
                        {
                            var cellDisplayText = workbookModulesTableViewFile.Worksheets[0][1, 0][0, i].DisplayText;
                            if (string.IsNullOrWhiteSpace(cellDisplayText))
                            {
                                ColumnBeforeFirstEmptyCellInTheRow = i - 1;
                                break;
                            }
                        }
                        var cellRange3 = workbookModulesTableViewFile.Worksheets[0].Range.FromLTRB(0, 0, ColumnBeforeFirstEmptyCellInTheRow, DtModule.Rows.Count + 10);

                        if (cellsFound3 != null) cellsFound3.CopyFrom(cellRange3, PasteSpecial.All);
                        worksheetModulesTable.FreezePanes(cellsFound3.RowIndex + 1, cellsFound3.ColumnIndex);

                        ColumnBeforeFirstEmptyCellInTheRow = 0;
                        for (int i = 0; i < 1000; i++)
                        {
                            var cellDisplayText = worksheetModulesTable[cellsFound3.RowIndex + 1, 0][0, i].DisplayText;
                            if (string.IsNullOrWhiteSpace(cellDisplayText))
                            {
                                ColumnBeforeFirstEmptyCellInTheRow = i - 1;
                                break;
                            }
                        }
                        if (ColumnBeforeFirstEmptyCellInTheRow > 0)
                        {
                            var cellRangeForFilter = worksheetModulesTable.Range.FromLTRB(cellsFound3.ColumnIndex, cellsFound3.RowIndex + 1, ColumnBeforeFirstEmptyCellInTheRow, cellsFound3.RowIndex + 1);
                            worksheetModulesTable.AutoFilter.Apply(cellRangeForFilter);
                        }
                        cellRange3 = null;
                    }
                    catch (Exception ex)
                    {

                    }
                    //string commaSeperatedSelectedPlants = string.Empty;
                    //if (SelectedPlant != null)
                    //{
                    //    commaSeperatedSelectedPlants = string.Join(";", SelectedPlant.Cast<Site>().Select(x => x.Name).ToArray());
                    //}
                    string commaSeperatedSelectedSaleCurrencies = string.Empty;
                    if (SelectedSaleCurrency != null)
                    {
                        commaSeperatedSelectedSaleCurrencies = string.Join(";", SelectedSaleCurrency.Cast<Currency>().Select(x => x.Name).ToArray());
                    }

                    Dictionary<string, string> DictReplaceTextByValue = new Dictionary<string, string>
                    {
                        { "ReplaceTextByValueOf_Code", SelectedCustomerPriceCode },
                        { "ReplaceTextByValueOf_BasePriceList", SelectedBasePriceName.Name },
                        { "ReplaceTextByValueOf_Currency", (SelectedCurrency!=null?((Currency)SelectedCurrency).Name:string.Empty)},
                        { "ReplaceTextByValueOf_SaleCurrency", commaSeperatedSelectedSaleCurrencies },
                        { "ReplaceTextByValueOf_Status", (SelectedStatus!=null?SelectedStatus.Value:string.Empty)},
                        { "ReplaceTextByValueOf_ExchangeRate", (SelectedExchangeRate!=null?SelectedExchangeRate.Value:string.Empty) },
                        { "ReplaceTextByValueOf_EffectiveDate", (EffectiveDate!=null?EffectiveDate.Value.ToString("dd/MM/yyyy"):string.Empty) },
                        { "ReplaceTextByValueOf_ExpiryDate", (ExpiryDate!=null?ExpiryDate.Value.ToString("dd/MM/yyyy"):string.Empty) },
                        { "ReplaceTextByValueOf_LastUpdate",(LastUpdated!=null?LastUpdated.Value.ToString("dd/MM/yyyy"):string.Empty)},
                        { "ReplaceTextByValueOf_NameEN",IsCheckedAllLanguages?Name:Name_en },
                        { "ReplaceTextByValueOf_NameES",IsCheckedAllLanguages?Name:Name_es},
                        { "ReplaceTextByValueOf_NameFR",IsCheckedAllLanguages?Name:Name_fr },
                        { "ReplaceTextByValueOf_NamePT",IsCheckedAllLanguages?Name:Name_pt },
                        { "ReplaceTextByValueOf_NameRO",IsCheckedAllLanguages?Name:Name_ro },
                        { "ReplaceTextByValueOf_NameRU",IsCheckedAllLanguages?Name:Name_ru },
                        { "ReplaceTextByValueOf_NameZH",IsCheckedAllLanguages?Name:Name_zh },
                        { "ReplaceTextByValueOf_DescriptionEN",IsCheckedAllLanguages?Description:Description_en },
                        { "ReplaceTextByValueOf_DescriptionES",IsCheckedAllLanguages?Description:Description_es },
                        { "ReplaceTextByValueOf_DescriptionFR",IsCheckedAllLanguages?Description:Description_fr },
                        { "ReplaceTextByValueOf_DescriptionPT",IsCheckedAllLanguages?Description:Description_pt },
                        { "ReplaceTextByValueOf_DescriptionRO",IsCheckedAllLanguages?Description:Description_ro },
                        { "ReplaceTextByValueOf_DescriptionRU",IsCheckedAllLanguages?Description:Description_ru },
                        { "ReplaceTextByValueOf_DescriptionZH",IsCheckedAllLanguages?Description:Description_zh },
                        { "ReplaceTextByValueOf_RemarksEN",IsCheckedAllLanguages?Remark:Remark_en },
                        { "ReplaceTextByValueOf_RemarksES",IsCheckedAllLanguages?Remark:Remark_es },
                        { "ReplaceTextByValueOf_RemarksFR",IsCheckedAllLanguages?Remark:Remark_fr },
                        { "ReplaceTextByValueOf_RemarksPT",IsCheckedAllLanguages?Remark:Remark_pt },
                        { "ReplaceTextByValueOf_RemarksRO",IsCheckedAllLanguages?Remark:Remark_ro },
                        { "ReplaceTextByValueOf_RemarksRU",IsCheckedAllLanguages?Remark:Remark_ru },
                        { "ReplaceTextByValueOf_RemarksZH",IsCheckedAllLanguages?Remark:Remark_zh }

                    };

                    using (stream = new FileStream(ResultFileName, FileMode.Create, FileAccess.ReadWrite))
                    {
                        foreach (var itemReplaceTextByValue in DictReplaceTextByValue)
                        {
                            var cellsFound = workbook.Search(itemReplaceTextByValue.Key, new SearchOptions { MatchEntireCellContents = true });

                            if (cellsFound != null)
                            {
                                foreach (var itemcellFound in cellsFound)
                                {
                                    itemcellFound.SetValueFromText(itemReplaceTextByValue.Value);
                                }
                            }
                        }

                        foreach (var itemWorksheet in workbook.Worksheets)
                        {
                            itemWorksheet.Columns.AutoFit(0, 100);

                            for (int i = 0; i < 20; i++)
                            {
                                if (itemWorksheet.Columns[i].Width > 1200)
                                {
                                    itemWorksheet.Columns[i].Width = 1200;
                                }
                            }

                        }
                        workbook.Worksheets.ActiveWorksheet = workbook.Worksheets[0];
                        workbook.Worksheets[0].Cells["A1"].Select();
                        workbook.SaveDocument(stream, DocumentFormat.Xlsx);
                    }
                    System.Diagnostics.Process.Start(ResultFileName);

                    if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                }
                GeosApplication.Instance.Logger.Log("Method ExportToExcelPriceListDetails()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in Method ExportToExcelPriceListDetails()...." + ex.Message + GeosApplication.createExceptionDetailsMsg(ex), category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show("Failed to Generate Excel.", Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
        }

        private void ExportTableView(TableView tableView, string fileName)
        {
            try
            {
                if (tableView != null)
                {
                    var gridColumnDelete = tableView.Grid.Columns.GetColumnByFieldName("Delete");
                    var gridColumnIsChecked = tableView.Grid.Columns.GetColumnByFieldName("IsChecked");

                    var BandDeleteVisible = gridColumnDelete.ParentBand.Visible;
                    var ColumnIsCheckedVisible = gridColumnIsChecked.Visible;
                    gridColumnDelete.ParentBand.Visible = false;
                    //  gridColumnDelete.Visible = false;
                    //   gridColumnDelete.AllowPrinting = false;
                    gridColumnIsChecked.Visible = false;

                    var ShowTotalSummaryValue = tableView.ShowTotalSummary;
                    var ShowFixedTotalSummary = tableView.ShowFixedTotalSummary;
                    tableView.ShowTotalSummary = false;
                    tableView.ShowFixedTotalSummary = false;

                    XlsxExportOptionsEx options = new XlsxExportOptionsEx();
                    options.CustomizeCell += Options_CustomizeCell;
                    tableView.ExportToXlsx(tempDirectory + @"\\" + fileName + ".xlsx", options); //  + DateTime.Now.ToString("MMddyyyy_hhmm")

                    gridColumnDelete.ParentBand.Visible = BandDeleteVisible;
                    //   gridColumnDelete.Visible = BandDeleteVisible;
                    gridColumnIsChecked.Visible = ColumnIsCheckedVisible;

                    tableView.ShowTotalSummary = ShowTotalSummaryValue;
                    tableView.ShowFixedTotalSummary = ShowFixedTotalSummary;
                }
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method ExportTableView()...." + ex.Message + GeosApplication.createExceptionDetailsMsg(ex), category: Category.Exception, priority: Priority.Low);
                throw ex;
            }
        }

        private void Options_CustomizeCell(DevExpress.Export.CustomizeCellEventArgs e)
        {
            try
            {
                if (e.ColumnFieldName == "Logic")
                {
                    int cellValue;
                    var conversionSuccess = int.TryParse(e.Value.ToString(), out cellValue);
                    if (conversionSuccess && LogicList != null)
                    {
                        var item = LogicList.Where(x => x.IdLookupValue == cellValue).FirstOrDefault();
                        if (item != null) e.Value = item.Value.ToString();
                    }
                }

                if (e.ColumnFieldName == "VisibleCustomer")
                {
                    if (e.Value.ToString().ToUpperInvariant() == "VISIBLE")
                    {
                        e.Value = "Y";
                    }
                    else if (e.Value.ToString().ToUpperInvariant() == "INVISIBLE")
                    {
                        e.Value = "N";
                    }
                    else if (string.IsNullOrWhiteSpace(e.Value.ToString()))
                    {
                        e.Value = "Visible";
                    }
                }

                if (e.ColumnFieldName == "NameChanged")
                {
                    if (e.Value.ToString().ToUpperInvariant() == "LINKED DESCRIPTION")
                    {
                        e.Value = "Y";
                    }
                    else if (e.Value.ToString().ToUpperInvariant() == "UNLINKED DESCRIPTION")
                    {
                        e.Value = "N";
                    }
                    else if (string.IsNullOrWhiteSpace(e.Value.ToString()))
                    {
                        e.Value = "Linked Description";
                    }
                }
                e.Formatting.Alignment = new XlCellAlignment() { WrapText = true };
                e.Handled = true;
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method Options_CustomizeCell()...." + ex.Message + GeosApplication.createExceptionDetailsMsg(ex), category: Category.Exception, priority: Priority.Low);
                throw ex;
            }
        }

        /// <summary>
        /// This method is used when we check on the Header checkbox for Select/Unselect all.
        /// [001] [vsana][11-12-2020][GEOS2-2561] Assign the customer group/ region/Country/ plant to the Customer Price List [#PLM26]
        /// </summary>
        private void CustomerHeaderClickCommandAction(object obj)
        {
            if (WindowHeader != System.Windows.Application.Current.FindResource("AddCustomerPriceList").ToString())
            {
                var List = ClonedCustomerPrice.CustomerList.Where(x => x.IsChecked == true).ToList();
                var List1 = CPLCustomerList.Where(x => x.IsChecked == true).ToList();
                if (obj == null)
                {
                    if (List.Count() != List1.Count())
                    {
                        IsExportVisible = Visibility.Collapsed;
                    }
                    else
                    {
                        IsExportVisible = Visibility.Visible;
                    }
                }
                else
                {
                    CPLCustomer customer = (CPLCustomer)obj;
                    if (List.Any(a => a.IdGroup == customer.IdGroup && a.IdRegion == customer.IdRegion && a.IsChecked == customer.IsChecked) || List.Count() == List1.Count())
                    {
                        HashSet<string> IdUniques = new HashSet<string>(List.Select(s => s.UniqueId));

                        var results = List1.Where(m => !IdUniques.Contains(m.UniqueId));
                        if (results.Count() > 0)
                        {
                            IsExportVisible = Visibility.Collapsed;
                        }
                        else
                        {
                            IsExportVisible = Visibility.Visible;
                        }
                    }
                    else
                        IsExportVisible = Visibility.Collapsed;
                }
            }
        }

        private void AddColumnsToArticleDataTable()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method AddColumnsToArticleDataTable ...", category: Category.Info, priority: Priority.Low);
                if (SelectedSaleCurrency == null)
                    SelectedSaleCurrency = new List<object>();
                if (SelectedPlant == null)
                    SelectedPlant = new List<object>();
                if (SelectedCurrency == null)
                    SelectedCurrency = new List<object>();
                Bands.Clear();
                BandItem band1 = new BandItem() { BandName = "all", AllowBandMove = false, FixedStyle = FixedStyle.Left, Visible = true, AllowMoving = DevExpress.Utils.DefaultBoolean.False };
                band1.Columns = new ObservableCollection<ColumnItem>();
                band1.Columns.Add(new ColumnItem() { ColumnFieldName = "IsChecked", HeaderText = " ", Width = 50, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                band1.Columns.Add(new ColumnItem() { ColumnFieldName = "VisibleCustomer", HeaderText = " ", Width = 40, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                band1.Columns.Add(new ColumnItem() { ColumnFieldName = "Reference", HeaderText = "Reference", Width = 100, IsVertical = false, Settings = SettingsType.Default, Visible = true });

                Bands.Add(band1);

                BandItem band2 = new BandItem() { BandName = "all1", BandHeader = "" };
                band2.Columns = new ObservableCollection<ColumnItem>();
                band2.Columns.Add(new ColumnItem() { ColumnFieldName = "Name", HeaderText = "Name", Width = 350, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                band2.Columns.Add(new ColumnItem() { ColumnFieldName = "NameChanged", HeaderText = " ", Width = 40, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                band2.Columns.Add(new ColumnItem() { ColumnFieldName = "Category", HeaderText = "Category", Width = 100, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                band2.Columns.Add(new ColumnItem() { ColumnFieldName = "STAT", HeaderText = "STAT", Width = 40, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                Bands.Add(band2);

                DtArticleCopy = new DataTable();
                DtArticleCopy.Columns.Add("IsChecked", typeof(bool));
                DtArticleCopy.Columns.Add("VisibleCustomer", typeof(string));
                DtArticleCopy.Columns.Add("Reference", typeof(string));
                DtArticleCopy.Columns.Add("STAT", typeof(string));
                DtArticleCopy.Columns.Add("HtmlColor", typeof(string));
                DtArticleCopy.Columns.Add("Category", typeof(string));
                DtArticleCopy.Columns.Add("Name", typeof(string));
                DtArticleCopy.Columns.Add("IdArticle", typeof(UInt32));
                DtArticleCopy.Columns.Add("CurrencyConversionDate", typeof(DateTime));
                DtArticleCopy.Columns.Add("Name_Old", typeof(string));
                DtArticleCopy.Columns.Add("Name_Changed", typeof(bool));
                DtArticleCopy.Columns.Add("Visible_Customer", typeof(bool)).DefaultValue = false;
                DtArticleCopy.Columns.Add("Enable_VisibleCustomer", typeof(bool)).DefaultValue = false;
                DtArticleCopy.Columns.Add("Enable_DescriptionLinked", typeof(bool)).DefaultValue = false;

                DtArticleCopy.Columns.Add("IsColor", typeof(bool)).DefaultValue = false;
                DtArticleCopy.Columns.Add("IsSalePriceValueColor", typeof(bool)).DefaultValue = false;
                DtArticleCopy.Columns.Add("NameChanged", typeof(string)).DefaultValue = "Not Changed";
                DtArticleCopy.Columns.Add("Enable_Delete", typeof(bool)).DefaultValue = false;
                DtArticleCopy.Columns.Add("IsUpdatedRow", typeof(bool)).DefaultValue = false;
                DtArticleCopy.Columns.Add("SaleCurrencyConversionDate", typeof(string));

                //plant	
                BandItem band3 = new BandItem() { BandName = "plant", BandHeader = "Plant" };
                band3.Columns = new ObservableCollection<ColumnItem>();
                foreach (Site plant in SelectedPlant)
                {
                    string fieldName = plant.Name;
                    DtArticleCopy.Columns.Add(fieldName, typeof(double));
                    band3.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = fieldName, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });
                }
                Bands.Add(band3);
                //max cost	
                BandItem band4 = new BandItem() { BandName = "max cost", BandHeader = "Max Cost" };
                band4.Columns = new ObservableCollection<ColumnItem>();
                string fieldName2 = "MaxCost_1";
                DtArticleCopy.Columns.Add(fieldName2, typeof(double));
                band4.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName2, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });
                Bands.Add(band4);
                //Base price	
                BandItem band5 = new BandItem() { BandName = "base price", BandHeader = "Base Price" };
                band5.Columns = new ObservableCollection<ColumnItem>();
                string fieldName5 = "BasePriceValue";
                DtArticleCopy.Columns.Add(fieldName5, typeof(double));
                band5.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName5, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });
                Bands.Add(band5);
                //rule	
                BandItem band6 = new BandItem() { BandName = "rule", BandHeader = "Rule" };
                band6.Columns = new ObservableCollection<ColumnItem>();
                string fieldName3 = "Value";
                DtArticleCopy.Columns.Add("Value", typeof(float));
                band6.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName3, HeaderText = fieldName3, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });
                string fieldName4 = "Logic";
                DtArticleCopy.Columns.Add(fieldName4, typeof(int));
                band6.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName4, HeaderText = fieldName4, Width = 50, Visible = true, IsVertical = false, Settings = SettingsType.Default });

                Bands.Add(band6);
                //Sale Currency	
                BandItem band7 = new BandItem() { BandName = "sale price", BandHeader = "Sale Price" };
                band7.Columns = new ObservableCollection<ColumnItem>();
                int count = 0;
                foreach (Currency currency in SelectedSaleCurrency)
                {
                    // code modified for reorder by common currency 
                    if (count == 0)
                    {
                        count = 1;
                        string fieldName = "Common_Cur";
                        DtArticleCopy.Columns.Add(fieldName, typeof(double));
                        band7.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                        DtArticleCopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));

                        if (currency.Name != ((Currency)SelectedCurrency).Name)
                        {
                            string fieldName1 = currency.Name;
                            DtArticleCopy.Columns.Add(fieldName1, typeof(double));
                            band7.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName1, HeaderText = fieldName1, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                            DtArticleCopy.Columns.Add("CurrencyConversionRate_" + fieldName1, typeof(double));
                        }
                    }
                    else
                    {
                        if (currency.Name != ((Currency)SelectedCurrency).Name)
                        {
                            string fieldName1 = currency.Name;
                            DtArticleCopy.Columns.Add(fieldName1, typeof(double));
                            band7.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName1, HeaderText = fieldName1, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                            DtArticleCopy.Columns.Add("CurrencyConversionRate_" + fieldName1, typeof(double));
                        }
                    }
                }
                Bands.Add(band7);

                // Profit
                BandItem band8 = new BandItem() { BandName = "all2", BandHeader = "" };
                band8.Columns = new ObservableCollection<ColumnItem>();
                band8.Columns.Add(new ColumnItem() { ColumnFieldName = "Profit", HeaderText = "Profit", Width = 100, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                DtArticleCopy.Columns.Add("Profit", typeof(double));
                Bands.Add(band8);

                // Cost Margin
                BandItem band9 = new BandItem() { BandName = "all3", BandHeader = "" };
                band9.Columns = new ObservableCollection<ColumnItem>();
                band9.Columns.Add(new ColumnItem() { ColumnFieldName = "CostMargin", HeaderText = "Cost Margin", Width = 100, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                DtArticleCopy.Columns.Add("CostMargin", typeof(double));
                Bands.Add(band9);

                BandItem band10 = new BandItem() { BandName = "all4", AllowBandMove = false, Visible = true, AllowMoving = DevExpress.Utils.DefaultBoolean.False, AllowPrinting = false };
                band10.Columns = new ObservableCollection<ColumnItem>();
                band10.Columns.Add(new ColumnItem() { ColumnFieldName = "Delete", HeaderText = " ", Width = 50, IsVertical = false, Settings = SettingsType.Default, Visible = true });

                Bands.Add(band10);

                Bands = new ObservableCollection<BandItem>(Bands);
                DtArticle = DtArticleCopy;
                GeosApplication.Instance.Logger.Log("Method AddColumnsToArticleDataTable executed Successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in AddColumnsToArticleDataTable() method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), "Red", CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in AddColumnsToArticleDataTable() Method - ServiceUnexceptedException " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in AddColumnsToArticleDataTable() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        private void AddColumnsToArticleDataTableBySaleCurrency()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method AddColumnsToArticleDataTable ...", category: Category.Info, priority: Priority.Low);
                if (SelectedSaleCurrency == null)
                    SelectedSaleCurrency = new List<object>();
                if (SelectedPlant == null)
                    SelectedPlant = new List<object>();
                if (SelectedCurrency == null)
                {
                    SelectedCurrency = new object();
                    SelectedCurrency_Copy = new object();
                }
                if (Bands.Count > 0)
                {
                    foreach (BandItem bandItem in Bands)
                    {
                        if (bandItem.BandHeader == "Sale Price")
                        {
                            foreach (Currency currency in SelectedSaleCurrency)
                            {
                                if (!bandItem.Columns.Any(a => a.HeaderText == currency.Name))
                                {
                                    string fieldName = currency.Name;
                                    DtArticleCopy.Columns.Add(fieldName, typeof(double));
                                    bandItem.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = fieldName, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                    DtArticleCopy.Columns.Add("CurrencyConversionRate_" + currency.Name, typeof(double));
                                }
                            }
                            List<ColumnItem> columns = new List<ColumnItem>(bandItem.Columns);
                            if (bandItem.Columns.Count != SelectedSaleCurrency.Count)
                            {
                                foreach (ColumnItem columnItem in columns.ToList())
                                {
                                    if (!SelectedSaleCurrency.Cast<Currency>().Any(a => a.Name == columnItem.HeaderText))
                                    {
                                        string fieldName = columnItem.HeaderText;
                                        DtArticleCopy.Columns.Remove(fieldName);
                                        bandItem.Columns.Remove(columnItem);

                                        DtArticleCopy.Columns.Remove("CurrencyConversionRate_" + fieldName);
                                    }
                                }
                            }
                            if (!SelectedSaleCurrency.Cast<Currency>().Any(a => a.Name == ((Currency)SelectedCurrency).Name))
                            {
                                SelectedSaleCurrency.Add(SaleCurrencyList.FirstOrDefault(a => a.Name == ((Currency)SelectedCurrency).Name));
                                SelectedSaleCurrency = new List<object>(SelectedSaleCurrency);
                                string fieldName = "Common_Cur";
                                DtArticleCopy.Columns.Remove(fieldName);
                                DtArticleCopy.Columns.Add(fieldName, typeof(double));
                                bandItem.Columns.Remove(bandItem.Columns.FirstOrDefault(a => a.ColumnFieldName == fieldName));
                                bandItem.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });

                                DtArticleCopy.Columns.Remove("CurrencyConversionRate_" + fieldName);
                                DtArticleCopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));


                                string fieldName1 = ((Currency)SelectedCurrency_Copy).Name;
                                DtArticleCopy.Columns.Add(fieldName1, typeof(double));
                                bandItem.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName1, HeaderText = fieldName1, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                DtArticleCopy.Columns.Add("CurrencyConversionRate_" + fieldName1, typeof(double));


                                SelectedSaleCurrency_Copy = SelectedSaleCurrency;
                            }
                        }
                    }

                    // reorder by common currency
                    BandItem item = Bands.FirstOrDefault(a => a.BandHeader == "Sale Price");
                    if (item.Columns.FirstOrDefault().HeaderText != ((Currency)SelectedCurrency).Name)
                    {
                        int count = 0;
                        foreach (Currency item1 in SelectedSaleCurrency.Cast<Currency>())
                        {
                            if (count == 0)
                            {
                                count = 1;
                                //string fieldName = ((Currency)SelectedCurrency).Name;
                                string fieldName = "Common_Cur";
                                DtArticleCopy.Columns.Remove(fieldName);
                                DtArticleCopy.Columns.Add(fieldName, typeof(double));
                                item.Columns.Remove(item.Columns.FirstOrDefault(a => a.ColumnFieldName == fieldName));
                                item.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                DtArticleCopy.Columns.Remove("CurrencyConversionRate_" + fieldName);
                                DtArticleCopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));


                                if (DtArticleCopy.Columns.Contains(((Currency)SelectedCurrency).Name))
                                    DtArticleCopy.Columns.Remove(((Currency)SelectedCurrency).Name);

                                if (DtArticleCopy.Columns.Contains("CurrencyConversionRate_" + ((Currency)SelectedCurrency).Name))
                                    DtArticleCopy.Columns.Remove("CurrencyConversionRate_" + ((Currency)SelectedCurrency).Name);

                                item.Columns.Remove(item.Columns.FirstOrDefault(a => a.ColumnFieldName == ((Currency)SelectedCurrency).Name));

                                if (item1.Name != ((Currency)SelectedCurrency).Name)
                                {
                                    string fieldName1 = item1.Name;
                                    if (DtArticleCopy.Columns.Contains(fieldName1))
                                        DtArticleCopy.Columns.Remove(fieldName1);

                                    DtArticleCopy.Columns.Add(fieldName1, typeof(double));
                                    item.Columns.Remove(item.Columns.FirstOrDefault(a => a.ColumnFieldName == fieldName1));
                                    item.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName1, HeaderText = fieldName1, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });

                                    if (DtArticleCopy.Columns.Contains("CurrencyConversionRate_" + fieldName1))
                                        DtArticleCopy.Columns.Remove("CurrencyConversionRate_" + fieldName1);

                                    DtArticleCopy.Columns.Add("CurrencyConversionRate_" + fieldName1, typeof(double));
                                }
                            }
                            else
                            {
                                if (item1.Name != ((Currency)SelectedCurrency).Name)
                                {
                                    string fieldName = item1.Name;
                                    if (DtArticleCopy.Columns.Contains(fieldName))
                                        DtArticleCopy.Columns.Remove(fieldName);

                                    DtArticleCopy.Columns.Add(fieldName, typeof(double));
                                    item.Columns.Remove(item.Columns.FirstOrDefault(a => a.ColumnFieldName == fieldName));
                                    item.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = fieldName, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });

                                    if (DtArticleCopy.Columns.Contains("CurrencyConversionRate_" + fieldName))
                                        DtArticleCopy.Columns.Remove("CurrencyConversionRate_" + fieldName);

                                    DtArticleCopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));
                                }
                            }
                        }
                    }

                    Bands = new ObservableCollection<BandItem>(Bands);
                }
                else
                {
                    Bands.Clear();
                    BandItem band1 = new BandItem() { BandName = "all", AllowBandMove = false, FixedStyle = FixedStyle.Left, Visible = true, AllowMoving = DevExpress.Utils.DefaultBoolean.False };
                    band1.Columns = new ObservableCollection<ColumnItem>();
                    band1.Columns.Add(new ColumnItem() { ColumnFieldName = "IsChecked", HeaderText = " ", Width = 50, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    band1.Columns.Add(new ColumnItem() { ColumnFieldName = "Reference", HeaderText = "Reference", Width = 100, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    Bands.Add(band1);

                    BandItem band2 = new BandItem() { BandName = "all1", BandHeader = "" };
                    band2.Columns = new ObservableCollection<ColumnItem>();
                    band2.Columns.Add(new ColumnItem() { ColumnFieldName = "Name", HeaderText = "Name", Width = 350, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    band2.Columns.Add(new ColumnItem() { ColumnFieldName = "Category", HeaderText = "Category", Width = 100, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    band2.Columns.Add(new ColumnItem() { ColumnFieldName = "STAT", HeaderText = "STAT", Width = 40, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    Bands.Add(band2);

                    DtArticleCopy = new DataTable();
                    DtArticleCopy.Columns.Add("IsChecked", typeof(bool));
                    DtArticleCopy.Columns.Add("Reference", typeof(string));
                    DtArticleCopy.Columns.Add("Category", typeof(string));
                    DtArticleCopy.Columns.Add("STAT", typeof(string));
                    DtArticleCopy.Columns.Add("HtmlColor", typeof(string));
                    DtArticleCopy.Columns.Add("Name", typeof(string));
                    DtArticleCopy.Columns.Add("IdArticle", typeof(UInt32));
                    DtArticleCopy.Columns.Add("CurrencyConversionDate", typeof(DateTime));
                    DtArticleCopy.Columns.Add("Name_Old", typeof(string));
                    DtArticleCopy.Columns.Add("Name_Changed", typeof(bool));
                    DtArticleCopy.Columns.Add("Visible_Customer", typeof(bool)).DefaultValue = false;
                    DtArticleCopy.Columns.Add("Enable_VisibleCustomer", typeof(bool)).DefaultValue = false;
                    DtArticleCopy.Columns.Add("Enable_Delete", typeof(bool)).DefaultValue = false;
                    DtArticleCopy.Columns.Add("Enable_DescriptionLinked", typeof(bool)).DefaultValue = false;
                    DtArticleCopy.Columns.Add("SaleCurrencyConversionDate", typeof(string));

                    //plant	
                    BandItem band3 = new BandItem() { BandName = "plant", BandHeader = "Plant" };
                    band3.Columns = new ObservableCollection<ColumnItem>();
                    foreach (Site plant in SelectedPlant)
                    {
                        string fieldName = plant.Name;
                        DtArticleCopy.Columns.Add(fieldName, typeof(double));
                        band3.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = fieldName, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });
                    }
                    Bands.Add(band3);
                    //max cost	
                    BandItem band4 = new BandItem() { BandName = "max cost", BandHeader = "Max Cost" };
                    band4.Columns = new ObservableCollection<ColumnItem>();
                    string fieldName2 = "MaxCost_1";
                    DtArticleCopy.Columns.Add(fieldName2, typeof(double));
                    band4.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName2, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });
                    //Base price	
                    BandItem band5 = new BandItem() { BandName = "base price", BandHeader = "Base Price" };
                    band5.Columns = new ObservableCollection<ColumnItem>();
                    string fieldName5 = "BasePriceValue";
                    DtArticleCopy.Columns.Add(fieldName5, typeof(double));
                    band5.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName5, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });
                    Bands.Add(band5);
                    //rule	
                    BandItem band6 = new BandItem() { BandName = "rule", BandHeader = "Rule" };
                    band6.Columns = new ObservableCollection<ColumnItem>();
                    string fieldName3 = "Value";
                    DtArticleCopy.Columns.Add("Value", typeof(float));
                    band6.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName3, HeaderText = fieldName3, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });
                    string fieldName4 = "Logic";
                    DtArticleCopy.Columns.Add(fieldName4, typeof(int));
                    band6.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName4, HeaderText = fieldName4, Width = 50, Visible = true, IsVertical = false, Settings = SettingsType.Default });
                    Bands.Add(band6);
                    //Sale Currency	
                    BandItem band7 = new BandItem() { BandName = "sale price", BandHeader = "Sale Price" };
                    band7.Columns = new ObservableCollection<ColumnItem>();
                    int count = 0;
                    foreach (Currency currency in SelectedSaleCurrency)
                    {
                        // code modified for reorder by common currency 
                        if (count == 0)
                        {
                            count = 1;
                            string fieldName = "Common_Cur";
                            DtArticleCopy.Columns.Add(fieldName, typeof(double));
                            band7.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                            DtArticleCopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));

                            if (currency.Name != ((Currency)SelectedCurrency).Name)
                            {
                                string fieldName1 = currency.Name;
                                DtArticleCopy.Columns.Add(fieldName1, typeof(double));
                                band7.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName1, HeaderText = fieldName1, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                DtArticleCopy.Columns.Add("CurrencyConversionRate_" + fieldName1, typeof(double));
                            }
                        }
                        else
                        {
                            if (currency.Name != ((Currency)SelectedCurrency).Name)
                            {
                                string fieldName1 = currency.Name;
                                DtArticleCopy.Columns.Add(fieldName1, typeof(double));
                                band7.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName1, HeaderText = fieldName1, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                DtArticleCopy.Columns.Add("CurrencyConversionRate_" + fieldName1, typeof(double));
                            }
                        }
                    }
                    Bands.Add(band7);

                    // Profit
                    BandItem band8 = new BandItem() { BandName = "all2", BandHeader = "" };
                    band8.Columns = new ObservableCollection<ColumnItem>();
                    band8.Columns.Add(new ColumnItem() { ColumnFieldName = "Profit", HeaderText = "Profit", Width = 100, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    DtArticleCopy.Columns.Add("Profit", typeof(double));
                    Bands.Add(band8);

                    // Cost Margin
                    BandItem band9 = new BandItem() { BandName = "all3", BandHeader = "" };
                    band9.Columns = new ObservableCollection<ColumnItem>();
                    band9.Columns.Add(new ColumnItem() { ColumnFieldName = "CostMargin", HeaderText = "Cost Margin", Width = 100, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    DtArticleCopy.Columns.Add("CostMargin", typeof(double));
                    Bands.Add(band9);

                    BandItem band10 = new BandItem() { BandName = "all4", AllowBandMove = false, Visible = true, AllowMoving = DevExpress.Utils.DefaultBoolean.False, AllowPrinting = false };
                    band10.Columns = new ObservableCollection<ColumnItem>();
                    band10.Columns.Add(new ColumnItem() { ColumnFieldName = "Delete", HeaderText = " ", Width = 50, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    Bands.Add(band10);

                }
                Bands = new ObservableCollection<BandItem>(Bands);
                DtArticle = DtArticleCopy;
                GeosApplication.Instance.Logger.Log("Method AddColumnsToArticleDataTable executed Successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in AddColumnsToArticleDataTable() method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), "Red", CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in AddColumnsToArticleDataTable() Method - ServiceUnexceptedException " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in AddColumnsToArticleDataTable() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        private void ChangeSaleCurrencyCommandAction(object obj)
        {
            try
            {
                if (obj == null)
                    return;
                GeosApplication.Instance.Logger.Log("Method ChangeSaleCurrencyCommandAction()...", category: Category.Info, priority: Priority.Low);
                if (((DevExpress.Xpf.Editors.ClosePopupEventArgs)obj).CloseMode == DevExpress.Xpf.Editors.PopupCloseMode.Normal && SelectedSaleCurrency != SelectedSaleCurrency_Copy)
                {
                    // if (ClonedCustomerPrice != null && ClonedCustomerPrice.IdStatus == 224)
                    if (ClonedCustomerPrice != null && ClonedCustomerPrice.IdStatus == 224 && isDuplicateClicked == false)//[Sudhir.Jangra][GEOS2-3349][27/12/2022]
                    {
                        CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("CantChangeCPLValidation").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                        SelectedSaleCurrency = SelectedSaleCurrency_Copy;
                        return;
                    }

                    if (DtArticle != null && DtArticle.Rows.Count > 0)
                    {
                        IsCalculateArticleCostButtonEnabled = true;
                        IsCalculated = false;
                    }
                    if (SelectedSaleCurrency == null)
                        SelectedSaleCurrency = new List<object>();
                    int removeCount = 0;
                    foreach (BandItem bandItem in Bands)
                    {
                        if (bandItem.BandHeader == "Sale Price")
                        {
                            List<ColumnItem> columns = new List<ColumnItem>(bandItem.Columns);
                            foreach (ColumnItem columnItem in columns.ToList())
                            {
                                if (!SelectedSaleCurrency.Cast<Currency>().Any(a => a.Name == columnItem.HeaderText))
                                {
                                    removeCount++;
                                }
                            }
                        }
                    }
                    if (removeCount > 0)
                    {
                        if (!SelectedSaleCurrency.Cast<Currency>().Any(a => a.Name == ((Currency)SelectedCurrency).Name))
                        {
                            CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("RemoveCommonBPLSalePrice").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                            SelectedSaleCurrency = SelectedSaleCurrency_Copy;
                            return;
                        }
                        MessageBoxResult MessageBoxResult = CustomMessageBox.Show(Application.Current.Resources["RemoveBPLSalePrice"].ToString(), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                        if (MessageBoxResult == MessageBoxResult.No)
                        {
                            SelectedSaleCurrency = SelectedSaleCurrency_Copy;
                            return;
                        }
                    }
                    if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }
                    AddColumnsToArticleDataTableBySaleCurrency();
                    AddColumnsToDetectionDataTableBySaleCurrency();
                    try
                    {
                        AddColumnsToModuleDataTableBySaleCurrency();

                    }
                    catch (Exception ex)
                    {
                    }
                    CalculateBasePriceArticlesByLogicValue();
                    CalculateBasePriceDetectionsByLogicValue();
                    try
                    {
                        CalculateBasePriceModulesByLogicValue();
                    }
                    catch (Exception EX)
                    {
                    }
                    SelectedSaleCurrency_Copy = SelectedSaleCurrency;
                    IsSaleCurrencyAddedOrRemove = true;
                    IsEnabledSaveButton = true;
                    if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                    GeosApplication.Instance.Logger.Log("Method ChangeSaleCurrencyCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);
                }
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log(string.Format("Error in method ChangeSaleCurrencyCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }


        public void CalculateBasePriceDetectionsByLogicValue()
        {
            try
            {
                if (DtDetection != null && DtDetection.Rows.Count > 0)
                {
                    int IndexselectedCurrencyName_ = DtDetection.Columns.IndexOf("MaxCost_1");
                    int IndexselectedCurrencyName_1 = DtDetection.Columns.IndexOf("BasePriceValue");
                    int indexIdDetection = DtDetection.Columns.IndexOf("IdDetection");
                    int indexCurrencyConversionDate = DtDetection.Columns.IndexOf("CurrencyConversionDate");
                    int indexValue = DtDetection.Columns.IndexOf("Value");
                    int indexLogic = DtDetection.Columns.IndexOf("Logic");

                    int indexProfit = DtDetection.Columns.IndexOf("Profit");
                    int indexCost = DtDetection.Columns.IndexOf("CostMargin");

                    int indexSelectedCurrency = DtDetection.Columns.IndexOf("Common_Cur");
                    int indexIsUpdatedRow = DtDetection.Columns.IndexOf("IsUpdatedRow");



                    for (int j = 0; j < DtDetection.Rows.Count; j++)
                    {
                        try
                        {
                            DtDetection.Rows[j].BeginEdit();
                            UInt64 idDetection = Convert.ToUInt64(DtDetection.Rows[j][indexIdDetection]);
                            double? value = null;
                            Int32? logic = null;
                            DateTime? indexCurrencyConversionDateValue = null;
                            double IndexselectedCurrencyName_Value = 0;
                            double IndexselectedCurrencyName_Value1 = 0;
                            double IndexselectedCurrencyNameValue = 0;
                            double indexSelectedCurrencyvalue = 0;
                            if (DtDetection.Rows[j][indexSelectedCurrency] != DBNull.Value)
                                indexSelectedCurrencyvalue = Convert.ToDouble(DtDetection.Rows[j][indexSelectedCurrency]);
                            if (DtDetection.Rows[j][indexValue] != DBNull.Value)
                                value = Convert.ToInt32(DtDetection.Rows[j][indexValue]);
                            if (DtDetection.Rows[j][indexLogic] != DBNull.Value)
                                logic = Convert.ToInt32(DtDetection.Rows[j][indexLogic]);
                            if (DtDetection.Rows[j][IndexselectedCurrencyName_] != DBNull.Value)
                                IndexselectedCurrencyName_Value = Convert.ToDouble(DtDetection.Rows[j][IndexselectedCurrencyName_]);
                            if (DtDetection.Rows[j][indexSelectedCurrency] != DBNull.Value)
                                IndexselectedCurrencyNameValue = Convert.ToDouble(DtDetection.Rows[j][indexSelectedCurrency]);
                            if (DtDetection.Rows[j][IndexselectedCurrencyName_1] != DBNull.Value)
                                IndexselectedCurrencyName_Value1 = Convert.ToDouble(DtDetection.Rows[j][IndexselectedCurrencyName_1]);

                            //if (DtDetection.Rows[j][indexCurrencyConversionDate] != DBNull.Value)
                            //    indexCurrencyConversionDateValue = Convert.ToDateTime(DtDetection.Rows[j][indexCurrencyConversionDate]);

                            List<CurrencyConversion> filterConversionDate = new List<CurrencyConversion>();
                            if (CurrencyConversionList != null && CurrencyConversionList.Count > 0)
                                filterConversionDate = CurrencyConversionList.Where(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency)).ToList();


                            double Cost_Value = 0;
                            double SellPriceValue = 0.00;
                            DtDetection.Rows[j][indexIsUpdatedRow] = true;

                            Cost_Value = IndexselectedCurrencyName_Value;

                            DtDetection.Rows[j][IndexselectedCurrencyName_1] = IndexselectedCurrencyName_Value1;

                            CustomerPriceListByItem record = DetectionList.FirstOrDefault(a => a.IdDetection == idDetection);
                            indexCurrencyConversionDateValue = filterConversionDate.FirstOrDefault().LastUpdate;

                            if (logic != 0)
                            {
                                // for CPL
                                foreach (Currency currency in SelectedSaleCurrency)
                                {
                                    if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                    {
                                        Int32 IndexSelectedSaleCurrency = DtDetection.Columns.IndexOf("CurrencyConversionRate_" + "Common_Cur");
                                        Int32 IndexCurrencyName = DtDetection.Columns.IndexOf("Common_Cur");
                                        CurrencyConversion CurConversion1 = null;
                                        if (indexCurrencyConversionDateValue != null)
                                        {
                                            CurConversion1 = filterConversionDate.FirstOrDefault(x => x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == indexCurrencyConversionDateValue.Value.Date);
                                            if (CurConversion1 != null)
                                            {
                                                if (DtDetection.Rows[j][indexValue] != DBNull.Value)
                                                    value = Convert.ToInt32(DtDetection.Rows[j][indexValue]);
                                                if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                    DtDetection.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                                else
                                                    DtDetection.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                                if (value != null)
                                                {
                                                    if (logic == 307)
                                                    {
                                                        DtDetection.Rows[j][indexSelectedCurrency] = IndexselectedCurrencyName_Value + (IndexselectedCurrencyName_Value * (value / 100));
                                                        if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                            DtDetection.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtDetection.Rows[j][indexSelectedCurrency]) * CurConversion1.ExchangeRate;
                                                        else
                                                            DtDetection.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtDetection.Rows[j][indexSelectedCurrency]) * CurConversion1.LastMonthAVGRate;

                                                    }
                                                    else if (logic == 308)
                                                    {
                                                        if (DtDetection.Rows[j][indexValue] == null || DtDetection.Rows[j][indexValue] == DBNull.Value || Convert.ToDouble(DtDetection.Rows[j][indexValue]) <= 0)
                                                        {
                                                            DtDetection.Rows[j][indexValue] = DBNull.Value;
                                                            DtDetection.Rows[j][indexSelectedCurrency] = DtDetection.Rows[j][indexValue];
                                                            DtDetection.Rows[j][IndexCurrencyName] = DBNull.Value;

                                                        }
                                                        else
                                                        {
                                                            DtDetection.Rows[j][indexSelectedCurrency] = DtDetection.Rows[j][indexValue];
                                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                                DtDetection.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtDetection.Rows[j][indexSelectedCurrency]) * CurConversion1.ExchangeRate;
                                                            else
                                                                DtDetection.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtDetection.Rows[j][indexSelectedCurrency]) * CurConversion1.LastMonthAVGRate;

                                                        }
                                                    }

                                                    else if (logic == 309)
                                                    {
                                                        if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                            DtDetection.Rows[j][indexSelectedCurrency] = Convert.ToDouble(DtDetection.Rows[j][indexSelectedCurrency]) * CurConversion1.ExchangeRate;
                                                        else
                                                            DtDetection.Rows[j][indexSelectedCurrency] = Convert.ToDouble(DtDetection.Rows[j][indexSelectedCurrency]) * CurConversion1.LastMonthAVGRate;

                                                    }
                                                }
                                            }
                                            else
                                            {
                                                DtDetection.Rows[j][IndexSelectedSaleCurrency] = DBNull.Value;
                                                DtDetection.Rows[j][IndexCurrencyName] = DBNull.Value;

                                            }
                                        }
                                        else
                                        {
                                            DtDetection.Rows[j][IndexSelectedSaleCurrency] = DBNull.Value;
                                        }
                                    }
                                    else
                                    {
                                        Int32 IndexSelectedSaleCurrency = DtDetection.Columns.IndexOf("CurrencyConversionRate_" + currency.Name);
                                        Int32 IndexCurrencyName = DtDetection.Columns.IndexOf(currency.Name);
                                        CurrencyConversion CurConversion1 = null;
                                        if (indexCurrencyConversionDateValue != null)
                                        {
                                            CurConversion1 = filterConversionDate.FirstOrDefault(x => x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == indexCurrencyConversionDateValue.Value.Date);
                                            if (CurConversion1 != null)
                                            {
                                                if (DtDetection.Rows[j][indexValue] != DBNull.Value)
                                                    value = Convert.ToInt32(DtDetection.Rows[j][indexValue]);
                                                if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                    DtDetection.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                                else
                                                    DtDetection.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                                if (value != null)
                                                {
                                                    if (logic == 307)
                                                    {
                                                        DtDetection.Rows[j][indexSelectedCurrency] = IndexselectedCurrencyName_Value + (IndexselectedCurrencyName_Value * (value / 100));
                                                        if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                            DtDetection.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtDetection.Rows[j][indexSelectedCurrency]) * CurConversion1.ExchangeRate;
                                                        else
                                                            DtDetection.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtDetection.Rows[j][indexSelectedCurrency]) * CurConversion1.LastMonthAVGRate;

                                                    }
                                                    else if (logic == 308)
                                                    {
                                                        if (DtDetection.Rows[j][indexValue] == null || DtDetection.Rows[j][indexValue] == DBNull.Value || Convert.ToDouble(DtDetection.Rows[j][indexValue]) <= 0)
                                                        {
                                                            DtDetection.Rows[j][indexValue] = DBNull.Value;
                                                            DtDetection.Rows[j][indexSelectedCurrency] = DtDetection.Rows[j][indexValue];
                                                            DtDetection.Rows[j][IndexCurrencyName] = DBNull.Value;

                                                        }
                                                        else
                                                        {
                                                            DtDetection.Rows[j][indexSelectedCurrency] = DtDetection.Rows[j][indexValue];
                                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                                DtDetection.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtDetection.Rows[j][indexSelectedCurrency]) * CurConversion1.ExchangeRate;
                                                            else
                                                                DtDetection.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtDetection.Rows[j][indexSelectedCurrency]) * CurConversion1.LastMonthAVGRate;

                                                        }
                                                    }

                                                    else if (logic == 309)
                                                    {
                                                        if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                            DtDetection.Rows[j][indexSelectedCurrency] = Convert.ToDouble(DtDetection.Rows[j][indexSelectedCurrency]) * CurConversion1.ExchangeRate;
                                                        else
                                                            DtDetection.Rows[j][indexSelectedCurrency] = Convert.ToDouble(DtDetection.Rows[j][indexSelectedCurrency]) * CurConversion1.LastMonthAVGRate;

                                                    }
                                                }
                                            }
                                            else
                                            {
                                                DtDetection.Rows[j][IndexSelectedSaleCurrency] = DBNull.Value;
                                                DtDetection.Rows[j][IndexCurrencyName] = DBNull.Value;

                                            }
                                        }
                                        else
                                        {
                                            DtDetection.Rows[j][IndexSelectedSaleCurrency] = DBNull.Value;
                                        }
                                    }
                                }
                            }
                            else
                            {
                                //for BPL
                                if (Convert.ToInt32(record.IdRule) == 307)
                                {
                                    DtDetection.Rows[j][indexSelectedCurrency] = Convert.ToDouble(record.MaxCost) + ((Convert.ToDouble(record.MaxCost) * (Convert.ToDouble(record.RuleValue) / 100)));

                                    foreach (Currency currency in SelectedSaleCurrency)
                                    {
                                        if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            Int32 IndexSelectedSaleCurrency = DtDetection.Columns.IndexOf("CurrencyConversionRate_" + "Common_Cur");
                                            Int32 IndexCurrencyName = DtDetection.Columns.IndexOf("Common_Cur");
                                            CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == indexCurrencyConversionDateValue.Value.Date);
                                            if (CurConversion1 != null)
                                            {
                                                if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                    DtDetection.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                                else
                                                    DtDetection.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                            }

                                            else
                                                DtDetection.Rows[j][IndexSelectedSaleCurrency] = DBNull.Value;
                                            if (DtDetection.Rows[j][IndexSelectedSaleCurrency] != DBNull.Value && DtDetection.Rows[j][IndexSelectedSaleCurrency] != null && DtDetection.Rows[j][IndexSelectedSaleCurrency] != "")
                                            {
                                                DtDetection.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtDetection.Rows[j][indexSelectedCurrency]) * Convert.ToDouble(DtDetection.Rows[j][IndexSelectedSaleCurrency]);
                                            }
                                            else
                                                DtDetection.Rows[j][IndexCurrencyName] = DBNull.Value;


                                            if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                DtDetection.Rows[j][IndexselectedCurrencyName_1] = DtDetection.Rows[j][IndexCurrencyName];
                                            }
                                        }
                                        else
                                        {
                                            Int32 IndexSelectedSaleCurrency = DtDetection.Columns.IndexOf("CurrencyConversionRate_" + currency.Name);
                                            Int32 IndexCurrencyName = DtDetection.Columns.IndexOf(currency.Name);
                                            CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == indexCurrencyConversionDateValue.Value.Date);
                                            if (CurConversion1 != null)
                                            {
                                                if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                    DtDetection.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                                else
                                                    DtDetection.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                            }

                                            else
                                                DtDetection.Rows[j][IndexSelectedSaleCurrency] = DBNull.Value;
                                            if (DtDetection.Rows[j][IndexSelectedSaleCurrency] != DBNull.Value && DtDetection.Rows[j][IndexSelectedSaleCurrency] != null && DtDetection.Rows[j][IndexSelectedSaleCurrency] != "")
                                            {
                                                DtDetection.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtDetection.Rows[j][indexSelectedCurrency]) * Convert.ToDouble(DtDetection.Rows[j][IndexSelectedSaleCurrency]);
                                            }
                                            else
                                                DtDetection.Rows[j][IndexCurrencyName] = DBNull.Value;


                                            if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                DtDetection.Rows[j][IndexselectedCurrencyName_1] = DtDetection.Rows[j][IndexCurrencyName];
                                            }
                                        }
                                    }
                                }
                                else if (Convert.ToInt32(record.IdRule) == 308)
                                {
                                    if (record.RuleValue == null || record.RuleValue <= 0)
                                    {
                                        DtDetection.Rows[j]["Value"] = DBNull.Value;
                                        DtDetection.Rows[j][indexSelectedCurrency] = DBNull.Value;

                                        foreach (Currency currency in SelectedSaleCurrency)
                                        {
                                            if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                Int32 IndexSelectedSaleCurrency = DtDetection.Columns.IndexOf("CurrencyConversionRate_" + "Common_Cur");
                                                Int32 IndexCurrencyName = DtDetection.Columns.IndexOf("Common_Cur");
                                                if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                                {
                                                    DtDetection.Rows[j][IndexselectedCurrencyName_1] = DtDetection.Rows[j][IndexCurrencyName];
                                                }
                                            }
                                            else
                                            {
                                                Int32 IndexSelectedSaleCurrency = DtDetection.Columns.IndexOf("CurrencyConversionRate_" + currency.Name);
                                                Int32 IndexCurrencyName = DtDetection.Columns.IndexOf(currency.Name);
                                                if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                                {
                                                    DtDetection.Rows[j][IndexselectedCurrencyName_1] = DtDetection.Rows[j][IndexCurrencyName];
                                                }
                                            }
                                        }
                                    }
                                    else
                                    {
                                        DtDetection.Rows[j][indexSelectedCurrency] = record.RuleValue;
                                        foreach (Currency currency in SelectedSaleCurrency)
                                        {
                                            if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                Int32 IndexSelectedSaleCurrency = DtDetection.Columns.IndexOf("CurrencyConversionRate_" + "Common_Cur");
                                                Int32 IndexCurrencyName = DtDetection.Columns.IndexOf("Common_Cur");
                                                CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == indexCurrencyConversionDateValue.Value.Date);
                                                if (CurConversion1 != null)
                                                {
                                                    if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                        DtDetection.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                                    else
                                                        DtDetection.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                                }

                                                else
                                                    DtDetection.Rows[j][IndexSelectedSaleCurrency] = DBNull.Value;
                                                if (DtDetection.Rows[j][IndexSelectedSaleCurrency] != DBNull.Value && DtDetection.Rows[j][IndexSelectedSaleCurrency] != null && DtDetection.Rows[j][IndexSelectedSaleCurrency] != "")
                                                    DtDetection.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtDetection.Rows[j][indexSelectedCurrency]) * Convert.ToDouble(DtDetection.Rows[j][IndexSelectedSaleCurrency]);
                                                else
                                                    DtDetection.Rows[j][IndexCurrencyName] = DBNull.Value;



                                                if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                                {
                                                    DtDetection.Rows[j][IndexselectedCurrencyName_1] = DtDetection.Rows[j][IndexCurrencyName];
                                                }
                                            }
                                            else
                                            {
                                                Int32 IndexSelectedSaleCurrency = DtDetection.Columns.IndexOf("CurrencyConversionRate_" + currency.Name);
                                                Int32 IndexCurrencyName = DtDetection.Columns.IndexOf(currency.Name);
                                                CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == indexCurrencyConversionDateValue.Value.Date);
                                                if (CurConversion1 != null)
                                                {
                                                    if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                        DtDetection.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                                    else
                                                        DtDetection.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                                }

                                                else
                                                    DtDetection.Rows[j][IndexSelectedSaleCurrency] = DBNull.Value;
                                                if (DtDetection.Rows[j][IndexSelectedSaleCurrency] != DBNull.Value && DtDetection.Rows[j][IndexSelectedSaleCurrency] != null && DtDetection.Rows[j][IndexSelectedSaleCurrency] != "")
                                                    DtDetection.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtDetection.Rows[j][indexSelectedCurrency]) * Convert.ToDouble(DtDetection.Rows[j][IndexSelectedSaleCurrency]);
                                                else
                                                    DtDetection.Rows[j][IndexCurrencyName] = DBNull.Value;



                                                if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                                {
                                                    DtDetection.Rows[j][IndexselectedCurrencyName_1] = DtDetection.Rows[j][IndexCurrencyName];
                                                }
                                            }
                                        }
                                    }
                                }
                                else if (Convert.ToInt32(record.IdRule) == 309)
                                {
                                    DtDetection.Rows[j][indexSelectedCurrency] = Convert.ToDouble(record.MaxCost) + (Convert.ToDouble(record.RuleValue));

                                    foreach (Currency currency in SelectedSaleCurrency)
                                    {
                                        if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            Int32 IndexSelectedSaleCurrency = DtDetection.Columns.IndexOf("CurrencyConversionRate_" + "Common_Cur");
                                            Int32 IndexCurrencyName = DtDetection.Columns.IndexOf("Common_Cur");
                                            CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == indexCurrencyConversionDateValue.Value.Date);
                                            if (CurConversion1 != null)
                                            {
                                                if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                    DtDetection.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                                else
                                                    DtDetection.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                            }

                                            else
                                                DtDetection.Rows[j][IndexSelectedSaleCurrency] = DBNull.Value;
                                            if (DtDetection.Rows[j][IndexSelectedSaleCurrency] != DBNull.Value && DtDetection.Rows[j][IndexSelectedSaleCurrency] != null && DtDetection.Rows[j][IndexSelectedSaleCurrency] != "")
                                                DtDetection.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtDetection.Rows[j][indexSelectedCurrency]) * Convert.ToDouble(DtDetection.Rows[j][IndexSelectedSaleCurrency]);
                                            else
                                                DtDetection.Rows[j][IndexCurrencyName] = DBNull.Value;


                                            if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                DtDetection.Rows[j][IndexselectedCurrencyName_1] = DtDetection.Rows[j][IndexCurrencyName];
                                            }
                                        }
                                        else
                                        {
                                            Int32 IndexSelectedSaleCurrency = DtDetection.Columns.IndexOf("CurrencyConversionRate_" + currency.Name);
                                            Int32 IndexCurrencyName = DtDetection.Columns.IndexOf(currency.Name);
                                            CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == indexCurrencyConversionDateValue.Value.Date);
                                            if (CurConversion1 != null)
                                            {
                                                if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                    DtDetection.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                                else
                                                    DtDetection.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                            }

                                            else
                                                DtDetection.Rows[j][IndexSelectedSaleCurrency] = DBNull.Value;
                                            if (DtDetection.Rows[j][IndexSelectedSaleCurrency] != DBNull.Value && DtDetection.Rows[j][IndexSelectedSaleCurrency] != null && DtDetection.Rows[j][IndexSelectedSaleCurrency] != "")
                                                DtDetection.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtDetection.Rows[j][indexSelectedCurrency]) * Convert.ToDouble(DtDetection.Rows[j][IndexSelectedSaleCurrency]);
                                            else
                                                DtDetection.Rows[j][IndexCurrencyName] = DBNull.Value;


                                            if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                DtDetection.Rows[j][IndexselectedCurrencyName_1] = DtDetection.Rows[j][IndexCurrencyName];
                                            }
                                        }
                                    }
                                }
                            }

                            if (DtDetection.Rows[j][indexSelectedCurrency] == DBNull.Value)
                            {
                                SellPriceValue = 0.00;
                            }
                            else
                            {
                                SellPriceValue = Convert.ToDouble(DtDetection.Rows[j][indexSelectedCurrency]); ;
                            }
                            DtDetection.Rows[j][indexProfit] = CalculateCustomerPriceProfitValue(Cost_Value, SellPriceValue);
                            DtDetection.Rows[j][indexCost] = CalculateCustomerPriceCostMarginValue(Cost_Value, SellPriceValue);
                        }
                        catch (Exception ex)
                        {
                            GeosApplication.Instance.Logger.Log(string.Format("Error in method CalculateBasePriceDetectionsByLogicValue() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                        }
                    }

                    DtDetection.AcceptChanges();
                    FilterBPLAndCPL();
                }
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method CalculateBasePriceDetectionsByLogicValue() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private double CalculateCustomerPriceProfitValue(double MaxCost, double SellPriceValue)
        {
            double Profit = 0;
            try
            {
                //GeosApplication.Instance.Logger.Log("Method CalculateCustomerPriceProfitValue() ...", category: Category.Info, priority: Priority.Low);

                if ((SellPriceValue == 0 && MaxCost == 0) || (SellPriceValue == MaxCost) || (SellPriceValue == 0 && MaxCost > 0))
                    Profit = 0.00;
                else
                    Profit = Convert.ToDouble(((((SellPriceValue) - (MaxCost)) / (SellPriceValue)) * 100));

                Profit = Math.Round(Profit, 2);

                //GeosApplication.Instance.Logger.Log("Method CalculateCustomerPriceProfitValue() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in CalculateCustomerPriceProfitValue() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
            return Profit;
        }

        private double CalculateCustomerPriceCostMarginValue(double MaxCost, double SellPriceValue)
        {
            double CostMargin = 0;
            try
            {
                //GeosApplication.Instance.Logger.Log("Method CalculateCustomerPriceCostMarginValue() ...", category: Category.Info, priority: Priority.Low);

                if ((MaxCost == 0 && SellPriceValue == 0) || (MaxCost == SellPriceValue) || (MaxCost == 0 && SellPriceValue > 0))
                    CostMargin = 0.00;
                else
                    CostMargin = Convert.ToDouble(((((SellPriceValue) - (MaxCost)) / (MaxCost)) * 100));

                CostMargin = Math.Round(CostMargin, 2);

                //GeosApplication.Instance.Logger.Log("Method CalculateCustomerPriceCostMarginValue() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in CalculateCustomerPriceCostMarginValue() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
            return CostMargin;
        }

        //[cpatil][001][25-02-2022][GEOS2-3564]
        private void FillDetectionData()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillDetectionData ...", category: Category.Info, priority: Priority.Low);
                double SellPriceValue = 0.00;
                if (DtDetectionCopy == null)
                    DtDetectionCopy = new DataTable();
                if (DetectionList == null)
                    DetectionList = new ObservableCollection<CustomerPriceListByItem>();

                if (SavedDetections == null)
                    SavedDetections = new List<CustomerPriceListByItem>();

                foreach (CustomerPriceListByItem record in DetectionList)
                {
                    try
                    {
                        double Cost_Value = 0;
                        DataRow dr = DtDetectionCopy.NewRow();
                        dr["IsChecked"] = false;

                        dr["CurrencyConversionDate"] = CurrencyConversionList.FirstOrDefault().LastUpdate;
                        if (SavedDetections.Any(a => a.IdDetection == record.IdDetection) && WindowHeader == System.Windows.Application.Current.FindResource("EditCustomerPriceList").ToString() && ClonedCustomerPrice.IdBasePriceList == SelectedBasePriceName.IdBasePriceList)
                        {
                            CustomerPriceListByItem record_saved = SavedDetections.FirstOrDefault(a => a.IdDetection == record.IdDetection);

                            if (string.IsNullOrEmpty(record_saved.Detection.Code)) //[001]
                                dr["Code"] = "---";
                            else
                                dr["Code"] = record_saved.Detection.Code;
                            //  dr["Code"] = record_saved.Detection.Code;
                            dr["Type"] = record_saved.Detection.DetectionTypes.Name;
                            dr["IdDetection"] = record_saved.IdDetection;
                            dr["STAT"] = record.Detection.StatusAbbreviation;
                            dr["HtmlColor"] = record.Detection.StatusHtmlColor;
                            Cost_Value = record.MaxCost;
                            dr["MaxCost_1"] = record.MaxCost;

                            if (record_saved.LinkedDescription == 1)
                            {
                                record_saved.ItemCustomerDescription = DetectionList.FirstOrDefault(a => a.IdDetection == Convert.ToUInt64(record_saved.IdDetection)).Detection.Name_es;
                                record_saved.ItemCustomerDescription_Old = record_saved.ItemCustomerDescription;
                                record.ItemCustomerDescription_Old = record_saved.ItemCustomerDescription;
                            }

                            if (record_saved.ItemCustomerDescription != null)
                                record_saved.ItemCustomerDescription = record_saved.ItemCustomerDescription.Trim('\n');
                            dr["Name"] = record_saved.ItemCustomerDescription;
                            dr["Logic"] = record_saved.IdRule;
                            dr["Value"] = record_saved.RuleValue;

                            dr["Enable_Delete"] = false;
                            dr["Enable_DescriptionLinked"] = false;
                            dr["Enable_VisibleCustomer"] = false;

                            if (Convert.ToInt32(record.IdRule) == 307)
                            {
                                foreach (Currency currency in SelectedSaleCurrency.Cast<Currency>().Where(a => a.IdCurrency == ((Currency)SelectedCurrency).IdCurrency).ToList())
                                {
                                    CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                    if (CurConversion1 != null)
                                    {
                                        if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                            dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                        else
                                            dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                    }

                                    else
                                        dr["CurrencyConversionRate_" + "Common_Cur"] = DBNull.Value;
                                    if (dr["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && dr["CurrencyConversionRate_" + "Common_Cur"] != null && dr["CurrencyConversionRate_" + "Common_Cur"] != "")
                                    {
                                        dr["BasePriceValue"] = Convert.ToDouble(Convert.ToDouble(record.MaxCost) + ((Convert.ToDouble(record.MaxCost) * (Convert.ToDouble(record.RuleValue) / 100)))) * Convert.ToDouble(dr["CurrencyConversionRate_" + "Common_Cur"]);
                                    }
                                    else
                                        dr["BasePriceValue"] = DBNull.Value;
                                }
                            }
                            else if (Convert.ToInt32(record.IdRule) == 308)
                            {
                                if (record.RuleValue == null || record.RuleValue <= 0)
                                {
                                    foreach (Currency currency in SelectedSaleCurrency.Cast<Currency>().Where(a => a.IdCurrency == ((Currency)SelectedCurrency).IdCurrency).ToList())
                                    {
                                        dr["BasePriceValue"] = DBNull.Value;
                                    }
                                }
                                else
                                {
                                    foreach (Currency currency in SelectedSaleCurrency.Cast<Currency>().Where(a => a.IdCurrency == ((Currency)SelectedCurrency).IdCurrency).ToList())
                                    {
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                            else
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                        }

                                        else
                                            dr["CurrencyConversionRate_" + "Common_Cur"] = DBNull.Value;
                                        if (dr["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && dr["CurrencyConversionRate_" + "Common_Cur"] != null && dr["CurrencyConversionRate_" + "Common_Cur"] != "")
                                            dr["BasePriceValue"] = Convert.ToDouble(record.RuleValue) * Convert.ToDouble(dr["CurrencyConversionRate_" + "Common_Cur"]);
                                        else
                                            dr["BasePriceValue"] = DBNull.Value;

                                    }
                                }
                            }
                            else if (Convert.ToInt32(record.IdRule) == 1518)
                            {
                                if (dr["Value"] == null || dr["Value"] == DBNull.Value)
                                {
                                    dr["Value"] = 0;
                                }
                                foreach (Currency currency in SelectedSaleCurrency.Cast<Currency>().Where(a => a.IdCurrency == ((Currency)SelectedCurrency).IdCurrency).ToList())
                                {
                                    CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                    if (CurConversion1 != null)
                                    {
                                        if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                            dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                        else
                                            dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                    }

                                    else
                                        dr["CurrencyConversionRate_" + "Common_Cur"] = DBNull.Value;

                                    dr["BasePriceValue"] = 0;
                                }

                                dr["Value"] = DBNull.Value;
                            }
                            else if (Convert.ToInt32(record.IdRule) == 309)
                            {

                                foreach (Currency currency in SelectedSaleCurrency.Cast<Currency>().Where(a => a.IdCurrency == ((Currency)SelectedCurrency).IdCurrency).ToList())
                                {
                                    CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                    if (CurConversion1 != null)
                                    {
                                        if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                            dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                        else
                                            dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                    }

                                    else
                                        dr["CurrencyConversionRate_" + "Common_Cur"] = DBNull.Value;
                                    if (dr["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && dr["CurrencyConversionRate_" + "Common_Cur"] != null && dr["CurrencyConversionRate_" + "Common_Cur"] != "")
                                        dr["BasePriceValue"] = Convert.ToDouble(Convert.ToDouble(dr["MaxCost_1"]) + (Convert.ToDouble(record.RuleValue))) * Convert.ToDouble(dr["CurrencyConversionRate_" + "Common_Cur"]);
                                    else
                                        dr["BasePriceValue"] = DBNull.Value;

                                }
                            }
                            //CPL saved 
                            dr["IsSalePriceValueColor"] = true;
                            dr["CurrencyConversionDate"] = CurrencyConversionList.FirstOrDefault().LastUpdate;

                            if (Convert.ToInt32(dr["Logic"]) == 307)
                            {
                                if (dr["Value"] == null || dr["Value"] == DBNull.Value)
                                {
                                    dr["Value"] = 0;
                                }

                                foreach (Currency currency in SelectedSaleCurrency)
                                {
                                    if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                    {
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                            else
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                        }

                                        else
                                            dr["CurrencyConversionRate_" + "Common_Cur"] = DBNull.Value;
                                        if (dr["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && dr["CurrencyConversionRate_" + "Common_Cur"] != null && dr["CurrencyConversionRate_" + "Common_Cur"] != "")
                                        {
                                            dr["Common_Cur"] = Convert.ToDouble(Convert.ToDouble(dr["MaxCost_1"]) + ((Convert.ToDouble(dr["MaxCost_1"]) * (Convert.ToDouble(dr["Value"]) / 100)))) * Convert.ToDouble(dr["CurrencyConversionRate_" + "Common_Cur"]);
                                        }
                                        else
                                            dr["Common_Cur"] = DBNull.Value;
                                    }
                                    else
                                    {
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.ExchangeRate;
                                            else
                                                dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.LastMonthAVGRate;
                                        }

                                        else
                                            dr["CurrencyConversionRate_" + currency.Name] = DBNull.Value;
                                        if (dr["CurrencyConversionRate_" + currency.Name] != DBNull.Value && dr["CurrencyConversionRate_" + currency.Name] != null && dr["CurrencyConversionRate_" + currency.Name] != "")
                                        {
                                            dr[currency.Name] = Convert.ToDouble(Convert.ToDouble(dr["MaxCost_1"]) + ((Convert.ToDouble(dr["MaxCost_1"]) * (Convert.ToDouble(dr["Value"]) / 100)))) * Convert.ToDouble(dr["CurrencyConversionRate_" + currency.Name]);
                                        }
                                        else
                                            dr[currency.Name] = DBNull.Value;
                                    }
                                }
                            }
                            else if (Convert.ToInt32(dr["Logic"]) == 308)
                            {
                                if (dr["Value"] == null || dr["Value"] == DBNull.Value || Convert.ToDouble(dr["Value"]) <= 0)
                                {
                                    dr["Value"] = DBNull.Value;
                                    dr["Common_Cur"] = DBNull.Value;
                                    foreach (Currency currency in SelectedSaleCurrency)
                                    {
                                        if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                            if (CurConversion1 != null)
                                            {
                                                if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                    dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                                else
                                                    dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                            }
                                            else
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = DBNull.Value;
                                            dr["Common_Cur"] = DBNull.Value;
                                        }
                                        else
                                        {
                                            CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                            if (CurConversion1 != null)
                                            {
                                                if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                    dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.ExchangeRate;
                                                else
                                                    dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.LastMonthAVGRate;
                                            }
                                            else
                                                dr["CurrencyConversionRate_" + currency.Name] = DBNull.Value;
                                            dr[currency.Name] = DBNull.Value;
                                        }
                                    }
                                }
                                else
                                {
                                    if (dr["Value"] == null || dr["Value"] == DBNull.Value)
                                    {
                                        dr["Value"] = 0;
                                    }
                                    dr["Common_Cur"] = dr["Value"];
                                    foreach (Currency currency in SelectedSaleCurrency)
                                    {
                                        if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                            if (CurConversion1 != null)
                                            {
                                                if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                    dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                                else
                                                    dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                            }

                                            else
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = DBNull.Value;
                                            if (dr["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && dr["CurrencyConversionRate_" + "Common_Cur"] != null && dr["CurrencyConversionRate_" + "Common_Cur"] != "")
                                                dr["Common_Cur"] = Convert.ToDouble(dr["Common_Cur"]) * Convert.ToDouble(dr["CurrencyConversionRate_" + "Common_Cur"]);
                                            else
                                                dr["Common_Cur"] = DBNull.Value;
                                        }
                                        else
                                        {
                                            CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                            if (CurConversion1 != null)
                                            {
                                                if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                    dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.ExchangeRate;
                                                else
                                                    dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.LastMonthAVGRate;
                                            }

                                            else
                                                dr["CurrencyConversionRate_" + currency.Name] = DBNull.Value;
                                            if (dr["CurrencyConversionRate_" + currency.Name] != DBNull.Value && dr["CurrencyConversionRate_" + currency.Name] != null && dr["CurrencyConversionRate_" + currency.Name] != "")
                                                dr[currency.Name] = Convert.ToDouble(dr["Common_Cur"]) * Convert.ToDouble(dr["CurrencyConversionRate_" + currency.Name]);
                                            else
                                                dr[currency.Name] = DBNull.Value;
                                        }
                                    }
                                }
                            }
                            else if (Convert.ToInt32(dr["Logic"]) == 1518)
                            {
                                if (dr["Value"] == null || dr["Value"] == DBNull.Value)
                                {
                                    dr["Value"] = 0;
                                }
                                foreach (Currency currency in SelectedSaleCurrency)
                                {
                                    if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                    {
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                            else
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                        }

                                        else
                                            dr["CurrencyConversionRate_" + "Common_Cur"] = DBNull.Value;
                                        dr["Common_Cur"] = 0;
                                    }
                                    else
                                    {
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.ExchangeRate;
                                            else
                                                dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.LastMonthAVGRate;
                                        }

                                        else
                                            dr["CurrencyConversionRate_" + currency.Name] = DBNull.Value;
                                        dr[currency.Name] = 0;
                                    }
                                }
                            }
                            else if (Convert.ToInt32(dr["Logic"]) == 309)
                            {
                                if (dr["Value"] == null || dr["Value"] == DBNull.Value)
                                {
                                    dr["Value"] = 0;
                                }

                                dr["Common_Cur"] = Convert.ToDouble(dr["MaxCost_1"]) + (Convert.ToDouble(dr["Value"]));

                                foreach (Currency currency in SelectedSaleCurrency)
                                {
                                    if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                    {
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                            else
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                        }

                                        else
                                            dr["CurrencyConversionRate_" + "Common_Cur"] = DBNull.Value;
                                        if (dr["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && dr["CurrencyConversionRate_" + "Common_Cur"] != null && dr["CurrencyConversionRate_" + "Common_Cur"] != "")
                                            dr["Common_Cur"] = Convert.ToDouble(dr["Common_Cur"]) * Convert.ToDouble(dr["CurrencyConversionRate_" + "Common_Cur"]);
                                        else
                                            dr["Common_Cur"] = DBNull.Value;
                                    }
                                    else
                                    {
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.ExchangeRate;
                                            else
                                                dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.LastMonthAVGRate;
                                        }

                                        else
                                            dr["CurrencyConversionRate_" + currency.Name] = DBNull.Value;
                                        if (dr["CurrencyConversionRate_" + currency.Name] != DBNull.Value && dr["CurrencyConversionRate_" + currency.Name] != null && dr["CurrencyConversionRate_" + currency.Name] != "")
                                            dr[currency.Name] = Convert.ToDouble(dr["Common_Cur"]) * Convert.ToDouble(dr["CurrencyConversionRate_" + currency.Name]);
                                        else
                                            dr[currency.Name] = DBNull.Value;
                                    }
                                }
                            }

                            dr["Name_Old"] = record_saved.ItemCustomerDescription_Old;



                            if (record_saved.LinkedDescription == 0)
                            {
                                dr["Name_Changed"] = true;
                                dr["NameChanged"] = "Unlinked Description";
                            }
                            else
                            {
                                dr["Name_Changed"] = false;
                                dr["NameChanged"] = "Linked Description";
                            }

                            if (record_saved.VisibleToCustomer == 0)
                            {
                                dr["Visible_Customer"] = false;
                                dr["VisibleCustomer"] = "Invisible";
                            }
                            else
                            {
                                dr["Visible_Customer"] = true;
                                dr["VisibleCustomer"] = "Visible";
                            }
                        }
                        else
                        {
                            if (string.IsNullOrEmpty(record.Detection.Code)) //[001]
                                dr["Code"] = "---";
                            else
                                dr["Code"] = record.Detection.Code;
                            // dr["Code"] = record.Detection.Code;
                            dr["Type"] = record.Detection.DetectionTypes.Name;
                            dr["IdDetection"] = record.IdDetection;
                            dr["STAT"] = record.Detection.StatusAbbreviation;
                            dr["HtmlColor"] = record.Detection.StatusHtmlColor;
                            Cost_Value = record.MaxCost;
                            dr["MaxCost_1"] = record.MaxCost;

                            if (record.LinkedDescription == 1)
                            {
                                record.ItemCustomerDescription = DetectionList.FirstOrDefault(a => a.IdDetection == Convert.ToUInt64(record.IdDetection)).Detection.Name_es;
                                record.ItemCustomerDescription_Old = record.ItemCustomerDescription;
                            }

                            dr["Name"] = record.Detection.Name;
                            dr["Logic"] = SelectedLogic.IdLookupValue;
                            dr["Value"] = DBNull.Value;

                            dr["Enable_Delete"] = true;
                            dr["Enable_DescriptionLinked"] = true;
                            dr["Enable_VisibleCustomer"] = true;

                            //base price

                            dr["IsSalePriceValueColor"] = false;

                            if (Convert.ToInt32(record.IdRule) == 307)
                            {
                                dr["Common_Cur"] = Convert.ToDouble(record.MaxCost) + ((Convert.ToDouble(record.MaxCost) * (Convert.ToDouble(record.RuleValue) / 100)));

                                foreach (Currency currency in SelectedSaleCurrency)
                                {
                                    if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                    {
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                            else
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                        }

                                        else
                                            dr["CurrencyConversionRate_" + "Common_Cur"] = DBNull.Value;
                                        if (dr["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && dr["CurrencyConversionRate_" + "Common_Cur"] != null && dr["CurrencyConversionRate_" + "Common_Cur"] != "")
                                        {
                                            dr["Common_Cur"] = Convert.ToDouble(dr["Common_Cur"]) * Convert.ToDouble(dr["CurrencyConversionRate_" + "Common_Cur"]);
                                        }
                                        else
                                            dr["Common_Cur"] = DBNull.Value;


                                        if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            dr["BasePriceValue"] = dr["Common_Cur"];
                                        }
                                    }
                                    else
                                    {
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.ExchangeRate;
                                            else
                                                dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.LastMonthAVGRate;
                                        }

                                        else
                                            dr["CurrencyConversionRate_" + currency.Name] = DBNull.Value;
                                        if (dr["CurrencyConversionRate_" + currency.Name] != DBNull.Value && dr["CurrencyConversionRate_" + currency.Name] != null && dr["CurrencyConversionRate_" + currency.Name] != "")
                                        {
                                            dr[currency.Name] = Convert.ToDouble(dr["Common_Cur"]) * Convert.ToDouble(dr["CurrencyConversionRate_" + currency.Name]);
                                        }
                                        else
                                            dr[currency.Name] = DBNull.Value;


                                        if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            dr["BasePriceValue"] = dr[currency.Name];
                                        }
                                    }
                                }
                            }
                            else if (Convert.ToInt32(record.IdRule) == 308)
                            {
                                if (record.RuleValue == null || record.RuleValue <= 0)
                                {
                                    dr["Value"] = DBNull.Value;
                                    dr["Common_Cur"] = DBNull.Value;
                                    foreach (Currency currency in SelectedSaleCurrency)
                                    {
                                        if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            dr["Common_Cur"] = DBNull.Value;

                                            CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                            if (CurConversion1 != null)
                                            {
                                                if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                    dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                                else
                                                    dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                            }

                                            else
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = DBNull.Value;

                                            if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                dr["BasePriceValue"] = dr["Common_Cur"];
                                            }
                                        }
                                        else
                                        {
                                            dr[currency.Name] = DBNull.Value;

                                            CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                            if (CurConversion1 != null)
                                            {
                                                if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                    dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.ExchangeRate;
                                                else
                                                    dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.LastMonthAVGRate;
                                            }

                                            else
                                                dr["CurrencyConversionRate_" + currency.Name] = DBNull.Value;

                                            if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                dr["BasePriceValue"] = dr[currency.Name];
                                            }
                                        }
                                    }
                                }
                                else
                                {
                                    dr["Common_Cur"] = record.RuleValue;
                                    foreach (Currency currency in SelectedSaleCurrency)
                                    {
                                        if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                            if (CurConversion1 != null)
                                            {
                                                if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                    dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                                else
                                                    dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                            }

                                            else
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = DBNull.Value;
                                            if (dr["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && dr["CurrencyConversionRate_" + "Common_Cur"] != null && dr["CurrencyConversionRate_" + "Common_Cur"] != "")
                                                dr["Common_Cur"] = Convert.ToDouble(dr["Common_Cur"]) * Convert.ToDouble(dr["CurrencyConversionRate_" + "Common_Cur"]);
                                            else
                                                dr["Common_Cur"] = DBNull.Value;


                                            if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                dr["BasePriceValue"] = dr["Common_Cur"];
                                            }
                                        }
                                        else
                                        {
                                            CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                            if (CurConversion1 != null)
                                            {
                                                if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                    dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.ExchangeRate;
                                                else
                                                    dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.LastMonthAVGRate;
                                            }

                                            else
                                                dr["CurrencyConversionRate_" + currency.Name] = DBNull.Value;
                                            if (dr["CurrencyConversionRate_" + currency.Name] != DBNull.Value && dr["CurrencyConversionRate_" + currency.Name] != null && dr["CurrencyConversionRate_" + currency.Name] != "")
                                                dr[currency.Name] = Convert.ToDouble(dr["Common_Cur"]) * Convert.ToDouble(dr["CurrencyConversionRate_" + currency.Name]);
                                            else
                                                dr[currency.Name] = DBNull.Value;


                                            if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                dr["BasePriceValue"] = dr[currency.Name];
                                            }
                                        }
                                    }
                                }
                            }
                            else if (Convert.ToInt32(record.IdRule) == 1518)
                            {
                                if (dr["Value"] == null || dr["Value"] == DBNull.Value)
                                {
                                    dr["Value"] = 0;
                                }
                                foreach (Currency currency in SelectedSaleCurrency)
                                {
                                    if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                    {
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                            else
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                        }

                                        else
                                            dr["CurrencyConversionRate_" + "Common_Cur"] = DBNull.Value;

                                        dr["Common_Cur"] = 0;
                                        if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            dr["BasePriceValue"] = dr["Common_Cur"];
                                        }
                                    }
                                    else
                                    {
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.ExchangeRate;
                                            else
                                                dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.LastMonthAVGRate;
                                        }

                                        else
                                            dr["CurrencyConversionRate_" + currency.Name] = DBNull.Value;

                                        dr[currency.Name] = 0;
                                        if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            dr["BasePriceValue"] = dr[currency.Name];
                                        }
                                    }
                                }

                                dr["Value"] = DBNull.Value;
                            }
                            else if (Convert.ToInt32(record.IdRule) == 309)
                            {
                                dr["Common_Cur"] = Convert.ToDouble(dr["MaxCost_1"]) + (Convert.ToDouble(record.RuleValue));

                                foreach (Currency currency in SelectedSaleCurrency)
                                {
                                    if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                    {
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                            else
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                        }

                                        else
                                            dr["CurrencyConversionRate_" + "Common_Cur"] = DBNull.Value;
                                        if (dr["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && dr["CurrencyConversionRate_" + "Common_Cur"] != null && dr["CurrencyConversionRate_" + "Common_Cur"] != "")
                                            dr["Common_Cur"] = Convert.ToDouble(dr["Common_Cur"]) * Convert.ToDouble(dr["CurrencyConversionRate_" + "Common_Cur"]);
                                        else
                                            dr["Common_Cur"] = DBNull.Value;


                                        if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            dr["BasePriceValue"] = dr["Common_Cur"];
                                        }
                                    }
                                    else
                                    {
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.ExchangeRate;
                                            else
                                                dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.LastMonthAVGRate;
                                        }

                                        else
                                            dr["CurrencyConversionRate_" + currency.Name] = DBNull.Value;
                                        if (dr["CurrencyConversionRate_" + currency.Name] != DBNull.Value && dr["CurrencyConversionRate_" + currency.Name] != null && dr["CurrencyConversionRate_" + currency.Name] != "")
                                            dr[currency.Name] = Convert.ToDouble(dr["Common_Cur"]) * Convert.ToDouble(dr["CurrencyConversionRate_" + currency.Name]);
                                        else
                                            dr[currency.Name] = DBNull.Value;


                                        if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            dr["BasePriceValue"] = dr[currency.Name];
                                        }
                                    }
                                }
                            }

                            dr["Name_Old"] = record.ItemCustomerDescription_Old;

                            dr["Name_Changed"] = false;
                            dr["NameChanged"] = "Linked Description";

                            dr["Visible_Customer"] = true;
                            dr["VisibleCustomer"] = "Visible";
                        }


                        if (dr["Common_Cur"] == DBNull.Value)
                            SellPriceValue = 0.00;
                        else
                            SellPriceValue = Convert.ToDouble(dr["Common_Cur"]);

                        dr["Profit"] = CalculateCustomerPriceProfitValue(Cost_Value, SellPriceValue);
                        dr["CostMargin"] = CalculateCustomerPriceCostMarginValue(Cost_Value, SellPriceValue);
                        if (dr["CurrencyConversionDate"] != DBNull.Value)
                        {
                            //[rdixit][13.03.2023][GEOS2-3177]
                            if (SelectedExchangeRate != null)
                            {
                                if (SelectedExchangeRate.IdLookupValue == 1509)
                                {
                                    dr["SaleCurrencyConversionDate"] = "Updated currency rate on : " + DateTime.Now.ToString("dd/MM/yyyy");
                                }
                                else
                                {
                                    dr["SaleCurrencyConversionDate"] = "Updated currency rate on : " + Convert.ToDateTime(dr["CurrencyConversionDate"]).ToString("dd/MM/yyyy");
                                }
                            }
                            else
                            {
                                dr["SaleCurrencyConversionDate"] = "Updated currency rate on : " + Convert.ToDateTime(dr["CurrencyConversionDate"]).ToString("dd/MM/yyyy");
                            }
                        }
                        DtDetectionCopy.Rows.Add(dr);
                        IsEnabledSaveButton = true;//[Sudhir.Jangra][GEOS2-3349][27/12/2022]
                        DtDetection = DtDetectionCopy;
                    }
                    catch (Exception ex)
                    {
                        GeosApplication.Instance.Logger.Log("Get an error in FillDetectionData() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
                    }
                }
                GeosApplication.Instance.Logger.Log("Method FillDetectionData() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in FillDetectionData() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), "Red", CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in FillDetectionData() Method - ServiceUnexceptedException " + ex.Message, category: Category.Info, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillDetectionData() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        private void DetectionVisibleCustomerCommandAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method DetectionVisibleCustomerCommandAction()...", category: Category.Info, priority: Priority.Low);

                DataColumn[] columns = DtDetectionCopy.Columns.Cast<DataColumn>().ToArray();
                DataRow[] foundChecked = DtDetectionCopy.AsEnumerable().Where(row => columns.Any(col => row["IsChecked"].ToString() == "True")).ToArray();
                DataRow MainRow = ((System.Data.DataRowView)obj).Row;
                bool value = Convert.ToBoolean(MainRow["Visible_Customer"]);
                if (foundChecked.Length > 0 && MainRow["IsChecked"].ToString() != "False")
                {
                    foreach (DataRow item in foundChecked)
                    {
                        DataRow Row = item;
                        if (Row["IsChecked"].ToString() != "False")
                        {
                            if (Convert.ToUInt32(Row["IdDetection"]) != Convert.ToUInt32(MainRow["IdDetection"]))
                            {
                                if (MainRow["Visible_Customer"] != DBNull.Value && Convert.ToBoolean(MainRow["Visible_Customer"]) == false)
                                {
                                    Row["Visible_Customer"] = true;
                                    Row["VisibleCustomer"] = "Visible";
                                }
                                else
                                {
                                    Row["Visible_Customer"] = false;
                                    Row["VisibleCustomer"] = "Invisible";
                                }


                                Row["IsColor"] = true;
                                Row["IsSalePriceValueColor"] = true;
                                Row["IsUpdatedRow"] = true;

                            }
                        }
                    }

                }

                DataRow Row1 = ((System.Data.DataRowView)obj).Row;
                if (Row1["Visible_Customer"] != DBNull.Value && Convert.ToBoolean(Row1["Visible_Customer"]) == false)
                {
                    Row1["Visible_Customer"] = true;
                    Row1["VisibleCustomer"] = "Visible";
                }
                else
                {
                    Row1["Visible_Customer"] = false;
                    Row1["VisibleCustomer"] = "Invisible";
                }

                Row1["IsColor"] = true;
                Row1["IsSalePriceValueColor"] = true;
                Row1["IsUpdatedRow"] = true;
                IsEnabledSaveButton = true;
                GeosApplication.Instance.Logger.Log("Method DetectionVisibleCustomerCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method DetectionVisibleCustomerCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }


        private void DetectionDescriptionLinkedCommandAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method DetectionDescriptionLinkedCommandAction()...", category: Category.Info, priority: Priority.Low);

                DataColumn[] columns = DtDetectionCopy.Columns.Cast<DataColumn>().ToArray();
                DataRow[] foundChecked = DtDetectionCopy.AsEnumerable().Where(row => columns.Any(col => row["IsChecked"].ToString() == "True")).ToArray();
                DataRow MainRow = ((System.Data.DataRowView)obj).Row;
                bool value = Convert.ToBoolean(MainRow["Name_Changed"]);
                if (foundChecked.Length > 0 && MainRow["IsChecked"].ToString() != "False")
                {
                    foreach (DataRow item in foundChecked)
                    {
                        DataRow Row = item;
                        if (Row["IsChecked"].ToString() != "False")
                        {
                            if (Convert.ToUInt32(Row["IdDetection"]) != Convert.ToUInt32(MainRow["IdDetection"]))
                            {
                                if (MainRow["Name_Changed"] != DBNull.Value && Convert.ToBoolean(MainRow["Name_Changed"]) == false)
                                {
                                    Row["Name_Changed"] = true;
                                    Row["NameChanged"] = "Unlinked Description";
                                }
                                else
                                {
                                    Row["Name_Changed"] = false;
                                    Row["NameChanged"] = "Linked Description";
                                    Row["Name"] = DetectionList.FirstOrDefault(a => a.IdDetection == Convert.ToUInt64(Row["IdDetection"])).Detection.Name_es;

                                }
                                Row["IsColor"] = true;
                                Row["IsSalePriceValueColor"] = true;

                            }
                        }
                    }

                }

                DataRow Row1 = ((System.Data.DataRowView)obj).Row;
                if (Row1["Name_Changed"] != DBNull.Value && Convert.ToBoolean(Row1["Name_Changed"]) == false)
                {
                    Row1["Name_Changed"] = true;
                    Row1["NameChanged"] = "Unlinked Description";
                }
                else
                {
                    Row1["Name_Changed"] = false;
                    Row1["NameChanged"] = "Linked Description";
                    Row1["Name"] = DetectionList.FirstOrDefault(a => a.IdDetection == Convert.ToUInt64(Row1["IdDetection"])).Detection.Name_es; //DetectionMenuList.FirstOrDefault(a => a.IdDetection == Convert.ToUInt64(Row1["IdDetection"])).Description;
                }

                Row1["IsColor"] = true;
                Row1["IsSalePriceValueColor"] = true;
                Row1["IsUpdatedRow"] = true;
                IsEnabledSaveButton = true;
                GeosApplication.Instance.Logger.Log("Method DetectionDescriptionLinkedCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method DetectionDescriptionLinkedCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void RuleValueChangedDetectionCommandAction(object obj)
        {
            try
            {
                double MaxCost = 0.00;
                double SellPriceValue = 0.00;

                if (((DevExpress.Xpf.Grid.CellValueEventArgs)obj).Column.FieldName == "Value" || ((DevExpress.Xpf.Grid.CellValueEventArgs)obj).Column.FieldName == "Logic")
                {
                    IsCalculateArticleCostButtonEnabled = true;
                    IsCalculated = false;
                    DataColumn[] columns = DtDetectionCopy.Columns.Cast<DataColumn>().ToArray();
                    DataRow[] foundChecked = DtDetectionCopy.AsEnumerable().Where(row => columns.Any(col => row["IsChecked"].ToString() == "True")).ToArray();
                    DataRow MainRow = ((System.Data.DataRowView)((DevExpress.Xpf.Grid.RowEventArgs)obj).Row).Row;
                    MainRow["Enable_Delete"] = false;
                    MainRow["Enable_DescriptionLinked"] = false;
                    MainRow["Enable_VisibleCustomer"] = false;

                    if (foundChecked.Length > 0 && MainRow["IsChecked"].ToString() != "False")
                    {
                        for (int j = 0; j < foundChecked.Length; j++)
                        {
                            foundChecked[j].BeginEdit();
                            if (((DevExpress.Xpf.Grid.CellValueEventArgs)obj).Column.FieldName == "Value")
                            {
                                if (MainRow["Value"] == DBNull.Value)
                                {
                                    MainRow["Value"] = 0;
                                }
                                foundChecked[j]["Value"] = MainRow["Value"];
                            }
                            else
                            {
                                if (foundChecked[j]["Value"] == DBNull.Value)
                                {
                                    foundChecked[j]["Value"] = 0;
                                }
                            }

                            if (((DevExpress.Xpf.Grid.CellValueEventArgs)obj).Column.FieldName == "Logic")
                            {
                                if (MainRow["Logic"] == DBNull.Value || Convert.ToInt32(MainRow["Logic"]) == 0)
                                {
                                    MainRow["Logic"] = 0;
                                    MainRow["Value"] = DBNull.Value;
                                }
                                foundChecked[j]["Logic"] = MainRow["Logic"];
                                foundChecked[j]["Value"] = MainRow["Value"];
                            }
                            else
                            {
                                if (foundChecked[j]["Logic"] == DBNull.Value || Convert.ToInt32(foundChecked[j]["Logic"]) == 0)
                                {
                                    foundChecked[j]["Logic"] = 308;
                                }
                            }
                            if (MainRow["IsChecked"].ToString() != "False")
                            {
                                foundChecked[j]["IsColor"] = true;
                                foundChecked[j]["IsUpdatedRow"] = true;

                                if (foundChecked[j]["MaxCost_1"] == DBNull.Value)
                                    foundChecked[j]["MaxCost_1"] = 0;
                                if (foundChecked[j]["Logic"] != DBNull.Value && Convert.ToInt32(foundChecked[j]["Logic"]) != 0)
                                {
                                    foundChecked[j]["IsSalePriceValueColor"] = true;
                                    foundChecked[j]["Enable_Delete"] = false;
                                    foundChecked[j]["Enable_DescriptionLinked"] = false;
                                    foundChecked[j]["Enable_VisibleCustomer"] = false;
                                    if (Convert.ToInt32(foundChecked[j]["Logic"]) == 307)
                                    {
                                        if (foundChecked[j]["MaxCost_1"] == DBNull.Value)
                                        {
                                            foundChecked[j]["MaxCost_1"] = 0;
                                        }
                                        foundChecked[j]["Common_Cur"] = Convert.ToDouble(foundChecked[j]["MaxCost_1"]) + (Convert.ToDouble(foundChecked[j]["MaxCost_1"]) * (Convert.ToDouble(foundChecked[j]["Value"]) / 100));
                                        foreach (Currency cur in SelectedSaleCurrency)
                                        {
                                            if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                if (foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != null && foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != "")
                                                    foundChecked[j]["Common_Cur"] = Convert.ToDouble(foundChecked[j]["Common_Cur"]) * Convert.ToDouble(foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"]);
                                                else
                                                    foundChecked[j]["Common_Cur"] = DBNull.Value;
                                            }
                                            else
                                            {
                                                if (foundChecked[j]["CurrencyConversionRate_" + cur.Name] != DBNull.Value && foundChecked[j]["CurrencyConversionRate_" + cur.Name] != null && foundChecked[j]["CurrencyConversionRate_" + cur.Name] != "")
                                                    foundChecked[j][cur.Name] = Convert.ToDouble(foundChecked[j]["Common_Cur"]) * Convert.ToDouble(foundChecked[j]["CurrencyConversionRate_" + cur.Name]);
                                                else
                                                    foundChecked[j][cur.Name] = DBNull.Value;
                                            }
                                        }
                                    }
                                    else if (Convert.ToInt32(foundChecked[j]["Logic"]) == 308)
                                    {
                                        if (foundChecked[j]["Value"] == null || foundChecked[j]["Value"] == DBNull.Value || Convert.ToDouble(foundChecked[j]["Value"]) <= 0)
                                        {
                                            foundChecked[j]["Value"] = DBNull.Value;
                                            foundChecked[j]["Common_Cur"] = DBNull.Value;
                                            foreach (Currency cur in SelectedSaleCurrency)
                                            {
                                                if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                                {
                                                    foundChecked[j]["Common_Cur"] = DBNull.Value;
                                                }
                                                else
                                                {
                                                    foundChecked[j][cur.Name] = DBNull.Value;
                                                }
                                            }
                                        }
                                        else
                                        {
                                            if (foundChecked[j]["MaxCost_1"] == DBNull.Value)
                                            {
                                                foundChecked[j]["MaxCost_1"] = 0;
                                            }

                                            foundChecked[j]["Common_Cur"] = foundChecked[j]["Value"];
                                            foreach (Currency cur in SelectedSaleCurrency)
                                            {
                                                if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                                {
                                                    if (foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != null && foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != "")
                                                        foundChecked[j]["Common_Cur"] = Convert.ToDouble(foundChecked[j]["Common_Cur"]) * Convert.ToDouble(foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"]);
                                                    else
                                                        foundChecked[j]["Common_Cur"] = DBNull.Value;
                                                }
                                                else
                                                {
                                                    if (foundChecked[j]["CurrencyConversionRate_" + cur.Name] != DBNull.Value && foundChecked[j]["CurrencyConversionRate_" + cur.Name] != null && foundChecked[j]["CurrencyConversionRate_" + cur.Name] != "")
                                                        foundChecked[j][cur.Name] = Convert.ToDouble(foundChecked[j]["Common_Cur"]) * Convert.ToDouble(foundChecked[j]["CurrencyConversionRate_" + cur.Name]);
                                                    else
                                                        foundChecked[j][cur.Name] = DBNull.Value;
                                                }
                                            }
                                        }
                                    }
                                    else if (Convert.ToInt32(foundChecked[j]["Logic"]) == 1518)
                                    {
                                        if (foundChecked[j]["Value"] == null || foundChecked[j]["Value"] == DBNull.Value)
                                        {
                                            foundChecked[j]["Value"] = 0;

                                            foundChecked[j]["Common_Cur"] = 0;

                                            foreach (Currency cur in SelectedSaleCurrency)
                                            {
                                                if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                                {
                                                    foundChecked[j]["Common_Cur"] = 0;
                                                }
                                                else
                                                {
                                                    foundChecked[j][cur.Name] = 0;
                                                }
                                            }
                                        }
                                        else if (foundChecked[j]["Value"] != null && Convert.ToInt32(foundChecked[j]["Value"]) >= 0)
                                        {
                                            foundChecked[j]["Value"] = 0;

                                            foundChecked[j]["Common_Cur"] = 0;

                                            foreach (Currency cur in SelectedSaleCurrency)
                                            {
                                                if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                                {
                                                    foundChecked[j]["Common_Cur"] = 0;
                                                }
                                                else
                                                {
                                                    foundChecked[j][cur.Name] = 0;
                                                }
                                            }
                                        }
                                    }
                                    else if (Convert.ToInt32(foundChecked[j]["Logic"]) == 309)
                                    {
                                        if (foundChecked[j]["MaxCost_1"] == DBNull.Value)
                                        {
                                            foundChecked[j]["MaxCost_1"] = 0;
                                        }
                                        foundChecked[j]["Common_Cur"] = Convert.ToDouble(foundChecked[j]["MaxCost_1"]) + (Convert.ToDouble(foundChecked[j]["Value"]));
                                        foreach (Currency cur in SelectedSaleCurrency)
                                        {
                                            if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                if (foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != null && foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != "")
                                                    foundChecked[j]["Common_Cur"] = Convert.ToDouble(foundChecked[j]["Common_Cur"]) * Convert.ToDouble(foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"]);
                                                else
                                                    foundChecked[j]["Common_Cur"] = DBNull.Value;
                                            }
                                            else
                                            {
                                                if (foundChecked[j]["CurrencyConversionRate_" + cur.Name] != DBNull.Value && foundChecked[j]["CurrencyConversionRate_" + cur.Name] != null && foundChecked[j]["CurrencyConversionRate_" + cur.Name] != "")
                                                    foundChecked[j][cur.Name] = Convert.ToDouble(foundChecked[j]["Common_Cur"]) * Convert.ToDouble(foundChecked[j]["CurrencyConversionRate_" + cur.Name]);
                                                else
                                                    foundChecked[j][cur.Name] = DBNull.Value;
                                            }
                                        }
                                    }
                                }
                                else
                                {
                                    //set from bpl
                                    foundChecked[j]["IsSalePriceValueColor"] = false;
                                    foundChecked[j]["Enable_Delete"] = true;
                                    foundChecked[j]["Enable_DescriptionLinked"] = true;
                                    foundChecked[j]["Enable_VisibleCustomer"] = true;
                                    CustomerPriceListByItem record = DetectionList.FirstOrDefault(a => a.IdDetection == Convert.ToUInt64(foundChecked[j]["IdDetection"]));
                                    int indexSelectedCurrency = DtDetection.Columns.IndexOf("Common_Cur");
                                    int indexCurrencyConversionDate = DtDetection.Columns.IndexOf("CurrencyConversionDate");
                                    DateTime? indexCurrencyConversionDateValue = null;
                                    //if (record.CurrencyConversionDate_New != null)
                                    //{
                                    //    indexCurrencyConversionDateValue = Convert.ToDateTime(record.CurrencyConversionDate_New);
                                    //    foundChecked[j]["CurrencyConversionDate"] = indexCurrencyConversionDateValue;
                                    //}

                                    indexCurrencyConversionDateValue = CurrencyConversionList.FirstOrDefault().LastUpdate;
                                    foundChecked[j]["CurrencyConversionDate"] = indexCurrencyConversionDateValue;


                                    if (Convert.ToInt32(record.IdRule) == 307)
                                    {
                                        foundChecked[j][indexSelectedCurrency] = Convert.ToDouble(record.MaxCost) + ((Convert.ToDouble(record.MaxCost) * (Convert.ToDouble(record.RuleValue) / 100)));

                                        foreach (Currency currency in SelectedSaleCurrency)
                                        {
                                            if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                Int32 IndexSelectedSaleCurrency = DtDetection.Columns.IndexOf("CurrencyConversionRate_" + "Common_Cur");
                                                Int32 IndexCurrencyName = DtDetection.Columns.IndexOf("Common_Cur");
                                                CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(indexCurrencyConversionDateValue.Value.Date));
                                                if (CurConversion1 != null)
                                                {
                                                    if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                        foundChecked[j][IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                                    else
                                                        foundChecked[j][IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                                }

                                                else
                                                    foundChecked[j][IndexSelectedSaleCurrency] = DBNull.Value;
                                                if (foundChecked[j][IndexSelectedSaleCurrency] != DBNull.Value && foundChecked[j][IndexSelectedSaleCurrency] != null && foundChecked[j][IndexSelectedSaleCurrency] != "")
                                                {
                                                    foundChecked[j][IndexCurrencyName] = Convert.ToDouble(foundChecked[j][indexSelectedCurrency]) * Convert.ToDouble(foundChecked[j][IndexSelectedSaleCurrency]);
                                                }
                                                else
                                                    foundChecked[j][IndexCurrencyName] = DBNull.Value;
                                            }
                                            else
                                            {
                                                Int32 IndexSelectedSaleCurrency = DtDetection.Columns.IndexOf("CurrencyConversionRate_" + currency.Name);
                                                Int32 IndexCurrencyName = DtDetection.Columns.IndexOf(currency.Name);
                                                CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(indexCurrencyConversionDateValue.Value.Date));
                                                if (CurConversion1 != null)
                                                {
                                                    if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                        foundChecked[j][IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                                    else
                                                        foundChecked[j][IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                                }

                                                else
                                                    foundChecked[j][IndexSelectedSaleCurrency] = DBNull.Value;
                                                if (foundChecked[j][IndexSelectedSaleCurrency] != DBNull.Value && foundChecked[j][IndexSelectedSaleCurrency] != null && foundChecked[j][IndexSelectedSaleCurrency] != "")
                                                {
                                                    foundChecked[j][IndexCurrencyName] = Convert.ToDouble(foundChecked[j][indexSelectedCurrency]) * Convert.ToDouble(foundChecked[j][IndexSelectedSaleCurrency]);
                                                }
                                                else
                                                    foundChecked[j][IndexCurrencyName] = DBNull.Value;
                                            }
                                        }
                                    }
                                    else if (Convert.ToInt32(record.IdRule) == 308)
                                    {
                                        foundChecked[j][indexSelectedCurrency] = record.RuleValue;
                                        foreach (Currency currency in SelectedSaleCurrency)
                                        {
                                            if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                Int32 IndexSelectedSaleCurrency = DtDetection.Columns.IndexOf("CurrencyConversionRate_" + "Common_Cur");
                                                Int32 IndexCurrencyName = DtDetection.Columns.IndexOf("Common_Cur");
                                                CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(indexCurrencyConversionDateValue.Value.Date));
                                                if (CurConversion1 != null)
                                                {
                                                    if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                        foundChecked[j][IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                                    else
                                                        foundChecked[j][IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                                }

                                                else
                                                    foundChecked[j][IndexSelectedSaleCurrency] = DBNull.Value;
                                                if (foundChecked[j][IndexSelectedSaleCurrency] != DBNull.Value && foundChecked[j][IndexSelectedSaleCurrency] != null && foundChecked[j][IndexSelectedSaleCurrency] != "")
                                                    foundChecked[j][IndexCurrencyName] = Convert.ToDouble(foundChecked[j][indexSelectedCurrency]) * Convert.ToDouble(foundChecked[j][IndexSelectedSaleCurrency]);
                                                else
                                                    foundChecked[j][IndexCurrencyName] = DBNull.Value;
                                            }
                                            else
                                            {
                                                Int32 IndexSelectedSaleCurrency = DtDetection.Columns.IndexOf("CurrencyConversionRate_" + currency.Name);
                                                Int32 IndexCurrencyName = DtDetection.Columns.IndexOf(currency.Name);
                                                CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(indexCurrencyConversionDateValue.Value.Date));
                                                if (CurConversion1 != null)
                                                {
                                                    if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                        foundChecked[j][IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                                    else
                                                        foundChecked[j][IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                                }

                                                else
                                                    foundChecked[j][IndexSelectedSaleCurrency] = DBNull.Value;
                                                if (foundChecked[j][IndexSelectedSaleCurrency] != DBNull.Value && foundChecked[j][IndexSelectedSaleCurrency] != null && foundChecked[j][IndexSelectedSaleCurrency] != "")
                                                    foundChecked[j][IndexCurrencyName] = Convert.ToDouble(foundChecked[j][indexSelectedCurrency]) * Convert.ToDouble(foundChecked[j][IndexSelectedSaleCurrency]);
                                                else
                                                    foundChecked[j][IndexCurrencyName] = DBNull.Value;
                                            }
                                        }
                                    }
                                    else if (Convert.ToInt32(record.IdRule) == 1518)
                                    {
                                        foundChecked[j]["Value"] = 0;
                                        foundChecked[j][indexSelectedCurrency] = 0;
                                        foreach (Currency currency in SelectedSaleCurrency)
                                        {
                                            if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                Int32 IndexCurrencyName = DtDetection.Columns.IndexOf("Common_Cur");
                                                foundChecked[j][IndexCurrencyName] = 0;
                                            }
                                            else
                                            {
                                                Int32 IndexCurrencyName = DtDetection.Columns.IndexOf(currency.Name);
                                                foundChecked[j][IndexCurrencyName] = 0;
                                            }
                                        }
                                    }
                                    else if (Convert.ToInt32(record.IdRule) == 309)
                                    {
                                        foundChecked[j][indexSelectedCurrency] = Convert.ToDouble(record.MaxCost) + (Convert.ToDouble(record.RuleValue));

                                        foreach (Currency currency in SelectedSaleCurrency)
                                        {
                                            if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                Int32 IndexSelectedSaleCurrency = DtDetection.Columns.IndexOf("CurrencyConversionRate_" + "Common_Cur");
                                                Int32 IndexCurrencyName = DtDetection.Columns.IndexOf("Common_Cur");
                                                CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(indexCurrencyConversionDateValue.Value.Date));
                                                if (CurConversion1 != null)
                                                {
                                                    if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                        foundChecked[j][IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                                    else
                                                        foundChecked[j][IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                                }

                                                else
                                                    foundChecked[j][IndexSelectedSaleCurrency] = DBNull.Value;
                                                if (foundChecked[j][IndexSelectedSaleCurrency] != DBNull.Value && foundChecked[j][IndexSelectedSaleCurrency] != null && foundChecked[j][IndexSelectedSaleCurrency] != "")
                                                    foundChecked[j][IndexCurrencyName] = Convert.ToDouble(foundChecked[j][indexSelectedCurrency]) * Convert.ToDouble(foundChecked[j][IndexSelectedSaleCurrency]);
                                                else
                                                    foundChecked[j][IndexCurrencyName] = DBNull.Value;
                                            }
                                            else
                                            {
                                                Int32 IndexSelectedSaleCurrency = DtDetection.Columns.IndexOf("CurrencyConversionRate_" + currency.Name);
                                                Int32 IndexCurrencyName = DtDetection.Columns.IndexOf(currency.Name);
                                                CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(indexCurrencyConversionDateValue.Value.Date));
                                                if (CurConversion1 != null)
                                                {
                                                    if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                        foundChecked[j][IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                                    else
                                                        foundChecked[j][IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                                }

                                                else
                                                    foundChecked[j][IndexSelectedSaleCurrency] = DBNull.Value;
                                                if (foundChecked[j][IndexSelectedSaleCurrency] != DBNull.Value && foundChecked[j][IndexSelectedSaleCurrency] != null && foundChecked[j][IndexSelectedSaleCurrency] != "")
                                                    foundChecked[j][IndexCurrencyName] = Convert.ToDouble(foundChecked[j][indexSelectedCurrency]) * Convert.ToDouble(foundChecked[j][IndexSelectedSaleCurrency]);
                                                else
                                                    foundChecked[j][IndexCurrencyName] = DBNull.Value;
                                            }
                                        }
                                    }

                                    foundChecked[j]["Value"] = DBNull.Value;
                                    //delete detections
                                    if (DeleteDetections == null)
                                        DeleteDetections = new List<Detections>();

                                    Detections det = new Detections();
                                    det.IdDetections = (uint)foundChecked[j]["IdDetection"];
                                    DeleteDetections.Add(det);
                                }

                                if (foundChecked[j]["Common_Cur"] != DBNull.Value)
                                    SellPriceValue = Convert.ToDouble(foundChecked[j]["Common_Cur"]);
                                else
                                    SellPriceValue = 0.00;

                                if (foundChecked[j]["MaxCost_1"] != DBNull.Value)
                                    MaxCost = Convert.ToDouble(foundChecked[j]["MaxCost_1"]);
                                else
                                    MaxCost = 0.00;

                                foundChecked[j]["Profit"] = CalculateCustomerPriceProfitValue(MaxCost, SellPriceValue);
                                foundChecked[j]["CostMargin"] = CalculateCustomerPriceCostMarginValue(MaxCost, SellPriceValue);
                            }
                        }
                    }
                    else
                    {
                        DataRow Row = ((System.Data.DataRowView)((DevExpress.Xpf.Grid.RowEventArgs)obj).Row).Row;

                        if (Row["Value"] == DBNull.Value)
                        {
                            Row["Value"] = 0;
                        }
                        if (((DevExpress.Xpf.Grid.CellValueEventArgs)obj).Column.FieldName == "Logic")
                        {
                            if (Row["Logic"] == DBNull.Value || Convert.ToInt32(Row["Logic"]) == 0)
                            {
                                Row["Logic"] = 0;
                                Row["Value"] = DBNull.Value;
                            }
                        }
                        else
                        {
                            if (Row["Logic"] == DBNull.Value || Convert.ToInt32(Row["Logic"]) == 0)
                            {
                                Row["Logic"] = 308;
                            }
                        }

                        Row["IsColor"] = true;
                        Row["IsUpdatedRow"] = true;

                        if (Row["MaxCost_1"] == DBNull.Value)
                            Row["MaxCost_1"] = 0;

                        if (Row["Logic"] != DBNull.Value && Convert.ToInt32(Row["Logic"]) != 0)
                        {
                            Row["IsSalePriceValueColor"] = true;
                            Row["Enable_Delete"] = false;
                            Row["Enable_DescriptionLinked"] = false;
                            Row["Enable_VisibleCustomer"] = false;
                            if (Convert.ToInt32(Row["Logic"]) == 307)
                            {
                                if (Row["MaxCost_1"] == DBNull.Value)
                                {
                                    Row["MaxCost_1"] = 0;
                                }
                                Row["Common_Cur"] = Convert.ToDouble(Row["MaxCost_1"]) + ((Convert.ToDouble(Row["MaxCost_1"]) * (Convert.ToDouble(Row["Value"]) / 100)));
                                foreach (Currency cur in SelectedSaleCurrency)
                                {
                                    if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                    {
                                        if (Row["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && Row["CurrencyConversionRate_" + "Common_Cur"] != null && Row["CurrencyConversionRate_" + "Common_Cur"] != "")
                                        {
                                            Row["Common_Cur"] = Convert.ToDouble(Row["Common_Cur"]) * Convert.ToDouble(Row["CurrencyConversionRate_" + "Common_Cur"]);
                                        }
                                        else
                                            Row["Common_Cur"] = DBNull.Value;
                                    }
                                    else
                                    {
                                        if (Row["CurrencyConversionRate_" + cur.Name] != DBNull.Value && Row["CurrencyConversionRate_" + cur.Name] != null && Row["CurrencyConversionRate_" + cur.Name] != "")
                                        {
                                            Row[cur.Name] = Convert.ToDouble(Row["Common_Cur"]) * Convert.ToDouble(Row["CurrencyConversionRate_" + cur.Name]);
                                        }
                                        else
                                            Row[cur.Name] = DBNull.Value;
                                    }
                                }
                            }
                            else if (Convert.ToInt32(Row["Logic"]) == 308)
                            {
                                if (Row["Value"] == null || Convert.ToDouble(Row["Value"]) <= 0)
                                {
                                    Row["Value"] = DBNull.Value;
                                    Row["Common_Cur"] = DBNull.Value;
                                    foreach (Currency cur in SelectedSaleCurrency)
                                    {
                                        if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            Row["Common_Cur"] = DBNull.Value;
                                        }
                                        else
                                        {
                                            Row[cur.Name] = DBNull.Value;
                                        }
                                    }
                                }
                                else
                                {
                                    if (Row["MaxCost_1"] == DBNull.Value)
                                    {
                                        Row["MaxCost_1"] = 0;
                                    }

                                    Row["Common_Cur"] = Row["Value"];
                                    foreach (Currency cur in SelectedSaleCurrency)
                                    {
                                        if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            if (Row["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && Row["CurrencyConversionRate_" + "Common_Cur"] != null && Row["CurrencyConversionRate_" + "Common_Cur"] != "")
                                            {
                                                Row["Common_Cur"] = Convert.ToDouble(Row["Common_Cur"]) * Convert.ToDouble(Row["CurrencyConversionRate_" + "Common_Cur"]);
                                            }
                                            else
                                                Row["Common_Cur"] = DBNull.Value;
                                        }
                                        else
                                        {
                                            if (Row["CurrencyConversionRate_" + cur.Name] != DBNull.Value && Row["CurrencyConversionRate_" + cur.Name] != null && Row["CurrencyConversionRate_" + cur.Name] != "")
                                            {
                                                Row[cur.Name] = Convert.ToDouble(Row["Common_Cur"]) * Convert.ToDouble(Row["CurrencyConversionRate_" + cur.Name]);
                                            }
                                            else
                                                Row[cur.Name] = DBNull.Value;
                                        }
                                    }
                                }
                            }
                            else if (Convert.ToInt32(Row["Logic"]) == 1518)
                            {
                                if (Row["Value"] == null || Row["Value"] == DBNull.Value)
                                {
                                    Row["Value"] = 0;

                                    Row["Common_Cur"] = 0;

                                    foreach (Currency cur in SelectedSaleCurrency)
                                    {
                                        if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            Row["Common_Cur"] = 0;
                                        }
                                        else
                                        {
                                            Row[cur.Name] = 0;
                                        }
                                    }
                                }
                                else if (Row["Value"] != null)
                                {
                                    Row["Value"] = 0;

                                    Row["Common_Cur"] = 0;

                                    foreach (Currency cur in SelectedSaleCurrency)
                                    {
                                        if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            Row["Common_Cur"] = 0;
                                        }
                                        else
                                        {
                                            Row[cur.Name] = 0;
                                        }
                                    }
                                }
                            }
                            else if (Convert.ToInt32(Row["Logic"]) == 309)
                            {
                                if (Row["MaxCost_1"] == DBNull.Value)
                                {
                                    Row["MaxCost_1"] = 0;
                                }
                                Row["Common_Cur"] = Convert.ToDouble(Row["MaxCost_1"]) + (Convert.ToDouble(Row["Value"]));
                                foreach (Currency cur in SelectedSaleCurrency)
                                {
                                    if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                    {
                                        if (Row["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && Row["CurrencyConversionRate_" + "Common_Cur"] != null && Row["CurrencyConversionRate_" + "Common_Cur"] != "")
                                        {
                                            Row["Common_Cur"] = Convert.ToDouble(Row["Common_Cur"]) * Convert.ToDouble(Row["CurrencyConversionRate_" + "Common_Cur"]);
                                        }
                                        else
                                            Row["Common_Cur"] = DBNull.Value;
                                    }
                                    else
                                    {
                                        if (Row["CurrencyConversionRate_" + cur.Name] != DBNull.Value && Row["CurrencyConversionRate_" + cur.Name] != null && Row["CurrencyConversionRate_" + cur.Name] != "")
                                        {
                                            Row[cur.Name] = Convert.ToDouble(Row["Common_Cur"]) * Convert.ToDouble(Row["CurrencyConversionRate_" + cur.Name]);
                                        }
                                        else
                                            Row[cur.Name] = DBNull.Value;
                                    }
                                }
                            }

                        }
                        else
                        {
                            //set from bpl
                            Row["IsSalePriceValueColor"] = false;
                            Row["Enable_Delete"] = true;
                            Row["Enable_DescriptionLinked"] = true;
                            Row["Enable_VisibleCustomer"] = true;
                            CustomerPriceListByItem record = DetectionList.FirstOrDefault(a => a.IdDetection == Convert.ToUInt64(Row["IdDetection"]));
                            int indexSelectedCurrency = DtDetection.Columns.IndexOf("Common_Cur");
                            int indexCurrencyConversionDate = DtDetection.Columns.IndexOf("CurrencyConversionDate");
                            DateTime? indexCurrencyConversionDateValue = null;
                            //if (record.CurrencyConversionDate_New != null)
                            //{
                            //    indexCurrencyConversionDateValue = Convert.ToDateTime(record.CurrencyConversionDate_New);
                            //    Row["CurrencyConversionDate"] = indexCurrencyConversionDateValue;
                            //}

                            indexCurrencyConversionDateValue = CurrencyConversionList.FirstOrDefault().LastUpdate;
                            Row["CurrencyConversionDate"] = indexCurrencyConversionDateValue;


                            if (Convert.ToInt32(record.IdRule) == 307)
                            {
                                Row[indexSelectedCurrency] = Convert.ToDouble(record.MaxCost) + ((Convert.ToDouble(record.MaxCost) * (Convert.ToDouble(record.RuleValue) / 100)));

                                foreach (Currency currency in SelectedSaleCurrency)
                                {
                                    if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                    {
                                        Int32 IndexSelectedSaleCurrency = DtDetection.Columns.IndexOf("CurrencyConversionRate_" + "Common_Cur");
                                        Int32 IndexCurrencyName = DtDetection.Columns.IndexOf("Common_Cur");
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(indexCurrencyConversionDateValue.Value.Date));
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                Row[IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                            else
                                                Row[IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                        }

                                        else
                                            Row[IndexSelectedSaleCurrency] = DBNull.Value;
                                        if (Row[IndexSelectedSaleCurrency] != DBNull.Value && Row[IndexSelectedSaleCurrency] != null && Row[IndexSelectedSaleCurrency] != "")
                                        {
                                            Row[IndexCurrencyName] = Convert.ToDouble(Row[indexSelectedCurrency]) * Convert.ToDouble(Row[IndexSelectedSaleCurrency]);
                                        }
                                        else
                                            Row[IndexCurrencyName] = DBNull.Value;
                                    }
                                    else
                                    {
                                        Int32 IndexSelectedSaleCurrency = DtDetection.Columns.IndexOf("CurrencyConversionRate_" + currency.Name);
                                        Int32 IndexCurrencyName = DtDetection.Columns.IndexOf(currency.Name);
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(indexCurrencyConversionDateValue.Value.Date));
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                Row[IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                            else
                                                Row[IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                        }

                                        else
                                            Row[IndexSelectedSaleCurrency] = DBNull.Value;
                                        if (Row[IndexSelectedSaleCurrency] != DBNull.Value && Row[IndexSelectedSaleCurrency] != null && Row[IndexSelectedSaleCurrency] != "")
                                        {
                                            Row[IndexCurrencyName] = Convert.ToDouble(Row[indexSelectedCurrency]) * Convert.ToDouble(Row[IndexSelectedSaleCurrency]);
                                        }
                                        else
                                            Row[IndexCurrencyName] = DBNull.Value;
                                    }
                                }
                            }
                            else if (Convert.ToInt32(record.IdRule) == 308)
                            {
                                Row[indexSelectedCurrency] = record.RuleValue;
                                foreach (Currency currency in SelectedSaleCurrency)
                                {
                                    if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                    {
                                        Int32 IndexSelectedSaleCurrency = DtDetection.Columns.IndexOf("CurrencyConversionRate_" + "Common_Cur");
                                        Int32 IndexCurrencyName = DtDetection.Columns.IndexOf("Common_Cur");
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(indexCurrencyConversionDateValue.Value.Date));
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                Row[IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                            else
                                                Row[IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                        }

                                        else
                                            Row[IndexSelectedSaleCurrency] = DBNull.Value;
                                        if (Row[IndexSelectedSaleCurrency] != DBNull.Value && Row[IndexSelectedSaleCurrency] != null && Row[IndexSelectedSaleCurrency] != "")
                                            Row[IndexCurrencyName] = Convert.ToDouble(Row[indexSelectedCurrency]) * Convert.ToDouble(Row[IndexSelectedSaleCurrency]);
                                        else
                                            Row[IndexCurrencyName] = DBNull.Value;
                                    }
                                    else
                                    {
                                        Int32 IndexSelectedSaleCurrency = DtDetection.Columns.IndexOf("CurrencyConversionRate_" + currency.Name);
                                        Int32 IndexCurrencyName = DtDetection.Columns.IndexOf(currency.Name);
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(indexCurrencyConversionDateValue.Value.Date));
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                Row[IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                            else
                                                Row[IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                        }

                                        else
                                            Row[IndexSelectedSaleCurrency] = DBNull.Value;
                                        if (Row[IndexSelectedSaleCurrency] != DBNull.Value && Row[IndexSelectedSaleCurrency] != null && Row[IndexSelectedSaleCurrency] != "")
                                            Row[IndexCurrencyName] = Convert.ToDouble(Row[indexSelectedCurrency]) * Convert.ToDouble(Row[IndexSelectedSaleCurrency]);
                                        else
                                            Row[IndexCurrencyName] = DBNull.Value;
                                    }
                                }
                            }
                            else if (Convert.ToInt32(record.IdRule) == 1518)
                            {
                                if (Row["Value"] == null || Row["Value"] == DBNull.Value)
                                {
                                    Row["Value"] = 0;

                                    Row["Common_Cur"] = 0;

                                    foreach (Currency cur in SelectedSaleCurrency)
                                    {
                                        if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            Row["Common_Cur"] = 0;
                                        }
                                        else
                                        {
                                            Row[cur.Name] = 0;
                                        }
                                    }
                                }
                                else if (Row["Value"] != null)
                                {
                                    Row["Value"] = 0;

                                    Row["Common_Cur"] = 0;

                                    foreach (Currency cur in SelectedSaleCurrency)
                                    {
                                        if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            Row["Common_Cur"] = 0;
                                        }
                                        else
                                        {
                                            Row[cur.Name] = 0;
                                        }
                                    }
                                }
                            }
                            else if (Convert.ToInt32(record.IdRule) == 309)
                            {
                                Row[indexSelectedCurrency] = Convert.ToDouble(record.MaxCost) + (Convert.ToDouble(record.RuleValue));

                                foreach (Currency currency in SelectedSaleCurrency)
                                {
                                    if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                    {
                                        Int32 IndexSelectedSaleCurrency = DtDetection.Columns.IndexOf("CurrencyConversionRate_" + "Common_Cur");
                                        Int32 IndexCurrencyName = DtDetection.Columns.IndexOf("Common_Cur");
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(indexCurrencyConversionDateValue.Value.Date));
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                Row[IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                            else
                                                Row[IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                        }

                                        else
                                            Row[IndexSelectedSaleCurrency] = DBNull.Value;
                                        if (Row[IndexSelectedSaleCurrency] != DBNull.Value && Row[IndexSelectedSaleCurrency] != null && Row[IndexSelectedSaleCurrency] != "")
                                            Row[IndexCurrencyName] = Convert.ToDouble(Row[indexSelectedCurrency]) * Convert.ToDouble(Row[IndexSelectedSaleCurrency]);
                                        else
                                            Row[IndexCurrencyName] = DBNull.Value;
                                    }
                                    else
                                    {
                                        Int32 IndexSelectedSaleCurrency = DtDetection.Columns.IndexOf("CurrencyConversionRate_" + currency.Name);
                                        Int32 IndexCurrencyName = DtDetection.Columns.IndexOf(currency.Name);
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(indexCurrencyConversionDateValue.Value.Date));
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                Row[IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                            else
                                                Row[IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                        }

                                        else
                                            Row[IndexSelectedSaleCurrency] = DBNull.Value;
                                        if (Row[IndexSelectedSaleCurrency] != DBNull.Value && Row[IndexSelectedSaleCurrency] != null && Row[IndexSelectedSaleCurrency] != "")
                                            Row[IndexCurrencyName] = Convert.ToDouble(Row[indexSelectedCurrency]) * Convert.ToDouble(Row[IndexSelectedSaleCurrency]);
                                        else
                                            Row[IndexCurrencyName] = DBNull.Value;
                                    }
                                }
                            }

                            Row["Value"] = DBNull.Value;
                            //delete detections
                            if (DeleteDetections == null)
                                DeleteDetections = new List<Detections>();

                            Detections det = new Detections();
                            det.IdDetections = (uint)Row["IdDetection"];
                            DeleteDetections.Add(det);
                        }

                        if (Row["Common_Cur"] != DBNull.Value)
                            SellPriceValue = Convert.ToDouble(Row["Common_Cur"]);
                        else
                            SellPriceValue = 0;

                        if (Row["MaxCost_1"] != DBNull.Value)
                            MaxCost = Convert.ToDouble(Row["MaxCost_1"]);
                        else
                            MaxCost = 0;

                        Row["Profit"] = CalculateCustomerPriceProfitValue(MaxCost, SellPriceValue);
                        Row["CostMargin"] = CalculateCustomerPriceCostMarginValue(MaxCost, SellPriceValue);
                    }
                    DtDetection.AcceptChanges();
                    IsEnabledSaveButton = true;
                }
                GeosApplication.Instance.Logger.Log("Method RuleValueChangedCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method RuleValueChangedCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
		//[nsatpute][28.05.2025][GEOS2-6689]
        private void FillLogicList()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillLogicList ...", category: Category.Info, priority: Priority.Low);
                IPCMService PCMServiceLocalThread = new PCMServiceController(GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString());
                IList<LookupValue> tempLogicList = PCMServiceLocalThread.GetLookupValues(63);
                LogicList = new List<LookupValue>();
                LogicList = new List<LookupValue>(tempLogicList);
                LogicList.Insert(0, new LookupValue() { Value = string.Empty, InUse = true });

                SelectedLogic = LogicList.FirstOrDefault();
                SelectedStatusIndex = LogicList.FindIndex(x => x.IdLookupValue == 308);
                GeosApplication.Instance.Logger.Log("Method FillLogicList() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in FillLogicList() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), "Red", CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in FillLogicList() Method - ServiceUnexceptedException " + ex.Message, category: Category.Info, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillLogicList() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }


        private void ArticleDetectionNameValueChangedCommandAction(object obj)
        {
            if (obj == null) return;
            var currentName = obj as string;
            if (isArticleGrid)
            {
                if (oldArticleNameGrid != null && !oldArticleNameGrid.Equals(currentName))
                {
                    IsEnabledSaveButton = true;
                    oldArticleNameGrid = currentName;
                }
            }
            else
            {
                if (oldDetectionNameGrid != null && !oldDetectionNameGrid.Equals(currentName))
                {
                    IsEnabledSaveButton = true;
                    oldDetectionNameGrid = currentName;
                }
            }
        }


        private void RuleValueChangedCommandAction(object obj)
        {
            try
            {
                double MaxCost = 0.00;
                double SellPriceValue = 0.00;

                if (((DevExpress.Xpf.Grid.CellValueEventArgs)obj).Column.FieldName == "Value" || ((DevExpress.Xpf.Grid.CellValueEventArgs)obj).Column.FieldName == "Logic")
                {
                    IsCalculateArticleCostButtonEnabled = true;
                    IsCalculated = false;
                    DataColumn[] columns = DtArticleCopy.Columns.Cast<DataColumn>().ToArray();
                    DataRow[] foundChecked = DtArticleCopy.AsEnumerable().Where(row => columns.Any(col => row["IsChecked"].ToString() == "True")).ToArray();
                    DataRow MainRow = ((System.Data.DataRowView)((DevExpress.Xpf.Grid.RowEventArgs)obj).Row).Row;
                    MainRow["Enable_Delete"] = false;
                    MainRow["Enable_DescriptionLinked"] = false;
                    MainRow["Enable_VisibleCustomer"] = false;

                    if (foundChecked.Length > 0 && MainRow["IsChecked"].ToString() != "False")
                    {
                        for (int j = 0; j < foundChecked.Length; j++)
                        {
                            foundChecked[j].BeginEdit();
                            if (((DevExpress.Xpf.Grid.CellValueEventArgs)obj).Column.FieldName == "Value")
                            {
                                if (MainRow["Value"] == DBNull.Value)
                                {
                                    MainRow["Value"] = 0;
                                }
                                foundChecked[j]["Value"] = MainRow["Value"];
                            }
                            else
                            {
                                if (foundChecked[j]["Value"] == DBNull.Value)
                                {
                                    foundChecked[j]["Value"] = 0;
                                }
                            }

                            if (((DevExpress.Xpf.Grid.CellValueEventArgs)obj).Column.FieldName == "Logic")
                            {
                                if (MainRow["Logic"] == DBNull.Value || Convert.ToInt32(MainRow["Logic"]) == 0)
                                {
                                    MainRow["Logic"] = 0;
                                    MainRow["Value"] = DBNull.Value;
                                }
                                foundChecked[j]["Logic"] = MainRow["Logic"];
                                foundChecked[j]["Value"] = MainRow["Value"];
                            }
                            else
                            {
                                if (foundChecked[j]["Logic"] == DBNull.Value || Convert.ToInt32(foundChecked[j]["Logic"]) == 0)
                                {
                                    foundChecked[j]["Logic"] = 308;
                                }
                            }

                            if (MainRow["IsChecked"].ToString() != "False")
                            {
                                foundChecked[j]["IsColor"] = true;
                                foundChecked[j]["IsUpdatedRow"] = true;

                                if (foundChecked[j]["MaxCost_1"] == DBNull.Value)
                                    foundChecked[j]["MaxCost_1"] = 0;
                                if (foundChecked[j]["Logic"] != DBNull.Value && Convert.ToInt32(foundChecked[j]["Logic"]) != 0)
                                {
                                    foundChecked[j]["IsSalePriceValueColor"] = true;
                                    foundChecked[j]["Enable_Delete"] = false;
                                    foundChecked[j]["Enable_DescriptionLinked"] = false;
                                    foundChecked[j]["Enable_VisibleCustomer"] = false;
                                    if (Convert.ToInt32(foundChecked[j]["Logic"]) == 307)
                                    {
                                        if (foundChecked[j]["MaxCost_1"] == DBNull.Value)
                                        {
                                            foundChecked[j]["MaxCost_1"] = 0;
                                        }
                                        foundChecked[j]["Common_Cur"] = Convert.ToDouble(foundChecked[j]["MaxCost_1"]) + (Convert.ToDouble(foundChecked[j]["MaxCost_1"]) * (Convert.ToDouble(foundChecked[j]["Value"]) / 100));
                                        foreach (Currency cur in SelectedSaleCurrency)
                                        {
                                            if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                if (foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != null && foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != "")
                                                    foundChecked[j]["Common_Cur"] = Convert.ToDouble(foundChecked[j]["Common_Cur"]) * Convert.ToDouble(foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"]);
                                                else
                                                    foundChecked[j]["Common_Cur"] = DBNull.Value;
                                            }
                                            else
                                            {
                                                if (foundChecked[j]["CurrencyConversionRate_" + cur.Name] != DBNull.Value && foundChecked[j]["CurrencyConversionRate_" + cur.Name] != null && foundChecked[j]["CurrencyConversionRate_" + cur.Name] != "")
                                                    foundChecked[j][cur.Name] = Convert.ToDouble(foundChecked[j]["Common_Cur"]) * Convert.ToDouble(foundChecked[j]["CurrencyConversionRate_" + cur.Name]);
                                                else
                                                    foundChecked[j][cur.Name] = DBNull.Value;
                                            }
                                        }
                                    }
                                    else if (Convert.ToInt32(foundChecked[j]["Logic"]) == 308)
                                    {
                                        if (foundChecked[j]["Value"] == null || foundChecked[j]["Value"] == DBNull.Value || Convert.ToDouble(foundChecked[j]["Value"]) <= 0)
                                        {
                                            foundChecked[j]["Value"] = DBNull.Value;
                                            foundChecked[j]["Common_Cur"] = DBNull.Value;
                                            foreach (Currency cur in SelectedSaleCurrency)
                                            {
                                                if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                                {
                                                    foundChecked[j]["Common_Cur"] = DBNull.Value;
                                                }
                                                else
                                                {
                                                    foundChecked[j][cur.Name] = DBNull.Value;
                                                }
                                            }
                                        }
                                        else
                                        {
                                            if (foundChecked[j]["MaxCost_1"] == DBNull.Value)
                                            {
                                                foundChecked[j]["MaxCost_1"] = 0;
                                            }

                                            foundChecked[j]["Common_Cur"] = foundChecked[j]["Value"];
                                            foreach (Currency cur in SelectedSaleCurrency)
                                            {
                                                if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                                {
                                                    if (foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != null && foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != "")
                                                        foundChecked[j]["Common_Cur"] = Convert.ToDouble(foundChecked[j]["Common_Cur"]) * Convert.ToDouble(foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"]);
                                                    else
                                                        foundChecked[j]["Common_Cur"] = DBNull.Value;
                                                }
                                                else
                                                {
                                                    if (foundChecked[j]["CurrencyConversionRate_" + cur.Name] != DBNull.Value && foundChecked[j]["CurrencyConversionRate_" + cur.Name] != null && foundChecked[j]["CurrencyConversionRate_" + cur.Name] != "")
                                                        foundChecked[j][cur.Name] = Convert.ToDouble(foundChecked[j]["Common_Cur"]) * Convert.ToDouble(foundChecked[j]["CurrencyConversionRate_" + cur.Name]);
                                                    else
                                                        foundChecked[j][cur.Name] = DBNull.Value;
                                                }
                                            }
                                        }
                                    }
                                    else if (Convert.ToInt32(foundChecked[j]["Logic"]) == 1518)
                                    {
                                        if (foundChecked[j]["Value"] == null || foundChecked[j]["Value"] == DBNull.Value)
                                        {
                                            foundChecked[j]["Value"] = 0;

                                            foundChecked[j]["Common_Cur"] = 0;

                                            foreach (Currency cur in SelectedSaleCurrency)
                                            {
                                                if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                                {
                                                    foundChecked[j]["Common_Cur"] = 0;
                                                }
                                                else
                                                {
                                                    foundChecked[j][cur.Name] = 0;
                                                }
                                            }
                                        }
                                        else if (foundChecked[j]["Value"] != null)
                                        {
                                            foundChecked[j]["Value"] = 0;

                                            foundChecked[j]["Common_Cur"] = 0;

                                            foreach (Currency cur in SelectedSaleCurrency)
                                            {
                                                if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                                {
                                                    foundChecked[j]["Common_Cur"] = 0;
                                                }
                                                else
                                                {
                                                    foundChecked[j][cur.Name] = 0;
                                                }
                                            }
                                        }
                                    }
                                    else if (Convert.ToInt32(foundChecked[j]["Logic"]) == 309)
                                    {
                                        if (foundChecked[j]["MaxCost_1"] == DBNull.Value)
                                        {
                                            foundChecked[j]["MaxCost_1"] = 0;
                                        }
                                        foundChecked[j]["Common_Cur"] = Convert.ToDouble(foundChecked[j]["MaxCost_1"]) + (Convert.ToDouble(foundChecked[j]["Value"]));
                                        foreach (Currency cur in SelectedSaleCurrency)
                                        {
                                            if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                if (foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != null && foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != "")
                                                    foundChecked[j]["Common_Cur"] = Convert.ToDouble(foundChecked[j]["Common_Cur"]) * Convert.ToDouble(foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"]);
                                                else
                                                    foundChecked[j]["Common_Cur"] = DBNull.Value;
                                            }
                                            else
                                            {
                                                if (foundChecked[j]["CurrencyConversionRate_" + cur.Name] != DBNull.Value && foundChecked[j]["CurrencyConversionRate_" + cur.Name] != null && foundChecked[j]["CurrencyConversionRate_" + cur.Name] != "")
                                                    foundChecked[j][cur.Name] = Convert.ToDouble(foundChecked[j]["Common_Cur"]) * Convert.ToDouble(foundChecked[j]["CurrencyConversionRate_" + cur.Name]);
                                                else
                                                    foundChecked[j][cur.Name] = DBNull.Value;
                                            }
                                        }
                                    }
                                }
                                else
                                {
                                    //set from bpl
                                    foundChecked[j]["IsSalePriceValueColor"] = false;
                                    foundChecked[j]["Enable_Delete"] = true;
                                    foundChecked[j]["Enable_DescriptionLinked"] = true;
                                    foundChecked[j]["Enable_VisibleCustomer"] = true;

                                    CustomerPriceListByItem record = ArticleList.FirstOrDefault(a => a.IdArticle == Convert.ToUInt64(foundChecked[j]["IdArticle"]));
                                    int indexSelectedCurrency = DtArticle.Columns.IndexOf("Common_Cur");
                                    int indexCurrencyConversionDate = DtArticle.Columns.IndexOf("CurrencyConversionDate");
                                    DateTime? indexCurrencyConversionDateValue = null;
                                    //if (record.CurrencyConversionDate_New != null)
                                    //{
                                    //    indexCurrencyConversionDateValue = Convert.ToDateTime(record.CurrencyConversionDate_New);
                                    //    foundChecked[j]["CurrencyConversionDate"] = indexCurrencyConversionDateValue;
                                    //}

                                    indexCurrencyConversionDateValue = CurrencyConversionList.FirstOrDefault().LastUpdate;
                                    foundChecked[j]["CurrencyConversionDate"] = indexCurrencyConversionDateValue;

                                    if (Convert.ToInt32(record.IdRule) == 307)
                                    {
                                        foundChecked[j][indexSelectedCurrency] = Convert.ToDouble(foundChecked[j]["MaxCost_1"]) + ((Convert.ToDouble(foundChecked[j]["MaxCost_1"]) * (Convert.ToDouble(record.RuleValue) / 100)));

                                        foreach (Currency currency in SelectedSaleCurrency)
                                        {
                                            if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                Int32 IndexSelectedSaleCurrency = DtArticle.Columns.IndexOf("CurrencyConversionRate_" + "Common_Cur");
                                                Int32 IndexCurrencyName = DtArticle.Columns.IndexOf("Common_Cur");
                                                CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(indexCurrencyConversionDateValue.Value).Date);
                                                if (CurConversion1 != null)
                                                {
                                                    if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                        foundChecked[j][IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                                    else
                                                        foundChecked[j][IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                                }
                                                if (foundChecked[j][IndexSelectedSaleCurrency] != DBNull.Value && foundChecked[j][IndexSelectedSaleCurrency] != null && foundChecked[j][IndexSelectedSaleCurrency] != "")
                                                {
                                                    foundChecked[j][IndexCurrencyName] = Convert.ToDouble(foundChecked[j][indexSelectedCurrency]) * Convert.ToDouble(foundChecked[j][IndexSelectedSaleCurrency]);
                                                }
                                                else
                                                    foundChecked[j][IndexCurrencyName] = DBNull.Value;
                                            }
                                            else
                                            {
                                                Int32 IndexSelectedSaleCurrency = DtArticle.Columns.IndexOf("CurrencyConversionRate_" + currency.Name);
                                                Int32 IndexCurrencyName = DtArticle.Columns.IndexOf(currency.Name);
                                                CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(indexCurrencyConversionDateValue.Value).Date);
                                                if (CurConversion1 != null)
                                                {
                                                    if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                        foundChecked[j][IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                                    else
                                                        foundChecked[j][IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                                }
                                                if (foundChecked[j][IndexSelectedSaleCurrency] != DBNull.Value && foundChecked[j][IndexSelectedSaleCurrency] != null && foundChecked[j][IndexSelectedSaleCurrency] != "")
                                                {
                                                    foundChecked[j][IndexCurrencyName] = Convert.ToDouble(foundChecked[j][indexSelectedCurrency]) * Convert.ToDouble(foundChecked[j][IndexSelectedSaleCurrency]);
                                                }
                                                else
                                                    foundChecked[j][IndexCurrencyName] = DBNull.Value;
                                            }
                                        }
                                    }
                                    else if (Convert.ToInt32(record.IdRule) == 308)
                                    {
                                        foundChecked[j][indexSelectedCurrency] = record.RuleValue;
                                        foreach (Currency currency in SelectedSaleCurrency)
                                        {
                                            if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                Int32 IndexSelectedSaleCurrency = DtArticle.Columns.IndexOf("CurrencyConversionRate_" + "Common_Cur");
                                                Int32 IndexCurrencyName = DtArticle.Columns.IndexOf("Common_Cur");
                                                CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(indexCurrencyConversionDateValue.Value).Date);
                                                if (CurConversion1 != null)
                                                {
                                                    if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                        foundChecked[j][IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                                    else
                                                        foundChecked[j][IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                                }

                                                if (foundChecked[j][IndexSelectedSaleCurrency] != DBNull.Value && foundChecked[j][IndexSelectedSaleCurrency] != null && foundChecked[j][IndexSelectedSaleCurrency] != "")
                                                    foundChecked[j][IndexCurrencyName] = Convert.ToDouble(foundChecked[j][indexSelectedCurrency]) * Convert.ToDouble(foundChecked[j][IndexSelectedSaleCurrency]);
                                                else
                                                    foundChecked[j][IndexCurrencyName] = DBNull.Value;
                                            }
                                            else
                                            {
                                                Int32 IndexSelectedSaleCurrency = DtArticle.Columns.IndexOf("CurrencyConversionRate_" + currency.Name);
                                                Int32 IndexCurrencyName = DtArticle.Columns.IndexOf(currency.Name);
                                                CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(indexCurrencyConversionDateValue.Value).Date);
                                                if (CurConversion1 != null)
                                                {
                                                    if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                        foundChecked[j][IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                                    else
                                                        foundChecked[j][IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                                }

                                                if (foundChecked[j][IndexSelectedSaleCurrency] != DBNull.Value && foundChecked[j][IndexSelectedSaleCurrency] != null && foundChecked[j][IndexSelectedSaleCurrency] != "")
                                                    foundChecked[j][IndexCurrencyName] = Convert.ToDouble(foundChecked[j][indexSelectedCurrency]) * Convert.ToDouble(foundChecked[j][IndexSelectedSaleCurrency]);
                                                else
                                                    foundChecked[j][IndexCurrencyName] = DBNull.Value;
                                            }
                                        }
                                    }
                                    else if (Convert.ToInt32(record.IdRule) == 1518)
                                    {
                                        if (foundChecked[j]["Value"] == null || foundChecked[j]["Value"] == DBNull.Value)
                                        {
                                            foundChecked[j]["Value"] = 0;

                                            foundChecked[j]["Common_Cur"] = 0;

                                            foreach (Currency cur in SelectedSaleCurrency)
                                            {
                                                if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                                {
                                                    foundChecked[j]["Common_Cur"] = 0;
                                                }
                                                else
                                                {
                                                    foundChecked[j][cur.Name] = 0;
                                                }
                                            }
                                        }
                                        else if (foundChecked[j]["Value"] != null)
                                        {
                                            foundChecked[j]["Value"] = 0;

                                            foundChecked[j]["Common_Cur"] = 0;

                                            foreach (Currency cur in SelectedSaleCurrency)
                                            {
                                                if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                                {
                                                    foundChecked[j]["Common_Cur"] = 0;
                                                }
                                                else
                                                {
                                                    foundChecked[j][cur.Name] = 0;
                                                }
                                            }
                                        }
                                    }
                                    else if (Convert.ToInt32(record.IdRule) == 309)
                                    {
                                        foundChecked[j][indexSelectedCurrency] = Convert.ToDouble(foundChecked[j]["MaxCost_1"]) + (Convert.ToDouble(record.RuleValue));

                                        foreach (Currency currency in SelectedSaleCurrency)
                                        {
                                            if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                Int32 IndexSelectedSaleCurrency = DtArticle.Columns.IndexOf("CurrencyConversionRate_" + "Common_Cur");
                                                Int32 IndexCurrencyName = DtArticle.Columns.IndexOf("Common_Cur");

                                                CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(indexCurrencyConversionDateValue.Value).Date);
                                                if (CurConversion1 != null)
                                                {
                                                    if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                        foundChecked[j][IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                                    else
                                                        foundChecked[j][IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                                }
                                                if (foundChecked[j][IndexSelectedSaleCurrency] != DBNull.Value && foundChecked[j][IndexSelectedSaleCurrency] != null && foundChecked[j][IndexSelectedSaleCurrency] != "")
                                                    foundChecked[j][IndexCurrencyName] = Convert.ToDouble(foundChecked[j][indexSelectedCurrency]) * Convert.ToDouble(foundChecked[j][IndexSelectedSaleCurrency]);
                                                else
                                                    foundChecked[j][IndexCurrencyName] = DBNull.Value;
                                            }
                                            else
                                            {
                                                Int32 IndexSelectedSaleCurrency = DtArticle.Columns.IndexOf("CurrencyConversionRate_" + currency.Name);
                                                Int32 IndexCurrencyName = DtArticle.Columns.IndexOf(currency.Name);

                                                CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(indexCurrencyConversionDateValue.Value).Date);
                                                if (CurConversion1 != null)
                                                {
                                                    if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                        foundChecked[j][IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                                    else
                                                        foundChecked[j][IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                                }
                                                if (foundChecked[j][IndexSelectedSaleCurrency] != DBNull.Value && foundChecked[j][IndexSelectedSaleCurrency] != null && foundChecked[j][IndexSelectedSaleCurrency] != "")
                                                    foundChecked[j][IndexCurrencyName] = Convert.ToDouble(foundChecked[j][indexSelectedCurrency]) * Convert.ToDouble(foundChecked[j][IndexSelectedSaleCurrency]);
                                                else
                                                    foundChecked[j][IndexCurrencyName] = DBNull.Value;
                                            }
                                        }
                                    }
                                    foundChecked[j]["Value"] = DBNull.Value;
                                    //delete articles
                                    if (DeleteArticles == null)
                                        DeleteArticles = new List<Articles>();

                                    Articles art = new Articles();
                                    art.IdArticle = (uint)foundChecked[j]["IdArticle"];
                                    DeleteArticles.Add(art);

                                }
                                if (foundChecked[j]["Common_Cur"] != DBNull.Value)
                                    SellPriceValue = Convert.ToDouble(foundChecked[j]["Common_Cur"]);
                                else
                                    SellPriceValue = 0;

                                if (foundChecked[j]["MaxCost_1"] != DBNull.Value)
                                    MaxCost = Convert.ToDouble(foundChecked[j]["MaxCost_1"]);
                                else
                                    MaxCost = 0;

                                foundChecked[j]["Profit"] = Convert.ToDouble(CalculateCustomerPriceArticlesProfitValue(MaxCost, SellPriceValue));
                                foundChecked[j]["CostMargin"] = Convert.ToDouble(CalculateCustomerPriceArticlesCostMarginValue(MaxCost, SellPriceValue));
                            }
                        }
                    }
                    else
                    {
                        DataRow Row = ((System.Data.DataRowView)((DevExpress.Xpf.Grid.RowEventArgs)obj).Row).Row;

                        Row["IsColor"] = true;
                        Row["IsUpdatedRow"] = true;

                        if (Row["Value"] == DBNull.Value)
                        {
                            Row["Value"] = 0;
                        }
                        if (((DevExpress.Xpf.Grid.CellValueEventArgs)obj).Column.FieldName == "Logic")
                        {
                            if (Row["Logic"] == DBNull.Value || Convert.ToInt32(Row["Logic"]) == 0)
                            {
                                Row["Logic"] = 0;
                                Row["Value"] = DBNull.Value;
                            }
                        }
                        else
                        {
                            if (Row["Logic"] == DBNull.Value || Convert.ToInt32(Row["Logic"]) == 0)
                            {
                                Row["Logic"] = 308;
                            }
                        }

                        if (Row["MaxCost_1"] == DBNull.Value)
                            Row["MaxCost_1"] = 0;
                        if (Row["Logic"] != DBNull.Value && Convert.ToInt32(Row["Logic"]) != 0)
                        {
                            Row["IsSalePriceValueColor"] = true;
                            Row["Enable_Delete"] = false;
                            Row["Enable_DescriptionLinked"] = false;
                            Row["Enable_VisibleCustomer"] = false;
                            if (Convert.ToInt32(Row["Logic"]) == 307)
                            {
                                if (Row["MaxCost_1"] == DBNull.Value)
                                {
                                    Row["MaxCost_1"] = 0;
                                }
                                Row["Common_Cur"] = Convert.ToDouble(Row["MaxCost_1"]) + ((Convert.ToDouble(Row["MaxCost_1"]) * (Convert.ToDouble(Row["Value"]) / 100)));
                                foreach (Currency cur in SelectedSaleCurrency)
                                {
                                    if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                    {
                                        if (Row["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && Row["CurrencyConversionRate_" + "Common_Cur"] != null && Row["CurrencyConversionRate_" + "Common_Cur"] != "")
                                            Row["Common_Cur"] = Convert.ToDouble(Row["Common_Cur"]) * Convert.ToDouble(Row["CurrencyConversionRate_" + "Common_Cur"]);
                                        else
                                            Row["Common_Cur"] = DBNull.Value;
                                    }
                                    else
                                    {
                                        if (Row["CurrencyConversionRate_" + cur.Name] != DBNull.Value && Row["CurrencyConversionRate_" + cur.Name] != null && Row["CurrencyConversionRate_" + cur.Name] != "")
                                            Row[cur.Name] = Convert.ToDouble(Row["Common_Cur"]) * Convert.ToDouble(Row["CurrencyConversionRate_" + cur.Name]);
                                        else
                                            Row[cur.Name] = DBNull.Value;
                                    }
                                }
                            }
                            else if (Convert.ToInt32(Row["Logic"]) == 308)
                            {
                                if (Row["Value"] == null || Row["Value"] == DBNull.Value || Convert.ToDouble(Row["Value"]) <= 0)
                                {
                                    Row["Value"] = DBNull.Value;
                                    Row["Common_Cur"] = Row["Value"];
                                    foreach (Currency cur in SelectedSaleCurrency)
                                    {
                                        if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            Row["Common_Cur"] = DBNull.Value;
                                        }
                                        else
                                        {
                                            Row[cur.Name] = DBNull.Value;
                                        }
                                    }
                                }
                                else
                                {
                                    if (Row["MaxCost_1"] == DBNull.Value)
                                    {
                                        Row["MaxCost_1"] = 0;
                                    }

                                    Row["Common_Cur"] = Row["Value"];
                                    foreach (Currency cur in SelectedSaleCurrency)
                                    {
                                        if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            if (Row["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && Row["CurrencyConversionRate_" + "Common_Cur"] != null && Row["CurrencyConversionRate_" + "Common_Cur"] != "")
                                                Row["Common_Cur"] = Convert.ToDouble(Row["Common_Cur"]) * Convert.ToDouble(Row["CurrencyConversionRate_" + "Common_Cur"]);
                                            else
                                                Row["Common_Cur"] = DBNull.Value;
                                        }
                                        else
                                        {
                                            if (Row["CurrencyConversionRate_" + cur.Name] != DBNull.Value && Row["CurrencyConversionRate_" + cur.Name] != null && Row["CurrencyConversionRate_" + cur.Name] != "")
                                                Row[cur.Name] = Convert.ToDouble(Row["Common_Cur"]) * Convert.ToDouble(Row["CurrencyConversionRate_" + cur.Name]);
                                            else
                                                Row[cur.Name] = DBNull.Value;
                                        }
                                    }
                                }
                            }
                            else if (Convert.ToInt32(Row["Logic"]) == 1518)
                            {
                                if (Row["Value"] == null || Row["Value"] == DBNull.Value)
                                {
                                    Row["Value"] = 0;

                                    Row["Common_Cur"] = 0;

                                    foreach (Currency cur in SelectedSaleCurrency)
                                    {
                                        if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            Row["Common_Cur"] = 0;
                                        }
                                        else
                                        {
                                            Row[cur.Name] = 0;
                                        }
                                    }
                                }
                                else if (Row["Value"] != null)
                                {
                                    Row["Value"] = 0;

                                    Row["Common_Cur"] = 0;

                                    foreach (Currency cur in SelectedSaleCurrency)
                                    {
                                        if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            Row["Common_Cur"] = 0;
                                        }
                                        else
                                        {
                                            Row[cur.Name] = 0;
                                        }
                                    }
                                }
                            }
                            else if (Convert.ToInt32(Row["Logic"]) == 309)
                            {
                                if (Row["MaxCost_1"] == DBNull.Value)
                                {
                                    Row["MaxCost_1"] = 0;
                                }
                                Row["Common_Cur"] = Convert.ToDouble(Row["MaxCost_1"]) + (Convert.ToDouble(Row["Value"]));
                                foreach (Currency cur in SelectedSaleCurrency)
                                {
                                    if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                    {
                                        if (Row["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && Row["CurrencyConversionRate_" + "Common_Cur"] != null && Row["CurrencyConversionRate_" + "Common_Cur"] != "")
                                            Row["Common_Cur"] = Convert.ToDouble(Row["Common_Cur"]) * Convert.ToDouble(Row["CurrencyConversionRate_" + "Common_Cur"]);
                                        else
                                            Row["Common_Cur"] = DBNull.Value;
                                    }
                                    else
                                    {
                                        if (Row["CurrencyConversionRate_" + cur.Name] != DBNull.Value && Row["CurrencyConversionRate_" + cur.Name] != null && Row["CurrencyConversionRate_" + cur.Name] != "")
                                            Row[cur.Name] = Convert.ToDouble(Row["Common_Cur"]) * Convert.ToDouble(Row["CurrencyConversionRate_" + cur.Name]);
                                        else
                                            Row[cur.Name] = DBNull.Value;
                                    }
                                }
                            }
                        }
                        else
                        {
                            //set from bpl
                            Row["IsSalePriceValueColor"] = false;
                            Row["Enable_Delete"] = true;
                            Row["Enable_DescriptionLinked"] = true;
                            Row["Enable_VisibleCustomer"] = true;
                            CustomerPriceListByItem record = ArticleList.FirstOrDefault(a => a.IdArticle == Convert.ToUInt64(Row["IdArticle"]));
                            int indexSelectedCurrency = DtArticle.Columns.IndexOf("Common_Cur");
                            int indexCurrencyConversionDate = DtArticle.Columns.IndexOf("CurrencyConversionDate");
                            DateTime? indexCurrencyConversionDateValue = null;
                            //if (record.CurrencyConversionDate_New != null)
                            //{
                            //    indexCurrencyConversionDateValue = Convert.ToDateTime(record.CurrencyConversionDate_New);
                            //    Row["CurrencyConversionDate"] = indexCurrencyConversionDateValue;
                            //}

                            indexCurrencyConversionDateValue = CurrencyConversionList.FirstOrDefault().LastUpdate;
                            Row["CurrencyConversionDate"] = indexCurrencyConversionDateValue;

                            if (Convert.ToInt32(record.IdRule) == 307)
                            {
                                Row[indexSelectedCurrency] = Convert.ToDouble(Row["MaxCost_1"]) + ((Convert.ToDouble(Row["MaxCost_1"]) * (Convert.ToDouble(record.RuleValue) / 100)));

                                foreach (Currency currency in SelectedSaleCurrency)
                                {
                                    if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                    {
                                        Int32 IndexSelectedSaleCurrency = DtArticle.Columns.IndexOf("CurrencyConversionRate_" + "Common_Cur");
                                        Int32 IndexCurrencyName = DtArticle.Columns.IndexOf("Common_Cur");

                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(indexCurrencyConversionDateValue.Value).Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                Row[IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                            else
                                                Row[IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                        }

                                        if (Row[IndexSelectedSaleCurrency] != DBNull.Value && Row[IndexSelectedSaleCurrency] != null && Row[IndexSelectedSaleCurrency] != "")
                                        {
                                            Row[IndexCurrencyName] = Convert.ToDouble(Row[indexSelectedCurrency]) * Convert.ToDouble(Row[IndexSelectedSaleCurrency]);
                                        }
                                        else
                                            Row[IndexCurrencyName] = DBNull.Value;
                                    }
                                    else
                                    {
                                        Int32 IndexSelectedSaleCurrency = DtArticle.Columns.IndexOf("CurrencyConversionRate_" + currency.Name);
                                        Int32 IndexCurrencyName = DtArticle.Columns.IndexOf(currency.Name);

                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(indexCurrencyConversionDateValue.Value).Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                Row[IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                            else
                                                Row[IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                        }

                                        if (Row[IndexSelectedSaleCurrency] != DBNull.Value && Row[IndexSelectedSaleCurrency] != null && Row[IndexSelectedSaleCurrency] != "")
                                        {
                                            Row[IndexCurrencyName] = Convert.ToDouble(Row[indexSelectedCurrency]) * Convert.ToDouble(Row[IndexSelectedSaleCurrency]);
                                        }
                                        else
                                            Row[IndexCurrencyName] = DBNull.Value;
                                    }
                                }
                            }
                            else if (Convert.ToInt32(record.IdRule) == 308)
                            {
                                Row[indexSelectedCurrency] = record.RuleValue;
                                foreach (Currency currency in SelectedSaleCurrency)
                                {
                                    if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                    {
                                        Int32 IndexSelectedSaleCurrency = DtArticle.Columns.IndexOf("CurrencyConversionRate_" + "Common_Cur");
                                        Int32 IndexCurrencyName = DtArticle.Columns.IndexOf("Common_Cur");
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(indexCurrencyConversionDateValue.Value).Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                Row[IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                            else
                                                Row[IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                        }

                                        if (Row[IndexSelectedSaleCurrency] != DBNull.Value && Row[IndexSelectedSaleCurrency] != null && Row[IndexSelectedSaleCurrency] != "")
                                            Row[IndexCurrencyName] = Convert.ToDouble(Row[indexSelectedCurrency]) * Convert.ToDouble(Row[IndexSelectedSaleCurrency]);
                                        else
                                            Row[IndexCurrencyName] = DBNull.Value;
                                    }
                                    else
                                    {
                                        Int32 IndexSelectedSaleCurrency = DtArticle.Columns.IndexOf("CurrencyConversionRate_" + currency.Name);
                                        Int32 IndexCurrencyName = DtArticle.Columns.IndexOf(currency.Name);
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(indexCurrencyConversionDateValue.Value).Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                Row[IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                            else
                                                Row[IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                        }

                                        if (Row[IndexSelectedSaleCurrency] != DBNull.Value && Row[IndexSelectedSaleCurrency] != null && Row[IndexSelectedSaleCurrency] != "")
                                            Row[IndexCurrencyName] = Convert.ToDouble(Row[indexSelectedCurrency]) * Convert.ToDouble(Row[IndexSelectedSaleCurrency]);
                                        else
                                            Row[IndexCurrencyName] = DBNull.Value;
                                    }
                                }
                            }
                            else if (Convert.ToInt32(record.IdRule) == 1518)
                            {
                                if (Row["Value"] == null || Row["Value"] == DBNull.Value)
                                {
                                    Row["Value"] = 0;

                                    Row["Common_Cur"] = 0;

                                    foreach (Currency cur in SelectedSaleCurrency)
                                    {
                                        if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            Row["Common_Cur"] = 0;
                                        }
                                        else
                                        {
                                            Row[cur.Name] = 0;
                                        }
                                    }
                                }
                                else if (Row["Value"] != null)
                                {
                                    Row["Value"] = 0;

                                    Row["Common_Cur"] = 0;

                                    foreach (Currency cur in SelectedSaleCurrency)
                                    {
                                        if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            Row["Common_Cur"] = 0;
                                        }
                                        else
                                        {
                                            Row[cur.Name] = 0;
                                        }
                                    }
                                }
                            }
                            else if (Convert.ToInt32(record.IdRule) == 309)
                            {
                                Row[indexSelectedCurrency] = Convert.ToDouble(Row["MaxCost_1"]) + (Convert.ToDouble(record.RuleValue));

                                foreach (Currency currency in SelectedSaleCurrency)
                                {
                                    if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                    {
                                        Int32 IndexSelectedSaleCurrency = DtArticle.Columns.IndexOf("CurrencyConversionRate_" + "Common_Cur");
                                        Int32 IndexCurrencyName = DtArticle.Columns.IndexOf("Common_Cur");
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(indexCurrencyConversionDateValue.Value).Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                Row[IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                            else
                                                Row[IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                        }
                                        if (Row[IndexSelectedSaleCurrency] != DBNull.Value && Row[IndexSelectedSaleCurrency] != null && Row[IndexSelectedSaleCurrency] != "")
                                            Row[IndexCurrencyName] = Convert.ToDouble(Row[indexSelectedCurrency]) * Convert.ToDouble(Row[IndexSelectedSaleCurrency]);
                                        else
                                            Row[IndexCurrencyName] = DBNull.Value;
                                    }
                                    else
                                    {
                                        Int32 IndexSelectedSaleCurrency = DtArticle.Columns.IndexOf("CurrencyConversionRate_" + currency.Name);
                                        Int32 IndexCurrencyName = DtArticle.Columns.IndexOf(currency.Name);
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(indexCurrencyConversionDateValue.Value).Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                Row[IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                            else
                                                Row[IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                        }
                                        if (Row[IndexSelectedSaleCurrency] != DBNull.Value && Row[IndexSelectedSaleCurrency] != null && Row[IndexSelectedSaleCurrency] != "")
                                            Row[IndexCurrencyName] = Convert.ToDouble(Row[indexSelectedCurrency]) * Convert.ToDouble(Row[IndexSelectedSaleCurrency]);
                                        else
                                            Row[IndexCurrencyName] = DBNull.Value;
                                    }
                                }
                            }
                            Row["Value"] = DBNull.Value;

                            //delete articles
                            if (DeleteArticles == null)
                                DeleteArticles = new List<Articles>();

                            Articles art = new Articles();
                            art.IdArticle = (uint)Row["IdArticle"];
                            DeleteArticles.Add(art);
                        }

                        if (Row["Common_Cur"] != DBNull.Value)
                            SellPriceValue = Convert.ToDouble(Row["Common_Cur"]);
                        else
                            SellPriceValue = 0;

                        if (Row["MaxCost_1"] != DBNull.Value)
                            MaxCost = Convert.ToDouble(Row["MaxCost_1"]);
                        else
                            MaxCost = 0;

                        Row["Profit"] = Convert.ToDouble(CalculateCustomerPriceArticlesProfitValue(MaxCost, SellPriceValue));
                        Row["CostMargin"] = Convert.ToDouble(CalculateCustomerPriceArticlesCostMarginValue(MaxCost, SellPriceValue));
                    }
                    DtArticle.AcceptChanges();
                    IsEnabledSaveButton = true;
                }
                GeosApplication.Instance.Logger.Log("Method RuleValueChangedCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method RuleValueChangedCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        private void CalculateArticleCostCommandAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method CalculateArticleCostCommandAction()...", category: Category.Info, priority: Priority.Low);
                CalculateBasePriceArticlesByLogicValue();
                if (DtArticle != null && DtArticle.Rows.Count > 0)
                {
                    IsCalculateArticleCostButtonEnabled = false;
                    IsCalculated = true;
                }
                GeosApplication.Instance.Logger.Log("Method CalculateArticleCostCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method CalculateArticleCostCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        public void CalculateBasePriceArticlesByLogicValue()
        {
            try
            {
                if (DtArticle != null && DtArticle.Rows.Count > 0)
                {
                    int IndexselectedCurrencyName_ = DtArticle.Columns.IndexOf("MaxCost_1");
                    int IndexselectedCurrencyName_1 = DtArticle.Columns.IndexOf("BasePriceValue");
                    int indexIdArticle = DtArticle.Columns.IndexOf("IdArticle");
                    int indexCurrencyConversionDate = DtArticle.Columns.IndexOf("CurrencyConversionDate");
                    int indexValue = DtArticle.Columns.IndexOf("Value");
                    int indexLogic = DtArticle.Columns.IndexOf("Logic");

                    int indexProfit = DtArticle.Columns.IndexOf("Profit");
                    int indexCost = DtArticle.Columns.IndexOf("CostMargin");

                    int indexSelectedCurrency = DtArticle.Columns.IndexOf("Common_Cur");
                    int indexIsUpdatedRow = DtArticle.Columns.IndexOf("IsUpdatedRow");



                    for (int j = 0; j < DtArticle.Rows.Count; j++)
                    {
                        try
                        {
                            DtArticle.Rows[j].BeginEdit();
                            UInt64 idArticle = Convert.ToUInt64(DtArticle.Rows[j][indexIdArticle]);
                            double? value = null;
                            Int32? logic = null;
                            DateTime? indexCurrencyConversionDateValue = null;
                            double IndexselectedCurrencyName_Value = 0;
                            double IndexselectedCurrencyName_Value1 = 0;
                            double IndexselectedCurrencyNameValue = 0;
                            double indexSelectedCurrencyvalue = 0;
                            if (DtArticle.Rows[j][indexSelectedCurrency] != DBNull.Value)
                                indexSelectedCurrencyvalue = Convert.ToDouble(DtArticle.Rows[j][indexSelectedCurrency]);
                            if (DtArticle.Rows[j][indexValue] != DBNull.Value)
                                value = Convert.ToInt32(DtArticle.Rows[j][indexValue]);
                            if (DtArticle.Rows[j][indexLogic] != DBNull.Value)
                                logic = Convert.ToInt32(DtArticle.Rows[j][indexLogic]);
                            if (DtArticle.Rows[j][IndexselectedCurrencyName_] != DBNull.Value)
                                IndexselectedCurrencyName_Value = Convert.ToDouble(DtArticle.Rows[j][IndexselectedCurrencyName_]);
                            if (DtArticle.Rows[j][indexSelectedCurrency] != DBNull.Value)
                                IndexselectedCurrencyNameValue = Convert.ToDouble(DtArticle.Rows[j][indexSelectedCurrency]);
                            if (DtArticle.Rows[j][IndexselectedCurrencyName_1] != DBNull.Value)
                                IndexselectedCurrencyName_Value1 = Convert.ToDouble(DtArticle.Rows[j][IndexselectedCurrencyName_1]);

                            //if (DtArticle.Rows[j][indexCurrencyConversionDate] != DBNull.Value)
                            //    indexCurrencyConversionDateValue = Convert.ToDateTime(DtArticle.Rows[j][indexCurrencyConversionDate]);

                            List<CurrencyConversion> filterConversionDate = new List<CurrencyConversion>();
                            if (CurrencyConversionList != null && CurrencyConversionList.Count > 0)
                                filterConversionDate = CurrencyConversionList.Where(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency)).ToList();

                            double Cost_Value = 0;
                            double SellPriceValue = 0.00;
                            DtArticle.Rows[j][indexIsUpdatedRow] = true;

                            Cost_Value = IndexselectedCurrencyName_Value;

                            CustomerPriceListByItem record = ArticleList.FirstOrDefault(a => a.IdArticle == Convert.ToUInt64(DtArticle.Rows[j]["IdArticle"]));
                            //indexCurrencyConversionDateValue = record.CurrencyConversionDate_New;

                            indexCurrencyConversionDateValue = filterConversionDate.FirstOrDefault().LastUpdate;
                            DtArticle.Rows[j][indexCurrencyConversionDate] = indexCurrencyConversionDateValue;


                            if (logic != 0)
                            {
                                // for cpl
                                foreach (Currency currency in SelectedSaleCurrency)
                                {
                                    if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                    {
                                        Int32 IndexSelectedSaleCurrency = DtArticle.Columns.IndexOf("CurrencyConversionRate_" + "Common_Cur");
                                        Int32 IndexCurrencyName = DtArticle.Columns.IndexOf("Common_Cur");
                                        DtArticle.Rows[j][IndexCurrencyName] = DBNull.Value;
                                        CurrencyConversion CurConversion1 = null;

                                        CurConversion1 = filterConversionDate.FirstOrDefault(x => x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == indexCurrencyConversionDateValue.Value.Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (DtArticle.Rows[j][indexValue] != DBNull.Value)
                                                value = Convert.ToInt32(DtArticle.Rows[j][indexValue]);

                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                DtArticle.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                            else
                                                DtArticle.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;

                                            if (value != null)
                                            {
                                                if (logic == 307)
                                                {
                                                    DtArticle.Rows[j][indexSelectedCurrency] = IndexselectedCurrencyName_Value + (IndexselectedCurrencyName_Value * (value / 100));
                                                    if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                        DtArticle.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtArticle.Rows[j][indexSelectedCurrency]) * CurConversion1.ExchangeRate;
                                                    else
                                                        DtArticle.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtArticle.Rows[j][indexSelectedCurrency]) * CurConversion1.LastMonthAVGRate;
                                                }
                                                else if (logic == 308)
                                                {
                                                    if (DtArticle.Rows[j][indexValue] == null || DtArticle.Rows[j][indexValue] == DBNull.Value || Convert.ToDouble(DtArticle.Rows[j][indexValue]) <= 0)
                                                    {
                                                        DtArticle.Rows[j]["Value"] = DBNull.Value;
                                                        DtArticle.Rows[j][indexSelectedCurrency] = DBNull.Value;
                                                        DtArticle.Rows[j][IndexCurrencyName] = DBNull.Value;
                                                    }
                                                    else
                                                    {
                                                        DtArticle.Rows[j][indexSelectedCurrency] = DtArticle.Rows[j][indexValue];
                                                        if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                            DtArticle.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtArticle.Rows[j][indexSelectedCurrency]) * CurConversion1.ExchangeRate;
                                                        else
                                                            DtArticle.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtArticle.Rows[j][indexSelectedCurrency]) * CurConversion1.LastMonthAVGRate;

                                                    }
                                                }
                                                else if (logic == 309)
                                                {
                                                    DtArticle.Rows[j][indexSelectedCurrency] = IndexselectedCurrencyName_Value + (value);
                                                    if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                        DtArticle.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtArticle.Rows[j][indexSelectedCurrency]) * CurConversion1.ExchangeRate;
                                                    else
                                                        DtArticle.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtArticle.Rows[j][indexSelectedCurrency]) * CurConversion1.LastMonthAVGRate;

                                                }
                                            }
                                        }
                                        else
                                        {
                                            DtArticle.Rows[j][IndexSelectedSaleCurrency] = DBNull.Value;
                                            DtArticle.Rows[j][IndexCurrencyName] = DBNull.Value;

                                        }
                                    }
                                    else
                                    {
                                        Int32 IndexSelectedSaleCurrency = DtArticle.Columns.IndexOf("CurrencyConversionRate_" + currency.Name);
                                        Int32 IndexCurrencyName = DtArticle.Columns.IndexOf(currency.Name);
                                        DtArticle.Rows[j][IndexCurrencyName] = DBNull.Value;
                                        CurrencyConversion CurConversion1 = null;

                                        CurConversion1 = filterConversionDate.FirstOrDefault(x => x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == indexCurrencyConversionDateValue.Value.Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (DtArticle.Rows[j][indexValue] != DBNull.Value)
                                                value = Convert.ToInt32(DtArticle.Rows[j][indexValue]);

                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                DtArticle.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                            else
                                                DtArticle.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;

                                            if (value != null)
                                            {
                                                if (logic == 307)
                                                {
                                                    DtArticle.Rows[j][indexSelectedCurrency] = IndexselectedCurrencyName_Value + (IndexselectedCurrencyName_Value * (value / 100));
                                                    if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                        DtArticle.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtArticle.Rows[j][indexSelectedCurrency]) * CurConversion1.ExchangeRate;
                                                    else
                                                        DtArticle.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtArticle.Rows[j][indexSelectedCurrency]) * CurConversion1.LastMonthAVGRate;
                                                }
                                                else if (logic == 308)
                                                {
                                                    if (DtArticle.Rows[j][indexValue] == null || DtArticle.Rows[j][indexValue] == DBNull.Value || Convert.ToDouble(DtArticle.Rows[j][indexValue]) <= 0)
                                                    {
                                                        DtArticle.Rows[j]["Value"] = DBNull.Value;
                                                        DtArticle.Rows[j][indexSelectedCurrency] = DBNull.Value;
                                                        DtArticle.Rows[j][IndexCurrencyName] = DBNull.Value;
                                                    }
                                                    else
                                                    {
                                                        DtArticle.Rows[j][indexSelectedCurrency] = DtArticle.Rows[j][indexValue];
                                                        if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                            DtArticle.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtArticle.Rows[j][indexSelectedCurrency]) * CurConversion1.ExchangeRate;
                                                        else
                                                            DtArticle.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtArticle.Rows[j][indexSelectedCurrency]) * CurConversion1.LastMonthAVGRate;

                                                    }
                                                }
                                                else if (logic == 309)
                                                {
                                                    DtArticle.Rows[j][indexSelectedCurrency] = IndexselectedCurrencyName_Value + (value);
                                                    if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                        DtArticle.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtArticle.Rows[j][indexSelectedCurrency]) * CurConversion1.ExchangeRate;
                                                    else
                                                        DtArticle.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtArticle.Rows[j][indexSelectedCurrency]) * CurConversion1.LastMonthAVGRate;

                                                }
                                            }
                                        }
                                        else
                                        {
                                            DtArticle.Rows[j][IndexSelectedSaleCurrency] = DBNull.Value;
                                            DtArticle.Rows[j][IndexCurrencyName] = DBNull.Value;

                                        }
                                    }
                                }
                            }
                            else
                            {
                                // for BPL
                                if (Convert.ToInt32(record.IdRule) == 307)
                                {
                                    DtArticle.Rows[j][indexSelectedCurrency] = IndexselectedCurrencyName_Value + ((IndexselectedCurrencyName_Value * (Convert.ToDouble(record.RuleValue) / 100)));

                                    foreach (Currency currency in SelectedSaleCurrency)
                                    {
                                        if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            Int32 IndexSelectedSaleCurrency = DtArticle.Columns.IndexOf("CurrencyConversionRate_" + "Common_Cur");
                                            Int32 IndexCurrencyName = DtArticle.Columns.IndexOf("Common_Cur");
                                            CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == indexCurrencyConversionDateValue.Value.Date);
                                            if (CurConversion1 != null)
                                            {
                                                if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                    DtArticle.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                                else
                                                    DtArticle.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                            }


                                            if (DtArticle.Rows[j][IndexSelectedSaleCurrency] != DBNull.Value && DtArticle.Rows[j][IndexSelectedSaleCurrency] != null && DtArticle.Rows[j][IndexSelectedSaleCurrency] != "")
                                            {
                                                DtArticle.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtArticle.Rows[j][indexSelectedCurrency]) * Convert.ToDouble(DtArticle.Rows[j][IndexSelectedSaleCurrency]);
                                            }
                                            else
                                                DtArticle.Rows[j][IndexCurrencyName] = DBNull.Value;


                                            if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                DtArticle.Rows[j][IndexselectedCurrencyName_1] = DtArticle.Rows[j][IndexCurrencyName];
                                            }
                                        }
                                        else
                                        {
                                            Int32 IndexSelectedSaleCurrency = DtArticle.Columns.IndexOf("CurrencyConversionRate_" + currency.Name);
                                            Int32 IndexCurrencyName = DtArticle.Columns.IndexOf(currency.Name);
                                            CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == indexCurrencyConversionDateValue.Value.Date);
                                            if (CurConversion1 != null)
                                            {
                                                if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                    DtArticle.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                                else
                                                    DtArticle.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                            }


                                            if (DtArticle.Rows[j][IndexSelectedSaleCurrency] != DBNull.Value && DtArticle.Rows[j][IndexSelectedSaleCurrency] != null && DtArticle.Rows[j][IndexSelectedSaleCurrency] != "")
                                            {
                                                DtArticle.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtArticle.Rows[j][indexSelectedCurrency]) * Convert.ToDouble(DtArticle.Rows[j][IndexSelectedSaleCurrency]);
                                            }
                                            else
                                                DtArticle.Rows[j][IndexCurrencyName] = DBNull.Value;


                                            if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                DtArticle.Rows[j][IndexselectedCurrencyName_1] = DtArticle.Rows[j][IndexCurrencyName];
                                            }
                                        }
                                    }
                                }
                                else if (Convert.ToInt32(record.IdRule) == 308)
                                {
                                    if (record.RuleValue == null || Convert.ToDouble(record.RuleValue) <= 0)
                                    {
                                        DtArticle.Rows[j]["Value"] = DBNull.Value;
                                        DtArticle.Rows[j][indexSelectedCurrency] = record.RuleValue;
                                        foreach (Currency currency in SelectedSaleCurrency)
                                        {
                                            if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                Int32 IndexSelectedSaleCurrency = DtArticle.Columns.IndexOf("CurrencyConversionRate_" + "Common_Cur");
                                                Int32 IndexCurrencyName = DtArticle.Columns.IndexOf("Common_Cur");
                                                DtArticle.Rows[j][IndexSelectedSaleCurrency] = DBNull.Value;

                                                if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                                {
                                                    DtArticle.Rows[j][IndexselectedCurrencyName_1] = DtArticle.Rows[j][IndexCurrencyName];
                                                }
                                            }
                                            else
                                            {
                                                Int32 IndexSelectedSaleCurrency = DtArticle.Columns.IndexOf("CurrencyConversionRate_" + currency.Name);
                                                Int32 IndexCurrencyName = DtArticle.Columns.IndexOf(currency.Name);
                                                DtArticle.Rows[j][IndexSelectedSaleCurrency] = DBNull.Value;

                                                if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                                {
                                                    DtArticle.Rows[j][IndexselectedCurrencyName_1] = DtArticle.Rows[j][IndexCurrencyName];
                                                }
                                            }
                                        }
                                    }
                                    else
                                    {


                                        DtArticle.Rows[j][indexSelectedCurrency] = record.RuleValue;
                                        foreach (Currency currency in SelectedSaleCurrency)
                                        {
                                            if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                Int32 IndexSelectedSaleCurrency = DtArticle.Columns.IndexOf("CurrencyConversionRate_" + "Common_Cur");
                                                Int32 IndexCurrencyName = DtArticle.Columns.IndexOf("Common_Cur");
                                                CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == indexCurrencyConversionDateValue.Value.Date);
                                                if (CurConversion1 != null)
                                                {
                                                    if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                        DtArticle.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                                    else
                                                        DtArticle.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                                }


                                                if (DtArticle.Rows[j][IndexSelectedSaleCurrency] != DBNull.Value && DtArticle.Rows[j][IndexSelectedSaleCurrency] != null && DtArticle.Rows[j][IndexSelectedSaleCurrency] != "")
                                                    DtArticle.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtArticle.Rows[j][indexSelectedCurrency]) * Convert.ToDouble(DtArticle.Rows[j][IndexSelectedSaleCurrency]);
                                                else
                                                    DtArticle.Rows[j][IndexCurrencyName] = DBNull.Value;


                                                if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                                {
                                                    DtArticle.Rows[j][IndexselectedCurrencyName_1] = DtArticle.Rows[j][IndexCurrencyName];
                                                }
                                            }
                                            else
                                            {
                                                Int32 IndexSelectedSaleCurrency = DtArticle.Columns.IndexOf("CurrencyConversionRate_" + currency.Name);
                                                Int32 IndexCurrencyName = DtArticle.Columns.IndexOf(currency.Name);
                                                CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == indexCurrencyConversionDateValue.Value.Date);
                                                if (CurConversion1 != null)
                                                {
                                                    if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                        DtArticle.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                                    else
                                                        DtArticle.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                                }


                                                if (DtArticle.Rows[j][IndexSelectedSaleCurrency] != DBNull.Value && DtArticle.Rows[j][IndexSelectedSaleCurrency] != null && DtArticle.Rows[j][IndexSelectedSaleCurrency] != "")
                                                    DtArticle.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtArticle.Rows[j][indexSelectedCurrency]) * Convert.ToDouble(DtArticle.Rows[j][IndexSelectedSaleCurrency]);
                                                else
                                                    DtArticle.Rows[j][IndexCurrencyName] = DBNull.Value;


                                                if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                                {
                                                    DtArticle.Rows[j][IndexselectedCurrencyName_1] = DtArticle.Rows[j][IndexCurrencyName];
                                                }
                                            }
                                        }
                                    }
                                }
                                else if (Convert.ToInt32(record.IdRule) == 1518)
                                {

                                    DtArticle.Rows[j][indexSelectedCurrency] = 0;
                                    foreach (Currency currency in SelectedSaleCurrency)
                                    {
                                        if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            Int32 IndexCurrencyName = DtArticle.Columns.IndexOf("Common_Cur");
                                            DtArticle.Rows[j][IndexCurrencyName] = 0;

                                            if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                DtArticle.Rows[j][IndexselectedCurrencyName_1] = DtArticle.Rows[j][IndexCurrencyName];
                                            }
                                        }
                                        else
                                        {
                                            Int32 IndexCurrencyName = DtArticle.Columns.IndexOf(currency.Name);
                                            DtArticle.Rows[j][IndexCurrencyName] = 0;

                                            if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                DtArticle.Rows[j][IndexselectedCurrencyName_1] = DtArticle.Rows[j][IndexCurrencyName];
                                            }
                                        }
                                    }

                                }
                                else if (Convert.ToInt32(record.IdRule) == 309)
                                {
                                    DtArticle.Rows[j][indexSelectedCurrency] = IndexselectedCurrencyName_Value + (Convert.ToDouble(record.RuleValue));

                                    foreach (Currency currency in SelectedSaleCurrency)
                                    {
                                        if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            Int32 IndexSelectedSaleCurrency = DtArticle.Columns.IndexOf("CurrencyConversionRate_" + "Common_Cur");
                                            Int32 IndexCurrencyName = DtArticle.Columns.IndexOf("Common_Cur");
                                            CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == indexCurrencyConversionDateValue.Value.Date);
                                            if (CurConversion1 != null)
                                            {
                                                if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                    DtArticle.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                                else
                                                    DtArticle.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                            }

                                            if (DtArticle.Rows[j][IndexSelectedSaleCurrency] != DBNull.Value && DtArticle.Rows[j][IndexSelectedSaleCurrency] != null && DtArticle.Rows[j][IndexSelectedSaleCurrency] != "")
                                                DtArticle.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtArticle.Rows[j][indexSelectedCurrency]) * Convert.ToDouble(DtArticle.Rows[j][IndexSelectedSaleCurrency]);
                                            else
                                                DtArticle.Rows[j][IndexCurrencyName] = DBNull.Value;


                                            if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                DtArticle.Rows[j][IndexselectedCurrencyName_1] = DtArticle.Rows[j][IndexCurrencyName];
                                            }
                                        }
                                        else
                                        {
                                            Int32 IndexSelectedSaleCurrency = DtArticle.Columns.IndexOf("CurrencyConversionRate_" + currency.Name);
                                            Int32 IndexCurrencyName = DtArticle.Columns.IndexOf(currency.Name);
                                            CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == indexCurrencyConversionDateValue.Value.Date);
                                            if (CurConversion1 != null)
                                            {
                                                if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                    DtArticle.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                                else
                                                    DtArticle.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                            }

                                            if (DtArticle.Rows[j][IndexSelectedSaleCurrency] != DBNull.Value && DtArticle.Rows[j][IndexSelectedSaleCurrency] != null && DtArticle.Rows[j][IndexSelectedSaleCurrency] != "")
                                                DtArticle.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtArticle.Rows[j][indexSelectedCurrency]) * Convert.ToDouble(DtArticle.Rows[j][IndexSelectedSaleCurrency]);
                                            else
                                                DtArticle.Rows[j][IndexCurrencyName] = DBNull.Value;


                                            if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                DtArticle.Rows[j][IndexselectedCurrencyName_1] = DtArticle.Rows[j][IndexCurrencyName];
                                            }
                                        }
                                    }
                                }
                            }

                            if (DtArticle.Rows[j][indexSelectedCurrency] == DBNull.Value)
                            {
                                SellPriceValue = 0.00;
                            }
                            else
                            {
                                SellPriceValue = Convert.ToDouble(DtArticle.Rows[j][indexSelectedCurrency]);
                            }
                            DtArticle.Rows[j][indexProfit] = CalculateCustomerPriceArticlesProfitValue(Cost_Value, SellPriceValue);
                            DtArticle.Rows[j][indexCost] = CalculateCustomerPriceArticlesCostMarginValue(Cost_Value, SellPriceValue);
                        }
                        catch (Exception ex)
                        {
                            GeosApplication.Instance.Logger.Log(string.Format("Error in method CalculateBasePriceArticlesByLogicValue() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                        }
                    }

                    DtArticle.AcceptChanges();
                }
                FilterBPLAndCPL();
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method CalculateBasePriceArticlesByLogicValue() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private double CalculateCustomerPriceArticlesProfitValue(double MaxCost, double SellPriceValue)
        {
            double Profit = 0;
            try
            {
                //GeosApplication.Instance.Logger.Log("Method CalculateBasePriceArticlesProfitValue() ...", category: Category.Info, priority: Priority.Low);

                if ((SellPriceValue == 0 && MaxCost == 0) || (SellPriceValue == MaxCost) || (SellPriceValue == 0 && MaxCost > 0))
                    Profit = 0.00;
                else
                    Profit = Convert.ToDouble(((((SellPriceValue) - (MaxCost)) / (SellPriceValue)) * 100));

                Profit = Math.Round(Profit, 2);

                //GeosApplication.Instance.Logger.Log("Method CalculateBasePriceArticlesProfitValue() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in CalculateBasePriceArticlesProfitValue() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
            return Profit;
        }

        private double CalculateCustomerPriceArticlesCostMarginValue(double MaxCost, double SellPriceValue)
        {
            double CostMargin = 0;
            try
            {
                //GeosApplication.Instance.Logger.Log("Method CalculateBasePriceArticlesCostMarginValue() ...", category: Category.Info, priority: Priority.Low);

                if ((MaxCost == 0 && SellPriceValue == 0) || (MaxCost == SellPriceValue) || (MaxCost == 0 && SellPriceValue > 0))
                    CostMargin = 0.00;
                else
                    CostMargin = Convert.ToDouble(((((SellPriceValue) - (MaxCost)) / (MaxCost)) * 100));

                CostMargin = Math.Round(CostMargin, 2);

                //GeosApplication.Instance.Logger.Log("Method CalculateBasePriceArticlesCostMarginValue() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in CalculateBasePriceArticlesCostMarginValue() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
            return CostMargin;
        }
		//[nsatpute][28.05.2025][GEOS2-6689]
        private void FillArticleData()
        {
            const string methodName = "FillArticleData";
            GeosApplication.Instance.Logger.Log($"Method {methodName} started...", Category.Info, Priority.Low);

            try
            {
                // Initialize data structures if null
                if (DtArticleCopy == null) DtArticleCopy = new DataTable();
                if (SavedArticles == null) SavedArticles = new List<CustomerPriceListByItem>();

                var currencyConversion = CurrencyConversionList.FirstOrDefault();
                var currencyConversionDate = currencyConversion != null ? currencyConversion.LastUpdate : (DateTime?)null;
                var selectedCurrency = SelectedCurrency as Currency;
                var selectedCurrencyId = selectedCurrency?.IdCurrency;
                /*
               // Create a thread-safe collection for the results
               var processedRows = new ConcurrentBag<DataRow>();

               // Parallel processing of articles
               Parallel.ForEach(ArticleList, record =>
               {
                   try
                   {
                       var dr = ProcessArticleRecord(record, currencyConversionDate, selectedCurrencyId);
                       if (dr != null)
                       {
                           processedRows.Add(dr);
                       }
                   }
                   catch (Exception ex)
                   {
                       GeosApplication.Instance.Logger.Log($"Error processing article {record.IdArticle} in {methodName}: {ex.Message}",
                           Category.Exception, Priority.Low);
                   }
               });
               */
                // Using PLINQ (sometimes faster than Parallel.ForEach)
                var processedRows = ArticleList
                    .AsParallel()
                    .WithDegreeOfParallelism(Environment.ProcessorCount)
                    .Select(record => {
                        try
                        {
                            return ProcessArticleRecord(record, currencyConversionDate, selectedCurrencyId);
                        }
                        catch (Exception ex)
                        {
                            GeosApplication.Instance.Logger.Log($"Error processing article {record.IdArticle} in {methodName}: {ex.Message}",
                             Category.Exception, Priority.Low);
                            return null;
                        }
                    })
                    .Where(dr => dr != null)
                    .ToList();

                // Add all processed rows to the DataTable
                foreach (var row in processedRows)
                {
                    DtArticleCopy.Rows.Add(row);
                }

                IsEnabledSaveButton = true;
                DtArticle = DtArticleCopy;

                GeosApplication.Instance.Logger.Log($"Method {methodName} executed successfully",
                    Category.Info, Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                HandleServiceException(ex);
            }
            catch (ServiceUnexceptedException ex)
            {
                HandleUnexpectedServiceException(ex);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log($"Error in {methodName}: {ex.Message}",
                    Category.Exception, Priority.Low);
            }
        }

        
		//[nsatpute][28.05.2025][GEOS2-6689]
        private DataRow ProcessArticleRecord(CustomerPriceListByItem record, DateTime? currencyConversionDate, int? selectedCurrencyId)
        {
            double costValue = 0;
            var dr = DtArticleCopy.NewRow();
            dr["IsChecked"] = false;
            dr["CurrencyConversionDate"] = currencyConversionDate;

            bool isSavedRecord = SavedArticles.Any(a => a.IdArticle == record.IdArticle) &&
                                WindowHeader == Application.Current.FindResource("EditCustomerPriceList").ToString() &&
                                ClonedCustomerPrice.IdBasePriceList == SelectedBasePriceName.IdBasePriceList;

            if (isSavedRecord)
            {
                ProcessSavedRecord(record, dr, ref costValue, currencyConversionDate, selectedCurrencyId);
            }
            else
            {
                ProcessNewRecord(record, dr, ref costValue, currencyConversionDate, selectedCurrencyId);
            }

            // Calculate profit and margin
            double sellPriceValue = dr["Common_Cur"] == DBNull.Value ? 0.00 : Convert.ToDouble(dr["Common_Cur"]);
            dr["Profit"] = CalculateCustomerPriceArticlesProfitValue(costValue, sellPriceValue);
            dr["CostMargin"] = CalculateCustomerPriceArticlesCostMarginValue(costValue, sellPriceValue);

            // Set conversion date display
            if (dr["CurrencyConversionDate"] != DBNull.Value)
            {
                string dateText = SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509
                    ? DateTime.Now.ToString("dd/MM/yyyy")
                    : Convert.ToDateTime(dr["CurrencyConversionDate"]).ToString("dd/MM/yyyy");
                dr["SaleCurrencyConversionDate"] = $"Updated currency rate on : {dateText}";
            }

            return dr;
        }
		//[nsatpute][28.05.2025][GEOS2-6689]
        private void ProcessSavedRecord(CustomerPriceListByItem record, DataRow dr, ref double costValue, DateTime? currencyConversionDate, int? selectedCurrencyId)
        {
            var savedRecord = SavedArticles.FirstOrDefault(a => a.IdArticle == record.IdArticle);
            if (savedRecord == null) return;

            // Set basic record info
            dr["Reference"] = savedRecord.ArticleData.Reference;
            dr["Category"] = savedRecord.ArticleData.PcmArticleCategory.Name;
            dr["STAT"] = record.ArticleData.PcmArticleCategory.StatusAbbreviation;
            dr["HtmlColor"] = record.ArticleData.PcmArticleCategory.StatusHtmlColor;
            dr["IdArticle"] = savedRecord.IdArticle;

            // Process plant costs
            costValue = ProcessPlantCosts(record, dr, (long)savedRecord.IdArticle);

            // Handle linked description
            if (savedRecord.LinkedDescription == 1)
            {
                var article = ArticleList.FirstOrDefault(a => a.IdArticle == (ulong)savedRecord.IdArticle);
                if (article != null)
                {
                    savedRecord.ItemCustomerDescription = article.ArticleData.Description_es;
                    savedRecord.ItemCustomerDescription_Old = savedRecord.ItemCustomerDescription;
                    record.ItemCustomerDescription_Old = savedRecord.ItemCustomerDescription;
                }
            }

            dr["Name"] = savedRecord.ItemCustomerDescription != null ? savedRecord.ItemCustomerDescription.Trim('\n') : string.Empty;
            dr["Logic"] = savedRecord.IdRule;
            dr["Value"] = savedRecord.RuleValue;
            dr["Enable_Delete"] = false;
            dr["Enable_DescriptionLinked"] = false;
            dr["Enable_VisibleCustomer"] = false;

            // Process pricing rules
            ProcessPricingRules(dr, costValue, currencyConversionDate, selectedCurrencyId, savedRecord.IdRule, savedRecord.RuleValue);

            // Set visibility and description flags
            dr["Name_Changed"] = savedRecord.LinkedDescription == 0;
            dr["NameChanged"] = savedRecord.LinkedDescription == 0 ? "Unlinked Description" : "Linked Description";
            dr["Visible_Customer"] = savedRecord.VisibleToCustomer != 0;
            dr["VisibleCustomer"] = savedRecord.VisibleToCustomer == 0 ? "Invisible" : "Visible";
            dr["Name_Old"] = savedRecord.ItemCustomerDescription_Old;
            dr["IsSalePriceValueColor"] = true;
        }
		//[nsatpute][28.05.2025][GEOS2-6689]
        private void ProcessNewRecord(CustomerPriceListByItem record, DataRow dr, ref double costValue, DateTime? currencyConversionDate, int? selectedCurrencyId)
        {
            // Set basic record info
            dr["Reference"] = record.ArticleData.Reference;
            dr["Category"] = record.ArticleData.PcmArticleCategory.Name;
            dr["IdArticle"] = record.IdArticle;
            dr["STAT"] = record.ArticleData.PcmArticleCategory.StatusAbbreviation;
            dr["HtmlColor"] = record.ArticleData.PcmArticleCategory.StatusHtmlColor;
            dr["Name"] = record.ArticleData.Description;
            dr["Logic"] = SelectedLogic.IdLookupValue;
            dr["Value"] = DBNull.Value;
            dr["Enable_Delete"] = true;
            dr["Enable_DescriptionLinked"] = true;
            dr["Enable_VisibleCustomer"] = true;

            // Process plant costs
            costValue = ProcessPlantCosts(record, dr, (long)record.IdArticle);
            dr["MaxCost_1"] = costValue;

            // Handle linked description
            if (record.LinkedDescription == 1)
            {
                var article = ArticleList.FirstOrDefault(a => a.IdArticle == (ulong)record.IdArticle);
                if (article != null)
                {
                    record.ItemCustomerDescription = article.ArticleData.Description_es;
                    record.ItemCustomerDescription_Old = record.ItemCustomerDescription;
                }
            }

            dr["IsSalePriceValueColor"] = false;

            // Process pricing rules
            ProcessPricingRules(dr, costValue, currencyConversionDate, selectedCurrencyId, record.IdRule, record.RuleValue);

            // Set default visibility and description flags
            dr["Name_Changed"] = false;
            dr["NameChanged"] = "Linked Description";
            dr["Visible_Customer"] = true;
            dr["VisibleCustomer"] = "Visible";
            dr["Name_Old"] = record.ItemCustomerDescription_Old;
        }
        //[nsatpute][28.05.2025][GEOS2-6689]
        private double ProcessPlantCosts(CustomerPriceListByItem record, DataRow dr, long articleId)
        {
            double finalMaxCost = 0;
            object lockObj = new object();
            uint localArticleId = (uint)articleId;

            var plants = SelectedPlant.OfType<Site>().ToList();

            Parallel.ForEach(plants, () => 0.0, (plant, loopState, localMax) =>
            {
                var cost = ArticleCostPriceList.FirstOrDefault(a =>
                          a.IdCompany == plant.IdSite &&
                          a.IdArticle == localArticleId)
                          ?? new ArticleCostPrice();

                double currentCost = cost.ArticleCostValue;

                lock (lockObj)
                {
                    dr[plant.Name] = currentCost;
                }

                return Math.Max(localMax, currentCost);
            },
            threadLocalMax =>
            {
                lock (lockObj)
                {
                    if (threadLocalMax > finalMaxCost)
                    {
                        finalMaxCost = threadLocalMax;
                        dr["MaxCost_1"] = finalMaxCost;
                    }
                }
            });

            return finalMaxCost;
        }
        //[nsatpute][28.05.2025][GEOS2-6689]
        private void ProcessPricingRules(DataRow dr, double costValue, DateTime? currencyConversionDate, int? selectedCurrencyId, int? ruleId, double? ruleValue)
        {
            if (ruleId == null) return;

            switch (ruleId.Value)
            {
                case 307: // Percentage markup
                    ProcessPercentageMarkupRule(dr, costValue, currencyConversionDate, selectedCurrencyId, ruleValue);
                    break;
                case 308: // Fixed price
                    ProcessFixedPriceRule(dr, currencyConversionDate, selectedCurrencyId, ruleValue);
                    break;
                case 1518: // Zero price
                    ProcessZeroPriceRule(dr, currencyConversionDate, selectedCurrencyId);
                    break;
                case 309: // Fixed amount markup
                    ProcessFixedAmountMarkupRule(dr, costValue, currencyConversionDate, selectedCurrencyId, ruleValue);
                    break;
            }
        }
		//[nsatpute][28.05.2025][GEOS2-6689]
        private void ProcessPercentageMarkupRule(DataRow dr, double costValue, DateTime? currencyConversionDate, int? selectedCurrencyId, double? ruleValue)
        {
            if (ruleValue == null) return;

            double baseValue = costValue + (costValue * (ruleValue.Value / 100));
            dr["Common_Cur"] = baseValue;
            ProcessCurrencyConversions(dr, baseValue, currencyConversionDate, selectedCurrencyId);
            dr["BasePriceValue"] = dr["Common_Cur"];
        }
		//[nsatpute][28.05.2025][GEOS2-6689]
        private void ProcessFixedPriceRule(DataRow dr, DateTime? currencyConversionDate, int? selectedCurrencyId, double? ruleValue)
        {
            if (ruleValue == null || ruleValue <= 0)
            {
                dr["Value"] = DBNull.Value;
                dr["Common_Cur"] = DBNull.Value;
                ProcessCurrencyConversions(dr, null, currencyConversionDate, selectedCurrencyId);
                dr["BasePriceValue"] = DBNull.Value;
            }
            else
            {
                dr["Common_Cur"] = ruleValue;
                ProcessCurrencyConversions(dr, ruleValue.Value, currencyConversionDate, selectedCurrencyId);
                dr["BasePriceValue"] = dr["Common_Cur"];
            }
        }
		//[nsatpute][28.05.2025][GEOS2-6689]
        private void ProcessZeroPriceRule(DataRow dr, DateTime? currencyConversionDate, int? selectedCurrencyId)
        {
            dr["Value"] = 0;
            dr["Common_Cur"] = 0;
            ProcessCurrencyConversions(dr, 0, currencyConversionDate, selectedCurrencyId);
            dr["BasePriceValue"] = 0;
            dr["Value"] = DBNull.Value;
        }
		//[nsatpute][28.05.2025][GEOS2-6689]
        private void ProcessFixedAmountMarkupRule(DataRow dr, double costValue, DateTime? currencyConversionDate, int? selectedCurrencyId, double? ruleValue)
        {
            if (ruleValue == null) return;

            double baseValue = costValue + ruleValue.Value;
            dr["Common_Cur"] = baseValue;
            ProcessCurrencyConversions(dr, baseValue, currencyConversionDate, selectedCurrencyId);
            dr["BasePriceValue"] = dr["Common_Cur"];
        }
        //[nsatpute][28.05.2025][GEOS2-6689]
        private void ProcessCurrencyConversions(DataRow dr, double? baseValue, DateTime? currencyConversionDate, int? selectedCurrencyId)
        {
            if (currencyConversionDate == null || selectedCurrencyId == null) return;

            // Create thread-safe local copies of shared data
            var localBaseValue = baseValue;
            var localConversionDate = currencyConversionDate.Value.Date;
            var localSelectedCurrencyId = (byte)selectedCurrencyId.Value;
            var useExchangeRate = SelectedExchangeRate?.IdLookupValue == 1509;

            // Prepare a thread-safe collection of currencies
            var currencies = SelectedSaleCurrency.OfType<Currency>().ToList();

            // Use thread-local storage to minimize locking
            Parallel.ForEach(currencies, currency =>
            {
                string rateFieldName = currency.IdCurrency == selectedCurrencyId
                    ? "CurrencyConversionRate_Common_Cur"
                    : $"CurrencyConversionRate_{currency.Name}";

                // Find conversion in thread-safe manner (assuming CurrencyConversionList is thread-safe for reads)
                var conversion = CurrencyConversionList.FirstOrDefault(x =>
                    x.Idcurrencyfrom == localSelectedCurrencyId &&
                    x.Idcurrencyto == currency.IdCurrency &&
                    x.LastUpdate.Date == localConversionDate);

                double? rateValue = null;
                if (conversion != null)
                {
                    rateValue = useExchangeRate ? conversion.ExchangeRate : conversion.LastMonthAVGRate;
                }

                // Calculate all values before locking
                object commonCurValue = DBNull.Value;
                object currencyValue = DBNull.Value;

                if (currency.IdCurrency == selectedCurrencyId)
                {
                    if (localBaseValue.HasValue && rateValue.HasValue)
                    {
                        commonCurValue = localBaseValue.Value * rateValue.Value;
                    }
                }
                else
                {
                    // Need to read Common_Cur value - requires lock
                    lock (dr)
                    {
                        var commonCur = dr["Common_Cur"];
                        if (localBaseValue.HasValue && commonCur != DBNull.Value && rateValue.HasValue)
                        {
                            currencyValue = Convert.ToDouble(commonCur) * rateValue.Value;
                        }
                    }
                }

                // Single lock for all DataRow updates
                lock (dr)
                {
                    if (conversion != null)
                    {
                        dr[rateFieldName] = rateValue;
                    }

                    if (currency.IdCurrency == selectedCurrencyId)
                    {
                        dr["Common_Cur"] = commonCurValue;
                    }
                    else
                    {
                        dr[currency.Name] = currencyValue;
                    }
                }
            });
        }
        //[nsatpute][28.05.2025][GEOS2-6689]
        private void HandleServiceException(FaultException<ServiceException> ex)
        {
            if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime)
            {
                DXSplashScreen.Close();
            }

            GeosApplication.Instance.Logger.Log($"Service error in FillArticleData: {ex.Detail.ErrorMessage}",
                Category.Exception, Priority.Low);
            CustomMessageBox.Show(
                GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null),
                "Red",
                CustomMessageBox.MessageImagePath.NotOk,
                MessageBoxButton.OK);
        }
		//[nsatpute][28.05.2025][GEOS2-6689]
        private void HandleUnexpectedServiceException(ServiceUnexceptedException ex)
        {
            if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime)
            {
                DXSplashScreen.Close();
            }

            GeosApplication.Instance.Logger.Log($"Unexpected service error in FillArticleData: {ex.Message}",
                Category.Info, Priority.Low);
            GeosApplication.Instance.ExceptionHandlingOperation(
                ex.ExceptionType,
                GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(),
                null);
        }

        private void ArticleVisibleCustomerCommandAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ArticleVisibleCustomerCommandAction()...", category: Category.Info, priority: Priority.Low);

                DataColumn[] columns = DtArticleCopy.Columns.Cast<DataColumn>().ToArray();
                DataRow[] foundChecked = DtArticleCopy.AsEnumerable().Where(row => columns.Any(col => row["IsChecked"].ToString() == "True")).ToArray();
                DataRow MainRow = ((System.Data.DataRowView)obj).Row;
                bool value = Convert.ToBoolean(MainRow["Visible_Customer"]);
                if (foundChecked.Length > 0 && MainRow["IsChecked"].ToString() != "False")
                {
                    foreach (DataRow item in foundChecked)
                    {
                        DataRow Row = item;
                        if (Row["IsChecked"].ToString() != "False")
                        {
                            if (Convert.ToUInt32(Row["IdArticle"]) != Convert.ToUInt32(MainRow["IdArticle"]))
                            {
                                if (MainRow["Visible_Customer"] != DBNull.Value && Convert.ToBoolean(MainRow["Visible_Customer"]) == false)
                                {
                                    Row["Visible_Customer"] = true;
                                    Row["VisibleCustomer"] = "Visible";
                                }
                                else
                                {
                                    Row["Visible_Customer"] = false;
                                    Row["VisibleCustomer"] = "Invisible";
                                }


                                Row["IsColor"] = true;
                                Row["IsSalePriceValueColor"] = true;
                                Row["IsUpdatedRow"] = true;
                            }
                        }
                    }

                }

                DataRow Row1 = ((System.Data.DataRowView)obj).Row;
                if (Row1["Visible_Customer"] != DBNull.Value && Convert.ToBoolean(Row1["Visible_Customer"]) == false)
                {
                    Row1["Visible_Customer"] = true;
                    Row1["VisibleCustomer"] = "Visible";
                }
                else
                {
                    Row1["Visible_Customer"] = false;
                    Row1["VisibleCustomer"] = "Invisible";
                }

                Row1["IsColor"] = true;
                Row1["IsSalePriceValueColor"] = true;
                Row1["IsUpdatedRow"] = true;
                IsEnabledSaveButton = true;

                GeosApplication.Instance.Logger.Log("Method ArticleVisibleCustomerCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method ArticleVisibleCustomerCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void ArticleDescriptionLinkedCommandAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ArticleDescriptionLinkedCommandAction()...", category: Category.Info, priority: Priority.Low);

                DataColumn[] columns = DtArticleCopy.Columns.Cast<DataColumn>().ToArray();
                DataRow[] foundChecked = DtArticleCopy.AsEnumerable().Where(row => columns.Any(col => row["IsChecked"].ToString() == "True")).ToArray();
                DataRow MainRow = ((System.Data.DataRowView)obj).Row;
                bool value = Convert.ToBoolean(MainRow["Name_Changed"]);
                if (foundChecked.Length > 0 && MainRow["IsChecked"].ToString() != "False")
                {
                    foreach (DataRow item in foundChecked)
                    {
                        DataRow Row = item;
                        if (Row["IsChecked"].ToString() != "False")
                        {
                            if (Convert.ToUInt32(Row["IdArticle"]) != Convert.ToUInt32(MainRow["IdArticle"]))
                            {
                                if (MainRow["Name_Changed"] != DBNull.Value && Convert.ToBoolean(MainRow["Name_Changed"]) == false)
                                {
                                    Row["Name_Changed"] = true;
                                    Row["NameChanged"] = "Unlinked Description";
                                }
                                else
                                {
                                    Row["Name_Changed"] = false;
                                    Row["NameChanged"] = "Linked Description";
                                    Row["Name"] = ArticleList.FirstOrDefault(a => a.IdArticle == Convert.ToUInt64(Row["IdArticle"])).ArticleData.Description_es;

                                }
                                Row["IsColor"] = true;
                                Row["IsSalePriceValueColor"] = true;
                                Row["IsUpdatedRow"] = true;
                            }
                        }
                    }

                }

                DataRow Row1 = ((System.Data.DataRowView)obj).Row;
                if (Row1["Name_Changed"] != DBNull.Value && Convert.ToBoolean(Row1["Name_Changed"]) == false)
                {
                    Row1["Name_Changed"] = true;
                    Row1["NameChanged"] = "Unlinked Description";
                }
                else
                {
                    Row1["Name_Changed"] = false;
                    Row1["NameChanged"] = "Linked Description";
                    Row1["Name"] = ArticleList.FirstOrDefault(a => a.IdArticle == Convert.ToUInt64(Row1["IdArticle"])).ArticleData.Description_es;
                }

                Row1["IsColor"] = true;
                Row1["IsSalePriceValueColor"] = true;
                Row1["IsUpdatedRow"] = true;
                IsEnabledSaveButton = true;

                GeosApplication.Instance.Logger.Log("Method ArticleDescriptionLinkedCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method ArticleDescriptionLinkedCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void AddChangedLogsDetails()
        {
            GeosApplication.Instance.Logger.Log("Method AddChangedLogsDetails ...", category: Category.Info, priority: Priority.Low);
            try
            {
                if (CustomerChangeLogList == null)
                    CustomerChangeLogList = new ObservableCollection<CustomerPriceLogEntry>();

                UpdatedItem.Name = UpdatedItem.Name.Trim();
                //for Name
                if (ClonedCustomerPrice.Name != UpdatedItem.Name)
                {
                    if (string.IsNullOrEmpty(UpdatedItem.Name))
                        CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogName").ToString(), ClonedCustomerPrice.Name, "None") });
                    else
                    {
                        if (string.IsNullOrEmpty(ClonedCustomerPrice.Name))
                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogName").ToString(), "None", Name) });
                        else
                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogName").ToString(), ClonedCustomerPrice.Name, UpdatedItem.Name) });
                    }
                }
                UpdatedItem.Name_es = UpdatedItem.Name_es.Trim();
                if (ClonedCustomerPrice.Name_es != UpdatedItem.Name_es)
                {
                    if (string.IsNullOrEmpty(UpdatedItem.Name_es))
                        CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogNameES").ToString(), ClonedCustomerPrice.Name_es, "None") });
                    else
                    {
                        if (string.IsNullOrEmpty(ClonedCustomerPrice.Name_es))
                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogNameES").ToString(), "None", UpdatedItem.Name_es) });
                        else
                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogNameES").ToString(), ClonedCustomerPrice.Name_es, UpdatedItem.Name_es) });
                    }
                }
                UpdatedItem.Name_fr = UpdatedItem.Name_fr.Trim();
                if (ClonedCustomerPrice.Name_fr != UpdatedItem.Name_fr)
                {
                    if (string.IsNullOrEmpty(UpdatedItem.Name_fr))
                        CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogNameFR").ToString(), ClonedCustomerPrice.Name_fr, "None") });
                    else
                    {
                        if (string.IsNullOrEmpty(ClonedCustomerPrice.Name_fr))
                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogNameFR").ToString(), "None", UpdatedItem.Name_fr) });
                        else
                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogNameFR").ToString(), ClonedCustomerPrice.Name_fr, UpdatedItem.Name_fr) });
                    }
                }
                UpdatedItem.Name_pt = UpdatedItem.Name_pt.Trim();
                if (ClonedCustomerPrice.Name_pt != UpdatedItem.Name_pt)
                {
                    if (string.IsNullOrEmpty(UpdatedItem.Name_pt))
                        CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogNamePT").ToString(), ClonedCustomerPrice.Name_pt, "None") });
                    else
                    {
                        if (string.IsNullOrEmpty(ClonedCustomerPrice.Name_pt))
                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogNamePT").ToString(), "None", UpdatedItem.Name_pt) });
                        else
                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogNamePT").ToString(), ClonedCustomerPrice.Name_pt, UpdatedItem.Name_pt) });
                    }
                }
                UpdatedItem.Name_ro = UpdatedItem.Name_ro.Trim();
                if (ClonedCustomerPrice.Name_ro != UpdatedItem.Name_ro)
                {
                    if (string.IsNullOrEmpty(UpdatedItem.Name_ro))
                        CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogNameRO").ToString(), ClonedCustomerPrice.Name_ro, "None") });
                    else
                    {
                        if (string.IsNullOrEmpty(ClonedCustomerPrice.Name_ro))
                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogNameRO").ToString(), "None", UpdatedItem.Name_ro) });
                        else
                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogNameRO").ToString(), ClonedCustomerPrice.Name_ro, UpdatedItem.Name_ro) });
                    }
                }
                UpdatedItem.Name_ru = UpdatedItem.Name_ru.Trim();
                if (ClonedCustomerPrice.Name_ru != UpdatedItem.Name_ru)
                {
                    if (string.IsNullOrEmpty(UpdatedItem.Name_ru))
                        CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogNameRU").ToString(), ClonedCustomerPrice.Name_ru, "None") });
                    else
                    {
                        if (string.IsNullOrEmpty(Name_ru))
                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogNameRU").ToString(), "None", UpdatedItem.Name_ru) });
                        else
                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogNameRU").ToString(), ClonedCustomerPrice.Name_ru, UpdatedItem.Name_ru) });
                    }
                }
                UpdatedItem.Name_zh = UpdatedItem.Name_zh.Trim();
                if (ClonedCustomerPrice.Name_zh != UpdatedItem.Name_zh)
                {
                    if (string.IsNullOrEmpty(UpdatedItem.Name_zh))
                        CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogNameZH").ToString(), ClonedCustomerPrice.Name_zh, "None") });
                    else
                    {
                        if (string.IsNullOrEmpty(ClonedCustomerPrice.Name_zh))
                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogNameZH").ToString(), "None", UpdatedItem.Name_zh) });
                        else
                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogNameZH").ToString(), ClonedCustomerPrice.Name_zh, UpdatedItem.Name_zh) });
                    }
                }

                //for Description
                UpdatedItem.Description = UpdatedItem.Description.Trim();
                if (ClonedCustomerPrice.Description != UpdatedItem.Description)
                {
                    if (string.IsNullOrEmpty(UpdatedItem.Description))
                        CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogDescription").ToString(), ClonedCustomerPrice.Description, "None") });
                    else
                    {
                        if (string.IsNullOrEmpty(ClonedCustomerPrice.Description))
                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogDescription").ToString(), "None", UpdatedItem.Description) });
                        else
                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogDescription").ToString(), ClonedCustomerPrice.Description, UpdatedItem.Description) });
                    }
                }
                UpdatedItem.Description_es = UpdatedItem.Description_es.Trim();
                if (ClonedCustomerPrice.Description_es != UpdatedItem.Description_es)
                {
                    if (string.IsNullOrEmpty(UpdatedItem.Description_es))
                        CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogDescriptionES").ToString(), ClonedCustomerPrice.Description_es, "None") });
                    else
                    {
                        if (string.IsNullOrEmpty(ClonedCustomerPrice.Description_es))
                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogDescriptionES").ToString(), "None", UpdatedItem.Description_es) });
                        else
                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogDescriptionES").ToString(), ClonedCustomerPrice.Description_es, UpdatedItem.Description_es) });
                    }
                }
                UpdatedItem.Description_fr = UpdatedItem.Description_fr.Trim();
                if (ClonedCustomerPrice.Description_fr != UpdatedItem.Description_fr)
                {
                    if (string.IsNullOrEmpty(UpdatedItem.Description_fr))
                        CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogDescriptionFR").ToString(), ClonedCustomerPrice.Description_es, "None") });
                    else
                    {
                        if (string.IsNullOrEmpty(ClonedCustomerPrice.Description_fr))
                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogDescriptionFR").ToString(), "None", UpdatedItem.Description_fr) });
                        else
                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogDescriptionFR").ToString(), ClonedCustomerPrice.Description_fr, UpdatedItem.Description_fr) });
                    }
                }
                UpdatedItem.Description_pt = UpdatedItem.Description_pt.Trim();
                if (ClonedCustomerPrice.Description_pt != UpdatedItem.Description_pt)
                {
                    if (string.IsNullOrEmpty(UpdatedItem.Description_pt))
                        CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("ProductTypeChangeLogDescriptionPT").ToString(), ClonedCustomerPrice.Description_pt, "None") });
                    else
                    {
                        if (string.IsNullOrEmpty(ClonedCustomerPrice.Description_pt))
                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogDescriptionPT").ToString(), "None", UpdatedItem.Description_pt) });
                        else
                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogDescriptionPT").ToString(), ClonedCustomerPrice.Description_pt, UpdatedItem.Description_pt) });
                    }
                }
                UpdatedItem.Description_ro = UpdatedItem.Description_ro.Trim();
                if (ClonedCustomerPrice.Description_ro != UpdatedItem.Description_ro)
                {
                    if (string.IsNullOrEmpty(UpdatedItem.Description_ro))
                        CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogDescriptionRO").ToString(), ClonedCustomerPrice.Description_ro, "None") });
                    else
                    {
                        if (string.IsNullOrEmpty(ClonedCustomerPrice.Description_ro))
                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogDescriptionRO").ToString(), "None", UpdatedItem.Description_ro) });
                        else
                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogDescriptionRO").ToString(), ClonedCustomerPrice.Description_ro, UpdatedItem.Description_ro) });
                    }
                }
                UpdatedItem.Description_ru = UpdatedItem.Description_ru.Trim();
                if (ClonedCustomerPrice.Description_ru != UpdatedItem.Description_ru)
                {
                    if (string.IsNullOrEmpty(UpdatedItem.Description_ru))
                        CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogDescriptionRU").ToString(), ClonedCustomerPrice.Description_ru, "None") });
                    else
                    {
                        if (string.IsNullOrEmpty(ClonedCustomerPrice.Description_ru))
                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogDescriptionRU").ToString(), "None", UpdatedItem.Description_ru) });
                        else
                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogDescriptionRU").ToString(), ClonedCustomerPrice.Description_ru, UpdatedItem.Description_ru) });
                    }
                }
                UpdatedItem.Description_zh = UpdatedItem.Description_zh.Trim();
                if (ClonedCustomerPrice.Description_zh != UpdatedItem.Description_zh)
                {
                    if (string.IsNullOrEmpty(UpdatedItem.Description_zh))
                        CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogDescriptionZH").ToString(), ClonedCustomerPrice.Description_ru, "None") });
                    else
                    {
                        if (string.IsNullOrEmpty(ClonedCustomerPrice.Description_zh))
                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogDescriptionZH").ToString(), "None", UpdatedItem.Description_zh) });
                        else
                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogDescriptionZH").ToString(), ClonedCustomerPrice.Description_zh, UpdatedItem.Description_zh) });
                    }
                }

                //for Remark
                UpdatedItem.Remark = UpdatedItem.Remark.Trim();
                if (ClonedCustomerPrice.Remark != UpdatedItem.Remark)
                {
                    if (string.IsNullOrEmpty(UpdatedItem.Remark))
                        CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogRemark").ToString(), ClonedCustomerPrice.Remark, "None") });
                    else
                    {
                        if (string.IsNullOrEmpty(ClonedCustomerPrice.Remark))
                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogRemark").ToString(), "None", UpdatedItem.Remark) });
                        else
                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogRemark").ToString(), ClonedCustomerPrice.Remark, UpdatedItem.Remark) });
                    }
                }
                UpdatedItem.Remark_es = UpdatedItem.Remark_es.Trim();
                if (ClonedCustomerPrice.Remark_es != UpdatedItem.Remark_es)
                {
                    if (string.IsNullOrEmpty(UpdatedItem.Remark_es))
                        CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogRemarkES").ToString(), ClonedCustomerPrice.Remark_es, "None") });
                    else
                    {
                        if (string.IsNullOrEmpty(ClonedCustomerPrice.Remark_es))
                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogRemarkES").ToString(), "None", UpdatedItem.Remark_es) });
                        else
                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogRemarkES").ToString(), ClonedCustomerPrice.Remark_es, UpdatedItem.Remark_es) });
                    }
                }
                UpdatedItem.Remark_fr = UpdatedItem.Remark_fr.Trim();
                if (ClonedCustomerPrice.Remark_fr != UpdatedItem.Remark_fr)
                {
                    if (string.IsNullOrEmpty(UpdatedItem.Remark_fr))
                        CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogRemarkFR").ToString(), ClonedCustomerPrice.Remark_fr, "None") });
                    else
                    {
                        if (string.IsNullOrEmpty(ClonedCustomerPrice.Remark_fr))
                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogRemarkFR").ToString(), "None", UpdatedItem.Remark_fr) });
                        else
                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogRemarkFR").ToString(), ClonedCustomerPrice.Remark_fr, UpdatedItem.Remark_fr) });
                    }
                }
                UpdatedItem.Remark_pt = UpdatedItem.Remark_pt.Trim();
                if (ClonedCustomerPrice.Remark_pt != UpdatedItem.Remark_pt)
                {
                    if (string.IsNullOrEmpty(UpdatedItem.Remark_pt))
                        CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogRemarkPT").ToString(), ClonedCustomerPrice.Remark_pt, "None") });
                    else
                    {
                        if (string.IsNullOrEmpty(ClonedCustomerPrice.Remark_pt))
                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogRemarkPT").ToString(), "None", UpdatedItem.Remark_pt) });
                        else
                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogRemarkPT").ToString(), ClonedCustomerPrice.Remark_pt, UpdatedItem.Remark_pt) });
                    }
                }
                UpdatedItem.Remark_ro = UpdatedItem.Remark_ro.Trim();
                if (ClonedCustomerPrice.Remark_ro != UpdatedItem.Remark_ro)
                {
                    if (string.IsNullOrEmpty(UpdatedItem.Remark_ro))
                        CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogRemarkRO").ToString(), ClonedCustomerPrice.Remark_ro, "None") });
                    else
                    {
                        if (string.IsNullOrEmpty(ClonedCustomerPrice.Remark_ro))
                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogRemarkRO").ToString(), "None", UpdatedItem.Remark_ro) });
                        else
                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogRemarkRO").ToString(), ClonedCustomerPrice.Remark_ro, UpdatedItem.Remark_ro) });
                    }
                }
                UpdatedItem.Remark_ru = UpdatedItem.Remark_ru.Trim();
                if (ClonedCustomerPrice.Remark_ru != UpdatedItem.Remark_ru)
                {
                    if (string.IsNullOrEmpty(UpdatedItem.Remark_ru))
                        CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogRemarkRU").ToString(), ClonedCustomerPrice.Remark_ru, "None") });
                    else
                    {
                        if (string.IsNullOrEmpty(ClonedCustomerPrice.Remark_ru))
                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogRemarkRU").ToString(), "None", UpdatedItem.Remark_ru) });
                        else
                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogRemarkRU").ToString(), ClonedCustomerPrice.Remark_ru, UpdatedItem.Remark_ru) });
                    }
                }
                UpdatedItem.Remark_zh = UpdatedItem.Remark_zh.Trim();
                if (ClonedCustomerPrice.Remark_zh != UpdatedItem.Remark_zh)
                {
                    if (string.IsNullOrEmpty(UpdatedItem.Remark_zh))
                        CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogRemarkZH").ToString(), ClonedCustomerPrice.Remark_zh, "None") });
                    else
                    {
                        if (string.IsNullOrEmpty(ClonedCustomerPrice.Remark_zh))
                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogRemarkZH").ToString(), "None", UpdatedItem.Remark_zh) });
                        else
                            CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogRemarkZH").ToString(), ClonedCustomerPrice.Remark_zh, UpdatedItem.Remark_zh) });
                    }
                }


                //for Effective Date
                if (ClonedCustomerPrice.EffectiveDate != UpdatedItem.EffectiveDate)
                {
                    CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogEffectiveDate").ToString(), ClonedCustomerPrice.EffectiveDate.ToShortDateString(), UpdatedItem.EffectiveDate.ToShortDateString()) });
                }

                //for  Expiry Date
                if (ClonedCustomerPrice.ExpiryDate != UpdatedItem.ExpiryDate)
                {
                    CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogExpiryDate").ToString(), ClonedCustomerPrice.ExpiryDate.ToShortDateString(), UpdatedItem.ExpiryDate.ToShortDateString()) });
                }

                //Status
                if (ClonedCustomerPrice.Status.IdLookupValue != UpdatedItem.IdStatus)
                {
                    LookupValue tempStatus = StatusList.FirstOrDefault(x => x.IdLookupValue == UpdatedItem.IdStatus);
                    if (tempStatus != null)
                        CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, UserName = GeosApplication.Instance.ActiveUser.FirstName + " " + GeosApplication.Instance.ActiveUser.LastName, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogStatus").ToString(), ClonedCustomerPrice.Status.Value, tempStatus.Value) });
                }


                //For currency
                if (ClonedCustomerPrice.IdBasePriceList != UpdatedItem.IdBasePriceList)
                {
                    string oldbasePrice = BasePriceNameList.FirstOrDefault(a => a.IdBasePriceList == ClonedCustomerPrice.IdBasePriceList).Name;
                    CustomerChangeLogList.Add(new CustomerPriceLogEntry() { IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser, Datetime = GeosApplication.Instance.ServerDateTime, Comments = string.Format(System.Windows.Application.Current.FindResource("EditCustomerPriceChangeLogBasePrice").ToString(), oldbasePrice, UpdatedItem.BasePriceName) });
                }

                GeosApplication.Instance.Logger.Log("Method AddChangedLogsDetails()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method AddChangedLogsDetails()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }

        }

        private void AllButtonClickAction(object obj)
        {
            try
            {
                if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }
                IsAll = true;
                TableView detailview = (TableView)obj;
                detailview.PageSize = DtArticle.Rows.Count;
                detailview.UpdateLayout();
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method AllButtonClickAction()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }

        }


        private void EditCustomerCommandAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method EditCustomerCommandAction()...", category: Category.Info, priority: Priority.Low);
                TableView detailView = (TableView)obj;
                CPLCustomer SelectedCustomer = (CPLCustomer)detailView.DataControl.CurrentItem;

                AddEditCPLCustomerView addEditCPLCustomerView = new AddEditCPLCustomerView();
                AddEditCPLCustomerViewModel addEditCPLCustomerViewModel = new AddEditCPLCustomerViewModel(obj);
                EventHandler handle = delegate { addEditCPLCustomerView.Close(); };
                addEditCPLCustomerViewModel.RequestClose += handle;
                addEditCPLCustomerViewModel.WindowHeader = System.Windows.Application.Current.FindResource("EditCPLCustomerHeader").ToString();
                addEditCPLCustomerViewModel.IsNew = false;

                addEditCPLCustomerViewModel.EditInit(SelectedCustomer);
                addEditCPLCustomerViewModel.CPLCustomerList = CPLCustomerList;
                addEditCPLCustomerView.DataContext = addEditCPLCustomerViewModel;
                addEditCPLCustomerView.ShowDialog();
                int count = 0;
                if (addEditCPLCustomerViewModel.IsSave == true)
                {

                    bool isupdatedRow = false;

                    if (SelectedCustomer.IdGroup == 0 && addEditCPLCustomerViewModel.SelectedGroup.IdGroup == 0)
                    {
                        #region 0 & 0
                        foreach (Site site in addEditCPLCustomerViewModel.SelectedPlant_Save)
                        {
                            if (site != null)
                            {
                                if (!CPLCustomerList.Any(ccl => ccl.IdGroup == 0 && ccl.IdPlant == site.IdSite))
                                {
                                    if (!isupdatedRow)
                                    {
                                        if (addEditCPLCustomerViewModel.IdCPLCustomer > 0)
                                            SelectedCustomer = CPLCustomerList.Where(ccl => ccl.IdCustomerPriceListCustomer == addEditCPLCustomerViewModel.IdCPLCustomer).FirstOrDefault();

                                        SelectedCustomer.IdGroup = site.IdGroup;
                                        SelectedCustomer.GroupName = "ALL";
                                        SelectedCustomer.IdRegion = site.IdRegion;
                                        SelectedCustomer.RegionName = site.RegionName;
                                        SelectedCustomer.IdCountry = site.IdCountry;
                                        SelectedCustomer.Country = new Country();
                                        SelectedCustomer.Country.Name = site.CountryName;
                                        SelectedCustomer.IdPlant = site.IdSite;
                                        SelectedCustomer.Plant = new Site();
                                        SelectedCustomer.Plant.Name = site.Name;
                                        isupdatedRow = true;
                                    }
                                    else
                                    {
                                        CPLCustomer customer = new CPLCustomer();
                                        customer.IdGroup = site.IdGroup;
                                        customer.GroupName = "ALL";
                                        customer.IdRegion = site.IdRegion;
                                        customer.RegionName = site.RegionName;
                                        customer.IdCountry = site.IdCountry;
                                        customer.Country = new Country();
                                        customer.Country.Name = site.CountryName;
                                        customer.IdPlant = site.IdSite;
                                        customer.Plant = new Site();
                                        customer.Plant.Name = site.Name;
                                        CPLCustomerList.Add(customer);
                                    }
                                }
                            }
                        }

                        foreach (Country country in addEditCPLCustomerViewModel.SelectedCountry_Save)
                        {
                            if (country != null)
                            {
                                if (!CPLCustomerList.Any(ccl => ccl.IdGroup == 0 && ccl.IdCountry == country.IdCountry && ccl.IdPlant == null))
                                {
                                    if (!isupdatedRow)
                                    {
                                        if (addEditCPLCustomerViewModel.IdCPLCustomer > 0)
                                            SelectedCustomer = CPLCustomerList.Where(ccl => ccl.IdCustomerPriceListCustomer == addEditCPLCustomerViewModel.IdCPLCustomer).FirstOrDefault();

                                        SelectedCustomer.IdGroup = (uint)addEditCPLCustomerViewModel.SelectedGroup.IdGroup;
                                        SelectedCustomer.GroupName = "ALL";
                                        SelectedCustomer.IdRegion = Convert.ToUInt32(country.IdRegion);
                                        SelectedCustomer.RegionName = addEditCPLCustomerViewModel.RegionList.Where(i => i.IdRegion == Convert.ToUInt32(country.IdRegion)).FirstOrDefault().RegionName;
                                        SelectedCustomer.IdCountry = country.IdCountry;
                                        SelectedCustomer.Country = new Country();
                                        SelectedCustomer.Country.Name = country.Name;
                                        SelectedCustomer.IdPlant = null;
                                        SelectedCustomer.Plant = new Site();
                                        SelectedCustomer.Plant.Name = "ALL";
                                        isupdatedRow = true;
                                    }
                                    else
                                    {
                                        if (addEditCPLCustomerViewModel.SelectedPlant_Save.FirstOrDefault() == null)
                                        {
                                            CPLCustomer customer = new CPLCustomer();
                                            customer.IdGroup = (uint)addEditCPLCustomerViewModel.SelectedGroup.IdGroup;
                                            customer.GroupName = "ALL";
                                            customer.IdRegion = Convert.ToUInt32(country.IdRegion);
                                            customer.RegionName = addEditCPLCustomerViewModel.RegionList.Where(i => i.IdRegion == Convert.ToUInt32(country.IdRegion)).FirstOrDefault().RegionName;
                                            customer.IdCountry = country.IdCountry;
                                            customer.Country = new Country();
                                            customer.Country.Name = country.Name;
                                            customer.IdPlant = null;
                                            customer.Plant = new Site();
                                            customer.Plant.Name = "ALL";
                                            CPLCustomerList.Add(customer);
                                        }
                                    }
                                }
                            }
                        }


                        foreach (Region region in addEditCPLCustomerViewModel.SelectedRegion_Save)
                        {
                            if (region != null)
                            {
                                if (!CPLCustomerList.Any(ccl => ccl.IdGroup == 0 && ccl.IdRegion == region.IdRegion && ccl.IdCountry == null && ccl.IdPlant == null))
                                {
                                    if (!isupdatedRow)
                                    {
                                        if (addEditCPLCustomerViewModel.IdCPLCustomer > 0)
                                            SelectedCustomer = CPLCustomerList.Where(ccl => ccl.IdCustomerPriceListCustomer == addEditCPLCustomerViewModel.IdCPLCustomer).FirstOrDefault();

                                        SelectedCustomer.IdGroup = (uint)addEditCPLCustomerViewModel.SelectedGroup.IdGroup;
                                        SelectedCustomer.GroupName = "ALL";
                                        SelectedCustomer.IdRegion = Convert.ToUInt32(region.IdRegion);
                                        SelectedCustomer.RegionName = region.RegionName;
                                        SelectedCustomer.IdCountry = null;
                                        SelectedCustomer.Country = new Country();
                                        SelectedCustomer.Country.Name = "ALL";
                                        SelectedCustomer.IdPlant = null;
                                        SelectedCustomer.Plant = new Site();
                                        SelectedCustomer.Plant.Name = "ALL";
                                        isupdatedRow = true;
                                    }
                                    else
                                    {
                                        if (addEditCPLCustomerViewModel.SelectedCountry_Save.FirstOrDefault() == null && addEditCPLCustomerViewModel.SelectedPlant_Save.FirstOrDefault() == null)
                                        {
                                            CPLCustomer customer = new CPLCustomer();
                                            customer.IdGroup = (uint)addEditCPLCustomerViewModel.SelectedGroup.IdGroup;
                                            customer.GroupName = "ALL";
                                            customer.IdRegion = Convert.ToUInt32(region.IdRegion);
                                            customer.RegionName = region.RegionName;
                                            customer.IdCountry = null;
                                            customer.Country = new Country();
                                            customer.Country.Name = "ALL";
                                            customer.IdPlant = null;
                                            customer.Plant = new Site();
                                            customer.Plant.Name = "ALL";
                                            CPLCustomerList.Add(customer);
                                        }
                                    }
                                }
                            }
                        }

                        #endregion
                    }
                    else
                    {
                        foreach (Site site in addEditCPLCustomerViewModel.SelectedPlant_Save)
                        {
                            if (site != null)
                            {
                                if (!CPLCustomerList.Any(ccl => ccl.IdGroup == 0 && ccl.IdPlant == site.IdSite))
                                {
                                    if (!isupdatedRow)
                                    {
                                        if (addEditCPLCustomerViewModel.IdCPLCustomer > 0)
                                            SelectedCustomer = CPLCustomerList.Where(ccl => ccl.IdCustomerPriceListCustomer == addEditCPLCustomerViewModel.IdCPLCustomer).FirstOrDefault();
                                        SelectedCustomer.IdGroup = site.IdGroup;

                                        if (string.IsNullOrEmpty(site.GroupName) || site.GroupName == "")
                                            SelectedCustomer.GroupName = "ALL";
                                        else
                                            SelectedCustomer.GroupName = site.GroupName;

                                        SelectedCustomer.IdRegion = site.IdRegion;
                                        SelectedCustomer.RegionName = site.RegionName;
                                        SelectedCustomer.IdCountry = site.IdCountry;
                                        SelectedCustomer.Country = new Country();
                                        SelectedCustomer.Country.Name = site.CountryName;
                                        SelectedCustomer.IdPlant = site.IdSite;
                                        SelectedCustomer.Plant = new Site();
                                        SelectedCustomer.Plant.Name = site.Name;
                                        isupdatedRow = true;
                                    }
                                    else
                                    {
                                        CPLCustomer customer = new CPLCustomer();
                                        customer.IdGroup = site.IdGroup;

                                        if (string.IsNullOrEmpty(site.GroupName) || site.GroupName == "")
                                            customer.GroupName = "ALL";
                                        else
                                            customer.GroupName = site.GroupName;

                                        customer.IdRegion = site.IdRegion;
                                        customer.RegionName = site.RegionName;
                                        customer.IdCountry = site.IdCountry;
                                        customer.Country = new Country();
                                        customer.Country.Name = site.CountryName;
                                        customer.IdPlant = site.IdSite;
                                        customer.Plant = new Site();
                                        customer.Plant.Name = site.Name;
                                        CPLCustomerList.Add(customer);
                                    }
                                }
                            }
                        }

                        foreach (Country country in addEditCPLCustomerViewModel.SelectedCountry_Save)
                        {
                            if (country != null)
                            {
                                if (!CPLCustomerList.Any(ccl => ccl.IdGroup == (uint)addEditCPLCustomerViewModel.SelectedGroup.IdGroup && ccl.IdCountry == country.IdCountry && ccl.IdPlant == null))
                                {
                                    if (!isupdatedRow)
                                    {
                                        if (addEditCPLCustomerViewModel.IdCPLCustomer > 0)
                                            SelectedCustomer = CPLCustomerList.Where(ccl => ccl.IdCustomerPriceListCustomer == addEditCPLCustomerViewModel.IdCPLCustomer).FirstOrDefault();

                                        SelectedCustomer.IdGroup = (uint)addEditCPLCustomerViewModel.SelectedGroup.IdGroup;

                                        if (string.IsNullOrEmpty(addEditCPLCustomerViewModel.SelectedGroup.GroupName) || addEditCPLCustomerViewModel.SelectedGroup.GroupName == "")
                                            SelectedCustomer.GroupName = "ALL";
                                        else
                                            SelectedCustomer.GroupName = addEditCPLCustomerViewModel.SelectedGroup.GroupName;

                                        SelectedCustomer.IdRegion = Convert.ToUInt32(country.IdRegion);
                                        SelectedCustomer.RegionName = addEditCPLCustomerViewModel.RegionList.Where(i => i.IdRegion == Convert.ToUInt32(country.IdRegion)).FirstOrDefault().RegionName;
                                        SelectedCustomer.IdCountry = country.IdCountry;
                                        SelectedCustomer.Country = new Country();
                                        SelectedCustomer.Country.Name = country.Name;
                                        SelectedCustomer.IdPlant = null;
                                        SelectedCustomer.Plant = new Site();
                                        SelectedCustomer.Plant.Name = "ALL";
                                        isupdatedRow = true;
                                    }
                                    else
                                    {
                                        if (addEditCPLCustomerViewModel.SelectedPlant_Save.FirstOrDefault() == null)
                                        {
                                            CPLCustomer customer = new CPLCustomer();
                                            customer.IdGroup = (uint)addEditCPLCustomerViewModel.SelectedGroup.IdGroup;

                                            if (string.IsNullOrEmpty(addEditCPLCustomerViewModel.SelectedGroup.GroupName) || addEditCPLCustomerViewModel.SelectedGroup.GroupName == "")
                                                customer.GroupName = "ALL";
                                            else
                                                customer.GroupName = addEditCPLCustomerViewModel.SelectedGroup.GroupName;

                                            customer.IdRegion = Convert.ToUInt32(country.IdRegion);
                                            customer.RegionName = addEditCPLCustomerViewModel.RegionList.Where(i => i.IdRegion == Convert.ToUInt32(country.IdRegion)).FirstOrDefault().RegionName;
                                            customer.IdCountry = country.IdCountry;
                                            customer.Country = new Country();
                                            customer.Country.Name = country.Name;
                                            customer.IdPlant = null;
                                            customer.Plant = new Site();
                                            customer.Plant.Name = "ALL";
                                            CPLCustomerList.Add(customer);
                                        }
                                    }
                                }
                            }
                        }

                        foreach (Region region in addEditCPLCustomerViewModel.SelectedRegion_Save)
                        {
                            if (region != null)
                            {
                                if (!CPLCustomerList.Any(ccl => ccl.IdGroup == (uint)addEditCPLCustomerViewModel.SelectedGroup.IdGroup && ccl.IdRegion == region.IdRegion && ccl.IdCountry == null && ccl.IdPlant == null))
                                {
                                    if (!isupdatedRow)
                                    {
                                        if (addEditCPLCustomerViewModel.IdCPLCustomer > 0)
                                            SelectedCustomer = CPLCustomerList.Where(ccl => ccl.IdCustomerPriceListCustomer == addEditCPLCustomerViewModel.IdCPLCustomer).FirstOrDefault();

                                        SelectedCustomer.IdGroup = (uint)addEditCPLCustomerViewModel.SelectedGroup.IdGroup;

                                        if (string.IsNullOrEmpty(addEditCPLCustomerViewModel.SelectedGroup.GroupName) || addEditCPLCustomerViewModel.SelectedGroup.GroupName == "")
                                            SelectedCustomer.GroupName = "ALL";
                                        else
                                            SelectedCustomer.GroupName = addEditCPLCustomerViewModel.SelectedGroup.GroupName;

                                        SelectedCustomer.IdRegion = Convert.ToUInt32(region.IdRegion);
                                        SelectedCustomer.RegionName = region.RegionName;
                                        SelectedCustomer.IdCountry = null;
                                        SelectedCustomer.Country = new Country();
                                        SelectedCustomer.Country.Name = "ALL";
                                        SelectedCustomer.IdPlant = null;
                                        SelectedCustomer.Plant = new Site();
                                        SelectedCustomer.Plant.Name = "ALL";
                                        isupdatedRow = true;
                                    }
                                    else
                                    {
                                        if (addEditCPLCustomerViewModel.SelectedCountry_Save.FirstOrDefault() == null && addEditCPLCustomerViewModel.SelectedPlant_Save.FirstOrDefault() == null)
                                        {
                                            CPLCustomer customer = new CPLCustomer();
                                            customer.IdGroup = (uint)addEditCPLCustomerViewModel.SelectedGroup.IdGroup;

                                            if (string.IsNullOrEmpty(addEditCPLCustomerViewModel.SelectedGroup.GroupName) || addEditCPLCustomerViewModel.SelectedGroup.GroupName == "")
                                                customer.GroupName = "ALL";
                                            else
                                                customer.GroupName = addEditCPLCustomerViewModel.SelectedGroup.GroupName;

                                            customer.IdRegion = Convert.ToUInt32(region.IdRegion);
                                            customer.RegionName = region.RegionName;
                                            customer.IdCountry = null;
                                            customer.Country = new Country();
                                            customer.Country.Name = "ALL";
                                            customer.IdPlant = null;
                                            customer.Plant = new Site();
                                            customer.Plant.Name = "ALL";
                                            CPLCustomerList.Add(customer);
                                        }
                                    }
                                }
                            }
                        }
                    }
                    CPLCustomerList = new List<CPLCustomer>(CPLCustomerList.OrderBy(a => a.GroupName));

                    List<CPLCustomer> IsCheckedList = CPLCustomerList.ToList();

                    Group = (from x in IsCheckedList select x.GroupName).Distinct().Count();
                    Region = (from x in IsCheckedList select x.RegionName).Distinct().Count();
                    Country = (from x in IsCheckedList select x.Country.Name).Distinct().Count();
                    Plant = (from x in IsCheckedList select x.Plant.Name).Distinct().Count();

                    Groups = String.Join(", ", IsCheckedList.Select(a => a.GroupName).Distinct());
                    Regions = String.Join(", ", IsCheckedList.Select(a => a.RegionName).Distinct());
                    Countries = String.Join(", ", IsCheckedList.Select(a => a.Country.Name).Distinct());
                    Plants = String.Join(", ", IsCheckedList.Select(a => a.Plant.Name).Distinct());


                    if (addEditCPLCustomerViewModel.IdCPLCustomer > 0)
                    {
                        CPLCustomer customer_old = ClonedCustomerPrice.CustomerList.FirstOrDefault(a => a.IdCustomerPriceListCustomer == addEditCPLCustomerViewModel.IdCPLCustomer);
                        if ((SelectedCustomer.IdGroup != customer_old.IdGroup) || (SelectedCustomer.IdRegion != customer_old.IdRegion) || (SelectedCustomer.IdCountry != customer_old.IdCountry) || (SelectedCustomer.IdPlant != customer_old.IdPlant))
                        {
                            IsExportVisible = Visibility.Collapsed;
                        }
                    }
                    IsEnabledSaveButton = true;
                }

                GeosApplication.Instance.Logger.Log("Method EditCustomerCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method EditCustomerCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void AddCustomerCommandAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method AddCustomerCommandAction()...", category: Category.Info, priority: Priority.Low);

                AddEditCPLCustomerView addEditCPLCustomerView = new AddEditCPLCustomerView();
                AddEditCPLCustomerViewModel addEditCPLCustomerViewModel = new AddEditCPLCustomerViewModel(obj);
                EventHandler handle = delegate { addEditCPLCustomerView.Close(); };
                addEditCPLCustomerViewModel.RequestClose += handle;
                addEditCPLCustomerViewModel.WindowHeader = System.Windows.Application.Current.FindResource("AddCPLCustomerHeader").ToString();

                addEditCPLCustomerViewModel.IsNew = true;

                if (CPLCustomerList == null)
                    CPLCustomerList = new List<CPLCustomer>();

                addEditCPLCustomerViewModel.CPLCustomerList = CPLCustomerList;
                addEditCPLCustomerView.DataContext = addEditCPLCustomerViewModel;
                addEditCPLCustomerView.ShowDialog();

                if (addEditCPLCustomerViewModel.IsSave == true)
                {
                    if (addEditCPLCustomerViewModel.SelectedGroup.IdGroup == 0)
                    {
                        foreach (Site site in addEditCPLCustomerViewModel.SelectedPlant_Save)
                        {
                            if (site != null)
                            {
                                if (!CPLCustomerList.Any(ccl => ccl.IdGroup == 0 && ccl.IdPlant == site.IdSite))
                                {
                                    CPLCustomer customer = new CPLCustomer();
                                    customer.IdGroup = site.IdGroup;
                                    customer.GroupName = "ALL";
                                    customer.IdRegion = site.IdRegion;
                                    customer.RegionName = site.RegionName;
                                    customer.IdCountry = site.IdCountry;
                                    customer.Country = new Country();
                                    customer.Country.Name = site.CountryName;
                                    customer.IdPlant = site.IdSite;
                                    customer.Plant = new Site();
                                    customer.Plant.Name = site.Name;
                                    CPLCustomerList.Add(customer);
                                }
                            }
                        }

                        if (addEditCPLCustomerViewModel.SelectedPlant_Save.FirstOrDefault() == null)
                        {

                            foreach (Country country in addEditCPLCustomerViewModel.SelectedCountry_Save)
                            {
                                if (country != null)
                                {
                                    foreach (Region region in addEditCPLCustomerViewModel.SelectedRegion_Save)
                                    {
                                        if (region != null)
                                        {
                                            if (!CPLCustomerList.Any(ccl => ccl.IdGroup == 0 && ccl.IdRegion == addEditCPLCustomerViewModel.RegionList.Where(i => i.IdRegion == Convert.ToUInt32(country.IdRegion)).FirstOrDefault().IdRegion && ccl.IdCountry == country.IdCountry))
                                            {
                                                CPLCustomer customer = new CPLCustomer();
                                                customer.IdGroup = (uint)addEditCPLCustomerViewModel.SelectedGroup.IdGroup;
                                                customer.GroupName = "ALL";
                                                customer.IdRegion = Convert.ToUInt32(country.IdRegion);
                                                customer.RegionName = addEditCPLCustomerViewModel.RegionList.Where(i => i.IdRegion == Convert.ToUInt32(country.IdRegion)).FirstOrDefault().RegionName;
                                                customer.IdCountry = country.IdCountry;
                                                customer.Country = new Country();
                                                customer.Country.Name = country.Name;
                                                customer.IdPlant = null;
                                                customer.Plant = new Site();
                                                customer.Plant.Name = "ALL";
                                                CPLCustomerList.Add(customer);
                                            }
                                        }
                                    }
                                }
                            }


                            foreach (Region region in addEditCPLCustomerViewModel.SelectedRegion_Save)
                            {
                                if (region != null)
                                {
                                    if (!CPLCustomerList.Any(ccl => ccl.IdGroup == 0 && ccl.IdRegion == region.IdRegion))
                                    {
                                        CPLCustomer customer = new CPLCustomer();
                                        customer.IdGroup = (uint)addEditCPLCustomerViewModel.SelectedGroup.IdGroup;
                                        customer.GroupName = "ALL";
                                        customer.IdRegion = Convert.ToUInt32(region.IdRegion);
                                        customer.RegionName = region.RegionName;
                                        customer.IdCountry = null;
                                        customer.Country = new Country();
                                        customer.Country.Name = "ALL";
                                        customer.IdPlant = null;
                                        customer.Plant = new Site();
                                        customer.Plant.Name = "ALL";
                                        CPLCustomerList.Add(customer);
                                    }
                                }
                            }
                        }
                    }
                    else
                    {
                        foreach (Site site in addEditCPLCustomerViewModel.SelectedPlant_Save)
                        {
                            if (site != null)
                            {
                                if (!CPLCustomerList.Any(ccl => ccl.IdPlant == site.IdSite))
                                {
                                    CPLCustomer customer = new CPLCustomer();
                                    customer.IdGroup = site.IdGroup;
                                    customer.GroupName = site.GroupName;
                                    customer.IdRegion = site.IdRegion;
                                    customer.RegionName = site.RegionName;
                                    customer.IdCountry = site.IdCountry;
                                    customer.Country = new Country();
                                    customer.Country.Name = site.CountryName;
                                    customer.IdPlant = site.IdSite;
                                    customer.Plant = new Site();
                                    customer.Plant.Name = site.Name;
                                    CPLCustomerList.Add(customer);
                                }
                            }

                        }
                        if (addEditCPLCustomerViewModel.SelectedPlant_Save.FirstOrDefault() == null)
                        {
                            foreach (Country country in addEditCPLCustomerViewModel.SelectedCountry_Save)
                            {
                                if (country != null)
                                {
                                    if (!CPLCustomerList.Any(ccl => ccl.IdGroup == (uint)addEditCPLCustomerViewModel.SelectedGroup.IdGroup && ccl.IdCountry == country.IdCountry))
                                    {
                                        CPLCustomer customer = new CPLCustomer();
                                        customer.IdGroup = (uint)addEditCPLCustomerViewModel.SelectedGroup.IdGroup;
                                        customer.GroupName = addEditCPLCustomerViewModel.SelectedGroup.GroupName;
                                        customer.IdRegion = Convert.ToUInt32(country.IdRegion);
                                        customer.RegionName = addEditCPLCustomerViewModel.RegionList.Where(i => i.IdRegion == Convert.ToUInt32(country.IdRegion)).FirstOrDefault().RegionName;
                                        customer.IdCountry = country.IdCountry;
                                        customer.Country = new Country();
                                        customer.Country.Name = country.Name;
                                        customer.IdPlant = null;
                                        customer.Plant = new Site();
                                        customer.Plant.Name = "ALL";
                                        CPLCustomerList.Add(customer);
                                    }
                                }
                            }

                            foreach (Region region in addEditCPLCustomerViewModel.SelectedRegion_Save)
                            {
                                if (region != null)
                                {
                                    if (!CPLCustomerList.Any(ccl => ccl.IdGroup == (uint)addEditCPLCustomerViewModel.SelectedGroup.IdGroup && ccl.IdRegion == region.IdRegion))
                                    {
                                        CPLCustomer customer = new CPLCustomer();
                                        customer.IdGroup = (uint)addEditCPLCustomerViewModel.SelectedGroup.IdGroup;
                                        customer.GroupName = addEditCPLCustomerViewModel.SelectedGroup.GroupName;
                                        customer.IdRegion = Convert.ToUInt32(region.IdRegion);
                                        customer.RegionName = region.RegionName;
                                        customer.IdCountry = null;
                                        customer.Country = new Country();
                                        customer.Country.Name = "ALL";
                                        customer.IdPlant = null;
                                        customer.Plant = new Site();
                                        customer.Plant.Name = "ALL";
                                        CPLCustomerList.Add(customer);
                                    }
                                }
                                else
                                {
                                    CPLCustomer customer = new CPLCustomer();
                                    customer.IdGroup = (uint)addEditCPLCustomerViewModel.SelectedGroup.IdGroup;
                                    customer.GroupName = addEditCPLCustomerViewModel.SelectedGroup.GroupName;
                                    customer.IdRegion = null;
                                    customer.RegionName = "ALL";
                                    customer.IdCountry = null;
                                    customer.Country = new Country();
                                    customer.Country.Name = "ALL";
                                    customer.IdPlant = null;
                                    customer.Plant = new Site();
                                    customer.Plant.Name = "ALL";
                                    CPLCustomerList.Add(customer);
                                }
                            }
                        }

                    }

                    CPLCustomerList = new List<CPLCustomer>(CPLCustomerList.OrderBy(a => a.GroupName));

                    List<CPLCustomer> IsCheckedList = CPLCustomerList.ToList();

                    Group = (from x in IsCheckedList select x.GroupName).Distinct().Count();
                    Region = (from x in IsCheckedList select x.RegionName).Distinct().Count();
                    Country = (from x in IsCheckedList select x.Country.Name).Distinct().Count();
                    Plant = (from x in IsCheckedList select x.Plant.Name).Distinct().Count();

                    Groups = String.Join(", ", IsCheckedList.Select(a => a.GroupName).Distinct());
                    Regions = String.Join(", ", IsCheckedList.Select(a => a.RegionName).Distinct());
                    Countries = String.Join(", ", IsCheckedList.Select(a => a.Country.Name).Distinct());
                    Plants = String.Join(", ", IsCheckedList.Select(a => a.Plant.Name).Distinct());

                    IsExportVisible = Visibility.Collapsed;
                    IsEnabledSaveButton = true;
                }
                GeosApplication.Instance.Logger.Log("Method AddCustomerCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method AddCustomerCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void DeleteCustomerCommandAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method DeleteCustomerCommandAction()...", category: Category.Info, priority: Priority.Low);
                MessageBoxResult MessageBoxResult = CustomMessageBox.Show(Application.Current.Resources["DeleteCPLCustomer"].ToString(), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);

                CPLCustomer SelectedCustomer = (CPLCustomer)obj;
                if (MessageBoxResult == MessageBoxResult.Yes)
                {
                    CPLCustomerList.Remove(SelectedCustomer);
                    CPLCustomerList = new List<CPLCustomer>(CPLCustomerList.OrderBy(a => a.GroupName));
                    SelectedCustomer = CPLCustomerList.FirstOrDefault();

                    List<CPLCustomer> IsCheckedList = CPLCustomerList.ToList();

                    Group = (from x in IsCheckedList select x.GroupName).Distinct().Count();
                    Region = (from x in IsCheckedList select x.RegionName).Distinct().Count();
                    Country = (from x in IsCheckedList select x.Country.Name).Distinct().Count();
                    Plant = (from x in IsCheckedList select x.Plant.Name).Distinct().Count();

                    Groups = String.Join(", ", IsCheckedList.Select(a => a.GroupName).Distinct());
                    Regions = String.Join(", ", IsCheckedList.Select(a => a.RegionName).Distinct());
                    Countries = String.Join(", ", IsCheckedList.Select(a => a.Country.Name).Distinct());
                    Plants = String.Join(", ", IsCheckedList.Select(a => a.Plant.Name).Distinct());

                    IsExportVisible = Visibility.Collapsed;
                    IsEnabledSaveButton = true;
                }

                GeosApplication.Instance.Logger.Log("Method DeleteCustomerCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method DeleteCustomerCommandAction()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
		//[nsatpute][28.05.2025][GEOS2-6689]
        private void GetCPLCustomerAll()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method GetCPLCustomerAll()...", category: Category.Info, priority: Priority.Low);
                IPLMService PLMServiceLocalThread = new PLMServiceController(GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString());
                CPLCustomersAll = new List<CPLCustomer>(PLMServiceLocalThread.GetCPLCustomers());
                GeosApplication.Instance.Logger.Log("Method GetCPLCustomerAll()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (FaultException<ServiceException> ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in GetCPLCustomerAll() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in GetCPLCustomerAll() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method GetCPLCustomerAll() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void ShowBasePriceFilterValue(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ShowBasePriceFilterValue()...", category: Category.Info, priority: Priority.Low);
                if (DtArticleCopy == null)
                    DtArticleCopy = new DataTable();
                if (DtArticleCopy.Rows.Count > 0)
                {
                    if (IsCheckedBasePrice == false && IsCheckedCustomerPrice == false)
                    {
                        MyFilterString = "[Logic] <> ('0')";
                        IsCheckedCustomerPrice = true;
                    }
                    else
                    {
                        FilterBPLAndCPL();
                    }
                }

                if (DtDetectionCopy == null)
                    DtDetectionCopy = new DataTable();

                if (DtDetectionCopy.Rows.Count > 0)
                {
                    if (IsCheckedBasePrice == false && IsCheckedCustomerPrice == false)
                    {
                        MyFilterString = "[Logic] <> ('0')";
                        IsCheckedCustomerPrice = true;
                    }
                    else
                    {
                        FilterBPLAndCPL();
                    }
                }


                GeosApplication.Instance.Logger.Log("Method ShowBasePriceFilterValue()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method ShowBasePriceFilterValue() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void ShowCustomerPriceFilterValue(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ShowCustomerPriceFilterValue()...", category: Category.Info, priority: Priority.Low);

                if (DtArticleCopy == null)
                    DtArticleCopy = new DataTable();
                if (DtArticleCopy.Rows.Count > 0)
                {
                    if (IsCheckedBasePrice == false && IsCheckedCustomerPrice == false)
                    {
                        MyFilterString = "[Logic] In ('0')";
                        IsCheckedBasePrice = true;
                    }
                    else
                    {
                        FilterBPLAndCPL();
                    }
                }

                if (DtDetectionCopy == null)
                    DtDetectionCopy = new DataTable();

                if (DtDetectionCopy.Rows.Count > 0)
                {
                    if (IsCheckedBasePrice == false && IsCheckedCustomerPrice == false)
                    {
                        MyFilterString = "[Logic] In ('0')";
                        IsCheckedBasePrice = true;
                    }
                    else
                    {
                        FilterBPLAndCPL();
                    }
                }

                GeosApplication.Instance.Logger.Log("Method ShowCustomerPriceFilterValue()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method ShowCustomerPriceFilterValue() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void FilterBPLAndCPL()
        {
            if (IsCheckedBasePrice == true && IsCheckedCustomerPrice == true)
            {
                MyFilterString = string.Empty;
            }
            else if (IsCheckedBasePrice == true && IsCheckedCustomerPrice == false)
            {
                MyFilterString = "[Logic] In ('0')";
            }
            else if (IsCheckedBasePrice == false && IsCheckedCustomerPrice == true)
            {
                MyFilterString = "[Logic] <> ('0')";
            }
        }

        private void OnDragRecordOverDetectionGrid(DragRecordOverEventArgs e)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method OnDragRecordOverDetectionGrid()...", category: Category.Info, priority: Priority.Low);
                if ((e.IsFromOutside) && typeof(BPLDetection).IsAssignableFrom(e.GetRecordType()))
                {
                    var data = (RecordDragDropData)e.Data.GetData(typeof(RecordDragDropData));
                    List<BPLDetection> record = data.Records.OfType<BPLDetection>().ToList();
                    int count = 0;
                    foreach (BPLDetection detection in record.Where(a => a.IdDetection > 0))
                    {
                        DataRow[] found = DtDetectionCopy.Select("IdDetection = '" + detection.IdDetection + "'");
                        if (found.Length == 0)
                        {
                            count++;
                        }
                    }
                    if (count > 0)
                    {
                        e.Effects = DragDropEffects.Copy;
                        e.Handled = true;
                    }
                    else
                    {
                        e.Effects = DragDropEffects.None;
                        e.Handled = false;
                    }

                }
                GeosApplication.Instance.Logger.Log("Method OnDragRecordOverDetectionGrid()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method OnDragRecordOverDetectionGrid() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        //[cpatil][001][25-02-2022][GEOS2-3564]
        private void DropRecordDetectionGrid(DropRecordEventArgs e)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method DropRecordDetectionGrid()...", category: Category.Info, priority: Priority.Low);

                double SellPriceValue = 0.00;

                if ((e.IsFromOutside) && typeof(BPLDetection).IsAssignableFrom(e.GetRecordType()))
                {
                    var data = (RecordDragDropData)e.Data.GetData(typeof(RecordDragDropData));
                    List<BPLDetection> records = data.Records.OfType<BPLDetection>().ToList();
                    foreach (BPLDetection record in records.Where(a => a.IdDetection > 0))
                    {
                        if (DtDetectionCopy == null)
                            DtDetectionCopy = new DataTable();
                        DataRow[] found = DtDetectionCopy.Select("IdDetection = '" + record.IdDetection + "'");
                        if (found.Length == 0)
                        {
                            IsCalculateArticleCostButtonEnabled = true;
                            IsCalculated = false;
                            if (DtDetectionCopy == null)
                                DtDetectionCopy = new DataTable();
                            DataRow dr = DtDetectionCopy.NewRow();
                            dr["IsChecked"] = false;
                            if (string.IsNullOrEmpty(record.KeyName)) //[001]
                                dr["Code"] = "---";
                            else
                                dr["Code"] = record.KeyName;
                            // dr["Code"] = record.KeyName;
                            record.Description = record.Description.Trim('\n');
                            dr["Name"] = record.Name;
                            dr["IdDetection"] = record.IdDetection;
                            dr["Type"] = record.IdDetectionType;
                            dr["Logic"] = 308;

                            dr["Name_Old"] = record.Description;
                            dr["Name_Changed"] = false;
                            dr["NameChanged"] = "Linked Description";
                            dr["Visible_Customer"] = true;
                            dr["VisibleCustomer"] = "Visible";


                            double Cost_Value = 0;
                            dr["MaxCost_1"] = DBNull.Value;

                            if (CurrencyList.Count > 0)
                            {
                                if (!CurrencyList.Any(x => x.IdCurrency == ((Currency)SelectedCurrency).IdCurrency))
                                    SellPriceValue = 0.00;
                                else
                                    SellPriceValue = Convert.ToDouble(CurrencyList.Where(x => x.IdCurrency == ((Currency)SelectedCurrency).IdCurrency).Select(x => x.SellPriceValue).FirstOrDefault());
                            }

                            dr["Profit"] = CalculateCustomerPriceProfitValue(Cost_Value, SellPriceValue);
                            dr["CostMargin"] = CalculateCustomerPriceCostMarginValue(Cost_Value, SellPriceValue);
                            if (dr["CurrencyConversionDate"] != DBNull.Value)
                            {
                                //[rdixit][13.03.2023][GEOS2-3177]
                                if (SelectedExchangeRate != null)
                                {
                                    if (SelectedExchangeRate.IdLookupValue == 1509)
                                    {
                                        dr["SaleCurrencyConversionDate"] = "Updated currency rate on : " + DateTime.Now.ToString("dd/MM/yyyy");
                                    }
                                    else
                                    {
                                        dr["SaleCurrencyConversionDate"] = "Updated currency rate on : " + Convert.ToDateTime(dr["CurrencyConversionDate"]).ToString("dd/MM/yyyy");
                                    }
                                }
                                else
                                {
                                    dr["SaleCurrencyConversionDate"] = "Updated currency rate on : " + Convert.ToDateTime(dr["CurrencyConversionDate"]).ToString("dd/MM/yyyy");
                                }
                            }
                            DtDetectionCopy.Rows.Add(dr);
                            DtDetection = DtDetectionCopy;
                            e.Handled = true;
                        }
                    }
                    FilterBPLAndCPL();
                }
                GeosApplication.Instance.Logger.Log("Method DropRecordDetectionGrid()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method DropRecordDetectionGrid() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void CompleteRecordDragDropDetectionGrid(CompleteRecordDragDropEventArgs e)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method CompleteRecordDragDropDetectionGrid()...", category: Category.Info, priority: Priority.Low);

                e.Handled = true;

                GeosApplication.Instance.Logger.Log("Method CompleteRecordDragDropDetectionGrid()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method CompleteRecordDragDropDetectionGrid() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void DeleteDetectionCommandAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method DeleteDetectionCommandAction()...", category: Category.Info, priority: Priority.Low);
                DataColumn[] columns = DtDetectionCopy.Columns.Cast<DataColumn>().ToArray();
                DataRow[] foundChecked = DtDetectionCopy.AsEnumerable().Where(row => columns.Any(col => row["IsChecked"].ToString() == "True")).ToArray();
                DataRow MainRow = ((System.Data.DataRowView)obj).Row;

                //if (ClonedCustomerPrice != null && ClonedCustomerPrice.IdStatus == 224)
                //[Sudhir.Jangra][GEOS2-3349][27/12/2022]
                if (ClonedCustomerPrice != null && isDuplicateClicked == false && ClonedCustomerPrice.IdStatus == 224)
                {
                    CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("CantChangeCPLValidation").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                    return;
                }

                if (DeleteDetections == null)
                    DeleteDetections = new List<Detections>();

                if (foundChecked.Length > 0 && MainRow["IsChecked"].ToString() != "False")
                {
                    MessageBoxResult MessageBoxResult = CustomMessageBox.Show(Application.Current.Resources["DeleteBPLDetectionMessage"].ToString(), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                    if (MessageBoxResult == MessageBoxResult.Yes)
                    {
                        if (foundChecked.Length > 0)
                        {
                            foreach (DataRow dr in foundChecked)
                            {
                                Detections det = new Detections();
                                det.IdDetections = (uint)dr["IdDetection"];
                                DeleteDetections.Add(det);
                                DtDetectionCopy.Rows.Remove(dr);
                            }
                        }
                        DtDetection = DtDetectionCopy;
                        IsEnabledSaveButton = true;
                    }
                }
                else
                {
                    MessageBoxResult MessageBoxResult = CustomMessageBox.Show(Application.Current.Resources["DeleteBPLDetectionMessageSelected"].ToString(), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                    if (MessageBoxResult == MessageBoxResult.Yes)
                    {
                        if (obj != null)
                        {
                            Detections det = new Detections();
                            det.IdDetections = (uint)MainRow["IdDetection"];
                            DeleteDetections.Add(det);
                            DtDetectionCopy.Rows.Remove(((System.Data.DataRowView)obj).Row);
                        }
                        DtDetection = DtDetectionCopy;
                        IsEnabledSaveButton = true;
                    }
                }

                GeosApplication.Instance.Logger.Log("Method DeleteDetectionCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method DeleteDetectionCommandAction()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }


        private void ShowingEditorCommandAction(object e)
        {
            try
            {
                GridColumn col = (GridColumn)((DevExpress.Xpf.Grid.EditorEventArgsBase)e).Column;
                if (col.FieldName == "IsChecked")
                {
                    DataRow row = ((System.Data.DataRowView)((DevExpress.Xpf.Grid.ShowingEditorEventArgs)e).Row).Row;
                    if (row["IsChecked"] != DBNull.Value && Convert.ToBoolean(row["IsChecked"]) == false)
                        row["IsChecked"] = true;
                    else
                        row["IsChecked"] = false;
                }
                else if (col.FieldName == "Name")
                {
                    DataRow row = ((System.Data.DataRowView)((DevExpress.Xpf.Grid.ShowingEditorEventArgs)e).Row).Row;
                    if (row["Name_Changed"] != DBNull.Value && Convert.ToBoolean(row["Name_Changed"]) == true)
                    {
                        row["IsUpdatedRow"] = true;
                        var currentName = row["Name"];
                        if (isArticleGrid)
                        {
                            if (!currentName.Equals(oldArticleNameGrid))
                                oldArticleNameGrid = currentName.ToString();
                        }
                        else
                        {
                            if (!currentName.Equals(oldDetectionNameGrid))
                                oldDetectionNameGrid = currentName.ToString();
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method ShowingEditorCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void PastingFromClipBoardCommondAction(object obj)
        {
            try
            {
                var view = (TableView)((System.Windows.RoutedEventArgs)obj).OriginalSource;
                var grid = view.Grid;
                var clipboardData = Clipboard.GetText();

                if (clipboardData != null)
                {
                    string[] rows = clipboardData.Split(new char[] { '\r', '\n' }, StringSplitOptions.RemoveEmptyEntries);
                    var selectedCells = view.GetSelectedCells();

                    if (rows.Length == 0 || selectedCells.Count == 0)
                    {
                        return;
                    }
                    if (selectedCells.ToList().Where(a => a.Column.FieldName == "Value").Count() > 0)
                    {
                        int count = 0;
                        foreach (var selectedCell in selectedCells.ToList().Where(a => a.Column.FieldName == "Value").ToList())
                        {
                            if (rows.Length > count)
                            {
                                double numericValue;
                                bool isNumber = double.TryParse(rows[count].ToString(), out numericValue);
                                if (isNumber == true)
                                    grid.SetCellValue(selectedCell.RowHandle, selectedCell.Column, Convert.ToDouble(rows[count]));
                            }
                            count++;
                        }
                    }
                }
                ((System.Windows.RoutedEventArgs)obj).Handled = true;
                view.CommitEditing();
                IsEnabledSaveButton = true;
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method PastingFromClipBoardCommondAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }


        public void FillCurrencyConversionList_All()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillCurrencyConversionList_All ...", category: Category.Info, priority: Priority.Low);
                if (PLMCommon.Instance.CurrencyConversionList == null || PLMCommon.Instance.CurrencyConversionList.Count == 0)
                {
                    PLMCommon.Instance.CurrencyConversionList = new List<CurrencyConversion>(PLMService.GetCurrencyConversionsDetailsByLatestDate());
                }
                CurrencyConversionList = PLMCommon.Instance.CurrencyConversionList;
                GeosApplication.Instance.Logger.Log("Method FillCurrencyConversionList_All() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in FillCurrencyConversionList_All() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), "Red", CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in FillCurrencyConversionList_All() Method - ServiceUnexceptedException " + ex.Message, category: Category.Info, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillCurrencyConversionList_All() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        public ImageSource ByteArrayToBitmapImage(byte[] byteArrayIn)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method convert byteArrayToImage ...", category: Category.Info, priority: Priority.Low);
                if (byteArrayIn == null || byteArrayIn.Length == 0) return null;
                var image = new BitmapImage();
                using (var mem = new System.IO.MemoryStream(byteArrayIn))
                {
                    mem.Position = 0;
                    image.BeginInit();
                    image.CreateOptions = BitmapCreateOptions.PreservePixelFormat;
                    image.CacheOption = BitmapCacheOption.OnLoad;
                    image.UriSource = null;
                    image.StreamSource = mem;
                    image.EndInit();
                }
                image.Freeze();
                GeosApplication.Instance.Logger.Log("Method byteArrayToImage() executed successfully", category: Category.Info, priority: Priority.Low);
                return image;
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in byteArrayToImage() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
            return null;
        }


        private void ChangeNameFromItemCommandAction(object e)
        {
            try
            {
                //var editor = (TextEdit)((System.Windows.RoutedEventArgs)e).OriginalSource;
                //if (editor.IsKeyboardFocusWithin)
                //{
                //    //Row["IsUpdatedRow"] = true;
                //}
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method ShowingEditorCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void PasteInSearchControlCommandAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method PasteInSearchControlCommandAction...", category: Category.Info, priority: Priority.Low);
                GridControl gridControl = obj as GridControl;
                TableView tableView = (TableView)gridControl.View;
                var clipboardData = Clipboard.GetText();
                if (clipboardData != null)
                {
                    string[] rows = clipboardData.Split(new char[] { '\r', '\n' }, StringSplitOptions.RemoveEmptyEntries);
                    if (rows.Length > 0)
                    {
                        string search = string.Join(" ", rows.Select(a => a.ToString()));
                        tableView.SearchString = search;
                    }
                }
                GeosApplication.Instance.Logger.Log("Method PasteInSearchControlCommandAction executed successfully...", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Error on PasteInSearchControlCommandAction() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        private void ArticleGridValueUpdated(UInt32 idArticle, EditPCMArticleViewModel editPCMArticleViewModel)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ArticleGridValueUpadated...", category: Category.Info, priority: Priority.Low);
                //DataRow MainRow = new DataRow()

                if (DtArticle == null)
                {
                    DtArticle = new DataTable();
                }
                else
                {

                    foreach (DataRow row in (from row in DtArticle.AsEnumerable() where row.Field<UInt32>("idArticle") == idArticle select row))
                    {


                        if (UInt32.Parse(row["idArticle"].ToString()) == idArticle)
                        {
                            row["Reference"] = (object)editPCMArticleViewModel.Reference;
                            row["Name"] = (object)editPCMArticleViewModel.Description;
                            row["Category"] = (object)editPCMArticleViewModel.SelectedCategory.Name;
                            row["STAT"] = (object)editPCMArticleViewModel.SelectedStatus.Abbreviation;
                            row["HtmlColor"] = (object)editPCMArticleViewModel.SelectedStatus.HtmlColor;
                            row["Logic"] = (object)editPCMArticleViewModel.SelectedIncludedPLMArticlePrice.IdRule;
                            row["Value"] = (object)editPCMArticleViewModel.SelectedIncludedPLMArticlePrice.RuleValue;


                        }
                    }
                    //List<CPLCustomer> CPLCustomers = new List<CPLCustomer>();
                    //AddChangedLogsDetails();
                    //AddChangeLogList(CPLCustomers);


                }
                GeosApplication.Instance.Logger.Log("Method ArticleGridValueUpadated executed successfully...", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Error on ArticleGridValueUpadated() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        private void DetectionGridValueUpdated(UInt32 idDetection, EditDetectionViewModel addEditOptionsDetectionsViewModel)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ArticleGridValueUpadated...", category: Category.Info, priority: Priority.Low);
                //DataRow MainRow = new DataRow()

                if (DtDetection == null)
                {
                    DtDetection = new DataTable();
                }
                else
                {

                    foreach (DataRow row in (from row in DtDetection.AsEnumerable() where row.Field<UInt32>("idDetection") == idDetection select row))
                    {


                        if (UInt32.Parse(row["idDetection"].ToString()) == idDetection)
                        {
                            row["Code"] = (object)addEditOptionsDetectionsViewModel.Code;
                            row["Name"] = (object)addEditOptionsDetectionsViewModel.Name;
                            row["Type"] = (object)addEditOptionsDetectionsViewModel.Type;
                            row["STAT"] = (object)addEditOptionsDetectionsViewModel.SelectedStatus.Abbreviation;
                            row["HtmlColor"] = (object)addEditOptionsDetectionsViewModel.SelectedStatus.HtmlColor;
                            row["Logic"] = (object)addEditOptionsDetectionsViewModel.SelectedIncludedPLMDetectionPrice.IdRule;
                            row["Value"] = (object)addEditOptionsDetectionsViewModel.SelectedIncludedPLMDetectionPrice.RuleValue;


                        }
                    }
                    //List<CPLCustomer> CPLCustomers = new List<CPLCustomer>();
                    //AddChangedLogsDetails();
                    //AddChangeLogList(CPLCustomers);

                }

                GeosApplication.Instance.Logger.Log("Method ArticleGridValueUpadated executed successfully...", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Error on ArticleGridValueUpadated() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        private void AddFile(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method AddFile()...", category: Category.Info, priority: Priority.Low);

                AddEditAttachmentFileInPLMView addEditAttachmentFileInPLMView = new AddEditAttachmentFileInPLMView();
                AddEditAttachmentFileInPLMArticleViewModel addEditAttachmentFileInPLMArticleViewModel = new AddEditAttachmentFileInPLMArticleViewModel();
                EventHandler handle = delegate { addEditAttachmentFileInPLMView.Close(); };
                addEditAttachmentFileInPLMArticleViewModel.RequestClose += handle;
                addEditAttachmentFileInPLMArticleViewModel.WindowHeader = System.Windows.Application.Current.FindResource("AddFileHeader").ToString();
                addEditAttachmentFileInPLMArticleViewModel.IsNew = true;
                addEditAttachmentFileInPLMArticleViewModel.IsCPLAttachment = true;
                addEditAttachmentFileInPLMArticleViewModel.CPLInit();

                addEditAttachmentFileInPLMView.DataContext = addEditAttachmentFileInPLMArticleViewModel;
                var ownerInfo = (obj as FrameworkElement);
                addEditAttachmentFileInPLMView.Owner = Window.GetWindow(ownerInfo);
                addEditAttachmentFileInPLMView.ShowDialog();

                if (addEditAttachmentFileInPLMArticleViewModel.IsSave)
                {
                    if (OptionWayDetectionSparePartFilesList == null)
                        OptionWayDetectionSparePartFilesList = new ObservableCollection<CPLDocument>();
                    addEditAttachmentFileInPLMArticleViewModel.SelectedCustomerPriceFile.ModifiedIn = Emdep.Geos.UI.Common.GeosApplication.Instance.ServerDateTime.Date.Date;
                    OptionWayDetectionSparePartFilesList.Add(addEditAttachmentFileInPLMArticleViewModel.SelectedCustomerPriceFile);
                    SelectedOptionWayDetectionSparePartFile = addEditAttachmentFileInPLMArticleViewModel.SelectedCustomerPriceFile;
                    FourOptionWayDetectionSparePartFilesList = new ObservableCollection<CPLDocument>(OptionWayDetectionSparePartFilesList.OrderByDescending(x => x.ModifiedIn).Take(4).ToList());
                }
                IsEnabledSaveButton = true;
                GeosApplication.Instance.Logger.Log("Method AddFile()....executed successfully", category: Category.Info, priority: Priority.Low);

            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method AddFile() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void EditFile(object obj)
        {
            try
            {



                GeosApplication.Instance.Logger.Log("Method EditFile()...", category: Category.Info, priority: Priority.Low);
                TableView detailView = (TableView)obj;
                CPLDocument bPLAttachedDoc = (CPLDocument)detailView.DataControl.CurrentItem;
                AddEditAttachmentFileInPLMView addEditAttachmentFileInPLMView = new AddEditAttachmentFileInPLMView();
                AddEditAttachmentFileInPLMArticleViewModel addEditAttachmentFileInPLMArticleViewModel = new AddEditAttachmentFileInPLMArticleViewModel();
                EventHandler handle = delegate { addEditAttachmentFileInPLMView.Close(); };
                addEditAttachmentFileInPLMArticleViewModel.RequestClose += handle;
                addEditAttachmentFileInPLMArticleViewModel.WindowHeader = System.Windows.Application.Current.FindResource("EditFileHeader").ToString();
                addEditAttachmentFileInPLMArticleViewModel.IsNew = false;
                addEditAttachmentFileInPLMArticleViewModel.ClearAllProperties();
                addEditAttachmentFileInPLMArticleViewModel.EditCPLInit(bPLAttachedDoc);
                addEditAttachmentFileInPLMView.DataContext = addEditAttachmentFileInPLMArticleViewModel;
                var ownerInfo = (detailView as FrameworkElement);
                addEditAttachmentFileInPLMView.Owner = Window.GetWindow(ownerInfo);
                addEditAttachmentFileInPLMView.ShowDialog();

                if (addEditAttachmentFileInPLMArticleViewModel.IsSave == true)
                {
                    SelectedOptionWayDetectionSparePartFile.IdAttachmentType = addEditAttachmentFileInPLMArticleViewModel.CPLSelectedType.IdLookupValue;
                    SelectedOptionWayDetectionSparePartFile.OriginalFileName = addEditAttachmentFileInPLMArticleViewModel.FileName;
                    SelectedOptionWayDetectionSparePartFile.Description = addEditAttachmentFileInPLMArticleViewModel.Description;
                    SelectedOptionWayDetectionSparePartFile.PLMArticleFileInBytes = addEditAttachmentFileInPLMArticleViewModel.FileInBytes;
                    SelectedOptionWayDetectionSparePartFile.SavedFileName = addEditAttachmentFileInPLMArticleViewModel.ArticleSavedFileName;
                    //SelectedOptionWayDetectionSparePartFile.ModifiedIn = addEditAttachmentFileInPLMArticleViewModel.UpdatedDate;
                    SelectedOptionWayDetectionSparePartFile.ModifiedIn = Emdep.Geos.UI.Common.GeosApplication.Instance.ServerDateTime.Date.Date;
                    SelectedOptionWayDetectionSparePartFile.ArticleDocumentType = new ArticleDocumentType();
                    SelectedOptionWayDetectionSparePartFile.ArticleDocumentType.DocumentType = addEditAttachmentFileInPLMArticleViewModel.CPLSelectedType.Value;
                    SelectedOptionWayDetectionSparePartFile.IsShareWithCustomer = addEditAttachmentFileInPLMArticleViewModel.IsShareWithCustomer;
                    IsEnabledSaveButton = true;
                }

                GeosApplication.Instance.Logger.Log("Method EditFile()....executed successfully", category: Category.Info, priority: Priority.Low);


            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method EditFile() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void OpenPDFDocument(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method OpenPDFDocument()...", category: Category.Info, priority: Priority.Low);

                // Open PDF in another window
                DocumentView documentView = new DocumentView();
                DocumentViewModel documentViewModel = new DocumentViewModel();
                SelectedOptionWayDetectionSparePartFile = (CPLDocument)obj;

                documentViewModel.OpenCPLPdf(SelectedOptionWayDetectionSparePartFile, obj, Name);
                if (documentViewModel.IsPresent)
                {
                    documentView.DataContext = documentViewModel;
                    documentView.Show();
                }
                GeosApplication.Instance.Logger.Log("Method OpenPDFDocument()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in OpenPDFDocument() Method " + ex.Detail.ErrorMessage, category: Category.Info, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in OpenPDFDocument() Method - ServiceUnexceptedException " + ex.Message, category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method OpenPDFDocument()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        private void DeleteAttachmentFile(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method DelateAttachmentFile()...", category: Category.Info, priority: Priority.Low);
                MessageBoxResult MessageBoxResult = CustomMessageBox.Show(Application.Current.Resources["DeleteDocumentMessage"].ToString(), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);

                if (MessageBoxResult == MessageBoxResult.Yes)
                {
                    OptionWayDetectionSparePartFilesList.Remove(SelectedOptionWayDetectionSparePartFile);
                    OptionWayDetectionSparePartFilesList = new ObservableCollection<CPLDocument>(OptionWayDetectionSparePartFilesList);
                    SelectedOptionWayDetectionSparePartFile = OptionWayDetectionSparePartFilesList.FirstOrDefault();
                    FourOptionWayDetectionSparePartFilesList = new ObservableCollection<CPLDocument>(OptionWayDetectionSparePartFilesList.OrderBy(x => x.IdCustomerPriceListDoc).Take(4).ToList());
                }
                IsEnabledSaveButton = true;

                GeosApplication.Instance.Logger.Log("Method DelateAttachmentFile()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method DelateAttachmentFile()...." + ex.Message, category: Category.Exception, priority: Priority.Low);

            }
        }

        //[Sudhir.Jangra][GEOS2-3349][27/12/2022]
        #region Sudhir.Jangra GEOS2-3349 27/12/2022
        private void DuplicateCustomerPriceCommandAction(object obj)
        {
            try
            {

                if (isDuplicateClicked == true)
                    return;
                isDuplicateClicked = true;
                NewPrice = new CustomerPrice();
                CustomerPriceOldCode = ClonedCustomerPrice.Code;
                GetLatestCustomerPriceCode();
                #region New
                NewPrice = ClonedCustomerPrice;
                NewPrice.Code = DuplicateCode;
                NewPrice.CreationDate = DateTime.Now;
                NewPrice.IdCreator = (uint)GeosApplication.Instance.ActiveUser.IdUser;
                NewPrice.IdCustomerPriceList = IdCustomerPriceList;
                NewPrice.IdStatus = 225;
                CustomerPriceLogEntry tempCustomerPriceLogEntry = new CustomerPriceLogEntry();
                tempCustomerPriceLogEntry.IdUser = (uint)GeosApplication.Instance.ActiveUser.IdUser;
                tempCustomerPriceLogEntry.UserName = GeosApplication.Instance.ActiveUser.FullName;
                tempCustomerPriceLogEntry.Datetime = GeosApplication.Instance.ServerDateTime;
                tempCustomerPriceLogEntry.Comments = string.Format(System.Windows.Application.Current.FindResource("CustomerPriceChangeLogDuplicated").ToString(),
                    NewPrice.Code.Trim(), NewPrice.Name.Trim(), CustomerPriceOldCode.Trim(), ClonedCustomerPrice.Name.Trim());
                CustomerChangeLogList = new ObservableCollection<CustomerPriceLogEntry>();
                CustomerChangeLogList.Add(tempCustomerPriceLogEntry);
                NewPrice.LogList = CustomerChangeLogList.ToList();
                IdCustomerPriceList = NewPrice.IdCustomerPriceList;
                SelectedCustomerPriceCode = NewPrice.Code;
                ClonedCustomerPrice = (CustomerPrice)NewPrice.Clone();
                if (ClonedCustomerPrice.IdStatus == 224)
                    InActiveStatus = true;
                else
                    InActiveStatus = false;
                DtArticleCopy = new DataTable();
                DtArticle = new DataTable();
                DtDetection = new DataTable();
                DtDetectionCopy = new DataTable();
                DtTable = new DataTable();
                DtTableCopy = new DataTable();
                Bands = new ObservableCollection<BandItem>();
                BandsTemplete = new ObservableCollection<BandItem>();
                DetectionBands = new ObservableCollection<BandItem>();
                detectionBandTemplate = new ObservableCollection<BandItem>();

                //Shubham[skadam]  GEOS2-2889 [ Modules + Attachments ]- Duplicate the base price list [#PLM05] 21 04 2023
                DtModule = new DataTable();
                DtModuleCopy = new DataTable();
                ModuleBands = new ObservableCollection<BandItem>();

                SelectedPlant = new List<object>();
                SelectedSaleCurrency = new List<object>();
                PlantCurrencyList = new ObservableCollection<BasePriceListByPlantCurrency>();
                EditInitCustomerPrice_Duplicate(NewPrice);
                DuplicatedCustomerPriceObject = NewPrice;
                IsNew = true;
                IsEnabledSaveButton = false;
                CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("CustomerPriceDuplicatedSuccess").ToString()), Application.Current.Resources["PopUpSuccessColor"].ToString(),
                  CustomMessageBox.MessageImagePath.Ok, MessageBoxButton.OK);

                #endregion
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method AllButtonClickAction()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        public void EditInitCustomerPrice_Duplicate(CustomerPrice temp)
        {
            try
            {
                GeosApplication.Instance.Logger.Log(string.Format("Method EditInitCustomerPrice_Duplicate..."), category: Category.Info, priority: Priority.Low);
                IdBasePriceList = temp.IdBasePriceList;
                SelectedCustomerPriceCode = temp.Code;

                Description = temp.Description;
                Description_en = temp.Description;
                Description_es = temp.Description_es;
                Description_fr = temp.Description_fr;
                Description_pt = temp.Description_pt;
                Description_ro = temp.Description_ro;
                Description_ru = temp.Description_ru;
                Description_zh = temp.Description_zh;

                Name = "Duplicated_" + temp.Name;
                Name_en = "Duplicated_" + temp.Name;
                Name_es = temp.Name_es;
                Name_fr = temp.Name_fr;
                Name_pt = temp.Name_pt;
                Name_ro = temp.Name_ro;
                Name_ru = temp.Name_ru;
                Name_zh = temp.Name_zh;

                Remark = temp.Remark;
                Remark_en = temp.Remark;
                Remark_es = temp.Remark_es;
                Remark_fr = temp.Remark_fr;
                Remark_pt = temp.Remark_pt;
                Remark_ro = temp.Remark_ro;
                Remark_ru = temp.Remark_ru;
                Remark_zh = temp.Remark_zh;


                if (StatusList != null)
                {
                    SelectedStatus = StatusList.FirstOrDefault(x => x.IdLookupValue == temp.IdStatus);
                }
                SelectedOriginalStatus = SelectedStatus;
                if (GeosApplication.Instance.IsPLMPermissionChange)
                {
                    IsDuplicateCustomerPriceButtonEnabled = true;
                }
                else
                {
                    IsDuplicateCustomerPriceButtonEnabled = false;
                }
                if (Name_en == Name_es && Name_en == Name_fr && Name_en == Name_pt && Name_en == Name_ro && Name_en == Name_ru && Name_en == Name_zh)
                {
                    IsCopyName = true;
                }
                if (Description_en == Description_es && Description_en == Description_fr && Description_en == Description_pt && Description_en == Description_ro && Description_en == Description_ru && Description_en == Description_zh)
                {
                    IsCopyDescription = true;
                }

                if (Remark_en == Remark_es && Remark_en == Remark_fr && Remark_en == Remark_pt && Remark_en == Remark_ro && Remark_en == Remark_ru && Remark_en == Remark_zh)
                {
                    IsCopyRemark = true;
                }

                if (IsCopyName == true && IsCopyDescription == true && IsCopyRemark == true)
                {
                    IsCheckedAllLanguages = true;
                }
                else
                {
                    IsCheckedAllLanguages = false;
                }
                oldIsCheckedAllLanguages = IsCheckedAllLanguages;
                FillArticleCostPriceList(((Currency)SelectedCurrency).IdCurrency); //[nsatpute][17.06.2025][GEOS2-6689]
                BasePriceNameList = new ObservableCollection<BasePrice>(PLMService.GetBasePriceNames());
                BasePriceNameList.Insert(0, new BasePrice() { Name = "---", IdBasePriceList = 0 });

                CreationDate = temp.CreationDate;
                EffectiveDate = null;
                ExpiryDate = null;
                CurrencyList = null;
                if (CurrencyList == null)
                {
                    CurrencyName = "---";
                    CurrencyIcon = null;
                }
                SaleCurrencyList = null;
                IsCheckedBasePrice = false;
                IsCheckedCustomerPrice = false;
                if (temp.LogList != null)
                {
                    CustomerChangeLogList = new ObservableCollection<CustomerPriceLogEntry>();
                    CustomerChangeLogList.AddRange(temp.LogList);
                    if (CustomerChangeLogList.Count > 0)
                    {
                        SelectedCustomerPriceChangeLog = CustomerChangeLogList.FirstOrDefault();
                    }
                }



                GeosApplication.Instance.Logger.Log(string.Format("Method EditInitCustomerPrice_Duplicate()....executed successfully"), category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in EditInitCustomerPrice_Duplicate() Method " + ex.Detail.ErrorMessage, category: Category.Info, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in EditInitCustomerPrice_Duplicate() Method - ServiceUnexceptedException " + ex.Message, category: Category.Info, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method EditInitCustomerPrice_Duplicate()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        #endregion




        //[Sudhir.Jangra][GEOS2-4935][21/11/2023]
        private void AddCommentsCommandAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method AddFile()...", category: Category.Info, priority: Priority.Low);
                GridControl gridControlView = (GridControl)obj;
                AddEditCommentsPLMView addCommentsView = new AddEditCommentsPLMView();
                AddEditCustomerPriceCommentsViewModel addCommentsViewModel = new AddEditCustomerPriceCommentsViewModel();
                EventHandler handle = delegate { addCommentsView.Close(); };
                addCommentsViewModel.RequestClose += handle;
                addCommentsViewModel.WindowHeader = System.Windows.Application.Current.FindResource("AddCommentsHeader").ToString();
                var ownerInfo = (gridControlView as FrameworkElement);
                addCommentsView.Owner = Window.GetWindow(ownerInfo);
                //addCommentsViewModel.IsNew = true;
                //addCommentsViewModel.Init();

                addCommentsView.DataContext = addCommentsViewModel;
                addCommentsView.ShowDialog();
                if (addCommentsViewModel.SelectedComment != null)
                {

                    if (CommentsList == null)
                        CommentsList = new ObservableCollection<CustomerPriceLogEntry>();

                    //  addCommentsViewModel.SelectedComment.IdCPType = contacts.IdArticleSupplier;

                    if (AddCommentsList == null)
                        AddCommentsList = new List<CustomerPriceLogEntry>();

                    AddCommentsList.Add(new CustomerPriceLogEntry()
                    {
                        IdUser = addCommentsViewModel.SelectedComment.IdUser,
                        // IdCPType = addCommentsViewModel.SelectedComment.IdCPType,
                        Comments = addCommentsViewModel.SelectedComment.Comments
                    });
                    CommentsList.Add(addCommentsViewModel.SelectedComment);
                    SelectedComment = addCommentsViewModel.SelectedComment;
                    CommentText = SelectedComment.Comments;
                    CommentDateTimeText = DateTime.Now;
                    CommentFullNameText = GeosApplication.Instance.ActiveUser.FullName;
                }
                GeosApplication.Instance.Logger.Log("Method AddFile()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method AddFile() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        //[Sudhir.Jangra][GEOS2-4935]
        public void DeleteCommentRowCommandAction(object parameter)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method convert DeleteCommentCommandAction ...", category: Category.Info, priority: Priority.Low);
                CustomerPriceLogEntry commentObject = (CustomerPriceLogEntry)parameter;
                if (commentObject.IdUser == GeosApplication.Instance.ActiveUser.IdUser)
                {
                    bool result = false;

                    MessageBoxResult MessageBoxResult = CustomMessageBox.Show(Application.Current.Resources["DeleteBasePriceComment"].ToString(), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);

                    if (MessageBoxResult == MessageBoxResult.Yes)
                    {
                        if (CommentsList != null && CommentsList?.Count > 0)
                        {
                            CustomerPriceLogEntry Comment = (CustomerPriceLogEntry)commentObject;

                            CommentsList.Remove(Comment);

                            if (DeleteCommentsList == null)
                                DeleteCommentsList = new ObservableCollection<CustomerPriceLogEntry>();

                            DeleteCommentsList.Add(new CustomerPriceLogEntry()
                            {
                                IdUser = Comment.IdUser,
                                //  IdCPType = Comment.IdCPType,
                                Comments = Comment.Comments,
                                //  IdLogEntryByCptype = Comment.IdLogEntryByCptype

                            });
                            CommentsList = new ObservableCollection<CustomerPriceLogEntry>(CommentsList);

                            IsDeleted = true;
                            if (CommentsList?.Count > 0)
                            {
                                CommentText = CommentsList[CommentsList.Count - 1].Comments;
                                CommentDateTimeText = CommentsList[CommentsList.Count - 1].Datetime;
                                CommentFullNameText = CommentsList[CommentsList.Count - 1].People.FullName;
                            }
                            else
                            {
                                CommentText = string.Empty;
                                CommentDateTimeText = null;
                                CommentFullNameText = string.Empty;
                            }
                        }
                    }
                }
                else
                {
                    CustomMessageBox.Show(Application.Current.Resources["PLMDeleteProductTypeCommentNotAllowed"].ToString(), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                }

                GeosApplication.Instance.Logger.Log("Method DeleteCommentCommandAction() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method DeleteCommentRowCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }

        }


        //[Sudhir.Jangra][GEOS2-4935]
        private void CommentDoubleClickCommandAction(object obj)
        {
            GeosApplication.Instance.Logger.Log("Method CommentDoubleClickCommandAction()...", category: Category.Info, priority: Priority.Low);
            CustomerPriceLogEntry logcomments = (CustomerPriceLogEntry)obj;
            if (logcomments.IdUser == GeosApplication.Instance.ActiveUser.IdUser)
            {
                AddEditCustomerPriceCommentsView editCommentsView = new AddEditCustomerPriceCommentsView();
                AddEditCustomerPriceCommentsViewModel editCommentsViewModel = new AddEditCustomerPriceCommentsViewModel();
                EventHandler handle = delegate { editCommentsView.Close(); };
                editCommentsViewModel.RequestClose += handle;
                editCommentsViewModel.WindowHeader = System.Windows.Application.Current.FindResource("EditCommentsHeader").ToString();
                editCommentsViewModel.NewItemComment = SelectedComment.Comments;
                // editCommentsViewModel.IdLogEntryByCpType = SelectedComment.IdLogEntryByCptype;
                editCommentsView.DataContext = editCommentsViewModel;
                editCommentsView.ShowDialog();

                if (editCommentsViewModel.SelectedComment != null)
                {
                    SelectedComment.Comments = editCommentsViewModel.NewItemComment;
                       CommentsList.FirstOrDefault(s => s.IdLogEntryByCustomerPriceList == SelectedComment.IdLogEntryByCustomerPriceList).Comments = editCommentsViewModel.NewItemComment;
                       CommentsList.FirstOrDefault(s => s.IdLogEntryByCustomerPriceList == SelectedComment.IdLogEntryByCustomerPriceList).Datetime = GeosApplication.Instance.ServerDateTime;

                    if (UpdatedCommentsList == null)
                        UpdatedCommentsList = new List<CustomerPriceLogEntry>();

                    // editCommentsViewModel.SelectedComment.IdCPType = SelectedContacts.;
                    UpdatedCommentsList.Add(new CustomerPriceLogEntry()
                    {
                        IdUser = SelectedComment.IdUser,
                          IdCustomerPriceList = SelectedComment.IdCustomerPriceList,
                        Comments = SelectedComment.Comments,
                        Datetime = GeosApplication.Instance.ServerDateTime,
                        IdLogEntryByCustomerPriceList = SelectedComment.IdLogEntryByCustomerPriceList
                    });
                }
            }
            else
            {
                CustomMessageBox.Show(Application.Current.Resources["EditProductTypeCommentNotAllowed"].ToString(), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }

        }

        //[Sudhir.jangra][GEOS2-4935]
        private void SetUserProfileImage(ObservableCollection<CustomerPriceLogEntry> CommentsList)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method SetUserProfileImage ...", category: Category.Info, priority: Priority.Low);

                foreach (var item in CommentsList)
                {
                    UserProfileImageByte = GeosRepositoryServiceController.GetUserProfileImageWithoutException(item.People.Login);

                    if (UserProfileImageByte != null)
                        item.People.OwnerImage = ByteArrayToBitmapImage(UserProfileImageByte);
                    else
                    {
                        if (ApplicationThemeHelper.ApplicationThemeName == "BlackAndBlue")
                        {
                            //if (item.People.IdPersonGender == 1)
                            //    item.People.OwnerImage = GetImage("/Emdep.Geos.Modules.Crm;component/Assets/Images/FemaleUser_White.png");
                            //else if (item.People.IdPersonGender == 2)
                            //    item.People.OwnerImage = GetImage("/Emdep.Geos.Modules.Crm;component/Assets/Images/MaleUser_White.png");
                            //else if (item.People.IdPersonGender == null)
                            item.People.OwnerImage = GetImage("/Emdep.Geos.Modules.Crm;component/Assets/Images/wUnknownGender.png");

                        }
                        else
                        {
                            //if (item.People.IdPersonGender == 1)
                            //    item.People.OwnerImage = GetImage("/Emdep.Geos.Modules.Crm;component/Assets/Images/FemaleUser_Blue.png");
                            //else if (item.People.IdPersonGender == 2)
                            //    item.People.OwnerImage = GetImage("/Emdep.Geos.Modules.Crm;component/Assets/Images/MaleUser_Blue.png");
                            //else if (item.People.IdPersonGender == null)
                            item.People.OwnerImage = GetImage("/Emdep.Geos.Modules.Crm;component/Assets/Images/blueUnknownGender.png");
                        }
                    }
                }

                GeosApplication.Instance.Logger.Log("Method SetUserProfileImage() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in SetUserProfileImage() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), "Red", CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in SetUserProfileImage() Method - ServiceUnexceptedException " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in SetUserProfileImage() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        //[Sudhir.Jangra][GEOS2-4935]
        BitmapImage GetImage(string path)
        {
            //return new BitmapImage(new Uri(path, UriKind.Relative));
            BitmapImage image = new BitmapImage();
            image.BeginInit();
            image.UriSource = new Uri(path, UriKind.RelativeOrAbsolute);
            image.EndInit();
            return image;
        }



        #endregion

        #region Validation

        bool allowValidation = false;

        string EnableValidationAndGetError()
        {
            allowValidation = true;
            string error = ((IDataErrorInfo)this).Error;
            if (!string.IsNullOrEmpty(error))
            {
                return error;
            }
            return null;
        }

        string IDataErrorInfo.Error
        {
            get
            {
                if (!allowValidation) return null;
                IDataErrorInfo me = (IDataErrorInfo)this;

                string error =
                me[BindableBase.GetPropertyName(() => Name)] +
                me[BindableBase.GetPropertyName(() => InformationError)] +
                me[BindableBase.GetPropertyName(() => EffectiveDate)] +
                me[BindableBase.GetPropertyName(() => ExpiryDate)] +
                me[BindableBase.GetPropertyName(() => SelectedBasePriceName)];


                if (!string.IsNullOrEmpty(error))
                    return "Please check inputted data.";

                return null;
            }
        }


        string IDataErrorInfo.this[string columnName]
        {
            get
            {
                if (!allowValidation) return null;

                string name = BindableBase.GetPropertyName(() => Name);
                string headerInformtionError = BindableBase.GetPropertyName(() => InformationError);
                string effectiveDate = BindableBase.GetPropertyName(() => EffectiveDate);
                string expiryDate = BindableBase.GetPropertyName(() => ExpiryDate);
                string selectedBasePriceName = BindableBase.GetPropertyName(() => SelectedBasePriceName);

                if (columnName == name)
                {
                    return AddEditCustomerPriceValidation.GetErrorMessage(name, Name);
                }

                if (columnName == headerInformtionError)
                {
                    return AddEditCustomerPriceValidation.GetErrorMessage(headerInformtionError, InformationError);
                }

                if (columnName == selectedBasePriceName)
                {
                    return AddEditCustomerPriceValidation.GetErrorMessage(selectedBasePriceName, SelectedBasePriceName);
                }

                if (columnName == effectiveDate)
                {
                    if (!string.IsNullOrEmpty(effectiveDateErrorMessage))
                    {
                        return effectiveDateErrorMessage;
                    }
                    else
                    {
                        return AddEditCustomerPriceValidation.GetErrorMessage(effectiveDate, EffectiveDate);
                    }
                }

                if (columnName == expiryDate)
                {
                    if (!string.IsNullOrEmpty(expiryDateErrorMessage))
                    {
                        return expiryDateErrorMessage;
                    }
                    else
                    {
                        return AddEditCustomerPriceValidation.GetErrorMessage(expiryDate, ExpiryDate);
                    }
                }

                return null;
            }
        }

        public string CheckInformationError(string error)
        {
            if (!string.IsNullOrEmpty(error))
            {
            }

            return error;

        }



        #endregion

        #region Column Chooser
        private void ArticleGridControlLoadedAction(object obj)
        {
            try
            {

                GeosApplication.Instance.Logger.Log("Method ArticleGridControlLoadedAction...", category: Category.Info, priority: Priority.Low);
                //{
                //    int visibleFalseColumn = 0;
                GridControl gridControl = obj as GridControl;

                TableView tableView = (TableView)gridControl.View;
                articleTableView = tableView;

                //    if (gridControl.Columns.Count() == 0)
                //        return;

                //    if (IsSwitch == true)
                //    {
                //        if (gridControl.Columns.Any(a => a.Visible == false))
                //        {
                //            IsArticleColumnChooserVisible = true;
                //        }
                //        IsSwitch = false;
                //        return;
                //    }

                //    gridControl.BeginInit();

                //    if (File.Exists(CPLArticleGridSettingFilePath))
                //    {
                //        gridControl.RestoreLayoutFromXml(CPLArticleGridSettingFilePath);
                //    }

                //    //This code for save grid layout.
                //    gridControl.SaveLayoutToXml(CPLArticleGridSettingFilePath);
                //    foreach (BandItem band in ((Emdep.Geos.UI.Helper.MyGridControl)gridControl).BandsSource)
                //    {
                //        if (!band.Visible)
                //        {
                //            visibleFalseColumn++;
                //        }
                //    }
                //    var list = gridControl.Columns.Where(a => Convert.ToString(((DevExpress.Xpf.Grid.BaseColumn)(a.Parent)).Header) == "Sale Price").ToList().OrderBy(x => x.VisibleIndex).ToList();

                //    if (list.Count > 0)
                //    {
                //        if (((Currency)SelectedCurrency).Name != Convert.ToString(list.FirstOrDefault().Header))
                //        {
                //            int commonindex = list.FirstOrDefault(a => Convert.ToString(a.Header) == ((Currency)SelectedCurrency).Name).VisibleIndex;
                //            int firstindex = list.FirstOrDefault().VisibleIndex;

                //            list.Where(a => Convert.ToString(a.Header) == ((Currency)SelectedCurrency).Name).ToList().ForEach(a => { a.VisibleIndex = firstindex; });
                //            list.Where(a => a.VisibleIndex == firstindex).ToList().ForEach(a => { a.VisibleIndex = commonindex; });
                //        }
                //    }

                //    foreach (GridColumn column in gridControl.Columns)
                //    {
                //        DependencyPropertyDescriptor descriptor = DependencyPropertyDescriptor.FromProperty(GridColumn.VisibleProperty, typeof(GridColumn));
                //        if (descriptor != null)
                //        {
                //            descriptor.AddValueChanged(column, ArticleVisibleChanged);
                //        }

                //        DependencyPropertyDescriptor descriptorColumnPosition = DependencyPropertyDescriptor.FromProperty(GridColumn.VisibleIndexProperty, typeof(GridColumn));
                //        if (descriptorColumnPosition != null)
                //        {
                //            descriptorColumnPosition.AddValueChanged(column, ArticleVisibleIndexChanged);
                //        }

                //        if (!column.Visible)
                //        {
                //            visibleFalseColumn++;
                //        }

                //    }

                //    if (visibleFalseColumn > 0)
                //    {
                //        IsArticleColumnChooserVisible = true;
                //    }
                //    else
                //    {
                //        IsArticleColumnChooserVisible = false;
                //    }


                //    gridControl.EndInit();
                //    tableView.SearchString = null;
                //    tableView.ShowGroupPanel = false;
                //}

                //if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                try
                {
                    SelectedTileBarItem = null;
                    DetectionSelectedTileBarItem = null;
                    ModuleSelectedTileBarItem = null;
                }
                catch (Exception ex)
                {

                }
                GeosApplication.Instance.Logger.Log("Method ArticleGridControlLoadedAction executed successfully...", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Error on ArticleGridControlLoadedAction() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        void ArticleVisibleChanged(object sender, EventArgs args)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ArticleVisibleChanged ...", category: Category.Info, priority: Priority.Low);

                GridColumn column = sender as GridColumn;

                if (column.ShowInColumnChooser)
                {
                    ((GridControl)((GridControlBand)((System.Windows.FrameworkContentElement)sender).Parent).Parent).SaveLayoutToXml(CPLArticleGridSettingFilePath);
                }

                if (column.Visible == false && this.articleTableView.ColumnChooserColumns.Count > 0)
                {
                    IsArticleColumnChooserVisible = true;
                }
                else
                {
                    IsArticleColumnChooserVisible = false;
                }

                GeosApplication.Instance.Logger.Log("Method ArticleVisibleChanged() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Error in ArticleVisibleChanged() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        void ArticleVisibleIndexChanged(object sender, EventArgs args)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ArticleVisibleIndexChanged ...", category: Category.Info, priority: Priority.Low);
                GridColumn column = sender as GridColumn;
                if (((DevExpress.Xpf.Grid.ColumnBase)sender).ActualColumnChooserHeaderCaption.ToString() != "")
                {
                    ((GridControl)((GridControlBand)((System.Windows.FrameworkContentElement)sender).Parent).Parent).SaveLayoutToXml(CPLArticleGridSettingFilePath);
                }
                GeosApplication.Instance.Logger.Log("Method ArticleVisibleIndexChanged() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Error in ArticleVisibleIndexChanged() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        private void ArticleItemListTableViewLoadedAction(object obj)
        {
            TableView tableView = obj as TableView;
            tableView.ColumnChooserState = new DefaultColumnChooserState
            {
                Location = new Point(20, 180),
                Size = new Size(250, 250)
            };
        }

        private void ArticleGridControlUnloadedAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ArticleGridControlUnloadedAction...", category: Category.Info, priority: Priority.Low);
                GridControl gridControl = obj as GridControl;
                if (gridControl.Columns.Count() > 0)
                {
                    TableView tableView = (TableView)gridControl.View;
                    tableView.SearchString = string.Empty;
                    if (gridControl.GroupCount > 0)
                        gridControl.ClearGrouping();

                    gridControl.ClearSorting();
                    gridControl.FilterString = null;
                    gridControl.SaveLayoutToXml(CPLArticleGridSettingFilePath);
                    IsSwitch = false;
                }
                else
                {
                    IsFirstTimeArticleLoad = false;
                    IsSwitch = true;
                }
                IsFirstTimeDetectionLoad = false;
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Method ArticleGridControlUnloadedAction executed successfully...", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Error on ArticleGridControlUnloadedAction() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        private void DetectionGridControlLoadedAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method DetectionGridControlLoadedAction...", category: Category.Info, priority: Priority.Low);
                //{
                // int visibleFalseColumn = 0;
                GridControl gridControl = obj as GridControl;

                //if (gridControl.Columns.Count() == 0)
                //    return;

                TableView tableView = (TableView)gridControl.View;
                this.detectionsTableView = tableView;

                //gridControl.BeginInit();

                //if (File.Exists(CPLDetectionGridSettingFilePath))
                //{
                //    gridControl.RestoreLayoutFromXml(CPLDetectionGridSettingFilePath);
                //}

                ////This code for save grid layout.
                //gridControl.SaveLayoutToXml(CPLDetectionGridSettingFilePath);

                //foreach (BandItem band in ((Emdep.Geos.UI.Helper.MyGridControl)gridControl).BandsSource)
                //{
                //    if (!band.Visible)
                //    {
                //        visibleFalseColumn++;
                //    }
                //}
                //var list = gridControl.Columns.Where(a => Convert.ToString(((DevExpress.Xpf.Grid.BaseColumn)(a.Parent)).Header) == "Sale Price").ToList().OrderBy(x => x.VisibleIndex).ToList();

                //if (list.Count > 0)
                //{
                //    if (((Currency)SelectedCurrency).Name != Convert.ToString(list.FirstOrDefault().Header))
                //    {
                //        int commonindex = list.FirstOrDefault(a => Convert.ToString(a.Header) == ((Currency)SelectedCurrency).Name).VisibleIndex;
                //        int firstindex = list.FirstOrDefault().VisibleIndex;

                //        list.Where(a => Convert.ToString(a.Header) == ((Currency)SelectedCurrency).Name).ToList().ForEach(a => { a.VisibleIndex = firstindex; });
                //        list.Where(a => a.VisibleIndex == firstindex).ToList().ForEach(a => { a.VisibleIndex = commonindex; });
                //    }
                //}
                //foreach (GridColumn column in gridControl.Columns)
                //{
                //    DependencyPropertyDescriptor descriptor = DependencyPropertyDescriptor.FromProperty(GridColumn.VisibleProperty, typeof(GridColumn));
                //    if (descriptor != null)
                //    {
                //        descriptor.AddValueChanged(column, DetectionVisibleChanged);
                //    }

                //    DependencyPropertyDescriptor descriptorColumnPosition = DependencyPropertyDescriptor.FromProperty(GridColumn.VisibleIndexProperty, typeof(GridColumn));
                //    if (descriptorColumnPosition != null)
                //    {
                //        descriptorColumnPosition.AddValueChanged(column, DetectionVisibleIndexChanged);
                //    }

                //    if (!column.Visible)
                //    {
                //        visibleFalseColumn++;
                //    }
                //}


                //if (IsSwitch == false)
                //{
                //    if (visibleFalseColumn > 0)
                //    {
                //        IsDetectionColumnChooserVisible = true;
                //    }
                //    else
                //    {
                //        IsDetectionColumnChooserVisible = false;
                //    }
                //}

                //gridControl.EndInit();
                //tableView.SearchString = null;
                //tableView.ShowGroupPanel = false;
                //}
                try
                {
                    SelectedTileBarItem = null;
                    DetectionSelectedTileBarItem = null;
                    ModuleSelectedTileBarItem = null;
                }
                catch (Exception ex)
                {

                }
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Method DetectionGridControlLoadedAction executed successfully...", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Error on DetectionGridControlLoadedAction() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        void DetectionVisibleChanged(object sender, EventArgs args)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method DetectionVisibleChanged ...", category: Category.Info, priority: Priority.Low);

                GridColumn column = sender as GridColumn;

                if (column.ShowInColumnChooser)
                {
                    ((GridControl)((GridControlBand)((System.Windows.FrameworkContentElement)sender).Parent).Parent).SaveLayoutToXml(CPLDetectionGridSettingFilePath);
                }

                if (column.Visible == false && this.detectionsTableView.ColumnChooserColumns.Count > 0)
                {
                    IsDetectionColumnChooserVisible = true;
                }
                else
                {
                    IsDetectionColumnChooserVisible = false;
                }

                GeosApplication.Instance.Logger.Log("Method DetectionVisibleChanged() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Error in DetectionVisibleChanged() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        void DetectionVisibleIndexChanged(object sender, EventArgs args)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method DetectionVisibleIndexChanged ...", category: Category.Info, priority: Priority.Low);
                GridColumn column = sender as GridColumn;
                if (((DevExpress.Xpf.Grid.ColumnBase)sender).ActualColumnChooserHeaderCaption.ToString() != "")
                {
                    ((GridControl)((GridControlBand)((System.Windows.FrameworkContentElement)sender).Parent).Parent).SaveLayoutToXml(CPLDetectionGridSettingFilePath);
                }
                GeosApplication.Instance.Logger.Log("Method DetectionVisibleIndexChanged() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Error in DetectionVisibleIndexChanged() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        private void DetectionItemListTableViewLoadedAction(object obj)
        {
            TableView tableView = obj as TableView;
            tableView.ColumnChooserState = new DefaultColumnChooserState
            {
                Location = new Point(20, 180),
                Size = new Size(250, 250)
            };
        }


        private void DetectionGridControlUnloadedAction(object obj)
        {
            try
            {
                if (IsFirstTimeLoad == true)
                {
                    IsFirstTimeLoad = false;
                    return;
                }
                GeosApplication.Instance.Logger.Log("Method DetectionGridControlUnloadedAction...", category: Category.Info, priority: Priority.Low);
                GridControl gridControl = obj as GridControl;
                if (gridControl.Columns.Count() > 0)
                {
                    TableView tableView = (TableView)gridControl.View;
                    tableView.SearchString = string.Empty;
                    if (gridControl.GroupCount > 0)
                        gridControl.ClearGrouping();

                    gridControl.ClearSorting();
                    gridControl.FilterString = null;
                    gridControl.SaveLayoutToXml(CPLDetectionGridSettingFilePath);
                    IsSwitch = false;
                }
                else
                {
                    IsFirstTimeDetectionLoad = false;
                    IsSwitch = true;
                }
                IsFirstTimeArticleLoad = false;
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Method DetectionGridControlUnloadedAction executed successfully...", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Error on DetectionGridControlUnloadedAction() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        private void ArticleGridControlPropertyChangedCommandAction(object obj)
        {
            try
            {
                if (obj.GetType() == typeof(System.ComponentModel.PropertyChangedEventArgs))
                    return;

                GroupBox grp = ((object[])obj)[2] as GroupBox;
                if (grp.State == GroupBoxState.Normal)
                    return;

                DXTabControl tab = ((object[])obj)[0] as DXTabControl;

                GridControl gridControl = ((object[])obj)[1] as GridControl;

                if (tab.SelectedIndex == 1)
                    return;

                if (gridControl.Columns.Any(a => a.Header == null))
                    return;

                TableView tableView = (TableView)gridControl.View;

                if (SelectedBasePriceName == null || SelectedBasePriceName.IdBasePriceList == 0)
                    return;

                if (gridControl.Columns.Count() == 0)
                {
                    if (SelectedBasePriceName_Copy == null)
                        SelectedBasePriceName_Copy = new BasePrice();

                    if (SelectedBasePriceName == null)
                        SelectedBasePriceName = new BasePrice();

                    if (SelectedBasePriceName_Copy.IdBasePriceList > 0 && SelectedBasePriceName_Copy.IdBasePriceList != SelectedBasePriceName.IdBasePriceList && IsFirstTimeArticleLoad == true)
                    {
                        IsFirstTimeArticleLoad = false;
                        SelectedBasePriceName_Copy = SelectedBasePriceName;
                    }
                    return;
                }
                if (IsFirstTimeArticleLoad == true)
                    return;

                int count = 0;
                foreach (BandItem band in Bands)
                {
                    count += band.Columns.Count();
                }
                if (count != gridControl.Columns.Count())
                {
                    return;
                }
                if (count == gridControl.Columns.Count())
                {
                    GeosApplication.Instance.Logger.Log("Method ArticleGridControlPropertyChangedCommandAction...", category: Category.Info, priority: Priority.Low);

                    int visibleFalseColumn = 0;
                    if (File.Exists(CPLArticleGridSettingFilePath))
                    {
                        if (IsFirstTimeArticleLoad == false)
                        {
                            IsFirstTimeArticleLoad = true;
                            gridControl.RestoreLayoutFromXml(CPLArticleGridSettingFilePath);
                        }
                        else
                        {
                            return;
                        }
                    }

                    //This code for save grid layout.
                    SelectedBasePriceName_Copy = SelectedBasePriceName;
                    gridControl.SaveLayoutToXml(CPLArticleGridSettingFilePath);
                    foreach (BandItem band in ((Emdep.Geos.UI.Helper.MyGridControl)gridControl).BandsSource)
                    {
                        if (!band.Visible)
                        {
                            visibleFalseColumn++;
                        }
                    }

                    var list = gridControl.Columns.Where(a => Convert.ToString(((DevExpress.Xpf.Grid.BaseColumn)(a.Parent)).Header) == "Sale Price").ToList().OrderBy(x => x.VisibleIndex).ToList();

                    if (list != null && list.Count > 0)
                    {
                        if (((Currency)SelectedCurrency).Name != Convert.ToString(list.FirstOrDefault().Header))
                        {
                            int commonindex = list.FirstOrDefault(a => Convert.ToString(a.Header) == ((Currency)SelectedCurrency).Name).VisibleIndex;
                            int firstindex = list.FirstOrDefault().VisibleIndex;

                            list.Where(a => a.VisibleIndex == firstindex).ToList().ForEach(a => { a.VisibleIndex = commonindex; });
                            list.Where(a => Convert.ToString(a.Header) == ((Currency)SelectedCurrency).Name).ToList().ForEach(a => { a.VisibleIndex = firstindex; });
                        }
                    }

                    foreach (GridColumn column in gridControl.Columns)
                    {
                        DependencyPropertyDescriptor descriptor = DependencyPropertyDescriptor.FromProperty(GridColumn.VisibleProperty, typeof(GridColumn));
                        if (descriptor != null)
                        {
                            descriptor.AddValueChanged(column, ArticleVisibleChanged);
                        }

                        DependencyPropertyDescriptor descriptorColumnPosition = DependencyPropertyDescriptor.FromProperty(GridColumn.VisibleIndexProperty, typeof(GridColumn));
                        if (descriptorColumnPosition != null)
                        {
                            descriptorColumnPosition.AddValueChanged(column, ArticleVisibleIndexChanged);
                        }
                        DependencyPropertyDescriptor descriptorColumnFormatting = DependencyPropertyDescriptor.FromProperty(GridColumn.CellStyleProperty, typeof(GridColumn));
                        if (descriptorColumnFormatting != null)
                        {
                            descriptorColumnFormatting.AddValueChanged(column, ArticleVisibleIndexChanged);
                        }

                        if (!column.Visible)
                        {
                            visibleFalseColumn++;
                        }
                    }



                    if (visibleFalseColumn > 0)
                    {
                        if (tab.SelectedIndex == 0)
                            IsArticleColumnChooserVisible = true;
                    }
                    else
                    {
                        IsArticleColumnChooserVisible = false;
                    }
                    if (tab.SelectedIndex == 0)
                        IsDetectionColumnChooserVisible = false;

                    tableView.SearchString = null;
                    tableView.ShowGroupPanel = false;
                    IsFirstTimeArticleLoad = true;
                    FilterBPLAndCPL();
                    GeosApplication.Instance.Logger.Log("Method ArticleGridControlPropertyChangedCommandAction executed successfully...", category: Category.Info, priority: Priority.Low);
                    if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                }
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Error on ArticleGridControlPropertyChangedCommandAction() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }


        private void DetectionGridControlPropertyChangedCommandAction(object obj)
        {
            try
            {

                if (IsSwitch == true)
                    return;

                if (obj.GetType() == typeof(System.ComponentModel.PropertyChangedEventArgs))
                    return;

                GroupBox grp = ((object[])obj)[2] as GroupBox;
                if (grp.State == GroupBoxState.Normal)
                    return;

                DXTabControl tab = ((object[])obj)[0] as DXTabControl;

                GridControl gridControl = ((object[])obj)[1] as GridControl;

                //if (tab.SelectedIndex == 0)
                //    return;

                if (gridControl.Columns.Any(a => a.Header == null))
                    return;

                TableView tableView = (TableView)gridControl.View;

                if (SelectedBasePriceName == null || SelectedBasePriceName.IdBasePriceList == 0)
                    return;

                if (gridControl.Columns.Count() == 0)
                {
                    if (SelectedBasePriceName_Copy == null)
                        SelectedBasePriceName_Copy = new BasePrice();

                    if (SelectedBasePriceName == null)
                        SelectedBasePriceName = new BasePrice();

                    if (SelectedBasePriceName_Copy.IdBasePriceList > 0 && SelectedBasePriceName_Copy.IdBasePriceList != SelectedBasePriceName.IdBasePriceList && IsFirstTimeDetectionLoad == true)
                    {
                        IsFirstTimeDetectionLoad = false;
                        SelectedBasePriceName_Copy = SelectedBasePriceName;
                    }
                    return;
                }

                if (IsFirstTimeDetectionLoad == true)
                    return;

                int count = 0;
                foreach (BandItem band in DetectionBands)
                {
                    count += band.Columns.Count();
                }
                if (count != gridControl.Columns.Count())
                {
                    return;
                }
                if (count == gridControl.Columns.Count())
                {
                    GeosApplication.Instance.Logger.Log("Method DetectionGridControlPropertyChangedCommandAction...", category: Category.Info, priority: Priority.Low);

                    int visibleFalseColumn = 0;
                    if (File.Exists(CPLDetectionGridSettingFilePath))
                    {
                        if (IsFirstTimeDetectionLoad == false)
                        {
                            IsFirstTimeDetectionLoad = true;
                            gridControl.RestoreLayoutFromXml(CPLDetectionGridSettingFilePath);
                        }
                        else
                        {
                            return;
                        }
                    }

                    //This code for save grid layout.
                    SelectedBasePriceName_Copy = SelectedBasePriceName;
                    gridControl.SaveLayoutToXml(CPLDetectionGridSettingFilePath);
                    foreach (BandItem band in ((Emdep.Geos.UI.Helper.MyGridControl)gridControl).BandsSource)
                    {
                        if (!band.Visible)
                        {
                            visibleFalseColumn++;
                        }
                    }

                    var list = gridControl.Columns.Where(a => Convert.ToString(((DevExpress.Xpf.Grid.BaseColumn)(a.Parent)).Header) == "Sale Price").ToList().OrderBy(x => x.VisibleIndex).ToList();

                    if (list != null && list.Count > 0)
                    {
                        if (((Currency)SelectedCurrency).Name != Convert.ToString(list.FirstOrDefault().Header))
                        {
                            int commonindex = list.FirstOrDefault(a => Convert.ToString(a.Header) == ((Currency)SelectedCurrency).Name).VisibleIndex;
                            int firstindex = list.FirstOrDefault().VisibleIndex;

                            list.Where(a => a.VisibleIndex == firstindex).ToList().ForEach(a => { a.VisibleIndex = commonindex; });
                            list.Where(a => Convert.ToString(a.Header) == ((Currency)SelectedCurrency).Name).ToList().ForEach(a => { a.VisibleIndex = firstindex; });
                        }
                    }

                    foreach (GridColumn column in gridControl.Columns)
                    {
                        DependencyPropertyDescriptor descriptor = DependencyPropertyDescriptor.FromProperty(GridColumn.VisibleProperty, typeof(GridColumn));
                        if (descriptor != null)
                        {
                            descriptor.AddValueChanged(column, DetectionVisibleChanged);
                        }

                        DependencyPropertyDescriptor descriptorColumnPosition = DependencyPropertyDescriptor.FromProperty(GridColumn.VisibleIndexProperty, typeof(GridColumn));
                        if (descriptorColumnPosition != null)
                        {
                            descriptorColumnPosition.AddValueChanged(column, DetectionVisibleIndexChanged);
                        }
                        DependencyPropertyDescriptor descriptorColumnFormatting = DependencyPropertyDescriptor.FromProperty(GridColumn.CellStyleProperty, typeof(GridColumn));
                        if (descriptorColumnFormatting != null)
                        {
                            descriptorColumnFormatting.AddValueChanged(column, DetectionVisibleIndexChanged);
                        }

                        if (!column.Visible)
                        {
                            visibleFalseColumn++;
                        }
                    }

                    if (visibleFalseColumn > 0)
                    {
                        if (tab.SelectedIndex == 1)
                            IsDetectionColumnChooserVisible = true;
                    }
                    else
                    {
                        IsDetectionColumnChooserVisible = false;
                    }

                    if (tab.SelectedIndex == 1)
                        IsArticleColumnChooserVisible = false;

                    tableView.SearchString = null;
                    tableView.ShowGroupPanel = false;
                    IsFirstTimeDetectionLoad = true;
                    FilterBPLAndCPL();

                    GeosApplication.Instance.Logger.Log("Method DetectionGridControlPropertyChangedCommandAction executed successfully...", category: Category.Info, priority: Priority.Low);
                    if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                }
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Error on DetectionGridControlPropertyChangedCommandAction() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        #endregion
        #region GEOS2-3272
        private ObservableCollection<TileBarFilters> filterStatusListOfTile;
        private TileBarFilters selectedTileBarItem;
        private List<GridColumn> GridColumnList;
        private bool isEdit;
        TableView view;
        private bool isFilterEnabled;
        private string userSettingsKeyForArticle = "PLM_CustomerPriceArticle_Filter_";
        private string userSettingsKeyForDetection = "PLM_CustomerPriceDetection_Filter_";
        public bool IsEdit
        {
            get
            {
                return isEdit;
            }
            set
            {
                isEdit = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsEdit"));
            }
        }
        public string FilterStringCriteria { get; set; }
        public string FilterStringName { get; set; }
        //string myFilterString;
        string height = "10";
        public string Height
        {
            get { return height; }
            set
            {
                height = value;
                OnPropertyChanged(new PropertyChangedEventArgs("Height"));
            }
        }
        Dictionary<string, string> BasePriceArticleFilter = new Dictionary<string, string>();
        //public string MyFilterString
        //{
        //    get { return myFilterString; }
        //    set
        //    {
        //        myFilterString = value;
        //        OnPropertyChanged(new PropertyChangedEventArgs("MyFilterString"));
        //    }
        //}
        public ObservableCollection<TileBarFilters> FilterStatusListOfTile
        {
            get { return filterStatusListOfTile; }
            set
            {
                filterStatusListOfTile = value;
                OnPropertyChanged(new PropertyChangedEventArgs("FilterStatusListOfTile"));
            }
        }
        public TileBarFilters SelectedTileBarItem
        {
            get { return selectedTileBarItem; }
            set
            {
                selectedTileBarItem = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedTileBarItem"));
            }
        }
        List<string> BPLArticleFilter = new List<string>();
        private void FilterEditorCreatedCommandAction(FilterEditorEventArgs obj)
        {
            try
            {
                BPLArticleFilter = new List<string>();
                obj.Handled = true;
                TableViewEx table = (TableViewEx)obj.OriginalSource;
                GridControl gridControl = (table).Grid;
                GridColumnList = gridControl.Columns.Where(x => x.Header != null).ToList();
                GridColumn column = GridColumnList.FirstOrDefault(x => x.Header.ToString().Equals("Status"));
                ShowFilterEditor(obj);
                if (BasePriceArticleFilter == null)
                    BasePriceArticleFilter = new Dictionary<string, string>();
                foreach (var Filter in GeosApplication.Instance.UserSettings)
                {
                    if (Filter.Key.StartsWith(userSettingsKeyForArticle))
                    {
                        if (!BasePriceArticleFilter.Any(a => a.Key == Filter.Key))
                            BasePriceArticleFilter.Add(Filter.Key, Filter.Value);
                        BPLArticleFilter.Add(Filter.Key.Replace(userSettingsKeyForArticle, ""));
                    }
                }
                //FillFilterTileBar();
                AddCustomSetting();
                SelectedTileBarItem = FilterStatusListOfTile.LastOrDefault();
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in FilterEditorCreatedCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        private void ShowFilterEditor(FilterEditorEventArgs e)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ShowFilterEditor()...", category: Category.Info, priority: Priority.Low);
                FilterEditorView filterEditorView = new FilterEditorView();
                FilterEditorViewModel filterEditorViewModel = new FilterEditorViewModel();
                string titleText = DevExpress.Xpf.Grid.GridControlLocalizer.Active.GetLocalizedString(GridControlStringId.FilterEditorTitle);
                if (IsEdit)
                {
                    filterEditorViewModel.FilterName = FilterStringName;
                    filterEditorViewModel.IsSave = true;
                    filterEditorViewModel.IsNew = false;
                    IsEdit = false;
                }
                else
                    filterEditorViewModel.IsNew = true;

                filterEditorViewModel.Init(e.FilterControl, FilterStatusListOfTile);
                filterEditorView.DataContext = filterEditorViewModel;
                EventHandler handle = delegate { filterEditorView.Close(); };
                filterEditorViewModel.RequestClose += handle;
                filterEditorView.Title = titleText;
                filterEditorView.Icon = DevExpress.Xpf.Core.Native.ImageHelper.CreateImageFromCoreEmbeddedResource("Editors.Images.FilterControl.filter.png");
                filterEditorView.Grid.Children.Add(e.FilterControl);
                filterEditorView.ShowDialog();

                if (filterEditorViewModel.IsDelete && !string.IsNullOrEmpty(filterEditorViewModel.FilterName) && filterEditorViewModel.IsSave)
                {
                    TileBarFilters tileBarItem = FilterStatusListOfTile.FirstOrDefault(x => x.Caption.Equals(FilterStringName));
                    if (tileBarItem != null)
                    {
                        FilterStatusListOfTile.Remove(tileBarItem);
                        List<Tuple<string, string>> lstUserConfiguration = new List<Tuple<string, string>>();
                        foreach (KeyValuePair<string, string> setting in GeosApplication.Instance.UserSettings)
                        {
                            string key = setting.Key;

                            if (setting.Key.Contains(userSettingsKeyForArticle))
                                key = setting.Key.Replace(userSettingsKeyForArticle, "");

                            if (!key.Equals(tileBarItem.Caption))
                                lstUserConfiguration.Add(new Tuple<string, string>(setting.Key.ToString(), setting.Value.ToString()));
                        }
                        ApplicationOperation.CreateNewSetting(lstUserConfiguration, GeosApplication.Instance.UserSettingFilePath, "UserSettings");
                        GeosApplication.Instance.UserSettings = ApplicationOperation.GetSetting(GeosApplication.Instance.UserSettingFilePath);
                    }
                }
                else if (filterEditorViewModel.FilterName != null && !string.IsNullOrEmpty(filterEditorViewModel.FilterName) && filterEditorViewModel.IsSave && !filterEditorViewModel.IsNew && filterEditorViewModel.IsCancel)
                {
                    TileBarFilters tileBarItem = FilterStatusListOfTile.FirstOrDefault(x => x.Caption.Equals(FilterStringName));
                    if (tileBarItem != null)
                    {
                        GridColumn column = GridColumnList.FirstOrDefault(x => x.Header.ToString() != null);
                        DevExpress.Xpf.Grid.GridControlBand gridControl = ((DevExpress.Xpf.Grid.GridControlBand)((System.Windows.FrameworkContentElement)(GridColumn)column).Parent);
                        int rowCount = 0;
                        if (FilterStatusListOfTile == null)
                            FilterStatusListOfTile = new ObservableCollection<TileBarFilters>();
                        FilterStringName = filterEditorViewModel.FilterName;
                        string filterCaption = tileBarItem.Caption;
                        tileBarItem.Caption = userSettingsKeyForArticle + filterEditorViewModel.FilterName;
                        tileBarItem.EntitiesCount = rowCount;
                        tileBarItem.EntitiesCountVisibility = Visibility.Visible;
                        tileBarItem.FilterCriteria = filterEditorViewModel.FilterCriteria;
                        List<Tuple<string, string>> lstUserConfiguration = new List<Tuple<string, string>>();
                        foreach (KeyValuePair<string, string> setting in GeosApplication.Instance.UserSettings)
                        {
                            string key = setting.Key;

                            if (setting.Key.Contains(userSettingsKeyForArticle))
                                key = setting.Key.Replace(userSettingsKeyForArticle, "");

                            if (!key.Equals(filterCaption))
                                lstUserConfiguration.Add(new Tuple<string, string>(setting.Key.ToString(), setting.Value.ToString()));
                            else
                                lstUserConfiguration.Add(new Tuple<string, string>(tileBarItem.Caption, tileBarItem.FilterCriteria));
                        }
                        ApplicationOperation.CreateNewSetting(lstUserConfiguration, GeosApplication.Instance.UserSettingFilePath, "UserSettings");
                        GeosApplication.Instance.UserSettings = ApplicationOperation.GetSetting(GeosApplication.Instance.UserSettingFilePath);
                    }
                }
                else if (filterEditorViewModel.FilterName != null && !string.IsNullOrEmpty(filterEditorViewModel.FilterName) && filterEditorViewModel.IsSave && filterEditorViewModel.IsNew && filterEditorViewModel.IsCancel)
                {
                    GridColumn column = GridColumnList.FirstOrDefault(x => x.Header.ToString() != null);
                    DevExpress.Xpf.Grid.GridControlBand gridControl = ((DevExpress.Xpf.Grid.GridControlBand)((System.Windows.FrameworkContentElement)(GridColumn)column).Parent);
                    int rowCount = 0;
                    if (FilterStatusListOfTile == null)
                        FilterStatusListOfTile = new ObservableCollection<TileBarFilters>();
                    FilterStatusListOfTile.Add(new TileBarFilters()
                    {
                        Caption = filterEditorViewModel.FilterName,
                        Id = 0,
                        BackColor = null,
                        ForeColor = null,
                        EntitiesCountVisibility = Visibility.Visible,
                        FilterCriteria = filterEditorViewModel.FilterCriteria,
                        EntitiesCount = rowCount,
                        Height = 58,
                        width = 188
                    });
                    SelectedTileBarItem = FilterStatusListOfTile.LastOrDefault();
                    string filterName = userSettingsKeyForArticle + filterEditorViewModel.FilterName;
                    GeosApplication.Instance.UserSettings[filterName] = filterEditorViewModel.FilterCriteria;
                    ApplicationOperation.CreateNewSetting(GeosApplication.Instance.UserSettings, GeosApplication.Instance.UserSettingFilePath, "UserSettings");
                    GeosApplication.Instance.UserSettings = ApplicationOperation.GetSetting(GeosApplication.Instance.UserSettingFilePath);
                }
                GeosApplication.Instance.Logger.Log("Method ShowFilterEditor() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method ShowFilterEditor() " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        public void FillFilterTileBar()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillFilterTileBar()...", category: Category.Info, priority: Priority.Low);
                FilterStatusListOfTile = new ObservableCollection<TileBarFilters>();
                ObservableCollection<GeosStatus> tempStatusList = new ObservableCollection<GeosStatus>();
                int _id = 1;

                if (DtArticle != null)
                {
                    var DtArticleList = DtArticle.AsEnumerable().ToList();
                    FilterStatusListOfTile.Add(new TileBarFilters()
                    {
                        Caption = (System.Windows.Application.Current.FindResource("BPLViewTileBarCaption").ToString()),
                        Id = 0,
                        BackColor = null,
                        ForeColor = null,
                        EntitiesCount = DtArticle.Rows.Count,
                        EntitiesCountVisibility = Visibility.Visible,
                        Height = 58,
                        width = 188
                    });

                    foreach (var item in tempStatusList)
                    {
                        FilterStatusListOfTile.Add(new TileBarFilters()
                        {
                            Caption = item.Name,
                            Id = _id++,
                            IdOfferStatusType = item.IdOfferStatusType,
                            BackColor = item.HtmlColor,
                            ForeColor = item.HtmlColor,
                            EntitiesCount = (DtArticleList.Where(x => (int)x.ItemArray[34] == item.IdOfferStatusType).ToList()).Count,
                            EntitiesCountVisibility = Visibility.Visible,
                            Height = 58,
                            width = 188
                        });
                    }
                }

                if (FilterStatusListOfTile.Count > 0)
                    SelectedTileBarItem = FilterStatusListOfTile[0];

                GeosApplication.Instance.Logger.Log("Method FillFilterTileBar() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method FillFilterTileBar() " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        private void AddCustomSetting()
        {
            try
            {
                DataTable tempDtArticle = new DataTable();
                FilterStatusListOfTile = new ObservableCollection<TileBarFilters>();
                GeosApplication.Instance.Logger.Log("Method AddCustomSetting()...", category: Category.Info, priority: Priority.Low);
                List<KeyValuePair<string, string>> tempUserSettings = GeosApplication.Instance.UserSettings.Where(x => x.Key.Contains(userSettingsKeyForArticle)).ToList();
                if (tempUserSettings != null && tempUserSettings.Count > 0)
                {
                    FilterStatusListOfTile.Add(
                    new TileBarFilters()
                    {
                        Caption = "ALL",
                        Id = 0,
                        BackColor = null,
                        ForeColor = null,
                        FilterCriteria = null,
                        EntitiesCount = DtArticle.Rows.Count,
                        EntitiesCountVisibility = Visibility.Visible,
                        Height = 58,
                        width = 188
                    });
                }
                if (DtArticle != null)
                {
                    tempDtArticle = DtArticle;
                    foreach (DataRow dtitem in tempDtArticle.Rows)
                    {
                        DataRow DataRow = (DataRow)dtitem;
                        for (int i = 0; i < dtitem.ItemArray.Count(); i++)
                        {
                            if (dtitem.ItemArray[i] is double)
                            {
                                //DataRow.ItemArray[i] = Math.Round((double)dtitem.ItemArray[i], 2);
                                double ItemArray = Math.Round((double)dtitem.ItemArray[i], 2);
                                DataRow.SetField(i, ItemArray);
                            }
                        }
                    }
                }
                foreach (var item in tempUserSettings)
                {
                    if (DtArticle != null)
                    {

                        int count = 0;
                        string filter = item.Value;
                        CriteriaOperator op = CriteriaOperator.Parse(filter);
                        try
                        {
                            op = CriteriaOperator.Parse(filter);
                            count = DtArticle.Select(CriteriaToWhereClauseHelper.GetDataSetWhere(op)).ToList().Count;
                        }
                        catch (Exception ex)
                        {
                            try
                            {
                                if (op != null)
                                {
                                    dynamic criteriaOperatorobj = op;
                                    if (criteriaOperatorobj.OperatorType is DevExpress.Data.Filtering.FunctionOperatorType)
                                    {
                                        if (criteriaOperatorobj.OperatorType == DevExpress.Data.Filtering.FunctionOperatorType.StartsWith)
                                        {
                                            var criteriaOperator = criteriaOperatorobj.Operands;
                                            DevExpress.Data.Filtering.OperandProperty operandProperty = criteriaOperator[0];
                                            op = CriteriaOperator.Parse("[" + operandProperty.PropertyName + "]" + '=' + criteriaOperator[1].Value);
                                            count = DtArticle.Select(CriteriaToWhereClauseHelper.GetDataSetWhere(op)).ToList().Count;
                                        }
                                    }
                                }
                            }
                            catch (Exception exc) { }
                            //GeosApplication.Instance.Logger.Log(string.Format("Error in Method AddCustomSetting() {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                        }

                        FilterStatusListOfTile.Add(
                            new TileBarFilters()
                            {
                                Caption = item.Key.Replace(userSettingsKeyForArticle, ""),
                                Id = 0,
                                BackColor = null,
                                ForeColor = null,
                                FilterCriteria = item.Value,
                                EntitiesCount = count,
                                EntitiesCountVisibility = Visibility.Visible,
                                Height = 58,
                                width = 188
                            });
                    }
                }

                GeosApplication.Instance.Logger.Log("Method AddCustomSetting() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method AddCustomSetting() " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        private void CustomShowFilterPopup(FilterPopupEventArgs e)
        {

            try
            {
                GeosApplication.Instance.Logger.Log(" Method CustomShowFilterPopup ...", category: Category.Info, priority: Priority.Low);

                GeosApplication.Instance.Logger.Log("Method CustomShowFilterPopup() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in CustomShowFilterPopup() method " + ex.Message, category: Category.Info, priority: Priority.Low);
            }
        }
        private void CommandFilterStatusTileClickAction(object obj)
        {
            try
            {
                System.Windows.Controls.SelectionChangedEventArgs Filter = (System.Windows.Controls.SelectionChangedEventArgs)obj;
                GeosApplication.Instance.Logger.Log("Method CommandFilterStatusTileClickAction()...", category: Category.Info, priority: Priority.Low);
                if (Filter.AddedItems.Count != 0)
                {
                    long statusIdType = ((TileBarFilters)((object[])((System.Windows.Controls.SelectionChangedEventArgs)obj).AddedItems)[0]).IdOfferStatusType;
                    string FilterString = ((TileBarFilters)((object[])((System.Windows.Controls.SelectionChangedEventArgs)obj).AddedItems)[0]).FilterCriteria;
                    FilterStringName = ((TileBarFilters)((object[])((System.Windows.Controls.SelectionChangedEventArgs)obj).AddedItems)[0]).Caption;
                    MyFilterString = FilterString;
                    if (!string.IsNullOrEmpty(FilterString) && string.IsNullOrEmpty(MyFilterString))
                    {
                        MyFilterString = FilterString;
                    }
                }
                GeosApplication.Instance.Logger.Log("Method CommandFilterStatusTileClickAction() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method CommandFilterStatusTileClickAction() " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        private void CommandTileBarClickDoubleClickAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method CommandTileBarClickDoubleClickAction()...", category: Category.Info, priority: Priority.Low);
                foreach (var item in FilterStatusListOfTile)
                {
                    if (FilterStringName != null)
                    {
                        if (FilterStringName.Equals(item.Caption))
                        {
                            //return;
                        }
                    }
                }

                if (FilterStringName.Equals(System.Windows.Application.Current.FindResource("BPLViewCustomFilter").ToString()) || FilterStringName.Equals(System.Windows.Application.Current.FindResource("BPLViewTileBarCaption").ToString()))
                {
                    return;
                }

                TableViewEx table = (TableViewEx)obj;
                GridControl gridControl = (table).Grid;
                GridColumnList = gridControl.Columns.Where(x => x.Header != null).ToList();
                GridColumn column = GridColumnList.FirstOrDefault(x => x.Header.ToString().Equals("Status"));
                IsEdit = true;
                table.ShowFilterEditor(column);
                GeosApplication.Instance.Logger.Log("Method CommandTileBarClickDoubleClickAction() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method CommandTileBarClickDoubleClickAction() " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        #region GEOS2-3272_Detection
        private ObservableCollection<TileBarFilters> DetectionfilterStatusListOfTile;
        private TileBarFilters DetectionselectedTileBarItem;
        private List<GridColumn> DetectionGridColumnList;
        private bool DetectionisEdit;
        TableView Detectionview;
        private bool DetectionisFilterEnabled;
        public bool DetectionIsEdit
        {
            get
            {
                return DetectionisEdit;
            }
            set
            {
                DetectionisEdit = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DetectionIsEdit"));
            }
        }
        public string DetectionFilterStringCriteria { get; set; }
        public string DetectionFilterStringName { get; set; }
        string detectionmyFilterString;
        string Detectionheight = "10";
        public string DetectionHeight
        {
            get { return Detectionheight; }
            set
            {
                Detectionheight = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DetectionHeight"));
            }
        }
        Dictionary<string, string> DetectionBasePriceArticleFilter = new Dictionary<string, string>();
        public string DetectionMyFilterString
        {
            get { return detectionmyFilterString; }
            set
            {
                detectionmyFilterString = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DetectionMyFilterString"));
            }
        }
        public ObservableCollection<TileBarFilters> DetectionFilterStatusListOfTile
        {
            get { return DetectionfilterStatusListOfTile; }
            set
            {
                DetectionfilterStatusListOfTile = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DetectionFilterStatusListOfTile"));
            }
        }
        public TileBarFilters DetectionSelectedTileBarItem
        {
            get { return DetectionselectedTileBarItem; }
            set
            {
                DetectionselectedTileBarItem = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DetectionSelectedTileBarItem"));
            }
        }
        List<string> DetectionBPLArticleFilter = new List<string>();
        private void DetectionFilterEditorCreatedCommandAction(FilterEditorEventArgs obj)
        {
            try
            {
                DetectionBPLArticleFilter = new List<string>();
                obj.Handled = true;
                TableViewEx table = (TableViewEx)obj.OriginalSource;
                GridControl gridControl = (table).Grid;
                GridColumnList = gridControl.Columns.Where(x => x.Header != null).ToList();
                GridColumn column = GridColumnList.FirstOrDefault(x => x.Header.ToString().Equals("Status"));
                DetectionShowFilterEditor(obj);
                if (DetectionBasePriceArticleFilter == null)
                    DetectionBasePriceArticleFilter = new Dictionary<string, string>();
                foreach (var Filter in GeosApplication.Instance.UserSettings)
                {
                    if (Filter.Key.StartsWith(userSettingsKeyForDetection))
                    {
                        if (!DetectionBasePriceArticleFilter.Any(a => a.Key == Filter.Key))
                            DetectionBasePriceArticleFilter.Add(Filter.Key, Filter.Value);
                        DetectionBPLArticleFilter.Add(Filter.Key.Replace(userSettingsKeyForDetection, ""));
                    }
                }
                //DetectionFillFilterTileBar();
                DetectionAddCustomSetting();
                DetectionSelectedTileBarItem = DetectionFilterStatusListOfTile.LastOrDefault();
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in DetectionFilterEditorCreatedCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        private void DetectionShowFilterEditor(FilterEditorEventArgs e)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method DetectionShowFilterEditor()...", category: Category.Info, priority: Priority.Low);
                FilterEditorView filterEditorView = new FilterEditorView();
                FilterEditorViewModel filterEditorViewModel = new FilterEditorViewModel();
                string titleText = DevExpress.Xpf.Grid.GridControlLocalizer.Active.GetLocalizedString(GridControlStringId.FilterEditorTitle);
                if (IsEdit)
                {
                    filterEditorViewModel.FilterName = DetectionFilterStringName;
                    filterEditorViewModel.IsSave = true;
                    filterEditorViewModel.IsNew = false;
                    IsEdit = false;
                }
                else
                    filterEditorViewModel.IsNew = true;

                filterEditorViewModel.Init(e.FilterControl, DetectionFilterStatusListOfTile);
                filterEditorView.DataContext = filterEditorViewModel;
                EventHandler handle = delegate { filterEditorView.Close(); };
                filterEditorViewModel.RequestClose += handle;
                filterEditorView.Title = titleText;
                filterEditorView.Icon = DevExpress.Xpf.Core.Native.ImageHelper.CreateImageFromCoreEmbeddedResource("Editors.Images.FilterControl.filter.png");
                filterEditorView.Grid.Children.Add(e.FilterControl);
                filterEditorView.ShowDialog();

                if (filterEditorViewModel.IsDelete && !string.IsNullOrEmpty(filterEditorViewModel.FilterName) && filterEditorViewModel.IsSave)
                {
                    TileBarFilters tileBarItem = DetectionFilterStatusListOfTile.FirstOrDefault(x => x.Caption.Equals(DetectionFilterStringName));
                    if (tileBarItem != null)
                    {
                        DetectionFilterStatusListOfTile.Remove(tileBarItem);
                        List<Tuple<string, string>> lstUserConfiguration = new List<Tuple<string, string>>();
                        foreach (KeyValuePair<string, string> setting in GeosApplication.Instance.UserSettings)
                        {
                            string key = setting.Key;

                            if (setting.Key.Contains(userSettingsKeyForDetection))
                                key = setting.Key.Replace(userSettingsKeyForDetection, "");

                            if (!key.Equals(tileBarItem.Caption))
                                lstUserConfiguration.Add(new Tuple<string, string>(setting.Key.ToString(), setting.Value.ToString()));
                        }
                        ApplicationOperation.CreateNewSetting(lstUserConfiguration, GeosApplication.Instance.UserSettingFilePath, "UserSettings");
                        GeosApplication.Instance.UserSettings = ApplicationOperation.GetSetting(GeosApplication.Instance.UserSettingFilePath);
                    }
                }
                else if (filterEditorViewModel.FilterName != null && !string.IsNullOrEmpty(filterEditorViewModel.FilterName) && filterEditorViewModel.IsSave && !filterEditorViewModel.IsNew && filterEditorViewModel.IsCancel)
                {
                    TileBarFilters tileBarItem = DetectionFilterStatusListOfTile.FirstOrDefault(x => x.Caption.Equals(DetectionFilterStringName));
                    if (tileBarItem != null)
                    {
                        GridColumn column = GridColumnList.FirstOrDefault(x => x.Header.ToString() != null);
                        DevExpress.Xpf.Grid.GridControlBand gridControl = ((DevExpress.Xpf.Grid.GridControlBand)((System.Windows.FrameworkContentElement)(GridColumn)column).Parent);
                        int rowCount = 0;
                        if (DetectionFilterStatusListOfTile == null)
                            DetectionFilterStatusListOfTile = new ObservableCollection<TileBarFilters>();
                        DetectionFilterStringName = userSettingsKeyForDetection + filterEditorViewModel.FilterName;
                        string filterCaption = tileBarItem.Caption;
                        tileBarItem.Caption = DetectionFilterStringName;
                        tileBarItem.EntitiesCount = rowCount;
                        tileBarItem.EntitiesCountVisibility = Visibility.Visible;
                        tileBarItem.FilterCriteria = filterEditorViewModel.FilterCriteria;
                        List<Tuple<string, string>> lstUserConfiguration = new List<Tuple<string, string>>();
                        foreach (KeyValuePair<string, string> setting in GeosApplication.Instance.UserSettings)
                        {
                            string key = setting.Key;

                            if (setting.Key.Contains(userSettingsKeyForDetection))
                                key = setting.Key.Replace(userSettingsKeyForDetection, "");

                            if (!key.Equals(filterCaption))
                                lstUserConfiguration.Add(new Tuple<string, string>(setting.Key.ToString(), setting.Value.ToString()));
                            else
                                lstUserConfiguration.Add(new Tuple<string, string>(tileBarItem.Caption, tileBarItem.FilterCriteria));
                        }
                        ApplicationOperation.CreateNewSetting(lstUserConfiguration, GeosApplication.Instance.UserSettingFilePath, "UserSettings");
                        GeosApplication.Instance.UserSettings = ApplicationOperation.GetSetting(GeosApplication.Instance.UserSettingFilePath);
                    }
                }
                else if (filterEditorViewModel.FilterName != null && !string.IsNullOrEmpty(filterEditorViewModel.FilterName) && filterEditorViewModel.IsSave && filterEditorViewModel.IsNew && filterEditorViewModel.IsCancel)
                {
                    GridColumn column = GridColumnList.FirstOrDefault(x => x.Header.ToString() != null);
                    DevExpress.Xpf.Grid.GridControlBand gridControl = ((DevExpress.Xpf.Grid.GridControlBand)((System.Windows.FrameworkContentElement)(GridColumn)column).Parent);
                    int rowCount = 0;
                    if (DetectionFilterStatusListOfTile == null)
                        DetectionFilterStatusListOfTile = new ObservableCollection<TileBarFilters>();
                    DetectionFilterStatusListOfTile.Add(new TileBarFilters()
                    {
                        Caption = filterEditorViewModel.FilterName,
                        Id = 0,
                        BackColor = null,
                        ForeColor = null,
                        EntitiesCountVisibility = Visibility.Visible,
                        FilterCriteria = filterEditorViewModel.FilterCriteria,
                        EntitiesCount = rowCount,
                        Height = 58,
                        width = 188
                    });
                    DetectionSelectedTileBarItem = DetectionFilterStatusListOfTile.LastOrDefault();
                    string filterName = userSettingsKeyForDetection + filterEditorViewModel.FilterName;
                    GeosApplication.Instance.UserSettings[filterName] = filterEditorViewModel.FilterCriteria;
                    ApplicationOperation.CreateNewSetting(GeosApplication.Instance.UserSettings, GeosApplication.Instance.UserSettingFilePath, "UserSettings");
                    GeosApplication.Instance.UserSettings = ApplicationOperation.GetSetting(GeosApplication.Instance.UserSettingFilePath);
                }
                GeosApplication.Instance.Logger.Log("Method DetectionShowFilterEditor() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method DetectionShowFilterEditor() " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        public void DetectionFillFilterTileBar()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method DetectionFillFilterTileBar()...", category: Category.Info, priority: Priority.Low);
                DetectionFilterStatusListOfTile = new ObservableCollection<TileBarFilters>();
                ObservableCollection<GeosStatus> tempStatusList = new ObservableCollection<GeosStatus>();
                int _id = 1;

                if (DtDetection != null)
                {
                    var DtDetectionList = DtDetection.AsEnumerable().ToList();
                    DetectionFilterStatusListOfTile.Add(new TileBarFilters()
                    {
                        Caption = (System.Windows.Application.Current.FindResource("BPLViewTileBarCaption").ToString()),
                        Id = 0,
                        BackColor = null,
                        ForeColor = null,
                        EntitiesCount = DtDetection.Rows.Count,
                        EntitiesCountVisibility = Visibility.Visible,
                        Height = 58,
                        width = 188
                    });

                    foreach (var item in tempStatusList)
                    {
                        DetectionFilterStatusListOfTile.Add(new TileBarFilters()
                        {
                            Caption = item.Name,
                            Id = _id++,
                            IdOfferStatusType = item.IdOfferStatusType,
                            BackColor = item.HtmlColor,
                            ForeColor = item.HtmlColor,
                            EntitiesCount = (DtDetectionList.Where(x => (int)x.ItemArray[34] == item.IdOfferStatusType).ToList()).Count,
                            EntitiesCountVisibility = Visibility.Visible,
                            Height = 58,
                            width = 188
                        });
                    }
                }

                if (DetectionFilterStatusListOfTile.Count > 0)
                    DetectionSelectedTileBarItem = DetectionFilterStatusListOfTile[0];

                GeosApplication.Instance.Logger.Log("Method DetectionFillFilterTileBar() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method DetectionFillFilterTileBar() " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        private void DetectionAddCustomSetting()
        {
            try
            {
                DataTable tempDtDetection = new DataTable();
                DetectionFilterStatusListOfTile = new ObservableCollection<TileBarFilters>();
                GeosApplication.Instance.Logger.Log("Method DetectionAddCustomSetting()...", category: Category.Info, priority: Priority.Low);
                List<KeyValuePair<string, string>> tempUserSettings = GeosApplication.Instance.UserSettings.Where(x => x.Key.Contains(userSettingsKeyForDetection)).ToList();
                if (tempUserSettings != null && tempUserSettings.Count > 0)
                {
                    DetectionFilterStatusListOfTile.Add(
                    new TileBarFilters()
                    {
                        Caption = "ALL",
                        Id = 0,
                        BackColor = null,
                        ForeColor = null,
                        FilterCriteria = null,
                        EntitiesCount = DtDetection.Rows.Count,
                        EntitiesCountVisibility = Visibility.Visible,
                        Height = 58,
                        width = 188
                    });
                }
                if (DtDetection != null)
                {
                    tempDtDetection = DtDetection;
                    foreach (DataRow dtitem in tempDtDetection.Rows)
                    {
                        DataRow DataRow = (DataRow)dtitem;
                        for (int i = 0; i < dtitem.ItemArray.Count(); i++)
                        {
                            if (dtitem.ItemArray[i] is double)
                            {
                                //DataRow.ItemArray[i] = Math.Round((double)dtitem.ItemArray[i], 2);
                                double ItemArray = Math.Round((double)dtitem.ItemArray[i], 2);
                                DataRow.SetField(i, ItemArray);
                            }
                        }
                    }
                }
                foreach (var item in tempUserSettings)
                {
                    if (DtDetection != null)
                    {

                        int count = 0;
                        string filter = item.Value;
                        CriteriaOperator op = CriteriaOperator.Parse(filter);
                        try
                        {
                            count = DtDetection.Select(CriteriaToWhereClauseHelper.GetDataSetWhere(op)).ToList().Count;
                        }
                        catch (Exception ex)
                        {
                            try
                            {
                                if (op != null)
                                {
                                    dynamic criteriaOperatorobj = op;
                                    if (criteriaOperatorobj.OperatorType is DevExpress.Data.Filtering.FunctionOperatorType)
                                    {
                                        if (criteriaOperatorobj.OperatorType == DevExpress.Data.Filtering.FunctionOperatorType.StartsWith)
                                        {
                                            var criteriaOperator = criteriaOperatorobj.Operands;
                                            DevExpress.Data.Filtering.OperandProperty operandProperty = criteriaOperator[0];
                                            op = CriteriaOperator.Parse("[" + operandProperty.PropertyName + "]" + '=' + criteriaOperator[1].Value);
                                            count = DtArticle.Select(CriteriaToWhereClauseHelper.GetDataSetWhere(op)).ToList().Count;
                                        }
                                    }
                                }
                            }
                            catch (Exception exc) { }
                            //GeosApplication.Instance.Logger.Log(string.Format("Error in Method AddCustomSetting() {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                        }

                        DetectionFilterStatusListOfTile.Add(
                            new TileBarFilters()
                            {
                                Caption = item.Key.Replace(userSettingsKeyForDetection, ""),
                                Id = 0,
                                BackColor = null,
                                ForeColor = null,
                                FilterCriteria = item.Value,
                                EntitiesCount = count,
                                EntitiesCountVisibility = Visibility.Visible,
                                Height = 58,
                                width = 188
                            });
                    }
                }

                GeosApplication.Instance.Logger.Log("Method DetectionAddCustomSetting() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method DetectionAddCustomSetting() " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        private void DetectionCustomShowFilterPopup(FilterPopupEventArgs e)
        {

            try
            {
                GeosApplication.Instance.Logger.Log(" Method DetectionCustomShowFilterPopup ...", category: Category.Info, priority: Priority.Low);

                GeosApplication.Instance.Logger.Log("Method DetectionCustomShowFilterPopup() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in DetectionCustomShowFilterPopup() method " + ex.Message, category: Category.Info, priority: Priority.Low);
            }
        }
        private void DetectionCommandFilterStatusTileClickAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method DetectionCommandFilterStatusTileClickAction()...", category: Category.Info, priority: Priority.Low);
                System.Windows.Controls.SelectionChangedEventArgs Filter = (System.Windows.Controls.SelectionChangedEventArgs)obj;
                if (Filter.AddedItems.Count != 0)
                {
                    long statusIdType = ((TileBarFilters)((object[])((System.Windows.Controls.SelectionChangedEventArgs)obj).AddedItems)[0]).IdOfferStatusType;
                    string FilterString = ((TileBarFilters)((object[])((System.Windows.Controls.SelectionChangedEventArgs)obj).AddedItems)[0]).FilterCriteria;
                    DetectionFilterStringName = ((TileBarFilters)((object[])((System.Windows.Controls.SelectionChangedEventArgs)obj).AddedItems)[0]).Caption;
                    //DetectionMyFilterString = FilterString;
                    MyFilterString = FilterString;
                }
                GeosApplication.Instance.Logger.Log("Method DetectionCommandFilterStatusTileClickAction() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method DetectionCommandFilterStatusTileClickAction() " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        private void DetectionCommandTileBarClickDoubleClickAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method DetectionCommandTileBarClickDoubleClickAction()...", category: Category.Info, priority: Priority.Low);
                foreach (var item in FilterStatusListOfTile)
                {
                    if (DetectionFilterStringName != null)
                    {
                        if (DetectionFilterStringName.Equals(item.Caption))
                        {
                            //return;
                        }
                    }
                }

                if (DetectionFilterStringName.Equals(System.Windows.Application.Current.FindResource("BPLViewCustomFilter").ToString()) || DetectionFilterStringName.Equals(System.Windows.Application.Current.FindResource("BPLViewTileBarCaption").ToString()))
                {
                    return;
                }

                TableViewEx table = (TableViewEx)obj;
                GridControl gridControl = (table).Grid;
                DetectionGridColumnList = gridControl.Columns.Where(x => x.Header != null).ToList();
                GridColumn column = DetectionGridColumnList.FirstOrDefault(x => x.Header.ToString().Equals("Status"));
                IsEdit = true;
                table.ShowFilterEditor(column);
                GeosApplication.Instance.Logger.Log("Method DetectionCommandTileBarClickDoubleClickAction() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method DetectionCommandTileBarClickDoubleClickAction() " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        #endregion
        #endregion
        #region GEOS2-2885
        //Shubham[skadam] GEOS2-2885 [Only Modules ] - Search the Article categories (and sub-categories), Modules and Detection (DOWS) in BPL [3/3][#PLM09]  15 03 2023
        private ObservableCollection<BPLModule> moduleMenuList;
        private BPLModule selectedModule;
        public ObservableCollection<BPLModule> ModuleMenulist
        {
            get
            {
                return moduleMenuList;
            }

            set
            {
                moduleMenuList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ModuleMenulist"));
            }
        }

        public BPLModule SelectedModule
        {
            get
            {
                return selectedModule;
            }

            set
            {
                selectedModule = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SelectedModule"));
            }
        }
        private void FillModuleMenuList()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillModuleMenuList()...", category: Category.Info, priority: Priority.Low);

                //ModuleMenulist = new ObservableCollection<ProductTypesTemplate>(PCMService.GetProductTypesWithTemplate());
                //PCMService = new PCMServiceController("localhost:6699");
                ModuleMenulist = new ObservableCollection<BPLModule>(PCMService.GetProductTypesWithTemplate_V2370());
                SelectedModule = ModuleMenulist.FirstOrDefault();

                GeosApplication.Instance.Logger.Log("Method FillModuleMenuList()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillModuleMenuList() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillModuleMenuList() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method FillModuleMenuList() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        #endregion

        #region GEOS2-2886
        //Shubham[skadam] GEOS2-2886 [Only Modules ] - Able to  add and access to the tab Modules/Detection /Articles a Base Price List [3/3] [#PLM07] 21 03 2023
        DataTable dtModule;
        public DataTable DtModule
        {
            get { return dtModule; }
            set
            {
                dtModule = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DtModule"));
            }
        }
        DataTable dtModuleCopy;
        public DataTable DtModuleCopy
        {
            get { return dtModuleCopy; }
            set
            {
                dtModuleCopy = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DtModuleCopy"));
            }
        }
        List<UInt64> addModules;
        public List<UInt64> AddModules
        {
            get
            {
                return addModules;
            }

            set
            {
                addModules = value;
                OnPropertyChanged(new PropertyChangedEventArgs("AddModules"));
            }
        }
        private ObservableCollection<BandItem> moduleBands = new ObservableCollection<BandItem>();
        public ObservableCollection<BandItem> ModuleBands
        {
            get { return moduleBands; }
            set
            {
                moduleBands = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ModuleBands"));
            }
        }

        List<BPLModule> deleteModules;
        public List<BPLModule> DeleteModules
        {
            get { return deleteModules; }
            set
            {
                deleteModules = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DeleteModules"));
            }
        }
        List<CustomerPriceListByItem> deleteModuleFromCPL;
        public List<CustomerPriceListByItem> DeleteModuleFromCPL
        {
            get
            {
                return deleteModuleFromCPL;
            }

            set
            {
                deleteModuleFromCPL = value;
                OnPropertyChanged(new PropertyChangedEventArgs("DeleteModuleFromCPL"));
            }
        }
        ObservableCollection<CustomerPriceListByItem> moduleList;
        public ObservableCollection<CustomerPriceListByItem> ModuleList
        {
            get { return moduleList; }
            set
            {
                moduleList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ModuleList"));
            }
        }

        public bool isDuplicateCliked = false;
        private List<CustomerPrice> cpList;
        private bool isUpdatedBasePriceSave;
        public List<CustomerPrice> CPList
        {
            get
            {
                return cpList;
            }
            set
            {
                cpList = value;
                OnPropertyChanged(new PropertyChangedEventArgs("CPList"));
            }
        }
        private List<CustomerPriceListByItem> savedModules;
        public List<CustomerPriceListByItem> SavedModules
        {
            get
            {
                return savedModules;
            }

            set
            {
                savedModules = value;
                OnPropertyChanged(new PropertyChangedEventArgs("SavedModules"));
            }
        }
        bool isFirstTimeModuleLoad;
        public bool IsFirstTimeModuleLoad
        {
            get
            {
                return isFirstTimeModuleLoad;
            }

            set
            {
                isFirstTimeModuleLoad = value;
                OnPropertyChanged(new PropertyChangedEventArgs("IsFirstTimeModuleLoad"));
            }
        }
        //TileBarFilters moduleselectedTileBarItem;
        //public TileBarFilters ModuleSelectedTileBarItem
        //{
        //    get { return moduleselectedTileBarItem; }
        //    set
        //    {
        //        moduleselectedTileBarItem = value;
        //        OnPropertyChanged(new PropertyChangedEventArgs("ModuleSelectedTileBarItem"));
        //    }
        //}
        int moduleCount;
        public int ModuleCount
        {
            get
            {
                return moduleCount;
            }

            set
            {
                moduleCount = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ModuleCount"));
            }
        }
        private void AddColumnsToModuleDataTable01()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method AddColumnsToModuleDataTable ...", category: Category.Info, priority: Priority.Low);
                if (SelectedSaleCurrency == null)
                    SelectedSaleCurrency = new List<object>();

                if (SelectedCurrency == null)
                {
                    SelectedCurrency = new List<object>();
                }

                if (ModuleBands.Count > 0)
                {
                    foreach (BandItem bandItem in ModuleBands)
                    {
                        if (bandItem.BandHeader == "Max Cost")
                        {
                            if (((Currency)SelectedCurrency).Name != bandItem.Columns.FirstOrDefault().HeaderText)
                            {
                                string fieldName = bandItem.Columns.FirstOrDefault().ColumnFieldName;
                                DtModuleCopy.Columns.Remove(fieldName);
                                bandItem.Columns.Remove(bandItem.Columns.FirstOrDefault());

                                string fieldName2 = "MaxCost_1";
                                DtModuleCopy.Columns.Add(fieldName2, typeof(double));
                                bandItem.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName2, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.MaxCost });

                            }
                        }
                        else if (bandItem.BandHeader == "Sale Price")
                        {
                            foreach (Currency currency in SelectedSaleCurrency)
                            {
                                if (!bandItem.Columns.Any(a => a.HeaderText == currency.Name))
                                {
                                    string fieldName = currency.Name;
                                    DtModuleCopy.Columns.Add(fieldName, typeof(double));
                                    bandItem.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = fieldName, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                    DtModuleCopy.Columns.Add("CurrencyConversionRate_" + currency.Name, typeof(double));
                                }
                            }
                            List<ColumnItem> columns = new List<ColumnItem>(bandItem.Columns);
                            if (bandItem.Columns.Count != SelectedSaleCurrency.Count)
                            {
                                foreach (ColumnItem columnItem in columns.ToList())
                                {
                                    if (!SelectedSaleCurrency.Cast<Currency>().Any(a => a.Name == columnItem.HeaderText))
                                    {
                                        string fieldName = columnItem.HeaderText;
                                        DtModuleCopy.Columns.Remove(fieldName);
                                        bandItem.Columns.Remove(columnItem);

                                        DtModuleCopy.Columns.Remove("CurrencyConversionRate_" + fieldName);
                                    }
                                }
                            }
                            if (!SelectedSaleCurrency.Cast<Currency>().Any(a => a.Name == ((Currency)SelectedCurrency).Name))
                            {
                                SelectedSaleCurrency.Add(SaleCurrencyList.FirstOrDefault(a => a.Name == ((Currency)SelectedCurrency).Name));
                                SelectedSaleCurrency = new List<object>(SelectedSaleCurrency);
                                string fieldName = "Common_Cur";
                                DtModuleCopy.Columns.Remove(fieldName);
                                DtModuleCopy.Columns.Add(fieldName, typeof(double));
                                bandItem.Columns.Remove(bandItem.Columns.FirstOrDefault(a => a.ColumnFieldName == fieldName));
                                bandItem.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });

                                DtModuleCopy.Columns.Remove("CurrencyConversionRate_" + fieldName);
                                DtModuleCopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));


                                string fieldName1 = ((Currency)SelectedCurrency_Copy).Name;
                                DtModuleCopy.Columns.Add(fieldName1, typeof(double));
                                bandItem.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName1, HeaderText = fieldName1, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                DtModuleCopy.Columns.Add("CurrencyConversionRate_" + fieldName1, typeof(double));

                                SelectedSaleCurrency_Copy = SelectedSaleCurrency;
                            }
                        }
                    }

                    // reorder by common currency
                    BandItem item = ModuleBands.FirstOrDefault(a => a.BandHeader == "Sale Price");
                    if (item.Columns.FirstOrDefault().HeaderText != ((Currency)SelectedCurrency).Name)
                    {
                        int count = 0;
                        foreach (Currency item1 in SelectedSaleCurrency.Cast<Currency>())
                        {
                            if (count == 0)
                            {
                                count = 1;
                                //string fieldName = ((Currency)SelectedCurrency).Name;
                                string fieldName = "Common_Cur";
                                DtModuleCopy.Columns.Remove(fieldName);
                                DtModuleCopy.Columns.Add(fieldName, typeof(double));
                                item.Columns.Remove(item.Columns.FirstOrDefault(a => a.ColumnFieldName == fieldName));
                                item.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                DtModuleCopy.Columns.Remove("CurrencyConversionRate_" + fieldName);
                                DtModuleCopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));

                                if (DtModuleCopy.Columns.Contains(((Currency)SelectedCurrency).Name))
                                    DtModuleCopy.Columns.Remove(((Currency)SelectedCurrency).Name);

                                if (DtModuleCopy.Columns.Contains("CurrencyConversionRate_" + ((Currency)SelectedCurrency).Name))
                                    DtModuleCopy.Columns.Remove("CurrencyConversionRate_" + ((Currency)SelectedCurrency).Name);

                                item.Columns.Remove(item.Columns.FirstOrDefault(a => a.ColumnFieldName == ((Currency)SelectedCurrency).Name));

                                if (item1.Name != ((Currency)SelectedCurrency).Name)
                                {
                                    string fieldName1 = item1.Name;
                                    if (DtModuleCopy.Columns.Contains(fieldName1))
                                        DtModuleCopy.Columns.Remove(fieldName1);

                                    DtModuleCopy.Columns.Add(fieldName1, typeof(double));
                                    item.Columns.Remove(item.Columns.FirstOrDefault(a => a.ColumnFieldName == fieldName1));
                                    item.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName1, HeaderText = fieldName1, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });

                                    if (DtModuleCopy.Columns.Contains("CurrencyConversionRate_" + fieldName1))
                                        DtModuleCopy.Columns.Remove("CurrencyConversionRate_" + fieldName1);

                                    DtModuleCopy.Columns.Add("CurrencyConversionRate_" + fieldName1, typeof(double));
                                }
                            }
                            else
                            {
                                if (item1.Name != ((Currency)SelectedCurrency).Name)
                                {
                                    string fieldName = item1.Name;
                                    if (DtModuleCopy.Columns.Contains(fieldName))
                                        DtModuleCopy.Columns.Remove(fieldName);

                                    DtModuleCopy.Columns.Add(fieldName, typeof(double));
                                    item.Columns.Remove(item.Columns.FirstOrDefault(a => a.ColumnFieldName == fieldName));
                                    item.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = fieldName, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });

                                    if (DtModuleCopy.Columns.Contains("CurrencyConversionRate_" + fieldName))
                                        DtModuleCopy.Columns.Remove("CurrencyConversionRate_" + fieldName);

                                    DtModuleCopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));
                                }
                            }
                        }
                    }
                    ModuleBands = new ObservableCollection<BandItem>(ModuleBands);
                }
                else
                {
                    ModuleBands.Clear();
                    DtModuleCopy = new DataTable();

                    BandItem band1 = new BandItem() { BandName = "all5", AllowBandMove = false, FixedStyle = FixedStyle.Left, Visible = true, AllowMoving = DevExpress.Utils.DefaultBoolean.False };
                    band1.Columns = new ObservableCollection<ColumnItem>();
                    band1.Columns.Add(new ColumnItem() { ColumnFieldName = "IsChecked", HeaderText = " ", Width = 50, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    band1.Columns.Add(new ColumnItem() { ColumnFieldName = "Code", HeaderText = "Code", Width = 100, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    ModuleBands.Add(band1);

                    BandItem band2 = new BandItem() { BandName = "all6", Visible = true };
                    band2.Columns = new ObservableCollection<ColumnItem>();
                    band2.Columns.Add(new ColumnItem() { ColumnFieldName = "Name", HeaderText = "Name", Width = 350, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    band2.Columns.Add(new ColumnItem() { ColumnFieldName = "Type", HeaderText = "Template", Width = 100, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    band2.Columns.Add(new ColumnItem() { ColumnFieldName = "STAT", HeaderText = "STAT", Width = 40, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    //  band2.Columns.Add(new ColumnItem() { ColumnFieldName = "HtmlColor", HeaderText = "HtmlColor", Width = 10, Visible = false, IsVertical = false, Settings = SettingsType.Hidden });

                    ModuleBands.Add(band2);

                    DtModuleCopy.Columns.Add("IsChecked", typeof(bool));
                    DtModuleCopy.Columns.Add("Code", typeof(string));
                    DtModuleCopy.Columns.Add("Type", typeof(string));
                    DtModuleCopy.Columns.Add("STAT", typeof(string));
                    DtModuleCopy.Columns.Add("HtmlColor", typeof(string));
                    DtModuleCopy.Columns.Add("Name", typeof(string));
                    DtModuleCopy.Columns.Add("IdCPType", typeof(UInt32));
                    DtModuleCopy.Columns.Add("CurrencyConversionDate", typeof(DateTime));
                    DtModuleCopy.Columns.Add("IsColor", typeof(bool)).DefaultValue = false;
                    DtModuleCopy.Columns.Add("IsUpdatedRow", typeof(bool)).DefaultValue = false;
                    DtModuleCopy.Columns.Add("SaleCurrencyConversionDate", typeof(string));


                    //Max Cost
                    BandItem band3 = new BandItem() { BandName = "max Cost", BandHeader = "Max Cost", Visible = true };
                    band3.Columns = new ObservableCollection<ColumnItem>();
                    string fieldName2 = "MaxCost_1";
                    DtModuleCopy.Columns.Add(fieldName2, typeof(double));
                    band3.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName2, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.MaxCost });
                    ModuleBands.Add(band3);

                    //rule
                    BandItem band4 = new BandItem() { BandName = "rule", BandHeader = "Rule", Visible = true };
                    band4.Columns = new ObservableCollection<ColumnItem>();

                    string fieldName3 = "Value";
                    DtModuleCopy.Columns.Add("Value", typeof(float));
                    band4.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName3, HeaderText = fieldName3, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });

                    string fieldName4 = "Logic";
                    DtModuleCopy.Columns.Add(fieldName4, typeof(int));
                    band4.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName4, HeaderText = fieldName4, Width = 50, Visible = true, IsVertical = false, Settings = SettingsType.Default });

                    ModuleBands.Add(band4);

                    //Sale Currency
                    BandItem band5 = new BandItem() { BandName = "sale Price", BandHeader = "Sale Price", Visible = true };
                    band5.Columns = new ObservableCollection<ColumnItem>();
                    int count = 0;
                    foreach (Currency currency in SelectedSaleCurrency)
                    {
                        // code modified for reorder by common currency 
                        if (count == 0)
                        {
                            count = 1;
                            string fieldName = "Common_Cur";
                            DtModuleCopy.Columns.Add(fieldName, typeof(double));
                            band5.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                            DtModuleCopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));

                            if (currency.Name != ((Currency)SelectedCurrency).Name)
                            {
                                string fieldName1 = currency.Name;
                                DtModuleCopy.Columns.Add(fieldName1, typeof(double));
                                band5.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName1, HeaderText = fieldName1, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                DtModuleCopy.Columns.Add("CurrencyConversionRate_" + fieldName1, typeof(double));
                            }
                        }
                        else
                        {
                            if (currency.Name != ((Currency)SelectedCurrency).Name)
                            {
                                string fieldName1 = currency.Name;
                                DtModuleCopy.Columns.Add(fieldName1, typeof(double));
                                band5.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName1, HeaderText = fieldName1, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                DtModuleCopy.Columns.Add("CurrencyConversionRate_" + fieldName1, typeof(double));
                            }
                        }
                    }

                    ModuleBands.Add(band5);

                    //Profit
                    BandItem band6 = new BandItem() { BandName = "all7", Visible = true };
                    band6.Columns = new ObservableCollection<ColumnItem>();
                    string fieldName5 = "Profit";
                    DtModuleCopy.Columns.Add(fieldName5, typeof(double));
                    band6.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName5, HeaderText = "Profit", Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });
                    ModuleBands.Add(band6);

                    //Cost Margin
                    BandItem band7 = new BandItem() { BandName = "all8", Visible = true };
                    band7.Columns = new ObservableCollection<ColumnItem>();
                    string fieldName6 = "CostMargin";
                    DtModuleCopy.Columns.Add(fieldName6, typeof(double));
                    band7.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName6, HeaderText = "Cost Margin", Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });
                    ModuleBands.Add(band7);

                    // Delete Button
                    BandItem band8 = new BandItem() { BandName = "all9", AllowBandMove = false, Visible = true, AllowMoving = DevExpress.Utils.DefaultBoolean.False };
                    band8.Columns = new ObservableCollection<ColumnItem>();
                    band8.Columns.Add(new ColumnItem() { ColumnFieldName = "Delete", HeaderText = " ", Width = 50, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    ModuleBands.Add(band8);

                    ModuleBands = new ObservableCollection<BandItem>(ModuleBands);
                }
                GeosApplication.Instance.Logger.Log("Method AddColumnsToModuleDataTable executed Successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in AddColumnsToModuleDataTable() method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), "Red", CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in AddColumnsToModuleDataTable() Method - ServiceUnexceptedException " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in AddColumnsToModuleDataTable() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        private void AddColumnsToModuleDataTable()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method AddColumnsToModuleDataTable ...", category: Category.Info, priority: Priority.Low);
                if (SelectedSaleCurrency == null)
                    SelectedSaleCurrency = new List<object>();
                if (SelectedCurrency == null)
                    SelectedCurrency = new List<object>();
                ModuleBands.Clear();
                BandItem band1 = new BandItem() { BandName = "All", AllowBandMove = false, FixedStyle = FixedStyle.Left, Visible = true, AllowMoving = DevExpress.Utils.DefaultBoolean.False };
                band1.Columns = new ObservableCollection<ColumnItem>();
                band1.Columns.Add(new ColumnItem() { ColumnFieldName = "IsChecked", HeaderText = " ", Width = 50, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                band1.Columns.Add(new ColumnItem() { ColumnFieldName = "VisibleCustomer", HeaderText = " ", Width = 40, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                band1.Columns.Add(new ColumnItem() { ColumnFieldName = "Code", HeaderText = "Code", Width = 100, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                ModuleBands.Add(band1);

                BandItem band2 = new BandItem() { BandName = "All1", BandHeader = "" };
                band2.Columns = new ObservableCollection<ColumnItem>();
                band2.Columns.Add(new ColumnItem() { ColumnFieldName = "Name", HeaderText = "Name", Width = 350, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                band2.Columns.Add(new ColumnItem() { ColumnFieldName = "NameChanged", HeaderText = " ", Width = 40, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                band2.Columns.Add(new ColumnItem() { ColumnFieldName = "Type", HeaderText = "Template", Width = 100, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                band2.Columns.Add(new ColumnItem() { ColumnFieldName = "STAT", HeaderText = "STAT", Width = 40, IsVertical = false, Settings = SettingsType.Default, Visible = true });

                ModuleBands.Add(band2);

                DtModuleCopy = new DataTable();
                DtModuleCopy.Columns.Add("IsChecked", typeof(bool));
                DtModuleCopy.Columns.Add("VisibleCustomer", typeof(string));
                DtModuleCopy.Columns.Add("Code", typeof(string));
                DtModuleCopy.Columns.Add("Type", typeof(string));
                DtModuleCopy.Columns.Add("STAT", typeof(string));
                DtModuleCopy.Columns.Add("HtmlColor", typeof(string));
                DtModuleCopy.Columns.Add("Name", typeof(string));
                DtModuleCopy.Columns.Add("IdCPType", typeof(UInt32));
                DtModuleCopy.Columns.Add("CurrencyConversionDate", typeof(DateTime));
                DtModuleCopy.Columns.Add("Name_Old", typeof(string));
                DtModuleCopy.Columns.Add("Name_Changed", typeof(bool));
                DtModuleCopy.Columns.Add("Visible_Customer", typeof(bool)).DefaultValue = false;
                DtModuleCopy.Columns.Add("Enable_VisibleCustomer", typeof(bool)).DefaultValue = false;
                DtModuleCopy.Columns.Add("Enable_DescriptionLinked", typeof(bool)).DefaultValue = false;
                DtModuleCopy.Columns.Add("IsColor", typeof(bool)).DefaultValue = false;
                DtModuleCopy.Columns.Add("IsSalePriceValueColor", typeof(bool)).DefaultValue = false;
                DtModuleCopy.Columns.Add("NameChanged", typeof(string)).DefaultValue = "Not Changed";
                DtModuleCopy.Columns.Add("Enable_Delete", typeof(bool)).DefaultValue = false;
                DtModuleCopy.Columns.Add("IsUpdatedRow", typeof(bool)).DefaultValue = false;
                DtModuleCopy.Columns.Add("SaleCurrencyConversionDate", typeof(string));

                //max cost	
                BandItem band3 = new BandItem() { BandName = "max cost", BandHeader = "Max Cost" };
                band3.Columns = new ObservableCollection<ColumnItem>();
                string fieldName2 = "MaxCost_1";
                DtModuleCopy.Columns.Add(fieldName2, typeof(double));
                band3.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName2, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.MaxCost });
                ModuleBands.Add(band3);
                //Base price	
                BandItem band4 = new BandItem() { BandName = "base price", BandHeader = "Base Price" };
                band4.Columns = new ObservableCollection<ColumnItem>();
                string fieldName5 = "BasePriceValue";
                DtModuleCopy.Columns.Add(fieldName5, typeof(double));
                band4.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName5, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });
                ModuleBands.Add(band4);
                //rule	
                BandItem band5 = new BandItem() { BandName = "rule", BandHeader = "Rule" };
                band5.Columns = new ObservableCollection<ColumnItem>();
                string fieldName3 = "Value";
                DtModuleCopy.Columns.Add("Value", typeof(float));
                band5.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName3, HeaderText = fieldName3, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });
                string fieldName4 = "Logic";
                DtModuleCopy.Columns.Add(fieldName4, typeof(int));
                band5.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName4, HeaderText = fieldName4, Width = 50, Visible = true, IsVertical = false, Settings = SettingsType.Default });
                ModuleBands.Add(band5);
                //Sale Currency	
                BandItem band6 = new BandItem() { BandName = "sale price", BandHeader = "Sale Price" };
                band6.Columns = new ObservableCollection<ColumnItem>();
                int count = 0;
                foreach (Currency currency in SelectedSaleCurrency)
                {
                    // code modified for reorder by common currency 
                    if (count == 0)
                    {
                        count = 1;
                        string fieldName = "Common_Cur";
                        DtModuleCopy.Columns.Add(fieldName, typeof(double));
                        band6.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                        DtModuleCopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));

                        if (currency.Name != ((Currency)SelectedCurrency).Name)
                        {
                            string fieldName1 = currency.Name;
                            DtModuleCopy.Columns.Add(fieldName1, typeof(double));
                            band6.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName1, HeaderText = fieldName1, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                            DtModuleCopy.Columns.Add("CurrencyConversionRate_" + fieldName1, typeof(double));
                        }
                    }
                    else
                    {
                        if (currency.Name != ((Currency)SelectedCurrency).Name)
                        {
                            string fieldName1 = currency.Name;
                            DtModuleCopy.Columns.Add(fieldName1, typeof(double));
                            band6.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName1, HeaderText = fieldName1, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                            DtModuleCopy.Columns.Add("CurrencyConversionRate_" + fieldName1, typeof(double));
                        }
                    }
                }
                ModuleBands.Add(band6);

                // Profit
                BandItem band7 = new BandItem() { BandName = "All2", BandHeader = "" };
                band7.Columns = new ObservableCollection<ColumnItem>();
                band7.Columns.Add(new ColumnItem() { ColumnFieldName = "Profit", HeaderText = "Profit", Width = 100, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                DtModuleCopy.Columns.Add("Profit", typeof(double));
                ModuleBands.Add(band7);

                // Cost Margin
                BandItem band8 = new BandItem() { BandName = "All3", BandHeader = "" };
                band8.Columns = new ObservableCollection<ColumnItem>();
                band8.Columns.Add(new ColumnItem() { ColumnFieldName = "CostMargin", HeaderText = "Cost Margin", Width = 100, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                DtModuleCopy.Columns.Add("CostMargin", typeof(double));
                ModuleBands.Add(band8);

                BandItem band9 = new BandItem() { BandName = "All4", AllowBandMove = false, Visible = true, AllowMoving = DevExpress.Utils.DefaultBoolean.False, AllowPrinting = false };
                band9.Columns = new ObservableCollection<ColumnItem>();
                band9.Columns.Add(new ColumnItem() { ColumnFieldName = "Delete", HeaderText = " ", Width = 50, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                ModuleBands.Add(band9);

                ModuleBands = new ObservableCollection<BandItem>(ModuleBands);
                DtModule = DtModuleCopy;
                GeosApplication.Instance.Logger.Log("Method AddColumnsToModuleDataTable executed Successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in AddColumnsToModuleDataTable() method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), "Red", CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in AddColumnsToModuleDataTable() Method - ServiceUnexceptedException " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in AddColumnsToModuleDataTable() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        private void FillModuleData()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method FillModuleData ...", category: Category.Info, priority: Priority.Low);
                double SellPriceValue = 0.00;
                if (DtModuleCopy == null)
                    DtModuleCopy = new DataTable();
                if (ModuleList == null)
                    ModuleList = new  ObservableCollection<CustomerPriceListByItem>();

                if (SavedModules == null)
                    SavedModules = new List<CustomerPriceListByItem>();

                foreach (CustomerPriceListByItem record in ModuleList)
                {
                    try
                    {
                        double Cost_Value = 0;
                        DataRow dr = DtModuleCopy.NewRow();
                        dr["IsChecked"] = false;

                        dr["CurrencyConversionDate"] = CurrencyConversionList.FirstOrDefault().LastUpdate;
                        if (SavedModules.Any(a => a.IdCPType == record.IdCPType) && WindowHeader == System.Windows.Application.Current.FindResource("EditCustomerPriceList").ToString() && ClonedCustomerPrice.IdBasePriceList == SelectedBasePriceName.IdBasePriceList)
                        {
                            CustomerPriceListByItem record_saved = SavedModules.FirstOrDefault(a => a.IdCPType == record.IdCPType);

                            if (string.IsNullOrEmpty(record_saved.ProductType.Code)) //[001]
                                dr["Code"] = "---";
                            else
                                dr["Code"] = record_saved.ProductType.Code;
                            //  dr["Code"] = record_saved.Detection.Code;
                            dr["Type"] = record.ProductType.Template.Name;
                            dr["IdCPType"] = record_saved.IdCPType;
                            dr["STAT"] = record.ProductType.StatusAbbreviation;
                            dr["HtmlColor"] = record.ProductType.StatusHtmlColor;
                            Cost_Value = record.MaxCost;
                            dr["MaxCost_1"] = record.MaxCost;

                            if (record_saved.LinkedDescription == 1)
                            {
                                record_saved.ItemCustomerDescription = ModuleList.FirstOrDefault(a => a.IdCPType == Convert.ToUInt64(record_saved.IdCPType)).ProductType.Name;
                                record_saved.ItemCustomerDescription_Old = record_saved.ItemCustomerDescription;
                                record.ItemCustomerDescription_Old = record_saved.ItemCustomerDescription;
                            }

                            if (record_saved.ItemCustomerDescription != null)
                                record_saved.ItemCustomerDescription = record_saved.ItemCustomerDescription.Trim('\n');
                            dr["Name"] = record_saved.ItemCustomerDescription;
                            dr["Logic"] = record_saved.IdRule;
                            dr["Value"] = record_saved.RuleValue;

                            dr["Enable_Delete"] = false;
                            dr["Enable_DescriptionLinked"] = false;
                            dr["Enable_VisibleCustomer"] = false;

                            if (Convert.ToInt32(record.IdRule) == 307)
                            {
                                foreach (Currency currency in SelectedSaleCurrency.Cast<Currency>().Where(a => a.IdCurrency == ((Currency)SelectedCurrency).IdCurrency).ToList())
                                {
                                    CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                    if (CurConversion1 != null)
                                    {
                                        if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                            dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                        else
                                            dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                    }

                                    else
                                        dr["CurrencyConversionRate_" + "Common_Cur"] = DBNull.Value;
                                    if (dr["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && dr["CurrencyConversionRate_" + "Common_Cur"] != null && dr["CurrencyConversionRate_" + "Common_Cur"] != "")
                                    {
                                        dr["BasePriceValue"] = Convert.ToDouble(Convert.ToDouble(record.MaxCost) + ((Convert.ToDouble(record.MaxCost) * (Convert.ToDouble(record.RuleValue) / 100)))) * Convert.ToDouble(dr["CurrencyConversionRate_" + "Common_Cur"]);
                                    }
                                    else
                                        dr["BasePriceValue"] = DBNull.Value;
                                }
                            }
                            else if (Convert.ToInt32(record.IdRule) == 308)
                            {
                                if (record.RuleValue == null || record.RuleValue <= 0)
                                {
                                    foreach (Currency currency in SelectedSaleCurrency.Cast<Currency>().Where(a => a.IdCurrency == ((Currency)SelectedCurrency).IdCurrency).ToList())
                                    {
                                        dr["BasePriceValue"] = DBNull.Value;
                                    }
                                }
                                else
                                {
                                    foreach (Currency currency in SelectedSaleCurrency.Cast<Currency>().Where(a => a.IdCurrency == ((Currency)SelectedCurrency).IdCurrency).ToList())
                                    {
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                            else
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                        }

                                        else
                                            dr["CurrencyConversionRate_" + "Common_Cur"] = DBNull.Value;
                                        if (dr["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && dr["CurrencyConversionRate_" + "Common_Cur"] != null && dr["CurrencyConversionRate_" + "Common_Cur"] != "")
                                            dr["BasePriceValue"] = Convert.ToDouble(record.RuleValue) * Convert.ToDouble(dr["CurrencyConversionRate_" + "Common_Cur"]);
                                        else
                                            dr["BasePriceValue"] = DBNull.Value;

                                    }
                                }
                            }
                            else if (Convert.ToInt32(record.IdRule) == 1518)
                            {
                                if (dr["Value"] == null || dr["Value"] == DBNull.Value)
                                {
                                    dr["Value"] = 0;
                                }
                                foreach (Currency currency in SelectedSaleCurrency.Cast<Currency>().Where(a => a.IdCurrency == ((Currency)SelectedCurrency).IdCurrency).ToList())
                                {
                                    CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                    if (CurConversion1 != null)
                                    {
                                        if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                            dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                        else
                                            dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                    }

                                    else
                                        dr["CurrencyConversionRate_" + "Common_Cur"] = DBNull.Value;

                                    dr["BasePriceValue"] = 0;
                                }

                                dr["Value"] = DBNull.Value;
                            }
                            else if (Convert.ToInt32(record.IdRule) == 309)
                            {

                                foreach (Currency currency in SelectedSaleCurrency.Cast<Currency>().Where(a => a.IdCurrency == ((Currency)SelectedCurrency).IdCurrency).ToList())
                                {
                                    CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                    if (CurConversion1 != null)
                                    {
                                        if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                            dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                        else
                                            dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                    }

                                    else
                                        dr["CurrencyConversionRate_" + "Common_Cur"] = DBNull.Value;
                                    if (dr["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && dr["CurrencyConversionRate_" + "Common_Cur"] != null && dr["CurrencyConversionRate_" + "Common_Cur"] != "")
                                        dr["BasePriceValue"] = Convert.ToDouble(Convert.ToDouble(dr["MaxCost_1"]) + (Convert.ToDouble(record.RuleValue))) * Convert.ToDouble(dr["CurrencyConversionRate_" + "Common_Cur"]);
                                    else
                                        dr["BasePriceValue"] = DBNull.Value;

                                }
                            }
                            //CPL saved 
                            dr["IsSalePriceValueColor"] = true;
                            dr["CurrencyConversionDate"] = CurrencyConversionList.FirstOrDefault().LastUpdate;

                            if (Convert.ToInt32(dr["Logic"]) == 307)
                            {
                                if (dr["Value"] == null || dr["Value"] == DBNull.Value)
                                {
                                    dr["Value"] = 0;
                                }

                                foreach (Currency currency in SelectedSaleCurrency)
                                {
                                    if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                    {
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                            else
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                        }

                                        else
                                            dr["CurrencyConversionRate_" + "Common_Cur"] = DBNull.Value;
                                        if (dr["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && dr["CurrencyConversionRate_" + "Common_Cur"] != null && dr["CurrencyConversionRate_" + "Common_Cur"] != "")
                                        {
                                            dr["Common_Cur"] = Convert.ToDouble(Convert.ToDouble(dr["MaxCost_1"]) + ((Convert.ToDouble(dr["MaxCost_1"]) * (Convert.ToDouble(dr["Value"]) / 100)))) * Convert.ToDouble(dr["CurrencyConversionRate_" + "Common_Cur"]);
                                        }
                                        else
                                            dr["Common_Cur"] = DBNull.Value;
                                    }
                                    else
                                    {
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.ExchangeRate;
                                            else
                                                dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.LastMonthAVGRate;
                                        }

                                        else
                                            dr["CurrencyConversionRate_" + currency.Name] = DBNull.Value;
                                        if (dr["CurrencyConversionRate_" + currency.Name] != DBNull.Value && dr["CurrencyConversionRate_" + currency.Name] != null && dr["CurrencyConversionRate_" + currency.Name] != "")
                                        {
                                            dr[currency.Name] = Convert.ToDouble(Convert.ToDouble(dr["MaxCost_1"]) + ((Convert.ToDouble(dr["MaxCost_1"]) * (Convert.ToDouble(dr["Value"]) / 100)))) * Convert.ToDouble(dr["CurrencyConversionRate_" + currency.Name]);
                                        }
                                        else
                                            dr[currency.Name] = DBNull.Value;
                                    }
                                }
                            }
                            else if (Convert.ToInt32(dr["Logic"]) == 308)
                            {
                                if (dr["Value"] == null || dr["Value"] == DBNull.Value || Convert.ToDouble(dr["Value"]) <= 0)
                                {
                                    dr["Value"] = DBNull.Value;
                                    dr["Common_Cur"] = DBNull.Value;
                                    foreach (Currency currency in SelectedSaleCurrency)
                                    {
                                        if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                            if (CurConversion1 != null)
                                            {
                                                if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                    dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                                else
                                                    dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                            }
                                            else
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = DBNull.Value;
                                            dr["Common_Cur"] = DBNull.Value;
                                        }
                                        else
                                        {
                                            CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                            if (CurConversion1 != null)
                                            {
                                                if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                    dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.ExchangeRate;
                                                else
                                                    dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.LastMonthAVGRate;
                                            }
                                            else
                                                dr["CurrencyConversionRate_" + currency.Name] = DBNull.Value;
                                            dr[currency.Name] = DBNull.Value;
                                        }
                                    }
                                }
                                else
                                {
                                    if (dr["Value"] == null || dr["Value"] == DBNull.Value)
                                    {
                                        dr["Value"] = 0;
                                    }
                                    dr["Common_Cur"] = dr["Value"];
                                    foreach (Currency currency in SelectedSaleCurrency)
                                    {
                                        if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                            if (CurConversion1 != null)
                                            {
                                                if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                    dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                                else
                                                    dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                            }

                                            else
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = DBNull.Value;
                                            if (dr["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && dr["CurrencyConversionRate_" + "Common_Cur"] != null && dr["CurrencyConversionRate_" + "Common_Cur"] != "")
                                                dr["Common_Cur"] = Convert.ToDouble(dr["Common_Cur"]) * Convert.ToDouble(dr["CurrencyConversionRate_" + "Common_Cur"]);
                                            else
                                                dr["Common_Cur"] = DBNull.Value;
                                        }
                                        else
                                        {
                                            CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                            if (CurConversion1 != null)
                                            {
                                                if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                    dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.ExchangeRate;
                                                else
                                                    dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.LastMonthAVGRate;
                                            }

                                            else
                                                dr["CurrencyConversionRate_" + currency.Name] = DBNull.Value;
                                            if (dr["CurrencyConversionRate_" + currency.Name] != DBNull.Value && dr["CurrencyConversionRate_" + currency.Name] != null && dr["CurrencyConversionRate_" + currency.Name] != "")
                                                dr[currency.Name] = Convert.ToDouble(dr["Common_Cur"]) * Convert.ToDouble(dr["CurrencyConversionRate_" + currency.Name]);
                                            else
                                                dr[currency.Name] = DBNull.Value;
                                        }
                                    }
                                }
                            }
                            else if (Convert.ToInt32(dr["Logic"]) == 1518)
                            {
                                if (dr["Value"] == null || dr["Value"] == DBNull.Value)
                                {
                                    dr["Value"] = 0;
                                }
                                foreach (Currency currency in SelectedSaleCurrency)
                                {
                                    if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                    {
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                            else
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                        }

                                        else
                                            dr["CurrencyConversionRate_" + "Common_Cur"] = DBNull.Value;
                                        dr["Common_Cur"] = 0;
                                    }
                                    else
                                    {
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.ExchangeRate;
                                            else
                                                dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.LastMonthAVGRate;
                                        }

                                        else
                                            dr["CurrencyConversionRate_" + currency.Name] = DBNull.Value;
                                        dr[currency.Name] = 0;
                                    }
                                }
                            }
                            else if (Convert.ToInt32(dr["Logic"]) == 309)
                            {
                                if (dr["Value"] == null || dr["Value"] == DBNull.Value)
                                {
                                    dr["Value"] = 0;
                                }

                                dr["Common_Cur"] = Convert.ToDouble(dr["MaxCost_1"]) + (Convert.ToDouble(dr["Value"]));

                                foreach (Currency currency in SelectedSaleCurrency)
                                {
                                    if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                    {
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                            else
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                        }

                                        else
                                            dr["CurrencyConversionRate_" + "Common_Cur"] = DBNull.Value;
                                        if (dr["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && dr["CurrencyConversionRate_" + "Common_Cur"] != null && dr["CurrencyConversionRate_" + "Common_Cur"] != "")
                                            dr["Common_Cur"] = Convert.ToDouble(dr["Common_Cur"]) * Convert.ToDouble(dr["CurrencyConversionRate_" + "Common_Cur"]);
                                        else
                                            dr["Common_Cur"] = DBNull.Value;
                                    }
                                    else
                                    {
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.ExchangeRate;
                                            else
                                                dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.LastMonthAVGRate;
                                        }

                                        else
                                            dr["CurrencyConversionRate_" + currency.Name] = DBNull.Value;
                                        if (dr["CurrencyConversionRate_" + currency.Name] != DBNull.Value && dr["CurrencyConversionRate_" + currency.Name] != null && dr["CurrencyConversionRate_" + currency.Name] != "")
                                            dr[currency.Name] = Convert.ToDouble(dr["Common_Cur"]) * Convert.ToDouble(dr["CurrencyConversionRate_" + currency.Name]);
                                        else
                                            dr[currency.Name] = DBNull.Value;
                                    }
                                }
                            }

                            dr["Name_Old"] = record_saved.ItemCustomerDescription_Old;



                            if (record_saved.LinkedDescription == 0)
                            {
                                dr["Name_Changed"] = true;
                                dr["NameChanged"] = "Unlinked Description";
                            }
                            else
                            {
                                dr["Name_Changed"] = false;
                                dr["NameChanged"] = "Linked Description";
                            }

                            if (record_saved.VisibleToCustomer == 0)
                            {
                                dr["Visible_Customer"] = false;
                                dr["VisibleCustomer"] = "Invisible";
                            }
                            else
                            {
                                dr["Visible_Customer"] = true;
                                dr["VisibleCustomer"] = "Visible";
                            }
                        }
                        else
                        {
                            if (string.IsNullOrEmpty(record.ProductType.Code)) //[001]
                                dr["Code"] = "---";
                            else
                                dr["Code"] = record.ProductType.Code;
                            // dr["Code"] = record.Detection.Code;
                            dr["Type"] = record.ProductType.Template.Name;
                            dr["IdCPType"] = record.IdCPType;
                            dr["STAT"] = record.ProductType.StatusAbbreviation;
                            dr["HtmlColor"] = record.ProductType.StatusHtmlColor;
                            Cost_Value = record.MaxCost;
                            dr["MaxCost_1"] = record.MaxCost;

                            if (record.LinkedDescription == 1)
                            {
                                record.ItemCustomerDescription = ModuleList.FirstOrDefault(a => a.IdCPType == Convert.ToUInt64(record.IdCPType)).ProductType.Name;
                                record.ItemCustomerDescription_Old = record.ItemCustomerDescription;
                            }

                            dr["Name"] = record.ProductType.Name;
                            dr["Logic"] = SelectedLogic.IdLookupValue;
                            dr["Value"] = DBNull.Value;

                            dr["Enable_Delete"] = true;
                            dr["Enable_DescriptionLinked"] = true;
                            dr["Enable_VisibleCustomer"] = true;

                            //base price

                            dr["IsSalePriceValueColor"] = false;

                            if (Convert.ToInt32(record.IdRule) == 307)
                            {
                                dr["Common_Cur"] = Convert.ToDouble(record.MaxCost) + ((Convert.ToDouble(record.MaxCost) * (Convert.ToDouble(record.RuleValue) / 100)));

                                foreach (Currency currency in SelectedSaleCurrency)
                                {
                                    if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                    {
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                            else
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                        }

                                        else
                                            dr["CurrencyConversionRate_" + "Common_Cur"] = DBNull.Value;
                                        if (dr["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && dr["CurrencyConversionRate_" + "Common_Cur"] != null && dr["CurrencyConversionRate_" + "Common_Cur"] != "")
                                        {
                                            dr["Common_Cur"] = Convert.ToDouble(dr["Common_Cur"]) * Convert.ToDouble(dr["CurrencyConversionRate_" + "Common_Cur"]);
                                        }
                                        else
                                            dr["Common_Cur"] = DBNull.Value;


                                        if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            dr["BasePriceValue"] = dr["Common_Cur"];
                                        }
                                    }
                                    else
                                    {
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.ExchangeRate;
                                            else
                                                dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.LastMonthAVGRate;
                                        }

                                        else
                                            dr["CurrencyConversionRate_" + currency.Name] = DBNull.Value;
                                        if (dr["CurrencyConversionRate_" + currency.Name] != DBNull.Value && dr["CurrencyConversionRate_" + currency.Name] != null && dr["CurrencyConversionRate_" + currency.Name] != "")
                                        {
                                            dr[currency.Name] = Convert.ToDouble(dr["Common_Cur"]) * Convert.ToDouble(dr["CurrencyConversionRate_" + currency.Name]);
                                        }
                                        else
                                            dr[currency.Name] = DBNull.Value;


                                        if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            dr["BasePriceValue"] = dr[currency.Name];
                                        }
                                    }
                                }
                            }
                            else if (Convert.ToInt32(record.IdRule) == 308)
                            {
                                if (record.RuleValue == null || record.RuleValue <= 0)
                                {
                                    dr["Value"] = DBNull.Value;
                                    dr["Common_Cur"] = DBNull.Value;
                                    foreach (Currency currency in SelectedSaleCurrency)
                                    {
                                        if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            dr["Common_Cur"] = DBNull.Value;

                                            CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                            if (CurConversion1 != null)
                                            {
                                                if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                    dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                                else
                                                    dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                            }

                                            else
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = DBNull.Value;

                                            if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                dr["BasePriceValue"] = dr["Common_Cur"];
                                            }
                                        }
                                        else
                                        {
                                            dr[currency.Name] = DBNull.Value;

                                            CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                            if (CurConversion1 != null)
                                            {
                                                if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                    dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.ExchangeRate;
                                                else
                                                    dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.LastMonthAVGRate;
                                            }

                                            else
                                                dr["CurrencyConversionRate_" + currency.Name] = DBNull.Value;

                                            if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                dr["BasePriceValue"] = dr[currency.Name];
                                            }
                                        }
                                    }
                                }
                                else
                                {
                                    dr["Common_Cur"] = record.RuleValue;
                                    foreach (Currency currency in SelectedSaleCurrency)
                                    {
                                        if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                            if (CurConversion1 != null)
                                            {
                                                if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                    dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                                else
                                                    dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                            }

                                            else
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = DBNull.Value;
                                            if (dr["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && dr["CurrencyConversionRate_" + "Common_Cur"] != null && dr["CurrencyConversionRate_" + "Common_Cur"] != "")
                                                dr["Common_Cur"] = Convert.ToDouble(dr["Common_Cur"]) * Convert.ToDouble(dr["CurrencyConversionRate_" + "Common_Cur"]);
                                            else
                                                dr["Common_Cur"] = DBNull.Value;


                                            if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                dr["BasePriceValue"] = dr["Common_Cur"];
                                            }
                                        }
                                        else
                                        {
                                            CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                            if (CurConversion1 != null)
                                            {
                                                if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                    dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.ExchangeRate;
                                                else
                                                    dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.LastMonthAVGRate;
                                            }

                                            else
                                                dr["CurrencyConversionRate_" + currency.Name] = DBNull.Value;
                                            if (dr["CurrencyConversionRate_" + currency.Name] != DBNull.Value && dr["CurrencyConversionRate_" + currency.Name] != null && dr["CurrencyConversionRate_" + currency.Name] != "")
                                                dr[currency.Name] = Convert.ToDouble(dr["Common_Cur"]) * Convert.ToDouble(dr["CurrencyConversionRate_" + currency.Name]);
                                            else
                                                dr[currency.Name] = DBNull.Value;


                                            if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                dr["BasePriceValue"] = dr[currency.Name];
                                            }
                                        }
                                    }
                                }
                            }
                            else if (Convert.ToInt32(record.IdRule) == 1518)
                            {
                                if (dr["Value"] == null || dr["Value"] == DBNull.Value)
                                {
                                    dr["Value"] = 0;
                                }
                                foreach (Currency currency in SelectedSaleCurrency)
                                {
                                    if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                    {
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                            else
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                        }

                                        else
                                            dr["CurrencyConversionRate_" + "Common_Cur"] = DBNull.Value;

                                        dr["Common_Cur"] = 0;
                                        if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            dr["BasePriceValue"] = dr["Common_Cur"];
                                        }
                                    }
                                    else
                                    {
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.ExchangeRate;
                                            else
                                                dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.LastMonthAVGRate;
                                        }

                                        else
                                            dr["CurrencyConversionRate_" + currency.Name] = DBNull.Value;

                                        dr[currency.Name] = 0;
                                        if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            dr["BasePriceValue"] = dr[currency.Name];
                                        }
                                    }
                                }

                                dr["Value"] = DBNull.Value;
                            }
                            else if (Convert.ToInt32(record.IdRule) == 309)
                            {
                                dr["Common_Cur"] = Convert.ToDouble(dr["MaxCost_1"]) + (Convert.ToDouble(record.RuleValue));

                                foreach (Currency currency in SelectedSaleCurrency)
                                {
                                    if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                    {
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.ExchangeRate;
                                            else
                                                dr["CurrencyConversionRate_" + "Common_Cur"] = CurConversion1.LastMonthAVGRate;
                                        }

                                        else
                                            dr["CurrencyConversionRate_" + "Common_Cur"] = DBNull.Value;
                                        if (dr["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && dr["CurrencyConversionRate_" + "Common_Cur"] != null && dr["CurrencyConversionRate_" + "Common_Cur"] != "")
                                            dr["Common_Cur"] = Convert.ToDouble(dr["Common_Cur"]) * Convert.ToDouble(dr["CurrencyConversionRate_" + "Common_Cur"]);
                                        else
                                            dr["Common_Cur"] = DBNull.Value;


                                        if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            dr["BasePriceValue"] = dr["Common_Cur"];
                                        }
                                    }
                                    else
                                    {
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(dr["CurrencyConversionDate"]).Date);
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.ExchangeRate;
                                            else
                                                dr["CurrencyConversionRate_" + currency.Name] = CurConversion1.LastMonthAVGRate;
                                        }

                                        else
                                            dr["CurrencyConversionRate_" + currency.Name] = DBNull.Value;
                                        if (dr["CurrencyConversionRate_" + currency.Name] != DBNull.Value && dr["CurrencyConversionRate_" + currency.Name] != null && dr["CurrencyConversionRate_" + currency.Name] != "")
                                            dr[currency.Name] = Convert.ToDouble(dr["Common_Cur"]) * Convert.ToDouble(dr["CurrencyConversionRate_" + currency.Name]);
                                        else
                                            dr[currency.Name] = DBNull.Value;


                                        if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            dr["BasePriceValue"] = dr[currency.Name];
                                        }
                                    }
                                }
                            }

                            dr["Name_Old"] = record.ItemCustomerDescription_Old;

                            dr["Name_Changed"] = false;
                            dr["NameChanged"] = "Linked Description";

                            dr["Visible_Customer"] = true;
                            dr["VisibleCustomer"] = "Visible";
                        }


                        if (dr["Common_Cur"] == DBNull.Value)
                            SellPriceValue = 0.00;
                        else
                            SellPriceValue = Convert.ToDouble(dr["Common_Cur"]);

                        dr["Profit"] = CalculateCustomerPriceProfitValue(Cost_Value, SellPriceValue);
                        dr["CostMargin"] = CalculateCustomerPriceCostMarginValue(Cost_Value, SellPriceValue);
                        if (dr["CurrencyConversionDate"] != DBNull.Value)
                        {
                            //[rdixit][13.03.2023][GEOS2-3177]
                            if (SelectedExchangeRate != null)
                            {
                                if (SelectedExchangeRate.IdLookupValue == 1509)
                                {
                                    dr["SaleCurrencyConversionDate"] = "Updated currency rate on : " + DateTime.Now.ToString("dd/MM/yyyy");
                                }
                                else
                                {
                                    dr["SaleCurrencyConversionDate"] = "Updated currency rate on : " + Convert.ToDateTime(dr["CurrencyConversionDate"]).ToString("dd/MM/yyyy");
                                }
                            }
                            else
                            {
                                dr["SaleCurrencyConversionDate"] = "Updated currency rate on : " + Convert.ToDateTime(dr["CurrencyConversionDate"]).ToString("dd/MM/yyyy");
                            }
                        }
                        DtModuleCopy.Rows.Add(dr);
                        IsEnabledSaveButton = true;//[Sudhir.Jangra][GEOS2-3349][27/12/2022]
                        DtModule = DtModuleCopy;
                    }
                    catch (Exception ex)
                    {
                        GeosApplication.Instance.Logger.Log("Get an error in FillModuleData() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
                    }
                }
                GeosApplication.Instance.Logger.Log("Method FillModuleData() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in FillModuleData() Method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), "Red", CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in FillModuleData() Method - ServiceUnexceptedException " + ex.Message, category: Category.Info, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServiceProviderIP"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in FillModuleData() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        private void ModuleVisibleCustomerCommandAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ModuleVisibleCustomerCommandAction()...", category: Category.Info, priority: Priority.Low);

                DataColumn[] columns = DtModuleCopy.Columns.Cast<DataColumn>().ToArray();
                DataRow[] foundChecked = DtModuleCopy.AsEnumerable().Where(row => columns.Any(col => row["IsChecked"].ToString() == "True")).ToArray();
                DataRow MainRow = ((System.Data.DataRowView)obj).Row;
                bool value = Convert.ToBoolean(MainRow["Visible_Customer"]);
                if (foundChecked.Length > 0 && MainRow["IsChecked"].ToString() != "False")
                {
                    foreach (DataRow item in foundChecked)
                    {
                        DataRow Row = item;
                        if (Row["IsChecked"].ToString() != "False")
                        {
                            if (Convert.ToUInt32(Row["IdCPType"]) != Convert.ToUInt32(MainRow["IdCPType"]))
                            {
                                if (MainRow["Visible_Customer"] != DBNull.Value && Convert.ToBoolean(MainRow["Visible_Customer"]) == false)
                                {
                                    Row["Visible_Customer"] = true;
                                    Row["VisibleCustomer"] = "Visible";
                                }
                                else
                                {
                                    Row["Visible_Customer"] = false;
                                    Row["VisibleCustomer"] = "Invisible";
                                }


                                Row["IsColor"] = true;
                                Row["IsSalePriceValueColor"] = true;
                                Row["IsUpdatedRow"] = true;

                            }
                        }
                    }

                }

                DataRow Row1 = ((System.Data.DataRowView)obj).Row;
                if (Row1["Visible_Customer"] != DBNull.Value && Convert.ToBoolean(Row1["Visible_Customer"]) == false)
                {
                    Row1["Visible_Customer"] = true;
                    Row1["VisibleCustomer"] = "Visible";
                }
                else
                {
                    Row1["Visible_Customer"] = false;
                    Row1["VisibleCustomer"] = "Invisible";
                }

                Row1["IsColor"] = true;
                Row1["IsSalePriceValueColor"] = true;
                Row1["IsUpdatedRow"] = true;
                IsEnabledSaveButton = true;
                GeosApplication.Instance.Logger.Log("Method ModuleVisibleCustomerCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method ModuleVisibleCustomerCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        private void ModuleDescriptionLinkedCommandAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ModuleDescriptionLinkedCommandAction()...", category: Category.Info, priority: Priority.Low);

                DataColumn[] columns = DtModuleCopy.Columns.Cast<DataColumn>().ToArray();
                DataRow[] foundChecked = DtModuleCopy.AsEnumerable().Where(row => columns.Any(col => row["IsChecked"].ToString() == "True")).ToArray();
                DataRow MainRow = ((System.Data.DataRowView)obj).Row;
                bool value = Convert.ToBoolean(MainRow["Name_Changed"]);
                if (foundChecked.Length > 0 && MainRow["IsChecked"].ToString() != "False")
                {
                    foreach (DataRow item in foundChecked)
                    {
                        DataRow Row = item;
                        if (Row["IsChecked"].ToString() != "False")
                        {
                            if (Convert.ToUInt32(Row["IdCPType"]) != Convert.ToUInt32(MainRow["IdCPType"]))
                            {
                                if (MainRow["Name_Changed"] != DBNull.Value && Convert.ToBoolean(MainRow["Name_Changed"]) == false)
                                {
                                    Row["Name_Changed"] = true;
                                    Row["NameChanged"] = "Unlinked Description";
                                }
                                else
                                {
                                    Row["Name_Changed"] = false;
                                    Row["NameChanged"] = "Linked Description";
                                    Row["Name"] = ModuleList.FirstOrDefault(a => a.IdCPType == Convert.ToUInt64(Row["IdCPType"])).ProductType.Name;

                                }
                                Row["IsColor"] = true;
                                Row["IsSalePriceValueColor"] = true;

                            }
                        }
                    }

                }

                DataRow Row1 = ((System.Data.DataRowView)obj).Row;
                if (Row1["Name_Changed"] != DBNull.Value && Convert.ToBoolean(Row1["Name_Changed"]) == false)
                {
                    Row1["Name_Changed"] = true;
                    Row1["NameChanged"] = "Unlinked Description";
                }
                else
                {
                    Row1["Name_Changed"] = false;
                    Row1["NameChanged"] = "Linked Description";
                    Row1["Name"] = ModuleList.FirstOrDefault(a => a.IdCPType == Convert.ToUInt64(Row1["IdCPType"])).ProductType.Name; //DetectionMenuList.FirstOrDefault(a => a.IdDetection == Convert.ToUInt64(Row1["IdDetection"])).Description;
                }

                Row1["IsColor"] = true;
                Row1["IsSalePriceValueColor"] = true;
                Row1["IsUpdatedRow"] = true;
                IsEnabledSaveButton = true;
                GeosApplication.Instance.Logger.Log("Method ModuleDescriptionLinkedCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method ModuleDescriptionLinkedCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        private void RuleValueChangedModuleCommandAction(object obj)
        {
            try
            {
                double MaxCost = 0.00;
                double SellPriceValue = 0.00;

                if (((DevExpress.Xpf.Grid.CellValueEventArgs)obj).Column.FieldName == "Value" || ((DevExpress.Xpf.Grid.CellValueEventArgs)obj).Column.FieldName == "Logic")
                {
                    IsCalculateArticleCostButtonEnabled = true;
                    IsCalculated = false;
                    DataColumn[] columns = DtModuleCopy.Columns.Cast<DataColumn>().ToArray();
                    DataRow[] foundChecked = DtModuleCopy.AsEnumerable().Where(row => columns.Any(col => row["IsChecked"].ToString() == "True")).ToArray();
                    DataRow MainRow = ((System.Data.DataRowView)((DevExpress.Xpf.Grid.RowEventArgs)obj).Row).Row;
                    MainRow["Enable_Delete"] = false;
                    MainRow["Enable_DescriptionLinked"] = false;
                    MainRow["Enable_VisibleCustomer"] = false;

                    if (foundChecked.Length > 0 && MainRow["IsChecked"].ToString() != "False")
                    {
                        for (int j = 0; j < foundChecked.Length; j++)
                        {
                            foundChecked[j].BeginEdit();
                            if (((DevExpress.Xpf.Grid.CellValueEventArgs)obj).Column.FieldName == "Value")
                            {
                                if (MainRow["Value"] == DBNull.Value)
                                {
                                    MainRow["Value"] = 0;
                                }
                                foundChecked[j]["Value"] = MainRow["Value"];
                            }
                            else
                            {
                                if (foundChecked[j]["Value"] == DBNull.Value)
                                {
                                    foundChecked[j]["Value"] = 0;
                                }
                            }

                            if (((DevExpress.Xpf.Grid.CellValueEventArgs)obj).Column.FieldName == "Logic")
                            {
                                if (MainRow["Logic"] == DBNull.Value || Convert.ToInt32(MainRow["Logic"]) == 0)
                                {
                                    MainRow["Logic"] = 0;
                                    MainRow["Value"] = DBNull.Value;
                                }
                                foundChecked[j]["Logic"] = MainRow["Logic"];
                                foundChecked[j]["Value"] = MainRow["Value"];
                            }
                            else
                            {
                                if (foundChecked[j]["Logic"] == DBNull.Value || Convert.ToInt32(foundChecked[j]["Logic"]) == 0)
                                {
                                    foundChecked[j]["Logic"] = 308;
                                }
                            }
                            if (MainRow["IsChecked"].ToString() != "False")
                            {
                                foundChecked[j]["IsColor"] = true;
                                foundChecked[j]["IsUpdatedRow"] = true;

                                if (foundChecked[j]["MaxCost_1"] == DBNull.Value)
                                    foundChecked[j]["MaxCost_1"] = 0;
                                if (foundChecked[j]["Logic"] != DBNull.Value && Convert.ToInt32(foundChecked[j]["Logic"]) != 0)
                                {
                                    foundChecked[j]["IsSalePriceValueColor"] = true;
                                    foundChecked[j]["Enable_Delete"] = false;
                                    foundChecked[j]["Enable_DescriptionLinked"] = false;
                                    foundChecked[j]["Enable_VisibleCustomer"] = false;
                                    if (Convert.ToInt32(foundChecked[j]["Logic"]) == 307)
                                    {
                                        if (foundChecked[j]["MaxCost_1"] == DBNull.Value)
                                        {
                                            foundChecked[j]["MaxCost_1"] = 0;
                                        }
                                        foundChecked[j]["Common_Cur"] = Convert.ToDouble(foundChecked[j]["MaxCost_1"]) + (Convert.ToDouble(foundChecked[j]["MaxCost_1"]) * (Convert.ToDouble(foundChecked[j]["Value"]) / 100));
                                        foreach (Currency cur in SelectedSaleCurrency)
                                        {
                                            if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                if (foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != null && foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != "")
                                                    foundChecked[j]["Common_Cur"] = Convert.ToDouble(foundChecked[j]["Common_Cur"]) * Convert.ToDouble(foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"]);
                                                else
                                                    foundChecked[j]["Common_Cur"] = DBNull.Value;
                                            }
                                            else
                                            {
                                                if (foundChecked[j]["CurrencyConversionRate_" + cur.Name] != DBNull.Value && foundChecked[j]["CurrencyConversionRate_" + cur.Name] != null && foundChecked[j]["CurrencyConversionRate_" + cur.Name] != "")
                                                    foundChecked[j][cur.Name] = Convert.ToDouble(foundChecked[j]["Common_Cur"]) * Convert.ToDouble(foundChecked[j]["CurrencyConversionRate_" + cur.Name]);
                                                else
                                                    foundChecked[j][cur.Name] = DBNull.Value;
                                            }
                                        }
                                    }
                                    else if (Convert.ToInt32(foundChecked[j]["Logic"]) == 308)
                                    {
                                        if (foundChecked[j]["Value"] == null || foundChecked[j]["Value"] == DBNull.Value || Convert.ToDouble(foundChecked[j]["Value"]) <= 0)
                                        {
                                            foundChecked[j]["Value"] = DBNull.Value;
                                            foundChecked[j]["Common_Cur"] = DBNull.Value;
                                            foreach (Currency cur in SelectedSaleCurrency)
                                            {
                                                if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                                {
                                                    foundChecked[j]["Common_Cur"] = DBNull.Value;
                                                }
                                                else
                                                {
                                                    foundChecked[j][cur.Name] = DBNull.Value;
                                                }
                                            }
                                        }
                                        else
                                        {
                                            if (foundChecked[j]["MaxCost_1"] == DBNull.Value)
                                            {
                                                foundChecked[j]["MaxCost_1"] = 0;
                                            }

                                            foundChecked[j]["Common_Cur"] = foundChecked[j]["Value"];
                                            foreach (Currency cur in SelectedSaleCurrency)
                                            {
                                                if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                                {
                                                    if (foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != null && foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != "")
                                                        foundChecked[j]["Common_Cur"] = Convert.ToDouble(foundChecked[j]["Common_Cur"]) * Convert.ToDouble(foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"]);
                                                    else
                                                        foundChecked[j]["Common_Cur"] = DBNull.Value;
                                                }
                                                else
                                                {
                                                    if (foundChecked[j]["CurrencyConversionRate_" + cur.Name] != DBNull.Value && foundChecked[j]["CurrencyConversionRate_" + cur.Name] != null && foundChecked[j]["CurrencyConversionRate_" + cur.Name] != "")
                                                        foundChecked[j][cur.Name] = Convert.ToDouble(foundChecked[j]["Common_Cur"]) * Convert.ToDouble(foundChecked[j]["CurrencyConversionRate_" + cur.Name]);
                                                    else
                                                        foundChecked[j][cur.Name] = DBNull.Value;
                                                }
                                            }
                                        }
                                    }
                                    else if (Convert.ToInt32(foundChecked[j]["Logic"]) == 1518)
                                    {
                                        if (foundChecked[j]["Value"] == null || foundChecked[j]["Value"] == DBNull.Value)
                                        {
                                            foundChecked[j]["Value"] = 0;

                                            foundChecked[j]["Common_Cur"] = 0;

                                            foreach (Currency cur in SelectedSaleCurrency)
                                            {
                                                if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                                {
                                                    foundChecked[j]["Common_Cur"] = 0;
                                                }
                                                else
                                                {
                                                    foundChecked[j][cur.Name] = 0;
                                                }
                                            }
                                        }
                                        else if (foundChecked[j]["Value"] != null && Convert.ToInt32(foundChecked[j]["Value"]) >= 0)
                                        {
                                            foundChecked[j]["Value"] = 0;

                                            foundChecked[j]["Common_Cur"] = 0;

                                            foreach (Currency cur in SelectedSaleCurrency)
                                            {
                                                if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                                {
                                                    foundChecked[j]["Common_Cur"] = 0;
                                                }
                                                else
                                                {
                                                    foundChecked[j][cur.Name] = 0;
                                                }
                                            }
                                        }
                                    }
                                    else if (Convert.ToInt32(foundChecked[j]["Logic"]) == 309)
                                    {
                                        if (foundChecked[j]["MaxCost_1"] == DBNull.Value)
                                        {
                                            foundChecked[j]["MaxCost_1"] = 0;
                                        }
                                        foundChecked[j]["Common_Cur"] = Convert.ToDouble(foundChecked[j]["MaxCost_1"]) + (Convert.ToDouble(foundChecked[j]["Value"]));
                                        foreach (Currency cur in SelectedSaleCurrency)
                                        {
                                            if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                if (foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != null && foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"] != "")
                                                    foundChecked[j]["Common_Cur"] = Convert.ToDouble(foundChecked[j]["Common_Cur"]) * Convert.ToDouble(foundChecked[j]["CurrencyConversionRate_" + "Common_Cur"]);
                                                else
                                                    foundChecked[j]["Common_Cur"] = DBNull.Value;
                                            }
                                            else
                                            {
                                                if (foundChecked[j]["CurrencyConversionRate_" + cur.Name] != DBNull.Value && foundChecked[j]["CurrencyConversionRate_" + cur.Name] != null && foundChecked[j]["CurrencyConversionRate_" + cur.Name] != "")
                                                    foundChecked[j][cur.Name] = Convert.ToDouble(foundChecked[j]["Common_Cur"]) * Convert.ToDouble(foundChecked[j]["CurrencyConversionRate_" + cur.Name]);
                                                else
                                                    foundChecked[j][cur.Name] = DBNull.Value;
                                            }
                                        }
                                    }
                                }
                                else
                                {
                                    //set from bpl
                                    foundChecked[j]["IsSalePriceValueColor"] = false;
                                    foundChecked[j]["Enable_Delete"] = true;
                                    foundChecked[j]["Enable_DescriptionLinked"] = true;
                                    foundChecked[j]["Enable_VisibleCustomer"] = true;
                                    CustomerPriceListByItem record = ModuleList.FirstOrDefault(a => a.IdCPType == Convert.ToUInt64(foundChecked[j]["IdCPType"]));
                                    int indexSelectedCurrency = DtModule.Columns.IndexOf("Common_Cur");
                                    int indexCurrencyConversionDate = DtModule.Columns.IndexOf("CurrencyConversionDate");
                                    DateTime? indexCurrencyConversionDateValue = null;
                                    //if (record.CurrencyConversionDate_New != null)
                                    //{
                                    //    indexCurrencyConversionDateValue = Convert.ToDateTime(record.CurrencyConversionDate_New);
                                    //    foundChecked[j]["CurrencyConversionDate"] = indexCurrencyConversionDateValue;
                                    //}

                                    indexCurrencyConversionDateValue = CurrencyConversionList.FirstOrDefault().LastUpdate;
                                    foundChecked[j]["CurrencyConversionDate"] = indexCurrencyConversionDateValue;


                                    if (Convert.ToInt32(record.IdRule) == 307)
                                    {
                                        foundChecked[j][indexSelectedCurrency] = Convert.ToDouble(record.MaxCost) + ((Convert.ToDouble(record.MaxCost) * (Convert.ToDouble(record.RuleValue) / 100)));

                                        foreach (Currency currency in SelectedSaleCurrency)
                                        {
                                            if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                Int32 IndexSelectedSaleCurrency = DtModule.Columns.IndexOf("CurrencyConversionRate_" + "Common_Cur");
                                                Int32 IndexCurrencyName = DtModule.Columns.IndexOf("Common_Cur");
                                                CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(indexCurrencyConversionDateValue.Value.Date));
                                                if (CurConversion1 != null)
                                                {
                                                    if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                        foundChecked[j][IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                                    else
                                                        foundChecked[j][IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                                }

                                                else
                                                    foundChecked[j][IndexSelectedSaleCurrency] = DBNull.Value;
                                                if (foundChecked[j][IndexSelectedSaleCurrency] != DBNull.Value && foundChecked[j][IndexSelectedSaleCurrency] != null && foundChecked[j][IndexSelectedSaleCurrency] != "")
                                                {
                                                    foundChecked[j][IndexCurrencyName] = Convert.ToDouble(foundChecked[j][indexSelectedCurrency]) * Convert.ToDouble(foundChecked[j][IndexSelectedSaleCurrency]);
                                                }
                                                else
                                                    foundChecked[j][IndexCurrencyName] = DBNull.Value;
                                            }
                                            else
                                            {
                                                Int32 IndexSelectedSaleCurrency = DtModule.Columns.IndexOf("CurrencyConversionRate_" + currency.Name);
                                                Int32 IndexCurrencyName = DtModule.Columns.IndexOf(currency.Name);
                                                CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(indexCurrencyConversionDateValue.Value.Date));
                                                if (CurConversion1 != null)
                                                {
                                                    if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                        foundChecked[j][IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                                    else
                                                        foundChecked[j][IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                                }

                                                else
                                                    foundChecked[j][IndexSelectedSaleCurrency] = DBNull.Value;
                                                if (foundChecked[j][IndexSelectedSaleCurrency] != DBNull.Value && foundChecked[j][IndexSelectedSaleCurrency] != null && foundChecked[j][IndexSelectedSaleCurrency] != "")
                                                {
                                                    foundChecked[j][IndexCurrencyName] = Convert.ToDouble(foundChecked[j][indexSelectedCurrency]) * Convert.ToDouble(foundChecked[j][IndexSelectedSaleCurrency]);
                                                }
                                                else
                                                    foundChecked[j][IndexCurrencyName] = DBNull.Value;
                                            }
                                        }
                                    }
                                    else if (Convert.ToInt32(record.IdRule) == 308)
                                    {
                                        foundChecked[j][indexSelectedCurrency] = record.RuleValue;
                                        foreach (Currency currency in SelectedSaleCurrency)
                                        {
                                            if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                Int32 IndexSelectedSaleCurrency = DtModule.Columns.IndexOf("CurrencyConversionRate_" + "Common_Cur");
                                                Int32 IndexCurrencyName = DtModule.Columns.IndexOf("Common_Cur");
                                                CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(indexCurrencyConversionDateValue.Value.Date));
                                                if (CurConversion1 != null)
                                                {
                                                    if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                        foundChecked[j][IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                                    else
                                                        foundChecked[j][IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                                }

                                                else
                                                    foundChecked[j][IndexSelectedSaleCurrency] = DBNull.Value;
                                                if (foundChecked[j][IndexSelectedSaleCurrency] != DBNull.Value && foundChecked[j][IndexSelectedSaleCurrency] != null && foundChecked[j][IndexSelectedSaleCurrency] != "")
                                                    foundChecked[j][IndexCurrencyName] = Convert.ToDouble(foundChecked[j][indexSelectedCurrency]) * Convert.ToDouble(foundChecked[j][IndexSelectedSaleCurrency]);
                                                else
                                                    foundChecked[j][IndexCurrencyName] = DBNull.Value;
                                            }
                                            else
                                            {
                                                Int32 IndexSelectedSaleCurrency = DtModule.Columns.IndexOf("CurrencyConversionRate_" + currency.Name);
                                                Int32 IndexCurrencyName = DtModule.Columns.IndexOf(currency.Name);
                                                CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(indexCurrencyConversionDateValue.Value.Date));
                                                if (CurConversion1 != null)
                                                {
                                                    if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                        foundChecked[j][IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                                    else
                                                        foundChecked[j][IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                                }

                                                else
                                                    foundChecked[j][IndexSelectedSaleCurrency] = DBNull.Value;
                                                if (foundChecked[j][IndexSelectedSaleCurrency] != DBNull.Value && foundChecked[j][IndexSelectedSaleCurrency] != null && foundChecked[j][IndexSelectedSaleCurrency] != "")
                                                    foundChecked[j][IndexCurrencyName] = Convert.ToDouble(foundChecked[j][indexSelectedCurrency]) * Convert.ToDouble(foundChecked[j][IndexSelectedSaleCurrency]);
                                                else
                                                    foundChecked[j][IndexCurrencyName] = DBNull.Value;
                                            }
                                        }
                                    }
                                    else if (Convert.ToInt32(record.IdRule) == 1518)
                                    {
                                        foundChecked[j]["Value"] = 0;
                                        foundChecked[j][indexSelectedCurrency] = 0;
                                        foreach (Currency currency in SelectedSaleCurrency)
                                        {
                                            if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                Int32 IndexCurrencyName = DtModule.Columns.IndexOf("Common_Cur");
                                                foundChecked[j][IndexCurrencyName] = 0;
                                            }
                                            else
                                            {
                                                Int32 IndexCurrencyName = DtModule.Columns.IndexOf(currency.Name);
                                                foundChecked[j][IndexCurrencyName] = 0;
                                            }
                                        }
                                    }
                                    else if (Convert.ToInt32(record.IdRule) == 309)
                                    {
                                        foundChecked[j][indexSelectedCurrency] = Convert.ToDouble(record.MaxCost) + (Convert.ToDouble(record.RuleValue));

                                        foreach (Currency currency in SelectedSaleCurrency)
                                        {
                                            if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                Int32 IndexSelectedSaleCurrency = DtModule.Columns.IndexOf("CurrencyConversionRate_" + "Common_Cur");
                                                Int32 IndexCurrencyName = DtModule.Columns.IndexOf("Common_Cur");
                                                CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(indexCurrencyConversionDateValue.Value.Date));
                                                if (CurConversion1 != null)
                                                {
                                                    if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                        foundChecked[j][IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                                    else
                                                        foundChecked[j][IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                                }

                                                else
                                                    foundChecked[j][IndexSelectedSaleCurrency] = DBNull.Value;
                                                if (foundChecked[j][IndexSelectedSaleCurrency] != DBNull.Value && foundChecked[j][IndexSelectedSaleCurrency] != null && foundChecked[j][IndexSelectedSaleCurrency] != "")
                                                    foundChecked[j][IndexCurrencyName] = Convert.ToDouble(foundChecked[j][indexSelectedCurrency]) * Convert.ToDouble(foundChecked[j][IndexSelectedSaleCurrency]);
                                                else
                                                    foundChecked[j][IndexCurrencyName] = DBNull.Value;
                                            }
                                            else
                                            {
                                                Int32 IndexSelectedSaleCurrency = DtModule.Columns.IndexOf("CurrencyConversionRate_" + currency.Name);
                                                Int32 IndexCurrencyName = DtModule.Columns.IndexOf(currency.Name);
                                                CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(indexCurrencyConversionDateValue.Value.Date));
                                                if (CurConversion1 != null)
                                                {
                                                    if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                        foundChecked[j][IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                                    else
                                                        foundChecked[j][IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                                }

                                                else
                                                    foundChecked[j][IndexSelectedSaleCurrency] = DBNull.Value;
                                                if (foundChecked[j][IndexSelectedSaleCurrency] != DBNull.Value && foundChecked[j][IndexSelectedSaleCurrency] != null && foundChecked[j][IndexSelectedSaleCurrency] != "")
                                                    foundChecked[j][IndexCurrencyName] = Convert.ToDouble(foundChecked[j][indexSelectedCurrency]) * Convert.ToDouble(foundChecked[j][IndexSelectedSaleCurrency]);
                                                else
                                                    foundChecked[j][IndexCurrencyName] = DBNull.Value;
                                            }
                                        }
                                    }

                                    foundChecked[j]["Value"] = DBNull.Value;
                                    //delete DeleteModules
                                    if (DeleteModules == null)
                                        DeleteModules = new List<BPLModule>();

                                    BPLModule det = new BPLModule();
                                    det.IdCPType = (uint)foundChecked[j]["IdCPType"];
                                    DeleteModules.Add(det);
                                }

                                if (foundChecked[j]["Common_Cur"] != DBNull.Value)
                                    SellPriceValue = Convert.ToDouble(foundChecked[j]["Common_Cur"]);
                                else
                                    SellPriceValue = 0.00;

                                if (foundChecked[j]["MaxCost_1"] != DBNull.Value)
                                    MaxCost = Convert.ToDouble(foundChecked[j]["MaxCost_1"]);
                                else
                                    MaxCost = 0.00;

                                foundChecked[j]["Profit"] = CalculateCustomerPriceProfitValue(MaxCost, SellPriceValue);
                                foundChecked[j]["CostMargin"] = CalculateCustomerPriceCostMarginValue(MaxCost, SellPriceValue);
                            }
                        }
                    }
                    else
                    {
                        DataRow Row = ((System.Data.DataRowView)((DevExpress.Xpf.Grid.RowEventArgs)obj).Row).Row;

                        if (Row["Value"] == DBNull.Value)
                        {
                            Row["Value"] = 0;
                        }
                        if (((DevExpress.Xpf.Grid.CellValueEventArgs)obj).Column.FieldName == "Logic")
                        {
                            if (Row["Logic"] == DBNull.Value || Convert.ToInt32(Row["Logic"]) == 0)
                            {
                                Row["Logic"] = 0;
                                Row["Value"] = DBNull.Value;
                            }
                        }
                        else
                        {
                            if (Row["Logic"] == DBNull.Value || Convert.ToInt32(Row["Logic"]) == 0)
                            {
                                Row["Logic"] = 308;
                            }
                        }

                        Row["IsColor"] = true;
                        Row["IsUpdatedRow"] = true;

                        if (Row["MaxCost_1"] == DBNull.Value)
                            Row["MaxCost_1"] = 0;

                        if (Row["Logic"] != DBNull.Value && Convert.ToInt32(Row["Logic"]) != 0)
                        {
                            Row["IsSalePriceValueColor"] = true;
                            Row["Enable_Delete"] = false;
                            Row["Enable_DescriptionLinked"] = false;
                            Row["Enable_VisibleCustomer"] = false;
                            if (Convert.ToInt32(Row["Logic"]) == 307)
                            {
                                if (Row["MaxCost_1"] == DBNull.Value)
                                {
                                    Row["MaxCost_1"] = 0;
                                }
                                Row["Common_Cur"] = Convert.ToDouble(Row["MaxCost_1"]) + ((Convert.ToDouble(Row["MaxCost_1"]) * (Convert.ToDouble(Row["Value"]) / 100)));
                                foreach (Currency cur in SelectedSaleCurrency)
                                {
                                    if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                    {
                                        if (Row["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && Row["CurrencyConversionRate_" + "Common_Cur"] != null && Row["CurrencyConversionRate_" + "Common_Cur"] != "")
                                        {
                                            Row["Common_Cur"] = Convert.ToDouble(Row["Common_Cur"]) * Convert.ToDouble(Row["CurrencyConversionRate_" + "Common_Cur"]);
                                        }
                                        else
                                            Row["Common_Cur"] = DBNull.Value;
                                    }
                                    else
                                    {
                                        if (Row["CurrencyConversionRate_" + cur.Name] != DBNull.Value && Row["CurrencyConversionRate_" + cur.Name] != null && Row["CurrencyConversionRate_" + cur.Name] != "")
                                        {
                                            Row[cur.Name] = Convert.ToDouble(Row["Common_Cur"]) * Convert.ToDouble(Row["CurrencyConversionRate_" + cur.Name]);
                                        }
                                        else
                                            Row[cur.Name] = DBNull.Value;
                                    }
                                }
                            }
                            else if (Convert.ToInt32(Row["Logic"]) == 308)
                            {
                                if (Row["Value"] == null || Convert.ToDouble(Row["Value"]) <= 0)
                                {
                                    Row["Value"] = DBNull.Value;
                                    Row["Common_Cur"] = DBNull.Value;
                                    foreach (Currency cur in SelectedSaleCurrency)
                                    {
                                        if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            Row["Common_Cur"] = DBNull.Value;
                                        }
                                        else
                                        {
                                            Row[cur.Name] = DBNull.Value;
                                        }
                                    }
                                }
                                else
                                {
                                    if (Row["MaxCost_1"] == DBNull.Value)
                                    {
                                        Row["MaxCost_1"] = 0;
                                    }

                                    Row["Common_Cur"] = Row["Value"];
                                    foreach (Currency cur in SelectedSaleCurrency)
                                    {
                                        if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            if (Row["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && Row["CurrencyConversionRate_" + "Common_Cur"] != null && Row["CurrencyConversionRate_" + "Common_Cur"] != "")
                                            {
                                                Row["Common_Cur"] = Convert.ToDouble(Row["Common_Cur"]) * Convert.ToDouble(Row["CurrencyConversionRate_" + "Common_Cur"]);
                                            }
                                            else
                                                Row["Common_Cur"] = DBNull.Value;
                                        }
                                        else
                                        {
                                            if (Row["CurrencyConversionRate_" + cur.Name] != DBNull.Value && Row["CurrencyConversionRate_" + cur.Name] != null && Row["CurrencyConversionRate_" + cur.Name] != "")
                                            {
                                                Row[cur.Name] = Convert.ToDouble(Row["Common_Cur"]) * Convert.ToDouble(Row["CurrencyConversionRate_" + cur.Name]);
                                            }
                                            else
                                                Row[cur.Name] = DBNull.Value;
                                        }
                                    }
                                }
                            }
                            else if (Convert.ToInt32(Row["Logic"]) == 1518)
                            {
                                if (Row["Value"] == null || Row["Value"] == DBNull.Value)
                                {
                                    Row["Value"] = 0;

                                    Row["Common_Cur"] = 0;

                                    foreach (Currency cur in SelectedSaleCurrency)
                                    {
                                        if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            Row["Common_Cur"] = 0;
                                        }
                                        else
                                        {
                                            Row[cur.Name] = 0;
                                        }
                                    }
                                }
                                else if (Row["Value"] != null)
                                {
                                    Row["Value"] = 0;

                                    Row["Common_Cur"] = 0;

                                    foreach (Currency cur in SelectedSaleCurrency)
                                    {
                                        if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            Row["Common_Cur"] = 0;
                                        }
                                        else
                                        {
                                            Row[cur.Name] = 0;
                                        }
                                    }
                                }
                            }
                            else if (Convert.ToInt32(Row["Logic"]) == 309)
                            {
                                if (Row["MaxCost_1"] == DBNull.Value)
                                {
                                    Row["MaxCost_1"] = 0;
                                }
                                Row["Common_Cur"] = Convert.ToDouble(Row["MaxCost_1"]) + (Convert.ToDouble(Row["Value"]));
                                foreach (Currency cur in SelectedSaleCurrency)
                                {
                                    if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                    {
                                        if (Row["CurrencyConversionRate_" + "Common_Cur"] != DBNull.Value && Row["CurrencyConversionRate_" + "Common_Cur"] != null && Row["CurrencyConversionRate_" + "Common_Cur"] != "")
                                        {
                                            Row["Common_Cur"] = Convert.ToDouble(Row["Common_Cur"]) * Convert.ToDouble(Row["CurrencyConversionRate_" + "Common_Cur"]);
                                        }
                                        else
                                            Row["Common_Cur"] = DBNull.Value;
                                    }
                                    else
                                    {
                                        if (Row["CurrencyConversionRate_" + cur.Name] != DBNull.Value && Row["CurrencyConversionRate_" + cur.Name] != null && Row["CurrencyConversionRate_" + cur.Name] != "")
                                        {
                                            Row[cur.Name] = Convert.ToDouble(Row["Common_Cur"]) * Convert.ToDouble(Row["CurrencyConversionRate_" + cur.Name]);
                                        }
                                        else
                                            Row[cur.Name] = DBNull.Value;
                                    }
                                }
                            }

                        }
                        else
                        {
                            //set from bpl
                            Row["IsSalePriceValueColor"] = false;
                            Row["Enable_Delete"] = true;
                            Row["Enable_DescriptionLinked"] = true;
                            Row["Enable_VisibleCustomer"] = true;
                            CustomerPriceListByItem record = ModuleList.FirstOrDefault(a => a.IdCPType == Convert.ToUInt64(Row["IdCPType"]));
                            int indexSelectedCurrency = DtModule.Columns.IndexOf("Common_Cur");
                            int indexCurrencyConversionDate = DtModule.Columns.IndexOf("CurrencyConversionDate");
                            DateTime? indexCurrencyConversionDateValue = null;
                            //if (record.CurrencyConversionDate_New != null)
                            //{
                            //    indexCurrencyConversionDateValue = Convert.ToDateTime(record.CurrencyConversionDate_New);
                            //    Row["CurrencyConversionDate"] = indexCurrencyConversionDateValue;
                            //}

                            indexCurrencyConversionDateValue = CurrencyConversionList.FirstOrDefault().LastUpdate;
                            Row["CurrencyConversionDate"] = indexCurrencyConversionDateValue;


                            if (Convert.ToInt32(record.IdRule) == 307)
                            {
                                Row[indexSelectedCurrency] = Convert.ToDouble(record.MaxCost) + ((Convert.ToDouble(record.MaxCost) * (Convert.ToDouble(record.RuleValue) / 100)));

                                foreach (Currency currency in SelectedSaleCurrency)
                                {
                                    if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                    {
                                        Int32 IndexSelectedSaleCurrency = DtModule.Columns.IndexOf("CurrencyConversionRate_" + "Common_Cur");
                                        Int32 IndexCurrencyName = DtModule.Columns.IndexOf("Common_Cur");
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(indexCurrencyConversionDateValue.Value.Date));
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                Row[IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                            else
                                                Row[IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                        }

                                        else
                                            Row[IndexSelectedSaleCurrency] = DBNull.Value;
                                        if (Row[IndexSelectedSaleCurrency] != DBNull.Value && Row[IndexSelectedSaleCurrency] != null && Row[IndexSelectedSaleCurrency] != "")
                                        {
                                            Row[IndexCurrencyName] = Convert.ToDouble(Row[indexSelectedCurrency]) * Convert.ToDouble(Row[IndexSelectedSaleCurrency]);
                                        }
                                        else
                                            Row[IndexCurrencyName] = DBNull.Value;
                                    }
                                    else
                                    {
                                        Int32 IndexSelectedSaleCurrency = DtModule.Columns.IndexOf("CurrencyConversionRate_" + currency.Name);
                                        Int32 IndexCurrencyName = DtModule.Columns.IndexOf(currency.Name);
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(indexCurrencyConversionDateValue.Value.Date));
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                Row[IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                            else
                                                Row[IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                        }

                                        else
                                            Row[IndexSelectedSaleCurrency] = DBNull.Value;
                                        if (Row[IndexSelectedSaleCurrency] != DBNull.Value && Row[IndexSelectedSaleCurrency] != null && Row[IndexSelectedSaleCurrency] != "")
                                        {
                                            Row[IndexCurrencyName] = Convert.ToDouble(Row[indexSelectedCurrency]) * Convert.ToDouble(Row[IndexSelectedSaleCurrency]);
                                        }
                                        else
                                            Row[IndexCurrencyName] = DBNull.Value;
                                    }
                                }
                            }
                            else if (Convert.ToInt32(record.IdRule) == 308)
                            {
                                Row[indexSelectedCurrency] = record.RuleValue;
                                foreach (Currency currency in SelectedSaleCurrency)
                                {
                                    if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                    {
                                        Int32 IndexSelectedSaleCurrency = DtModule.Columns.IndexOf("CurrencyConversionRate_" + "Common_Cur");
                                        Int32 IndexCurrencyName = DtModule.Columns.IndexOf("Common_Cur");
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(indexCurrencyConversionDateValue.Value.Date));
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                Row[IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                            else
                                                Row[IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                        }

                                        else
                                            Row[IndexSelectedSaleCurrency] = DBNull.Value;
                                        if (Row[IndexSelectedSaleCurrency] != DBNull.Value && Row[IndexSelectedSaleCurrency] != null && Row[IndexSelectedSaleCurrency] != "")
                                            Row[IndexCurrencyName] = Convert.ToDouble(Row[indexSelectedCurrency]) * Convert.ToDouble(Row[IndexSelectedSaleCurrency]);
                                        else
                                            Row[IndexCurrencyName] = DBNull.Value;
                                    }
                                    else
                                    {
                                        Int32 IndexSelectedSaleCurrency = DtModule.Columns.IndexOf("CurrencyConversionRate_" + currency.Name);
                                        Int32 IndexCurrencyName = DtModule.Columns.IndexOf(currency.Name);
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(indexCurrencyConversionDateValue.Value.Date));
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                Row[IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                            else
                                                Row[IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                        }

                                        else
                                            Row[IndexSelectedSaleCurrency] = DBNull.Value;
                                        if (Row[IndexSelectedSaleCurrency] != DBNull.Value && Row[IndexSelectedSaleCurrency] != null && Row[IndexSelectedSaleCurrency] != "")
                                            Row[IndexCurrencyName] = Convert.ToDouble(Row[indexSelectedCurrency]) * Convert.ToDouble(Row[IndexSelectedSaleCurrency]);
                                        else
                                            Row[IndexCurrencyName] = DBNull.Value;
                                    }
                                }
                            }
                            else if (Convert.ToInt32(record.IdRule) == 1518)
                            {
                                if (Row["Value"] == null || Row["Value"] == DBNull.Value)
                                {
                                    Row["Value"] = 0;

                                    Row["Common_Cur"] = 0;

                                    foreach (Currency cur in SelectedSaleCurrency)
                                    {
                                        if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            Row["Common_Cur"] = 0;
                                        }
                                        else
                                        {
                                            Row[cur.Name] = 0;
                                        }
                                    }
                                }
                                else if (Row["Value"] != null)
                                {
                                    Row["Value"] = 0;

                                    Row["Common_Cur"] = 0;

                                    foreach (Currency cur in SelectedSaleCurrency)
                                    {
                                        if (cur.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            Row["Common_Cur"] = 0;
                                        }
                                        else
                                        {
                                            Row[cur.Name] = 0;
                                        }
                                    }
                                }
                            }
                            else if (Convert.ToInt32(record.IdRule) == 309)
                            {
                                Row[indexSelectedCurrency] = Convert.ToDouble(record.MaxCost) + (Convert.ToDouble(record.RuleValue));

                                foreach (Currency currency in SelectedSaleCurrency)
                                {
                                    if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                    {
                                        Int32 IndexSelectedSaleCurrency = DtModule.Columns.IndexOf("CurrencyConversionRate_" + "Common_Cur");
                                        Int32 IndexCurrencyName = DtModule.Columns.IndexOf("Common_Cur");
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(indexCurrencyConversionDateValue.Value.Date));
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                Row[IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                            else
                                                Row[IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                        }

                                        else
                                            Row[IndexSelectedSaleCurrency] = DBNull.Value;
                                        if (Row[IndexSelectedSaleCurrency] != DBNull.Value && Row[IndexSelectedSaleCurrency] != null && Row[IndexSelectedSaleCurrency] != "")
                                            Row[IndexCurrencyName] = Convert.ToDouble(Row[indexSelectedCurrency]) * Convert.ToDouble(Row[IndexSelectedSaleCurrency]);
                                        else
                                            Row[IndexCurrencyName] = DBNull.Value;
                                    }
                                    else
                                    {
                                        Int32 IndexSelectedSaleCurrency = DtModule.Columns.IndexOf("CurrencyConversionRate_" + currency.Name);
                                        Int32 IndexCurrencyName = DtModule.Columns.IndexOf(currency.Name);
                                        CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == Convert.ToDateTime(indexCurrencyConversionDateValue.Value.Date));
                                        if (CurConversion1 != null)
                                        {
                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                Row[IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                            else
                                                Row[IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                        }

                                        else
                                            Row[IndexSelectedSaleCurrency] = DBNull.Value;
                                        if (Row[IndexSelectedSaleCurrency] != DBNull.Value && Row[IndexSelectedSaleCurrency] != null && Row[IndexSelectedSaleCurrency] != "")
                                            Row[IndexCurrencyName] = Convert.ToDouble(Row[indexSelectedCurrency]) * Convert.ToDouble(Row[IndexSelectedSaleCurrency]);
                                        else
                                            Row[IndexCurrencyName] = DBNull.Value;
                                    }
                                }
                            }

                            Row["Value"] = DBNull.Value;
                            //delete Modules
                            if (DeleteModules == null)
                                DeleteModules = new List<BPLModule>();

                            BPLModule det = new BPLModule();
                            det.IdCPType = (uint)Row["IdCPType"];
                            DeleteModules.Add(det);
                        }

                        if (Row["Common_Cur"] != DBNull.Value)
                            SellPriceValue = Convert.ToDouble(Row["Common_Cur"]);
                        else
                            SellPriceValue = 0;

                        if (Row["MaxCost_1"] != DBNull.Value)
                            MaxCost = Convert.ToDouble(Row["MaxCost_1"]);
                        else
                            MaxCost = 0;

                        Row["Profit"] = CalculateCustomerPriceProfitValue(MaxCost, SellPriceValue);
                        Row["CostMargin"] = CalculateCustomerPriceCostMarginValue(MaxCost, SellPriceValue);
                    }
                    DtModule.AcceptChanges();
                    IsEnabledSaveButton = true;
                }
                GeosApplication.Instance.Logger.Log("Method RuleValueChangedCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method RuleValueChangedCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void ModuleGridControlLoadedAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ModuleGridControlLoadedAction...", category: Category.Info, priority: Priority.Low);
                GridControl gridControl = obj as GridControl;
                TableView tableView = (TableView)gridControl.View;
                this.moduleTableView = tableView;
                try
                {
                    SelectedTileBarItem = null;
                    ModuleSelectedTileBarItem = null;
                }
                catch (Exception ex)
                {

                }
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Method ModuleGridControlLoadedAction executed successfully...", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Error on ModuleGridControlLoadedAction() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        private void ModuleGridControlUnloadedAction(object obj)
        {
            try
            {
                if (IsFirstTimeLoad == true)
                {
                    IsFirstTimeLoad = false;
                    return;
                }
                GeosApplication.Instance.Logger.Log("Method ModuleGridControlUnloadedAction...", category: Category.Info, priority: Priority.Low);
                GridControl gridControl = obj as GridControl;
                if (gridControl.Columns.Count() > 0)
                {
                    TableView tableView = (TableView)gridControl.View;
                    tableView.SearchString = string.Empty;
                    if (gridControl.GroupCount > 0)
                        gridControl.ClearGrouping();

                    gridControl.ClearSorting();
                    gridControl.FilterString = null;
                    gridControl.SaveLayoutToXml(CPLModuleGridSettingFilePath);
                    IsSwitch = false;
                }
                else
                {
                    IsFirstTimeArticleLoad = false;
                    IsSwitch = true;
                }
                IsFirstTimeDetectionLoad = false;
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Method ModuleGridControlUnloadedAction executed successfully...", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Error on ModuleGridControlUnloadedAction() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        private void DeleteModuleCommandAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method DeleteModuleCommandAction()...", category: Category.Info, priority: Priority.Low);
                DataColumn[] columns = DtModuleCopy.Columns.Cast<DataColumn>().ToArray();
                DataRow[] foundChecked = DtModuleCopy.AsEnumerable().Where(row => columns.Any(col => row["IsChecked"].ToString() == "True")).ToArray();
                DataRow MainRow = ((System.Data.DataRowView)obj).Row;

                //if (ClonedCustomerPrice != null && ClonedCustomerPrice.IdStatus == 224)
                //[Sudhir.Jangra][GEOS2-3349][27/12/2022]
                if (ClonedCustomerPrice != null && isDuplicateClicked == false && ClonedCustomerPrice.IdStatus == 224)
                {
                    CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("CantChangeCPLValidation").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                    return;
                }

                if (DeleteModules == null)
                    DeleteModules = new List<BPLModule>();

                if (foundChecked.Length > 0 && MainRow["IsChecked"].ToString() != "False")
                {
                    MessageBoxResult MessageBoxResult = CustomMessageBox.Show(Application.Current.Resources["DeleteBPLModuleMessage"].ToString(), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                    if (MessageBoxResult == MessageBoxResult.Yes)
                    {
                        if (foundChecked.Length > 0)
                        {
                            foreach (DataRow dr in foundChecked)
                            {
                                BPLModule det = new BPLModule();
                                det.IdCPType = (uint)dr["IdCPType"];
                                DeleteModules.Add(det);
                                DtModuleCopy.Rows.Remove(dr);
                            }
                        }
                        DtModule = DtModuleCopy;
                        IsEnabledSaveButton = true;
                    }
                }
                else
                {
                    MessageBoxResult MessageBoxResult = CustomMessageBox.Show(Application.Current.Resources["DeleteBPLModuleMessageSelected"].ToString(), Application.Current.Resources["PopUpDeleteColor"].ToString(), CustomMessageBox.MessageImagePath.Question, MessageBoxButton.YesNo);
                    if (MessageBoxResult == MessageBoxResult.Yes)
                    {
                        if (obj != null)
                        {
                            BPLModule det = new BPLModule();
                            det.IdCPType = (uint)MainRow["IdCPType"];
                            DeleteModules.Add(det);
                            DtModuleCopy.Rows.Remove(((System.Data.DataRowView)obj).Row);
                        }
                        DtModule = DtModuleCopy;
                        IsEnabledSaveButton = true;
                    }
                }

                GeosApplication.Instance.Logger.Log("Method DeleteModuleCommandAction()....executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method DeleteModuleCommandAction()...." + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        private void EditModuleItem01(object obj)
        {
            try
            {
                if (GeosApplication.Instance.ActiveUser.UserPermissions.Any(p => p.IdPermission == 33))
                {
                    GeosApplication.Instance.Logger.Log("Method EditModuleItem()...", category: Category.Info, priority: Priority.Low);

                    if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<SplashScreenView>(); }


                    if (obj == null) return;

                    //ModuleDetails Modules = null;

                    if (obj is TableView)
                    {
                        TableView detailView = (TableView)obj;

                        UInt32 idDetection = Convert.ToUInt32(((System.Data.DataRowView)detailView.DataControl.CurrentItem).Row.ItemArray[7]);
                        string detectionTypeName = Convert.ToString(((System.Data.DataRowView)detailView.DataControl.CurrentItem).Row.ItemArray[3]);
                    }

                    if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                    GeosApplication.Instance.Logger.Log("Method EditModuleItem()....executed successfully", category: Category.Info, priority: Priority.Low);
                }
                else
                {
                    CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("PLMEditArticleInformation").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                }
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log(string.Format("Error in Method EditModuleItem()..", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        private void EditModuleAction(object obj)
        {
            try
            {
                if (GeosApplication.Instance.ActiveUser.UserPermissions.Any(p => p.IdPermission == 33))
                {
                    GeosApplication.Instance.Logger.Log(string.Format("Method EditModuleAction()..."), category: Category.Info, priority: Priority.Low);
                    if (!DXSplashScreen.IsActive) { DXSplashScreen.Show<Views.SplashScreenView>(); }

                    TableView detailView = (TableView)obj;
                    GridControl gridControl = (detailView).Grid;

                    DataRowView dr = (System.Data.DataRowView)detailView.DataControl.CurrentItem;
                    int IdCPType = Convert.ToInt32(dr.Row["IdCPType"].ToString());
                    string Template = Convert.ToString(dr.Row["Type"].ToString());
                    CustomerPriceListByItem basePriceListByItem = ModuleList.Where(w => w.IdCPType == IdCPType).FirstOrDefault();
                    int IdTemplate = 0;
                    if (basePriceListByItem == null)
                    {
                        IdTemplate = ModuleMenulist.FirstOrDefault(f => f.IdCPType == Convert.ToUInt64(IdCPType)).IdTemplate;
                    }
                    else
                    {
                        IdTemplate = basePriceListByItem.ProductType.Template.IdTemplate;
                    }
                    Emdep.Geos.Modules.PCM.Views.ProductTypeView productTypeView = new Emdep.Geos.Modules.PCM.Views.ProductTypeView();
                    Emdep.Geos.Modules.PCM.ViewModels.ProductTypeViewModel productTypeViewModel = new Emdep.Geos.Modules.PCM.ViewModels.ProductTypeViewModel();
                    PCM.Views.EditProductTypeView editProductTypeView = new PCM.Views.EditProductTypeView();
                    EditProductTypeViewModel editProductTypeViewModel = new EditProductTypeViewModel();
                    EventHandler handle = delegate { editProductTypeView.Close(); };
                    editProductTypeViewModel.RequestClose += handle;
                    editProductTypeView.DataContext = editProductTypeViewModel;

                    editProductTypeViewModel.ProductTypeItem = new ProductTypes();

                    editProductTypeViewModel.ProductTypeItem.IdCPType = (ulong)IdCPType;
                    editProductTypeViewModel.ProductTypeItem.IdTemplate = (byte)IdTemplate;
                    int IdScope = 1635;
                    editProductTypeViewModel.Init(IdScope);
                    editProductTypeViewModel.SelectedTemplate = editProductTypeViewModel.TemplatesMenuList.FirstOrDefault(x => x.IdTemplate == IdTemplate);
                    var ownerInfo = (detailView as FrameworkElement);
                    editProductTypeView.Owner = Window.GetWindow(ownerInfo);
                    editProductTypeViewModel.isEnabledCancelButton = false;
                    editProductTypeView.ShowDialog();
                    if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                    GeosApplication.Instance.Logger.Log(string.Format("Method EditModuleAction()....executed successfully"), category: Category.Info, priority: Priority.Low);
                }
                else
                {
                    CustomMessageBox.Show(string.Format(System.Windows.Application.Current.FindResource("PLMEditModulesInformation").ToString()), Application.Current.Resources["PopUpWarningColor"].ToString(), CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
                }
            }
            catch (Exception ex)
            {
                if (DXSplashScreen.IsActive) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log(string.Format("Error in method EditModuleAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }

        private void AddColumnsToModuleDataTableBySaleCurrency()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method AddColumnsToModuleDataTableBySaleCurrency ...", category: Category.Info, priority: Priority.Low);
                if (SelectedSaleCurrency == null)
                    SelectedSaleCurrency = new List<object>();
                if (SelectedCurrency == null)
                    SelectedCurrency = new List<object>();

                if (ModuleBands.Count > 0)
                {
                    foreach (BandItem bandItem in ModuleBands)
                    {
                        if (bandItem.BandHeader == "Sale Price")
                        {
                            foreach (Currency currency in SelectedSaleCurrency)
                            {
                                if (!bandItem.Columns.Any(a => a.HeaderText == currency.Name))
                                {
                                    string fieldName = currency.Name;
                                    DtModuleCopy.Columns.Add(fieldName, typeof(double));
                                    bandItem.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = fieldName, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                    DtModuleCopy.Columns.Add("CurrencyConversionRate_" + currency.Name, typeof(double));
                                }
                            }
                            List<ColumnItem> columns = new List<ColumnItem>(bandItem.Columns);
                            if (bandItem.Columns.Count != SelectedSaleCurrency.Count)
                            {
                                foreach (ColumnItem columnItem in columns.ToList())
                                {
                                    if (!SelectedSaleCurrency.Cast<Currency>().Any(a => a.Name == columnItem.HeaderText))
                                    {
                                        string fieldName = columnItem.HeaderText;
                                        DtModuleCopy.Columns.Remove(fieldName);
                                        bandItem.Columns.Remove(columnItem);

                                        DtModuleCopy.Columns.Remove("CurrencyConversionRate_" + fieldName);
                                    }
                                }
                            }
                            if (!SelectedSaleCurrency.Cast<Currency>().Any(a => a.Name == ((Currency)SelectedCurrency).Name))
                            {
                                SelectedSaleCurrency.Add(SaleCurrencyList.FirstOrDefault(a => a.Name == ((Currency)SelectedCurrency).Name));
                                SelectedSaleCurrency = new List<object>(SelectedSaleCurrency);
                                string fieldName = "Common_Cur";
                                DtModuleCopy.Columns.Remove(fieldName);
                                DtModuleCopy.Columns.Add(fieldName, typeof(double));
                                bandItem.Columns.Remove(bandItem.Columns.FirstOrDefault(a => a.ColumnFieldName == fieldName));
                                bandItem.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });

                                DtModuleCopy.Columns.Remove("CurrencyConversionRate_" + fieldName);
                                DtModuleCopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));


                                string fieldName1 = ((Currency)SelectedCurrency_Copy).Name;
                                DtModuleCopy.Columns.Add(fieldName1, typeof(double));
                                bandItem.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName1, HeaderText = fieldName1, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                DtModuleCopy.Columns.Add("CurrencyConversionRate_" + fieldName1, typeof(double));

                                SelectedSaleCurrency_Copy = SelectedSaleCurrency;
                            }
                        }
                    }

                    // reorder by common currency
                    BandItem item = ModuleBands.FirstOrDefault(a => a.BandHeader == "Sale Price");
                    if (item.Columns.FirstOrDefault().HeaderText != ((Currency)SelectedCurrency).Name)
                    {
                        int count = 0;
                        foreach (Currency item1 in SelectedSaleCurrency.Cast<Currency>())
                        {
                            if (count == 0)
                            {
                                count = 1;
                                //string fieldName = ((Currency)SelectedCurrency).Name;
                                string fieldName = "Common_Cur";
                                DtModuleCopy.Columns.Remove(fieldName);
                                DtModuleCopy.Columns.Add(fieldName, typeof(double));
                                item.Columns.Remove(item.Columns.FirstOrDefault(a => a.ColumnFieldName == fieldName));
                                item.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                DtModuleCopy.Columns.Remove("CurrencyConversionRate_" + fieldName);
                                DtModuleCopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));

                                if (DtModuleCopy.Columns.Contains(((Currency)SelectedCurrency).Name))
                                    DtModuleCopy.Columns.Remove(((Currency)SelectedCurrency).Name);

                                if (DtModuleCopy.Columns.Contains("CurrencyConversionRate_" + ((Currency)SelectedCurrency).Name))
                                    DtModuleCopy.Columns.Remove("CurrencyConversionRate_" + ((Currency)SelectedCurrency).Name);

                                item.Columns.Remove(item.Columns.FirstOrDefault(a => a.ColumnFieldName == ((Currency)SelectedCurrency).Name));

                                if (item1.Name != ((Currency)SelectedCurrency).Name)
                                {
                                    string fieldName1 = item1.Name;
                                    if (DtModuleCopy.Columns.Contains(fieldName1))
                                        DtModuleCopy.Columns.Remove(fieldName1);

                                    DtModuleCopy.Columns.Add(fieldName1, typeof(double));
                                    item.Columns.Remove(item.Columns.FirstOrDefault(a => a.ColumnFieldName == fieldName1));
                                    item.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName1, HeaderText = fieldName1, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });

                                    if (DtModuleCopy.Columns.Contains("CurrencyConversionRate_" + fieldName1))
                                        DtModuleCopy.Columns.Remove("CurrencyConversionRate_" + fieldName1);

                                    DtModuleCopy.Columns.Add("CurrencyConversionRate_" + fieldName1, typeof(double));
                                }
                            }
                            else
                            {
                                if (item1.Name != ((Currency)SelectedCurrency).Name)
                                {
                                    string fieldName = item1.Name;
                                    if (DtModuleCopy.Columns.Contains(fieldName))
                                        DtModuleCopy.Columns.Remove(fieldName);

                                    DtModuleCopy.Columns.Add(fieldName, typeof(double));
                                    item.Columns.Remove(item.Columns.FirstOrDefault(a => a.ColumnFieldName == fieldName));
                                    item.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = fieldName, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });

                                    if (DtModuleCopy.Columns.Contains("CurrencyConversionRate_" + fieldName))
                                        DtModuleCopy.Columns.Remove("CurrencyConversionRate_" + fieldName);

                                    DtModuleCopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));
                                }
                            }
                        }
                    }

                    ModuleBands = new ObservableCollection<BandItem>(ModuleBands);
                }
                else
                {
                    ModuleBands.Clear();
                    BandItem band1 = new BandItem() { BandName = "All", AllowBandMove = false, FixedStyle = FixedStyle.Left, Visible = true, AllowMoving = DevExpress.Utils.DefaultBoolean.False };
                    band1.Columns = new ObservableCollection<ColumnItem>();
                    band1.Columns.Add(new ColumnItem() { ColumnFieldName = "IsChecked", HeaderText = " ", Width = 50, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    band1.Columns.Add(new ColumnItem() { ColumnFieldName = "Code", HeaderText = "Code", Width = 100, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    ModuleBands.Add(band1);

                    BandItem band2 = new BandItem() { BandName = "All1", BandHeader = "" };
                    band2.Columns = new ObservableCollection<ColumnItem>();
                    band2.Columns.Add(new ColumnItem() { ColumnFieldName = "Name", HeaderText = "Name", Width = 350, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    band2.Columns.Add(new ColumnItem() { ColumnFieldName = "Type", HeaderText = "Template", Width = 100, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    band2.Columns.Add(new ColumnItem() { ColumnFieldName = "STAT", HeaderText = "STAT", Width = 40, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    ModuleBands.Add(band2);


                    DtModuleCopy = new DataTable();
                    DtModuleCopy.Columns.Add("IsChecked", typeof(bool));
                    DtModuleCopy.Columns.Add("Code", typeof(string));
                    DtModuleCopy.Columns.Add("Type", typeof(string));
                    DtModuleCopy.Columns.Add("Name", typeof(string));
                    DtModuleCopy.Columns.Add("STAT", typeof(string));
                    DtModuleCopy.Columns.Add("HtmlColor", typeof(string));
                    DtModuleCopy.Columns.Add("IdCPType", typeof(UInt32));
                    DtModuleCopy.Columns.Add("CurrencyConversionDate", typeof(DateTime));
                    DtModuleCopy.Columns.Add("Name_Old", typeof(string));
                    DtModuleCopy.Columns.Add("Name_Changed", typeof(bool));
                    DtModuleCopy.Columns.Add("Visible_Customer", typeof(bool)).DefaultValue = false;
                    DtModuleCopy.Columns.Add("Enable_VisibleCustomer", typeof(bool)).DefaultValue = false;
                    DtModuleCopy.Columns.Add("Enable_DescriptionLinked", typeof(bool)).DefaultValue = false;
                    DtModuleCopy.Columns.Add("Enable_Delete", typeof(bool)).DefaultValue = false;
                    DtModuleCopy.Columns.Add("SaleCurrencyConversionDate", typeof(string));

                    //max cost	
                    BandItem band3 = new BandItem() { BandName = "max cost", BandHeader = "Max Cost" };
                    band3.Columns = new ObservableCollection<ColumnItem>();
                    string fieldName2 = "MaxCost_1";
                    DtModuleCopy.Columns.Add(fieldName2, typeof(double));
                    band3.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName2, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });
                    //Base price	
                    BandItem band4 = new BandItem() { BandName = "base price", BandHeader = "Base Price" };
                    band4.Columns = new ObservableCollection<ColumnItem>();
                    string fieldName5 = "BasePriceValue";
                    DtModuleCopy.Columns.Add(fieldName5, typeof(double));
                    band4.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName5, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });
                    ModuleBands.Add(band4);
                    //rule	
                    BandItem band5 = new BandItem() { BandName = "rule", BandHeader = "Rule" };
                    band5.Columns = new ObservableCollection<ColumnItem>();
                    string fieldName3 = "Value";
                    DtModuleCopy.Columns.Add("Value", typeof(float));
                    band5.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName3, HeaderText = fieldName3, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.Default });
                    string fieldName4 = "Logic";
                    DtModuleCopy.Columns.Add(fieldName4, typeof(int));
                    band5.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName4, HeaderText = fieldName4, Width = 50, Visible = true, IsVertical = false, Settings = SettingsType.Default });
                    ModuleBands.Add(band5);
                    //Sale Currency	
                    BandItem band6 = new BandItem() { BandName = "sale price", BandHeader = "Sale Price" };
                    band6.Columns = new ObservableCollection<ColumnItem>();
                    int count = 0;
                    foreach (Currency currency in SelectedSaleCurrency)
                    {
                        // code modified for reorder by common currency 
                        if (count == 0)
                        {
                            count = 1;
                            string fieldName = "Common_Cur";
                            DtModuleCopy.Columns.Add(fieldName, typeof(double));
                            band6.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName, HeaderText = ((Currency)SelectedCurrency).Name, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                            DtModuleCopy.Columns.Add("CurrencyConversionRate_" + fieldName, typeof(double));

                            if (currency.Name != ((Currency)SelectedCurrency).Name)
                            {
                                string fieldName1 = currency.Name;
                                DtModuleCopy.Columns.Add(fieldName1, typeof(double));
                                band6.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName1, HeaderText = fieldName1, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                DtModuleCopy.Columns.Add("CurrencyConversionRate_" + fieldName1, typeof(double));
                            }
                        }
                        else
                        {
                            if (currency.Name != ((Currency)SelectedCurrency).Name)
                            {
                                string fieldName1 = currency.Name;
                                DtModuleCopy.Columns.Add(fieldName1, typeof(double));
                                band6.Columns.Add(new ColumnItem() { ColumnFieldName = fieldName1, HeaderText = fieldName1, Width = 100, Visible = true, IsVertical = false, Settings = SettingsType.SellPriceValue });
                                DtModuleCopy.Columns.Add("CurrencyConversionRate_" + fieldName1, typeof(double));
                            }
                        }
                    }
                    ModuleBands.Add(band6);
                    BandItem band7 = new BandItem() { BandName = "All2", AllowBandMove = false, Visible = true, AllowMoving = DevExpress.Utils.DefaultBoolean.False, AllowPrinting = false };
                    band7.Columns = new ObservableCollection<ColumnItem>();
                    band7.Columns.Add(new ColumnItem() { ColumnFieldName = "Delete", HeaderText = " ", Width = 50, IsVertical = false, Settings = SettingsType.Default, Visible = true });
                    ModuleBands.Add(band7);
                }
                ModuleBands = new ObservableCollection<BandItem>(ModuleBands);
                DtModule = DtModuleCopy;
                GeosApplication.Instance.Logger.Log("Method AddColumnsToModuleDataTableBySaleCurrency executed Successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (FaultException<ServiceException> ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in AddColumnsToModuleDataTableBySaleCurrency() method " + ex.Detail.ErrorMessage, category: Category.Exception, priority: Priority.Low);
                CustomMessageBox.Show(GeosApplication.Instance.ExceptionHandlingOperationString(ex.Detail, null), "Red", CustomMessageBox.MessageImagePath.NotOk, MessageBoxButton.OK);
            }
            catch (ServiceUnexceptedException ex)
            {
                if (DXSplashScreen.IsActive && !GeosApplication.Instance.IsLoadOneTime) { DXSplashScreen.Close(); }
                GeosApplication.Instance.Logger.Log("Get an error in AddColumnsToModuleDataTableBySaleCurrency() Method - ServiceUnexceptedException " + ex.Message, category: Category.Exception, priority: Priority.Low);
                GeosApplication.Instance.ExceptionHandlingOperation(ex.ExceptionType, GeosApplication.Instance.ApplicationSettings["ServicePath"].ToString(), null);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in AddColumnsToModuleDataTableBySaleCurrency() Method " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }

        public void CalculateBasePriceModulesByLogicValue()
        {
            try
            {
                if (DtModule != null && DtModule.Rows.Count > 0)
                {
                    int IndexselectedCurrencyName_ = DtModule.Columns.IndexOf("MaxCost_1");
                    int IndexselectedCurrencyName_1 = DtModule.Columns.IndexOf("BasePriceValue");
                    int indexIdModule = DtModule.Columns.IndexOf("IdModule");
                    int indexCurrencyConversionDate = DtModule.Columns.IndexOf("CurrencyConversionDate");
                    int indexValue = DtModule.Columns.IndexOf("Value");
                    int indexLogic = DtModule.Columns.IndexOf("Logic");

                    int indexProfit = DtModule.Columns.IndexOf("Profit");
                    int indexCost = DtModule.Columns.IndexOf("CostMargin");

                    int indexSelectedCurrency = DtModule.Columns.IndexOf("Common_Cur");
                    int indexIsUpdatedRow = DtModule.Columns.IndexOf("IsUpdatedRow");



                    for (int j = 0; j < DtModule.Rows.Count; j++)
                    {
                        try
                        {
                            DtModule.Rows[j].BeginEdit();
                            UInt64 idModule = Convert.ToUInt64(DtModule.Rows[j][indexIdModule]);
                            double? value = null;
                            Int32? logic = null;
                            DateTime? indexCurrencyConversionDateValue = null;
                            double IndexselectedCurrencyName_Value = 0;
                            double IndexselectedCurrencyName_Value1 = 0;
                            double IndexselectedCurrencyNameValue = 0;
                            double indexSelectedCurrencyvalue = 0;
                            if (DtModule.Rows[j][indexSelectedCurrency] != DBNull.Value)
                                indexSelectedCurrencyvalue = Convert.ToDouble(DtModule.Rows[j][indexSelectedCurrency]);
                            if (DtModule.Rows[j][indexValue] != DBNull.Value)
                                value = Convert.ToInt32(DtModule.Rows[j][indexValue]);
                            if (DtModule.Rows[j][indexLogic] != DBNull.Value)
                                logic = Convert.ToInt32(DtModule.Rows[j][indexLogic]);
                            if (DtModule.Rows[j][IndexselectedCurrencyName_] != DBNull.Value)
                                IndexselectedCurrencyName_Value = Convert.ToDouble(DtModule.Rows[j][IndexselectedCurrencyName_]);
                            if (DtModule.Rows[j][indexSelectedCurrency] != DBNull.Value)
                                IndexselectedCurrencyNameValue = Convert.ToDouble(DtModule.Rows[j][indexSelectedCurrency]);
                            if (DtModule.Rows[j][IndexselectedCurrencyName_1] != DBNull.Value)
                                IndexselectedCurrencyName_Value1 = Convert.ToDouble(DtModule.Rows[j][IndexselectedCurrencyName_1]);

                            //if (DtModule.Rows[j][indexCurrencyConversionDate] != DBNull.Value)
                            //    indexCurrencyConversionDateValue = Convert.ToDateTime(DtModule.Rows[j][indexCurrencyConversionDate]);

                            List<CurrencyConversion> filterConversionDate = new List<CurrencyConversion>();
                            if (CurrencyConversionList != null && CurrencyConversionList.Count > 0)
                                filterConversionDate = CurrencyConversionList.Where(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency)).ToList();


                            double Cost_Value = 0;
                            double SellPriceValue = 0.00;
                            DtModule.Rows[j][indexIsUpdatedRow] = true;

                            Cost_Value = IndexselectedCurrencyName_Value;

                            DtModule.Rows[j][IndexselectedCurrencyName_1] = IndexselectedCurrencyName_Value1;

                            CustomerPriceListByItem record = ModuleList.FirstOrDefault(a => a.IdCPType == idModule);
                            indexCurrencyConversionDateValue = filterConversionDate.FirstOrDefault().LastUpdate;

                            if (logic != 0)
                            {
                                // for CPL
                                foreach (Currency currency in SelectedSaleCurrency)
                                {
                                    if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                    {
                                        Int32 IndexSelectedSaleCurrency = DtModule.Columns.IndexOf("CurrencyConversionRate_" + "Common_Cur");
                                        Int32 IndexCurrencyName = DtModule.Columns.IndexOf("Common_Cur");
                                        CurrencyConversion CurConversion1 = null;
                                        if (indexCurrencyConversionDateValue != null)
                                        {
                                            CurConversion1 = filterConversionDate.FirstOrDefault(x => x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == indexCurrencyConversionDateValue.Value.Date);
                                            if (CurConversion1 != null)
                                            {
                                                if (DtModule.Rows[j][indexValue] != DBNull.Value)
                                                    value = Convert.ToInt32(DtModule.Rows[j][indexValue]);
                                                if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                    DtModule.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                                else
                                                    DtModule.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                                if (value != null)
                                                {
                                                    if (logic == 307)
                                                    {
                                                        DtModule.Rows[j][indexSelectedCurrency] = IndexselectedCurrencyName_Value + (IndexselectedCurrencyName_Value * (value / 100));
                                                        if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                            DtModule.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtModule.Rows[j][indexSelectedCurrency]) * CurConversion1.ExchangeRate;
                                                        else
                                                            DtModule.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtModule.Rows[j][indexSelectedCurrency]) * CurConversion1.LastMonthAVGRate;

                                                    }
                                                    else if (logic == 308)
                                                    {
                                                        if (DtModule.Rows[j][indexValue] == null || DtModule.Rows[j][indexValue] == DBNull.Value || Convert.ToDouble(DtModule.Rows[j][indexValue]) <= 0)
                                                        {
                                                            DtModule.Rows[j][indexValue] = DBNull.Value;
                                                            DtModule.Rows[j][indexSelectedCurrency] = DtModule.Rows[j][indexValue];
                                                            DtModule.Rows[j][IndexCurrencyName] = DBNull.Value;

                                                        }
                                                        else
                                                        {
                                                            DtModule.Rows[j][indexSelectedCurrency] = DtModule.Rows[j][indexValue];
                                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                                DtModule.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtModule.Rows[j][indexSelectedCurrency]) * CurConversion1.ExchangeRate;
                                                            else
                                                                DtModule.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtModule.Rows[j][indexSelectedCurrency]) * CurConversion1.LastMonthAVGRate;

                                                        }
                                                    }

                                                    else if (logic == 309)
                                                    {
                                                        if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                            DtModule.Rows[j][indexSelectedCurrency] = Convert.ToDouble(DtModule.Rows[j][indexSelectedCurrency]) * CurConversion1.ExchangeRate;
                                                        else
                                                            DtModule.Rows[j][indexSelectedCurrency] = Convert.ToDouble(DtModule.Rows[j][indexSelectedCurrency]) * CurConversion1.LastMonthAVGRate;

                                                    }
                                                }
                                            }
                                            else
                                            {
                                                DtModule.Rows[j][IndexSelectedSaleCurrency] = DBNull.Value;
                                                DtModule.Rows[j][IndexCurrencyName] = DBNull.Value;

                                            }
                                        }
                                        else
                                        {
                                            DtModule.Rows[j][IndexSelectedSaleCurrency] = DBNull.Value;
                                        }
                                    }
                                    else
                                    {
                                        Int32 IndexSelectedSaleCurrency = DtModule.Columns.IndexOf("CurrencyConversionRate_" + currency.Name);
                                        Int32 IndexCurrencyName = DtModule.Columns.IndexOf(currency.Name);
                                        CurrencyConversion CurConversion1 = null;
                                        if (indexCurrencyConversionDateValue != null)
                                        {
                                            CurConversion1 = filterConversionDate.FirstOrDefault(x => x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == indexCurrencyConversionDateValue.Value.Date);
                                            if (CurConversion1 != null)
                                            {
                                                if (DtModule.Rows[j][indexValue] != DBNull.Value)
                                                    value = Convert.ToInt32(DtModule.Rows[j][indexValue]);
                                                if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                    DtModule.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                                else
                                                    DtModule.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                                if (value != null)
                                                {
                                                    if (logic == 307)
                                                    {
                                                        DtModule.Rows[j][indexSelectedCurrency] = IndexselectedCurrencyName_Value + (IndexselectedCurrencyName_Value * (value / 100));
                                                        if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                            DtModule.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtModule.Rows[j][indexSelectedCurrency]) * CurConversion1.ExchangeRate;
                                                        else
                                                            DtModule.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtModule.Rows[j][indexSelectedCurrency]) * CurConversion1.LastMonthAVGRate;

                                                    }
                                                    else if (logic == 308)
                                                    {
                                                        if (DtModule.Rows[j][indexValue] == null || DtModule.Rows[j][indexValue] == DBNull.Value || Convert.ToDouble(DtModule.Rows[j][indexValue]) <= 0)
                                                        {
                                                            DtModule.Rows[j][indexValue] = DBNull.Value;
                                                            DtModule.Rows[j][indexSelectedCurrency] = DtModule.Rows[j][indexValue];
                                                            DtModule.Rows[j][IndexCurrencyName] = DBNull.Value;

                                                        }
                                                        else
                                                        {
                                                            DtModule.Rows[j][indexSelectedCurrency] = DtModule.Rows[j][indexValue];
                                                            if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                                DtModule.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtModule.Rows[j][indexSelectedCurrency]) * CurConversion1.ExchangeRate;
                                                            else
                                                                DtModule.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtModule.Rows[j][indexSelectedCurrency]) * CurConversion1.LastMonthAVGRate;

                                                        }
                                                    }

                                                    else if (logic == 309)
                                                    {
                                                        if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                            DtModule.Rows[j][indexSelectedCurrency] = Convert.ToDouble(DtModule.Rows[j][indexSelectedCurrency]) * CurConversion1.ExchangeRate;
                                                        else
                                                            DtModule.Rows[j][indexSelectedCurrency] = Convert.ToDouble(DtModule.Rows[j][indexSelectedCurrency]) * CurConversion1.LastMonthAVGRate;

                                                    }
                                                }
                                            }
                                            else
                                            {
                                                DtModule.Rows[j][IndexSelectedSaleCurrency] = DBNull.Value;
                                                DtModule.Rows[j][IndexCurrencyName] = DBNull.Value;

                                            }
                                        }
                                        else
                                        {
                                            DtModule.Rows[j][IndexSelectedSaleCurrency] = DBNull.Value;
                                        }
                                    }
                                }
                            }
                            else
                            {
                                //for BPL
                                if (Convert.ToInt32(record.IdRule) == 307)
                                {
                                    DtModule.Rows[j][indexSelectedCurrency] = Convert.ToDouble(record.MaxCost) + ((Convert.ToDouble(record.MaxCost) * (Convert.ToDouble(record.RuleValue) / 100)));

                                    foreach (Currency currency in SelectedSaleCurrency)
                                    {
                                        if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            Int32 IndexSelectedSaleCurrency = DtModule.Columns.IndexOf("CurrencyConversionRate_" + "Common_Cur");
                                            Int32 IndexCurrencyName = DtModule.Columns.IndexOf("Common_Cur");
                                            CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == indexCurrencyConversionDateValue.Value.Date);
                                            if (CurConversion1 != null)
                                            {
                                                if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                    DtModule.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                                else
                                                    DtModule.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                            }

                                            else
                                                DtModule.Rows[j][IndexSelectedSaleCurrency] = DBNull.Value;
                                            if (DtModule.Rows[j][IndexSelectedSaleCurrency] != DBNull.Value && DtModule.Rows[j][IndexSelectedSaleCurrency] != null && DtModule.Rows[j][IndexSelectedSaleCurrency] != "")
                                            {
                                                DtModule.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtModule.Rows[j][indexSelectedCurrency]) * Convert.ToDouble(DtModule.Rows[j][IndexSelectedSaleCurrency]);
                                            }
                                            else
                                                DtModule.Rows[j][IndexCurrencyName] = DBNull.Value;


                                            if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                DtModule.Rows[j][IndexselectedCurrencyName_1] = DtModule.Rows[j][IndexCurrencyName];
                                            }
                                        }
                                        else
                                        {
                                            Int32 IndexSelectedSaleCurrency = DtModule.Columns.IndexOf("CurrencyConversionRate_" + currency.Name);
                                            Int32 IndexCurrencyName = DtModule.Columns.IndexOf(currency.Name);
                                            CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == indexCurrencyConversionDateValue.Value.Date);
                                            if (CurConversion1 != null)
                                            {
                                                if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                    DtModule.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                                else
                                                    DtModule.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                            }

                                            else
                                                DtModule.Rows[j][IndexSelectedSaleCurrency] = DBNull.Value;
                                            if (DtModule.Rows[j][IndexSelectedSaleCurrency] != DBNull.Value && DtModule.Rows[j][IndexSelectedSaleCurrency] != null && DtModule.Rows[j][IndexSelectedSaleCurrency] != "")
                                            {
                                                DtModule.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtModule.Rows[j][indexSelectedCurrency]) * Convert.ToDouble(DtModule.Rows[j][IndexSelectedSaleCurrency]);
                                            }
                                            else
                                                DtModule.Rows[j][IndexCurrencyName] = DBNull.Value;


                                            if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                DtModule.Rows[j][IndexselectedCurrencyName_1] = DtModule.Rows[j][IndexCurrencyName];
                                            }
                                        }
                                    }
                                }
                                else if (Convert.ToInt32(record.IdRule) == 308)
                                {
                                    if (record.RuleValue == null || record.RuleValue <= 0)
                                    {
                                        DtModule.Rows[j]["Value"] = DBNull.Value;
                                        DtModule.Rows[j][indexSelectedCurrency] = DBNull.Value;

                                        foreach (Currency currency in SelectedSaleCurrency)
                                        {
                                            if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                Int32 IndexSelectedSaleCurrency = DtModule.Columns.IndexOf("CurrencyConversionRate_" + "Common_Cur");
                                                Int32 IndexCurrencyName = DtModule.Columns.IndexOf("Common_Cur");
                                                if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                                {
                                                    DtModule.Rows[j][IndexselectedCurrencyName_1] = DtModule.Rows[j][IndexCurrencyName];
                                                }
                                            }
                                            else
                                            {
                                                Int32 IndexSelectedSaleCurrency = DtModule.Columns.IndexOf("CurrencyConversionRate_" + currency.Name);
                                                Int32 IndexCurrencyName = DtModule.Columns.IndexOf(currency.Name);
                                                if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                                {
                                                    DtModule.Rows[j][IndexselectedCurrencyName_1] = DtModule.Rows[j][IndexCurrencyName];
                                                }
                                            }
                                        }
                                    }
                                    else
                                    {
                                        DtModule.Rows[j][indexSelectedCurrency] = record.RuleValue;
                                        foreach (Currency currency in SelectedSaleCurrency)
                                        {
                                            if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                Int32 IndexSelectedSaleCurrency = DtModule.Columns.IndexOf("CurrencyConversionRate_" + "Common_Cur");
                                                Int32 IndexCurrencyName = DtModule.Columns.IndexOf("Common_Cur");
                                                CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == indexCurrencyConversionDateValue.Value.Date);
                                                if (CurConversion1 != null)
                                                {
                                                    if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                        DtModule.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                                    else
                                                        DtModule.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                                }

                                                else
                                                    DtModule.Rows[j][IndexSelectedSaleCurrency] = DBNull.Value;
                                                if (DtModule.Rows[j][IndexSelectedSaleCurrency] != DBNull.Value && DtModule.Rows[j][IndexSelectedSaleCurrency] != null && DtModule.Rows[j][IndexSelectedSaleCurrency] != "")
                                                    DtModule.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtModule.Rows[j][indexSelectedCurrency]) * Convert.ToDouble(DtModule.Rows[j][IndexSelectedSaleCurrency]);
                                                else
                                                    DtModule.Rows[j][IndexCurrencyName] = DBNull.Value;



                                                if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                                {
                                                    DtModule.Rows[j][IndexselectedCurrencyName_1] = DtModule.Rows[j][IndexCurrencyName];
                                                }
                                            }
                                            else
                                            {
                                                Int32 IndexSelectedSaleCurrency = DtModule.Columns.IndexOf("CurrencyConversionRate_" + currency.Name);
                                                Int32 IndexCurrencyName = DtModule.Columns.IndexOf(currency.Name);
                                                CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == indexCurrencyConversionDateValue.Value.Date);
                                                if (CurConversion1 != null)
                                                {
                                                    if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                        DtModule.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                                    else
                                                        DtModule.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                                }

                                                else
                                                    DtModule.Rows[j][IndexSelectedSaleCurrency] = DBNull.Value;
                                                if (DtModule.Rows[j][IndexSelectedSaleCurrency] != DBNull.Value && DtModule.Rows[j][IndexSelectedSaleCurrency] != null && DtModule.Rows[j][IndexSelectedSaleCurrency] != "")
                                                    DtModule.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtModule.Rows[j][indexSelectedCurrency]) * Convert.ToDouble(DtModule.Rows[j][IndexSelectedSaleCurrency]);
                                                else
                                                    DtModule.Rows[j][IndexCurrencyName] = DBNull.Value;



                                                if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                                {
                                                    DtModule.Rows[j][IndexselectedCurrencyName_1] = DtModule.Rows[j][IndexCurrencyName];
                                                }
                                            }
                                        }
                                    }
                                }
                                else if (Convert.ToInt32(record.IdRule) == 309)
                                {
                                    DtModule.Rows[j][indexSelectedCurrency] = Convert.ToDouble(record.MaxCost) + (Convert.ToDouble(record.RuleValue));

                                    foreach (Currency currency in SelectedSaleCurrency)
                                    {
                                        if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                        {
                                            Int32 IndexSelectedSaleCurrency = DtModule.Columns.IndexOf("CurrencyConversionRate_" + "Common_Cur");
                                            Int32 IndexCurrencyName = DtModule.Columns.IndexOf("Common_Cur");
                                            CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == indexCurrencyConversionDateValue.Value.Date);
                                            if (CurConversion1 != null)
                                            {
                                                if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                    DtModule.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                                else
                                                    DtModule.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                            }

                                            else
                                                DtModule.Rows[j][IndexSelectedSaleCurrency] = DBNull.Value;
                                            if (DtModule.Rows[j][IndexSelectedSaleCurrency] != DBNull.Value && DtModule.Rows[j][IndexSelectedSaleCurrency] != null && DtModule.Rows[j][IndexSelectedSaleCurrency] != "")
                                                DtModule.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtModule.Rows[j][indexSelectedCurrency]) * Convert.ToDouble(DtModule.Rows[j][IndexSelectedSaleCurrency]);
                                            else
                                                DtModule.Rows[j][IndexCurrencyName] = DBNull.Value;


                                            if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                DtModule.Rows[j][IndexselectedCurrencyName_1] = DtModule.Rows[j][IndexCurrencyName];
                                            }
                                        }
                                        else
                                        {
                                            Int32 IndexSelectedSaleCurrency = DtModule.Columns.IndexOf("CurrencyConversionRate_" + currency.Name);
                                            Int32 IndexCurrencyName = DtModule.Columns.IndexOf(currency.Name);
                                            CurrencyConversion CurConversion1 = CurrencyConversionList.FirstOrDefault(x => x.Idcurrencyfrom == Convert.ToByte(((Currency)SelectedCurrency).IdCurrency) && x.Idcurrencyto == currency.IdCurrency && x.LastUpdate.Date == indexCurrencyConversionDateValue.Value.Date);
                                            if (CurConversion1 != null)
                                            {
                                                if (SelectedExchangeRate != null && SelectedExchangeRate.IdLookupValue == 1509)
                                                    DtModule.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.ExchangeRate;
                                                else
                                                    DtModule.Rows[j][IndexSelectedSaleCurrency] = CurConversion1.LastMonthAVGRate;
                                            }

                                            else
                                                DtModule.Rows[j][IndexSelectedSaleCurrency] = DBNull.Value;
                                            if (DtModule.Rows[j][IndexSelectedSaleCurrency] != DBNull.Value && DtModule.Rows[j][IndexSelectedSaleCurrency] != null && DtModule.Rows[j][IndexSelectedSaleCurrency] != "")
                                                DtModule.Rows[j][IndexCurrencyName] = Convert.ToDouble(DtModule.Rows[j][indexSelectedCurrency]) * Convert.ToDouble(DtModule.Rows[j][IndexSelectedSaleCurrency]);
                                            else
                                                DtModule.Rows[j][IndexCurrencyName] = DBNull.Value;


                                            if (currency.IdCurrency == ((Currency)SelectedCurrency).IdCurrency)
                                            {
                                                DtModule.Rows[j][IndexselectedCurrencyName_1] = DtModule.Rows[j][IndexCurrencyName];
                                            }
                                        }
                                    }
                                }
                            }

                            if (DtModule.Rows[j][indexSelectedCurrency] == DBNull.Value)
                            {
                                SellPriceValue = 0.00;
                            }
                            else
                            {
                                SellPriceValue = Convert.ToDouble(DtModule.Rows[j][indexSelectedCurrency]); ;
                            }
                            DtModule.Rows[j][indexProfit] = CalculateCustomerPriceProfitValue(Cost_Value, SellPriceValue);
                            DtModule.Rows[j][indexCost] = CalculateCustomerPriceCostMarginValue(Cost_Value, SellPriceValue);
                        }
                        catch (Exception ex)
                        {
                            GeosApplication.Instance.Logger.Log(string.Format("Error in method CalculateBasePriceModulesByLogicValue() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                        }
                    }

                    DtModule.AcceptChanges();
                    FilterBPLAndCPL();
                }
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in method CalculateBasePriceModulesByLogicValue() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        #endregion

        //Shubham[skadam] GEOS2-4424 Need to add "Add ALL" button in module tab in BPL. 29 08 2023
        //Shubham[skadam] GEOS2-4784 Need to add custom filter option in module same as article/detection. 29 08 2023
        //Shubham[skadam] GEOS2-4785 No additional data so remove [0] this in tree menu in article, detection & module  left tree in BPL menu 29 08 2023
        //Shubham[skadam] GEOS2-4786 (JLR) The exported XLS Price List (BPL and CPL) must have the sheet with the modules. 29 08 2023
        #region GEOS2-4424_Module
        //Shubham[skadam] GEOS2-4424 Some changes in  Module tab in BPL (3/3) 28 08 2023
        private string userSettingsKeyForModule = "PLM_CustomerPriceModule_Filter_";
        private ObservableCollection<TileBarFilters> ModulefilterStatusListOfTile;
        private TileBarFilters ModuleselectedTileBarItem;
        private List<GridColumn> ModuleGridColumnList;
        private bool ModuleisEdit;
        TableView Moduleview;
        private bool ModuleisFilterEnabled;
        public bool ModuleIsEdit
        {
            get
            {
                return ModuleisEdit;
            }
            set
            {
                ModuleisEdit = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ModuleIsEdit"));
            }
        }
        public string ModuleFilterStringCriteria { get; set; }
        public string ModuleFilterStringName { get; set; }
        string ModulemyFilterString;
        string Moduleheight = "10";
        public string ModuleHeight
        {
            get { return Moduleheight; }
            set
            {
                Moduleheight = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ModuleHeight"));
            }
        }
        Dictionary<string, string> ModuleBasePriceArticleFilter = new Dictionary<string, string>();
        public string ModuleMyFilterString
        {
            get { return ModulemyFilterString; }
            set
            {
                ModulemyFilterString = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ModuleMyFilterString"));
            }
        }
        public ObservableCollection<TileBarFilters> ModuleFilterStatusListOfTile
        {
            get { return ModulefilterStatusListOfTile; }
            set
            {
                ModulefilterStatusListOfTile = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ModuleFilterStatusListOfTile"));
            }
        }
        public TileBarFilters ModuleSelectedTileBarItem
        {
            get { return ModuleselectedTileBarItem; }
            set
            {
                ModuleselectedTileBarItem = value;
                OnPropertyChanged(new PropertyChangedEventArgs("ModuleSelectedTileBarItem"));
            }
        }
        List<string> ModuleBPLArticleFilter = new List<string>();
        private void ModuleFilterEditorCreatedCommandAction(FilterEditorEventArgs obj)
        {
            try
            {
                ModuleBPLArticleFilter = new List<string>();
                obj.Handled = true;
                TableViewEx table = (TableViewEx)obj.OriginalSource;
                GridControl gridControl = (table).Grid;
                GridColumnList = gridControl.Columns.Where(x => x.Header != null).ToList();
                GridColumn column = GridColumnList.FirstOrDefault(x => x.Header.ToString().Equals("Status"));
                ModuleShowFilterEditor(obj);
                if (ModuleBasePriceArticleFilter == null)
                    ModuleBasePriceArticleFilter = new Dictionary<string, string>();
                foreach (var Filter in GeosApplication.Instance.UserSettings)
                {
                    if (Filter.Key.StartsWith(userSettingsKeyForModule))
                    {
                        if (!ModuleBasePriceArticleFilter.Any(a => a.Key == Filter.Key))
                            ModuleBasePriceArticleFilter.Add(Filter.Key, Filter.Value);
                        ModuleBPLArticleFilter.Add(Filter.Key.Replace(userSettingsKeyForModule, ""));
                    }
                }
                //ModuleFillFilterTileBar();
                ModuleAddCustomSetting();
                ModuleSelectedTileBarItem = ModuleFilterStatusListOfTile.LastOrDefault();
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log(string.Format("Error in ModuleFilterEditorCreatedCommandAction() - {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
            }
        }
        private void ModuleShowFilterEditor(FilterEditorEventArgs e)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ModuleShowFilterEditor()...", category: Category.Info, priority: Priority.Low);
                FilterEditorView filterEditorView = new FilterEditorView();
                FilterEditorViewModel filterEditorViewModel = new FilterEditorViewModel();
                string titleText = DevExpress.Xpf.Grid.GridControlLocalizer.Active.GetLocalizedString(GridControlStringId.FilterEditorTitle);
                if (IsEdit)
                {
                    filterEditorViewModel.FilterName = ModuleFilterStringName;
                    filterEditorViewModel.IsSave = true;
                    filterEditorViewModel.IsNew = false;
                    IsEdit = false;
                }
                else
                    filterEditorViewModel.IsNew = true;

                filterEditorViewModel.Init(e.FilterControl, ModuleFilterStatusListOfTile);
                filterEditorView.DataContext = filterEditorViewModel;
                EventHandler handle = delegate { filterEditorView.Close(); };
                filterEditorViewModel.RequestClose += handle;
                filterEditorView.Title = titleText;
                filterEditorView.Icon = DevExpress.Xpf.Core.Native.ImageHelper.CreateImageFromCoreEmbeddedResource("Editors.Images.FilterControl.filter.png");
                filterEditorView.Grid.Children.Add(e.FilterControl);
                filterEditorView.ShowDialog();

                if (filterEditorViewModel.IsDelete && !string.IsNullOrEmpty(filterEditorViewModel.FilterName) && filterEditorViewModel.IsSave)
                {
                    TileBarFilters tileBarItem = ModuleFilterStatusListOfTile.FirstOrDefault(x => x.Caption.Equals(ModuleFilterStringName));
                    if (tileBarItem != null)
                    {
                        ModuleFilterStatusListOfTile.Remove(tileBarItem);
                        List<Tuple<string, string>> lstUserConfiguration = new List<Tuple<string, string>>();
                        foreach (KeyValuePair<string, string> setting in GeosApplication.Instance.UserSettings)
                        {
                            string key = setting.Key;

                            if (setting.Key.Contains(userSettingsKeyForModule))
                                key = setting.Key.Replace(userSettingsKeyForModule, "");

                            if (!key.Equals(tileBarItem.Caption))
                                lstUserConfiguration.Add(new Tuple<string, string>(setting.Key.ToString(), setting.Value.ToString()));
                        }
                        ApplicationOperation.CreateNewSetting(lstUserConfiguration, GeosApplication.Instance.UserSettingFilePath, "UserSettings");
                        GeosApplication.Instance.UserSettings = ApplicationOperation.GetSetting(GeosApplication.Instance.UserSettingFilePath);
                    }
                }
                else if (filterEditorViewModel.FilterName != null && !string.IsNullOrEmpty(filterEditorViewModel.FilterName) && filterEditorViewModel.IsSave && !filterEditorViewModel.IsNew && filterEditorViewModel.IsCancel)
                {
                    TileBarFilters tileBarItem = ModuleFilterStatusListOfTile.FirstOrDefault(x => x.Caption.Equals(ModuleFilterStringName));
                    if (tileBarItem != null)
                    {
                        GridColumn column = GridColumnList.FirstOrDefault(x => x.Header.ToString() != null);
                        DevExpress.Xpf.Grid.GridControlBand gridControl = ((DevExpress.Xpf.Grid.GridControlBand)((System.Windows.FrameworkContentElement)(GridColumn)column).Parent);
                        int rowCount = 0;
                        if (ModuleFilterStatusListOfTile == null)
                            ModuleFilterStatusListOfTile = new ObservableCollection<TileBarFilters>();
                        ModuleFilterStringName = userSettingsKeyForModule + filterEditorViewModel.FilterName;
                        string filterCaption = tileBarItem.Caption;
                        tileBarItem.Caption = ModuleFilterStringName;
                        tileBarItem.EntitiesCount = rowCount;
                        tileBarItem.EntitiesCountVisibility = Visibility.Visible;
                        tileBarItem.FilterCriteria = filterEditorViewModel.FilterCriteria;
                        List<Tuple<string, string>> lstUserConfiguration = new List<Tuple<string, string>>();
                        foreach (KeyValuePair<string, string> setting in GeosApplication.Instance.UserSettings)
                        {
                            string key = setting.Key;

                            if (setting.Key.Contains(userSettingsKeyForModule))
                                key = setting.Key.Replace(userSettingsKeyForModule, "");

                            if (!key.Equals(filterCaption))
                                lstUserConfiguration.Add(new Tuple<string, string>(setting.Key.ToString(), setting.Value.ToString()));
                            else
                                lstUserConfiguration.Add(new Tuple<string, string>(tileBarItem.Caption, tileBarItem.FilterCriteria));
                        }
                        ApplicationOperation.CreateNewSetting(lstUserConfiguration, GeosApplication.Instance.UserSettingFilePath, "UserSettings");
                        GeosApplication.Instance.UserSettings = ApplicationOperation.GetSetting(GeosApplication.Instance.UserSettingFilePath);
                    }
                }
                else if (filterEditorViewModel.FilterName != null && !string.IsNullOrEmpty(filterEditorViewModel.FilterName) && filterEditorViewModel.IsSave && filterEditorViewModel.IsNew && filterEditorViewModel.IsCancel)
                {
                    GridColumn column = GridColumnList.FirstOrDefault(x => x.Header.ToString() != null);
                    DevExpress.Xpf.Grid.GridControlBand gridControl = ((DevExpress.Xpf.Grid.GridControlBand)((System.Windows.FrameworkContentElement)(GridColumn)column).Parent);
                    int rowCount = 0;
                    if (ModuleFilterStatusListOfTile == null)
                        ModuleFilterStatusListOfTile = new ObservableCollection<TileBarFilters>();
                    ModuleFilterStatusListOfTile.Add(new TileBarFilters()
                    {
                        Caption = filterEditorViewModel.FilterName,
                        Id = 0,
                        BackColor = null,
                        ForeColor = null,
                        EntitiesCountVisibility = Visibility.Visible,
                        FilterCriteria = filterEditorViewModel.FilterCriteria,
                        EntitiesCount = rowCount,
                        Height = 58,
                        width = 188
                    });
                    ModuleSelectedTileBarItem = ModuleFilterStatusListOfTile.LastOrDefault();
                    string filterName = userSettingsKeyForModule + filterEditorViewModel.FilterName;
                    GeosApplication.Instance.UserSettings[filterName] = filterEditorViewModel.FilterCriteria;
                    ApplicationOperation.CreateNewSetting(GeosApplication.Instance.UserSettings, GeosApplication.Instance.UserSettingFilePath, "UserSettings");
                    GeosApplication.Instance.UserSettings = ApplicationOperation.GetSetting(GeosApplication.Instance.UserSettingFilePath);
                }
                GeosApplication.Instance.Logger.Log("Method ModuleShowFilterEditor() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method ModuleShowFilterEditor() " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        public void ModuleFillFilterTileBar()
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ModuleFillFilterTileBar()...", category: Category.Info, priority: Priority.Low);
                ModuleFilterStatusListOfTile = new ObservableCollection<TileBarFilters>();
                ObservableCollection<GeosStatus> tempStatusList = new ObservableCollection<GeosStatus>();
                int _id = 1;

                if (DtModule != null)
                {
                    var DtModuleList = DtModule.AsEnumerable().ToList();
                    ModuleFilterStatusListOfTile.Add(new TileBarFilters()
                    {
                        Caption = (System.Windows.Application.Current.FindResource("BPLViewTileBarCaption").ToString()),
                        Id = 0,
                        BackColor = null,
                        ForeColor = null,
                        EntitiesCount = DtArticle.Rows.Count,
                        EntitiesCountVisibility = Visibility.Visible,
                        Height = 58,
                        width = 188
                    });

                    foreach (var item in tempStatusList)
                    {
                        ModuleFilterStatusListOfTile.Add(new TileBarFilters()
                        {
                            Caption = item.Name,
                            Id = _id++,
                            IdOfferStatusType = item.IdOfferStatusType,
                            BackColor = item.HtmlColor,
                            ForeColor = item.HtmlColor,
                            EntitiesCount = (DtModuleList.Where(x => (int)x.ItemArray[34] == item.IdOfferStatusType).ToList()).Count,
                            EntitiesCountVisibility = Visibility.Visible,
                            Height = 58,
                            width = 188
                        });
                    }
                }

                if (ModuleFilterStatusListOfTile.Count > 0)
                    ModuleSelectedTileBarItem = ModuleFilterStatusListOfTile[0];

                GeosApplication.Instance.Logger.Log("Method ModuleFillFilterTileBar() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method ModuleFillFilterTileBar() " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        private void ModuleAddCustomSetting()
        {
            try
            {
                DataTable tempDtModule = new DataTable();
                ModuleFilterStatusListOfTile = new ObservableCollection<TileBarFilters>();
                GeosApplication.Instance.Logger.Log("Method ModuleAddCustomSetting()...", category: Category.Info, priority: Priority.Low);
                List<KeyValuePair<string, string>> tempUserSettings = GeosApplication.Instance.UserSettings.Where(x => x.Key.Contains(userSettingsKeyForModule)).ToList();
                if (tempUserSettings != null && tempUserSettings.Count > 0)
                {
                    ModuleFilterStatusListOfTile.Add(
                    new TileBarFilters()
                    {
                        Caption = "ALL",
                        Id = 0,
                        BackColor = null,
                        ForeColor = null,
                        FilterCriteria = null,
                        EntitiesCount = DtModule.Rows.Count,
                        EntitiesCountVisibility = Visibility.Visible,
                        Height = 58,
                        width = 188
                    });
                }
                if (DtModule != null)
                {
                    tempDtModule = DtModule;
                    foreach (DataRow dtitem in tempDtModule.Rows)
                    {
                        DataRow DataRow = (DataRow)dtitem;
                        for (int i = 0; i < dtitem.ItemArray.Count(); i++)
                        {
                            if (dtitem.ItemArray[i] is double)
                            {
                                //DataRow.ItemArray[i] = Math.Round((double)dtitem.ItemArray[i], 2);
                                double ItemArray = Math.Round((double)dtitem.ItemArray[i], 2);
                                DataRow.SetField(i, ItemArray);
                            }
                        }
                    }
                }
                foreach (var item in tempUserSettings)
                {
                    if (DtModule != null)
                    {

                        int count = 0;
                        string filter = item.Value;
                        CriteriaOperator op = CriteriaOperator.Parse(filter);
                        try
                        {
                            count = DtModule.Select(CriteriaToWhereClauseHelper.GetDataSetWhere(op)).ToList().Count;
                        }
                        catch (Exception ex)
                        {
                            try
                            {
                                if (op != null)
                                {
                                    dynamic criteriaOperatorobj = op;
                                    if (criteriaOperatorobj.OperatorType is DevExpress.Data.Filtering.FunctionOperatorType)
                                    {
                                        if (criteriaOperatorobj.OperatorType == DevExpress.Data.Filtering.FunctionOperatorType.StartsWith)
                                        {
                                            var criteriaOperator = criteriaOperatorobj.Operands;
                                            DevExpress.Data.Filtering.OperandProperty operandProperty = criteriaOperator[0];
                                            op = CriteriaOperator.Parse("[" + operandProperty.PropertyName + "]" + '=' + criteriaOperator[1].Value);
                                            count = DtArticle.Select(CriteriaToWhereClauseHelper.GetDataSetWhere(op)).ToList().Count;
                                        }
                                    }
                                }
                            }
                            catch (Exception exc) { }
                            //GeosApplication.Instance.Logger.Log(string.Format("Error in Method AddCustomSetting() {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                        }

                        ModuleFilterStatusListOfTile.Add(
                            new TileBarFilters()
                            {
                                Caption = item.Key.Replace(userSettingsKeyForModule, ""),
                                Id = 0,
                                BackColor = null,
                                ForeColor = null,
                                FilterCriteria = item.Value,
                                EntitiesCount = count,
                                EntitiesCountVisibility = Visibility.Visible,
                                Height = 58,
                                width = 188
                            });
                    }
                }

                GeosApplication.Instance.Logger.Log("Method ModuleAddCustomSetting() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method ModuleAddCustomSetting() " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        private void ModuleCustomShowFilterPopup(FilterPopupEventArgs e)
        {

            try
            {
                GeosApplication.Instance.Logger.Log(" Method ModuleCustomShowFilterPopup ...", category: Category.Info, priority: Priority.Low);

                GeosApplication.Instance.Logger.Log("Method ModuleCustomShowFilterPopup() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in ModuleCustomShowFilterPopup() method " + ex.Message, category: Category.Info, priority: Priority.Low);
            }
        }
        private void ModuleCommandFilterStatusTileClickAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ModuleCommandFilterStatusTileClickAction()...", category: Category.Info, priority: Priority.Low);
                System.Windows.Controls.SelectionChangedEventArgs Filter = (System.Windows.Controls.SelectionChangedEventArgs)obj;
                if (Filter.AddedItems.Count != 0)
                {
                    long statusIdType = ((TileBarFilters)((object[])((System.Windows.Controls.SelectionChangedEventArgs)obj).AddedItems)[0]).IdOfferStatusType;
                    string FilterString = ((TileBarFilters)((object[])((System.Windows.Controls.SelectionChangedEventArgs)obj).AddedItems)[0]).FilterCriteria;
                    ModuleFilterStringName = ((TileBarFilters)((object[])((System.Windows.Controls.SelectionChangedEventArgs)obj).AddedItems)[0]).Caption;
                    ModuleMyFilterString = FilterString;
                }
                GeosApplication.Instance.Logger.Log("Method ModuleCommandFilterStatusTileClickAction() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method ModuleCommandFilterStatusTileClickAction() " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        private void ModuleCommandTileBarClickDoubleClickAction(object obj)
        {
            try
            {
                GeosApplication.Instance.Logger.Log("Method ModuleCommandTileBarClickDoubleClickAction()...", category: Category.Info, priority: Priority.Low);
                foreach (var item in FilterStatusListOfTile)
                {
                    if (ModuleFilterStringName != null)
                    {
                        if (ModuleFilterStringName.Equals(item.Caption))
                        {
                            //return;
                        }
                    }
                }

                if (ModuleFilterStringName.Equals(System.Windows.Application.Current.FindResource("BPLViewCustomFilter").ToString()) || ModuleFilterStringName.Equals(System.Windows.Application.Current.FindResource("BPLViewTileBarCaption").ToString()))
                {
                    return;
                }

                TableViewEx table = (TableViewEx)obj;
                GridControl gridControl = (table).Grid;
                ModuleGridColumnList = gridControl.Columns.Where(x => x.Header != null).ToList();
                GridColumn column = ModuleGridColumnList.FirstOrDefault(x => x.Header.ToString().Equals("Status"));
                IsEdit = true;
                table.ShowFilterEditor(column);
                GeosApplication.Instance.Logger.Log("Method ModuleCommandTileBarClickDoubleClickAction() executed successfully", category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                GeosApplication.Instance.Logger.Log("Get an error in Method ModuleCommandTileBarClickDoubleClickAction() " + ex.Message, category: Category.Exception, priority: Priority.Low);
            }
        }
        #endregion

    }
}
