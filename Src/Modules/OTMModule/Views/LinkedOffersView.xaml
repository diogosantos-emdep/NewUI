<dxwui:WinUIDialogWindow x:Class="Emdep.Geos.Modules.OTM.Views.LinkedOffersView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:Emdep.Geos.Modules.OTM.Views"
        xmlns:dxwui="http://schemas.devexpress.com/winfx/2008/xaml/windowsui" 
        xmlns:dxg="http://schemas.devexpress.com/winfx/2008/xaml/grid"
        xmlns:dxe="http://schemas.devexpress.com/winfx/2008/xaml/editors"
        xmlns:dxp="http://schemas.devexpress.com/winfx/2008/xaml/printing" 
        xmlns:sysglb="clr-namespace:System.Globalization;assembly=mscorlib"
        xmlns:Coverter="clr-namespace:Emdep.Geos.UI.Converters;assembly=Emdep.Geos.UI.Converters"
        xmlns:dxmvvm="http://schemas.devexpress.com/winfx/2008/xaml/mvvm" 
        mc:Ignorable="d"
        Title="" Height="450" Width="800">

    <dxwui:WinUIDialogWindow.InputBindings>
        <KeyBinding Key="Escape" Command="{Binding LinkedOfferViewCancelButtonCommand}" />
    </dxwui:WinUIDialogWindow.InputBindings>

    <dxwui:WinUIDialogWindow.Resources>
        <Coverter:ForegroundColorConverter x:Key="ForegroundColorConverter" />
    </dxwui:WinUIDialogWindow.Resources>

    <Grid>
        
      <Grid.RowDefinitions>
       <RowDefinition Height="45"/>
        <RowDefinition Height="500"/>
        <RowDefinition Height="*"  />
      </Grid.RowDefinitions>
        <!--[pramod.misal][GEOS2-6465][16.12.2024]-->
        <TextBlock Margin="0,0,0,0" Grid.Row="0"  VerticalAlignment="Center" FontSize="30" FontWeight="Bold" Text="{DynamicResource LinkedPOViewHeader}" />


        <dxg:GridControl DockPanel.Dock="Right" Name="gridControl" SelectionMode="Row" Grid.Row="1" ScrollViewer.VerticalScrollBarVisibility="Auto"
                 SelectedItem="{Binding SelectedIndexLinkedOffer,UpdateSourceTrigger=PropertyChanged,Mode=TwoWay}"  
                 FilterString="{Binding MyFilterString,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}"
                 ShowBorder="True" 
                 ItemsSource="{Binding Linkedofferlist,UpdateSourceTrigger=PropertyChanged,Mode=TwoWay}" 
                 ImplyNullLikeEmptyStringWhenFiltering="True">

            <!--Code-->
            <dxg:GridColumn FieldName="Code" Header="{DynamicResource OTMCode}"  Width="80" MinWidth="100" MaxWidth="100"  ReadOnly="True" AllowBestFit="true"  FilterPopupMode="CheckedList">
                <dxg:GridColumn.CellToolTipBinding>
                    <Binding Path="Code" />
                </dxg:GridColumn.CellToolTipBinding>
                <dxg:GridColumn.CellTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal" Height="24">
                            <TextBlock Text ="{Binding RowData.Row.Code,UpdateSourceTrigger=PropertyChanged}" VerticalAlignment="Center"  HorizontalAlignment="Center"  Margin="5,0,0,0" ></TextBlock>
                        </StackPanel>
                    </DataTemplate>
                </dxg:GridColumn.CellTemplate>
            </dxg:GridColumn>

            <!--Description-->
            <dxg:GridColumn FieldName="Description" Header="{DynamicResource OTMDescription}" Width="220" MinWidth="220" MaxWidth="220"  ReadOnly="True" AllowBestFit="true"  FilterPopupMode="CheckedList">
                <dxg:GridColumn.CellToolTipBinding>
                    <Binding Path="Description" />
                </dxg:GridColumn.CellToolTipBinding>
                <dxg:GridColumn.CellTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal" Height="24">
                            <TextBlock Text ="{Binding RowData.Row.Description,UpdateSourceTrigger=PropertyChanged}" VerticalAlignment="Center"  HorizontalAlignment="Center"  Margin="5,0,0,0" ></TextBlock>
                        </StackPanel>
                    </DataTemplate>
                </dxg:GridColumn.CellTemplate>
            </dxg:GridColumn>

            <!--RFQ-->
            <dxg:GridColumn FieldName="RFQ" Header="{DynamicResource OTMRFQ}" Width="80" MinWidth="80"  ReadOnly="True" AllowBestFit="true"  FilterPopupMode="CheckedList">
                <dxg:GridColumn.CellToolTipBinding>
                    <Binding Path="RFQ" />
                </dxg:GridColumn.CellToolTipBinding>
                <dxg:GridColumn.CellTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal" Height="24">
                            <TextBlock Text ="{Binding RowData.Row.RFQ,UpdateSourceTrigger=PropertyChanged}" VerticalAlignment="Center"  HorizontalAlignment="Center"  Margin="5,0,0,0" ></TextBlock>
                        </StackPanel>
                    </DataTemplate>
                </dxg:GridColumn.CellTemplate>
            </dxg:GridColumn>

            <!--Contact-->
            <dxg:GridColumn FieldName="Contact" Header="{DynamicResource POContact}" Width="100" MinWidth="100"  ReadOnly="True" AllowBestFit="true"  FilterPopupMode="CheckedList">
                <dxg:GridColumn.CellToolTipBinding>
                    <Binding Path="Contact" />
                </dxg:GridColumn.CellToolTipBinding>
                <dxg:GridColumn.CellTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal" Height="24">
                            <TextBlock Text ="{Binding RowData.Row.Contact,UpdateSourceTrigger=PropertyChanged}" VerticalAlignment="Center"  HorizontalAlignment="Center"  Margin="5,0,0,0" ></TextBlock>
                        </StackPanel>
                    </DataTemplate>
                </dxg:GridColumn.CellTemplate>
            </dxg:GridColumn>
            
            <!-- old column Status-->

            <!--<dxg:GridColumn Header="{DynamicResource POStatus}" FieldName="Status" FilterPopupMode="CheckedList" MinWidth="50" Width="110" MaxWidth="120" ReadOnly="True">
                <dxg:GridColumn.CellTemplate>
                    <DataTemplate>
                        <TextBlock  Text ="{Binding RowData.Row.Status,UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}">
                            <TextBlock.Style>
                                <Style TargetType="TextBlock" >
                                    <Setter Property="Background" Value="{Binding RowData.Row.HtmlColor,UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"/>
                                    <Setter Property="HorizontalAlignment"  Value="Stretch"/>
                                    
                                    <Setter Property="VerticalAlignment" Value="Stretch"/>
                                    <Setter Property="Foreground" Value="{Binding Path=Background,Converter={StaticResource ForegroundColorConverter}}"/>
                                </Style>
                            </TextBlock.Style>
                        </TextBlock>
                    </DataTemplate>
                </dxg:GridColumn.CellTemplate>
            </dxg:GridColumn>-->

            <dxg:GridColumn Header="{DynamicResource POStatus}" FieldName="Status" FilterPopupMode="CheckedList" MinWidth="120" MaxWidth="150"   ReadOnly="True">
                <!--<dxg:GridColumn.CellToolTipBinding>
                     <Binding Path="Status" />
                 </dxg:GridColumn.CellToolTipBinding>-->
                <dxg:GridColumn.CellTemplate>
                    <DataTemplate>
                        <Border Background="{Binding RowData.Row.HtmlColor, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}" 
                     VerticalAlignment="Stretch" 
                      HorizontalAlignment="Stretch">
                            <TextBlock Text="{Binding RowData.Row.Status, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                     HorizontalAlignment="Center" 
                     VerticalAlignment="Center"
                     TextAlignment="Center"
                     Foreground="Black" 
                     Padding="4"/>
                        </Border>
                    </DataTemplate>
                </dxg:GridColumn.CellTemplate>
            </dxg:GridColumn>



            <!--Discount-->
            <!--[pramod.misal][GEOS2-9523][29-09-2025]https://helpdesk.emdep.com/browse/GEOS2-9523-->
            <dxg:GridColumn Header="{DynamicResource OTMDiscount}" FieldName="Discount" FilterPopupMode="CheckedList" MinWidth="60" Width="50" MaxWidth="90" ReadOnly="True">
                <dxg:GridColumn.CellTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal" Margin="0,0,3,0" HorizontalAlignment="Right">
                            <TextBlock Grid.Column="1" VerticalAlignment="Center">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Text" Value="{Binding RowData.Row.Discount, StringFormat={}{0:0.0}%, ConverterCulture={x:Static sysglb:CultureInfo.CurrentCulture}}"/>
                                        <Style.Triggers>

                                            <DataTrigger Binding="{Binding RowData.Row.Discount}" Value="0.00 %">
                                                <Setter Property="Text" Value="{x:Null}" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </StackPanel>
                    </DataTemplate>
                </dxg:GridColumn.CellTemplate>

            </dxg:GridColumn>


            <!--Amount-->

            <dxg:GridColumn Header="{DynamicResource POAmount}" FieldName="Amount" FilterPopupMode="CheckedList" MinWidth="90" Width="80" MaxWidth="140" ReadOnly="True">
                <dxg:GridColumn.CellTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal" Margin="0,0,3,0"  HorizontalAlignment="Right">
                            <TextBlock Grid.Column="1" VerticalAlignment="Center">
                                <TextBlock.Style>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Text" Value="{Binding RowData.Row.Amount, StringFormat={}{0:N2}, ConverterCulture={x:Static sysglb:CultureInfo.CurrentCulture}}"/>
                                        <Style.Triggers>

                                            <DataTrigger Binding="{Binding RowData.Row.Amount}" Value="0.00">
                                                <Setter Property="Text" Value="{x:Null}" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </TextBlock.Style>
                            </TextBlock>
                        </StackPanel>
                    </DataTemplate>
                </dxg:GridColumn.CellTemplate>
               
            </dxg:GridColumn>

            <!--Currency-->

            <dxg:GridColumn Header="{DynamicResource OTMCurrency}" AllowBestFit="true" FieldName="OfferCurrency" FilterPopupMode="CheckedList" MinWidth="65" Width="65" MaxWidth="65" ReadOnly="True">
                <dxg:GridColumn.CellTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal" Height="24">
                            <Image Source="{Binding RowData.Row.CurrencyIconBytes,UpdateSourceTrigger=PropertyChanged}" VerticalAlignment="Center" Height="24" Width="24" Margin="2,0,0,0" />
                            <TextBlock Text ="{Binding RowData.Row.OfferCurrency,UpdateSourceTrigger=PropertyChanged}"  VerticalAlignment="Center" Margin="5,0,0,0" ></TextBlock>
                        </StackPanel>
                    </DataTemplate>
                </dxg:GridColumn.CellTemplate>
            </dxg:GridColumn>

            <!--Linked PO-->

            <dxg:GridColumn FieldName="LinkedPO" FixedWidth="True"  Header="{DynamicResource OTMLinkedPO}" Width="200" MinWidth="180"  ReadOnly="True" AllowBestFit="true"  FilterPopupMode="CheckedList">
                <dxg:GridColumn.CellToolTipBinding>
                    <Binding Path="LinkedPO" />
                </dxg:GridColumn.CellToolTipBinding>
                <dxg:GridColumn.CellTemplate>
                    <DataTemplate>
                        <StackPanel Orientation="Horizontal" Height="24">
                            <TextBlock Text ="{Binding RowData.Row.LinkedPO,UpdateSourceTrigger=PropertyChanged}" VerticalAlignment="Center"  HorizontalAlignment="Center"  Margin="5,0,0,0" ></TextBlock>
                        </StackPanel>
                    </DataTemplate>
                </dxg:GridColumn.CellTemplate>
            </dxg:GridColumn>


            <!--Folder-->

            <dxg:GridColumn Header=" "  MinWidth="40" Width="50" MaxWidth="50" FixedWidth="True" Fixed="Right" ReadOnly="True" AllowColumnFiltering="false" AllowPrinting="False" ShowInColumnChooser="False" AllowMoving="false">
                <dxg:GridColumn.CellTemplate>
                    <DataTemplate>
                        <Button x:Name="btnViewFile" ToolTip="{DynamicResource LinkedOfferDocuments}" Command="{Binding DataContext.LinkedOfferOpenCommand,UpdateSourceTrigger=PropertyChanged,Mode=TwoWay,RelativeSource={RelativeSource AncestorType=dxwui:WinUIDialogWindow}}" CommandParameter="{Binding RowData.Row}">
                            <Button.ContentTemplate>
                                <DataTemplate>
                                    <Image Height="22" Width="22" Source="/Emdep.Geos.Modules.OTM;component/Assets/Images/FileExpo.png" />
                                </DataTemplate>
                            </Button.ContentTemplate>
                            <Button.Style>
                                <Style TargetType="{x:Type Button}">
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Cursor" Value="Hand"/>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                    </DataTemplate>
                </dxg:GridColumn.CellTemplate>
                <!--<dxmvvm:Interaction.Behaviors>
                    <dxmvvm:EventToCommand Command="{Binding DataContext.LinkedOfferOpenCommand,RelativeSource={RelativeSource AncestorType=dxwui:WinUIDialogWindow}}"
        EventName="Click"
        CommandParameter="{Binding Path=.}" />
                </dxmvvm:Interaction.Behaviors>-->
            </dxg:GridColumn>

            <dxg:GridControl.View>
                <dxg:TableView x:Name="EmployeeExpenseTableView"
                 NavigationStyle="Row"
                 RowDetailsVisibilityMode="Visible"
                 ShowHorizontalLines="True"
                 ShowSearchPanelMode="Always"
                 ShowColumnHeaders="True"
                 VerticalScrollbarVisibility="Auto" 
                 HorizontalScrollbarVisibility="Auto"
                 AllowFixedColumnMenu="False"
                 ShowTotalSummary="False"
                 IsColumnChooserVisible="{Binding DataContext.IsLinkedOffersViewColumnChooserVisible,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged,RelativeSource={RelativeSource AncestorType=dxwui:WinUIDialogWindow}}"
                 ShowFixedTotalSummary="False"
                 SearchPanelHorizontalAlignment="Stretch"
                 EnableImmediatePosting="True"
                 ImmediateUpdateRowPosition="True"
                 AllowEditing="True"
                 ColumnChooserColumnDisplayMode="ShowHiddenColumnsOnly"
                 AllowGrouping="True"
                 ShowGroupPanel="False"
                 ShowIndicator="False" 
                 ShowFilterPopup="{DXEvent Handler='@args.PopupBaseEdit.PopupWidth=200'}" 
                 FocusedRow="{Binding Path=SelectedGridRow,UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                 RowDetailsTemplate="{Binding SelectedItem.DetailTemplate,ElementName=rowTemplateComboBox}"
                 RowStyle="{Binding SelectedItem.RowStyle,ElementName=rowTemplateComboBox}"
                 UseLegacyFilterEditor="True">

                    <dxmvvm:Interaction.Behaviors>
                        <dxmvvm:EventToCommand 
                            Command="{Binding DataContext.TableViewLoadedCommand,RelativeSource={RelativeSource AncestorType=dxwui:WinUIDialogWindow}, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}" EventName="Loaded" PassEventArgsToCommand="True" />
                    </dxmvvm:Interaction.Behaviors>
                </dxg:TableView>
            </dxg:GridControl.View>



        </dxg:GridControl>

        <StackPanel Grid.Row="2" Grid.Column="1" Grid.ColumnSpan="2"
     HorizontalAlignment="Center" 
     Orientation="Horizontal"
     Margin="25,30,75,0"
     Width="290">

            <Button Content="{DynamicResource EditRegisteredPOsViewAccept}"
     Command="{Binding LinkedOfferViewAcceptButtonCommand}"
     Height="30"
     Width="100"
     Margin="0,0,30,0"
     VerticalAlignment="Bottom"/>
            <Button Content="{DynamicResource EditRegisteredPOsViewCancel}"
     Command="{Binding LinkedOfferViewCancelButtonCommand}"
     Height="30"
     Width="100"
     Margin="30,0,0,0"
     VerticalAlignment="Bottom"/>
        </StackPanel>

    </Grid>
    
</dxwui:WinUIDialogWindow>
