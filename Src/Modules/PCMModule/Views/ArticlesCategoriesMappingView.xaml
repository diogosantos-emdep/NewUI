<dxwui:WinUIDialogWindow x:Class="Emdep.Geos.Modules.PCM.Views.ArticlesCategoriesMappingView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:dxdo="http://schemas.devexpress.com/winfx/2008/xaml/docking"
             xmlns:dxlc="http://schemas.devexpress.com/winfx/2008/xaml/layoutcontrol"
             xmlns:dxmvvm="http://schemas.devexpress.com/winfx/2008/xaml/mvvm"
             xmlns:UIHelper="clr-namespace:Emdep.Geos.UI.Helper;assembly=Emdep.Geos.UI.Helper"
             xmlns:dxe="http://schemas.devexpress.com/winfx/2008/xaml/editors"
             xmlns:dxg="http://schemas.devexpress.com/winfx/2008/xaml/grid"
             xmlns:Validation ="clr-namespace:Emdep.Geos.UI.Validations;assembly=Emdep.Geos.UI.Validations"
             xmlns:local="clr-namespace:Emdep.Geos.Modules.PCM.Views"
             xmlns:dxwui="http://schemas.devexpress.com/winfx/2008/xaml/windowsui"
             xmlns:GeosApplication="clr-namespace:Emdep.Geos.UI.Common;assembly=Emdep.Geos.UI.Common"
             mc:Ignorable="d" 
             d:DesignHeight="300" d:DesignWidth="300" 
            
             HorizontalAlignment="Stretch"
           
             HorizontalContentAlignment="Stretch"            
             VerticalContentAlignment="Stretch"
             VerticalAlignment="Stretch"
             TitleStyle="{DynamicResource WinUIDialogWindowTitleStyle}"
             Style="{DynamicResource WinUIDialogWindowStyle}">  
    <dxwui:WinUIDialogWindow.InputBindings>
        <KeyBinding Key="Escape"  Command="{Binding CancelButtonCommand}"/>
    </dxwui:WinUIDialogWindow.InputBindings>
    <dxwui:WinUIDialogWindow.Resources>
        <DataTemplate x:Key="WarehousecategoryHeaderTemplate">

            <dxlc:LayoutControl Padding="2" ScrollBars="None" Background="Transparent">


                <TextBlock Text="{DynamicResource ArticlesWarehouseCategoriesHeader}" HorizontalAlignment="Left" VerticalAlignment="Center" />
                
                <Button Content=" " Width="40" HorizontalAlignment="Right"
                                        Background="Gray" 
                                        HorizontalContentAlignment="Right"
                                        Command="{Binding DataContext.ExpandAndCollapsWMSCategoriesCommand, RelativeSource={RelativeSource AncestorType=dxwui:WinUIDialogWindow, Mode=FindAncestor}}"
                                        CommandParameter="{Binding ElementName=WMSArticleCategoryTreeListView}">
                    <Button.ContentTemplate>
                        <DataTemplate>
                            <Image 
                                                   Height="14" Width="14"
                                                   HorizontalAlignment="Center" VerticalAlignment="Center">
                                <Image.Style>
                                    <Style TargetType="{x:Type Image}">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding DataContext.IsWMSExpand, Mode=TwoWay,UpdateSourceTrigger=PropertyChanged,RelativeSource={RelativeSource AncestorType=dxwui:WinUIDialogWindow}}" Value="True">
                                                <Setter Property="Source" Value="{DynamicResource ExpandButtonImage}" />
                                                <Setter Property="ToolTip" Value="Expand Categories" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding DataContext.IsWMSExpand, Mode=TwoWay,UpdateSourceTrigger=PropertyChanged,RelativeSource={RelativeSource AncestorType=dxwui:WinUIDialogWindow}}" Value="False">
                                                <Setter Property="Source" Value="{DynamicResource CollapsButtonImage}" />
                                                <Setter Property="ToolTip" Value="Collapse Categories" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Image.Style>
                            </Image>
                        </DataTemplate>
                    </Button.ContentTemplate>
                </Button>
            </dxlc:LayoutControl>
            
        </DataTemplate>

        <DataTemplate x:Key="ArticleCategoryHeaderTemplate">

            <dxlc:LayoutControl Padding="2" ScrollBars="None" Background="Transparent">


                <TextBlock Text="{DynamicResource ArticlesArticleCategoriesHeader}" HorizontalAlignment="Left" VerticalAlignment="Center" />
                <Button Content=" " Width="40" HorizontalAlignment="Right"
                                        Background="Gray" 
                                        HorizontalContentAlignment="Center"
                                        Command="{Binding DataContext.ExpandAndCollapsPCMCategoriesCommand, RelativeSource={RelativeSource AncestorType=dxwui:WinUIDialogWindow, Mode=FindAncestor}}"
                                        CommandParameter="{Binding ElementName=GridCategoryMenuTreeList}">

                    <Button.ToolTip>
                        <TextBlock Text="Expand Categories"/>
                    </Button.ToolTip>
                    <Button.ContentTemplate>
                        <DataTemplate>
                            <Image 
                                                   Height="14" Width="14"
                                                   HorizontalAlignment="Center" VerticalAlignment="Center">
                                <Image.Style>
                                    <Style TargetType="{x:Type Image}">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding DataContext.IsPCMExpand, Mode=TwoWay,UpdateSourceTrigger=PropertyChanged,RelativeSource={RelativeSource AncestorType=dxwui:WinUIDialogWindow}}" Value="True">
                                                <Setter Property="Source" Value="{DynamicResource ExpandButtonImage}" />
                                                <Setter Property="ToolTip" Value="Expand Categories" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding DataContext.IsPCMExpand, Mode=TwoWay,UpdateSourceTrigger=PropertyChanged,RelativeSource={RelativeSource AncestorType=dxwui:WinUIDialogWindow}}" Value="False">
                                                <Setter Property="Source" Value="{DynamicResource CollapsButtonImage}" />
                                                <Setter Property="ToolTip" Value="Collapse Categories" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Image.Style>
                            </Image>
                        </DataTemplate>
                    </Button.ContentTemplate>
                </Button>
            </dxlc:LayoutControl>

        </DataTemplate>


    </dxwui:WinUIDialogWindow.Resources>
    <ScrollViewer VerticalScrollBarVisibility="Auto" HorizontalScrollBarVisibility="Auto">
    <Grid HorizontalAlignment="Stretch" VerticalAlignment="Center" >
        <Grid.RowDefinitions>
            <RowDefinition Height="70"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="5"/>
            <RowDefinition Height="50"/>
        </Grid.RowDefinitions>

            <Grid Grid.Row="0" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
            <Label Content="{DynamicResource ArticlesCategoriesMappingHeader}" Style="{StaticResource LabelTitleStyle}"
                    HorizontalAlignment="Left"
                    VerticalAlignment="Center" />
        </Grid>

            <Grid Grid.Row="1" VerticalAlignment="Stretch" HorizontalAlignment="Stretch" >

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="5"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <!--Warehouse Categories-->
                <dxlc:LayoutGroup Grid.Column="0" Header="{DynamicResource ArticlesWarehouseCategoriesHeader}" HeaderTemplate="{StaticResource WarehousecategoryHeaderTemplate}"
                          MinHeight="600" MaxHeight="600"           View="GroupBox" Width="300" dxlc:LayoutControl.AllowVerticalSizing="True">
                    <Grid>
                       
                        <dxg:TreeListControl x:Name="GridArticleMenuList" MaxHeight="550"
                                                 HorizontalAlignment="Stretch" VerticalAlignment="Stretch" SelectionMode="Row"
            
                                                 ItemsSource="{Binding DataContext.WarehouseCategoryMenuList, Mode=TwoWay,UpdateSourceTrigger=PropertyChanged,RelativeSource={RelativeSource AncestorType=dxwui:WinUIDialogWindow}}">
                            <dxg:TreeListControl.Columns>
                                <dxg:TreeListColumn Width="*" FieldName="Name" FixedWidth="True" ReadOnly="True" FilterPopupMode="CheckedList"/>
                            </dxg:TreeListControl.Columns>
                            <dxg:TreeListControl.View >
                                <dxg:TreeListView Name="WMSArticleCategoryTreeListView" 
                                                      ShowTotalSummary="False"
                                                      AllowRecursiveNodeChecking="False"
                                                      ShowSearchPanelMode="Always"
                                                      ShowColumnHeaders="False"
                                                      ShowIndicator="False" 
                                                      VerticalScrollbarVisibility="Visible"
                                                      ParentFieldName="ParentName" 
                                                      KeyFieldName="KeyName"
                                                      FilterMode="Extended"
                                                      SearchPanelHorizontalAlignment="Stretch" 
                                                      AllowDragDrop="True" 
                                                      AllowDrop="False"
                                                      AllowCascadeUpdate="False"
                                                      AllowEditing="False"
                                                      NavigationStyle="Row" 
                                                      AutoExpandAllNodes="True" >
                                    
                                    <dxg:TreeListView.DragDropHintTemplate>
                                            <DataTemplate>
                                                <dxe:ListBoxEdit ItemsSource="{Binding DataContext.ArticleRecords,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged,RelativeSource={RelativeSource AncestorType=dxwui:WinUIDialogWindow}}" DisplayMember="Name"/>
                                            </DataTemplate>
                                        </dxg:TreeListView.DragDropHintTemplate>
                                    
                            </dxg:TreeListView>
                        </dxg:TreeListControl.View>
                    </dxg:TreeListControl>
                </Grid>
                </dxlc:LayoutGroup>

          

            <!--Article Categories-->

                <dxlc:LayoutGroup Grid.Column="2"  Header="{DynamicResource ArticlesArticleCategoriesHeader}" HeaderTemplate="{StaticResource ArticleCategoryHeaderTemplate}"
                       MinHeight="600" MaxHeight="600"            View="GroupBox" Width="300" dxlc:LayoutControl.AllowVerticalSizing="True">
                    <Grid>
                       
                        <dxg:TreeListControl x:Name="GridCategoryMenuList" MaxHeight="550"
                                               
                                                 HorizontalAlignment="Stretch" VerticalAlignment="Stretch" AutoGenerateColumns="None" 
                                                 ItemsSource="{Binding DataContext.CategoryMenulist, Mode=TwoWay,UpdateSourceTrigger=PropertyChanged,RelativeSource={RelativeSource AncestorType=dxwui:WinUIDialogWindow}}"                                                  
                                                 SelectionMode="Row" >

                            <dxg:TreeListControl.Columns>
                                <dxg:TreeListColumn Width="*" FieldName="NameWithArticleCount" FixedWidth="True" ReadOnly="True" FilterPopupMode="CheckedList"/>

                            </dxg:TreeListControl.Columns>
                            <dxg:TreeListControl.View>
                                <dxg:TreeListView Name="GridCategoryMenuTreeList" 
                                                      ShowTotalSummary="False"
                                                      AllowRecursiveNodeChecking="False"
                                                      ShowSearchPanelMode="Always"
                                                      ShowColumnHeaders="False"
                                                      ShowIndicator="False"
                                                      VerticalScrollbarVisibility="Visible"
                                                      ParentFieldName="ParentName" 
                                                      KeyFieldName="KeyName"
                                                      FilterMode="Extended"
                                                      SearchPanelHorizontalAlignment="Stretch"
                                                      AllowDragDrop="True"                                                     
                                                      AutoExpandAllNodes="True"
                                                      NavigationStyle="Row">
                                    <dxmvvm:Interaction.Behaviors>
                                        <dxmvvm:EventToCommand Command="{Binding DataContext.CommandOnDragRecordOverPCMArticle, RelativeSource={RelativeSource AncestorType={x:Type dxwui:WinUIDialogWindow}}}"
                                                                                       EventName="DragRecordOver" PassEventArgsToCommand="True">
                                        </dxmvvm:EventToCommand>
                                        <dxmvvm:EventToCommand Command="{Binding DataContext.CommandCompleteRecordDragDropPCMArticle, RelativeSource={RelativeSource AncestorType={x:Type dxwui:WinUIDialogWindow}}}"
                                                                                       EventName="CompleteRecordDragDrop" PassEventArgsToCommand="True">
                                        </dxmvvm:EventToCommand>
                                        <dxmvvm:EventToCommand Command="{Binding DataContext.CommandDropRecordPCMArticle, RelativeSource={RelativeSource AncestorType={x:Type dxwui:WinUIDialogWindow}}}"
                                                                                       EventName="DropRecord" PassEventArgsToCommand="True">
                                        </dxmvvm:EventToCommand>
                                    </dxmvvm:Interaction.Behaviors>
                                </dxg:TreeListView>
                            </dxg:TreeListControl.View>
                        </dxg:TreeListControl>
                    </Grid>
                </dxlc:LayoutGroup>


                <dxlc:LayoutGroup VerticalAlignment="Stretch" HorizontalAlignment="Stretch" Grid.Column="4" MinHeight="600" MaxHeight="600" >
                    <Grid >
                       
                        <dxg:GridControl  VerticalAlignment="Stretch" HorizontalAlignment="Stretch" MinHeight="600" MaxHeight="600"
                             ItemsSource="{Binding ArticleCategoryMappingList,UpdateSourceTrigger=PropertyChanged,Mode=TwoWay}" 
                             SelectedItem="{Binding SelectedPCMArticleCategory,UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                           
                             ImplyNullLikeEmptyStringWhenFiltering="True" SelectionMode="Row">

                            <dxg:GridColumn Header="{DynamicResource ArticlesWarehouseCategoryHeader}" FieldName="WMSArticleMapping"  Width="500" FilterPopupMode="CheckedList" />
                            <dxg:GridColumn Header="{DynamicResource ArticlesArticleCategoryHeader}" FieldName="PCMArticleMapping" Width="500" FilterPopupMode="CheckedList"/>
                            <dxg:GridColumn MinWidth="30" Width="40" ReadOnly="True" FixedWidth="True" Fixed="Right" FilterPopupMode="Default" AllowPrinting="False" ShowInColumnChooser="False" AllowMoving="false">
                                <dxg:GridColumn.CellTemplate>
                                    <DataTemplate>
                                        <Button Name="deleteRowItem" ToolTip="{DynamicResource Delete}" 
                                                IsEnabled="{Binding Source={x:Static GeosApplication:GeosApplication.Instance}, Path=PCMEditArticleCategoryMapping}"
                                                Command="{Binding View.DataContext.DeleteDetectionCommand}" CommandParameter="{Binding ElementName=ItemListTableView}">
                                            <Button.ContentTemplate>
                                                <DataTemplate>
                                                    <Image Height="16" Width="16"  Style="{ DynamicResource DeleteStyle}" />
                                                </DataTemplate>
                                            </Button.ContentTemplate>
                                            <Button.Style>
                                                <Style TargetType="{x:Type Button}">
                                                    <Style.Triggers>
                                                        <Trigger Property="IsMouseOver" Value="True">
                                                            <Setter Property="Cursor" Value="Hand"/>
                                                        </Trigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Button.Style>
                                        </Button>
                                    </DataTemplate>
                                </dxg:GridColumn.CellTemplate>
                            </dxg:GridColumn>

                            <dxg:GridControl.View>
                                <dxg:TableView
                                   x:Name="ItemListTableView"
                                               NavigationStyle="Row"
                                               AllowHorizontalScrollingVirtualization="True" 
                                               RowDetailsVisibilityMode="Visible"
                                               ShowHorizontalLines="True"
                                               ShowSearchPanelMode="Always"
                                               ShowColumnHeaders="True"
                                               VerticalScrollbarVisibility="Auto" 
                                               HorizontalScrollbarVisibility="Auto"
                                               AllowFixedColumnMenu="False"
                                               AutoWidth="False"
                                               ShowFixedTotalSummary="True"
                                               ShowAutoFilterRow="True"
                                               ShowSearchPanelCloseButton="False"
                                               SearchPanelHorizontalAlignment="Stretch"
                                               ColumnChooserColumnDisplayMode="ShowHiddenColumnsOnly"
                                               AllowGrouping="True"
                                               ShowGroupPanel="False"
                                               ShowIndicator="False" 
                                               FilterRowDelay="500"
                                               AllowColumnFiltering="True"
                                               FilterEditorShowOperandTypeIcon="True"
                                               AllowColumnMoving="True"
                                               AllowEditing="False"
                                               AllowDrop="False"
                                               UseLegacyFilterEditor="True"                                   
                                               ImmediateUpdateRowPosition="False"
                                               AllowConditionalFormattingMenu="True"
                                    FocusedRow="{Binding Path=SelectedPCMArticleCategory, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}">
                                </dxg:TableView>
                            </dxg:GridControl.View>
                            <dxmvvm:Interaction.Behaviors>
                                <UIHelper:GridSelectingBehavior />
                            </dxmvvm:Interaction.Behaviors>

                            <dxg:GridControl.TotalSummary>
                                <dxg:GridSummaryItem x:Name="summary" FieldName="" SummaryType="Count" DisplayFormat="Total Count : {0}" Visible="True" Alignment="Left"/>
                            </dxg:GridControl.TotalSummary>
                        </dxg:GridControl>
                    </Grid>
                </dxlc:LayoutGroup>
          


           


          
        </Grid>





            <Grid Grid.Row="3" ShowGridLines="False" VerticalAlignment="Center" HorizontalAlignment="Center">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="50"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Button Grid.Row="3" Grid.Column="0"
                    Style="{DynamicResource Button16Style}"
                    HorizontalAlignment="Right"
                    Content="{DynamicResource AddCatalogueAcceptButton}"
                    Command="{Binding AcceptButtonCommand,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}"
                    Height="30"
                    Width="100"
                   IsEnabled="{Binding Source={x:Static GeosApplication:GeosApplication.Instance}, Path=PCMEditArticleCategoryMapping}"
                    CommandParameter="{Binding ElementName=Compatibility}"/>

            <Button Grid.Row="3" Grid.Column="2"
                    Style="{DynamicResource Button16Style}"
                    HorizontalAlignment="Left"
                    Content="{DynamicResource AddCatalogueCancelButton}"
                    Command="{Binding CancelButtonCommand}"
                    Height="30"
                    Width="100" />
        </Grid>

    </Grid>
    </ScrollViewer>
</dxwui:WinUIDialogWindow>
