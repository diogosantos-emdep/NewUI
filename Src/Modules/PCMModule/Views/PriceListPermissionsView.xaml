<UserControl x:Class="Emdep.Geos.Modules.PCM.Views.PriceListPermissionsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:dxg="http://schemas.devexpress.com/winfx/2008/xaml/grid"
             xmlns:ViewModels="clr-namespace:Emdep.Geos.Modules.PCM.ViewModels"
             xmlns:dxe="http://schemas.devexpress.com/winfx/2008/xaml/editors"
             xmlns:dxmvvm="http://schemas.devexpress.com/winfx/2008/xaml/mvvm" 
             xmlns:dx="http://schemas.devexpress.com/winfx/2008/xaml/core" 
             xmlns:ei="http://schemas.microsoft.com/expression/2010/interactions"
             xmlns:dxci="http://schemas.devexpress.com/winfx/2008/xaml/core/internal"
             xmlns:dxwui="http://schemas.devexpress.com/winfx/2008/xaml/windowsui"
             xmlns:UIHelper="clr-namespace:Emdep.Geos.UI.Helper;assembly=Emdep.Geos.UI.Helper"
             xmlns:UIConverter="clr-namespace:Emdep.Geos.UI.Converters;assembly=Emdep.Geos.UI.Converters" 
             xmlns:dxpg="http://schemas.devexpress.com/winfx/2008/xaml/pivotgrid"
             xmlns:local="clr-namespace:Emdep.Geos.Modules.PCM.Views"
             xmlns:dxgt="http://schemas.devexpress.com/winfx/2008/xaml/grid/themekeys"
             xmlns:dxp="http://schemas.devexpress.com/winfx/2008/xaml/printing" 
             xmlns:Interactive="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity" 
             xmlns:sysglb="clr-namespace:System.Globalization;assembly=mscorlib"
             xmlns:Behaviors="clr-namespace:Emdep.Geos.UI.Behaviors;assembly=Emdep.Geos.UI.Common"
             xmlns:GeosApplication="clr-namespace:Emdep.Geos.UI.Common;assembly=Emdep.Geos.UI.Common"
             xmlns:i="http://schemas.microsoft.com/expression/2010/interactivity"
             xmlns:gif="http://wpfanimatedgif.codeplex.com"
             mc:Ignorable="d" Style="{DynamicResource UserControlStyle}"
             d:DesignHeight="300" d:DesignWidth="300">

    <UserControl.Resources>

        <Style x:Key="ColumnStyle" TargetType="dxg:GridColumn">
            <Setter Property="FilterPopupMode" Value="CheckedList"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding Path=IsVertical}" Value="True">
                    <Setter Property="HeaderTemplate">
                        <Setter.Value>
                            <DataTemplate>
                                <ContentControl Content="{Binding}">
                                    <ContentControl.LayoutTransform>
                                        <RotateTransform Angle="-90"/>
                                    </ContentControl.LayoutTransform>
                                    <ContentControl.ContentTemplate>
                                        <DataTemplate>
                                            <TextBlock TextWrapping="Wrap" Text="{Binding}" ToolTip="{Binding}" />
                                        </DataTemplate>
                                    </ContentControl.ContentTemplate>
                                </ContentControl>
                            </DataTemplate>
                        </Setter.Value>
                    </Setter>
                    <Setter Property="FilterEditorHeaderTemplate">
                        <Setter.Value>
                            <DataTemplate>
                                <ContentControl Content="{Binding}">
                                    <ContentControl.LayoutTransform>
                                        <RotateTransform Angle="0"/>
                                    </ContentControl.LayoutTransform>
                                    <ContentControl.ContentTemplate>
                                        <DataTemplate>
                                            <TextBlock TextWrapping="Wrap" Text="{Binding}" ToolTip="{Binding}" />
                                        </DataTemplate>
                                    </ContentControl.ContentTemplate>
                                </ContentControl>
                            </DataTemplate>
                        </Setter.Value>
                    </Setter>
                    <Setter Property="Width" Value="10"/>
                    <Setter Property="FixedWidth" Value="True"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="PrintColumnHeaderStyle" TargetType="dxe:TextEdit"  BasedOn="{StaticResource {dxgt:TableViewThemeKey ResourceKey=DefaultPrintCellStyle}}">
            <Style.Triggers>
                <DataTrigger Binding="{Binding Path=Column.DataContext.IsVertical}" Value="True">
                    <Setter Property="dxp:ExportSettings.TargetType" Value="Image"/>
                    <Setter Property="Height" Value="150"/>
                    <Setter Property="DisplayTemplate">
                        <Setter.Value>
                            <ControlTemplate>
                                <dxe:TextEdit Name="PART_Editor" HorizontalAlignment="Left" Text="{Binding Path=Column.DataContext.FieldName}" IsPrintingMode="True" >
                                    <dxe:TextEdit.LayoutTransform >
                                        <RotateTransform Angle="-90"/>
                                    </dxe:TextEdit.LayoutTransform>
                                </dxe:TextEdit>
                            </ControlTemplate>
                        </Setter.Value>
                    </Setter>
                </DataTrigger>
            </Style.Triggers>
        </Style>
        <UIHelper:ColumnTemplateSelector x:Key="ColumnTemplateSelector"/>
        <UIHelper:PriceListPermissionMultipleCellEditHelper x:Key="PriceListPermissionMultipleCellEditHelper"/>
        <Style TargetType="dxg:GridColumnHeader">
            <Setter Property="Height" Value="120"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding RelativeSource={RelativeSource Self}, Path=(dxg:ColumnBase.HeaderPresenterType)}" Value="ColumnChooser">
                    <Setter Property="Height" Value="30"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <ControlTemplate x:Key="popupContentTemplate">
            <dxg:GridControl x:Name="PART_GridControl" AutoExpandAllGroups="True">
                <dxg:GridControl.Columns>
                    <dxg:GridColumn FieldName="Name" Header="Name" />
                    <dxg:GridColumn FieldName="CarOEM.Name" Header="OEM" />
                    <dxg:GridColumn FieldName="CreationDate" Header="Creation Date"/>
                </dxg:GridControl.Columns>
                <dxg:GridControl.View>
                    <dxg:TableView
                        Name="View"
                        ShowGroupedColumns="True"
                        AutoWidth="True"
                        ShowIndicator="False"
                        AllowPerPixelScrolling="True"
                        ScrollAnimationDuration="0" 
                        ShowAutoFilterRow="True"
                        ShowTotalSummary="False"
                        IsSynchronizedWithCurrentItem="False"
                        SearchPanelHorizontalAlignment="Stretch"
                        ColumnChooserColumnDisplayMode="ShowHiddenColumnsOnly">
                    </dxg:TableView>
                </dxg:GridControl.View>
            </dxg:GridControl>
        </ControlTemplate>

        <DataTemplate x:Key="IsCheckedColumnTemplate">
            <ContentControl>
                <dxg:GridColumn FieldName="{Binding Path=(dxci:DependencyObjectExtensions.DataContext).FieldName, RelativeSource={RelativeSource Self}}" MinWidth="150" AllowMoving="True" AllowEditing="{Binding AllowEditing }" Visible="{Binding Visible}"  ShowInColumnChooser="False" 
                                ReadOnly="{Binding Source={x:Static GeosApplication:GeosApplication.Instance}, Path=IsPermissionReadOnly}">
                    <dxg:GridColumn.CellTemplate>
                        <DataTemplate>
                            <dxe:CheckEdit EditValue="{Binding Data.IsChecked,UpdateSourceTrigger=PropertyChanged,Mode=TwoWay}" IsThreeState="True" />
                        </DataTemplate>
                    </dxg:GridColumn.CellTemplate>
                </dxg:GridColumn>
            </ContentControl>
        </DataTemplate>

        <DataTemplate x:Key="RotateHeaderTemplate" >
            <ContentControl Content="{Binding IsVertical}">
                <ContentControl.LayoutTransform>
                    <RotateTransform Angle="-90" />
                </ContentControl.LayoutTransform>
            </ContentControl>
        </DataTemplate>

        <DataTemplate x:Key="turnedHeaderTemplate">
            <TextBlock Text="{Binding}">
                <TextBlock.LayoutTransform>
                    <TransformGroup>
                        <RotateTransform Angle="180"/>
                    </TransformGroup>
                </TextBlock.LayoutTransform>
            </TextBlock>
        </DataTemplate>



        <Style TargetType="dxg:GridCellContentPresenter"  x:Key="11"
               xmlns:dxgt="http://schemas.devexpress.com/winfx/2008/xaml/grid/themekeys"
               BasedOn="{StaticResource {dxgt:GridRowThemeKey ResourceKey=CellStyle}}">
            <Setter Property="Background" Value="Green" />
            <Style.Triggers>
                <DataTrigger Binding="{Binding RowData.IsSelected}" Value="True">
                    <Setter Property="Background" Value="DeepPink" />
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <DataTemplate x:Key="HiddenColumnTemplate">
            <ContentControl>
                <dxg:GridColumn FieldName="{Binding FieldName}" Header="{Binding HeaderText}" AllowCellMerge="{Binding AllowCellMerge}"  FixedWidth="{Binding FixedWidth}"   AllowBestFit="True" Width="{Binding  Width}" AllowEditing="False" AllowAutoFilter="False"  Visible="{Binding Visible}"  AllowMoving="False" ShowInColumnChooser="False" 
                                ReadOnly="{Binding Source={x:Static GeosApplication:GeosApplication.Instance}, Path=IsPermissionReadOnly}" />
            </ContentControl>
        </DataTemplate>

        <DataTemplate x:Key="NameColumnTemplate">
            <ContentControl>
                <dxg:GridColumn FieldName="{Binding FieldName}" Header="{Binding HeaderText}" AllowCellMerge="{Binding AllowCellMerge}"  FixedWidth="{Binding FixedWidth}"   AllowBestFit="true" Width="{Binding  Width}" AllowEditing="false" AllowAutoFilter="False"  Visible="True" MinWidth="200" AllowMoving="True" 
                                ReadOnly="{Binding Source={x:Static GeosApplication:GeosApplication.Instance}, Path=IsPermissionReadOnly}"/>
            </ContentControl>
        </DataTemplate>
        <DataTemplate x:Key="ALLPriceListsColumnTemplate">
            <ContentControl>
                <dxg:GridColumn FieldName="{Binding Path=FieldName}" Tag="{Binding}" Header="{Binding HeaderText}" AllowCellMerge="{Binding AllowCellMerge}" FixedWidth="{Binding FixedWidth}"   AllowBestFit="true" Width="{Binding  Width}" AllowEditing="True" AllowAutoFilter="False"  Visible="True" MinWidth="50" AllowMoving="True"  
                                 HorizontalHeaderContentAlignment="Center">
                    <dxg:GridColumn.DisplayTemplate>
                        <ControlTemplate>
                            <TextBlock Text="{Binding Data.ALLPriceLists}" HorizontalAlignment="Center" VerticalAlignment="Center"></TextBlock>
                        </ControlTemplate>
                    </dxg:GridColumn.DisplayTemplate>
                    <dxg:GridColumn.CellTemplate>
                        <DataTemplate>
                            <dxe:ComboBoxEdit Name="PART_Editor" ItemsSource="{Binding DataContext.ALLPriceListPermissionsList,RelativeSource={RelativeSource AncestorType=UserControl}}"
                                              IsTextEditable="False" HorizontalContentAlignment="Center" Height="50" HorizontalAlignment="Stretch" DisplayMember="PermissionName"
                                              ValueMember="PermissionName" SelectedItem="{Binding DataContext.SelectAllPriceList,RelativeSource={RelativeSource AncestorType=UserControl}}">
                            </dxe:ComboBoxEdit>
                        </DataTemplate>
                    </dxg:GridColumn.CellTemplate>
                </dxg:GridColumn>
            </ContentControl>
        </DataTemplate>

        <DataTemplate x:Key="ArrayColumnTemplate">
            <ContentControl>
                <dxg:GridColumn FieldName="{Binding Path=FieldName}" Tag="{Binding}" Header="{Binding HeaderText}" AllowCellMerge="{Binding AllowCellMerge}" HorizontalHeaderContentAlignment="Center" FixedWidth="{Binding FixedWidth}" AllowBestFit="true" Width="{Binding  Width}" Visible="{Binding Visible}" AllowMoving="False" ShowInColumnChooser="False" AllowEditing="True"
                                ReadOnly="{Binding Source={x:Static GeosApplication:GeosApplication.Instance}, Path=IsPermissionReadOnly}" BestFitArea="All" >

                    <dxg:GridColumn.CellTemplate>
                        <DataTemplate>
                            <dxe:ComboBoxEdit Name="PART_Editor" ItemsSource="{Binding DataContext.PermissionsList,RelativeSource={RelativeSource AncestorType=UserControl}}"
                                              HorizontalAlignment="Stretch" IsTextEditable="False" Height="50"
                                              ApplyItemTemplateToSelectedItem="True" HorizontalContentAlignment="Center">
                                <dxe:ComboBoxEdit.ItemTemplate>
                                    <DataTemplate>
                                        <TextBlock Text="{Binding StringFormat={}{0}}"/>
                                    </DataTemplate>
                                </dxe:ComboBoxEdit.ItemTemplate>
                            </dxe:ComboBoxEdit>
                        </DataTemplate>
                    </dxg:GridColumn.CellTemplate>
                </dxg:GridColumn>
            </ContentControl>
        </DataTemplate>

        <DataTemplate x:Key="IdPriceListColumnTemplate">
            <ContentControl>
                <dxg:GridColumn FieldName="{Binding Path=FieldName}" Tag="{Binding}"  Header="{Binding HeaderText}" AllowCellMerge="{Binding AllowCellMerge}"  FixedWidth="{Binding FixedWidth}"  AllowBestFit="true" Width="{Binding  Width}" HorizontalHeaderContentAlignment="Center"  Visible="{Binding Visible}" AllowMoving="False" ShowInColumnChooser="False" AllowSorting="False" 
                                ReadOnly="{Binding Source={x:Static GeosApplication:GeosApplication.Instance}, Path=IsPermissionReadOnly}" BestFitArea="All">
                    <dxg:GridColumn.EditSettings>
                        <dxe:TextEditSettings HorizontalContentAlignment="Left">
                        </dxe:TextEditSettings>
                    </dxg:GridColumn.EditSettings>
                </dxg:GridColumn>
            </ContentControl>
        </DataTemplate>

        <UIHelper:CellTemplateSelector x:Key="myTemplateSelector"/>

        <DataTemplate x:Key="SummaryTemplate">
            <ContentControl>
                <dxg:GridSummaryItem FieldName="{Binding Path=(dxci:DependencyObjectExtensions.DataContext).FieldName, RelativeSource={RelativeSource Self}}"
                                     SummaryType="{Binding Path=(dxci:DependencyObjectExtensions.DataContext).Type, RelativeSource={RelativeSource Self}}"
                                     DisplayFormat= "{Binding Path=(dxci:DependencyObjectExtensions.DataContext).DisplayFormat, RelativeSource={RelativeSource Self}}" />
            </ContentControl>
        </DataTemplate>

    </UserControl.Resources>

    <Grid x:Name="PriceListPermissionsGrid">

        <Grid.RowDefinitions>
            <RowDefinition Height="50"/>
            <RowDefinition Height="{Binding GridRowHeight}"/>
            <RowDefinition Height="50*"/>
        </Grid.RowDefinitions>

        <Grid  HorizontalAlignment="Stretch" VerticalAlignment="Stretch"  Grid.Row="0" >
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="AUTO" />
                <ColumnDefinition Width="AUTO" />
                <ColumnDefinition Width="AUTO" />
                <ColumnDefinition Width="AUTO" />
                <ColumnDefinition Width="AUTO" />
            </Grid.ColumnDefinitions>

            <TextBlock Text="{DynamicResource PriceListPermissionsViewHeader}"  Grid.Column="0" Style="{DynamicResource TextBlock30Style}" FontWeight="Bold" />

            <!-- Period -->
            <DockPanel Grid.Column="3" HorizontalAlignment="Center"  VerticalAlignment="Center" Margin="15,0,0,0" >
                <TextBlock Text="{Binding FromDate, StringFormat=d}" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0, 0,5,0"/>
                <TextBlock Text=" - " HorizontalAlignment="Center" VerticalAlignment="Center" FontWeight="Bold" Margin="0,0,5,0"/>
                <TextBlock Text="{Binding ToDate, StringFormat=d}" HorizontalAlignment="Center" VerticalAlignment="Center" Margin="0, 0,5,0"/>
            </DockPanel>

            <!--Calender Icon-->
            <dxwui:AppBar x:Name="Appbar" HideMode="AlwaysVisible" Background="Transparent" Grid.Column="2"
                                  IsSticky="True" HorizontalAlignment="Right"
                                  VerticalAlignment="Stretch"
                                  IsOpen="True" IsExitButtonEnabled="False" Margin="0,-10,-40,0">

                <dxwui:AppBarButton x:Name="appbarbutton" ToolTip="{DynamicResource PeriodSelect}"
                                        GlyphHeight="24" GlyphWidth="24" AllowGlyphTheming="False"
                                        Style="{DynamicResource CalendarImageGlyphStyle}"
                                        GlyphStretch="Fill" IsEllipseEnabled="False" >
                    <dxwui:AppBarButton.Flyout>
                        <dxwui:MenuFlyout ShowIndicator="True" x:Name="MenuLayout">
                            <dxwui:MenuFlyoutItem StaysOpenOnClick="True">
                                <Grid Width="Auto" Height="Auto">
                                    <DockPanel>
                                        <StackPanel Orientation="Vertical" x:Name="PeriodCategories">
                                            <!--This Year-->
                                            <Button x:Name="ThisYear" Content="This Year" HorizontalAlignment="Center" VerticalAlignment="Center"
                                                            Height="30" Width="110"
                                                            Command="{Binding PeriodCommand}"
                                                            CommandParameter="{Binding ElementName=ThisYear}">
                                            </Button>

                                            <!--Last Year-->
                                            <Button x:Name="LastYear" Content="Last Year" HorizontalAlignment="Center" VerticalAlignment="Center"
                                                            Height="30" Width="110"
                                                            Command="{Binding PeriodCommand}"
                                                            CommandParameter="{Binding ElementName=LastYear}">
                                            </Button>


                                            <!--This Month-->
                                            <Button x:Name="ThisMonth" Content="{DynamicResource SAMThisMonth}" HorizontalAlignment="Center" VerticalAlignment="Center"
                                                            Height="30" Width="110"
                                                            Command="{Binding PeriodCommand}"
                                                            CommandParameter="{Binding ElementName=ThisMonth}">
                                            </Button>

                                            <Button x:Name="LastMonth" Content="{DynamicResource SAMLastMonth}" HorizontalAlignment="Center" VerticalAlignment="Center" 
                                                            Height="30" Width="110"
                                                            Command="{Binding PeriodCommand}"
                                                            CommandParameter="{Binding ElementName=LastMonth}">
                                            </Button>

                                            <!--This week-->
                                            <Button x:Name="ThisWeek" Content="{DynamicResource SAMThisWeek}" HorizontalAlignment="Center" VerticalAlignment="Center" 
                                                            Height="30" Width="110"
                                                            Command="{Binding PeriodCommand}"
                                                            CommandParameter="{Binding ElementName=ThisWeek}">
                                            </Button>

                                            <Button x:Name="LastWeek" Content="{DynamicResource SAMLastWeek}" HorizontalAlignment="Center" VerticalAlignment="Center" 
                                                            Height="30" Width="110"
                                                            Command="{Binding PeriodCommand}"
                                                            CommandParameter="{Binding ElementName=LastWeek}">
                                            </Button>

                                            <!--Last 12 month-->
                                            <Button x:Name="Last12Months" Content="Last 12 Months" HorizontalAlignment="Center" VerticalAlignment="Center" 
                                                            Height="30" Width="110"
                                                            Command="{Binding PeriodCommand}"
                                                            CommandParameter="{Binding ElementName=Last12Months}">
                                            </Button>

                                            <!--Custom Range-->
                                            <Button x:Name="CustomRange" Content="{DynamicResource PeriodCustomRange}" HorizontalAlignment="Center" VerticalAlignment="Center"
                                                            Height="30" Width="110"
                                                            Command="{Binding PeriodCustomRangeCommand}"
                                                            CommandParameter="{Binding ElementName=CustomRange}">
                                            </Button>
                                            <StackPanel Orientation="Horizontal" Margin="0,50,0,0">
                                                <Button Content="{DynamicResource SAMApply}" HorizontalAlignment="Center" VerticalAlignment="Center"
                                                            Height="30" Width="60" Background="Yellow" 
                                                            Command="{Binding ApplyCommand}" CommandParameter="{Binding ElementName=MenuLayout}">
                                                </Button>
                                                <Button Content="{DynamicResource SAMCancel}" HorizontalAlignment="Center" VerticalAlignment="Center"
                                                            Height="30" Width="60" 
                                                            Command="{Binding CancelCommand}" CommandParameter="{Binding ElementName=MenuLayout}">
                                                </Button>
                                            </StackPanel>
                                        </StackPanel>

                                        <StackPanel Visibility="{Binding DataContext.IsCalendarVisible, RelativeSource={RelativeSource AncestorType=UserControl}, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}" Orientation="Horizontal">
                                            <StackPanel Orientation="Vertical">
                                                <dxe:TextEdit Text="{Binding DataContext.StartDate, RelativeSource={RelativeSource AncestorType=UserControl}, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}" 
                                                  Height="30" TextWrapping="Wrap" Mask="dd/MM/yyyy"  
                                                  MaskType="DateTimeAdvancingCaret"  
                                                  MaskUseAsDisplayFormat="True"
                                                  HorizontalAlignment="Stretch" IsReadOnly="True"  Margin="2,2,2,2">
                                                </dxe:TextEdit>
                                                <!--Calendar-->
                                                <dxe:DateEditCalendar DateTime="{Binding DataContext.StartDate, RelativeSource={RelativeSource AncestorType=UserControl}, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                                                                      VerticalAlignment="Center"
                                                                      ShowToday="False"
                                                                      ShowClearButton="False"/>
                                            </StackPanel>
                                            <StackPanel Orientation="Vertical">
                                                <dxe:TextEdit Text="{Binding DataContext.EndDate, RelativeSource={RelativeSource AncestorType=UserControl}, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}" 
                                                  Height="30" TextWrapping="Wrap" Mask="dd/MM/yyyy"  
                                                  MaskType="DateTimeAdvancingCaret"  
                                                  MaskUseAsDisplayFormat="True"
                                                  HorizontalAlignment="Stretch" IsReadOnly="True"  Margin="2,2,2,2">
                                                </dxe:TextEdit>
                                                <!--Calendar-->
                                                <dxe:DateEditCalendar DateTime="{Binding DataContext.EndDate, RelativeSource={RelativeSource AncestorType=UserControl}, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                                                                      VerticalAlignment="Center"
                                                                      ShowToday="False"
                                                                      ShowClearButton="False"/>
                                            </StackPanel>
                                        </StackPanel>
                                    </DockPanel>
                                </Grid>
                            </dxwui:MenuFlyoutItem>
                        </dxwui:MenuFlyout>
                    </dxwui:AppBarButton.Flyout>
                </dxwui:AppBarButton>
            </dxwui:AppBar>

            <Button Content=" " Height="40" Width="40" Grid.Column="4" Command="{Binding RefreshButtonCommand}" CommandParameter="{Binding ElementName=grid}"  HorizontalAlignment="Right" Margin="0,0,5,0">
                <Button.ToolTip>
                    <TextBlock Text="{DynamicResource ButtonRefresh}"/>
                </Button.ToolTip>
                <Button.ContentTemplate>
                    <DataTemplate>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <Image Style="{ DynamicResource RefreshButtonImageStyle}" Grid.Column="0" Height="24" Width="24" Margin="-10"/>
                        </Grid>
                    </DataTemplate>
                </Button.ContentTemplate>
            </Button>

            <Button Content=" " Height="40" Width="40"  HorizontalAlignment="Right" Grid.Column="5" Margin="0,0,5,0"
                    Command="{Binding PrintButtonCommand}" CommandParameter="{Binding ElementName=PriceListPermissionsTableView}" >
                <Button.ToolTip>
                    <TextBlock Text="{DynamicResource ButtonPrint}"/>
                </Button.ToolTip>
                <Button.ContentTemplate>
                    <DataTemplate>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <Image Style="{ DynamicResource PrinterButtonImageStyle}" Grid.Column="5" Height="24" Width="24" Margin="-10"/>
                        </Grid>
                    </DataTemplate>
                </Button.ContentTemplate>
            </Button>

            <Button Content=" " Height="40" Width="40"  HorizontalAlignment="Right" Grid.Column="6" Margin="0,0,5,0"
                    Command="{Binding ExportButtonCommand}" CommandParameter="{Binding ElementName=PriceListPermissionsTableView}" >
                <Button.ToolTip>
                    <TextBlock Text="{DynamicResource ButtonExportToExcel}"/>
                </Button.ToolTip>
                <Button.ContentTemplate>
                    <DataTemplate>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <Image Style="{ DynamicResource ExcelExportButtonImageStyle}" Grid.Column="0" Height="24" Width="24" Margin="-10"/>
                        </Grid>
                    </DataTemplate>
                </Button.ContentTemplate>
            </Button>

            <Button Content=" " Height="40" Width="40" Grid.Column="7" Command="{Binding UpdateMultipleRowsPriceListPermissionsCommand}" CommandParameter="{Binding ElementName=PriceListPermissionsTableView}" HorizontalAlignment="Right" Margin="0,0,5,0" 
                   IsEnabled="{Binding Path=(UIHelper:PriceListPermissionMultipleCellEditHelper.IsValueChanged), ElementName=PriceListPermissionsTableView}" >

                <Button.ToolTip>
                    <TextBlock Text="{DynamicResource ButtonSave}"/>
                </Button.ToolTip>
                <Button.ContentTemplate>
                    <DataTemplate>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <Image Style="{DynamicResource SaveButtonImageStyle}" Grid.Column="0" Height="24" Width="24" Margin="-10"/>
                        </Grid>
                    </DataTemplate>
                </Button.ContentTemplate>
            </Button>
        </Grid>

        <dxg:GridControl x:Name="grid"  DockPanel.Dock="Top" Grid.Row="2" HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Height="Auto"
                             ItemsSource="{Binding Dttable,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}" 
                             ColumnsSource="{Binding Columns,UpdateSourceTrigger=PropertyChanged}" AutoGenerateColumns="None"
                             ColumnGeneratorStyle="{StaticResource ColumnStyle}" ScrollViewer.HorizontalScrollBarVisibility="Auto"
                             ColumnGeneratorTemplateSelector="{StaticResource ColumnTemplateSelector}"
                             FilterString="{Binding MyFilterString,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}" SelectionMode="Cell"
                             FocusManager.IsFocusScope="True"
                             IsFilterEnabled="{Binding IsFilterEnabled, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"   ImplyNullLikeEmptyStringWhenFiltering="True" >

            <dxg:GridControl.View>
                <UIHelper:TableViewEx  x:Name="PriceListPermissionsTableView" ShowSearchPanelMode="Always"
                                       NavigationStyle="Cell"
                                       ShowFixedTotalSummary="False"
                                       ShowTotalSummary="True"
                                       ShowHorizontalLines="True"
                                       AllowPerPixelScrolling="True"
                                       AllowGrouping="True" ShowGroupPanel="False" 
                                       ShowColumnHeaders="True" ShowVerticalLines="True" 
                                       ShowIndicator="True" AutoWidth="True" 
                                       HorizontalScrollbarVisibility="Auto" 
                                       VerticalScrollbarVisibility="Auto"
                                       HorizontalContentAlignment="Center"
                                       ShowAutoFilterRow="False"
                                       RowMinHeight="20"
                                       AllowSorting="True" 
                                       AllowScrollHeaders="False"
                                       AllowEditing="True"
                                       AllowColumnMoving="True"
                                       AutoMoveRowFocus="False"
                                       AllowScrollAnimation="True"
                                       UIHelper:PriceListPermissionMultipleCellEditHelper.IsEnabled="True"
                                       AllowBestFit="True" AllowResizing="True"
                                       AllowConditionalFormattingMenu="True"
                                       PrintColumnHeaderStyle="{StaticResource PrintColumnHeaderStyle}"
                                       SearchPanelHorizontalAlignment="Stretch">

                    <dxmvvm:Interaction.Behaviors>
                        <dxmvvm:EventToCommand  Command="{Binding CommandGridDoubleClick}" EventName="MouseDoubleClick">
                            <dxmvvm:EventToCommand.EventArgsConverter>
                                <dx:EventArgsToDataRowConverter />
                            </dxmvvm:EventToCommand.EventArgsConverter>
                        </dxmvvm:EventToCommand>

                        <dxmvvm:EventToCommand EventName="ShowFilterPopup"
                                               Command="{Binding CommandShowFilterPopupClick}"
                                               PassEventArgsToCommand="True"/>

                        <dxmvvm:EventToCommand EventName="CellValueChanging" 
                                Command="{Binding DataContext.RuleValueChangedCommand,RelativeSource={RelativeSource AncestorType=UserControl}}"
                                PassEventArgsToCommand="True" CommandParameter="{Binding DataContext.RowData.Row}"/>

                    </dxmvvm:Interaction.Behaviors>
                    <Interactive:Interaction.Triggers>
                        <Interactive:EventTrigger  EventName="Loaded">
                            <Behaviors:InvokeDelegateCommandAction Command="{Binding CustomCellAppearanceCommand}" 
                                                                   CommandParameter="{Binding RelativeSource={RelativeSource Self}, Path=InvokeParameter}" />
                        </Interactive:EventTrigger>
                    </Interactive:Interaction.Triggers>
                    <dxg:TableView.Resources>
                        <DataTemplate x:Key="PageHeader">
                            <Grid Width="{Binding UsablePageWidth}">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*" />
                                    <ColumnDefinition Width="50" />
                                    <ColumnDefinition Width="130" />
                                </Grid.ColumnDefinitions>
                                <dxe:TextEdit Text=" " Width="{Binding UsablePageWidth}" Grid.ColumnSpan="3" IsPrintingMode="True" Background="#333E5E"   HorizontalAlignment="Stretch" 
                                              VerticalAlignment="Stretch" Padding="12" Foreground="#FFFFFFFF" FontWeight="Bold" FontSize="20" Height="50" />
                                <dxe:TextEdit Text="Price List Permissions Report" IsPrintingMode="True"     HorizontalAlignment="Stretch" 
                                              VerticalAlignment="Stretch" Padding="12" Foreground="#FFFFFFFF" FontWeight="Bold" FontSize="20" />
                                <Image Source="/Emdep.Geos.Modules.PCM;component/Assets/Images/GeosReportLogo.png" Height="50" Width="80"  dxp:ExportSettings.TargetType="Image" Grid.Column="2" />
                            </Grid>
                        </DataTemplate>
                        <DataTemplate x:Key="PageFooter">
                            <dxe:TextEdit HorizontalContentAlignment="Center" 
                                            Width="{Binding Path=UsablePageWidth, Mode=OneWay}" 
                                            dxp:ExportSettings.TargetType="PageNumber" 
                                            dxp:PageNumberExportSettings.Kind="NumberOfTotal" 
                                            dxp:PageNumberExportSettings.Format="Page {0} of {1}">
                            </dxe:TextEdit>
                        </DataTemplate>
                    </dxg:TableView.Resources>
                </UIHelper:TableViewEx>
            </dxg:GridControl.View>
        </dxg:GridControl>
    </Grid>
</UserControl>
