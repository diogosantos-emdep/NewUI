<UserControl x:Class="Emdep.Geos.Modules.Warehouse.Views.WorkOrderScheduleView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:dxg="http://schemas.devexpress.com/winfx/2008/xaml/grid"
             xmlns:dxe="http://schemas.devexpress.com/winfx/2008/xaml/editors"
             xmlns:dxmvvm="http://schemas.devexpress.com/winfx/2008/xaml/mvvm" 
             xmlns:dx="http://schemas.devexpress.com/winfx/2008/xaml/core" 
             xmlns:ei="http://schemas.microsoft.com/expression/2010/interactions"
             xmlns:dxci="http://schemas.devexpress.com/winfx/2008/xaml/core/internal"
             xmlns:dxwui="http://schemas.devexpress.com/winfx/2008/xaml/windowsui"
             xmlns:UIHelper="clr-namespace:Emdep.Geos.UI.Helper;assembly=Emdep.Geos.UI.Helper"
             xmlns:UIConverter="clr-namespace:Emdep.Geos.UI.Converters;assembly=Emdep.Geos.UI.Converters" 
             xmlns:dxp="http://schemas.devexpress.com/winfx/2008/xaml/printing" 
             xmlns:dxgt="http://schemas.devexpress.com/winfx/2008/xaml/grid/themekeys"
             xmlns:i="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity" 
             xmlns:sysglb="clr-namespace:System.Globalization;assembly=mscorlib"
             xmlns:behaviors="clr-namespace:Emdep.Geos.UI.Behaviors;assembly=Emdep.Geos.UI.Common"
             xmlns:GeosApplication="clr-namespace:Emdep.Geos.UI.Common;assembly=Emdep.Geos.UI.Common"
             xmlns:Interactive="clr-namespace:System.Windows.Interactivity;assembly=System.Windows.Interactivity"
             xmlns:dxsch="http://schemas.devexpress.com/winfx/2008/xaml/scheduler"
             xmlns:dxdo="http://schemas.devexpress.com/winfx/2008/xaml/docking"
             xmlns:dxb="http://schemas.devexpress.com/winfx/2008/xaml/bars"
             xmlns:dxschcore="clr-namespace:DevExpress.XtraScheduler;assembly=DevExpress.XtraScheduler.v19.2.Core"
             xmlns:WarehouseCommon="clr-namespace:Emdep.Geos.Modules.Warehouse"
             xmlns:sys="clr-namespace:System;assembly=mscorlib"
             Style="{DynamicResource UserControlStyle}"
             mc:Ignorable="d" 
             d:DesignHeight="300" d:DesignWidth="300">

    <UserControl.Resources>

        <!--<BooleanToVisibilityConverter x:Key="BoolToVis"/>-->
        <sys:Boolean x:Key="False">False</sys:Boolean>
        <UIConverter:AppointmentForegroundColorConverter x:Key="appointmentForegroundColorConverter" />
        <DataTemplate x:Key="AppointmentToolTipContentTemplate">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>
                <TextBlock Grid.Row="2" Text="{Binding Subject}" />
            </Grid>
        </DataTemplate>

        <!-- Display subject. -->
        <DataTemplate x:Key="AppointmentContentTemplate">
            <Border Margin="-5 -2 -5 -2" Style="{DynamicResource BorderStyle}">
                <Grid ShowGridLines="False">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="*" />
                    </Grid.ColumnDefinitions>

                    <Image Margin="2,0,0,0" Grid.Row="0" Grid.Column="0" Grid.RowSpan="1"
                           HorizontalAlignment="Left" VerticalAlignment="Top" 
                           MaxWidth="20" MaxHeight="20"
                           Source="{Binding CustomViewInfo.Picture}">
                        <Image.Style>
                            <Style TargetType="Image">
                                <Style.Triggers>
                                    <Trigger Property="Source" Value="{x:Null}">
                                        <Setter Property="Visibility" Value="Hidden" />
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </Image.Style>
                    </Image>

                    <Image Margin="2,0,0,0" Grid.Row="0" Grid.Column="1" Grid.RowSpan="1"
                           MaxWidth="18" MaxHeight="18"
                           HorizontalAlignment="Left" VerticalAlignment="Top" 
                           Source="{Binding CustomViewInfo.Picture2}" ToolTip="IsCritical">
                        <Image.Style>
                            <Style TargetType="Image">
                                <Style.Triggers>
                                    <Trigger Property="Source" Value="{x:Null}">
                                        <Setter Property="Visibility" Value="Hidden" />
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </Image.Style>
                    </Image>


                    <TextBlock Margin="2,0,0,0" Grid.Row="0" Grid.Column="2" Grid.ColumnSpan="2" HorizontalAlignment="Left" VerticalAlignment="Top" TextAlignment="Center" 
                               Text="{Binding Subject}" TextWrapping="WrapWithOverflow" Foreground="{Binding Label, Converter={StaticResource appointmentForegroundColorConverter}}" />

                    <TextBlock Margin="0,0,0,2" Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="4" VerticalAlignment="Bottom" HorizontalAlignment="Right" TextAlignment="Right" FontWeight="Bold"
                               Text="{Binding Description}" TextTrimming="CharacterEllipsis" Foreground="{Binding Label, Converter={StaticResource appointmentForegroundColorConverter}}" />
                </Grid>
            </Border>
        </DataTemplate>

    </UserControl.Resources>

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="50" />
            <RowDefinition Height="45*" />
        </Grid.RowDefinitions>


        <!--<Label Content="Schedule" Style="{StaticResource LabelTitleStyle}" Grid.Row="0"/>-->
        <Grid Grid.Row="0" HorizontalAlignment="Stretch" VerticalAlignment="Stretch">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="100*" />
                <ColumnDefinition Width="Auto" />
            </Grid.ColumnDefinitions>
            <Label Content="{DynamicResource WorkOrderScheduleHeader}" Grid.Row="0" Grid.Column="0" Style="{StaticResource LabelTitleStyle}" HorizontalAlignment="Left" />

            <DockPanel Grid.Row="0" Grid.Column="1">

                <Grid HorizontalAlignment="Right" Width="Auto" Height="45">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="45" />
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <!-- Waresouse combobox section -->
                    <!-- Plant Owner -->
                    <DockPanel Grid.Column="1" HorizontalAlignment="Center" VerticalAlignment="Center" Height="30">
                        <Image Style="{DynamicResource WarehouseImageStyle}" Width="24" Height="24" Margin="7,0,3,0" />
                        <TextBlock Text="{DynamicResource Warehouse}" FontWeight="Bold" Margin="5,2,5,0" VerticalAlignment="Bottom" />
                    </DockPanel>

                    <dxe:ComboBoxEdit Name="CbeWareHouse" Style="{DynamicResource ComboBoxEditStyle}" Grid.Column="2" Width="150" Height="30"
                                      Margin="5,0,5,0" IsTextEditable="False"
                                      ItemsSource="{Binding Source={x:Static WarehouseCommon:WarehouseCommon.Instance}, Path=WarehouseList, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                                  SelectedItem="{Binding Source={x:Static WarehouseCommon:WarehouseCommon.Instance}, Path=Selectedwarehouse,UpdateSourceTrigger=PropertyChanged}"
                                      DisplayMember="Name">
                        <dxmvvm:Interaction.Triggers>
                            <dxmvvm:EventToCommand EventName="EditValueChanged"
                                               Command="{Binding CommandWarehouseEditValueChanged}" CommandParameter="{Binding ElementName=CbeWareHouse,Path=SelectedItem}"
                                              />
                        </dxmvvm:Interaction.Triggers>
                    </dxe:ComboBoxEdit>

                    <!-- Refresh Button -->
                    <Button Content=" " Grid.Column="3" Height="40" Width="40" HorizontalAlignment="Right" Command="{Binding RefreshScheduleViewCommand}" CommandParameter="{Binding ElementName=ActivityTableView}" Margin="0,0,5,5">
                        <Button.ToolTip>
                            <TextBlock Text="{DynamicResource ButtonRefresh}" />
                        </Button.ToolTip>
                        <Button.ContentTemplate>
                            <DataTemplate>
                                <Image Style="{ DynamicResource WareHouseRefreshButtonImageStyle}" Height="24" Width="24" Margin="-10" />
                            </DataTemplate>
                        </Button.ContentTemplate>
                    </Button>
                </Grid>
            </DockPanel>
        </Grid>

        <!--<Button Content=" " Height="40" Width="40" Grid.Row="0" Command="{Binding RefreshScheduleViewCommand}" CommandParameter="{Binding ElementName=ActivityTableView}" HorizontalAlignment="Right" Margin="0,0,5,5">
            <Button.ToolTip>
                <TextBlock Text="{DynamicResource ButtonRefresh}"/>
            </Button.ToolTip>
            <Button.ContentTemplate>
                <DataTemplate>
                    <Image Style="{ DynamicResource WareHouseRefreshButtonImageStyle}" Grid.Column="0" Height="24" Width="24" Margin="-10"/>
                </DataTemplate>
            </Button.ContentTemplate>
        </Button>-->

        <dxsch:SchedulerControl ActiveViewType="Month" x:Name="WOSchedulerControl" Grid.Row="1">
            <dxsch:SchedulerControl.DayView>
                <dxsch:DayView AppointmentToolTipVisibility="Standard" AppointmentToolTipContentTemplate="{StaticResource AppointmentToolTipContentTemplate}" 
                               VerticalAppointmentContentTemplate="{StaticResource AppointmentContentTemplate}">
                    <dxsch:DayView.AppointmentDisplayOptions>
                        <dxsch:SchedulerDayViewAppointmentDisplayOptions StartTimeVisibility="Never" EndTimeVisibility="Never" ShowRecurrence="False" ShowReminder="False" />
                    </dxsch:DayView.AppointmentDisplayOptions>
                </dxsch:DayView>
            </dxsch:SchedulerControl.DayView>

            <dxsch:SchedulerControl.MonthView>
                <dxsch:MonthView AppointmentToolTipVisibility="Standard" AppointmentToolTipContentTemplate="{StaticResource AppointmentToolTipContentTemplate}" 
                                 HorizontalAppointmentContentTemplate="{StaticResource AppointmentContentTemplate}">
                    <dxsch:MonthView.AppointmentDisplayOptions>
                        <dxsch:SchedulerMonthViewAppointmentDisplayOptions AppointmentAutoHeight="True" StartTimeVisibility="Never" EndTimeVisibility="Never" ShowRecurrence="False" ShowReminder="False" />
                    </dxsch:MonthView.AppointmentDisplayOptions>
                </dxsch:MonthView>
            </dxsch:SchedulerControl.MonthView>

            <dxsch:SchedulerControl.WeekView>
                <dxsch:WeekView AppointmentToolTipVisibility="Standard" AppointmentToolTipContentTemplate="{StaticResource AppointmentToolTipContentTemplate}" 
                                HorizontalAppointmentContentTemplate="{StaticResource AppointmentContentTemplate}">
                    <dxsch:WeekView.AppointmentDisplayOptions>
                        <dxsch:SchedulerWeekViewAppointmentDisplayOptions AppointmentAutoHeight="True" StartTimeVisibility="Never" EndTimeVisibility="Never" ShowRecurrence="False" ShowReminder="False" />
                    </dxsch:WeekView.AppointmentDisplayOptions>
                </dxsch:WeekView>
            </dxsch:SchedulerControl.WeekView>


            <dxsch:SchedulerControl.TimelineView>
                <dxsch:TimelineView AppointmentToolTipVisibility="Standard" AppointmentToolTipContentTemplate="{StaticResource AppointmentToolTipContentTemplate}" 
                                    HorizontalAppointmentContentTemplate="{StaticResource AppointmentContentTemplate}">
                    <dxsch:TimelineView.AppointmentDisplayOptions>
                        <dxsch:SchedulerTimelineViewAppointmentDisplayOptions AppointmentAutoHeight="True" StartTimeVisibility="Never" EndTimeVisibility="Never" ShowReminder="False" ShowRecurrence="True" />
                    </dxsch:TimelineView.AppointmentDisplayOptions>
                    <dxsch:TimelineView.Scales>
                        <dxschcore:TimeScaleCollection>
                            <UIHelper:DisplayWeekInTimelineSchedulerHelper />
                            <dxschcore:TimeScaleWeek />
                            <dxschcore:TimeScaleDay />
                        </dxschcore:TimeScaleCollection>
                    </dxsch:TimelineView.Scales>
                </dxsch:TimelineView>
            </dxsch:SchedulerControl.TimelineView>

            <dxsch:SchedulerControl.TimeRulerMenuCustomizations>
                <dxsch:SwitchTimeScalesCaptionBarSubItem IsVisible="False" />
            </dxsch:SchedulerControl.TimeRulerMenuCustomizations>

            <dxsch:SchedulerControl.DefaultMenuCustomizations>
                <dxb:RemoveBarItemAndLinkAction ItemName="{x:Static dxsch:SchedulerMenuItemName.NewAppointment}" />
                <dxb:RemoveBarItemAndLinkAction ItemName="{x:Static dxsch:SchedulerMenuItemName.NewRecurringAppointment}" />
                <dxb:RemoveBarItemAndLinkAction ItemName="{x:Static dxsch:SchedulerMenuItemName.SwitchToWeekView}" />
                <dxb:RemoveBarItemAndLinkAction ItemName="{x:Static dxsch:SchedulerMenuItemName.SwitchTimeScale}" />
                <dxb:RemoveBarItemAndLinkAction ItemName="{x:Static dxsch:SchedulerMenuItemName.SwitchToFullWeekView}" />
                <dxb:RemoveBarItemAndLinkAction ItemName="{x:Static dxsch:SchedulerMenuItemName.NewRecurringAppointment}" />
                <dxb:RemoveBarItemAndLinkAction ItemName="{x:Static dxsch:SchedulerMenuItemName.NewRecurringEvent}" />
                <dxb:RemoveBarItemAndLinkAction ItemName="{x:Static dxsch:SchedulerMenuItemName.GotoThisDay}" />
                <dxb:RemoveBarItemAndLinkAction ItemName="{x:Static dxsch:SchedulerMenuItemName.NewAllDayEvent}" />
                <dxb:RemoveBarItemAndLinkAction ItemName="{x:Static dxsch:SchedulerMenuItemName.GotoDate}" />
                <dxb:RemoveBarItemAndLinkAction ItemName="TimeScaleVisible" />
                <dxb:RemoveBarItemAndLinkAction ItemName="TimeScaleEnable" />

                <dxb:UpdateAction ElementName="{x:Static dxsch:SchedulerMenuItemName.SwitchToWorkWeekView}" PropertyName="IsVisible" Value="{StaticResource False}" />
                <dxb:UpdateAction ElementName="{x:Static dxsch:SchedulerMenuItemName.SwitchTimeScale}" PropertyName="IsVisible" Value="{StaticResource False}" />
            </dxsch:SchedulerControl.DefaultMenuCustomizations>

            <i:Interaction.Triggers>
                <i:EventTrigger EventName="EditAppointmentFormShowing">
                    <behaviors:InvokeDelegateCommandAction Command="{Binding AllowEditScheduleCommand}">
                        <behaviors:InvokeDelegateCommandAction.CommandParameter>
                            <MultiBinding Converter="{UIConverter:ConverterForRefresh}">
                                <Binding ElementName="WOSchedulerControl" />
                                <Binding Path="InvokeParameter" RelativeSource="{RelativeSource Self}" />
                            </MultiBinding>
                        </behaviors:InvokeDelegateCommandAction.CommandParameter>
                    </behaviors:InvokeDelegateCommandAction> <!--CommandParameter="{Binding ElementName=WOSchedulerControl}" />--> 
                </i:EventTrigger>
                <i:EventTrigger EventName="PopupMenuShowing">
                    <behaviors:InvokeDelegateCommandAction Command="{Binding PopupMenuShowingCommand }" CommandParameter="{Binding RelativeSource={RelativeSource Self}, Path=InvokeParameter}" />
                </i:EventTrigger>
            </i:Interaction.Triggers>

            <dxmvvm:Interaction.Behaviors>
                <UIHelper:CustomToolTipImage />
            </dxmvvm:Interaction.Behaviors>

            <!-- 1) Status="Status" using for show is completed image-->
            <!-- 2) Location="Tag" using for show is Activity type image-->
            <dxsch:SchedulerControl.Storage>
                <dxsch:SchedulerStorage>
                    <dxsch:SchedulerStorage.AppointmentStorage>
                        <dxsch:AppointmentStorage DataSource="{Binding AppointmentsMainOtsList, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" 
                                                  Labels="{Binding Labels,UpdateSourceTrigger=PropertyChanged,Mode=TwoWay}">
                            <dxsch:AppointmentStorage.Mappings>
                                <dxsch:AppointmentMapping Start="StartTime"
                                                          End="EndTime"
                                                          Subject="Subject"
                                                          Description="Description"
                                                          Label="Label"
                                                          Status="Status"
                                                          AppointmentId="AppointmentId"
                                                          Type="EventType"
                                                          ResourceId="ResourceId" />
                            </dxsch:AppointmentStorage.Mappings>
                            <dxsch:AppointmentStorage.CustomFieldMappings>
                                <dxsch:SchedulerCustomFieldMapping Name="Picture" Member="Owner" ValueType="Object" />
                                <dxsch:SchedulerCustomFieldMapping Name="IsCritical" Member="IsCritical" ValueType="Boolean" />
                                <dxsch:SchedulerCustomFieldMapping Name="Tag" Member="Tag" ValueType="Object" />
                            </dxsch:AppointmentStorage.CustomFieldMappings>
                        </dxsch:AppointmentStorage>
                    </dxsch:SchedulerStorage.AppointmentStorage>

                    <dxsch:SchedulerStorage.ResourceStorage>
                        <dxsch:ResourceStorage DataSource="{Binding ResourceStorageList, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                            <dxsch:ResourceStorage.Mappings>
                                <dxsch:ResourceMapping Caption="Model" Id="Id" Image="Picture" />
                            </dxsch:ResourceStorage.Mappings>
                        </dxsch:ResourceStorage>
                    </dxsch:SchedulerStorage.ResourceStorage>
                </dxsch:SchedulerStorage>
            </dxsch:SchedulerControl.Storage>
        </dxsch:SchedulerControl>
    </Grid>
</UserControl>
