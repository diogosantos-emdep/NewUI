<UserControl x:Class="Emdep.Geos.Modules.Crm.Views.ActionsView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:Emdep.Geos.Modules.Crm.Views"
             xmlns:dxe="http://schemas.devexpress.com/winfx/2008/xaml/editors"
             xmlns:dxg="http://schemas.devexpress.com/winfx/2008/xaml/grid" 
             xmlns:GeosApplication="clr-namespace:Emdep.Geos.UI.Common;assembly=Emdep.Geos.UI.Common"
             xmlns:dxmvvm="http://schemas.devexpress.com/winfx/2008/xaml/mvvm"
             xmlns:UIHelper="clr-namespace:Emdep.Geos.UI.Helper;assembly=Emdep.Geos.UI.Helper"
             xmlns:dxwui="http://schemas.devexpress.com/winfx/2008/xaml/windowsui"
             xmlns:dxn="http://schemas.devexpress.com/winfx/2008/xaml/navbar"
             xmlns:dxp="http://schemas.devexpress.com/winfx/2008/xaml/printing"
             xmlns:dx="http://schemas.devexpress.com/winfx/2008/xaml/core"
             xmlns:Converters="clr-namespace:Emdep.Geos.UI.Converters;assembly=Emdep.Geos.UI.Converters"
             xmlns:sysglb="clr-namespace:System.Globalization;assembly=mscorlib"
             mc:Ignorable="d" 
             Style="{DynamicResource UserControlStyle}">

    <UserControl.Resources>
        <Converters:ForegroundColorConverter x:Key="ForegroundColorConverter"/>
    </UserControl.Resources>

    <!--MainGrid-->
    <Grid ShowGridLines="False" x:Name="gridActions">
        <Grid.RowDefinitions>
            <RowDefinition Height="50" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>

        <Grid Grid.Row="0" ShowGridLines="False">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition Width="Auto" />
                <!--<ColumnDefinition Width="Auto" />-->
            </Grid.ColumnDefinitions>

            <!--Title-->
            <TextBlock Text="{DynamicResource CrmMainViewModelActions}" Grid.Column="0" Margin="10,0,0,0" Style="{DynamicResource TextBlock30Style}" FontWeight="Bold" />

            <!--Plant Owner-->
            <DockPanel Grid.Column="1"  HorizontalAlignment="Center" VerticalAlignment="Center"  Visibility="{Binding Source={x:Static GeosApplication:GeosApplication.Instance}, Path=CmbPlantOwnerUsers}">
                <Image Style="{DynamicResource PlantOwnerImageStyle}" VerticalAlignment="Center" Width="24" Height="24" Margin="7,0,3,0" />
                <TextBlock Text="{DynamicResource CommonPlantOwner}" VerticalAlignment="Center" FontWeight="Bold" Margin="5,2,5,0" />
            </DockPanel>

            <dxe:ComboBoxEdit Style="{DynamicResource ComboBoxEditStyle}" Grid.Column="2" Width="150" Height="40"
                                  Visibility="{Binding Source={x:Static GeosApplication:GeosApplication.Instance}, Path=CmbPlantOwnerUsers}"
                                  ItemsSource="{Binding Source={x:Static GeosApplication:GeosApplication.Instance}, Path=PlantOwnerUsersList}"
                                  DisplayMember="ShortName" Margin="5,0,5,0" 
                                  EditValue="{Binding Source={x:Static GeosApplication:GeosApplication.Instance}, Path=SelectedPlantOwnerUsersList, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">

                <dxe:ComboBoxEdit.StyleSettings>
                    <dxe:CheckedComboBoxStyleSettings />
                </dxe:ComboBoxEdit.StyleSettings>
                <dxmvvm:Interaction.Triggers>
                    <dxmvvm:EventToCommand EventName="PopupClosed"
                                               Command="{Binding DataContext.PlantOwnerPopupClosedCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                                               PassEventArgsToCommand="True"/>
                </dxmvvm:Interaction.Triggers>
            </dxe:ComboBoxEdit>

            <!--Sales Owner-->
            <DockPanel Grid.Column="1" HorizontalAlignment="Center" VerticalAlignment="Center" Visibility="{Binding Source={x:Static GeosApplication:GeosApplication.Instance}, Path=CmbSalesOwnerUsers}">
                <Image Style="{DynamicResource OwnerGroupImageStyle}" VerticalAlignment="Center" Width="24" Height="24" Margin="7,0,3,0" />
                <TextBlock Text="{DynamicResource CommonSalesOwner}" VerticalAlignment="Center" FontWeight="Bold" Margin="5,2,5,0" />
            </DockPanel>

            <dxe:ComboBoxEdit Style="{DynamicResource ComboBoxEditStyle}" Grid.Column="2" Width="150" Height="40"
                                  DisplayMember="User.FullName" Margin="5,0,5,0"
                                  Visibility="{Binding Source={x:Static GeosApplication:GeosApplication.Instance}, Path=CmbSalesOwnerUsers}"
                                  ItemsSource="{Binding Source={x:Static GeosApplication:GeosApplication.Instance}, Path=SalesOwnerUsersList}"
                                  EditValue="{Binding Source={x:Static GeosApplication:GeosApplication.Instance}, Path=SelectedSalesOwnerUsersList, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">

                <dxe:ComboBoxEdit.StyleSettings>
                    <dxe:CheckedComboBoxStyleSettings />
                </dxe:ComboBoxEdit.StyleSettings>
                <dxmvvm:Interaction.Triggers>
                    <dxmvvm:EventToCommand EventName="PopupClosed"
                                               Command="{Binding DataContext.SalesOwnerPopupClosedCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                                               PassEventArgsToCommand="True"/>
                </dxmvvm:Interaction.Triggers>
            </dxe:ComboBoxEdit>

            <!--Ignored action Closed before-->
            <DockPanel Grid.Column="3"  HorizontalAlignment="Center" VerticalAlignment="Center" >
                <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" Text="{DynamicResource ActionsIgnoreActionsClosedBefore}" Style="{StaticResource TextBlock16Style}" FontWeight="Bold" Margin="0,0,5,0" />
                <TextBlock Text="{Binding DataContext.CloseDate, RelativeSource={RelativeSource AncestorType=UserControl}, StringFormat=d, ConverterCulture={x:Static sysglb:CultureInfo.CurrentCulture}, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}" Style="{StaticResource TextBlock16Style}" VerticalAlignment="Center" />

                <!--Calender Icon-->
                <dxwui:AppBar HideMode="Default" Background="Transparent"
                                  IsSticky="True" HorizontalAlignment="Stretch"
                                  VerticalAlignment="Stretch"
                                  IsOpen="True" IsExitButtonEnabled="False" >

                    <!--Glyph="/Emdep.Geos.Modules.Crm;component/Assets/Images/wCalendar16x16.png"-->

                    <dxwui:AppBarButton ToolTip="{DynamicResource ActionsSelectDate}"
                                        GlyphHeight="24" GlyphWidth="24"
                                        Style="{DynamicResource CalendarImageGlyphStyle}"
                                        GlyphStretch="Fill"
                                        Width="50" IsEllipseEnabled="False" Margin="0 -10 0 0" >
                        <dxwui:AppBarButton.Flyout>
                            <dxwui:MenuFlyout ShowIndicator="True">
                                <dxwui:MenuFlyoutItem>
                                    <Grid Width="Auto" Height="Auto">
                                        <DockPanel>
                                            <StackPanel Orientation="Vertical">
                                                <!--3 months-->
                                                <Button Content="{DynamicResource Actions3Months}" HorizontalAlignment="Center" VerticalAlignment="Center"
                                                            Height="50" Width="100"
                                                            Command="{Binding CommandGetThreeMonthsDate}">
                                                </Button>

                                                <!--6 months-->
                                                <Button Content="{DynamicResource Actions6Months}" HorizontalAlignment="Center" VerticalAlignment="Center" 
                                                            Height="50" Width="100"
                                                            Command="{Binding CommandGetSixMonthsDate}">
                                                </Button>

                                                <!--1 year-->
                                                <Button Content="{DynamicResource Actions1Year}" HorizontalAlignment="Center" VerticalAlignment="Center" 
                                                            Height="50" Width="100"
                                                            Command="{Binding CommandGetOneYearDate}">
                                                </Button>

                                                <!--CustomDate-->
                                                <Button Content="{DynamicResource ActionsCustomDate}" HorizontalAlignment="Center" VerticalAlignment="Center"
                                                            Height="50" Width="100"
                                                            Command="{Binding CommandOpenCalendar}">
                                                </Button>
                                            </StackPanel>

                                            <StackPanel Visibility="{Binding DataContext.IsCalendarVisible, RelativeSource={RelativeSource AncestorType=UserControl}, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}">
                                                <!--Calendar-->
                                                <dxe:DateEditCalendar DateTime="{Binding DataContext.CloseDate, RelativeSource={RelativeSource AncestorType=UserControl}, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay}"
                                                                      VerticalAlignment="Center"
                                                                      ShowToday="True"
                                                                      ShowClearButton="False"/>

                                            </StackPanel>
                                        </DockPanel>

                                    </Grid>
                                </dxwui:MenuFlyoutItem>
                            </dxwui:MenuFlyout>
                        </dxwui:AppBarButton.Flyout>
                    </dxwui:AppBarButton>
                </dxwui:AppBar>
            </DockPanel>

            <!--Add New Action-->
            <Button HorizontalAlignment="Left" Height="40" Width="40" Grid.Column="4" Margin="0,0,5,0"
                    Command="{Binding CommandNewActionsClick}" CommandParameter="{Binding ElementName=ActionsTableView}">
                <Button.ToolTip>
                    <TextBlock Text="{DynamicResource ActionsAddNewActions}"/>
                </Button.ToolTip>
                <Button.ContentTemplate>
                    <DataTemplate>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <Image Style="{DynamicResource AddButtonImageStyle}" Grid.Column="1" Height="24" Width="24" HorizontalAlignment="Right" Margin="-10" />
                        </Grid>
                    </DataTemplate>
                </Button.ContentTemplate>
            </Button>

            <!--Refresh-->
            <Button HorizontalAlignment="Left" Height="40" Width="40" Grid.Column="5" Margin="0,0,5,0"
                    Command="{Binding RefreshActionsViewCommand}" CommandParameter="{Binding ElementName=ActionsTableView}">
                <Button.ToolTip>
                    <TextBlock Text="{DynamicResource ButtonRefresh}"/>
                </Button.ToolTip>
                <Button.ContentTemplate>
                    <DataTemplate>
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>
                            <Image Style="{ DynamicResource RefreshButtonImageStyle}" Grid.Column="0" Height="24" Width="24" Margin="-10"/>
                        </Grid>
                    </DataTemplate>
                </Button.ContentTemplate>
            </Button>

            <!--Print-->
            <Button HorizontalAlignment="Left" Height="40" Width="40" Grid.Column="6" Margin="0,0,5,0"
                    Command="{Binding PrintButtonCommand}" CommandParameter="{Binding ElementName=ActionsTableView}">
                <Button.ToolTip>
                    <TextBlock Text="{DynamicResource ButtonPrint}"/>
                </Button.ToolTip>
                <Button.ContentTemplate>
                    <DataTemplate>
                        <Image Style="{ DynamicResource PrinterButtonImageStyle}" Grid.Column="0" Height="24" Width="24" Margin="-10"/>
                    </DataTemplate>
                </Button.ContentTemplate>
            </Button>

            <!--Export to Excel-->
            <Button HorizontalAlignment="Left" Height="40" Width="40" Grid.Column="7"  Margin="0,0,5,0"
                         Command="{Binding ExportButtonCommand}" CommandParameter="{Binding ElementName=ActionsTableView}">
                <Button.ToolTip>
                    <TextBlock Text="{DynamicResource ButtonExportToExcel}"/>
                </Button.ToolTip>
                <Button.ContentTemplate>
                    <DataTemplate>
                        <Image Style="{ DynamicResource ExcelExportButtonImageStyle}" Grid.Column="0" Height="24" Width="24" Margin="-10"/>
                    </DataTemplate>
                </Button.ContentTemplate>
            </Button>

            <!--Save-->
            <!--<Button HorizontalAlignment="Left" Height="40" Width="40" Grid.Column="8"  Margin="0,0,5,0">
                <Button.ToolTip>
                    <TextBlock Text="{DynamicResource ButtonSave}"/>
                </Button.ToolTip>
                <Button.ContentTemplate>
                    <DataTemplate>
                        <Image Style="{ DynamicResource SaveButtonImageStyle}" Grid.Column="0" Height="24" Width="24" Margin="-10"/>
                    </DataTemplate>
                </Button.ContentTemplate>
            </Button>-->
        </Grid>

        <Grid Grid.Row="1">
            <!--MainGridControl-->
            <dxg:GridControl x:Name="ActionsGridControl" Width="Auto" Height="Auto" SelectionMode="Row"
                             ItemsSource="{Binding ActionPlanItemList,Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}"
                             SelectedItem="{Binding SelectedObject, Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}" ImplyNullLikeEmptyStringWhenFiltering="True" >

                <dxmvvm:Interaction.Behaviors>
                    <UIHelper:BestFitBehavior/>
                    <UIHelper:GridSelectingBehavior />
                </dxmvvm:Interaction.Behaviors>

                <dxg:GridControl.Columns>

                    <!--MinWidth="60" Width="150" MaxWidth="200"-->
                    <dxg:GridColumn FieldName="ActionPlan.Code" Header="{DynamicResource CommonCode}" 
                                    ReadOnly="True" FilterPopupMode="CheckedList" />

                    <!--MinWidth="60" Width="150" MaxWidth="200"-->
                    <dxg:GridColumn FieldName="Status.Value" Header="{DynamicResource CommonStatus}" ReadOnly="True" FilterPopupMode="CheckedList">
                        <dxg:GridColumn.CellStyle>
                            <Style TargetType="{x:Type dxg:LightweightCellEditor}">
                                <Setter Property="Background" Value="{Binding RowData.Row.Status.HtmlColor}"/>
                                <Setter Property="Foreground" Value="{Binding Path=Background,Converter={StaticResource ForegroundColorConverter}}"/>
                            </Style>
                        </dxg:GridColumn.CellStyle>
                    </dxg:GridColumn>

                    <!--MinWidth="60" Width="150" MaxWidth="200"-->
                    <dxg:GridColumn FieldName="Group" MaxWidth="200" Header="{DynamicResource CommonGroupWithoutColon}" ReadOnly="True" FilterPopupMode="CheckedList"/>

                    <!--MinWidth="60" Width="200"-->
                    <dxg:GridColumn FieldName="Plant" MaxWidth="200" Header="{DynamicResource CommonPlanWithoutColon}" ReadOnly="True" FilterPopupMode="CheckedList" />

                    <!--MinWidth="60" Width="200"-->
                    <dxg:GridColumn FieldName="Scope" Header="{DynamicResource CommonScope}" ReadOnly="True" FilterPopupMode="CheckedList" />

                    <!--MinWidth="100" Width="150"-->
                    <dxg:GridColumn FieldName="Title" MaxWidth="200" Header="{DynamicResource CommonSubject}" ReadOnly="True"  FilterPopupMode="CheckedList"/>

                    <!--MinWidth="100" Width="150"-->
                    <dxg:GridColumn FieldName="Reporter" MaxWidth="200" Header="{DynamicResource CommonReporter}" ReadOnly="True" FilterPopupMode="CheckedList" />

                    <!--MinWidth="60" Width="200" MaxWidth="350"-->
                    <dxg:GridColumn FieldName="CreationDate" Header ="{DynamicResource CommonCreationDate}" ReadOnly="True" FilterPopupMode="CheckedList"/>

                    <!--MinWidth="100" Width="150" MaxWidth="200"-->
                    <dxg:GridColumn FieldName="ModificationDate" Header="{DynamicResource CommonReviewDate}" ReadOnly="True" FilterPopupMode="CheckedList" />

                    <!--MinWidth="100" Width="150" MaxWidth="200"-->
                    <dxg:GridColumn FieldName="CurrentDueDate" Header="{DynamicResource CommonDueDate}" ReadOnly="True" FilterPopupMode="CheckedList">
                        <dxg:GridColumn.CellTemplate>
                            <DataTemplate>
                                <Border VerticalAlignment="Stretch" HorizontalAlignment="Stretch">
                                    <TextBlock Text="{Binding RowData.Row.CurrentDueDate,StringFormat=d,ConverterCulture={x:Static sysglb:CultureInfo.CurrentCulture}}"
                                               VerticalAlignment="Center">
                                        <TextBlock.Style>
                                            <Style>
                                                <Style.Triggers>
                                                    <DataTrigger Value="True" Binding="{Binding Data.CurrentDueDate,Converter={Converters:DateCellColorConvertor}}">
                                                        <Setter Property="TextBlock.Foreground" Value="{DynamicResource SleepDaysRedColor}"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                </Border>
                            </DataTemplate>
                        </dxg:GridColumn.CellTemplate>
                    </dxg:GridColumn>

                    <!--MinWidth="100" Width="150" MaxWidth="200"-->
                    <dxg:GridColumn FieldName="Assignee" MaxWidth="200" Header="{DynamicResource CommonResponsible}"  ReadOnly="True" FilterPopupMode="CheckedList" />

                    <!--MinWidth="100" Width="100" MaxWidth="150"-->
                    <dxg:GridColumn FieldName="CloseDate" Header="{DynamicResource CommonCloseDate}" ReadOnly="True" FilterPopupMode="CheckedList" />

                    <dxg:GridColumn Width="40" FieldName=""  AllowSorting="False" MaxWidth="40" FixedWidth="True" Fixed="Right" HorizontalHeaderContentAlignment="Center" AllowColumnFiltering="False" 
                                        ShowInColumnChooser="False" Visible="True" AllowPrinting="False" FilterPopupMode="CheckedList">
                        <dxg:GridColumn.CellTemplate>
                            <DataTemplate>
                                <Button Name="deleteActions" Command="{Binding DataContext.DeleteActionsCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                     CommandParameter="{Binding RowData.Row}" Content="" Width="40" BorderBrush="Transparent" IsEnabled="{Binding Source={x:Static GeosApplication:GeosApplication.Instance}, Path=IsPermissionEnabled}">
                                    <Button.ContentTemplate>
                                        <DataTemplate>
                                            <Image Height="16" Width="16" Source="/Emdep.Geos.Modules.Crm;component/Assets/Images/Delete.png"/>
                                        </DataTemplate>
                                    </Button.ContentTemplate>
                                    <Button.ToolTip>
                                        <TextBlock HorizontalAlignment="Stretch" Text="{DynamicResource CommonDelete}" />
                                    </Button.ToolTip>
                                </Button>
                            </DataTemplate>
                        </dxg:GridColumn.CellTemplate>
                    </dxg:GridColumn>
                </dxg:GridControl.Columns>

                <dxg:GridControl.TotalSummary>
                    <dxg:GridSummaryItem x:Name="summary" FieldName="Name" SummaryType="Count" DisplayFormat="Total Count: {0}" Visible="True"   Alignment="Left"/>
                </dxg:GridControl.TotalSummary>

                <dxg:GridControl.View>
                    <dxg:TableView Name="ActionsTableView" ShowGroupPanel="False" NavigationStyle="Row" RowDetailsVisibilityMode="Visible" ShowHorizontalLines="True" ShowSearchPanelMode="Always"
                                    ShowColumnHeaders="True" 
                                    VerticalScrollbarVisibility="Visible" AllowFixedColumnMenu="False" ColumnChooserColumnDisplayMode="ShowHiddenColumnsOnly"
                                    ShowFixedTotalSummary="True"  SearchPanelHorizontalAlignment="Stretch"
                                    FocusedRow="{Binding SelectedObject, Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}"
                                    AllowGrouping="False" ShowIndicator="False">

                        <dxg:TableView.Resources>
                            <DataTemplate x:Key="ActionsViewCustomPrintHeaderTemplate">
                                <Grid Width="{Binding UsablePageWidth}">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="50" />
                                        <ColumnDefinition Width="130" />
                                    </Grid.ColumnDefinitions>
                                    <dxe:TextEdit Text=" " Width="{Binding UsablePageWidth}" Grid.ColumnSpan="3" IsPrintingMode="True" Background="#333E5E" HorizontalAlignment="Stretch" 
                                                  VerticalAlignment="Stretch" Padding="12" Foreground="#FFFFFFFF" Style="{DynamicResource TextEdit20Style}" FontWeight="Bold" Height="50" />
                                    <dxe:TextEdit Text="Actions Report" IsPrintingMode="True" HorizontalAlignment="Stretch" 
                                                  VerticalAlignment="Stretch" Padding="12" Foreground="#FFFFFFFF" Style="{DynamicResource TextEdit20Style}" FontWeight="Bold" />
                                    <Image Source="/Emdep.Geos.Modules.Crm;component/Assets/Images/GeosReportLogo.png" Height="50" Width="80"  dxp:ExportSettings.TargetType="Image" Grid.Column="2" />
                                </Grid>
                            </DataTemplate>

                            <DataTemplate x:Key="ActionsViewCustomPrintFooterTemplate">
                                <dxe:TextEdit HorizontalContentAlignment="Center" 
                                                  Width="{Binding Path=UsablePageWidth, Mode=OneWay}" 
                                                  dxp:ExportSettings.TargetType="PageNumber" 
                                                  dxp:PageNumberExportSettings.Kind="NumberOfTotal" 
                                                  dxp:PageNumberExportSettings.Format="Page {0} of {1}"/>
                            </DataTemplate>
                        </dxg:TableView.Resources>

                        <dxmvvm:Interaction.Behaviors>
                            <dxmvvm:EventToCommand Command="{Binding DataContext.CommandGridDoubleClick,RelativeSource={RelativeSource AncestorType=dxg:GridControl}}" EventName="MouseDoubleClick" CommandParameter="{Binding ElementName=ActionsTableView}">
                                <dxmvvm:EventToCommand.EventArgsConverter>
                                    <dx:EventArgsToDataRowConverter />
                                </dxmvvm:EventToCommand.EventArgsConverter>
                            </dxmvvm:EventToCommand>
                        </dxmvvm:Interaction.Behaviors>

                    </dxg:TableView>
                </dxg:GridControl.View>

                <!-- Comment Section -->
                <dxg:GridControl.DetailDescriptor>
                    <dxg:DataControlDetailDescriptor x:Name="gridDetailDescriptor" 
                                                         ItemsSourcePath="LogEntriesByActionItems"
                                                         ShowHeader="True">
                        <dxg:DataControlDetailDescriptor.HeaderContentTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="Comments" />

                                    <Button HorizontalAlignment="Left" Margin="10,0,0,0" Height="24" Width="24" 
                                                Command="{Binding AddCommentWindowCommand}"
                                                CommandParameter="{Binding SelectedObject, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                DataContext="{Binding DataContext, RelativeSource={RelativeSource AncestorType=dxg:GridControl}}">
                                        <Button.ToolTip>
                                            <TextBlock Text="{DynamicResource ActionsViewAddComment}"/>
                                        </Button.ToolTip>
                                        <Button.ContentTemplate>
                                            <DataTemplate>
                                                <Image Style="{DynamicResource AddButtonImageStyle}" Grid.Column="0" Height="20" Width="20" HorizontalAlignment="Left" Margin="-10" />
                                            </DataTemplate>
                                        </Button.ContentTemplate>
                                    </Button>
                                </StackPanel>
                            </DataTemplate>
                        </dxg:DataControlDetailDescriptor.HeaderContentTemplate>

                        <dxg:GridControl x:Name="ActionItemCommentsGridControl"
                                             SelectedItem="{Binding SelectedObject, Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}">
                            <dxg:GridControl.Columns>
                                <dxg:GridColumn Header="{DynamicResource CommonUser}" FieldName="Creator" Width="15*" FilterPopupMode="CheckedList"/>
                                <dxg:GridColumn Header="{DynamicResource CommonComment}" FieldName="Comment" Width="70*" FilterPopupMode="CheckedList">
                                    <dxg:GridColumn.CellTemplate>
                                        <DataTemplate>
                                            <UIHelper:BindableRichTextBox x:Name="BindableRichTextBox_Editor1" HorizontalScrollBarVisibility="Auto" 
                                                                              Document="{Binding Row.Comment, Converter={Converters:RtfToFlowDocumentConverter}}" 
                                                                              IsReadOnly="True" Grid.Column="1" Grid.Row="0" ScrollViewer.VerticalScrollBarVisibility="Auto"
                                                                              Style="{DynamicResource RichTextBoxStyle}">
                                            </UIHelper:BindableRichTextBox>
                                        </DataTemplate>
                                    </dxg:GridColumn.CellTemplate>
                                </dxg:GridColumn>
                                <dxg:GridColumn Header="{DynamicResource CommonDate}" FieldName="CreationDate" Width="15*" FilterPopupMode="CheckedList"/>
                                <dxg:GridColumn Header=" " Width="40" FixedWidth="True" FilterPopupMode="CheckedList">
                                    <dxg:GridColumn.CellTemplate>
                                        <DataTemplate>
                                            <Button ToolTip="Delete" Command="{Binding DataContext.DeleteCommentWindowCommand,RelativeSource={RelativeSource AncestorType=UserControl}}" 
                                                                                    CommandParameter="{Binding RowData.Row}" IsEnabled="{Binding Source={x:Static GeosApplication:GeosApplication.Instance}, Path=IsPermissionEnabled}">
                                                <Button.ContentTemplate>
                                                    <DataTemplate>
                                                        <Image Height="16" Width="16"
                                                                       Source="/Emdep.Geos.Modules.Crm;component/Assets/Images/Delete.png" />
                                                    </DataTemplate>
                                                </Button.ContentTemplate>
                                            </Button>
                                        </DataTemplate>
                                    </dxg:GridColumn.CellTemplate>
                                </dxg:GridColumn>
                            </dxg:GridControl.Columns>

                            <dxg:GridControl.View>
                                <dxg:TableView x:Name="detailView"
                                                   FocusedRow="{Binding SelectedObject, Mode=TwoWay,UpdateSourceTrigger=PropertyChanged}"
                                                   VerticalScrollbarVisibility="Auto" 
                                                   NavigationStyle="Row"
                                                   AutoWidth="True"
                                                   ShowGroupPanel="False" 
                                                   AllowEditing="False">
                                    <dxmvvm:Interaction.Behaviors>
                                        <!--Command="{Binding EditCommentWindowCommand}"-->
                                        <dxmvvm:EventToCommand Command="{Binding DataContext.EditCommentWindowCommand,RelativeSource={RelativeSource AncestorType=UserControl}}" 
                                                                   EventName="MouseDoubleClick" 
                                                                   CommandParameter="{Binding ElementName=detailView}">
                                            <dxmvvm:EventToCommand.EventArgsConverter>
                                                <dx:EventArgsToDataRowConverter />
                                            </dxmvvm:EventToCommand.EventArgsConverter>
                                        </dxmvvm:EventToCommand>
                                        <!--<dxmvvm:EventToCommand Command="{Binding DataContext.EditCommentWindowCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                                                                   EventName="MouseDoubleClick" 
                                                                   CommandParameter="{Binding ElementName=ActionItemCommentsGridControl}">
                                                <dxmvvm:EventToCommand.EventArgsConverter>
                                                    <dx:EventArgsToDataRowConverter />
                                                </dxmvvm:EventToCommand.EventArgsConverter>
                                            </dxmvvm:EventToCommand>-->
                                    </dxmvvm:Interaction.Behaviors>
                                </dxg:TableView>
                            </dxg:GridControl.View>

                            <!--Serial Numbers Detail Descriptor-->
                            <!--<dxg:GridControl.DetailDescriptor>
                                    <dxg:DataControlDetailDescriptor x:Name="SN_GridDetailDescriptor"
                                                                     ItemsSourcePath="SerialCodes"
                                                                     ShowHeader="false">
                                        <dxg:GridControl Name="SN_detailGrid">
                                            <dxg:GridControl.Columns>
                                                <dxg:GridColumn Header="Serial Numbers">
                                                    <dxg:GridColumn.DisplayMemberBinding>
                                                        <Binding Path="RowData.Row" RelativeSource="{RelativeSource Self}"/>
                                                    </dxg:GridColumn.DisplayMemberBinding>
                                                </dxg:GridColumn>
                                            </dxg:GridControl.Columns>
                                            <dxg:GridControl.View>
                                                <dxg:TableView x:Name="SN_detailView"
                                                               VerticalScrollbarVisibility="Auto" 
                                                               NavigationStyle="Row"
                                                               AutoWidth="True"
                                                               ShowGroupPanel="False" 
                                                               AllowEditing="False"/>
                                            </dxg:GridControl.View>
                                        </dxg:GridControl>
                                    </dxg:DataControlDetailDescriptor>
                                </dxg:GridControl.DetailDescriptor>-->

                        </dxg:GridControl>
                    </dxg:DataControlDetailDescriptor>
                </dxg:GridControl.DetailDescriptor>
                <!-- End Comment Section -->


            </dxg:GridControl>
        </Grid>


    </Grid>
</UserControl>
