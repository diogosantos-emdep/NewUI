using Emdep.Geos.Data.BusinessLogic.Logging;
using Emdep.Geos.Data.Common;
using Emdep.Geos.Data.Common.Epc;
using Emdep.Geos.Data.Common.PCM;
using Emdep.Geos.Data.Common.SRM;
using Emdep.Geos.Data.DataAccess;
using Emdep.Geos.Utility;
using MySql.Data.MySqlClient;
using Prism.Logging;
using ServiceStack;
using System;
using System.Collections.Generic;
using System.Collections.ObjectModel;
using System.Configuration;
using System.Data;
using System.Globalization;
using System.IO;
using System.Linq;
using System.Net;
using System.Text;
using System.Transactions;

namespace Emdep.Geos.Data.BusinessLogic
{
    public class SRMManager
    {

        public SRMManager()
        {
            try
            {
                if (Log4NetLogger.Logger == null)
                {
                    string ApplicationLogFilePath = System.Web.Hosting.HostingEnvironment.MapPath("/") + "log4net.config";
                    FileInfo file = new FileInfo(ApplicationLogFilePath);
                    Log4NetLogger.Logger = LoggerFactory.CreateLogger(LogType.Log4Net, file);
                }
            }
            catch
            {
                throw;
            }
        }

        #region Insert methods
        /// <summary>
        /// This method is used to insert Comments Or Log Entries By PO
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="LogEntriesByWarehousePOList">Get Log entry or comment list details.</param>
        public void AddCommentsOrLogEntriesByPO(string MainServerConnectionString, List<LogEntriesByWarehousePO> LogEntriesByWarehousePOList)
        {
            try
            {
                if (LogEntriesByWarehousePOList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (LogEntriesByWarehousePO logEntriesByWarehousePO in LogEntriesByWarehousePOList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("SRM_log_entries_by_warehouse_purchase_order_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", logEntriesByWarehousePO.IdWarehousePurchaseOrder);
                            mySqlCommand.Parameters.AddWithValue("_IdUser", logEntriesByWarehousePO.IdUser);
                            mySqlCommand.Parameters.AddWithValue("_Datetime", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                            mySqlCommand.Parameters.AddWithValue("_Comments", logEntriesByWarehousePO.Comments);
                            mySqlCommand.Parameters.AddWithValue("_IdLogEntryType", logEntriesByWarehousePO.IdLogEntryType);
                            mySqlCommand.Parameters.AddWithValue("_IsRtfText", logEntriesByWarehousePO.IsRtfText);

                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddCommentsOrLogEntriesByPO(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        #endregion

        #region Update methods
        /// <summary>
        /// This method is used to Update Workflow Status In PO
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="IdWarehousePurchaseOrder">Get IdWarehousePurchaseOrder.</param>
        /// <param name="IdWorkflowStatus">Get IdWorkflowStatus.</param>
        /// <param name="LogEntriesByWarehousePOList">Get Log entry or comment list details.</param>
        public bool UpdateWorkflowStatusInPO(string MainServerConnectionString, uint IdWarehousePurchaseOrder, UInt32 IdWorkflowStatus, int IdUser, List<LogEntriesByWarehousePO> LogEntriesByWarehousePOList)
        {
            bool status;
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        MySqlCommand mySqlCommand = new MySqlCommand("SRM_warehousepurchaseorders_UpdateWorkflowStatus", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", IdWarehousePurchaseOrder);
                        mySqlCommand.Parameters.AddWithValue("_IdWorkflowStatus", IdWorkflowStatus);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdUser);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                        status = true;
                    }
                    AddCommentsOrLogEntriesByPO(MainServerConnectionString, LogEntriesByWarehousePOList);
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateWorkflowStatusInPO(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return status;
        }


        /// <summary>
        /// Get Article Suppliers By Warehouse
        /// </summary>
        /// <param name="warehouse">The warehouse for connection string</param>
        /// <returns>List of Article Suppliers By Warehouse</returns>
        public List<ArticleSupplier> GetArticleSuppliersByWarehouse(Warehouses warehouse)
        {
            string connectionString = warehouse.Company.ConnectPlantConstr;
            List<ArticleSupplier> articleSuppliers = new List<ArticleSupplier>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetArticleSuppliersByWarehouse", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdWarehouse", warehouse.IdWarehouse);

                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    while (mySqlDataReader.Read())
                    {
                        try
                        {
                            ArticleSupplier articleSupplier = new ArticleSupplier();

                            articleSupplier.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                            if (mySqlDataReader["name"] != DBNull.Value)
                                articleSupplier.Name = Convert.ToString(mySqlDataReader["name"]);

                            if (mySqlDataReader["IdCountry"] != DBNull.Value)
                            {
                                articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["IdCountry"]);

                                articleSupplier.Country = new Country();
                                articleSupplier.Country.IdCountry = Convert.ToByte(mySqlDataReader["IdCountry"]);
                                articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);
                            }
                            if (mySqlDataReader["Cif"] != DBNull.Value)
                                articleSupplier.Cif = Convert.ToString(mySqlDataReader["Cif"]);

                            if (mySqlDataReader["City"] != DBNull.Value)
                                articleSupplier.City = Convert.ToString(mySqlDataReader["City"]);

                            if (mySqlDataReader["PostCode"] != DBNull.Value)
                                articleSupplier.PostCode = Convert.ToString(mySqlDataReader["PostCode"]);

                            if (mySqlDataReader["Address"] != DBNull.Value)
                                articleSupplier.Address = Convert.ToString(mySqlDataReader["Address"]);

                            if (mySqlDataReader["Email"] != DBNull.Value)
                                articleSupplier.Email = Convert.ToString(mySqlDataReader["Email"]);

                            if (mySqlDataReader["Web"] != DBNull.Value)
                                articleSupplier.Web = Convert.ToString(mySqlDataReader["Web"]);

                            if (mySqlDataReader["Phone1"] != DBNull.Value)
                                articleSupplier.Phone1 = Convert.ToString(mySqlDataReader["Phone1"]);

                            if (mySqlDataReader["Phone2"] != DBNull.Value)
                                articleSupplier.Phone2 = Convert.ToString(mySqlDataReader["Phone2"]);

                            if (mySqlDataReader["serie"] != DBNull.Value)
                                articleSupplier.Serie = Convert.ToChar(mySqlDataReader["serie"]);

                            if (mySqlDataReader["CreatedIn"] != DBNull.Value)
                                articleSupplier.CreatedIn = Convert.ToDateTime(mySqlDataReader["CreatedIn"].ToString());

                            articleSuppliers.Add(articleSupplier);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetArticleSuppliersByWarehouse(). ErrorMessage-" + ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            Log4NetLogger.Logger.Log("Executed GetArticleSuppliersByWarehouse().", category: Category.Info, priority: Priority.Low);
            return articleSuppliers;
        }



        /// <summary>
        /// This method is used to Delete Article Supplier
        /// </summary>
        /// <param name="MainServerConnectionString">The main server connection string.</param>
        /// <param name="idArticleSupplier">Get idArticleSupplier.</param>
        public bool DeleteArticleSupplier(string MainServerConnectionString, Int64 idArticleSupplier, int IdUser)
        {
            bool status;
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("SRM_ArticleSupplier_Delete", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdArticleSupplier", idArticleSupplier);
                    mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdUser);
                    mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                    mySqlCommand.ExecuteNonQuery();
                    mySqlConnection.Close();
                    status = true;
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error DeleteArticleSupplier(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return status;
        }

        public ArticleSupplier GetArticleSupplierByIdArticleSupplier(Warehouses warehouse, UInt64 IdArticleSupplier)
        {
            string connectionString = warehouse.Company.ConnectPlantConstr;
            ArticleSupplier articleSupplier = null;

            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetArticleSupplierByIdArticleSupplier", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdArticleSupplier", IdArticleSupplier);

                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    if (mySqlDataReader.Read())
                    {
                        try
                        {
                            articleSupplier = new ArticleSupplier();

                            articleSupplier.IdArticleSupplier = Convert.ToInt64(IdArticleSupplier);

                            articleSupplier.Code = "SUPL" + articleSupplier.IdArticleSupplier.ToString().PadLeft(6, '0');

                            if (mySqlDataReader["name"] != DBNull.Value)
                                articleSupplier.Name = Convert.ToString(mySqlDataReader["name"]);

                            if (mySqlDataReader["Cif"] != DBNull.Value)
                                articleSupplier.Cif = Convert.ToString(mySqlDataReader["Cif"]);

                            if (mySqlDataReader["serie"] != DBNull.Value)
                                articleSupplier.Serie = Convert.ToChar(mySqlDataReader["serie"]);

                            if (mySqlDataReader["Observations"] != DBNull.Value)
                                articleSupplier.Observations = Convert.ToString(mySqlDataReader["Observations"]);

                            if (mySqlDataReader["lastOrder"] != DBNull.Value)
                                articleSupplier.LastOrderDate = Convert.ToDateTime(mySqlDataReader["lastOrder"].ToString());

                            if (mySqlDataReader["Phone1"] != DBNull.Value)
                                articleSupplier.Phone1 = Convert.ToString(mySqlDataReader["Phone1"]);

                            if (mySqlDataReader["Phone2"] != DBNull.Value)
                                articleSupplier.Phone2 = Convert.ToString(mySqlDataReader["Phone2"]);

                            if (mySqlDataReader["Email"] != DBNull.Value)
                                articleSupplier.Email = Convert.ToString(mySqlDataReader["Email"]);

                            if (mySqlDataReader["fax"] != DBNull.Value)
                                articleSupplier.Fax = Convert.ToString(mySqlDataReader["fax"]);

                            if (mySqlDataReader["Web"] != DBNull.Value)
                                articleSupplier.Web = Convert.ToString(mySqlDataReader["Web"]);

                            if (mySqlDataReader["Address"] != DBNull.Value)
                                articleSupplier.Address = Convert.ToString(mySqlDataReader["Address"]);

                            if (mySqlDataReader["City"] != DBNull.Value)
                                articleSupplier.City = Convert.ToString(mySqlDataReader["City"]);

                            if (mySqlDataReader["PostCode"] != DBNull.Value)
                                articleSupplier.PostCode = Convert.ToString(mySqlDataReader["PostCode"]);

                            if (mySqlDataReader["idcountry"] != DBNull.Value)
                            {
                                articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["idcountry"]);

                                articleSupplier.Country = new Country();
                                articleSupplier.Country.IdCountry = Convert.ToByte(mySqlDataReader["idcountry"]);
                                articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);
                            }

                            if (mySqlDataReader["modifiedIn"] != DBNull.Value)
                                articleSupplier.ModifiedIn = Convert.ToDateTime(mySqlDataReader["modifiedIn"].ToString());

                            if (mySqlDataReader["createdIn"] != DBNull.Value)
                                articleSupplier.CreatedIn = Convert.ToDateTime(mySqlDataReader["createdIn"].ToString());

                            if (mySqlDataReader["State"] != DBNull.Value)
                                articleSupplier.Region = Convert.ToString(mySqlDataReader["State"]);

                            if (mySqlDataReader["Latitude"] != DBNull.Value)
                            {
                                articleSupplier.Latitude = Convert.ToDouble(mySqlDataReader["Latitude"]);
                                articleSupplier.Coordinates = articleSupplier.Latitude.ToString();
                            }

                            if (mySqlDataReader["Longitude"] != DBNull.Value)
                            {
                                articleSupplier.Longitude = Convert.ToDouble(mySqlDataReader["Longitude"]);
                                if (mySqlDataReader["Latitude"] != DBNull.Value)
                                {
                                    articleSupplier.Coordinates = articleSupplier.Latitude.ToString() + ", " + articleSupplier.Longitude.ToString();
                                }
                                else
                                {
                                    articleSupplier.Coordinates = articleSupplier.Longitude.ToString();
                                }
                            }
                            articleSupplier.ArticleList = GetArticlesByIdArticleSupplier(connectionString, IdArticleSupplier);
                            articleSupplier.DocumentList = GetDocumentsByIdArticleSupplier(connectionString, IdArticleSupplier);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetArticleSupplierByIdArticleSupplier(IdArticleSupplier-{0}), ErrorMessage- {1} ", IdArticleSupplier, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            Log4NetLogger.Logger.Log("Executed GetArticleSupplierByIdArticleSupplier().", category: Category.Info, priority: Priority.Low);
            return articleSupplier;
        }

        public List<ArticleBySupplier> GetArticlesByIdArticleSupplier(string connectionString, UInt64 IdArticleSupplier)
        {
            List<ArticleBySupplier> articleBySupplierList = new List<ArticleBySupplier>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetArticlesByIdArticleSupplier", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdArticleSupplier", IdArticleSupplier);

                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    while (mySqlDataReader.Read())
                    {
                        try
                        {
                            ArticleBySupplier articleBySupplier = new ArticleBySupplier();

                            articleBySupplier.IdArticleSupplier = Convert.ToInt64(IdArticleSupplier);
                            articleBySupplier.IdArticle = Convert.ToInt64(mySqlDataReader["idArticle"]);

                            if (mySqlDataReader["Reference"] != DBNull.Value)
                                articleBySupplier.Reference = Convert.ToString(mySqlDataReader["Reference"]);

                            if (mySqlDataReader["BasePrice"] != DBNull.Value)
                                articleBySupplier.BasePrice = Convert.ToDouble(mySqlDataReader["BasePrice"]);

                            if (mySqlDataReader["Description"] != DBNull.Value)
                                articleBySupplier.Description = Convert.ToString(mySqlDataReader["Description"]);

                            if (mySqlDataReader["IdCurrency"] != DBNull.Value)
                            {
                                articleBySupplier.IdCurrency = Convert.ToByte(mySqlDataReader["IdCurrency"]);
                                articleBySupplier.Currency = new Currency();
                                articleBySupplier.Currency.IdCurrency = Convert.ToByte(mySqlDataReader["IdCurrency"]);
                                if (mySqlDataReader["Name"] != DBNull.Value)
                                    articleBySupplier.Currency.Name = Convert.ToString(mySqlDataReader["Name"]);
                            }
                            articleBySupplierList.Add(articleBySupplier);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetArticlesByIdArticleSupplier(IdArticleSupplier-{0}), ErrorMessage- {1} ", IdArticleSupplier, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            Log4NetLogger.Logger.Log("Executed GetArticlesByIdArticleSupplier().", category: Category.Info, priority: Priority.Low);
            return articleBySupplierList;
        }

        public List<ArticleSuppliersDoc> GetDocumentsByIdArticleSupplier(string connectionString, UInt64 IdArticleSupplier)
        {
            List<ArticleSuppliersDoc> articleSuppliersDocList = new List<ArticleSuppliersDoc>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetDocumentsByIdArticleSupplier", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdArticleSupplier", IdArticleSupplier);

                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    while (mySqlDataReader.Read())
                    {
                        try
                        {
                            ArticleSuppliersDoc articleSuppliersDoc = new ArticleSuppliersDoc();

                            articleSuppliersDoc.IdArticleSupplier = IdArticleSupplier;
                            articleSuppliersDoc.IdSupplierDoc = Convert.ToUInt64(mySqlDataReader["IdSupplierDoc"]);

                            if (mySqlDataReader["OriginalFileName"] != DBNull.Value)
                                articleSuppliersDoc.OriginalFileName = Convert.ToString(mySqlDataReader["OriginalFileName"]);

                            if (mySqlDataReader["SavedFileName"] != DBNull.Value)
                                articleSuppliersDoc.SavedFileName = Convert.ToString(mySqlDataReader["SavedFileName"]);

                            if (mySqlDataReader["Description"] != DBNull.Value)
                                articleSuppliersDoc.Description = Convert.ToString(mySqlDataReader["Description"]);

                            if (mySqlDataReader["IdDocType"] != DBNull.Value)
                                articleSuppliersDoc.IdDocType = Convert.ToUInt64(mySqlDataReader["IdDocType"]);

                            if (mySqlDataReader["ExpirationDate"] != DBNull.Value)
                                articleSuppliersDoc.ExpirationDate = Convert.ToDateTime(mySqlDataReader["ExpirationDate"].ToString());

                            articleSuppliersDocList.Add(articleSuppliersDoc);

                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetDocumentsByIdArticleSupplier(IdArticleSupplier-{0}), ErrorMessage- {1} ", IdArticleSupplier, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            Log4NetLogger.Logger.Log("Executed GetDocumentsByIdArticleSupplier().", category: Category.Info, priority: Priority.Low);
            return articleSuppliersDocList;
        }


        public bool SendSupplierPurchaseOrderRequestMail(WarehousePurchaseOrder warehousePurchaseOrder, string MailServerName, string MailServerPort, string emailTemplatePath, string POAttachmentPath, string EmailFrom)
        {
            try
            {
                Log4NetLogger.Logger.Log(string.Format("[INFO] SendSupplierPurchaseOrderRequestMail......"), category: Category.Info, priority: Priority.Low);
                bool isSend = false;
                if (warehousePurchaseOrder != null && warehousePurchaseOrder.ArticleSupplier != null)
                {
                    string HTMLFileName = null;
                    if (File.Exists(string.Format("{0}{1}SupplierPurchaseOrderRequestMailFormat_{2}-{3}.html", emailTemplatePath, @"\", warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower(), warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToUpper())))
                    {
                        HTMLFileName = string.Format("SupplierPurchaseOrderRequestMailFormat_{0}-{1}.html", warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower(), warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToUpper());
                    }
                    else if (File.Exists(string.Format("{0}{1}SupplierPurchaseOrderRequestMailFormat.html", emailTemplatePath, @"\")))
                    {
                        HTMLFileName = "SupplierPurchaseOrderRequestMailFormat.html";
                    }
                    if (HTMLFileName != null)
                    {
                        StringBuilder emailbody = new StringBuilder();

                        try
                        {
                            string text = ReadMailTemplate(HTMLFileName, emailTemplatePath);

                            text = text.Replace("[Supplier_Name]", warehousePurchaseOrder.ArticleSupplier.ContactPerson);

                            text = text.Replace("[PO_Code]", warehousePurchaseOrder.Code);

                            emailbody.Append(text);

                            string Subject = "PO " + warehousePurchaseOrder.Code;
                            string POFileName = warehousePurchaseOrder.Code + ".pdf";

                            POAttachmentPath = POAttachmentPath + @"\" + warehousePurchaseOrder.CreatedIn.Year + @"\" + warehousePurchaseOrder.Code + @"\01 Purchase Order\PO_" + warehousePurchaseOrder.Code + ".pdf";
                            if (File.Exists(POAttachmentPath))
                            {
                                List<string> ccAddress = new List<string>();
                                MailControl.SendHtmlMailWithAttachment(Subject, emailbody.ToString(), warehousePurchaseOrder.ArticleSupplier.ContactEmail, ccAddress, EmailFrom, MailServerName, MailServerPort, null, POFileName, POAttachmentPath);
                                //  MailControl.SendHtmlMailWithAttachment(Subject, emailbody.ToString(), "adhatkar@emdep.com", ccAddress, "adhatkar@emdep.com", MailServerName, MailServerPort, null, POFileName, POAttachmentPath);
                                isSend = true;
                                Log4NetLogger.Logger.Log(string.Format("[INFO] Supplier email sent to - {0} email - {1}", warehousePurchaseOrder.ArticleSupplier.Name, warehousePurchaseOrder.ArticleSupplier.ContactEmail), category: Category.Info, priority: Priority.Low);
                            }
                        }
                        catch (System.Net.Mail.SmtpFailedRecipientException ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("[ERROR] SendSupplierPurchaseOrderRequestMail() in MailControl.SendHtmlMail-SmtpFailedRecipient - {0} - {1}", ex.FailedRecipient, ex.Message), category: Category.Exception, priority: Priority.Low);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("[ERROR] SendSupplierPurchaseOrderRequestMail() in MailControl.SendHtmlMail - {0} - {1}", warehousePurchaseOrder.ArticleSupplier.Name, ex.Message), category: Category.Exception, priority: Priority.Low);
                        }
                    }
                }
                return isSend;
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error SendSupplierPurchaseOrderRequestMail(). ErrorMessage-" + ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public string ReadMailTemplate(string templateName, string EmailTemplatePath)
        {
            string Text = "";
            try
            {
                Text = System.IO.File.ReadAllText(string.Format(@"{0}\{1}", EmailTemplatePath, templateName));
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error ReadMailTemplate(). ErrorMessage-" + ex.Message), category: Category.Exception, priority: Priority.Low);
            }
            return Text;
        }





        #endregion

        #region GET methods

        /// <summary>
        /// Pending Purchase Orders by warehouse 
        /// </summary>
        /// <param name="warehouse">The warehouse for connection string</param>
        /// <returns>List of pending warehouse purchase order details</returns>
        public List<WarehousePurchaseOrder> GetPendingPurchaseOrdersByWarehouse(Warehouses warehouse)
        {
            string connectionString = warehouse.Company.ConnectPlantConstr;
            List<WarehousePurchaseOrder> warehousePurchaseOrders = new List<WarehousePurchaseOrder>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetPendingPurchaseOrdersByWarehouse", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdWarehouse", warehouse.IdWarehouse);

                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    double totalQuantity = 0;
                    double receivedQuantity = 0;

                    while (mySqlDataReader.Read())
                    {
                        try
                        {
                            totalQuantity = 0;
                            receivedQuantity = 0;

                            WarehousePurchaseOrder warehousePurchaseOrder = new WarehousePurchaseOrder();

                            warehousePurchaseOrder.IdWarehousePurchaseOrder = Convert.ToInt64(mySqlDataReader["idWarehousepurchaseorder"]);

                            if (mySqlDataReader["Code"] != DBNull.Value)
                                warehousePurchaseOrder.Code = Convert.ToString(mySqlDataReader["Code"]);

                            if (mySqlDataReader["IdArticleSupplier"] != DBNull.Value)
                            {
                                ArticleSupplier articleSupplier = new ArticleSupplier();

                                articleSupplier.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                                if (mySqlDataReader["Supplier"] != DBNull.Value)
                                    articleSupplier.Name = Convert.ToString(mySqlDataReader["Supplier"]);

                                if (mySqlDataReader["IdCountry"] != DBNull.Value)
                                {
                                    articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["IdCountry"]);

                                    articleSupplier.Country = new Country();
                                    articleSupplier.Country.IdCountry = Convert.ToByte(mySqlDataReader["IdCountry"]);
                                    articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);
                                }

                                warehousePurchaseOrder.ArticleSupplier = articleSupplier;
                            }

                            if (mySqlDataReader["DeliveryDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["deliveryDate"]) != DateTime.MinValue)
                            {
                                warehousePurchaseOrder.DeliveryDate = Convert.ToDateTime(mySqlDataReader["deliveryDate"]);
                                warehousePurchaseOrder.Delay = (int)(warehousePurchaseOrder.DeliveryDate.Value.Date - DateTime.Now.Date).TotalDays;
                            }

                            if (mySqlDataReader["AttachedPO"] != DBNull.Value)
                                warehousePurchaseOrder.AttachedPO = Convert.ToByte(mySqlDataReader["AttachedPO"]);

                            if (mySqlDataReader["Deliveries"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.Deliveries = Convert.ToInt32(mySqlDataReader["Deliveries"]);

                                if (warehousePurchaseOrder.Deliveries > 0)
                                {
                                    warehousePurchaseOrder.IsPartialPending = true;
                                }
                            }

                            if (mySqlDataReader["LatestDeliveryDate"] != DBNull.Value)
                                warehousePurchaseOrder.LatestDeliveryDate = Convert.ToDateTime(mySqlDataReader["LatestDeliveryDate"]);

                            if (mySqlDataReader["IdWarehouse"] != DBNull.Value)
                                warehousePurchaseOrder.IdWarehouse = Convert.ToInt64(mySqlDataReader["IdWarehouse"]);

                            if (mySqlDataReader["OrderQty"] != DBNull.Value)
                                totalQuantity = Convert.ToDouble(mySqlDataReader["OrderQty"]);

                            if (mySqlDataReader["ReceivedQuantity"] != DBNull.Value)
                                receivedQuantity = Convert.ToDouble(mySqlDataReader["ReceivedQuantity"]);

                            if (totalQuantity > 0)
                                warehousePurchaseOrder.Status = (Int16)((receivedQuantity / totalQuantity) * 100);

                            if (mySqlDataReader["TotalAmount"] != DBNull.Value)
                                warehousePurchaseOrder.TotalAmount = Convert.ToDecimal(mySqlDataReader["TotalAmount"]);

                            if (mySqlDataReader["CreatedIn"] != DBNull.Value)
                                warehousePurchaseOrder.CreatedIn = Convert.ToDateTime(mySqlDataReader["CreatedIn"]);

                            if (mySqlDataReader["AttachPdf"] != DBNull.Value)
                                warehousePurchaseOrder.AttachPdf = Convert.ToString(mySqlDataReader["AttachPdf"]);

                            if (mySqlDataReader["idCurrency"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.IdCurrency = Convert.ToByte(mySqlDataReader["idCurrency"]);
                                warehousePurchaseOrder.Currency = new Currency();
                                warehousePurchaseOrder.Currency.IdCurrency = Convert.ToByte(mySqlDataReader["idCurrency"]);
                                warehousePurchaseOrder.Currency.Name = Convert.ToString(mySqlDataReader["CurrencyName"]);
                                warehousePurchaseOrder.Currency.Symbol = Convert.ToString(mySqlDataReader["CurrencySymbol"]);
                            }

                            if (mySqlDataReader["IdWorkflowStatus"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                warehousePurchaseOrder.WorkflowStatus = new WorkflowStatus();
                                warehousePurchaseOrder.WorkflowStatus.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                warehousePurchaseOrder.WorkflowStatus.Name = Convert.ToString(mySqlDataReader["Status"]);
                                warehousePurchaseOrder.WorkflowStatus.HtmlColor = Convert.ToString(mySqlDataReader["HtmlColor"]);
                            }

                            warehousePurchaseOrders.Add(warehousePurchaseOrder);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetPendingPurchaseOrdersByWarehouse(). ErrorMessage-" + ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            Log4NetLogger.Logger.Log("Executed GetPendingPurchaseOrdersByWarehouse().", category: Category.Info, priority: Priority.Low);
            return warehousePurchaseOrders;
        }


        /// <summary>
        /// This method is used to get PO pdf.
        /// </summary>
        /// <param name="PurchaseOrderPath">Get Path.</param>
        /// <param name="AttachPDF">Get File Name.</param>
        public byte[] GetPurchaseOrderPdf(string PurchaseOrderPath, string AttachPDF)
        {
            byte[] bytes = null;
            string fileUploadPath = string.Format(@"{0}\{1}", PurchaseOrderPath, AttachPDF);

            try
            {
                if (File.Exists(fileUploadPath))
                {
                    using (System.IO.FileStream stream = new System.IO.FileStream(fileUploadPath, System.IO.FileMode.Open, System.IO.FileAccess.Read))
                    {
                        bytes = new byte[stream.Length];
                        int numBytesToRead = (int)stream.Length;
                        int numBytesRead = 0;

                        while (numBytesToRead > 0)
                        {
                            // Read may return anything from 0 to numBytesToRead.
                            int n = stream.Read(bytes, numBytesRead, numBytesToRead);

                            // Break when the end of the file is reached.
                            if (n == 0)
                                break;

                            numBytesRead += n;
                            numBytesToRead -= n;
                        }
                    }
                }

                return bytes;
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetProductTypeAttachedDoc(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        /// <summary>
        /// Get Pending PO By IdWarehousePurchaseOrder
        /// </summary>
        /// <param name="connectionString">The connection string. (crm-context)</param>
        /// <param name="idWarehousePurchaseOrder">The idwarehousepurchseorder.</param>
        /// <returns>Get Pending PO By IdWarehousePurchaseOrder</returns>
        public WarehousePurchaseOrder GetPendingPOByIdWarehousePurchaseOrder(string connectionString, Int64 idWarehousePurchaseOrder, string purchaseOrdersPath, string emailTemplatePath)
        {
            WarehousePurchaseOrder warehousePurchaseOrder = null;

            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetPendingPOByIdWarehousePurchaseOrder", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", idWarehousePurchaseOrder);

                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    if (mySqlDataReader.Read())
                    {
                        try
                        {
                            warehousePurchaseOrder = new WarehousePurchaseOrder();

                            warehousePurchaseOrder.IdWarehousePurchaseOrder = idWarehousePurchaseOrder;

                            if (mySqlDataReader["Code"] != DBNull.Value)
                                warehousePurchaseOrder.Code = Convert.ToString(mySqlDataReader["Code"]);

                            if (mySqlDataReader["IdArticleSupplier"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                                ArticleSupplier articleSupplier = new ArticleSupplier();
                                articleSupplier.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                                if (mySqlDataReader["Supplier"] != DBNull.Value)
                                    articleSupplier.Name = Convert.ToString(mySqlDataReader["Supplier"]);

                                if (mySqlDataReader["SupplierContactPerson"] != DBNull.Value)
                                    articleSupplier.ContactPerson = Convert.ToString(mySqlDataReader["SupplierContactPerson"]);

                                if (mySqlDataReader["SupplierContactEmail"] != DBNull.Value)
                                    articleSupplier.ContactEmail = Convert.ToString(mySqlDataReader["SupplierContactEmail"]);

                                if (mySqlDataReader["Serie"] != DBNull.Value)
                                    articleSupplier.Serie = Convert.ToChar(mySqlDataReader["Serie"]);

                                if (mySqlDataReader["IdCountry"] != DBNull.Value)
                                {
                                    articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["IdCountry"]);

                                    articleSupplier.Country = new Country();
                                    articleSupplier.Country.IdCountry = (byte)articleSupplier.IdCountry;
                                    articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);

                                    if (mySqlDataReader["SupplierCountryISO"] != DBNull.Value)
                                        articleSupplier.Country.Iso = Convert.ToString(mySqlDataReader["SupplierCountryISO"]);

                                    if (mySqlDataReader["IdCountryGroup"] != DBNull.Value)
                                        articleSupplier.Country.IdCountryGroup = Convert.ToInt64(mySqlDataReader["IdCountryGroup"]);
                                }

                                if (mySqlDataReader["IdArticleSupplierType"] != DBNull.Value)
                                {
                                    articleSupplier.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["IdArticleSupplierType"]);

                                    articleSupplier.ArticleSupplierType = new ArticleSupplierType();
                                    articleSupplier.ArticleSupplierType.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["IdArticleSupplierType"]);
                                    articleSupplier.ArticleSupplierType.Name = Convert.ToString(mySqlDataReader["ArticleSupplierType"]);
                                    articleSupplier.ArticleSupplierType.HtmlColor = Convert.ToString(mySqlDataReader["HtmlColor"]);
                                }

                                warehousePurchaseOrder.ArticleSupplier = articleSupplier;
                            }

                            if (mySqlDataReader["DeliveryDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["deliveryDate"]) != DateTime.MinValue)
                            {
                                warehousePurchaseOrder.DeliveryDate = Convert.ToDateTime(mySqlDataReader["deliveryDate"]);
                            }

                            if (mySqlDataReader["AttachedPO"] != DBNull.Value)
                                warehousePurchaseOrder.AttachedPO = Convert.ToByte(mySqlDataReader["AttachedPO"]);

                            if (mySqlDataReader["IdPaymentType"] != DBNull.Value)
                                warehousePurchaseOrder.IdPaymentType = Convert.ToInt64(mySqlDataReader["IdPaymentType"]);

                            if (mySqlDataReader["ReminderEmailDate"] != DBNull.Value)
                                warehousePurchaseOrder.ReminderEmailDate = Convert.ToDateTime(mySqlDataReader["ReminderEmailDate"]);

                            if (mySqlDataReader["CreatedIn"] != DBNull.Value)
                                warehousePurchaseOrder.CreatedIn = Convert.ToDateTime(mySqlDataReader["CreatedIn"]);

                            if (mySqlDataReader["ModifiedIn"] != DBNull.Value)
                                warehousePurchaseOrder.ModifiedIn = Convert.ToDateTime(mySqlDataReader["ModifiedIn"]);

                            if (mySqlDataReader["Comments"] != DBNull.Value)
                                warehousePurchaseOrder.Comments = Convert.ToString(mySqlDataReader["Comments"]);

                            if (mySqlDataReader["IsClosed"] != DBNull.Value)
                                warehousePurchaseOrder.IsClosed = Convert.ToByte(mySqlDataReader["IsClosed"]);

                            if (mySqlDataReader["CreatedBy"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.CreatedBy = Convert.ToInt64(mySqlDataReader["CreatedBy"]);
                                warehousePurchaseOrder.Creator = new People();
                                warehousePurchaseOrder.Creator.IdPerson = Convert.ToInt32(mySqlDataReader["CreatedBy"].ToString());
                                warehousePurchaseOrder.Creator.Name = mySqlDataReader["CreatorName"].ToString();
                                warehousePurchaseOrder.Creator.Surname = mySqlDataReader["CreatorSurname"].ToString();
                            }

                            if (mySqlDataReader["ModifiedBy"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.ModifiedBy = Convert.ToInt64(mySqlDataReader["ModifiedBy"]);
                                warehousePurchaseOrder.Modifier = new People();
                                warehousePurchaseOrder.Modifier.IdPerson = Convert.ToInt32(mySqlDataReader["ModifiedBy"].ToString());
                                warehousePurchaseOrder.Modifier.Name = mySqlDataReader["ModifierName"].ToString();
                                warehousePurchaseOrder.Modifier.Surname = mySqlDataReader["ModifierSurname"].ToString();
                            }

                            if (mySqlDataReader["ReasonClosed"] != DBNull.Value)
                                warehousePurchaseOrder.ReasonClosed = Convert.ToString(mySqlDataReader["ReasonClosed"]);

                            if (mySqlDataReader["IdWarehouse"] != DBNull.Value)
                                warehousePurchaseOrder.IdWarehouse = Convert.ToInt64(mySqlDataReader["IdWarehouse"]);

                            if (mySqlDataReader["IdCurrency"] != DBNull.Value)
                                warehousePurchaseOrder.IdCurrency = Convert.ToByte(mySqlDataReader["IdCurrency"]);

                            if (mySqlDataReader["IdWorkflowStatus"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                warehousePurchaseOrder.WorkflowStatus = new WorkflowStatus();
                                warehousePurchaseOrder.WorkflowStatus.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                warehousePurchaseOrder.WorkflowStatus.Name = Convert.ToString(mySqlDataReader["Status"]);
                                warehousePurchaseOrder.WorkflowStatus.HtmlColor = Convert.ToString(mySqlDataReader["StatusHtmlColor"]);
                            }
                            string HTMLFileName = null;
                            if (File.Exists(string.Format("{0}{1}SupplierPurchaseOrderRequestMailFormat_{2}-{3}.html", emailTemplatePath, @"\", warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower(), warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToUpper())))
                            {
                                HTMLFileName = string.Format("SupplierPurchaseOrderRequestMailFormat_{0}-{1}.html", warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower(), warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToUpper());
                            }
                            else if (File.Exists(string.Format("{0}{1}SupplierPurchaseOrderRequestMailFormat.html", emailTemplatePath, @"\")))
                            {
                                HTMLFileName = "SupplierPurchaseOrderRequestMailFormat.html";
                            }
                            if (HTMLFileName != null)
                            {
                                StringBuilder emailbody = new StringBuilder();

                                string text = ReadMailTemplate(HTMLFileName, emailTemplatePath);

                                text = text.Replace("[Supplier_Name]", warehousePurchaseOrder.ArticleSupplier.ContactPerson);

                                text = text.Replace("[PO_Code]", warehousePurchaseOrder.Code);

                                emailbody.Append(text);

                                warehousePurchaseOrder.EmailBody = emailbody.ToString();
                            }
                            warehousePurchaseOrder.AttachPdf = warehousePurchaseOrder.CreatedIn.Year + @"\" + warehousePurchaseOrder.Code + @"\01 Purchase Order\PO_" + warehousePurchaseOrder.Code + ".pdf";

                            warehousePurchaseOrder.AttachmentBytes = GetPurchaseOrderPdf(purchaseOrdersPath, warehousePurchaseOrder.AttachPdf);
                            warehousePurchaseOrder.WarehouseDeliveryNotes = GetDeliveryNotesByIdWarehousePurchaseOrder(connectionString, warehousePurchaseOrder, purchaseOrdersPath);

                            warehousePurchaseOrder.WarehousePurchaseOrderItems = GetArticlesByIdWarehousePurchaseOrder(connectionString, warehousePurchaseOrder.IdWarehousePurchaseOrder);

                            warehousePurchaseOrder.WarehousePOComments = GetlogEntriesByWarehousePO(idWarehousePurchaseOrder, 252, connectionString);
                            warehousePurchaseOrder.WarehousePOLogEntries = GetlogEntriesByWarehousePO(idWarehousePurchaseOrder, 253, connectionString);


                            //[pramod.misal][GEOS2-4951][05-07-2023]
                            // warehousePurchaseOrder.WarehouseShippingAddress = GetlogEntriesByWarehousePO(idWarehousePurchaseOrder, 253, connectionString);

                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetPendingPOByIdWarehousePurchaseOrder(idWarehousePurchaseOrder-{0}), ErrorMessage- {1} ", idWarehousePurchaseOrder, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            Log4NetLogger.Logger.Log("Executed GetPendingPOByIdWarehousePurchaseOrder().", category: Category.Info, priority: Priority.Low);
            return warehousePurchaseOrder;
        }


        /// <summary>
        /// Get delivery notes by IdWarehousePurchaseOrder.
        /// </summary>
        /// <param name="connectionString">The connection string.</param>
        /// <param name="idWarehousePurchaseOrder"></param>
        /// <returns>The idwarehousepurchseorder.</returns>
        public List<WarehouseDeliveryNote> GetDeliveryNotesByIdWarehousePurchaseOrder(string connectionString, WarehousePurchaseOrder warehousePurchaseOrder, string purchaseOrdersPath)
        {
            List<WarehouseDeliveryNote> warehouseDeliveryNotes = new List<WarehouseDeliveryNote>();

            using (MySqlConnection connActivities = new MySqlConnection(connectionString))
            {
                connActivities.Open();

                MySqlCommand activitiesCommand = new MySqlCommand("warehouse_GetDeliveryNotesByIdWarehousePurchaseOrder", connActivities);
                activitiesCommand.CommandType = CommandType.StoredProcedure;
                activitiesCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", warehousePurchaseOrder.IdWarehousePurchaseOrder);

                using (MySqlDataReader poReader = activitiesCommand.ExecuteReader())
                {
                    while (poReader.Read())
                    {
                        try
                        {
                            WarehouseDeliveryNote warehouseDeliveryNote = new WarehouseDeliveryNote();

                            warehouseDeliveryNote.IdWarehousePurchaseOrder = warehousePurchaseOrder.IdWarehousePurchaseOrder;

                            if (poReader["Idwarehousedeliverynote"] != DBNull.Value)
                                warehouseDeliveryNote.IdWarehouseDeliveryNote = Convert.ToInt64(poReader["Idwarehousedeliverynote"]);

                            if (poReader["Attacheddeliverynotes"] != DBNull.Value)
                                warehouseDeliveryNote.AttachedDeliveryNotes = Convert.ToByte(poReader["Attacheddeliverynotes"]);

                            if (poReader["IdCurrencyImportExpenses"] != DBNull.Value)
                                warehouseDeliveryNote.IdCurrencyImportExpenses = Convert.ToInt64(poReader["IdCurrencyImportExpenses"]);

                            if (poReader["ImportExpenses"] != DBNull.Value)
                                warehouseDeliveryNote.ImportExpenses = Convert.ToDouble(poReader["ImportExpenses"]);

                            if (poReader["Code"] != DBNull.Value)
                                warehouseDeliveryNote.Code = Convert.ToString(poReader["Code"]);

                            if (poReader["DeliveryDate"] != DBNull.Value)
                                warehouseDeliveryNote.DeliveryDate = Convert.ToDateTime(poReader["DeliveryDate"]);

                            if (poReader["CreatedIn"] != DBNull.Value)
                                warehouseDeliveryNote.CreatedIn = Convert.ToDateTime(poReader["CreatedIn"]);

                            if (poReader["ModifiedIn"] != DBNull.Value)
                                warehouseDeliveryNote.ModifiedIn = Convert.ToDateTime(poReader["ModifiedIn"]);

                            if (poReader["SupplierCode"] != DBNull.Value)
                                warehouseDeliveryNote.SupplierCode = Convert.ToString(poReader["SupplierCode"]);

                            if (poReader["Idcurrency"] != DBNull.Value)
                                warehouseDeliveryNote.IdCurrency = Convert.ToByte(poReader["Idcurrency"]);

                            //if (poReader["LocalIdCurrency"] != DBNull.Value)
                            //    warehouseDeliveryNote.LocalIdCurrency = Convert.ToByte(poReader["LocalIdCurrency"]);

                            if (poReader["ExchangeRate"] != DBNull.Value)
                                warehouseDeliveryNote.ExchangeRate = Convert.ToByte(poReader["ExchangeRate"]);

                            if (poReader["ZF01"] != DBNull.Value)
                                warehouseDeliveryNote.ZF01 = Convert.ToString(poReader["ZF01"]);

                            if (poReader["CurrentlyAccessedBy"] != DBNull.Value)
                                warehouseDeliveryNote.CurrentlyAccessedBy = Convert.ToInt32(poReader["CurrentlyAccessedBy"]);

                            warehouseDeliveryNote.PdfFilePath = purchaseOrdersPath + @"\" + warehousePurchaseOrder.CreatedIn.Year + @"\" + warehousePurchaseOrder.Code + @"\02 Delivery Notes\DN_" + warehouseDeliveryNote.Code + ".pdf"; ;

                            warehouseDeliveryNotes.Add(warehouseDeliveryNote);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Executed GetDeliveryNotesByIdWarehousePurchaseOrder(idWarehousePurchaseOrder-{0}). ErrorMessage- {1}", warehousePurchaseOrder.IdWarehousePurchaseOrder, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            Log4NetLogger.Logger.Log("Executed GetDeliveryNotesByIdWarehousePurchaseOrder().", category: Category.Info, priority: Priority.Low);
            return warehouseDeliveryNotes;
        }


        /// <summary>
        /// Get articles by IdWarehousePurchaseOrder
        /// </summary>
        /// <param name="connectionString">The connection string.</param>
        /// <param name="idWarehousePurchaseOrder">The idwarehousepurchseorder.</param>
        /// <returns>The List WarehousePurchaseOrderItems</returns>
        public List<WarehousePurchaseOrderItem> GetArticlesByIdWarehousePurchaseOrder(string connectionString, Int64 idWarehousePurchaseOrder)
        {
            List<WarehousePurchaseOrderItem> warehousePurchaseOrderItems = new List<WarehousePurchaseOrderItem>();

            using (MySqlConnection connWarehousePurchaseOrderItem = new MySqlConnection(connectionString))
            {
                connWarehousePurchaseOrderItem.Open();

                MySqlCommand activitiesCommand = new MySqlCommand("SRM_GetArticlesAndPOItemsByIdWarehousePurchaseOrder", connWarehousePurchaseOrderItem);
                activitiesCommand.CommandType = CommandType.StoredProcedure;
                activitiesCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", idWarehousePurchaseOrder);

                using (MySqlDataReader poReader = activitiesCommand.ExecuteReader())
                {
                    while (poReader.Read())
                    {
                        try
                        {
                            WarehousePurchaseOrderItem warehousePurchaseOrderItem = new WarehousePurchaseOrderItem();

                            warehousePurchaseOrderItem.IdWarehousePurchaseOrder = idWarehousePurchaseOrder;

                            if (poReader["IdWarehousePurchaseOrderItem"] != DBNull.Value)
                                warehousePurchaseOrderItem.IdWarehousePurchaseOrderItem = Convert.ToInt64(poReader["IdWarehousePurchaseOrderItem"]);

                            if (poReader["Description"] != DBNull.Value)
                                warehousePurchaseOrderItem.Description = Convert.ToString(poReader["Description"]);

                            if (poReader["IdArticle"] != DBNull.Value)
                            {
                                warehousePurchaseOrderItem.IdArticle = Convert.ToInt32(poReader["IdArticle"]);

                                Article article = new Article();

                                if (poReader["Reference"] != DBNull.Value)
                                    article.Reference = Convert.ToString(poReader["Reference"]);

                                if (poReader["IsGeneric"] != DBNull.Value)
                                    article.IsGeneric = Convert.ToSByte(poReader["IsGeneric"]);

                                if (poReader["IdArticleCategory"] != DBNull.Value)
                                    article.IdArticleCategory = Convert.ToInt32(poReader["IdArticleCategory"]);

                                warehousePurchaseOrderItem.Article = article;
                            }

                            if (poReader["Quantity"] != DBNull.Value)
                                warehousePurchaseOrderItem.Quantity = Convert.ToInt32(poReader["Quantity"]);

                            if (poReader["UnitPrice"] != DBNull.Value)
                                warehousePurchaseOrderItem.UnitPrice = Convert.ToDouble(poReader["UnitPrice"]);

                            if (poReader["Discount"] != DBNull.Value)
                                warehousePurchaseOrderItem.Discount = Convert.ToDouble(poReader["Discount"]);

                            if (poReader["Iva"] != DBNull.Value)
                                warehousePurchaseOrderItem.IVA = Convert.ToDouble(poReader["Iva"]);

                            if (poReader["AdditionalComments"] != DBNull.Value)
                                warehousePurchaseOrderItem.AdditionalComments = Convert.ToString(poReader["AdditionalComments"]);

                            if (poReader["Position"] != DBNull.Value)
                                warehousePurchaseOrderItem.Position = Convert.ToInt64(poReader["Position"]);

                            if (poReader["AlbaranQty"] != DBNull.Value)
                                warehousePurchaseOrderItem.ReceivedQuantity = Convert.ToInt32(poReader["AlbaranQty"]);


                            if (poReader["TotalAmount"] != DBNull.Value)
                                warehousePurchaseOrderItem.TotalAmount = Convert.ToDecimal(poReader["TotalAmount"]);

                            if (warehousePurchaseOrderItem.Quantity > 0)
                            {

                                warehousePurchaseOrderItem.Status = (Int32)(warehousePurchaseOrderItem.ReceivedQuantity / warehousePurchaseOrderItem.Quantity * 100);
                            }

                            warehousePurchaseOrderItem.WarehousePurchaseOrderExpectedItems = GetWarehousePOExpectedItems(connectionString, warehousePurchaseOrderItem.IdWarehousePurchaseOrderItem);

                            if (warehousePurchaseOrderItem.WarehousePurchaseOrderExpectedItems.Count > 0)
                            {
                                warehousePurchaseOrderItem.ExpectedDate = warehousePurchaseOrderItem.WarehousePurchaseOrderExpectedItems.First().Date;
                            }

                            warehousePurchaseOrderItem.ReceivedDeliveryNotes = GetDeliveryNotesByIdWarehousePurchaseOrderItem(connectionString, warehousePurchaseOrderItem.IdWarehousePurchaseOrderItem);
                            warehousePurchaseOrderItems.Add(warehousePurchaseOrderItem);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetArticlesByIdWarehousePurchaseOrder(idWarehousePurchaseOrder-{0}). ErrorMessage- {1}", idWarehousePurchaseOrder, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            Log4NetLogger.Logger.Log("Executed GetArticlesByIdWarehousePurchaseOrder().", category: Category.Info, priority: Priority.Low);
            return warehousePurchaseOrderItems;
        }


        /// <summary>
        /// [WMS-M028-08] Changes in PO details section - Show POExpectedItems dates in grid.
        /// </summary>
        /// <param name="connectionString">The Connection string to PO - warehouse</param>
        /// <param name="idWarehousePurchaseOrderItem">The IdWarehousePurchaseOrderItem</param>
        /// <returns>List of warehouse purchase order expected item details</returns>
        public List<WarehousePurchaseOrderExpectedItem> GetWarehousePOExpectedItems(string connectionString, Int64 idWarehousePurchaseOrderItem)
        {
            List<WarehousePurchaseOrderExpectedItem> warehousePurchaseOrderExpectedItems = new List<WarehousePurchaseOrderExpectedItem>();

            using (MySqlConnection connWarehousePurchaseOrderItem = new MySqlConnection(connectionString))
            {
                connWarehousePurchaseOrderItem.Open();

                MySqlCommand activitiesCommand = new MySqlCommand("warehouse_GetWarehousePOExpectedItems", connWarehousePurchaseOrderItem);
                activitiesCommand.CommandType = CommandType.StoredProcedure;
                activitiesCommand.Parameters.AddWithValue("_idWarehousePurchaseOrderItem", idWarehousePurchaseOrderItem);

                using (MySqlDataReader poReader = activitiesCommand.ExecuteReader())
                {
                    while (poReader.Read())
                    {
                        try
                        {
                            WarehousePurchaseOrderExpectedItem warehousePurchaseOrderExpectedItem = new WarehousePurchaseOrderExpectedItem();

                            if (poReader["idWarehousePurchaseOrderItem"] != DBNull.Value)
                                warehousePurchaseOrderExpectedItem.IdWarehousePurchaseOrderItem = Convert.ToInt64(poReader["idWarehousePurchaseOrderItem"]);

                            if (poReader["Quantity"] != DBNull.Value)
                                warehousePurchaseOrderExpectedItem.Quantity = Convert.ToInt64(poReader["Quantity"]);

                            if (poReader["Date"] != DBNull.Value)
                                warehousePurchaseOrderExpectedItem.Date = Convert.ToDateTime(poReader["Date"]);

                            warehousePurchaseOrderExpectedItems.Add(warehousePurchaseOrderExpectedItem);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetWarehousePOExpectedItems(idWarehousePurchaseOrder-{0}). ErrorMessage- {1}", idWarehousePurchaseOrderItem, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            Log4NetLogger.Logger.Log("Executed GetWarehousePOExpectedItems().", category: Category.Info, priority: Priority.Low);
            return warehousePurchaseOrderExpectedItems;
        }


        /// <summary>
        /// [WMS-M028-08] Changes in PO details section - Show delivery notes to perticuler PO item.
        /// </summary>
        /// <param name="connectionString">The Connection string to PO - warehouse</param>
        /// <param name="IdWarehousePurchaseOrderItem">The IdWarehousePurchaseOrderItem</param>
        /// <returns>List of warehouse delivery note details</returns>
        public List<WarehouseDeliveryNote> GetDeliveryNotesByIdWarehousePurchaseOrderItem(string connectionString, Int64 IdWarehousePurchaseOrderItem)
        {
            List<WarehouseDeliveryNote> warehouseDeliveryNotes = new List<WarehouseDeliveryNote>();

            using (MySqlConnection connActivities = new MySqlConnection(connectionString))
            {
                connActivities.Open();

                MySqlCommand activitiesCommand = new MySqlCommand("warehouse_GetDeliveryNotesByIdWarehousePOItem", connActivities);
                activitiesCommand.CommandType = CommandType.StoredProcedure;
                activitiesCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrderItem", IdWarehousePurchaseOrderItem);

                using (MySqlDataReader poReader = activitiesCommand.ExecuteReader())
                {
                    while (poReader.Read())
                    {
                        try
                        {
                            WarehouseDeliveryNote warehouseDeliveryNote = new WarehouseDeliveryNote();

                            if (poReader["IdWarehousePurchaseOrder"] != DBNull.Value)
                                warehouseDeliveryNote.IdWarehousePurchaseOrder = Convert.ToInt64(poReader["IdWarehousePurchaseOrder"]);

                            if (poReader["IdWarehouseDeliveryNote"] != DBNull.Value)
                                warehouseDeliveryNote.IdWarehouseDeliveryNote = Convert.ToInt64(poReader["IdWarehouseDeliveryNote"]);

                            if (poReader["Code"] != DBNull.Value)
                                warehouseDeliveryNote.Code = Convert.ToString(poReader["Code"]);

                            if (poReader["DeliveryDate"] != DBNull.Value)
                                warehouseDeliveryNote.DeliveryDate = Convert.ToDateTime(poReader["DeliveryDate"]);

                            if (poReader["SupplierCode"] != DBNull.Value)
                                warehouseDeliveryNote.SupplierCode = Convert.ToString(poReader["SupplierCode"]);

                            if (poReader["Quantity"] != DBNull.Value)
                                warehouseDeliveryNote.Quantity = Convert.ToInt64(poReader["Quantity"]);

                            warehouseDeliveryNotes.Add(warehouseDeliveryNote);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Executed GetDeliveryNotesByIdWarehousePurchaseOrderItem(idWarehousePurchaseOrder-{0}). ErrorMessage- {1}", IdWarehousePurchaseOrderItem, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            Log4NetLogger.Logger.Log("Executed GetDeliveryNotesByIdWarehousePurchaseOrderItem().", category: Category.Info, priority: Priority.Low);
            return warehouseDeliveryNotes;
        }

        /// <summary>
        /// This method is used to get log entries by warehouse PO.
        /// </summary>
        /// <param name="idWarehousePurchaseOrder">Get warehouse PO id.</param>
        /// <param name="idLogEntryType">Get log entry type.</param>
        /// <param name="connectionString">connection string.</param>
        public List<LogEntriesByWarehousePO> GetlogEntriesByWarehousePO(Int64 idWarehousePurchaseOrder, byte idLogEntryType, string connectionString)
        {
            List<LogEntriesByWarehousePO> logEntriesByWarehousePOList = new List<LogEntriesByWarehousePO>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetLogEntriesByWarehousePurchaseOrder", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", idWarehousePurchaseOrder);
                    mySqlCommand.Parameters.AddWithValue("_IdLogEntryType", idLogEntryType);

                    using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                    {
                        while (mySqlDataReader.Read())
                        {
                            LogEntriesByWarehousePO logEntriesByWarehousePO = new LogEntriesByWarehousePO();

                            logEntriesByWarehousePO.IdLogEntryByPurchaseOrder = Convert.ToInt64(mySqlDataReader["IdLogEntryByPurchaseOrder"]);

                            if (mySqlDataReader["IdUser"] != DBNull.Value)
                                logEntriesByWarehousePO.IdUser = Convert.ToInt32(mySqlDataReader["IdUser"].ToString());

                            if (mySqlDataReader["IdWarehousePurchaseOrder"] != DBNull.Value)
                                logEntriesByWarehousePO.IdWarehousePurchaseOrder = Convert.ToInt64(mySqlDataReader["IdWarehousePurchaseOrder"].ToString());

                            if (mySqlDataReader["IdPerson"] != DBNull.Value)
                            {
                                logEntriesByWarehousePO.People = new People();
                                logEntriesByWarehousePO.People.IdPerson = Convert.ToInt32(mySqlDataReader["IdPerson"].ToString());
                                logEntriesByWarehousePO.People.Name = mySqlDataReader["Name"].ToString();
                                logEntriesByWarehousePO.People.Surname = mySqlDataReader["Surname"].ToString();
                            }

                            if (mySqlDataReader["Datetime"] != DBNull.Value)
                                logEntriesByWarehousePO.Datetime = Convert.ToDateTime(mySqlDataReader["Datetime"].ToString());

                            if (mySqlDataReader["Comments"] != DBNull.Value)
                                logEntriesByWarehousePO.Comments = mySqlDataReader["Comments"].ToString();

                            if (mySqlDataReader["IdLogEntryType"] != DBNull.Value)
                                logEntriesByWarehousePO.IdLogEntryType = Convert.ToByte(mySqlDataReader["IdLogEntryType"]);

                            if (mySqlDataReader["IsRtfText"] != DBNull.Value)
                                logEntriesByWarehousePO.IsRtfText = Convert.ToBoolean(mySqlDataReader["IsRtfText"]);

                            logEntriesByWarehousePOList.Add(logEntriesByWarehousePO);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetlogEntriesByWarehousePO(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return logEntriesByWarehousePOList;
        }

        /// <summary>
        /// This method is used to get All workflow status.
        /// </summary>
        /// <param name="connectionString">connection string.</param>
        public List<WorkflowStatus> GetAllWorkflowStatus(string connectionString)
        {

            List<WorkflowStatus> workflowStatusList = new List<WorkflowStatus>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetAllWorkflowStatus", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                    {
                        while (mySqlDataReader.Read())
                        {
                            WorkflowStatus workflowStatus = new WorkflowStatus();

                            workflowStatus.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);

                            if (mySqlDataReader["IdWorkflow"] != DBNull.Value)
                                workflowStatus.IdWorkflow = Convert.ToUInt32(mySqlDataReader["IdWorkflow"].ToString());

                            if (mySqlDataReader["Name"] != DBNull.Value)
                                workflowStatus.Name = mySqlDataReader["Name"].ToString();

                            if (mySqlDataReader["HtmlColor"] != DBNull.Value)
                                workflowStatus.HtmlColor = mySqlDataReader["HtmlColor"].ToString();

                            if (mySqlDataReader["IdWorkflowScope"] != DBNull.Value)
                                workflowStatus.IdWorkflowScope = Convert.ToUInt32(mySqlDataReader["IdWorkflowScope"].ToString());

                            workflowStatusList.Add(workflowStatus);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllWorkflowStatus(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return workflowStatusList;
        }

        /// <summary>
        /// This method is used to get All workflow status.
        /// </summary>
        /// <param name="connectionString">connection string.</param>
        public List<WorkflowTransition> GetAllWorkflowTransitions(string connectionString)
        {

            List<WorkflowTransition> workflowTransitionList = new List<WorkflowTransition>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("SRM_Get_workflow_transitions", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                    {
                        while (mySqlDataReader.Read())
                        {
                            WorkflowTransition workflowTransition = new WorkflowTransition();

                            workflowTransition.IdWorkflowTransition = Convert.ToUInt32(mySqlDataReader["IdWorkflowTransition"]);

                            if (mySqlDataReader["IdWorkflow"] != DBNull.Value)
                                workflowTransition.IdWorkflow = Convert.ToUInt32(mySqlDataReader["IdWorkflow"]);

                            if (mySqlDataReader["Name"] != DBNull.Value)
                                workflowTransition.Name = mySqlDataReader["Name"].ToString();

                            if (mySqlDataReader["IdWorkflowStatusFrom"] != DBNull.Value)
                                workflowTransition.IdWorkflowStatusFrom = Convert.ToByte(mySqlDataReader["IdWorkflowStatusFrom"]);

                            if (mySqlDataReader["IdWorkflowStatusTo"] != DBNull.Value)
                                workflowTransition.IdWorkflowStatusTo = Convert.ToByte(mySqlDataReader["IdWorkflowStatusTo"]);

                            if (mySqlDataReader["IsCommentRequired"] != DBNull.Value)
                                workflowTransition.IsCommentRequired = Convert.ToByte(mySqlDataReader["IsCommentRequired"]);

                            if (mySqlDataReader["IdWorkflowScope"] != DBNull.Value)
                                workflowTransition.IdWorkflowScope = Convert.ToUInt32(mySqlDataReader["IdWorkflowScope"]);

                            workflowTransitionList.Add(workflowTransition);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllWorkflowTransitions(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return workflowTransitionList;
        }



        #endregion

        #region V2110
        public List<WarehousePurchaseOrder> GetPendingPurchaseOrdersByWarehouse_V2110(Warehouses warehouse, string countryIconFilePath)
        {
            string connectionString = warehouse.Company.ConnectPlantConstr;
            List<WarehousePurchaseOrder> warehousePurchaseOrders = new List<WarehousePurchaseOrder>();
            List<string> countryISOs = new List<string>();
            List<long> orderid = new List<long>();
            Dictionary<string, List<long>> SupplierEmailId = new Dictionary<string, List<long>>();
            List<string> Suppliername = new List<string>();
            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();
                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetPendingPurchaseOrdersByWarehouse_V2110", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdWarehouse", warehouse.IdWarehouse);
                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    double totalQuantity = 0;
                    double receivedQuantity = 0;
                    while (mySqlDataReader.Read())
                    {
                        try
                        {
                            totalQuantity = 0;
                            receivedQuantity = 0;
                            WarehousePurchaseOrder warehousePurchaseOrder = new WarehousePurchaseOrder();

                            warehousePurchaseOrder.IdWarehousePurchaseOrder = Convert.ToInt64(mySqlDataReader["idWarehousepurchaseorder"]);
                            if (mySqlDataReader["Code"] != DBNull.Value)
                                warehousePurchaseOrder.Code = Convert.ToString(mySqlDataReader["Code"]);
                            if (mySqlDataReader["IdArticleSupplier"] != DBNull.Value)
                            {
                                ArticleSupplier articleSupplier = new ArticleSupplier();
                                articleSupplier.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);
                                if (mySqlDataReader["Supplier"] != DBNull.Value)
                                    articleSupplier.Name = Convert.ToString(mySqlDataReader["Supplier"]);
                                if (mySqlDataReader["IdCountry"] != DBNull.Value)
                                {
                                    articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["IdCountry"]);
                                    articleSupplier.Country = new Country();
                                    articleSupplier.Country.IdCountry = Convert.ToByte(mySqlDataReader["IdCountry"]);
                                    articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);
                                    if (mySqlDataReader["CountryISO"] != DBNull.Value)
                                    {
                                        articleSupplier.Country.Iso = Convert.ToString(mySqlDataReader["CountryISO"]);
                                        if (!countryISOs.Any(co => co.ToString() == articleSupplier.Country.Iso))
                                        {
                                            countryISOs.Add(articleSupplier.Country.Iso);
                                        }
                                    }
                                }
                                if (mySqlDataReader["SupplierContactPerson"] != DBNull.Value)
                                    articleSupplier.ContactPerson = Convert.ToString(mySqlDataReader["SupplierContactPerson"]);
                                if (mySqlDataReader["SupplierContactEmail"] != DBNull.Value)
                                    articleSupplier.ContactEmail = Convert.ToString(mySqlDataReader["SupplierContactEmail"]);
                                warehousePurchaseOrder.ArticleSupplier = articleSupplier;
                            }
                            if (mySqlDataReader["DeliveryDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["deliveryDate"]) != DateTime.MinValue)
                            {
                                warehousePurchaseOrder.DeliveryDate = Convert.ToDateTime(mySqlDataReader["deliveryDate"]);
                                warehousePurchaseOrder.Delay = (int)(warehousePurchaseOrder.DeliveryDate.Value.Date - DateTime.Now.Date).TotalDays;
                            }
                            if (mySqlDataReader["AttachedPO"] != DBNull.Value)
                                warehousePurchaseOrder.AttachedPO = Convert.ToByte(mySqlDataReader["AttachedPO"]);
                            if (mySqlDataReader["Deliveries"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.Deliveries = Convert.ToInt32(mySqlDataReader["Deliveries"]);
                                if (warehousePurchaseOrder.Deliveries > 0)
                                {
                                    warehousePurchaseOrder.IsPartialPending = true;
                                }
                            }
                            if (mySqlDataReader["LatestDeliveryDate"] != DBNull.Value)
                                warehousePurchaseOrder.LatestDeliveryDate = Convert.ToDateTime(mySqlDataReader["LatestDeliveryDate"]);
                            if (mySqlDataReader["IdWarehouse"] != DBNull.Value)
                                warehousePurchaseOrder.IdWarehouse = Convert.ToInt64(mySqlDataReader["IdWarehouse"]);
                            if (mySqlDataReader["OrderQty"] != DBNull.Value)
                                totalQuantity = Convert.ToDouble(mySqlDataReader["OrderQty"]);
                            if (mySqlDataReader["ReceivedQuantity"] != DBNull.Value)
                                receivedQuantity = Convert.ToDouble(mySqlDataReader["ReceivedQuantity"]);
                            if (totalQuantity > 0)
                                warehousePurchaseOrder.Status = (Int16)((receivedQuantity / totalQuantity) * 100);
                            if (mySqlDataReader["TotalAmount"] != DBNull.Value)
                                warehousePurchaseOrder.TotalAmount = Convert.ToDecimal(mySqlDataReader["TotalAmount"]);
                            if (mySqlDataReader["CreatedIn"] != DBNull.Value)
                                warehousePurchaseOrder.CreatedIn = Convert.ToDateTime(mySqlDataReader["CreatedIn"]);
                            if (mySqlDataReader["AttachPdf"] != DBNull.Value)
                                warehousePurchaseOrder.AttachPdf = Convert.ToString(mySqlDataReader["AttachPdf"]);
                            if (mySqlDataReader["idCurrency"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.IdCurrency = Convert.ToByte(mySqlDataReader["idCurrency"]);
                                warehousePurchaseOrder.Currency = new Currency();
                                warehousePurchaseOrder.Currency.IdCurrency = Convert.ToByte(mySqlDataReader["idCurrency"]);
                                warehousePurchaseOrder.Currency.Name = Convert.ToString(mySqlDataReader["CurrencyName"]);
                                warehousePurchaseOrder.Currency.Symbol = Convert.ToString(mySqlDataReader["CurrencySymbol"]);
                            }
                            if (mySqlDataReader["IdWorkflowStatus"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                warehousePurchaseOrder.WorkflowStatus = new WorkflowStatus();
                                warehousePurchaseOrder.WorkflowStatus.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                warehousePurchaseOrder.WorkflowStatus.Name = Convert.ToString(mySqlDataReader["Status"]);
                                warehousePurchaseOrder.WorkflowStatus.HtmlColor = Convert.ToString(mySqlDataReader["HtmlColor"]);
                            }
                            if (mySqlDataReader["ReminderEmailDate"] != DBNull.Value)
                                warehousePurchaseOrder.ReminderEmailDate = Convert.ToDateTime(mySqlDataReader["ReminderEmailDate"]);
                            if (!string.IsNullOrEmpty(warehousePurchaseOrder.ArticleSupplier.ContactEmail))
                            {
                                if (warehousePurchaseOrder.ReminderEmailDate == DateTime.MinValue || warehousePurchaseOrder.ReminderEmailDate == null)
                                {
                                    warehousePurchaseOrder.ReminderEmailDate = warehousePurchaseOrder.DeliveryDate.Value.AddDays(1);
                                }
                                DateTime dtRm = new DateTime(warehousePurchaseOrder.ReminderEmailDate.Value.Year, warehousePurchaseOrder.ReminderEmailDate.Value.Month, warehousePurchaseOrder.ReminderEmailDate.Value.Day);
                                DateTime dtNow = new DateTime(DateTime.Now.Year, DateTime.Now.Month, DateTime.Now.Day);
                                if (dtRm <= dtNow)
                                {
                                    orderid = new List<long>();
                                    orderid.Add(warehousePurchaseOrder.IdWarehousePurchaseOrder);
                                    if (!SupplierEmailId.ContainsKey(warehousePurchaseOrder.ArticleSupplier.ContactEmail))
                                    {
                                        SupplierEmailId.Add(warehousePurchaseOrder.ArticleSupplier.ContactEmail, orderid);
                                    }
                                    else
                                    {
                                        SupplierEmailId[warehousePurchaseOrder.ArticleSupplier.ContactEmail].Add(warehousePurchaseOrder.IdWarehousePurchaseOrder);
                                    }
                                }
                            }
                            else
                            {
                                if (!Suppliername.Contains(warehousePurchaseOrder.ArticleSupplier.Name))
                                {
                                    Suppliername.Add(warehousePurchaseOrder.ArticleSupplier.Name);
                                }
                            }
                            warehousePurchaseOrders.Add(warehousePurchaseOrder);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetPendingPurchaseOrdersByWarehouse_V2110(). ErrorMessage-" + ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }
            foreach (string item in countryISOs)
            {
                byte[] bytes = null;
                bytes = GetCountryIconFileInBytes(item, countryIconFilePath);
                warehousePurchaseOrders.Where(wp => wp.ArticleSupplier.Country.Iso == item).ToList().ForEach(wp => wp.ArticleSupplier.Country.CountryIconBytes = bytes);
            }
            if (warehousePurchaseOrders.Count > 0)
            {
                warehousePurchaseOrders.FirstOrDefault().SupplierEmailId = SupplierEmailId;
                warehousePurchaseOrders.FirstOrDefault().Suppliername = Suppliername;
            }
            Log4NetLogger.Logger.Log("Executed GetPendingPurchaseOrdersByWarehouse_V2110().", category: Category.Info, priority: Priority.Low);
            return warehousePurchaseOrders;
        }
        public WarehousePurchaseOrder GetPendingPOByIdWarehousePurchaseOrder_V2110(string connectionString, Int64 idWarehousePurchaseOrder, string purchaseOrdersPath, string emailTemplatePath, string countryIconFilePath)
        {
            WarehousePurchaseOrder warehousePurchaseOrder = null;

            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetPendingPOByIdWarehousePurchaseOrder_V2110", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", idWarehousePurchaseOrder);

                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    if (mySqlDataReader.Read())
                    {
                        try
                        {
                            warehousePurchaseOrder = new WarehousePurchaseOrder();

                            warehousePurchaseOrder.IdWarehousePurchaseOrder = idWarehousePurchaseOrder;

                            if (mySqlDataReader["Code"] != DBNull.Value)
                                warehousePurchaseOrder.Code = Convert.ToString(mySqlDataReader["Code"]);

                            if (mySqlDataReader["IdArticleSupplier"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                                ArticleSupplier articleSupplier = new ArticleSupplier();
                                articleSupplier.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                                if (mySqlDataReader["Supplier"] != DBNull.Value)
                                    articleSupplier.Name = Convert.ToString(mySqlDataReader["Supplier"]);

                                if (mySqlDataReader["SupplierContactPerson"] != DBNull.Value)
                                    articleSupplier.ContactPerson = Convert.ToString(mySqlDataReader["SupplierContactPerson"]);

                                if (mySqlDataReader["SupplierContactEmail"] != DBNull.Value)
                                    articleSupplier.ContactEmail = Convert.ToString(mySqlDataReader["SupplierContactEmail"]);

                                if (mySqlDataReader["Serie"] != DBNull.Value)
                                    articleSupplier.Serie = Convert.ToChar(mySqlDataReader["Serie"]);

                                if (mySqlDataReader["IdCountry"] != DBNull.Value)
                                {
                                    articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["IdCountry"]);

                                    articleSupplier.Country = new Country();
                                    articleSupplier.Country.IdCountry = (byte)articleSupplier.IdCountry;
                                    articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);

                                    if (mySqlDataReader["SupplierCountryISO"] != DBNull.Value)
                                    {
                                        articleSupplier.Country.Iso = Convert.ToString(mySqlDataReader["SupplierCountryISO"]);
                                        byte[] bytes = null;
                                        bytes = GetCountryIconFileInBytes(articleSupplier.Country.Iso, countryIconFilePath);
                                        articleSupplier.Country.CountryIconBytes = bytes;
                                    }

                                    if (mySqlDataReader["IdCountryGroup"] != DBNull.Value)
                                        articleSupplier.Country.IdCountryGroup = Convert.ToInt64(mySqlDataReader["IdCountryGroup"]);
                                }

                                if (mySqlDataReader["IdArticleSupplierType"] != DBNull.Value)
                                {
                                    articleSupplier.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["IdArticleSupplierType"]);

                                    articleSupplier.ArticleSupplierType = new ArticleSupplierType();
                                    articleSupplier.ArticleSupplierType.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["IdArticleSupplierType"]);
                                    articleSupplier.ArticleSupplierType.Name = Convert.ToString(mySqlDataReader["ArticleSupplierType"]);
                                    articleSupplier.ArticleSupplierType.HtmlColor = Convert.ToString(mySqlDataReader["HtmlColor"]);
                                }

                                warehousePurchaseOrder.ArticleSupplier = articleSupplier;
                            }

                            if (mySqlDataReader["DeliveryDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["deliveryDate"]) != DateTime.MinValue)
                            {
                                warehousePurchaseOrder.DeliveryDate = Convert.ToDateTime(mySqlDataReader["deliveryDate"]);
                            }

                            if (mySqlDataReader["AttachedPO"] != DBNull.Value)
                                warehousePurchaseOrder.AttachedPO = Convert.ToByte(mySqlDataReader["AttachedPO"]);

                            if (mySqlDataReader["IdPaymentType"] != DBNull.Value)
                                warehousePurchaseOrder.IdPaymentType = Convert.ToInt64(mySqlDataReader["IdPaymentType"]);

                            if (mySqlDataReader["ReminderEmailDate"] != DBNull.Value)
                                warehousePurchaseOrder.ReminderEmailDate = Convert.ToDateTime(mySqlDataReader["ReminderEmailDate"]);

                            if (mySqlDataReader["CreatedIn"] != DBNull.Value)
                                warehousePurchaseOrder.CreatedIn = Convert.ToDateTime(mySqlDataReader["CreatedIn"]);

                            if (mySqlDataReader["ModifiedIn"] != DBNull.Value)
                                warehousePurchaseOrder.ModifiedIn = Convert.ToDateTime(mySqlDataReader["ModifiedIn"]);

                            if (mySqlDataReader["Comments"] != DBNull.Value)
                                warehousePurchaseOrder.Comments = Convert.ToString(mySqlDataReader["Comments"]);

                            if (mySqlDataReader["IsClosed"] != DBNull.Value)
                                warehousePurchaseOrder.IsClosed = Convert.ToByte(mySqlDataReader["IsClosed"]);

                            if (mySqlDataReader["CreatedBy"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.CreatedBy = Convert.ToInt64(mySqlDataReader["CreatedBy"]);
                                warehousePurchaseOrder.Creator = new People();
                                warehousePurchaseOrder.Creator.IdPerson = Convert.ToInt32(mySqlDataReader["CreatedBy"].ToString());
                                warehousePurchaseOrder.Creator.Name = mySqlDataReader["CreatorName"].ToString();
                                warehousePurchaseOrder.Creator.Surname = mySqlDataReader["CreatorSurname"].ToString();
                            }

                            if (mySqlDataReader["ModifiedBy"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.ModifiedBy = Convert.ToInt64(mySqlDataReader["ModifiedBy"]);
                                warehousePurchaseOrder.Modifier = new People();
                                warehousePurchaseOrder.Modifier.IdPerson = Convert.ToInt32(mySqlDataReader["ModifiedBy"].ToString());
                                warehousePurchaseOrder.Modifier.Name = mySqlDataReader["ModifierName"].ToString();
                                warehousePurchaseOrder.Modifier.Surname = mySqlDataReader["ModifierSurname"].ToString();
                            }

                            if (mySqlDataReader["ReasonClosed"] != DBNull.Value)
                                warehousePurchaseOrder.ReasonClosed = Convert.ToString(mySqlDataReader["ReasonClosed"]);

                            if (mySqlDataReader["IdWarehouse"] != DBNull.Value)
                                warehousePurchaseOrder.IdWarehouse = Convert.ToInt64(mySqlDataReader["IdWarehouse"]);

                            if (mySqlDataReader["IdCurrency"] != DBNull.Value)
                                warehousePurchaseOrder.IdCurrency = Convert.ToByte(mySqlDataReader["IdCurrency"]);

                            if (mySqlDataReader["IdWorkflowStatus"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                warehousePurchaseOrder.WorkflowStatus = new WorkflowStatus();
                                warehousePurchaseOrder.WorkflowStatus.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                warehousePurchaseOrder.WorkflowStatus.Name = Convert.ToString(mySqlDataReader["Status"]);
                                warehousePurchaseOrder.WorkflowStatus.HtmlColor = Convert.ToString(mySqlDataReader["StatusHtmlColor"]);
                            }

                            if (mySqlDataReader["IdAssignee"] != DBNull.Value)
                                warehousePurchaseOrder.IdAssignee = Convert.ToUInt32(mySqlDataReader["IdAssignee"]);

                            if (mySqlDataReader["IdApprover"] != DBNull.Value)
                                warehousePurchaseOrder.IdApprover = Convert.ToUInt32(mySqlDataReader["IdApprover"]);

                            string HTMLFileName = null;
                            if (File.Exists(string.Format("{0}{1}SupplierPurchaseOrderRequestMailFormat_{2}-{3}.html", emailTemplatePath, @"\", warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower(), warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToUpper())))
                            {
                                HTMLFileName = string.Format("SupplierPurchaseOrderRequestMailFormat_{0}-{1}.html", warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower(), warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToUpper());
                            }
                            else if (File.Exists(string.Format("{0}{1}SupplierPurchaseOrderRequestMailFormat.html", emailTemplatePath, @"\")))
                            {
                                HTMLFileName = "SupplierPurchaseOrderRequestMailFormat.html";
                            }
                            if (HTMLFileName != null)
                            {
                                StringBuilder emailbody = new StringBuilder();
                                string text = ReadMailTemplate(HTMLFileName, emailTemplatePath);

                                if (string.IsNullOrEmpty(warehousePurchaseOrder.ArticleSupplier.ContactPerson))
                                {
                                    text = text.Replace("[Supplier_Name]", "Supplier");
                                }
                                else
                                {
                                    text = text.Replace("[Supplier_Name]", warehousePurchaseOrder.ArticleSupplier.ContactPerson);
                                }
                                text = text.Replace("[PO_Code]", warehousePurchaseOrder.Code);

                                emailbody.Append(text);

                                warehousePurchaseOrder.EmailBody = emailbody.ToString();
                            }
                            warehousePurchaseOrder.AttachPdf = warehousePurchaseOrder.CreatedIn.Year + @"\" + warehousePurchaseOrder.Code + @"\01 Purchase Order\PO_" + warehousePurchaseOrder.Code + ".pdf";

                            warehousePurchaseOrder.AttachmentBytes = GetPurchaseOrderPdf(purchaseOrdersPath, warehousePurchaseOrder.AttachPdf);
                            warehousePurchaseOrder.WarehouseDeliveryNotes = GetDeliveryNotesByIdWarehousePurchaseOrder(connectionString, warehousePurchaseOrder, purchaseOrdersPath);

                            warehousePurchaseOrder.WarehousePurchaseOrderItems = GetArticlesByIdWarehousePurchaseOrder_V2110(connectionString, warehousePurchaseOrder.IdWarehousePurchaseOrder);

                            warehousePurchaseOrder.WarehousePOComments = GetlogEntriesByWarehousePO(idWarehousePurchaseOrder, 252, connectionString);
                            warehousePurchaseOrder.WarehousePOLogEntries = GetlogEntriesByWarehousePO(idWarehousePurchaseOrder, 253, connectionString);

                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetPendingPOByIdWarehousePurchaseOrder_V2110(idWarehousePurchaseOrder-{0}), ErrorMessage- {1} ", idWarehousePurchaseOrder, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            Log4NetLogger.Logger.Log("Executed GetPendingPOByIdWarehousePurchaseOrder_V2110().", category: Category.Info, priority: Priority.Low);
            return warehousePurchaseOrder;
        }
        public byte[] GetCountryIconFileInBytes(string countryiso, string filepath)
        {
            byte[] bytes = null;
            try
            {
                string filenamepng = countryiso + ".png";
                string filenamejpg = countryiso + ".jpg";
                string filepathjpg = Path.Combine(filepath, filenamejpg);
                string filepathpng = Path.Combine(filepath, filenamepng);
                if (File.Exists(filepathjpg))
                {
                    using (System.IO.FileStream stream = new System.IO.FileStream(filepathjpg, System.IO.FileMode.Open, System.IO.FileAccess.Read))
                    {
                        bytes = new byte[stream.Length];
                        int numBytesToRead = (int)stream.Length;
                        int numBytesRead = 0;
                        while (numBytesToRead > 0)
                        {
                            // Read may return anything from 0 to numBytesToRead.	
                            int n = stream.Read(bytes, numBytesRead, numBytesToRead);
                            // Break when the end of the file is reached.	
                            if (n == 0)
                                break;
                            numBytesRead += n;
                            numBytesToRead -= n;
                        }
                    }
                }
                else if (File.Exists(filepathpng))
                {
                    using (System.IO.FileStream stream = new System.IO.FileStream(filepathpng, System.IO.FileMode.Open, System.IO.FileAccess.Read))
                    {
                        bytes = new byte[stream.Length];
                        int numBytesToRead = (int)stream.Length;
                        int numBytesRead = 0;
                        while (numBytesToRead > 0)
                        {
                            // Read may return anything from 0 to numBytesToRead.	
                            int n = stream.Read(bytes, numBytesRead, numBytesToRead);
                            // Break when the end of the file is reached.	
                            if (n == 0)
                                break;
                            numBytesRead += n;
                            numBytesToRead -= n;
                        }
                    }
                }
                return bytes;
            }
            catch (FileNotFoundException ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCountryIconFileInBytes() ISO-{0}. ErrorMessage- {1}", countryiso, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            catch (DirectoryNotFoundException ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCountryIconFileInBytes() ISO-{0}. ErrorMessage- {1}", countryiso, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCountryIconFileInBytes() ISO-{0}. ErrorMessage- {1}", countryiso, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }
        public List<Article> GetPendingArticles(Warehouses warehouse)
        {
            List<Article> articles = new List<Article>();
            string connectionString = warehouse.Company.ConnectPlantConstr;
            using (MySqlConnection connArticles = new MySqlConnection(connectionString))
            {
                connArticles.Open();
                MySqlCommand articleCommand = new MySqlCommand("SRM_GetPendingArticles", connArticles);
                articleCommand.CommandType = CommandType.StoredProcedure;
                articleCommand.Parameters.AddWithValue("_IdWarehouse", warehouse.IdWarehouse);
                using (MySqlDataReader articleReader = articleCommand.ExecuteReader())
                {
                    while (articleReader.Read())
                    {
                        try
                        {
                            Article article = new Article();
                            if (articleReader["IdArticle"] != DBNull.Value)
                                article.IdArticle = Convert.ToInt32(articleReader["IdArticle"]);
                            if (articleReader["Reference"] != DBNull.Value)
                                article.Reference = Convert.ToString(articleReader["Reference"]);
                            if (articleReader["Description"] != DBNull.Value)
                                article.Description = Convert.ToString(articleReader["Description"]);
                            WarehousePurchaseOrder warehousePO = new WarehousePurchaseOrder();
                            warehousePO.IdWarehousePurchaseOrder = Convert.ToInt64(articleReader["IdWarehousePurchaseOrder"]);
                            if (articleReader["PurchaseOrderCode"] != DBNull.Value)
                                warehousePO.Code = Convert.ToString(articleReader["PurchaseOrderCode"]);
                            if (articleReader["WO_DeliveryDate"] != DBNull.Value)
                            {
                                warehousePO.DeliveryDate = Convert.ToDateTime(articleReader["WO_DeliveryDate"]);
                                warehousePO.Delay = (int)(warehousePO.DeliveryDate.Value.Date - DateTime.Now.Date).TotalDays;
                            }
                            if (articleReader["WO_Supplier"] != DBNull.Value)
                            {
                                warehousePO.ArticleSupplier = new ArticleSupplier();
                                warehousePO.ArticleSupplier.Name = Convert.ToString(articleReader["WO_Supplier"]);
                            }
                            if (articleReader["PurchasedQty"] != DBNull.Value)
                            {
                                article.PurchasedQty = Convert.ToInt64(articleReader["PurchasedQty"]);
                            }
                            if (articleReader["DeliveredQty"] != DBNull.Value)
                            {
                                article.DeliveredQty = Convert.ToInt64(articleReader["DeliveredQty"]);
                            }
                            if (articleReader["RemainingQty"] != DBNull.Value)
                                article.Quantity = Convert.ToDouble(articleReader["RemainingQty"]);
                            if (articleReader["IdWarehouse"] != DBNull.Value)
                                warehousePO.IdWarehouse = Convert.ToInt64(articleReader["IdWarehouse"]);
                            if (articleReader["IdWorkflowStatus"] != DBNull.Value)
                            {
                                warehousePO.IdWorkflowStatus = Convert.ToByte(articleReader["IdWorkflowStatus"]);
                                warehousePO.WorkflowStatus = new WorkflowStatus();
                                warehousePO.WorkflowStatus.IdWorkflowStatus = Convert.ToByte(articleReader["IdWorkflowStatus"]);
                                warehousePO.WorkflowStatus.Name = Convert.ToString(articleReader["Status"]);
                                warehousePO.WorkflowStatus.HtmlColor = Convert.ToString(articleReader["HtmlColor"]);
                            }
                            article.WarehousePurchaseOrder = warehousePO;
                            articles.Add(article);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error SRM_GetPendingArticles(). ErrorMessage-" + ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }
            Log4NetLogger.Logger.Log("Executed SRM_GetPendingArticles().", category: Category.Info, priority: Priority.Low);
            return articles;
        }


        public List<WarehousePurchaseOrderItem> GetArticlesByIdWarehousePurchaseOrder_V2110(string connectionString, Int64 idWarehousePurchaseOrder)
        {
            List<WarehousePurchaseOrderItem> warehousePurchaseOrderItems = new List<WarehousePurchaseOrderItem>();

            using (MySqlConnection connWarehousePurchaseOrderItem = new MySqlConnection(connectionString))
            {
                connWarehousePurchaseOrderItem.Open();

                MySqlCommand activitiesCommand = new MySqlCommand("SRM_GetArticlesAndPOItemsByIdWarehousePurchaseOrder", connWarehousePurchaseOrderItem);
                activitiesCommand.CommandType = CommandType.StoredProcedure;
                activitiesCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", idWarehousePurchaseOrder);

                using (MySqlDataReader poReader = activitiesCommand.ExecuteReader())
                {
                    while (poReader.Read())
                    {
                        try
                        {
                            WarehousePurchaseOrderItem warehousePurchaseOrderItem = new WarehousePurchaseOrderItem();

                            warehousePurchaseOrderItem.IdWarehousePurchaseOrder = idWarehousePurchaseOrder;

                            if (poReader["IdWarehousePurchaseOrderItem"] != DBNull.Value)
                                warehousePurchaseOrderItem.IdWarehousePurchaseOrderItem = Convert.ToInt64(poReader["IdWarehousePurchaseOrderItem"]);

                            if (poReader["Description"] != DBNull.Value)
                                warehousePurchaseOrderItem.Description = Convert.ToString(poReader["Description"]);

                            if (poReader["IdArticle"] != DBNull.Value)
                            {
                                warehousePurchaseOrderItem.IdArticle = Convert.ToInt32(poReader["IdArticle"]);

                                Article article = new Article();

                                if (poReader["Reference"] != DBNull.Value)
                                    article.Reference = Convert.ToString(poReader["Reference"]);

                                if (poReader["IsGeneric"] != DBNull.Value)
                                    article.IsGeneric = Convert.ToSByte(poReader["IsGeneric"]);

                                if (poReader["IdArticleCategory"] != DBNull.Value)
                                    article.IdArticleCategory = Convert.ToInt32(poReader["IdArticleCategory"]);

                                warehousePurchaseOrderItem.Article = article;
                            }

                            if (poReader["Quantity"] != DBNull.Value)
                                warehousePurchaseOrderItem.Quantity = Convert.ToInt32(poReader["Quantity"]);

                            if (poReader["UnitPrice"] != DBNull.Value)
                                warehousePurchaseOrderItem.UnitPrice = Convert.ToDouble(poReader["UnitPrice"]);

                            if (poReader["Discount"] != DBNull.Value)
                                warehousePurchaseOrderItem.Discount = Convert.ToDouble(poReader["Discount"]);

                            if (poReader["Iva"] != DBNull.Value)
                                warehousePurchaseOrderItem.IVA = Convert.ToDouble(poReader["Iva"]);

                            if (poReader["AdditionalComments"] != DBNull.Value)
                                warehousePurchaseOrderItem.AdditionalComments = Convert.ToString(poReader["AdditionalComments"]);

                            if (poReader["Position"] != DBNull.Value)
                                warehousePurchaseOrderItem.Position = Convert.ToInt64(poReader["Position"]);

                            if (poReader["AlbaranQty"] != DBNull.Value)
                                warehousePurchaseOrderItem.ReceivedQuantity = Convert.ToInt32(poReader["AlbaranQty"]);


                            if (poReader["TotalAmount"] != DBNull.Value)
                                warehousePurchaseOrderItem.TotalAmount = Convert.ToDecimal(poReader["TotalAmount"]);

                            if (poReader["TotalAmount"] != DBNull.Value)
                                warehousePurchaseOrderItem.TotalAmount_New = Convert.ToDouble(poReader["TotalAmount"]);

                            if (warehousePurchaseOrderItem.Quantity > 0)
                            {
                                warehousePurchaseOrderItem.Status = (Int32)(warehousePurchaseOrderItem.ReceivedQuantity / warehousePurchaseOrderItem.Quantity * 100);
                            }

                            warehousePurchaseOrderItem.WarehousePurchaseOrderExpectedItems = GetWarehousePOExpectedItems(connectionString, warehousePurchaseOrderItem.IdWarehousePurchaseOrderItem);

                            if (warehousePurchaseOrderItem.WarehousePurchaseOrderExpectedItems.Count > 0)
                            {
                                warehousePurchaseOrderItem.ExpectedDate = warehousePurchaseOrderItem.WarehousePurchaseOrderExpectedItems.First().Date;
                            }

                            warehousePurchaseOrderItem.ReceivedDeliveryNotes = GetDeliveryNotesByIdWarehousePurchaseOrderItem(connectionString, warehousePurchaseOrderItem.IdWarehousePurchaseOrderItem);
                            warehousePurchaseOrderItems.Add(warehousePurchaseOrderItem);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetArticlesByIdWarehousePurchaseOrder_V2110(idWarehousePurchaseOrder-{0}). ErrorMessage- {1}", idWarehousePurchaseOrder, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            Log4NetLogger.Logger.Log("Executed GetArticlesByIdWarehousePurchaseOrder_V2110().", category: Category.Info, priority: Priority.Low);
            return warehousePurchaseOrderItems;
        }

        public List<User> GetPermissionUsers(string connectionstring)
        {
            List<User> users = new List<User>();
            try
            {
                using (MySqlConnection objMySqlConnection = new MySqlConnection(connectionstring))
                {
                    objMySqlConnection.Open();
                    MySqlCommand objMySqlCommand = new MySqlCommand("SRM_GetPermissionUsers", objMySqlConnection);
                    objMySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader sitereader = objMySqlCommand.ExecuteReader())
                    {
                        while (sitereader.Read())
                        {
                            User user = new User();
                            user.IdUser = Convert.ToInt32(sitereader["IdUser"].ToString());
                            user.FirstName = sitereader["FirstName"].ToString();
                            user.LastName = sitereader["LastName"].ToString();
                            user.CompanyEmail = sitereader["CompanyEmail"].ToString();
                            users.Add(user);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log("Executed GetPermissionUsers().", category: Category.Info, priority: Priority.Low);
                throw;
            }
            return users;
        }


        public bool UpdateArticleSupplierReminderEmailDate(string MainServerConnectionString, Int64 IdWarehousePurchaseOrder, DateTime? ReminderEmailDate, Int64 IdSupplier, Int64 IdUser)
        {
            bool status;
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("SRM_UpdateReminderEmailDateInPO", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_ReminderEmailDate", ReminderEmailDate);
                    mySqlCommand.Parameters.AddWithValue("_idarticlesupplier", IdSupplier);
                    mySqlCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", IdWarehousePurchaseOrder);
                    mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdUser);
                    mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                    mySqlCommand.ExecuteNonQuery();
                    mySqlConnection.Close();
                    status = true;
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error UpdateArticleSupplierReminderEmailDate(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return status;
        }


        public List<KeyValuePair<string, string>> GetBodyAndUpdateReminderDateInPO(Warehouses warehouse, string MainServerConnectionString, List<WarehousePurchaseOrder> warehousePurchaseOrderList, Dictionary<string, List<long>> supplierEmailId, string emailTemplatePath, int IdModifiedBy)
        {
            List<KeyValuePair<string, string>> MailWithBodyList = new List<KeyValuePair<string, string>>();

            string HTMLFileName = null;
            string connectionString = warehouse.Company.ConnectPlantConstr;
            try
            {
                StringBuilder EmailBodyWithTable = new StringBuilder();
                foreach (KeyValuePair<String, List<long>> val in supplierEmailId)
                {
                    string EmailBody = "";
                    string fullTemplateText = "";
                    string TemplateText_Dynamic = "";
                    int status = 0;
                    WarehousePurchaseOrder order = new WarehousePurchaseOrder();
                    string suppemail = val.Key;
                    for (int i = 0; i < val.Value.Count; i++)
                    {
                        if (warehousePurchaseOrderList.Any(a => a.IdWarehousePurchaseOrder == val.Value[i]))
                        {
                            StringBuilder strArticles = new StringBuilder();
                            order = GetPendingPOByIdWarehousePurchaseOrder_ForReminderMail(connectionString, val.Value[i]);
                            if (order.ReminderEmailDate == DateTime.MinValue || order.ReminderEmailDate == null)
                            {
                                order.ReminderEmailDate = order.DeliveryDate.Value.AddDays(1);
                            }
                            DateTime dtRm = new DateTime(order.ReminderEmailDate.Value.Year, order.ReminderEmailDate.Value.Month, order.ReminderEmailDate.Value.Day);
                            DateTime dtNow = new DateTime(DateTime.Now.Year, DateTime.Now.Month, DateTime.Now.Day);

                            if (dtRm <= dtNow)
                            {
                                if (string.IsNullOrEmpty(fullTemplateText))
                                {
                                    if (File.Exists(string.Format("{0}{1}SupplierPurchaseOrderDelayReminderMailFormat_{2}-{3}.html", emailTemplatePath, @"\", order.ArticleSupplier.Country.Iso.ToLower(), order.ArticleSupplier.Country.Iso.ToUpper())))
                                    {
                                        HTMLFileName = string.Format("SupplierPurchaseOrderDelayReminderMailFormat_{0}-{1}.html", order.ArticleSupplier.Country.Iso.ToLower(), order.ArticleSupplier.Country.Iso.ToUpper());
                                    }
                                    else if (File.Exists(string.Format("{0}{1}SupplierPurchaseOrderDelayReminderMailFormat.html", emailTemplatePath, @"\")))
                                    {
                                        HTMLFileName = "SupplierPurchaseOrderDelayReminderMailFormat.html";
                                    }
                                    if (HTMLFileName != null)
                                    {
                                        fullTemplateText = ReadMailTemplate(HTMLFileName, emailTemplatePath);

                                        int pFrom = fullTemplateText.IndexOf("<div id=\"Template\">") + "<div id=\"Template\">".Length;
                                        int pTo = fullTemplateText.LastIndexOf("</div>");

                                        TemplateText_Dynamic = fullTemplateText.Substring(pFrom, pTo - pFrom);
                                    }
                                }
                                if (status == 1)
                                {
                                    string text_temp = TemplateText_Dynamic;
                                    text_temp = text_temp.Replace("[PO_Code]", order.Code);

                                    for (int k = 0; k < order.WarehousePurchaseOrderItems.Count; k++)
                                    {
                                        int RemainingQty = Convert.ToInt32(order.WarehousePurchaseOrderItems[k].Quantity - order.WarehousePurchaseOrderItems[k].ReceivedQuantity);
                                        if ((RemainingQty > 0))
                                        {
                                            strArticles.AppendLine("<tr>");
                                            strArticles.AppendLine("<td>" + order.WarehousePurchaseOrderItems[k].Article.Reference + "</td>");
                                            strArticles.AppendLine("<td>" + order.WarehousePurchaseOrderItems[k].Description + "</td>");
                                            strArticles.AppendLine("<td style=\"text-align:center; \">" + RemainingQty + "</td>");
                                            if (order.WarehousePurchaseOrderItems[k].ExpectedDate != null)
                                            {
                                                if (order.WarehousePurchaseOrderItems[k].ExpectedDate.Value.Date < DateTime.Now.Date)
                                                    strArticles.AppendLine("<td style=\"color: red; text-align:center;\">" + order.WarehousePurchaseOrderItems[k].ExpectedDate.Value.ToShortDateString() + "</td>");
                                                else
                                                    strArticles.AppendLine("<td>" + order.WarehousePurchaseOrderItems[k].ExpectedDate.Value.ToShortDateString() + "</td>");
                                            }
                                            else
                                                strArticles.AppendLine("<td>" + "" + "</td>");

                                            strArticles.AppendLine("</tr>");
                                        }
                                    }

                                    text_temp = text_temp.Replace("[POItems]", strArticles.ToString());

                                    EmailBody += text_temp;
                                }
                                else
                                {
                                    status = 1;
                                    fullTemplateText = fullTemplateText.Replace("[PO_Code]", order.Code);

                                    for (int k = 0; k < order.WarehousePurchaseOrderItems.Count; k++)
                                    {
                                        int RemainingQty = Convert.ToInt32(order.WarehousePurchaseOrderItems[k].Quantity - order.WarehousePurchaseOrderItems[k].ReceivedQuantity);
                                        if ((RemainingQty > 0))
                                        {
                                            strArticles.AppendLine("<tr>");
                                            strArticles.AppendLine("<td>" + order.WarehousePurchaseOrderItems[k].Article.Reference + "</td>");
                                            strArticles.AppendLine("<td>" + order.WarehousePurchaseOrderItems[k].Description + "</td>");
                                            strArticles.AppendLine("<td style=\"text-align:center; \">" + RemainingQty + "</td>");
                                            if (order.WarehousePurchaseOrderItems[k].ExpectedDate != null)
                                            {
                                                if (order.WarehousePurchaseOrderItems[k].ExpectedDate.Value.Date < DateTime.Now.Date)
                                                    strArticles.AppendLine("<td style=\"color: red; text-align:center;\">" + order.WarehousePurchaseOrderItems[k].ExpectedDate.Value.ToShortDateString() + "</td>");
                                                else
                                                    strArticles.AppendLine("<td>" + order.WarehousePurchaseOrderItems[k].ExpectedDate.Value.ToShortDateString() + "</td>");
                                            }
                                            else
                                                strArticles.AppendLine("<td>" + "" + "</td>");

                                            strArticles.AppendLine("</tr>");
                                        }
                                    }

                                    fullTemplateText = fullTemplateText.Replace("[POItems]", strArticles.ToString());
                                }

                                order.ReminderEmailDate = System.DateTime.Now.AddDays(2);
                                DateTime dtRm1 = new DateTime(order.ReminderEmailDate.Value.Year, order.ReminderEmailDate.Value.Month, order.ReminderEmailDate.Value.Day);
                                UpdateArticleSupplierReminderEmailDate(MainServerConnectionString, order.IdWarehousePurchaseOrder, order.ReminderEmailDate, order.ArticleSupplier.IdArticleSupplier, IdModifiedBy);

                            }

                        }
                    }

                    if (!string.IsNullOrEmpty(fullTemplateText))
                    {
                        StringBuilder MainMailBody = new StringBuilder();

                        if (string.IsNullOrEmpty(order.ArticleSupplier.ContactPerson))
                        {
                            fullTemplateText = fullTemplateText.Replace("[Supplier_Name]", "Supplier");
                        }
                        else
                        {
                            fullTemplateText = fullTemplateText.Replace("[Supplier_Name]", order.ArticleSupplier.ContactPerson);
                        }
                        fullTemplateText = fullTemplateText.Replace("[Items_Information]", EmailBody.ToString());

                        MainMailBody.Append(fullTemplateText);
                        MailWithBodyList.Add(new KeyValuePair<string, string>(order.ArticleSupplier.ContactEmail, MainMailBody.ToString()));
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBodyAndUpdateReminderDateInPO(), ErrorMessage- {0} ", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            Log4NetLogger.Logger.Log("Executed GetBodyAndUpdateReminderDateInPO().", category: Category.Info, priority: Priority.Low);
            return MailWithBodyList;
        }

        public List<KeyValuePair<string, string>> GetBodyAndUpdateReminderDateInPO_V2650(Warehouses warehouse, string MainServerConnectionString, List<WarehousePurchaseOrder> warehousePurchaseOrderList, Dictionary<string, List<long>> supplierEmailId, string emailTemplatePath, int IdModifiedBy)
        {
            List<KeyValuePair<string, string>> MailWithBodyList = new List<KeyValuePair<string, string>>();

            string HTMLFileName = null;
            string connectionString = warehouse.Company.ConnectPlantConstr;
            try
            {
                StringBuilder EmailBodyWithTable = new StringBuilder();
                foreach (KeyValuePair<String, List<long>> val in supplierEmailId)
                {
                    string EmailBody = "";
                    string fullTemplateText = "";
                    string TemplateText_Dynamic = "";
                    int status = 0;
                    WarehousePurchaseOrder order = new WarehousePurchaseOrder();
                    string suppemail = val.Key;
                    for (int i = 0; i < val.Value.Count; i++)
                    {
                        if (warehousePurchaseOrderList.Any(a => a.IdWarehousePurchaseOrder == val.Value[i]))
                        {
                            StringBuilder strArticles = new StringBuilder();
                            order = GetPendingPOByIdWarehousePurchaseOrder_ForReminderMail_V2650(connectionString, val.Value[i], warehouse.IdWarehouse);
                            if (order.ReminderEmailDate == DateTime.MinValue || order.ReminderEmailDate == null)
                            {
                                order.ReminderEmailDate = order.DeliveryDate.Value.AddDays(1);
                            }
                            DateTime dtRm = new DateTime(order.ReminderEmailDate.Value.Year, order.ReminderEmailDate.Value.Month, order.ReminderEmailDate.Value.Day);
                            DateTime dtNow = new DateTime(DateTime.Now.Year, DateTime.Now.Month, DateTime.Now.Day);

                            if (dtRm <= dtNow)
                            {
                                if (string.IsNullOrEmpty(fullTemplateText))
                                {
                                    if (File.Exists(string.Format("{0}{1}SupplierPurchaseOrderDelayReminderMailFormat_{2}-{3}.html", emailTemplatePath, @"\", order.ArticleSupplier.Country.Iso.ToLower(), order.ArticleSupplier.Country.Iso.ToUpper())))
                                    {
                                        HTMLFileName = string.Format("SupplierPurchaseOrderDelayReminderMailFormat_{0}-{1}.html", order.ArticleSupplier.Country.Iso.ToLower(), order.ArticleSupplier.Country.Iso.ToUpper());
                                    }
                                    else if (File.Exists(string.Format("{0}{1}SupplierPurchaseOrderDelayReminderMailFormat.html", emailTemplatePath, @"\")))
                                    {
                                        HTMLFileName = "SupplierPurchaseOrderDelayReminderMailFormat.html";
                                    }
                                    if (HTMLFileName != null)
                                    {
                                        fullTemplateText = ReadMailTemplate(HTMLFileName, emailTemplatePath);

                                        int pFrom = fullTemplateText.IndexOf("<div id=\"Template\">") + "<div id=\"Template\">".Length;
                                        int pTo = fullTemplateText.LastIndexOf("</div>");

                                        TemplateText_Dynamic = fullTemplateText.Substring(pFrom, pTo - pFrom);
                                    }
                                }
                                if (status == 1)
                                {
                                    string text_temp = TemplateText_Dynamic;
                                    text_temp = text_temp.Replace("[PO_Code]", order.Code);

                                    for (int k = 0; k < order.WarehousePurchaseOrderItems.Count; k++)
                                    {
                                        int RemainingQty = Convert.ToInt32(order.WarehousePurchaseOrderItems[k].Quantity - order.WarehousePurchaseOrderItems[k].ReceivedQuantity);
                                        if ((RemainingQty > 0))
                                        {
                                            strArticles.AppendLine("<tr>");
                                            strArticles.AppendLine("<td>" + order.WarehousePurchaseOrderItems[k].Article.Reference + "</td>");
                                            strArticles.AppendLine("<td>" + order.WarehousePurchaseOrderItems[k].Description + "</td>");
                                            strArticles.AppendLine("<td style=\"text-align:center; \">" + RemainingQty + "</td>");
                                            if (order.WarehousePurchaseOrderItems[k].ExpectedDate != null)
                                            {
                                                if (order.WarehousePurchaseOrderItems[k].ExpectedDate.Value.Date < DateTime.Now.Date)
                                                    strArticles.AppendLine("<td style=\"color: red; text-align:center;\">" + order.WarehousePurchaseOrderItems[k].ExpectedDate.Value.ToShortDateString() + "</td>");
                                                else
                                                    strArticles.AppendLine("<td>" + order.WarehousePurchaseOrderItems[k].ExpectedDate.Value.ToShortDateString() + "</td>");
                                            }
                                            else
                                                strArticles.AppendLine("<td>" + "" + "</td>");

                                            strArticles.AppendLine("</tr>");
                                        }
                                    }

                                    text_temp = text_temp.Replace("[POItems]", strArticles.ToString());

                                    EmailBody += text_temp;
                                }
                                else
                                {
                                    status = 1;
                                    fullTemplateText = fullTemplateText.Replace("[PO_Code]", order.Code);

                                    for (int k = 0; k < order.WarehousePurchaseOrderItems.Count; k++)
                                    {
                                        int RemainingQty = Convert.ToInt32(order.WarehousePurchaseOrderItems[k].Quantity - order.WarehousePurchaseOrderItems[k].ReceivedQuantity);
                                        if ((RemainingQty > 0))
                                        {
                                            strArticles.AppendLine("<tr>");
                                            strArticles.AppendLine("<td>" + order.WarehousePurchaseOrderItems[k].Article.Reference + "</td>");
                                            strArticles.AppendLine("<td>" + order.WarehousePurchaseOrderItems[k].Description + "</td>");
                                            strArticles.AppendLine("<td style=\"text-align:center; \">" + RemainingQty + "</td>");
                                            if (order.WarehousePurchaseOrderItems[k].ExpectedDate != null)
                                            {
                                                if (order.WarehousePurchaseOrderItems[k].ExpectedDate.Value.Date < DateTime.Now.Date)
                                                    strArticles.AppendLine("<td style=\"color: red; text-align:center;\">" + order.WarehousePurchaseOrderItems[k].ExpectedDate.Value.ToShortDateString() + "</td>");
                                                else
                                                    strArticles.AppendLine("<td>" + order.WarehousePurchaseOrderItems[k].ExpectedDate.Value.ToShortDateString() + "</td>");
                                            }
                                            else
                                                strArticles.AppendLine("<td>" + "" + "</td>");

                                            strArticles.AppendLine("</tr>");
                                        }
                                    }

                                    fullTemplateText = fullTemplateText.Replace("[POItems]", strArticles.ToString());
                                }

                                order.ReminderEmailDate = System.DateTime.Now.AddDays(2);
                                DateTime dtRm1 = new DateTime(order.ReminderEmailDate.Value.Year, order.ReminderEmailDate.Value.Month, order.ReminderEmailDate.Value.Day);
                                UpdateArticleSupplierReminderEmailDate(MainServerConnectionString, order.IdWarehousePurchaseOrder, order.ReminderEmailDate, order.ArticleSupplier.IdArticleSupplier, IdModifiedBy);

                            }

                        }
                    }

                    if (!string.IsNullOrEmpty(fullTemplateText))
                    {
                        StringBuilder MainMailBody = new StringBuilder();

                        if (string.IsNullOrEmpty(order.ArticleSupplier.ContactPerson))
                        {
                            fullTemplateText = fullTemplateText.Replace("[Supplier_Name]", "Supplier");
                        }
                        else
                        {
                            fullTemplateText = fullTemplateText.Replace("[Supplier_Name]", order.ArticleSupplier.ContactPerson);
                        }
                        fullTemplateText = fullTemplateText.Replace("[Items_Information]", EmailBody.ToString());

                        MainMailBody.Append(fullTemplateText);
                        MailWithBodyList.Add(new KeyValuePair<string, string>(order.ArticleSupplier.ContactEmail, MainMailBody.ToString()));
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetBodyAndUpdateReminderDateInPO_V2650(), ErrorMessage- {0} ", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            Log4NetLogger.Logger.Log("Executed GetBodyAndUpdateReminderDateInPO_V2650().", category: Category.Info, priority: Priority.Low);
            return MailWithBodyList;
        }


        public bool UpdateWorkflowStatusInPO_V2110(string MainServerConnectionString, uint IdWarehousePurchaseOrder, UInt32 IdWorkflowStatus, int IdUser, List<LogEntriesByWarehousePO> LogEntriesByWarehousePOList, UInt32 IdAssignee, UInt32 IdApprover)
        {
            bool status;
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        MySqlCommand mySqlCommand = new MySqlCommand("SRM_warehousepurchaseorders_UpdateWorkflowStatus", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", IdWarehousePurchaseOrder);
                        mySqlCommand.Parameters.AddWithValue("_IdWorkflowStatus", IdWorkflowStatus);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdUser);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                        status = true;
                    }
                    AddCommentsOrLogEntriesByPO(MainServerConnectionString, LogEntriesByWarehousePOList);
                    UpdateAssigneeAndApproverInPO(MainServerConnectionString, IdWarehousePurchaseOrder, IdAssignee, IdApprover, IdUser);
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateWorkflowStatusInPO_V2110(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return status;
        }


        public void UpdateAssigneeAndApproverInPO(string MainServerConnectionString, uint IdWarehousePurchaseOrder, UInt32 IdAssignee, UInt32 IdApprover, int IdUser)
        {
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("SRM_UpdateAssigneeAndApproverInPO", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    mySqlCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", IdWarehousePurchaseOrder);
                    mySqlCommand.Parameters.AddWithValue("_IdAssignee", IdAssignee);
                    mySqlCommand.Parameters.AddWithValue("_IdApprover", IdApprover);
                    mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdUser);
                    mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                    mySqlCommand.ExecuteNonQuery();
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddCommentsOrLogEntriesByPO(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        public WarehousePurchaseOrder GetPendingPOByIdWarehousePurchaseOrder_ForReminderMail(string connectionString, Int64 idWarehousePurchaseOrder)
        {
            WarehousePurchaseOrder warehousePurchaseOrder = null;

            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetPendingPOByIdWarehousePurchaseOrder_V2110", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", idWarehousePurchaseOrder);

                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    if (mySqlDataReader.Read())
                    {
                        try
                        {
                            warehousePurchaseOrder = new WarehousePurchaseOrder();

                            warehousePurchaseOrder.IdWarehousePurchaseOrder = idWarehousePurchaseOrder;

                            if (mySqlDataReader["Code"] != DBNull.Value)
                                warehousePurchaseOrder.Code = Convert.ToString(mySqlDataReader["Code"]);

                            if (mySqlDataReader["IdArticleSupplier"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                                ArticleSupplier articleSupplier = new ArticleSupplier();
                                articleSupplier.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                                if (mySqlDataReader["Supplier"] != DBNull.Value)
                                    articleSupplier.Name = Convert.ToString(mySqlDataReader["Supplier"]);

                                if (mySqlDataReader["SupplierContactPerson"] != DBNull.Value)
                                    articleSupplier.ContactPerson = Convert.ToString(mySqlDataReader["SupplierContactPerson"]);

                                if (mySqlDataReader["SupplierContactEmail"] != DBNull.Value)
                                    articleSupplier.ContactEmail = Convert.ToString(mySqlDataReader["SupplierContactEmail"]);

                                if (mySqlDataReader["Serie"] != DBNull.Value)
                                    articleSupplier.Serie = Convert.ToChar(mySqlDataReader["Serie"]);

                                if (mySqlDataReader["IdCountry"] != DBNull.Value)
                                {
                                    articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["IdCountry"]);

                                    articleSupplier.Country = new Country();
                                    articleSupplier.Country.IdCountry = (byte)articleSupplier.IdCountry;
                                    articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);

                                    if (mySqlDataReader["SupplierCountryISO"] != DBNull.Value)
                                    {
                                        articleSupplier.Country.Iso = Convert.ToString(mySqlDataReader["SupplierCountryISO"]);
                                    }

                                    if (mySqlDataReader["IdCountryGroup"] != DBNull.Value)
                                        articleSupplier.Country.IdCountryGroup = Convert.ToInt64(mySqlDataReader["IdCountryGroup"]);
                                }

                                if (mySqlDataReader["IdArticleSupplierType"] != DBNull.Value)
                                {
                                    articleSupplier.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["IdArticleSupplierType"]);

                                    articleSupplier.ArticleSupplierType = new ArticleSupplierType();
                                    articleSupplier.ArticleSupplierType.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["IdArticleSupplierType"]);
                                    articleSupplier.ArticleSupplierType.Name = Convert.ToString(mySqlDataReader["ArticleSupplierType"]);
                                    articleSupplier.ArticleSupplierType.HtmlColor = Convert.ToString(mySqlDataReader["HtmlColor"]);
                                }

                                warehousePurchaseOrder.ArticleSupplier = articleSupplier;
                            }

                            if (mySqlDataReader["DeliveryDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["deliveryDate"]) != DateTime.MinValue)
                            {
                                warehousePurchaseOrder.DeliveryDate = Convert.ToDateTime(mySqlDataReader["deliveryDate"]);
                            }

                            if (mySqlDataReader["AttachedPO"] != DBNull.Value)
                                warehousePurchaseOrder.AttachedPO = Convert.ToByte(mySqlDataReader["AttachedPO"]);

                            if (mySqlDataReader["IdPaymentType"] != DBNull.Value)
                                warehousePurchaseOrder.IdPaymentType = Convert.ToInt64(mySqlDataReader["IdPaymentType"]);

                            if (mySqlDataReader["ReminderEmailDate"] != DBNull.Value)
                                warehousePurchaseOrder.ReminderEmailDate = Convert.ToDateTime(mySqlDataReader["ReminderEmailDate"]);

                            if (mySqlDataReader["CreatedIn"] != DBNull.Value)
                                warehousePurchaseOrder.CreatedIn = Convert.ToDateTime(mySqlDataReader["CreatedIn"]);

                            if (mySqlDataReader["ModifiedIn"] != DBNull.Value)
                                warehousePurchaseOrder.ModifiedIn = Convert.ToDateTime(mySqlDataReader["ModifiedIn"]);

                            if (mySqlDataReader["Comments"] != DBNull.Value)
                                warehousePurchaseOrder.Comments = Convert.ToString(mySqlDataReader["Comments"]);

                            if (mySqlDataReader["IsClosed"] != DBNull.Value)
                                warehousePurchaseOrder.IsClosed = Convert.ToByte(mySqlDataReader["IsClosed"]);

                            if (mySqlDataReader["CreatedBy"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.CreatedBy = Convert.ToInt64(mySqlDataReader["CreatedBy"]);
                                warehousePurchaseOrder.Creator = new People();
                                warehousePurchaseOrder.Creator.IdPerson = Convert.ToInt32(mySqlDataReader["CreatedBy"].ToString());
                                warehousePurchaseOrder.Creator.Name = mySqlDataReader["CreatorName"].ToString();
                                warehousePurchaseOrder.Creator.Surname = mySqlDataReader["CreatorSurname"].ToString();
                            }

                            if (mySqlDataReader["ModifiedBy"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.ModifiedBy = Convert.ToInt64(mySqlDataReader["ModifiedBy"]);
                                warehousePurchaseOrder.Modifier = new People();
                                warehousePurchaseOrder.Modifier.IdPerson = Convert.ToInt32(mySqlDataReader["ModifiedBy"].ToString());
                                warehousePurchaseOrder.Modifier.Name = mySqlDataReader["ModifierName"].ToString();
                                warehousePurchaseOrder.Modifier.Surname = mySqlDataReader["ModifierSurname"].ToString();
                            }

                            if (mySqlDataReader["ReasonClosed"] != DBNull.Value)
                                warehousePurchaseOrder.ReasonClosed = Convert.ToString(mySqlDataReader["ReasonClosed"]);

                            if (mySqlDataReader["IdWarehouse"] != DBNull.Value)
                                warehousePurchaseOrder.IdWarehouse = Convert.ToInt64(mySqlDataReader["IdWarehouse"]);

                            if (mySqlDataReader["IdCurrency"] != DBNull.Value)
                                warehousePurchaseOrder.IdCurrency = Convert.ToByte(mySqlDataReader["IdCurrency"]);

                            if (mySqlDataReader["IdWorkflowStatus"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                warehousePurchaseOrder.WorkflowStatus = new WorkflowStatus();
                                warehousePurchaseOrder.WorkflowStatus.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                warehousePurchaseOrder.WorkflowStatus.Name = Convert.ToString(mySqlDataReader["Status"]);
                                warehousePurchaseOrder.WorkflowStatus.HtmlColor = Convert.ToString(mySqlDataReader["StatusHtmlColor"]);
                            }

                            if (mySqlDataReader["IdAssignee"] != DBNull.Value)
                                warehousePurchaseOrder.IdAssignee = Convert.ToUInt32(mySqlDataReader["IdAssignee"]);

                            if (mySqlDataReader["IdApprover"] != DBNull.Value)
                                warehousePurchaseOrder.IdApprover = Convert.ToUInt32(mySqlDataReader["IdApprover"]);

                            warehousePurchaseOrder.WarehousePurchaseOrderItems = GetArticlesByIdWarehousePurchaseOrder_V2110(connectionString, warehousePurchaseOrder.IdWarehousePurchaseOrder);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetPendingPOByIdWarehousePurchaseOrder_ForReminderMail(idWarehousePurchaseOrder-{0}), ErrorMessage- {1} ", idWarehousePurchaseOrder, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            Log4NetLogger.Logger.Log("Executed GetPendingPOByIdWarehousePurchaseOrder_ForReminderMail().", category: Category.Info, priority: Priority.Low);
            return warehousePurchaseOrder;
        }

        public WarehousePurchaseOrder GetPendingPOByIdWarehousePurchaseOrder_ForReminderMail_V2650(string connectionString, Int64 idWarehousePurchaseOrder, long _IdWarehouse)
        {
            WarehousePurchaseOrder warehousePurchaseOrder = null;

            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetPendingPOByIdWarehousePurchaseOrder_V2650", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", idWarehousePurchaseOrder);
                mySqlCommand.Parameters.AddWithValue("_IdWarehouse", _IdWarehouse);

                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    if (mySqlDataReader.Read())
                    {
                        try
                        {
                            warehousePurchaseOrder = new WarehousePurchaseOrder();

                            warehousePurchaseOrder.IdWarehousePurchaseOrder = idWarehousePurchaseOrder;

                            if (mySqlDataReader["Code"] != DBNull.Value)
                                warehousePurchaseOrder.Code = Convert.ToString(mySqlDataReader["Code"]);

                            if (mySqlDataReader["IdArticleSupplier"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                                ArticleSupplier articleSupplier = new ArticleSupplier();
                                articleSupplier.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                                if (mySqlDataReader["Supplier"] != DBNull.Value)
                                    articleSupplier.Name = Convert.ToString(mySqlDataReader["Supplier"]);

                                if (mySqlDataReader["SupplierContactPerson"] != DBNull.Value)
                                    articleSupplier.ContactPerson = Convert.ToString(mySqlDataReader["SupplierContactPerson"]);

                                if (mySqlDataReader["SupplierContactEmail"] != DBNull.Value)
                                    articleSupplier.ContactEmail = Convert.ToString(mySqlDataReader["SupplierContactEmail"]);

                                if (mySqlDataReader["Serie"] != DBNull.Value)
                                    articleSupplier.Serie = Convert.ToChar(mySqlDataReader["Serie"]);

                                if (mySqlDataReader["IdCountry"] != DBNull.Value)
                                {
                                    articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["IdCountry"]);

                                    articleSupplier.Country = new Country();
                                    articleSupplier.Country.IdCountry = (byte)articleSupplier.IdCountry;
                                    articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);

                                    if (mySqlDataReader["SupplierCountryISO"] != DBNull.Value)
                                    {
                                        articleSupplier.Country.Iso = Convert.ToString(mySqlDataReader["SupplierCountryISO"]);
                                    }

                                    if (mySqlDataReader["IdCountryGroup"] != DBNull.Value)
                                        articleSupplier.Country.IdCountryGroup = Convert.ToInt64(mySqlDataReader["IdCountryGroup"]);
                                }

                                if (mySqlDataReader["IdArticleSupplierType"] != DBNull.Value)
                                {
                                    articleSupplier.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["IdArticleSupplierType"]);

                                    articleSupplier.ArticleSupplierType = new ArticleSupplierType();
                                    articleSupplier.ArticleSupplierType.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["IdArticleSupplierType"]);
                                    articleSupplier.ArticleSupplierType.Name = Convert.ToString(mySqlDataReader["ArticleSupplierType"]);
                                    articleSupplier.ArticleSupplierType.HtmlColor = Convert.ToString(mySqlDataReader["HtmlColor"]);
                                }

                                warehousePurchaseOrder.ArticleSupplier = articleSupplier;
                            }

                            if (mySqlDataReader["DeliveryDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["deliveryDate"]) != DateTime.MinValue)
                            {
                                warehousePurchaseOrder.DeliveryDate = Convert.ToDateTime(mySqlDataReader["deliveryDate"]);
                            }

                            if (mySqlDataReader["AttachedPO"] != DBNull.Value)
                                warehousePurchaseOrder.AttachedPO = Convert.ToByte(mySqlDataReader["AttachedPO"]);

                            if (mySqlDataReader["IdPaymentType"] != DBNull.Value)
                                warehousePurchaseOrder.IdPaymentType = Convert.ToInt64(mySqlDataReader["IdPaymentType"]);

                            if (mySqlDataReader["ReminderEmailDate"] != DBNull.Value)
                                warehousePurchaseOrder.ReminderEmailDate = Convert.ToDateTime(mySqlDataReader["ReminderEmailDate"]);

                            if (mySqlDataReader["CreatedIn"] != DBNull.Value)
                                warehousePurchaseOrder.CreatedIn = Convert.ToDateTime(mySqlDataReader["CreatedIn"]);

                            if (mySqlDataReader["ModifiedIn"] != DBNull.Value)
                                warehousePurchaseOrder.ModifiedIn = Convert.ToDateTime(mySqlDataReader["ModifiedIn"]);

                            if (mySqlDataReader["Comments"] != DBNull.Value)
                                warehousePurchaseOrder.Comments = Convert.ToString(mySqlDataReader["Comments"]);

                            if (mySqlDataReader["IsClosed"] != DBNull.Value)
                                warehousePurchaseOrder.IsClosed = Convert.ToByte(mySqlDataReader["IsClosed"]);

                            if (mySqlDataReader["CreatedBy"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.CreatedBy = Convert.ToInt64(mySqlDataReader["CreatedBy"]);
                                warehousePurchaseOrder.Creator = new People();
                                warehousePurchaseOrder.Creator.IdPerson = Convert.ToInt32(mySqlDataReader["CreatedBy"].ToString());
                                warehousePurchaseOrder.Creator.Name = mySqlDataReader["CreatorName"].ToString();
                                warehousePurchaseOrder.Creator.Surname = mySqlDataReader["CreatorSurname"].ToString();
                            }

                            if (mySqlDataReader["ModifiedBy"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.ModifiedBy = Convert.ToInt64(mySqlDataReader["ModifiedBy"]);
                                warehousePurchaseOrder.Modifier = new People();
                                warehousePurchaseOrder.Modifier.IdPerson = Convert.ToInt32(mySqlDataReader["ModifiedBy"].ToString());
                                warehousePurchaseOrder.Modifier.Name = mySqlDataReader["ModifierName"].ToString();
                                warehousePurchaseOrder.Modifier.Surname = mySqlDataReader["ModifierSurname"].ToString();
                            }

                            if (mySqlDataReader["ReasonClosed"] != DBNull.Value)
                                warehousePurchaseOrder.ReasonClosed = Convert.ToString(mySqlDataReader["ReasonClosed"]);

                            if (mySqlDataReader["IdWarehouse"] != DBNull.Value)
                                warehousePurchaseOrder.IdWarehouse = Convert.ToInt64(mySqlDataReader["IdWarehouse"]);

                            if (mySqlDataReader["IdCurrency"] != DBNull.Value)
                                warehousePurchaseOrder.IdCurrency = Convert.ToByte(mySqlDataReader["IdCurrency"]);

                            if (mySqlDataReader["IdWorkflowStatus"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                warehousePurchaseOrder.WorkflowStatus = new WorkflowStatus();
                                warehousePurchaseOrder.WorkflowStatus.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                warehousePurchaseOrder.WorkflowStatus.Name = Convert.ToString(mySqlDataReader["Status"]);
                                warehousePurchaseOrder.WorkflowStatus.HtmlColor = Convert.ToString(mySqlDataReader["StatusHtmlColor"]);
                            }

                            if (mySqlDataReader["IdAssignee"] != DBNull.Value)
                                warehousePurchaseOrder.IdAssignee = Convert.ToUInt32(mySqlDataReader["IdAssignee"]);

                            if (mySqlDataReader["IdApprover"] != DBNull.Value)
                                warehousePurchaseOrder.IdApprover = Convert.ToUInt32(mySqlDataReader["IdApprover"]);

                            warehousePurchaseOrder.WarehousePurchaseOrderItems = GetArticlesByIdWarehousePurchaseOrder_V2110(connectionString, warehousePurchaseOrder.IdWarehousePurchaseOrder);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetPendingPOByIdWarehousePurchaseOrder_ForReminderMail_V2650(idWarehousePurchaseOrder-{0}), ErrorMessage- {1} ", idWarehousePurchaseOrder, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            Log4NetLogger.Logger.Log("Executed GetPendingPOByIdWarehousePurchaseOrder_ForReminderMail_V2650().", category: Category.Info, priority: Priority.Low);
            return warehousePurchaseOrder;
        }
        #endregion
        #region V2240

        //GEOS_3434


        #region Insert methods

        //GEOS_3434


        public Contacts AddContact(string mainServerConnectionString, Contacts contacts)
        {
            TransactionScope transactionScope = null;
            try
            {
                using (transactionScope = new TransactionScope())
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("SRM_Contacts_Insert_Update", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_Idcontact", contacts.IdContact);
                        mySqlCommand.Parameters.AddWithValue("_Firstname", contacts.Firstname);
                        mySqlCommand.Parameters.AddWithValue("_Lastname", contacts.Lastname);
                        mySqlCommand.Parameters.AddWithValue("_IdGender", contacts.IdGender);
                        mySqlCommand.Parameters.AddWithValue("_Email", contacts.Email);
                        mySqlCommand.Parameters.AddWithValue("_Phone", contacts.Phone);
                        mySqlCommand.Parameters.AddWithValue("_IdDepartment", contacts.IdDepartment);
                        mySqlCommand.Parameters.AddWithValue("_JobTitle", contacts.JobTitle);
                        mySqlCommand.Parameters.AddWithValue("_Image", contacts.ImageText);

                        contacts.IdContact = Convert.ToInt32(mySqlCommand.ExecuteScalar());
                        mySqlConnection.Close();
                    }

                    transactionScope.Complete();
                }
            }
            catch (Exception ex)
            {
                if (Transaction.Current != null)
                    Transaction.Current.Rollback();

                if (transactionScope != null)
                    transactionScope.Dispose();

                Log4NetLogger.Logger.Log(string.Format("Error AddContact(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return contacts;
        }

        public void ArticleSupplierContacts_Insert(string connectionString, int idContact, Int64 idArticleSupplier)
        {
            TransactionScope transactionScope = null;
            try
            {
                using (transactionScope = new TransactionScope())
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("SRM_ArticleSupplierContacts_Insert;", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdArticleSupplier", idArticleSupplier);
                        mySqlCommand.Parameters.AddWithValue("_IdContact", idContact);
                        mySqlCommand.Parameters.AddWithValue("_IsMainContact", null);

                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }

                    transactionScope.Complete();
                }
            }
            catch (Exception ex)
            {
                if (Transaction.Current != null)
                    Transaction.Current.Rollback();

                if (transactionScope != null)
                    transactionScope.Dispose();

                Log4NetLogger.Logger.Log(string.Format("Error ArticleSuppliercontacts_Insert(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

        }

        public Contacts GetContacts(string connectionString, int idContact)
        {
            Contacts contacts = new Contacts();

            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();

                MySqlCommand activitiesCommand = new MySqlCommand("SRM_GetContacts", mySqlConnection);
                activitiesCommand.CommandType = CommandType.StoredProcedure;
                activitiesCommand.Parameters.AddWithValue("_IdContact", idContact);

                using (MySqlDataReader poReader = activitiesCommand.ExecuteReader())
                {
                    while (poReader.Read())
                    {
                        try
                        {
                            if (poReader["IdContact"] != DBNull.Value)
                                contacts.IdContact = Convert.ToInt32(poReader["IdContact"]);

                            if (poReader["Firstname"] != DBNull.Value)
                                contacts.Firstname = Convert.ToString(poReader["Firstname"]);

                            if (poReader["Lastname"] != DBNull.Value)
                                contacts.Lastname = Convert.ToString(poReader["Lastname"]);

                            if (poReader["IdGender"] != DBNull.Value)
                                contacts.IdGender = Convert.ToByte(poReader["IdGender"]);

                            if (poReader["Email"] != DBNull.Value)
                                contacts.Email = Convert.ToString(poReader["Email"]);

                            if (poReader["IdDepartment"] != DBNull.Value)
                                contacts.IdDepartment = Convert.ToInt32(poReader["IdDepartment"]);

                            if (poReader["JobTitle"] != DBNull.Value)
                                contacts.JobTitle = Convert.ToString(poReader["JobTitle"]);

                            if (poReader["Phone"] != DBNull.Value)
                                contacts.Phone = Convert.ToString(poReader["Phone"]);

                            if (poReader["Image"] != DBNull.Value)
                                contacts.ImageText = Convert.ToString(poReader["Image"]);

                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetContacts(idContact-{0}). ErrorMessage- {1}", idContact, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            Log4NetLogger.Logger.Log("Executed GetContacts().", category: Category.Info, priority: Priority.Low);
            return contacts;
        }

        public List<Contacts> GetAllContacts(string connectionString)
        {
            List<Contacts> allContactList = new List<Contacts>();
            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();

                MySqlCommand activitiesCommand = new MySqlCommand("SRM_GetAllContacts", mySqlConnection);
                activitiesCommand.CommandType = CommandType.StoredProcedure;

                using (MySqlDataReader poReader = activitiesCommand.ExecuteReader())
                {
                    while (poReader.Read())
                    {
                        try
                        {
                            Contacts contacts = new Contacts();

                            if (poReader["IdContact"] != DBNull.Value)
                                contacts.IdContact = Convert.ToInt32(poReader["IdContact"]);

                            if (poReader["Firstname"] != DBNull.Value)
                                contacts.Firstname = Convert.ToString(poReader["Firstname"]);

                            if (poReader["Lastname"] != DBNull.Value)
                                contacts.Lastname = Convert.ToString(poReader["Lastname"]);

                            if (poReader["IdGender"] != DBNull.Value)
                                contacts.IdGender = Convert.ToByte(poReader["IdGender"]);

                            if (poReader["Email"] != DBNull.Value)
                                contacts.Email = Convert.ToString(poReader["Email"]);

                            if (poReader["IdDepartment"] != DBNull.Value)
                                contacts.IdDepartment = Convert.ToInt32(poReader["IdDepartment"]);

                            if (poReader["JobTitle"] != DBNull.Value)
                                contacts.JobTitle = Convert.ToString(poReader["JobTitle"]);

                            if (poReader["Phone"] != DBNull.Value)
                                contacts.Phone = Convert.ToString(poReader["Phone"]);

                            if (poReader["Image"] != DBNull.Value)
                                contacts.ImageText = Convert.ToString(poReader["Image"]);

                            allContactList.Add(contacts);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetAllContacts(). ErrorMessage- ", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            Log4NetLogger.Logger.Log("Executed GetAllContacts().", category: Category.Info, priority: Priority.Low);
            return allContactList;
        }

        public List<Contacts> GetContactsByIdArticleSupplier(string connectionString, int idArticleSupplier)
        {
            List<Contacts> contactsList = new List<Contacts>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();

                MySqlCommand activitiesCommand = new MySqlCommand("SRM_GetContactsByIdArticleSupplier", mySqlConnection);
                activitiesCommand.CommandType = CommandType.StoredProcedure;
                activitiesCommand.Parameters.AddWithValue("_IdArticleSupplier", idArticleSupplier);

                using (MySqlDataReader poReader = activitiesCommand.ExecuteReader())
                {
                    while (poReader.Read())
                    {
                        try
                        {
                            Contacts contacts = new Contacts();

                            if (poReader["IdContact"] != DBNull.Value)
                                contacts.IdContact = Convert.ToInt32(poReader["IdContact"]);

                            if (poReader["Firstname"] != DBNull.Value)
                                contacts.Firstname = Convert.ToString(poReader["Firstname"]);

                            if (poReader["Lastname"] != DBNull.Value)
                                contacts.Lastname = Convert.ToString(poReader["Lastname"]);

                            if (poReader["IdGender"] != DBNull.Value)
                                contacts.IdGender = Convert.ToByte(poReader["IdGender"]);

                            if (poReader["Email"] != DBNull.Value)
                                contacts.Email = Convert.ToString(poReader["Email"]);

                            if (poReader["IdDepartment"] != DBNull.Value)
                                contacts.IdDepartment = Convert.ToInt32(poReader["IdDepartment"]);

                            if (poReader["JobTitle"] != DBNull.Value)
                                contacts.JobTitle = Convert.ToString(poReader["JobTitle"]);

                            if (poReader["Phone"] != DBNull.Value)
                                contacts.Phone = Convert.ToString(poReader["Phone"]);

                            if (poReader["Image"] != DBNull.Value)
                                contacts.ImageText = Convert.ToString(poReader["Image"]);

                            if (poReader["IsMainContact"] != DBNull.Value)
                                contacts.IsMainContact = Convert.ToBoolean(poReader["IsMainContact"]);

                            contactsList.Add(contacts);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetContactsByIdArticleSupplier(idArticleSupplier-{0}). ErrorMessage- {1}", idArticleSupplier, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            Log4NetLogger.Logger.Log("Executed GetContactsByIdArticleSupplier().", category: Category.Info, priority: Priority.Low);

            return contactsList;
        }



        #endregion

        #region Get methods



        public ArticleSupplier GetArticleSupplierByIdArticleSupplier_V2240(Warehouses warehouse, UInt64 IdArticleSupplier)
        {
            string connectionString = warehouse.Company.ConnectPlantConstr;
            ArticleSupplier articleSupplier = null;

            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetArticleSupplierByIdArticleSupplier_V2240", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdArticleSupplier", IdArticleSupplier);

                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    while (mySqlDataReader.Read())
                    {
                        try
                        {
                            articleSupplier = new ArticleSupplier();

                            articleSupplier.IdArticleSupplier = Convert.ToInt64(IdArticleSupplier);

                            articleSupplier.Code = "SUPL" + articleSupplier.IdArticleSupplier.ToString().PadLeft(6, '0');

                            if (mySqlDataReader["name"] != DBNull.Value)
                                articleSupplier.Name = Convert.ToString(mySqlDataReader["name"]);

                            if (mySqlDataReader["Cif"] != DBNull.Value)
                                articleSupplier.Cif = Convert.ToString(mySqlDataReader["Cif"]);

                            if (mySqlDataReader["serie"] != DBNull.Value)
                                articleSupplier.Serie = Convert.ToChar(mySqlDataReader["serie"]);

                            if (mySqlDataReader["Observations"] != DBNull.Value)
                                articleSupplier.Observations = Convert.ToString(mySqlDataReader["Observations"]);

                            if (mySqlDataReader["lastOrder"] != DBNull.Value)
                                articleSupplier.LastOrderDate = Convert.ToDateTime(mySqlDataReader["lastOrder"].ToString());

                            if (mySqlDataReader["Phone1"] != DBNull.Value)
                                articleSupplier.Phone1 = Convert.ToString(mySqlDataReader["Phone1"]);

                            if (mySqlDataReader["Phone2"] != DBNull.Value)
                                articleSupplier.Phone2 = Convert.ToString(mySqlDataReader["Phone2"]);

                            if (mySqlDataReader["Email"] != DBNull.Value)
                                articleSupplier.Email = Convert.ToString(mySqlDataReader["Email"]);

                            if (mySqlDataReader["fax"] != DBNull.Value)
                                articleSupplier.Fax = Convert.ToString(mySqlDataReader["fax"]);

                            if (mySqlDataReader["Web"] != DBNull.Value)
                                articleSupplier.Web = Convert.ToString(mySqlDataReader["Web"]);

                            if (mySqlDataReader["Address"] != DBNull.Value)
                                articleSupplier.Address = Convert.ToString(mySqlDataReader["Address"]);

                            if (mySqlDataReader["City"] != DBNull.Value)
                                articleSupplier.City = Convert.ToString(mySqlDataReader["City"]);

                            if (mySqlDataReader["PostCode"] != DBNull.Value)
                                articleSupplier.PostCode = Convert.ToString(mySqlDataReader["PostCode"]);

                            if (mySqlDataReader["idcountry"] != DBNull.Value)
                            {
                                articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["idcountry"]);

                                articleSupplier.Country = new Country();
                                articleSupplier.Country.IdCountry = Convert.ToByte(mySqlDataReader["idcountry"]);
                                articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);
                            }

                            if (mySqlDataReader["modifiedIn"] != DBNull.Value)
                                articleSupplier.ModifiedIn = Convert.ToDateTime(mySqlDataReader["modifiedIn"].ToString());

                            if (mySqlDataReader["createdIn"] != DBNull.Value)
                                articleSupplier.CreatedIn = Convert.ToDateTime(mySqlDataReader["createdIn"].ToString());

                            if (mySqlDataReader["State"] != DBNull.Value)
                                articleSupplier.Region = Convert.ToString(mySqlDataReader["State"]);

                            if (mySqlDataReader["Latitude"] != DBNull.Value)
                            {
                                articleSupplier.Latitude = Convert.ToDouble(mySqlDataReader["Latitude"]);
                                articleSupplier.Coordinates = articleSupplier.Latitude.ToString();
                            }

                            if (mySqlDataReader["Longitude"] != DBNull.Value)
                            {
                                articleSupplier.Longitude = Convert.ToDouble(mySqlDataReader["Longitude"]);
                                if (mySqlDataReader["Latitude"] != DBNull.Value)
                                {
                                    articleSupplier.Coordinates = articleSupplier.Latitude.ToString() + ", " + articleSupplier.Longitude.ToString();
                                }
                                else
                                {
                                    articleSupplier.Coordinates = articleSupplier.Longitude.ToString();
                                }
                            }
                            articleSupplier.ArticleList = GetArticlesByIdArticleSupplier(connectionString, IdArticleSupplier);
                            articleSupplier.DocumentList = GetDocumentsByIdArticleSupplier(connectionString, IdArticleSupplier);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetArticleSupplierByIdArticleSupplier(IdArticleSupplier-{0}), ErrorMessage- {1} ", IdArticleSupplier, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }

                    if (mySqlDataReader.NextResult())
                    {
                        while (mySqlDataReader.Read())
                        {
                            WarehousePurchaseOrder WarehousePurchaseOrder = new WarehousePurchaseOrder();
                            if (mySqlDataReader["Code"] != DBNull.Value)
                            {
                                if (articleSupplier.Orders == null)
                                {
                                    articleSupplier.Orders = new List<WarehousePurchaseOrder>();
                                }
                                WarehousePurchaseOrder.Code = Convert.ToString(mySqlDataReader["Code"]);
                                WarehousePurchaseOrder.IdWarehousePurchaseOrder = Convert.ToInt64(mySqlDataReader["IdWarehousePurchaseOrder"]);
                                if (mySqlDataReader["WpoDate"] != DBNull.Value)
                                {
                                    WarehousePurchaseOrder.CreatedIn = Convert.ToDateTime(mySqlDataReader["WpoDate"].ToString());
                                }

                            }
                            articleSupplier.Orders.Add(WarehousePurchaseOrder);
                        }

                    }
                }
            }
            return articleSupplier;
        }

        #endregion

        #endregion

        #region V2250

        /// <summary>
        /// Get Article Suppliers By Warehouse
        /// </summary>
        /// <param name="warehouse">The warehouse for connection string</param>
        /// <returns>List of Article Suppliers By Warehouse</returns>
        public List<ArticleSupplier> GetArticleSuppliersByWarehouse_V2250(Warehouses warehouse, string countryIconFilePath)
        {
            string connectionString = warehouse.Company.ConnectPlantConstr;
            List<ArticleSupplier> articleSuppliers = new List<ArticleSupplier>();
            List<string> countryISOs = new List<string>();
            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetArticleSuppliersByWarehouse_V2250", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdWarehouse", warehouse.IdWarehouse);

                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    while (mySqlDataReader.Read())
                    {
                        try
                        {
                            ArticleSupplier articleSupplier = new ArticleSupplier();

                            articleSupplier.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                            if (mySqlDataReader["name"] != DBNull.Value)
                                articleSupplier.Name = Convert.ToString(mySqlDataReader["name"]);

                            if (mySqlDataReader["IdCountry"] != DBNull.Value)
                            {
                                articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["IdCountry"]);

                                articleSupplier.Country = new Country();
                                articleSupplier.Country.IdCountry = Convert.ToByte(mySqlDataReader["IdCountry"]);
                                articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);
                                articleSupplier.Country.Iso = Convert.ToString(mySqlDataReader["Iso"]);
                                if (!countryISOs.Any(co => co.ToString() == articleSupplier.Country.Iso))
                                {
                                    countryISOs.Add(articleSupplier.Country.Iso);
                                }
                            }
                            if (mySqlDataReader["Cif"] != DBNull.Value)
                                articleSupplier.Cif = Convert.ToString(mySqlDataReader["Cif"]);

                            if (mySqlDataReader["City"] != DBNull.Value)
                                articleSupplier.City = Convert.ToString(mySqlDataReader["City"]);

                            if (mySqlDataReader["PostCode"] != DBNull.Value)
                                articleSupplier.PostCode = Convert.ToString(mySqlDataReader["PostCode"]);

                            if (mySqlDataReader["Address"] != DBNull.Value)
                                articleSupplier.Address = Convert.ToString(mySqlDataReader["Address"]);

                            if (mySqlDataReader["Email"] != DBNull.Value)
                                articleSupplier.Email = Convert.ToString(mySqlDataReader["Email"]);

                            if (mySqlDataReader["Web"] != DBNull.Value)
                                articleSupplier.Web = Convert.ToString(mySqlDataReader["Web"]);

                            if (mySqlDataReader["Phone1"] != DBNull.Value)
                                articleSupplier.Phone1 = Convert.ToString(mySqlDataReader["Phone1"]);

                            if (mySqlDataReader["Phone2"] != DBNull.Value)
                                articleSupplier.Phone2 = Convert.ToString(mySqlDataReader["Phone2"]);

                            if (mySqlDataReader["serie"] != DBNull.Value)
                                articleSupplier.Serie = Convert.ToChar(mySqlDataReader["serie"]);

                            if (mySqlDataReader["CreatedIn"] != DBNull.Value)
                                articleSupplier.CreatedIn = Convert.ToDateTime(mySqlDataReader["CreatedIn"].ToString());

                            if (mySqlDataReader["EnterpriseGroup"] != DBNull.Value)
                                articleSupplier.Group = Convert.ToString(mySqlDataReader["EnterpriseGroup"].ToString());

                            articleSuppliers.Add(articleSupplier);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetArticleSuppliersByWarehouse_V2250(). ErrorMessage-" + ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }
            foreach (string item in countryISOs)
            {
                byte[] bytes = null;
                bytes = GetCountryIconFileInBytes(item, countryIconFilePath);
                articleSuppliers.Where(ars => ars.Country.Iso == item).ToList().ForEach(oi => oi.Country.CountryIconBytes = bytes);
            }
            Log4NetLogger.Logger.Log("Executed GetArticleSuppliersByWarehouse_V2250().", category: Category.Info, priority: Priority.Low);
            return articleSuppliers;
        }

        public ArticleSupplier GetArticleSupplierByIdArticleSupplier_V2250(Warehouses warehouse, UInt64 IdArticleSupplier)
        {
            string connectionString = warehouse.Company.ConnectPlantConstr;
            ArticleSupplier articleSupplier = null;

            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetArticleSupplierByIdArticleSupplier_V2250", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdArticleSupplier", IdArticleSupplier);

                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    while (mySqlDataReader.Read())
                    {
                        try
                        {
                            articleSupplier = new ArticleSupplier();

                            articleSupplier.IdArticleSupplier = Convert.ToInt64(IdArticleSupplier);

                            articleSupplier.Code = "SUPL" + articleSupplier.IdArticleSupplier.ToString().PadLeft(6, '0');

                            if (mySqlDataReader["name"] != DBNull.Value)
                                articleSupplier.Name = Convert.ToString(mySqlDataReader["name"]);

                            if (mySqlDataReader["Cif"] != DBNull.Value)
                                articleSupplier.Cif = Convert.ToString(mySqlDataReader["Cif"]);

                            if (mySqlDataReader["serie"] != DBNull.Value)
                                articleSupplier.Serie = Convert.ToChar(mySqlDataReader["serie"]);

                            if (mySqlDataReader["Observations"] != DBNull.Value)
                                articleSupplier.Observations = Convert.ToString(mySqlDataReader["Observations"]);

                            if (mySqlDataReader["lastOrder"] != DBNull.Value)
                                articleSupplier.LastOrderDate = Convert.ToDateTime(mySqlDataReader["lastOrder"].ToString());

                            if (mySqlDataReader["Phone1"] != DBNull.Value)
                                articleSupplier.Phone1 = Convert.ToString(mySqlDataReader["Phone1"]);

                            if (mySqlDataReader["Phone2"] != DBNull.Value)
                                articleSupplier.Phone2 = Convert.ToString(mySqlDataReader["Phone2"]);

                            if (mySqlDataReader["Email"] != DBNull.Value)
                                articleSupplier.Email = Convert.ToString(mySqlDataReader["Email"]);

                            if (mySqlDataReader["fax"] != DBNull.Value)
                                articleSupplier.Fax = Convert.ToString(mySqlDataReader["fax"]);

                            if (mySqlDataReader["Web"] != DBNull.Value)
                                articleSupplier.Web = Convert.ToString(mySqlDataReader["Web"]);

                            if (mySqlDataReader["Address"] != DBNull.Value)
                                articleSupplier.Address = Convert.ToString(mySqlDataReader["Address"]);

                            if (mySqlDataReader["City"] != DBNull.Value)
                                articleSupplier.City = Convert.ToString(mySqlDataReader["City"]);

                            if (mySqlDataReader["PostCode"] != DBNull.Value)
                                articleSupplier.PostCode = Convert.ToString(mySqlDataReader["PostCode"]);

                            //[001][GEOS2-3440][pjadhav]
                            if (mySqlDataReader["idcountry"] != DBNull.Value)
                            {
                                articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["idcountry"]);
                                articleSupplier.Country = new Country();
                                articleSupplier.Country.IdCountry = Convert.ToByte(mySqlDataReader["idcountry"]);

                                if (mySqlDataReader["CountryName"] != DBNull.Value)
                                {
                                    articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);
                                }
                            }

                            if (mySqlDataReader["modifiedIn"] != DBNull.Value)
                                articleSupplier.ModifiedIn = Convert.ToDateTime(mySqlDataReader["modifiedIn"].ToString());

                            if (mySqlDataReader["createdIn"] != DBNull.Value)
                                articleSupplier.CreatedIn = Convert.ToDateTime(mySqlDataReader["createdIn"].ToString());

                            if (mySqlDataReader["State"] != DBNull.Value)
                                articleSupplier.Region = Convert.ToString(mySqlDataReader["State"]);

                            if (mySqlDataReader["Latitude"] != DBNull.Value)
                            {
                                articleSupplier.Latitude = Convert.ToDouble(mySqlDataReader["Latitude"]);
                                articleSupplier.Coordinates = articleSupplier.Latitude.ToString();
                            }

                            if (mySqlDataReader["Longitude"] != DBNull.Value)
                            {
                                articleSupplier.Longitude = Convert.ToDouble(mySqlDataReader["Longitude"]);
                                if (mySqlDataReader["Latitude"] != DBNull.Value)
                                {
                                    articleSupplier.Coordinates = articleSupplier.Latitude.ToString() + ", " + articleSupplier.Longitude.ToString();
                                }
                                else
                                {
                                    articleSupplier.Coordinates = articleSupplier.Longitude.ToString();
                                }
                            }
                            articleSupplier.ArticleList = GetArticlesByIdArticleSupplier(connectionString, IdArticleSupplier);
                            articleSupplier.DocumentList = GetDocumentsByIdArticleSupplier(connectionString, IdArticleSupplier);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetArticleSupplierByIdArticleSupplier_V2250(IdArticleSupplier-{0}), ErrorMessage- {1} ", IdArticleSupplier, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }

                    if (mySqlDataReader.NextResult())
                    {
                        while (mySqlDataReader.Read())
                        {
                            WarehousePurchaseOrder WarehousePurchaseOrder = new WarehousePurchaseOrder();
                            if (mySqlDataReader["Code"] != DBNull.Value)
                            {
                                if (articleSupplier.Orders == null)
                                {
                                    articleSupplier.Orders = new List<WarehousePurchaseOrder>();
                                }
                                WarehousePurchaseOrder.Code = Convert.ToString(mySqlDataReader["Code"]);
                                WarehousePurchaseOrder.IdWarehousePurchaseOrder = Convert.ToInt64(mySqlDataReader["IdWarehousePurchaseOrder"]);
                                if (mySqlDataReader["WpoDate"] != DBNull.Value)
                                {
                                    WarehousePurchaseOrder.CreatedIn = Convert.ToDateTime(mySqlDataReader["WpoDate"].ToString());
                                }

                            }
                            articleSupplier.Orders.Add(WarehousePurchaseOrder);
                        }

                    }

                    if (mySqlDataReader.NextResult())
                    {
                        while (mySqlDataReader.Read())
                        {
                            ArticleSupplierPlants articleSupplierPlants = new ArticleSupplierPlants();
                            if (mySqlDataReader["IdSite"] != DBNull.Value)
                            {
                                if (articleSupplier.Plants == null)
                                {
                                    articleSupplier.Plants = new List<ArticleSupplierPlants>();
                                }
                                articleSupplierPlants.IdSite = Convert.ToInt64(mySqlDataReader["IdSite"]);
                                articleSupplierPlants.Name = Convert.ToString(mySqlDataReader["Name"]);
                                articleSupplierPlants.Allow = Convert.ToBoolean(mySqlDataReader["Allow"]);
                            }
                            articleSupplier.Plants.Add(articleSupplierPlants);
                        }

                    }
                }
            }
            articleSupplier.LogEntriesByArticleSuppliers = GetLogEntriesByArticleSuppliers(warehouse, IdArticleSupplier);
            return articleSupplier;
        }
        public ArticleSupplier GetArticleSupplierByIdArticleSupplier_V2301(Warehouses warehouse, UInt64 IdArticleSupplier)
        {
            string connectionString = warehouse.Company.ConnectPlantConstr;
            ArticleSupplier articleSupplier = null;

            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetArticleSupplierByIdArticleSupplier_V2301", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdArticleSupplier", IdArticleSupplier);

                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    while (mySqlDataReader.Read())
                    {
                        try
                        {
                            articleSupplier = new ArticleSupplier();

                            articleSupplier.IdArticleSupplier = Convert.ToInt64(IdArticleSupplier);

                            articleSupplier.Code = "SUPL" + articleSupplier.IdArticleSupplier.ToString().PadLeft(6, '0');

                            if (mySqlDataReader["name"] != DBNull.Value)
                                articleSupplier.Name = Convert.ToString(mySqlDataReader["name"]);

                            if (mySqlDataReader["Cif"] != DBNull.Value)
                                articleSupplier.Cif = Convert.ToString(mySqlDataReader["Cif"]);

                            if (mySqlDataReader["serie"] != DBNull.Value)
                                articleSupplier.Serie = Convert.ToChar(mySqlDataReader["serie"]);

                            if (mySqlDataReader["Observations"] != DBNull.Value)
                                articleSupplier.Observations = Convert.ToString(mySqlDataReader["Observations"]);

                            if (mySqlDataReader["lastOrder"] != DBNull.Value)
                                articleSupplier.LastOrderDate = Convert.ToDateTime(mySqlDataReader["lastOrder"].ToString());

                            if (mySqlDataReader["Phone1"] != DBNull.Value)
                                articleSupplier.Phone1 = Convert.ToString(mySqlDataReader["Phone1"]);

                            if (mySqlDataReader["Phone2"] != DBNull.Value)
                                articleSupplier.Phone2 = Convert.ToString(mySqlDataReader["Phone2"]);

                            if (mySqlDataReader["Email"] != DBNull.Value)
                                articleSupplier.Email = Convert.ToString(mySqlDataReader["Email"]);

                            if (mySqlDataReader["fax"] != DBNull.Value)
                                articleSupplier.Fax = Convert.ToString(mySqlDataReader["fax"]);

                            if (mySqlDataReader["Web"] != DBNull.Value)
                                articleSupplier.Web = Convert.ToString(mySqlDataReader["Web"]);

                            if (mySqlDataReader["Address"] != DBNull.Value)
                                articleSupplier.Address = Convert.ToString(mySqlDataReader["Address"]);

                            if (mySqlDataReader["City"] != DBNull.Value)
                                articleSupplier.City = Convert.ToString(mySqlDataReader["City"]);

                            if (mySqlDataReader["PostCode"] != DBNull.Value)
                                articleSupplier.PostCode = Convert.ToString(mySqlDataReader["PostCode"]);

                            //[001][GEOS2-3440][pjadhav]
                            if (mySqlDataReader["idcountry"] != DBNull.Value)
                            {
                                articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["idcountry"]);
                                articleSupplier.Country = new Country();
                                articleSupplier.Country.IdCountry = Convert.ToByte(mySqlDataReader["idcountry"]);

                                if (mySqlDataReader["CountryName"] != DBNull.Value)
                                {
                                    articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);
                                }
                            }

                            if (mySqlDataReader["IdEnterpriseGroup"] != DBNull.Value)
                            {

                                articleSupplier.IdEnterpriseGroup = Convert.ToInt32(mySqlDataReader["IdEnterpriseGroup"]);
                                articleSupplier.EnterpriseGroup = new Group();
                                articleSupplier.EnterpriseGroup.IdEnterpriseGroup = Convert.ToInt32(mySqlDataReader["IdEnterpriseGroup"]);
                                if (mySqlDataReader["groupName"] != DBNull.Value)
                                {
                                    articleSupplier.EnterpriseGroup.Name = Convert.ToString(mySqlDataReader["groupName"]);
                                }
                            }
                            if (mySqlDataReader["idArticleSupplierType"] != DBNull.Value)
                            {

                                articleSupplier.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["idArticleSupplierType"]);
                                articleSupplier.ArticleSupplierType = new ArticleSupplierType();
                                articleSupplier.ArticleSupplierType.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["idArticleSupplierType"]);
                                if (mySqlDataReader["CategoryName"] != DBNull.Value)
                                {
                                    articleSupplier.ArticleSupplierType.Name = Convert.ToString(mySqlDataReader["CategoryName"]);
                                }
                            }
                            if (mySqlDataReader["IdPaymentType"] != DBNull.Value)
                            {

                                articleSupplier.IdPaymentType = Convert.ToInt64(mySqlDataReader["IdPaymentType"]);
                                articleSupplier.PaymentTerm = new PaymentTerm();
                                articleSupplier.PaymentTerm.IdPaymentType = Convert.ToInt32(mySqlDataReader["IdPaymentType"]);
                                if (mySqlDataReader["paymentType"] != DBNull.Value)
                                {
                                    articleSupplier.PaymentTerm.PaymentType = Convert.ToString(mySqlDataReader["paymentType"]);
                                }
                            }


                            if (mySqlDataReader["modifiedIn"] != DBNull.Value)
                                articleSupplier.ModifiedIn = Convert.ToDateTime(mySqlDataReader["modifiedIn"].ToString());

                            if (mySqlDataReader["createdIn"] != DBNull.Value)
                                articleSupplier.CreatedIn = Convert.ToDateTime(mySqlDataReader["createdIn"].ToString());

                            if (mySqlDataReader["State"] != DBNull.Value)
                                articleSupplier.Region = Convert.ToString(mySqlDataReader["State"]);

                            if (mySqlDataReader["Latitude"] != DBNull.Value)
                            {
                                articleSupplier.Latitude = Convert.ToDouble(mySqlDataReader["Latitude"]);
                                articleSupplier.Coordinates = articleSupplier.Latitude.ToString();
                            }

                            if (mySqlDataReader["Longitude"] != DBNull.Value)
                            {
                                articleSupplier.Longitude = Convert.ToDouble(mySqlDataReader["Longitude"]);
                                if (mySqlDataReader["Latitude"] != DBNull.Value)
                                {
                                    articleSupplier.Coordinates = articleSupplier.Latitude.ToString() + ", " + articleSupplier.Longitude.ToString();
                                }
                                else
                                {
                                    articleSupplier.Coordinates = articleSupplier.Longitude.ToString();
                                }
                            }

                            if (mySqlDataReader["OrdersReceptionMethod"] != DBNull.Value)
                            {

                                articleSupplier.IdOrderReceptionLookup = Convert.ToInt32(mySqlDataReader["OrdersReceptionMethod"]);
                                articleSupplier.OrderReceptionLookup = new LookupValue();
                                articleSupplier.OrderReceptionLookup.IdLookupValue = Convert.ToInt32(mySqlDataReader["OrdersReceptionMethod"]);
                                if (mySqlDataReader["OrdersReceptionMethodValue"] != DBNull.Value)
                                {
                                    articleSupplier.OrderReceptionLookup.Value = Convert.ToString(mySqlDataReader["OrdersReceptionMethodValue"]);
                                }
                                if (mySqlDataReader["OrdersReceptionMethodHtmlColor"] != DBNull.Value)
                                {
                                    articleSupplier.OrderReceptionLookup.HtmlColor = Convert.ToString(mySqlDataReader["OrdersReceptionMethodHtmlColor"]);
                                }
                            }
                            articleSupplier.ArticleList = GetArticlesByIdArticleSupplier(connectionString, IdArticleSupplier);
                            articleSupplier.DocumentList = GetDocumentsByIdArticleSupplier(connectionString, IdArticleSupplier);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetArticleSupplierByIdArticleSupplier_V2250(IdArticleSupplier-{0}), ErrorMessage- {1} ", IdArticleSupplier, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }

                    if (mySqlDataReader.NextResult())
                    {
                        while (mySqlDataReader.Read())
                        {
                            WarehousePurchaseOrder WarehousePurchaseOrder = new WarehousePurchaseOrder();
                            if (mySqlDataReader["Code"] != DBNull.Value)
                            {
                                if (articleSupplier.Orders == null)
                                {
                                    articleSupplier.Orders = new List<WarehousePurchaseOrder>();
                                }
                                WarehousePurchaseOrder.Code = Convert.ToString(mySqlDataReader["Code"]);
                                WarehousePurchaseOrder.IdWarehousePurchaseOrder = Convert.ToInt64(mySqlDataReader["IdWarehousePurchaseOrder"]);
                                if (mySqlDataReader["WpoDate"] != DBNull.Value)
                                {
                                    WarehousePurchaseOrder.CreatedIn = Convert.ToDateTime(mySqlDataReader["WpoDate"].ToString());
                                }

                            }
                            articleSupplier.Orders.Add(WarehousePurchaseOrder);
                        }

                    }

                    if (mySqlDataReader.NextResult())
                    {
                        while (mySqlDataReader.Read())
                        {
                            ArticleSupplierPlants articleSupplierPlants = new ArticleSupplierPlants();
                            if (mySqlDataReader["IdSite"] != DBNull.Value)
                            {
                                if (articleSupplier.Plants == null)
                                {
                                    articleSupplier.Plants = new List<ArticleSupplierPlants>();
                                }
                                articleSupplierPlants.IdSite = Convert.ToInt64(mySqlDataReader["IdSite"]);
                                articleSupplierPlants.Name = Convert.ToString(mySqlDataReader["Name"]);
                                articleSupplierPlants.Allow = Convert.ToBoolean(mySqlDataReader["Allow"]);
                            }
                            articleSupplier.Plants.Add(articleSupplierPlants);
                        }

                    }
                }
            }
            articleSupplier.LogEntriesByArticleSuppliers = GetLogEntriesByArticleSuppliers(warehouse, IdArticleSupplier);
            return articleSupplier;
        }

        public List<LogEntriesByArticleSuppliers> GetLogEntriesByArticleSuppliers(Warehouses warehouse, UInt64 IdArticleSupplier)
        {
            string connectionString = warehouse.Company.ConnectPlantConstr;
            List<LogEntriesByArticleSuppliers> logEntriesByArticleSuppliersList = new List<LogEntriesByArticleSuppliers>();
            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();
                MySqlCommand mySqlCommand = new MySqlCommand("SRM_Getlog_Entries_by_ArticleSuppliers", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdArticleSupplier", IdArticleSupplier);
                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    while (mySqlDataReader.Read())
                    {
                        try
                        {
                            LogEntriesByArticleSuppliers logEntriesByArticleSuppliers = new LogEntriesByArticleSuppliers();
                            if (mySqlDataReader["IdLogEntryByArticleSuppliers"] != DBNull.Value)
                                logEntriesByArticleSuppliers.IdLogEntryByArticleSuppliers = Convert.ToInt64(mySqlDataReader["IdLogEntryByArticleSuppliers"]);

                            if (mySqlDataReader["IdUser"] != DBNull.Value)
                            {
                                logEntriesByArticleSuppliers.IdUser = Convert.ToInt64(mySqlDataReader["IdUser"]);
                            }

                            if (mySqlDataReader["idArticleSupplier"] != DBNull.Value)
                            {
                                logEntriesByArticleSuppliers.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["idArticleSupplier"]);
                            }

                            if (mySqlDataReader["Datetime"] != DBNull.Value)
                            {
                                logEntriesByArticleSuppliers.Datetime = Convert.ToDateTime(mySqlDataReader["Datetime"]);
                            }

                            if (mySqlDataReader["Comments"] != DBNull.Value)
                            {
                                logEntriesByArticleSuppliers.Comments = Convert.ToString(mySqlDataReader["Comments"]);
                            }
                            if (mySqlDataReader["ChangeLogUser"] != DBNull.Value)
                            {
                                logEntriesByArticleSuppliers.ChangeLogUser = Convert.ToString(mySqlDataReader["ChangeLogUser"]);
                            }
                            logEntriesByArticleSuppliersList.Add(logEntriesByArticleSuppliers);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetLogEntriesByArticleSuppliers(IdArticleSupplier-{0}), ErrorMessage- {1} ", IdArticleSupplier, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }

                    }
                }
            }
            return logEntriesByArticleSuppliersList;
        }

        public bool DeleteContacts(string connectionString, int idContact)
        {
            bool status;
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("SRM_Delete_contacts", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_idContact", idContact);
                    mySqlCommand.ExecuteNonQuery();
                    mySqlConnection.Close();
                    status = true;
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error DeleteContacts(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return status;
        }

        public void AddCommentsOrLogEntriesByArticleSuppliers(string MainServerConnectionString, List<LogEntriesByArticleSuppliers> AddLogEntries)
        {
            try
            {
                if (AddLogEntries != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (LogEntriesByArticleSuppliers logEntriesByitem in AddLogEntries)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("SRM_AddLogEntriesByActionItem", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_idArticleSupplier", logEntriesByitem.IdArticleSupplier);
                            mySqlCommand.Parameters.AddWithValue("_IdUser", logEntriesByitem.IdUser);
                            mySqlCommand.Parameters.AddWithValue("_CreationDate", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                            mySqlCommand.Parameters.AddWithValue("_Comments", logEntriesByitem.Comments);
                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddCommentsOrLogEntriesByArticleSuppliers(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        public void ArticleSupplierContacts_Insert_V2250(string connectionString, int idContact, Int64 idArticleSupplier, List<LogEntriesByArticleSuppliers> ArticleSuppliersChangeLogList)
        {
            TransactionScope transactionScope = null;
            try
            {
                using (transactionScope = new TransactionScope())
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("SRM_ArticleSupplierContacts_Insert;", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdArticleSupplier", idArticleSupplier);
                        mySqlCommand.Parameters.AddWithValue("_IdContact", idContact);
                        mySqlCommand.Parameters.AddWithValue("_IsMainContact", null);

                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }

                    transactionScope.Complete();
                }

            }
            catch (Exception ex)
            {
                if (Transaction.Current != null)
                    Transaction.Current.Rollback();

                if (transactionScope != null)
                    transactionScope.Dispose();

                Log4NetLogger.Logger.Log(string.Format("Error ArticleSupplierContacts_Insert_V2250(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

        }

        public bool SetIsMainContact(string connectionString, int idContact, Int64 IdArticleSupplier)
        {
            bool status;
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("SRM_Update_IsMainContact", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_idContact", idContact);
                    mySqlCommand.Parameters.AddWithValue("_IdArticleSupplier", IdArticleSupplier);
                    mySqlCommand.ExecuteNonQuery();
                    mySqlConnection.Close();
                    status = true;
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error SetIsMainContact(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return status;
        }


        public Contacts AddContact_V2250(string mainServerConnectionString, Contacts contacts, List<LogEntriesByArticleSuppliers> ArticleSuppliersChangeLogList)
        {
            TransactionScope transactionScope = null;
            try
            {
                using (transactionScope = new TransactionScope())
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("SRM_Contacts_Insert_Update_V2250", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_Idcontact", contacts.IdContact);
                        mySqlCommand.Parameters.AddWithValue("_Firstname", contacts.Firstname);
                        mySqlCommand.Parameters.AddWithValue("_Lastname", contacts.Lastname);
                        mySqlCommand.Parameters.AddWithValue("_IdGender", contacts.IdGender);
                        mySqlCommand.Parameters.AddWithValue("_Email", contacts.Email);
                        mySqlCommand.Parameters.AddWithValue("_Phone", contacts.Phone);
                        mySqlCommand.Parameters.AddWithValue("_IdDepartment", contacts.IdDepartment);
                        mySqlCommand.Parameters.AddWithValue("_JobTitle", contacts.JobTitle);
                        mySqlCommand.Parameters.AddWithValue("_Image", contacts.ImageText);
                        mySqlCommand.Parameters.AddWithValue("_Remarks", contacts.Remarks);

                        contacts.IdContact = Convert.ToInt32(mySqlCommand.ExecuteScalar());
                        mySqlConnection.Close();
                    }

                    transactionScope.Complete();
                }
                AddCommentsOrLogEntriesByArticleSuppliers(mainServerConnectionString, ArticleSuppliersChangeLogList);
            }
            catch (Exception ex)
            {
                if (Transaction.Current != null)
                    Transaction.Current.Rollback();

                if (transactionScope != null)
                    transactionScope.Dispose();

                Log4NetLogger.Logger.Log(string.Format("Error AddContact_V2250(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return contacts;
        }
        public Contacts GetContacts_V2250(string connectionString, int idContact)
        {
            Contacts contacts = new Contacts();

            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();

                MySqlCommand activitiesCommand = new MySqlCommand("SRM_GetContacts_V2250", mySqlConnection);
                activitiesCommand.CommandType = CommandType.StoredProcedure;
                activitiesCommand.Parameters.AddWithValue("_IdContact", idContact);

                using (MySqlDataReader poReader = activitiesCommand.ExecuteReader())
                {
                    while (poReader.Read())
                    {
                        try
                        {
                            if (poReader["IdContact"] != DBNull.Value)
                                contacts.IdContact = Convert.ToInt32(poReader["IdContact"]);

                            if (poReader["Firstname"] != DBNull.Value)
                                contacts.Firstname = Convert.ToString(poReader["Firstname"]);

                            if (poReader["Lastname"] != DBNull.Value)
                                contacts.Lastname = Convert.ToString(poReader["Lastname"]);

                            if (poReader["IdGender"] != DBNull.Value)
                                contacts.IdGender = Convert.ToByte(poReader["IdGender"]);

                            if (poReader["Email"] != DBNull.Value)
                                contacts.Email = Convert.ToString(poReader["Email"]);

                            if (poReader["IdDepartment"] != DBNull.Value)
                                contacts.IdDepartment = Convert.ToInt32(poReader["IdDepartment"]);

                            if (poReader["JobTitle"] != DBNull.Value)
                                contacts.JobTitle = Convert.ToString(poReader["JobTitle"]);

                            if (poReader["Phone"] != DBNull.Value)
                                contacts.Phone = Convert.ToString(poReader["Phone"]);

                            if (poReader["Image"] != DBNull.Value)
                                contacts.ImageText = Convert.ToString(poReader["Image"]);

                            if (poReader["Remarks"] != DBNull.Value)
                                contacts.Remarks = Convert.ToString(poReader["Remarks"]);

                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetContacts_V2250(idContact-{0}). ErrorMessage- {1}", idContact, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }
            return contacts;
        }

        public List<Contacts> GetAllContacts_V2250(string connectionString)
        {
            List<Contacts> allContactList = new List<Contacts>();
            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();

                MySqlCommand activitiesCommand = new MySqlCommand("SRM_GetAllContacts_V2250", mySqlConnection);
                activitiesCommand.CommandType = CommandType.StoredProcedure;

                using (MySqlDataReader poReader = activitiesCommand.ExecuteReader())
                {
                    while (poReader.Read())
                    {
                        try
                        {
                            Contacts contacts = new Contacts();

                            if (poReader["IdContact"] != DBNull.Value)
                                contacts.IdContact = Convert.ToInt32(poReader["IdContact"]);

                            if (poReader["Firstname"] != DBNull.Value)
                                contacts.Firstname = Convert.ToString(poReader["Firstname"]);

                            if (poReader["Lastname"] != DBNull.Value)
                                contacts.Lastname = Convert.ToString(poReader["Lastname"]);

                            if (poReader["IdGender"] != DBNull.Value)
                                contacts.IdGender = Convert.ToByte(poReader["IdGender"]);

                            if (poReader["Email"] != DBNull.Value)
                                contacts.Email = Convert.ToString(poReader["Email"]);

                            if (poReader["IdDepartment"] != DBNull.Value)
                                contacts.IdDepartment = Convert.ToInt32(poReader["IdDepartment"]);

                            if (poReader["JobTitle"] != DBNull.Value)
                                contacts.JobTitle = Convert.ToString(poReader["JobTitle"]);

                            if (poReader["Phone"] != DBNull.Value)
                                contacts.Phone = Convert.ToString(poReader["Phone"]);

                            if (poReader["Image"] != DBNull.Value)
                                contacts.ImageText = Convert.ToString(poReader["Image"]);

                            if (poReader["Remarks"] != DBNull.Value)
                                contacts.Remarks = Convert.ToString(poReader["Remarks"]);

                            allContactList.Add(contacts);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetAllContacts_V2250(). ErrorMessage- ", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }
            return allContactList;
        }
        #endregion
        #region Other methods
        static internal double CalculatePrice(double basePrice, int quantity, float discount, float iva, float overCost)
        {
            //[001] Round-Off the value for base price and then calculate the total value
            basePrice = Convert.ToDouble(basePrice.ToString("n5"));
            double total = (basePrice * quantity) * ((100 + iva) / 100) * ((100 - discount) / 100) * ((100 + overCost) / 100);
            return total;
        }
        #endregion

        #region connection methods

        /// <summary>
        /// This method is used to get connection string name exists or not by name.
        /// </summary>
        public bool IsConnectionStringNameExist(string Name)
        {
            bool isExist = false;
            ConnectionStringSettingsCollection settings = ConfigurationManager.ConnectionStrings;
            if (settings != null)
            {
                foreach (ConnectionStringSettings cs in settings)
                {
                    if (cs.Name == Name)
                    {
                        isExist = true;
                        return isExist;
                    }
                }
            }
            return isExist;
        }

        #endregion

        public WarehousePurchaseOrder GetPendingPOByIdWarehousePurchaseOrder_V2300(string connectionString, Int64 idWarehousePurchaseOrder, string purchaseOrdersPath, string emailTemplatePath, string countryIconFilePath)
        {
            WarehousePurchaseOrder warehousePurchaseOrder = null;

            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetPendingPOByIdWarehousePurchaseOrder_V2300", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", idWarehousePurchaseOrder);

                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    if (mySqlDataReader.Read())
                    {
                        try
                        {
                            warehousePurchaseOrder = new WarehousePurchaseOrder();

                            warehousePurchaseOrder.IdWarehousePurchaseOrder = idWarehousePurchaseOrder;

                            if (mySqlDataReader["Code"] != DBNull.Value)
                                warehousePurchaseOrder.Code = Convert.ToString(mySqlDataReader["Code"]);

                            if (mySqlDataReader["IdArticleSupplier"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                                ArticleSupplier articleSupplier = new ArticleSupplier();
                                articleSupplier.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                                if (mySqlDataReader["Supplier"] != DBNull.Value)
                                    articleSupplier.Name = Convert.ToString(mySqlDataReader["Supplier"]);

                                if (mySqlDataReader["SupplierContactPerson"] != DBNull.Value)
                                    articleSupplier.ContactPerson = Convert.ToString(mySqlDataReader["SupplierContactPerson"]);

                                if (mySqlDataReader["SupplierContactEmail"] != DBNull.Value)
                                    articleSupplier.ContactEmail = Convert.ToString(mySqlDataReader["SupplierContactEmail"]);

                                if (mySqlDataReader["Serie"] != DBNull.Value)
                                    articleSupplier.Serie = Convert.ToChar(mySqlDataReader["Serie"]);

                                if (mySqlDataReader["IdCountry"] != DBNull.Value)
                                {
                                    articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["IdCountry"]);

                                    articleSupplier.Country = new Country();
                                    articleSupplier.Country.IdCountry = (byte)articleSupplier.IdCountry;
                                    articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);

                                    if (mySqlDataReader["SupplierCountryISO"] != DBNull.Value)
                                    {
                                        articleSupplier.Country.Iso = Convert.ToString(mySqlDataReader["SupplierCountryISO"]);
                                        byte[] bytes = null;
                                        bytes = GetCountryIconFileInBytes(articleSupplier.Country.Iso, countryIconFilePath);
                                        articleSupplier.Country.CountryIconBytes = bytes;
                                    }

                                    if (mySqlDataReader["IdCountryGroup"] != DBNull.Value)
                                        articleSupplier.Country.IdCountryGroup = Convert.ToInt64(mySqlDataReader["IdCountryGroup"]);
                                }

                                if (mySqlDataReader["IdArticleSupplierType"] != DBNull.Value)
                                {
                                    articleSupplier.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["IdArticleSupplierType"]);

                                    articleSupplier.ArticleSupplierType = new ArticleSupplierType();
                                    articleSupplier.ArticleSupplierType.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["IdArticleSupplierType"]);
                                    articleSupplier.ArticleSupplierType.Name = Convert.ToString(mySqlDataReader["ArticleSupplierType"]);
                                    articleSupplier.ArticleSupplierType.HtmlColor = Convert.ToString(mySqlDataReader["HtmlColor"]);
                                }

                                warehousePurchaseOrder.ArticleSupplier = articleSupplier;
                            }

                            if (mySqlDataReader["DeliveryDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["deliveryDate"]) != DateTime.MinValue)
                            {
                                warehousePurchaseOrder.DeliveryDate = Convert.ToDateTime(mySqlDataReader["deliveryDate"]);
                            }

                            if (mySqlDataReader["AttachedPO"] != DBNull.Value)
                                warehousePurchaseOrder.AttachedPO = Convert.ToByte(mySqlDataReader["AttachedPO"]);

                            if (mySqlDataReader["IdPaymentType"] != DBNull.Value)
                                warehousePurchaseOrder.IdPaymentType = Convert.ToInt64(mySqlDataReader["IdPaymentType"]);

                            if (mySqlDataReader["ReminderEmailDate"] != DBNull.Value)
                                warehousePurchaseOrder.ReminderEmailDate = Convert.ToDateTime(mySqlDataReader["ReminderEmailDate"]);

                            if (mySqlDataReader["CreatedIn"] != DBNull.Value)
                                warehousePurchaseOrder.CreatedIn = Convert.ToDateTime(mySqlDataReader["CreatedIn"]);

                            if (mySqlDataReader["ModifiedIn"] != DBNull.Value)
                                warehousePurchaseOrder.ModifiedIn = Convert.ToDateTime(mySqlDataReader["ModifiedIn"]);

                            if (mySqlDataReader["Comments"] != DBNull.Value)
                                warehousePurchaseOrder.Comments = Convert.ToString(mySqlDataReader["Comments"]);

                            if (mySqlDataReader["IsClosed"] != DBNull.Value)
                                warehousePurchaseOrder.IsClosed = Convert.ToByte(mySqlDataReader["IsClosed"]);

                            if (mySqlDataReader["CreatedBy"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.CreatedBy = Convert.ToInt64(mySqlDataReader["CreatedBy"]);
                                warehousePurchaseOrder.Creator = new People();
                                warehousePurchaseOrder.Creator.IdPerson = Convert.ToInt32(mySqlDataReader["CreatedBy"].ToString());
                                warehousePurchaseOrder.Creator.Name = mySqlDataReader["CreatorName"].ToString();
                                warehousePurchaseOrder.Creator.Surname = mySqlDataReader["CreatorSurname"].ToString();
                            }

                            if (mySqlDataReader["ModifiedBy"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.ModifiedBy = Convert.ToInt64(mySqlDataReader["ModifiedBy"]);
                                warehousePurchaseOrder.Modifier = new People();
                                warehousePurchaseOrder.Modifier.IdPerson = Convert.ToInt32(mySqlDataReader["ModifiedBy"].ToString());
                                warehousePurchaseOrder.Modifier.Name = mySqlDataReader["ModifierName"].ToString();
                                warehousePurchaseOrder.Modifier.Surname = mySqlDataReader["ModifierSurname"].ToString();
                            }

                            if (mySqlDataReader["ReasonClosed"] != DBNull.Value)
                                warehousePurchaseOrder.ReasonClosed = Convert.ToString(mySqlDataReader["ReasonClosed"]);

                            if (mySqlDataReader["IdWarehouse"] != DBNull.Value)
                                warehousePurchaseOrder.IdWarehouse = Convert.ToInt64(mySqlDataReader["IdWarehouse"]);

                            if (mySqlDataReader["IdCurrency"] != DBNull.Value)
                                warehousePurchaseOrder.IdCurrency = Convert.ToByte(mySqlDataReader["IdCurrency"]);

                            if (mySqlDataReader["IdWorkflowStatus"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                warehousePurchaseOrder.WorkflowStatus = new WorkflowStatus();
                                warehousePurchaseOrder.WorkflowStatus.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                warehousePurchaseOrder.WorkflowStatus.Name = Convert.ToString(mySqlDataReader["Status"]);
                                warehousePurchaseOrder.WorkflowStatus.HtmlColor = Convert.ToString(mySqlDataReader["StatusHtmlColor"]);
                            }

                            if (mySqlDataReader["IdAssignee"] != DBNull.Value)
                                warehousePurchaseOrder.IdAssignee = Convert.ToUInt32(mySqlDataReader["IdAssignee"]);

                            if (mySqlDataReader["IdApprover"] != DBNull.Value)
                                warehousePurchaseOrder.IdApprover = Convert.ToUInt32(mySqlDataReader["IdApprover"]);

                            string HTMLFileName = null;
                            if (File.Exists(string.Format("{0}{1}SupplierPurchaseOrderRequestMailFormat_{2}-{3}.html", emailTemplatePath, @"\", warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower(), warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToUpper())))
                            {
                                HTMLFileName = string.Format("SupplierPurchaseOrderRequestMailFormat_{0}-{1}.html", warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower(), warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToUpper());
                            }
                            else if (File.Exists(string.Format("{0}{1}SupplierPurchaseOrderRequestMailFormat.html", emailTemplatePath, @"\")))
                            {
                                HTMLFileName = "SupplierPurchaseOrderRequestMailFormat.html";
                            }
                            if (HTMLFileName != null)
                            {
                                StringBuilder emailbody = new StringBuilder();
                                string text = ReadMailTemplate(HTMLFileName, emailTemplatePath);

                                if (string.IsNullOrEmpty(warehousePurchaseOrder.ArticleSupplier.ContactPerson))
                                {
                                    text = text.Replace("[Supplier_Name]", "Supplier");
                                }
                                else
                                {
                                    text = text.Replace("[Supplier_Name]", warehousePurchaseOrder.ArticleSupplier.ContactPerson);
                                }
                                text = text.Replace("[PO_Code]", warehousePurchaseOrder.Code);

                                emailbody.Append(text);

                                warehousePurchaseOrder.EmailBody = emailbody.ToString();
                            }
                            warehousePurchaseOrder.AttachPdf = warehousePurchaseOrder.CreatedIn.Year + @"\" + warehousePurchaseOrder.Code + @"\01 Purchase Order\PO_" + warehousePurchaseOrder.Code + ".pdf";

                            warehousePurchaseOrder.AttachmentBytes = GetPurchaseOrderPdf(purchaseOrdersPath, warehousePurchaseOrder.AttachPdf);
                            warehousePurchaseOrder.WarehouseDeliveryNotes = GetDeliveryNotesByIdWarehousePurchaseOrder(connectionString, warehousePurchaseOrder, purchaseOrdersPath);

                            warehousePurchaseOrder.WarehousePurchaseOrderItemWithComments = GetArticlesByIdWarehousePurchaseOrder_V2300(connectionString, warehousePurchaseOrder.IdWarehousePurchaseOrder);

                            warehousePurchaseOrder.WarehousePOComments = GetlogEntriesByWarehousePO(idWarehousePurchaseOrder, 252, connectionString);
                            warehousePurchaseOrder.WarehousePOLogEntries = GetlogEntriesByWarehousePO(idWarehousePurchaseOrder, 253, connectionString);

                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetPendingPOByIdWarehousePurchaseOrder_V2300(idWarehousePurchaseOrder-{0}), ErrorMessage- {1} ", idWarehousePurchaseOrder, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            return warehousePurchaseOrder;
        }
        public List<WarehousePurchaseOrderItemWithComments> GetArticlesByIdWarehousePurchaseOrder_V2300(string connectionString, Int64 idWarehousePurchaseOrder)
        {
            List<WarehousePurchaseOrderItemWithComments> warehousePurchaseOrderItems = new List<WarehousePurchaseOrderItemWithComments>();

            using (MySqlConnection connWarehousePurchaseOrderItem = new MySqlConnection(connectionString))
            {
                connWarehousePurchaseOrderItem.Open();

                MySqlCommand activitiesCommand = new MySqlCommand("SRM_GetArticlesAndPOItemsByIdWarehousePurchaseOrder_V2300", connWarehousePurchaseOrderItem);
                activitiesCommand.CommandType = CommandType.StoredProcedure;
                activitiesCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", idWarehousePurchaseOrder);

                using (MySqlDataReader poReader = activitiesCommand.ExecuteReader())
                {
                    while (poReader.Read())
                    {
                        try
                        {
                            WarehousePurchaseOrderItemWithComments warehousePurchaseOrderItem = new WarehousePurchaseOrderItemWithComments();

                            warehousePurchaseOrderItem.IdWarehousePurchaseOrder = idWarehousePurchaseOrder;

                            if (poReader["IdWarehousePurchaseOrderItem"] != DBNull.Value)
                                warehousePurchaseOrderItem.IdWarehousePurchaseOrderItem = Convert.ToInt64(poReader["IdWarehousePurchaseOrderItem"]);

                            if (poReader["Description"] != DBNull.Value)
                                warehousePurchaseOrderItem.Description = Convert.ToString(poReader["Description"]);

                            if (poReader["IdArticle"] != DBNull.Value)
                            {
                                warehousePurchaseOrderItem.IdArticle = Convert.ToInt32(poReader["IdArticle"]);

                                Article article = new Article();

                                if (poReader["Reference"] != DBNull.Value)
                                    article.Reference = Convert.ToString(poReader["Reference"]);

                                if (poReader["IsGeneric"] != DBNull.Value)
                                    article.IsGeneric = Convert.ToSByte(poReader["IsGeneric"]);

                                if (poReader["IdArticleCategory"] != DBNull.Value)
                                    article.IdArticleCategory = Convert.ToInt32(poReader["IdArticleCategory"]);

                                warehousePurchaseOrderItem.Article = article;
                            }

                            if (poReader["Quantity"] != DBNull.Value)
                                warehousePurchaseOrderItem.Quantity = Convert.ToInt32(poReader["Quantity"]);

                            if (poReader["UnitPrice"] != DBNull.Value)
                                warehousePurchaseOrderItem.UnitPrice = Convert.ToDouble(poReader["UnitPrice"]);

                            if (poReader["Discount"] != DBNull.Value)
                                warehousePurchaseOrderItem.Discount = Convert.ToDouble(poReader["Discount"]);

                            if (poReader["Iva"] != DBNull.Value)
                                warehousePurchaseOrderItem.IVA = Convert.ToDouble(poReader["Iva"]);

                            if (poReader["AdditionalComments"] != DBNull.Value)
                                warehousePurchaseOrderItem.AdditionalComments = Convert.ToString(poReader["AdditionalComments"]);

                            if (poReader["Position"] != DBNull.Value)
                                warehousePurchaseOrderItem.Position = Convert.ToInt64(poReader["Position"]);

                            if (poReader["AlbaranQty"] != DBNull.Value)
                                warehousePurchaseOrderItem.ReceivedQuantity = Convert.ToInt32(poReader["AlbaranQty"]);


                            if (poReader["TotalAmount"] != DBNull.Value)
                                warehousePurchaseOrderItem.TotalAmount = Convert.ToDecimal(poReader["TotalAmount"]);

                            if (poReader["TotalAmount"] != DBNull.Value)
                                warehousePurchaseOrderItem.TotalAmount_New = Convert.ToDouble(poReader["TotalAmount"]);

                            if (warehousePurchaseOrderItem.Quantity > 0)
                            {
                                warehousePurchaseOrderItem.Status = (Int32)(warehousePurchaseOrderItem.ReceivedQuantity / warehousePurchaseOrderItem.Quantity * 100);
                            }

                            warehousePurchaseOrderItem.WarehousePurchaseOrderExpectedItems = GetWarehousePOExpectedItems(connectionString, warehousePurchaseOrderItem.IdWarehousePurchaseOrderItem);

                            if (warehousePurchaseOrderItem.WarehousePurchaseOrderExpectedItems.Count > 0)
                            {
                                warehousePurchaseOrderItem.ExpectedDate = warehousePurchaseOrderItem.WarehousePurchaseOrderExpectedItems.First().Date;
                            }

                            warehousePurchaseOrderItem.ReceivedDeliveryNotes = GetDeliveryNotesByIdWarehousePurchaseOrderItem(connectionString, warehousePurchaseOrderItem.IdWarehousePurchaseOrderItem);
                            warehousePurchaseOrderItems.Add(warehousePurchaseOrderItem);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetArticlesByIdWarehousePurchaseOrder_V2300(idWarehousePurchaseOrder-{0}). ErrorMessage- {1}", idWarehousePurchaseOrder, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            return warehousePurchaseOrderItems;
        }

        public List<Country> GetCountries_V2301(string connectionstring)
        {
            List<Country> countries = new List<Country>();

            using (MySqlConnection conofferwithoutpurchaseorder = new MySqlConnection(connectionstring))
            {
                conofferwithoutpurchaseorder.Open();
                MySqlCommand conofferwithoutpurchaseordercommand = new MySqlCommand("countries_GetCountriesDetails", conofferwithoutpurchaseorder);
                conofferwithoutpurchaseordercommand.CommandType = CommandType.StoredProcedure;

                using (MySqlDataReader offerreader = conofferwithoutpurchaseordercommand.ExecuteReader())
                {
                    while (offerreader.Read())
                    {
                        Country country = new Country();
                        country.IdCountry = Convert.ToByte(offerreader["idCountry"].ToString());
                        country.Name = offerreader["CountryName"].ToString();
                        countries.Add(country);
                    }
                }
            }

            return countries;
        }

        public List<Group> GetGroups_V2301(string connectionstring)
        {
            List<Group> group = new List<Group>();

            using (MySqlConnection conofferwithoutpurchaseorder = new MySqlConnection(connectionstring))
            {
                conofferwithoutpurchaseorder.Open();
                MySqlCommand conofferwithoutpurchaseordercommand = new MySqlCommand("group_GetGroupDetails", conofferwithoutpurchaseorder);
                conofferwithoutpurchaseordercommand.CommandType = CommandType.StoredProcedure;

                using (MySqlDataReader offerreader = conofferwithoutpurchaseordercommand.ExecuteReader())
                {
                    while (offerreader.Read())
                    {
                        Group group1 = new Group();
                        group1.IdEnterpriseGroup = Convert.ToInt32(offerreader["IdEnterpriseGroup"].ToString());
                        group1.Name = offerreader["Name"].ToString();
                        group.Add(group1);
                    }
                }
            }

            return group;
        }

        public List<Categorys> GetCategorys_V2301(string connectionstring)
        {
            List<Categorys> categorys = new List<Categorys>();

            using (MySqlConnection conofferwithoutpurchaseorder = new MySqlConnection(connectionstring))
            {
                conofferwithoutpurchaseorder.Open();
                MySqlCommand conofferwithoutpurchaseordercommand = new MySqlCommand("group_GetCategoryDetails", conofferwithoutpurchaseorder);
                conofferwithoutpurchaseordercommand.CommandType = CommandType.StoredProcedure;

                using (MySqlDataReader offerreader = conofferwithoutpurchaseordercommand.ExecuteReader())
                {
                    while (offerreader.Read())
                    {
                        Categorys cat = new Categorys();
                        cat.IdArticleSupplierType = Convert.ToInt32(offerreader["idArticleSupplierType"].ToString());
                        cat.CategoryName = offerreader["Name"].ToString();
                        categorys.Add(cat);
                    }
                }
            }

            return categorys;
        }
        public List<PaymentTerm> GetPayments_V2301(string connectionstring)
        {
            List<PaymentTerm> pay = new List<PaymentTerm>();

            using (MySqlConnection conofferwithoutpurchaseorder = new MySqlConnection(connectionstring))
            {
                conofferwithoutpurchaseorder.Open();
                MySqlCommand conofferwithoutpurchaseordercommand = new MySqlCommand("group_GetPaymentTypeDetails", conofferwithoutpurchaseorder);
                conofferwithoutpurchaseordercommand.CommandType = CommandType.StoredProcedure;

                using (MySqlDataReader offerreader = conofferwithoutpurchaseordercommand.ExecuteReader())
                {
                    while (offerreader.Read())
                    {
                        PaymentTerm pays = new PaymentTerm();
                        pays.IdPaymentType = Convert.ToInt32(offerreader["IdPaymentType"].ToString());
                        pays.PaymentType = offerreader["Name"].ToString();
                        pay.Add(pays);
                    }
                }
            }

            return pay;
        }

        public bool UpdateArticleSupplier(string connectionString, ArticleSupplier articleSupplier)
        {
            bool status;
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("SRM_Update_ArticleSupplier", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdArticleSupplier", articleSupplier.IdArticleSupplier);
                    mySqlCommand.Parameters.AddWithValue("_IdCountry", articleSupplier.IdCountry);
                    mySqlCommand.Parameters.AddWithValue("_IdPaymentType", articleSupplier.IdPaymentType);
                    if (articleSupplier.IdEnterpriseGroup > 0)
                        mySqlCommand.Parameters.AddWithValue("_IdEnterpriseGroup", articleSupplier.IdEnterpriseGroup);
                    else
                        mySqlCommand.Parameters.AddWithValue("_IdEnterpriseGroup", null);

                    mySqlCommand.Parameters.AddWithValue("_idArticleSupplierType", articleSupplier.IdArticleSupplierType);
                    mySqlCommand.Parameters.AddWithValue("_OrdersReceptionMethod", articleSupplier.IdOrderReceptionLookup);
                    mySqlCommand.Parameters.AddWithValue("_ModifiedBy", articleSupplier.ModifiedBy);
                    mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now);
                    mySqlCommand.ExecuteNonQuery();
                    mySqlConnection.Close();
                    status = true;
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error UpdateArticleSupplier(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return status;
        }

        public List<WorkflowStatus> GetWorkFlowStatus(string connectionstring)
        {
            List<WorkflowStatus> workflowStatusLst = new List<WorkflowStatus>();

            using (MySqlConnection conofferwithoutpurchaseorder = new MySqlConnection(connectionstring))
            {
                conofferwithoutpurchaseorder.Open();
                MySqlCommand conofferwithoutpurchaseordercommand = new MySqlCommand("SRM_GetworkflowstatusDetailsById", conofferwithoutpurchaseorder);
                conofferwithoutpurchaseordercommand.CommandType = CommandType.StoredProcedure;
                conofferwithoutpurchaseordercommand.Parameters.AddWithValue("_IdWorkFlow", 1);
                using (MySqlDataReader offerreader = conofferwithoutpurchaseordercommand.ExecuteReader())
                {
                    while (offerreader.Read())
                    {
                        WorkflowStatus workflowStatus = new WorkflowStatus();
                        workflowStatus.IdWorkflowStatus = Convert.ToByte(offerreader["IdWorkflowStatus"].ToString());
                        workflowStatus.Name = offerreader["Name"].ToString();
                        workflowStatus.HtmlColor = offerreader["HtmlColor"].ToString();
                        workflowStatusLst.Add(workflowStatus);
                    }
                }
            }

            return workflowStatusLst;
        }


        public List<WarehousePurchaseOrder> GetPendingPurchaseOrdersByWarehouse_V2301(Warehouses warehouse, string countryIconFilePath, string connectionStringWorkbench)
        {
            string connectionString = warehouse.Company.ConnectPlantConstr;
            List<WarehousePurchaseOrder> warehousePurchaseOrders = new List<WarehousePurchaseOrder>();
            List<string> countryISOs = new List<string>();
            List<long> orderid = new List<long>();
            Dictionary<string, List<long>> SupplierEmailId = new Dictionary<string, List<long>>();
            List<string> Suppliername = new List<string>();

            List<WorkflowStatus> LstWorkflowStatus = GetAllWorkflowStatus_V2301(connectionStringWorkbench);
            List<WorkflowTransition> LstWorkflowStatusTransitions = GetAllWorkflowTransitions_V2301(connectionStringWorkbench);
            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();
                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetPendingPurchaseOrdersByWarehouse_V2110", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdWarehouse", warehouse.IdWarehouse);
                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    double totalQuantity = 0;
                    double receivedQuantity = 0;
                    while (mySqlDataReader.Read())
                    {
                        try
                        {
                            totalQuantity = 0;
                            receivedQuantity = 0;
                            WarehousePurchaseOrder warehousePurchaseOrder = new WarehousePurchaseOrder();
                            try
                            {
                                warehousePurchaseOrder.IdWarehousePurchaseOrder = Convert.ToInt64(mySqlDataReader["idWarehousepurchaseorder"]);
                                if (mySqlDataReader["Code"] != DBNull.Value)
                                    warehousePurchaseOrder.Code = Convert.ToString(mySqlDataReader["Code"]);
                                if (mySqlDataReader["IdArticleSupplier"] != DBNull.Value)
                                {
                                    ArticleSupplier articleSupplier = new ArticleSupplier();
                                    articleSupplier.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);
                                    if (mySqlDataReader["Supplier"] != DBNull.Value)
                                        articleSupplier.Name = Convert.ToString(mySqlDataReader["Supplier"]);
                                    if (mySqlDataReader["IdCountry"] != DBNull.Value)
                                    {
                                        articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["IdCountry"]);
                                        articleSupplier.Country = new Country();
                                        articleSupplier.Country.IdCountry = Convert.ToByte(mySqlDataReader["IdCountry"]);
                                        articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);
                                        if (mySqlDataReader["CountryISO"] != DBNull.Value)
                                        {
                                            articleSupplier.Country.Iso = Convert.ToString(mySqlDataReader["CountryISO"]);
                                            if (!countryISOs.Any(co => co.ToString() == articleSupplier.Country.Iso))
                                            {
                                                countryISOs.Add(articleSupplier.Country.Iso);
                                            }
                                        }
                                    }
                                    if (mySqlDataReader["SupplierContactPerson"] != DBNull.Value)
                                        articleSupplier.ContactPerson = Convert.ToString(mySqlDataReader["SupplierContactPerson"]);
                                    if (mySqlDataReader["SupplierContactEmail"] != DBNull.Value)
                                        articleSupplier.ContactEmail = Convert.ToString(mySqlDataReader["SupplierContactEmail"]);
                                    warehousePurchaseOrder.ArticleSupplier = articleSupplier;
                                }
                                if (mySqlDataReader["DeliveryDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["deliveryDate"]) != DateTime.MinValue)
                                {
                                    warehousePurchaseOrder.DeliveryDate = Convert.ToDateTime(mySqlDataReader["deliveryDate"]);
                                    warehousePurchaseOrder.Delay = (int)(warehousePurchaseOrder.DeliveryDate.Value.Date - DateTime.Now.Date).TotalDays;
                                }
                                if (mySqlDataReader["AttachedPO"] != DBNull.Value)
                                    warehousePurchaseOrder.AttachedPO = Convert.ToByte(mySqlDataReader["AttachedPO"]);
                                if (mySqlDataReader["Deliveries"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.Deliveries = Convert.ToInt32(mySqlDataReader["Deliveries"]);
                                    if (warehousePurchaseOrder.Deliveries > 0)
                                    {
                                        warehousePurchaseOrder.IsPartialPending = true;
                                    }
                                }
                                if (mySqlDataReader["LatestDeliveryDate"] != DBNull.Value)
                                    warehousePurchaseOrder.LatestDeliveryDate = Convert.ToDateTime(mySqlDataReader["LatestDeliveryDate"]);
                                if (mySqlDataReader["IdWarehouse"] != DBNull.Value)
                                    warehousePurchaseOrder.IdWarehouse = Convert.ToInt64(mySqlDataReader["IdWarehouse"]);
                                if (mySqlDataReader["OrderQty"] != DBNull.Value)
                                    totalQuantity = Convert.ToDouble(mySqlDataReader["OrderQty"]);
                                if (mySqlDataReader["ReceivedQuantity"] != DBNull.Value)
                                    receivedQuantity = Convert.ToDouble(mySqlDataReader["ReceivedQuantity"]);
                                if (totalQuantity > 0)
                                    warehousePurchaseOrder.Status = (Int16)((receivedQuantity / totalQuantity) * 100);
                                if (mySqlDataReader["TotalAmount"] != DBNull.Value)
                                    warehousePurchaseOrder.TotalAmount = Convert.ToDecimal(mySqlDataReader["TotalAmount"]);
                                if (mySqlDataReader["CreatedIn"] != DBNull.Value)
                                    warehousePurchaseOrder.CreatedIn = Convert.ToDateTime(mySqlDataReader["CreatedIn"]);
                                if (mySqlDataReader["AttachPdf"] != DBNull.Value)
                                    warehousePurchaseOrder.AttachPdf = Convert.ToString(mySqlDataReader["AttachPdf"]);
                                if (mySqlDataReader["idCurrency"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.IdCurrency = Convert.ToByte(mySqlDataReader["idCurrency"]);
                                    warehousePurchaseOrder.Currency = new Currency();
                                    warehousePurchaseOrder.Currency.IdCurrency = Convert.ToByte(mySqlDataReader["idCurrency"]);
                                    warehousePurchaseOrder.Currency.Name = Convert.ToString(mySqlDataReader["CurrencyName"]);
                                    warehousePurchaseOrder.Currency.Symbol = Convert.ToString(mySqlDataReader["CurrencySymbol"]);
                                }
                                if (mySqlDataReader["IdWorkflowStatus"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                    warehousePurchaseOrder.WorkflowStatus = new WorkflowStatus();
                                    warehousePurchaseOrder.WorkflowStatus.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                    warehousePurchaseOrder.WorkflowStatus.Name = Convert.ToString(mySqlDataReader["Status"]);
                                    warehousePurchaseOrder.WorkflowStatus.HtmlColor = Convert.ToString(mySqlDataReader["HtmlColor"]);
                                }
                                if (mySqlDataReader["ReminderEmailDate"] != DBNull.Value)
                                    warehousePurchaseOrder.ReminderEmailDate = Convert.ToDateTime(mySqlDataReader["ReminderEmailDate"]);
                                if (!string.IsNullOrEmpty(warehousePurchaseOrder.ArticleSupplier.ContactEmail))
                                {
                                    if (warehousePurchaseOrder.ReminderEmailDate == DateTime.MinValue || warehousePurchaseOrder.ReminderEmailDate == null)
                                    {
                                        warehousePurchaseOrder.ReminderEmailDate = warehousePurchaseOrder.DeliveryDate.Value.AddDays(1);
                                    }
                                    DateTime dtRm = new DateTime(warehousePurchaseOrder.ReminderEmailDate.Value.Year, warehousePurchaseOrder.ReminderEmailDate.Value.Month, warehousePurchaseOrder.ReminderEmailDate.Value.Day);
                                    DateTime dtNow = new DateTime(DateTime.Now.Year, DateTime.Now.Month, DateTime.Now.Day);
                                    if (dtRm <= dtNow)
                                    {
                                        orderid = new List<long>();
                                        orderid.Add(warehousePurchaseOrder.IdWarehousePurchaseOrder);
                                        if (!SupplierEmailId.ContainsKey(warehousePurchaseOrder.ArticleSupplier.ContactEmail))
                                        {
                                            SupplierEmailId.Add(warehousePurchaseOrder.ArticleSupplier.ContactEmail, orderid);
                                        }
                                        else
                                        {
                                            SupplierEmailId[warehousePurchaseOrder.ArticleSupplier.ContactEmail].Add(warehousePurchaseOrder.IdWarehousePurchaseOrder);
                                        }
                                    }
                                }
                                else
                                {
                                    if (!Suppliername.Contains(warehousePurchaseOrder.ArticleSupplier.Name))
                                    {
                                        Suppliername.Add(warehousePurchaseOrder.ArticleSupplier.Name);
                                    }
                                }



                                warehousePurchaseOrder.LstWorkflowStatus = LstWorkflowStatus;
                                List<byte> GetCurrentButtons = LstWorkflowStatusTransitions.Where(a => a.IdWorkflowStatusFrom == warehousePurchaseOrder.IdWorkflowStatus).Select(a => a.IdWorkflowStatusTo).Distinct().ToList();
                                warehousePurchaseOrder.LstWorkflowStatusTransition = new List<WorkflowStatus>();
                                warehousePurchaseOrder.LstWorkflowStatusTransition.Add(warehousePurchaseOrder.LstWorkflowStatus.FirstOrDefault(a => a.IdWorkflowStatus == warehousePurchaseOrder.IdWorkflowStatus));
                                foreach (byte statusbutton in GetCurrentButtons)
                                {
                                    warehousePurchaseOrder.LstWorkflowStatusTransition.Add(warehousePurchaseOrder.LstWorkflowStatus.FirstOrDefault(a => a.IdWorkflowStatus == statusbutton));
                                }
                            }
                            catch (Exception ex)
                            {
                            }
                            warehousePurchaseOrders.Add(warehousePurchaseOrder);

                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetPendingPurchaseOrdersByWarehouse_V2110(). ErrorMessage-" + ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }
            foreach (string item in countryISOs)
            {
                byte[] bytes = null;
                bytes = GetCountryIconFileInBytes(item, countryIconFilePath);
                warehousePurchaseOrders.Where(wp => wp.ArticleSupplier.Country.Iso == item).ToList().ForEach(wp => wp.ArticleSupplier.Country.CountryIconBytes = bytes);
            }
            if (warehousePurchaseOrders.Count > 0)
            {
                warehousePurchaseOrders.FirstOrDefault().SupplierEmailId = SupplierEmailId;
                warehousePurchaseOrders.FirstOrDefault().Suppliername = Suppliername;
            }
            Log4NetLogger.Logger.Log("Executed GetPendingPurchaseOrdersByWarehouse_V2110().", category: Category.Info, priority: Priority.Low);
            return warehousePurchaseOrders;
        }

        public WarehousePurchaseOrder GetPendingPODetailsForGridUpdate(string connectionString, Int64 idWarehousePurchaseOrder)
        {
            WarehousePurchaseOrder warehousePurchaseOrder = null;

            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetPendingPODetailsForGridUpdate", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", idWarehousePurchaseOrder);

                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    if (mySqlDataReader.Read())
                    {
                        try
                        {
                            warehousePurchaseOrder = new WarehousePurchaseOrder();

                            warehousePurchaseOrder.IdWarehousePurchaseOrder = idWarehousePurchaseOrder;

                            if (mySqlDataReader["Code"] != DBNull.Value)
                                warehousePurchaseOrder.Code = Convert.ToString(mySqlDataReader["Code"]);


                            if (mySqlDataReader["IdWorkflowStatus"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                warehousePurchaseOrder.WorkflowStatus = new WorkflowStatus();
                                warehousePurchaseOrder.WorkflowStatus.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                warehousePurchaseOrder.WorkflowStatus.Name = Convert.ToString(mySqlDataReader["Status"]);
                                warehousePurchaseOrder.WorkflowStatus.HtmlColor = Convert.ToString(mySqlDataReader["StatusHtmlColor"]);
                            }
                            if (mySqlDataReader["IdAssignee"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.IdAssignee = Convert.ToUInt32(mySqlDataReader["IdAssignee"]);
                            }
                            if (mySqlDataReader["IdApprover"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.IdApprover = Convert.ToUInt32(mySqlDataReader["IdApprover"]);
                            }


                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetPendingPODetailsForGridUpdate(idWarehousePurchaseOrder-{0}), ErrorMessage- {1} ", idWarehousePurchaseOrder, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            return warehousePurchaseOrder;
        }

        public bool IsUpdateWarehousePurchaseOrderWithStatus(string connectionString, WarehousePurchaseOrder warehousePurchaseOrder)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    if (warehousePurchaseOrder != null && warehousePurchaseOrder.IdWarehousePurchaseOrder > 0)
                    {
                        using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                        {
                            mySqlConnection.Open();

                            MySqlCommand mySqlCommand = new MySqlCommand("SRM_UpdatePendingPODetailsForGridUpdate", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", warehousePurchaseOrder.IdWarehousePurchaseOrder);
                            mySqlCommand.Parameters.AddWithValue("_IdWorkflowStatus", warehousePurchaseOrder.IdWorkflowStatus);
                            mySqlCommand.Parameters.AddWithValue("_IdAssignee", warehousePurchaseOrder.IdAssignee);
                            mySqlCommand.Parameters.AddWithValue("_IdApprover", warehousePurchaseOrder.IdApprover);
                            mySqlCommand.Parameters.AddWithValue("_IdModifier", warehousePurchaseOrder.ModifiedBy);
                            mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                            mySqlCommand.ExecuteNonQuery();

                            mySqlConnection.Close();

                            isUpdated = true;
                        }


                        AddWarehousePurchaseOrderLogEntry(connectionString, warehousePurchaseOrder.IdWarehousePurchaseOrder, warehousePurchaseOrder.WarehousePOLogEntries);


                        isUpdated = true;
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error IsUpdateWarehousePurchaseOrderWithStatus(). IdWarehousePurchaseOrder- {0} ErrorMessage- {1}", warehousePurchaseOrder.IdWarehousePurchaseOrder, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }

        public void AddWarehousePurchaseOrderLogEntry(string MainServerConnectionString, Int64 IdWarehousePurchaseOrder, List<LogEntriesByWarehousePO> LogList)
        {
            try
            {
                if (LogList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (LogEntriesByWarehousePO logList in LogList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("SRM_LogEntriesWarehousePurchaseOrder_Insert", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", IdWarehousePurchaseOrder);
                            mySqlCommand.Parameters.AddWithValue("_IdUser", logList.IdUser);
                            mySqlCommand.Parameters.AddWithValue("_IdLogEntryType", logList.IdLogEntryType);
                            mySqlCommand.Parameters.AddWithValue("_Datetime", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                            mySqlCommand.Parameters.AddWithValue("_Comments", logList.Comments);

                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddWarehousePurchaseOrderLogEntry(). IdWarehousePurchaseOrder- {0} ErrorMessage- {1}", IdWarehousePurchaseOrder, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        /// <summary>
        /// This method is used to get All workflow status.
        /// </summary>
        /// <param name="connectionString">connection string.</param>
        public List<WorkflowStatus> GetAllWorkflowStatus_V2301(string connectionString)
        {

            List<WorkflowStatus> workflowStatusList = new List<WorkflowStatus>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetAllWorkflowStatus_V2301", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                    {
                        while (mySqlDataReader.Read())
                        {
                            WorkflowStatus workflowStatus = new WorkflowStatus();

                            workflowStatus.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);

                            if (mySqlDataReader["IdWorkflow"] != DBNull.Value)
                                workflowStatus.IdWorkflow = Convert.ToUInt32(mySqlDataReader["IdWorkflow"].ToString());

                            if (mySqlDataReader["Name"] != DBNull.Value)
                                workflowStatus.Name = mySqlDataReader["Name"].ToString();

                            if (mySqlDataReader["HtmlColor"] != DBNull.Value)
                                workflowStatus.HtmlColor = mySqlDataReader["HtmlColor"].ToString();

                            if (mySqlDataReader["IdWorkflowScope"] != DBNull.Value)
                                workflowStatus.IdWorkflowScope = Convert.ToUInt32(mySqlDataReader["IdWorkflowScope"].ToString());

                            workflowStatusList.Add(workflowStatus);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllWorkflowStatus(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return workflowStatusList;
        }

        /// <summary>
        /// This method is used to get All workflow status.
        /// </summary>
        /// <param name="connectionString">connection string.</param>
        public List<WorkflowTransition> GetAllWorkflowTransitions_V2301(string connectionString)
        {

            List<WorkflowTransition> workflowTransitionList = new List<WorkflowTransition>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("SRM_Get_workflow_transitions_V2301", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                    {
                        while (mySqlDataReader.Read())
                        {
                            WorkflowTransition workflowTransition = new WorkflowTransition();

                            workflowTransition.IdWorkflowTransition = Convert.ToUInt32(mySqlDataReader["IdWorkflowTransition"]);

                            if (mySqlDataReader["IdWorkflow"] != DBNull.Value)
                                workflowTransition.IdWorkflow = Convert.ToUInt32(mySqlDataReader["IdWorkflow"]);

                            if (mySqlDataReader["Name"] != DBNull.Value)
                                workflowTransition.Name = mySqlDataReader["Name"].ToString();

                            if (mySqlDataReader["IdWorkflowStatusFrom"] != DBNull.Value)
                                workflowTransition.IdWorkflowStatusFrom = Convert.ToByte(mySqlDataReader["IdWorkflowStatusFrom"]);

                            if (mySqlDataReader["IdWorkflowStatusTo"] != DBNull.Value)
                                workflowTransition.IdWorkflowStatusTo = Convert.ToByte(mySqlDataReader["IdWorkflowStatusTo"]);

                            if (mySqlDataReader["IsCommentRequired"] != DBNull.Value)
                                workflowTransition.IsCommentRequired = Convert.ToByte(mySqlDataReader["IsCommentRequired"]);

                            if (mySqlDataReader["IdWorkflowScope"] != DBNull.Value)
                                workflowTransition.IdWorkflowScope = Convert.ToUInt32(mySqlDataReader["IdWorkflowScope"]);

                            workflowTransitionList.Add(workflowTransition);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllWorkflowTransitions(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return workflowTransitionList;
        }

        public List<WarehousePurchaseOrder> GetPendingPurchaseOrdersByWarehouse_V2310(Warehouses warehouse, string countryIconFilePath, string connectionStringWorkbench)
        {
            string connectionString = warehouse.Company.ConnectPlantConstr;
            List<WarehousePurchaseOrder> warehousePurchaseOrders = new List<WarehousePurchaseOrder>();
            List<string> countryISOs = new List<string>();
            List<long> orderid = new List<long>();
            Dictionary<string, List<long>> SupplierEmailId = new Dictionary<string, List<long>>();
            List<string> Suppliername = new List<string>();

            List<WorkflowStatus> LstWorkflowStatus = GetAllWorkflowStatus_V2301(connectionStringWorkbench);
            List<WorkflowTransition> LstWorkflowStatusTransitions = GetAllWorkflowTransitions_V2301(connectionStringWorkbench);
            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();
                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetPendingPurchaseOrdersByWarehouse_V2110", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdWarehouse", warehouse.IdWarehouse);
                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    double totalQuantity = 0;
                    double receivedQuantity = 0;
                    while (mySqlDataReader.Read())
                    {
                        try
                        {
                            totalQuantity = 0;
                            receivedQuantity = 0;
                            WarehousePurchaseOrder warehousePurchaseOrder = new WarehousePurchaseOrder();
                            try
                            {
                                warehousePurchaseOrder.IdWarehousePurchaseOrder = Convert.ToInt64(mySqlDataReader["idWarehousepurchaseorder"]);
                                if (mySqlDataReader["Code"] != DBNull.Value)
                                    warehousePurchaseOrder.Code = Convert.ToString(mySqlDataReader["Code"]);
                                if (mySqlDataReader["IdArticleSupplier"] != DBNull.Value)
                                {
                                    ArticleSupplier articleSupplier = new ArticleSupplier();
                                    articleSupplier.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);
                                    if (mySqlDataReader["Supplier"] != DBNull.Value)
                                        articleSupplier.Name = Convert.ToString(mySqlDataReader["Supplier"]);
                                    if (mySqlDataReader["IdCountry"] != DBNull.Value)
                                    {
                                        articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["IdCountry"]);
                                        articleSupplier.Country = new Country();
                                        articleSupplier.Country.IdCountry = Convert.ToByte(mySqlDataReader["IdCountry"]);
                                        articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);
                                        if (mySqlDataReader["CountryISO"] != DBNull.Value)
                                        {
                                            articleSupplier.Country.Iso = Convert.ToString(mySqlDataReader["CountryISO"]);
                                            if (!countryISOs.Any(co => co.ToString() == articleSupplier.Country.Iso))
                                            {
                                                countryISOs.Add(articleSupplier.Country.Iso);
                                            }
                                        }
                                    }
                                    if (mySqlDataReader["SupplierContactPerson"] != DBNull.Value)
                                        articleSupplier.ContactPerson = Convert.ToString(mySqlDataReader["SupplierContactPerson"]);
                                    if (mySqlDataReader["SupplierContactEmail"] != DBNull.Value)
                                        articleSupplier.ContactEmail = Convert.ToString(mySqlDataReader["SupplierContactEmail"]);
                                    warehousePurchaseOrder.ArticleSupplier = articleSupplier;
                                }
                                if (mySqlDataReader["DeliveryDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["deliveryDate"]) != DateTime.MinValue)
                                {
                                    warehousePurchaseOrder.DeliveryDate = Convert.ToDateTime(mySqlDataReader["deliveryDate"]);
                                    warehousePurchaseOrder.Delay = (int)(warehousePurchaseOrder.DeliveryDate.Value.Date - DateTime.Now.Date).TotalDays;
                                }
                                if (mySqlDataReader["AttachedPO"] != DBNull.Value)
                                    warehousePurchaseOrder.AttachedPO = Convert.ToByte(mySqlDataReader["AttachedPO"]);
                                if (mySqlDataReader["Deliveries"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.Deliveries = Convert.ToInt32(mySqlDataReader["Deliveries"]);
                                    if (warehousePurchaseOrder.Deliveries > 0)
                                    {
                                        warehousePurchaseOrder.IsPartialPending = true;
                                    }
                                }
                                if (mySqlDataReader["LatestDeliveryDate"] != DBNull.Value)
                                    warehousePurchaseOrder.LatestDeliveryDate = Convert.ToDateTime(mySqlDataReader["LatestDeliveryDate"]);
                                if (mySqlDataReader["IdWarehouse"] != DBNull.Value)
                                    warehousePurchaseOrder.IdWarehouse = Convert.ToInt64(mySqlDataReader["IdWarehouse"]);
                                if (mySqlDataReader["OrderQty"] != DBNull.Value)
                                    totalQuantity = Convert.ToDouble(mySqlDataReader["OrderQty"]);
                                if (mySqlDataReader["ReceivedQuantity"] != DBNull.Value)
                                    receivedQuantity = Convert.ToDouble(mySqlDataReader["ReceivedQuantity"]);
                                if (totalQuantity > 0)
                                    warehousePurchaseOrder.Status = (Int16)((receivedQuantity / totalQuantity) * 100);
                                if (mySqlDataReader["TotalAmount"] != DBNull.Value)
                                    warehousePurchaseOrder.TotalAmount = Convert.ToDecimal(mySqlDataReader["TotalAmount"]);
                                if (mySqlDataReader["CreatedIn"] != DBNull.Value)
                                    warehousePurchaseOrder.CreatedIn = Convert.ToDateTime(mySqlDataReader["CreatedIn"]);
                                if (mySqlDataReader["AttachPdf"] != DBNull.Value)
                                    warehousePurchaseOrder.AttachPdf = Convert.ToString(mySqlDataReader["AttachPdf"]);
                                if (mySqlDataReader["idCurrency"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.IdCurrency = Convert.ToByte(mySqlDataReader["idCurrency"]);
                                    warehousePurchaseOrder.Currency = new Currency();
                                    warehousePurchaseOrder.Currency.IdCurrency = Convert.ToByte(mySqlDataReader["idCurrency"]);
                                    warehousePurchaseOrder.Currency.Name = Convert.ToString(mySqlDataReader["CurrencyName"]);
                                    warehousePurchaseOrder.Currency.Symbol = Convert.ToString(mySqlDataReader["CurrencySymbol"]);
                                }
                                if (mySqlDataReader["IdWorkflowStatus"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                    warehousePurchaseOrder.WorkflowStatus = new WorkflowStatus();
                                    warehousePurchaseOrder.WorkflowStatus.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                    warehousePurchaseOrder.WorkflowStatus.Name = Convert.ToString(mySqlDataReader["Status"]);
                                    warehousePurchaseOrder.WorkflowStatus.HtmlColor = Convert.ToString(mySqlDataReader["HtmlColor"]);
                                }
                                if (mySqlDataReader["ReminderEmailDate"] != DBNull.Value)
                                    warehousePurchaseOrder.ReminderEmailDate = Convert.ToDateTime(mySqlDataReader["ReminderEmailDate"]);
                                if (!string.IsNullOrEmpty(warehousePurchaseOrder.ArticleSupplier.ContactEmail))
                                {
                                    if (warehousePurchaseOrder.ReminderEmailDate == DateTime.MinValue || warehousePurchaseOrder.ReminderEmailDate == null)
                                    {
                                        warehousePurchaseOrder.ReminderEmailDate = warehousePurchaseOrder.DeliveryDate.Value.AddDays(1);
                                    }
                                    DateTime dtRm = new DateTime(warehousePurchaseOrder.ReminderEmailDate.Value.Year, warehousePurchaseOrder.ReminderEmailDate.Value.Month, warehousePurchaseOrder.ReminderEmailDate.Value.Day);
                                    DateTime dtNow = new DateTime(DateTime.Now.Year, DateTime.Now.Month, DateTime.Now.Day);
                                    if (dtRm <= dtNow)
                                    {
                                        orderid = new List<long>();
                                        orderid.Add(warehousePurchaseOrder.IdWarehousePurchaseOrder);
                                        if (!SupplierEmailId.ContainsKey(warehousePurchaseOrder.ArticleSupplier.ContactEmail))
                                        {
                                            SupplierEmailId.Add(warehousePurchaseOrder.ArticleSupplier.ContactEmail, orderid);
                                        }
                                        else
                                        {
                                            SupplierEmailId[warehousePurchaseOrder.ArticleSupplier.ContactEmail].Add(warehousePurchaseOrder.IdWarehousePurchaseOrder);
                                        }
                                    }
                                }
                                else
                                {
                                    if (!Suppliername.Contains(warehousePurchaseOrder.ArticleSupplier.Name))
                                    {
                                        Suppliername.Add(warehousePurchaseOrder.ArticleSupplier.Name);
                                    }
                                }



                                warehousePurchaseOrder.LstWorkflowStatus = LstWorkflowStatus;
                                List<byte> GetCurrentButtons = LstWorkflowStatusTransitions.Where(a => a.IdWorkflowStatusFrom == warehousePurchaseOrder.IdWorkflowStatus).Select(a => a.IdWorkflowStatusTo).Distinct().ToList();
                                warehousePurchaseOrder.LstWorkflowStatusTransition = new List<WorkflowStatus>();
                                warehousePurchaseOrder.LstWorkflowStatusTransition.Add(warehousePurchaseOrder.LstWorkflowStatus.FirstOrDefault(a => a.IdWorkflowStatus == warehousePurchaseOrder.IdWorkflowStatus));
                                foreach (byte statusbutton in GetCurrentButtons)
                                {
                                    warehousePurchaseOrder.LstWorkflowStatusTransition.Add(warehousePurchaseOrder.LstWorkflowStatus.FirstOrDefault(a => a.IdWorkflowStatus == statusbutton));
                                }
                            }
                            catch (Exception ex)
                            {
                            }
                            warehousePurchaseOrder.LstAllWorkflowStatusTransitions = LstWorkflowStatusTransitions;
                            warehousePurchaseOrders.Add(warehousePurchaseOrder);

                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetPendingPurchaseOrdersByWarehouse_V2310(). ErrorMessage-" + ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }
            foreach (string item in countryISOs)
            {
                byte[] bytes = null;
                bytes = GetCountryIconFileInBytes(item, countryIconFilePath);
                warehousePurchaseOrders.Where(wp => wp.ArticleSupplier.Country.Iso == item).ToList().ForEach(wp => wp.ArticleSupplier.Country.CountryIconBytes = bytes);
            }
            if (warehousePurchaseOrders.Count > 0)
            {
                warehousePurchaseOrders.FirstOrDefault().SupplierEmailId = SupplierEmailId;
                warehousePurchaseOrders.FirstOrDefault().Suppliername = Suppliername;
            }
            return warehousePurchaseOrders;
        }

        //[GEOS2-4027][rdixit][18.11.2022]
        public ArticleSupplier GetArticleSupplierByIdArticleSupplier_V2340(Warehouses warehouse, UInt64 IdArticleSupplier)
        {
            string connectionString = warehouse.Company.ConnectPlantConstr;
            ArticleSupplier articleSupplier = null;

            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetArticleSupplierByIdArticleSupplier_V2340", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdArticleSupplier", IdArticleSupplier);

                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    while (mySqlDataReader.Read())
                    {
                        try
                        {
                            articleSupplier = new ArticleSupplier();

                            articleSupplier.IdArticleSupplier = Convert.ToInt64(IdArticleSupplier);

                            articleSupplier.Code = "SUPL" + articleSupplier.IdArticleSupplier.ToString().PadLeft(6, '0');

                            if (mySqlDataReader["name"] != DBNull.Value)
                                articleSupplier.Name = Convert.ToString(mySqlDataReader["name"]);

                            if (mySqlDataReader["Cif"] != DBNull.Value)
                                articleSupplier.Cif = Convert.ToString(mySqlDataReader["Cif"]);

                            if (mySqlDataReader["serie"] != DBNull.Value)
                                articleSupplier.Serie = Convert.ToChar(mySqlDataReader["serie"]);

                            if (mySqlDataReader["Observations"] != DBNull.Value)
                                articleSupplier.Observations = Convert.ToString(mySqlDataReader["Observations"]);

                            if (mySqlDataReader["lastOrder"] != DBNull.Value)
                                articleSupplier.LastOrderDate = Convert.ToDateTime(mySqlDataReader["lastOrder"].ToString());

                            if (mySqlDataReader["Phone1"] != DBNull.Value)
                                articleSupplier.Phone1 = Convert.ToString(mySqlDataReader["Phone1"]);

                            if (mySqlDataReader["Phone2"] != DBNull.Value)
                                articleSupplier.Phone2 = Convert.ToString(mySqlDataReader["Phone2"]);

                            if (mySqlDataReader["Email"] != DBNull.Value)
                                articleSupplier.Email = Convert.ToString(mySqlDataReader["Email"]);

                            if (mySqlDataReader["fax"] != DBNull.Value)
                                articleSupplier.Fax = Convert.ToString(mySqlDataReader["fax"]);

                            if (mySqlDataReader["Web"] != DBNull.Value)
                                articleSupplier.Web = Convert.ToString(mySqlDataReader["Web"]);

                            if (mySqlDataReader["Address"] != DBNull.Value)
                                articleSupplier.Address = Convert.ToString(mySqlDataReader["Address"]);

                            if (mySqlDataReader["City"] != DBNull.Value)
                                articleSupplier.City = Convert.ToString(mySqlDataReader["City"]);

                            if (mySqlDataReader["PostCode"] != DBNull.Value)
                                articleSupplier.PostCode = Convert.ToString(mySqlDataReader["PostCode"]);

                            if (mySqlDataReader["IsStillActive"] != DBNull.Value)
                            {
                                articleSupplier.IsStillActive = Convert.ToSByte(mySqlDataReader["IsStillActive"]);
                            }

                            //[001][GEOS2-3440][pjadhav]
                            if (mySqlDataReader["idcountry"] != DBNull.Value)
                            {
                                articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["idcountry"]);
                                articleSupplier.Country = new Country();
                                articleSupplier.Country.IdCountry = Convert.ToByte(mySqlDataReader["idcountry"]);

                                if (mySqlDataReader["CountryName"] != DBNull.Value)
                                {
                                    articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);
                                }
                            }

                            if (mySqlDataReader["IdEnterpriseGroup"] != DBNull.Value)
                            {

                                articleSupplier.IdEnterpriseGroup = Convert.ToInt32(mySqlDataReader["IdEnterpriseGroup"]);
                                articleSupplier.EnterpriseGroup = new Group();
                                articleSupplier.EnterpriseGroup.IdEnterpriseGroup = Convert.ToInt32(mySqlDataReader["IdEnterpriseGroup"]);
                                if (mySqlDataReader["groupName"] != DBNull.Value)
                                {
                                    articleSupplier.EnterpriseGroup.Name = Convert.ToString(mySqlDataReader["groupName"]);
                                }
                            }
                            if (mySqlDataReader["idArticleSupplierType"] != DBNull.Value)
                            {

                                articleSupplier.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["idArticleSupplierType"]);
                                articleSupplier.ArticleSupplierType = new ArticleSupplierType();
                                articleSupplier.ArticleSupplierType.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["idArticleSupplierType"]);
                                if (mySqlDataReader["CategoryName"] != DBNull.Value)
                                {
                                    articleSupplier.ArticleSupplierType.Name = Convert.ToString(mySqlDataReader["CategoryName"]);
                                }
                            }
                            if (mySqlDataReader["IdPaymentType"] != DBNull.Value)
                            {

                                articleSupplier.IdPaymentType = Convert.ToInt64(mySqlDataReader["IdPaymentType"]);
                                articleSupplier.PaymentTerm = new PaymentTerm();
                                articleSupplier.PaymentTerm.IdPaymentType = Convert.ToInt32(mySqlDataReader["IdPaymentType"]);
                                if (mySqlDataReader["paymentType"] != DBNull.Value)
                                {
                                    articleSupplier.PaymentTerm.PaymentType = Convert.ToString(mySqlDataReader["paymentType"]);
                                }
                            }


                            if (mySqlDataReader["modifiedIn"] != DBNull.Value)
                                articleSupplier.ModifiedIn = Convert.ToDateTime(mySqlDataReader["modifiedIn"].ToString());

                            if (mySqlDataReader["createdIn"] != DBNull.Value)
                                articleSupplier.CreatedIn = Convert.ToDateTime(mySqlDataReader["createdIn"].ToString());

                            if (mySqlDataReader["State"] != DBNull.Value)
                                articleSupplier.Region = Convert.ToString(mySqlDataReader["State"]);

                            if (mySqlDataReader["Latitude"] != DBNull.Value)
                            {
                                articleSupplier.Latitude = Convert.ToDouble(mySqlDataReader["Latitude"]);
                                articleSupplier.Coordinates = articleSupplier.Latitude.ToString();
                            }

                            if (mySqlDataReader["Longitude"] != DBNull.Value)
                            {
                                articleSupplier.Longitude = Convert.ToDouble(mySqlDataReader["Longitude"]);
                                if (mySqlDataReader["Latitude"] != DBNull.Value)
                                {
                                    articleSupplier.Coordinates = articleSupplier.Latitude.ToString() + ", " + articleSupplier.Longitude.ToString();
                                }
                                else
                                {
                                    articleSupplier.Coordinates = articleSupplier.Longitude.ToString();
                                }
                            }

                            if (mySqlDataReader["OrdersReceptionMethod"] != DBNull.Value)
                            {

                                articleSupplier.IdOrderReceptionLookup = Convert.ToInt32(mySqlDataReader["OrdersReceptionMethod"]);
                                articleSupplier.OrderReceptionLookup = new LookupValue();
                                articleSupplier.OrderReceptionLookup.IdLookupValue = Convert.ToInt32(mySqlDataReader["OrdersReceptionMethod"]);
                                if (mySqlDataReader["OrdersReceptionMethodValue"] != DBNull.Value)
                                {
                                    articleSupplier.OrderReceptionLookup.Value = Convert.ToString(mySqlDataReader["OrdersReceptionMethodValue"]);
                                }
                                if (mySqlDataReader["OrdersReceptionMethodHtmlColor"] != DBNull.Value)
                                {
                                    articleSupplier.OrderReceptionLookup.HtmlColor = Convert.ToString(mySqlDataReader["OrdersReceptionMethodHtmlColor"]);
                                }
                            }
                            articleSupplier.ArticleList = GetArticlesByIdArticleSupplier(connectionString, IdArticleSupplier);
                            articleSupplier.DocumentList = GetDocumentsByIdArticleSupplier(connectionString, IdArticleSupplier);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetArticleSupplierByIdArticleSupplier_V2340(IdArticleSupplier-{0}), ErrorMessage- {1} ", IdArticleSupplier, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }

                    if (mySqlDataReader.NextResult())
                    {
                        while (mySqlDataReader.Read())
                        {
                            WarehousePurchaseOrder WarehousePurchaseOrder = new WarehousePurchaseOrder();
                            if (mySqlDataReader["Code"] != DBNull.Value)
                            {
                                if (articleSupplier.Orders == null)
                                {
                                    articleSupplier.Orders = new List<WarehousePurchaseOrder>();
                                }
                                WarehousePurchaseOrder.Code = Convert.ToString(mySqlDataReader["Code"]);
                                WarehousePurchaseOrder.IdWarehousePurchaseOrder = Convert.ToInt64(mySqlDataReader["IdWarehousePurchaseOrder"]);
                                if (mySqlDataReader["WpoDate"] != DBNull.Value)
                                {
                                    WarehousePurchaseOrder.CreatedIn = Convert.ToDateTime(mySqlDataReader["WpoDate"].ToString());
                                }

                            }
                            articleSupplier.Orders.Add(WarehousePurchaseOrder);
                        }

                    }

                    if (mySqlDataReader.NextResult())
                    {
                        while (mySqlDataReader.Read())
                        {
                            ArticleSupplierPlants articleSupplierPlants = new ArticleSupplierPlants();
                            if (mySqlDataReader["IdSite"] != DBNull.Value)
                            {
                                if (articleSupplier.Plants == null)
                                {
                                    articleSupplier.Plants = new List<ArticleSupplierPlants>();
                                }
                                articleSupplierPlants.IdSite = Convert.ToInt64(mySqlDataReader["IdSite"]);
                                articleSupplierPlants.Name = Convert.ToString(mySqlDataReader["Name"]);
                                articleSupplierPlants.Allow = Convert.ToBoolean(mySqlDataReader["Allow"]);
                            }
                            articleSupplier.Plants.Add(articleSupplierPlants);
                        }

                    }
                }
            }
            articleSupplier.LogEntriesByArticleSuppliers = GetLogEntriesByArticleSuppliers(warehouse, IdArticleSupplier);
            return articleSupplier;
        }
        //[GEOS2-4027][rdixit][18.11.2022]
        public List<ArticleSupplier> GetArticleSuppliersByWarehouse_V2340(Warehouses warehouse, string countryIconFilePath)
        {
            string connectionString = warehouse.Company.ConnectPlantConstr;
            List<ArticleSupplier> articleSuppliers = new List<ArticleSupplier>();
            List<string> countryISOs = new List<string>();
            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetArticleSuppliersByWarehouse_V2340", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdWarehouse", warehouse.IdWarehouse);

                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    while (mySqlDataReader.Read())
                    {
                        try
                        {
                            ArticleSupplier articleSupplier = new ArticleSupplier();

                            articleSupplier.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                            if (mySqlDataReader["name"] != DBNull.Value)
                                articleSupplier.Name = Convert.ToString(mySqlDataReader["name"]);

                            if (mySqlDataReader["IdCountry"] != DBNull.Value)
                            {
                                articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["IdCountry"]);

                                articleSupplier.Country = new Country();
                                articleSupplier.Country.IdCountry = Convert.ToByte(mySqlDataReader["IdCountry"]);
                                articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);
                                articleSupplier.Country.Iso = Convert.ToString(mySqlDataReader["Iso"]);

                                if (!countryISOs.Any(co => co.ToString() == articleSupplier.Country.Iso))
                                {
                                    countryISOs.Add(articleSupplier.Country.Iso);
                                }
                            }
                            if (mySqlDataReader["Cif"] != DBNull.Value)
                                articleSupplier.Cif = Convert.ToString(mySqlDataReader["Cif"]);

                            if (mySqlDataReader["City"] != DBNull.Value)
                                articleSupplier.City = Convert.ToString(mySqlDataReader["City"]);

                            if (mySqlDataReader["PostCode"] != DBNull.Value)
                                articleSupplier.PostCode = Convert.ToString(mySqlDataReader["PostCode"]);

                            if (mySqlDataReader["Address"] != DBNull.Value)
                                articleSupplier.Address = Convert.ToString(mySqlDataReader["Address"]);

                            if (mySqlDataReader["Email"] != DBNull.Value)
                                articleSupplier.Email = Convert.ToString(mySqlDataReader["Email"]);

                            if (mySqlDataReader["Web"] != DBNull.Value)
                                articleSupplier.Web = Convert.ToString(mySqlDataReader["Web"]);

                            if (mySqlDataReader["Phone1"] != DBNull.Value)
                                articleSupplier.Phone1 = Convert.ToString(mySqlDataReader["Phone1"]);

                            if (mySqlDataReader["Phone2"] != DBNull.Value)
                                articleSupplier.Phone2 = Convert.ToString(mySqlDataReader["Phone2"]);

                            if (mySqlDataReader["serie"] != DBNull.Value)
                                articleSupplier.Serie = Convert.ToChar(mySqlDataReader["serie"]);

                            if (mySqlDataReader["CreatedIn"] != DBNull.Value)
                                articleSupplier.CreatedIn = Convert.ToDateTime(mySqlDataReader["CreatedIn"].ToString());

                            if (mySqlDataReader["EnterpriseGroup"] != DBNull.Value)
                                articleSupplier.Group = Convert.ToString(mySqlDataReader["EnterpriseGroup"].ToString());

                            if (mySqlDataReader["IsStillActive"] != DBNull.Value)
                            {
                                articleSupplier.IsStillActive = Convert.ToSByte(mySqlDataReader["IsStillActive"]);
                                if (articleSupplier.IsStillActive == 1)
                                {
                                    articleSupplier.IsActive = "Yes";
                                }
                                else
                                {
                                    articleSupplier.IsActive = "No";
                                }
                            }
                            articleSuppliers.Add(articleSupplier);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetArticleSuppliersByWarehouse_V2340(). ErrorMessage-" + ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }
            foreach (string item in countryISOs)
            {
                byte[] bytes = null;
                bytes = GetCountryIconFileInBytes(item, countryIconFilePath);
                articleSuppliers.Where(ars => ars.Country.Iso == item).ToList().ForEach(oi => oi.Country.CountryIconBytes = bytes);
            }
            Log4NetLogger.Logger.Log("Executed GetArticleSuppliersByWarehouse_V2340().", category: Category.Info, priority: Priority.Low);
            return articleSuppliers;
        }
        //[GEOS2-4027][rdixit][18.11.2022]
        public bool UpdateArticleSupplier_V2340(string connectionString, ArticleSupplier articleSupplier)
        {
            bool status;
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("SRM_Update_ArticleSupplier_V2340", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdArticleSupplier", articleSupplier.IdArticleSupplier);
                    mySqlCommand.Parameters.AddWithValue("_IdCountry", articleSupplier.IdCountry);
                    mySqlCommand.Parameters.AddWithValue("_IdPaymentType", articleSupplier.IdPaymentType);
                    if (articleSupplier.IdEnterpriseGroup > 0)
                        mySqlCommand.Parameters.AddWithValue("_IdEnterpriseGroup", articleSupplier.IdEnterpriseGroup);
                    else
                        mySqlCommand.Parameters.AddWithValue("_IdEnterpriseGroup", null);

                    mySqlCommand.Parameters.AddWithValue("_idArticleSupplierType", articleSupplier.IdArticleSupplierType);
                    mySqlCommand.Parameters.AddWithValue("_OrdersReceptionMethod", articleSupplier.IdOrderReceptionLookup);
                    mySqlCommand.Parameters.AddWithValue("_IsStillActive", articleSupplier.IsStillActive);
                    mySqlCommand.Parameters.AddWithValue("_ModifiedBy", articleSupplier.ModifiedBy);
                    mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now);
                    mySqlCommand.ExecuteNonQuery();
                    mySqlConnection.Close();
                    status = true;
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error UpdateArticleSupplier_V2340(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return status;
        }

        //[GEOS2-3441][sshegaonkar][24.01.2023]
        public List<ArticleBySupplier> GetArticlesByIdArticleSupplier_V2360(string connectionString, UInt64 IdArticleSupplier)
        {
            List<ArticleBySupplier> articleBySupplierList = new List<ArticleBySupplier>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetArticlesByIdArticleSupplier_V2360", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdArticleSupplier", IdArticleSupplier);

                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    while (mySqlDataReader.Read())
                    {
                        try
                        {
                            ArticleBySupplier articleBySupplier = new ArticleBySupplier();

                            articleBySupplier.IdArticleSupplier = Convert.ToInt64(IdArticleSupplier);
                            articleBySupplier.IdArticle = Convert.ToInt64(mySqlDataReader["idArticle"]);

                            if (mySqlDataReader["Reference"] != DBNull.Value)
                                articleBySupplier.Reference = Convert.ToString(mySqlDataReader["Reference"]);

                            if (mySqlDataReader["BasePrice"] != DBNull.Value)
                                articleBySupplier.BasePrice = Convert.ToDouble(mySqlDataReader["BasePrice"]);

                            if (mySqlDataReader["Description"] != DBNull.Value)
                                articleBySupplier.Description = Convert.ToString(mySqlDataReader["Description"]);

                            if (mySqlDataReader["CurrencySymbol"] != DBNull.Value)
                            {
                                articleBySupplier.CurSymbol = Convert.ToString(mySqlDataReader["CurrencySymbol"]);
                            }

                            if (mySqlDataReader["IdCurrency"] != DBNull.Value)
                            {
                                articleBySupplier.IdCurrency = Convert.ToByte(mySqlDataReader["IdCurrency"]);
                                articleBySupplier.Currency = new Currency();
                                articleBySupplier.Currency.IdCurrency = Convert.ToByte(mySqlDataReader["IdCurrency"]);
                                if (mySqlDataReader["Name"] != DBNull.Value)
                                    articleBySupplier.Currency.Name = Convert.ToString(mySqlDataReader["Name"]);
                            }
                            articleBySupplierList.Add(articleBySupplier);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetArticlesByIdArticleSupplier_V2360(IdArticleSupplier-{0}), ErrorMessage- {1} ", IdArticleSupplier, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            Log4NetLogger.Logger.Log("Executed GetArticlesByIdArticleSupplier_V2360().", category: Category.Info, priority: Priority.Low);
            return articleBySupplierList;
        }

        //[GEOS2-3441][sshegaonkar][24.01.2023]
        public ArticleSupplier GetArticleSupplierByIdArticleSupplier_V2360(Warehouses warehouse, UInt64 IdArticleSupplier)
        {
            string connectionString = warehouse.Company.ConnectPlantConstr;
            ArticleSupplier articleSupplier = null;

            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetArticleSupplierByIdArticleSupplier_V2340", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdArticleSupplier", IdArticleSupplier);

                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    while (mySqlDataReader.Read())
                    {
                        try
                        {
                            articleSupplier = new ArticleSupplier();

                            articleSupplier.IdArticleSupplier = Convert.ToInt64(IdArticleSupplier);

                            articleSupplier.Code = "SUPL" + articleSupplier.IdArticleSupplier.ToString().PadLeft(6, '0');

                            if (mySqlDataReader["name"] != DBNull.Value)
                                articleSupplier.Name = Convert.ToString(mySqlDataReader["name"]);

                            if (mySqlDataReader["Cif"] != DBNull.Value)
                                articleSupplier.Cif = Convert.ToString(mySqlDataReader["Cif"]);

                            if (mySqlDataReader["serie"] != DBNull.Value)
                                articleSupplier.Serie = Convert.ToChar(mySqlDataReader["serie"]);

                            if (mySqlDataReader["Observations"] != DBNull.Value)
                                articleSupplier.Observations = Convert.ToString(mySqlDataReader["Observations"]);

                            if (mySqlDataReader["lastOrder"] != DBNull.Value)
                                articleSupplier.LastOrderDate = Convert.ToDateTime(mySqlDataReader["lastOrder"].ToString());

                            if (mySqlDataReader["Phone1"] != DBNull.Value)
                                articleSupplier.Phone1 = Convert.ToString(mySqlDataReader["Phone1"]);

                            if (mySqlDataReader["Phone2"] != DBNull.Value)
                                articleSupplier.Phone2 = Convert.ToString(mySqlDataReader["Phone2"]);

                            if (mySqlDataReader["Email"] != DBNull.Value)
                                articleSupplier.Email = Convert.ToString(mySqlDataReader["Email"]);

                            if (mySqlDataReader["fax"] != DBNull.Value)
                                articleSupplier.Fax = Convert.ToString(mySqlDataReader["fax"]);

                            if (mySqlDataReader["Web"] != DBNull.Value)
                                articleSupplier.Web = Convert.ToString(mySqlDataReader["Web"]);

                            if (mySqlDataReader["Address"] != DBNull.Value)
                                articleSupplier.Address = Convert.ToString(mySqlDataReader["Address"]);

                            if (mySqlDataReader["City"] != DBNull.Value)
                                articleSupplier.City = Convert.ToString(mySqlDataReader["City"]);

                            if (mySqlDataReader["PostCode"] != DBNull.Value)
                                articleSupplier.PostCode = Convert.ToString(mySqlDataReader["PostCode"]);

                            if (mySqlDataReader["IsStillActive"] != DBNull.Value)
                            {
                                articleSupplier.IsStillActive = Convert.ToSByte(mySqlDataReader["IsStillActive"]);
                            }

                            //[001][GEOS2-3440][pjadhav]
                            if (mySqlDataReader["idcountry"] != DBNull.Value)
                            {
                                articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["idcountry"]);
                                articleSupplier.Country = new Country();
                                articleSupplier.Country.IdCountry = Convert.ToByte(mySqlDataReader["idcountry"]);

                                if (mySqlDataReader["CountryName"] != DBNull.Value)
                                {
                                    articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);
                                }
                            }

                            if (mySqlDataReader["IdEnterpriseGroup"] != DBNull.Value)
                            {

                                articleSupplier.IdEnterpriseGroup = Convert.ToInt32(mySqlDataReader["IdEnterpriseGroup"]);
                                articleSupplier.EnterpriseGroup = new Group();
                                articleSupplier.EnterpriseGroup.IdEnterpriseGroup = Convert.ToInt32(mySqlDataReader["IdEnterpriseGroup"]);
                                if (mySqlDataReader["groupName"] != DBNull.Value)
                                {
                                    articleSupplier.EnterpriseGroup.Name = Convert.ToString(mySqlDataReader["groupName"]);
                                }
                            }
                            if (mySqlDataReader["idArticleSupplierType"] != DBNull.Value)
                            {

                                articleSupplier.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["idArticleSupplierType"]);
                                articleSupplier.ArticleSupplierType = new ArticleSupplierType();
                                articleSupplier.ArticleSupplierType.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["idArticleSupplierType"]);
                                if (mySqlDataReader["CategoryName"] != DBNull.Value)
                                {
                                    articleSupplier.ArticleSupplierType.Name = Convert.ToString(mySqlDataReader["CategoryName"]);
                                }
                            }
                            if (mySqlDataReader["IdPaymentType"] != DBNull.Value)
                            {

                                articleSupplier.IdPaymentType = Convert.ToInt64(mySqlDataReader["IdPaymentType"]);
                                articleSupplier.PaymentTerm = new PaymentTerm();
                                articleSupplier.PaymentTerm.IdPaymentType = Convert.ToInt32(mySqlDataReader["IdPaymentType"]);
                                if (mySqlDataReader["paymentType"] != DBNull.Value)
                                {
                                    articleSupplier.PaymentTerm.PaymentType = Convert.ToString(mySqlDataReader["paymentType"]);
                                }
                            }


                            if (mySqlDataReader["modifiedIn"] != DBNull.Value)
                                articleSupplier.ModifiedIn = Convert.ToDateTime(mySqlDataReader["modifiedIn"].ToString());

                            if (mySqlDataReader["createdIn"] != DBNull.Value)
                                articleSupplier.CreatedIn = Convert.ToDateTime(mySqlDataReader["createdIn"].ToString());

                            if (mySqlDataReader["State"] != DBNull.Value)
                                articleSupplier.Region = Convert.ToString(mySqlDataReader["State"]);

                            if (mySqlDataReader["Latitude"] != DBNull.Value)
                            {
                                articleSupplier.Latitude = Convert.ToDouble(mySqlDataReader["Latitude"]);
                                articleSupplier.Coordinates = articleSupplier.Latitude.ToString();
                            }

                            if (mySqlDataReader["Longitude"] != DBNull.Value)
                            {
                                articleSupplier.Longitude = Convert.ToDouble(mySqlDataReader["Longitude"]);
                                if (mySqlDataReader["Latitude"] != DBNull.Value)
                                {
                                    articleSupplier.Coordinates = articleSupplier.Latitude.ToString() + ", " + articleSupplier.Longitude.ToString();
                                }
                                else
                                {
                                    articleSupplier.Coordinates = articleSupplier.Longitude.ToString();
                                }
                            }

                            if (mySqlDataReader["OrdersReceptionMethod"] != DBNull.Value)
                            {

                                articleSupplier.IdOrderReceptionLookup = Convert.ToInt32(mySqlDataReader["OrdersReceptionMethod"]);
                                articleSupplier.OrderReceptionLookup = new LookupValue();
                                articleSupplier.OrderReceptionLookup.IdLookupValue = Convert.ToInt32(mySqlDataReader["OrdersReceptionMethod"]);
                                if (mySqlDataReader["OrdersReceptionMethodValue"] != DBNull.Value)
                                {
                                    articleSupplier.OrderReceptionLookup.Value = Convert.ToString(mySqlDataReader["OrdersReceptionMethodValue"]);
                                }
                                if (mySqlDataReader["OrdersReceptionMethodHtmlColor"] != DBNull.Value)
                                {
                                    articleSupplier.OrderReceptionLookup.HtmlColor = Convert.ToString(mySqlDataReader["OrdersReceptionMethodHtmlColor"]);
                                }
                            }
                            articleSupplier.ArticleList = GetArticlesByIdArticleSupplier_V2360(connectionString, IdArticleSupplier);
                            articleSupplier.DocumentList = GetDocumentsByIdArticleSupplier(connectionString, IdArticleSupplier);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetArticleSupplierByIdArticleSupplier_V2360(IdArticleSupplier-{0}), ErrorMessage- {1} ", IdArticleSupplier, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }

                    if (mySqlDataReader.NextResult())
                    {
                        while (mySqlDataReader.Read())
                        {
                            WarehousePurchaseOrder WarehousePurchaseOrder = new WarehousePurchaseOrder();
                            if (mySqlDataReader["Code"] != DBNull.Value)
                            {
                                if (articleSupplier.Orders == null)
                                {
                                    articleSupplier.Orders = new List<WarehousePurchaseOrder>();
                                }
                                WarehousePurchaseOrder.Code = Convert.ToString(mySqlDataReader["Code"]);
                                WarehousePurchaseOrder.IdWarehousePurchaseOrder = Convert.ToInt64(mySqlDataReader["IdWarehousePurchaseOrder"]);
                                if (mySqlDataReader["WpoDate"] != DBNull.Value)
                                {
                                    WarehousePurchaseOrder.CreatedIn = Convert.ToDateTime(mySqlDataReader["WpoDate"].ToString());
                                }

                            }
                            articleSupplier.Orders.Add(WarehousePurchaseOrder);
                        }

                    }

                    if (mySqlDataReader.NextResult())
                    {
                        while (mySqlDataReader.Read())
                        {
                            ArticleSupplierPlants articleSupplierPlants = new ArticleSupplierPlants();
                            if (mySqlDataReader["IdSite"] != DBNull.Value)
                            {
                                if (articleSupplier.Plants == null)
                                {
                                    articleSupplier.Plants = new List<ArticleSupplierPlants>();
                                }
                                articleSupplierPlants.IdSite = Convert.ToInt64(mySqlDataReader["IdSite"]);
                                articleSupplierPlants.Name = Convert.ToString(mySqlDataReader["Name"]);
                                articleSupplierPlants.Allow = Convert.ToBoolean(mySqlDataReader["Allow"]);
                            }
                            articleSupplier.Plants.Add(articleSupplierPlants);
                        }

                    }
                }
            }
            articleSupplier.LogEntriesByArticleSuppliers = GetLogEntriesByArticleSuppliers(warehouse, IdArticleSupplier);
            return articleSupplier;
        }



        //[GEOS2-3442][cpatil][20.03.2023]
        public ArticleSupplier GetArticleSupplierByIdArticleSupplier_V2370(Warehouses warehouse, UInt64 IdArticleSupplier)
        {
            string connectionString = warehouse.Company.ConnectPlantConstr;
            ArticleSupplier articleSupplier = null;

            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetArticleSupplierByIdArticleSupplier_V2370", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdArticleSupplier", IdArticleSupplier);

                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    while (mySqlDataReader.Read())
                    {
                        try
                        {
                            articleSupplier = new ArticleSupplier();

                            articleSupplier.IdArticleSupplier = Convert.ToInt64(IdArticleSupplier);

                            articleSupplier.Code = "SUPL" + articleSupplier.IdArticleSupplier.ToString().PadLeft(6, '0');

                            if (mySqlDataReader["name"] != DBNull.Value)
                                articleSupplier.Name = Convert.ToString(mySqlDataReader["name"]);

                            if (mySqlDataReader["Cif"] != DBNull.Value)
                                articleSupplier.Cif = Convert.ToString(mySqlDataReader["Cif"]);

                            if (mySqlDataReader["serie"] != DBNull.Value)
                                articleSupplier.Serie = Convert.ToChar(mySqlDataReader["serie"]);

                            if (mySqlDataReader["Observations"] != DBNull.Value)
                                articleSupplier.Observations = Convert.ToString(mySqlDataReader["Observations"]);

                            if (mySqlDataReader["lastOrder"] != DBNull.Value)
                                articleSupplier.LastOrderDate = Convert.ToDateTime(mySqlDataReader["lastOrder"].ToString());

                            if (mySqlDataReader["Phone1"] != DBNull.Value)
                                articleSupplier.Phone1 = Convert.ToString(mySqlDataReader["Phone1"]);

                            if (mySqlDataReader["Phone2"] != DBNull.Value)
                                articleSupplier.Phone2 = Convert.ToString(mySqlDataReader["Phone2"]);

                            if (mySqlDataReader["Email"] != DBNull.Value)
                                articleSupplier.Email = Convert.ToString(mySqlDataReader["Email"]);

                            if (mySqlDataReader["fax"] != DBNull.Value)
                                articleSupplier.Fax = Convert.ToString(mySqlDataReader["fax"]);

                            if (mySqlDataReader["Web"] != DBNull.Value)
                                articleSupplier.Web = Convert.ToString(mySqlDataReader["Web"]);

                            if (mySqlDataReader["Address"] != DBNull.Value)
                                articleSupplier.Address = Convert.ToString(mySqlDataReader["Address"]);

                            if (mySqlDataReader["City"] != DBNull.Value)
                                articleSupplier.City = Convert.ToString(mySqlDataReader["City"]);

                            if (mySqlDataReader["PostCode"] != DBNull.Value)
                                articleSupplier.PostCode = Convert.ToString(mySqlDataReader["PostCode"]);

                            if (mySqlDataReader["IsStillActive"] != DBNull.Value)
                            {
                                articleSupplier.IsStillActive = Convert.ToSByte(mySqlDataReader["IsStillActive"]);
                            }

                            //[001][GEOS2-3440][pjadhav]
                            if (mySqlDataReader["idcountry"] != DBNull.Value)
                            {
                                articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["idcountry"]);
                                articleSupplier.Country = new Country();
                                articleSupplier.Country.IdCountry = Convert.ToByte(mySqlDataReader["idcountry"]);

                                if (mySqlDataReader["CountryName"] != DBNull.Value)
                                {
                                    articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);
                                }
                            }

                            if (mySqlDataReader["IdEnterpriseGroup"] != DBNull.Value)
                            {

                                articleSupplier.IdEnterpriseGroup = Convert.ToInt32(mySqlDataReader["IdEnterpriseGroup"]);
                                articleSupplier.EnterpriseGroup = new Group();
                                articleSupplier.EnterpriseGroup.IdEnterpriseGroup = Convert.ToInt32(mySqlDataReader["IdEnterpriseGroup"]);
                                if (mySqlDataReader["groupName"] != DBNull.Value)
                                {
                                    articleSupplier.EnterpriseGroup.Name = Convert.ToString(mySqlDataReader["groupName"]);
                                }
                            }
                            if (mySqlDataReader["idArticleSupplierType"] != DBNull.Value)
                            {

                                articleSupplier.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["idArticleSupplierType"]);
                                articleSupplier.ArticleSupplierType = new ArticleSupplierType();
                                articleSupplier.ArticleSupplierType.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["idArticleSupplierType"]);
                                if (mySqlDataReader["CategoryName"] != DBNull.Value)
                                {
                                    articleSupplier.ArticleSupplierType.Name = Convert.ToString(mySqlDataReader["CategoryName"]);
                                }
                            }
                            if (mySqlDataReader["IdPaymentType"] != DBNull.Value)
                            {

                                articleSupplier.IdPaymentType = Convert.ToInt64(mySqlDataReader["IdPaymentType"]);
                                articleSupplier.PaymentTerm = new PaymentTerm();
                                articleSupplier.PaymentTerm.IdPaymentType = Convert.ToInt32(mySqlDataReader["IdPaymentType"]);
                                if (mySqlDataReader["paymentType"] != DBNull.Value)
                                {
                                    articleSupplier.PaymentTerm.PaymentType = Convert.ToString(mySqlDataReader["paymentType"]);
                                }
                            }


                            if (mySqlDataReader["modifiedIn"] != DBNull.Value)
                                articleSupplier.ModifiedIn = Convert.ToDateTime(mySqlDataReader["modifiedIn"].ToString());

                            if (mySqlDataReader["createdIn"] != DBNull.Value)
                                articleSupplier.CreatedIn = Convert.ToDateTime(mySqlDataReader["createdIn"].ToString());

                            if (mySqlDataReader["State"] != DBNull.Value)
                                articleSupplier.Region = Convert.ToString(mySqlDataReader["State"]);

                            if (mySqlDataReader["Latitude"] != DBNull.Value)
                            {
                                articleSupplier.Latitude = Convert.ToDouble(mySqlDataReader["Latitude"]);
                                articleSupplier.Coordinates = articleSupplier.Latitude.ToString();
                            }

                            if (mySqlDataReader["Longitude"] != DBNull.Value)
                            {
                                articleSupplier.Longitude = Convert.ToDouble(mySqlDataReader["Longitude"]);
                                if (mySqlDataReader["Latitude"] != DBNull.Value)
                                {
                                    articleSupplier.Coordinates = articleSupplier.Latitude.ToString() + ", " + articleSupplier.Longitude.ToString();
                                }
                                else
                                {
                                    articleSupplier.Coordinates = articleSupplier.Longitude.ToString();
                                }
                            }

                            if (mySqlDataReader["OrdersReceptionMethod"] != DBNull.Value)
                            {

                                articleSupplier.IdOrderReceptionLookup = Convert.ToInt32(mySqlDataReader["OrdersReceptionMethod"]);
                                articleSupplier.OrderReceptionLookup = new LookupValue();
                                articleSupplier.OrderReceptionLookup.IdLookupValue = Convert.ToInt32(mySqlDataReader["OrdersReceptionMethod"]);
                                if (mySqlDataReader["OrdersReceptionMethodValue"] != DBNull.Value)
                                {
                                    articleSupplier.OrderReceptionLookup.Value = Convert.ToString(mySqlDataReader["OrdersReceptionMethodValue"]);
                                }
                                if (mySqlDataReader["OrdersReceptionMethodHtmlColor"] != DBNull.Value)
                                {
                                    articleSupplier.OrderReceptionLookup.HtmlColor = Convert.ToString(mySqlDataReader["OrdersReceptionMethodHtmlColor"]);
                                }
                            }

                            if (mySqlDataReader["deliveryDays"] != DBNull.Value)
                            {
                                articleSupplier.DeliveryDays = Convert.ToInt64(mySqlDataReader["deliveryDays"]);
                            }

                            if (mySqlDataReader["IdCarriageMethod"] != DBNull.Value)
                            {
                                articleSupplier.IdCarriageMethod = Convert.ToInt32(mySqlDataReader["IdCarriageMethod"]);
                                articleSupplier.CarriageMethod = new LookupValue();
                                articleSupplier.CarriageMethod.IdLookupValue = Convert.ToInt32(mySqlDataReader["IdCarriageMethod"]);
                                articleSupplier.CarriageMethod.Value = Convert.ToString(mySqlDataReader["CarriageMethod"]);
                            }

                            articleSupplier.ArticleList = GetArticlesByIdArticleSupplier_V2360(connectionString, IdArticleSupplier);
                            articleSupplier.DocumentList = GetDocumentsByIdArticleSupplier(connectionString, IdArticleSupplier);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetArticleSupplierByIdArticleSupplier_V2360(IdArticleSupplier-{0}), ErrorMessage- {1} ", IdArticleSupplier, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }

                    if (mySqlDataReader.NextResult())
                    {
                        while (mySqlDataReader.Read())
                        {
                            WarehousePurchaseOrder WarehousePurchaseOrder = new WarehousePurchaseOrder();
                            if (mySqlDataReader["Code"] != DBNull.Value)
                            {
                                if (articleSupplier.Orders == null)
                                {
                                    articleSupplier.Orders = new List<WarehousePurchaseOrder>();
                                }
                                WarehousePurchaseOrder.Code = Convert.ToString(mySqlDataReader["Code"]);
                                WarehousePurchaseOrder.IdWarehousePurchaseOrder = Convert.ToInt64(mySqlDataReader["IdWarehousePurchaseOrder"]);
                                if (mySqlDataReader["WpoDate"] != DBNull.Value)
                                {
                                    WarehousePurchaseOrder.CreatedIn = Convert.ToDateTime(mySqlDataReader["WpoDate"].ToString());
                                }

                            }
                            articleSupplier.Orders.Add(WarehousePurchaseOrder);
                        }

                    }

                    if (mySqlDataReader.NextResult())
                    {
                        while (mySqlDataReader.Read())
                        {
                            ArticleSupplierPlants articleSupplierPlants = new ArticleSupplierPlants();
                            if (mySqlDataReader["IdSite"] != DBNull.Value)
                            {
                                if (articleSupplier.Plants == null)
                                {
                                    articleSupplier.Plants = new List<ArticleSupplierPlants>();
                                }
                                articleSupplierPlants.IdSite = Convert.ToInt64(mySqlDataReader["IdSite"]);
                                articleSupplierPlants.Name = Convert.ToString(mySqlDataReader["Name"]);
                                articleSupplierPlants.Allow = Convert.ToBoolean(mySqlDataReader["Allow"]);
                            }
                            articleSupplier.Plants.Add(articleSupplierPlants);
                        }

                    }
                }
            }
            articleSupplier.LogEntriesByArticleSuppliers = GetLogEntriesByArticleSuppliers(warehouse, IdArticleSupplier);
            return articleSupplier;
        }


        //[GEOS2-3442][cpatil][20.03.2023]
        public bool UpdateArticleSupplier_V2370(string connectionString, ArticleSupplier articleSupplier)
        {
            bool status;
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("SRM_Update_ArticleSupplier_V2370", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdArticleSupplier", articleSupplier.IdArticleSupplier);
                    mySqlCommand.Parameters.AddWithValue("_IdCountry", articleSupplier.IdCountry);
                    mySqlCommand.Parameters.AddWithValue("_IdPaymentType", articleSupplier.IdPaymentType);
                    if (articleSupplier.IdEnterpriseGroup > 0)
                        mySqlCommand.Parameters.AddWithValue("_IdEnterpriseGroup", articleSupplier.IdEnterpriseGroup);
                    else
                        mySqlCommand.Parameters.AddWithValue("_IdEnterpriseGroup", null);

                    mySqlCommand.Parameters.AddWithValue("_idArticleSupplierType", articleSupplier.IdArticleSupplierType);
                    mySqlCommand.Parameters.AddWithValue("_OrdersReceptionMethod", articleSupplier.IdOrderReceptionLookup);
                    mySqlCommand.Parameters.AddWithValue("_IsStillActive", articleSupplier.IsStillActive);
                    mySqlCommand.Parameters.AddWithValue("_ModifiedBy", articleSupplier.ModifiedBy);
                    mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now);
                    mySqlCommand.Parameters.AddWithValue("_deliveryDays", articleSupplier.DeliveryDays);
                    if (articleSupplier.IdCarriageMethod > 0)
                        mySqlCommand.Parameters.AddWithValue("_IdCarriageMethod", articleSupplier.IdCarriageMethod);
                    else
                        mySqlCommand.Parameters.AddWithValue("_IdCarriageMethod", null);

                    mySqlCommand.ExecuteNonQuery();
                    mySqlConnection.Close();
                    status = true;
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error UpdateArticleSupplier_V2370(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return status;
        }

        //[GEOS2-4310][rdixit][05.04.2023]
        public WarehousePurchaseOrder GetPendingPOByIdWarehousePurchaseOrder_V2380(string connectionString, Int64 idWarehousePurchaseOrder, string purchaseOrdersPath, string emailTemplatePath, string countryIconFilePath)
        {
            WarehousePurchaseOrder warehousePurchaseOrder = null;

            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetPendingPOByIdWarehousePurchaseOrder_V2380", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", idWarehousePurchaseOrder);

                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    if (mySqlDataReader.Read())
                    {
                        try
                        {
                            warehousePurchaseOrder = new WarehousePurchaseOrder();

                            warehousePurchaseOrder.IdWarehousePurchaseOrder = idWarehousePurchaseOrder;

                            if (mySqlDataReader["Code"] != DBNull.Value)
                                warehousePurchaseOrder.Code = Convert.ToString(mySqlDataReader["Code"]);

                            if (mySqlDataReader["IdArticleSupplier"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                                ArticleSupplier articleSupplier = new ArticleSupplier();
                                articleSupplier.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                                if (mySqlDataReader["Supplier"] != DBNull.Value)
                                    articleSupplier.Name = Convert.ToString(mySqlDataReader["Supplier"]);

                                if (mySqlDataReader["SupplierContactPerson"] != DBNull.Value)
                                    articleSupplier.ContactPerson = Convert.ToString(mySqlDataReader["SupplierContactPerson"]);

                                if (mySqlDataReader["SupplierContactEmail"] != DBNull.Value)
                                    articleSupplier.ContactEmail = Convert.ToString(mySqlDataReader["SupplierContactEmail"]);

                                if (mySqlDataReader["Serie"] != DBNull.Value)
                                    articleSupplier.Serie = Convert.ToChar(mySqlDataReader["Serie"]);

                                if (mySqlDataReader["IdCountry"] != DBNull.Value)
                                {
                                    articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["IdCountry"]);

                                    articleSupplier.Country = new Country();
                                    articleSupplier.Country.IdCountry = (byte)articleSupplier.IdCountry;
                                    articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);

                                    if (mySqlDataReader["SupplierCountryISO"] != DBNull.Value)
                                    {
                                        articleSupplier.Country.Iso = Convert.ToString(mySqlDataReader["SupplierCountryISO"]);
                                        byte[] bytes = null;
                                        bytes = GetCountryIconFileInBytes(articleSupplier.Country.Iso, countryIconFilePath);
                                        articleSupplier.Country.CountryIconBytes = bytes;
                                    }

                                    if (mySqlDataReader["IdCountryGroup"] != DBNull.Value)
                                        articleSupplier.Country.IdCountryGroup = Convert.ToInt64(mySqlDataReader["IdCountryGroup"]);
                                }

                                if (mySqlDataReader["IdArticleSupplierType"] != DBNull.Value)
                                {
                                    articleSupplier.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["IdArticleSupplierType"]);

                                    articleSupplier.ArticleSupplierType = new ArticleSupplierType();
                                    articleSupplier.ArticleSupplierType.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["IdArticleSupplierType"]);
                                    articleSupplier.ArticleSupplierType.Name = Convert.ToString(mySqlDataReader["ArticleSupplierType"]);
                                    articleSupplier.ArticleSupplierType.HtmlColor = Convert.ToString(mySqlDataReader["HtmlColor"]);
                                }

                                warehousePurchaseOrder.ArticleSupplier = articleSupplier;
                            }

                            if (mySqlDataReader["DeliveryDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["deliveryDate"]) != DateTime.MinValue)
                            {
                                warehousePurchaseOrder.DeliveryDate = Convert.ToDateTime(mySqlDataReader["deliveryDate"]);
                            }

                            if (mySqlDataReader["AttachedPO"] != DBNull.Value)
                                warehousePurchaseOrder.AttachedPO = Convert.ToByte(mySqlDataReader["AttachedPO"]);

                            if (mySqlDataReader["IdPaymentType"] != DBNull.Value)
                                warehousePurchaseOrder.IdPaymentType = Convert.ToInt64(mySqlDataReader["IdPaymentType"]);

                            if (mySqlDataReader["ReminderEmailDate"] != DBNull.Value)
                                warehousePurchaseOrder.ReminderEmailDate = Convert.ToDateTime(mySqlDataReader["ReminderEmailDate"]);

                            if (mySqlDataReader["CreatedIn"] != DBNull.Value)
                                warehousePurchaseOrder.CreatedIn = Convert.ToDateTime(mySqlDataReader["CreatedIn"]);

                            if (mySqlDataReader["ModifiedIn"] != DBNull.Value)
                                warehousePurchaseOrder.ModifiedIn = Convert.ToDateTime(mySqlDataReader["ModifiedIn"]);

                            if (mySqlDataReader["Comments"] != DBNull.Value)
                                warehousePurchaseOrder.Comments = Convert.ToString(mySqlDataReader["Comments"]);

                            if (mySqlDataReader["IsClosed"] != DBNull.Value)
                                warehousePurchaseOrder.IsClosed = Convert.ToByte(mySqlDataReader["IsClosed"]);

                            if (mySqlDataReader["CreatedBy"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.CreatedBy = Convert.ToInt64(mySqlDataReader["CreatedBy"]);
                                warehousePurchaseOrder.Creator = new People();
                                warehousePurchaseOrder.Creator.IdPerson = Convert.ToInt32(mySqlDataReader["CreatedBy"].ToString());
                                warehousePurchaseOrder.Creator.Name = mySqlDataReader["CreatorName"].ToString();
                                warehousePurchaseOrder.Creator.Surname = mySqlDataReader["CreatorSurname"].ToString();
                            }

                            if (mySqlDataReader["ModifiedBy"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.ModifiedBy = Convert.ToInt64(mySqlDataReader["ModifiedBy"]);
                                warehousePurchaseOrder.Modifier = new People();
                                warehousePurchaseOrder.Modifier.IdPerson = Convert.ToInt32(mySqlDataReader["ModifiedBy"].ToString());
                                warehousePurchaseOrder.Modifier.Name = mySqlDataReader["ModifierName"].ToString();
                                warehousePurchaseOrder.Modifier.Surname = mySqlDataReader["ModifierSurname"].ToString();
                            }

                            if (mySqlDataReader["ReasonClosed"] != DBNull.Value)
                                warehousePurchaseOrder.ReasonClosed = Convert.ToString(mySqlDataReader["ReasonClosed"]);

                            if (mySqlDataReader["IdWarehouse"] != DBNull.Value)
                                warehousePurchaseOrder.IdWarehouse = Convert.ToInt64(mySqlDataReader["IdWarehouse"]);

                            if (mySqlDataReader["IdCurrency"] != DBNull.Value)
                                warehousePurchaseOrder.IdCurrency = Convert.ToByte(mySqlDataReader["IdCurrency"]);

                            if (mySqlDataReader["IdWorkflowStatus"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                warehousePurchaseOrder.WorkflowStatus = new WorkflowStatus();
                                warehousePurchaseOrder.WorkflowStatus.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                warehousePurchaseOrder.WorkflowStatus.Name = Convert.ToString(mySqlDataReader["Status"]);
                                warehousePurchaseOrder.WorkflowStatus.HtmlColor = Convert.ToString(mySqlDataReader["StatusHtmlColor"]);
                            }

                            if (mySqlDataReader["IdAssignee"] != DBNull.Value)
                                warehousePurchaseOrder.IdAssignee = Convert.ToUInt32(mySqlDataReader["IdAssignee"]);

                            if (mySqlDataReader["IdApprover"] != DBNull.Value)
                                warehousePurchaseOrder.IdApprover = Convert.ToUInt32(mySqlDataReader["IdApprover"]);

                            string HTMLFileName = null;
                            if (File.Exists(string.Format("{0}{1}SupplierPurchaseOrderRequestMailFormat_{2}-{3}.html", emailTemplatePath, @"\", warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower(), warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToUpper())))
                            {
                                HTMLFileName = string.Format("SupplierPurchaseOrderRequestMailFormat_{0}-{1}.html", warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower(), warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToUpper());
                            }
                            else if (File.Exists(string.Format("{0}{1}SupplierPurchaseOrderRequestMailFormat.html", emailTemplatePath, @"\")))
                            {
                                HTMLFileName = "SupplierPurchaseOrderRequestMailFormat.html";
                            }
                            if (HTMLFileName != null)
                            {
                                StringBuilder emailbody = new StringBuilder();
                                string text = ReadMailTemplate(HTMLFileName, emailTemplatePath);

                                if (string.IsNullOrEmpty(warehousePurchaseOrder.ArticleSupplier.ContactPerson))
                                {
                                    text = text.Replace("[Supplier_Name]", "Supplier");
                                }
                                else
                                {
                                    text = text.Replace("[Supplier_Name]", warehousePurchaseOrder.ArticleSupplier.ContactPerson);
                                }
                                text = text.Replace("[PO_Code]", warehousePurchaseOrder.Code);

                                emailbody.Append(text);

                                warehousePurchaseOrder.EmailBody = emailbody.ToString();
                            }
                            warehousePurchaseOrder.AttachPdf = warehousePurchaseOrder.CreatedIn.Year + @"\" + warehousePurchaseOrder.Code + @"\01 Purchase Order\PO_" + warehousePurchaseOrder.Code + ".pdf";

                            warehousePurchaseOrder.AttachmentBytes = GetPurchaseOrderPdf(purchaseOrdersPath, warehousePurchaseOrder.AttachPdf);
                            warehousePurchaseOrder.WarehouseDeliveryNotes = GetDeliveryNotesByIdWarehousePurchaseOrder(connectionString, warehousePurchaseOrder, purchaseOrdersPath);

                            warehousePurchaseOrder.WarehousePurchaseOrderItemWithComments = GetArticlesByIdWarehousePurchaseOrder_V2300(connectionString, warehousePurchaseOrder.IdWarehousePurchaseOrder);

                            warehousePurchaseOrder.WarehousePOComments = GetlogEntriesByWarehousePO(idWarehousePurchaseOrder, 252, connectionString);
                            warehousePurchaseOrder.WarehousePOLogEntries = GetlogEntriesByWarehousePO(idWarehousePurchaseOrder, 253, connectionString);

                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetPendingPOByIdWarehousePurchaseOrder_V2380(idWarehousePurchaseOrder-{0}), ErrorMessage- {1} ", idWarehousePurchaseOrder, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            return warehousePurchaseOrder;
        }

        //[GEOS2-4309][rdixit][10.04.2023]
        public List<WarehousePurchaseOrder> SendPOMailForSelectedPO_V2380(string connectionString, List<WarehousePurchaseOrder> ListPurchaseOrder_Checked, string purchaseOrdersPath, string emailTemplatePath)
        {
            List<WarehousePurchaseOrder> warehousePurchaseOrderList = new List<WarehousePurchaseOrder>();
            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();
                foreach (var item in ListPurchaseOrder_Checked)
                {
                    MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetPendingPOByIdWarehousePurchaseOrder_V2380", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", item.IdWarehousePurchaseOrder);

                    using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                    {
                        if (mySqlDataReader.Read())
                        {
                            try
                            {
                                WarehousePurchaseOrder warehousePurchaseOrder = new WarehousePurchaseOrder();

                                warehousePurchaseOrder.IdWarehousePurchaseOrder = item.IdWarehousePurchaseOrder;

                                if (mySqlDataReader["Code"] != DBNull.Value)
                                    warehousePurchaseOrder.Code = Convert.ToString(mySqlDataReader["Code"]);

                                if (mySqlDataReader["IdArticleSupplier"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                                    ArticleSupplier articleSupplier = new ArticleSupplier();
                                    articleSupplier.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                                    if (mySqlDataReader["Supplier"] != DBNull.Value)
                                        articleSupplier.Name = Convert.ToString(mySqlDataReader["Supplier"]);

                                    if (mySqlDataReader["SupplierContactPerson"] != DBNull.Value)
                                        articleSupplier.ContactPerson = Convert.ToString(mySqlDataReader["SupplierContactPerson"]);

                                    if (mySqlDataReader["SupplierContactEmail"] != DBNull.Value)
                                        articleSupplier.ContactEmail = Convert.ToString(mySqlDataReader["SupplierContactEmail"]);

                                    if (mySqlDataReader["Serie"] != DBNull.Value)
                                        articleSupplier.Serie = Convert.ToChar(mySqlDataReader["Serie"]);

                                    if (mySqlDataReader["IdCountry"] != DBNull.Value)
                                    {
                                        articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["IdCountry"]);

                                        articleSupplier.Country = new Country();
                                        articleSupplier.Country.IdCountry = (byte)articleSupplier.IdCountry;
                                        articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);

                                        if (mySqlDataReader["IdCountryGroup"] != DBNull.Value)
                                            articleSupplier.Country.IdCountryGroup = Convert.ToInt64(mySqlDataReader["IdCountryGroup"]);

                                        if (mySqlDataReader["SupplierCountryISO"] != DBNull.Value)
                                            articleSupplier.Country.Iso = Convert.ToString(mySqlDataReader["SupplierCountryISO"]);

                                    }

                                    if (mySqlDataReader["IdArticleSupplierType"] != DBNull.Value)
                                    {
                                        articleSupplier.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["IdArticleSupplierType"]);

                                        articleSupplier.ArticleSupplierType = new ArticleSupplierType();
                                        articleSupplier.ArticleSupplierType.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["IdArticleSupplierType"]);
                                        articleSupplier.ArticleSupplierType.Name = Convert.ToString(mySqlDataReader["ArticleSupplierType"]);
                                        articleSupplier.ArticleSupplierType.HtmlColor = Convert.ToString(mySqlDataReader["HtmlColor"]);
                                    }

                                    warehousePurchaseOrder.ArticleSupplier = articleSupplier;
                                }

                                if (mySqlDataReader["DeliveryDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["deliveryDate"]) != DateTime.MinValue)
                                {
                                    warehousePurchaseOrder.DeliveryDate = Convert.ToDateTime(mySqlDataReader["deliveryDate"]);
                                }

                                if (mySqlDataReader["AttachedPO"] != DBNull.Value)
                                    warehousePurchaseOrder.AttachedPO = Convert.ToByte(mySqlDataReader["AttachedPO"]);

                                if (mySqlDataReader["IdPaymentType"] != DBNull.Value)
                                    warehousePurchaseOrder.IdPaymentType = Convert.ToInt64(mySqlDataReader["IdPaymentType"]);

                                if (mySqlDataReader["ReminderEmailDate"] != DBNull.Value)
                                    warehousePurchaseOrder.ReminderEmailDate = Convert.ToDateTime(mySqlDataReader["ReminderEmailDate"]);

                                if (mySqlDataReader["CreatedIn"] != DBNull.Value)
                                    warehousePurchaseOrder.CreatedIn = Convert.ToDateTime(mySqlDataReader["CreatedIn"]);

                                if (mySqlDataReader["ModifiedIn"] != DBNull.Value)
                                    warehousePurchaseOrder.ModifiedIn = Convert.ToDateTime(mySqlDataReader["ModifiedIn"]);

                                if (mySqlDataReader["Comments"] != DBNull.Value)
                                    warehousePurchaseOrder.Comments = Convert.ToString(mySqlDataReader["Comments"]);

                                if (mySqlDataReader["IsClosed"] != DBNull.Value)
                                    warehousePurchaseOrder.IsClosed = Convert.ToByte(mySqlDataReader["IsClosed"]);

                                if (mySqlDataReader["CreatedBy"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.CreatedBy = Convert.ToInt64(mySqlDataReader["CreatedBy"]);
                                    warehousePurchaseOrder.Creator = new People();
                                    warehousePurchaseOrder.Creator.IdPerson = Convert.ToInt32(mySqlDataReader["CreatedBy"].ToString());
                                    warehousePurchaseOrder.Creator.Name = mySqlDataReader["CreatorName"].ToString();
                                    warehousePurchaseOrder.Creator.Surname = mySqlDataReader["CreatorSurname"].ToString();
                                }

                                if (mySqlDataReader["ModifiedBy"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.ModifiedBy = Convert.ToInt64(mySqlDataReader["ModifiedBy"]);
                                    warehousePurchaseOrder.Modifier = new People();
                                    warehousePurchaseOrder.Modifier.IdPerson = Convert.ToInt32(mySqlDataReader["ModifiedBy"].ToString());
                                    warehousePurchaseOrder.Modifier.Name = mySqlDataReader["ModifierName"].ToString();
                                    warehousePurchaseOrder.Modifier.Surname = mySqlDataReader["ModifierSurname"].ToString();
                                }

                                if (mySqlDataReader["ReasonClosed"] != DBNull.Value)
                                    warehousePurchaseOrder.ReasonClosed = Convert.ToString(mySqlDataReader["ReasonClosed"]);

                                if (mySqlDataReader["IdWarehouse"] != DBNull.Value)
                                    warehousePurchaseOrder.IdWarehouse = Convert.ToInt64(mySqlDataReader["IdWarehouse"]);

                                if (mySqlDataReader["IdCurrency"] != DBNull.Value)
                                    warehousePurchaseOrder.IdCurrency = Convert.ToByte(mySqlDataReader["IdCurrency"]);

                                if (mySqlDataReader["IdWorkflowStatus"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                    warehousePurchaseOrder.WorkflowStatus = new WorkflowStatus();
                                    warehousePurchaseOrder.WorkflowStatus.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                    warehousePurchaseOrder.WorkflowStatus.Name = Convert.ToString(mySqlDataReader["Status"]);
                                    warehousePurchaseOrder.WorkflowStatus.HtmlColor = Convert.ToString(mySqlDataReader["StatusHtmlColor"]);
                                }

                                if (mySqlDataReader["IdAssignee"] != DBNull.Value)
                                    warehousePurchaseOrder.IdAssignee = Convert.ToUInt32(mySqlDataReader["IdAssignee"]);

                                if (mySqlDataReader["IdApprover"] != DBNull.Value)
                                    warehousePurchaseOrder.IdApprover = Convert.ToUInt32(mySqlDataReader["IdApprover"]);

                                string HTMLFileName = null;
                                if (File.Exists(string.Format("{0}{1}SupplierPurchaseOrderRequestMailFormat_{2}-{3}.html", emailTemplatePath, @"\", warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower(), warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToUpper())))
                                {
                                    HTMLFileName = string.Format("SupplierPurchaseOrderRequestMailFormat_{0}-{1}.html", warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower(), warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToUpper());
                                }
                                else if (File.Exists(string.Format("{0}{1}SupplierPurchaseOrderRequestMailFormat.html", emailTemplatePath, @"\")))
                                {
                                    HTMLFileName = "SupplierPurchaseOrderRequestMailFormat.html";
                                }
                                if (HTMLFileName != null)
                                {
                                    StringBuilder emailbody = new StringBuilder();
                                    string text = ReadMailTemplate(HTMLFileName, emailTemplatePath);

                                    if (string.IsNullOrEmpty(warehousePurchaseOrder.ArticleSupplier.ContactPerson))
                                    {
                                        text = text.Replace("[Supplier_Name]", "Supplier");
                                    }
                                    else
                                    {
                                        text = text.Replace("[Supplier_Name]", warehousePurchaseOrder.ArticleSupplier.ContactPerson);
                                    }
                                    text = text.Replace("[PO_Code]", warehousePurchaseOrder.Code);

                                    emailbody.Append(text);

                                    warehousePurchaseOrder.EmailBody = emailbody.ToString();
                                }
                                warehousePurchaseOrder.AttachPdf = warehousePurchaseOrder.CreatedIn.Year + @"\" + warehousePurchaseOrder.Code + @"\01 Purchase Order\PO_" + warehousePurchaseOrder.Code + ".pdf";

                                warehousePurchaseOrder.AttachmentBytes = GetPurchaseOrderPdf(purchaseOrdersPath, warehousePurchaseOrder.AttachPdf);
                                warehousePurchaseOrderList.Add(warehousePurchaseOrder);

                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetPendingPOByIdWarehousePurchaseOrder_V2380(idWarehousePurchaseOrder-{0}), ErrorMessage- {1} ", item.IdWarehousePurchaseOrder, ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }

                        }
                    }
                }
            }

            return warehousePurchaseOrderList;
        }

        //[rdixit][GEOS2-4313][17.04.2023]
        public bool UpdateAssigneeAndApproverInPO_V2380(string connectionString, WarehousePurchaseOrder warehousePurchaseOrder)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    if (warehousePurchaseOrder != null && warehousePurchaseOrder.IdWarehousePurchaseOrder > 0)
                    {
                        using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                        {
                            mySqlConnection.Open();

                            MySqlCommand mySqlCommand = new MySqlCommand("SRM_UpdateAssigneeAndApproverInPO", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", warehousePurchaseOrder.IdWarehousePurchaseOrder);
                            mySqlCommand.Parameters.AddWithValue("_IdAssignee", warehousePurchaseOrder.IdAssignee);
                            mySqlCommand.Parameters.AddWithValue("_IdApprover", warehousePurchaseOrder.IdApprover);
                            mySqlCommand.Parameters.AddWithValue("_ModifiedBy", warehousePurchaseOrder.ModifiedBy);
                            mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                            mySqlCommand.ExecuteNonQuery();

                            mySqlConnection.Close();

                            isUpdated = true;
                        }
                        AddCommentsOrLogEntriesByPO(connectionString, warehousePurchaseOrder.WarehousePOLogEntries);
                        isUpdated = true;
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error IsUpdateWarehousePurchaseOrderWithStatus(). IdWarehousePurchaseOrder- {0} ErrorMessage- {1}", warehousePurchaseOrder.IdWarehousePurchaseOrder, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }

        //[rdixit][GEOS2-4313][17.04.2023]
        public bool UpdateWorkflowStatusInPO_V2380(string MainServerConnectionString, uint IdWarehousePurchaseOrder, UInt32 IdWorkflowStatus, int IdUser, List<LogEntriesByWarehousePO> LogEntriesByWarehousePOList, UInt32 IdAssignee, UInt32 IdApprover)
        {
            bool status;
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        MySqlCommand mySqlCommand = new MySqlCommand("SRM_warehousepurchaseorders_UpdateWorkflowStatus", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", IdWarehousePurchaseOrder);
                        mySqlCommand.Parameters.AddWithValue("_IdWorkflowStatus", IdWorkflowStatus);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdUser);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                        status = true;
                    }
                    AddCommentsOrLogEntriesByPO(MainServerConnectionString, LogEntriesByWarehousePOList);
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateWorkflowStatusInPO_V2110(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return status;
        }


        //[Sudhir.Jangra][GEOS2-4401][02/05/2023]
        public List<WarehousePurchaseOrder> GetPendingPurchaseOrdersByWarehouse_V2390(long idWarehouse, string connectionstring, string countryIconFilePath, string connectionStringWorkbench)
        {
            // string connectionString = warehouse.Company.ConnectPlantConstr;
            List<WarehousePurchaseOrder> warehousePurchaseOrders = new List<WarehousePurchaseOrder>();
            List<string> countryISOs = new List<string>();
            List<long> orderid = new List<long>();
            Dictionary<string, List<long>> SupplierEmailId = new Dictionary<string, List<long>>();
            List<string> Suppliername = new List<string>();

            List<WorkflowStatus> LstWorkflowStatus = GetAllWorkflowStatus_V2301(connectionStringWorkbench);
            List<WorkflowTransition> LstWorkflowStatusTransitions = GetAllWorkflowTransitions_V2301(connectionStringWorkbench);
            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionstring))
            {
                mySqlConnection.Open();
                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetPendingPurchaseOrdersByWarehouse_V2390", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdWarehouse", idWarehouse);
                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    double totalQuantity = 0;
                    double receivedQuantity = 0;
                    while (mySqlDataReader.Read())
                    {
                        try
                        {
                            totalQuantity = 0;
                            receivedQuantity = 0;
                            WarehousePurchaseOrder warehousePurchaseOrder = new WarehousePurchaseOrder();
                            try
                            {
                                warehousePurchaseOrder.IdWarehousePurchaseOrder = Convert.ToInt64(mySqlDataReader["idWarehousepurchaseorder"]);
                                if (mySqlDataReader["Code"] != DBNull.Value)
                                    warehousePurchaseOrder.Code = Convert.ToString(mySqlDataReader["Code"]);
                                if (mySqlDataReader["IdArticleSupplier"] != DBNull.Value)
                                {
                                    ArticleSupplier articleSupplier = new ArticleSupplier();
                                    articleSupplier.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);
                                    if (mySqlDataReader["Supplier"] != DBNull.Value)
                                        articleSupplier.Name = Convert.ToString(mySqlDataReader["Supplier"]);
                                    if (mySqlDataReader["IdCountry"] != DBNull.Value)
                                    {
                                        articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["IdCountry"]);
                                        articleSupplier.Country = new Country();
                                        articleSupplier.Country.IdCountry = Convert.ToByte(mySqlDataReader["IdCountry"]);
                                        articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);
                                        if (mySqlDataReader["CountryISO"] != DBNull.Value)
                                        {
                                            articleSupplier.Country.Iso = Convert.ToString(mySqlDataReader["CountryISO"]);
                                            if (!countryISOs.Any(co => co.ToString() == articleSupplier.Country.Iso))
                                            {
                                                countryISOs.Add(articleSupplier.Country.Iso);
                                            }
                                        }
                                    }
                                    if (mySqlDataReader["SupplierContactPerson"] != DBNull.Value)
                                        articleSupplier.ContactPerson = Convert.ToString(mySqlDataReader["SupplierContactPerson"]);
                                    if (mySqlDataReader["SupplierContactEmail"] != DBNull.Value)
                                        articleSupplier.ContactEmail = Convert.ToString(mySqlDataReader["SupplierContactEmail"]);
                                    warehousePurchaseOrder.ArticleSupplier = articleSupplier;
                                }
                                if (mySqlDataReader["DeliveryDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["deliveryDate"]) != DateTime.MinValue)
                                {
                                    warehousePurchaseOrder.DeliveryDate = Convert.ToDateTime(mySqlDataReader["deliveryDate"]);
                                    warehousePurchaseOrder.Delay = (int)(warehousePurchaseOrder.DeliveryDate.Value.Date - DateTime.Now.Date).TotalDays;
                                }
                                if (mySqlDataReader["AttachedPO"] != DBNull.Value)
                                    warehousePurchaseOrder.AttachedPO = Convert.ToByte(mySqlDataReader["AttachedPO"]);
                                if (mySqlDataReader["Deliveries"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.Deliveries = Convert.ToInt32(mySqlDataReader["Deliveries"]);
                                    if (warehousePurchaseOrder.Deliveries > 0)
                                    {
                                        warehousePurchaseOrder.IsPartialPending = true;
                                    }
                                }
                                if (mySqlDataReader["LatestDeliveryDate"] != DBNull.Value)
                                    warehousePurchaseOrder.LatestDeliveryDate = Convert.ToDateTime(mySqlDataReader["LatestDeliveryDate"]);
                                if (mySqlDataReader["IdWarehouse"] != DBNull.Value)
                                    warehousePurchaseOrder.IdWarehouse = Convert.ToInt64(mySqlDataReader["IdWarehouse"]);
                                if (mySqlDataReader["OrderQty"] != DBNull.Value)
                                    totalQuantity = Convert.ToDouble(mySqlDataReader["OrderQty"]);
                                if (mySqlDataReader["ReceivedQuantity"] != DBNull.Value)
                                    receivedQuantity = Convert.ToDouble(mySqlDataReader["ReceivedQuantity"]);
                                if (totalQuantity > 0)
                                    warehousePurchaseOrder.Status = (Int16)((receivedQuantity / totalQuantity) * 100);
                                if (mySqlDataReader["TotalAmount"] != DBNull.Value)
                                    warehousePurchaseOrder.TotalAmount = Convert.ToDecimal(mySqlDataReader["TotalAmount"]);
                                if (mySqlDataReader["CreatedIn"] != DBNull.Value)
                                    warehousePurchaseOrder.CreatedIn = Convert.ToDateTime(mySqlDataReader["CreatedIn"]);
                                if (mySqlDataReader["AttachPdf"] != DBNull.Value)
                                    warehousePurchaseOrder.AttachPdf = Convert.ToString(mySqlDataReader["AttachPdf"]);
                                if (mySqlDataReader["idCurrency"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.IdCurrency = Convert.ToByte(mySqlDataReader["idCurrency"]);
                                    warehousePurchaseOrder.Currency = new Currency();
                                    warehousePurchaseOrder.Currency.IdCurrency = Convert.ToByte(mySqlDataReader["idCurrency"]);
                                    warehousePurchaseOrder.Currency.Name = Convert.ToString(mySqlDataReader["CurrencyName"]);
                                    warehousePurchaseOrder.Currency.Symbol = Convert.ToString(mySqlDataReader["CurrencySymbol"]);
                                }
                                if (mySqlDataReader["IdWorkflowStatus"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                    warehousePurchaseOrder.WorkflowStatus = new WorkflowStatus();
                                    warehousePurchaseOrder.WorkflowStatus.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                    warehousePurchaseOrder.WorkflowStatus.Name = Convert.ToString(mySqlDataReader["Status"]);
                                    warehousePurchaseOrder.WorkflowStatus.HtmlColor = Convert.ToString(mySqlDataReader["HtmlColor"]);
                                }
                                if (mySqlDataReader["AssigneeEmail"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.AssigneeEmail = Convert.ToString(mySqlDataReader["AssigneeEmail"]);
                                }
                                if (mySqlDataReader["CreatorEmail"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.CreatorEmail = Convert.ToString(mySqlDataReader["CreatorEmail"]);
                                }
                                if (mySqlDataReader["ReminderEmailDate"] != DBNull.Value)
                                    warehousePurchaseOrder.ReminderEmailDate = Convert.ToDateTime(mySqlDataReader["ReminderEmailDate"]);
                                if (!string.IsNullOrEmpty(warehousePurchaseOrder.ArticleSupplier.ContactEmail))
                                {
                                    if (warehousePurchaseOrder.ReminderEmailDate == DateTime.MinValue || warehousePurchaseOrder.ReminderEmailDate == null)
                                    {
                                        warehousePurchaseOrder.ReminderEmailDate = warehousePurchaseOrder.DeliveryDate.Value.AddDays(1);
                                    }
                                    DateTime dtRm = new DateTime(warehousePurchaseOrder.ReminderEmailDate.Value.Year, warehousePurchaseOrder.ReminderEmailDate.Value.Month, warehousePurchaseOrder.ReminderEmailDate.Value.Day);
                                    DateTime dtNow = new DateTime(DateTime.Now.Year, DateTime.Now.Month, DateTime.Now.Day);
                                    if (dtRm <= dtNow)
                                    {
                                        orderid = new List<long>();
                                        orderid.Add(warehousePurchaseOrder.IdWarehousePurchaseOrder);
                                        if (!SupplierEmailId.ContainsKey(warehousePurchaseOrder.ArticleSupplier.ContactEmail))
                                        {
                                            SupplierEmailId.Add(warehousePurchaseOrder.ArticleSupplier.ContactEmail, orderid);
                                        }
                                        else
                                        {
                                            SupplierEmailId[warehousePurchaseOrder.ArticleSupplier.ContactEmail].Add(warehousePurchaseOrder.IdWarehousePurchaseOrder);
                                        }
                                    }
                                }
                                else
                                {
                                    if (!Suppliername.Contains(warehousePurchaseOrder.ArticleSupplier.Name))
                                    {
                                        Suppliername.Add(warehousePurchaseOrder.ArticleSupplier.Name);
                                    }
                                }



                                warehousePurchaseOrder.LstWorkflowStatus = LstWorkflowStatus;
                                List<byte> GetCurrentButtons = LstWorkflowStatusTransitions.Where(a => a.IdWorkflowStatusFrom == warehousePurchaseOrder.IdWorkflowStatus).Select(a => a.IdWorkflowStatusTo).Distinct().ToList();
                                warehousePurchaseOrder.LstWorkflowStatusTransition = new List<WorkflowStatus>();
                                warehousePurchaseOrder.LstWorkflowStatusTransition.Add(warehousePurchaseOrder.LstWorkflowStatus.FirstOrDefault(a => a.IdWorkflowStatus == warehousePurchaseOrder.IdWorkflowStatus));
                                foreach (byte statusbutton in GetCurrentButtons)
                                {
                                    warehousePurchaseOrder.LstWorkflowStatusTransition.Add(warehousePurchaseOrder.LstWorkflowStatus.FirstOrDefault(a => a.IdWorkflowStatus == statusbutton));
                                }
                            }
                            catch (Exception ex)
                            {
                            }
                            warehousePurchaseOrder.LstAllWorkflowStatusTransitions = LstWorkflowStatusTransitions;
                            warehousePurchaseOrders.Add(warehousePurchaseOrder);

                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetPendingPurchaseOrdersByWarehouse_V2310(). ErrorMessage-" + ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }
            foreach (string item in countryISOs)
            {
                byte[] bytes = null;
                bytes = GetCountryIconFileInBytes(item, countryIconFilePath);
                warehousePurchaseOrders.Where(wp => wp.ArticleSupplier.Country.Iso == item).ToList().ForEach(wp => wp.ArticleSupplier.Country.CountryIconBytes = bytes);
            }
            if (warehousePurchaseOrders.Count > 0)
            {
                warehousePurchaseOrders.FirstOrDefault().SupplierEmailId = SupplierEmailId;
                warehousePurchaseOrders.FirstOrDefault().Suppliername = Suppliername;
            }
            return warehousePurchaseOrders;
        }

        //[Sudhir.Jangra][GEOS2-4402][03/05/2023]
        public List<Article> GetPendingArticles_V2390(long idWarehouse, string connectionString)
        {
            List<Article> articles = new List<Article>();
            // string connectionString = warehouse.Company.ConnectPlantConstr;
            using (MySqlConnection connArticles = new MySqlConnection(connectionString))
            {
                connArticles.Open();
                MySqlCommand articleCommand = new MySqlCommand("SRM_GetPendingArticles", connArticles);
                articleCommand.CommandType = CommandType.StoredProcedure;
                articleCommand.Parameters.AddWithValue("_IdWarehouse", idWarehouse);
                using (MySqlDataReader articleReader = articleCommand.ExecuteReader())
                {
                    while (articleReader.Read())
                    {
                        try
                        {
                            Article article = new Article();
                            if (articleReader["IdArticle"] != DBNull.Value)
                                article.IdArticle = Convert.ToInt32(articleReader["IdArticle"]);
                            if (articleReader["Reference"] != DBNull.Value)
                                article.Reference = Convert.ToString(articleReader["Reference"]);
                            if (articleReader["Description"] != DBNull.Value)
                                article.Description = Convert.ToString(articleReader["Description"]);
                            WarehousePurchaseOrder warehousePO = new WarehousePurchaseOrder();
                            warehousePO.IdWarehousePurchaseOrder = Convert.ToInt64(articleReader["IdWarehousePurchaseOrder"]);
                            if (articleReader["PurchaseOrderCode"] != DBNull.Value)
                                warehousePO.Code = Convert.ToString(articleReader["PurchaseOrderCode"]);
                            if (articleReader["WO_DeliveryDate"] != DBNull.Value)
                            {
                                warehousePO.DeliveryDate = Convert.ToDateTime(articleReader["WO_DeliveryDate"]);
                                warehousePO.Delay = (int)(warehousePO.DeliveryDate.Value.Date - DateTime.Now.Date).TotalDays;
                            }
                            if (articleReader["WO_Supplier"] != DBNull.Value)
                            {
                                warehousePO.ArticleSupplier = new ArticleSupplier();
                                warehousePO.ArticleSupplier.Name = Convert.ToString(articleReader["WO_Supplier"]);
                            }
                            if (articleReader["PurchasedQty"] != DBNull.Value)
                            {
                                article.PurchasedQty = Convert.ToInt64(articleReader["PurchasedQty"]);
                            }
                            if (articleReader["DeliveredQty"] != DBNull.Value)
                            {
                                article.DeliveredQty = Convert.ToInt64(articleReader["DeliveredQty"]);
                            }
                            if (articleReader["RemainingQty"] != DBNull.Value)
                                article.Quantity = Convert.ToDouble(articleReader["RemainingQty"]);
                            if (articleReader["IdWarehouse"] != DBNull.Value)
                                warehousePO.IdWarehouse = Convert.ToInt64(articleReader["IdWarehouse"]);
                            if (articleReader["IdWorkflowStatus"] != DBNull.Value)
                            {
                                warehousePO.IdWorkflowStatus = Convert.ToByte(articleReader["IdWorkflowStatus"]);
                                warehousePO.WorkflowStatus = new WorkflowStatus();
                                warehousePO.WorkflowStatus.IdWorkflowStatus = Convert.ToByte(articleReader["IdWorkflowStatus"]);
                                warehousePO.WorkflowStatus.Name = Convert.ToString(articleReader["Status"]);
                                warehousePO.WorkflowStatus.HtmlColor = Convert.ToString(articleReader["HtmlColor"]);
                            }
                            article.WarehousePurchaseOrder = warehousePO;
                            articles.Add(article);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error SRM_GetPendingArticles_V2390(). ErrorMessage-" + ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }
            //  Log4NetLogger.Logger.Log("Executed SRM_GetPendingArticles_V2390().", category: Category.Info, priority: Priority.Low);
            return articles;
        }

        //[Sudhir.Jangra][GEOS2-4403][03/05/2023]
        public List<ArticleSupplier> GetArticleSuppliersByWarehouse_V2390(long idWarehouse, string connectionString, string countryIconFilePath)
        {
            //string connectionString = warehouse.Company.ConnectPlantConstr;
            List<ArticleSupplier> articleSuppliers = new List<ArticleSupplier>();
            List<string> countryISOs = new List<string>();
            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetArticleSuppliersByWarehouse_V2340", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdWarehouse", idWarehouse);

                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    while (mySqlDataReader.Read())
                    {
                        try
                        {
                            ArticleSupplier articleSupplier = new ArticleSupplier();

                            articleSupplier.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                            if (mySqlDataReader["name"] != DBNull.Value)
                                articleSupplier.Name = Convert.ToString(mySqlDataReader["name"]);

                            if (mySqlDataReader["IdCountry"] != DBNull.Value)
                            {
                                articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["IdCountry"]);

                                articleSupplier.Country = new Country();
                                articleSupplier.Country.IdCountry = Convert.ToByte(mySqlDataReader["IdCountry"]);
                                articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);
                                articleSupplier.Country.Iso = Convert.ToString(mySqlDataReader["Iso"]);

                                if (!countryISOs.Any(co => co.ToString() == articleSupplier.Country.Iso))
                                {
                                    countryISOs.Add(articleSupplier.Country.Iso);
                                }
                            }
                            if (mySqlDataReader["Cif"] != DBNull.Value)
                                articleSupplier.Cif = Convert.ToString(mySqlDataReader["Cif"]);

                            if (mySqlDataReader["City"] != DBNull.Value)
                                articleSupplier.City = Convert.ToString(mySqlDataReader["City"]);

                            if (mySqlDataReader["PostCode"] != DBNull.Value)
                                articleSupplier.PostCode = Convert.ToString(mySqlDataReader["PostCode"]);

                            if (mySqlDataReader["Address"] != DBNull.Value)
                                articleSupplier.Address = Convert.ToString(mySqlDataReader["Address"]);

                            if (mySqlDataReader["Email"] != DBNull.Value)
                                articleSupplier.Email = Convert.ToString(mySqlDataReader["Email"]);

                            if (mySqlDataReader["Web"] != DBNull.Value)
                                articleSupplier.Web = Convert.ToString(mySqlDataReader["Web"]);

                            if (mySqlDataReader["Phone1"] != DBNull.Value)
                                articleSupplier.Phone1 = Convert.ToString(mySqlDataReader["Phone1"]);

                            if (mySqlDataReader["Phone2"] != DBNull.Value)
                                articleSupplier.Phone2 = Convert.ToString(mySqlDataReader["Phone2"]);

                            if (mySqlDataReader["serie"] != DBNull.Value)
                                articleSupplier.Serie = Convert.ToChar(mySqlDataReader["serie"]);

                            if (mySqlDataReader["CreatedIn"] != DBNull.Value)
                                articleSupplier.CreatedIn = Convert.ToDateTime(mySqlDataReader["CreatedIn"].ToString());

                            if (mySqlDataReader["EnterpriseGroup"] != DBNull.Value)
                                articleSupplier.Group = Convert.ToString(mySqlDataReader["EnterpriseGroup"].ToString());

                            if (mySqlDataReader["IsStillActive"] != DBNull.Value)
                            {
                                articleSupplier.IsStillActive = Convert.ToSByte(mySqlDataReader["IsStillActive"]);
                                if (articleSupplier.IsStillActive == 1)
                                {
                                    articleSupplier.IsActive = "Yes";
                                }
                                else
                                {
                                    articleSupplier.IsActive = "No";
                                }
                            }
                            articleSuppliers.Add(articleSupplier);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetArticleSuppliersByWarehouse_V2340(). ErrorMessage-" + ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }
            foreach (string item in countryISOs)
            {
                byte[] bytes = null;
                bytes = GetCountryIconFileInBytes(item, countryIconFilePath);
                articleSuppliers.Where(ars => ars.Country.Iso == item).ToList().ForEach(oi => oi.Country.CountryIconBytes = bytes);
            }
            // Log4NetLogger.Logger.Log("Executed GetArticleSuppliersByWarehouse_V2340().", category: Category.Info, priority: Priority.Low);
            return articleSuppliers;
        }


        //[Sudhir.Jangra][GEOS2-4407][04/05/2023]
        public List<GeosAppSetting> GetSystemSettings_V2390(string connectionString)
        {
            List<GeosAppSetting> SystemSetting = new List<GeosAppSetting>();
            List<SystemSettings> System = new List<SystemSettings>();
            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetAllSystemSettings_V2390", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;

                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    while (mySqlDataReader.Read())
                    {
                        try
                        {
                            GeosAppSetting systemSettings = new GeosAppSetting();

                            if (mySqlDataReader["IdAppSetting"] != DBNull.Value)
                            {
                                systemSettings.IdAppSetting = Convert.ToInt16(mySqlDataReader["IdAppSetting"]);
                            }
                            if (mySqlDataReader["AppSettingName"] != DBNull.Value)
                            {
                                systemSettings.AppSettingName = Convert.ToString(mySqlDataReader["AppSettingName"]);
                            }
                            if (mySqlDataReader["IsUserModify"] != DBNull.Value)
                            {
                                systemSettings.IsUserModify = Convert.ToByte(mySqlDataReader["IsUserModify"]);
                            }
                            if (mySqlDataReader["DefaultValue"] != DBNull.Value)
                            {
                                systemSettings.DefaultValue = Convert.ToString(mySqlDataReader["DefaultValue"]);


                                string input = systemSettings.DefaultValue;

                                string[] parts = input.Split(new string[] { "),(" }, StringSplitOptions.None);

                                systemSettings.SystemSettings = new ObservableCollection<SystemSettings>();

                                foreach (string part in parts)
                                {
                                    SystemSettings system = new SystemSettings();
                                    string warehouseString;
                                    string emailString = "";
                                    string[] data = part.Split(';');
                                    string warehouse = data[0];

                                    if (warehouse.StartsWith("("))
                                    {
                                        warehouseString = warehouse.Substring(1);
                                    }
                                    else
                                    {
                                        warehouseString = warehouse;
                                    }


                                    List<string> emailList = new List<string>();
                                    for (int i = 0; i < data.Length; i++)
                                    {
                                        if (i != 0)
                                        {
                                            string emails = data[i];

                                            if (emails.EndsWith(")"))
                                            {
                                                emailString = emails.Substring(0, emails.Length - 1);
                                            }
                                            else
                                            {
                                                emailString = emails;
                                            }
                                            emailList.Add(emailString);
                                        }
                                    }
                                    string ema = string.Join(",", emailList);


                                    system.Warehouse = warehouseString;
                                    system.CC = ema;
                                    systemSettings.SystemSettings.Add(system);
                                }
                            }
                            SystemSetting.Add(systemSettings);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error SRM_GetAllSystemSettings_V2390(). ErrorMessage-" + ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }
            return SystemSetting;
        }

        //[Sudhir.Jangra][GEOS2-4407][09/05/2023]
        public bool UpdateSystemSettings_V2390(string defaultValue, string SRMConnectionString)
        {
            bool isupdated = false;
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(SRMConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("SRM_UpdateSystemSettings_V2390", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_DefaultValue", defaultValue);

                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }

                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateSystemSettings_V2390(). IdWorkOperation - {0} ErrorMessage- {1}", defaultValue, ex.Message), category: Category.Exception, priority: Priority.Low);

                    throw;
                }
            }
            return isupdated;
        }

        //[Sudhir.Jangra][GEOS2-4407][19/05/2023]

        public WarehousePurchaseOrder GetPendingPOByIdWarehousePurchaseOrder_V2390(string connectionString, Int64 idWarehousePurchaseOrder, string purchaseOrdersPath, string emailTemplatePath, string countryIconFilePath)
        {
            WarehousePurchaseOrder warehousePurchaseOrder = null;

            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetPendingPOByIdWarehousePurchaseOrder_V2390", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", idWarehousePurchaseOrder);

                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    if (mySqlDataReader.Read())
                    {
                        try
                        {
                            warehousePurchaseOrder = new WarehousePurchaseOrder();

                            warehousePurchaseOrder.IdWarehousePurchaseOrder = idWarehousePurchaseOrder;

                            if (mySqlDataReader["Code"] != DBNull.Value)
                                warehousePurchaseOrder.Code = Convert.ToString(mySqlDataReader["Code"]);

                            if (mySqlDataReader["IdArticleSupplier"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                                ArticleSupplier articleSupplier = new ArticleSupplier();
                                articleSupplier.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                                if (mySqlDataReader["Supplier"] != DBNull.Value)
                                    articleSupplier.Name = Convert.ToString(mySqlDataReader["Supplier"]);

                                if (mySqlDataReader["SupplierContactPerson"] != DBNull.Value)
                                    articleSupplier.ContactPerson = Convert.ToString(mySqlDataReader["SupplierContactPerson"]);

                                if (mySqlDataReader["SupplierContactEmail"] != DBNull.Value)
                                    articleSupplier.ContactEmail = Convert.ToString(mySqlDataReader["SupplierContactEmail"]);

                                if (mySqlDataReader["Serie"] != DBNull.Value)
                                    articleSupplier.Serie = Convert.ToChar(mySqlDataReader["Serie"]);

                                if (mySqlDataReader["IdCountry"] != DBNull.Value)
                                {
                                    articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["IdCountry"]);

                                    articleSupplier.Country = new Country();
                                    articleSupplier.Country.IdCountry = (byte)articleSupplier.IdCountry;
                                    articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);

                                    if (mySqlDataReader["SupplierCountryISO"] != DBNull.Value)
                                    {
                                        articleSupplier.Country.Iso = Convert.ToString(mySqlDataReader["SupplierCountryISO"]);
                                        byte[] bytes = null;
                                        bytes = GetCountryIconFileInBytes(articleSupplier.Country.Iso, countryIconFilePath);
                                        articleSupplier.Country.CountryIconBytes = bytes;
                                    }

                                    if (mySqlDataReader["IdCountryGroup"] != DBNull.Value)
                                        articleSupplier.Country.IdCountryGroup = Convert.ToInt64(mySqlDataReader["IdCountryGroup"]);
                                }

                                if (mySqlDataReader["IdArticleSupplierType"] != DBNull.Value)
                                {
                                    articleSupplier.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["IdArticleSupplierType"]);

                                    articleSupplier.ArticleSupplierType = new ArticleSupplierType();
                                    articleSupplier.ArticleSupplierType.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["IdArticleSupplierType"]);
                                    articleSupplier.ArticleSupplierType.Name = Convert.ToString(mySqlDataReader["ArticleSupplierType"]);
                                    articleSupplier.ArticleSupplierType.HtmlColor = Convert.ToString(mySqlDataReader["HtmlColor"]);
                                }

                                warehousePurchaseOrder.ArticleSupplier = articleSupplier;
                            }

                            if (mySqlDataReader["DeliveryDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["deliveryDate"]) != DateTime.MinValue)
                            {
                                warehousePurchaseOrder.DeliveryDate = Convert.ToDateTime(mySqlDataReader["deliveryDate"]);
                            }

                            if (mySqlDataReader["AttachedPO"] != DBNull.Value)
                                warehousePurchaseOrder.AttachedPO = Convert.ToByte(mySqlDataReader["AttachedPO"]);

                            if (mySqlDataReader["IdPaymentType"] != DBNull.Value)
                                warehousePurchaseOrder.IdPaymentType = Convert.ToInt64(mySqlDataReader["IdPaymentType"]);

                            if (mySqlDataReader["ReminderEmailDate"] != DBNull.Value)
                                warehousePurchaseOrder.ReminderEmailDate = Convert.ToDateTime(mySqlDataReader["ReminderEmailDate"]);

                            if (mySqlDataReader["CreatedIn"] != DBNull.Value)
                                warehousePurchaseOrder.CreatedIn = Convert.ToDateTime(mySqlDataReader["CreatedIn"]);

                            if (mySqlDataReader["ModifiedIn"] != DBNull.Value)
                                warehousePurchaseOrder.ModifiedIn = Convert.ToDateTime(mySqlDataReader["ModifiedIn"]);

                            if (mySqlDataReader["Comments"] != DBNull.Value)
                                warehousePurchaseOrder.Comments = Convert.ToString(mySqlDataReader["Comments"]);

                            if (mySqlDataReader["IsClosed"] != DBNull.Value)
                                warehousePurchaseOrder.IsClosed = Convert.ToByte(mySqlDataReader["IsClosed"]);

                            if (mySqlDataReader["CreatedBy"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.CreatedBy = Convert.ToInt64(mySqlDataReader["CreatedBy"]);
                                warehousePurchaseOrder.Creator = new People();
                                warehousePurchaseOrder.Creator.IdPerson = Convert.ToInt32(mySqlDataReader["CreatedBy"].ToString());
                                warehousePurchaseOrder.Creator.Name = mySqlDataReader["CreatorName"].ToString();
                                warehousePurchaseOrder.Creator.Surname = mySqlDataReader["CreatorSurname"].ToString();
                            }

                            if (mySqlDataReader["ModifiedBy"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.ModifiedBy = Convert.ToInt64(mySqlDataReader["ModifiedBy"]);
                                warehousePurchaseOrder.Modifier = new People();
                                warehousePurchaseOrder.Modifier.IdPerson = Convert.ToInt32(mySqlDataReader["ModifiedBy"].ToString());
                                warehousePurchaseOrder.Modifier.Name = mySqlDataReader["ModifierName"].ToString();
                                warehousePurchaseOrder.Modifier.Surname = mySqlDataReader["ModifierSurname"].ToString();
                            }

                            if (mySqlDataReader["ReasonClosed"] != DBNull.Value)
                                warehousePurchaseOrder.ReasonClosed = Convert.ToString(mySqlDataReader["ReasonClosed"]);

                            if (mySqlDataReader["IdWarehouse"] != DBNull.Value)
                                warehousePurchaseOrder.IdWarehouse = Convert.ToInt64(mySqlDataReader["IdWarehouse"]);

                            if (mySqlDataReader["IdCurrency"] != DBNull.Value)
                                warehousePurchaseOrder.IdCurrency = Convert.ToByte(mySqlDataReader["IdCurrency"]);

                            if (mySqlDataReader["IdWorkflowStatus"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                warehousePurchaseOrder.WorkflowStatus = new WorkflowStatus();
                                warehousePurchaseOrder.WorkflowStatus.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                warehousePurchaseOrder.WorkflowStatus.Name = Convert.ToString(mySqlDataReader["Status"]);
                                warehousePurchaseOrder.WorkflowStatus.HtmlColor = Convert.ToString(mySqlDataReader["StatusHtmlColor"]);
                            }

                            if (mySqlDataReader["IdAssignee"] != DBNull.Value)
                                warehousePurchaseOrder.IdAssignee = Convert.ToUInt32(mySqlDataReader["IdAssignee"]);

                            if (mySqlDataReader["IdApprover"] != DBNull.Value)
                                warehousePurchaseOrder.IdApprover = Convert.ToUInt32(mySqlDataReader["IdApprover"]);

                            if (mySqlDataReader["AssigneeEmail"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.AssigneeEmail = Convert.ToString(mySqlDataReader["AssigneeEmail"]);
                            }
                            if (mySqlDataReader["CreatorEmail"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.CreatorEmail = Convert.ToString(mySqlDataReader["CreatorEmail"]);
                            }

                            string HTMLFileName = null;
                            if (File.Exists(string.Format("{0}{1}SupplierPurchaseOrderRequestMailFormat_{2}-{3}.html", emailTemplatePath, @"\", warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower(), warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToUpper())))
                            {
                                HTMLFileName = string.Format("SupplierPurchaseOrderRequestMailFormat_{0}-{1}.html", warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower(), warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToUpper());
                            }
                            else if (File.Exists(string.Format("{0}{1}SupplierPurchaseOrderRequestMailFormat.html", emailTemplatePath, @"\")))
                            {
                                HTMLFileName = "SupplierPurchaseOrderRequestMailFormat.html";
                            }
                            if (HTMLFileName != null)
                            {
                                StringBuilder emailbody = new StringBuilder();
                                string text = ReadMailTemplate(HTMLFileName, emailTemplatePath);

                                if (string.IsNullOrEmpty(warehousePurchaseOrder.ArticleSupplier.ContactPerson))
                                {
                                    text = text.Replace("[Supplier_Name]", "Supplier");
                                }
                                else
                                {
                                    text = text.Replace("[Supplier_Name]", warehousePurchaseOrder.ArticleSupplier.ContactPerson);
                                }
                                text = text.Replace("[PO_Code]", warehousePurchaseOrder.Code);

                                emailbody.Append(text);

                                warehousePurchaseOrder.EmailBody = emailbody.ToString();
                            }
                            warehousePurchaseOrder.AttachPdf = warehousePurchaseOrder.CreatedIn.Year + @"\" + warehousePurchaseOrder.Code + @"\01 Purchase Order\PO_" + warehousePurchaseOrder.Code + ".pdf";

                            warehousePurchaseOrder.AttachmentBytes = GetPurchaseOrderPdf(purchaseOrdersPath, warehousePurchaseOrder.AttachPdf);
                            warehousePurchaseOrder.WarehouseDeliveryNotes = GetDeliveryNotesByIdWarehousePurchaseOrder(connectionString, warehousePurchaseOrder, purchaseOrdersPath);

                            warehousePurchaseOrder.WarehousePurchaseOrderItemWithComments = GetArticlesByIdWarehousePurchaseOrder_V2300(connectionString, warehousePurchaseOrder.IdWarehousePurchaseOrder);

                            warehousePurchaseOrder.WarehousePOComments = GetlogEntriesByWarehousePO(idWarehousePurchaseOrder, 252, connectionString);
                            warehousePurchaseOrder.WarehousePOLogEntries = GetlogEntriesByWarehousePO(idWarehousePurchaseOrder, 253, connectionString);

                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetPendingPOByIdWarehousePurchaseOrder_V2380(idWarehousePurchaseOrder-{0}), ErrorMessage- {1} ", idWarehousePurchaseOrder, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            return warehousePurchaseOrder;
        }

        //[Sudhir.Jangra][GEOS2-4407]
        public List<WarehousePurchaseOrder> SendPOMailForSelectedPO_V2390(string connectionString, List<WarehousePurchaseOrder> ListPurchaseOrder_Checked, string purchaseOrdersPath, string emailTemplatePath)
        {
            List<WarehousePurchaseOrder> warehousePurchaseOrderList = new List<WarehousePurchaseOrder>();
            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();
                foreach (var item in ListPurchaseOrder_Checked)
                {
                    MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetPendingPOByIdWarehousePurchaseOrder_V2390", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", item.IdWarehousePurchaseOrder);

                    using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                    {
                        if (mySqlDataReader.Read())
                        {
                            try
                            {
                                WarehousePurchaseOrder warehousePurchaseOrder = new WarehousePurchaseOrder();

                                warehousePurchaseOrder.IdWarehousePurchaseOrder = item.IdWarehousePurchaseOrder;

                                if (mySqlDataReader["Code"] != DBNull.Value)
                                    warehousePurchaseOrder.Code = Convert.ToString(mySqlDataReader["Code"]);

                                if (mySqlDataReader["IdArticleSupplier"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                                    ArticleSupplier articleSupplier = new ArticleSupplier();
                                    articleSupplier.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                                    if (mySqlDataReader["Supplier"] != DBNull.Value)
                                        articleSupplier.Name = Convert.ToString(mySqlDataReader["Supplier"]);

                                    if (mySqlDataReader["SupplierContactPerson"] != DBNull.Value)
                                        articleSupplier.ContactPerson = Convert.ToString(mySqlDataReader["SupplierContactPerson"]);

                                    if (mySqlDataReader["SupplierContactEmail"] != DBNull.Value)
                                        articleSupplier.ContactEmail = Convert.ToString(mySqlDataReader["SupplierContactEmail"]);

                                    if (mySqlDataReader["Serie"] != DBNull.Value)
                                        articleSupplier.Serie = Convert.ToChar(mySqlDataReader["Serie"]);

                                    if (mySqlDataReader["IdCountry"] != DBNull.Value)
                                    {
                                        articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["IdCountry"]);

                                        articleSupplier.Country = new Country();
                                        articleSupplier.Country.IdCountry = (byte)articleSupplier.IdCountry;
                                        articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);

                                        if (mySqlDataReader["IdCountryGroup"] != DBNull.Value)
                                            articleSupplier.Country.IdCountryGroup = Convert.ToInt64(mySqlDataReader["IdCountryGroup"]);

                                        if (mySqlDataReader["SupplierCountryISO"] != DBNull.Value)
                                            articleSupplier.Country.Iso = Convert.ToString(mySqlDataReader["SupplierCountryISO"]);

                                    }

                                    if (mySqlDataReader["IdArticleSupplierType"] != DBNull.Value)
                                    {
                                        articleSupplier.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["IdArticleSupplierType"]);

                                        articleSupplier.ArticleSupplierType = new ArticleSupplierType();
                                        articleSupplier.ArticleSupplierType.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["IdArticleSupplierType"]);
                                        articleSupplier.ArticleSupplierType.Name = Convert.ToString(mySqlDataReader["ArticleSupplierType"]);
                                        articleSupplier.ArticleSupplierType.HtmlColor = Convert.ToString(mySqlDataReader["HtmlColor"]);
                                    }

                                    warehousePurchaseOrder.ArticleSupplier = articleSupplier;
                                }

                                if (mySqlDataReader["DeliveryDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["deliveryDate"]) != DateTime.MinValue)
                                {
                                    warehousePurchaseOrder.DeliveryDate = Convert.ToDateTime(mySqlDataReader["deliveryDate"]);
                                }

                                if (mySqlDataReader["AttachedPO"] != DBNull.Value)
                                    warehousePurchaseOrder.AttachedPO = Convert.ToByte(mySqlDataReader["AttachedPO"]);

                                if (mySqlDataReader["IdPaymentType"] != DBNull.Value)
                                    warehousePurchaseOrder.IdPaymentType = Convert.ToInt64(mySqlDataReader["IdPaymentType"]);

                                if (mySqlDataReader["ReminderEmailDate"] != DBNull.Value)
                                    warehousePurchaseOrder.ReminderEmailDate = Convert.ToDateTime(mySqlDataReader["ReminderEmailDate"]);

                                if (mySqlDataReader["CreatedIn"] != DBNull.Value)
                                    warehousePurchaseOrder.CreatedIn = Convert.ToDateTime(mySqlDataReader["CreatedIn"]);

                                if (mySqlDataReader["ModifiedIn"] != DBNull.Value)
                                    warehousePurchaseOrder.ModifiedIn = Convert.ToDateTime(mySqlDataReader["ModifiedIn"]);

                                if (mySqlDataReader["Comments"] != DBNull.Value)
                                    warehousePurchaseOrder.Comments = Convert.ToString(mySqlDataReader["Comments"]);

                                if (mySqlDataReader["IsClosed"] != DBNull.Value)
                                    warehousePurchaseOrder.IsClosed = Convert.ToByte(mySqlDataReader["IsClosed"]);

                                if (mySqlDataReader["CreatedBy"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.CreatedBy = Convert.ToInt64(mySqlDataReader["CreatedBy"]);
                                    warehousePurchaseOrder.Creator = new People();
                                    warehousePurchaseOrder.Creator.IdPerson = Convert.ToInt32(mySqlDataReader["CreatedBy"].ToString());
                                    warehousePurchaseOrder.Creator.Name = mySqlDataReader["CreatorName"].ToString();
                                    warehousePurchaseOrder.Creator.Surname = mySqlDataReader["CreatorSurname"].ToString();
                                }

                                if (mySqlDataReader["ModifiedBy"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.ModifiedBy = Convert.ToInt64(mySqlDataReader["ModifiedBy"]);
                                    warehousePurchaseOrder.Modifier = new People();
                                    warehousePurchaseOrder.Modifier.IdPerson = Convert.ToInt32(mySqlDataReader["ModifiedBy"].ToString());
                                    warehousePurchaseOrder.Modifier.Name = mySqlDataReader["ModifierName"].ToString();
                                    warehousePurchaseOrder.Modifier.Surname = mySqlDataReader["ModifierSurname"].ToString();
                                }

                                if (mySqlDataReader["ReasonClosed"] != DBNull.Value)
                                    warehousePurchaseOrder.ReasonClosed = Convert.ToString(mySqlDataReader["ReasonClosed"]);

                                if (mySqlDataReader["IdWarehouse"] != DBNull.Value)
                                    warehousePurchaseOrder.IdWarehouse = Convert.ToInt64(mySqlDataReader["IdWarehouse"]);

                                if (mySqlDataReader["IdCurrency"] != DBNull.Value)
                                    warehousePurchaseOrder.IdCurrency = Convert.ToByte(mySqlDataReader["IdCurrency"]);

                                if (mySqlDataReader["IdWorkflowStatus"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                    warehousePurchaseOrder.WorkflowStatus = new WorkflowStatus();
                                    warehousePurchaseOrder.WorkflowStatus.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                    warehousePurchaseOrder.WorkflowStatus.Name = Convert.ToString(mySqlDataReader["Status"]);
                                    warehousePurchaseOrder.WorkflowStatus.HtmlColor = Convert.ToString(mySqlDataReader["StatusHtmlColor"]);
                                }

                                if (mySqlDataReader["IdAssignee"] != DBNull.Value)
                                    warehousePurchaseOrder.IdAssignee = Convert.ToUInt32(mySqlDataReader["IdAssignee"]);

                                if (mySqlDataReader["IdApprover"] != DBNull.Value)
                                    warehousePurchaseOrder.IdApprover = Convert.ToUInt32(mySqlDataReader["IdApprover"]);

                                if (mySqlDataReader["AssigneeEmail"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.AssigneeEmail = Convert.ToString(mySqlDataReader["AssigneeEmail"]);
                                }
                                if (mySqlDataReader["CreatorEmail"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.CreatorEmail = Convert.ToString(mySqlDataReader["CreatorEmail"]);
                                }
                                string HTMLFileName = null;
                                if (File.Exists(string.Format("{0}{1}SupplierPurchaseOrderRequestMailFormat_{2}-{3}.html", emailTemplatePath, @"\", warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower(), warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToUpper())))
                                {
                                    HTMLFileName = string.Format("SupplierPurchaseOrderRequestMailFormat_{0}-{1}.html", warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower(), warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToUpper());
                                }
                                else if (File.Exists(string.Format("{0}{1}SupplierPurchaseOrderRequestMailFormat.html", emailTemplatePath, @"\")))
                                {
                                    HTMLFileName = "SupplierPurchaseOrderRequestMailFormat.html";
                                }
                                if (HTMLFileName != null)
                                {
                                    StringBuilder emailbody = new StringBuilder();
                                    string text = ReadMailTemplate(HTMLFileName, emailTemplatePath);

                                    if (string.IsNullOrEmpty(warehousePurchaseOrder.ArticleSupplier.ContactPerson))
                                    {
                                        text = text.Replace("[Supplier_Name]", "Supplier");
                                    }
                                    else
                                    {
                                        text = text.Replace("[Supplier_Name]", warehousePurchaseOrder.ArticleSupplier.ContactPerson);
                                    }
                                    text = text.Replace("[PO_Code]", warehousePurchaseOrder.Code);

                                    emailbody.Append(text);

                                    warehousePurchaseOrder.EmailBody = emailbody.ToString();
                                }
                                warehousePurchaseOrder.AttachPdf = warehousePurchaseOrder.CreatedIn.Year + @"\" + warehousePurchaseOrder.Code + @"\01 Purchase Order\PO_" + warehousePurchaseOrder.Code + ".pdf";

                                warehousePurchaseOrder.AttachmentBytes = GetPurchaseOrderPdf(purchaseOrdersPath, warehousePurchaseOrder.AttachPdf);
                                warehousePurchaseOrderList.Add(warehousePurchaseOrder);

                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetPendingPOByIdWarehousePurchaseOrder_V2380(idWarehousePurchaseOrder-{0}), ErrorMessage- {1} ", item.IdWarehousePurchaseOrder, ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }

                        }
                    }
                }
            }

            return warehousePurchaseOrderList;
        }


        //[Sudhir.Jangra][GEOS2-4487][31/05/2023]
        public List<WarehousePurchaseOrder> GetPendingPurchaseOrdersByWarehouse_V2400(long idWarehouse, string connectionstring, string countryIconFilePath, string connectionStringWorkbench)
        {
            // string connectionString = warehouse.Company.ConnectPlantConstr;
            List<WarehousePurchaseOrder> warehousePurchaseOrders = new List<WarehousePurchaseOrder>();
            List<string> countryISOs = new List<string>();
            List<long> orderid = new List<long>();
            Dictionary<string, List<long>> SupplierEmailId = new Dictionary<string, List<long>>();
            List<string> Suppliername = new List<string>();

            List<WorkflowStatus> LstWorkflowStatus = GetAllWorkflowStatus_V2301(connectionStringWorkbench);
            List<WorkflowTransition> LstWorkflowStatusTransitions = GetAllWorkflowTransitions_V2301(connectionStringWorkbench);
            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionstring))
            {
                mySqlConnection.Open();
                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetPendingPurchaseOrdersByWarehouse_V2400", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdWarehouse", idWarehouse);
                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    double totalQuantity = 0;
                    double receivedQuantity = 0;
                    while (mySqlDataReader.Read())
                    {
                        try
                        {
                            totalQuantity = 0;
                            receivedQuantity = 0;
                            WarehousePurchaseOrder warehousePurchaseOrder = new WarehousePurchaseOrder();
                            try
                            {
                                warehousePurchaseOrder.IdWarehousePurchaseOrder = Convert.ToInt64(mySqlDataReader["idWarehousepurchaseorder"]);
                                if (mySqlDataReader["Code"] != DBNull.Value)
                                    warehousePurchaseOrder.Code = Convert.ToString(mySqlDataReader["Code"]);
                                if (mySqlDataReader["IdArticleSupplier"] != DBNull.Value)
                                {
                                    ArticleSupplier articleSupplier = new ArticleSupplier();
                                    articleSupplier.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);
                                    if (mySqlDataReader["Supplier"] != DBNull.Value)
                                        articleSupplier.Name = Convert.ToString(mySqlDataReader["Supplier"]);
                                    if (mySqlDataReader["IdCountry"] != DBNull.Value)
                                    {
                                        articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["IdCountry"]);
                                        articleSupplier.Country = new Country();
                                        articleSupplier.Country.IdCountry = Convert.ToByte(mySqlDataReader["IdCountry"]);
                                        articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);
                                        if (mySqlDataReader["CountryISO"] != DBNull.Value)
                                        {
                                            articleSupplier.Country.Iso = Convert.ToString(mySqlDataReader["CountryISO"]);
                                            articleSupplier.Country.CountryIconUrl = "https://api.emdep.com/GEOS/Images?FilePath=/Images/Countries/" + articleSupplier.Country.Iso + ".png";
                                            //if (!countryISOs.Any(co => co.ToString() == articleSupplier.Country.Iso))
                                            //{
                                            //    countryISOs.Add(articleSupplier.Country.Iso);
                                            //}
                                        }
                                    }
                                    if (mySqlDataReader["SupplierContactPerson"] != DBNull.Value)
                                        articleSupplier.ContactPerson = Convert.ToString(mySqlDataReader["SupplierContactPerson"]);
                                    if (mySqlDataReader["SupplierContactEmail"] != DBNull.Value)
                                        articleSupplier.ContactEmail = Convert.ToString(mySqlDataReader["SupplierContactEmail"]);
                                    warehousePurchaseOrder.ArticleSupplier = articleSupplier;
                                }
                                //[rdixit][GEOS2-4455][19.06.2023]
                                //if (mySqlDataReader["DeliveryDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["deliveryDate"]) != DateTime.MinValue)
                                //{
                                //warehousePurchaseOrder.DeliveryDate = Convert.ToDateTime(mySqlDataReader["deliveryDate"]);
                                //warehousePurchaseOrder.Delay = (int)(warehousePurchaseOrder.DeliveryDate.Value.Date - DateTime.Now.Date).TotalDays;
                                //}
                                if (mySqlDataReader["AttachedPO"] != DBNull.Value)
                                    warehousePurchaseOrder.AttachedPO = Convert.ToByte(mySqlDataReader["AttachedPO"]);
                                if (mySqlDataReader["Deliveries"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.Deliveries = Convert.ToInt32(mySqlDataReader["Deliveries"]);
                                    if (warehousePurchaseOrder.Deliveries > 0)
                                    {
                                        warehousePurchaseOrder.IsPartialPending = true;
                                    }
                                }
                                if (mySqlDataReader["LatestDeliveryDate"] != DBNull.Value)
                                    warehousePurchaseOrder.LatestDeliveryDate = Convert.ToDateTime(mySqlDataReader["LatestDeliveryDate"]);
                                if (mySqlDataReader["IdWarehouse"] != DBNull.Value)
                                    warehousePurchaseOrder.IdWarehouse = Convert.ToInt64(mySqlDataReader["IdWarehouse"]);
                                if (mySqlDataReader["OrderQty"] != DBNull.Value)
                                    totalQuantity = Convert.ToDouble(mySqlDataReader["OrderQty"]);
                                if (mySqlDataReader["ReceivedQuantity"] != DBNull.Value)
                                    receivedQuantity = Convert.ToDouble(mySqlDataReader["ReceivedQuantity"]);
                                if (totalQuantity > 0)
                                    warehousePurchaseOrder.Status = (Int16)((receivedQuantity / totalQuantity) * 100);
                                if (mySqlDataReader["TotalAmount"] != DBNull.Value)
                                    warehousePurchaseOrder.TotalAmount = Convert.ToDecimal(mySqlDataReader["TotalAmount"]);
                                if (mySqlDataReader["CreatedIn"] != DBNull.Value)
                                    warehousePurchaseOrder.CreatedIn = Convert.ToDateTime(mySqlDataReader["CreatedIn"]);
                                if (mySqlDataReader["AttachPdf"] != DBNull.Value)
                                    warehousePurchaseOrder.AttachPdf = Convert.ToString(mySqlDataReader["AttachPdf"]);
                                if (mySqlDataReader["idCurrency"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.IdCurrency = Convert.ToByte(mySqlDataReader["idCurrency"]);
                                    warehousePurchaseOrder.Currency = new Currency();
                                    warehousePurchaseOrder.Currency.IdCurrency = Convert.ToByte(mySqlDataReader["idCurrency"]);
                                    warehousePurchaseOrder.Currency.Name = Convert.ToString(mySqlDataReader["CurrencyName"]);
                                    warehousePurchaseOrder.Currency.Symbol = Convert.ToString(mySqlDataReader["CurrencySymbol"]);
                                }
                                if (mySqlDataReader["IdWorkflowStatus"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                    warehousePurchaseOrder.WorkflowStatus = new WorkflowStatus();
                                    warehousePurchaseOrder.WorkflowStatus.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                    warehousePurchaseOrder.WorkflowStatus.Name = Convert.ToString(mySqlDataReader["Status"]);
                                    warehousePurchaseOrder.WorkflowStatus.HtmlColor = Convert.ToString(mySqlDataReader["HtmlColor"]);
                                }
                                if (mySqlDataReader["AssigneeEmail"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.AssigneeEmail = Convert.ToString(mySqlDataReader["AssigneeEmail"]);
                                }
                                if (mySqlDataReader["CreatorEmail"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.CreatorEmail = Convert.ToString(mySqlDataReader["CreatorEmail"]);
                                }

                                if (mySqlDataReader["ReminderEmailDate"] != DBNull.Value)
                                    warehousePurchaseOrder.ReminderEmailDate = Convert.ToDateTime(mySqlDataReader["ReminderEmailDate"]);

                                if (mySqlDataReader["WarehouseName"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.WarehouseName = Convert.ToString(mySqlDataReader["WarehouseName"]);
                                }


                                warehousePurchaseOrder.LstWorkflowStatus = LstWorkflowStatus;
                                List<byte> GetCurrentButtons = LstWorkflowStatusTransitions.Where(a => a.IdWorkflowStatusFrom == warehousePurchaseOrder.IdWorkflowStatus).Select(a => a.IdWorkflowStatusTo).Distinct().ToList();
                                warehousePurchaseOrder.LstWorkflowStatusTransition = new List<WorkflowStatus>();
                                warehousePurchaseOrder.LstWorkflowStatusTransition.Add(warehousePurchaseOrder.LstWorkflowStatus.FirstOrDefault(a => a.IdWorkflowStatus == warehousePurchaseOrder.IdWorkflowStatus));
                                foreach (byte statusbutton in GetCurrentButtons)
                                {
                                    warehousePurchaseOrder.LstWorkflowStatusTransition.Add(warehousePurchaseOrder.LstWorkflowStatus.FirstOrDefault(a => a.IdWorkflowStatus == statusbutton));
                                }
                            }
                            catch (Exception ex)
                            {
                            }
                            warehousePurchaseOrder.LstAllWorkflowStatusTransitions = LstWorkflowStatusTransitions;
                            warehousePurchaseOrders.Add(warehousePurchaseOrder);

                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetPendingPurchaseOrdersByWarehouse_V2400(). ErrorMessage-" + ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                    #region 2nd ResultSet [rdixit][GEOS2-4455][19.06.2023] 
                    if (mySqlDataReader.NextResult())
                    {
                        while (mySqlDataReader.Read())
                        {
                            if (mySqlDataReader["idWarehousePurchaseOrder"] != DBNull.Value)
                            {
                                WarehousePurchaseOrderItem OrderItem = new WarehousePurchaseOrderItem();

                                WarehousePurchaseOrder Order = warehousePurchaseOrders.FirstOrDefault(i => i.IdWarehousePurchaseOrder == Convert.ToInt64(mySqlDataReader["idWarehousePurchaseOrder"]));
                                if (Order != null)
                                {
                                    if (Order.WarehousePurchaseOrderItems == null)
                                    {
                                        Order.WarehousePurchaseOrderItems = new List<WarehousePurchaseOrderItem>();
                                    }
                                    if (mySqlDataReader["idWarehousePurchaseOrder"] != DBNull.Value)
                                        OrderItem.IdWarehousePurchaseOrder = Convert.ToInt64(mySqlDataReader["idWarehousePurchaseOrder"]);
                                    if (mySqlDataReader["IdWarehousePurchaseOrderItem"] != DBNull.Value)
                                        OrderItem.IdWarehousePurchaseOrderItem = Convert.ToInt64(mySqlDataReader["IdWarehousePurchaseOrderItem"]);
                                    if (mySqlDataReader["Quantity"] != DBNull.Value)
                                        OrderItem.Quantity = Convert.ToDouble(mySqlDataReader["Quantity"]);
                                    if (mySqlDataReader["AlbaranQty"] != DBNull.Value)
                                        OrderItem.ReceivedQuantity = Convert.ToDouble(mySqlDataReader["AlbaranQty"]);
                                    if (OrderItem.Quantity > 0)
                                        OrderItem.Status = (Int16)((OrderItem.ReceivedQuantity / OrderItem.Quantity) * 100);
                                    Order.WarehousePurchaseOrderItems.Add(OrderItem);
                                }
                            }
                        }
                    }
                    #endregion
                    #region 3nd ResultSet [rdixit][GEOS2-4455][19.06.2023] 
                    if (mySqlDataReader.NextResult())
                    {
                        while (mySqlDataReader.Read())
                        {
                            if (mySqlDataReader["IdWarehousePurchaseOrderItem"] != DBNull.Value)
                            {
                                WarehousePurchaseOrderExpectedItem OrderExpectedItem = new WarehousePurchaseOrderExpectedItem();

                                WarehousePurchaseOrderItem OrderItem = warehousePurchaseOrders.Where(o => o.WarehousePurchaseOrderItems != null)
                                                                        .SelectMany(order => order.WarehousePurchaseOrderItems)
                                                                        .FirstOrDefault(item => item.IdWarehousePurchaseOrderItem == Convert.ToInt64(mySqlDataReader["IdWarehousePurchaseOrderItem"]));
                                if (OrderItem != null)
                                {
                                    if (OrderItem.WarehousePurchaseOrderExpectedItems == null)
                                    {
                                        OrderItem.WarehousePurchaseOrderExpectedItems = new List<WarehousePurchaseOrderExpectedItem>();
                                    }
                                    if (mySqlDataReader["IdWarehousePurchaseOrderItem"] != DBNull.Value)
                                        OrderExpectedItem.IdWarehousePurchaseOrderItem = Convert.ToInt64(mySqlDataReader["IdWarehousePurchaseOrderItem"]);
                                    if (mySqlDataReader["Quantity"] != DBNull.Value)
                                        OrderExpectedItem.Quantity = (long)Convert.ToDouble(mySqlDataReader["Quantity"]);
                                    if (mySqlDataReader["Date"] != DBNull.Value)
                                        OrderExpectedItem.Date = Convert.ToDateTime(mySqlDataReader["Date"]);

                                    OrderItem.WarehousePurchaseOrderExpectedItems.Add(OrderExpectedItem);
                                }
                            }
                        }
                    }
                    #endregion
                }
            }
            #region 2nd ResultSet [rdixit][GEOS2-4455][19.06.2023] 
            foreach (WarehousePurchaseOrder Order in warehousePurchaseOrders)
            {
                List<DateTime> ItemDates = new List<DateTime>();
                if (Order.WarehousePurchaseOrderItems != null)
                {
                    if (Order.WarehousePurchaseOrderItems.Where(i => i.Status < 100) != null)
                    {
                        if (Order.WarehousePurchaseOrderItems.Where(i => i.Status < 100).ToList().Count > 0)
                        {
                            foreach (WarehousePurchaseOrderItem OrderItem in Order.WarehousePurchaseOrderItems.Where(i => i.Status != 100))
                            {
                                if (OrderItem.WarehousePurchaseOrderExpectedItems != null)
                                {
                                    if (OrderItem.WarehousePurchaseOrderExpectedItems.Count > 0)
                                        ItemDates.Add(OrderItem.WarehousePurchaseOrderExpectedItems.FirstOrDefault().Date);
                                }
                            }
                        }
                    }
                }
                if (ItemDates.Count != 0)
                {
                    Order.DeliveryDate = ItemDates.Min(d => d.Date).Date;
                    Order.Delay = (int)(Order.DeliveryDate.Value.Date - DateTime.Now.Date).TotalDays;

                    if (!string.IsNullOrEmpty(Order.ArticleSupplier.ContactEmail))
                    {
                        if (Order.ReminderEmailDate == DateTime.MinValue || Order.ReminderEmailDate == null)
                        {
                            Order.ReminderEmailDate = Order.DeliveryDate.Value.AddDays(1);
                        }
                        DateTime dtRm = new DateTime(Order.ReminderEmailDate.Value.Year, Order.ReminderEmailDate.Value.Month, Order.ReminderEmailDate.Value.Day);
                        DateTime dtNow = new DateTime(DateTime.Now.Year, DateTime.Now.Month, DateTime.Now.Day);
                        if (dtRm <= dtNow)
                        {
                            orderid = new List<long>();
                            orderid.Add(Order.IdWarehousePurchaseOrder);
                            if (!SupplierEmailId.ContainsKey(Order.ArticleSupplier.ContactEmail))
                            {
                                SupplierEmailId.Add(Order.ArticleSupplier.ContactEmail, orderid);
                            }
                            else
                            {
                                SupplierEmailId[Order.ArticleSupplier.ContactEmail].Add(Order.IdWarehousePurchaseOrder);
                            }
                        }
                    }
                    else
                    {
                        if (!Suppliername.Contains(Order.ArticleSupplier.Name))
                        {
                            Suppliername.Add(Order.ArticleSupplier.Name);
                        }
                    }
                }
            }
            #endregion
            //foreach (string item in countryISOs)
            //{
            //    byte[] bytes = null;
            //    bytes = GetCountryIconFileInBytes(item, countryIconFilePath);
            //    warehousePurchaseOrders.Where(wp => wp.ArticleSupplier.Country.Iso == item).ToList().ForEach(wp => wp.ArticleSupplier.Country.CountryIconBytes = bytes);
            //}
            if (warehousePurchaseOrders.Count > 0)
            {
                warehousePurchaseOrders.FirstOrDefault().SupplierEmailId = SupplierEmailId;
                warehousePurchaseOrders.FirstOrDefault().Suppliername = Suppliername;
            }
            return warehousePurchaseOrders;
        }

        //[pramod.misal][GEOS2-4431][16/06/2023]
        public WarehousePurchaseOrder GetPendingPOByIdWarehousePurchaseOrder_V2400(string connectionString, Int64 idWarehousePurchaseOrder, string purchaseOrdersPath, string emailTemplatePath, string countryIconFilePath)
        {
            WarehousePurchaseOrder warehousePurchaseOrder = null;

            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetPendingPOByIdWarehousePurchaseOrder_V2390", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", idWarehousePurchaseOrder);

                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    if (mySqlDataReader.Read())
                    {
                        try
                        {
                            warehousePurchaseOrder = new WarehousePurchaseOrder();

                            warehousePurchaseOrder.IdWarehousePurchaseOrder = idWarehousePurchaseOrder;

                            if (mySqlDataReader["Code"] != DBNull.Value)
                                warehousePurchaseOrder.Code = Convert.ToString(mySqlDataReader["Code"]);

                            if (mySqlDataReader["IdArticleSupplier"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                                ArticleSupplier articleSupplier = new ArticleSupplier();
                                articleSupplier.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                                if (mySqlDataReader["Supplier"] != DBNull.Value)
                                    articleSupplier.Name = Convert.ToString(mySqlDataReader["Supplier"]);

                                if (mySqlDataReader["SupplierContactPerson"] != DBNull.Value)
                                    articleSupplier.ContactPerson = Convert.ToString(mySqlDataReader["SupplierContactPerson"]);

                                if (mySqlDataReader["SupplierContactEmail"] != DBNull.Value)
                                    articleSupplier.ContactEmail = Convert.ToString(mySqlDataReader["SupplierContactEmail"]);

                                if (mySqlDataReader["Serie"] != DBNull.Value)
                                    articleSupplier.Serie = Convert.ToChar(mySqlDataReader["Serie"]);

                                if (mySqlDataReader["IdCountry"] != DBNull.Value)
                                {
                                    articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["IdCountry"]);

                                    articleSupplier.Country = new Country();
                                    articleSupplier.Country.IdCountry = (byte)articleSupplier.IdCountry;
                                    articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);

                                    if (mySqlDataReader["SupplierCountryISO"] != DBNull.Value)
                                    {
                                        articleSupplier.Country.Iso = Convert.ToString(mySqlDataReader["SupplierCountryISO"]);
                                        byte[] bytes = null;
                                        bytes = GetCountryIconFileInBytes(articleSupplier.Country.Iso, countryIconFilePath);
                                        articleSupplier.Country.CountryIconBytes = bytes;
                                    }

                                    if (mySqlDataReader["IdCountryGroup"] != DBNull.Value)
                                        articleSupplier.Country.IdCountryGroup = Convert.ToInt64(mySqlDataReader["IdCountryGroup"]);
                                }

                                if (mySqlDataReader["IdArticleSupplierType"] != DBNull.Value)
                                {
                                    articleSupplier.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["IdArticleSupplierType"]);

                                    articleSupplier.ArticleSupplierType = new ArticleSupplierType();
                                    articleSupplier.ArticleSupplierType.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["IdArticleSupplierType"]);
                                    articleSupplier.ArticleSupplierType.Name = Convert.ToString(mySqlDataReader["ArticleSupplierType"]);
                                    articleSupplier.ArticleSupplierType.HtmlColor = Convert.ToString(mySqlDataReader["HtmlColor"]);
                                }

                                warehousePurchaseOrder.ArticleSupplier = articleSupplier;
                            }
                            //[rdixit][GEOS2-4455][28.06.2023] 
                            //if (mySqlDataReader["DeliveryDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["deliveryDate"]) != DateTime.MinValue)
                            //{
                            //    warehousePurchaseOrder.DeliveryDate = Convert.ToDateTime(mySqlDataReader["deliveryDate"]);
                            //}

                            if (mySqlDataReader["AttachedPO"] != DBNull.Value)
                                warehousePurchaseOrder.AttachedPO = Convert.ToByte(mySqlDataReader["AttachedPO"]);

                            if (mySqlDataReader["IdPaymentType"] != DBNull.Value)
                                warehousePurchaseOrder.IdPaymentType = Convert.ToInt64(mySqlDataReader["IdPaymentType"]);

                            if (mySqlDataReader["ReminderEmailDate"] != DBNull.Value)
                                warehousePurchaseOrder.ReminderEmailDate = Convert.ToDateTime(mySqlDataReader["ReminderEmailDate"]);

                            if (mySqlDataReader["CreatedIn"] != DBNull.Value)
                                warehousePurchaseOrder.CreatedIn = Convert.ToDateTime(mySqlDataReader["CreatedIn"]);

                            if (mySqlDataReader["ModifiedIn"] != DBNull.Value)
                                warehousePurchaseOrder.ModifiedIn = Convert.ToDateTime(mySqlDataReader["ModifiedIn"]);

                            if (mySqlDataReader["Comments"] != DBNull.Value)
                                warehousePurchaseOrder.Comments = Convert.ToString(mySqlDataReader["Comments"]);

                            if (mySqlDataReader["IsClosed"] != DBNull.Value)
                                warehousePurchaseOrder.IsClosed = Convert.ToByte(mySqlDataReader["IsClosed"]);

                            if (mySqlDataReader["CreatedBy"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.CreatedBy = Convert.ToInt64(mySqlDataReader["CreatedBy"]);
                                warehousePurchaseOrder.Creator = new People();
                                warehousePurchaseOrder.Creator.IdPerson = Convert.ToInt32(mySqlDataReader["CreatedBy"].ToString());
                                warehousePurchaseOrder.Creator.Name = mySqlDataReader["CreatorName"].ToString();
                                warehousePurchaseOrder.Creator.Surname = mySqlDataReader["CreatorSurname"].ToString();
                            }

                            if (mySqlDataReader["ModifiedBy"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.ModifiedBy = Convert.ToInt64(mySqlDataReader["ModifiedBy"]);
                                warehousePurchaseOrder.Modifier = new People();
                                warehousePurchaseOrder.Modifier.IdPerson = Convert.ToInt32(mySqlDataReader["ModifiedBy"].ToString());
                                warehousePurchaseOrder.Modifier.Name = mySqlDataReader["ModifierName"].ToString();
                                warehousePurchaseOrder.Modifier.Surname = mySqlDataReader["ModifierSurname"].ToString();
                            }

                            if (mySqlDataReader["ReasonClosed"] != DBNull.Value)
                                warehousePurchaseOrder.ReasonClosed = Convert.ToString(mySqlDataReader["ReasonClosed"]);

                            if (mySqlDataReader["IdWarehouse"] != DBNull.Value)
                                warehousePurchaseOrder.IdWarehouse = Convert.ToInt64(mySqlDataReader["IdWarehouse"]);

                            if (mySqlDataReader["IdCurrency"] != DBNull.Value)
                                warehousePurchaseOrder.IdCurrency = Convert.ToByte(mySqlDataReader["IdCurrency"]);

                            if (mySqlDataReader["IdWorkflowStatus"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                warehousePurchaseOrder.WorkflowStatus = new WorkflowStatus();
                                warehousePurchaseOrder.WorkflowStatus.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                warehousePurchaseOrder.WorkflowStatus.Name = Convert.ToString(mySqlDataReader["Status"]);
                                warehousePurchaseOrder.WorkflowStatus.HtmlColor = Convert.ToString(mySqlDataReader["StatusHtmlColor"]);
                            }

                            if (mySqlDataReader["IdAssignee"] != DBNull.Value)
                                warehousePurchaseOrder.IdAssignee = Convert.ToUInt32(mySqlDataReader["IdAssignee"]);

                            if (mySqlDataReader["IdApprover"] != DBNull.Value)
                                warehousePurchaseOrder.IdApprover = Convert.ToUInt32(mySqlDataReader["IdApprover"]);

                            if (mySqlDataReader["AssigneeEmail"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.AssigneeEmail = Convert.ToString(mySqlDataReader["AssigneeEmail"]);
                            }
                            if (mySqlDataReader["CreatorEmail"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.CreatorEmail = Convert.ToString(mySqlDataReader["CreatorEmail"]);
                            }

                            string HTMLFileName = null;
                            if (File.Exists(string.Format("{0}{1}SupplierPurchaseOrderRequestMailFormat_{2}-{3}.html", emailTemplatePath, @"\", warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower(), warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToUpper())))
                            {
                                HTMLFileName = string.Format("SupplierPurchaseOrderRequestMailFormat_{0}-{1}.html", warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower(), warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToUpper());
                            }
                            else if (File.Exists(string.Format("{0}{1}SupplierPurchaseOrderRequestMailFormat.html", emailTemplatePath, @"\")))
                            {
                                HTMLFileName = "SupplierPurchaseOrderRequestMailFormat.html";
                            }
                            if (HTMLFileName != null)
                            {
                                StringBuilder emailbody = new StringBuilder();
                                string text = ReadMailTemplate(HTMLFileName, emailTemplatePath);

                                if (string.IsNullOrEmpty(warehousePurchaseOrder.ArticleSupplier.ContactPerson))
                                {
                                    text = text.Replace("[Supplier_Name]", "Supplier");
                                }
                                else
                                {
                                    text = text.Replace("[Supplier_Name]", warehousePurchaseOrder.ArticleSupplier.ContactPerson);
                                }
                                text = text.Replace("[PO_Code]", warehousePurchaseOrder.Code);

                                emailbody.Append(text);

                                warehousePurchaseOrder.EmailBody = emailbody.ToString();
                            }
                            warehousePurchaseOrder.AttachPdf = warehousePurchaseOrder.CreatedIn.Year + @"\" + warehousePurchaseOrder.Code + @"\01 Purchase Order\PO_" + warehousePurchaseOrder.Code + ".pdf";

                            warehousePurchaseOrder.AttachmentBytes = GetPurchaseOrderPdf(purchaseOrdersPath, warehousePurchaseOrder.AttachPdf);
                            warehousePurchaseOrder.WarehouseDeliveryNotes = GetDeliveryNotesByIdWarehousePurchaseOrder(connectionString, warehousePurchaseOrder, purchaseOrdersPath);

                            warehousePurchaseOrder.WarehousePurchaseOrderItemWithComments = GetArticlesByIdWarehousePurchaseOrder_V2300(connectionString, warehousePurchaseOrder.IdWarehousePurchaseOrder);

                            warehousePurchaseOrder.WarehousePOComments = GetlogEntriesByWarehousePO_V2400(idWarehousePurchaseOrder, 252, connectionString);
                            warehousePurchaseOrder.WarehousePOLogEntries = GetlogEntriesByWarehousePO_V2400(idWarehousePurchaseOrder, 253, connectionString);

                            //[rdixit][GEOS2-4455][28.06.2023] 
                            List<DateTime> ItemDates = new List<DateTime>();
                            if (warehousePurchaseOrder.WarehousePurchaseOrderItemWithComments != null)
                            {
                                if (warehousePurchaseOrder.WarehousePurchaseOrderItemWithComments.Where(i => i.Status < 100) != null)
                                {
                                    if (warehousePurchaseOrder.WarehousePurchaseOrderItemWithComments.Where(i => i.Status < 100).ToList().Count > 0)
                                        foreach (var item in warehousePurchaseOrder.WarehousePurchaseOrderItemWithComments.Where(i => i.Status < 100))
                                        {
                                            if (item.WarehousePurchaseOrderExpectedItems != null)
                                            {
                                                if (item.WarehousePurchaseOrderExpectedItems.Count > 0)
                                                    ItemDates.Add(item.WarehousePurchaseOrderExpectedItems.FirstOrDefault().Date);
                                            }
                                        }
                                }
                            }
                            if (ItemDates.Count > 0)
                                warehousePurchaseOrder.DeliveryDate = ItemDates.Min(d => d.Date).Date;
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetPendingPOByIdWarehousePurchaseOrder_V2400(idWarehousePurchaseOrder-{0}), ErrorMessage- {1} ", idWarehousePurchaseOrder, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            return warehousePurchaseOrder;
        }

        //[pramod.misal][GEOS2-4431][16-06-2023]
        public List<LogEntriesByWarehousePO> GetlogEntriesByWarehousePO_V2400(Int64 idWarehousePurchaseOrder, byte idLogEntryType, string connectionString)
        {
            List<LogEntriesByWarehousePO> logEntriesByWarehousePOList = new List<LogEntriesByWarehousePO>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetLogEntriesByWarehousePurchaseOrder", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", idWarehousePurchaseOrder);
                    mySqlCommand.Parameters.AddWithValue("_IdLogEntryType", idLogEntryType);

                    using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                    {
                        while (mySqlDataReader.Read())
                        {
                            LogEntriesByWarehousePO logEntriesByWarehousePO = new LogEntriesByWarehousePO();

                            logEntriesByWarehousePO.IdLogEntryByPurchaseOrder = Convert.ToInt64(mySqlDataReader["IdLogEntryByPurchaseOrder"]);

                            if (mySqlDataReader["IdUser"] != DBNull.Value)
                                logEntriesByWarehousePO.IdUser = Convert.ToInt32(mySqlDataReader["IdUser"].ToString());

                            if (mySqlDataReader["IdWarehousePurchaseOrder"] != DBNull.Value)
                                logEntriesByWarehousePO.IdWarehousePurchaseOrder = Convert.ToInt64(mySqlDataReader["IdWarehousePurchaseOrder"].ToString());

                            if (mySqlDataReader["IdPerson"] != DBNull.Value)
                            {
                                logEntriesByWarehousePO.People = new People();
                                logEntriesByWarehousePO.People.IdPerson = Convert.ToInt32(mySqlDataReader["IdPerson"].ToString());
                                logEntriesByWarehousePO.People.Name = mySqlDataReader["Name"].ToString();
                                logEntriesByWarehousePO.People.Surname = mySqlDataReader["Surname"].ToString();
                            }

                            //if (mySqlDataReader["Datetime"] != DBNull.Value)
                            //    logEntriesByWarehousePO.Datetime = Convert.ToDateTime(mySqlDataReader["Datetime"].ToString());

                            //[pramod.misal][GEOS2-4431][16-06-2023]
                            if (mySqlDataReader["Datetime"] != DBNull.Value)
                            {
                                logEntriesByWarehousePO.Datetime = Convert.ToDateTime(mySqlDataReader["Datetime"].ToString());
                            }

                            if (mySqlDataReader["Comments"] != DBNull.Value)
                                logEntriesByWarehousePO.Comments = mySqlDataReader["Comments"].ToString();

                            if (mySqlDataReader["IdLogEntryType"] != DBNull.Value)
                                logEntriesByWarehousePO.IdLogEntryType = Convert.ToByte(mySqlDataReader["IdLogEntryType"]);

                            if (mySqlDataReader["IsRtfText"] != DBNull.Value)
                                logEntriesByWarehousePO.IsRtfText = Convert.ToBoolean(mySqlDataReader["IsRtfText"]);

                            logEntriesByWarehousePOList.Add(logEntriesByWarehousePO);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetlogEntriesByWarehousePO_V2400. ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return logEntriesByWarehousePOList;
        }

        #region  GEOS2-4404&GEOS2-4405
        //Shubham[skadam]  GEOS2-4404 (View Supplier) Set the PO status automatically to “Sent” when sending successfully the Email 21 06 2023
        //Shubham[skadam]  GEOS2-4405 (Grid) Set the PO status automatically to “Sent” when sending successfully the Email 21 06 2023
        public bool UpdatePurchasingOrderStatus(Int64 IdWarehousePurchaseOrder, Int64 IdUser, string connectionString)
        {
            bool isUpdate = false;
            try
            {
                using (MySqlConnection conn = new MySqlConnection(connectionString))
                {
                    conn.Open();
                    MySqlCommand command = new MySqlCommand("SRM_PurchasingOrderStatusUpdate_V2400", conn);
                    command.CommandType = CommandType.StoredProcedure;
                    command.Parameters.AddWithValue("_IdWarehousePurchaseOrder", IdWarehousePurchaseOrder);
                    command.Parameters.AddWithValue("_IdUser", IdUser);
                    command.ExecuteNonQuery();
                    isUpdate = true;
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error PurchasingOrderStatusUpdate(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw ex;
            }
            return isUpdate;
        }

        public Int32 GetPurchasingOrderStatus(Int64 IdWarehousePurchaseOrder, string connectionString)
        {
            Int32 IdWorkflowStatus = 0;
            try
            {
                using (MySqlConnection conn = new MySqlConnection(connectionString))
                {
                    conn.Open();
                    MySqlCommand command = new MySqlCommand("SRM_PurchasingOrderStatus_V2400", conn);
                    command.CommandType = CommandType.StoredProcedure;
                    command.Parameters.AddWithValue("_IdWarehousePurchaseOrder", IdWarehousePurchaseOrder);

                    using (MySqlDataReader dr = command.ExecuteReader())
                    {
                        if (dr.Read())
                        {
                            if (dr["IdWorkflowStatus"] != DBNull.Value)
                            {
                                IdWorkflowStatus = Convert.ToInt32(dr["IdWorkflowStatus"]);
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return IdWorkflowStatus;
        }
        #endregion

        public POEmailNotification GetPurchasingOrderNotificationDetails(Int64 IdWarehousePurchaseOrder, Int64 IdUser, string connectionString)
        {
            POEmailNotification EmailNotificationDetails = new POEmailNotification();
            try
            {
                using (MySqlConnection conn = new MySqlConnection(connectionString))
                {
                    conn.Open();
                    MySqlCommand command = new MySqlCommand("SRM_GetPurchasingOrderEmailNotificationDetails_V4200", conn);
                    command.CommandType = CommandType.StoredProcedure;
                    command.Parameters.AddWithValue("_IdWarehousePurchaseOrder", IdWarehousePurchaseOrder);
                    command.Parameters.AddWithValue("_IdUser", IdUser);
                    using (MySqlDataReader dr = command.ExecuteReader())
                    {
                        if (dr.Read())
                        {
                            if (dr["IdWorkflowStatus"] != DBNull.Value)
                            {
                                EmailNotificationDetails.IdWorkflowStatus = Convert.ToInt32(dr["IdWorkflowStatus"]);
                            }
                            if (dr["IdWarehouse"] != DBNull.Value)
                            {
                                EmailNotificationDetails.IdWarehouse = Convert.ToInt32(dr["IdWarehouse"]);
                            }
                            if (dr["IdCurrency"] != DBNull.Value)
                            {
                                EmailNotificationDetails.IdCurrency = Convert.ToInt32(dr["IdCurrency"]);
                            }
                            if (dr["IdWarehousePurchaseOrder"] != DBNull.Value)
                            {
                                EmailNotificationDetails.IdWarehousePurchaseOrder = Convert.ToInt64(dr["IdWarehousePurchaseOrder"]);
                            }
                            if (dr["Code"] != DBNull.Value)
                            {
                                EmailNotificationDetails.Code = Convert.ToString(dr["Code"].ToString());
                            }
                            if (dr["IdAssignee"] != DBNull.Value)
                            {
                                EmailNotificationDetails.IdAssignee = Convert.ToInt64(dr["IdAssignee"].ToString());
                            }
                            if (dr["IdApprover"] != DBNull.Value)
                            {
                                EmailNotificationDetails.IdApprover = Convert.ToInt64(dr["IdApprover"].ToString());
                            }
                            if (dr["ReasonClosed"] != DBNull.Value)
                            {
                                EmailNotificationDetails.ReasonClosed = Convert.ToString(dr["ReasonClosed"].ToString());
                            }
                            if (dr["Supplier"] != DBNull.Value)
                            {
                                EmailNotificationDetails.Supplier = Convert.ToString(dr["Supplier"].ToString());
                            }
                            if (dr["IdArticleSupplierType"] != DBNull.Value)
                            {
                                EmailNotificationDetails.IdArticleSupplierType = Convert.ToInt64(dr["IdArticleSupplierType"].ToString());
                            }
                            if (dr["ArticleSupplierType"] != DBNull.Value)
                            {
                                EmailNotificationDetails.ArticleSupplierType = Convert.ToString(dr["ArticleSupplierType"].ToString());
                            }
                            if (dr["HtmlColor"] != DBNull.Value)
                            {
                                EmailNotificationDetails.HtmlColor = Convert.ToString(dr["HtmlColor"].ToString());
                            }
                            if (dr["Comments"] != DBNull.Value)
                            {
                                EmailNotificationDetails.Comments = Convert.ToString(dr["Comments"].ToString());
                            }
                            if (dr["Status"] != DBNull.Value)
                            {
                                EmailNotificationDetails.Status = Convert.ToString(dr["Status"].ToString());
                            }
                            if (dr["StatusHtmlColor"] != DBNull.Value)
                            {
                                EmailNotificationDetails.StatusHtmlColor = Convert.ToString(dr["StatusHtmlColor"].ToString());
                            }
                            if (dr["SupplierContactPerson"] != DBNull.Value)
                            {
                                EmailNotificationDetails.SupplierContactPerson = Convert.ToString(dr["SupplierContactPerson"].ToString());
                            }
                            if (dr["SupplierContactEmail"] != DBNull.Value)
                            {
                                EmailNotificationDetails.SupplierContactEmail = Convert.ToString(dr["SupplierContactEmail"].ToString());
                            }
                            if (dr["AssineeId"] != DBNull.Value)
                            {
                                EmailNotificationDetails.AssineeId = Convert.ToInt64(dr["AssineeId"].ToString());
                            }
                            if (dr["AssineeFname"] != DBNull.Value)
                            {
                                EmailNotificationDetails.AssineeFname = Convert.ToString(dr["AssineeFname"].ToString());
                            }
                            if (dr["AssineeLname"] != DBNull.Value)
                            {
                                EmailNotificationDetails.AssineeLname = Convert.ToString(dr["AssineeLname"].ToString());
                            }
                            if (dr["AssineeCompEmail"] != DBNull.Value)
                            {
                                EmailNotificationDetails.AssineeCompEmail = Convert.ToString(dr["AssineeCompEmail"].ToString());
                            }
                            if (dr["ApproverId"] != DBNull.Value)
                            {
                                EmailNotificationDetails.ApproverId = Convert.ToInt64(dr["ApproverId"].ToString());
                            }
                            if (dr["ApproverFname"] != DBNull.Value)
                            {
                                EmailNotificationDetails.ApproverFname = Convert.ToString(dr["ApproverFname"].ToString());
                            }
                            if (dr["ApproverLname"] != DBNull.Value)
                            {
                                EmailNotificationDetails.ApproverLname = Convert.ToString(dr["ApproverLname"].ToString());
                            }
                            if (dr["ApproverCompEmail"] != DBNull.Value)
                            {
                                EmailNotificationDetails.ApproverCompEmail = Convert.ToString(dr["ApproverCompEmail"].ToString());
                            }
                            if (dr["CreatorEmail"] != DBNull.Value)
                            {
                                EmailNotificationDetails.CreatorEmail = Convert.ToString(dr["CreatorEmail"].ToString());
                            }
                            if (dr["CreatedBy"] != DBNull.Value)
                            {
                                EmailNotificationDetails.CreatedByEmail = Convert.ToString(dr["CreatedBy"].ToString());
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                throw ex;
            }
            return EmailNotificationDetails;
        }

        public List<WorkflowTransition> GetAllWorkflowTransitions_V2400(string connectionString)
        {

            List<WorkflowTransition> workflowTransitionList = new List<WorkflowTransition>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("SRM_Get_workflow_transitions_V2400", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                    {
                        while (mySqlDataReader.Read())
                        {
                            WorkflowTransition workflowTransition = new WorkflowTransition();

                            workflowTransition.IdWorkflowTransition = Convert.ToUInt32(mySqlDataReader["IdWorkflowTransition"]);

                            if (mySqlDataReader["IdWorkflow"] != DBNull.Value)
                                workflowTransition.IdWorkflow = Convert.ToUInt32(mySqlDataReader["IdWorkflow"]);

                            if (mySqlDataReader["Name"] != DBNull.Value)
                                workflowTransition.Name = mySqlDataReader["Name"].ToString();

                            if (mySqlDataReader["IdWorkflowStatusFrom"] != DBNull.Value)
                                workflowTransition.IdWorkflowStatusFrom = Convert.ToByte(mySqlDataReader["IdWorkflowStatusFrom"]);

                            if (mySqlDataReader["IdWorkflowStatusTo"] != DBNull.Value)
                                workflowTransition.IdWorkflowStatusTo = Convert.ToByte(mySqlDataReader["IdWorkflowStatusTo"]);

                            if (mySqlDataReader["IsCommentRequired"] != DBNull.Value)
                                workflowTransition.IsCommentRequired = Convert.ToByte(mySqlDataReader["IsCommentRequired"]);

                            if (mySqlDataReader["IdWorkflowScope"] != DBNull.Value)
                                workflowTransition.IdWorkflowScope = Convert.ToUInt32(mySqlDataReader["IdWorkflowScope"]);

                            if (mySqlDataReader["IsNotificationRaised"] != DBNull.Value)
                                workflowTransition.IsNotificationRaised = Convert.ToInt16(mySqlDataReader["IsNotificationRaised"]);

                            workflowTransitionList.Add(workflowTransition);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllWorkflowTransitions_V2400(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return workflowTransitionList;
        }

        public bool PurchasingOrderNotificationSend(POEmailNotification PurchasingOrder, string emailTemplate, string mailFrom, string mailServerName, string mailServerPort)
        {
            bool isSend = false;
            try
            {
                #region isSend
                List<System.Net.Mail.LinkedResource> ImgResourceList = new List<System.Net.Mail.LinkedResource>();
                List<string> Images = new List<string>();
                //emailTemplate = "";
                //emailTemplate =  File.ReadAllText(@"C:\Temp\geos$\Workbench\Templates\" + "SupplierPurchaseOrderStatusChangeMailFormat.html"); ;
                emailTemplate = emailTemplate.Replace("[PO_CODE]", PurchasingOrder.Code);

                if (PurchasingOrder.Comments != "" && PurchasingOrder.Comments != null && PurchasingOrder.Comments != string.Empty)
                {
                    emailTemplate = emailTemplate.Replace("[COMMENTS]", "<br><b>REASON=</b><i>\"" + PurchasingOrder.Comments + "\"</i>");
                }
                else
                {
                    emailTemplate = emailTemplate.Replace("[COMMENTS]", "");
                }
                emailTemplate = emailTemplate.Replace("[StatusStyle]", PurchasingOrder.StatusHtmlColor);
                emailTemplate = emailTemplate.Replace("[Status]", PurchasingOrder.Status);
                emailTemplate = emailTemplate.Replace("[NotifyUserEmail]", PurchasingOrder.CreatorEmail);

                #region Take Images From URL
                System.Text.RegularExpressions.Regex regexImg = new System.Text.RegularExpressions.Regex("<img.+?src=[\"'](.+?)[\"'].*?>", System.Text.RegularExpressions.RegexOptions.IgnoreCase);
                System.Text.RegularExpressions.MatchCollection matchesImg = regexImg.Matches(emailTemplate);
                string mailecos = "SRM";
                System.Net.Mail.MailAddress emailFrom = new System.Net.Mail.MailAddress(mailFrom, mailecos);
                using (System.Net.Mail.MailMessage mail = new System.Net.Mail.MailMessage())
                {
                    mail.From = emailFrom;
                    //if (!string.IsNullOrEmpty(PurchasingOrder.SupplierContactEmail))
                    //{
                    //    mail.To.Add(PurchasingOrder.SupplierContactEmail);
                    //}
                    if (!string.IsNullOrEmpty(PurchasingOrder.CreatedByEmail))
                        mail.Bcc.Add(PurchasingOrder.CreatedByEmail);
                    if (!string.IsNullOrEmpty(PurchasingOrder.ApproverCompEmail))
                        mail.Bcc.Add(PurchasingOrder.ApproverCompEmail);
                    if (!string.IsNullOrEmpty(PurchasingOrder.AssineeCompEmail))
                        mail.Bcc.Add(PurchasingOrder.AssineeCompEmail);

                    foreach (System.Text.RegularExpressions.Match matchImg in matchesImg)
                    {
                        Images.Add(matchImg.Groups[1].Value);
                    }

                    System.Net.ServicePointManager.SecurityProtocol = System.Net.SecurityProtocolType.Tls12;
                    ImgResourceList.Clear();
                    foreach (var item in Images)
                    {
                        if (item.Contains("logo-geos.png"))
                        {
                            emailTemplate = emailTemplate.Replace(item, "cid:EmbeddedContent_1");

                            // Download the image from the URL
                            //using (System.Net.WebClient webClient = new System.Net.WebClient())
                            //{
                            //    byte[] imageBytes = webClient.DownloadData(item);
                            //    MemoryStream imgGeosLogo = new MemoryStream(imageBytes);
                            //    System.Net.Mail.LinkedResource LRGeosLogo = new System.Net.Mail.LinkedResource(imgGeosLogo);
                            //    LRGeosLogo.ContentId = "EmbeddedContent_1";
                            //    LRGeosLogo.ContentLink = new Uri("cid:" + LRGeosLogo.ContentId);
                            //    ImgResourceList.Add(LRGeosLogo);
                            //}
                            try
                            {
                                // Download the image from the URL
                                byte[] imageBytes = Utility.ImageUtil.GetImageByWebClient(item);
                                MemoryStream imgGeosLogo = new MemoryStream(imageBytes);
                                System.Net.Mail.LinkedResource LRGeosLogo = new System.Net.Mail.LinkedResource(imgGeosLogo);
                                LRGeosLogo.ContentId = "EmbeddedContent_1";
                                LRGeosLogo.ContentLink = new Uri("cid:" + LRGeosLogo.ContentId);
                                ImgResourceList.Add(LRGeosLogo);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("[ERROR] SendEmailForPO() in MailControl.SendHtmlMail - {1}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            }

                        }

                        if (item.Contains("logo-emdep.png"))
                        {
                            emailTemplate = emailTemplate.Replace(item, "cid:EmbeddedContent_2");

                            // Download the image from the URL
                            //using (System.Net.WebClient webClient = new System.Net.WebClient())
                            //{
                            //    byte[] imageBytes = webClient.DownloadData(item);
                            //    MemoryStream imgEmdepLogo = new MemoryStream(imageBytes);
                            //    System.Net.Mail.LinkedResource LREmdepLogo = new System.Net.Mail.LinkedResource(imgEmdepLogo);
                            //    LREmdepLogo.ContentId = "EmbeddedContent_2";
                            //    LREmdepLogo.ContentLink = new Uri("cid:" + LREmdepLogo.ContentId);
                            //    ImgResourceList.Add(LREmdepLogo);
                            //}
                            try
                            {
                                // Download the image from the URL
                                byte[] imageBytes = Utility.ImageUtil.GetImageByWebClient(item);
                                MemoryStream imgEmdepLogo = new MemoryStream(imageBytes);
                                System.Net.Mail.LinkedResource LREmdepLogo = new System.Net.Mail.LinkedResource(imgEmdepLogo);
                                LREmdepLogo.ContentId = "EmbeddedContent_2";
                                LREmdepLogo.ContentLink = new Uri("cid:" + LREmdepLogo.ContentId);
                                ImgResourceList.Add(LREmdepLogo);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("[ERROR] SendEmailForPO() in MailControl.SendHtmlMail - {1}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            }

                        }

                        if (item.Contains("linkedin_sm.png"))
                        {
                            emailTemplate = emailTemplate.Replace(item, "cid:EmbeddedContent_3");

                            // Download the image from the URL
                            //using (System.Net.WebClient webClient = new System.Net.WebClient())
                            //{
                            //    byte[] imageBytes = webClient.DownloadData(item);
                            //    MemoryStream imglinkedin = new MemoryStream(imageBytes);
                            //    System.Net.Mail.LinkedResource LRlinkedin = new System.Net.Mail.LinkedResource(imglinkedin);
                            //    LRlinkedin.ContentId = "EmbeddedContent_3";
                            //    LRlinkedin.ContentLink = new Uri("cid:" + LRlinkedin.ContentId);
                            //    ImgResourceList.Add(LRlinkedin);
                            //}
                            try
                            {
                                byte[] imageBytes = Utility.ImageUtil.GetImageByWebClient(item);
                                MemoryStream imglinkedin = new MemoryStream(imageBytes);
                                System.Net.Mail.LinkedResource LRlinkedin = new System.Net.Mail.LinkedResource(imglinkedin);
                                LRlinkedin.ContentId = "EmbeddedContent_3";
                                LRlinkedin.ContentLink = new Uri("cid:" + LRlinkedin.ContentId);
                                ImgResourceList.Add(LRlinkedin);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("[ERROR] SendEmailForPO() in MailControl.SendHtmlMail - {1}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            }
                        }
                    }
                    System.Net.Mail.AlternateView htmlView = System.Net.Mail.AlternateView.CreateAlternateViewFromString(emailTemplate.ToString(), null, "text/html");

                    foreach (System.Net.Mail.LinkedResource linkedResource in ImgResourceList)
                    {
                        htmlView.LinkedResources.Add(linkedResource);
                    }
                    using (System.Net.Mail.SmtpClient smtp = new System.Net.Mail.SmtpClient(mailServerName, Convert.ToInt32(mailServerPort)))
                    {
                        mail.AlternateViews.Add(htmlView);
                        mail.Subject = "[SRM] New Status change in Purchase Order " + PurchasingOrder.Code;
                        mail.IsBodyHtml = true;
                        mail.Body = string.Empty;
                        smtp.UseDefaultCredentials = false;
                        smtp.EnableSsl = false;
                        try
                        {
                            smtp.Send(mail);
                            isSend = true;
                        }
                        catch (Exception ex)
                        {
                            isSend = false;
                        }
                    }
                }
                #endregion
                #endregion
            }
            catch (Exception ex)
            {
                isSend = false;
            }
            return isSend;
        }

        //[rdixit][28.06.2023]
        public bool SendEmailForPO(string emailto, string sub, string emailbody, string MailServerName, string MailServerPort, Dictionary<string, byte[]> attachments, string EmailFrom, List<string> ccAddress)
        {
            Log4NetLogger.Logger.Log(string.Format("[INFO] SendEmailForPO......"), category: Category.Info, priority: Priority.Low);
            try
            {
                MailControl.SendHtmlMailWithccAndMultipleAttachment(sub, emailbody.ToString(), emailto, ccAddress, EmailFrom, MailServerName, MailServerPort, attachments);
                return true;
                Log4NetLogger.Logger.Log(string.Format("[INFO] Supplier email sent to email - {0}", emailto), category: Category.Info, priority: Priority.Low);
            }

            catch (System.Net.Mail.SmtpFailedRecipientException ex)
            {
                Log4NetLogger.Logger.Log(string.Format("[ERROR] SendEmailForPO() in MailControl.SendHtmlMail-SmtpFailedRecipient - {0} - {1}", ex.FailedRecipient, ex.Message), category: Category.Exception, priority: Priority.Low);
                return false;
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("[ERROR] SendEmailForPO() in MailControl.SendHtmlMail - {1}", ex.Message), category: Category.Exception, priority: Priority.Low);
                return false;
            }
        }

        //[pramod.misal][GEOS2-4448][30-06-2023]
        public List<WarehousePurchaseOrder> GetPendingPurchaseOrdersByWarehouse_V2410(long idWarehouse, string connectionstring, string countryIconFilePath, string connectionStringWorkbench)
        {
            // string connectionString = warehouse.Company.ConnectPlantConstr;
            List<WarehousePurchaseOrder> warehousePurchaseOrders = new List<WarehousePurchaseOrder>();
            List<string> countryISOs = new List<string>();
            List<long> orderid = new List<long>();
            Dictionary<string, List<long>> SupplierEmailId = new Dictionary<string, List<long>>();
            List<string> Suppliername = new List<string>();

            List<WorkflowStatus> LstWorkflowStatus = GetAllWorkflowStatus_V2301(connectionStringWorkbench);
            List<WorkflowTransition> LstWorkflowStatusTransitions = GetAllWorkflowTransitions_V2301(connectionStringWorkbench);
            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionstring))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetPendingPurchaseOrdersByWarehouse_V2410", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdWarehouse", idWarehouse);
                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    double totalQuantity = 0;
                    double receivedQuantity = 0;
                    while (mySqlDataReader.Read())
                    {
                        try
                        {
                            totalQuantity = 0;
                            receivedQuantity = 0;
                            WarehousePurchaseOrder warehousePurchaseOrder = new WarehousePurchaseOrder();
                            try
                            {
                                warehousePurchaseOrder.IdWarehousePurchaseOrder = Convert.ToInt64(mySqlDataReader["idWarehousepurchaseorder"]);
                                if (mySqlDataReader["Code"] != DBNull.Value)
                                    warehousePurchaseOrder.Code = Convert.ToString(mySqlDataReader["Code"]);
                                if (mySqlDataReader["IdArticleSupplier"] != DBNull.Value)
                                {
                                    ArticleSupplier articleSupplier = new ArticleSupplier();
                                    articleSupplier.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);
                                    if (mySqlDataReader["Supplier"] != DBNull.Value)
                                        articleSupplier.Name = Convert.ToString(mySqlDataReader["Supplier"]);
                                    if (mySqlDataReader["IdCountry"] != DBNull.Value)
                                    {
                                        articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["IdCountry"]);
                                        articleSupplier.Country = new Country();
                                        articleSupplier.Country.IdCountry = Convert.ToByte(mySqlDataReader["IdCountry"]);
                                        articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);
                                        if (mySqlDataReader["CountryISO"] != DBNull.Value)
                                        {
                                            articleSupplier.Country.Iso = Convert.ToString(mySqlDataReader["CountryISO"]);
                                            articleSupplier.Country.CountryIconUrl = "https://api.emdep.com/GEOS/Images?FilePath=/Images/Countries/" + articleSupplier.Country.Iso + ".png";
                                            //if (!countryISOs.Any(co => co.ToString() == articleSupplier.Country.Iso))
                                            //{
                                            //    countryISOs.Add(articleSupplier.Country.Iso);
                                            //}
                                        }
                                    }
                                    if (mySqlDataReader["SupplierContactPerson"] != DBNull.Value)
                                        articleSupplier.ContactPerson = Convert.ToString(mySqlDataReader["SupplierContactPerson"]);
                                    if (mySqlDataReader["SupplierContactEmail"] != DBNull.Value)
                                        articleSupplier.ContactEmail = Convert.ToString(mySqlDataReader["SupplierContactEmail"]);
                                    warehousePurchaseOrder.ArticleSupplier = articleSupplier;
                                }
                                //[rdixit][GEOS2-4455][19.06.2023]
                                //if (mySqlDataReader["DeliveryDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["deliveryDate"]) != DateTime.MinValue)
                                //{
                                //warehousePurchaseOrder.DeliveryDate = Convert.ToDateTime(mySqlDataReader["deliveryDate"]);
                                //warehousePurchaseOrder.Delay = (int)(warehousePurchaseOrder.DeliveryDate.Value.Date - DateTime.Now.Date).TotalDays;
                                //}
                                if (mySqlDataReader["AttachedPO"] != DBNull.Value)
                                    warehousePurchaseOrder.AttachedPO = Convert.ToByte(mySqlDataReader["AttachedPO"]);
                                if (mySqlDataReader["Deliveries"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.Deliveries = Convert.ToInt32(mySqlDataReader["Deliveries"]);
                                    if (warehousePurchaseOrder.Deliveries > 0)
                                    {
                                        warehousePurchaseOrder.IsPartialPending = true;
                                    }
                                }
                                if (mySqlDataReader["LatestDeliveryDate"] != DBNull.Value)
                                    warehousePurchaseOrder.LatestDeliveryDate = Convert.ToDateTime(mySqlDataReader["LatestDeliveryDate"]);
                                if (mySqlDataReader["IdWarehouse"] != DBNull.Value)
                                    warehousePurchaseOrder.IdWarehouse = Convert.ToInt64(mySqlDataReader["IdWarehouse"]);
                                if (mySqlDataReader["OrderQty"] != DBNull.Value)
                                    totalQuantity = Convert.ToDouble(mySqlDataReader["OrderQty"]);
                                if (mySqlDataReader["ReceivedQuantity"] != DBNull.Value)
                                    receivedQuantity = Convert.ToDouble(mySqlDataReader["ReceivedQuantity"]);
                                if (totalQuantity > 0)
                                    warehousePurchaseOrder.Status = (Int16)((receivedQuantity / totalQuantity) * 100);
                                if (mySqlDataReader["TotalAmount"] != DBNull.Value)
                                    warehousePurchaseOrder.TotalAmount = Convert.ToDecimal(mySqlDataReader["TotalAmount"]);
                                if (mySqlDataReader["CreatedIn"] != DBNull.Value)
                                    warehousePurchaseOrder.CreatedIn = Convert.ToDateTime(mySqlDataReader["CreatedIn"]);
                                if (mySqlDataReader["AttachPdf"] != DBNull.Value)
                                    warehousePurchaseOrder.AttachPdf = Convert.ToString(mySqlDataReader["AttachPdf"]);
                                if (mySqlDataReader["idCurrency"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.IdCurrency = Convert.ToByte(mySqlDataReader["idCurrency"]);
                                    warehousePurchaseOrder.Currency = new Currency();
                                    warehousePurchaseOrder.Currency.IdCurrency = Convert.ToByte(mySqlDataReader["idCurrency"]);
                                    warehousePurchaseOrder.Currency.Name = Convert.ToString(mySqlDataReader["CurrencyName"]);
                                    warehousePurchaseOrder.Currency.Symbol = Convert.ToString(mySqlDataReader["CurrencySymbol"]);
                                }
                                if (mySqlDataReader["IdWorkflowStatus"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                    warehousePurchaseOrder.WorkflowStatus = new WorkflowStatus();
                                    warehousePurchaseOrder.WorkflowStatus.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                    warehousePurchaseOrder.WorkflowStatus.Name = Convert.ToString(mySqlDataReader["Status"]);
                                    warehousePurchaseOrder.WorkflowStatus.HtmlColor = Convert.ToString(mySqlDataReader["HtmlColor"]);


                                    //[pramod.misal][GEOS2-4448][06-07-2023]
                                    if (mySqlDataReader["SortOrder"] != DBNull.Value)
                                    {
                                        warehousePurchaseOrder.WorkflowStatus.SortOrder = Convert.ToInt32(mySqlDataReader["SortOrder"]);
                                    }

                                }
                                if (mySqlDataReader["AssigneeEmail"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.AssigneeEmail = Convert.ToString(mySqlDataReader["AssigneeEmail"]);
                                }
                                if (mySqlDataReader["CreatorEmail"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.CreatorEmail = Convert.ToString(mySqlDataReader["CreatorEmail"]);
                                }

                                if (mySqlDataReader["ReminderEmailDate"] != DBNull.Value)
                                    warehousePurchaseOrder.ReminderEmailDate = Convert.ToDateTime(mySqlDataReader["ReminderEmailDate"]);

                                if (mySqlDataReader["WarehouseName"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.WarehouseName = Convert.ToString(mySqlDataReader["WarehouseName"]);
                                }


                                warehousePurchaseOrder.LstWorkflowStatus = LstWorkflowStatus;
                                List<byte> GetCurrentButtons = LstWorkflowStatusTransitions.Where(a => a.IdWorkflowStatusFrom == warehousePurchaseOrder.IdWorkflowStatus).Select(a => a.IdWorkflowStatusTo).Distinct().ToList();
                                warehousePurchaseOrder.LstWorkflowStatusTransition = new List<WorkflowStatus>();
                                warehousePurchaseOrder.LstWorkflowStatusTransition.Add(warehousePurchaseOrder.LstWorkflowStatus.FirstOrDefault(a => a.IdWorkflowStatus == warehousePurchaseOrder.IdWorkflowStatus));
                                foreach (byte statusbutton in GetCurrentButtons)
                                {
                                    warehousePurchaseOrder.LstWorkflowStatusTransition.Add(warehousePurchaseOrder.LstWorkflowStatus.FirstOrDefault(a => a.IdWorkflowStatus == statusbutton));
                                }
                            }
                            catch (Exception ex)
                            {
                            }
                            warehousePurchaseOrder.LstAllWorkflowStatusTransitions = LstWorkflowStatusTransitions;
                            warehousePurchaseOrders.Add(warehousePurchaseOrder);

                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetPendingPurchaseOrdersByWarehouse_V2400(). ErrorMessage-" + ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                    #region 2nd ResultSet [rdixit][GEOS2-4455][19.06.2023] 
                    if (mySqlDataReader.NextResult())
                    {
                        while (mySqlDataReader.Read())
                        {
                            if (mySqlDataReader["idWarehousePurchaseOrder"] != DBNull.Value)
                            {
                                WarehousePurchaseOrderItem OrderItem = new WarehousePurchaseOrderItem();

                                WarehousePurchaseOrder Order = warehousePurchaseOrders.FirstOrDefault(i => i.IdWarehousePurchaseOrder == Convert.ToInt64(mySqlDataReader["idWarehousePurchaseOrder"]));
                                if (Order != null)
                                {
                                    if (Order.WarehousePurchaseOrderItems == null)
                                    {
                                        Order.WarehousePurchaseOrderItems = new List<WarehousePurchaseOrderItem>();
                                    }
                                    if (mySqlDataReader["idWarehousePurchaseOrder"] != DBNull.Value)
                                        OrderItem.IdWarehousePurchaseOrder = Convert.ToInt64(mySqlDataReader["idWarehousePurchaseOrder"]);
                                    if (mySqlDataReader["IdWarehousePurchaseOrderItem"] != DBNull.Value)
                                        OrderItem.IdWarehousePurchaseOrderItem = Convert.ToInt64(mySqlDataReader["IdWarehousePurchaseOrderItem"]);
                                    if (mySqlDataReader["Quantity"] != DBNull.Value)
                                        OrderItem.Quantity = Convert.ToDouble(mySqlDataReader["Quantity"]);
                                    if (mySqlDataReader["AlbaranQty"] != DBNull.Value)
                                        OrderItem.ReceivedQuantity = Convert.ToDouble(mySqlDataReader["AlbaranQty"]);
                                    if (OrderItem.Quantity > 0)
                                        OrderItem.Status = (Int16)((OrderItem.ReceivedQuantity / OrderItem.Quantity) * 100);
                                    Order.WarehousePurchaseOrderItems.Add(OrderItem);
                                }
                            }
                        }
                    }
                    #endregion
                    #region 3nd ResultSet [rdixit][GEOS2-4455][19.06.2023] 
                    if (mySqlDataReader.NextResult())
                    {
                        while (mySqlDataReader.Read())
                        {
                            if (mySqlDataReader["IdWarehousePurchaseOrderItem"] != DBNull.Value)
                            {
                                WarehousePurchaseOrderExpectedItem OrderExpectedItem = new WarehousePurchaseOrderExpectedItem();

                                WarehousePurchaseOrderItem OrderItem = warehousePurchaseOrders.Where(o => o.WarehousePurchaseOrderItems != null)
                                                                        .SelectMany(order => order.WarehousePurchaseOrderItems)
                                                                        .FirstOrDefault(item => item.IdWarehousePurchaseOrderItem == Convert.ToInt64(mySqlDataReader["IdWarehousePurchaseOrderItem"]));
                                if (OrderItem != null)
                                {
                                    if (OrderItem.WarehousePurchaseOrderExpectedItems == null)
                                    {
                                        OrderItem.WarehousePurchaseOrderExpectedItems = new List<WarehousePurchaseOrderExpectedItem>();
                                    }
                                    if (mySqlDataReader["IdWarehousePurchaseOrderItem"] != DBNull.Value)
                                        OrderExpectedItem.IdWarehousePurchaseOrderItem = Convert.ToInt64(mySqlDataReader["IdWarehousePurchaseOrderItem"]);
                                    if (mySqlDataReader["Quantity"] != DBNull.Value)
                                        OrderExpectedItem.Quantity = (long)Convert.ToDouble(mySqlDataReader["Quantity"]);
                                    if (mySqlDataReader["Date"] != DBNull.Value)
                                        OrderExpectedItem.Date = Convert.ToDateTime(mySqlDataReader["Date"]);

                                    OrderItem.WarehousePurchaseOrderExpectedItems.Add(OrderExpectedItem);
                                }
                            }
                        }
                    }
                    #endregion
                }
            }
            #region 2nd ResultSet [rdixit][GEOS2-4455][19.06.2023] 
            foreach (WarehousePurchaseOrder Order in warehousePurchaseOrders)
            {
                List<DateTime> ItemDates = new List<DateTime>();
                if (Order.WarehousePurchaseOrderItems != null)
                {
                    if (Order.WarehousePurchaseOrderItems.Where(i => i.Status < 100) != null)
                    {
                        if (Order.WarehousePurchaseOrderItems.Where(i => i.Status < 100).ToList().Count > 0)
                        {
                            foreach (WarehousePurchaseOrderItem OrderItem in Order.WarehousePurchaseOrderItems.Where(i => i.Status != 100))
                            {
                                if (OrderItem.WarehousePurchaseOrderExpectedItems != null)
                                {
                                    if (OrderItem.WarehousePurchaseOrderExpectedItems.Count > 0)
                                        ItemDates.Add(OrderItem.WarehousePurchaseOrderExpectedItems.FirstOrDefault().Date);
                                }
                            }
                        }
                    }
                }
                if (ItemDates.Count != 0)
                {
                    Order.DeliveryDate = ItemDates.Min(d => d.Date).Date;
                    Order.Delay = (int)(Order.DeliveryDate.Value.Date - DateTime.Now.Date).TotalDays;

                    if (!string.IsNullOrEmpty(Order.ArticleSupplier.ContactEmail))
                    {
                        if (Order.ReminderEmailDate == DateTime.MinValue || Order.ReminderEmailDate == null)
                        {
                            Order.ReminderEmailDate = Order.DeliveryDate.Value.AddDays(1);
                        }
                        DateTime dtRm = new DateTime(Order.ReminderEmailDate.Value.Year, Order.ReminderEmailDate.Value.Month, Order.ReminderEmailDate.Value.Day);
                        DateTime dtNow = new DateTime(DateTime.Now.Year, DateTime.Now.Month, DateTime.Now.Day);
                        if (dtRm <= dtNow)
                        {
                            orderid = new List<long>();
                            orderid.Add(Order.IdWarehousePurchaseOrder);
                            if (!SupplierEmailId.ContainsKey(Order.ArticleSupplier.ContactEmail))
                            {
                                SupplierEmailId.Add(Order.ArticleSupplier.ContactEmail, orderid);
                            }
                            else
                            {
                                SupplierEmailId[Order.ArticleSupplier.ContactEmail].Add(Order.IdWarehousePurchaseOrder);
                            }
                        }
                    }
                    else
                    {
                        if (!Suppliername.Contains(Order.ArticleSupplier.Name))
                        {
                            Suppliername.Add(Order.ArticleSupplier.Name);
                        }
                    }
                }
            }
            #endregion
            //foreach (string item in countryISOs)
            //{
            //    byte[] bytes = null;
            //    bytes = GetCountryIconFileInBytes(item, countryIconFilePath);
            //    warehousePurchaseOrders.Where(wp => wp.ArticleSupplier.Country.Iso == item).ToList().ForEach(wp => wp.ArticleSupplier.Country.CountryIconBytes = bytes);
            //}
            if (warehousePurchaseOrders.Count > 0)
            {
                warehousePurchaseOrders.FirstOrDefault().SupplierEmailId = SupplierEmailId;
                warehousePurchaseOrders.FirstOrDefault().Suppliername = Suppliername;
            }
            return warehousePurchaseOrders;
        }

        //[pramod.misal][GEOS2-4449][04-06-2023]
        public WarehousePurchaseOrder GetPendingPOByIdWarehousePurchaseOrder_V2410(string connectionString, Int64 idWarehousePurchaseOrder, string purchaseOrdersPath, string emailTemplatePath, string countryIconFilePath)
        {
            WarehousePurchaseOrder warehousePurchaseOrder = null;

            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetPendingPOByIdWarehousePurchaseOrder_V2410", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", idWarehousePurchaseOrder);

                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    if (mySqlDataReader.Read())
                    {
                        try
                        {
                            warehousePurchaseOrder = new WarehousePurchaseOrder();

                            warehousePurchaseOrder.IdWarehousePurchaseOrder = idWarehousePurchaseOrder;

                            if (mySqlDataReader["Code"] != DBNull.Value)
                                warehousePurchaseOrder.Code = Convert.ToString(mySqlDataReader["Code"]);

                            if (mySqlDataReader["IdArticleSupplier"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                                ArticleSupplier articleSupplier = new ArticleSupplier();
                                articleSupplier.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                                if (mySqlDataReader["Supplier"] != DBNull.Value)
                                    articleSupplier.Name = Convert.ToString(mySqlDataReader["Supplier"]);

                                if (mySqlDataReader["SupplierContactPerson"] != DBNull.Value)
                                    articleSupplier.ContactPerson = Convert.ToString(mySqlDataReader["SupplierContactPerson"]);

                                if (mySqlDataReader["SupplierContactEmail"] != DBNull.Value)
                                    articleSupplier.ContactEmail = Convert.ToString(mySqlDataReader["SupplierContactEmail"]);

                                if (mySqlDataReader["Serie"] != DBNull.Value)
                                    articleSupplier.Serie = Convert.ToChar(mySqlDataReader["Serie"]);

                                if (mySqlDataReader["IdCountry"] != DBNull.Value)
                                {
                                    articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["IdCountry"]);

                                    articleSupplier.Country = new Country();
                                    articleSupplier.Country.IdCountry = (byte)articleSupplier.IdCountry;
                                    articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);

                                    if (mySqlDataReader["SupplierCountryISO"] != DBNull.Value)
                                    {
                                        articleSupplier.Country.Iso = Convert.ToString(mySqlDataReader["SupplierCountryISO"]);
                                        byte[] bytes = null;
                                        bytes = GetCountryIconFileInBytes(articleSupplier.Country.Iso, countryIconFilePath);
                                        articleSupplier.Country.CountryIconBytes = bytes;
                                    }

                                    if (mySqlDataReader["IdCountryGroup"] != DBNull.Value)
                                        articleSupplier.Country.IdCountryGroup = Convert.ToInt64(mySqlDataReader["IdCountryGroup"]);
                                }

                                if (mySqlDataReader["IdArticleSupplierType"] != DBNull.Value)
                                {
                                    articleSupplier.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["IdArticleSupplierType"]);

                                    articleSupplier.ArticleSupplierType = new ArticleSupplierType();
                                    articleSupplier.ArticleSupplierType.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["IdArticleSupplierType"]);
                                    articleSupplier.ArticleSupplierType.Name = Convert.ToString(mySqlDataReader["ArticleSupplierType"]);
                                    articleSupplier.ArticleSupplierType.HtmlColor = Convert.ToString(mySqlDataReader["HtmlColor"]);
                                }

                                warehousePurchaseOrder.ArticleSupplier = articleSupplier;
                            }
                            //[rdixit][GEOS2-4455][28.06.2023] 
                            //if (mySqlDataReader["DeliveryDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["deliveryDate"]) != DateTime.MinValue)
                            //{
                            //    warehousePurchaseOrder.DeliveryDate = Convert.ToDateTime(mySqlDataReader["deliveryDate"]);
                            //}

                            if (mySqlDataReader["AttachedPO"] != DBNull.Value)
                                warehousePurchaseOrder.AttachedPO = Convert.ToByte(mySqlDataReader["AttachedPO"]);

                            if (mySqlDataReader["IdPaymentType"] != DBNull.Value)
                                warehousePurchaseOrder.IdPaymentType = Convert.ToInt64(mySqlDataReader["IdPaymentType"]);

                            if (mySqlDataReader["ReminderEmailDate"] != DBNull.Value)
                                warehousePurchaseOrder.ReminderEmailDate = Convert.ToDateTime(mySqlDataReader["ReminderEmailDate"]);

                            if (mySqlDataReader["CreatedIn"] != DBNull.Value)
                                warehousePurchaseOrder.CreatedIn = Convert.ToDateTime(mySqlDataReader["CreatedIn"]);

                            if (mySqlDataReader["ModifiedIn"] != DBNull.Value)
                                warehousePurchaseOrder.ModifiedIn = Convert.ToDateTime(mySqlDataReader["ModifiedIn"]);

                            if (mySqlDataReader["Comments"] != DBNull.Value)
                                warehousePurchaseOrder.Comments = Convert.ToString(mySqlDataReader["Comments"]);

                            //[pramod.misal][GEOS2-4449][04-06-2023]warehouseShippingAddress
                            if (mySqlDataReader["Observations"] != DBNull.Value)
                                warehousePurchaseOrder.SupplierComments = Convert.ToString(mySqlDataReader["Observations"]);

                            // create a new Sp and  read feilds related to shipping address




                            if (mySqlDataReader["IsClosed"] != DBNull.Value)
                                warehousePurchaseOrder.IsClosed = Convert.ToByte(mySqlDataReader["IsClosed"]);

                            if (mySqlDataReader["CreatedBy"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.CreatedBy = Convert.ToInt64(mySqlDataReader["CreatedBy"]);
                                warehousePurchaseOrder.Creator = new People();
                                warehousePurchaseOrder.Creator.IdPerson = Convert.ToInt32(mySqlDataReader["CreatedBy"].ToString());
                                warehousePurchaseOrder.Creator.Name = mySqlDataReader["CreatorName"].ToString();
                                warehousePurchaseOrder.Creator.Surname = mySqlDataReader["CreatorSurname"].ToString();
                            }

                            if (mySqlDataReader["ModifiedBy"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.ModifiedBy = Convert.ToInt64(mySqlDataReader["ModifiedBy"]);
                                warehousePurchaseOrder.Modifier = new People();
                                warehousePurchaseOrder.Modifier.IdPerson = Convert.ToInt32(mySqlDataReader["ModifiedBy"].ToString());
                                warehousePurchaseOrder.Modifier.Name = mySqlDataReader["ModifierName"].ToString();
                                warehousePurchaseOrder.Modifier.Surname = mySqlDataReader["ModifierSurname"].ToString();
                            }

                            if (mySqlDataReader["ReasonClosed"] != DBNull.Value)
                                warehousePurchaseOrder.ReasonClosed = Convert.ToString(mySqlDataReader["ReasonClosed"]);

                            if (mySqlDataReader["IdWarehouse"] != DBNull.Value)
                                warehousePurchaseOrder.IdWarehouse = Convert.ToInt64(mySqlDataReader["IdWarehouse"]);

                            if (mySqlDataReader["IdCurrency"] != DBNull.Value)
                                warehousePurchaseOrder.IdCurrency = Convert.ToByte(mySqlDataReader["IdCurrency"]);

                            if (mySqlDataReader["IdWorkflowStatus"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                warehousePurchaseOrder.WorkflowStatus = new WorkflowStatus();
                                warehousePurchaseOrder.WorkflowStatus.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                warehousePurchaseOrder.WorkflowStatus.Name = Convert.ToString(mySqlDataReader["Status"]);
                                warehousePurchaseOrder.WorkflowStatus.HtmlColor = Convert.ToString(mySqlDataReader["StatusHtmlColor"]);
                            }

                            if (mySqlDataReader["IdAssignee"] != DBNull.Value)
                                warehousePurchaseOrder.IdAssignee = Convert.ToUInt32(mySqlDataReader["IdAssignee"]);

                            if (mySqlDataReader["IdApprover"] != DBNull.Value)
                                warehousePurchaseOrder.IdApprover = Convert.ToUInt32(mySqlDataReader["IdApprover"]);

                            if (mySqlDataReader["AssigneeEmail"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.AssigneeEmail = Convert.ToString(mySqlDataReader["AssigneeEmail"]);
                            }
                            if (mySqlDataReader["CreatorEmail"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.CreatorEmail = Convert.ToString(mySqlDataReader["CreatorEmail"]);
                            }

                            string HTMLFileName = null;
                            if (File.Exists(string.Format("{0}{1}SupplierPurchaseOrderRequestMailFormat_{2}-{3}.html", emailTemplatePath, @"\", warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower(), warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToUpper())))
                            {
                                HTMLFileName = string.Format("SupplierPurchaseOrderRequestMailFormat_{0}-{1}.html", warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower(), warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToUpper());
                            }
                            else if (File.Exists(string.Format("{0}{1}SupplierPurchaseOrderRequestMailFormat.html", emailTemplatePath, @"\")))
                            {
                                HTMLFileName = "SupplierPurchaseOrderRequestMailFormat.html";
                            }
                            if (HTMLFileName != null)
                            {
                                StringBuilder emailbody = new StringBuilder();
                                string text = ReadMailTemplate(HTMLFileName, emailTemplatePath);

                                if (string.IsNullOrEmpty(warehousePurchaseOrder.ArticleSupplier.ContactPerson))
                                {
                                    text = text.Replace("[Supplier_Name]", "Supplier");
                                }
                                else
                                {
                                    text = text.Replace("[Supplier_Name]", warehousePurchaseOrder.ArticleSupplier.ContactPerson);
                                }
                                text = text.Replace("[PO_Code]", warehousePurchaseOrder.Code);

                                emailbody.Append(text);

                                warehousePurchaseOrder.EmailBody = emailbody.ToString();
                            }
                            warehousePurchaseOrder.AttachPdf = warehousePurchaseOrder.CreatedIn.Year + @"\" + warehousePurchaseOrder.Code + @"\01 Purchase Order\PO_" + warehousePurchaseOrder.Code + ".pdf";

                            warehousePurchaseOrder.AttachmentBytes = GetPurchaseOrderPdf(purchaseOrdersPath, warehousePurchaseOrder.AttachPdf);
                            warehousePurchaseOrder.WarehouseDeliveryNotes = GetDeliveryNotesByIdWarehousePurchaseOrder(connectionString, warehousePurchaseOrder, purchaseOrdersPath);

                            warehousePurchaseOrder.WarehousePurchaseOrderItemWithComments = GetArticlesByIdWarehousePurchaseOrder_V2300(connectionString, warehousePurchaseOrder.IdWarehousePurchaseOrder);

                            warehousePurchaseOrder.WarehousePOComments = GetlogEntriesByWarehousePO_V2400(idWarehousePurchaseOrder, 252, connectionString);
                            warehousePurchaseOrder.WarehousePOLogEntries = GetlogEntriesByWarehousePO_V2400(idWarehousePurchaseOrder, 253, connectionString);

                            //[rdixit][GEOS2-4455][28.06.2023] 
                            List<DateTime> ItemDates = new List<DateTime>();
                            if (warehousePurchaseOrder.WarehousePurchaseOrderItemWithComments != null)
                            {
                                if (warehousePurchaseOrder.WarehousePurchaseOrderItemWithComments.Where(i => i.Status < 100) != null)
                                {
                                    if (warehousePurchaseOrder.WarehousePurchaseOrderItemWithComments.Where(i => i.Status < 100).ToList().Count > 0)
                                        foreach (var item in warehousePurchaseOrder.WarehousePurchaseOrderItemWithComments.Where(i => i.Status < 100))
                                        {
                                            if (item.WarehousePurchaseOrderExpectedItems != null)
                                            {
                                                if (item.WarehousePurchaseOrderExpectedItems.Count > 0)
                                                    ItemDates.Add(item.WarehousePurchaseOrderExpectedItems.FirstOrDefault().Date);
                                            }
                                        }
                                }
                            }
                            if (ItemDates.Count > 0)
                                warehousePurchaseOrder.DeliveryDate = ItemDates.Min(d => d.Date).Date;
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetPendingPOByIdWarehousePurchaseOrder_V2400(idWarehousePurchaseOrder-{0}), ErrorMessage- {1} ", idWarehousePurchaseOrder, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            return warehousePurchaseOrder;
        }

        //[GEOS2-4453][21.07.2023][rdixit]
        public WarehousePurchaseOrder GetOfferExportChart(int IdPo, int idWarehouse, string connectionString, string poExcelTemplatePath)
        {
            Dictionary<string, WarehousePurchaseOrder> Result = new Dictionary<string, WarehousePurchaseOrder>();
            byte[] bytes = null;
            WarehousePurchaseOrder po = new WarehousePurchaseOrder();
            string defaultFileName = @"\SupplierPO.xlsx";

            string companyFileName = string.Format("{0}{1}{2}{3}", @"\", IdPo, "_", "SupplierPO.xlsx");
            #region Template file get Method
            try
            {
                if (File.Exists(string.Format("{0}{1}", poExcelTemplatePath, companyFileName)))
                {
                    using (System.IO.FileStream stream = new System.IO.FileStream(string.Format("{0}{1}", poExcelTemplatePath, companyFileName), System.IO.FileMode.Open, System.IO.FileAccess.Read))
                    {
                        bytes = new byte[stream.Length];
                        int numBytesToRead = (int)stream.Length;
                        int numBytesRead = 0;

                        while (numBytesToRead > 0)
                        {
                            // Read may return anything from 0 to numBytesToRead.
                            int n = stream.Read(bytes, numBytesRead, numBytesToRead);

                            // Break when the end of the file is reached.
                            if (n == 0)
                                break;

                            numBytesRead += n;
                            numBytesToRead -= n;
                        }
                    }
                }
                else if (File.Exists(string.Format("{0}{1}", poExcelTemplatePath, defaultFileName)))
                {
                    using (System.IO.FileStream stream = new System.IO.FileStream(string.Format("{0}{1}", poExcelTemplatePath, defaultFileName), System.IO.FileMode.Open, System.IO.FileAccess.Read))
                    {
                        bytes = new byte[stream.Length];
                        int numBytesToRead = (int)stream.Length;
                        int numBytesRead = 0;

                        while (numBytesToRead > 0)
                        {
                            // Read may return anything from 0 to numBytesToRead.
                            int n = stream.Read(bytes, numBytesRead, numBytesToRead);

                            // Break when the end of the file is reached.
                            if (n == 0)
                                break;

                            numBytesRead += n;
                            numBytesToRead -= n;
                        }
                    }
                }


            }
            catch (FileNotFoundException ex)
            {

            }
            catch (DirectoryNotFoundException ex)
            {

            }
            catch (Exception ex)
            {

            }
            #endregion
            if (bytes != null)
            {

                po.Templatefilebytes = bytes;
                using (MySqlConnection conn = new MySqlConnection(connectionString))
                {
                    conn.Open();
                    MySqlCommand command = new MySqlCommand("SRM_PurchasingOrdersExport", conn);
                    command.CommandType = CommandType.StoredProcedure;
                    command.Parameters.AddWithValue("_IdPo", IdPo);
                    command.Parameters.AddWithValue("_IdWarehouse", idWarehouse);
                    using (MySqlDataReader dr = command.ExecuteReader())
                    {
                        #region dr.Read
                        if (dr.Read())
                        {
                            po.IdWarehousePurchaseOrder = IdPo;
                            if (dr["Code"] != DBNull.Value)
                            {
                                po.Code = Convert.ToString(dr["Code"]);
                            }
                            if (dr["PODate"] != DBNull.Value)
                            {
                                po.CreatedIn = Convert.ToDateTime(dr["PODate"]);
                            }
                            if (dr["DeliveryDate"] != DBNull.Value)
                            {
                                po.DeliveryDate = Convert.ToDateTime(dr["DeliveryDate"]);
                            }
                            if (dr["Warehouse"] != DBNull.Value)
                            {
                                po.WarehouseName = Convert.ToString(dr["Warehouse"]);
                            }
                            if (dr["DEAddress"] != DBNull.Value)
                            {
                                po.DEAddress = Convert.ToString(dr["DEAddress"]);
                            }
                            if (dr["DEPostCode"] != DBNull.Value)
                            {
                                po.DEPostCode = Convert.ToString(dr["DEPostCode"]);
                            }
                            if (dr["DETelephone"] != DBNull.Value)
                            {
                                po.DETelephone = Convert.ToString(dr["DETelephone"]);
                            }
                            if (dr["DECity"] != DBNull.Value)
                            {
                                po.DECity = Convert.ToString(dr["DECity"]);
                            }
                            if (dr["DeliveryAddressCountry"] != DBNull.Value)
                            {
                                po.DeliveryAddressCountry = Convert.ToString(dr["DeliveryAddressCountry"]);
                            }
                            if (dr["SUPCity"] != DBNull.Value)
                            {
                                po.ArticleSupplier = new ArticleSupplier();
                                po.ArticleSupplier.City = Convert.ToString(dr["SUPCity"]);
                            }
                            if (dr["SUPPostCode"] != DBNull.Value)
                            {
                                po.ArticleSupplier.PostCode = Convert.ToString(dr["SUPPostCode"]);
                            }
                            if (dr["SUPAddress"] != DBNull.Value)
                            {
                                po.ArticleSupplier.Address = Convert.ToString(dr["SUPAddress"]);
                            }
                            if (dr["SUPName"] != DBNull.Value)
                            {
                                po.ArticleSupplier.Name = Convert.ToString(dr["SUPName"]);
                            }
                            if (dr["SUPPhone"] != DBNull.Value)
                            {
                                po.ArticleSupplier.Phone1 = Convert.ToString(dr["SUPPhone"]);
                            }
                            if (dr["SUPContactEmail"] != DBNull.Value)
                            {
                                po.ArticleSupplier.ContactEmail = Convert.ToString(dr["SUPContactEmail"]);
                            }
                            if (dr["SUPContactMobile"] != DBNull.Value)
                            {
                                po.ArticleSupplier.Phone2 = Convert.ToString(dr["SUPContactMobile"]);
                            }
                            if (dr["SUPContactPerson"] != DBNull.Value)
                            {
                                po.ArticleSupplier.ContactPerson = Convert.ToString(dr["SUPContactPerson"]);
                            }
                            if (dr["SUPCountry"] != DBNull.Value)
                            {
                                po.ArticleSupplier.Country = new Country();
                                po.ArticleSupplier.Country.Name = Convert.ToString(dr["SUPCountry"]);
                            }
                            if (dr["SupplierState"] != DBNull.Value)
                            {
                                po.ArticleSupplier.Country = new Country();
                                po.ArticleSupplier.Country.State = Convert.ToString(dr["SupplierState"]);
                            }

                            if (dr["DeliveryAddressState"] != DBNull.Value)
                            {
                                po.DeliveryAddressState = Convert.ToString(dr["DeliveryAddressState"]);
                            }
                            if (dr["Remarks"] != DBNull.Value)
                            {
                                po.Remarks = Convert.ToString(dr["Remarks"]);
                            }
                            if (dr["PurchasingContactName"] != DBNull.Value)
                            {
                                po.PurchasingContactName = Convert.ToString(dr["PurchasingContactName"]);
                            }
                            if (dr["PurchasingContactEmail"] != DBNull.Value)
                            {
                                po.PurchasingContactEmail = Convert.ToString(dr["PurchasingContactEmail"]);
                            }
                            if (dr["PlantCity"] != DBNull.Value)
                            {
                                po.Warehouse = new Warehouses();
                                po.Warehouse.Company = new Company();
                                po.Warehouse.Company.City = Convert.ToString(dr["PlantCity"]);
                            }
                            if (dr["PlantPhone"] != DBNull.Value)
                            {
                                po.Warehouse.Company.Telephone = Convert.ToString(dr["PlantPhone"]);
                            }
                            if (dr["PlantRegistrationNumber"] != DBNull.Value)
                            {
                                po.Warehouse.Company.RegisteredNumber = Convert.ToString(dr["PlantRegistrationNumber"]);
                            }
                            if (dr["PlantStreet"] != DBNull.Value)
                            {
                                po.Warehouse.Company.Address = Convert.ToString(dr["PlantStreet"]);
                            }
                            if (dr["PlantZipCode"] != DBNull.Value)
                            {
                                po.Warehouse.Company.ZipCode = Convert.ToString(dr["PlantZipCode"]);
                            }
                            if (dr["PlantRegisteredName"] != DBNull.Value)
                            {
                                po.Warehouse.Company.RegisteredName = Convert.ToString(dr["PlantRegisteredName"]);
                            }
                            if (dr["PlantState"] != DBNull.Value)
                            {
                                po.Warehouse.Company.Country = new Country();
                                po.Warehouse.Company.Country.State = Convert.ToString(dr["PlantState"]);
                            }
                            if (dr["PlantCountry"] != DBNull.Value)
                            {
                                po.Warehouse.Company.Country.Name = Convert.ToString(dr["PlantCountry"]);
                            }
                            if (dr["year"] != DBNull.Value)
                            {
                                po.Year = Convert.ToString(dr["year"]);
                            }
                            if (dr["Incoterms"] != DBNull.Value)
                            {
                                po.Incoterms = Convert.ToString(dr["Incoterms"]);
                            }
                            if (dr["Remarks"] != DBNull.Value)
                            {
                                po.Remarks = Convert.ToString(dr["Remarks"]);
                            }
                            if (dr["PaymentTerms"] != DBNull.Value)
                            {
                                po.PaymentTerms = Convert.ToString(dr["PaymentTerms"]);
                            }
                            if (dr["SupplierNotes"] != DBNull.Value)
                            {
                                po.SupplierComments = Convert.ToString(dr["SupplierNotes"]);
                            }
                            if (dr["CurrencyName"] != DBNull.Value)
                            {
                                po.Currency = new Currency();
                                po.Currency.Name = Convert.ToString(dr["CurrencyName"]);
                            }
                            if (dr["Observations"] != DBNull.Value)
                            {
                                po.Comments = Convert.ToString(dr["Observations"]);
                            }
                        }
                        #endregion
                        #region PurchasingOrdersItems                    
                        if (dr.NextResult())
                        {
                            po.WarehousePurchaseOrderItems = new List<WarehousePurchaseOrderItem>();
                            try
                            {
                                while (dr.Read())
                                {
                                    WarehousePurchaseOrderItem Item = new WarehousePurchaseOrderItem();
                                    if (dr["idWarehousePurchaseOrder"] != DBNull.Value)
                                    {
                                        if (po != null)
                                        {
                                            if (dr["idArticle"] != DBNull.Value)
                                            {
                                                Item.Article = new Article();
                                                Item.IdArticle = Convert.ToInt32(dr["idArticle"].ToString());
                                                Item.Article.IdArticle = Convert.ToInt32(dr["idArticle"].ToString());

                                                if (dr["Reference"] != DBNull.Value)
                                                {
                                                    Item.Article.Reference = Convert.ToString(dr["Reference"]);
                                                }
                                            }
                                            if (dr["Description"] != DBNull.Value)
                                            {
                                                Item.Description = Convert.ToString(dr["Description"]);
                                            }
                                            if (dr["Qty"] != DBNull.Value)
                                            {
                                                Item.Quantity = Convert.ToInt64(dr["Qty"].ToString());
                                            }
                                            if (dr["DiscountRate"] != DBNull.Value)
                                            {
                                                string discount = dr["DiscountRate"].ToString();
                                                Item.Discount = Convert.ToDouble(discount);
                                            }
                                            if (dr["UnitPrice"] != DBNull.Value)
                                            {
                                                if (Convert.ToDouble(dr["UnitPrice"]) == 0 && Convert.ToDouble(dr["DiscountRate"]) == 100)
                                                {
                                                    Item.UnitPrice = Convert.ToDouble(dr["UnitPrice"]);
                                                }
                                                else
                                                {
                                                    Item.UnitPrice = Convert.ToDouble(dr["UnitPrice"]);
                                                }
                                            }
                                            po.WarehousePurchaseOrderItems.Add(Item);
                                            if (Item.Discount != 0)
                                            {

                                                if (po.WarehousePurchaseOrderItems == null)
                                                    po.WarehousePurchaseOrderItems = new List<WarehousePurchaseOrderItem>();

                                                WarehousePurchaseOrderItem Items = new WarehousePurchaseOrderItem();
                                                if (dr["Description"] != DBNull.Value)
                                                {
                                                    Items.Description = "Discount";
                                                }
                                                if (dr["UnitPrice"] != DBNull.Value)
                                                {
                                                    if (Items.UnitPrice == 0 && Items.Discount == 100)
                                                    {
                                                        Items.UnitPrice = 0;
                                                    }
                                                    else
                                                    {
                                                        double discount = ((Items.UnitPrice * Items.Discount) / 100);
                                                        Items.UnitPrice = Math.Round((discount * Items.Quantity), 4, MidpointRounding.AwayFromZero);
                                                    }
                                                }
                                                if (dr["Qty"] != DBNull.Value)
                                                {
                                                    Items.Quantity = -1;
                                                }
                                                if (dr["DiscountRate"] != DBNull.Value)
                                                {
                                                    string discount = dr["DiscountRate"].ToString();
                                                    Items.Discount = Convert.ToDouble(discount);
                                                }
                                                po.WarehousePurchaseOrderItems.Add(Items);
                                            }

                                        }
                                    }
                                }
                                #endregion
                            }
                            catch (Exception ex)
                            {

                            }

                        }
                    }
                }
            }
            return po;
        }


        // [pramod.misal][GEOS2-4451][21-07-2023]
        public WarehousePurchaseOrder GetPendingPOByIdWarehousePurchaseOrder_V2420(string connectionString, Int64 idWarehousePurchaseOrder, string idShippingAddress, string purchaseOrdersPath, string emailTemplatePath, string countryIconFilePath)
        {
            WarehousePurchaseOrder warehousePurchaseOrder = null;

            Country country = new Country();
            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();
                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetPendingPOByIdWarehousePurchaseOrder_V2420", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", idWarehousePurchaseOrder);

                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    if (mySqlDataReader.Read())
                    {
                        try
                        {

                            warehousePurchaseOrder = new WarehousePurchaseOrder();
                            List<WarehouseShippingAddress> warehouseShippingAddresses = new List<WarehouseShippingAddress>();


                            warehousePurchaseOrder.IdWarehousePurchaseOrder = idWarehousePurchaseOrder;

                            if (mySqlDataReader["Code"] != DBNull.Value)
                                warehousePurchaseOrder.Code = Convert.ToString(mySqlDataReader["Code"]);

                            if (mySqlDataReader["IdArticleSupplier"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                                ArticleSupplier articleSupplier = new ArticleSupplier();
                                articleSupplier.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                                if (mySqlDataReader["Supplier"] != DBNull.Value)
                                    articleSupplier.Name = Convert.ToString(mySqlDataReader["Supplier"]);

                                if (mySqlDataReader["SupplierContactPerson"] != DBNull.Value)
                                    articleSupplier.ContactPerson = Convert.ToString(mySqlDataReader["SupplierContactPerson"]);

                                if (mySqlDataReader["SupplierContactEmail"] != DBNull.Value)
                                    articleSupplier.ContactEmail = Convert.ToString(mySqlDataReader["SupplierContactEmail"]);

                                if (mySqlDataReader["Serie"] != DBNull.Value)
                                    articleSupplier.Serie = Convert.ToChar(mySqlDataReader["Serie"]);

                                if (mySqlDataReader["IdCountry"] != DBNull.Value)
                                {
                                    articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["IdCountry"]);

                                    articleSupplier.Country = new Country();
                                    articleSupplier.Country.IdCountry = (byte)articleSupplier.IdCountry;
                                    articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);

                                    if (mySqlDataReader["SupplierCountryISO"] != DBNull.Value)
                                    {
                                        articleSupplier.Country.Iso = Convert.ToString(mySqlDataReader["SupplierCountryISO"]);
                                        byte[] bytes = null;
                                        bytes = GetCountryIconFileInBytes(articleSupplier.Country.Iso, countryIconFilePath);
                                        articleSupplier.Country.CountryIconBytes = bytes;
                                    }

                                    if (mySqlDataReader["IdCountryGroup"] != DBNull.Value)
                                        articleSupplier.Country.IdCountryGroup = Convert.ToInt64(mySqlDataReader["IdCountryGroup"]);
                                }

                                if (mySqlDataReader["IdArticleSupplierType"] != DBNull.Value)
                                {
                                    articleSupplier.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["IdArticleSupplierType"]);

                                    articleSupplier.ArticleSupplierType = new ArticleSupplierType();
                                    articleSupplier.ArticleSupplierType.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["IdArticleSupplierType"]);
                                    articleSupplier.ArticleSupplierType.Name = Convert.ToString(mySqlDataReader["ArticleSupplierType"]);
                                    articleSupplier.ArticleSupplierType.HtmlColor = Convert.ToString(mySqlDataReader["HtmlColor"]);
                                }

                                warehousePurchaseOrder.ArticleSupplier = articleSupplier;
                            }
                            //[rdixit][GEOS2-4455][28.06.2023] 
                            //if (mySqlDataReader["DeliveryDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["deliveryDate"]) != DateTime.MinValue)
                            //{
                            //    warehousePurchaseOrder.DeliveryDate = Convert.ToDateTime(mySqlDataReader["deliveryDate"]);
                            //}

                            if (mySqlDataReader["AttachedPO"] != DBNull.Value)
                                warehousePurchaseOrder.AttachedPO = Convert.ToByte(mySqlDataReader["AttachedPO"]);

                            if (mySqlDataReader["IdPaymentType"] != DBNull.Value)
                                warehousePurchaseOrder.IdPaymentType = Convert.ToInt64(mySqlDataReader["IdPaymentType"]);

                            if (mySqlDataReader["ReminderEmailDate"] != DBNull.Value)
                                warehousePurchaseOrder.ReminderEmailDate = Convert.ToDateTime(mySqlDataReader["ReminderEmailDate"]);

                            if (mySqlDataReader["CreatedIn"] != DBNull.Value)
                                warehousePurchaseOrder.CreatedIn = Convert.ToDateTime(mySqlDataReader["CreatedIn"]);

                            if (mySqlDataReader["ModifiedIn"] != DBNull.Value)
                                warehousePurchaseOrder.ModifiedIn = Convert.ToDateTime(mySqlDataReader["ModifiedIn"]);

                            if (mySqlDataReader["Comments"] != DBNull.Value)
                                warehousePurchaseOrder.Comments = Convert.ToString(mySqlDataReader["Comments"]);

                            //[pramod.misal][GEOS2-4449][04-06-2023]warehouseShippingAddress
                            if (mySqlDataReader["Observations"] != DBNull.Value)
                                warehousePurchaseOrder.SupplierComments = Convert.ToString(mySqlDataReader["Observations"]);

                            #region old code
                            //-------------------------------------------------------------------------------------
                            // create a new Sp and  read feilds related to shipping address

                            //if (mySqlDataReader["Name"] != DBNull.Value)
                            //    warehousePurchaseOrder.Name = Convert.ToString(mySqlDataReader["Name"]);

                            //if (mySqlDataReader["Address"] != DBNull.Value)
                            //    warehousePurchaseOrder.Address = Convert.ToString(mySqlDataReader["Address"]);

                            //if (mySqlDataReader["ZipCode"] != DBNull.Value)
                            //    warehousePurchaseOrder.ZipCode = Convert.ToString(mySqlDataReader["ZipCode"]);

                            //if (mySqlDataReader["City"] != DBNull.Value)
                            //    warehousePurchaseOrder.City = Convert.ToString(mySqlDataReader["City"]);

                            //if (mySqlDataReader["Region"] != DBNull.Value)
                            //    warehousePurchaseOrder.Region = Convert.ToString(mySqlDataReader["Region"]);

                            //if (mySqlDataReader["IdCountry"] != DBNull.Value)
                            //    warehousePurchaseOrder.IdCountry = Convert.ToInt64(mySqlDataReader["IdCountry"]);

                            //or

                            //while (mySqlDataReader.Read())
                            //{
                            //    WarehouseShippingAddress warehouseShippingAddress = new WarehouseShippingAddress();

                            //    if (mySqlDataReader["Name"] != DBNull.Value)
                            //        warehouseShippingAddress.Name = Convert.ToString(mySqlDataReader["Name"]);

                            //    if (mySqlDataReader["Address"] != DBNull.Value)
                            //        warehouseShippingAddress.Address = Convert.ToString(mySqlDataReader["Address"]);

                            //    if (mySqlDataReader["ZipCode"] != DBNull.Value)
                            //        warehouseShippingAddress.ZipCode = Convert.ToString(mySqlDataReader["ZipCode"]);

                            //    if (mySqlDataReader["City"] != DBNull.Value)
                            //        warehouseShippingAddress.City = Convert.ToString(mySqlDataReader["City"]);

                            //    if (mySqlDataReader["Region"] != DBNull.Value)
                            //        warehouseShippingAddress.Region = Convert.ToString(mySqlDataReader["Region"]);

                            //    if (mySqlDataReader["IdCountry"] != DBNull.Value)
                            //        warehouseShippingAddress.IdCountry = Convert.ToInt64(mySqlDataReader["IdCountry"]);

                            //    warehouseShippingAddresses.Add(warehouseShippingAddress);
                            //}

                            //warehousePurchaseOrder.WarehouseShippingAddress = warehouseShippingAddresses;


                            //------------------------------------------------------------------------------------------
                            #endregion old code end

                            if (mySqlDataReader["IsClosed"] != DBNull.Value)
                                warehousePurchaseOrder.IsClosed = Convert.ToByte(mySqlDataReader["IsClosed"]);

                            if (mySqlDataReader["CreatedBy"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.CreatedBy = Convert.ToInt64(mySqlDataReader["CreatedBy"]);
                                warehousePurchaseOrder.Creator = new People();
                                warehousePurchaseOrder.Creator.IdPerson = Convert.ToInt32(mySqlDataReader["CreatedBy"].ToString());
                                warehousePurchaseOrder.Creator.Name = mySqlDataReader["CreatorName"].ToString();
                                warehousePurchaseOrder.Creator.Surname = mySqlDataReader["CreatorSurname"].ToString();
                            }

                            if (mySqlDataReader["ModifiedBy"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.ModifiedBy = Convert.ToInt64(mySqlDataReader["ModifiedBy"]);
                                warehousePurchaseOrder.Modifier = new People();
                                warehousePurchaseOrder.Modifier.IdPerson = Convert.ToInt32(mySqlDataReader["ModifiedBy"].ToString());
                                warehousePurchaseOrder.Modifier.Name = mySqlDataReader["ModifierName"].ToString();
                                warehousePurchaseOrder.Modifier.Surname = mySqlDataReader["ModifierSurname"].ToString();
                            }

                            if (mySqlDataReader["ReasonClosed"] != DBNull.Value)
                                warehousePurchaseOrder.ReasonClosed = Convert.ToString(mySqlDataReader["ReasonClosed"]);

                            if (mySqlDataReader["IdWarehouse"] != DBNull.Value)
                                warehousePurchaseOrder.IdWarehouse = Convert.ToInt64(mySqlDataReader["IdWarehouse"]);

                            if (mySqlDataReader["IdShippingAddress"] != DBNull.Value)
                                warehousePurchaseOrder.IdShippingAddress = Convert.ToInt64(mySqlDataReader["IdShippingAddress"]);

                            if (mySqlDataReader["IdCurrency"] != DBNull.Value)
                                warehousePurchaseOrder.IdCurrency = Convert.ToByte(mySqlDataReader["IdCurrency"]);

                            if (mySqlDataReader["IdWorkflowStatus"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                warehousePurchaseOrder.WorkflowStatus = new WorkflowStatus();
                                warehousePurchaseOrder.WorkflowStatus.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                warehousePurchaseOrder.WorkflowStatus.Name = Convert.ToString(mySqlDataReader["Status"]);
                                warehousePurchaseOrder.WorkflowStatus.HtmlColor = Convert.ToString(mySqlDataReader["StatusHtmlColor"]);
                            }

                            if (mySqlDataReader["IdAssignee"] != DBNull.Value)
                                warehousePurchaseOrder.IdAssignee = Convert.ToUInt32(mySqlDataReader["IdAssignee"]);

                            if (mySqlDataReader["IdApprover"] != DBNull.Value)
                                warehousePurchaseOrder.IdApprover = Convert.ToUInt32(mySqlDataReader["IdApprover"]);

                            if (mySqlDataReader["AssigneeEmail"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.AssigneeEmail = Convert.ToString(mySqlDataReader["AssigneeEmail"]);
                            }
                            if (mySqlDataReader["CreatorEmail"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.CreatorEmail = Convert.ToString(mySqlDataReader["CreatorEmail"]);
                            }

                            string HTMLFileName = null;
                            if (File.Exists(string.Format("{0}{1}SupplierPurchaseOrderRequestMailFormat_{2}-{3}.html", emailTemplatePath, @"\", warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower(), warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToUpper())))
                            {
                                HTMLFileName = string.Format("SupplierPurchaseOrderRequestMailFormat_{0}-{1}.html", warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower(), warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToUpper());
                            }
                            else if (File.Exists(string.Format("{0}{1}SupplierPurchaseOrderRequestMailFormat.html", emailTemplatePath, @"\")))
                            {
                                HTMLFileName = "SupplierPurchaseOrderRequestMailFormat.html";
                            }
                            if (HTMLFileName != null)
                            {
                                StringBuilder emailbody = new StringBuilder();
                                string text = ReadMailTemplate(HTMLFileName, emailTemplatePath);

                                if (string.IsNullOrEmpty(warehousePurchaseOrder.ArticleSupplier.ContactPerson))
                                {
                                    text = text.Replace("[Supplier_Name]", "Supplier");
                                }
                                else
                                {
                                    text = text.Replace("[Supplier_Name]", warehousePurchaseOrder.ArticleSupplier.ContactPerson);
                                }
                                text = text.Replace("[PO_Code]", warehousePurchaseOrder.Code);

                                emailbody.Append(text);

                                warehousePurchaseOrder.EmailBody = emailbody.ToString();
                            }
                            warehousePurchaseOrder.AttachPdf = warehousePurchaseOrder.CreatedIn.Year + @"\" + warehousePurchaseOrder.Code + @"\01 Purchase Order\PO_" + warehousePurchaseOrder.Code + ".pdf";

                            warehousePurchaseOrder.AttachmentBytes = GetPurchaseOrderPdf(purchaseOrdersPath, warehousePurchaseOrder.AttachPdf);
                            warehousePurchaseOrder.WarehouseDeliveryNotes = GetDeliveryNotesByIdWarehousePurchaseOrder(connectionString, warehousePurchaseOrder, purchaseOrdersPath);


                            // [pramod.misal][GEOS2-4951][05-07-2023]

                            warehousePurchaseOrder.WarehouseShippingAddress = GetShippingAddressByIdShippingAddress_V2420(connectionString, warehousePurchaseOrder, idShippingAddress);
                            warehousePurchaseOrder.WarehousePurchaseOrderItemWithComments = GetArticlesByIdWarehousePurchaseOrder_V2300(connectionString, warehousePurchaseOrder.IdWarehousePurchaseOrder);
                            //warehousePurchaseOrder.WarehousePOComments = GetlogEntriesByWarehousePO_V2400(idWarehousePurchaseOrder, 252, connectionString);
                            //warehousePurchaseOrder.WarehousePOLogEntries = GetlogEntriesByWarehousePO_V2400(idWarehousePurchaseOrder, 253, connectionString);
                            //[pramod.misal][GEOS2-4451][08-08-2023]  logEntriesByWarehousePO.IdEntryType
                            warehousePurchaseOrder.WarehousePOComments = GetlogEntriesByWarehousePO_V2420(idWarehousePurchaseOrder, 257, connectionString);
                            warehousePurchaseOrder.WarehousePOLogEntries = GetlogEntriesByWarehousePO_V2420(idWarehousePurchaseOrder, 258, connectionString);



                            //[rdixit][GEOS2-4455][28.06.2023] 
                            List<DateTime> ItemDates = new List<DateTime>();
                            if (warehousePurchaseOrder.WarehousePurchaseOrderItemWithComments != null)
                            {
                                if (warehousePurchaseOrder.WarehousePurchaseOrderItemWithComments.Where(i => i.Status < 100) != null)
                                {
                                    if (warehousePurchaseOrder.WarehousePurchaseOrderItemWithComments.Where(i => i.Status < 100).ToList().Count > 0)
                                        foreach (var item in warehousePurchaseOrder.WarehousePurchaseOrderItemWithComments.Where(i => i.Status < 100))
                                        {
                                            if (item.WarehousePurchaseOrderExpectedItems != null)
                                            {
                                                if (item.WarehousePurchaseOrderExpectedItems.Count > 0)
                                                    ItemDates.Add(item.WarehousePurchaseOrderExpectedItems.FirstOrDefault().Date);
                                            }
                                        }
                                }
                            }
                            if (ItemDates.Count > 0)
                                warehousePurchaseOrder.DeliveryDate = ItemDates.Min(d => d.Date).Date;
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetPendingPOByIdWarehousePurchaseOrder_V2420(idWarehousePurchaseOrder-{0}), ErrorMessage- {1} ", idWarehousePurchaseOrder, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            return warehousePurchaseOrder;
        }

        // [pramod.misal][GEOS2-4951][16-08-2023]
        public List<WarehouseShippingAddress> GetShippingAddressByIdShippingAddress_V2420(string connectionString, WarehousePurchaseOrder warehousePurchaseOrder, string idShippingAddress)
        {
            List<WarehouseShippingAddress> WarehouseShippingAddresses = new List<WarehouseShippingAddress>();

            using (MySqlConnection connActivities = new MySqlConnection(connectionString))
            {
                connActivities.Open();
                MySqlCommand activitiesCommand = new MySqlCommand("warehouse_GetShippingAddressByIdWarehousePurchaseOrder", connActivities);
                activitiesCommand.CommandType = CommandType.StoredProcedure;
                //activitiesCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", warehousePurchaseOrder.IdWarehousePurchaseOrder);
                activitiesCommand.Parameters.AddWithValue("_IdShippingAddress", idShippingAddress);


                using (MySqlDataReader poReader = activitiesCommand.ExecuteReader())
                {
                    while (poReader.Read())
                    {
                        try
                        {
                            WarehouseShippingAddress warehouseShippingAddress = new WarehouseShippingAddress();


                            warehouseShippingAddress.IdWarehousePurchaseOrder = warehousePurchaseOrder.IdWarehousePurchaseOrder;

                            if (poReader["IdShippingAddress"] != DBNull.Value)
                                warehouseShippingAddress.IdShippingAddress = Convert.ToInt64(poReader["IdShippingAddress"]);

                            if (poReader["Name"] != DBNull.Value)
                                warehouseShippingAddress.Name = Convert.ToString(poReader["Name"]);

                            if (poReader["Address"] != DBNull.Value)
                                warehouseShippingAddress.Address = Convert.ToString(poReader["Address"]);

                            if (poReader["ZipCode"] != DBNull.Value)
                                warehouseShippingAddress.ZipCode = Convert.ToString(poReader["ZipCode"]);

                            if (poReader["City"] != DBNull.Value)
                                warehouseShippingAddress.City = Convert.ToString(poReader["City"]);

                            if (poReader["Region"] != DBNull.Value)
                                warehouseShippingAddress.Region = Convert.ToString(poReader["Region"]);

                            if (poReader["Region"] != DBNull.Value)
                                warehouseShippingAddress.Region = Convert.ToString(poReader["Region"]);

                            if (poReader["CountryName"] != DBNull.Value)
                                warehouseShippingAddress.CountryName = Convert.ToString(poReader["CountryName"]);

                            if (poReader["IdCountry"] != DBNull.Value)
                            {
                                warehouseShippingAddress.IdCountry = Convert.ToInt64(poReader["IdCountry"]);
                                warehouseShippingAddress.Country = new Country();
                                warehouseShippingAddress.Country.Iso = Convert.ToString(poReader["CountryISO"]);

                                if (poReader["CountryISO"] != DBNull.Value)
                                {
                                    warehouseShippingAddress.Country.CountryIconUrl = "https://api.emdep.com/GEOS/Images?FilePath=/Images/Countries/" + warehouseShippingAddress.Country.Iso + ".png";

                                }

                            }


                            WarehouseShippingAddresses.Add(warehouseShippingAddress);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Executed GetShippingAddressByIdShippingAddress_V2420(idWarehousePurchaseOrder-{0}). ErrorMessage- {1}", warehousePurchaseOrder.IdWarehousePurchaseOrder, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            Log4NetLogger.Logger.Log("Executed GetShippingAddressByIdShippingAddress_V2420().", category: Category.Info, priority: Priority.Low);
            return WarehouseShippingAddresses;
        }
        //Shubham[skadam]  GEOS2-4713 Missing Delivery Dates 31 07 2023 
        public List<WarehousePurchaseOrder> GetPendingPurchaseOrdersByWarehouse_V2420(long idWarehouse, string connectionstring, string countryIconFilePath, string connectionStringWorkbench)
        {
            // string connectionString = warehouse.Company.ConnectPlantConstr;
            List<WarehousePurchaseOrder> warehousePurchaseOrders = new List<WarehousePurchaseOrder>();
            List<string> countryISOs = new List<string>();
            List<long> orderid = new List<long>();
            Dictionary<string, List<long>> SupplierEmailId = new Dictionary<string, List<long>>();
            List<string> Suppliername = new List<string>();

            List<WorkflowStatus> LstWorkflowStatus = GetAllWorkflowStatus_V2301(connectionStringWorkbench);
            List<WorkflowTransition> LstWorkflowStatusTransitions = GetAllWorkflowTransitions_V2301(connectionStringWorkbench);
            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionstring))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetPendingPurchaseOrdersByWarehouse_V2420", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdWarehouse", idWarehouse);
                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    double totalQuantity = 0;
                    double receivedQuantity = 0;
                    while (mySqlDataReader.Read())
                    {
                        try
                        {
                            totalQuantity = 0;
                            receivedQuantity = 0;
                            WarehousePurchaseOrder warehousePurchaseOrder = new WarehousePurchaseOrder();
                            try
                            {
                                warehousePurchaseOrder.IdWarehousePurchaseOrder = Convert.ToInt64(mySqlDataReader["idWarehousepurchaseorder"]);
                                if (mySqlDataReader["Code"] != DBNull.Value)
                                    warehousePurchaseOrder.Code = Convert.ToString(mySqlDataReader["Code"]);
                                if (mySqlDataReader["IdArticleSupplier"] != DBNull.Value)
                                {
                                    ArticleSupplier articleSupplier = new ArticleSupplier();
                                    articleSupplier.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);
                                    if (mySqlDataReader["Supplier"] != DBNull.Value)
                                        articleSupplier.Name = Convert.ToString(mySqlDataReader["Supplier"]);
                                    if (mySqlDataReader["IdCountry"] != DBNull.Value)
                                    {
                                        articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["IdCountry"]);
                                        articleSupplier.Country = new Country();
                                        articleSupplier.Country.IdCountry = Convert.ToByte(mySqlDataReader["IdCountry"]);
                                        articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);
                                        if (mySqlDataReader["CountryISO"] != DBNull.Value)
                                        {
                                            articleSupplier.Country.Iso = Convert.ToString(mySqlDataReader["CountryISO"]);
                                            articleSupplier.Country.CountryIconUrl = "https://api.emdep.com/GEOS/Images?FilePath=/Images/Countries/" + articleSupplier.Country.Iso + ".png";
                                            //if (!countryISOs.Any(co => co.ToString() == articleSupplier.Country.Iso))
                                            //{
                                            //    countryISOs.Add(articleSupplier.Country.Iso);
                                            //}
                                        }
                                    }
                                    if (mySqlDataReader["SupplierContactPerson"] != DBNull.Value)
                                        articleSupplier.ContactPerson = Convert.ToString(mySqlDataReader["SupplierContactPerson"]);
                                    if (mySqlDataReader["SupplierContactEmail"] != DBNull.Value)
                                        articleSupplier.ContactEmail = Convert.ToString(mySqlDataReader["SupplierContactEmail"]);
                                    warehousePurchaseOrder.ArticleSupplier = articleSupplier;
                                }
                                //[rdixit][GEOS2-4455][19.06.2023]
                                //if (mySqlDataReader["DeliveryDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["deliveryDate"]) != DateTime.MinValue)
                                //{
                                //warehousePurchaseOrder.DeliveryDate = Convert.ToDateTime(mySqlDataReader["deliveryDate"]);
                                //warehousePurchaseOrder.Delay = (int)(warehousePurchaseOrder.DeliveryDate.Value.Date - DateTime.Now.Date).TotalDays;
                                //}

                                //Shubham[skadam]  GEOS2-4713 Missing Delivery Dates 31 07 2023 
                                if (mySqlDataReader["PODeliveryDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["PODeliveryDate"]) != DateTime.MinValue)
                                {
                                    warehousePurchaseOrder.PODeliveryDate = Convert.ToDateTime(mySqlDataReader["PODeliveryDate"]);
                                }
                                if (mySqlDataReader["AttachedPO"] != DBNull.Value)
                                    warehousePurchaseOrder.AttachedPO = Convert.ToByte(mySqlDataReader["AttachedPO"]);
                                if (mySqlDataReader["Deliveries"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.Deliveries = Convert.ToInt32(mySqlDataReader["Deliveries"]);
                                    if (warehousePurchaseOrder.Deliveries > 0)
                                    {
                                        warehousePurchaseOrder.IsPartialPending = true;
                                    }
                                }
                                if (mySqlDataReader["LatestDeliveryDate"] != DBNull.Value)
                                    warehousePurchaseOrder.LatestDeliveryDate = Convert.ToDateTime(mySqlDataReader["LatestDeliveryDate"]);
                                if (mySqlDataReader["IdWarehouse"] != DBNull.Value)
                                    warehousePurchaseOrder.IdWarehouse = Convert.ToInt64(mySqlDataReader["IdWarehouse"]);
                                if (mySqlDataReader["OrderQty"] != DBNull.Value)
                                    totalQuantity = Convert.ToDouble(mySqlDataReader["OrderQty"]);
                                if (mySqlDataReader["ReceivedQuantity"] != DBNull.Value)
                                    receivedQuantity = Convert.ToDouble(mySqlDataReader["ReceivedQuantity"]);
                                if (totalQuantity > 0)
                                    warehousePurchaseOrder.Status = (Int16)((receivedQuantity / totalQuantity) * 100);
                                if (mySqlDataReader["TotalAmount"] != DBNull.Value)
                                    warehousePurchaseOrder.TotalAmount = Convert.ToDecimal(mySqlDataReader["TotalAmount"]);
                                if (mySqlDataReader["CreatedIn"] != DBNull.Value)
                                    warehousePurchaseOrder.CreatedIn = Convert.ToDateTime(mySqlDataReader["CreatedIn"]);
                                if (mySqlDataReader["AttachPdf"] != DBNull.Value)
                                    warehousePurchaseOrder.AttachPdf = Convert.ToString(mySqlDataReader["AttachPdf"]);
                                if (mySqlDataReader["idCurrency"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.IdCurrency = Convert.ToByte(mySqlDataReader["idCurrency"]);
                                    warehousePurchaseOrder.Currency = new Currency();
                                    warehousePurchaseOrder.Currency.IdCurrency = Convert.ToByte(mySqlDataReader["idCurrency"]);
                                    warehousePurchaseOrder.Currency.Name = Convert.ToString(mySqlDataReader["CurrencyName"]);
                                    warehousePurchaseOrder.Currency.Symbol = Convert.ToString(mySqlDataReader["CurrencySymbol"]);
                                }
                                if (mySqlDataReader["IdWorkflowStatus"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                    warehousePurchaseOrder.WorkflowStatus = new WorkflowStatus();
                                    warehousePurchaseOrder.WorkflowStatus.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                    warehousePurchaseOrder.WorkflowStatus.Name = Convert.ToString(mySqlDataReader["Status"]);
                                    warehousePurchaseOrder.WorkflowStatus.HtmlColor = Convert.ToString(mySqlDataReader["HtmlColor"]);


                                    //[pramod.misal][GEOS2-4448][06-07-2023]
                                    if (mySqlDataReader["SortOrder"] != DBNull.Value)
                                    {
                                        warehousePurchaseOrder.WorkflowStatus.SortOrder = Convert.ToInt32(mySqlDataReader["SortOrder"]);
                                    }

                                }
                                if (mySqlDataReader["AssigneeEmail"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.AssigneeEmail = Convert.ToString(mySqlDataReader["AssigneeEmail"]);
                                }
                                if (mySqlDataReader["CreatorEmail"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.CreatorEmail = Convert.ToString(mySqlDataReader["CreatorEmail"]);
                                }

                                if (mySqlDataReader["ReminderEmailDate"] != DBNull.Value)
                                    warehousePurchaseOrder.ReminderEmailDate = Convert.ToDateTime(mySqlDataReader["ReminderEmailDate"]);

                                if (mySqlDataReader["WarehouseName"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.WarehouseName = Convert.ToString(mySqlDataReader["WarehouseName"]);
                                }


                                warehousePurchaseOrder.LstWorkflowStatus = LstWorkflowStatus;
                                List<byte> GetCurrentButtons = LstWorkflowStatusTransitions.Where(a => a.IdWorkflowStatusFrom == warehousePurchaseOrder.IdWorkflowStatus).Select(a => a.IdWorkflowStatusTo).Distinct().ToList();
                                warehousePurchaseOrder.LstWorkflowStatusTransition = new List<WorkflowStatus>();
                                warehousePurchaseOrder.LstWorkflowStatusTransition.Add(warehousePurchaseOrder.LstWorkflowStatus.FirstOrDefault(a => a.IdWorkflowStatus == warehousePurchaseOrder.IdWorkflowStatus));
                                foreach (byte statusbutton in GetCurrentButtons)
                                {
                                    warehousePurchaseOrder.LstWorkflowStatusTransition.Add(warehousePurchaseOrder.LstWorkflowStatus.FirstOrDefault(a => a.IdWorkflowStatus == statusbutton));
                                }
                            }
                            catch (Exception ex)
                            {
                            }
                            warehousePurchaseOrder.LstAllWorkflowStatusTransitions = LstWorkflowStatusTransitions;
                            warehousePurchaseOrders.Add(warehousePurchaseOrder);

                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetPendingPurchaseOrdersByWarehouse_V2420(). ErrorMessage-" + ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                    #region 2nd ResultSet [rdixit][GEOS2-4455][19.06.2023] 
                    if (mySqlDataReader.NextResult())
                    {
                        while (mySqlDataReader.Read())
                        {
                            if (mySqlDataReader["idWarehousePurchaseOrder"] != DBNull.Value)
                            {
                                WarehousePurchaseOrderItem OrderItem = new WarehousePurchaseOrderItem();

                                WarehousePurchaseOrder Order = warehousePurchaseOrders.FirstOrDefault(i => i.IdWarehousePurchaseOrder == Convert.ToInt64(mySqlDataReader["idWarehousePurchaseOrder"]));
                                if (Order != null)
                                {
                                    if (Order.WarehousePurchaseOrderItems == null)
                                    {
                                        Order.WarehousePurchaseOrderItems = new List<WarehousePurchaseOrderItem>();
                                    }
                                    if (mySqlDataReader["idWarehousePurchaseOrder"] != DBNull.Value)
                                        OrderItem.IdWarehousePurchaseOrder = Convert.ToInt64(mySqlDataReader["idWarehousePurchaseOrder"]);
                                    if (mySqlDataReader["IdWarehousePurchaseOrderItem"] != DBNull.Value)
                                        OrderItem.IdWarehousePurchaseOrderItem = Convert.ToInt64(mySqlDataReader["IdWarehousePurchaseOrderItem"]);
                                    if (mySqlDataReader["Quantity"] != DBNull.Value)
                                        OrderItem.Quantity = Convert.ToDouble(mySqlDataReader["Quantity"]);
                                    if (mySqlDataReader["AlbaranQty"] != DBNull.Value)
                                        OrderItem.ReceivedQuantity = Convert.ToDouble(mySqlDataReader["AlbaranQty"]);
                                    if (OrderItem.Quantity > 0)
                                        OrderItem.Status = (Int16)((OrderItem.ReceivedQuantity / OrderItem.Quantity) * 100);
                                    Order.WarehousePurchaseOrderItems.Add(OrderItem);
                                }
                            }
                        }
                    }
                    #endregion
                    #region 3nd ResultSet [rdixit][GEOS2-4455][19.06.2023] 
                    if (mySqlDataReader.NextResult())
                    {
                        while (mySqlDataReader.Read())
                        {
                            if (mySqlDataReader["IdWarehousePurchaseOrderItem"] != DBNull.Value)
                            {
                                WarehousePurchaseOrderExpectedItem OrderExpectedItem = new WarehousePurchaseOrderExpectedItem();

                                WarehousePurchaseOrderItem OrderItem = warehousePurchaseOrders.Where(o => o.WarehousePurchaseOrderItems != null)
                                                                        .SelectMany(order => order.WarehousePurchaseOrderItems)
                                                                        .FirstOrDefault(item => item.IdWarehousePurchaseOrderItem == Convert.ToInt64(mySqlDataReader["IdWarehousePurchaseOrderItem"]));
                                if (OrderItem != null)
                                {
                                    if (OrderItem.WarehousePurchaseOrderExpectedItems == null)
                                    {
                                        OrderItem.WarehousePurchaseOrderExpectedItems = new List<WarehousePurchaseOrderExpectedItem>();
                                    }
                                    if (mySqlDataReader["IdWarehousePurchaseOrderItem"] != DBNull.Value)
                                        OrderExpectedItem.IdWarehousePurchaseOrderItem = Convert.ToInt64(mySqlDataReader["IdWarehousePurchaseOrderItem"]);
                                    if (mySqlDataReader["Quantity"] != DBNull.Value)
                                        OrderExpectedItem.Quantity = (long)Convert.ToDouble(mySqlDataReader["Quantity"]);
                                    if (mySqlDataReader["Date"] != DBNull.Value)
                                        OrderExpectedItem.Date = Convert.ToDateTime(mySqlDataReader["Date"]);

                                    OrderItem.WarehousePurchaseOrderExpectedItems.Add(OrderExpectedItem);
                                }
                            }
                        }
                    }
                    #endregion
                }
            }
            #region 2nd ResultSet [rdixit][GEOS2-4455][19.06.2023] 
            foreach (WarehousePurchaseOrder Order in warehousePurchaseOrders)
            {
                List<DateTime> ItemDates = new List<DateTime>();
                if (Order.WarehousePurchaseOrderItems != null)
                {
                    if (Order.WarehousePurchaseOrderItems.Where(i => i.Status < 100) != null)
                    {
                        if (Order.WarehousePurchaseOrderItems.Where(i => i.Status < 100).ToList().Count > 0)
                        {
                            foreach (WarehousePurchaseOrderItem OrderItem in Order.WarehousePurchaseOrderItems.Where(i => i.Status != 100))
                            {
                                if (OrderItem.WarehousePurchaseOrderExpectedItems != null)
                                {
                                    if (OrderItem.WarehousePurchaseOrderExpectedItems.Count > 0)
                                        ItemDates.Add(OrderItem.WarehousePurchaseOrderExpectedItems.FirstOrDefault().Date);
                                }
                            }
                        }
                    }
                }
                if (ItemDates.Count != 0)
                {
                    Order.DeliveryDate = ItemDates.Min(d => d.Date).Date;
                    Order.Delay = (int)(Order.DeliveryDate.Value.Date - DateTime.Now.Date).TotalDays;

                    if (!string.IsNullOrEmpty(Order.ArticleSupplier.ContactEmail))
                    {
                        if (Order.ReminderEmailDate == DateTime.MinValue || Order.ReminderEmailDate == null)
                        {
                            Order.ReminderEmailDate = Order.DeliveryDate.Value.AddDays(1);
                        }
                        DateTime dtRm = new DateTime(Order.ReminderEmailDate.Value.Year, Order.ReminderEmailDate.Value.Month, Order.ReminderEmailDate.Value.Day);
                        DateTime dtNow = new DateTime(DateTime.Now.Year, DateTime.Now.Month, DateTime.Now.Day);
                        if (dtRm <= dtNow)
                        {
                            orderid = new List<long>();
                            orderid.Add(Order.IdWarehousePurchaseOrder);
                            if (!SupplierEmailId.ContainsKey(Order.ArticleSupplier.ContactEmail))
                            {
                                SupplierEmailId.Add(Order.ArticleSupplier.ContactEmail, orderid);
                            }
                            else
                            {
                                SupplierEmailId[Order.ArticleSupplier.ContactEmail].Add(Order.IdWarehousePurchaseOrder);
                            }
                        }
                    }
                    else
                    {
                        if (!Suppliername.Contains(Order.ArticleSupplier.Name))
                        {
                            Suppliername.Add(Order.ArticleSupplier.Name);
                        }
                    }
                }
            }
            #endregion
            #region GEOS2-4713
            //Shubham[skadam]  GEOS2-4713 Missing Delivery Dates 31 07 2023 
            foreach (var item in warehousePurchaseOrders.Where(w => w.DeliveryDate == null || w.DeliveryDate == DateTime.MinValue))
            {
                if (!string.IsNullOrEmpty(item.PODeliveryDate.ToString()))
                {
                    item.DeliveryDate = item.PODeliveryDate;
                    item.Delay = (int)(item.DeliveryDate.Value.Date - DateTime.Now.Date).TotalDays;
                }
            }
            #endregion
            //foreach (string item in countryISOs)
            //{
            //    byte[] bytes = null;
            //    bytes = GetCountryIconFileInBytes(item, countryIconFilePath);
            //    warehousePurchaseOrders.Where(wp => wp.ArticleSupplier.Country.Iso == item).ToList().ForEach(wp => wp.ArticleSupplier.Country.CountryIconBytes = bytes);
            //}
            if (warehousePurchaseOrders.Count > 0)
            {
                warehousePurchaseOrders.FirstOrDefault().SupplierEmailId = SupplierEmailId;
                warehousePurchaseOrders.FirstOrDefault().Suppliername = Suppliername;
            }
            return warehousePurchaseOrders;
        }

        //[pramod.misal][GEOS2-4450][01.08.2023]
        public bool UpdateAssigneeAndApproverInPO_V2420(string connectionString, WarehousePurchaseOrder warehousePurchaseOrder)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    if (warehousePurchaseOrder != null && warehousePurchaseOrder.IdWarehousePurchaseOrder > 0)
                    {
                        using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                        {
                            mySqlConnection.Open();

                            MySqlCommand mySqlCommand = new MySqlCommand("SRM_UpdateAssigneeAndApproverInPO", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", warehousePurchaseOrder.IdWarehousePurchaseOrder);
                            mySqlCommand.Parameters.AddWithValue("_IdAssignee", warehousePurchaseOrder.IdAssignee);
                            mySqlCommand.Parameters.AddWithValue("_IdApprover", warehousePurchaseOrder.IdApprover);
                            mySqlCommand.Parameters.AddWithValue("_ModifiedBy", warehousePurchaseOrder.ModifiedBy);
                            mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                            mySqlCommand.ExecuteNonQuery();

                            mySqlConnection.Close();

                            isUpdated = true;
                        }
                        AddCommentsOrLogEntriesByPO_V2420(connectionString, warehousePurchaseOrder.WarehousePOLogEntries);

                        //[pramod.misal][GEOS2-4550][03-08-2023]
                        AddUpdateDeleteCommentsByPO(connectionString, warehousePurchaseOrder.WarehousePOComments);
                        isUpdated = true;
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateAssigneeAndApproverInPO_V2420(). IdWarehousePurchaseOrder- {0} ErrorMessage- {1}", warehousePurchaseOrder.IdWarehousePurchaseOrder, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }

        //[pramod.misal][GEOS2-4450][01.08.2023]
        public void AddUpdateDeleteCommentsByPO(string MainServerConnectionString, List<LogEntriesByWarehousePO> commentsByWarehousePOList)
        {
            try
            {
                if (commentsByWarehousePOList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (LogEntriesByWarehousePO logEntriesByWarehousePO in commentsByWarehousePOList)
                        {

                            if (logEntriesByWarehousePO.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {

                                MySqlCommand mySqlCommand = new MySqlCommand("SRM_Insert_Comment_by_warehouse_purchase_order_Insert_V2420", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                mySqlCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", logEntriesByWarehousePO.IdWarehousePurchaseOrder);
                                mySqlCommand.Parameters.AddWithValue("_IdUser", logEntriesByWarehousePO.IdUser);
                                mySqlCommand.Parameters.AddWithValue("_Datetime", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                mySqlCommand.Parameters.AddWithValue("_Comments", logEntriesByWarehousePO.Comments);
                                //[pramod.misal][GEOS2-4736][07/08/2023]
                                mySqlCommand.Parameters.AddWithValue("_IdLogEntryType", 257);
                                mySqlCommand.Parameters.AddWithValue("_IsRtfText", logEntriesByWarehousePO.IsRtfText);

                                mySqlCommand.ExecuteNonQuery();
                            }

                            else if (logEntriesByWarehousePO.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {

                                MySqlCommand mySqlCommand = new MySqlCommand("SRM_Delete_Comment_by_IdLogEntryByWarehousePurchaseOrder", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdLogEntryByWarehousePurchaseOrder", logEntriesByWarehousePO.IdLogEntryByPurchaseOrder);
                                mySqlCommand.ExecuteNonQuery();
                            }


                            else if (logEntriesByWarehousePO.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("UpdateCommentsByIdWarehousePurchaseOrder", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdLogEntryByWarehousePurchaseOrder", logEntriesByWarehousePO.IdLogEntryByPurchaseOrder);
                                mySqlCommand.Parameters.AddWithValue("_Comments", logEntriesByWarehousePO.Comments);
                                mySqlCommand.ExecuteNonQuery();

                            }

                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeleteCommentsByPO(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        //[pramod.misal][GEOS2-4451][08-08-2023]
        public List<LogEntriesByWarehousePO> GetlogEntriesByWarehousePO_V2420(Int64 idWarehousePurchaseOrder, int idLogEntryType, string connectionString)
        {
            List<LogEntriesByWarehousePO> logEntriesByWarehousePOList = new List<LogEntriesByWarehousePO>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetLogEntriesByWarehousePurchaseOrder_V2420", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", idWarehousePurchaseOrder);
                    mySqlCommand.Parameters.AddWithValue("_IdLogEntryType", idLogEntryType);

                    using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                    {
                        while (mySqlDataReader.Read())
                        {
                            LogEntriesByWarehousePO logEntriesByWarehousePO = new LogEntriesByWarehousePO();

                            logEntriesByWarehousePO.IdLogEntryByPurchaseOrder = Convert.ToInt64(mySqlDataReader["IdLogEntryByPurchaseOrder"]);

                            if (mySqlDataReader["IdUser"] != DBNull.Value)
                                logEntriesByWarehousePO.IdUser = Convert.ToInt32(mySqlDataReader["IdUser"].ToString());

                            if (mySqlDataReader["IdWarehousePurchaseOrder"] != DBNull.Value)
                                logEntriesByWarehousePO.IdWarehousePurchaseOrder = Convert.ToInt64(mySqlDataReader["IdWarehousePurchaseOrder"].ToString());

                            if (mySqlDataReader["IdPerson"] != DBNull.Value)
                            {
                                logEntriesByWarehousePO.People = new People();
                                logEntriesByWarehousePO.People.IdPerson = Convert.ToInt32(mySqlDataReader["IdPerson"].ToString());
                                logEntriesByWarehousePO.People.Name = mySqlDataReader["Name"].ToString();
                                logEntriesByWarehousePO.People.Surname = mySqlDataReader["Surname"].ToString();
                            }

                            //if (mySqlDataReader["Datetime"] != DBNull.Value)
                            //    logEntriesByWarehousePO.Datetime = Convert.ToDateTime(mySqlDataReader["Datetime"].ToString());

                            //[pramod.misal][GEOS2-4431][16-06-2023]
                            if (mySqlDataReader["Datetime"] != DBNull.Value)
                            {
                                logEntriesByWarehousePO.Datetime = Convert.ToDateTime(mySqlDataReader["Datetime"].ToString());
                            }

                            if (mySqlDataReader["Comments"] != DBNull.Value)
                                logEntriesByWarehousePO.Comments = mySqlDataReader["Comments"].ToString();

                            if (mySqlDataReader["IdLogEntryType"] != DBNull.Value)
                                logEntriesByWarehousePO.IdEntryType = Convert.ToInt32(mySqlDataReader["IdLogEntryType"]);

                            if (mySqlDataReader["IsRtfText"] != DBNull.Value)
                                logEntriesByWarehousePO.IsRtfText = Convert.ToBoolean(mySqlDataReader["IsRtfText"]);

                            logEntriesByWarehousePOList.Add(logEntriesByWarehousePO);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetlogEntriesByWarehousePO_V2420. ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return logEntriesByWarehousePOList;
        }

        //[pramod.misal][GEOS2-4451][08-08-2023]
        public void AddCommentsOrLogEntriesByPO_V2420(string MainServerConnectionString, List<LogEntriesByWarehousePO> LogEntriesByWarehousePOList)
        {
            try
            {
                if (LogEntriesByWarehousePOList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (LogEntriesByWarehousePO logEntriesByWarehousePO in LogEntriesByWarehousePOList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("SRM_log_entries_by_warehouse_purchase_order_Insert_V2420", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", logEntriesByWarehousePO.IdWarehousePurchaseOrder);
                            mySqlCommand.Parameters.AddWithValue("_IdUser", logEntriesByWarehousePO.IdUser);
                            mySqlCommand.Parameters.AddWithValue("_Datetime", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                            mySqlCommand.Parameters.AddWithValue("_Comments", logEntriesByWarehousePO.Comments);
                            mySqlCommand.Parameters.AddWithValue("_IdLogEntryType", logEntriesByWarehousePO.IdEntryType);
                            mySqlCommand.Parameters.AddWithValue("_IsRtfText", logEntriesByWarehousePO.IsRtfText);

                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddCommentsOrLogEntriesByPO_V2420(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        //[pramod.misal][GEOS2-4451][08-08-2023]
        public bool UpdateWorkflowStatusInPO_V2420(string MainServerConnectionString, uint IdWarehousePurchaseOrder, UInt32 IdWorkflowStatus, int IdUser, List<LogEntriesByWarehousePO> LogEntriesByWarehousePOList, UInt32 IdAssignee, UInt32 IdApprover)
        {
            bool status;
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        MySqlCommand mySqlCommand = new MySqlCommand("SRM_warehousepurchaseorders_UpdateWorkflowStatus", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", IdWarehousePurchaseOrder);
                        mySqlCommand.Parameters.AddWithValue("_IdWorkflowStatus", IdWorkflowStatus);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdUser);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                        status = true;
                    }

                    AddCommentsOrLogEntriesByPO_V2420(MainServerConnectionString, LogEntriesByWarehousePOList);
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateWorkflowStatusInPO_V2420(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return status;
        }


        //[pramod.misal][GEOS2-4674][22-08-2023]
        public Contacts AddContact_V2430(string mainServerConnectionString, Contacts contacts, List<LogEntriesByArticleSuppliers> ArticleSuppliersChangeLogList)
        {
            TransactionScope transactionScope = null;
            try
            {
                using (transactionScope = new TransactionScope())
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("SRM_Contacts_Insert_Update_V2430", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_Idcontact", contacts.IdContact);
                        mySqlCommand.Parameters.AddWithValue("_Firstname", contacts.Firstname);
                        mySqlCommand.Parameters.AddWithValue("_Lastname", contacts.Lastname);
                        mySqlCommand.Parameters.AddWithValue("_IdGender", contacts.IdGender);
                        mySqlCommand.Parameters.AddWithValue("_Email", contacts.Email);
                        mySqlCommand.Parameters.AddWithValue("_Phone", contacts.Phone);
                        mySqlCommand.Parameters.AddWithValue("_Phone2", contacts.Phone2);
                        mySqlCommand.Parameters.AddWithValue("_IdDepartment", contacts.IdDepartment);
                        mySqlCommand.Parameters.AddWithValue("_JobTitle", contacts.JobTitle);
                        mySqlCommand.Parameters.AddWithValue("_Image", contacts.ImageText);
                        mySqlCommand.Parameters.AddWithValue("_Remarks", contacts.Remarks);

                        contacts.IdContact = Convert.ToInt32(mySqlCommand.ExecuteScalar());
                        mySqlConnection.Close();
                    }

                    transactionScope.Complete();
                }

                AddCommentsOrLogEntriesByArticleSuppliers(mainServerConnectionString, ArticleSuppliersChangeLogList);
            }
            catch (Exception ex)
            {
                if (Transaction.Current != null)
                    Transaction.Current.Rollback();

                if (transactionScope != null)
                    transactionScope.Dispose();

                Log4NetLogger.Logger.Log(string.Format("Error AddContact_V2430(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return contacts;
        }

        //[pramod.misal][GEOS2-4675][22-08-2023]
        public Contacts GetContacts_V2430(string connectionString, int idContact)
        {
            Contacts contacts = new Contacts();

            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();

                MySqlCommand activitiesCommand = new MySqlCommand("SRM_GetContacts_V2430", mySqlConnection);
                activitiesCommand.CommandType = CommandType.StoredProcedure;
                activitiesCommand.Parameters.AddWithValue("_IdContact", idContact);

                using (MySqlDataReader poReader = activitiesCommand.ExecuteReader())
                {
                    while (poReader.Read())
                    {
                        try
                        {
                            if (poReader["IdContact"] != DBNull.Value)
                                contacts.IdContact = Convert.ToInt32(poReader["IdContact"]);

                            if (poReader["Firstname"] != DBNull.Value)
                                contacts.Firstname = Convert.ToString(poReader["Firstname"]);

                            if (poReader["Lastname"] != DBNull.Value)
                                contacts.Lastname = Convert.ToString(poReader["Lastname"]);

                            if (poReader["IdGender"] != DBNull.Value)
                                contacts.IdGender = Convert.ToByte(poReader["IdGender"]);

                            if (poReader["Email"] != DBNull.Value)
                                contacts.Email = Convert.ToString(poReader["Email"]);

                            if (poReader["IdDepartment"] != DBNull.Value)
                                contacts.IdDepartment = Convert.ToInt32(poReader["IdDepartment"]);

                            if (poReader["JobTitle"] != DBNull.Value)
                                contacts.JobTitle = Convert.ToString(poReader["JobTitle"]);

                            if (poReader["Phone"] != DBNull.Value)
                                contacts.Phone = Convert.ToString(poReader["Phone"]);

                            if (poReader["Phone2"] != DBNull.Value)
                                contacts.Phone2 = Convert.ToString(poReader["Phone2"]);

                            if (poReader["Image"] != DBNull.Value)
                                contacts.ImageText = Convert.ToString(poReader["Image"]);

                            if (poReader["Remarks"] != DBNull.Value)
                                contacts.Remarks = Convert.ToString(poReader["Remarks"]);

                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetContacts_V2430(idContact-{0}). ErrorMessage- {1}", idContact, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }
            return contacts;
        }

        //[Sudhir.Jangra][GEOS2-4676][28/08/2023]
        public bool DisableContact(People people, string mainConnectionString)
        {
            bool isDeleted = false;
            try
            {
                using (MySqlConnection myConnection = new MySqlConnection(mainConnectionString))
                {
                    myConnection.Open();
                    using (MySqlTransaction trans = myConnection.BeginTransaction())
                    {
                        try
                        {
                            MySqlCommand concompanycommand = new MySqlCommand("people_Delete", myConnection);
                            concompanycommand.CommandType = CommandType.StoredProcedure;

                            concompanycommand.Parameters.AddWithValue("_IdPerson", people.IdPerson);
                            concompanycommand.Parameters.AddWithValue("_IsDeleted", people.IsStillActive);

                            concompanycommand.Transaction = trans;
                            concompanycommand.ExecuteNonQuery();

                            isDeleted = true;
                            trans.Commit();

                            //if (isDeleted == true)
                            //{
                            //    AddLogEntriesByActivity(activity.IdActivity, activity.LogEntriesByActivity, mainConnectionString);
                            //}
                        }
                        catch (Exception ex)
                        {
                            trans.Rollback();
                            throw;
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                throw;
            }

            return isDeleted;
        }
        //[Sudhir.Jangra][GEOS2-4676][28/08/2023]
        public List<People> GetContactsByIdPermission_V2390(string connectionstring, Int32 idActiveUser, string idUser, string idSite, Int32 idPermission)
        {
            List<People> peoples = new List<People>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionstring))
            {
                mySqlConnection.Open();
                MySqlCommand mySqlCommand = new MySqlCommand("people_GetContactsByIdPermission_V2390", mySqlConnection);

                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_idActiveUser", idActiveUser);
                mySqlCommand.Parameters.AddWithValue("_idUser", idUser);
                mySqlCommand.Parameters.AddWithValue("_idSite", idSite);
                mySqlCommand.Parameters.AddWithValue("_idPermission", idPermission);

                using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        People people = new People();
                        people.IdPerson = Convert.ToInt32(reader["IdPerson"]);
                        people.Name = Convert.ToString(reader["FirstName"]);
                        people.Surname = Convert.ToString(reader["LastName"]);
                        people.Phone = Convert.ToString(reader["Telephone"]);
                        people.Email = Convert.ToString(reader["Email"]);

                        if (reader["IdPersonGender"] != DBNull.Value)
                        {
                            people.IdPersonGender = Convert.ToByte(reader["IdPersonGender"]);
                            if (people.IdPersonGender == 1)
                                people.UserGender = "Female";
                            else if (people.IdPersonGender == 2)
                                people.UserGender = "Male";
                        }

                        people.IdPersonType = Convert.ToByte(reader["IdPersonType"].ToString());
                        people.PeopleType = new PeopleType();
                        people.PeopleType.IdPersonType = Convert.ToByte(reader["IdPersonType"].ToString());
                        people.PeopleType.Name = Convert.ToString(reader["PersonTypeName"]);

                        if (reader["CreatedIn"] != DBNull.Value)
                            people.CreatedIn = Convert.ToDateTime(reader["CreatedIn"].ToString());

                        people.Company = new Company() { IdCompany = Convert.ToInt32(reader["IdCompany"].ToString()), Name = reader["CustomerPlant"].ToString().Trim(), Country = new Country { IdCountry = Convert.ToByte(reader["IdCountry"].ToString()), Name = reader["Country"].ToString(), CountryIconUrl = "https://api.emdep.com/GEOS/Images?FilePath=/Images/Countries/" + reader["Iso"].ToString() + ".png", Zone = new Zone { Name = reader["Zone"].ToString() } } };

                        //if (idPermission == 21 || idPermission == 22)
                        //{
                        //    if (reader["IdSalesResponsible"] != DBNull.Value)
                        //    {
                        //        people.Company.IdSalesResponsible = Convert.ToInt32(reader["IdSalesResponsible"]);
                        //        people.Company.People = new People();
                        //        people.Company.People.IdPerson = (Int32)people.Company.IdSalesResponsible;

                        //        if (reader["SalesResponsibleFirstName"] != DBNull.Value)
                        //            people.Company.People.Name = Convert.ToString(reader["SalesResponsibleFirstName"]);

                        //        if (reader["SalesResponsibleLastName"] != DBNull.Value)
                        //            people.Company.People.Surname = Convert.ToString(reader["SalesResponsibleLastName"]);
                        //    }

                        //    if (reader["IdSalesResponsibleAssemblyBU"] != DBNull.Value)
                        //    {
                        //        people.Company.IdSalesResponsibleAssemblyBU = Convert.ToInt32(reader["IdSalesResponsibleAssemblyBU"]);

                        //        people.Company.PeopleSalesResponsibleAssemblyBU = new People();
                        //        people.Company.PeopleSalesResponsibleAssemblyBU.IdPerson = (Int32)people.Company.IdSalesResponsibleAssemblyBU;

                        //        if (reader["SalesResponsibleBUFirstName"] != DBNull.Value)
                        //            people.Company.PeopleSalesResponsibleAssemblyBU.Name = Convert.ToString(reader["SalesResponsibleBUFirstName"]);

                        //        if (reader["SalesResponsibleBULastName"] != DBNull.Value)
                        //            people.Company.PeopleSalesResponsibleAssemblyBU.Surname = Convert.ToString(reader["SalesResponsibleBULastName"]);
                        //    }
                        //}

                        people.Company.Address = Convert.ToString(reader["SiteAddress"]);
                        people.Observations = Convert.ToString(reader["Observations"]);
                        people.Company.City = Convert.ToString(reader["SiteCity"]);
                        people.Company.CIF = Convert.ToString(reader["SiteCIF"]);
                        people.Company.Telephone = Convert.ToString(reader["SiteTelephone"]);
                        people.Company.Fax = Convert.ToString(reader["SiteFax"]);
                        people.Company.PostCode = Convert.ToString(reader["SitePostCode"]);
                        people.Company.ZipCode = Convert.ToString(reader["SitePostCode"]);
                        people.Company.Region = Convert.ToString(reader["SiteRegion"]);
                        people.Company.RegisteredName = Convert.ToString(reader["SiteRegisteredName"]);
                        people.Company.Website = Convert.ToString(reader["SiteWebsite"]);
                        people.Company.Customers = new List<Customer> { new Customer { IdCustomer = Convert.ToInt32(reader["IdCustomer"].ToString()), CustomerName = reader["CustomerGroup"].ToString() } };

                        if (reader["IdCompanyDepartment"] != DBNull.Value)
                        {
                            people.IdCompanyDepartment = Convert.ToInt32(reader["IdCompanyDepartment"].ToString());
                            people.CompanyDepartment = new LookupValue();
                            people.CompanyDepartment.IdLookupValue = Convert.ToInt32(reader["IdCompanyDepartment"].ToString());
                            people.CompanyDepartment.Value = reader["Value"].ToString();

                            if (reader["IdImage"] != DBNull.Value)
                                people.CompanyDepartment.IdImage = Convert.ToInt64(reader["IdImage"].ToString());

                        }

                        people.JobTitle = reader["JobTitle"].ToString();
                        people.ImageText = reader["Image"].ToString();

                        if (reader["IdContactInfluenceLevel"] != DBNull.Value)
                        {
                            people.IdContactInfluenceLevel = Convert.ToInt32(reader["IdContactInfluenceLevel"].ToString());
                            people.InfluenceLevel = new LookupValue();
                            people.InfluenceLevel.IdLookupValue = Convert.ToInt32(reader["IdContactInfluenceLevel"].ToString());
                            people.InfluenceLevel.Value = reader["InfluenceLevel"].ToString();
                            people.InfluenceLevel.HtmlColor = reader["InfluenceLevelHtmlcolor"].ToString();

                            if (reader["InfluenceLevelIdImage"] != DBNull.Value)
                                people.InfluenceLevel.IdImage = Convert.ToInt64(reader["InfluenceLevelIdImage"].ToString());
                        }

                        if (reader["IdContactEmdepAffinity"] != DBNull.Value)
                        {
                            people.IdContactEmdepAffinity = Convert.ToInt32(reader["IdContactEmdepAffinity"].ToString());
                            people.EmdepAffinity = new LookupValue();
                            people.EmdepAffinity.IdLookupValue = Convert.ToInt32(reader["IdContactEmdepAffinity"].ToString());
                            people.EmdepAffinity.Value = reader["EmdepAffinity"].ToString();
                            people.EmdepAffinity.HtmlColor = reader["EmdepAffinityHtmlcolor"].ToString();

                            if (reader["EmdepAffinityIdImage"] != DBNull.Value)
                                people.EmdepAffinity.IdImage = Convert.ToInt64(reader["EmdepAffinityIdImage"].ToString());
                        }

                        if (reader["IdContactProductInvolved"] != DBNull.Value)
                        {
                            people.IdContactProductInvolved = Convert.ToInt32(reader["IdContactProductInvolved"].ToString());
                            people.ProductInvolved = new LookupValue();
                            people.ProductInvolved.IdLookupValue = Convert.ToInt32(reader["IdContactProductInvolved"].ToString());
                            people.ProductInvolved.Value = reader["ProductInvolved"].ToString();
                            people.ProductInvolved.HtmlColor = reader["ProductInvolvedLevelHtmlcolor"].ToString();

                            if (reader["ProductInvolvedLevelIdImage"] != DBNull.Value)
                                people.ProductInvolved.IdImage = Convert.ToInt64(reader["ProductInvolvedLevelIdImage"].ToString());
                        }

                        if (reader["IdCompetitor"] != DBNull.Value)
                        {
                            people.IdCompetitor = Convert.ToInt32(reader["IdCompetitor"].ToString());
                            people.Competitor = new Competitor();
                            people.Competitor.IdCompetitor = Convert.ToInt32(reader["IdCompetitor"].ToString());
                            people.Competitor.Name = reader["Competitor"].ToString();
                        }


                        if (reader["IdCreator"] != DBNull.Value)
                        {
                            people.IdCreator = Convert.ToInt32(reader["IdCreator"].ToString());
                            people.Creator = new People();
                            people.Creator.IdPerson = Convert.ToInt32(reader["IdCreator"].ToString());
                            people.Creator.Name = Convert.ToString(reader["CreatedByFirstName"].ToString());
                            people.Creator.Surname = Convert.ToString(reader["CreatedByLastName"].ToString());
                        }

                        peoples.Add(people);
                    }
                    if (reader.NextResult())
                    {
                        while (reader.Read())
                        {
                            People saleowner = new People();
                            if (reader["IdPerson"] != DBNull.Value)
                            {
                                People people = peoples.Where(i => i.IdPerson == Convert.ToInt64(reader["IdPerson"].ToString())).FirstOrDefault();
                                if (people.Company.SalesOwnerList == null)
                                    people.Company.SalesOwnerList = new List<People>();
                                if (idPermission == 21 || idPermission == 22)
                                {
                                    if (reader["IdSiteSalesOwner"] != DBNull.Value)
                                    {
                                        //people.Company.IdSalesResponsible = Convert.ToInt32(reader["IdSalesResponsible"]);

                                        saleowner.IdPerson = Convert.ToInt32(reader["IdSalesOwner"]);

                                        if (reader["IdSite"] != DBNull.Value)
                                            saleowner.IdSite = Convert.ToInt32(reader["IdSite"]);

                                        if (reader["IsMainSalesOwner"] != DBNull.Value)
                                        {
                                            int i = Convert.ToInt32(reader["IsMainSalesOwner"]);
                                            if (i == 1)
                                                saleowner.IsSalesResponsible = true;
                                        }
                                        if (reader["salesresponsiblename"] != DBNull.Value)
                                        {
                                            saleowner.Name = Convert.ToString(reader["salesresponsiblename"]);
                                            if (people.SalesOwner == null)
                                                people.SalesOwner = saleowner.Name;
                                            else
                                                people.SalesOwner = people.SalesOwner + "\n" + saleowner.Name;
                                        }
                                    }
                                }
                                people.Company.SalesOwnerList.Add(saleowner);
                            }
                        }
                    }
                }
            }
            return peoples;
        }

        //[Sudhir.Jangra][GEOS2-4676][28/08/2023]
        public List<Country> GetAllCountriesDetails(string connectionstring, string countryIconFilePath)
        {

            List<Country> countries = new List<Country>();
            List<string> countryISOs = new List<string>();
            using (MySqlConnection conCountry = new MySqlConnection(connectionstring))
            {
                conCountry.Open();
                //string query = "select name, idCountry from countries order by name;";
                MySqlCommand conCountrycommand = new MySqlCommand("CRM_GetCountriesDetails", conCountry);
                conCountrycommand.CommandType = CommandType.StoredProcedure;
                using (MySqlDataReader countryreader = conCountrycommand.ExecuteReader())
                {
                    while (countryreader.Read())
                    {
                        Country country = new Country();

                        if (countryreader["idCountry"] != DBNull.Value)
                            country.IdCountry = Convert.ToByte(countryreader["idCountry"].ToString());

                        if (countryreader["name"] != DBNull.Value)
                            country.Name = countryreader["name"].ToString();

                        if (countryreader["iso"] != DBNull.Value)
                            country.Iso = countryreader["iso"].ToString();

                        if (countryreader["iso3"] != DBNull.Value)
                            country.Iso3 = countryreader["iso3"].ToString();

                        if (countryreader["mainLanguage"] != DBNull.Value)
                            country.MainLanguage = countryreader["mainLanguage"].ToString();

                        if (countryreader["Observations"] != DBNull.Value)
                            country.Observations = countryreader["Observations"].ToString();

                        if (countryreader["numcode"] != DBNull.Value)
                            country.Numcode = Convert.ToInt16(countryreader["numcode"].ToString());

                        if (countryreader["StandardVAT"] != DBNull.Value)
                            country.StandardVAT = (float)Convert.ToDecimal(countryreader["StandardVAT"].ToString());

                        if (countryreader["IdCurrency"] != DBNull.Value)
                            country.IdCurrency = Convert.ToSByte(countryreader["IdCurrency"].ToString());

                        if (countryreader["IdZone"] != DBNull.Value)
                            country.IdZone = Convert.ToInt32(countryreader["IdZone"].ToString());

                        if (countryreader["IdRegion"] != DBNull.Value)
                            country.IdRegion = Convert.ToInt32(countryreader["IdRegion"].ToString());

                        if (!countryISOs.Any(co => co.ToString() == country.Iso))
                            countryISOs.Add(country.Iso);

                        countries.Add(country);
                    }
                }
            }

            //foreach (string item in countryISOs)
            //{
            //    byte[] bytes = null;
            //    bytes = GetCountryIconFileInBytes(item, countryIconFilePath);
            //    countries.Where(ot => ot.Iso == item).ToList().ForEach(ot => ot.CountryIconBytes = bytes);
            //}
            return countries;
        }

        //[Sudhir.Jangra][GEOS2-4676][28/08/2023]
        public List<Company> GetAllCustomerCompanies(string connectionstring)
        {
            List<Company> companies = new List<Company>();

            using (MySqlConnection consite = new MySqlConnection(connectionstring))
            {
                consite.Open();
                MySqlCommand consitecommand = new MySqlCommand("sites_GetAllSites", consite);
                consitecommand.CommandType = CommandType.StoredProcedure;
                using (MySqlDataReader sitereader = consitecommand.ExecuteReader())
                {
                    while (sitereader.Read())
                    {
                        Company company = new Company();
                        company.IdCompany = Convert.ToInt32(sitereader["IdCompany"].ToString());
                        company.Name = sitereader["SiteName"].ToString();

                        if (sitereader["IdCustomer"] != DBNull.Value)
                        {
                            company.IdCustomer = Convert.ToInt32(sitereader["IdCustomer"].ToString());
                            Customer customer = new Customer();
                            customer.IdCustomer = Convert.ToInt32(sitereader["IdCustomer"].ToString());
                            customer.CustomerName = sitereader["CustomerName"].ToString();

                            company.Customer = customer;
                        }

                        companies.Add(company);
                    }
                }
            }
            return companies;
        }

        //[Sudhir.jangra][GEOS2-4676][28/08/2023]
        public People GetContactsByIdPerson(Int32 idPerson, string connectionstring)
        {
            People people = new People();

            using (MySqlConnection conPeople = new MySqlConnection(connectionstring))
            {
                conPeople.Open();
                MySqlCommand conPeoplecommand = new MySqlCommand("people_GetContactsByIdPerson", conPeople);

                conPeoplecommand.CommandType = CommandType.StoredProcedure;
                conPeoplecommand.Parameters.AddWithValue("_idPerson", idPerson);
                using (MySqlDataReader peopleReader = conPeoplecommand.ExecuteReader())
                {
                    while (peopleReader.Read())
                    {
                        people.IdPerson = Convert.ToInt32(peopleReader["IdPerson"].ToString());
                        people.Name = peopleReader["FirstName"].ToString();
                        people.Surname = peopleReader["LastName"].ToString();
                        people.Phone = peopleReader["Telephone"].ToString();
                        people.Email = peopleReader["Email"].ToString();

                        if (peopleReader["IdPersonGender"] != DBNull.Value)
                        {
                            people.IdPersonGender = Convert.ToByte(peopleReader["IdPersonGender"].ToString());
                            if (people.IdPersonGender == 1)
                                people.UserGender = "Female";
                            else if (people.IdPersonGender == 2)
                                people.UserGender = "Male";
                        }

                        people.Company = new Company() { IdCompany = Convert.ToInt32(peopleReader["IdCompany"].ToString()), Name = peopleReader["CustomerPlant"].ToString(), Country = new Country { IdCountry = Convert.ToByte(peopleReader["IdCountry"].ToString()), Name = peopleReader["Country"].ToString(), Zone = new Zone { Name = peopleReader["Zone"].ToString() } } };
                        people.Company.Address = peopleReader["SiteAddress"].ToString();
                        people.Observations = peopleReader["Observations"].ToString();
                        people.Company.City = peopleReader["SiteCity"].ToString();
                        people.Company.CIF = peopleReader["SiteCIF"].ToString();
                        people.Company.Telephone = peopleReader["SiteTelephone"].ToString();
                        people.Company.Fax = peopleReader["SiteFax"].ToString();
                        people.Company.PostCode = peopleReader["SitePostCode"].ToString();
                        people.Company.ZipCode = peopleReader["SitePostCode"].ToString();
                        people.Company.Region = peopleReader["SiteRegion"].ToString();
                        people.Company.RegisteredName = peopleReader["SiteRegisteredName"].ToString();
                        people.Company.Website = peopleReader["SiteWebsite"].ToString();
                        people.Company.Customers = new List<Customer> { new Customer { IdCustomer = Convert.ToInt32(peopleReader["IdCustomer"].ToString()), CustomerName = peopleReader["CustomerGroup"].ToString() } };

                        if (peopleReader["IdPersonType"] != DBNull.Value)
                        {
                            people.PeopleType = new PeopleType();
                            people.IdPersonType = Convert.ToByte(peopleReader["IdPersonType"].ToString());
                            people.PeopleType.IdPersonType = Convert.ToByte(peopleReader["IdPersonType"].ToString());
                            people.PeopleType.Name = peopleReader["PersonTypeName"].ToString();
                        }

                        if (peopleReader["CreatedIn"] != DBNull.Value)
                            people.CreatedIn = Convert.ToDateTime(peopleReader["CreatedIn"].ToString());

                        if (peopleReader["IdCompanyDepartment"] != DBNull.Value)
                        {
                            people.IdCompanyDepartment = Convert.ToInt32(peopleReader["IdCompanyDepartment"].ToString());
                            people.CompanyDepartment = new LookupValue();
                            people.CompanyDepartment.IdLookupValue = Convert.ToInt32(peopleReader["IdCompanyDepartment"].ToString());
                            people.CompanyDepartment.Value = peopleReader["Value"].ToString();

                            if (peopleReader["IdImage"] != DBNull.Value)
                                people.CompanyDepartment.IdImage = Convert.ToInt64(peopleReader["IdImage"].ToString());

                            //if (sitereader["InUse"] != DBNull.Value)
                            //    people.CompanyDepartment.InUse = Convert.ToBoolean(sitereader["InUse"].ToString());
                        }

                        people.JobTitle = peopleReader["JobTitle"].ToString();
                        people.ImageText = peopleReader["Image"].ToString();

                        if (peopleReader["IdContactInfluenceLevel"] != DBNull.Value)
                        {
                            people.IdContactInfluenceLevel = Convert.ToInt32(peopleReader["IdContactInfluenceLevel"].ToString());
                            people.InfluenceLevel = new LookupValue();
                            people.InfluenceLevel.IdLookupValue = Convert.ToInt32(peopleReader["IdContactInfluenceLevel"].ToString());
                            people.InfluenceLevel.Value = peopleReader["InfluenceLevel"].ToString();
                            people.InfluenceLevel.HtmlColor = peopleReader["InfluenceLevelHtmlcolor"].ToString();

                            if (peopleReader["InfluenceLevelIdImage"] != DBNull.Value)
                                people.InfluenceLevel.IdImage = Convert.ToInt64(peopleReader["InfluenceLevelIdImage"].ToString());

                            //if (peoplereader["InfluenceLevelInUse"] != DBNull.Value)
                            //    people.InfluenceLevel.InUse = Convert.ToBoolean(peoplereader["InfluenceLevelInUse"].ToString());
                        }

                        if (peopleReader["IdContactEmdepAffinity"] != DBNull.Value)
                        {
                            people.IdContactEmdepAffinity = Convert.ToInt32(peopleReader["IdContactEmdepAffinity"].ToString());
                            people.EmdepAffinity = new LookupValue();
                            people.EmdepAffinity.IdLookupValue = Convert.ToInt32(peopleReader["IdContactEmdepAffinity"].ToString());
                            people.EmdepAffinity.Value = peopleReader["EmdepAffinity"].ToString();
                            people.EmdepAffinity.HtmlColor = peopleReader["EmdepAffinityHtmlcolor"].ToString();

                            if (peopleReader["EmdepAffinityIdImage"] != DBNull.Value)
                                people.EmdepAffinity.IdImage = Convert.ToInt64(peopleReader["EmdepAffinityIdImage"].ToString());

                            //if (peoplereader["EmdepAffinityInUse"] != DBNull.Value)
                            //    people.EmdepAffinity.InUse = Convert.ToBoolean(peoplereader["EmdepAffinityInUse"].ToString());
                        }


                        if (peopleReader["IdContactProductInvolved"] != DBNull.Value)
                        {
                            people.IdContactProductInvolved = Convert.ToInt32(peopleReader["IdContactProductInvolved"].ToString());
                            people.ProductInvolved = new LookupValue();
                            people.ProductInvolved.IdLookupValue = Convert.ToInt32(peopleReader["IdContactProductInvolved"].ToString());
                            people.ProductInvolved.Value = peopleReader["ProductInvolved"].ToString();
                            people.ProductInvolved.HtmlColor = peopleReader["ProductInvolvedLevelHtmlcolor"].ToString();

                            if (peopleReader["ProductInvolvedLevelIdImage"] != DBNull.Value)
                                people.ProductInvolved.IdImage = Convert.ToInt64(peopleReader["ProductInvolvedLevelIdImage"].ToString());

                            //if (peoplereader["ProductInvolvedInUse"] != DBNull.Value)
                            //    people.ProductInvolved.InUse = Convert.ToBoolean(peoplereader["ProductInvolvedInUse"].ToString());
                        }

                        if (peopleReader["IdCompetitor"] != DBNull.Value)
                        {
                            people.IdCompetitor = Convert.ToInt32(peopleReader["IdCompetitor"].ToString());
                            people.Competitor = new Competitor();
                            people.Competitor.IdCompetitor = Convert.ToInt32(peopleReader["IdCompetitor"].ToString());
                            people.Competitor.Name = peopleReader["Competitor"].ToString();
                        }
                    }
                }
            }

            return people;
        }

        //[Sudhir.Jangra][GEOS2-4676][28/08/2023]
        public List<Offer> GetOffersByIdSiteToLinkedWithActivities(byte idCurrency, Int32 idUser, Int64 accountingYear, Company compdetails, Int32 idUserPermission, Int32 idSite)
        {
            List<Offer> offers = new List<Offer>();

            //DataSet ds = new DataSet();

            using (MySqlConnection connOffersByIdSiteForActivities = new MySqlConnection(compdetails.ConnectPlantConstr))
            {
                connOffersByIdSiteForActivities.Open();
                MySqlCommand offersCommand = new MySqlCommand("offers_GetOffersByIdSiteForActivities", connOffersByIdSiteForActivities);
                offersCommand.CommandType = CommandType.StoredProcedure;
                offersCommand.Parameters.AddWithValue("_idcurrency", idCurrency);
                offersCommand.Parameters.AddWithValue("_idUser", idUser);
                offersCommand.Parameters.AddWithValue("_accountingYear", accountingYear);
                offersCommand.Parameters.AddWithValue("_idPermission", idUserPermission);
                offersCommand.Parameters.AddWithValue("_IdSite", idSite);
                MySqlDataAdapter da = new MySqlDataAdapter(offersCommand);
                //DataSet ds = new DataSet();
                //da.Fill(ds);

                using (MySqlDataReader itemRow = offersCommand.ExecuteReader())
                {
                    if (itemRow.HasRows)
                    {
                        while (itemRow.Read())
                        {
                            Offer offer = new Offer();

                            offer.IdOffer = Convert.ToInt64(itemRow["idoffer"].ToString());

                            if (itemRow["IdSalesOwner"] != DBNull.Value)
                            {
                                offer.IdSalesOwner = Convert.ToInt32(itemRow["IdSalesOwner"].ToString());
                            }

                            offer.IdOfferType = Convert.ToByte(itemRow["IdOfferType"].ToString());
                            offer.Code = itemRow["OfferCode"].ToString();
                            offer.Description = itemRow["OfferTitle"].ToString();

                            offer.Site = new Company { IdCompany = Convert.ToInt32(itemRow["IdSite"].ToString()), Name = itemRow["SiteName"].ToString() };

                            if (itemRow["IdSalesResponsible"] != DBNull.Value)
                            {
                                offer.Site.IdSalesResponsible = Convert.ToInt32(itemRow["IdSalesResponsible"].ToString());
                            }

                            if (itemRow["IdSalesResponsibleAssemblyBU"] != DBNull.Value)
                            {
                                offer.Site.IdSalesResponsibleAssemblyBU = Convert.ToInt32(itemRow["IdSalesResponsibleAssemblyBU"].ToString());
                            }

                            offer.Site.ConnectPlantId = compdetails.ConnectPlantId;
                            offer.Site.Alias = compdetails.ShortName;

                            offer.Site.Customers = new List<Customer> { new Customer { IdCustomer = Convert.ToInt32(itemRow["IdCustomer"].ToString()), CustomerName = itemRow["CustomerGroup"].ToString() } };
                            offer.Site.Country = new Country { Name = itemRow["CustomerCountry"].ToString(), Zone = new Zone { Name = itemRow["CustomerZone"].ToString() } };
                            offer.GeosStatus = new GeosStatus { IdOfferStatusType = Convert.ToInt64(itemRow["OfferStatusid"].ToString()), Name = itemRow["OfferStatus"].ToString(), HtmlColor = itemRow["OfferStatusColor"].ToString(), SalesStatusType = new SalesStatusType { IdSalesStatusType = Convert.ToInt64(itemRow["IdSalesStatusType"].ToString()), Name = itemRow["SalesStatusType"].ToString(), HtmlColor = itemRow["SalesStatusTypeColor"].ToString() } };
                            offer.Value = Convert.ToDouble(itemRow["OfferAmount"].ToString());

                            offer.Currency = new Currency { IdCurrency = Convert.ToByte(itemRow["IdCurrency"].ToString()), Name = itemRow["OfferCurrency"].ToString() };
                            if (itemRow["OfferConfidentialLevel"] != DBNull.Value)
                                offer.ProbabilityOfSuccess = Convert.ToSByte(itemRow["OfferConfidentialLevel"].ToString());

                            //if (itemRow["OfferExpectedPODate"] != DBNull.Value)
                            //    offer.DeliveryDate = Convert.ToDateTime(itemRow["OfferExpectedPODate"].ToString());
                            //else
                            //    offer.DeliveryDate = null;

                            //if (itemRow["Rfq"] != DBNull.Value)
                            //    offer.Rfq = itemRow["Rfq"].ToString();

                            //if (itemRow["RFQReception"] != DBNull.Value)
                            //    offer.RFQReception = Convert.ToDateTime(itemRow["RFQReception"].ToString());
                            //else
                            //    offer.RFQReception = null;

                            //if (itemRow["SendIn"] != DBNull.Value)
                            //    offer.SendIn = Convert.ToDateTime(itemRow["SendIn"].ToString());
                            //else
                            //    offer.SendIn = null;

                            //if (itemRow["IdSource"] != DBNull.Value)
                            //{
                            //    offer.IdSource = Convert.ToByte(itemRow["IdSource"].ToString());
                            //    offer.Source = new LookupValue { IdLookupValue = Convert.ToInt32(itemRow["IdSource"].ToString()), Value = itemRow["Source"].ToString() };
                            //}

                            //if (itemRow["IdBusinessUnit"] != DBNull.Value)
                            //{
                            //    offer.IdBusinessUnit = Convert.ToByte(itemRow["IdBusinessUnit"].ToString());
                            //    offer.BusinessUnit = new LookupValue { IdLookupValue = Convert.ToInt32(itemRow["IdBusinessUnit"].ToString()), Value = itemRow["BusinessUnit"].ToString() };
                            //}

                            //if (itemRow["IdProject"] != DBNull.Value)
                            //{
                            //    offer.IdProject = Convert.ToInt32(itemRow["IdProject"].ToString());
                            //    offer.Projects = new List<Project>();
                            //    Project project = new Project();
                            //    project.IdProject = Convert.ToInt32(itemRow["IdProject"].ToString());
                            //    project.ProjectCode = itemRow["Code"].ToString();
                            //    project.ProjectName = itemRow["Title"].ToString();
                            //    offer.Projects.Add(project);
                            //}

                            //if (itemRow["IdCarProject"] != DBNull.Value)
                            //{
                            //    offer.IdCarProject = Convert.ToInt64(itemRow["IdCarProject"].ToString());
                            //    offer.CarProject = new CarProject();

                            //    offer.CarProject.IdCarProject = Convert.ToInt32(itemRow["IdCarProject"].ToString());
                            //    offer.CarProject.Name = itemRow["CarProjectName"].ToString();
                            //}

                            //if (itemRow["IdCarOEM"] != DBNull.Value)
                            //{
                            //    offer.IdCarOEM = Convert.ToInt32(itemRow["IdCarOEM"].ToString());
                            //    offer.CarOEM = new CarOEM();
                            //    offer.CarOEM.IdCarOEM = Convert.ToInt32(itemRow["IdCarOEM"].ToString());
                            //    offer.CarOEM.Name = itemRow["CarOEM"].ToString();
                            //}

                            offers.Add(offer);
                        }
                    }
                }
            }

            return offers;
        }

        //[Sudhir.Jangra][GEOS2-4676][28/08/2023]
        public List<Activity> GetActivitiesByIdSite(Int32 idSite, string mainconnectionstring)
        {
            List<Activity> listActivity = new List<Activity>();

            using (MySqlConnection congetactivities = new MySqlConnection(mainconnectionstring))
            {
                congetactivities.Open();
                MySqlCommand congetactivitiescommand = new MySqlCommand("activities_GetactivitiesByIdSite", congetactivities);
                congetactivitiescommand.CommandType = CommandType.StoredProcedure;
                congetactivitiescommand.Parameters.AddWithValue("_IdSite", idSite);
                using (MySqlDataReader activityreader = congetactivitiescommand.ExecuteReader())
                {
                    while (activityreader.Read())
                    {
                        Activity activity = new Activity();
                        activity.IdActivity = Convert.ToInt64(activityreader["IdActivity"].ToString());
                        activity.Subject = activityreader["Subject"].ToString();
                        activity.Description = activityreader["Description"].ToString();

                        if (activityreader["IdActivityType"] != DBNull.Value)
                        {
                            activity.LookupValue = new LookupValue();
                            activity.LookupValue.IdLookupValue = Convert.ToInt32(activityreader["IdActivityType"].ToString());
                            activity.LookupValue.Value = activityreader["ActivityType"].ToString();
                            activity.LookupValue.HtmlColor = activityreader["ActivityTypeHtmlColor"].ToString();
                            if (activityreader["ActivityTypeImage"] != DBNull.Value)
                                activity.LookupValue.IdImage = Convert.ToInt64(activityreader["ActivityTypeImage"].ToString());
                            if (activityreader["ActivityTypePosition"] != DBNull.Value)
                                activity.LookupValue.Position = Convert.ToInt32(activityreader["ActivityTypePosition"].ToString());
                        }

                        if (activityreader["FromDate"] != DBNull.Value)
                            activity.FromDate = Convert.ToDateTime(activityreader["FromDate"].ToString());

                        if (activityreader["ToDate"] != DBNull.Value)
                            activity.ToDate = Convert.ToDateTime(activityreader["ToDate"].ToString());

                        if (activityreader["CloseDate"] != DBNull.Value)
                            activity.CloseDate = Convert.ToDateTime(activityreader["CloseDate"].ToString());

                        activity.Location = activityreader["Location"].ToString();

                        if (activityreader["IdOwner"] != DBNull.Value)
                            activity.IdOwner = Convert.ToInt32(activityreader["IdOwner"].ToString());

                        if (activityreader["IdOwner"] != DBNull.Value)
                        {
                            activity.People = new People();
                            activity.People.Name = activityreader["Name"].ToString();
                            activity.People.Surname = activityreader["Surname"].ToString();
                        }

                        if (activityreader["Latitude"] != DBNull.Value)
                            activity.Latitude = Convert.ToDouble(activityreader["Latitude"].ToString());
                        if (activityreader["Longitude"] != DBNull.Value)
                            activity.Longitude = Convert.ToDouble(activityreader["Longitude"].ToString());
                        if (activityreader["IsCompleted"] != DBNull.Value)
                        {
                            activity.IsCompleted = Convert.ToByte(activityreader["IsCompleted"].ToString());

                            //close filled when completing some activity.
                            if (activity.IsCompleted == 1)
                            {
                                activity.ActivityGridStatus = "Completed";

                                if (activityreader["CloseDate"] != DBNull.Value)
                                    activity.CloseDate = Convert.ToDateTime(activityreader["CloseDate"].ToString());
                            }
                        }

                        if (activityreader["IdActivityStatus"] != DBNull.Value)
                        {
                            activity.ActivityStatus = new LookupValue();
                            activity.ActivityStatus.IdLookupValue = Convert.ToInt32(activityreader["IdActivityStatus"].ToString());
                            activity.ActivityStatus.Value = activityreader["ActivityStatus"].ToString();
                            activity.ActivityStatus.HtmlColor = activityreader["ActivityStatusHtmlColor"].ToString();

                            if (activityreader["ActivityStatusImage"] != DBNull.Value)
                                activity.ActivityStatus.IdImage = Convert.ToInt64(activityreader["ActivityStatusImage"].ToString());

                            if (activityreader["ActivityStatusPosition"] != DBNull.Value)
                                activity.ActivityStatus.Position = Convert.ToInt32(activityreader["ActivityStatusPosition"].ToString());

                            if (activity.ActivityStatus.IdLookupValue == 48)
                            {
                                activity.ActivityGridStatus = "Completed";
                            }
                            else
                            {
                                activity.ActivityGridStatus = activityreader["ActivityStatus"].ToString();
                            }
                        }
                        listActivity.Add(activity);
                    }
                }
            }

            return listActivity;
        }

        //[Sudhir.Jangra][GEOS2-4676][28/08/2023]
        public List<LogEntryBySite> GetAllLogEntriesByIdSite(Int64 idSite, string connectionString)
        {
            List<LogEntryBySite> logEntries = new List<LogEntryBySite>();
            //using (var workbenchcontext = new WorkbenchContext())
            //{
            using (MySqlConnection conoffer = new MySqlConnection(connectionString))
            {
                conoffer.Open();

                MySqlCommand conoffercommand = new MySqlCommand("logentry_GetAllLogEntriesByIdSite", conoffer);
                conoffercommand.CommandType = CommandType.StoredProcedure;
                conoffercommand.Parameters.AddWithValue("_idSite", idSite);
                using (MySqlDataReader reader = conoffercommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        LogEntryBySite logEntryBySite = new LogEntryBySite();
                        logEntryBySite.IdLogEntryBySite = Convert.ToInt64(reader["IdLogEntriesBySite"].ToString());
                        // logEntryBySite.IdLogEntryType = Convert.ToByte(reader["idLogEntryType"].ToString());
                        logEntryBySite.IdSite = Convert.ToInt64(reader["IdSite"].ToString());
                        logEntryBySite.IdUser = Convert.ToInt32(reader["IdUser"].ToString());
                        logEntryBySite.People = new People { IdPerson = Convert.ToInt32(reader["IdUser"].ToString()), Name = reader["Name"].ToString(), Surname = reader["Surname"].ToString() };
                        logEntryBySite.DateTime = Convert.ToDateTime(reader["DateTime"].ToString());
                        logEntryBySite.Comments = reader["comments"].ToString();
                        logEntryBySite.IsDeleted = false;
                        logEntries.Add(logEntryBySite);
                    }
                }
                //}
            }
            return logEntries;
        }


        //[Sudhir.Jangra][GEOS2-4676][28/08/2023]
        public List<Country> GetCountries(string connectionstring)
        {
            List<Country> countries = new List<Country>();

            using (MySqlConnection conofferwithoutpurchaseorder = new MySqlConnection(connectionstring))
            {
                conofferwithoutpurchaseorder.Open();
                MySqlCommand conofferwithoutpurchaseordercommand = new MySqlCommand("countries_GetCountriesDetails", conofferwithoutpurchaseorder);
                conofferwithoutpurchaseordercommand.CommandType = CommandType.StoredProcedure;

                using (MySqlDataReader offerreader = conofferwithoutpurchaseordercommand.ExecuteReader())
                {
                    while (offerreader.Read())
                    {
                        Country country = new Country();
                        country.IdCountry = Convert.ToByte(offerreader["idCountry"].ToString());
                        country.Name = offerreader["CountryName"].ToString();
                        country.Zone = new Zone();
                        country.Zone.IdZone = Convert.ToInt32(offerreader["IdZone"].ToString());
                        country.Zone.Name = offerreader["ZoneName"].ToString();
                        countries.Add(country);
                    }
                }
            }

            return countries;
        }

        //[Sudhir.Jangra][GEOS2-4676][29/08/2023]
        public List<Customer> GetSelectedUserCompanyGroup_V2420(string connectionString, string idUser, bool isIncludeDefault = false)
        {
            List<Customer> customers = new List<Customer>();
            if (isIncludeDefault)
            {
                Customer customerDefault = new Customer();
                customerDefault.IdCustomer = 0;
                customerDefault.CustomerName = "---";
                customers.Add(customerDefault);
            }

            using (MySqlConnection myConnection = new MySqlConnection(connectionString))
            {
                myConnection.Open();
                MySqlCommand myCommand = new MySqlCommand("customers_GetSelectedUserCompanyGroup_V2420", myConnection);
                myCommand.CommandType = System.Data.CommandType.StoredProcedure;
                myCommand.Parameters.AddWithValue("_idUser", idUser);

                using (MySqlDataReader reader = myCommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        Customer customer = new Customer();
                        customer.IdCustomer = Convert.ToInt32(reader["IdCustomer"].ToString());
                        customer.CustomerName = reader["Name"].ToString();
                        customers.Add(customer);
                    }
                }

            }

            return customers;
        }

        //[sudhir.Jangra][GEOS2-4676][29/08/2023]
        public List<Customer> GetCompanyGroup_V2420(string connectionString, Int32 idUser, Int32 idZone, Int32 idUserPermission, bool isIncludeDefault = false)
        {
            List<Customer> customers = new List<Customer>();
            if (isIncludeDefault)
            {
                Customer customerDefault = new Customer();
                customerDefault.IdCustomer = 0;
                customerDefault.CustomerName = "---";
                customers.Add(customerDefault);
            }

            using (MySqlConnection myConnection = new MySqlConnection(connectionString))
            {
                myConnection.Open();
                MySqlCommand myCommand = new MySqlCommand("customers_GetCompanyGroup_V2420", myConnection);
                myCommand.CommandType = System.Data.CommandType.StoredProcedure;
                myCommand.Parameters.AddWithValue("_idUser", idUser);
                myCommand.Parameters.AddWithValue("_idZone", idZone);
                myCommand.Parameters.AddWithValue("_idPermission", idUserPermission);
                using (MySqlDataReader reader = myCommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        Customer customer = new Customer();
                        customer.IdCustomer = Convert.ToInt32(reader["IdCustomer"].ToString());
                        customer.CustomerName = reader["Name"].ToString();
                        customers.Add(customer);
                    }
                }

            }

            return customers;
        }

        //[Sudhir.Jangra][GEOS2-4676][29/08/2023]
        public List<Company> GetSelectedUserCompanyPlantByIdUser_V2420(string connectionString, string idUser, bool isIncludeDefault = false)
        {
            List<Company> companies = new List<Company>();
            if (isIncludeDefault)
            {
                Company companyDefault = new Company();
                companyDefault.IdCompany = 0;
                companyDefault.Name = "---";
                companyDefault.SiteNameWithoutCountry = "---";
                companies.Add(companyDefault);
            }

            using (MySqlConnection myConnection = new MySqlConnection(connectionString))
            {
                myConnection.Open();
                MySqlCommand myCommand = new MySqlCommand("sites_GetSelectedUserCompanyPlantByIdUser_V2420", myConnection);
                myCommand.CommandType = System.Data.CommandType.StoredProcedure;

                myCommand.Parameters.AddWithValue("_idUser", idUser);

                using (MySqlDataReader reader = myCommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        Company company = new Company();
                        company.IdCompany = Convert.ToInt32(reader["IdSite"].ToString());
                        company.Name = reader["Name"].ToString();
                        company.Country = new Country { IdCountry = Convert.ToByte(reader["idCountry"].ToString()), Name = reader["Country"].ToString(), Zone = new Zone { IdZone = Convert.ToInt32(reader["IdZone"].ToString()), Name = reader["Zone"].ToString() } };
                        company.IdCountry = Convert.ToByte(reader["idCountry"].ToString());
                        company.Address = reader["Address"].ToString();
                        company.City = reader["City"].ToString();
                        company.Region = reader["Region"].ToString();
                        company.ZipCode = reader["PostCode"].ToString();
                        company.Telephone = reader["Telephone"].ToString();
                        company.SiteNameWithoutCountry = reader["SiteName"].ToString();

                        if (reader["SalesOwner"] != DBNull.Value)
                            company.IdSalesResponsible = Convert.ToInt32(reader["SalesOwner"].ToString());

                        //if (reader["IdSalesResponsibleAssemblyBU"] != DBNull.Value)
                        //    company.IdSalesResponsibleAssemblyBU = Convert.ToInt32(reader["IdSalesResponsibleAssemblyBU"].ToString());

                        if (reader["Latitude"] != DBNull.Value)
                            company.Latitude = Convert.ToDouble(reader["Latitude"].ToString());

                        if (reader["Longitude"] != DBNull.Value)
                            company.Longitude = Convert.ToDouble(reader["Longitude"].ToString());

                        if (reader["IdCustomer"] != DBNull.Value)
                            company.IdCustomer = Convert.ToInt32(reader["IdCustomer"].ToString());

                        companies.Add(company);
                    }
                }
            }
            return companies;
        }

        //[Sudhir.Jangra][GEOS2-4676][29/08/2023]
        public List<Company> GetCompanyPlantByUserId_V2420(string connectionString, Int32 idUser, Int32 idZone, Int32 idUserPermission, bool isIncludeDefault = false)
        {
            List<Company> companies = new List<Company>();
            if (isIncludeDefault)
            {
                Company companyDefault = new Company();
                companyDefault.IdCompany = 0;
                companyDefault.Name = "---";
                companyDefault.SiteNameWithoutCountry = "---";
                companies.Add(companyDefault);
            }

            using (MySqlConnection myConnection = new MySqlConnection(connectionString))
            {
                myConnection.Open();
                MySqlCommand myCommand = new MySqlCommand("sites_GetCompanyPlantByUserId_V2420", myConnection);
                myCommand.CommandType = System.Data.CommandType.StoredProcedure;

                myCommand.Parameters.AddWithValue("_idUser", idUser);
                myCommand.Parameters.AddWithValue("_idZone", idZone);
                myCommand.Parameters.AddWithValue("_idPermission", idUserPermission);

                using (MySqlDataReader reader = myCommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        Company company = new Company();
                        company.IdCompany = Convert.ToInt32(reader["IdSite"].ToString());
                        company.Name = reader["Name"].ToString();
                        company.Country = new Country { IdCountry = Convert.ToByte(reader["idCountry"].ToString()), Name = reader["Country"].ToString(), Zone = new Zone { IdZone = Convert.ToInt32(reader["IdZone"].ToString()), Name = reader["Zone"].ToString() } };
                        company.IdCountry = Convert.ToByte(reader["idCountry"].ToString());
                        company.Address = reader["Address"].ToString();
                        company.City = reader["City"].ToString();
                        company.Region = reader["Region"].ToString();
                        company.ZipCode = reader["PostCode"].ToString();
                        company.Telephone = reader["Telephone"].ToString();
                        company.SiteNameWithoutCountry = reader["SiteName"].ToString();

                        if (reader["IdCustomer"] != DBNull.Value)
                            company.IdCustomer = Convert.ToInt32(reader["IdCustomer"].ToString());

                        if (reader["SalesOwner"] != DBNull.Value)
                            company.IdSalesResponsible = Convert.ToInt32(reader["SalesOwner"].ToString());

                        //if (reader["IdSalesResponsibleAssemblyBU"] != DBNull.Value)
                        //    company.IdSalesResponsibleAssemblyBU = Convert.ToInt32(reader["IdSalesResponsibleAssemblyBU"].ToString());

                        if (reader["Latitude"] != DBNull.Value)
                            company.Latitude = Convert.ToDouble(reader["Latitude"].ToString());

                        if (reader["Longitude"] != DBNull.Value)
                            company.Longitude = Convert.ToDouble(reader["Longitude"].ToString());

                        companies.Add(company);
                    }
                }

            }
            return companies;
        }

        //[Sudhir.Jangra][GEOS2-4676][29/08/2023]
        public List<People> GetSalesOwnerBySiteId_V2390(string connectionstring, Int32 idSite)
        {
            List<People> peoples = new List<People>();
            using (MySqlConnection conPeople = new MySqlConnection(connectionstring))
            {
                conPeople.Open();
                MySqlCommand conPeoplecommand = new MySqlCommand("sites_GetSalesOwnerBySiteId_V2390", conPeople);
                conPeoplecommand.CommandType = CommandType.StoredProcedure;
                conPeoplecommand.Parameters.AddWithValue("_idSite", idSite);
                using (MySqlDataReader peoplereader = conPeoplecommand.ExecuteReader())
                {
                    while (peoplereader.Read())
                    {
                        People people = new People();
                        if (peoplereader["IdSiteSalesOwner"] != DBNull.Value)
                        {
                            people.IdSiteSalesOwner = Convert.ToInt32(peoplereader["IdSiteSalesOwner"].ToString());
                            people.IdPerson = Convert.ToInt32(peoplereader["IdPerson"].ToString());
                            people.Name = peoplereader["Name"].ToString();
                            people.Surname = peoplereader["Surname"].ToString();
                            people.Email = peoplereader["Email"].ToString();
                            people.IdSite = Convert.ToInt32(peoplereader["IdSite"].ToString());
                            if (peoplereader["IsMainSalesOwner"] != DBNull.Value)
                            {
                                int i = Convert.ToInt32(peoplereader["IsMainSalesOwner"]);
                                if (i == 1)
                                {
                                    people.IsSalesResponsible = true;
                                    people.IsSelected = true;
                                }
                            }
                            peoples.Add(people);
                        }
                    }
                }
            }
            return peoples;
        }

        //[Sudhir.Jangra][GEOS2-4676][29/08/2023]
        public List<People> GetSiteContacts(string connectionstring, Int64 idSite)
        {
            List<People> peoples = new List<People>();

            using (MySqlConnection consite = new MySqlConnection(connectionstring))
            {
                consite.Open();
                //string query = "select * from people where IdSite=" + idSite + " and IsStillActive=1;";
                MySqlCommand consitecommand = new MySqlCommand("people_GetSiteContacts", consite);
                consitecommand.CommandType = CommandType.StoredProcedure;
                consitecommand.Parameters.AddWithValue("_idSite", idSite);

                using (MySqlDataReader sitereader = consitecommand.ExecuteReader())
                {
                    while (sitereader.Read())
                    {
                        People people = new People();
                        people.IdPerson = Convert.ToInt32(sitereader["IdPerson"].ToString());
                        people.Name = sitereader["Name"].ToString();
                        people.Surname = sitereader["Surname"].ToString();
                        people.IdPersonType = Convert.ToByte(sitereader["IdPersonType"].ToString());
                        people.Email = sitereader["Email"].ToString();
                        people.IdSite = Convert.ToInt32(sitereader["IdSite"].ToString());
                        people.IsStillActive = Convert.ToByte(sitereader["IsStillActive"].ToString());
                        people.Phone = sitereader["Phone"].ToString();
                        people.Observations = sitereader["Observations"].ToString();
                        if (sitereader["CreatedIn"] != DBNull.Value)
                            people.CreatedIn = Convert.ToDateTime(sitereader["CreatedIn"].ToString());
                        if (sitereader["DisabledIn"] != DBNull.Value)
                            people.DisabledIn = Convert.ToDateTime(sitereader["DisabledIn"].ToString());
                        if (sitereader["IdPersonGender"] != DBNull.Value)
                            people.IdPersonGender = Convert.ToByte(sitereader["IdPersonGender"].ToString());
                        if (sitereader["IdCompanyDepartment"] != DBNull.Value)
                        {
                            people.IdCompanyDepartment = Convert.ToInt32(sitereader["IdCompanyDepartment"].ToString());
                            people.CompanyDepartment = new LookupValue();
                            people.CompanyDepartment.IdLookupValue = Convert.ToInt32(sitereader["IdCompanyDepartment"].ToString());
                            people.CompanyDepartment.Value = sitereader["Value"].ToString();
                            if (sitereader["IdImage"] != DBNull.Value)
                                people.CompanyDepartment.IdImage = Convert.ToInt64(sitereader["IdImage"].ToString());
                            //if (sitereader["InUse"] != DBNull.Value)
                            //    people.CompanyDepartment.InUse = Convert.ToBoolean(sitereader["InUse"].ToString());

                        }
                        people.JobTitle = sitereader["JobTitle"].ToString();
                        people.ImageText = sitereader["Image"].ToString();

                        peoples.Add(people);
                    }
                }
            }
            return peoples;
        }

        //[Sudhir.Jangra][GEOS2-4676][29/08/2023]
        public Company UpdateCompany_V2430(Company company, string mainconnectionstring, string crmconnectionstring)
        {
            Company addedcompany = new Company();
            company.IsUpdate = false;
            company.IsExist = false;
            try
            {
                using (MySqlConnection conoffer = new MySqlConnection(mainconnectionstring))
                {
                    conoffer.Open();
                    //string query = "select IdSite,Name,IdCustomer,IdCountry from sites where IdSite=" + company.IdCompany + ";";
                    MySqlCommand conoffercommand = new MySqlCommand("sites_GetSitesById", conoffer);
                    conoffercommand.CommandType = CommandType.StoredProcedure;
                    conoffercommand.Parameters.AddWithValue("_IdSite", company.IdCompany);

                    using (MySqlDataReader offerreader = conoffercommand.ExecuteReader())
                    {
                        if (offerreader.Read())
                        {
                            addedcompany.IdCompany = Convert.ToInt32(offerreader["IdSite"].ToString());
                            addedcompany.IdCustomer = Convert.ToInt32(offerreader["IdCustomer"].ToString());
                            addedcompany.IdCountry = Convert.ToByte(offerreader["IdCountry"].ToString());
                            addedcompany.Name = offerreader["Name"].ToString();
                        }
                    }
                }
                string sitename = company.Name.Trim() + " (" + company.Country.Name + ")";
                sitename = sitename.ToString().Replace("'", "\"");
                if (addedcompany.Name.ToUpper() == sitename.ToUpper())
                {
                    if (addedcompany.IdCustomer == company.IdCustomer)
                    {
                        company = updateCompany_V2430(company, mainconnectionstring, crmconnectionstring);
                    }
                    else
                    {
                        using (MySqlConnection conoffer = new MySqlConnection(mainconnectionstring))
                        {
                            conoffer.Open();
                            MySqlCommand conoffercommand = new MySqlCommand("sites_GetSiteNameCustomerIdExist", conoffer);
                            conoffercommand.CommandType = CommandType.StoredProcedure;
                            conoffercommand.Parameters.AddWithValue("_SiteName", sitename);
                            conoffercommand.Parameters.AddWithValue("_IdCustomer", company.IdCustomer);
                            using (MySqlDataReader offerreader = conoffercommand.ExecuteReader())
                            {
                                if (offerreader.Read())
                                {
                                    company.IsExist = true;

                                }
                                else
                                {
                                    company = updateCompany_V2430(company, mainconnectionstring, crmconnectionstring);
                                }
                            }
                        }
                    }
                }
                else
                {
                    using (MySqlConnection conoffer = new MySqlConnection(mainconnectionstring))
                    {
                        conoffer.Open();
                        MySqlCommand conoffercommand = new MySqlCommand("sites_GetSiteNameCustomerIdExist", conoffer);
                        conoffercommand.CommandType = CommandType.StoredProcedure;
                        conoffercommand.Parameters.AddWithValue("_SiteName", sitename);
                        conoffercommand.Parameters.AddWithValue("_IdCustomer", company.IdCustomer);

                        using (MySqlDataReader offerreader = conoffercommand.ExecuteReader())
                        {
                            if (offerreader.Read())
                            {
                                company.IsExist = true;

                            }
                            else
                            {
                                company = updateCompany_V2430(company, mainconnectionstring, crmconnectionstring);
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                throw;

            }
            return company;
        }

        //[Sudhir.Jangra][GEOS2-4676][29/08/2023]
        private Company updateCompany_V2430(Company company, string mainServerConnectionString, string crmConnectionString)
        {
            company.IsUpdate = false;

            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection concompany = new MySqlConnection(mainServerConnectionString))
                    {
                        concompany.Open();

                        MySqlCommand concompanycommand = new MySqlCommand("sites_Update_V2430", concompany);
                        concompanycommand.CommandType = CommandType.StoredProcedure;
                        concompanycommand.Parameters.AddWithValue("_IdSite", company.IdCompany);
                        concompanycommand.Parameters.AddWithValue("_IdCustomer", company.IdCustomer);
                        concompanycommand.Parameters.AddWithValue("_Name", company.Name);
                        concompanycommand.Parameters.AddWithValue("_IdCountry", company.IdCountry);
                        concompanycommand.Parameters.AddWithValue("_Address", company.Address);
                        concompanycommand.Parameters.AddWithValue("_Telephone", company.Telephone);
                        concompanycommand.Parameters.AddWithValue("_Email", company.Email);
                        concompanycommand.Parameters.AddWithValue("_Region", company.Region);
                        concompanycommand.Parameters.AddWithValue("_Fax", company.Fax);
                        concompanycommand.Parameters.AddWithValue("_IdBusinessCenter", company.IdBusinessCenter);
                        concompanycommand.Parameters.AddWithValue("_IdBusinessField", company.IdBusinessField);
                        //  concompanycommand.Parameters.AddWithValue("_Size", company.Size);
                        concompanycommand.Parameters.AddWithValue("_CuttingMachines", company.CuttingMachines);
                        //  concompanycommand.Parameters.AddWithValue("_NumberOfEmployee", company.NumberOfEmployees);
                        concompanycommand.Parameters.AddWithValue("_IdSource", company.IdSource);
                        concompanycommand.Parameters.AddWithValue("_Line", company.Line);
                        concompanycommand.Parameters.AddWithValue("_Website", company.Website);
                        concompanycommand.Parameters.AddWithValue("_City", company.City);
                        concompanycommand.Parameters.AddWithValue("_PostCode", company.ZipCode);
                        concompanycommand.Parameters.AddWithValue("_ModifiedBy", company.ModifiedBy);
                        concompanycommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now);
                        concompanycommand.Parameters.AddWithValue("_IdBusinessType", company.IdBusinessType);
                        concompanycommand.Parameters.AddWithValue("_Latitude", company.Latitude);
                        concompanycommand.Parameters.AddWithValue("_Longitude", company.Longitude);
                        concompanycommand.Parameters.AddWithValue("_ShortName", company.ShortName);
                        //concompanycommand.Parameters.AddWithValue("_IdSalesResponsible", company.IdSalesResponsible);
                        //concompanycommand.Parameters.AddWithValue("_IdSalesResponsibleAssemblyBU", company.IdSalesResponsibleAssemblyBU);
                        concompanycommand.Parameters.AddWithValue("_RegisteredName", company.RegisteredName);
                        concompanycommand.Parameters.AddWithValue("_RegistrationNumber", company.CIF);
                        concompanycommand.ExecuteNonQuery();
                        company.IsUpdate = true;
                    }

                    if (company.IsUpdate)
                    {
                        AddUpdateDelete_CRMSiteSaleSowners(mainServerConnectionString, company);
                        AddSiteByBusinessProduct(company, mainServerConnectionString);
                        AddLogEntryBySite(company, mainServerConnectionString);
                    }

                    transactionScope.Complete();
                }
                catch (Exception ex)
                {
                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return company;

        }

        //[Sudhir.Jangra][GEOS2-4676][29/08/2023]
        public bool AddUpdateDelete_CRMSiteSaleSowners(string MainServerConnectionString, Company company)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    if (company.SalesOwnerList != null)
                    {
                        using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                        {
                            mySqlConnection.Open();

                            foreach (People People in company.SalesOwnerList)
                            {
                                if (People.IdPerson > 0)
                                {
                                    if (People.TransactionOperation == ModelBase.TransactionOperations.Delete)
                                    {
                                        MySqlCommand mySqlCommand = new MySqlCommand("CRM_SiteSaleSowners_Delete", mySqlConnection);
                                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                                        mySqlCommand.Parameters.AddWithValue("_IdSiteSalesOwner", People.IdSiteSalesOwner);

                                        mySqlCommand.ExecuteNonQuery();
                                    }
                                    else if (People.TransactionOperation == ModelBase.TransactionOperations.Add)
                                    {
                                        MySqlCommand mySqlCommand = new MySqlCommand("CRM_SiteSaleSowners_Insert", mySqlConnection);
                                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                                        mySqlCommand.Parameters.AddWithValue("_IdSalesOwner", People.IdPerson);
                                        mySqlCommand.Parameters.AddWithValue("_IdSite", company.IdCompany);
                                        mySqlCommand.Parameters.AddWithValue("_IsMainSalesOwner", (People.IsSalesResponsible ? 1 : 0));

                                        mySqlCommand.ExecuteNonQuery();
                                    }
                                    else if (People.TransactionOperation == ModelBase.TransactionOperations.Update)
                                    {
                                        MySqlCommand mySqlCommand = new MySqlCommand("CRM_SiteSaleSowners_Update", mySqlConnection);
                                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                                        mySqlCommand.Parameters.AddWithValue("_IdSiteSalesOwner", People.IdSiteSalesOwner);
                                        mySqlCommand.Parameters.AddWithValue("_IdSalesOwner", People.IdPerson);
                                        mySqlCommand.Parameters.AddWithValue("_IdSite", company.IdCompany);
                                        mySqlCommand.Parameters.AddWithValue("_IsMainSalesOwner", (People.IsSalesResponsible ? 1 : 0));

                                        mySqlCommand.ExecuteNonQuery();
                                    }
                                }
                            }
                            mySqlConnection.Close();
                        }
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                    isUpdated = true;
                }
                catch (Exception ex)
                {
                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }

        //[Sudhir.Jangra][GEOS2-4676][29/08/2023]
        public void AddSiteByBusinessProduct(Company site, string connectionstring)
        {
            try
            {
                if (site.BusinessProductList != null)
                {
                    foreach (SitesByBusinessProduct sitesByBusinessProduct in site.BusinessProductList)
                    {
                        if (sitesByBusinessProduct.IsAdded)
                        {
                            if (site.IdCompany > 0 && sitesByBusinessProduct.IdBusinessProduct > 0)
                            {
                                using (MySqlConnection consitesByBusinessProduct = new MySqlConnection(connectionstring))
                                {
                                    consitesByBusinessProduct.Open();
                                    //using (MySqlTransaction trans = consitesByBusinessProduct.BeginTransaction())
                                    //{
                                    //    try
                                    //    {
                                    //string query = "insert into sites_by_businessproduct( IdSite, IdBusinessProduct) values(" + site.IdCompany + "," + sitesByBusinessProduct.IdBusinessProduct + ")";

                                    MySqlCommand consitesByBusinessProductcommand = new MySqlCommand("sitesByBusinessproduct_Insert", consitesByBusinessProduct);
                                    consitesByBusinessProductcommand.CommandType = CommandType.StoredProcedure;
                                    consitesByBusinessProductcommand.Parameters.AddWithValue("_IdSite", site.IdCompany);
                                    consitesByBusinessProductcommand.Parameters.AddWithValue("_IdBusinessProduct", sitesByBusinessProduct.IdBusinessProduct);
                                    //consitesByBusinessProductcommand.Transaction = trans;
                                    consitesByBusinessProductcommand.ExecuteNonQuery();
                                    consitesByBusinessProduct.Close();

                                    //    trans.Commit();
                                    //}
                                    //catch (Exception ex)
                                    //{
                                    //    trans.Rollback();
                                    //    throw;
                                    //}
                                    //}
                                }
                            }
                        }
                        else if (sitesByBusinessProduct.IsDeleted)
                        {
                            if (site.IdCompany > 0 && sitesByBusinessProduct.IdBusinessProduct > 0)
                            {
                                using (MySqlConnection conlogEntryBySite = new MySqlConnection(connectionstring))
                                {
                                    conlogEntryBySite.Open();
                                    //using (MySqlTransaction trans = conlogEntryBySite.BeginTransaction())
                                    //{
                                    //    try
                                    //    {
                                    string query = "delete from sites_by_businessproduct where IdSite=" + site.IdCompany + " and IdBusinessProduct=" + sitesByBusinessProduct.IdBusinessProduct + ";";
                                    MySqlCommand conlogEntryBySitecommand = new MySqlCommand(query, conlogEntryBySite);
                                    //conlogEntryBySitecommand.Transaction = trans;
                                    conlogEntryBySitecommand.ExecuteNonQuery();
                                    conlogEntryBySite.Close();
                                    //        trans.Commit();
                                    //    }
                                    //    catch (Exception ex)
                                    //    {
                                    //        trans.Rollback();
                                    //        throw;
                                    //    }
                                    //}
                                }
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                throw;
            }
        }

        //[Sudhir.Jangra][GEOS2-4676][29/08/2023]

        public void AddLogEntryBySite(Company site, string connectionstring)
        {
            try
            {
                if (site.LogEntryBySites != null)
                {
                    foreach (LogEntryBySite logEntryBySite in site.LogEntryBySites)
                    {
                        if (logEntryBySite.IsUpdate)
                        {
                            if (logEntryBySite.IdLogEntryBySite > 0)
                            {
                                using (MySqlConnection conlogEntryBySite = new MySqlConnection(connectionstring))
                                {
                                    conlogEntryBySite.Open();

                                    //using (MySqlTransaction trans = conlogEntryBySite.BeginTransaction())
                                    //{
                                    //    try
                                    //    {
                                    //string query = "update log_entries_by_site set comments='" + logEntryBySite.Comments + "', dateTime='" + DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss") + "'  where IdLogEntriesBySite=" + logEntryBySite.IdLogEntryBySite + ";";

                                    MySqlCommand conlogEntryBySitecommand = new MySqlCommand("logEntriesBySite_Update", conlogEntryBySite);
                                    conlogEntryBySitecommand.CommandType = CommandType.StoredProcedure;

                                    conlogEntryBySitecommand.Parameters.AddWithValue("_IdLogEntriesBySite", logEntryBySite.IdLogEntryBySite);
                                    conlogEntryBySitecommand.Parameters.AddWithValue("_Datetime", DateTime.Now);
                                    conlogEntryBySitecommand.Parameters.AddWithValue("_Comments", logEntryBySite.Comments);
                                    //conlogEntryBySitecommand.Transaction = trans;
                                    conlogEntryBySitecommand.ExecuteNonQuery();
                                    conlogEntryBySite.Close();

                                    //trans.Commit();
                                    //    }
                                    //    catch (Exception ex)
                                    //    {
                                    //        trans.Rollback();
                                    //        throw;
                                    //    }
                                    //}
                                }
                            }
                        }

                        else if (logEntryBySite.IsDeleted)
                        {
                            if (logEntryBySite.IdLogEntryBySite > 0)
                            {
                                using (MySqlConnection conlogEntryBySite = new MySqlConnection(connectionstring))
                                {
                                    conlogEntryBySite.Open();

                                    //using (MySqlTransaction trans = conlogEntryBySite.BeginTransaction())
                                    //{
                                    //    try
                                    //    {
                                    //string query = "delete from log_entries_by_site where IdLogEntriesBySite=" + logEntryBySite.IdLogEntryBySite + ";";

                                    MySqlCommand conlogEntryBySitecommand = new MySqlCommand("logEntriesBySite_Delete", conlogEntryBySite);
                                    conlogEntryBySitecommand.CommandType = CommandType.StoredProcedure;

                                    conlogEntryBySitecommand.Parameters.AddWithValue("_IdLogEntriesBySite", logEntryBySite.IdLogEntryBySite);
                                    //conlogEntryBySitecommand.Transaction = trans;
                                    conlogEntryBySitecommand.ExecuteNonQuery();
                                    conlogEntryBySite.Close();

                                    //    trans.Commit();
                                    //}
                                    //catch (Exception ex)
                                    //{
                                    //    trans.Rollback();
                                    //    throw;
                                    //}
                                    //}

                                }
                            }
                        }
                        else
                        {
                            using (MySqlConnection conlogEntryBySite = new MySqlConnection(connectionstring))
                            {
                                conlogEntryBySite.Open();

                                //using (MySqlTransaction trans = conlogEntryBySite.BeginTransaction())
                                //{
                                //    try
                                //    {

                                MySqlCommand conlogEntryBySitecommand = new MySqlCommand("logEntryBySite_Insert", conlogEntryBySite);
                                conlogEntryBySitecommand.CommandType = CommandType.StoredProcedure;
                                conlogEntryBySitecommand.Parameters.AddWithValue("_IdSite", site.IdCompany);
                                conlogEntryBySitecommand.Parameters.AddWithValue("_IdUser", logEntryBySite.IdUser);
                                conlogEntryBySitecommand.Parameters.AddWithValue("_Datetime", DateTime.Now);
                                conlogEntryBySitecommand.Parameters.AddWithValue("_Comments", logEntryBySite.Comments);

                                //conlogEntryBySitecommand.Parameters.AddWithValue("_IdLogEntryType", logEntryBySite.IdLogEntryType);
                                //conlogEntryBySitecommand.Transaction = trans;

                                conlogEntryBySitecommand.ExecuteNonQuery();
                                conlogEntryBySite.Close();

                                //trans.Commit();
                                //    }
                                //    catch (Exception ex)
                                //    {
                                //        trans.Rollback();
                                //        throw;
                                //    }
                                //}
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                throw;
            }
        }

        //[Sudhir.jangra][GEOS2-4676][29/08/2023]
        public List<People> GetAllActivePeoples_V2390(String connectionstring)
        {
            List<People> peoples = new List<People>();

            using (MySqlConnection conofferwithoutpurchaseorder = new MySqlConnection(connectionstring))
            {
                conofferwithoutpurchaseorder.Open();
                MySqlCommand conofferwithoutpurchaseordercommand = new MySqlCommand("SalesUser_GetSalesUser_V2390", conofferwithoutpurchaseorder);
                conofferwithoutpurchaseordercommand.CommandType = CommandType.StoredProcedure;

                using (MySqlDataReader offerreader = conofferwithoutpurchaseordercommand.ExecuteReader())
                {
                    while (offerreader.Read())
                    {
                        People people = new People();
                        people.IdPerson = Convert.ToInt32(offerreader["IdPerson"].ToString());
                        people.Name = offerreader["Name"].ToString();
                        people.Surname = offerreader["Surname"].ToString();
                        people.Email = offerreader["Email"].ToString();
                        people.Phone = offerreader["phone"].ToString();
                        peoples.Add(people);
                    }
                }
            }

            return peoples;
        }

        //[Sudhir.Jangra][GEOS2-4676][29/08/2023]
        public Activity GetActivityByIdActivity_V2035(Int64 idActivity, string connectionString)
        {
            Activity activity = new Activity();

            using (MySqlConnection connActivities = new MySqlConnection(connectionString))
            {
                connActivities.Open();
                MySqlCommand getActivitiesCommand = new MySqlCommand("CRM_GetActivityByIdActivity_V2035", connActivities);
                getActivitiesCommand.CommandType = CommandType.StoredProcedure;
                getActivitiesCommand.Parameters.AddWithValue("_IdActivity", idActivity);
                using (MySqlDataReader activityReader = getActivitiesCommand.ExecuteReader())
                {
                    while (activityReader.Read())
                    {
                        activity.Subject = activityReader["Subject"].ToString();

                        if (activityReader["IdActivityType"] != DBNull.Value)
                        {
                            activity.IdActivityType = Convert.ToInt32(activityReader["IdActivityType"].ToString());
                            activity.LookupValue = new LookupValue();
                            activity.LookupValue.IdLookupValue = Convert.ToInt32(activityReader["IdActivityType"].ToString());
                            activity.LookupValue.Value = activityReader["ActivityType"].ToString();
                            activity.LookupValue.HtmlColor = activityReader["ActivityTypeHtmlColor"].ToString();

                            if (activityReader["ActivityTypeImage"] != DBNull.Value)
                                activity.LookupValue.IdImage = Convert.ToInt64(activityReader["ActivityTypeImage"].ToString());

                            if (activityReader["ActivityTypePosition"] != DBNull.Value)
                                activity.LookupValue.Position = Convert.ToInt32(activityReader["ActivityTypePosition"].ToString());
                        }

                        activity.IdActivity = Convert.ToInt64(activityReader["IdActivity"].ToString());
                        if (activityReader["IdOwner"] != DBNull.Value)
                            activity.IdOwner = Convert.ToInt32(activityReader["IdOwner"].ToString());

                        if (activityReader["FromDate"] != DBNull.Value)
                        {
                            var ordinal = activityReader.GetOrdinal("FromDate");
                            activity.FromDate = Convert.ToDateTime(activityReader.GetMySqlDateTime(ordinal));
                        }

                        if (activityReader["ToDate"] != DBNull.Value)
                        {
                            var ordinal = activityReader.GetOrdinal("ToDate");
                            activity.ToDate = Convert.ToDateTime(activityReader.GetMySqlDateTime(ordinal));
                        }

                        //if (activityreader["FromDate"] != DBNull.Value)
                        //    activity.FromDate = Convert.ToDateTime(activityreader["FromDate"].ToString());
                        //if (activityreader["ToDate"] != DBNull.Value)
                        //    activity.ToDate = Convert.ToDateTime(activityreader["ToDate"].ToString());

                        activity.Description = activityReader["Description"].ToString();
                        activity.Location = activityReader["Location"].ToString();

                        if (activityReader["CreatedIn"] != DBNull.Value)
                            activity.CreatedIn = Convert.ToDateTime(activityReader["CreatedIn"].ToString());

                        if (activityReader["ModifiedIn"] != DBNull.Value)
                            activity.ModifiedIn = Convert.ToDateTime(activityReader["ModifiedIn"].ToString());

                        if (activityReader["CreatedBy"] != DBNull.Value)
                            activity.CreatedBy = Convert.ToInt32(activityReader["CreatedBy"].ToString());

                        if (activityReader["ModifiedBy"] != DBNull.Value)
                            activity.ModifiedBy = Convert.ToInt32(activityReader["ModifiedBy"].ToString());

                        if (activityReader["Latitude"] != DBNull.Value)
                        {
                            activity.Latitude = Convert.ToDouble(activityReader["Latitude"].ToString());
                            activity.BothLongitudeLatitude = activity.Latitude.ToString();
                        }

                        if (activityReader["Longitude"] != DBNull.Value)
                        {
                            activity.Longitude = Convert.ToDouble(activityReader["Longitude"].ToString());
                            activity.BothLongitudeLatitude = activity.BothLongitudeLatitude + activity.Longitude.ToString();
                        }

                        if (activityReader["IdPerson"] != DBNull.Value)
                        {
                            activity.People = new People();
                            activity.People.Name = activityReader["Name"].ToString();
                            activity.People.IdPerson = Convert.ToInt32(activityReader["IdPerson"].ToString());
                            activity.People.Surname = activityReader["Surname"].ToString();

                            if (activityReader["IdPersonGender"] != DBNull.Value)
                                activity.People.IdPersonGender = Convert.ToByte(activityReader["IdPersonGender"].ToString());
                        }

                        if (activityReader["IsCompleted"] != DBNull.Value)
                        {
                            activity.IsCompleted = Convert.ToByte(activityReader["IsCompleted"].ToString());

                            if (activityReader["CloseDate"] != DBNull.Value)
                                activity.CloseDate = Convert.ToDateTime(activityReader["CloseDate"].ToString());
                        }

                        if (activityReader["IsInternal"] != DBNull.Value)
                        {
                            activity.IsInternal = Convert.ToByte(activityReader["IsInternal"].ToString());
                        }

                        if (activityReader["IdActivityStatus"] != DBNull.Value)
                        {
                            activity.IdActivityStatus = Convert.ToInt32(activityReader["IdActivityStatus"].ToString());
                            activity.ActivityStatus = new LookupValue();
                            activity.ActivityStatus.IdLookupValue = Convert.ToInt32(activityReader["IdActivityStatus"].ToString());
                            activity.ActivityStatus.Value = activityReader["ActivityStatus"].ToString();
                            activity.ActivityStatus.HtmlColor = activityReader["ActivityStatusHtmlColor"].ToString();
                            if (activityReader["ActivityStatusImage"] != DBNull.Value)
                                activity.ActivityStatus.IdImage = Convert.ToInt64(activityReader["ActivityStatusImage"].ToString());
                            if (activityReader["ActivityStatusPosition"] != DBNull.Value)
                                activity.ActivityStatus.Position = Convert.ToInt32(activityReader["ActivityStatusPosition"].ToString());
                        }

                        if (activityReader["ReminderDateTime"] != DBNull.Value)
                            activity.ActivityReminderDateTime = Convert.ToDateTime(activityReader["ReminderDateTime"].ToString());

                        if (activityReader["IsSentMail"] != DBNull.Value)
                            activity.IsSentMail = Convert.ToByte(activityReader["IsSentMail"].ToString());

                        if (activityReader["MinDueDate"] != DBNull.Value)
                            activity.MinDueDate = Convert.ToDateTime(activityReader["MinDueDate"].ToString());

                        if (activityReader["MaxDueDate"] != DBNull.Value)
                            activity.MaxDueDate = Convert.ToDateTime(activityReader["MaxDueDate"].ToString());

                        activity.LogEntriesByActivity = new List<LogEntriesByActivity>();
                        activity.LogEntriesByActivity = GetlogEntriesByActivity(idActivity, 2, connectionString);

                        activity.CommentsByActivity = new List<LogEntriesByActivity>();
                        activity.CommentsByActivity = GetlogEntriesByActivity(idActivity, 1, connectionString);

                        activity.ActivityAttendees = new List<ActivityAttendees>();
                        activity.ActivityAttendees = GetActivityAttendeesByIdActivity(idActivity, connectionString);

                        activity.ActivityWatchers = GetActivityWatchersByIdActivity(idActivity, connectionString);

                        activity.ActivityLinkedItem = new List<ActivityLinkedItem>();
                        activity.ActivityLinkedItem = GetActivityLinkedItemsByIdActivity(idActivity, connectionString);

                        activity.ActivityAttachment = new List<ActivityAttachment>();
                        activity.ActivityAttachment = GetActivityAttachmentByIdActivity(idActivity, connectionString);

                        activity.ActivityTags = new List<ActivityTag>();
                        activity.ActivityTags = GetActivityTagsByIdActivity(idActivity, connectionString);
                        //listactivity.Add(activity);
                    }
                }
            }
            return activity;
        }


        //[Sudhir.jangra][GEOS2-4676][29/08/2023]
        public List<ActivityTag> GetActivityTagsByIdActivity(Int64 idActivity, string connectionString)
        {
            List<ActivityTag> listActivityTags = new List<ActivityTag>();

            using (MySqlConnection connActivityTags = new MySqlConnection(connectionString))
            {
                connActivityTags.Open();
                MySqlCommand activityTagsCommand = new MySqlCommand("activityTags_GetActivityTagsByIdActivity", connActivityTags);
                activityTagsCommand.CommandType = CommandType.StoredProcedure;
                activityTagsCommand.Parameters.AddWithValue("_IdActivity", idActivity);

                using (MySqlDataReader activityReader = activityTagsCommand.ExecuteReader())
                {
                    while (activityReader.Read())
                    {
                        ActivityTag ActivityTag = new ActivityTag();

                        if (activityReader["IdActivity"] != DBNull.Value)
                            ActivityTag.IdActivity = Convert.ToInt64(activityReader["IdActivity"].ToString());

                        if (activityReader["IdTag"] != DBNull.Value)
                        {
                            ActivityTag.IdTag = Convert.ToInt64(activityReader["IdTag"].ToString());

                            ActivityTag.Tag = new Tag();
                            ActivityTag.Tag.IdTag = Convert.ToInt64(activityReader["IdTag"].ToString());
                            ActivityTag.Tag.Name = activityReader["Name"].ToString();
                        }

                        if (activityReader["IdActivityTag"] != DBNull.Value)
                            ActivityTag.IdActivityTag = Convert.ToInt64(activityReader["IdActivityTag"].ToString());

                        listActivityTags.Add(ActivityTag);
                    }
                }
            }

            return listActivityTags;
        }

        //[Sudhir.jangra][GEOS2-4676][29/08/2023]
        public List<ActivityAttachment> GetActivityAttachmentByIdActivity(Int64 idActivity, string mainconnectionstring)
        {
            List<ActivityAttachment> activityAttachments = new List<ActivityAttachment>();
            using (MySqlConnection congetactivities = new MySqlConnection(mainconnectionstring))
            {
                congetactivities.Open();
                MySqlCommand congetactivitiescommand = new MySqlCommand("activities_GetAttachmentByIdActivity", congetactivities);
                congetactivitiescommand.CommandType = CommandType.StoredProcedure;
                congetactivitiescommand.Parameters.AddWithValue("_IdActivity", idActivity);

                using (MySqlDataReader activityreader = congetactivitiescommand.ExecuteReader())
                {
                    while (activityreader.Read())
                    {
                        ActivityAttachment activityAttachment = new ActivityAttachment();
                        if (activityreader["IdActivityAttachment"] != DBNull.Value)
                            activityAttachment.IdActivityAttachment = Convert.ToInt64(activityreader["IdActivityAttachment"].ToString());
                        if (activityreader["IdActivity"] != DBNull.Value)
                            activityAttachment.IdActivity = Convert.ToInt64(activityreader["IdActivity"].ToString());
                        if (activityreader["FileSize"] != DBNull.Value)
                            activityAttachment.FileSize = Convert.ToInt64(activityreader["FileSize"].ToString());
                        activityAttachment.OriginalFileName = activityreader["OriginalFileName"].ToString();
                        activityAttachment.SavedFileName = activityreader["SavedFileName"].ToString();
                        activityAttachment.FileType = activityreader["FileType"].ToString();
                        if (activityreader["UploadedIn"] != DBNull.Value)
                            activityAttachment.UploadedIn = Convert.ToDateTime(activityreader["UploadedIn"].ToString());
                        if (activityreader["IsDeleted"] != DBNull.Value)
                            activityAttachment.IsDeleted = Convert.ToByte(activityreader["IsDeleted"].ToString());

                        activityAttachments.Add(activityAttachment);
                    }
                }
            }

            return activityAttachments;
        }


        //[Sudhir.jangra][GEOS2-4676][29/08/2023]
        public List<ActivityLinkedItem> GetActivityLinkedItemsByIdActivity(Int64 idActivity, string mainconnectionstring)
        {
            List<ActivityLinkedItem> activityLinkedItems = new List<ActivityLinkedItem>();

            using (MySqlConnection congetactivities = new MySqlConnection(mainconnectionstring))
            {
                congetactivities.Open();
                MySqlCommand congetactivitiescommand = new MySqlCommand("activityLinkedItems_GetactivityLinkedItemsByIdActivity", congetactivities);
                congetactivitiescommand.CommandType = CommandType.StoredProcedure;
                congetactivitiescommand.Parameters.AddWithValue("_IdActivity", idActivity);

                using (MySqlDataReader activityreader = congetactivitiescommand.ExecuteReader())
                {
                    while (activityreader.Read())
                    {
                        ActivityLinkedItem activityLinkedItem = new ActivityLinkedItem();
                        activityLinkedItem.IdActivity = Convert.ToInt64(activityreader["IdActivity"].ToString());
                        activityLinkedItem.IdActivityLinkedItem = Convert.ToInt64(activityreader["IdActivityLinkedItem"].ToString());
                        activityLinkedItem.Customer = new Customer();
                        if (activityreader["IdCustomer"] != DBNull.Value)
                        {
                            activityLinkedItem.IdCustomer = Convert.ToInt32(activityreader["IdCustomer"].ToString());

                            activityLinkedItem.Customer.IdCustomer = Convert.ToInt32(activityreader["IdCustomer"].ToString());
                            activityLinkedItem.Customer.CustomerName = activityreader["Group"].ToString();
                        }

                        activityLinkedItem.Company = new Company();
                        if (activityreader["IdSite"] != DBNull.Value)
                        {
                            activityLinkedItem.IdSite = Convert.ToInt32(activityreader["IdSite"].ToString());

                            activityLinkedItem.Company.IdCompany = Convert.ToInt32(activityreader["IdSite"].ToString());
                            activityLinkedItem.Company.SiteNameWithoutCountry = activityreader["SiteWithCountryName"].ToString();
                            activityLinkedItem.Company.Name = activityreader["Plant"].ToString();

                            if (activityreader["IdCustomer"] != DBNull.Value)
                            {
                                activityLinkedItem.Company.Customers = new List<Customer>();
                                Customer cust = new Customer();
                                cust.IdCustomer = Convert.ToInt32(activityreader["IdCustomer"].ToString());
                                cust.CustomerName = activityreader["Group"].ToString();
                                activityLinkedItem.Company.Customers.Add(cust);
                            }
                            activityLinkedItem.Name = activityLinkedItem.Customer.CustomerName + " - " + activityLinkedItem.Company.SiteNameWithoutCountry;
                        }

                        if (activityreader["IdCarProject"] != DBNull.Value)
                        {
                            activityLinkedItem.IdCarProject = Convert.ToInt64(activityreader["IdCarProject"].ToString());
                            activityLinkedItem.CarProject = new CarProject();
                            activityLinkedItem.CarProject.IdCarProject = Convert.ToInt64(activityreader["IdCarProject"].ToString());
                            activityLinkedItem.CarProject.Name = activityreader["CarProject"].ToString();
                            activityLinkedItem.CarProject.CarOEM = new CarOEM();
                            if (activityreader["IdCarOem"] != DBNull.Value)
                            {
                                activityLinkedItem.CarProject.CarOEM.IdCarOEM = Convert.ToInt32(activityreader["IdCarOem"].ToString());
                                activityLinkedItem.CarProject.CarOEM.Name = activityreader["Caroem"].ToString();
                            }
                            activityLinkedItem.Name = activityLinkedItem.CarProject.Name + " - " + activityLinkedItem.CarProject.CarOEM.Name;
                        }

                        if (activityreader["IdPerson"] != DBNull.Value)
                        {
                            activityLinkedItem.IdPerson = Convert.ToInt32(activityreader["IdPerson"].ToString());
                            activityLinkedItem.People = new People();
                            activityLinkedItem.People.IdPerson = Convert.ToInt32(activityreader["IdPerson"].ToString());
                            activityLinkedItem.People.Name = activityreader["FirstName"].ToString();
                            activityLinkedItem.People.Surname = activityreader["Surname"].ToString();
                            if (activityreader["IdPersonGender"] != DBNull.Value)
                            {
                                activityLinkedItem.People.IdPersonGender = Convert.ToByte(activityreader["IdPersonGender"].ToString());
                            }
                            activityLinkedItem.People.Phone = activityreader["Phone"].ToString();
                            activityLinkedItem.People.ImageText = activityreader["Image"].ToString();

                            activityLinkedItem.Name = activityLinkedItem.People.FullName;
                        }

                        if (activityreader["IdOffer"] != DBNull.Value)
                        {
                            activityLinkedItem.IdOffer = Convert.ToInt64(activityreader["IdOffer"].ToString());
                            activityLinkedItem.IdEmdepSite = Convert.ToInt32(activityreader["IdEmdepSite"].ToString());
                        }

                        if (activityreader["IdLinkedItemType"] != DBNull.Value)
                        {
                            activityLinkedItem.IdLinkedItemType = Convert.ToByte(activityreader["IdLinkedItemType"].ToString());
                            activityLinkedItem.LinkedItemType = new LookupValue();
                            activityLinkedItem.LinkedItemType.IdLookupValue = Convert.ToInt32(activityreader["IdLinkedItemType"].ToString());
                            activityLinkedItem.LinkedItemType.Value = activityreader["ItemType"].ToString();
                        }

                        if (activityreader["IdCompetitor"] != DBNull.Value)
                        {
                            activityLinkedItem.IdCompetitor = Convert.ToByte(activityreader["IdCompetitor"].ToString());
                            activityLinkedItem.Competitor = new Competitor();
                            activityLinkedItem.Competitor.IdCompetitor = Convert.ToInt32(activityreader["IdCompetitor"].ToString());
                            activityLinkedItem.Competitor.Name = activityreader["Competitor"].ToString();
                            activityLinkedItem.Name = activityreader["Competitor"].ToString();
                        }



                        activityLinkedItems.Add(activityLinkedItem);
                    }
                }
            }

            return activityLinkedItems;
        }


        //[Sudhir.Jangra][GEOS2-4676][29/08/2023]
        public List<ActivityWatcher> GetActivityWatchersByIdActivity(Int64 idActivity, string connectionString)
        {
            List<ActivityWatcher> activityWatchers = new List<ActivityWatcher>();

            using (MySqlConnection connWatchers = new MySqlConnection(connectionString))
            {
                connWatchers.Open();
                MySqlCommand watchersCommand = new MySqlCommand("activityWatchers_GetWatchersByIdActivity", connWatchers);
                watchersCommand.CommandType = CommandType.StoredProcedure;
                watchersCommand.Parameters.AddWithValue("_IdActivity", idActivity);

                using (MySqlDataReader activityreader = watchersCommand.ExecuteReader())
                {
                    while (activityreader.Read())
                    {
                        ActivityWatcher activityWatcher = new ActivityWatcher();

                        if (activityreader["IdActivity"] != DBNull.Value)
                            activityWatcher.IdActivity = Convert.ToInt64(activityreader["IdActivity"].ToString());

                        if (activityreader["IdUser"] != DBNull.Value)
                            activityWatcher.IdUser = Convert.ToInt32(activityreader["IdUser"].ToString());

                        if (activityreader["IdActivityWatcher"] != DBNull.Value)
                            activityWatcher.IdActivityWatcher = Convert.ToInt64(activityreader["IdActivityWatcher"].ToString());

                        if (activityreader["IdPerson"] != DBNull.Value)
                        {
                            activityWatcher.People = new People();
                            activityWatcher.People.IdPerson = Convert.ToInt32(activityreader["IdPerson"].ToString());
                            activityWatcher.People.Name = activityreader["Name"].ToString();
                            activityWatcher.People.Surname = activityreader["Surname"].ToString();
                            activityWatcher.People.Email = activityreader["Email"].ToString();
                            activityWatcher.People.Phone = activityreader["Phone"].ToString();
                        }

                        activityWatchers.Add(activityWatcher);
                    }
                }
            }

            return activityWatchers;
        }

        //[Sudhir.Jangra][GEOS2-4676][29/08/2023]
        public List<ActivityAttendees> GetActivityAttendeesByIdActivity(Int64 idActivity, string mainconnectionstring)
        {
            List<ActivityAttendees> listactivity = new List<ActivityAttendees>();

            using (MySqlConnection congetactivities = new MySqlConnection(mainconnectionstring))
            {
                congetactivities.Open();
                MySqlCommand congetactivitiescommand = new MySqlCommand("activityAttendees_GetAttendeesByIdActivity", congetactivities);
                congetactivitiescommand.CommandType = CommandType.StoredProcedure;
                congetactivitiescommand.Parameters.AddWithValue("_IdActivity", idActivity);
                using (MySqlDataReader activityreader = congetactivitiescommand.ExecuteReader())
                {
                    while (activityreader.Read())
                    {
                        ActivityAttendees activityAttendees = new ActivityAttendees();
                        if (activityreader["IdActivity"] != DBNull.Value)
                            activityAttendees.IdActivity = Convert.ToInt64(activityreader["IdActivity"].ToString());
                        if (activityreader["IdUser"] != DBNull.Value)
                            activityAttendees.IdUser = Convert.ToInt32(activityreader["IdUser"].ToString());
                        if (activityreader["IdActivityAttendees"] != DBNull.Value)
                            activityAttendees.IdActivityAttendees = Convert.ToInt64(activityreader["IdActivityAttendees"].ToString());
                        if (activityreader["IdPerson"] != DBNull.Value)
                        {
                            activityAttendees.People = new People();
                            activityAttendees.People.IdPerson = Convert.ToInt32(activityreader["IdPerson"].ToString());
                            activityAttendees.People.Name = activityreader["Name"].ToString();
                            activityAttendees.People.Surname = activityreader["Surname"].ToString();
                            activityAttendees.People.Email = activityreader["Email"].ToString();
                            activityAttendees.People.Phone = activityreader["Phone"].ToString();
                        }
                        listactivity.Add(activityAttendees);
                    }
                }
            }

            return listactivity;
        }

        public Company GetCompanyDetailsById_V2340(string connectionstring, Int32 idSite)
        {

            Company company = new Company();
            DataTable dt = new DataTable();
            using (MySqlConnection concompany = new MySqlConnection(connectionstring))
            {
                concompany.Open();
                MySqlCommand concompanycommand = new MySqlCommand("sites_GetCompanyDetailsById_V2430", concompany);
                concompanycommand.CommandType = CommandType.StoredProcedure;
                concompanycommand.Parameters.AddWithValue("_IdSite", idSite);
                MySqlDataAdapter da = new MySqlDataAdapter(concompanycommand);
                //DataSet ds = new DataSet();
                da.Fill(dt);
            }
            foreach (DataRow companyreader in dt.Rows)
            {

                company.IdCompany = Convert.ToInt32(companyreader["IdSite"].ToString());
                company.Name = companyreader["CustomerPlant"].ToString();
                company.RegisteredName = companyreader["RegisteredName"].ToString();
                company.CIF = companyreader["RegistrationNumber"].ToString();
                company.IdCountry = Convert.ToByte(companyreader["idCountry"].ToString());
                company.Country = new Country { IdCountry = Convert.ToByte(companyreader["idCountry"].ToString()), Name = companyreader["Country"].ToString() };
                company.City = companyreader["City"].ToString();
                company.Address = companyreader["Address"].ToString();
                company.Telephone = companyreader["Phone"].ToString();
                company.ZipCode = companyreader["PostCode"].ToString();
                company.Fax = companyreader["Fax"].ToString();
                company.Website = companyreader["WebSite"].ToString();
                company.Email = companyreader["Email"].ToString();
                company.Region = companyreader["Region"].ToString();
                company.ShortName = companyreader["ShortName"].ToString();
                if (companyreader["IdSalesResponsible"] != DBNull.Value)
                {
                    company.IdSalesResponsible = Convert.ToInt32(companyreader["IdSalesResponsible"].ToString());
                    company.People = new People { IdPerson = Convert.ToInt32(companyreader["IdSalesResponsible"].ToString()), Name = companyreader["SalesResponsibleName"].ToString(), Surname = companyreader["SalesResponsibleSurname"].ToString(), IsSalesResponsible = true };
                }

                if (companyreader["IdSalesResponsibleAssemblyBU"] != DBNull.Value)
                {
                    company.IdSalesResponsibleAssemblyBU = Convert.ToInt32(companyreader["IdSalesResponsibleAssemblyBU"].ToString());
                    company.PeopleSalesResponsibleAssemblyBU = new People { IdPerson = Convert.ToInt32(companyreader["IdSalesResponsibleAssemblyBU"].ToString()), Name = companyreader["SalesResponsiblebuName"].ToString(), Surname = companyreader["SalesResponsiblebuSurname"].ToString(), IsSalesResponsible = false };
                }

                company.Country.Zone = new Zone { Name = companyreader["SalesZone"].ToString() };
                company.IdCustomer = Convert.ToInt32(companyreader["IdCustomer"].ToString());
                company.Customers = new List<Customer> { new Customer { IdCustomer = Convert.ToInt32(companyreader["IdCustomer"].ToString()), CustomerName = companyreader["CustomerGroup"].ToString() } };
                if (companyreader["Line"] != DBNull.Value)
                    company.Line = Convert.ToInt32(companyreader["Line"].ToString());
                if (companyreader["ModifiedIn"] != DBNull.Value)
                    company.ModifiedIn = Convert.ToDateTime(companyreader["ModifiedIn"].ToString());
                else
                    company.ModifiedIn = null;
                if (companyreader["CreatedIn"] != DBNull.Value)
                    company.CreatedIn = Convert.ToDateTime(companyreader["CreatedIn"].ToString());
                if (companyreader["CuttingMachines"] != DBNull.Value)
                    company.CuttingMachines = Convert.ToInt32(companyreader["CuttingMachines"].ToString());
                //if (companyreader["Size"] != DBNull.Value)
                //    company.Size = Convert.ToDouble(companyreader["Size"].ToString());
                //if (companyreader["NumberOfEmployees"] != DBNull.Value)
                //    company.NumberOfEmployees = Convert.ToInt32(companyreader["NumberOfEmployees"].ToString());
                if (companyreader["IdSource"] != DBNull.Value)
                {
                    company.IdSource = Convert.ToInt32(companyreader["IdSource"]);
                }
                if (companyreader["IdBusinessField"] != DBNull.Value)
                {
                    company.IdBusinessField = Convert.ToByte(companyreader["IdBusinessField"].ToString());
                    company.BusinessField = new LookupValue { IdLookupValue = Convert.ToByte(companyreader["IdBusinessField"].ToString()), Value = companyreader["BusinessField"].ToString() };
                }
                if (companyreader["IdBusinessCenter"] != DBNull.Value)
                {
                    company.IdBusinessCenter = Convert.ToByte(companyreader["IdBusinessCenter"].ToString());
                    company.BusinessCenter = new LookupValue { IdLookupValue = Convert.ToByte(companyreader["IdBusinessCenter"].ToString()), Value = companyreader["BusinessCenter"].ToString() };
                }

                if (companyreader["IdBusinessType"] != DBNull.Value)
                {
                    company.IdBusinessType = Convert.ToByte(companyreader["IdBusinessType"].ToString());
                    company.BusinessType = new LookupValue { IdLookupValue = Convert.ToByte(companyreader["IdBusinessType"].ToString()), Value = companyreader["BusinessType"].ToString() };
                }
                if (companyreader["Latitude"] != DBNull.Value)
                {
                    company.Latitude = Convert.ToDouble(companyreader["Latitude"].ToString());
                }
                if (companyreader["Longitude"] != DBNull.Value)
                {
                    company.Longitude = Convert.ToDouble(companyreader["Longitude"].ToString());
                }
                company.BusinessProductList = new List<SitesByBusinessProduct>();
                using (MySqlConnection concompanybusinessproduct = new MySqlConnection(connectionstring))
                {
                    concompanybusinessproduct.Open();
                    MySqlCommand concompanycommandbusinessproduct = new MySqlCommand("sitesbybusinessproduct_GetBusinessproductByIdSite", concompanybusinessproduct);
                    concompanycommandbusinessproduct.CommandType = CommandType.StoredProcedure;
                    concompanycommandbusinessproduct.Parameters.AddWithValue("_idSite", company.IdCompany);
                    using (MySqlDataReader companybusinessproductreader = concompanycommandbusinessproduct.ExecuteReader())
                    {
                        while (companybusinessproductreader.Read())
                        {
                            SitesByBusinessProduct sitesByBusinessProduct = new SitesByBusinessProduct();
                            sitesByBusinessProduct.IdSite = Convert.ToInt32(companybusinessproductreader["IdSite"].ToString());
                            sitesByBusinessProduct.IdBusinessProduct = Convert.ToInt32(companybusinessproductreader["IdBusinessProduct"].ToString());
                            sitesByBusinessProduct.IsAdded = true;
                            company.BusinessProductList.Add(sitesByBusinessProduct);
                        }
                    }
                }

            }

            return company;
        }


        //[Sudhir.Jangra][GEOS2-4676][29/08/2023]
        public List<LogEntriesByActivity> GetlogEntriesByActivity(Int64 idActivity, byte idLogEntryType, string mainConnectionString)
        {
            List<LogEntriesByActivity> listLogEntriesByActivity = new List<LogEntriesByActivity>();

            using (MySqlConnection congetactivities = new MySqlConnection(mainConnectionString))
            {
                congetactivities.Open();

                MySqlCommand congetactivitiescommand = new MySqlCommand("logEntryActivity_GetlogEntriesByActivity", congetactivities);
                congetactivitiescommand.CommandType = CommandType.StoredProcedure;
                congetactivitiescommand.Parameters.AddWithValue("_IdActivity", idActivity);
                congetactivitiescommand.Parameters.AddWithValue("_IdLogEntryType", idLogEntryType);

                using (MySqlDataReader activityreader = congetactivitiescommand.ExecuteReader())
                {
                    while (activityreader.Read())
                    {
                        LogEntriesByActivity logEntriesByActivity = new LogEntriesByActivity();

                        logEntriesByActivity.IdLogEntryByActivity = Convert.ToInt64(activityreader["IdLogEntryByActivity"]);

                        if (activityreader["IdUser"] != DBNull.Value)
                            logEntriesByActivity.IdUser = Convert.ToInt32(activityreader["IdUser"].ToString());

                        if (activityreader["IdActivity"] != DBNull.Value)
                            logEntriesByActivity.IdActivity = Convert.ToInt64(activityreader["IdActivity"].ToString());

                        if (activityreader["IdPerson"] != DBNull.Value)
                        {
                            logEntriesByActivity.People = new People();
                            logEntriesByActivity.People.IdPerson = Convert.ToInt32(activityreader["IdPerson"].ToString());
                            logEntriesByActivity.People.Name = activityreader["Name"].ToString();
                            logEntriesByActivity.People.Surname = activityreader["Surname"].ToString();

                            if (activityreader["Login"] != DBNull.Value)
                                logEntriesByActivity.People.Login = Convert.ToString(activityreader["Login"]);

                            if (activityreader["IdUserGender"] != DBNull.Value)
                                logEntriesByActivity.People.IdPersonGender = Convert.ToByte(activityreader["IdUserGender"]);
                        }

                        if (activityreader["Datetime"] != DBNull.Value)
                            logEntriesByActivity.Datetime = Convert.ToDateTime(activityreader["Datetime"].ToString());

                        if (activityreader["Comments"] != DBNull.Value)
                            logEntriesByActivity.Comments = activityreader["Comments"].ToString();

                        if (activityreader["IdLogEntryType"] != DBNull.Value)
                            logEntriesByActivity.IdLogEntryType = Convert.ToByte(activityreader["IdLogEntryType"]);

                        if (activityreader["IsRtfText"] != DBNull.Value)
                            logEntriesByActivity.IsRtfText = Convert.ToBoolean(activityreader["IsRtfText"]);

                        listLogEntriesByActivity.Add(logEntriesByActivity);
                    }
                }
            }

            return listLogEntriesByActivity;
        }

        //[Sudhir.jangra][GEOS2-4676][29/08/2023]
        public List<Competitor> GetCompetitors(string connectionstring)
        {

            List<Competitor> competitors = new List<Competitor>();
            using (MySqlConnection concompetitor = new MySqlConnection(connectionstring))
            {
                concompetitor.Open();
                MySqlCommand concompetitorcommand = new MySqlCommand("competitors_GetCompetitors", concompetitor);
                concompetitorcommand.CommandType = CommandType.StoredProcedure;

                using (MySqlDataReader competitorreader = concompetitorcommand.ExecuteReader())
                {
                    while (competitorreader.Read())
                    {
                        Competitor competitor = new Competitor();
                        competitor.IdCompetitor = Convert.ToInt32(competitorreader["IdCompetitor"].ToString());
                        competitor.Name = competitorreader["Name"].ToString();
                        competitors.Add(competitor);
                    }
                }
            }
            return competitors;
        }

        //[Sudhir.Jangra][GEOS2-4676][29/08/2023]
        public List<Activity> GetActivitiesByIdContact(Int32 idContact, string mainconnectionstring)
        {
            List<Activity> listActivity = new List<Activity>();

            using (MySqlConnection congetactivities = new MySqlConnection(mainconnectionstring))
            {
                congetactivities.Open();
                MySqlCommand congetactivitiescommand = new MySqlCommand("activities_GetactivitiesByIdPerson", congetactivities);
                congetactivitiescommand.CommandType = CommandType.StoredProcedure;
                congetactivitiescommand.Parameters.AddWithValue("_IdPerson", idContact);
                using (MySqlDataReader activityreader = congetactivitiescommand.ExecuteReader())
                {
                    while (activityreader.Read())
                    {
                        Activity activity = new Activity();
                        activity.IdActivity = Convert.ToInt64(activityreader["IdActivity"].ToString());
                        activity.Subject = activityreader["Subject"].ToString();
                        activity.Description = activityreader["Description"].ToString();

                        if (activityreader["IdActivityType"] != DBNull.Value)
                        {
                            activity.LookupValue = new LookupValue();
                            activity.LookupValue.IdLookupValue = Convert.ToInt32(activityreader["IdActivityType"].ToString());
                            activity.LookupValue.Value = activityreader["ActivityType"].ToString();
                            activity.LookupValue.HtmlColor = activityreader["ActivityTypeHtmlColor"].ToString();
                            if (activityreader["ActivityTypeImage"] != DBNull.Value)
                                activity.LookupValue.IdImage = Convert.ToInt64(activityreader["ActivityTypeImage"].ToString());
                            if (activityreader["ActivityTypePosition"] != DBNull.Value)
                                activity.LookupValue.Position = Convert.ToInt32(activityreader["ActivityTypePosition"].ToString());
                        }

                        if (activityreader["FromDate"] != DBNull.Value)
                            activity.FromDate = Convert.ToDateTime(activityreader["FromDate"].ToString());

                        if (activityreader["ToDate"] != DBNull.Value)
                            activity.ToDate = Convert.ToDateTime(activityreader["ToDate"].ToString());

                        if (activityreader["CloseDate"] != DBNull.Value)
                            activity.CloseDate = Convert.ToDateTime(activityreader["CloseDate"].ToString());

                        activity.Location = activityreader["Location"].ToString();

                        if (activityreader["IdOwner"] != DBNull.Value)
                            activity.IdOwner = Convert.ToInt32(activityreader["IdOwner"].ToString());

                        if (activityreader["IdOwner"] != DBNull.Value)
                        {
                            activity.People = new People();

                            activity.People.Name = activityreader["Name"].ToString();
                            activity.People.Surname = activityreader["Surname"].ToString();
                        }

                        if (activityreader["Latitude"] != DBNull.Value)
                            activity.Latitude = Convert.ToDouble(activityreader["Latitude"].ToString());

                        if (activityreader["Longitude"] != DBNull.Value)
                            activity.Longitude = Convert.ToDouble(activityreader["Longitude"].ToString());

                        if (activityreader["IsCompleted"] != DBNull.Value)
                        {
                            activity.IsCompleted = Convert.ToByte(activityreader["IsCompleted"].ToString());

                            //close filled when completing some activity.
                            if (activity.IsCompleted == 1)
                            {
                                activity.ActivityGridStatus = "Completed";

                                if (activityreader["CloseDate"] != DBNull.Value)
                                    activity.CloseDate = Convert.ToDateTime(activityreader["CloseDate"].ToString());
                            }
                        }

                        if (activityreader["IdActivityStatus"] != DBNull.Value)
                        {
                            activity.ActivityStatus = new LookupValue();
                            activity.ActivityStatus.IdLookupValue = Convert.ToInt32(activityreader["IdActivityStatus"].ToString());
                            activity.ActivityStatus.Value = activityreader["ActivityStatus"].ToString();
                            activity.ActivityStatus.HtmlColor = activityreader["ActivityStatusHtmlColor"].ToString();

                            if (activityreader["ActivityStatusImage"] != DBNull.Value)
                                activity.ActivityStatus.IdImage = Convert.ToInt64(activityreader["ActivityStatusImage"].ToString());

                            if (activityreader["ActivityStatusPosition"] != DBNull.Value)
                                activity.ActivityStatus.Position = Convert.ToInt32(activityreader["ActivityStatusPosition"].ToString());

                            if (activity.ActivityStatus.IdLookupValue == 48)
                            {
                                activity.ActivityGridStatus = "Completed";
                            }
                            else
                            {
                                activity.ActivityGridStatus = activityreader["ActivityStatus"].ToString();
                            }
                        }

                        listActivity.Add(activity);
                    }
                }
            }

            return listActivity;
        }

        //[Sudhir.jangra][GEOS2-4676][29/08/2023]
        public List<LogEntriesByContact> GetLogEntriesByContact(Int32 idContact, byte idLogEntryType, string mainConnectionString)
        {
            List<LogEntriesByContact> listLogEntriesByActivity = new List<LogEntriesByContact>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(mainConnectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("logEntryContact_GetlogEntriesByContact", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdContact", idContact);
                mySqlCommand.Parameters.AddWithValue("_IdLogEntryType", idLogEntryType);

                using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        LogEntriesByContact logEntryContact = new LogEntriesByContact();
                        logEntryContact.IdContact = idContact;
                        logEntryContact.IdLogEntryByContact = Convert.ToInt64(reader["IdLogEntryByContact"]);

                        if (reader["IdUser"] != DBNull.Value)
                        {
                            logEntryContact.IdUser = Convert.ToInt32(reader["IdUser"]);

                            logEntryContact.User = new People();
                            logEntryContact.User.IdPerson = logEntryContact.IdUser;
                            logEntryContact.User.Name = Convert.ToString(reader["Name"]);
                            logEntryContact.User.Surname = Convert.ToString(reader["Surname"]);

                            if (reader["Login"] != DBNull.Value)
                                logEntryContact.User.Login = Convert.ToString(reader["Login"]);

                            if (reader["IdUserGender"] != DBNull.Value)
                                logEntryContact.User.IdPersonGender = Convert.ToByte(reader["IdUserGender"]);
                        }

                        if (reader["Datetime"] != DBNull.Value)
                            logEntryContact.Datetime = Convert.ToDateTime(reader["Datetime"]);

                        if (reader["Comments"] != DBNull.Value)
                            logEntryContact.Comments = Convert.ToString(reader["Comments"]);

                        if (reader["IdLogEntryType"] != DBNull.Value)
                            logEntryContact.IdLogEntryType = Convert.ToByte(reader["IdLogEntryType"]);

                        if (reader["IsRtfText"] != DBNull.Value)
                            logEntryContact.IsRtfText = Convert.ToBoolean(reader["IsRtfText"]);

                        listLogEntriesByActivity.Add(logEntryContact);
                    }
                }
            }

            return listLogEntriesByActivity;
        }

        //[Sudhir.jangra][GEOS2-4676][29/08/2023]
        public bool UpdateContact(string mainServerConnectionString, People people)
        {
            TransactionScope transactionScope = null;
            List<People> peoples = new List<People>();

            try
            {
                using (transactionScope = new TransactionScope())
                {
                    using (MySqlConnection concompany = new MySqlConnection(mainServerConnectionString))
                    {
                        concompany.Open();

                        MySqlCommand concompanycommand = new MySqlCommand("people_UpdateContact", concompany);
                        concompanycommand.CommandType = CommandType.StoredProcedure;
                        concompanycommand.Parameters.AddWithValue("_IdPerson", people.IdPerson);
                        concompanycommand.Parameters.AddWithValue("_Name", people.Name);
                        concompanycommand.Parameters.AddWithValue("_Surname", people.Surname);
                        concompanycommand.Parameters.AddWithValue("_Email", people.Email);
                        concompanycommand.Parameters.AddWithValue("_IdSite", people.IdSite);
                        concompanycommand.Parameters.AddWithValue("_Phone", people.Phone);
                        concompanycommand.Parameters.AddWithValue("_Observations", people.Observations);
                        concompanycommand.Parameters.AddWithValue("_IdPersonGender", people.IdPersonGender);
                        concompanycommand.Parameters.AddWithValue("_IdCompany", people.Company.IdCompany);
                        concompanycommand.Parameters.AddWithValue("_IdCountry", people.Company.IdCountry);
                        concompanycommand.Parameters.AddWithValue("_Address", people.Company.Address);
                        concompanycommand.Parameters.AddWithValue("_Telephone", people.Company.Telephone);
                        concompanycommand.Parameters.AddWithValue("_CompanyEmail", people.Company.Email);
                        concompanycommand.Parameters.AddWithValue("_Region", people.Company.Region);
                        concompanycommand.Parameters.AddWithValue("_City", people.Company.City);
                        concompanycommand.Parameters.AddWithValue("_PostCode", people.Company.ZipCode);
                        concompanycommand.Parameters.AddWithValue("_ModifiedBy", people.Company.ModifiedBy);
                        concompanycommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now);
                        concompanycommand.Parameters.AddWithValue("_IdCompanyDepartment", people.IdCompanyDepartment);
                        concompanycommand.Parameters.AddWithValue("_JobTitle", people.JobTitle);
                        concompanycommand.Parameters.AddWithValue("_Image", people.ImageText);
                        concompanycommand.Parameters.AddWithValue("_IdContactInfluenceLevel", people.IdContactInfluenceLevel);
                        concompanycommand.Parameters.AddWithValue("_IdContactEmdepAffinity", people.IdContactEmdepAffinity);
                        concompanycommand.Parameters.AddWithValue("_IdContactProductInvolved", people.IdContactProductInvolved);
                        concompanycommand.Parameters.AddWithValue("_IdCompetitor", people.IdCompetitor);

                        concompanycommand.ExecuteNonQuery();
                        concompany.Close();
                    }

                    if (people.CommentsByContact != null && people.CommentsByContact.Count > 0)
                        AddUpdateDeleteCommentsByContact(people.IdPerson, people.CommentsByContact, mainServerConnectionString);

                    if (people.LogEntriesByContact != null && people.LogEntriesByContact.Count > 0)
                        AddLogEntriesByContact(people.IdPerson, people.LogEntriesByContact, mainServerConnectionString);

                    transactionScope.Complete();
                }
            }
            catch (Exception ex)
            {
                if (Transaction.Current != null)
                    Transaction.Current.Rollback();

                if (transactionScope != null)
                    transactionScope.Dispose();

                throw;
            }

            return true;
        }

        //[Sudhir.Jangra][GEOS2-4676][29/08/2023]
        public void AddLogEntriesByContact(Int32 idContact, List<LogEntriesByContact> logEntriesByContact, string mainServerConnectionString)
        {
            if (logEntriesByContact != null)
            {
                foreach (LogEntriesByContact logEntryContact in logEntriesByContact)
                {
                    using (MySqlConnection connLogEntries = new MySqlConnection(mainServerConnectionString))
                    {
                        connLogEntries.Open();

                        MySqlCommand logEntriesCommand = new MySqlCommand("logEntriesByContact_Insert", connLogEntries);
                        logEntriesCommand.CommandType = CommandType.StoredProcedure;

                        logEntriesCommand.Parameters.AddWithValue("_IdContact", idContact);
                        logEntriesCommand.Parameters.AddWithValue("_IdUser", logEntryContact.IdUser);
                        logEntriesCommand.Parameters.AddWithValue("_Datetime", DateTime.Now);
                        logEntriesCommand.Parameters.AddWithValue("_IdLogEntryType", logEntryContact.IdLogEntryType);
                        logEntriesCommand.Parameters.AddWithValue("_Comments", logEntryContact.Comments);
                        logEntriesCommand.Parameters.AddWithValue("_IsRtfText", logEntryContact.IsRtfText);

                        logEntriesCommand.ExecuteScalar();
                        connLogEntries.Close();
                    }
                }
            }
        }

        //[Sudhir.Jangra][GEOS2-4676][29/08/2023]
        public void AddUpdateDeleteCommentsByContact(Int32 idContact, List<LogEntriesByContact> logEntriesByContact, string mainServerConnectionString)
        {
            if (logEntriesByContact != null)
            {
                try
                {
                    foreach (LogEntriesByContact logEntryContact in logEntriesByContact)
                    {
                        if (logEntryContact.IsUpdated)
                        {
                            using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerConnectionString))
                            {
                                mySqlConnection.Open();

                                MySqlCommand updateCommentCommand = new MySqlCommand("logEntriesByContact_Update", mySqlConnection);
                                updateCommentCommand.CommandType = CommandType.StoredProcedure;
                                updateCommentCommand.Parameters.AddWithValue("_IdLogEntryByContact", logEntryContact.IdLogEntryByContact);
                                updateCommentCommand.Parameters.AddWithValue("_Comments", logEntryContact.Comments);
                                updateCommentCommand.Parameters.AddWithValue("_Datetime", DateTime.Now);
                                updateCommentCommand.Parameters.AddWithValue("_IsRtfText", logEntryContact.IsRtfText);

                                updateCommentCommand.ExecuteScalar();
                                mySqlConnection.Close();
                            }
                        }
                        else if (logEntryContact.IsDeleted)
                        {
                            using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerConnectionString))
                            {
                                mySqlConnection.Open();

                                MySqlCommand deleteCommentCommand = new MySqlCommand("logEntriesByContact_Delete", mySqlConnection);
                                deleteCommentCommand.CommandType = CommandType.StoredProcedure;
                                deleteCommentCommand.Parameters.AddWithValue("_IdLogEntryByContact", logEntryContact.IdLogEntryByContact);

                                deleteCommentCommand.ExecuteNonQuery();
                                mySqlConnection.Close();
                            }
                        }
                        else
                        {
                            using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerConnectionString))
                            {
                                mySqlConnection.Open();

                                MySqlCommand insertCommentsCommand = new MySqlCommand("logEntriesByContact_Insert", mySqlConnection);
                                insertCommentsCommand.CommandType = CommandType.StoredProcedure;

                                insertCommentsCommand.Parameters.AddWithValue("_IdContact", idContact);
                                insertCommentsCommand.Parameters.AddWithValue("_IdUser", logEntryContact.IdUser);
                                insertCommentsCommand.Parameters.AddWithValue("_Datetime", DateTime.Now);
                                insertCommentsCommand.Parameters.AddWithValue("_IdLogEntryType", logEntryContact.IdLogEntryType);
                                insertCommentsCommand.Parameters.AddWithValue("_Comments", logEntryContact.Comments);
                                insertCommentsCommand.Parameters.AddWithValue("_IsRtfText", logEntryContact.IsRtfText);

                                logEntryContact.IdLogEntryByContact = Convert.ToInt32(insertCommentsCommand.ExecuteScalar());
                                mySqlConnection.Close();
                            }
                        }
                    }
                }
                catch (Exception ex)
                {
                    throw;
                }
            }
        }

        //[Sudhir.jangra][GEOS2-4676][29/08/2023]
        public People AddContact_V2033(string mainServerConnectionString, People people)
        {
            TransactionScope transactionScope = null;
            try
            {
                using (transactionScope = new TransactionScope())
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("people_InsertContact_V2033", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdPersonType", people.IdPersonType);
                        mySqlCommand.Parameters.AddWithValue("_Name", people.Name);
                        mySqlCommand.Parameters.AddWithValue("_Surname", people.Surname);
                        mySqlCommand.Parameters.AddWithValue("_Email", people.Email);
                        mySqlCommand.Parameters.AddWithValue("_Phone", people.Phone);
                        mySqlCommand.Parameters.AddWithValue("_Observations", people.Observations);
                        mySqlCommand.Parameters.AddWithValue("_IdPersonGender", people.IdPersonGender);
                        mySqlCommand.Parameters.AddWithValue("_IdCompany", people.Company.IdCompany);
                        mySqlCommand.Parameters.AddWithValue("_IdCountry", people.Company.IdCountry);
                        mySqlCommand.Parameters.AddWithValue("_Address", people.Company.Address);
                        mySqlCommand.Parameters.AddWithValue("_Telephone", people.Company.Telephone);
                        mySqlCommand.Parameters.AddWithValue("_CompanyEmail", people.Company.Email);
                        mySqlCommand.Parameters.AddWithValue("_Region", people.Company.Region);
                        mySqlCommand.Parameters.AddWithValue("_City", people.Company.City);
                        mySqlCommand.Parameters.AddWithValue("_PostCode", people.Company.ZipCode);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedBy", people.Company.ModifiedBy);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now);
                        mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now);
                        mySqlCommand.Parameters.AddWithValue("_IdCompanyDepartment", people.IdCompanyDepartment);
                        mySqlCommand.Parameters.AddWithValue("_JobTitle", people.JobTitle);
                        mySqlCommand.Parameters.AddWithValue("_Image", people.ImageText);
                        mySqlCommand.Parameters.AddWithValue("_IdContactInfluenceLevel", people.IdContactInfluenceLevel);
                        mySqlCommand.Parameters.AddWithValue("_IdContactEmdepAffinity", people.IdContactEmdepAffinity);
                        mySqlCommand.Parameters.AddWithValue("_IdContactProductInvolved", people.IdContactProductInvolved);
                        mySqlCommand.Parameters.AddWithValue("_IdCompetitor", people.IdCompetitor);
                        mySqlCommand.Parameters.AddWithValue("_IdCreator", people.IdCreator);

                        people.IdPerson = Convert.ToInt32(mySqlCommand.ExecuteScalar());
                        mySqlConnection.Close();
                    }

                    if (people.CommentsByContact != null && people.CommentsByContact.Count > 0)
                        AddUpdateDeleteCommentsByContact(people.IdPerson, people.CommentsByContact, mainServerConnectionString);

                    if (people.LogEntriesByContact != null && people.LogEntriesByContact.Count > 0)
                        AddLogEntriesByContact(people.IdPerson, people.LogEntriesByContact, mainServerConnectionString);

                    transactionScope.Complete();
                }
            }
            catch (Exception ex)
            {
                if (Transaction.Current != null)
                    Transaction.Current.Rollback();

                if (transactionScope != null)
                    transactionScope.Dispose();

                throw;
            }

            return people;
        }


        //[Sudhir.jangra][GEOS2-4676][29/08/2023]
        public People AddSRMContact_V2430(string mainServerConnectionString, People people)
        {
            TransactionScope transactionScope = null;
            try
            {
                using (transactionScope = new TransactionScope())
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("people_InsertContact_V2430", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdPersonType", people.IdPersonType);
                        mySqlCommand.Parameters.AddWithValue("_Name", people.Name);
                        mySqlCommand.Parameters.AddWithValue("_Surname", people.Surname);
                        mySqlCommand.Parameters.AddWithValue("_Email", people.Email);
                        mySqlCommand.Parameters.AddWithValue("_Phone", people.Phone);
                        mySqlCommand.Parameters.AddWithValue("_Observations", people.Observations);
                        mySqlCommand.Parameters.AddWithValue("_IdPersonGender", people.IdPersonGender);
                        mySqlCommand.Parameters.AddWithValue("_IdCompany", people.Company.IdCompany);
                        mySqlCommand.Parameters.AddWithValue("_IdCountry", people.Company.IdCountry);
                        mySqlCommand.Parameters.AddWithValue("_Address", people.Company.Address);
                        mySqlCommand.Parameters.AddWithValue("_Telephone", people.Company.Telephone);
                        mySqlCommand.Parameters.AddWithValue("_CompanyEmail", people.Company.Email);
                        mySqlCommand.Parameters.AddWithValue("_Region", people.Company.Region);
                        mySqlCommand.Parameters.AddWithValue("_City", people.Company.City);
                        mySqlCommand.Parameters.AddWithValue("_PostCode", people.Company.ZipCode);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedBy", people.Company.ModifiedBy);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now);
                        mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now);
                        mySqlCommand.Parameters.AddWithValue("_IdCompanyDepartment", people.IdCompanyDepartment);
                        mySqlCommand.Parameters.AddWithValue("_JobTitle", people.JobTitle);
                        mySqlCommand.Parameters.AddWithValue("_Image", people.ImageText);
                        mySqlCommand.Parameters.AddWithValue("_IdContactInfluenceLevel", people.IdContactInfluenceLevel);
                        mySqlCommand.Parameters.AddWithValue("_IdContactEmdepAffinity", people.IdContactEmdepAffinity);
                        mySqlCommand.Parameters.AddWithValue("_IdContactProductInvolved", people.IdContactProductInvolved);
                        mySqlCommand.Parameters.AddWithValue("_IdCompetitor", people.IdCompetitor);
                        mySqlCommand.Parameters.AddWithValue("_IdCreator", people.IdCreator);
                        mySqlCommand.Parameters.AddWithValue("_Phone2", people.Phone2);

                        people.IdPerson = Convert.ToInt32(mySqlCommand.ExecuteScalar());
                        mySqlConnection.Close();
                    }

                    if (people.CommentsByContact != null && people.CommentsByContact.Count > 0)
                        AddUpdateDeleteCommentsByContact(people.IdPerson, people.CommentsByContact, mainServerConnectionString);

                    if (people.LogEntriesByContact != null && people.LogEntriesByContact.Count > 0)
                        AddLogEntriesByContact(people.IdPerson, people.LogEntriesByContact, mainServerConnectionString);

                    transactionScope.Complete();
                }
            }
            catch (Exception ex)
            {
                if (Transaction.Current != null)
                    Transaction.Current.Rollback();

                if (transactionScope != null)
                    transactionScope.Dispose();

                throw;
            }

            return people;
        }

        //[Sudhir.jangra][GEOS2-4676][29/08/2023]
        public List<People> GetContactsByIdPermission_V2430(string connectionstring, Int32 idActiveUser, string idUser, string idSite, Int32 idPermission)
        {
            List<People> peoples = new List<People>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionstring))
            {
                mySqlConnection.Open();
                MySqlCommand mySqlCommand = new MySqlCommand("people_getcontactsbyidpermission_V2430", mySqlConnection);

                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_idActiveUser", idActiveUser);
                mySqlCommand.Parameters.AddWithValue("_idUser", idUser);
                mySqlCommand.Parameters.AddWithValue("_idSite", idSite);
                mySqlCommand.Parameters.AddWithValue("_idPermission", idPermission);

                using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        People people = new People();
                        people.IdPerson = Convert.ToInt32(reader["IdPerson"]);
                        people.Name = Convert.ToString(reader["FirstName"]);
                        people.Surname = Convert.ToString(reader["LastName"]);
                        people.Phone = Convert.ToString(reader["Telephone"]);
                        people.Phone2 = Convert.ToString(reader["Telephone2"]);
                        people.Email = Convert.ToString(reader["Email"]);

                        if (reader["IdPersonGender"] != DBNull.Value)
                        {
                            people.IdPersonGender = Convert.ToByte(reader["IdPersonGender"]);
                            if (people.IdPersonGender == 1)
                                people.UserGender = "Female";
                            else if (people.IdPersonGender == 2)
                                people.UserGender = "Male";
                        }

                        people.IdPersonType = Convert.ToByte(reader["IdPersonType"].ToString());
                        people.PeopleType = new PeopleType();
                        people.PeopleType.IdPersonType = Convert.ToByte(reader["IdPersonType"].ToString());
                        people.PeopleType.Name = Convert.ToString(reader["PersonTypeName"]);

                        if (reader["CreatedIn"] != DBNull.Value)
                            people.CreatedIn = Convert.ToDateTime(reader["CreatedIn"].ToString());

                        people.Company = new Company() { IdCompany = Convert.ToInt32(reader["IdCompany"].ToString()), Name = reader["CustomerPlant"].ToString().Trim(), Country = new Country { IdCountry = Convert.ToByte(reader["IdCountry"].ToString()), Name = reader["Country"].ToString(), CountryIconUrl = "https://api.emdep.com/GEOS/Images?FilePath=/Images/Countries/" + reader["Iso"].ToString() + ".png", Zone = new Zone { Name = reader["Zone"].ToString() } } };

                        //if (idPermission == 21 || idPermission == 22)
                        //{
                        //    if (reader["IdSalesResponsible"] != DBNull.Value)
                        //    {
                        //        people.Company.IdSalesResponsible = Convert.ToInt32(reader["IdSalesResponsible"]);
                        //        people.Company.People = new People();
                        //        people.Company.People.IdPerson = (Int32)people.Company.IdSalesResponsible;

                        //        if (reader["SalesResponsibleFirstName"] != DBNull.Value)
                        //            people.Company.People.Name = Convert.ToString(reader["SalesResponsibleFirstName"]);

                        //        if (reader["SalesResponsibleLastName"] != DBNull.Value)
                        //            people.Company.People.Surname = Convert.ToString(reader["SalesResponsibleLastName"]);
                        //    }

                        //    if (reader["IdSalesResponsibleAssemblyBU"] != DBNull.Value)
                        //    {
                        //        people.Company.IdSalesResponsibleAssemblyBU = Convert.ToInt32(reader["IdSalesResponsibleAssemblyBU"]);

                        //        people.Company.PeopleSalesResponsibleAssemblyBU = new People();
                        //        people.Company.PeopleSalesResponsibleAssemblyBU.IdPerson = (Int32)people.Company.IdSalesResponsibleAssemblyBU;

                        //        if (reader["SalesResponsibleBUFirstName"] != DBNull.Value)
                        //            people.Company.PeopleSalesResponsibleAssemblyBU.Name = Convert.ToString(reader["SalesResponsibleBUFirstName"]);

                        //        if (reader["SalesResponsibleBULastName"] != DBNull.Value)
                        //            people.Company.PeopleSalesResponsibleAssemblyBU.Surname = Convert.ToString(reader["SalesResponsibleBULastName"]);
                        //    }
                        //}

                        people.Company.Address = Convert.ToString(reader["SiteAddress"]);
                        people.Observations = Convert.ToString(reader["Observations"]);
                        people.Company.City = Convert.ToString(reader["SiteCity"]);
                        people.Company.CIF = Convert.ToString(reader["SiteCIF"]);
                        people.Company.Telephone = Convert.ToString(reader["SiteTelephone"]);
                        people.Company.Fax = Convert.ToString(reader["SiteFax"]);
                        people.Company.PostCode = Convert.ToString(reader["SitePostCode"]);
                        people.Company.ZipCode = Convert.ToString(reader["SitePostCode"]);
                        people.Company.Region = Convert.ToString(reader["SiteRegion"]);
                        people.Company.RegisteredName = Convert.ToString(reader["SiteRegisteredName"]);
                        people.Company.Website = Convert.ToString(reader["SiteWebsite"]);
                        people.Company.Customers = new List<Customer> { new Customer { IdCustomer = Convert.ToInt32(reader["IdCustomer"].ToString()), CustomerName = reader["CustomerGroup"].ToString() } };

                        if (reader["IdCompanyDepartment"] != DBNull.Value)
                        {
                            people.IdCompanyDepartment = Convert.ToInt32(reader["IdCompanyDepartment"].ToString());
                            people.CompanyDepartment = new LookupValue();
                            people.CompanyDepartment.IdLookupValue = Convert.ToInt32(reader["IdCompanyDepartment"].ToString());
                            people.CompanyDepartment.Value = reader["Value"].ToString();

                            if (reader["IdImage"] != DBNull.Value)
                                people.CompanyDepartment.IdImage = Convert.ToInt64(reader["IdImage"].ToString());

                        }

                        people.JobTitle = reader["JobTitle"].ToString();
                        people.ImageText = reader["Image"].ToString();

                        if (reader["IdContactInfluenceLevel"] != DBNull.Value)
                        {
                            people.IdContactInfluenceLevel = Convert.ToInt32(reader["IdContactInfluenceLevel"].ToString());
                            people.InfluenceLevel = new LookupValue();
                            people.InfluenceLevel.IdLookupValue = Convert.ToInt32(reader["IdContactInfluenceLevel"].ToString());
                            people.InfluenceLevel.Value = reader["InfluenceLevel"].ToString();
                            people.InfluenceLevel.HtmlColor = reader["InfluenceLevelHtmlcolor"].ToString();

                            if (reader["InfluenceLevelIdImage"] != DBNull.Value)
                                people.InfluenceLevel.IdImage = Convert.ToInt64(reader["InfluenceLevelIdImage"].ToString());
                        }

                        if (reader["IdContactEmdepAffinity"] != DBNull.Value)
                        {
                            people.IdContactEmdepAffinity = Convert.ToInt32(reader["IdContactEmdepAffinity"].ToString());
                            people.EmdepAffinity = new LookupValue();
                            people.EmdepAffinity.IdLookupValue = Convert.ToInt32(reader["IdContactEmdepAffinity"].ToString());
                            people.EmdepAffinity.Value = reader["EmdepAffinity"].ToString();
                            people.EmdepAffinity.HtmlColor = reader["EmdepAffinityHtmlcolor"].ToString();

                            if (reader["EmdepAffinityIdImage"] != DBNull.Value)
                                people.EmdepAffinity.IdImage = Convert.ToInt64(reader["EmdepAffinityIdImage"].ToString());
                        }

                        if (reader["IdContactProductInvolved"] != DBNull.Value)
                        {
                            people.IdContactProductInvolved = Convert.ToInt32(reader["IdContactProductInvolved"].ToString());
                            people.ProductInvolved = new LookupValue();
                            people.ProductInvolved.IdLookupValue = Convert.ToInt32(reader["IdContactProductInvolved"].ToString());
                            people.ProductInvolved.Value = reader["ProductInvolved"].ToString();
                            people.ProductInvolved.HtmlColor = reader["ProductInvolvedLevelHtmlcolor"].ToString();

                            if (reader["ProductInvolvedLevelIdImage"] != DBNull.Value)
                                people.ProductInvolved.IdImage = Convert.ToInt64(reader["ProductInvolvedLevelIdImage"].ToString());
                        }

                        if (reader["IdCompetitor"] != DBNull.Value)
                        {
                            people.IdCompetitor = Convert.ToInt32(reader["IdCompetitor"].ToString());
                            people.Competitor = new Competitor();
                            people.Competitor.IdCompetitor = Convert.ToInt32(reader["IdCompetitor"].ToString());
                            people.Competitor.Name = reader["Competitor"].ToString();
                        }


                        if (reader["IdCreator"] != DBNull.Value)
                        {
                            people.IdCreator = Convert.ToInt32(reader["IdCreator"].ToString());
                            people.Creator = new People();
                            people.Creator.IdPerson = Convert.ToInt32(reader["IdCreator"].ToString());
                            people.Creator.Name = Convert.ToString(reader["CreatedByFirstName"].ToString());
                            people.Creator.Surname = Convert.ToString(reader["CreatedByLastName"].ToString());
                        }

                        peoples.Add(people);
                    }
                    if (reader.NextResult())
                    {
                        while (reader.Read())
                        {
                            People saleowner = new People();
                            if (reader["IdPerson"] != DBNull.Value)
                            {
                                People people = peoples.Where(i => i.IdPerson == Convert.ToInt64(reader["IdPerson"].ToString())).FirstOrDefault();
                                if (people.Company.SalesOwnerList == null)
                                    people.Company.SalesOwnerList = new List<People>();
                                if (idPermission == 21 || idPermission == 22)
                                {
                                    if (reader["IdSiteSalesOwner"] != DBNull.Value)
                                    {
                                        //people.Company.IdSalesResponsible = Convert.ToInt32(reader["IdSalesResponsible"]);

                                        saleowner.IdPerson = Convert.ToInt32(reader["IdSalesOwner"]);

                                        if (reader["IdSite"] != DBNull.Value)
                                            saleowner.IdSite = Convert.ToInt32(reader["IdSite"]);

                                        if (reader["IsMainSalesOwner"] != DBNull.Value)
                                        {
                                            int i = Convert.ToInt32(reader["IsMainSalesOwner"]);
                                            if (i == 1)
                                                saleowner.IsSalesResponsible = true;
                                        }
                                        if (reader["salesresponsiblename"] != DBNull.Value)
                                        {
                                            saleowner.Name = Convert.ToString(reader["salesresponsiblename"]);
                                            if (people.SalesOwner == null)
                                                people.SalesOwner = saleowner.Name;
                                            else
                                                people.SalesOwner = people.SalesOwner + "\n" + saleowner.Name;
                                        }
                                    }
                                }
                                people.Company.SalesOwnerList.Add(saleowner);
                            }
                        }
                    }
                }
            }
            return peoples;
        }


        //[Sudhir.jangra][GEOS2-4676][29/08/2023]
        public bool UpdateContact_V2430(string mainServerConnectionString, People people)
        {
            TransactionScope transactionScope = null;
            List<People> peoples = new List<People>();

            try
            {
                using (transactionScope = new TransactionScope())
                {
                    using (MySqlConnection concompany = new MySqlConnection(mainServerConnectionString))
                    {
                        concompany.Open();

                        MySqlCommand concompanycommand = new MySqlCommand("people_UpdateContact_V2430", concompany);
                        concompanycommand.CommandType = CommandType.StoredProcedure;
                        concompanycommand.Parameters.AddWithValue("_IdPerson", people.IdPerson);
                        concompanycommand.Parameters.AddWithValue("_Name", people.Name);
                        concompanycommand.Parameters.AddWithValue("_Surname", people.Surname);
                        concompanycommand.Parameters.AddWithValue("_Email", people.Email);
                        concompanycommand.Parameters.AddWithValue("_IdSite", people.IdSite);
                        concompanycommand.Parameters.AddWithValue("_Phone", people.Phone);
                        concompanycommand.Parameters.AddWithValue("_Phone2", people.Phone2);
                        concompanycommand.Parameters.AddWithValue("_Observations", people.Observations);
                        concompanycommand.Parameters.AddWithValue("_IdPersonGender", people.IdPersonGender);
                        concompanycommand.Parameters.AddWithValue("_IdCompany", people.Company.IdCompany);
                        concompanycommand.Parameters.AddWithValue("_IdCountry", people.Company.IdCountry);
                        concompanycommand.Parameters.AddWithValue("_Address", people.Company.Address);
                        concompanycommand.Parameters.AddWithValue("_Telephone", people.Company.Telephone);
                        concompanycommand.Parameters.AddWithValue("_CompanyEmail", people.Company.Email);
                        concompanycommand.Parameters.AddWithValue("_Region", people.Company.Region);
                        concompanycommand.Parameters.AddWithValue("_City", people.Company.City);
                        concompanycommand.Parameters.AddWithValue("_PostCode", people.Company.ZipCode);
                        concompanycommand.Parameters.AddWithValue("_ModifiedBy", people.Company.ModifiedBy);
                        concompanycommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now);
                        concompanycommand.Parameters.AddWithValue("_IdCompanyDepartment", people.IdCompanyDepartment);
                        concompanycommand.Parameters.AddWithValue("_JobTitle", people.JobTitle);
                        concompanycommand.Parameters.AddWithValue("_Image", people.ImageText);
                        concompanycommand.Parameters.AddWithValue("_IdContactInfluenceLevel", people.IdContactInfluenceLevel);
                        concompanycommand.Parameters.AddWithValue("_IdContactEmdepAffinity", people.IdContactEmdepAffinity);
                        concompanycommand.Parameters.AddWithValue("_IdContactProductInvolved", people.IdContactProductInvolved);
                        concompanycommand.Parameters.AddWithValue("_IdCompetitor", people.IdCompetitor);

                        concompanycommand.ExecuteNonQuery();
                        concompany.Close();
                    }

                    if (people.CommentsByContact != null && people.CommentsByContact.Count > 0)
                        AddUpdateDeleteCommentsByContact(people.IdPerson, people.CommentsByContact, mainServerConnectionString);

                    if (people.LogEntriesByContact != null && people.LogEntriesByContact.Count > 0)
                        AddLogEntriesByContact(people.IdPerson, people.LogEntriesByContact, mainServerConnectionString);

                    transactionScope.Complete();
                }
            }
            catch (Exception ex)
            {
                if (Transaction.Current != null)
                    Transaction.Current.Rollback();

                if (transactionScope != null)
                    transactionScope.Dispose();

                throw;
            }

            return true;
        }

        // [rdixit][GEOS2-4822][13-09-2023]
        public List<WarehousePurchaseOrderItemWithComments> GetArticlesByIdWarehousePurchaseOrder_V2430(string connectionString, Int64 idWarehousePurchaseOrder)
        {
            List<WarehousePurchaseOrderItemWithComments> warehousePurchaseOrderItems = new List<WarehousePurchaseOrderItemWithComments>();

            using (MySqlConnection connWarehousePurchaseOrderItem = new MySqlConnection(connectionString))
            {
                connWarehousePurchaseOrderItem.Open();

                MySqlCommand activitiesCommand = new MySqlCommand("SRM_GetArticlesAndPOItemsByIdWarehousePurchaseOrder_V2430", connWarehousePurchaseOrderItem);
                activitiesCommand.CommandType = CommandType.StoredProcedure;
                activitiesCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", idWarehousePurchaseOrder);

                using (MySqlDataReader poReader = activitiesCommand.ExecuteReader())
                {
                    while (poReader.Read())
                    {
                        try
                        {
                            WarehousePurchaseOrderItemWithComments warehousePurchaseOrderItem = new WarehousePurchaseOrderItemWithComments();

                            warehousePurchaseOrderItem.IdWarehousePurchaseOrder = idWarehousePurchaseOrder;

                            if (poReader["IdWarehousePurchaseOrderItem"] != DBNull.Value)
                                warehousePurchaseOrderItem.IdWarehousePurchaseOrderItem = Convert.ToInt64(poReader["IdWarehousePurchaseOrderItem"]);

                            if (poReader["Description"] != DBNull.Value)
                                warehousePurchaseOrderItem.Description = Convert.ToString(poReader["Description"]);

                            if (poReader["IdArticle"] != DBNull.Value)
                            {
                                warehousePurchaseOrderItem.IdArticle = Convert.ToInt32(poReader["IdArticle"]);

                                Article article = new Article();

                                if (poReader["Reference"] != DBNull.Value)
                                    article.Reference = Convert.ToString(poReader["Reference"]);

                                if (poReader["IsGeneric"] != DBNull.Value)
                                    article.IsGeneric = Convert.ToSByte(poReader["IsGeneric"]);

                                if (poReader["IdArticleCategory"] != DBNull.Value)
                                    article.IdArticleCategory = Convert.ToInt32(poReader["IdArticleCategory"]);

                                warehousePurchaseOrderItem.Article = article;
                            }

                            if (poReader["Quantity"] != DBNull.Value)
                                warehousePurchaseOrderItem.Quantity = Convert.ToInt32(poReader["Quantity"]);

                            if (poReader["UnitPrice"] != DBNull.Value)
                                warehousePurchaseOrderItem.UnitPrice = Convert.ToDouble(poReader["UnitPrice"]);

                            if (poReader["Discount"] != DBNull.Value)
                                warehousePurchaseOrderItem.Discount = Convert.ToDouble(poReader["Discount"]);

                            if (poReader["Iva"] != DBNull.Value)
                                warehousePurchaseOrderItem.IVA = Convert.ToDouble(poReader["Iva"]);

                            if (poReader["AdditionalComments"] != DBNull.Value)
                                warehousePurchaseOrderItem.AdditionalComments = Convert.ToString(poReader["AdditionalComments"]);

                            if (poReader["Position"] != DBNull.Value)
                                warehousePurchaseOrderItem.Position = Convert.ToInt64(poReader["Position"]);

                            if (poReader["AlbaranQty"] != DBNull.Value)
                                warehousePurchaseOrderItem.ReceivedQuantity = Convert.ToInt32(poReader["AlbaranQty"]);


                            if (poReader["TotalAmount"] != DBNull.Value)
                                warehousePurchaseOrderItem.TotalAmount = Convert.ToDecimal(poReader["TotalAmount"]);

                            if (poReader["TotalAmount"] != DBNull.Value)
                                warehousePurchaseOrderItem.TotalAmount_New = Convert.ToDouble(poReader["TotalAmount"]);

                            if (warehousePurchaseOrderItem.Quantity > 0)
                            {
                                warehousePurchaseOrderItem.Status = (Int32)(warehousePurchaseOrderItem.ReceivedQuantity / warehousePurchaseOrderItem.Quantity * 100);
                            }

                            warehousePurchaseOrderItem.WarehousePurchaseOrderExpectedItems = GetWarehousePOExpectedItems(connectionString, warehousePurchaseOrderItem.IdWarehousePurchaseOrderItem);

                            if (warehousePurchaseOrderItem.WarehousePurchaseOrderExpectedItems.Count > 0)
                            {
                                warehousePurchaseOrderItem.ExpectedDate = warehousePurchaseOrderItem.WarehousePurchaseOrderExpectedItems.First().Date;
                            }

                            warehousePurchaseOrderItem.ReceivedDeliveryNotes = GetDeliveryNotesByIdWarehousePurchaseOrderItem(connectionString, warehousePurchaseOrderItem.IdWarehousePurchaseOrderItem);
                            warehousePurchaseOrderItems.Add(warehousePurchaseOrderItem);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetArticlesByIdWarehousePurchaseOrder_V2430(idWarehousePurchaseOrder-{0}). ErrorMessage- {1}", idWarehousePurchaseOrder, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            return warehousePurchaseOrderItems;
        }

        // [rdixit][GEOS2-4822][13-09-2023]
        public WarehousePurchaseOrder GetPendingPOByIdWarehousePurchaseOrder_V2430(string connectionString, Int64 idWarehousePurchaseOrder, string idShippingAddress, string purchaseOrdersPath, string emailTemplatePath, string countryIconFilePath)
        {
            WarehousePurchaseOrder warehousePurchaseOrder = null;

            Country country = new Country();
            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();
                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetPendingPOByIdWarehousePurchaseOrder_V2420", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", idWarehousePurchaseOrder);

                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    if (mySqlDataReader.Read())
                    {
                        try
                        {

                            warehousePurchaseOrder = new WarehousePurchaseOrder();
                            List<WarehouseShippingAddress> warehouseShippingAddresses = new List<WarehouseShippingAddress>();


                            warehousePurchaseOrder.IdWarehousePurchaseOrder = idWarehousePurchaseOrder;

                            if (mySqlDataReader["Code"] != DBNull.Value)
                                warehousePurchaseOrder.Code = Convert.ToString(mySqlDataReader["Code"]);

                            if (mySqlDataReader["IdArticleSupplier"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                                ArticleSupplier articleSupplier = new ArticleSupplier();
                                articleSupplier.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                                if (mySqlDataReader["Supplier"] != DBNull.Value)
                                    articleSupplier.Name = Convert.ToString(mySqlDataReader["Supplier"]);

                                if (mySqlDataReader["SupplierContactPerson"] != DBNull.Value)
                                    articleSupplier.ContactPerson = Convert.ToString(mySqlDataReader["SupplierContactPerson"]);

                                if (mySqlDataReader["SupplierContactEmail"] != DBNull.Value)
                                    articleSupplier.ContactEmail = Convert.ToString(mySqlDataReader["SupplierContactEmail"]);

                                if (mySqlDataReader["Serie"] != DBNull.Value)
                                    articleSupplier.Serie = Convert.ToChar(mySqlDataReader["Serie"]);

                                if (mySqlDataReader["IdCountry"] != DBNull.Value)
                                {
                                    articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["IdCountry"]);

                                    articleSupplier.Country = new Country();
                                    articleSupplier.Country.IdCountry = (byte)articleSupplier.IdCountry;
                                    articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);

                                    if (mySqlDataReader["SupplierCountryISO"] != DBNull.Value)
                                    {
                                        articleSupplier.Country.Iso = Convert.ToString(mySqlDataReader["SupplierCountryISO"]);
                                        byte[] bytes = null;
                                        bytes = GetCountryIconFileInBytes(articleSupplier.Country.Iso, countryIconFilePath);
                                        articleSupplier.Country.CountryIconBytes = bytes;
                                    }

                                    if (mySqlDataReader["IdCountryGroup"] != DBNull.Value)
                                        articleSupplier.Country.IdCountryGroup = Convert.ToInt64(mySqlDataReader["IdCountryGroup"]);
                                }

                                if (mySqlDataReader["IdArticleSupplierType"] != DBNull.Value)
                                {
                                    articleSupplier.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["IdArticleSupplierType"]);

                                    articleSupplier.ArticleSupplierType = new ArticleSupplierType();
                                    articleSupplier.ArticleSupplierType.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["IdArticleSupplierType"]);
                                    articleSupplier.ArticleSupplierType.Name = Convert.ToString(mySqlDataReader["ArticleSupplierType"]);
                                    articleSupplier.ArticleSupplierType.HtmlColor = Convert.ToString(mySqlDataReader["HtmlColor"]);
                                }

                                warehousePurchaseOrder.ArticleSupplier = articleSupplier;
                            }
                            //[rdixit][GEOS2-4455][28.06.2023] 
                            //if (mySqlDataReader["DeliveryDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["deliveryDate"]) != DateTime.MinValue)
                            //{
                            //    warehousePurchaseOrder.DeliveryDate = Convert.ToDateTime(mySqlDataReader["deliveryDate"]);
                            //}

                            if (mySqlDataReader["AttachedPO"] != DBNull.Value)
                                warehousePurchaseOrder.AttachedPO = Convert.ToByte(mySqlDataReader["AttachedPO"]);

                            if (mySqlDataReader["IdPaymentType"] != DBNull.Value)
                                warehousePurchaseOrder.IdPaymentType = Convert.ToInt64(mySqlDataReader["IdPaymentType"]);

                            if (mySqlDataReader["ReminderEmailDate"] != DBNull.Value)
                                warehousePurchaseOrder.ReminderEmailDate = Convert.ToDateTime(mySqlDataReader["ReminderEmailDate"]);

                            if (mySqlDataReader["CreatedIn"] != DBNull.Value)
                                warehousePurchaseOrder.CreatedIn = Convert.ToDateTime(mySqlDataReader["CreatedIn"]);

                            if (mySqlDataReader["ModifiedIn"] != DBNull.Value)
                                warehousePurchaseOrder.ModifiedIn = Convert.ToDateTime(mySqlDataReader["ModifiedIn"]);

                            if (mySqlDataReader["Comments"] != DBNull.Value)
                                warehousePurchaseOrder.Comments = Convert.ToString(mySqlDataReader["Comments"]);

                            //[pramod.misal][GEOS2-4449][04-06-2023]warehouseShippingAddress
                            if (mySqlDataReader["Observations"] != DBNull.Value)
                                warehousePurchaseOrder.SupplierComments = Convert.ToString(mySqlDataReader["Observations"]);

                            #region old code
                            //-------------------------------------------------------------------------------------
                            // create a new Sp and  read feilds related to shipping address

                            //if (mySqlDataReader["Name"] != DBNull.Value)
                            //    warehousePurchaseOrder.Name = Convert.ToString(mySqlDataReader["Name"]);

                            //if (mySqlDataReader["Address"] != DBNull.Value)
                            //    warehousePurchaseOrder.Address = Convert.ToString(mySqlDataReader["Address"]);

                            //if (mySqlDataReader["ZipCode"] != DBNull.Value)
                            //    warehousePurchaseOrder.ZipCode = Convert.ToString(mySqlDataReader["ZipCode"]);

                            //if (mySqlDataReader["City"] != DBNull.Value)
                            //    warehousePurchaseOrder.City = Convert.ToString(mySqlDataReader["City"]);

                            //if (mySqlDataReader["Region"] != DBNull.Value)
                            //    warehousePurchaseOrder.Region = Convert.ToString(mySqlDataReader["Region"]);

                            //if (mySqlDataReader["IdCountry"] != DBNull.Value)
                            //    warehousePurchaseOrder.IdCountry = Convert.ToInt64(mySqlDataReader["IdCountry"]);

                            //or

                            //while (mySqlDataReader.Read())
                            //{
                            //    WarehouseShippingAddress warehouseShippingAddress = new WarehouseShippingAddress();

                            //    if (mySqlDataReader["Name"] != DBNull.Value)
                            //        warehouseShippingAddress.Name = Convert.ToString(mySqlDataReader["Name"]);

                            //    if (mySqlDataReader["Address"] != DBNull.Value)
                            //        warehouseShippingAddress.Address = Convert.ToString(mySqlDataReader["Address"]);

                            //    if (mySqlDataReader["ZipCode"] != DBNull.Value)
                            //        warehouseShippingAddress.ZipCode = Convert.ToString(mySqlDataReader["ZipCode"]);

                            //    if (mySqlDataReader["City"] != DBNull.Value)
                            //        warehouseShippingAddress.City = Convert.ToString(mySqlDataReader["City"]);

                            //    if (mySqlDataReader["Region"] != DBNull.Value)
                            //        warehouseShippingAddress.Region = Convert.ToString(mySqlDataReader["Region"]);

                            //    if (mySqlDataReader["IdCountry"] != DBNull.Value)
                            //        warehouseShippingAddress.IdCountry = Convert.ToInt64(mySqlDataReader["IdCountry"]);

                            //    warehouseShippingAddresses.Add(warehouseShippingAddress);
                            //}

                            //warehousePurchaseOrder.WarehouseShippingAddress = warehouseShippingAddresses;


                            //------------------------------------------------------------------------------------------
                            #endregion old code end

                            if (mySqlDataReader["IsClosed"] != DBNull.Value)
                                warehousePurchaseOrder.IsClosed = Convert.ToByte(mySqlDataReader["IsClosed"]);

                            if (mySqlDataReader["CreatedBy"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.CreatedBy = Convert.ToInt64(mySqlDataReader["CreatedBy"]);
                                warehousePurchaseOrder.Creator = new People();
                                warehousePurchaseOrder.Creator.IdPerson = Convert.ToInt32(mySqlDataReader["CreatedBy"].ToString());
                                warehousePurchaseOrder.Creator.Name = mySqlDataReader["CreatorName"].ToString();
                                warehousePurchaseOrder.Creator.Surname = mySqlDataReader["CreatorSurname"].ToString();
                            }

                            if (mySqlDataReader["ModifiedBy"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.ModifiedBy = Convert.ToInt64(mySqlDataReader["ModifiedBy"]);
                                warehousePurchaseOrder.Modifier = new People();
                                warehousePurchaseOrder.Modifier.IdPerson = Convert.ToInt32(mySqlDataReader["ModifiedBy"].ToString());
                                warehousePurchaseOrder.Modifier.Name = mySqlDataReader["ModifierName"].ToString();
                                warehousePurchaseOrder.Modifier.Surname = mySqlDataReader["ModifierSurname"].ToString();
                            }

                            if (mySqlDataReader["ReasonClosed"] != DBNull.Value)
                                warehousePurchaseOrder.ReasonClosed = Convert.ToString(mySqlDataReader["ReasonClosed"]);

                            if (mySqlDataReader["IdWarehouse"] != DBNull.Value)
                                warehousePurchaseOrder.IdWarehouse = Convert.ToInt64(mySqlDataReader["IdWarehouse"]);

                            if (mySqlDataReader["IdShippingAddress"] != DBNull.Value)
                                warehousePurchaseOrder.IdShippingAddress = Convert.ToInt64(mySqlDataReader["IdShippingAddress"]);

                            if (mySqlDataReader["IdCurrency"] != DBNull.Value)
                                warehousePurchaseOrder.IdCurrency = Convert.ToByte(mySqlDataReader["IdCurrency"]);

                            if (mySqlDataReader["IdWorkflowStatus"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                warehousePurchaseOrder.WorkflowStatus = new WorkflowStatus();
                                warehousePurchaseOrder.WorkflowStatus.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                warehousePurchaseOrder.WorkflowStatus.Name = Convert.ToString(mySqlDataReader["Status"]);
                                warehousePurchaseOrder.WorkflowStatus.HtmlColor = Convert.ToString(mySqlDataReader["StatusHtmlColor"]);
                            }

                            if (mySqlDataReader["IdAssignee"] != DBNull.Value)
                                warehousePurchaseOrder.IdAssignee = Convert.ToUInt32(mySqlDataReader["IdAssignee"]);

                            if (mySqlDataReader["IdApprover"] != DBNull.Value)
                                warehousePurchaseOrder.IdApprover = Convert.ToUInt32(mySqlDataReader["IdApprover"]);

                            if (mySqlDataReader["AssigneeEmail"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.AssigneeEmail = Convert.ToString(mySqlDataReader["AssigneeEmail"]);
                            }
                            if (mySqlDataReader["CreatorEmail"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.CreatorEmail = Convert.ToString(mySqlDataReader["CreatorEmail"]);
                            }

                            string HTMLFileName = null;
                            if (File.Exists(string.Format("{0}{1}SupplierPurchaseOrderRequestMailFormat_{2}-{3}.html", emailTemplatePath, @"\", warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower(), warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToUpper())))
                            {
                                HTMLFileName = string.Format("SupplierPurchaseOrderRequestMailFormat_{0}-{1}.html", warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower(), warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToUpper());
                            }
                            else if (File.Exists(string.Format("{0}{1}SupplierPurchaseOrderRequestMailFormat.html", emailTemplatePath, @"\")))
                            {
                                HTMLFileName = "SupplierPurchaseOrderRequestMailFormat.html";
                            }
                            if (HTMLFileName != null)
                            {
                                StringBuilder emailbody = new StringBuilder();
                                string text = ReadMailTemplate(HTMLFileName, emailTemplatePath);

                                if (string.IsNullOrEmpty(warehousePurchaseOrder.ArticleSupplier.ContactPerson))
                                {
                                    text = text.Replace("[Supplier_Name]", "Supplier");
                                }
                                else
                                {
                                    text = text.Replace("[Supplier_Name]", warehousePurchaseOrder.ArticleSupplier.ContactPerson);
                                }
                                text = text.Replace("[PO_Code]", warehousePurchaseOrder.Code);

                                emailbody.Append(text);

                                warehousePurchaseOrder.EmailBody = emailbody.ToString();
                            }
                            warehousePurchaseOrder.AttachPdf = warehousePurchaseOrder.CreatedIn.Year + @"\" + warehousePurchaseOrder.Code + @"\01 Purchase Order\PO_" + warehousePurchaseOrder.Code + ".pdf";

                            warehousePurchaseOrder.AttachmentBytes = GetPurchaseOrderPdf(purchaseOrdersPath, warehousePurchaseOrder.AttachPdf);
                            warehousePurchaseOrder.WarehouseDeliveryNotes = GetDeliveryNotesByIdWarehousePurchaseOrder(connectionString, warehousePurchaseOrder, purchaseOrdersPath);


                            // [pramod.misal][GEOS2-4951][05-07-2023]

                            warehousePurchaseOrder.WarehouseShippingAddress = GetShippingAddressByIdShippingAddress_V2420(connectionString, warehousePurchaseOrder, idShippingAddress);
                            warehousePurchaseOrder.WarehousePurchaseOrderItemWithComments = GetArticlesByIdWarehousePurchaseOrder_V2430(connectionString, warehousePurchaseOrder.IdWarehousePurchaseOrder); // [rdixit][GEOS2-4822][13-09-2023]
                            //warehousePurchaseOrder.WarehousePOComments = GetlogEntriesByWarehousePO_V2400(idWarehousePurchaseOrder, 252, connectionString);
                            //warehousePurchaseOrder.WarehousePOLogEntries = GetlogEntriesByWarehousePO_V2400(idWarehousePurchaseOrder, 253, connectionString);
                            //[pramod.misal][GEOS2-4451][08-08-2023]  logEntriesByWarehousePO.IdEntryType
                            warehousePurchaseOrder.WarehousePOComments = GetlogEntriesByWarehousePO_V2420(idWarehousePurchaseOrder, 257, connectionString);
                            warehousePurchaseOrder.WarehousePOLogEntries = GetlogEntriesByWarehousePO_V2420(idWarehousePurchaseOrder, 258, connectionString);



                            //[rdixit][GEOS2-4455][28.06.2023] 
                            List<DateTime> ItemDates = new List<DateTime>();
                            if (warehousePurchaseOrder.WarehousePurchaseOrderItemWithComments != null)
                            {
                                if (warehousePurchaseOrder.WarehousePurchaseOrderItemWithComments.Where(i => i.Status < 100) != null)
                                {
                                    if (warehousePurchaseOrder.WarehousePurchaseOrderItemWithComments.Where(i => i.Status < 100).ToList().Count > 0)
                                        foreach (var item in warehousePurchaseOrder.WarehousePurchaseOrderItemWithComments.Where(i => i.Status < 100))
                                        {
                                            if (item.WarehousePurchaseOrderExpectedItems != null)
                                            {
                                                if (item.WarehousePurchaseOrderExpectedItems.Count > 0)
                                                    ItemDates.Add(item.WarehousePurchaseOrderExpectedItems.FirstOrDefault().Date);
                                            }
                                        }
                                }
                            }
                            if (ItemDates.Count > 0)
                                warehousePurchaseOrder.DeliveryDate = ItemDates.Min(d => d.Date).Date;
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetPendingPOByIdWarehousePurchaseOrder_V2430(idWarehousePurchaseOrder-{0}), ErrorMessage- {1} ", idWarehousePurchaseOrder, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            return warehousePurchaseOrder;
        }

        //[Sudhir.Jangra][GEOS2-4676]
        public List<ArticleSupplier> GetArticleSuppliersForSRMContact_V2430(Warehouses warehouse)
        {
            string connectionString = warehouse.Company.ConnectPlantConstr;
            List<ArticleSupplier> articleSuppliers = new List<ArticleSupplier>();
            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();
                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetArticleSuppliersForSRMContact_V2430", mySqlConnection);//[rdixit][GEOS2-4676][18.09.2023]
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdWarehouse", warehouse.IdWarehouse);

                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    while (mySqlDataReader.Read())
                    {
                        try
                        {
                            ArticleSupplier articleSupplier = new ArticleSupplier();

                            articleSupplier.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                            articleSupplier.Code = "SUPL" + articleSupplier.IdArticleSupplier.ToString().PadLeft(6, '0');

                            if (mySqlDataReader["name"] != DBNull.Value)
                                articleSupplier.Name = Convert.ToString(mySqlDataReader["name"]);

                            if (mySqlDataReader["Cif"] != DBNull.Value)
                                articleSupplier.Cif = Convert.ToString(mySqlDataReader["Cif"]);

                            if (mySqlDataReader["serie"] != DBNull.Value)
                                articleSupplier.Serie = Convert.ToChar(mySqlDataReader["serie"]);

                            if (mySqlDataReader["Observations"] != DBNull.Value)
                                articleSupplier.Observations = Convert.ToString(mySqlDataReader["Observations"]);

                            if (mySqlDataReader["Phone1"] != DBNull.Value)
                                articleSupplier.Phone1 = Convert.ToString(mySqlDataReader["Phone1"]);

                            if (mySqlDataReader["Phone2"] != DBNull.Value)
                                articleSupplier.Phone2 = Convert.ToString(mySqlDataReader["Phone2"]);

                            if (mySqlDataReader["Email"] != DBNull.Value)
                                articleSupplier.Email = Convert.ToString(mySqlDataReader["Email"]);

                            if (mySqlDataReader["fax"] != DBNull.Value)
                                articleSupplier.Fax = Convert.ToString(mySqlDataReader["fax"]);

                            if (mySqlDataReader["Web"] != DBNull.Value)
                                articleSupplier.Web = Convert.ToString(mySqlDataReader["Web"]);

                            if (mySqlDataReader["Address"] != DBNull.Value)
                                articleSupplier.Address = Convert.ToString(mySqlDataReader["Address"]);

                            if (mySqlDataReader["City"] != DBNull.Value)
                                articleSupplier.City = Convert.ToString(mySqlDataReader["City"]);

                            if (mySqlDataReader["PostCode"] != DBNull.Value)
                                articleSupplier.PostCode = Convert.ToString(mySqlDataReader["PostCode"]);

                            if (mySqlDataReader["State"] != DBNull.Value)
                                articleSupplier.Region = Convert.ToString(mySqlDataReader["State"]);

                            if (mySqlDataReader["idcountry"] != DBNull.Value)
                            {
                                articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["idcountry"]);
                                articleSupplier.Country = new Country();
                                articleSupplier.Country.IdCountry = Convert.ToByte(mySqlDataReader["idcountry"]);

                                if (mySqlDataReader["CountryName"] != DBNull.Value)
                                {
                                    articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);
                                }
                            }
                            articleSuppliers.Add(articleSupplier);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetArticleSuppliersForSRMContact_V2430(ErrorMessage- {0} ", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            return articleSuppliers;
        }

        ////[Sudhir.Jangra][GEOS2-4676]
        public List<Contacts> GetContactsAndSupplier_V2430(Warehouses warehouse, string countryIconFilePath)
        {
            string connectionString = warehouse.Company.ConnectPlantConstr;
            List<string> countryISOs = new List<string>();
            List<Contacts> contactsList = new List<Contacts>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetContactsAndSupplier_V2430", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdWarehouse", warehouse.IdWarehouse);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Contacts contact = new Contacts();
                            contact.IdContact = Convert.ToInt32(reader["IdContact"]);
                            if (reader["IdArticleSupplierContact"] != DBNull.Value)
                            {
                                contact.IdArticleSupplierContact = Convert.ToInt32(reader["IdArticleSupplierContact"]);
                            }
                            if (reader["idArticleSupplier"] != DBNull.Value)
                            {
                                contact.IdArticleSupplier = Convert.ToInt32(reader["idArticleSupplier"]);
                            }
                            if (reader["Address"] != DBNull.Value)
                            {
                                contact.Address = Convert.ToString(reader["Address"]);
                            }
                            if (reader["PostCode"] != DBNull.Value)
                            {
                                contact.PostCode = Convert.ToString(reader["PostCode"]);
                            }
                            if (reader["City"] != DBNull.Value)
                            {
                                contact.City = Convert.ToString(reader["City"]);
                            }
                            if (reader["IdGender"] != DBNull.Value)
                            {
                                contact.IdGender = Convert.ToByte(reader["IdGender"]);
                                if (contact.IdGender == 1)
                                {
                                    contact.UserGender = "Female";
                                }
                                else if (contact.IdGender == 2)
                                {
                                    contact.UserGender = "Male";
                                }
                            }
                            if (reader["FirstName"] != DBNull.Value)
                            {
                                contact.Firstname = Convert.ToString(reader["FirstName"]);
                            }
                            if (reader["LastName"] != DBNull.Value)
                            {
                                contact.Lastname = Convert.ToString(reader["LastName"]);
                            }
                            if (reader["IdDepartment"] != DBNull.Value)
                            {
                                contact.IdDepartment = Convert.ToInt32(reader["IdDepartment"]);
                                contact.CompanyDepartment = new LookupValue();
                                contact.CompanyDepartment.IdLookupValue = Convert.ToInt32(reader["IdDepartment"]);
                                contact.CompanyDepartment.Value = Convert.ToString(reader["DepartmentName"]);
                            }
                            if (reader["JobTitle"] != DBNull.Value)
                            {
                                contact.JobTitle = Convert.ToString(reader["JobTitle"]);
                            }
                            if (reader["Phone"] != DBNull.Value)
                            {
                                contact.Phone = Convert.ToString(reader["Phone"]);
                            }
                            if (reader["Phone2"] != DBNull.Value)
                            {
                                contact.Phone2 = Convert.ToString(reader["Phone2"]);
                            }
                            if (reader["Email"] != DBNull.Value)
                            {
                                contact.Email = Convert.ToString(reader["Email"]);
                            }
                            if (reader["Remarks"] != DBNull.Value)
                            {
                                contact.Remarks = Convert.ToString(reader["Remarks"]);
                            }
                            if (reader["CreatedIn"] != DBNull.Value)
                            {
                                contact.CreatedIn = Convert.ToDateTime(reader["CreatedIn"]);
                            }
                            if (reader["SupplierName"] != DBNull.Value)
                            {
                                contact.SupplierName = Convert.ToString(reader["SupplierName"]);
                            }
                            if (reader["idCountry"] != DBNull.Value)
                            {
                                contact.CountryList = new Country();
                                contact.CountryList.IdCountry = Convert.ToByte(reader["idCountry"]);
                                contact.CountryList.Name = Convert.ToString(reader["CountryName"]);
                                contact.CountryList.Iso = Convert.ToString(reader["CountryIso"]);
                                if (!countryISOs.Any(co => co.ToString() == contact.CountryList.Iso))
                                {
                                    countryISOs.Add(contact.CountryList.Iso);
                                }
                            }
                            if (reader["Region"] != DBNull.Value)
                            {
                                contact.Region = Convert.ToString(reader["Region"]);
                            }
                            if (reader["IsStillActive"] != DBNull.Value)
                            {
                                contact.IsStillActive = Convert.ToByte(reader["IsStillActive"]);
                                if (contact.IsStillActive == 1)
                                {
                                    contact.IsActive = "Yes";
                                }
                                else
                                {
                                    contact.IsActive = "No";
                                }
                            }
                            if (reader["Image"] != DBNull.Value)
                            {
                                contact.ImageText = Convert.ToString(reader["Image"]);
                            }

                            contactsList.Add(contact);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetContactsAndSupplier_V2430(). ErrorMessage-" + ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            foreach (string item in countryISOs)
            {
                byte[] bytes = null;
                bytes = GetCountryIconFileInBytes(item, countryIconFilePath);
                contactsList.Where(x => x.CountryList.Iso == item).ToList().ForEach(a => a.CountryList.CountryIconBytes = bytes);
            }

            return contactsList;

        }

        //[Sudhir.Jangra][GEOS2-4676][28/08/2023]
        public bool DeleteContactDetails_V2340(Contacts contact, string mainConnectionString)
        {
            bool isDeleted = false;
            try
            {
                using (MySqlConnection myConnection = new MySqlConnection(mainConnectionString))
                {
                    myConnection.Open();
                    using (MySqlTransaction trans = myConnection.BeginTransaction())
                    {
                        try
                        {
                            MySqlCommand concompanycommand = new MySqlCommand("SRM_DeleteContactDetails_V2430", myConnection);
                            concompanycommand.CommandType = CommandType.StoredProcedure;
                            concompanycommand.Parameters.AddWithValue("_IdContact", contact.IdContact);

                            concompanycommand.Transaction = trans;
                            concompanycommand.ExecuteNonQuery();

                            isDeleted = true;
                            trans.Commit();
                        }
                        catch (Exception ex)
                        {
                            trans.Rollback();
                            throw;
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                throw;
            }

            return isDeleted;
        }

        //[Sudhir.Jangra][GEOS2-4676]
        public bool ArticleSupplierContacts_Update_V2430(string connectionString, Int32 IdArticleSupplierContact, long IdArticleSupplier)
        {
            bool isUpdated;
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("SRM_ArticleSupplierContacts_Update_V2430", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdArticleSupplierContact", IdArticleSupplierContact);
                    mySqlCommand.Parameters.AddWithValue("_IdArticleSupplier", IdArticleSupplier);
                    mySqlCommand.ExecuteNonQuery();
                    mySqlConnection.Close();
                    isUpdated = true;
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error ArticleSupplierContacts_Update_V2430(). ErrorMessage-" + ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return isUpdated;
        }


        //[sudhir.Jangra][GEOS2-4740][26/09/2023]
        public List<ArticleSupplier> GetArticleSuppliersByWarehouse_V2440(long idWarehouse, string connectionString, string countryIconFilePath)
        {
            //string connectionString = warehouse.Company.ConnectPlantConstr;
            List<ArticleSupplier> articleSuppliers = new List<ArticleSupplier>();
            List<string> countryISOs = new List<string>();
            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetArticleSuppliersByWarehouse_V2440", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdWarehouse", idWarehouse);

                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    while (mySqlDataReader.Read())
                    {
                        try
                        {
                            ArticleSupplier articleSupplier = new ArticleSupplier();

                            articleSupplier.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                            if (mySqlDataReader["name"] != DBNull.Value)
                                articleSupplier.Name = Convert.ToString(mySqlDataReader["name"]);

                            if (mySqlDataReader["IdCountry"] != DBNull.Value)
                            {
                                articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["IdCountry"]);

                                articleSupplier.Country = new Country();
                                articleSupplier.Country.IdCountry = Convert.ToByte(mySqlDataReader["IdCountry"]);
                                articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);
                                articleSupplier.Country.Iso = Convert.ToString(mySqlDataReader["Iso"]);

                                if (!countryISOs.Any(co => co.ToString() == articleSupplier.Country.Iso))
                                {
                                    countryISOs.Add(articleSupplier.Country.Iso);
                                }
                            }
                            if (mySqlDataReader["Cif"] != DBNull.Value)
                                articleSupplier.Cif = Convert.ToString(mySqlDataReader["Cif"]);

                            if (mySqlDataReader["City"] != DBNull.Value)
                                articleSupplier.City = Convert.ToString(mySqlDataReader["City"]);

                            if (mySqlDataReader["PostCode"] != DBNull.Value)
                                articleSupplier.PostCode = Convert.ToString(mySqlDataReader["PostCode"]);

                            if (mySqlDataReader["Address"] != DBNull.Value)
                                articleSupplier.Address = Convert.ToString(mySqlDataReader["Address"]);

                            if (mySqlDataReader["Email"] != DBNull.Value)
                                articleSupplier.Email = Convert.ToString(mySqlDataReader["Email"]);

                            if (mySqlDataReader["Web"] != DBNull.Value)
                                articleSupplier.Web = Convert.ToString(mySqlDataReader["Web"]);

                            if (mySqlDataReader["Phone1"] != DBNull.Value)
                                articleSupplier.Phone1 = Convert.ToString(mySqlDataReader["Phone1"]);

                            if (mySqlDataReader["Phone2"] != DBNull.Value)
                                articleSupplier.Phone2 = Convert.ToString(mySqlDataReader["Phone2"]);

                            if (mySqlDataReader["serie"] != DBNull.Value)
                                articleSupplier.Serie = Convert.ToChar(mySqlDataReader["serie"]);

                            if (mySqlDataReader["CreatedIn"] != DBNull.Value)
                                articleSupplier.CreatedIn = Convert.ToDateTime(mySqlDataReader["CreatedIn"].ToString());

                            if (mySqlDataReader["EnterpriseGroup"] != DBNull.Value)
                                articleSupplier.Group = Convert.ToString(mySqlDataReader["EnterpriseGroup"].ToString());

                            if (mySqlDataReader["IsStillActive"] != DBNull.Value)
                            {
                                articleSupplier.IsStillActive = Convert.ToSByte(mySqlDataReader["IsStillActive"]);
                                if (articleSupplier.IsStillActive == 1)
                                {
                                    articleSupplier.IsActive = "Yes";
                                }
                                else
                                {
                                    articleSupplier.IsActive = "No";
                                }
                            }
                            if (mySqlDataReader["TradeName"] != DBNull.Value)
                            {
                                articleSupplier.TradeName = Convert.ToString(mySqlDataReader["TradeName"]);
                            }
                            if (mySqlDataReader["ModifiedIn"] != DBNull.Value)
                            {
                                articleSupplier.ModifiedIn = Convert.ToDateTime(mySqlDataReader["ModifiedIn"]);
                                articleSupplier.ModificationDate = Convert.ToDateTime(mySqlDataReader["ModifiedIn"]);
                            }
                            if (mySqlDataReader["State"] != DBNull.Value)
                            {
                                articleSupplier.State = Convert.ToString(mySqlDataReader["State"]);
                            }
                            if (mySqlDataReader["ContactCount"] != DBNull.Value)
                            {
                                articleSupplier.ContactCount = Convert.ToString(mySqlDataReader["ContactCount"]);
                            }

                            articleSuppliers.Add(articleSupplier);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetArticleSuppliersByWarehouse_V2440(). ErrorMessage-" + ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }
            foreach (string item in countryISOs)
            {
                byte[] bytes = null;
                bytes = GetCountryIconFileInBytes(item, countryIconFilePath);
                articleSuppliers.Where(ars => ars.Country.Iso == item).ToList().ForEach(oi => oi.Country.CountryIconBytes = bytes);
            }
            // Log4NetLogger.Logger.Log("Executed GetArticleSuppliersByWarehouse_V2440().", category: Category.Info, priority: Priority.Low);
            return articleSuppliers;
        }


        //[Sudhir.Jangra][GEOS2-4738][27/09/2023]
        public ArticleSupplier GetSRMEmdepCodeForAddSupplier(string connectionString)
        {
            ArticleSupplier articleSupplier = new ArticleSupplier();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetEmdepCodeForSupplier", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            if (reader["IdArticleSupplier"] != DBNull.Value)
                            {
                                articleSupplier.IdArticleSupplier = Convert.ToInt64(reader["IdArticleSupplier"]);

                                articleSupplier.Code = "SUPL" + articleSupplier.IdArticleSupplier.ToString().PadLeft(6, '0');
                            }
                        }
                    }
                }
                return articleSupplier;
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetSRMEmdepCodeForAddSupplier(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        //[Sudhir.jangra][GEOS2-4738][27/09/2023]
        public Contacts AddContact_V2440(string mainServerConnectionString, Contacts contacts, List<LogEntriesByArticleSuppliers> ArticleSuppliersChangeLogList)
        {
            TransactionScope transactionScope = null;
            try
            {
                using (transactionScope = new TransactionScope())
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("SRM_Contacts_Insert_Update_V2430", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_Idcontact", contacts.IdContact);
                        mySqlCommand.Parameters.AddWithValue("_Firstname", contacts.Firstname);
                        mySqlCommand.Parameters.AddWithValue("_Lastname", contacts.Lastname);
                        mySqlCommand.Parameters.AddWithValue("_IdGender", contacts.IdGender);
                        mySqlCommand.Parameters.AddWithValue("_Email", contacts.Email);
                        mySqlCommand.Parameters.AddWithValue("_Phone", contacts.Phone);
                        mySqlCommand.Parameters.AddWithValue("_Phone2", contacts.Phone2);
                        mySqlCommand.Parameters.AddWithValue("_IdDepartment", contacts.IdDepartment);
                        mySqlCommand.Parameters.AddWithValue("_JobTitle", contacts.JobTitle);
                        mySqlCommand.Parameters.AddWithValue("_Image", contacts.ImageText);
                        mySqlCommand.Parameters.AddWithValue("_Remarks", contacts.Remarks);

                        contacts.IdContact = Convert.ToInt32(mySqlCommand.ExecuteScalar());
                        mySqlConnection.Close();
                    }

                    transactionScope.Complete();
                }
                if (ArticleSuppliersChangeLogList != null && ArticleSuppliersChangeLogList.Count > 0)
                {
                    AddCommentsOrLogEntriesByArticleSuppliers(mainServerConnectionString, ArticleSuppliersChangeLogList);
                }
            }
            catch (Exception ex)
            {
                if (Transaction.Current != null)
                    Transaction.Current.Rollback();

                if (transactionScope != null)
                    transactionScope.Dispose();

                Log4NetLogger.Logger.Log(string.Format("Error AddContact_V2440(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return contacts;
        }


        //[Sudhir.jangra][GEOS2-4738]
        public bool AddArticleSupplier_V2440(string connectionString, ArticleSupplier articleSupplier, List<Contacts> contactsList, List<Warehouses> warehouses)
        {
            bool isAdded = false;
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("SRM_Add_Supplier_V2440", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        if (articleSupplier.IdEnterpriseGroup == 0)
                        {
                            mySqlCommand.Parameters.AddWithValue("_IdEnterpriseGroup", null);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_IdEnterpriseGroup", articleSupplier.IdEnterpriseGroup);
                        }

                        mySqlCommand.Parameters.AddWithValue("_Name", articleSupplier.Name);
                        mySqlCommand.Parameters.AddWithValue("_Cif", articleSupplier.Cif);
                        mySqlCommand.Parameters.AddWithValue("_idArticleSupplierType", articleSupplier.IdArticleSupplierType);
                        mySqlCommand.Parameters.AddWithValue("_Observations", articleSupplier.Observations);
                        mySqlCommand.Parameters.AddWithValue("_IdPaymentType", articleSupplier.IdPaymentType);
                        mySqlCommand.Parameters.AddWithValue("_OrdersReceptionMethod", articleSupplier.IdOrderReceptionLookup);
                        mySqlCommand.Parameters.AddWithValue("_deliveryDays", articleSupplier.DeliveryDays);
                        mySqlCommand.Parameters.AddWithValue("_IdCarriageMethod", articleSupplier.IdCarriageMethod);
                        mySqlCommand.Parameters.AddWithValue("_IsStillActive", articleSupplier.IsStillActive);
                        mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_Phone1", articleSupplier.Phone1);
                        mySqlCommand.Parameters.AddWithValue("_Phone2", articleSupplier.Phone2);
                        mySqlCommand.Parameters.AddWithValue("_Email", articleSupplier.Email);
                        mySqlCommand.Parameters.AddWithValue("_Fax", articleSupplier.Fax);
                        mySqlCommand.Parameters.AddWithValue("_Web", articleSupplier.Web);
                        mySqlCommand.Parameters.AddWithValue("_Address", articleSupplier.Address);
                        mySqlCommand.Parameters.AddWithValue("_City", articleSupplier.City);
                        mySqlCommand.Parameters.AddWithValue("_Region", articleSupplier.Region);
                        mySqlCommand.Parameters.AddWithValue("_PostCode", articleSupplier.PostCode);
                        mySqlCommand.Parameters.AddWithValue("_IdCountry", articleSupplier.IdCountry);
                        mySqlCommand.Parameters.AddWithValue("_idSite", null);


                        articleSupplier.IdArticleSupplier = Convert.ToInt64(mySqlCommand.ExecuteScalar());

                        mySqlConnection.Close();
                        if (articleSupplier.IdArticleSupplier > 0)
                        {
                            if (contactsList != null && contactsList.Count > 0)
                            {
                                foreach (Contacts item in contactsList)
                                {
                                    //ArticleSupplierContacts_Insert(connectionString, item.IdContact, articleSupplier.IdArticleSupplier);

                                    //[pramod.misal][GEOS2-5136][22.01.2024]
                                    ArticleSupplierContacts_Insert_V2480(connectionString, item.IdContact, articleSupplier.IdArticleSupplier);


                                }
                            }
                            if (warehouses != null && warehouses.Count > 0)
                            {
                                foreach (Warehouses item in warehouses)
                                {
                                    AddSRMSupplierBySite_V2440(connectionString, articleSupplier.IdArticleSupplier, item.IdSite, articleSupplier.IdPaymentType);
                                }
                            }
                        }
                        transactionScope.Complete();
                        transactionScope.Dispose();
                        isAdded = true;

                    }
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddArticleSupplier_V2440(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();
                    throw;
                }
            }

            return isAdded;
        }


        //[Sudhir.jangra][GEOS2-4738]
        public void AddSRMSupplierBySite_V2440(string connectionString, Int64 IdArticleSupplier, Int64 IdSite, Int64 IdPaymentType)
        {
            TransactionScope transactionScope = null;
            try
            {
                using (transactionScope = new TransactionScope())
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("SRM_Add_SupplierBySites_V2440", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdArticleSupplier", IdArticleSupplier);
                        mySqlCommand.Parameters.AddWithValue("_IdSite", IdSite);
                        mySqlCommand.Parameters.AddWithValue("_IdPaymentType", IdPaymentType);

                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();

                    }
                    transactionScope.Complete();
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddSRMSupplierBySite_V2440(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                if (Transaction.Current != null)
                    Transaction.Current.Rollback();

                if (transactionScope != null)
                    transactionScope.Dispose();
                throw;
            }
        }


        //[Sudhir.jangra][GEOS2-4738]
        public ArticleSupplier GetArticleSupplierByIdArticleSupplier_V2440(Warehouses warehouse, UInt64 IdArticleSupplier)
        {
            string connectionString = warehouse.Company.ConnectPlantConstr;
            ArticleSupplier articleSupplier = null;

            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetArticleSupplierByIdArticleSupplier_V2440", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdArticleSupplier", IdArticleSupplier);

                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    while (mySqlDataReader.Read())
                    {
                        try
                        {
                            articleSupplier = new ArticleSupplier();

                            articleSupplier.IdArticleSupplier = Convert.ToInt64(IdArticleSupplier);

                            articleSupplier.Code = "SUPL" + articleSupplier.IdArticleSupplier.ToString().PadLeft(6, '0');

                            if (mySqlDataReader["name"] != DBNull.Value)
                                articleSupplier.Name = Convert.ToString(mySqlDataReader["name"]);

                            if (mySqlDataReader["Cif"] != DBNull.Value)
                                articleSupplier.Cif = Convert.ToString(mySqlDataReader["Cif"]);

                            if (mySqlDataReader["serie"] != DBNull.Value)
                                articleSupplier.Serie = Convert.ToChar(mySqlDataReader["serie"]);

                            if (mySqlDataReader["Observations"] != DBNull.Value)
                                articleSupplier.Observations = Convert.ToString(mySqlDataReader["Observations"]);

                            if (mySqlDataReader["lastOrder"] != DBNull.Value)
                                articleSupplier.LastOrderDate = Convert.ToDateTime(mySqlDataReader["lastOrder"].ToString());

                            if (mySqlDataReader["Phone1"] != DBNull.Value)
                                articleSupplier.Phone1 = Convert.ToString(mySqlDataReader["Phone1"]);

                            if (mySqlDataReader["Phone2"] != DBNull.Value)
                                articleSupplier.Phone2 = Convert.ToString(mySqlDataReader["Phone2"]);

                            if (mySqlDataReader["Email"] != DBNull.Value)
                                articleSupplier.Email = Convert.ToString(mySqlDataReader["Email"]);

                            if (mySqlDataReader["fax"] != DBNull.Value)
                                articleSupplier.Fax = Convert.ToString(mySqlDataReader["fax"]);

                            if (mySqlDataReader["Web"] != DBNull.Value)
                                articleSupplier.Web = Convert.ToString(mySqlDataReader["Web"]);

                            if (mySqlDataReader["Address"] != DBNull.Value)
                                articleSupplier.Address = Convert.ToString(mySqlDataReader["Address"]);

                            if (mySqlDataReader["City"] != DBNull.Value)
                                articleSupplier.City = Convert.ToString(mySqlDataReader["City"]);

                            if (mySqlDataReader["PostCode"] != DBNull.Value)
                                articleSupplier.PostCode = Convert.ToString(mySqlDataReader["PostCode"]);

                            if (mySqlDataReader["IsStillActive"] != DBNull.Value)
                            {
                                articleSupplier.IsStillActive = Convert.ToSByte(mySqlDataReader["IsStillActive"]);
                            }

                            //[001][GEOS2-3440][pjadhav]
                            if (mySqlDataReader["idcountry"] != DBNull.Value)
                            {
                                articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["idcountry"]);
                                articleSupplier.Country = new Country();
                                articleSupplier.Country.IdCountry = Convert.ToByte(mySqlDataReader["idcountry"]);

                                if (mySqlDataReader["CountryName"] != DBNull.Value)
                                {
                                    articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);
                                }
                            }

                            if (mySqlDataReader["IdEnterpriseGroup"] != DBNull.Value)
                            {

                                articleSupplier.IdEnterpriseGroup = Convert.ToInt32(mySqlDataReader["IdEnterpriseGroup"]);
                                articleSupplier.EnterpriseGroup = new Group();
                                articleSupplier.EnterpriseGroup.IdEnterpriseGroup = Convert.ToInt32(mySqlDataReader["IdEnterpriseGroup"]);
                                if (mySqlDataReader["groupName"] != DBNull.Value)
                                {
                                    articleSupplier.EnterpriseGroup.Name = Convert.ToString(mySqlDataReader["groupName"]);
                                }
                            }
                            if (mySqlDataReader["idArticleSupplierType"] != DBNull.Value)
                            {

                                articleSupplier.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["idArticleSupplierType"]);
                                articleSupplier.ArticleSupplierType = new ArticleSupplierType();
                                articleSupplier.ArticleSupplierType.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["idArticleSupplierType"]);
                                if (mySqlDataReader["CategoryName"] != DBNull.Value)
                                {
                                    articleSupplier.ArticleSupplierType.Name = Convert.ToString(mySqlDataReader["CategoryName"]);
                                }
                            }
                            if (mySqlDataReader["IdPaymentType"] != DBNull.Value)
                            {

                                articleSupplier.IdPaymentType = Convert.ToInt64(mySqlDataReader["IdPaymentType"]);
                                articleSupplier.PaymentTerm = new PaymentTerm();
                                articleSupplier.PaymentTerm.IdPaymentType = Convert.ToInt32(mySqlDataReader["IdPaymentType"]);
                                if (mySqlDataReader["paymentType"] != DBNull.Value)
                                {
                                    articleSupplier.PaymentTerm.PaymentType = Convert.ToString(mySqlDataReader["paymentType"]);
                                }
                            }


                            if (mySqlDataReader["modifiedIn"] != DBNull.Value)
                                articleSupplier.ModificationDate = Convert.ToDateTime(mySqlDataReader["modifiedIn"].ToString());

                            if (mySqlDataReader["createdIn"] != DBNull.Value)
                                articleSupplier.CreatedIn = Convert.ToDateTime(mySqlDataReader["createdIn"].ToString());

                            if (mySqlDataReader["State"] != DBNull.Value)
                                articleSupplier.Region = Convert.ToString(mySqlDataReader["State"]);

                            //if (mySqlDataReader["Latitude"] != DBNull.Value)
                            //{
                            //    articleSupplier.Latitude = Convert.ToDouble(mySqlDataReader["Latitude"]);
                            //    articleSupplier.Coordinates = articleSupplier.Latitude.ToString();
                            //}

                            //if (mySqlDataReader["Longitude"] != DBNull.Value)
                            //{
                            //    articleSupplier.Longitude = Convert.ToDouble(mySqlDataReader["Longitude"]);
                            //    if (mySqlDataReader["Latitude"] != DBNull.Value)
                            //    {
                            //        articleSupplier.Coordinates = articleSupplier.Latitude.ToString() + ", " + articleSupplier.Longitude.ToString();
                            //    }
                            //    else
                            //    {
                            //        articleSupplier.Coordinates = articleSupplier.Longitude.ToString();
                            //    }
                            //}

                            if (mySqlDataReader["OrdersReceptionMethod"] != DBNull.Value)
                            {

                                articleSupplier.IdOrderReceptionLookup = Convert.ToInt32(mySqlDataReader["OrdersReceptionMethod"]);
                                articleSupplier.OrderReceptionLookup = new LookupValue();
                                articleSupplier.OrderReceptionLookup.IdLookupValue = Convert.ToInt32(mySqlDataReader["OrdersReceptionMethod"]);
                                if (mySqlDataReader["OrdersReceptionMethodValue"] != DBNull.Value)
                                {
                                    articleSupplier.OrderReceptionLookup.Value = Convert.ToString(mySqlDataReader["OrdersReceptionMethodValue"]);
                                }
                                if (mySqlDataReader["OrdersReceptionMethodHtmlColor"] != DBNull.Value)
                                {
                                    articleSupplier.OrderReceptionLookup.HtmlColor = Convert.ToString(mySqlDataReader["OrdersReceptionMethodHtmlColor"]);
                                }
                            }

                            if (mySqlDataReader["deliveryDays"] != DBNull.Value)
                            {
                                articleSupplier.DeliveryDays = Convert.ToInt64(mySqlDataReader["deliveryDays"]);
                            }

                            if (mySqlDataReader["IdCarriageMethod"] != DBNull.Value)
                            {
                                articleSupplier.IdCarriageMethod = Convert.ToInt32(mySqlDataReader["IdCarriageMethod"]);
                                articleSupplier.CarriageMethod = new LookupValue();
                                articleSupplier.CarriageMethod.IdLookupValue = Convert.ToInt32(mySqlDataReader["IdCarriageMethod"]);
                                articleSupplier.CarriageMethod.Value = Convert.ToString(mySqlDataReader["CarriageMethod"]);
                            }

                            articleSupplier.ArticleList = GetArticlesByIdArticleSupplier_V2360(connectionString, IdArticleSupplier);
                            articleSupplier.DocumentList = GetDocumentsByIdArticleSupplier(connectionString, IdArticleSupplier);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetArticleSupplierByIdArticleSupplier_V2440(IdArticleSupplier-{0}), ErrorMessage- {1} ", IdArticleSupplier, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }

                    if (mySqlDataReader.NextResult())
                    {
                        while (mySqlDataReader.Read())
                        {
                            WarehousePurchaseOrder WarehousePurchaseOrder = new WarehousePurchaseOrder();
                            if (mySqlDataReader["Code"] != DBNull.Value)
                            {
                                if (articleSupplier.Orders == null)
                                {
                                    articleSupplier.Orders = new List<WarehousePurchaseOrder>();
                                }
                                WarehousePurchaseOrder.Code = Convert.ToString(mySqlDataReader["Code"]);
                                WarehousePurchaseOrder.IdWarehousePurchaseOrder = Convert.ToInt64(mySqlDataReader["IdWarehousePurchaseOrder"]);
                                if (mySqlDataReader["WpoDate"] != DBNull.Value)
                                {
                                    WarehousePurchaseOrder.CreatedIn = Convert.ToDateTime(mySqlDataReader["WpoDate"].ToString());
                                }

                            }
                            articleSupplier.Orders.Add(WarehousePurchaseOrder);
                        }

                    }

                    if (mySqlDataReader.NextResult())
                    {
                        while (mySqlDataReader.Read())
                        {
                            ArticleSupplierPlants articleSupplierPlants = new ArticleSupplierPlants();
                            if (mySqlDataReader["IdSite"] != DBNull.Value)
                            {
                                if (articleSupplier.Plants == null)
                                {
                                    articleSupplier.Plants = new List<ArticleSupplierPlants>();
                                }
                                articleSupplierPlants.IdSite = Convert.ToInt64(mySqlDataReader["IdSite"]);
                                articleSupplierPlants.Name = Convert.ToString(mySqlDataReader["Name"]);
                                articleSupplierPlants.Allow = Convert.ToBoolean(mySqlDataReader["Allow"]);
                            }
                            articleSupplier.Plants.Add(articleSupplierPlants);
                        }

                    }
                }
            }
            articleSupplier.LogEntriesByArticleSuppliers = GetLogEntriesByArticleSuppliers(warehouse, IdArticleSupplier);
            return articleSupplier;
        }

        // [rdixit][GEOS2-4589][09-10-2023]
        public WarehousePurchaseOrder GetPendingPOByIdWarehousePurchaseOrder_V2440(string connectionString, Int64 idWarehousePurchaseOrder, string idShippingAddress, string purchaseOrdersPath, string emailTemplatePath, string countryIconFilePath)
        {
            WarehousePurchaseOrder warehousePurchaseOrder = null;

            Country country = new Country();
            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();
                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetPendingPOByIdWarehousePurchaseOrder_V2420", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", idWarehousePurchaseOrder);

                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    if (mySqlDataReader.Read())
                    {
                        try
                        {

                            warehousePurchaseOrder = new WarehousePurchaseOrder();
                            List<WarehouseShippingAddress> warehouseShippingAddresses = new List<WarehouseShippingAddress>();


                            warehousePurchaseOrder.IdWarehousePurchaseOrder = idWarehousePurchaseOrder;

                            if (mySqlDataReader["Code"] != DBNull.Value)
                                warehousePurchaseOrder.Code = Convert.ToString(mySqlDataReader["Code"]);

                            if (mySqlDataReader["IdArticleSupplier"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                                ArticleSupplier articleSupplier = new ArticleSupplier();
                                articleSupplier.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                                if (mySqlDataReader["Supplier"] != DBNull.Value)
                                    articleSupplier.Name = Convert.ToString(mySqlDataReader["Supplier"]);

                                if (mySqlDataReader["SupplierContactPerson"] != DBNull.Value)
                                    articleSupplier.ContactPerson = Convert.ToString(mySqlDataReader["SupplierContactPerson"]);

                                if (mySqlDataReader["SupplierContactEmail"] != DBNull.Value)
                                    articleSupplier.ContactEmail = Convert.ToString(mySqlDataReader["SupplierContactEmail"]);

                                if (mySqlDataReader["Serie"] != DBNull.Value)
                                    articleSupplier.Serie = Convert.ToChar(mySqlDataReader["Serie"]);

                                if (mySqlDataReader["IdCountry"] != DBNull.Value)
                                {
                                    articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["IdCountry"]);

                                    articleSupplier.Country = new Country();
                                    articleSupplier.Country.IdCountry = (byte)articleSupplier.IdCountry;
                                    articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);

                                    if (mySqlDataReader["SupplierCountryISO"] != DBNull.Value)
                                    {
                                        articleSupplier.Country.Iso = Convert.ToString(mySqlDataReader["SupplierCountryISO"]);
                                        byte[] bytes = null;
                                        bytes = GetCountryIconFileInBytes(articleSupplier.Country.Iso, countryIconFilePath);
                                        articleSupplier.Country.CountryIconBytes = bytes;
                                    }

                                    if (mySqlDataReader["IdCountryGroup"] != DBNull.Value)
                                        articleSupplier.Country.IdCountryGroup = Convert.ToInt64(mySqlDataReader["IdCountryGroup"]);
                                }

                                if (mySqlDataReader["IdArticleSupplierType"] != DBNull.Value)
                                {
                                    articleSupplier.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["IdArticleSupplierType"]);

                                    articleSupplier.ArticleSupplierType = new ArticleSupplierType();
                                    articleSupplier.ArticleSupplierType.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["IdArticleSupplierType"]);
                                    articleSupplier.ArticleSupplierType.Name = Convert.ToString(mySqlDataReader["ArticleSupplierType"]);
                                    articleSupplier.ArticleSupplierType.HtmlColor = Convert.ToString(mySqlDataReader["HtmlColor"]);
                                }

                                warehousePurchaseOrder.ArticleSupplier = articleSupplier;
                            }
                            //[rdixit][GEOS2-4455][28.06.2023] 
                            //if (mySqlDataReader["DeliveryDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["deliveryDate"]) != DateTime.MinValue)
                            //{
                            //    warehousePurchaseOrder.DeliveryDate = Convert.ToDateTime(mySqlDataReader["deliveryDate"]);
                            //}

                            if (mySqlDataReader["AttachedPO"] != DBNull.Value)
                                warehousePurchaseOrder.AttachedPO = Convert.ToByte(mySqlDataReader["AttachedPO"]);

                            if (mySqlDataReader["IdPaymentType"] != DBNull.Value)
                                warehousePurchaseOrder.IdPaymentType = Convert.ToInt64(mySqlDataReader["IdPaymentType"]);

                            if (mySqlDataReader["ReminderEmailDate"] != DBNull.Value)
                                warehousePurchaseOrder.ReminderEmailDate = Convert.ToDateTime(mySqlDataReader["ReminderEmailDate"]);

                            if (mySqlDataReader["CreatedIn"] != DBNull.Value)
                                warehousePurchaseOrder.CreatedIn = Convert.ToDateTime(mySqlDataReader["CreatedIn"]);

                            if (mySqlDataReader["ModifiedIn"] != DBNull.Value)
                                warehousePurchaseOrder.ModifiedIn = Convert.ToDateTime(mySqlDataReader["ModifiedIn"]);

                            if (mySqlDataReader["Comments"] != DBNull.Value)
                                warehousePurchaseOrder.Comments = Convert.ToString(mySqlDataReader["Comments"]);

                            //[pramod.misal][GEOS2-4449][04-06-2023]warehouseShippingAddress
                            if (mySqlDataReader["Observations"] != DBNull.Value)
                                warehousePurchaseOrder.SupplierComments = Convert.ToString(mySqlDataReader["Observations"]);

                            #region old code
                            //-------------------------------------------------------------------------------------
                            // create a new Sp and  read feilds related to shipping address

                            //if (mySqlDataReader["Name"] != DBNull.Value)
                            //    warehousePurchaseOrder.Name = Convert.ToString(mySqlDataReader["Name"]);

                            //if (mySqlDataReader["Address"] != DBNull.Value)
                            //    warehousePurchaseOrder.Address = Convert.ToString(mySqlDataReader["Address"]);

                            //if (mySqlDataReader["ZipCode"] != DBNull.Value)
                            //    warehousePurchaseOrder.ZipCode = Convert.ToString(mySqlDataReader["ZipCode"]);

                            //if (mySqlDataReader["City"] != DBNull.Value)
                            //    warehousePurchaseOrder.City = Convert.ToString(mySqlDataReader["City"]);

                            //if (mySqlDataReader["Region"] != DBNull.Value)
                            //    warehousePurchaseOrder.Region = Convert.ToString(mySqlDataReader["Region"]);

                            //if (mySqlDataReader["IdCountry"] != DBNull.Value)
                            //    warehousePurchaseOrder.IdCountry = Convert.ToInt64(mySqlDataReader["IdCountry"]);

                            //or

                            //while (mySqlDataReader.Read())
                            //{
                            //    WarehouseShippingAddress warehouseShippingAddress = new WarehouseShippingAddress();

                            //    if (mySqlDataReader["Name"] != DBNull.Value)
                            //        warehouseShippingAddress.Name = Convert.ToString(mySqlDataReader["Name"]);

                            //    if (mySqlDataReader["Address"] != DBNull.Value)
                            //        warehouseShippingAddress.Address = Convert.ToString(mySqlDataReader["Address"]);

                            //    if (mySqlDataReader["ZipCode"] != DBNull.Value)
                            //        warehouseShippingAddress.ZipCode = Convert.ToString(mySqlDataReader["ZipCode"]);

                            //    if (mySqlDataReader["City"] != DBNull.Value)
                            //        warehouseShippingAddress.City = Convert.ToString(mySqlDataReader["City"]);

                            //    if (mySqlDataReader["Region"] != DBNull.Value)
                            //        warehouseShippingAddress.Region = Convert.ToString(mySqlDataReader["Region"]);

                            //    if (mySqlDataReader["IdCountry"] != DBNull.Value)
                            //        warehouseShippingAddress.IdCountry = Convert.ToInt64(mySqlDataReader["IdCountry"]);

                            //    warehouseShippingAddresses.Add(warehouseShippingAddress);
                            //}

                            //warehousePurchaseOrder.WarehouseShippingAddress = warehouseShippingAddresses;


                            //------------------------------------------------------------------------------------------
                            #endregion old code end

                            if (mySqlDataReader["IsClosed"] != DBNull.Value)
                                warehousePurchaseOrder.IsClosed = Convert.ToByte(mySqlDataReader["IsClosed"]);

                            if (mySqlDataReader["CreatedBy"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.CreatedBy = Convert.ToInt64(mySqlDataReader["CreatedBy"]);
                                warehousePurchaseOrder.Creator = new People();
                                warehousePurchaseOrder.Creator.IdPerson = Convert.ToInt32(mySqlDataReader["CreatedBy"].ToString());
                                warehousePurchaseOrder.Creator.Name = mySqlDataReader["CreatorName"].ToString();
                                warehousePurchaseOrder.Creator.Surname = mySqlDataReader["CreatorSurname"].ToString();
                            }

                            if (mySqlDataReader["ModifiedBy"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.ModifiedBy = Convert.ToInt64(mySqlDataReader["ModifiedBy"]);
                                warehousePurchaseOrder.Modifier = new People();
                                warehousePurchaseOrder.Modifier.IdPerson = Convert.ToInt32(mySqlDataReader["ModifiedBy"].ToString());
                                warehousePurchaseOrder.Modifier.Name = mySqlDataReader["ModifierName"].ToString();
                                warehousePurchaseOrder.Modifier.Surname = mySqlDataReader["ModifierSurname"].ToString();
                            }

                            if (mySqlDataReader["ReasonClosed"] != DBNull.Value)
                                warehousePurchaseOrder.ReasonClosed = Convert.ToString(mySqlDataReader["ReasonClosed"]);

                            if (mySqlDataReader["IdWarehouse"] != DBNull.Value)
                                warehousePurchaseOrder.IdWarehouse = Convert.ToInt64(mySqlDataReader["IdWarehouse"]);

                            if (mySqlDataReader["IdShippingAddress"] != DBNull.Value)
                                warehousePurchaseOrder.IdShippingAddress = Convert.ToInt64(mySqlDataReader["IdShippingAddress"]);

                            if (mySqlDataReader["IdCurrency"] != DBNull.Value)
                                warehousePurchaseOrder.IdCurrency = Convert.ToByte(mySqlDataReader["IdCurrency"]);

                            if (mySqlDataReader["IdWorkflowStatus"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                warehousePurchaseOrder.WorkflowStatus = new WorkflowStatus();
                                warehousePurchaseOrder.WorkflowStatus.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                warehousePurchaseOrder.WorkflowStatus.Name = Convert.ToString(mySqlDataReader["Status"]);
                                warehousePurchaseOrder.WorkflowStatus.HtmlColor = Convert.ToString(mySqlDataReader["StatusHtmlColor"]);
                            }

                            if (mySqlDataReader["IdAssignee"] != DBNull.Value)
                                warehousePurchaseOrder.IdAssignee = Convert.ToUInt32(mySqlDataReader["IdAssignee"]);

                            if (mySqlDataReader["IdApprover"] != DBNull.Value)
                                warehousePurchaseOrder.IdApprover = Convert.ToUInt32(mySqlDataReader["IdApprover"]);

                            if (mySqlDataReader["AssigneeEmail"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.AssigneeEmail = Convert.ToString(mySqlDataReader["AssigneeEmail"]);
                            }
                            if (mySqlDataReader["CreatorEmail"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.CreatorEmail = Convert.ToString(mySqlDataReader["CreatorEmail"]);
                            }

                            string HTMLFileName = null;
                            if (File.Exists(string.Format("{0}{1}SupplierPurchaseOrderRequestMailFormat_{2}-{3}.html", emailTemplatePath, @"\", warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower(), warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToUpper())))
                            {
                                HTMLFileName = string.Format("SupplierPurchaseOrderRequestMailFormat_{0}-{1}.html", warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower(), warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToUpper());
                            }
                            else if (File.Exists(string.Format("{0}{1}SupplierPurchaseOrderRequestMailFormat.html", emailTemplatePath, @"\")))
                            {
                                HTMLFileName = "SupplierPurchaseOrderRequestMailFormat.html";
                            }
                            if (HTMLFileName != null)
                            {
                                StringBuilder emailbody = new StringBuilder();
                                string text = ReadMailTemplate(HTMLFileName, emailTemplatePath);

                                if (string.IsNullOrEmpty(warehousePurchaseOrder.ArticleSupplier.ContactPerson))
                                {
                                    text = text.Replace("[Supplier_Name]", "Supplier");
                                }
                                else
                                {
                                    text = text.Replace("[Supplier_Name]", warehousePurchaseOrder.ArticleSupplier.ContactPerson);
                                }
                                text = text.Replace("[PO_Code]", warehousePurchaseOrder.Code);

                                emailbody.Append(text);

                                warehousePurchaseOrder.EmailBody = emailbody.ToString();
                            }
                            warehousePurchaseOrder.AttachPdf = warehousePurchaseOrder.CreatedIn.Year + @"\" + warehousePurchaseOrder.Code + @"\01 Purchase Order\PO_" + warehousePurchaseOrder.Code + ".pdf";

                            warehousePurchaseOrder.AttachmentBytes = GetPurchaseOrderPdf(purchaseOrdersPath, warehousePurchaseOrder.AttachPdf);
                            warehousePurchaseOrder.WarehouseDeliveryNotes = GetDeliveryNotesByIdWarehousePurchaseOrder(connectionString, warehousePurchaseOrder, purchaseOrdersPath);


                            // [pramod.misal][GEOS2-4951][05-07-2023]

                            warehousePurchaseOrder.WarehouseShippingAddress = GetShippingAddressByIdShippingAddress_V2420(connectionString, warehousePurchaseOrder, idShippingAddress);
                            // [rdixit][GEOS2-4822][13-09-2023]
                            // [rdixit][GEOS2-4589][09-10-2023]
                            warehousePurchaseOrder.WarehousePurchaseOrderItemWithComments = GetArticlesByIdWarehousePurchaseOrder_V2440(connectionString, warehousePurchaseOrder.IdWarehousePurchaseOrder);
                            //warehousePurchaseOrder.WarehousePOComments = GetlogEntriesByWarehousePO_V2400(idWarehousePurchaseOrder, 252, connectionString);
                            //warehousePurchaseOrder.WarehousePOLogEntries = GetlogEntriesByWarehousePO_V2400(idWarehousePurchaseOrder, 253, connectionString);
                            //[pramod.misal][GEOS2-4451][08-08-2023]  logEntriesByWarehousePO.IdEntryType
                            warehousePurchaseOrder.WarehousePOComments = GetlogEntriesByWarehousePO_V2420(idWarehousePurchaseOrder, 257, connectionString);
                            warehousePurchaseOrder.WarehousePOLogEntries = GetlogEntriesByWarehousePO_V2420(idWarehousePurchaseOrder, 258, connectionString);



                            //[rdixit][GEOS2-4455][28.06.2023] 
                            List<DateTime> ItemDates = new List<DateTime>();
                            if (warehousePurchaseOrder.WarehousePurchaseOrderItemWithComments != null)
                            {
                                if (warehousePurchaseOrder.WarehousePurchaseOrderItemWithComments.Where(i => i.Status < 100) != null)
                                {
                                    if (warehousePurchaseOrder.WarehousePurchaseOrderItemWithComments.Where(i => i.Status < 100).ToList().Count > 0)
                                        foreach (var item in warehousePurchaseOrder.WarehousePurchaseOrderItemWithComments.Where(i => i.Status < 100))
                                        {
                                            if (item.WarehousePurchaseOrderExpectedItems != null)
                                            {
                                                if (item.WarehousePurchaseOrderExpectedItems.Count > 0)
                                                    ItemDates.Add(item.WarehousePurchaseOrderExpectedItems.FirstOrDefault().Date);
                                            }
                                        }
                                }
                            }
                            if (ItemDates.Count > 0)
                                warehousePurchaseOrder.DeliveryDate = ItemDates.Min(d => d.Date).Date;
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetPendingPOByIdWarehousePurchaseOrder_V2440(idWarehousePurchaseOrder-{0}), ErrorMessage- {1} ", idWarehousePurchaseOrder, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            return warehousePurchaseOrder;
        }


        public List<WarehousePurchaseOrderItemWithComments> GetArticlesByIdWarehousePurchaseOrder_V2440(string connectionString, Int64 idWarehousePurchaseOrder)
        {
            List<WarehousePurchaseOrderItemWithComments> warehousePurchaseOrderItems = new List<WarehousePurchaseOrderItemWithComments>();

            using (MySqlConnection connWarehousePurchaseOrderItem = new MySqlConnection(connectionString))
            {
                connWarehousePurchaseOrderItem.Open();

                MySqlCommand activitiesCommand = new MySqlCommand("SRM_GetArticlesAndPOItemsByIdWarehousePurchaseOrder_V2440", connWarehousePurchaseOrderItem);
                activitiesCommand.CommandType = CommandType.StoredProcedure;
                activitiesCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", idWarehousePurchaseOrder);

                using (MySqlDataReader poReader = activitiesCommand.ExecuteReader())
                {
                    while (poReader.Read())
                    {
                        try
                        {
                            WarehousePurchaseOrderItemWithComments warehousePurchaseOrderItem = new WarehousePurchaseOrderItemWithComments();

                            warehousePurchaseOrderItem.IdWarehousePurchaseOrder = idWarehousePurchaseOrder;

                            if (poReader["IdWarehousePurchaseOrderItem"] != DBNull.Value)
                                warehousePurchaseOrderItem.IdWarehousePurchaseOrderItem = Convert.ToInt64(poReader["IdWarehousePurchaseOrderItem"]);

                            if (poReader["Description"] != DBNull.Value)
                                warehousePurchaseOrderItem.Description = Convert.ToString(poReader["Description"]);

                            if (poReader["IdArticle"] != DBNull.Value)
                            {
                                warehousePurchaseOrderItem.IdArticle = Convert.ToInt32(poReader["IdArticle"]);

                                Article article = new Article();

                                if (poReader["Reference"] != DBNull.Value)
                                    article.Reference = Convert.ToString(poReader["Reference"]);

                                if (poReader["IsGeneric"] != DBNull.Value)
                                    article.IsGeneric = Convert.ToSByte(poReader["IsGeneric"]);

                                if (poReader["IdArticleCategory"] != DBNull.Value)
                                    article.IdArticleCategory = Convert.ToInt32(poReader["IdArticleCategory"]);

                                warehousePurchaseOrderItem.Article = article;
                            }

                            if (poReader["Quantity"] != DBNull.Value)
                                warehousePurchaseOrderItem.Quantity = Convert.ToInt32(poReader["Quantity"]);

                            if (poReader["UnitPrice"] != DBNull.Value)
                                warehousePurchaseOrderItem.UnitPrice = Convert.ToDouble(poReader["UnitPrice"]);

                            if (poReader["Discount"] != DBNull.Value)
                                warehousePurchaseOrderItem.Discount = Convert.ToDouble(poReader["Discount"]);

                            if (poReader["Iva"] != DBNull.Value)
                                warehousePurchaseOrderItem.IVA = Convert.ToDouble(poReader["Iva"]);

                            if (poReader["AdditionalComments"] != DBNull.Value)
                                warehousePurchaseOrderItem.AdditionalComments = Convert.ToString(poReader["AdditionalComments"]);

                            if (poReader["Position"] != DBNull.Value)
                                warehousePurchaseOrderItem.Position = Convert.ToInt64(poReader["Position"]);

                            if (poReader["AlbaranQty"] != DBNull.Value)
                                warehousePurchaseOrderItem.ReceivedQuantity = Convert.ToInt32(poReader["AlbaranQty"]);


                            if (poReader["TotalAmount"] != DBNull.Value)
                                warehousePurchaseOrderItem.TotalAmount = Convert.ToDecimal(poReader["TotalAmount"]);

                            if (poReader["TotalAmount"] != DBNull.Value)
                                warehousePurchaseOrderItem.TotalAmount_New = Convert.ToDouble(poReader["TotalAmount"]);

                            if (warehousePurchaseOrderItem.Quantity > 0)
                            {
                                warehousePurchaseOrderItem.Status = (Int32)(warehousePurchaseOrderItem.ReceivedQuantity / warehousePurchaseOrderItem.Quantity * 100);
                            }

                            warehousePurchaseOrderItem.WarehousePurchaseOrderExpectedItems = GetWarehousePOExpectedItems(connectionString, warehousePurchaseOrderItem.IdWarehousePurchaseOrderItem);

                            if (warehousePurchaseOrderItem.WarehousePurchaseOrderExpectedItems.Count > 0)
                            {
                                warehousePurchaseOrderItem.ExpectedDate = warehousePurchaseOrderItem.WarehousePurchaseOrderExpectedItems.First().Date;
                            }

                            warehousePurchaseOrderItem.ReceivedDeliveryNotes = GetDeliveryNotesByIdWarehousePurchaseOrderItem(connectionString, warehousePurchaseOrderItem.IdWarehousePurchaseOrderItem);
                            warehousePurchaseOrderItems.Add(warehousePurchaseOrderItem);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetArticlesByIdWarehousePurchaseOrder_V2440(idWarehousePurchaseOrder-{0}). ErrorMessage- {1}", idWarehousePurchaseOrder, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            return warehousePurchaseOrderItems;
        }

        //[chitra.girigosavi][GEOS2-4692][09.10.2023]
        public List<LogEntriesByArticleSuppliers> GetArticleSuppliersContactsComments_V2450(string connectionString, int idContact)
        {
            List<LogEntriesByArticleSuppliers> logEntriesByArticleSupplierList = new List<LogEntriesByArticleSuppliers>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetArticleSupplierByContactsComments_V2450", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdContact", idContact);

                    using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                    {
                        while (mySqlDataReader.Read())
                        {
                            LogEntriesByArticleSuppliers logEntriesByArticleSuppliers = new LogEntriesByArticleSuppliers();

                            logEntriesByArticleSuppliers.IdLogEntryByContact = Convert.ToInt64(mySqlDataReader["IdLogEntryByContact"]);

                            if (mySqlDataReader["IdContact"] != DBNull.Value)
                                logEntriesByArticleSuppliers.IdContact = Convert.ToInt32(mySqlDataReader["IdContact"].ToString());

                            if (mySqlDataReader["IdUser"] != DBNull.Value)
                                logEntriesByArticleSuppliers.IdUser = Convert.ToInt32(mySqlDataReader["IdUser"].ToString());

                            if (mySqlDataReader["IdContact"] != DBNull.Value)
                                logEntriesByArticleSuppliers.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdContact"].ToString());

                            if (mySqlDataReader["IdPerson"] != DBNull.Value)
                            {
                                logEntriesByArticleSuppliers.People = new People();
                                logEntriesByArticleSuppliers.People.IdPerson = Convert.ToInt32(mySqlDataReader["IdPerson"].ToString());
                                logEntriesByArticleSuppliers.People.Name = mySqlDataReader["Name"].ToString();
                                logEntriesByArticleSuppliers.People.Surname = mySqlDataReader["Surname"].ToString();
                            }
                            if (mySqlDataReader["Datetime"] != DBNull.Value)
                            {
                                logEntriesByArticleSuppliers.Datetime = Convert.ToDateTime(mySqlDataReader["Datetime"].ToString());
                            }

                            if (mySqlDataReader["Comments"] != DBNull.Value)
                                logEntriesByArticleSuppliers.Comments = mySqlDataReader["Comments"].ToString();

                            if (mySqlDataReader["IdLogEntryType"] != DBNull.Value)
                                logEntriesByArticleSuppliers.IdEntryType = Convert.ToInt32(mySqlDataReader["IdLogEntryType"]);

                            if (mySqlDataReader["IsRtfText"] != DBNull.Value)
                                logEntriesByArticleSuppliers.IsRtfText = Convert.ToBoolean(mySqlDataReader["IsRtfText"]);

                            logEntriesByArticleSupplierList.Add(logEntriesByArticleSuppliers);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetlogEntriesByWarehousePO_V2420. ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return logEntriesByArticleSupplierList;
        }
        //[chitra.girigosavi][GEOS2-4692][09.10.2023]
        public List<LogEntriesByArticleSuppliers> GetArticleSuppliersContactsChangelog_V2450(string connectionString, int idContact)
        {
            List<LogEntriesByArticleSuppliers> logEntriesByArticleSupplierList = new List<LogEntriesByArticleSuppliers>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetArticleSupplierByContactsChangelog_V2450", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdContact", idContact);

                    using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                    {
                        while (mySqlDataReader.Read())
                        {
                            LogEntriesByArticleSuppliers logEntriesByArticleSuppliers = new LogEntriesByArticleSuppliers();

                            logEntriesByArticleSuppliers.IdLogEntryByContact = Convert.ToInt64(mySqlDataReader["IdLogEntryByContact"]);

                            if (mySqlDataReader["IdContact"] != DBNull.Value)
                                logEntriesByArticleSuppliers.IdContact = Convert.ToInt32(mySqlDataReader["IdContact"].ToString());

                            if (mySqlDataReader["IdUser"] != DBNull.Value)
                                logEntriesByArticleSuppliers.IdUser = Convert.ToInt32(mySqlDataReader["IdUser"].ToString());

                            if (mySqlDataReader["IdContact"] != DBNull.Value)
                                logEntriesByArticleSuppliers.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdContact"].ToString());

                            if (mySqlDataReader["IdPerson"] != DBNull.Value)
                            {
                                logEntriesByArticleSuppliers.People = new People();
                                logEntriesByArticleSuppliers.People.IdPerson = Convert.ToInt32(mySqlDataReader["IdPerson"].ToString());
                                logEntriesByArticleSuppliers.People.Name = mySqlDataReader["Name"].ToString();
                                logEntriesByArticleSuppliers.People.Surname = mySqlDataReader["Surname"].ToString();

                                logEntriesByArticleSuppliers.ChangeLogUser = logEntriesByArticleSuppliers.People.FullName;
                            }
                            if (mySqlDataReader["Datetime"] != DBNull.Value)
                            {
                                logEntriesByArticleSuppliers.Datetime = Convert.ToDateTime(mySqlDataReader["Datetime"].ToString());
                            }

                            if (mySqlDataReader["Comments"] != DBNull.Value)
                                logEntriesByArticleSuppliers.Comments = mySqlDataReader["Comments"].ToString();

                            if (mySqlDataReader["IdLogEntryType"] != DBNull.Value)
                                logEntriesByArticleSuppliers.IdEntryType = Convert.ToInt32(mySqlDataReader["IdLogEntryType"]);

                            if (mySqlDataReader["IsRtfText"] != DBNull.Value)
                                logEntriesByArticleSuppliers.IsRtfText = Convert.ToBoolean(mySqlDataReader["IsRtfText"]);

                            logEntriesByArticleSupplierList.Add(logEntriesByArticleSuppliers);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetlogEntriesByWarehousePO_V2420. ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return logEntriesByArticleSupplierList;
        }
        //[chitra.girigosavi][GEOS2-4692][17.10.2023]
        public bool AddUpdateDeleteCommentsByContacts_V2450(string MainServerConnectionString, int idcontact, List<LogEntriesByArticleSuppliers> commentsBycontactsList)
        {
            try
            {
                if (commentsBycontactsList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (LogEntriesByArticleSuppliers logEntriesByArticleSuppliers in commentsBycontactsList)
                        {

                            if (logEntriesByArticleSuppliers.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {

                                MySqlCommand mySqlCommand = new MySqlCommand("SRM_Insert_Comment_by_Contacts_Insert_V2450", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                mySqlCommand.Parameters.AddWithValue("_IdContact", idcontact);
                                mySqlCommand.Parameters.AddWithValue("_IdUser", logEntriesByArticleSuppliers.IdUser);
                                mySqlCommand.Parameters.AddWithValue("_Datetime", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                mySqlCommand.Parameters.AddWithValue("_Comments", logEntriesByArticleSuppliers.Comments);
                                mySqlCommand.Parameters.AddWithValue("_IdLogEntryType", 257);
                                mySqlCommand.Parameters.AddWithValue("_IsRtfText", logEntriesByArticleSuppliers.IsRtfText);

                                mySqlCommand.ExecuteNonQuery();
                            }

                            else if (logEntriesByArticleSuppliers.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {

                                MySqlCommand mySqlCommand = new MySqlCommand("SRM_Delete_Comment_by_IdLogEntryByContacts_V2450", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdLogEntryByContact", logEntriesByArticleSuppliers.IdLogEntryByContact);
                                mySqlCommand.ExecuteNonQuery();
                            }


                            else if (logEntriesByArticleSuppliers.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("UpdateCommentsByContacts_V2450", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdLogEntryByContact", logEntriesByArticleSuppliers.IdLogEntryByContact);
                                mySqlCommand.Parameters.AddWithValue("_Comments", logEntriesByArticleSuppliers.Comments);
                                mySqlCommand.ExecuteNonQuery();

                            }

                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeleteCommentsByContacts(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                return false;
            }
            return true;
        }
        //[chitra.girigosavi][GEOS2-4692][17.10.2023]
        public bool AddCommentsOrLogEntriesByContacts_V2450(string MainServerConnectionString, int idcontact, List<LogEntriesByArticleSuppliers> AddLogEntries)
        {
            try
            {
                if (AddLogEntries != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (LogEntriesByArticleSuppliers logEntriesByitem in AddLogEntries)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("SRM_AddLogEntriesByContactsComments_V2450", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdContact", idcontact);
                            mySqlCommand.Parameters.AddWithValue("_IdUser", logEntriesByitem.IdUser);
                            mySqlCommand.Parameters.AddWithValue("_CreationDate", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                            mySqlCommand.Parameters.AddWithValue("_Comments", logEntriesByitem.Comments);
                            mySqlCommand.Parameters.AddWithValue("_IdLogEntryType", logEntriesByitem.IdLogEntryType);
                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddCommentsOrLogEntriesByArticleSuppliers_V2440(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                return false;
            }
            return true;
        }
        public Contacts AddContact_V2450(string mainServerConnectionString, Contacts contacts, List<LogEntriesByArticleSuppliers> ArticleSuppliersChangeLogList)
        {
            TransactionScope transactionScope = null;
            try
            {
                using (transactionScope = new TransactionScope())
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("SRM_Contacts_Insert_Update_V2450", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_Idcontact", contacts.IdContact);
                        mySqlCommand.Parameters.AddWithValue("_Firstname", contacts.Firstname);
                        mySqlCommand.Parameters.AddWithValue("_Lastname", contacts.Lastname);
                        mySqlCommand.Parameters.AddWithValue("_IdGender", contacts.IdGender);
                        mySqlCommand.Parameters.AddWithValue("_Email", contacts.Email);
                        mySqlCommand.Parameters.AddWithValue("_Phone", contacts.Phone);
                        mySqlCommand.Parameters.AddWithValue("_Phone2", contacts.Phone2);
                        mySqlCommand.Parameters.AddWithValue("_IdDepartment", contacts.IdDepartment);
                        mySqlCommand.Parameters.AddWithValue("_JobTitle", contacts.JobTitle);
                        mySqlCommand.Parameters.AddWithValue("_Image", contacts.ImageText);
                        mySqlCommand.Parameters.AddWithValue("_Remarks", contacts.Remarks);

                        contacts.IdContact = Convert.ToInt32(mySqlCommand.ExecuteScalar());
                        mySqlConnection.Close();
                    }

                    transactionScope.Complete();
                }
                if (contacts.ArticleSuppliersComments != null)
                {
                    AddUpdateDeleteCommentsByContacts_V2450(mainServerConnectionString, contacts.IdContact, contacts.ArticleSuppliersComments);
                }
                if (ArticleSuppliersChangeLogList != null && ArticleSuppliersChangeLogList.Count > 0)
                {
                    AddCommentsOrLogEntriesByContacts_V2450(mainServerConnectionString, contacts.IdContact, ArticleSuppliersChangeLogList);
                }
            }
            catch (Exception ex)
            {
                if (Transaction.Current != null)
                    Transaction.Current.Rollback();

                if (transactionScope != null)
                    transactionScope.Dispose();

                Log4NetLogger.Logger.Log(string.Format("Error AddContact_V2450(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return contacts;
        }

        // [rdixit][19.10.2023][GEOS2-4961]
        public bool AddArticleSupplier_V2450(string connectionString, ArticleSupplier articleSupplier, List<Contacts> contactsList, List<Warehouses> warehouses)
        {
            bool isAdded = false;
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("SRM_Add_Supplier_V2440", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        if (articleSupplier.IdEnterpriseGroup == 0)
                        {
                            mySqlCommand.Parameters.AddWithValue("_IdEnterpriseGroup", null);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_IdEnterpriseGroup", articleSupplier.IdEnterpriseGroup);
                        }

                        mySqlCommand.Parameters.AddWithValue("_Name", articleSupplier.Name);
                        mySqlCommand.Parameters.AddWithValue("_Cif", articleSupplier.Cif);
                        mySqlCommand.Parameters.AddWithValue("_idArticleSupplierType", articleSupplier.IdArticleSupplierType);
                        mySqlCommand.Parameters.AddWithValue("_Observations", articleSupplier.Observations);
                        mySqlCommand.Parameters.AddWithValue("_IdPaymentType", articleSupplier.IdPaymentType);
                        mySqlCommand.Parameters.AddWithValue("_OrdersReceptionMethod", articleSupplier.IdOrderReceptionLookup);
                        mySqlCommand.Parameters.AddWithValue("_deliveryDays", articleSupplier.DeliveryDays);
                        mySqlCommand.Parameters.AddWithValue("_IdCarriageMethod", (articleSupplier.IdCarriageMethod == 0 ? (int?)null : articleSupplier.IdCarriageMethod));
                        mySqlCommand.Parameters.AddWithValue("_IsStillActive", articleSupplier.IsStillActive);
                        mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_Phone1", articleSupplier.Phone1);
                        mySqlCommand.Parameters.AddWithValue("_Phone2", articleSupplier.Phone2);
                        mySqlCommand.Parameters.AddWithValue("_Email", articleSupplier.Email);
                        mySqlCommand.Parameters.AddWithValue("_Fax", articleSupplier.Fax);
                        mySqlCommand.Parameters.AddWithValue("_Web", articleSupplier.Web);
                        mySqlCommand.Parameters.AddWithValue("_Address", articleSupplier.Address);
                        mySqlCommand.Parameters.AddWithValue("_City", articleSupplier.City);
                        mySqlCommand.Parameters.AddWithValue("_Region", articleSupplier.Region);
                        mySqlCommand.Parameters.AddWithValue("_PostCode", articleSupplier.PostCode);
                        mySqlCommand.Parameters.AddWithValue("_IdCountry", articleSupplier.IdCountry);
                        mySqlCommand.Parameters.AddWithValue("_idSite", null);


                        articleSupplier.IdArticleSupplier = Convert.ToInt64(mySqlCommand.ExecuteScalar());

                        mySqlConnection.Close();
                        if (articleSupplier.IdArticleSupplier > 0)
                        {
                            if (contactsList != null && contactsList.Count > 0)
                            {
                                foreach (Contacts item in contactsList)
                                {
                                    //ArticleSupplierContacts_Insert(connectionString, item.IdContact, articleSupplier.IdArticleSupplier);
                                    //[pramod.misal][GEOS2-5136][22.01.2024]
                                    ArticleSupplierContacts_Insert_V2480(connectionString, item.IdContact, articleSupplier.IdArticleSupplier);
                                }
                            }
                            if (warehouses != null && warehouses.Count > 0)
                            {
                                foreach (Warehouses item in warehouses)
                                {
                                    AddSRMSupplierBySite_V2440(connectionString, articleSupplier.IdArticleSupplier, item.IdSite, articleSupplier.IdPaymentType);
                                }
                            }
                        }
                        transactionScope.Complete();
                        transactionScope.Dispose();
                        isAdded = true;

                    }
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddArticleSupplier_V2440(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();
                    throw;
                }
            }

            return isAdded;
        }


        //[cpatil] [GEOS2-4902] [2023-10-30]
        public List<WarehousePurchaseOrder> GetPendingPurchaseOrdersByWarehouse_V2450(long idWarehouse, string connectionstring, string countryIconFilePath, string connectionStringWorkbench)
        {
            // string connectionString = warehouse.Company.ConnectPlantConstr;
            List<WarehousePurchaseOrder> warehousePurchaseOrders = new List<WarehousePurchaseOrder>();
            List<string> countryISOs = new List<string>();
            List<long> orderid = new List<long>();
            Dictionary<string, List<long>> SupplierEmailId = new Dictionary<string, List<long>>();
            List<string> Suppliername = new List<string>();

            List<WorkflowStatus> LstWorkflowStatus = GetAllWorkflowStatus_V2301(connectionStringWorkbench);
            List<WorkflowTransition> LstWorkflowStatusTransitions = GetAllWorkflowTransitions_V2301(connectionStringWorkbench);
            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionstring))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetPendingPurchaseOrdersByWarehouse_V2450", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdWarehouse", idWarehouse);
                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    double totalQuantity = 0;
                    double receivedQuantity = 0;
                    while (mySqlDataReader.Read())
                    {
                        try
                        {
                            totalQuantity = 0;
                            receivedQuantity = 0;
                            WarehousePurchaseOrder warehousePurchaseOrder = new WarehousePurchaseOrder();
                            try
                            {
                                warehousePurchaseOrder.IdWarehousePurchaseOrder = Convert.ToInt64(mySqlDataReader["idWarehousepurchaseorder"]);
                                if (mySqlDataReader["Code"] != DBNull.Value)
                                    warehousePurchaseOrder.Code = Convert.ToString(mySqlDataReader["Code"]);
                                if (mySqlDataReader["IdArticleSupplier"] != DBNull.Value)
                                {
                                    ArticleSupplier articleSupplier = new ArticleSupplier();
                                    articleSupplier.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);
                                    if (mySqlDataReader["Supplier"] != DBNull.Value)
                                        articleSupplier.Name = Convert.ToString(mySqlDataReader["Supplier"]);
                                    if (mySqlDataReader["IdCountry"] != DBNull.Value)
                                    {
                                        articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["IdCountry"]);
                                        articleSupplier.Country = new Country();
                                        articleSupplier.Country.IdCountry = Convert.ToByte(mySqlDataReader["IdCountry"]);
                                        articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);
                                        if (mySqlDataReader["CountryISO"] != DBNull.Value)
                                        {
                                            articleSupplier.Country.Iso = Convert.ToString(mySqlDataReader["CountryISO"]);
                                            articleSupplier.Country.CountryIconUrl = "https://api.emdep.com/GEOS/Images?FilePath=/Images/Countries/" + articleSupplier.Country.Iso + ".png";
                                            //if (!countryISOs.Any(co => co.ToString() == articleSupplier.Country.Iso))
                                            //{
                                            //    countryISOs.Add(articleSupplier.Country.Iso);
                                            //}
                                        }
                                    }
                                    if (mySqlDataReader["SupplierContactPerson"] != DBNull.Value)
                                        articleSupplier.ContactPerson = Convert.ToString(mySqlDataReader["SupplierContactPerson"]);
                                    if (mySqlDataReader["SupplierContactEmail"] != DBNull.Value)
                                        articleSupplier.ContactEmail = Convert.ToString(mySqlDataReader["SupplierContactEmail"]);
                                    warehousePurchaseOrder.ArticleSupplier = articleSupplier;
                                }
                                //[rdixit][GEOS2-4455][19.06.2023]
                                //if (mySqlDataReader["DeliveryDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["deliveryDate"]) != DateTime.MinValue)
                                //{
                                //warehousePurchaseOrder.DeliveryDate = Convert.ToDateTime(mySqlDataReader["deliveryDate"]);
                                //warehousePurchaseOrder.Delay = (int)(warehousePurchaseOrder.DeliveryDate.Value.Date - DateTime.Now.Date).TotalDays;
                                //}

                                //Shubham[skadam]  GEOS2-4713 Missing Delivery Dates 31 07 2023 
                                if (mySqlDataReader["PODeliveryDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["PODeliveryDate"]) != DateTime.MinValue)
                                {
                                    warehousePurchaseOrder.PODeliveryDate = Convert.ToDateTime(mySqlDataReader["PODeliveryDate"]);
                                }
                                if (mySqlDataReader["AttachedPO"] != DBNull.Value)
                                    warehousePurchaseOrder.AttachedPO = Convert.ToByte(mySqlDataReader["AttachedPO"]);
                                if (mySqlDataReader["Deliveries"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.Deliveries = Convert.ToInt32(mySqlDataReader["Deliveries"]);
                                    if (warehousePurchaseOrder.Deliveries > 0)
                                    {
                                        warehousePurchaseOrder.IsPartialPending = true;
                                    }
                                }
                                if (mySqlDataReader["LatestDeliveryDate"] != DBNull.Value)
                                    warehousePurchaseOrder.LatestDeliveryDate = Convert.ToDateTime(mySqlDataReader["LatestDeliveryDate"]);
                                if (mySqlDataReader["IdWarehouse"] != DBNull.Value)
                                    warehousePurchaseOrder.IdWarehouse = Convert.ToInt64(mySqlDataReader["IdWarehouse"]);
                                if (mySqlDataReader["OrderQty"] != DBNull.Value)
                                    totalQuantity = Convert.ToDouble(mySqlDataReader["OrderQty"]);
                                if (mySqlDataReader["ReceivedQuantity"] != DBNull.Value)
                                    receivedQuantity = Convert.ToDouble(mySqlDataReader["ReceivedQuantity"]);
                                if (totalQuantity > 0)
                                    warehousePurchaseOrder.Status = (Int16)((receivedQuantity / totalQuantity) * 100);
                                if (mySqlDataReader["TotalAmount"] != DBNull.Value)
                                    warehousePurchaseOrder.TotalAmount = Convert.ToDecimal(mySqlDataReader["TotalAmount"]);
                                if (mySqlDataReader["CreatedIn"] != DBNull.Value)
                                    warehousePurchaseOrder.CreatedIn = Convert.ToDateTime(mySqlDataReader["CreatedIn"]);
                                if (mySqlDataReader["AttachPdf"] != DBNull.Value)
                                    warehousePurchaseOrder.AttachPdf = Convert.ToString(mySqlDataReader["AttachPdf"]);
                                if (mySqlDataReader["idCurrency"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.IdCurrency = Convert.ToByte(mySqlDataReader["idCurrency"]);
                                    warehousePurchaseOrder.Currency = new Currency();
                                    warehousePurchaseOrder.Currency.IdCurrency = Convert.ToByte(mySqlDataReader["idCurrency"]);
                                    warehousePurchaseOrder.Currency.Name = Convert.ToString(mySqlDataReader["CurrencyName"]);
                                    warehousePurchaseOrder.Currency.Symbol = Convert.ToString(mySqlDataReader["CurrencySymbol"]);
                                }
                                if (mySqlDataReader["IdWorkflowStatus"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                    warehousePurchaseOrder.WorkflowStatus = new WorkflowStatus();
                                    warehousePurchaseOrder.WorkflowStatus.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                    warehousePurchaseOrder.WorkflowStatus.Name = Convert.ToString(mySqlDataReader["Status"]);
                                    warehousePurchaseOrder.WorkflowStatus.HtmlColor = Convert.ToString(mySqlDataReader["HtmlColor"]);


                                    //[pramod.misal][GEOS2-4448][06-07-2023]
                                    if (mySqlDataReader["SortOrder"] != DBNull.Value)
                                    {
                                        warehousePurchaseOrder.WorkflowStatus.SortOrder = Convert.ToInt32(mySqlDataReader["SortOrder"]);
                                    }

                                }
                                if (mySqlDataReader["AssigneeEmail"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.AssigneeEmail = Convert.ToString(mySqlDataReader["AssigneeEmail"]);
                                }
                                if (mySqlDataReader["CreatorEmail"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.CreatorEmail = Convert.ToString(mySqlDataReader["CreatorEmail"]);
                                }

                                if (mySqlDataReader["ReminderEmailDate"] != DBNull.Value)
                                    warehousePurchaseOrder.ReminderEmailDate = Convert.ToDateTime(mySqlDataReader["ReminderEmailDate"]);

                                if (mySqlDataReader["WarehouseName"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.WarehouseName = Convert.ToString(mySqlDataReader["WarehouseName"]);
                                }


                                warehousePurchaseOrder.LstWorkflowStatus = LstWorkflowStatus;
                                List<byte> GetCurrentButtons = LstWorkflowStatusTransitions.Where(a => a.IdWorkflowStatusFrom == warehousePurchaseOrder.IdWorkflowStatus).Select(a => a.IdWorkflowStatusTo).Distinct().ToList();
                                warehousePurchaseOrder.LstWorkflowStatusTransition = new List<WorkflowStatus>();
                                warehousePurchaseOrder.LstWorkflowStatusTransition.Add(warehousePurchaseOrder.LstWorkflowStatus.FirstOrDefault(a => a.IdWorkflowStatus == warehousePurchaseOrder.IdWorkflowStatus));
                                foreach (byte statusbutton in GetCurrentButtons)
                                {
                                    warehousePurchaseOrder.LstWorkflowStatusTransition.Add(warehousePurchaseOrder.LstWorkflowStatus.FirstOrDefault(a => a.IdWorkflowStatus == statusbutton));
                                }
                            }
                            catch (Exception ex)
                            {
                            }
                            warehousePurchaseOrder.LstAllWorkflowStatusTransitions = LstWorkflowStatusTransitions;
                            warehousePurchaseOrders.Add(warehousePurchaseOrder);

                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetPendingPurchaseOrdersByWarehouse_V2450(). ErrorMessage-" + ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                    #region 2nd ResultSet [rdixit][GEOS2-4455][19.06.2023] 
                    if (mySqlDataReader.NextResult())
                    {
                        while (mySqlDataReader.Read())
                        {
                            if (mySqlDataReader["idWarehousePurchaseOrder"] != DBNull.Value)
                            {
                                WarehousePurchaseOrderItem OrderItem = new WarehousePurchaseOrderItem();

                                WarehousePurchaseOrder Order = warehousePurchaseOrders.FirstOrDefault(i => i.IdWarehousePurchaseOrder == Convert.ToInt64(mySqlDataReader["idWarehousePurchaseOrder"]));
                                if (Order != null)
                                {
                                    if (Order.WarehousePurchaseOrderItems == null)
                                    {
                                        Order.WarehousePurchaseOrderItems = new List<WarehousePurchaseOrderItem>();
                                    }
                                    if (mySqlDataReader["idWarehousePurchaseOrder"] != DBNull.Value)
                                        OrderItem.IdWarehousePurchaseOrder = Convert.ToInt64(mySqlDataReader["idWarehousePurchaseOrder"]);
                                    if (mySqlDataReader["IdWarehousePurchaseOrderItem"] != DBNull.Value)
                                        OrderItem.IdWarehousePurchaseOrderItem = Convert.ToInt64(mySqlDataReader["IdWarehousePurchaseOrderItem"]);
                                    if (mySqlDataReader["Quantity"] != DBNull.Value)
                                        OrderItem.Quantity = Convert.ToDouble(mySqlDataReader["Quantity"]);
                                    if (mySqlDataReader["AlbaranQty"] != DBNull.Value)
                                        OrderItem.ReceivedQuantity = Convert.ToDouble(mySqlDataReader["AlbaranQty"]);
                                    if (OrderItem.Quantity > 0)
                                        OrderItem.Status = (Int16)((OrderItem.ReceivedQuantity / OrderItem.Quantity) * 100);
                                    Order.WarehousePurchaseOrderItems.Add(OrderItem);
                                }
                            }
                        }
                    }
                    #endregion
                    #region 3nd ResultSet [rdixit][GEOS2-4455][19.06.2023] 
                    if (mySqlDataReader.NextResult())
                    {
                        while (mySqlDataReader.Read())
                        {
                            if (mySqlDataReader["IdWarehousePurchaseOrderItem"] != DBNull.Value)
                            {
                                WarehousePurchaseOrderExpectedItem OrderExpectedItem = new WarehousePurchaseOrderExpectedItem();

                                WarehousePurchaseOrderItem OrderItem = warehousePurchaseOrders.Where(o => o.WarehousePurchaseOrderItems != null)
                                                                        .SelectMany(order => order.WarehousePurchaseOrderItems)
                                                                        .FirstOrDefault(item => item.IdWarehousePurchaseOrderItem == Convert.ToInt64(mySqlDataReader["IdWarehousePurchaseOrderItem"]));
                                if (OrderItem != null)
                                {
                                    if (OrderItem.WarehousePurchaseOrderExpectedItems == null)
                                    {
                                        OrderItem.WarehousePurchaseOrderExpectedItems = new List<WarehousePurchaseOrderExpectedItem>();
                                    }
                                    if (mySqlDataReader["IdWarehousePurchaseOrderItem"] != DBNull.Value)
                                        OrderExpectedItem.IdWarehousePurchaseOrderItem = Convert.ToInt64(mySqlDataReader["IdWarehousePurchaseOrderItem"]);
                                    if (mySqlDataReader["Quantity"] != DBNull.Value)
                                        OrderExpectedItem.Quantity = (long)Convert.ToDouble(mySqlDataReader["Quantity"]);
                                    if (mySqlDataReader["Date"] != DBNull.Value)
                                        OrderExpectedItem.Date = Convert.ToDateTime(mySqlDataReader["Date"]);

                                    OrderItem.WarehousePurchaseOrderExpectedItems.Add(OrderExpectedItem);
                                }
                            }
                        }
                    }
                    #endregion
                }
            }
            #region 2nd ResultSet [rdixit][GEOS2-4455][19.06.2023] 
            foreach (WarehousePurchaseOrder Order in warehousePurchaseOrders)
            {
                List<DateTime> ItemDates = new List<DateTime>();
                if (Order.WarehousePurchaseOrderItems != null)
                {
                    if (Order.WarehousePurchaseOrderItems.Where(i => i.Status < 100) != null)
                    {
                        if (Order.WarehousePurchaseOrderItems.Where(i => i.Status < 100).ToList().Count > 0)
                        {
                            foreach (WarehousePurchaseOrderItem OrderItem in Order.WarehousePurchaseOrderItems.Where(i => i.Status != 100))
                            {
                                if (OrderItem.WarehousePurchaseOrderExpectedItems != null)
                                {
                                    if (OrderItem.WarehousePurchaseOrderExpectedItems.Count > 0)
                                        ItemDates.Add(OrderItem.WarehousePurchaseOrderExpectedItems.FirstOrDefault().Date);
                                }
                            }
                        }
                    }
                }
                if (ItemDates.Count != 0)
                {
                    Order.DeliveryDate = ItemDates.Min(d => d.Date).Date;
                    Order.Delay = (int)(Order.DeliveryDate.Value.Date - DateTime.Now.Date).TotalDays;

                    if (!string.IsNullOrEmpty(Order.ArticleSupplier.ContactEmail))
                    {
                        if (Order.ReminderEmailDate == DateTime.MinValue || Order.ReminderEmailDate == null)
                        {
                            Order.ReminderEmailDate = Order.DeliveryDate.Value.AddDays(1);
                        }
                        DateTime dtRm = new DateTime(Order.ReminderEmailDate.Value.Year, Order.ReminderEmailDate.Value.Month, Order.ReminderEmailDate.Value.Day);
                        DateTime dtNow = new DateTime(DateTime.Now.Year, DateTime.Now.Month, DateTime.Now.Day);
                        if (dtRm <= dtNow)
                        {
                            orderid = new List<long>();
                            orderid.Add(Order.IdWarehousePurchaseOrder);
                            if (!SupplierEmailId.ContainsKey(Order.ArticleSupplier.ContactEmail))
                            {
                                SupplierEmailId.Add(Order.ArticleSupplier.ContactEmail, orderid);
                            }
                            else
                            {
                                SupplierEmailId[Order.ArticleSupplier.ContactEmail].Add(Order.IdWarehousePurchaseOrder);
                            }
                        }
                    }
                    else
                    {
                        if (!Suppliername.Contains(Order.ArticleSupplier.Name))
                        {
                            Suppliername.Add(Order.ArticleSupplier.Name);
                        }
                    }
                }
            }
            #endregion
            #region GEOS2-4713
            //Shubham[skadam]  GEOS2-4713 Missing Delivery Dates 31 07 2023 
            foreach (var item in warehousePurchaseOrders.Where(w => w.DeliveryDate == null || w.DeliveryDate == DateTime.MinValue))
            {
                if (!string.IsNullOrEmpty(item.PODeliveryDate.ToString()))
                {
                    item.DeliveryDate = item.PODeliveryDate;
                    item.Delay = (int)(item.DeliveryDate.Value.Date - DateTime.Now.Date).TotalDays;
                }
            }
            #endregion
            //foreach (string item in countryISOs)
            //{
            //    byte[] bytes = null;
            //    bytes = GetCountryIconFileInBytes(item, countryIconFilePath);
            //    warehousePurchaseOrders.Where(wp => wp.ArticleSupplier.Country.Iso == item).ToList().ForEach(wp => wp.ArticleSupplier.Country.CountryIconBytes = bytes);
            //}
            if (warehousePurchaseOrders.Count > 0)
            {
                warehousePurchaseOrders.FirstOrDefault().SupplierEmailId = SupplierEmailId;
                warehousePurchaseOrders.FirstOrDefault().Suppliername = Suppliername;
            }
            return warehousePurchaseOrders;
        }

        //Shubham[skadam] GEOS2-5026 Log not added properly in purchase order 08 11 2023
        public bool IsUpdateWarehousePurchaseOrderWithStatus_V2450(string connectionString, WarehousePurchaseOrder warehousePurchaseOrder)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    if (warehousePurchaseOrder != null && warehousePurchaseOrder.IdWarehousePurchaseOrder > 0)
                    {
                        using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                        {
                            mySqlConnection.Open();

                            MySqlCommand mySqlCommand = new MySqlCommand("SRM_UpdatePendingPODetailsForGridUpdate", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", warehousePurchaseOrder.IdWarehousePurchaseOrder);
                            mySqlCommand.Parameters.AddWithValue("_IdWorkflowStatus", warehousePurchaseOrder.IdWorkflowStatus);
                            mySqlCommand.Parameters.AddWithValue("_IdAssignee", warehousePurchaseOrder.IdAssignee);
                            mySqlCommand.Parameters.AddWithValue("_IdApprover", warehousePurchaseOrder.IdApprover);
                            mySqlCommand.Parameters.AddWithValue("_IdModifier", warehousePurchaseOrder.ModifiedBy);
                            mySqlCommand.Parameters.AddWithValue("_ModificationDate", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                            mySqlCommand.ExecuteNonQuery();

                            mySqlConnection.Close();

                            isUpdated = true;
                        }


                        AddWarehousePurchaseOrderLogEntry_V2450(connectionString, warehousePurchaseOrder.IdWarehousePurchaseOrder, warehousePurchaseOrder.WarehousePOLogEntries);


                        isUpdated = true;
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error IsUpdateWarehousePurchaseOrderWithStatus(). IdWarehousePurchaseOrder- {0} ErrorMessage- {1}", warehousePurchaseOrder.IdWarehousePurchaseOrder, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }

        public void AddWarehousePurchaseOrderLogEntry_V2450(string MainServerConnectionString, Int64 IdWarehousePurchaseOrder, List<LogEntriesByWarehousePO> LogList)
        {
            try
            {
                if (LogList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (LogEntriesByWarehousePO logList in LogList)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("SRM_LogEntriesWarehousePurchaseOrder_Insert_V2450", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", IdWarehousePurchaseOrder);
                            mySqlCommand.Parameters.AddWithValue("_IdUser", logList.IdUser);
                            mySqlCommand.Parameters.AddWithValue("_IdLogEntryType", logList.IdEntryType);
                            mySqlCommand.Parameters.AddWithValue("_Datetime", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                            mySqlCommand.Parameters.AddWithValue("_Comments", logList.Comments);

                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddWarehousePurchaseOrderLogEntry(). IdWarehousePurchaseOrder- {0} ErrorMessage- {1}", IdWarehousePurchaseOrder, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        //Shubham[skadam] GEOS2-4965 General discount row is not added in the PO 24 11 2023
        public WarehousePurchaseOrder GetPendingPOByIdWarehousePurchaseOrder_V2460(string connectionString, Int64 idWarehousePurchaseOrder, string idShippingAddress, string purchaseOrdersPath, string emailTemplatePath, string countryIconFilePath)
        {
            WarehousePurchaseOrder warehousePurchaseOrder = null;

            Country country = new Country();
            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();
                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetPendingPOByIdWarehousePurchaseOrder_V2420", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", idWarehousePurchaseOrder);

                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    if (mySqlDataReader.Read())
                    {
                        try
                        {

                            warehousePurchaseOrder = new WarehousePurchaseOrder();
                            List<WarehouseShippingAddress> warehouseShippingAddresses = new List<WarehouseShippingAddress>();


                            warehousePurchaseOrder.IdWarehousePurchaseOrder = idWarehousePurchaseOrder;

                            if (mySqlDataReader["Code"] != DBNull.Value)
                                warehousePurchaseOrder.Code = Convert.ToString(mySqlDataReader["Code"]);

                            if (mySqlDataReader["IdArticleSupplier"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                                ArticleSupplier articleSupplier = new ArticleSupplier();
                                articleSupplier.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                                if (mySqlDataReader["Supplier"] != DBNull.Value)
                                    articleSupplier.Name = Convert.ToString(mySqlDataReader["Supplier"]);

                                if (mySqlDataReader["SupplierContactPerson"] != DBNull.Value)
                                    articleSupplier.ContactPerson = Convert.ToString(mySqlDataReader["SupplierContactPerson"]);

                                if (mySqlDataReader["SupplierContactEmail"] != DBNull.Value)
                                    articleSupplier.ContactEmail = Convert.ToString(mySqlDataReader["SupplierContactEmail"]);

                                if (mySqlDataReader["Serie"] != DBNull.Value)
                                    articleSupplier.Serie = Convert.ToChar(mySqlDataReader["Serie"]);

                                if (mySqlDataReader["IdCountry"] != DBNull.Value)
                                {
                                    articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["IdCountry"]);

                                    articleSupplier.Country = new Country();
                                    articleSupplier.Country.IdCountry = (byte)articleSupplier.IdCountry;
                                    articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);

                                    if (mySqlDataReader["SupplierCountryISO"] != DBNull.Value)
                                    {
                                        articleSupplier.Country.Iso = Convert.ToString(mySqlDataReader["SupplierCountryISO"]);
                                        byte[] bytes = null;
                                        bytes = GetCountryIconFileInBytes(articleSupplier.Country.Iso, countryIconFilePath);
                                        articleSupplier.Country.CountryIconBytes = bytes;
                                    }

                                    if (mySqlDataReader["IdCountryGroup"] != DBNull.Value)
                                        articleSupplier.Country.IdCountryGroup = Convert.ToInt64(mySqlDataReader["IdCountryGroup"]);
                                }

                                if (mySqlDataReader["IdArticleSupplierType"] != DBNull.Value)
                                {
                                    articleSupplier.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["IdArticleSupplierType"]);

                                    articleSupplier.ArticleSupplierType = new ArticleSupplierType();
                                    articleSupplier.ArticleSupplierType.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["IdArticleSupplierType"]);
                                    articleSupplier.ArticleSupplierType.Name = Convert.ToString(mySqlDataReader["ArticleSupplierType"]);
                                    articleSupplier.ArticleSupplierType.HtmlColor = Convert.ToString(mySqlDataReader["HtmlColor"]);
                                }

                                warehousePurchaseOrder.ArticleSupplier = articleSupplier;
                            }
                            //[rdixit][GEOS2-4455][28.06.2023] 
                            //if (mySqlDataReader["DeliveryDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["deliveryDate"]) != DateTime.MinValue)
                            //{
                            //    warehousePurchaseOrder.DeliveryDate = Convert.ToDateTime(mySqlDataReader["deliveryDate"]);
                            //}

                            if (mySqlDataReader["AttachedPO"] != DBNull.Value)
                                warehousePurchaseOrder.AttachedPO = Convert.ToByte(mySqlDataReader["AttachedPO"]);

                            if (mySqlDataReader["IdPaymentType"] != DBNull.Value)
                                warehousePurchaseOrder.IdPaymentType = Convert.ToInt64(mySqlDataReader["IdPaymentType"]);

                            if (mySqlDataReader["ReminderEmailDate"] != DBNull.Value)
                                warehousePurchaseOrder.ReminderEmailDate = Convert.ToDateTime(mySqlDataReader["ReminderEmailDate"]);

                            if (mySqlDataReader["CreatedIn"] != DBNull.Value)
                                warehousePurchaseOrder.CreatedIn = Convert.ToDateTime(mySqlDataReader["CreatedIn"]);

                            if (mySqlDataReader["ModifiedIn"] != DBNull.Value)
                                warehousePurchaseOrder.ModifiedIn = Convert.ToDateTime(mySqlDataReader["ModifiedIn"]);

                            if (mySqlDataReader["Comments"] != DBNull.Value)
                                warehousePurchaseOrder.Comments = Convert.ToString(mySqlDataReader["Comments"]);

                            //[pramod.misal][GEOS2-4449][04-06-2023]warehouseShippingAddress
                            if (mySqlDataReader["Observations"] != DBNull.Value)
                                warehousePurchaseOrder.SupplierComments = Convert.ToString(mySqlDataReader["Observations"]);

                            #region old code
                            //-------------------------------------------------------------------------------------
                            // create a new Sp and  read feilds related to shipping address

                            //if (mySqlDataReader["Name"] != DBNull.Value)
                            //    warehousePurchaseOrder.Name = Convert.ToString(mySqlDataReader["Name"]);

                            //if (mySqlDataReader["Address"] != DBNull.Value)
                            //    warehousePurchaseOrder.Address = Convert.ToString(mySqlDataReader["Address"]);

                            //if (mySqlDataReader["ZipCode"] != DBNull.Value)
                            //    warehousePurchaseOrder.ZipCode = Convert.ToString(mySqlDataReader["ZipCode"]);

                            //if (mySqlDataReader["City"] != DBNull.Value)
                            //    warehousePurchaseOrder.City = Convert.ToString(mySqlDataReader["City"]);

                            //if (mySqlDataReader["Region"] != DBNull.Value)
                            //    warehousePurchaseOrder.Region = Convert.ToString(mySqlDataReader["Region"]);

                            //if (mySqlDataReader["IdCountry"] != DBNull.Value)
                            //    warehousePurchaseOrder.IdCountry = Convert.ToInt64(mySqlDataReader["IdCountry"]);

                            //or

                            //while (mySqlDataReader.Read())
                            //{
                            //    WarehouseShippingAddress warehouseShippingAddress = new WarehouseShippingAddress();

                            //    if (mySqlDataReader["Name"] != DBNull.Value)
                            //        warehouseShippingAddress.Name = Convert.ToString(mySqlDataReader["Name"]);

                            //    if (mySqlDataReader["Address"] != DBNull.Value)
                            //        warehouseShippingAddress.Address = Convert.ToString(mySqlDataReader["Address"]);

                            //    if (mySqlDataReader["ZipCode"] != DBNull.Value)
                            //        warehouseShippingAddress.ZipCode = Convert.ToString(mySqlDataReader["ZipCode"]);

                            //    if (mySqlDataReader["City"] != DBNull.Value)
                            //        warehouseShippingAddress.City = Convert.ToString(mySqlDataReader["City"]);

                            //    if (mySqlDataReader["Region"] != DBNull.Value)
                            //        warehouseShippingAddress.Region = Convert.ToString(mySqlDataReader["Region"]);

                            //    if (mySqlDataReader["IdCountry"] != DBNull.Value)
                            //        warehouseShippingAddress.IdCountry = Convert.ToInt64(mySqlDataReader["IdCountry"]);

                            //    warehouseShippingAddresses.Add(warehouseShippingAddress);
                            //}

                            //warehousePurchaseOrder.WarehouseShippingAddress = warehouseShippingAddresses;


                            //------------------------------------------------------------------------------------------
                            #endregion old code end

                            if (mySqlDataReader["IsClosed"] != DBNull.Value)
                                warehousePurchaseOrder.IsClosed = Convert.ToByte(mySqlDataReader["IsClosed"]);

                            if (mySqlDataReader["CreatedBy"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.CreatedBy = Convert.ToInt64(mySqlDataReader["CreatedBy"]);
                                warehousePurchaseOrder.Creator = new People();
                                warehousePurchaseOrder.Creator.IdPerson = Convert.ToInt32(mySqlDataReader["CreatedBy"].ToString());
                                warehousePurchaseOrder.Creator.Name = mySqlDataReader["CreatorName"].ToString();
                                warehousePurchaseOrder.Creator.Surname = mySqlDataReader["CreatorSurname"].ToString();
                            }

                            if (mySqlDataReader["ModifiedBy"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.ModifiedBy = Convert.ToInt64(mySqlDataReader["ModifiedBy"]);
                                warehousePurchaseOrder.Modifier = new People();
                                warehousePurchaseOrder.Modifier.IdPerson = Convert.ToInt32(mySqlDataReader["ModifiedBy"].ToString());
                                warehousePurchaseOrder.Modifier.Name = mySqlDataReader["ModifierName"].ToString();
                                warehousePurchaseOrder.Modifier.Surname = mySqlDataReader["ModifierSurname"].ToString();
                            }

                            if (mySqlDataReader["ReasonClosed"] != DBNull.Value)
                                warehousePurchaseOrder.ReasonClosed = Convert.ToString(mySqlDataReader["ReasonClosed"]);

                            if (mySqlDataReader["IdWarehouse"] != DBNull.Value)
                                warehousePurchaseOrder.IdWarehouse = Convert.ToInt64(mySqlDataReader["IdWarehouse"]);

                            if (mySqlDataReader["IdShippingAddress"] != DBNull.Value)
                                warehousePurchaseOrder.IdShippingAddress = Convert.ToInt64(mySqlDataReader["IdShippingAddress"]);

                            if (mySqlDataReader["IdCurrency"] != DBNull.Value)
                                warehousePurchaseOrder.IdCurrency = Convert.ToByte(mySqlDataReader["IdCurrency"]);

                            if (mySqlDataReader["IdWorkflowStatus"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                warehousePurchaseOrder.WorkflowStatus = new WorkflowStatus();
                                warehousePurchaseOrder.WorkflowStatus.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                warehousePurchaseOrder.WorkflowStatus.Name = Convert.ToString(mySqlDataReader["Status"]);
                                warehousePurchaseOrder.WorkflowStatus.HtmlColor = Convert.ToString(mySqlDataReader["StatusHtmlColor"]);
                            }

                            if (mySqlDataReader["IdAssignee"] != DBNull.Value)
                                warehousePurchaseOrder.IdAssignee = Convert.ToUInt32(mySqlDataReader["IdAssignee"]);

                            if (mySqlDataReader["IdApprover"] != DBNull.Value)
                                warehousePurchaseOrder.IdApprover = Convert.ToUInt32(mySqlDataReader["IdApprover"]);

                            if (mySqlDataReader["AssigneeEmail"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.AssigneeEmail = Convert.ToString(mySqlDataReader["AssigneeEmail"]);
                            }
                            if (mySqlDataReader["CreatorEmail"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.CreatorEmail = Convert.ToString(mySqlDataReader["CreatorEmail"]);
                            }

                            string HTMLFileName = null;
                            if (File.Exists(string.Format("{0}{1}SupplierPurchaseOrderRequestMailFormat_{2}-{3}.html", emailTemplatePath, @"\", warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower(), warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToUpper())))
                            {
                                HTMLFileName = string.Format("SupplierPurchaseOrderRequestMailFormat_{0}-{1}.html", warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower(), warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToUpper());
                            }
                            else if (File.Exists(string.Format("{0}{1}SupplierPurchaseOrderRequestMailFormat.html", emailTemplatePath, @"\")))
                            {
                                HTMLFileName = "SupplierPurchaseOrderRequestMailFormat.html";
                            }
                            if (HTMLFileName != null)
                            {
                                StringBuilder emailbody = new StringBuilder();
                                string text = ReadMailTemplate(HTMLFileName, emailTemplatePath);

                                if (string.IsNullOrEmpty(warehousePurchaseOrder.ArticleSupplier.ContactPerson))
                                {
                                    text = text.Replace("[Supplier_Name]", "Supplier");
                                }
                                else
                                {
                                    text = text.Replace("[Supplier_Name]", warehousePurchaseOrder.ArticleSupplier.ContactPerson);
                                }
                                text = text.Replace("[PO_Code]", warehousePurchaseOrder.Code);

                                emailbody.Append(text);

                                warehousePurchaseOrder.EmailBody = emailbody.ToString();
                            }
                            warehousePurchaseOrder.AttachPdf = warehousePurchaseOrder.CreatedIn.Year + @"\" + warehousePurchaseOrder.Code + @"\01 Purchase Order\PO_" + warehousePurchaseOrder.Code + ".pdf";

                            warehousePurchaseOrder.AttachmentBytes = GetPurchaseOrderPdf(purchaseOrdersPath, warehousePurchaseOrder.AttachPdf);
                            warehousePurchaseOrder.WarehouseDeliveryNotes = GetDeliveryNotesByIdWarehousePurchaseOrder(connectionString, warehousePurchaseOrder, purchaseOrdersPath);


                            // [pramod.misal][GEOS2-4951][05-07-2023]

                            warehousePurchaseOrder.WarehouseShippingAddress = GetShippingAddressByIdShippingAddress_V2420(connectionString, warehousePurchaseOrder, idShippingAddress);
                            // [rdixit][GEOS2-4822][13-09-2023]
                            // [rdixit][GEOS2-4589][09-10-2023]
                            warehousePurchaseOrder.WarehousePurchaseOrderItemWithComments = GetArticlesByIdWarehousePurchaseOrder_V2460(connectionString, warehousePurchaseOrder.IdWarehousePurchaseOrder);
                            //warehousePurchaseOrder.WarehousePOComments = GetlogEntriesByWarehousePO_V2400(idWarehousePurchaseOrder, 252, connectionString);
                            //warehousePurchaseOrder.WarehousePOLogEntries = GetlogEntriesByWarehousePO_V2400(idWarehousePurchaseOrder, 253, connectionString);
                            //[pramod.misal][GEOS2-4451][08-08-2023]  logEntriesByWarehousePO.IdEntryType
                            warehousePurchaseOrder.WarehousePOComments = GetlogEntriesByWarehousePO_V2420(idWarehousePurchaseOrder, 257, connectionString);
                            warehousePurchaseOrder.WarehousePOLogEntries = GetlogEntriesByWarehousePO_V2420(idWarehousePurchaseOrder, 258, connectionString);



                            //[rdixit][GEOS2-4455][28.06.2023] 
                            List<DateTime> ItemDates = new List<DateTime>();
                            if (warehousePurchaseOrder.WarehousePurchaseOrderItemWithComments != null)
                            {
                                if (warehousePurchaseOrder.WarehousePurchaseOrderItemWithComments.Where(i => i.Status < 100) != null)
                                {
                                    if (warehousePurchaseOrder.WarehousePurchaseOrderItemWithComments.Where(i => i.Status < 100).ToList().Count > 0)
                                        foreach (var item in warehousePurchaseOrder.WarehousePurchaseOrderItemWithComments.Where(i => i.Status < 100))
                                        {
                                            if (item.WarehousePurchaseOrderExpectedItems != null)
                                            {
                                                if (item.WarehousePurchaseOrderExpectedItems.Count > 0)
                                                    ItemDates.Add(item.WarehousePurchaseOrderExpectedItems.FirstOrDefault().Date);
                                            }
                                        }
                                }
                            }
                            if (ItemDates.Count > 0)
                                warehousePurchaseOrder.DeliveryDate = ItemDates.Min(d => d.Date).Date;
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetPendingPOByIdWarehousePurchaseOrder_V2440(idWarehousePurchaseOrder-{0}), ErrorMessage- {1} ", idWarehousePurchaseOrder, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            return warehousePurchaseOrder;
        }
        public List<WarehousePurchaseOrderItemWithComments> GetArticlesByIdWarehousePurchaseOrder_V2460(string connectionString, Int64 idWarehousePurchaseOrder)
        {
            List<WarehousePurchaseOrderItemWithComments> warehousePurchaseOrderItems = new List<WarehousePurchaseOrderItemWithComments>();

            using (MySqlConnection connWarehousePurchaseOrderItem = new MySqlConnection(connectionString))
            {
                connWarehousePurchaseOrderItem.Open();

                MySqlCommand activitiesCommand = new MySqlCommand("SRM_GetArticlesAndPOItemsByIdWarehousePurchaseOrder_V2460", connWarehousePurchaseOrderItem);
                activitiesCommand.CommandType = CommandType.StoredProcedure;
                activitiesCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", idWarehousePurchaseOrder);

                using (MySqlDataReader poReader = activitiesCommand.ExecuteReader())
                {
                    while (poReader.Read())
                    {
                        try
                        {
                            WarehousePurchaseOrderItemWithComments warehousePurchaseOrderItem = new WarehousePurchaseOrderItemWithComments();

                            warehousePurchaseOrderItem.IdWarehousePurchaseOrder = idWarehousePurchaseOrder;

                            if (poReader["IdWarehousePurchaseOrderItem"] != DBNull.Value)
                                warehousePurchaseOrderItem.IdWarehousePurchaseOrderItem = Convert.ToInt64(poReader["IdWarehousePurchaseOrderItem"]);

                            if (poReader["Description"] != DBNull.Value)
                                warehousePurchaseOrderItem.Description = Convert.ToString(poReader["Description"]);

                            if (poReader["IdArticle"] != DBNull.Value)
                            {
                                warehousePurchaseOrderItem.IdArticle = Convert.ToInt32(poReader["IdArticle"]);

                                Article article = new Article();

                                if (poReader["Reference"] != DBNull.Value)
                                    article.Reference = Convert.ToString(poReader["Reference"]);

                                if (poReader["IsGeneric"] != DBNull.Value)
                                    article.IsGeneric = Convert.ToSByte(poReader["IsGeneric"]);

                                if (poReader["IdArticleCategory"] != DBNull.Value)
                                    article.IdArticleCategory = Convert.ToInt32(poReader["IdArticleCategory"]);

                                warehousePurchaseOrderItem.Article = article;
                            }

                            if (poReader["Quantity"] != DBNull.Value)
                                warehousePurchaseOrderItem.Quantity = Convert.ToInt32(poReader["Quantity"]);

                            if (poReader["UnitPrice"] != DBNull.Value)
                                warehousePurchaseOrderItem.UnitPrice = Convert.ToDouble(poReader["UnitPrice"]);

                            if (poReader["Discount"] != DBNull.Value)
                                warehousePurchaseOrderItem.Discount = Convert.ToDouble(poReader["Discount"]);

                            if (poReader["Iva"] != DBNull.Value)
                                warehousePurchaseOrderItem.IVA = Convert.ToDouble(poReader["Iva"]);

                            if (poReader["AdditionalComments"] != DBNull.Value)
                                warehousePurchaseOrderItem.AdditionalComments = Convert.ToString(poReader["AdditionalComments"]);

                            if (poReader["Position"] != DBNull.Value)
                                warehousePurchaseOrderItem.Position = Convert.ToInt64(poReader["Position"]);

                            if (poReader["AlbaranQty"] != DBNull.Value)
                                warehousePurchaseOrderItem.ReceivedQuantity = Convert.ToInt32(poReader["AlbaranQty"]);


                            if (poReader["TotalAmount"] != DBNull.Value)
                                warehousePurchaseOrderItem.TotalAmount = Convert.ToDecimal(poReader["TotalAmount"]);

                            if (poReader["TotalAmount"] != DBNull.Value)
                                warehousePurchaseOrderItem.TotalAmount_New = Convert.ToDouble(poReader["TotalAmount"]);

                            if (warehousePurchaseOrderItem.Quantity > 0)
                            {
                                warehousePurchaseOrderItem.Status = (Int32)(warehousePurchaseOrderItem.ReceivedQuantity / warehousePurchaseOrderItem.Quantity * 100);
                            }

                            warehousePurchaseOrderItem.WarehousePurchaseOrderExpectedItems = GetWarehousePOExpectedItems(connectionString, warehousePurchaseOrderItem.IdWarehousePurchaseOrderItem);

                            if (warehousePurchaseOrderItem.WarehousePurchaseOrderExpectedItems.Count > 0)
                            {
                                warehousePurchaseOrderItem.ExpectedDate = warehousePurchaseOrderItem.WarehousePurchaseOrderExpectedItems.First().Date;
                            }

                            warehousePurchaseOrderItem.ReceivedDeliveryNotes = GetDeliveryNotesByIdWarehousePurchaseOrderItem(connectionString, warehousePurchaseOrderItem.IdWarehousePurchaseOrderItem);
                            warehousePurchaseOrderItems.Add(warehousePurchaseOrderItem);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetArticlesByIdWarehousePurchaseOrder_V2440(idWarehousePurchaseOrder-{0}). ErrorMessage- {1}", idWarehousePurchaseOrder, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            return warehousePurchaseOrderItems;
        }

        //[pramod.misal][GEOS2-4450][01.08.2023]
        //Shubham[skadam] GEOS2-5206 When we update comment updated date not show in grid. 22 01 2024.
        public bool UpdateAssigneeAndApproverInPO_V2480(string connectionString, WarehousePurchaseOrder warehousePurchaseOrder)
        {
            bool isUpdated = false;
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    if (warehousePurchaseOrder != null && warehousePurchaseOrder.IdWarehousePurchaseOrder > 0)
                    {
                        using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                        {
                            mySqlConnection.Open();

                            MySqlCommand mySqlCommand = new MySqlCommand("SRM_UpdateAssigneeAndApproverInPO", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", warehousePurchaseOrder.IdWarehousePurchaseOrder);
                            mySqlCommand.Parameters.AddWithValue("_IdAssignee", warehousePurchaseOrder.IdAssignee);
                            mySqlCommand.Parameters.AddWithValue("_IdApprover", warehousePurchaseOrder.IdApprover);
                            mySqlCommand.Parameters.AddWithValue("_ModifiedBy", warehousePurchaseOrder.ModifiedBy);
                            mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));

                            mySqlCommand.ExecuteNonQuery();

                            mySqlConnection.Close();

                            isUpdated = true;
                        }
                        AddCommentsOrLogEntriesByPO_V2420(connectionString, warehousePurchaseOrder.WarehousePOLogEntries);

                        //[pramod.misal][GEOS2-4550][03-08-2023]
                        AddUpdateDeleteCommentsByPO_V2480(connectionString, warehousePurchaseOrder.WarehousePOComments);
                        isUpdated = true;
                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateAssigneeAndApproverInPO_V2480(). IdWarehousePurchaseOrder- {0} ErrorMessage- {1}", warehousePurchaseOrder.IdWarehousePurchaseOrder, ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return isUpdated;
        }

        //[pramod.misal][GEOS2-4450][01.08.2023]PRM
        public void AddUpdateDeleteCommentsByPO_V2480(string MainServerConnectionString, List<LogEntriesByWarehousePO> commentsByWarehousePOList)
        {
            try
            {
                if (commentsByWarehousePOList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (LogEntriesByWarehousePO logEntriesByWarehousePO in commentsByWarehousePOList)
                        {

                            if (logEntriesByWarehousePO.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {

                                MySqlCommand mySqlCommand = new MySqlCommand("SRM_Insert_Comment_by_warehouse_purchase_order_Insert_V2420", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                mySqlCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", logEntriesByWarehousePO.IdWarehousePurchaseOrder);
                                mySqlCommand.Parameters.AddWithValue("_IdUser", logEntriesByWarehousePO.IdUser);
                                mySqlCommand.Parameters.AddWithValue("_Datetime", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                mySqlCommand.Parameters.AddWithValue("_Comments", logEntriesByWarehousePO.Comments);
                                //[pramod.misal][GEOS2-4736][07/08/2023]
                                mySqlCommand.Parameters.AddWithValue("_IdLogEntryType", 257);
                                mySqlCommand.Parameters.AddWithValue("_IsRtfText", logEntriesByWarehousePO.IsRtfText);

                                mySqlCommand.ExecuteNonQuery();
                            }

                            else if (logEntriesByWarehousePO.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {

                                MySqlCommand mySqlCommand = new MySqlCommand("SRM_Delete_Comment_by_IdLogEntryByWarehousePurchaseOrder", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdLogEntryByWarehousePurchaseOrder", logEntriesByWarehousePO.IdLogEntryByPurchaseOrder);
                                mySqlCommand.ExecuteNonQuery();
                            }

                            //Shubham[skadam] GEOS2-5206 When we update comment updated date not show in grid. 22 01 2024.
                            else if (logEntriesByWarehousePO.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("UpdateCommentsByIdWarehousePurchaseOrder_V2480", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdLogEntryByWarehousePurchaseOrder", logEntriesByWarehousePO.IdLogEntryByPurchaseOrder);
                                mySqlCommand.Parameters.AddWithValue("_Comments", logEntriesByWarehousePO.Comments);
                                mySqlCommand.Parameters.AddWithValue("_Datetime", logEntriesByWarehousePO.Datetime);
                                mySqlCommand.ExecuteNonQuery();

                            }

                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeleteCommentsByPO_V2480(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }


        public Contacts AddContact_V2480(string mainServerConnectionString, Contacts contacts, List<LogEntriesByArticleSuppliers> ArticleSuppliersChangeLogList)
        {
            TransactionScope transactionScope = null;
            try
            {
                using (transactionScope = new TransactionScope())
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("SRM_Contacts_Insert_Update_V2450", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_Idcontact", contacts.IdContact);
                        mySqlCommand.Parameters.AddWithValue("_Firstname", contacts.Firstname);
                        mySqlCommand.Parameters.AddWithValue("_Lastname", contacts.Lastname);
                        mySqlCommand.Parameters.AddWithValue("_IdGender", contacts.IdGender);
                        mySqlCommand.Parameters.AddWithValue("_Email", contacts.Email);
                        mySqlCommand.Parameters.AddWithValue("_Phone", contacts.Phone);
                        mySqlCommand.Parameters.AddWithValue("_Phone2", contacts.Phone2);
                        mySqlCommand.Parameters.AddWithValue("_IdDepartment", contacts.IdDepartment);
                        mySqlCommand.Parameters.AddWithValue("_JobTitle", contacts.JobTitle);
                        mySqlCommand.Parameters.AddWithValue("_Image", contacts.ImageText);
                        mySqlCommand.Parameters.AddWithValue("_Remarks", contacts.Remarks);

                        contacts.IdContact = Convert.ToInt32(mySqlCommand.ExecuteScalar());
                        mySqlConnection.Close();
                    }

                    transactionScope.Complete();
                }
                if (contacts.ArticleSuppliersComments != null)
                {
                    AddUpdateDeleteCommentsByContacts_V2480(mainServerConnectionString, contacts.IdContact, contacts.ArticleSuppliersComments);
                }
                if (ArticleSuppliersChangeLogList != null && ArticleSuppliersChangeLogList.Count > 0)
                {
                    AddCommentsOrLogEntriesByContacts_V2450(mainServerConnectionString, contacts.IdContact, ArticleSuppliersChangeLogList);
                }
            }
            catch (Exception ex)
            {
                if (Transaction.Current != null)
                    Transaction.Current.Rollback();

                if (transactionScope != null)
                    transactionScope.Dispose();

                Log4NetLogger.Logger.Log(string.Format("Error AddContact_V2480(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return contacts;
        }

        //[chitra.girigosavi][GEOS2-4692][17.10.2023]
        public bool AddUpdateDeleteCommentsByContacts_V2480(string MainServerConnectionString, int idcontact, List<LogEntriesByArticleSuppliers> commentsBycontactsList)
        {
            try
            {
                if (commentsBycontactsList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (LogEntriesByArticleSuppliers logEntriesByArticleSuppliers in commentsBycontactsList)
                        {

                            if (logEntriesByArticleSuppliers.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {

                                MySqlCommand mySqlCommand = new MySqlCommand("SRM_Insert_Comment_by_Contacts_Insert_V2450", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;

                                mySqlCommand.Parameters.AddWithValue("_IdContact", idcontact);
                                mySqlCommand.Parameters.AddWithValue("_IdUser", logEntriesByArticleSuppliers.IdUser);
                                mySqlCommand.Parameters.AddWithValue("_Datetime", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                                mySqlCommand.Parameters.AddWithValue("_Comments", logEntriesByArticleSuppliers.Comments);
                                mySqlCommand.Parameters.AddWithValue("_IdLogEntryType", 257);
                                mySqlCommand.Parameters.AddWithValue("_IsRtfText", logEntriesByArticleSuppliers.IsRtfText);

                                mySqlCommand.ExecuteNonQuery();
                            }

                            else if (logEntriesByArticleSuppliers.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {

                                MySqlCommand mySqlCommand = new MySqlCommand("SRM_Delete_Comment_by_IdLogEntryByContacts_V2450", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdLogEntryByContact", logEntriesByArticleSuppliers.IdLogEntryByContact);
                                mySqlCommand.ExecuteNonQuery();
                            }

                            //Shubham[skadam] GEOS2-5206 When we update comment updated date not show in grid. 22 01 2024.
                            else if (logEntriesByArticleSuppliers.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("UpdateCommentsByContacts_V2480", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdLogEntryByContact", logEntriesByArticleSuppliers.IdLogEntryByContact);
                                mySqlCommand.Parameters.AddWithValue("_Comments", logEntriesByArticleSuppliers.Comments);
                                mySqlCommand.Parameters.AddWithValue("_Datetime", logEntriesByArticleSuppliers.Datetime);
                                mySqlCommand.ExecuteNonQuery();

                            }

                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeleteCommentsByContacts(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                return false;
            }
            return true;
        }

        //[pramod.misal][GEOS2-5136][22.01.2024]
        public void ArticleSupplierContacts_Insert_V2480(string connectionString, int idContact, Int64 idArticleSupplier)
        {
            TransactionScope transactionScope = null;
            try
            {
                using (transactionScope = new TransactionScope())
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("SRM_ArticleSupplierContacts_Insert;", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdArticleSupplier", idArticleSupplier);
                        mySqlCommand.Parameters.AddWithValue("_IdContact", idContact);
                        mySqlCommand.Parameters.AddWithValue("_IsMainContact", 0);

                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }

                    transactionScope.Complete();
                }
            }
            catch (Exception ex)
            {
                if (Transaction.Current != null)
                    Transaction.Current.Rollback();

                if (transactionScope != null)
                    transactionScope.Dispose();

                Log4NetLogger.Logger.Log(string.Format("Error ArticleSuppliercontacts_Insert(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

        }

        public bool SetIsMainContact_V2480(string connectionString, int idContact, Int64 IdArticleSupplier)
        {
            bool status;
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("SRM_Update_IsMainContact_V2480", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_idContact", idContact);
                    mySqlCommand.Parameters.AddWithValue("_IdArticleSupplier", IdArticleSupplier);
                    mySqlCommand.ExecuteNonQuery();
                    mySqlConnection.Close();
                    status = true;
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error SetIsMainContact(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return status;
        }
        #region GEOS2-5375
        public List<WarehousePurchaseOrder> SendPOMailForSelectedPO_V2500(string connectionString, List<WarehousePurchaseOrder> ListPurchaseOrder_Checked, string purchaseOrdersPath, string emailTemplatePath)
        {
            List<WarehousePurchaseOrder> warehousePurchaseOrderList = new List<WarehousePurchaseOrder>();
            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();
                foreach (var item in ListPurchaseOrder_Checked)
                {
                    MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetPendingPOByIdWarehousePurchaseOrder_V2390", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", item.IdWarehousePurchaseOrder);//9695

                    using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                    {
                        if (mySqlDataReader.Read())
                        {
                            try
                            {
                                WarehousePurchaseOrder warehousePurchaseOrder = new WarehousePurchaseOrder();

                                warehousePurchaseOrder.IdWarehousePurchaseOrder = item.IdWarehousePurchaseOrder;

                                if (mySqlDataReader["Code"] != DBNull.Value)
                                    warehousePurchaseOrder.Code = Convert.ToString(mySqlDataReader["Code"]);

                                if (mySqlDataReader["IdArticleSupplier"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                                    ArticleSupplier articleSupplier = new ArticleSupplier();
                                    articleSupplier.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                                    if (mySqlDataReader["Supplier"] != DBNull.Value)
                                        articleSupplier.Name = Convert.ToString(mySqlDataReader["Supplier"]);

                                    if (mySqlDataReader["SupplierContactPerson"] != DBNull.Value)
                                        articleSupplier.ContactPerson = Convert.ToString(mySqlDataReader["SupplierContactPerson"]);

                                    if (mySqlDataReader["SupplierContactEmail"] != DBNull.Value)
                                        articleSupplier.ContactEmail = Convert.ToString(mySqlDataReader["SupplierContactEmail"]);

                                    if (mySqlDataReader["Serie"] != DBNull.Value)
                                        articleSupplier.Serie = Convert.ToChar(mySqlDataReader["Serie"]);

                                    if (mySqlDataReader["IdCountry"] != DBNull.Value)
                                    {
                                        articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["IdCountry"]);

                                        articleSupplier.Country = new Country();
                                        articleSupplier.Country.IdCountry = (byte)articleSupplier.IdCountry;
                                        articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);

                                        if (mySqlDataReader["IdCountryGroup"] != DBNull.Value)
                                            articleSupplier.Country.IdCountryGroup = Convert.ToInt64(mySqlDataReader["IdCountryGroup"]);

                                        if (mySqlDataReader["SupplierCountryISO"] != DBNull.Value)
                                            articleSupplier.Country.Iso = Convert.ToString(mySqlDataReader["SupplierCountryISO"]);

                                    }

                                    if (mySqlDataReader["IdArticleSupplierType"] != DBNull.Value)
                                    {
                                        articleSupplier.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["IdArticleSupplierType"]);

                                        articleSupplier.ArticleSupplierType = new ArticleSupplierType();
                                        articleSupplier.ArticleSupplierType.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["IdArticleSupplierType"]);
                                        articleSupplier.ArticleSupplierType.Name = Convert.ToString(mySqlDataReader["ArticleSupplierType"]);
                                        articleSupplier.ArticleSupplierType.HtmlColor = Convert.ToString(mySqlDataReader["HtmlColor"]);
                                    }

                                    warehousePurchaseOrder.ArticleSupplier = articleSupplier;
                                }

                                if (mySqlDataReader["DeliveryDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["deliveryDate"]) != DateTime.MinValue)
                                {
                                    warehousePurchaseOrder.DeliveryDate = Convert.ToDateTime(mySqlDataReader["deliveryDate"]);
                                }

                                if (mySqlDataReader["AttachedPO"] != DBNull.Value)
                                    warehousePurchaseOrder.AttachedPO = Convert.ToByte(mySqlDataReader["AttachedPO"]);

                                if (mySqlDataReader["IdPaymentType"] != DBNull.Value)
                                    warehousePurchaseOrder.IdPaymentType = Convert.ToInt64(mySqlDataReader["IdPaymentType"]);

                                if (mySqlDataReader["ReminderEmailDate"] != DBNull.Value)
                                    warehousePurchaseOrder.ReminderEmailDate = Convert.ToDateTime(mySqlDataReader["ReminderEmailDate"]);

                                if (mySqlDataReader["CreatedIn"] != DBNull.Value)
                                    warehousePurchaseOrder.CreatedIn = Convert.ToDateTime(mySqlDataReader["CreatedIn"]);

                                if (mySqlDataReader["ModifiedIn"] != DBNull.Value)
                                    warehousePurchaseOrder.ModifiedIn = Convert.ToDateTime(mySqlDataReader["ModifiedIn"]);

                                if (mySqlDataReader["Comments"] != DBNull.Value)
                                    warehousePurchaseOrder.Comments = Convert.ToString(mySqlDataReader["Comments"]);

                                if (mySqlDataReader["IsClosed"] != DBNull.Value)
                                    warehousePurchaseOrder.IsClosed = Convert.ToByte(mySqlDataReader["IsClosed"]);

                                if (mySqlDataReader["CreatedBy"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.CreatedBy = Convert.ToInt64(mySqlDataReader["CreatedBy"]);
                                    warehousePurchaseOrder.Creator = new People();
                                    warehousePurchaseOrder.Creator.IdPerson = Convert.ToInt32(mySqlDataReader["CreatedBy"].ToString());
                                    warehousePurchaseOrder.Creator.Name = mySqlDataReader["CreatorName"].ToString();
                                    warehousePurchaseOrder.Creator.Surname = mySqlDataReader["CreatorSurname"].ToString();
                                }

                                if (mySqlDataReader["ModifiedBy"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.ModifiedBy = Convert.ToInt64(mySqlDataReader["ModifiedBy"]);
                                    warehousePurchaseOrder.Modifier = new People();
                                    warehousePurchaseOrder.Modifier.IdPerson = Convert.ToInt32(mySqlDataReader["ModifiedBy"].ToString());
                                    warehousePurchaseOrder.Modifier.Name = mySqlDataReader["ModifierName"].ToString();
                                    warehousePurchaseOrder.Modifier.Surname = mySqlDataReader["ModifierSurname"].ToString();
                                }

                                if (mySqlDataReader["ReasonClosed"] != DBNull.Value)
                                    warehousePurchaseOrder.ReasonClosed = Convert.ToString(mySqlDataReader["ReasonClosed"]);

                                if (mySqlDataReader["IdWarehouse"] != DBNull.Value)
                                    warehousePurchaseOrder.IdWarehouse = Convert.ToInt64(mySqlDataReader["IdWarehouse"]);

                                if (mySqlDataReader["IdCurrency"] != DBNull.Value)
                                    warehousePurchaseOrder.IdCurrency = Convert.ToByte(mySqlDataReader["IdCurrency"]);

                                if (mySqlDataReader["IdWorkflowStatus"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                    warehousePurchaseOrder.WorkflowStatus = new WorkflowStatus();
                                    warehousePurchaseOrder.WorkflowStatus.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                    warehousePurchaseOrder.WorkflowStatus.Name = Convert.ToString(mySqlDataReader["Status"]);
                                    warehousePurchaseOrder.WorkflowStatus.HtmlColor = Convert.ToString(mySqlDataReader["StatusHtmlColor"]);
                                }

                                if (mySqlDataReader["IdAssignee"] != DBNull.Value)
                                    warehousePurchaseOrder.IdAssignee = Convert.ToUInt32(mySqlDataReader["IdAssignee"]);

                                if (mySqlDataReader["IdApprover"] != DBNull.Value)
                                    warehousePurchaseOrder.IdApprover = Convert.ToUInt32(mySqlDataReader["IdApprover"]);

                                if (mySqlDataReader["AssigneeEmail"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.AssigneeEmail = Convert.ToString(mySqlDataReader["AssigneeEmail"]);
                                }
                                if (mySqlDataReader["CreatorEmail"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.CreatorEmail = Convert.ToString(mySqlDataReader["CreatorEmail"]);
                                }
                                string HTMLFileName = null;
                                if (File.Exists(string.Format("{0}{1}SupplierPurchaseOrderRequestMailFormat_{2}-{3}.html", emailTemplatePath, @"\", warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower(), warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToUpper())))
                                {
                                    HTMLFileName = string.Format("SupplierPurchaseOrderRequestMailFormat_{0}-{1}.html", warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower(), warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToUpper());
                                }
                                else if (File.Exists(string.Format("{0}{1}SupplierPurchaseOrderRequestMailFormat.html", emailTemplatePath, @"\")))
                                {
                                    HTMLFileName = "SupplierPurchaseOrderRequestMailFormat.html";
                                }
                                if (HTMLFileName != null)
                                {
                                    StringBuilder emailbody = new StringBuilder();
                                    string text = ReadMailTemplate(HTMLFileName, emailTemplatePath);

                                    if (string.IsNullOrEmpty(warehousePurchaseOrder.ArticleSupplier.ContactPerson))
                                    {
                                        text = text.Replace("[Supplier_Name]", "Supplier");
                                    }
                                    else
                                    {
                                        text = text.Replace("[Supplier_Name]", warehousePurchaseOrder.ArticleSupplier.ContactPerson);
                                    }
                                    text = text.Replace("[PO_Code]", warehousePurchaseOrder.Code);


                                    #region 1 rajashri GEOS2-5375 && GEOS2-5376
                                    #region  rajashri GEOS2-5375    
                                    string concatenatedValues = string.Empty;
                                    List<WarehousePurchaseOrder> WarehousePurchaseOrder1;
                                    if (warehousePurchaseOrder.DeliveryDate != null)
                                    {
                                        WarehousePurchaseOrder1 = GetWarehouseHolidays(connectionString, warehousePurchaseOrder.DeliveryDate, warehousePurchaseOrder.IdWarehouse, warehousePurchaseOrder.IdWarehousePurchaseOrder);
                                    }
                                    else
                                    {
                                        WarehousePurchaseOrder1 = new List<WarehousePurchaseOrder>();
                                    }
                                    if (WarehousePurchaseOrder1 != null && WarehousePurchaseOrder1.Count > 0)
                                    {
                                        CultureInfo cultureInfo = CultureInfo.CurrentCulture;

                                        var holidays = WarehousePurchaseOrder1.Select(h => new
                                        {
                                            StartDate = h.WarehouseHolidayStartdate?.Date.ToString("d", cultureInfo),
                                            EndDate = h.WarehouseHolidayEndDate?.Date.ToString("d", cultureInfo),
                                            Type = h.Holidaytype
                                        }).ToList();

                                        // var holidays = WarehousePurchaseOrder1.Select(h => new { StartDate = h.WarehouseHolidayStartdate?.Date, EndDate = h.WarehouseHolidayEndDate?.Date, Type = h.Holidaytype }).ToList();
                                        if (holidays.Count == 1)
                                        {
                                            var holiday = holidays.First();
                                            concatenatedValues = $"<tr style=\"margin-top:5px\">" +
                                                                $"<td colspan=\"2\" style=\"background: white; font-weight: 700; border-top: 4px solid grey; Padding:5px\">" +
                                                                $"</tr>" +
                                                                $"<tr style=\"margin-top:5px\">" +
                                                                $"<td colspan=\"2\" style=\"background: #d1d8db; color: black; font-weight: 700; border-top: 4px solid grey; Padding:20px\">";
                                            if (warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower() == "es")
                                            {
                                                concatenatedValues += $"Tenga en cuenta que el almacén({WarehousePurchaseOrder1.FirstOrDefault()?.Name}) estará cerrado el ";
                                                if (holiday.StartDate == holiday.EndDate)
                                                {
                                                    concatenatedValues += $"{holiday.StartDate} debido a un día festivo \"{holiday.Type}\"";
                                                }
                                                else
                                                {
                                                    concatenatedValues += $"{holiday.StartDate},{holiday.EndDate} debido a un día festivo \"{holiday.Type}\"";
                                                }
                                            }
                                            else
                                            {
                                                concatenatedValues += $"Please be Informed that warehouse({WarehousePurchaseOrder1.FirstOrDefault()?.Name}) will be closed on ";

                                                if (holiday.StartDate == holiday.EndDate)
                                                {
                                                    concatenatedValues += $"{holiday.StartDate} due to \"{holiday.Type}\" holiday";
                                                }
                                                else
                                                {
                                                    concatenatedValues += $"{holiday.StartDate},{holiday.EndDate} due to \"{holiday.Type}\" holiday";
                                                }
                                            }

                                            concatenatedValues += $"</td></tr>";

                                        }
                                        else
                                        {

                                            //var groupesHolidays = holidays.GroupBy(h => h.Type).Select(g => new {
                                            //    Type = g.Key,
                                            //    Dates = g.Select(h =>
                                            //    {
                                            //        if (h.StartDate == h.EndDate)
                                            //        {
                                            //            return h.StartDate?.ToShortDateString();
                                            //        }
                                            //        else if(
                                            //        {
                                            //            return $"{h.StartDate?.ToShortDateString()} , {h.EndDate?.ToShortDateString()}";
                                            //        }
                                            //    }).ToList()
                                            //});

                                            var groupesHolidays = holidays.GroupBy(h => h.Type).Select(g => new
                                            {
                                                Type = g.Key,
                                                Dates = g.Select(h =>
                                                {
                                                    if (h.StartDate == h.EndDate)
                                                    {
                                                        return h.StartDate;
                                                    }
                                                    else if (h.StartDate != null && h.EndDate != null)
                                                    {
                                                        return $"{h.StartDate} , {h.EndDate}";
                                                    }
                                                    else if (h.StartDate != null)
                                                    {
                                                        return h.StartDate;
                                                    }
                                                    else if (h.EndDate != null)
                                                    {
                                                        return h.EndDate;
                                                    }
                                                    else
                                                    {
                                                        return ""; // Handle case where both StartDate and EndDate are null
                                                    }
                                                }).ToList()
                                            });


                                            concatenatedValues = $"<tr style=\"margin-top:5px\">" +
                                             $"<td colspan=\"2\" style=\"background: white; font-weight: 700; border-top: 4px solid grey; Padding:5px\">";
                                            int groupCount = groupesHolidays.Count();
                                            if (groupCount > 0)
                                            {
                                                if (warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower() == "es")
                                                {
                                                    concatenatedValues += $"Tenga en cuenta que el almacén({WarehousePurchaseOrder1.FirstOrDefault()?.Name}) estará cerrado ";
                                                }
                                                else
                                                {
                                                    concatenatedValues += $"Please be Informed that warehouse({WarehousePurchaseOrder1.FirstOrDefault()?.Name}) will be closed  ";
                                                }
                                            }

                                            int currentIndex = 0;

                                            foreach (var group in groupesHolidays)
                                            {

                                                if (warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower() == "es")
                                                {
                                                    concatenatedValues += $" en  {string.Join(", ", group.Dates)} debido a un día festivo  \"{group.Type}\"";
                                                    if (currentIndex < groupCount - 1)
                                                    {
                                                        concatenatedValues += " Y ";
                                                    }
                                                }
                                                else
                                                {
                                                    concatenatedValues += $" on  {string.Join(", ", group.Dates)} due to \"{group.Type}\" holiday";
                                                    if (currentIndex < groupCount - 1)
                                                    {
                                                        concatenatedValues += (currentIndex % 2 == 0) ? ", " : " and ";
                                                    }
                                                }
                                                currentIndex++;
                                            }


                                            concatenatedValues += $"</td></tr>";

                                        }
                                        text = text.Replace("[footerdata]", concatenatedValues);
                                    }
                                    #endregion
                                    #region GEOS-5376
                                    else
                                    {

                                        #region CustomMessageFooter

                                        List<Warehouses> customHoliday = GetCustomMessageforHoliday_PORequestMail_V2500(connectionString, warehousePurchaseOrder.IdWarehouse);
                                        if (customHoliday != null && customHoliday.Count > 0)
                                        {
                                            var customMessages = string.Join(", ", customHoliday.Select(h => h.CustomMessage));
                                            var customStartDate = string.Join(", ", customHoliday.Select(h => h.ImportantNoticeStartDate?.Date.ToShortDateString()));
                                            var customEndDate = string.Join(", ", customHoliday.Select(h => h.ImportantNoticeEndDate?.Date.ToShortDateString()));

                                            CultureInfo cultureInfo = CultureInfo.CurrentCulture;
                                            customStartDate = customStartDate.ToString(cultureInfo);
                                            customEndDate = customEndDate.ToString(cultureInfo);


                                            if (!string.IsNullOrEmpty(customStartDate) && string.IsNullOrEmpty(customEndDate))
                                            {
                                                concatenatedValues = $"<tr style=\"margin-top:5px\">" +
                                                                      $"<td colspan=\"2\" style=\"background: white;  font-weight: 700; border-top: 4px solid grey;Padding:5px \">" +
                                                                      $"</tr>" +
                                                                      $"<tr style=\"margin-top:5px\">" +
                                                                      $"<td colspan=\"2\" style=\"background: #d1d8db; color: black; font-weight: 700; border-top: 4px solid grey;Padding:20px \">" +
                                                                      $"{customMessages} from " +
                                                                      $"\"{customStartDate}\"" + "</td>" +
                                                                      $"</tr>";
                                            }
                                            else if (string.IsNullOrEmpty(customStartDate) && !string.IsNullOrEmpty(customEndDate))
                                            {
                                                concatenatedValues = $"<tr style=\"margin-top:5px\">" +
                                                                      $"<td colspan=\"2\" style=\"background: white;  font-weight: 700; border-top: 4px solid grey;Padding:5px \">" +
                                                                      $"</tr>" +
                                                                      $"<tr style=\"margin-top:5px\">" +
                                                                      $"<td colspan=\"2\" style=\"background: #d1d8db; color: black; font-weight: 700; border-top: 4px solid grey;Padding:20px \">" +
                                                                      $"{customMessages} " +
                                                                      $" till " +
                                                                      $"\"{customEndDate}\"" + "</td>" +
                                                                      $"</tr>";
                                            }
                                            else if (!string.IsNullOrEmpty(customStartDate) && !string.IsNullOrEmpty(customEndDate))
                                            {
                                                concatenatedValues = $"<tr style=\"margin-top:5px\">" +
                                                                      $"<td colspan=\"2\" style=\"background: white;  font-weight: 700; border-top: 4px solid grey;Padding:5px \">" +
                                                                      $"</tr>" +
                                                                      $"<tr style=\"margin-top:5px\">" +
                                                                      $"<td colspan=\"2\" style=\"background: #d1d8db; color: black; font-weight: 700; border-top: 4px solid grey;Padding:20px \">" +
                                                                      $"{customMessages} from " +
                                                                      $"\"{customStartDate}\"" + " to " +
                                                                      $"\"{customEndDate}\"" + "</td>" +
                                                                      $"</tr>";
                                            }

                                            else
                                            {
                                                concatenatedValues = $"<tr style=\"margin-top:5px\">" +
                                                                     $"<td colspan=\"2\" style=\"background: white;  font-weight: 700; border-top: 4px solid grey;Padding:5px \">" +
                                                                     $"</tr>" +
                                                                     $"<tr style=\"margin-top:5px\">" +
                                                                     $"<td colspan=\"2\" style=\"background: #d1d8db; color: black; font-weight: 700; border-top: 4px solid grey;Padding:20px \">" +
                                                                     $"{customMessages}</td>" +
                                                                     $"</tr>";
                                            }

                                        }
                                        else
                                        {
                                            concatenatedValues = string.Empty;
                                        }
                                        text = text.Replace("[footerdata]", concatenatedValues);
                                        #endregion
                                    }
                                    #endregion

                                    #endregion
                                    emailbody.Append(text);

                                    warehousePurchaseOrder.EmailBody = emailbody.ToString();
                                }

                                warehousePurchaseOrder.AttachPdf = warehousePurchaseOrder.CreatedIn.Year + @"\" + warehousePurchaseOrder.Code + @"\01 Purchase Order\PO_" + warehousePurchaseOrder.Code + ".pdf";

                                warehousePurchaseOrder.AttachmentBytes = GetPurchaseOrderPdf(purchaseOrdersPath, warehousePurchaseOrder.AttachPdf);
                                warehousePurchaseOrderList.Add(warehousePurchaseOrder);

                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetPendingPOByIdWarehousePurchaseOrder_V2380(idWarehousePurchaseOrder-{0}), ErrorMessage- {1} ", item.IdWarehousePurchaseOrder, ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }

                        }
                    }
                }
            }

            return warehousePurchaseOrderList;
        }

        public List<WarehousePurchaseOrder> GetWarehouseHolidays(string connectionString, DateTime? deliverydate, long? idWarehouse, long IdWarehousePurchaseOrder)
        {
            WarehousePurchaseOrder warehousePurchaseOrder = null;
            List<WarehousePurchaseOrder> warehouseHolidays = new List<WarehousePurchaseOrder>();
            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetPORequestMailWarehouseHolidays", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("Deliverydate", deliverydate.Value.Date);
                mySqlCommand.Parameters.AddWithValue("_IdWarehouse", idWarehouse);
                mySqlCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", IdWarehousePurchaseOrder);

                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    while (mySqlDataReader.Read())
                    {
                        try
                        {
                            warehousePurchaseOrder = new WarehousePurchaseOrder();

                            warehousePurchaseOrder.IdWarehouse = idWarehouse;

                            if (mySqlDataReader["IdWarehouse"] != DBNull.Value)
                                warehousePurchaseOrder.IdWarehouse = Convert.ToInt32(mySqlDataReader["IdWarehouse"]);

                            if (mySqlDataReader["DeliveryDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["deliveryDate"]) != DateTime.MinValue)
                            {
                                warehousePurchaseOrder.DeliveryDate = Convert.ToDateTime(mySqlDataReader["deliveryDate"]);
                            }
                            if (mySqlDataReader["WarehouseHolidayStartdate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["WarehouseHolidayStartdate"]) != DateTime.MinValue)
                            {
                                warehousePurchaseOrder.WarehouseHolidayStartdate = Convert.ToDateTime(mySqlDataReader["WarehouseHolidayStartdate"]);
                            }
                            if (mySqlDataReader["WarehouseHolidayEndDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["WarehouseHolidayEndDate"]) != DateTime.MinValue)
                            {
                                warehousePurchaseOrder.WarehouseHolidayEndDate = Convert.ToDateTime(mySqlDataReader["WarehouseHolidayEndDate"]);
                            }

                            if (mySqlDataReader["Value"] != DBNull.Value)
                                warehousePurchaseOrder.Holidaytype = Convert.ToString(mySqlDataReader["Value"]);

                            if (mySqlDataReader["Code"] != DBNull.Value)
                                warehousePurchaseOrder.Code = Convert.ToString(mySqlDataReader["Code"]);
                            if (mySqlDataReader["Name"] != DBNull.Value)
                                warehousePurchaseOrder.Name = Convert.ToString(mySqlDataReader["Name"]);
                            warehouseHolidays.Add(warehousePurchaseOrder);

                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetWarehouseHolidays_V2500(idWarehousePurchaseOrder-{0}), ErrorMessage- {1} ", idWarehouse, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            Log4NetLogger.Logger.Log("Executed GetWarehouseHolidays_V2500().", category: Category.Info, priority: Priority.Low);
            return warehouseHolidays;
        }
        #endregion

        #region rajashri   // GEOS2-5376

        public List<Warehouses> GetCustomMessageforHoliday_V2500(string connectionString)
        {
            List<Warehouses> warehouseMessage = new List<Warehouses>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetCustomMessageHolidayForWarehouse_V2500", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {

                    while (mySqlDataReader.Read())
                    {
                        try
                        {
                            Warehouses warehousePurchaseOrder = new Warehouses();

                            if (mySqlDataReader["IdWarehouse"] != DBNull.Value)
                                warehousePurchaseOrder.IdWarehouse = Convert.ToInt32(mySqlDataReader["IdWarehouse"]);

                            if (mySqlDataReader["ImportantNoticeStartDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["ImportantNoticeStartDate"]) != DateTime.MinValue)
                            {
                                warehousePurchaseOrder.ImportantNoticeStartDate = Convert.ToDateTime(mySqlDataReader["ImportantNoticeStartDate"]);
                            }
                            if (mySqlDataReader["ImportantNoticeEndDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["ImportantNoticeEndDate"]) != DateTime.MinValue)
                            {
                                warehousePurchaseOrder.ImportantNoticeEndDate = Convert.ToDateTime(mySqlDataReader["ImportantNoticeEndDate"]);
                            }

                            if (mySqlDataReader["ImportantNoticeMessage"] != DBNull.Value)
                                warehousePurchaseOrder.CustomMessage = Convert.ToString(mySqlDataReader["ImportantNoticeMessage"]);
                            if (mySqlDataReader["Name"] != DBNull.Value)
                                warehousePurchaseOrder.Name = Convert.ToString(mySqlDataReader["Name"]);

                            if (mySqlDataReader["IsImportantNoticeEnabled"] != DBNull.Value)
                                warehousePurchaseOrder.IsImportantNoticeEnabled = Convert.ToBoolean(mySqlDataReader["IsImportantNoticeEnabled"]);

                            warehouseMessage.Add(warehousePurchaseOrder);

                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetCustomMessageforHoliday_V2500() ", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            return warehouseMessage;
        }
        public List<Warehouses> GetCustomMessageforHoliday_PORequestMail_V2500(string connectionString, long? idWarehouse)
        {
            List<Warehouses> warehouseMessage = new List<Warehouses>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetCustomMessageHoliday_PORequestMail_V2500", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdWarehouse", idWarehouse);
                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {

                    while (mySqlDataReader.Read())
                    {
                        try
                        {
                            Warehouses warehousePurchaseOrder = new Warehouses();

                            if (mySqlDataReader["IdWarehouse"] != DBNull.Value)
                                warehousePurchaseOrder.IdWarehouse = Convert.ToInt32(mySqlDataReader["IdWarehouse"]);

                            if (mySqlDataReader["ImportantNoticeStartDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["ImportantNoticeStartDate"]) != DateTime.MinValue)
                            {
                                warehousePurchaseOrder.ImportantNoticeStartDate = Convert.ToDateTime(mySqlDataReader["ImportantNoticeStartDate"]);
                            }
                            if (mySqlDataReader["ImportantNoticeEndDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["ImportantNoticeEndDate"]) != DateTime.MinValue)
                            {
                                warehousePurchaseOrder.ImportantNoticeEndDate = Convert.ToDateTime(mySqlDataReader["ImportantNoticeEndDate"]);
                            }

                            if (mySqlDataReader["ImportantNoticeMessage"] != DBNull.Value)
                                warehousePurchaseOrder.CustomMessage = Convert.ToString(mySqlDataReader["ImportantNoticeMessage"]);
                            if (mySqlDataReader["Name"] != DBNull.Value)
                                warehousePurchaseOrder.Name = Convert.ToString(mySqlDataReader["Name"]);

                            if (mySqlDataReader["IsImportantNoticeEnabled"] != DBNull.Value)
                                warehousePurchaseOrder.IsImportantNoticeEnabled = Convert.ToBoolean(mySqlDataReader["IsImportantNoticeEnabled"]);

                            warehouseMessage.Add(warehousePurchaseOrder);

                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetCustomMessageforHoliday_PORequestMail_V2500(_IdWarehouse-{0}), ErrorMessage- {1} ", idWarehouse, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            return warehouseMessage;
        }
        public bool UpdateCustomMessageForPORequestMail_V2500(string MainServerConnectionString, List<Warehouses> warehouses)
        {
            bool status;
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        foreach (Warehouses warehouse in warehouses)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("SRM_UpdateCustomMessageHolidayForWarehouse_V2500", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;
                            mySqlCommand.Parameters.AddWithValue("_idWarehouse", warehouse.IdWarehouse);
                            mySqlCommand.Parameters.AddWithValue("_IsImportantNoticeEnabled", warehouse.IsImportantNoticeEnabled);
                            mySqlCommand.Parameters.AddWithValue("_ImportantNoticeMessage", warehouse.CustomMessage);
                            mySqlCommand.Parameters.AddWithValue("_ImportantNoticeStartDate", warehouse.ImportantNoticeStartDate);
                            mySqlCommand.Parameters.AddWithValue("_ImportantNoticeEndDate", warehouse.ImportantNoticeEndDate);
                            mySqlCommand.ExecuteNonQuery();
                            mySqlConnection.Close();
                        }
                        status = true;

                    }
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateCustomMessageForPORequestMail_V2500(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }
            return status;
        }
        public WarehousePurchaseOrder GetPendingPOByIdWarehousePurchaseOrder_V2500(string connectionString, Int64 idWarehousePurchaseOrder, string idShippingAddress, string purchaseOrdersPath, string emailTemplatePath, string countryIconFilePath)
        {
            WarehousePurchaseOrder warehousePurchaseOrder = null;

            Country country = new Country();
            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();
                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetPendingPOByIdWarehousePurchaseOrder_V2420", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", idWarehousePurchaseOrder);

                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    if (mySqlDataReader.Read())
                    {
                        try
                        {

                            warehousePurchaseOrder = new WarehousePurchaseOrder();
                            List<WarehouseShippingAddress> warehouseShippingAddresses = new List<WarehouseShippingAddress>();


                            warehousePurchaseOrder.IdWarehousePurchaseOrder = idWarehousePurchaseOrder;

                            if (mySqlDataReader["Code"] != DBNull.Value)
                                warehousePurchaseOrder.Code = Convert.ToString(mySqlDataReader["Code"]);

                            if (mySqlDataReader["IdArticleSupplier"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                                ArticleSupplier articleSupplier = new ArticleSupplier();
                                articleSupplier.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                                if (mySqlDataReader["Supplier"] != DBNull.Value)
                                    articleSupplier.Name = Convert.ToString(mySqlDataReader["Supplier"]);

                                if (mySqlDataReader["SupplierContactPerson"] != DBNull.Value)
                                    articleSupplier.ContactPerson = Convert.ToString(mySqlDataReader["SupplierContactPerson"]);

                                if (mySqlDataReader["SupplierContactEmail"] != DBNull.Value)
                                    articleSupplier.ContactEmail = Convert.ToString(mySqlDataReader["SupplierContactEmail"]);

                                if (mySqlDataReader["Serie"] != DBNull.Value)
                                    articleSupplier.Serie = Convert.ToChar(mySqlDataReader["Serie"]);

                                if (mySqlDataReader["DeliveryDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["DeliveryDate"]) != DateTime.MinValue)
                                {
                                    warehousePurchaseOrder.DeliveryDate = Convert.ToDateTime(mySqlDataReader["DeliveryDate"]);
                                }
                                if (mySqlDataReader["IdCountry"] != DBNull.Value)
                                {
                                    articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["IdCountry"]);

                                    articleSupplier.Country = new Country();
                                    articleSupplier.Country.IdCountry = (byte)articleSupplier.IdCountry;
                                    articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);

                                    if (mySqlDataReader["SupplierCountryISO"] != DBNull.Value)
                                    {
                                        articleSupplier.Country.Iso = Convert.ToString(mySqlDataReader["SupplierCountryISO"]);
                                        byte[] bytes = null;
                                        bytes = GetCountryIconFileInBytes(articleSupplier.Country.Iso, countryIconFilePath);
                                        articleSupplier.Country.CountryIconBytes = bytes;
                                    }

                                    if (mySqlDataReader["IdCountryGroup"] != DBNull.Value)
                                        articleSupplier.Country.IdCountryGroup = Convert.ToInt64(mySqlDataReader["IdCountryGroup"]);
                                }

                                if (mySqlDataReader["IdArticleSupplierType"] != DBNull.Value)
                                {
                                    articleSupplier.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["IdArticleSupplierType"]);

                                    articleSupplier.ArticleSupplierType = new ArticleSupplierType();
                                    articleSupplier.ArticleSupplierType.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["IdArticleSupplierType"]);
                                    articleSupplier.ArticleSupplierType.Name = Convert.ToString(mySqlDataReader["ArticleSupplierType"]);
                                    articleSupplier.ArticleSupplierType.HtmlColor = Convert.ToString(mySqlDataReader["HtmlColor"]);
                                }

                                warehousePurchaseOrder.ArticleSupplier = articleSupplier;
                            }
                            //[rdixit][GEOS2-4455][28.06.2023] 
                            //if (mySqlDataReader["DeliveryDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["deliveryDate"]) != DateTime.MinValue)
                            //{
                            //    warehousePurchaseOrder.DeliveryDate = Convert.ToDateTime(mySqlDataReader["deliveryDate"]);
                            //}

                            if (mySqlDataReader["AttachedPO"] != DBNull.Value)
                                warehousePurchaseOrder.AttachedPO = Convert.ToByte(mySqlDataReader["AttachedPO"]);

                            if (mySqlDataReader["IdPaymentType"] != DBNull.Value)
                                warehousePurchaseOrder.IdPaymentType = Convert.ToInt64(mySqlDataReader["IdPaymentType"]);

                            if (mySqlDataReader["ReminderEmailDate"] != DBNull.Value)
                                warehousePurchaseOrder.ReminderEmailDate = Convert.ToDateTime(mySqlDataReader["ReminderEmailDate"]);

                            if (mySqlDataReader["CreatedIn"] != DBNull.Value)
                                warehousePurchaseOrder.CreatedIn = Convert.ToDateTime(mySqlDataReader["CreatedIn"]);

                            if (mySqlDataReader["ModifiedIn"] != DBNull.Value)
                                warehousePurchaseOrder.ModifiedIn = Convert.ToDateTime(mySqlDataReader["ModifiedIn"]);

                            if (mySqlDataReader["Comments"] != DBNull.Value)
                                warehousePurchaseOrder.Comments = Convert.ToString(mySqlDataReader["Comments"]);

                            //[pramod.misal][GEOS2-4449][04-06-2023]warehouseShippingAddress
                            if (mySqlDataReader["Observations"] != DBNull.Value)
                                warehousePurchaseOrder.SupplierComments = Convert.ToString(mySqlDataReader["Observations"]);

                            if (mySqlDataReader["IsClosed"] != DBNull.Value)
                                warehousePurchaseOrder.IsClosed = Convert.ToByte(mySqlDataReader["IsClosed"]);

                            if (mySqlDataReader["CreatedBy"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.CreatedBy = Convert.ToInt64(mySqlDataReader["CreatedBy"]);
                                warehousePurchaseOrder.Creator = new People();
                                warehousePurchaseOrder.Creator.IdPerson = Convert.ToInt32(mySqlDataReader["CreatedBy"].ToString());
                                warehousePurchaseOrder.Creator.Name = mySqlDataReader["CreatorName"].ToString();
                                warehousePurchaseOrder.Creator.Surname = mySqlDataReader["CreatorSurname"].ToString();
                            }

                            if (mySqlDataReader["ModifiedBy"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.ModifiedBy = Convert.ToInt64(mySqlDataReader["ModifiedBy"]);
                                warehousePurchaseOrder.Modifier = new People();
                                warehousePurchaseOrder.Modifier.IdPerson = Convert.ToInt32(mySqlDataReader["ModifiedBy"].ToString());
                                warehousePurchaseOrder.Modifier.Name = mySqlDataReader["ModifierName"].ToString();
                                warehousePurchaseOrder.Modifier.Surname = mySqlDataReader["ModifierSurname"].ToString();
                            }

                            if (mySqlDataReader["ReasonClosed"] != DBNull.Value)
                                warehousePurchaseOrder.ReasonClosed = Convert.ToString(mySqlDataReader["ReasonClosed"]);

                            if (mySqlDataReader["IdWarehouse"] != DBNull.Value)
                                warehousePurchaseOrder.IdWarehouse = Convert.ToInt64(mySqlDataReader["IdWarehouse"]);

                            if (mySqlDataReader["IdShippingAddress"] != DBNull.Value)
                                warehousePurchaseOrder.IdShippingAddress = Convert.ToInt64(mySqlDataReader["IdShippingAddress"]);

                            if (mySqlDataReader["IdCurrency"] != DBNull.Value)
                                warehousePurchaseOrder.IdCurrency = Convert.ToByte(mySqlDataReader["IdCurrency"]);

                            if (mySqlDataReader["IdWorkflowStatus"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                warehousePurchaseOrder.WorkflowStatus = new WorkflowStatus();
                                warehousePurchaseOrder.WorkflowStatus.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                warehousePurchaseOrder.WorkflowStatus.Name = Convert.ToString(mySqlDataReader["Status"]);
                                warehousePurchaseOrder.WorkflowStatus.HtmlColor = Convert.ToString(mySqlDataReader["StatusHtmlColor"]);
                            }

                            if (mySqlDataReader["IdAssignee"] != DBNull.Value)
                                warehousePurchaseOrder.IdAssignee = Convert.ToUInt32(mySqlDataReader["IdAssignee"]);

                            if (mySqlDataReader["IdApprover"] != DBNull.Value)
                                warehousePurchaseOrder.IdApprover = Convert.ToUInt32(mySqlDataReader["IdApprover"]);

                            if (mySqlDataReader["AssigneeEmail"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.AssigneeEmail = Convert.ToString(mySqlDataReader["AssigneeEmail"]);
                            }
                            if (mySqlDataReader["CreatorEmail"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.CreatorEmail = Convert.ToString(mySqlDataReader["CreatorEmail"]);
                            }

                            string HTMLFileName = null;
                            if (File.Exists(string.Format("{0}{1}SupplierPurchaseOrderRequestMailFormat_{2}-{3}.html", emailTemplatePath, @"\", warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower(), warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToUpper())))
                            {
                                HTMLFileName = string.Format("SupplierPurchaseOrderRequestMailFormat_{0}-{1}.html", warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower(), warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToUpper());
                            }
                            else if (File.Exists(string.Format("{0}{1}SupplierPurchaseOrderRequestMailFormat.html", emailTemplatePath, @"\")))
                            {
                                HTMLFileName = "SupplierPurchaseOrderRequestMailFormat.html";
                            }
                            if (HTMLFileName != null)
                            {
                                StringBuilder emailbody = new StringBuilder();
                                string text = ReadMailTemplate(HTMLFileName, emailTemplatePath);

                                if (string.IsNullOrEmpty(warehousePurchaseOrder.ArticleSupplier.ContactPerson))
                                {
                                    text = text.Replace("[Supplier_Name]", "Supplier");
                                }
                                else
                                {
                                    text = text.Replace("[Supplier_Name]", warehousePurchaseOrder.ArticleSupplier.ContactPerson);
                                }
                                text = text.Replace("[PO_Code]", warehousePurchaseOrder.Code);

                                #region 2 rajashri GEOS2-5375 && GEOS2-5376
                                #region  rajashri GEOS2-5375    
                                string concatenatedValues = string.Empty;
                                List<WarehousePurchaseOrder> WarehousePurchaseOrder1;
                                if (warehousePurchaseOrder.DeliveryDate != null)
                                {
                                    WarehousePurchaseOrder1 = GetWarehouseHolidays(connectionString, warehousePurchaseOrder.DeliveryDate, warehousePurchaseOrder.IdWarehouse, warehousePurchaseOrder.IdWarehousePurchaseOrder);
                                }
                                else
                                {
                                    WarehousePurchaseOrder1 = new List<WarehousePurchaseOrder>();
                                }
                                if (WarehousePurchaseOrder1 != null && WarehousePurchaseOrder1.Count > 0)
                                {
                                    CultureInfo cultureInfo = CultureInfo.CurrentCulture;

                                    var holidays = WarehousePurchaseOrder1.Select(h => new
                                    {
                                        StartDate = h.WarehouseHolidayStartdate?.Date.ToString("d", cultureInfo),
                                        EndDate = h.WarehouseHolidayEndDate?.Date.ToString("d", cultureInfo),
                                        Type = h.Holidaytype
                                    }).ToList();

                                    // var holidays = WarehousePurchaseOrder1.Select(h => new { StartDate = h.WarehouseHolidayStartdate?.Date, EndDate = h.WarehouseHolidayEndDate?.Date, Type = h.Holidaytype }).ToList();
                                    if (holidays.Count == 1)
                                    {
                                        var holiday = holidays.First();
                                        concatenatedValues = $"<tr style=\"margin-top:5px\">" +
                                                            $"<td colspan=\"2\" style=\"background: white; font-weight: 700; border-top: 4px solid grey; Padding:5px\">" +
                                                            $"</tr>" +
                                                            $"<tr style=\"margin-top:5px\">" +
                                                            $"<td colspan=\"2\" style=\"background: #d1d8db; color: black; font-weight: 700; border-top: 4px solid grey; Padding:20px\">";
                                        if (warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower() == "es")
                                        {
                                            concatenatedValues += $"Tenga en cuenta que el almacén({WarehousePurchaseOrder1.FirstOrDefault()?.Name}) estará cerrado el ";
                                            if (holiday.StartDate == holiday.EndDate)
                                            {
                                                concatenatedValues += $"{holiday.StartDate} debido a un día festivo \"{holiday.Type}\"";
                                            }
                                            else
                                            {
                                                concatenatedValues += $"{holiday.StartDate},{holiday.EndDate} debido a un día festivo \"{holiday.Type}\"";
                                            }
                                        }
                                        else
                                        {
                                            concatenatedValues += $"Please be Informed that warehouse({WarehousePurchaseOrder1.FirstOrDefault()?.Name}) will be closed on ";

                                            if (holiday.StartDate == holiday.EndDate)
                                            {
                                                concatenatedValues += $"{holiday.StartDate} due to \"{holiday.Type}\" holiday";
                                            }
                                            else
                                            {
                                                concatenatedValues += $"{holiday.StartDate},{holiday.EndDate} due to \"{holiday.Type}\" holiday";
                                            }
                                        }

                                        concatenatedValues += $"</td></tr>";

                                    }
                                    else
                                    {

                                        //var groupesHolidays = holidays.GroupBy(h => h.Type).Select(g => new {
                                        //    Type = g.Key,
                                        //    Dates = g.Select(h =>
                                        //    {
                                        //        if (h.StartDate == h.EndDate)
                                        //        {
                                        //            return h.StartDate?.ToShortDateString();
                                        //        }
                                        //        else if(
                                        //        {
                                        //            return $"{h.StartDate?.ToShortDateString()} , {h.EndDate?.ToShortDateString()}";
                                        //        }
                                        //    }).ToList()
                                        //});

                                        var groupesHolidays = holidays.GroupBy(h => h.Type).Select(g => new
                                        {
                                            Type = g.Key,
                                            Dates = g.Select(h =>
                                            {
                                                if (h.StartDate == h.EndDate)
                                                {
                                                    return h.StartDate;
                                                }
                                                else if (h.StartDate != null && h.EndDate != null)
                                                {
                                                    return $"{h.StartDate} , {h.EndDate}";
                                                }
                                                else if (h.StartDate != null)
                                                {
                                                    return h.StartDate;
                                                }
                                                else if (h.EndDate != null)
                                                {
                                                    return h.EndDate;
                                                }
                                                else
                                                {
                                                    return ""; // Handle case where both StartDate and EndDate are null
                                                }
                                            }).ToList()
                                        });


                                        concatenatedValues = $"<tr style=\"margin-top:5px\">" +
                                         $"<td colspan=\"2\" style=\"background: white; font-weight: 700; border-top: 4px solid grey; Padding:5px\">";
                                        int groupCount = groupesHolidays.Count();
                                        if (groupCount > 0)
                                        {
                                            if (warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower() == "es")
                                            {
                                                concatenatedValues += $"Tenga en cuenta que el almacén({WarehousePurchaseOrder1.FirstOrDefault()?.Name}) estará cerrado ";
                                            }
                                            else
                                            {
                                                concatenatedValues += $"Please be Informed that warehouse({WarehousePurchaseOrder1.FirstOrDefault()?.Name}) will be closed  ";
                                            }
                                        }

                                        int currentIndex = 0;

                                        foreach (var group in groupesHolidays)
                                        {

                                            if (warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower() == "es")
                                            {
                                                concatenatedValues += $" en  {string.Join(", ", group.Dates)} debido a un día festivo  \"{group.Type}\"";
                                                if (currentIndex < groupCount - 1)
                                                {
                                                    concatenatedValues += " Y ";
                                                }
                                            }
                                            else
                                            {
                                                concatenatedValues += $" on  {string.Join(", ", group.Dates)} due to \"{group.Type}\" holiday";
                                                if (currentIndex < groupCount - 1)
                                                {
                                                    concatenatedValues += (currentIndex % 2 == 0) ? ", " : " and ";
                                                }
                                            }
                                            currentIndex++;
                                        }


                                        concatenatedValues += $"</td></tr>";

                                    }
                                    text = text.Replace("[footerdata]", concatenatedValues);
                                }
                                #endregion
                                #region GEOS-5376
                                else
                                {

                                    #region CustomMessageFooter

                                    List<Warehouses> customHoliday = GetCustomMessageforHoliday_PORequestMail_V2500(connectionString, warehousePurchaseOrder.IdWarehouse);
                                    if (customHoliday != null && customHoliday.Count > 0)
                                    {
                                        var customMessages = string.Join(", ", customHoliday.Select(h => h.CustomMessage));
                                        var customStartDate = string.Join(", ", customHoliday.Select(h => h.ImportantNoticeStartDate?.Date.ToShortDateString()));
                                        var customEndDate = string.Join(", ", customHoliday.Select(h => h.ImportantNoticeEndDate?.Date.ToShortDateString()));

                                        CultureInfo cultureInfo = CultureInfo.CurrentCulture;
                                        customStartDate = customStartDate.ToString(cultureInfo);
                                        customEndDate = customEndDate.ToString(cultureInfo);


                                        if (!string.IsNullOrEmpty(customStartDate) && string.IsNullOrEmpty(customEndDate))
                                        {
                                            concatenatedValues = $"<tr style=\"margin-top:5px\">" +
                                                                  $"<td colspan=\"2\" style=\"background: white;  font-weight: 700; border-top: 4px solid grey;Padding:5px \">" +
                                                                  $"</tr>" +
                                                                  $"<tr style=\"margin-top:5px\">" +
                                                                  $"<td colspan=\"2\" style=\"background: #d1d8db; color: black; font-weight: 700; border-top: 4px solid grey;Padding:20px \">" +
                                                                  $"{customMessages} from " +
                                                                  $"\"{customStartDate}\"" + "</td>" +
                                                                  $"</tr>";
                                        }
                                        else if (string.IsNullOrEmpty(customStartDate) && !string.IsNullOrEmpty(customEndDate))
                                        {
                                            concatenatedValues = $"<tr style=\"margin-top:5px\">" +
                                                                  $"<td colspan=\"2\" style=\"background: white;  font-weight: 700; border-top: 4px solid grey;Padding:5px \">" +
                                                                  $"</tr>" +
                                                                  $"<tr style=\"margin-top:5px\">" +
                                                                  $"<td colspan=\"2\" style=\"background: #d1d8db; color: black; font-weight: 700; border-top: 4px solid grey;Padding:20px \">" +
                                                                  $"{customMessages} " +
                                                                  $" till " +
                                                                  $"\"{customEndDate}\"" + "</td>" +
                                                                  $"</tr>";
                                        }
                                        else if (!string.IsNullOrEmpty(customStartDate) && !string.IsNullOrEmpty(customEndDate))
                                        {
                                            concatenatedValues = $"<tr style=\"margin-top:5px\">" +
                                                                  $"<td colspan=\"2\" style=\"background: white;  font-weight: 700; border-top: 4px solid grey;Padding:5px \">" +
                                                                  $"</tr>" +
                                                                  $"<tr style=\"margin-top:5px\">" +
                                                                  $"<td colspan=\"2\" style=\"background: #d1d8db; color: black; font-weight: 700; border-top: 4px solid grey;Padding:20px \">" +
                                                                  $"{customMessages} from " +
                                                                  $"\"{customStartDate}\"" + " to " +
                                                                  $"\"{customEndDate}\"" + "</td>" +
                                                                  $"</tr>";
                                        }

                                        else
                                        {
                                            concatenatedValues = $"<tr style=\"margin-top:5px\">" +
                                                                 $"<td colspan=\"2\" style=\"background: white;  font-weight: 700; border-top: 4px solid grey;Padding:5px \">" +
                                                                 $"</tr>" +
                                                                 $"<tr style=\"margin-top:5px\">" +
                                                                 $"<td colspan=\"2\" style=\"background: #d1d8db; color: black; font-weight: 700; border-top: 4px solid grey;Padding:20px \">" +
                                                                 $"{customMessages}</td>" +
                                                                 $"</tr>";
                                        }

                                    }
                                    else
                                    {
                                        concatenatedValues = string.Empty;
                                    }
                                    text = text.Replace("[footerdata]", concatenatedValues);
                                    #endregion
                                }
                                #endregion

                                #endregion
                                emailbody.Append(text);

                                warehousePurchaseOrder.EmailBody = emailbody.ToString();
                            }
                            warehousePurchaseOrder.AttachPdf = warehousePurchaseOrder.CreatedIn.Year + @"\" + warehousePurchaseOrder.Code + @"\01 Purchase Order\PO_" + warehousePurchaseOrder.Code + ".pdf";

                            warehousePurchaseOrder.AttachmentBytes = GetPurchaseOrderPdf(purchaseOrdersPath, warehousePurchaseOrder.AttachPdf);
                            warehousePurchaseOrder.WarehouseDeliveryNotes = GetDeliveryNotesByIdWarehousePurchaseOrder(connectionString, warehousePurchaseOrder, purchaseOrdersPath);


                            // [pramod.misal][GEOS2-4951][05-07-2023]

                            warehousePurchaseOrder.WarehouseShippingAddress = GetShippingAddressByIdShippingAddress_V2420(connectionString, warehousePurchaseOrder, idShippingAddress);
                            // [rdixit][GEOS2-4822][13-09-2023]
                            // [rdixit][GEOS2-4589][09-10-2023]
                            warehousePurchaseOrder.WarehousePurchaseOrderItemWithComments = GetArticlesByIdWarehousePurchaseOrder_V2460(connectionString, warehousePurchaseOrder.IdWarehousePurchaseOrder);
                            //warehousePurchaseOrder.WarehousePOComments = GetlogEntriesByWarehousePO_V2400(idWarehousePurchaseOrder, 252, connectionString);
                            //warehousePurchaseOrder.WarehousePOLogEntries = GetlogEntriesByWarehousePO_V2400(idWarehousePurchaseOrder, 253, connectionString);
                            //[pramod.misal][GEOS2-4451][08-08-2023]  logEntriesByWarehousePO.IdEntryType
                            warehousePurchaseOrder.WarehousePOComments = GetlogEntriesByWarehousePO_V2420(idWarehousePurchaseOrder, 257, connectionString);
                            warehousePurchaseOrder.WarehousePOLogEntries = GetlogEntriesByWarehousePO_V2420(idWarehousePurchaseOrder, 258, connectionString);



                            //[rdixit][GEOS2-4455][28.06.2023] 
                            List<DateTime> ItemDates = new List<DateTime>();
                            if (warehousePurchaseOrder.WarehousePurchaseOrderItemWithComments != null)
                            {
                                if (warehousePurchaseOrder.WarehousePurchaseOrderItemWithComments.Where(i => i.Status < 100) != null)
                                {
                                    if (warehousePurchaseOrder.WarehousePurchaseOrderItemWithComments.Where(i => i.Status < 100).ToList().Count > 0)
                                        foreach (var item in warehousePurchaseOrder.WarehousePurchaseOrderItemWithComments.Where(i => i.Status < 100))
                                        {
                                            if (item.WarehousePurchaseOrderExpectedItems != null)
                                            {
                                                if (item.WarehousePurchaseOrderExpectedItems.Count > 0)
                                                    ItemDates.Add(item.WarehousePurchaseOrderExpectedItems.FirstOrDefault().Date);
                                            }
                                        }
                                }
                            }
                            if (ItemDates.Count > 0)
                                warehousePurchaseOrder.DeliveryDate = ItemDates.Min(d => d.Date).Date;
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetPendingPOByIdWarehousePurchaseOrder_V2440(idWarehousePurchaseOrder-{0}), ErrorMessage- {1} ", idWarehousePurchaseOrder, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            return warehousePurchaseOrder;
        }

        #endregion

        #region chitra.girigosavi ON [3/04/2024] GEOS2-5528 After Execute the PO in SRM need flag to 1
        public bool UpdatePoflag(string connectionString, WarehousePurchaseOrder selectedPurchaseOrder)
        {
            bool isDone = false;
            try
            {
                Log4NetLogger.Logger.Log(string.Format("Method updatePoflag()...."), category: Category.Info, priority: Priority.Low);

                using (MySqlConnection conn = new MySqlConnection(connectionString))
                {
                    conn.Open();
                    MySqlCommand command = new MySqlCommand("SRM_PurchasingOrdersUpdateupdatePoflag_V2510", conn);
                    command.CommandType = CommandType.StoredProcedure;
                    command.Parameters.AddWithValue("_IdWarehousePurchaseOrder", selectedPurchaseOrder.IdWarehousePurchaseOrder);
                    command.ExecuteNonQuery();
                    isDone = true;
                }

                Log4NetLogger.Logger.Log(string.Format("Method updatePoflag()....Executed successfully."), category: Category.Info, priority: Priority.Low);
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error updatePoflag(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw ex;
            }
            return isDone;
        }
        #endregion



        //[Sudhir.Jangra][GEOS2-5491]
        public bool DeleteArticleSupplierOrder_V2510(string connectionString, UInt32 idArticleSupplierPOReceiver)
        {
            bool status;
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("SRM_DeleteArticleSupplierOrdersContact_V2510", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdArticleSupplierPoReceiver", idArticleSupplierPOReceiver);
                    mySqlCommand.ExecuteNonQuery();
                    mySqlConnection.Close();
                    status = true;
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error DeleteArticleSupplierOrder_V2510(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return status;
        }

        //[Sudhir.Jangra][GEOS2-5491]
        public bool AddDeleteArticleSupplierOrder_V2510(string connectionString, List<Contacts> contactList, long idWarehouse)
        {
            bool status = false;
            try
            {
                if (contactList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                    {
                        mySqlConnection.Open();

                        foreach (Contacts item in contactList)
                        {
                            if (item.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("SRM_DeleteArticleSupplierOrdersContact_V2510", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdArticleSupplierPoReceiver", item.IdArticleSupplierPOReceiver);
                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (item.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("SRM_InsertArticleSupplierOrder_V2510", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdArticleSupplier", item.IdArticleSupplier);
                                mySqlCommand.Parameters.AddWithValue("_IdWarehouse", idWarehouse);
                                mySqlCommand.Parameters.AddWithValue("_IdType", item.IdType);
                                mySqlCommand.Parameters.AddWithValue("_IdContact", item.IdContact);
                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                        mySqlConnection.Close();
                        status = true;
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeleteArticleSupplierOrder_V2510(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return status;
        }


        //[Sudhir.Jangra][GEOS2-5491]
        public List<Contacts> GetArticleSuppliersOrders_V2510(string connectionString, Int32 idArticleSupplier, long idWarehouse)
        {
            List<Contacts> contactsList = new List<Contacts>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();

                MySqlCommand activitiesCommand = new MySqlCommand("SRM_GetSuppliersOrders_V2510", mySqlConnection);
                activitiesCommand.CommandType = CommandType.StoredProcedure;
                activitiesCommand.Parameters.AddWithValue("_IdArticleSupplier", idArticleSupplier);
                activitiesCommand.Parameters.AddWithValue("_IdWarehouse", idWarehouse);


                using (MySqlDataReader poReader = activitiesCommand.ExecuteReader())
                {
                    while (poReader.Read())
                    {
                        try
                        {
                            Contacts contacts = new Contacts();

                            if (poReader["IdArticleSupplierPoReceiver"] != DBNull.Value)
                                contacts.IdArticleSupplierPOReceiver = Convert.ToUInt32(poReader["IdArticleSupplierPoReceiver"]);

                            if (poReader["IdType"] != DBNull.Value)
                                contacts.IdType = Convert.ToUInt32(poReader["IdType"]);

                            if (poReader["IdContact"] != DBNull.Value)
                                contacts.IdContact = Convert.ToInt32(poReader["IdContact"]);

                            if (poReader["Firstname"] != DBNull.Value)
                                contacts.Firstname = Convert.ToString(poReader["Firstname"]);

                            if (poReader["Lastname"] != DBNull.Value)
                                contacts.Lastname = Convert.ToString(poReader["Lastname"]);

                            if (poReader["Image"] != DBNull.Value)
                                contacts.ImageText = Convert.ToString(poReader["Image"]);

                            if (poReader["IdGender"] != DBNull.Value)
                                contacts.IdGender = Convert.ToByte(poReader["IdGender"]);

                            if (poReader["Email"] != DBNull.Value)
                                contacts.Email = Convert.ToString(poReader["Email"]);

                            if (poReader["IsMainContact"] != DBNull.Value)
                                contacts.IsMainContact = Convert.ToBoolean(poReader["IsMainContact"]);

                            contactsList.Add(contacts);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetArticleSuppliersOrders_V2510(idArticleSupplier-{0}). ErrorMessage- {1}", idArticleSupplier, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            Log4NetLogger.Logger.Log("Executed GetArticleSuppliersOrders_V2510().", category: Category.Info, priority: Priority.Low);

            return contactsList;
        }

        //[cpatil] [GEOS2-5618] [2024-04-30]
        public List<WarehousePurchaseOrder> GetPendingPurchaseOrdersByWarehouse_V2510(long idWarehouse, string connectionstring, string countryIconFilePath, string connectionStringWorkbench)
        {
            // string connectionString = warehouse.Company.ConnectPlantConstr;
            List<WarehousePurchaseOrder> warehousePurchaseOrders = new List<WarehousePurchaseOrder>();
            List<string> countryISOs = new List<string>();
            List<long> orderid = new List<long>();
            Dictionary<string, List<long>> SupplierEmailId = new Dictionary<string, List<long>>();
            List<string> Suppliername = new List<string>();

            List<WorkflowStatus> LstWorkflowStatus = GetAllWorkflowStatus_V2301(connectionStringWorkbench);
            List<WorkflowTransition> LstWorkflowStatusTransitions = GetAllWorkflowTransitions_V2301(connectionStringWorkbench);
            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionstring))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetPendingPurchaseOrdersByWarehouse_V2510", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdWarehouse", idWarehouse);
                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    double totalQuantity = 0;
                    double receivedQuantity = 0;
                    while (mySqlDataReader.Read())
                    {
                        try
                        {
                            totalQuantity = 0;
                            receivedQuantity = 0;
                            WarehousePurchaseOrder warehousePurchaseOrder = new WarehousePurchaseOrder();
                            try
                            {
                                warehousePurchaseOrder.IdWarehousePurchaseOrder = Convert.ToInt64(mySqlDataReader["idWarehousepurchaseorder"]);
                                if (mySqlDataReader["Code"] != DBNull.Value)
                                    warehousePurchaseOrder.Code = Convert.ToString(mySqlDataReader["Code"]);
                                if (mySqlDataReader["IdArticleSupplier"] != DBNull.Value)
                                {
                                    ArticleSupplier articleSupplier = new ArticleSupplier();
                                    articleSupplier.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);
                                    if (mySqlDataReader["Supplier"] != DBNull.Value)
                                        articleSupplier.Name = Convert.ToString(mySqlDataReader["Supplier"]);
                                    if (mySqlDataReader["IdCountry"] != DBNull.Value)
                                    {
                                        articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["IdCountry"]);
                                        articleSupplier.Country = new Country();
                                        articleSupplier.Country.IdCountry = Convert.ToByte(mySqlDataReader["IdCountry"]);
                                        articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);
                                        if (mySqlDataReader["CountryISO"] != DBNull.Value)
                                        {
                                            articleSupplier.Country.Iso = Convert.ToString(mySqlDataReader["CountryISO"]);
                                            articleSupplier.Country.CountryIconUrl = "https://api.emdep.com/GEOS/Images?FilePath=/Images/Countries/" + articleSupplier.Country.Iso + ".png";
                                            //if (!countryISOs.Any(co => co.ToString() == articleSupplier.Country.Iso))
                                            //{
                                            //    countryISOs.Add(articleSupplier.Country.Iso);
                                            //}
                                        }
                                    }
                                    if (mySqlDataReader["SupplierContactPerson"] != DBNull.Value)
                                        articleSupplier.ContactPerson = Convert.ToString(mySqlDataReader["SupplierContactPerson"]);
                                    if (mySqlDataReader["SupplierContactEmail"] != DBNull.Value)
                                        articleSupplier.ContactEmail = Convert.ToString(mySqlDataReader["SupplierContactEmail"]);
                                    warehousePurchaseOrder.ArticleSupplier = articleSupplier;
                                }
                                //[rdixit][GEOS2-4455][19.06.2023]
                                //if (mySqlDataReader["DeliveryDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["deliveryDate"]) != DateTime.MinValue)
                                //{
                                //warehousePurchaseOrder.DeliveryDate = Convert.ToDateTime(mySqlDataReader["deliveryDate"]);
                                //warehousePurchaseOrder.Delay = (int)(warehousePurchaseOrder.DeliveryDate.Value.Date - DateTime.Now.Date).TotalDays;
                                //}

                                //Shubham[skadam]  GEOS2-4713 Missing Delivery Dates 31 07 2023 
                                if (mySqlDataReader["PODeliveryDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["PODeliveryDate"]) != DateTime.MinValue)
                                {
                                    warehousePurchaseOrder.PODeliveryDate = Convert.ToDateTime(mySqlDataReader["PODeliveryDate"]);
                                }
                                if (mySqlDataReader["AttachedPO"] != DBNull.Value)
                                    warehousePurchaseOrder.AttachedPO = Convert.ToByte(mySqlDataReader["AttachedPO"]);
                                if (mySqlDataReader["Deliveries"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.Deliveries = Convert.ToInt32(mySqlDataReader["Deliveries"]);
                                    if (warehousePurchaseOrder.Deliveries > 0)
                                    {
                                        warehousePurchaseOrder.IsPartialPending = true;
                                    }
                                }
                                if (mySqlDataReader["LatestDeliveryDate"] != DBNull.Value)
                                    warehousePurchaseOrder.LatestDeliveryDate = Convert.ToDateTime(mySqlDataReader["LatestDeliveryDate"]);
                                if (mySqlDataReader["IdWarehouse"] != DBNull.Value)
                                    warehousePurchaseOrder.IdWarehouse = Convert.ToInt64(mySqlDataReader["IdWarehouse"]);
                                if (mySqlDataReader["OrderQty"] != DBNull.Value)
                                    totalQuantity = Convert.ToDouble(mySqlDataReader["OrderQty"]);
                                if (mySqlDataReader["ReceivedQuantity"] != DBNull.Value)
                                    receivedQuantity = Convert.ToDouble(mySqlDataReader["ReceivedQuantity"]);
                                if (totalQuantity > 0)
                                    warehousePurchaseOrder.Status = (Int16)((receivedQuantity / totalQuantity) * 100);
                                if (mySqlDataReader["TotalAmount"] != DBNull.Value)
                                    warehousePurchaseOrder.TotalAmount = Convert.ToDecimal(mySqlDataReader["TotalAmount"]);
                                if (mySqlDataReader["CreatedIn"] != DBNull.Value)
                                    warehousePurchaseOrder.CreatedIn = Convert.ToDateTime(mySqlDataReader["CreatedIn"]);
                                if (mySqlDataReader["AttachPdf"] != DBNull.Value)
                                    warehousePurchaseOrder.AttachPdf = Convert.ToString(mySqlDataReader["AttachPdf"]);
                                if (mySqlDataReader["idCurrency"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.IdCurrency = Convert.ToByte(mySqlDataReader["idCurrency"]);
                                    warehousePurchaseOrder.Currency = new Currency();
                                    warehousePurchaseOrder.Currency.IdCurrency = Convert.ToByte(mySqlDataReader["idCurrency"]);
                                    warehousePurchaseOrder.Currency.Name = Convert.ToString(mySqlDataReader["CurrencyName"]);
                                    warehousePurchaseOrder.Currency.Symbol = Convert.ToString(mySqlDataReader["CurrencySymbol"]);
                                }
                                if (mySqlDataReader["IdWorkflowStatus"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                    warehousePurchaseOrder.WorkflowStatus = new WorkflowStatus();
                                    warehousePurchaseOrder.WorkflowStatus.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                    warehousePurchaseOrder.WorkflowStatus.Name = Convert.ToString(mySqlDataReader["Status"]);
                                    warehousePurchaseOrder.WorkflowStatus.HtmlColor = Convert.ToString(mySqlDataReader["HtmlColor"]);


                                    //[pramod.misal][GEOS2-4448][06-07-2023]
                                    if (mySqlDataReader["SortOrder"] != DBNull.Value)
                                    {
                                        warehousePurchaseOrder.WorkflowStatus.SortOrder = Convert.ToInt32(mySqlDataReader["SortOrder"]);
                                    }

                                }
                                if (mySqlDataReader["AssigneeEmail"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.AssigneeEmail = Convert.ToString(mySqlDataReader["AssigneeEmail"]);
                                }
                                if (mySqlDataReader["CreatorEmail"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.CreatorEmail = Convert.ToString(mySqlDataReader["CreatorEmail"]);
                                }

                                if (mySqlDataReader["ReminderEmailDate"] != DBNull.Value)
                                    warehousePurchaseOrder.ReminderEmailDate = Convert.ToDateTime(mySqlDataReader["ReminderEmailDate"]);

                                if (mySqlDataReader["WarehouseName"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.WarehouseName = Convert.ToString(mySqlDataReader["WarehouseName"]);
                                }


                                warehousePurchaseOrder.LstWorkflowStatus = LstWorkflowStatus;
                                List<byte> GetCurrentButtons = LstWorkflowStatusTransitions.Where(a => a.IdWorkflowStatusFrom == warehousePurchaseOrder.IdWorkflowStatus).Select(a => a.IdWorkflowStatusTo).Distinct().ToList();
                                warehousePurchaseOrder.LstWorkflowStatusTransition = new List<WorkflowStatus>();
                                warehousePurchaseOrder.LstWorkflowStatusTransition.Add(warehousePurchaseOrder.LstWorkflowStatus.FirstOrDefault(a => a.IdWorkflowStatus == warehousePurchaseOrder.IdWorkflowStatus));
                                foreach (byte statusbutton in GetCurrentButtons)
                                {
                                    warehousePurchaseOrder.LstWorkflowStatusTransition.Add(warehousePurchaseOrder.LstWorkflowStatus.FirstOrDefault(a => a.IdWorkflowStatus == statusbutton));
                                }
                            }
                            catch (Exception ex)
                            {
                            }
                            warehousePurchaseOrder.LstAllWorkflowStatusTransitions = LstWorkflowStatusTransitions;
                            warehousePurchaseOrders.Add(warehousePurchaseOrder);

                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetPendingPurchaseOrdersByWarehouse_V2450(). ErrorMessage-" + ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                    #region 2nd ResultSet [rdixit][GEOS2-4455][19.06.2023] 
                    if (mySqlDataReader.NextResult())
                    {
                        while (mySqlDataReader.Read())
                        {
                            if (mySqlDataReader["idWarehousePurchaseOrder"] != DBNull.Value)
                            {
                                WarehousePurchaseOrderItem OrderItem = new WarehousePurchaseOrderItem();

                                WarehousePurchaseOrder Order = warehousePurchaseOrders.FirstOrDefault(i => i.IdWarehousePurchaseOrder == Convert.ToInt64(mySqlDataReader["idWarehousePurchaseOrder"]));

                                if (Order != null)
                                {
                                    if (Order.WarehousePurchaseOrderItems == null)
                                    {
                                        Order.WarehousePurchaseOrderItems = new List<WarehousePurchaseOrderItem>();
                                    }
                                    if (mySqlDataReader["idWarehousePurchaseOrder"] != DBNull.Value)
                                        OrderItem.IdWarehousePurchaseOrder = Convert.ToInt64(mySqlDataReader["idWarehousePurchaseOrder"]);
                                    if (mySqlDataReader["IdWarehousePurchaseOrderItem"] != DBNull.Value)
                                        OrderItem.IdWarehousePurchaseOrderItem = Convert.ToInt64(mySqlDataReader["IdWarehousePurchaseOrderItem"]);
                                    if (mySqlDataReader["Quantity"] != DBNull.Value)
                                        OrderItem.Quantity = Convert.ToDouble(mySqlDataReader["Quantity"]);
                                    if (mySqlDataReader["AlbaranQty"] != DBNull.Value)
                                        OrderItem.ReceivedQuantity = Convert.ToDouble(mySqlDataReader["AlbaranQty"]);
                                    if (OrderItem.Quantity > 0)
                                        OrderItem.Status = (Int32)(OrderItem.ReceivedQuantity / OrderItem.Quantity * 100);
                                    Order.WarehousePurchaseOrderItems.Add(OrderItem);
                                }
                            }
                        }
                    }
                    #endregion
                    #region 3nd ResultSet [rdixit][GEOS2-4455][19.06.2023] 
                    if (mySqlDataReader.NextResult())
                    {
                        while (mySqlDataReader.Read())
                        {
                            if (mySqlDataReader["IdWarehousePurchaseOrderItem"] != DBNull.Value)
                            {
                                WarehousePurchaseOrderExpectedItem OrderExpectedItem = new WarehousePurchaseOrderExpectedItem();

                                WarehousePurchaseOrderItem OrderItem = warehousePurchaseOrders.Where(o => o.WarehousePurchaseOrderItems != null)
                                                                        .SelectMany(order => order.WarehousePurchaseOrderItems)
                                                                        .FirstOrDefault(item => item.IdWarehousePurchaseOrderItem == Convert.ToInt64(mySqlDataReader["IdWarehousePurchaseOrderItem"]));
                                if (OrderItem != null)
                                {
                                    if (OrderItem.WarehousePurchaseOrderExpectedItems == null)
                                    {
                                        OrderItem.WarehousePurchaseOrderExpectedItems = new List<WarehousePurchaseOrderExpectedItem>();
                                    }
                                    if (mySqlDataReader["IdWarehousePurchaseOrderItem"] != DBNull.Value)
                                        OrderExpectedItem.IdWarehousePurchaseOrderItem = Convert.ToInt64(mySqlDataReader["IdWarehousePurchaseOrderItem"]);
                                    if (mySqlDataReader["Quantity"] != DBNull.Value)
                                        OrderExpectedItem.Quantity = (long)Convert.ToDouble(mySqlDataReader["Quantity"]);
                                    if (mySqlDataReader["Date"] != DBNull.Value)
                                        OrderExpectedItem.Date = Convert.ToDateTime(mySqlDataReader["Date"]);

                                    OrderItem.WarehousePurchaseOrderExpectedItems.Add(OrderExpectedItem);
                                }
                            }
                        }
                    }
                    #endregion
                }
            }
            #region 2nd ResultSet [rdixit][GEOS2-4455][19.06.2023] 
            foreach (WarehousePurchaseOrder Order in warehousePurchaseOrders)
            {
                List<DateTime> ItemDates = new List<DateTime>();
                if (Order.WarehousePurchaseOrderItems != null)
                {
                    if (Order.WarehousePurchaseOrderItems.Where(i => i.Status < 100) != null)
                    {
                        if (Order.WarehousePurchaseOrderItems.Where(i => i.Status < 100).ToList().Count > 0)
                        {
                            foreach (WarehousePurchaseOrderItem OrderItem in Order.WarehousePurchaseOrderItems.Where(i => i.Status != 100))
                            {
                                if (OrderItem.WarehousePurchaseOrderExpectedItems != null)
                                {
                                    if (OrderItem.WarehousePurchaseOrderExpectedItems.Count > 0)
                                        ItemDates.Add(OrderItem.WarehousePurchaseOrderExpectedItems.FirstOrDefault().Date);
                                }
                            }
                        }
                    }
                }
                if (ItemDates.Count != 0)
                {
                    Order.DeliveryDate = ItemDates.Min(d => d.Date).Date;
                    Order.Delay = (int)(Order.DeliveryDate.Value.Date - DateTime.Now.Date).TotalDays;

                    if (!string.IsNullOrEmpty(Order.ArticleSupplier.ContactEmail))
                    {
                        if (Order.ReminderEmailDate == DateTime.MinValue || Order.ReminderEmailDate == null)
                        {
                            Order.ReminderEmailDate = Order.DeliveryDate.Value.AddDays(1);
                        }
                        DateTime dtRm = new DateTime(Order.ReminderEmailDate.Value.Year, Order.ReminderEmailDate.Value.Month, Order.ReminderEmailDate.Value.Day);
                        DateTime dtNow = new DateTime(DateTime.Now.Year, DateTime.Now.Month, DateTime.Now.Day);
                        if (dtRm <= dtNow)
                        {
                            orderid = new List<long>();
                            orderid.Add(Order.IdWarehousePurchaseOrder);
                            if (!SupplierEmailId.ContainsKey(Order.ArticleSupplier.ContactEmail))
                            {
                                SupplierEmailId.Add(Order.ArticleSupplier.ContactEmail, orderid);
                            }
                            else
                            {
                                SupplierEmailId[Order.ArticleSupplier.ContactEmail].Add(Order.IdWarehousePurchaseOrder);
                            }
                        }
                    }
                    else
                    {
                        if (!Suppliername.Contains(Order.ArticleSupplier.Name))
                        {
                            Suppliername.Add(Order.ArticleSupplier.Name);
                        }
                    }
                }
            }
            #endregion
            #region GEOS2-4713
            //Shubham[skadam]  GEOS2-4713 Missing Delivery Dates 31 07 2023 
            foreach (var item in warehousePurchaseOrders.Where(w => w.DeliveryDate == null || w.DeliveryDate == DateTime.MinValue))
            {
                if (!string.IsNullOrEmpty(item.PODeliveryDate.ToString()))
                {
                    item.DeliveryDate = item.PODeliveryDate;
                    item.Delay = (int)(item.DeliveryDate.Value.Date - DateTime.Now.Date).TotalDays;
                }
            }
            #endregion
            //foreach (string item in countryISOs)
            //{
            //    byte[] bytes = null;
            //    bytes = GetCountryIconFileInBytes(item, countryIconFilePath);
            //    warehousePurchaseOrders.Where(wp => wp.ArticleSupplier.Country.Iso == item).ToList().ForEach(wp => wp.ArticleSupplier.Country.CountryIconBytes = bytes);
            //}
            if (warehousePurchaseOrders.Count > 0)
            {
                warehousePurchaseOrders.FirstOrDefault().SupplierEmailId = SupplierEmailId;
                warehousePurchaseOrders.FirstOrDefault().Suppliername = Suppliername;
            }
            return warehousePurchaseOrders;
        }



        //[Sudhir.jangra][GEOS2-5491]

        public bool DeleteContacts_V2510(string connectionString, int idContact, Int32 idArticleSupplier, long idWarehouse)
        {
            bool status;
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("SRM_Delete_contacts", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_idContact", idContact);
                    mySqlCommand.Parameters.AddWithValue("_IdArticleSupplier", idArticleSupplier);
                    mySqlCommand.Parameters.AddWithValue("_IdWarehouse", idWarehouse);
                    mySqlCommand.ExecuteNonQuery();
                    mySqlConnection.Close();
                    status = true;
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error DeleteContacts(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return status;
        }


        //rajashri [GEOS2-5461]
        public List<WarehousePurchaseOrder> GetCompletedPurchaseOrdersByWarehouse_V2520(DateTime startDate, DateTime endDate, long idWarehouse, string connectionstring, string countryIconFilePath, string connectionStringWorkbench)
        {
            // string connectionString = warehouse.Company.ConnectPlantConstr;
            List<WarehousePurchaseOrder> warehousePurchaseOrders = new List<WarehousePurchaseOrder>();
            List<string> countryISOs = new List<string>();
            List<long> orderid = new List<long>();
            Dictionary<string, List<long>> SupplierEmailId = new Dictionary<string, List<long>>();
            List<string> Suppliername = new List<string>();

            List<WorkflowStatus> LstWorkflowStatus = GetAllWorkflowStatus_V2301(connectionStringWorkbench);
            List<WorkflowTransition> LstWorkflowStatusTransitions = GetAllWorkflowTransitions_V2301(connectionStringWorkbench);
            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionstring))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetCompletedOrdersByWarehouse_V2520", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_StartDate", startDate);
                mySqlCommand.Parameters.AddWithValue("_EndDate", endDate);
                mySqlCommand.Parameters.AddWithValue("_IdWarehouse", idWarehouse);
                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    double totalQuantity = 0;
                    double receivedQuantity = 0;
                    while (mySqlDataReader.Read())
                    {
                        try
                        {
                            totalQuantity = 0;
                            receivedQuantity = 0;
                            WarehousePurchaseOrder warehousePurchaseOrder = new WarehousePurchaseOrder();
                            try
                            {
                                warehousePurchaseOrder.IdWarehousePurchaseOrder = Convert.ToInt64(mySqlDataReader["idWarehousepurchaseorder"]);
                                if (mySqlDataReader["Code"] != DBNull.Value)
                                    warehousePurchaseOrder.Code = Convert.ToString(mySqlDataReader["Code"]);
                                if (mySqlDataReader["Incoterms"] != DBNull.Value)
                                    warehousePurchaseOrder.Incoterms = Convert.ToString(mySqlDataReader["Incoterms"]);
                                if (mySqlDataReader["Comments"] != DBNull.Value)
                                    warehousePurchaseOrder.Comments = Convert.ToString(mySqlDataReader["Comments"]);
                                //if (mySqlDataReader["Observations"] != DBNull.Value)
                                //    warehousePurchaseOrder.Observations = Convert.ToString(mySqlDataReader["Observations"]);
                                if (mySqlDataReader["IdArticleSupplier"] != DBNull.Value)
                                {
                                    ArticleSupplier articleSupplier = new ArticleSupplier();
                                    articleSupplier.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);
                                    if (mySqlDataReader["Supplier"] != DBNull.Value)
                                        articleSupplier.Name = Convert.ToString(mySqlDataReader["Supplier"]);
                                    if (mySqlDataReader["IdCountry"] != DBNull.Value)
                                    {
                                        articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["IdCountry"]);
                                        articleSupplier.Country = new Country();
                                        articleSupplier.Country.IdCountry = Convert.ToByte(mySqlDataReader["IdCountry"]);
                                        articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);
                                        if (mySqlDataReader["CountryISO"] != DBNull.Value)
                                        {
                                            articleSupplier.Country.Iso = Convert.ToString(mySqlDataReader["CountryISO"]);
                                            articleSupplier.Country.CountryIconUrl = "https://api.emdep.com/GEOS/Images?FilePath=/Images/Countries/" + articleSupplier.Country.Iso + ".png";
                                            //if (!countryISOs.Any(co => co.ToString() == articleSupplier.Country.Iso))
                                            //{
                                            //    countryISOs.Add(articleSupplier.Country.Iso);
                                            //}
                                        }
                                    }
                                    if (mySqlDataReader["SupplierContactPerson"] != DBNull.Value)
                                        articleSupplier.ContactPerson = Convert.ToString(mySqlDataReader["SupplierContactPerson"]);
                                    if (mySqlDataReader["SupplierContactEmail"] != DBNull.Value)
                                        articleSupplier.ContactEmail = Convert.ToString(mySqlDataReader["SupplierContactEmail"]);
                                    warehousePurchaseOrder.ArticleSupplier = articleSupplier;
                                }

                                //Shubham[skadam]  GEOS2-4713 Missing Delivery Dates 31 07 2023 
                                if (mySqlDataReader["PODeliveryDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["PODeliveryDate"]) != DateTime.MinValue)
                                {
                                    warehousePurchaseOrder.PODeliveryDate = Convert.ToDateTime(mySqlDataReader["PODeliveryDate"]);
                                }
                                if (mySqlDataReader["AttachedPO"] != DBNull.Value)
                                    warehousePurchaseOrder.AttachedPO = Convert.ToByte(mySqlDataReader["AttachedPO"]);
                                if (mySqlDataReader["Deliveries"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.Deliveries = Convert.ToInt32(mySqlDataReader["Deliveries"]);
                                    if (warehousePurchaseOrder.Deliveries > 0)
                                    {
                                        warehousePurchaseOrder.IsPartialPending = true;
                                    }
                                }
                                if (mySqlDataReader["LatestDeliveryDate"] != DBNull.Value)
                                    warehousePurchaseOrder.LatestDeliveryDate = Convert.ToDateTime(mySqlDataReader["LatestDeliveryDate"]);
                                if (mySqlDataReader["FirstDeliveryDate"] != DBNull.Value)
                                    warehousePurchaseOrder.FirstDeliveryDate = Convert.ToDateTime(mySqlDataReader["FirstDeliveryDate"]);
                                if (mySqlDataReader["IdWarehouse"] != DBNull.Value)
                                    warehousePurchaseOrder.IdWarehouse = Convert.ToInt64(mySqlDataReader["IdWarehouse"]);
                                if (mySqlDataReader["OrderQty"] != DBNull.Value)
                                    totalQuantity = Convert.ToDouble(mySqlDataReader["OrderQty"]);
                                if (mySqlDataReader["ReceivedQuantity"] != DBNull.Value)
                                    receivedQuantity = Convert.ToDouble(mySqlDataReader["ReceivedQuantity"]);
                                if (totalQuantity > 0)
                                    warehousePurchaseOrder.Status = (Int16)((receivedQuantity / totalQuantity) * 100);
                                if (mySqlDataReader["TotalAmount"] != DBNull.Value)
                                    warehousePurchaseOrder.TotalAmount = Convert.ToDecimal(mySqlDataReader["TotalAmount"]);
                                if (mySqlDataReader["CreatedIn"] != DBNull.Value)
                                    warehousePurchaseOrder.CreatedIn = Convert.ToDateTime(mySqlDataReader["CreatedIn"]);
                                if (mySqlDataReader["AttachPdf"] != DBNull.Value)
                                    warehousePurchaseOrder.AttachPdf = Convert.ToString(mySqlDataReader["AttachPdf"]);
                                if (mySqlDataReader["idCurrency"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.IdCurrency = Convert.ToByte(mySqlDataReader["idCurrency"]);
                                    warehousePurchaseOrder.Currency = new Currency();
                                    warehousePurchaseOrder.Currency.IdCurrency = Convert.ToByte(mySqlDataReader["idCurrency"]);
                                    warehousePurchaseOrder.Currency.Name = Convert.ToString(mySqlDataReader["CurrencyName"]);
                                    warehousePurchaseOrder.Currency.Symbol = Convert.ToString(mySqlDataReader["CurrencySymbol"]);
                                }
                                if (mySqlDataReader["IdWorkflowStatus"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                    warehousePurchaseOrder.WorkflowStatus = new WorkflowStatus();
                                    warehousePurchaseOrder.WorkflowStatus.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                    warehousePurchaseOrder.WorkflowStatus.Name = Convert.ToString(mySqlDataReader["Status"]);
                                    warehousePurchaseOrder.WorkflowStatus.HtmlColor = Convert.ToString(mySqlDataReader["HtmlColor"]);


                                    //[pramod.misal][GEOS2-4448][06-07-2023]
                                    if (mySqlDataReader["SortOrder"] != DBNull.Value)
                                    {
                                        warehousePurchaseOrder.WorkflowStatus.SortOrder = Convert.ToInt32(mySqlDataReader["SortOrder"]);
                                    }

                                }
                                if (mySqlDataReader["AssigneeEmail"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.AssigneeEmail = Convert.ToString(mySqlDataReader["AssigneeEmail"]);
                                }
                                if (mySqlDataReader["CreatorEmail"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.CreatorEmail = Convert.ToString(mySqlDataReader["CreatorEmail"]);
                                }

                                if (mySqlDataReader["ReminderEmailDate"] != DBNull.Value)
                                    warehousePurchaseOrder.ReminderEmailDate = Convert.ToDateTime(mySqlDataReader["ReminderEmailDate"]);

                                if (mySqlDataReader["WarehouseName"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.WarehouseName = Convert.ToString(mySqlDataReader["WarehouseName"]);
                                }


                                warehousePurchaseOrder.LstWorkflowStatus = LstWorkflowStatus;
                                List<byte> GetCurrentButtons = LstWorkflowStatusTransitions.Where(a => a.IdWorkflowStatusFrom == warehousePurchaseOrder.IdWorkflowStatus).Select(a => a.IdWorkflowStatusTo).Distinct().ToList();
                                warehousePurchaseOrder.LstWorkflowStatusTransition = new List<WorkflowStatus>();
                                warehousePurchaseOrder.LstWorkflowStatusTransition.Add(warehousePurchaseOrder.LstWorkflowStatus.FirstOrDefault(a => a.IdWorkflowStatus == warehousePurchaseOrder.IdWorkflowStatus));
                                foreach (byte statusbutton in GetCurrentButtons)
                                {
                                    warehousePurchaseOrder.LstWorkflowStatusTransition.Add(warehousePurchaseOrder.LstWorkflowStatus.FirstOrDefault(a => a.IdWorkflowStatus == statusbutton));
                                }
                            }
                            catch (Exception ex)
                            {
                            }
                            warehousePurchaseOrder.LstAllWorkflowStatusTransitions = LstWorkflowStatusTransitions;
                            warehousePurchaseOrders.Add(warehousePurchaseOrder);
                            // warehousePurchaseOrder.WarehousePurchaseOrderItemWithComments = GetArticlesByIdWarehousePurchaseOrder_V2460(connectionstring, warehousePurchaseOrder.IdWarehousePurchaseOrder);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetPendingPurchaseOrdersByWarehouse_V2450(). ErrorMessage-" + ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                    #region 2nd ResultSet [rdixit][GEOS2-4455][19.06.2023] 
                    if (mySqlDataReader.NextResult())
                    {
                        Dictionary<long, int> orderItemCounts = new Dictionary<long, int>();
                        while (mySqlDataReader.Read())
                        {
                            if (mySqlDataReader["idWarehousePurchaseOrder"] != DBNull.Value)
                            {
                                WarehousePurchaseOrderItem OrderItem = new WarehousePurchaseOrderItem();

                                WarehousePurchaseOrder Order = warehousePurchaseOrders.FirstOrDefault(i => i.IdWarehousePurchaseOrder == Convert.ToInt64(mySqlDataReader["idWarehousePurchaseOrder"]));

                                if (Order != null)
                                {
                                    if (Order.WarehousePurchaseOrderItems == null)
                                    {
                                        Order.WarehousePurchaseOrderItems = new List<WarehousePurchaseOrderItem>();
                                    }
                                    if (mySqlDataReader["idWarehousePurchaseOrder"] != DBNull.Value)
                                        OrderItem.IdWarehousePurchaseOrder = Convert.ToInt64(mySqlDataReader["idWarehousePurchaseOrder"]);
                                    if (mySqlDataReader["IdWarehousePurchaseOrderItem"] != DBNull.Value)
                                        OrderItem.IdWarehousePurchaseOrderItem = Convert.ToInt64(mySqlDataReader["IdWarehousePurchaseOrderItem"]);
                                    if (mySqlDataReader["Quantity"] != DBNull.Value)
                                        OrderItem.Quantity = Convert.ToDouble(mySqlDataReader["Quantity"]);
                                    if (mySqlDataReader["AlbaranQty"] != DBNull.Value)
                                        OrderItem.ReceivedQuantity = Convert.ToDouble(mySqlDataReader["AlbaranQty"]);

                                    if (OrderItem.Article == null)
                                    {
                                        OrderItem.Article = new Article();
                                    }
                                    if (mySqlDataReader["Reference"] != DBNull.Value)
                                        OrderItem.Article.Reference = Convert.ToString(mySqlDataReader["Reference"]);

                                    if (OrderItem.Quantity > 0)
                                        OrderItem.Status = (Int32)(OrderItem.ReceivedQuantity / OrderItem.Quantity * 100);

                                    Order.WarehousePurchaseOrderItems.Add(OrderItem);

                                    Order.ItemCount = Order.WarehousePurchaseOrderItems.Count(i => i.Article.Reference != "");


                                }
                            }
                        }
                    }

                    #endregion
                    #region 3nd ResultSet [rdixit][GEOS2-4455][19.06.2023] 

                    if (mySqlDataReader.NextResult())
                    {
                        while (mySqlDataReader.Read())
                        {
                            if (mySqlDataReader["IdWarehousePurchaseOrderItem"] != DBNull.Value)
                            {
                                WarehousePurchaseOrderExpectedItem OrderExpectedItem = new WarehousePurchaseOrderExpectedItem();

                                WarehousePurchaseOrderItem OrderItem = warehousePurchaseOrders.Where(o => o.WarehousePurchaseOrderItems != null)
                                                                        .SelectMany(order => order.WarehousePurchaseOrderItems)
                                                                        .FirstOrDefault(item => item.IdWarehousePurchaseOrderItem == Convert.ToInt64(mySqlDataReader["IdWarehousePurchaseOrderItem"]));
                                if (OrderItem != null)
                                {
                                    if (OrderItem.WarehousePurchaseOrderExpectedItems == null)
                                    {
                                        OrderItem.WarehousePurchaseOrderExpectedItems = new List<WarehousePurchaseOrderExpectedItem>();
                                    }
                                    if (mySqlDataReader["IdWarehousePurchaseOrderItem"] != DBNull.Value)
                                        OrderExpectedItem.IdWarehousePurchaseOrderItem = Convert.ToInt64(mySqlDataReader["IdWarehousePurchaseOrderItem"]);
                                    if (mySqlDataReader["Quantity"] != DBNull.Value)
                                        OrderExpectedItem.Quantity = (long)Convert.ToDouble(mySqlDataReader["Quantity"]);
                                    if (mySqlDataReader["Date"] != DBNull.Value)
                                        OrderExpectedItem.Date = Convert.ToDateTime(mySqlDataReader["Date"]);

                                    OrderItem.WarehousePurchaseOrderExpectedItems.Add(OrderExpectedItem);

                                }
                            }
                        }
                    }
                    #endregion
                }
            }
            #region 2nd ResultSet [rdixit][GEOS2-4455][19.06.2023] 
            foreach (WarehousePurchaseOrder Order in warehousePurchaseOrders)
            {
                List<DateTime> ItemDates = new List<DateTime>();
                if (Order.WarehousePurchaseOrderItems != null)
                {
                    if (Order.WarehousePurchaseOrderItems.Where(i => i.Status < 100) != null)
                    {
                        if (Order.WarehousePurchaseOrderItems.Where(i => i.Status < 100).ToList().Count > 0)
                        {
                            foreach (WarehousePurchaseOrderItem OrderItem in Order.WarehousePurchaseOrderItems.Where(i => i.Status != 100))
                            {
                                if (OrderItem.WarehousePurchaseOrderExpectedItems != null)
                                {
                                    if (OrderItem.WarehousePurchaseOrderExpectedItems.Count > 0)
                                        ItemDates.Add(OrderItem.WarehousePurchaseOrderExpectedItems.FirstOrDefault().Date);
                                }
                            }
                        }
                    }
                }
                if (ItemDates.Count != 0)
                {
                    Order.DeliveryDate = ItemDates.Min(d => d.Date).Date;
                    Order.Delay = (int)(Order.DeliveryDate.Value.Date - DateTime.Now.Date).TotalDays;

                    if (!string.IsNullOrEmpty(Order.ArticleSupplier.ContactEmail))
                    {
                        if (Order.ReminderEmailDate == DateTime.MinValue || Order.ReminderEmailDate == null)
                        {
                            Order.ReminderEmailDate = Order.DeliveryDate.Value.AddDays(1);
                        }
                        DateTime dtRm = new DateTime(Order.ReminderEmailDate.Value.Year, Order.ReminderEmailDate.Value.Month, Order.ReminderEmailDate.Value.Day);
                        DateTime dtNow = new DateTime(DateTime.Now.Year, DateTime.Now.Month, DateTime.Now.Day);
                        if (dtRm <= dtNow)
                        {
                            orderid = new List<long>();
                            orderid.Add(Order.IdWarehousePurchaseOrder);
                            if (!SupplierEmailId.ContainsKey(Order.ArticleSupplier.ContactEmail))
                            {
                                SupplierEmailId.Add(Order.ArticleSupplier.ContactEmail, orderid);
                            }
                            else
                            {
                                SupplierEmailId[Order.ArticleSupplier.ContactEmail].Add(Order.IdWarehousePurchaseOrder);
                            }
                        }
                    }
                    else
                    {
                        if (!Suppliername.Contains(Order.ArticleSupplier.Name))
                        {
                            Suppliername.Add(Order.ArticleSupplier.Name);
                        }
                    }
                }
            }
            #endregion
            #region GEOS2-4713
            //Shubham[skadam]  GEOS2-4713 Missing Delivery Dates 31 07 2023 
            foreach (var item in warehousePurchaseOrders.Where(w => w.DeliveryDate == null || w.DeliveryDate == DateTime.MinValue))
            {
                if (!string.IsNullOrEmpty(item.PODeliveryDate.ToString()))
                {
                    item.DeliveryDate = item.PODeliveryDate;
                    item.Delay = (int)(item.DeliveryDate.Value.Date - DateTime.Now.Date).TotalDays;
                }
            }
            #endregion

            if (warehousePurchaseOrders.Count > 0)
            {
                warehousePurchaseOrders.FirstOrDefault().SupplierEmailId = SupplierEmailId;
                warehousePurchaseOrders.FirstOrDefault().Suppliername = Suppliername;
            }

            return warehousePurchaseOrders;
        }

        #region //chitra.girigosavi ON [2/04/2024] GEOS2-5406 Changes in Supplier PO Management(2/3)
        public WarehousePurchaseOrder GetOfferExportChart_V2520(int IdPo, int idWarehouse, string connectionString, string poExcelTemplatePath)
        {
            Dictionary<string, WarehousePurchaseOrder> Result = new Dictionary<string, WarehousePurchaseOrder>();
            byte[] bytes = null;
            WarehousePurchaseOrder po = new WarehousePurchaseOrder();
            string defaultFileName = @"\SupplierPO.xlsx";

            string companyFileName = string.Format("{0}{1}{2}{3}", @"\", IdPo, "_", "SupplierPO.xlsx");
            #region Template file get Method
            try
            {
                if (File.Exists(string.Format("{0}{1}", poExcelTemplatePath, companyFileName)))
                {
                    using (System.IO.FileStream stream = new System.IO.FileStream(string.Format("{0}{1}", poExcelTemplatePath, companyFileName), System.IO.FileMode.Open, System.IO.FileAccess.Read))
                    {
                        bytes = new byte[stream.Length];
                        int numBytesToRead = (int)stream.Length;
                        int numBytesRead = 0;

                        while (numBytesToRead > 0)
                        {
                            // Read may return anything from 0 to numBytesToRead.
                            int n = stream.Read(bytes, numBytesRead, numBytesToRead);

                            // Break when the end of the file is reached.
                            if (n == 0)
                                break;

                            numBytesRead += n;
                            numBytesToRead -= n;
                        }
                    }
                }
                else if (File.Exists(string.Format("{0}{1}", poExcelTemplatePath, defaultFileName)))
                {
                    using (System.IO.FileStream stream = new System.IO.FileStream(string.Format("{0}{1}", poExcelTemplatePath, defaultFileName), System.IO.FileMode.Open, System.IO.FileAccess.Read))
                    {
                        bytes = new byte[stream.Length];
                        int numBytesToRead = (int)stream.Length;
                        int numBytesRead = 0;

                        while (numBytesToRead > 0)
                        {
                            // Read may return anything from 0 to numBytesToRead.
                            int n = stream.Read(bytes, numBytesRead, numBytesToRead);

                            // Break when the end of the file is reached.
                            if (n == 0)
                                break;

                            numBytesRead += n;
                            numBytesToRead -= n;
                        }
                    }
                }


            }
            catch (FileNotFoundException ex)
            {

            }
            catch (DirectoryNotFoundException ex)
            {

            }
            catch (Exception ex)
            {

            }
            #endregion
            if (bytes != null)
            {

                po.Templatefilebytes = bytes;
                using (MySqlConnection conn = new MySqlConnection(connectionString))
                {
                    conn.Open();
                    MySqlCommand command = new MySqlCommand("SRM_PurchasingOrdersExport_V2520", conn);
                    command.CommandType = CommandType.StoredProcedure;
                    command.Parameters.AddWithValue("_IdPo", IdPo);
                    command.Parameters.AddWithValue("_IdWarehouse", idWarehouse);
                    using (MySqlDataReader dr = command.ExecuteReader())
                    {
                        #region dr.Read
                        if (dr.Read())
                        {
                            po.IdWarehousePurchaseOrder = IdPo;
                            if (dr["Code"] != DBNull.Value)
                            {
                                po.Code = Convert.ToString(dr["Code"]);
                            }
                            if (dr["PODate"] != DBNull.Value)
                            {
                                po.CreatedIn = Convert.ToDateTime(dr["PODate"]);
                            }
                            if (dr["DeliveryDate"] != DBNull.Value)
                            {
                                po.DeliveryDate = Convert.ToDateTime(dr["DeliveryDate"]);
                            }
                            if (dr["Warehouse"] != DBNull.Value)
                            {
                                po.WarehouseName = Convert.ToString(dr["Warehouse"]);
                            }
                            if (dr["DEAddress"] != DBNull.Value)
                            {
                                po.DEAddress = Convert.ToString(dr["DEAddress"]);
                            }
                            if (dr["DEPostCode"] != DBNull.Value)
                            {
                                po.DEPostCode = Convert.ToString(dr["DEPostCode"]);
                            }
                            if (dr["DETelephone"] != DBNull.Value)
                            {
                                po.DETelephone = Convert.ToString(dr["DETelephone"]);
                            }
                            if (dr["DECity"] != DBNull.Value)
                            {
                                po.DECity = Convert.ToString(dr["DECity"]);
                            }
                            if (dr["DeliveryAddressCountry"] != DBNull.Value)
                            {
                                po.DeliveryAddressCountry = Convert.ToString(dr["DeliveryAddressCountry"]);
                            }
                            if (dr["SUPCity"] != DBNull.Value)
                            {
                                po.ArticleSupplier = new ArticleSupplier();
                                po.ArticleSupplier.City = Convert.ToString(dr["SUPCity"]);
                            }
                            if (dr["SUPPostCode"] != DBNull.Value)
                            {
                                po.ArticleSupplier.PostCode = Convert.ToString(dr["SUPPostCode"]);
                            }
                            if (dr["SUPAddress"] != DBNull.Value)
                            {
                                po.ArticleSupplier.Address = Convert.ToString(dr["SUPAddress"]);
                            }
                            if (dr["SUPName"] != DBNull.Value)
                            {
                                po.ArticleSupplier.Name = Convert.ToString(dr["SUPName"]);
                            }
                            if (dr["SUPPhone"] != DBNull.Value)
                            {
                                po.ArticleSupplier.Phone1 = Convert.ToString(dr["SUPPhone"]);
                            }
                            if (dr["SUPContactEmail"] != DBNull.Value)
                            {
                                po.ArticleSupplier.ContactEmail = Convert.ToString(dr["SUPContactEmail"]);
                            }
                            if (dr["SUPContactMobile"] != DBNull.Value)
                            {
                                po.ArticleSupplier.Phone2 = Convert.ToString(dr["SUPContactMobile"]);
                            }
                            if (dr["SUPContactPerson"] != DBNull.Value)
                            {
                                po.ArticleSupplier.ContactPerson = Convert.ToString(dr["SUPContactPerson"]);
                            }
                            if (dr["SUPCountry"] != DBNull.Value)
                            {
                                po.ArticleSupplier.Country = new Country();
                                po.ArticleSupplier.Country.Name = Convert.ToString(dr["SUPCountry"]);
                            }
                            if (dr["SupplierState"] != DBNull.Value)
                            {
                                po.ArticleSupplier.Country = new Country();
                                po.ArticleSupplier.Country.State = Convert.ToString(dr["SupplierState"]);
                            }

                            if (dr["DeliveryAddressState"] != DBNull.Value)
                            {
                                po.DeliveryAddressState = Convert.ToString(dr["DeliveryAddressState"]);
                            }
                            if (dr["Remarks"] != DBNull.Value)
                            {
                                po.Remarks = Convert.ToString(dr["Remarks"]);
                            }
                            if (dr["PurchasingContactName"] != DBNull.Value)
                            {
                                po.PurchasingContactName = Convert.ToString(dr["PurchasingContactName"]);
                            }
                            if (dr["PurchasingContactEmail"] != DBNull.Value)
                            {
                                po.PurchasingContactEmail = Convert.ToString(dr["PurchasingContactEmail"]);
                            }
                            if (dr["PlantCity"] != DBNull.Value)
                            {
                                po.Warehouse = new Warehouses();
                                po.Warehouse.Company = new Company();
                                po.Warehouse.Company.City = Convert.ToString(dr["PlantCity"]);
                            }
                            if (dr["PlantPhone"] != DBNull.Value)
                            {
                                po.Warehouse.Company.Telephone = Convert.ToString(dr["PlantPhone"]);
                            }
                            if (dr["PlantRegistrationNumber"] != DBNull.Value)
                            {
                                po.Warehouse.Company.RegisteredNumber = Convert.ToString(dr["PlantRegistrationNumber"]);
                            }
                            if (dr["PlantStreet"] != DBNull.Value)
                            {
                                po.Warehouse.Company.Address = Convert.ToString(dr["PlantStreet"]);
                            }
                            if (dr["PlantZipCode"] != DBNull.Value)
                            {
                                po.Warehouse.Company.ZipCode = Convert.ToString(dr["PlantZipCode"]);
                            }
                            if (dr["PlantRegisteredName"] != DBNull.Value)
                            {
                                po.Warehouse.Company.RegisteredName = Convert.ToString(dr["PlantRegisteredName"]);
                            }
                            if (dr["PlantState"] != DBNull.Value)
                            {
                                po.Warehouse.Company.Country = new Country();
                                po.Warehouse.Company.Country.State = Convert.ToString(dr["PlantState"]);
                            }
                            if (dr["PlantCountry"] != DBNull.Value)
                            {
                                po.Warehouse.Company.Country.Name = Convert.ToString(dr["PlantCountry"]);
                            }
                            if (dr["year"] != DBNull.Value)
                            {
                                po.Year = Convert.ToString(dr["year"]);
                            }
                            if (dr["Incoterms"] != DBNull.Value)
                            {
                                po.Incoterms = Convert.ToString(dr["Incoterms"]);
                            }
                            if (dr["Remarks"] != DBNull.Value)
                            {
                                po.Remarks = Convert.ToString(dr["Remarks"]);
                            }
                            if (dr["PaymentTerms"] != DBNull.Value)
                            {
                                po.PaymentTerms = Convert.ToString(dr["PaymentTerms"]);
                            }
                            if (dr["SupplierNotes"] != DBNull.Value)
                            {
                                po.SupplierComments = Convert.ToString(dr["SupplierNotes"]);
                            }
                            if (dr["CurrencyName"] != DBNull.Value)
                            {
                                po.Currency = new Currency();
                                po.Currency.Name = Convert.ToString(dr["CurrencyName"]);
                            }
                            if (dr["Observations"] != DBNull.Value)
                            {
                                po.Comments = Convert.ToString(dr["Observations"]);
                            }
                        }
                        #endregion
                        #region PurchasingOrdersItems                    
                        if (dr.NextResult())
                        {
                            po.WarehousePurchaseOrderItems = new List<WarehousePurchaseOrderItem>();
                            try
                            {
                                while (dr.Read())
                                {
                                    WarehousePurchaseOrderItem Item = new WarehousePurchaseOrderItem();
                                    if (dr["idWarehousePurchaseOrder"] != DBNull.Value)
                                    {
                                        if (po != null)
                                        {
                                            if (dr["idArticle"] != DBNull.Value)
                                            {
                                                Item.Article = new Article();
                                                Item.IdArticle = Convert.ToInt32(dr["idArticle"].ToString());
                                                Item.Article.IdArticle = Convert.ToInt32(dr["idArticle"].ToString());

                                                if (dr["Reference"] != DBNull.Value)
                                                {
                                                    Item.Article.Reference = Convert.ToString(dr["Reference"]);
                                                }
                                            }
                                            if (dr["Description"] != DBNull.Value)
                                            {
                                                Item.Description = Convert.ToString(dr["Description"]);
                                            }
                                            if (dr["Qty"] != DBNull.Value)
                                            {
                                                Item.Quantity = Convert.ToInt64(dr["Qty"].ToString());
                                            }
                                            if (dr["DiscountRate"] != DBNull.Value)
                                            {
                                                string discount = dr["DiscountRate"].ToString();
                                                Item.Discount = Convert.ToDouble(discount);
                                            }
                                            if (dr["UnitPrice"] != DBNull.Value)
                                            {
                                                if (Convert.ToDouble(dr["UnitPrice"]) == 0 && Convert.ToDouble(dr["DiscountRate"]) == 100)
                                                {
                                                    Item.UnitPrice = Convert.ToDouble(dr["UnitPrice"]);
                                                }
                                                else
                                                {
                                                    Item.UnitPrice = Convert.ToDouble(dr["UnitPrice"]);
                                                }
                                            }
                                            po.WarehousePurchaseOrderItems.Add(Item);
                                            if (Item.Discount != 0)
                                            {

                                                if (po.WarehousePurchaseOrderItems == null)
                                                    po.WarehousePurchaseOrderItems = new List<WarehousePurchaseOrderItem>();

                                                WarehousePurchaseOrderItem Items = new WarehousePurchaseOrderItem();
                                                if (dr["Description"] != DBNull.Value)
                                                {
                                                    Items.Description = "Discount";
                                                }
                                                if (dr["UnitPrice"] != DBNull.Value)
                                                {
                                                    if (Items.UnitPrice == 0 && Items.Discount == 100)
                                                    {
                                                        Items.UnitPrice = 0;
                                                    }
                                                    else
                                                    {
                                                        double discount = ((Item.UnitPrice * Item.Discount) / 100);
                                                        Items.UnitPrice = Math.Round((discount * Item.Quantity), 4, MidpointRounding.AwayFromZero);
                                                    }
                                                }
                                                if (dr["Qty"] != DBNull.Value)
                                                {
                                                    Items.Quantity = -1;
                                                }
                                                if (dr["DiscountRate"] != DBNull.Value)
                                                {
                                                    string discount = dr["DiscountRate"].ToString();
                                                    Items.Discount = Convert.ToDouble(discount);
                                                }
                                                //Added by chitra.girigosavi ON [2/04/2024] GEOS2-5406 Changes in Supplier PO Management(2/3)
                                                if (dr["TotalPrice"] != DBNull.Value)
                                                {
                                                    string TotalPrice = dr["TotalPrice"].ToString();
                                                    Items.TotalPrice = Convert.ToDouble(TotalPrice);
                                                }
                                                po.WarehousePurchaseOrderItems.Add(Items);
                                            }

                                        }
                                    }
                                }
                                #endregion
                            }
                            catch (Exception ex)
                            {

                            }

                        }
                    }
                }
            }
            return po;
        }
        #endregion

        public List<WarehousePurchaseOrder> SendPOMailForSelectedPO_V2520(string connectionString, List<WarehousePurchaseOrder> ListPurchaseOrder_Checked, string purchaseOrdersPath, string emailTemplatePath)
        {
            List<WarehousePurchaseOrder> warehousePurchaseOrderList = new List<WarehousePurchaseOrder>();
            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();
                foreach (var item in ListPurchaseOrder_Checked)
                {
                    MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetPendingPOByIdWarehousePurchaseOrder_V2390", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", item.IdWarehousePurchaseOrder);//9695

                    using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                    {
                        if (mySqlDataReader.Read())
                        {
                            try
                            {
                                WarehousePurchaseOrder warehousePurchaseOrder = new WarehousePurchaseOrder();

                                warehousePurchaseOrder.IdWarehousePurchaseOrder = item.IdWarehousePurchaseOrder;

                                if (mySqlDataReader["Code"] != DBNull.Value)
                                    warehousePurchaseOrder.Code = Convert.ToString(mySqlDataReader["Code"]);

                                if (mySqlDataReader["IdArticleSupplier"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                                    ArticleSupplier articleSupplier = new ArticleSupplier();
                                    articleSupplier.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                                    if (mySqlDataReader["Supplier"] != DBNull.Value)
                                        articleSupplier.Name = Convert.ToString(mySqlDataReader["Supplier"]);

                                    if (mySqlDataReader["SupplierContactPerson"] != DBNull.Value)
                                        articleSupplier.ContactPerson = Convert.ToString(mySqlDataReader["SupplierContactPerson"]);

                                    if (mySqlDataReader["SupplierContactEmail"] != DBNull.Value)
                                        articleSupplier.ContactEmail = Convert.ToString(mySqlDataReader["SupplierContactEmail"]);

                                    if (mySqlDataReader["Serie"] != DBNull.Value)
                                        articleSupplier.Serie = Convert.ToChar(mySqlDataReader["Serie"]);

                                    if (mySqlDataReader["IdCountry"] != DBNull.Value)
                                    {
                                        articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["IdCountry"]);

                                        articleSupplier.Country = new Country();
                                        articleSupplier.Country.IdCountry = (byte)articleSupplier.IdCountry;
                                        articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);

                                        if (mySqlDataReader["IdCountryGroup"] != DBNull.Value)
                                            articleSupplier.Country.IdCountryGroup = Convert.ToInt64(mySqlDataReader["IdCountryGroup"]);

                                        if (mySqlDataReader["SupplierCountryISO"] != DBNull.Value)
                                            articleSupplier.Country.Iso = Convert.ToString(mySqlDataReader["SupplierCountryISO"]);

                                    }

                                    if (mySqlDataReader["IdArticleSupplierType"] != DBNull.Value)
                                    {
                                        articleSupplier.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["IdArticleSupplierType"]);

                                        articleSupplier.ArticleSupplierType = new ArticleSupplierType();
                                        articleSupplier.ArticleSupplierType.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["IdArticleSupplierType"]);
                                        articleSupplier.ArticleSupplierType.Name = Convert.ToString(mySqlDataReader["ArticleSupplierType"]);
                                        articleSupplier.ArticleSupplierType.HtmlColor = Convert.ToString(mySqlDataReader["HtmlColor"]);
                                    }

                                    warehousePurchaseOrder.ArticleSupplier = articleSupplier;
                                }

                                if (mySqlDataReader["DeliveryDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["deliveryDate"]) != DateTime.MinValue)
                                {
                                    warehousePurchaseOrder.DeliveryDate = Convert.ToDateTime(mySqlDataReader["deliveryDate"]);
                                }

                                if (mySqlDataReader["AttachedPO"] != DBNull.Value)
                                    warehousePurchaseOrder.AttachedPO = Convert.ToByte(mySqlDataReader["AttachedPO"]);

                                if (mySqlDataReader["IdPaymentType"] != DBNull.Value)
                                    warehousePurchaseOrder.IdPaymentType = Convert.ToInt64(mySqlDataReader["IdPaymentType"]);

                                if (mySqlDataReader["ReminderEmailDate"] != DBNull.Value)
                                    warehousePurchaseOrder.ReminderEmailDate = Convert.ToDateTime(mySqlDataReader["ReminderEmailDate"]);

                                if (mySqlDataReader["CreatedIn"] != DBNull.Value)
                                    warehousePurchaseOrder.CreatedIn = Convert.ToDateTime(mySqlDataReader["CreatedIn"]);

                                if (mySqlDataReader["ModifiedIn"] != DBNull.Value)
                                    warehousePurchaseOrder.ModifiedIn = Convert.ToDateTime(mySqlDataReader["ModifiedIn"]);

                                if (mySqlDataReader["Comments"] != DBNull.Value)
                                    warehousePurchaseOrder.Comments = Convert.ToString(mySqlDataReader["Comments"]);

                                if (mySqlDataReader["IsClosed"] != DBNull.Value)
                                    warehousePurchaseOrder.IsClosed = Convert.ToByte(mySqlDataReader["IsClosed"]);

                                if (mySqlDataReader["CreatedBy"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.CreatedBy = Convert.ToInt64(mySqlDataReader["CreatedBy"]);
                                    warehousePurchaseOrder.Creator = new People();
                                    warehousePurchaseOrder.Creator.IdPerson = Convert.ToInt32(mySqlDataReader["CreatedBy"].ToString());
                                    warehousePurchaseOrder.Creator.Name = mySqlDataReader["CreatorName"].ToString();
                                    warehousePurchaseOrder.Creator.Surname = mySqlDataReader["CreatorSurname"].ToString();
                                }

                                if (mySqlDataReader["ModifiedBy"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.ModifiedBy = Convert.ToInt64(mySqlDataReader["ModifiedBy"]);
                                    warehousePurchaseOrder.Modifier = new People();
                                    warehousePurchaseOrder.Modifier.IdPerson = Convert.ToInt32(mySqlDataReader["ModifiedBy"].ToString());
                                    warehousePurchaseOrder.Modifier.Name = mySqlDataReader["ModifierName"].ToString();
                                    warehousePurchaseOrder.Modifier.Surname = mySqlDataReader["ModifierSurname"].ToString();
                                }

                                if (mySqlDataReader["ReasonClosed"] != DBNull.Value)
                                    warehousePurchaseOrder.ReasonClosed = Convert.ToString(mySqlDataReader["ReasonClosed"]);

                                if (mySqlDataReader["IdWarehouse"] != DBNull.Value)
                                    warehousePurchaseOrder.IdWarehouse = Convert.ToInt64(mySqlDataReader["IdWarehouse"]);

                                if (mySqlDataReader["IdCurrency"] != DBNull.Value)
                                    warehousePurchaseOrder.IdCurrency = Convert.ToByte(mySqlDataReader["IdCurrency"]);

                                if (mySqlDataReader["IdWorkflowStatus"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                    warehousePurchaseOrder.WorkflowStatus = new WorkflowStatus();
                                    warehousePurchaseOrder.WorkflowStatus.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                    warehousePurchaseOrder.WorkflowStatus.Name = Convert.ToString(mySqlDataReader["Status"]);
                                    warehousePurchaseOrder.WorkflowStatus.HtmlColor = Convert.ToString(mySqlDataReader["StatusHtmlColor"]);
                                }

                                if (mySqlDataReader["IdAssignee"] != DBNull.Value)
                                    warehousePurchaseOrder.IdAssignee = Convert.ToUInt32(mySqlDataReader["IdAssignee"]);

                                if (mySqlDataReader["IdApprover"] != DBNull.Value)
                                    warehousePurchaseOrder.IdApprover = Convert.ToUInt32(mySqlDataReader["IdApprover"]);

                                if (mySqlDataReader["AssigneeEmail"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.AssigneeEmail = Convert.ToString(mySqlDataReader["AssigneeEmail"]);
                                }
                                if (mySqlDataReader["CreatorEmail"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.CreatorEmail = Convert.ToString(mySqlDataReader["CreatorEmail"]);
                                }
                                string HTMLFileName = null;
                                if (File.Exists(string.Format("{0}{1}SupplierPurchaseOrderRequestMailFormat_{2}-{3}.html", emailTemplatePath, @"\", warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower(), warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToUpper())))
                                {
                                    HTMLFileName = string.Format("SupplierPurchaseOrderRequestMailFormat_{0}-{1}.html", warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower(), warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToUpper());
                                }
                                else if (File.Exists(string.Format("{0}{1}SupplierPurchaseOrderRequestMailFormat.html", emailTemplatePath, @"\")))
                                {
                                    HTMLFileName = "SupplierPurchaseOrderRequestMailFormat.html";
                                }
                                if (HTMLFileName != null)
                                {
                                    StringBuilder emailbody = new StringBuilder();
                                    string text = ReadMailTemplate(HTMLFileName, emailTemplatePath);

                                    if (string.IsNullOrEmpty(warehousePurchaseOrder.ArticleSupplier.ContactPerson))
                                    {
                                        text = text.Replace("[Supplier_Name]", "Supplier");
                                    }
                                    else
                                    {
                                        text = text.Replace("[Supplier_Name]", warehousePurchaseOrder.ArticleSupplier.ContactPerson);
                                    }
                                    text = text.Replace("[PO_Code]", warehousePurchaseOrder.Code);


                                    #region 1 rajashri GEOS2-5375 && GEOS2-5376
                                    #region  rajashri GEOS2-5375    
                                    string concatenatedValues = string.Empty;
                                    List<WarehousePurchaseOrder> WarehousePurchaseOrder1;
                                    if (warehousePurchaseOrder.DeliveryDate != null)
                                    {
                                        WarehousePurchaseOrder1 = GetWarehouseHolidays_V2520(connectionString, warehousePurchaseOrder.DeliveryDate, warehousePurchaseOrder.IdWarehouse, warehousePurchaseOrder.IdWarehousePurchaseOrder);
                                    }
                                    else
                                    {
                                        WarehousePurchaseOrder1 = new List<WarehousePurchaseOrder>();
                                    }
                                    if (WarehousePurchaseOrder1 != null && WarehousePurchaseOrder1.Count > 0)
                                    {
                                        CultureInfo cultureInfo = CultureInfo.CurrentCulture;

                                        var holidays = WarehousePurchaseOrder1.Select(h => new
                                        {
                                            StartDate = h.WarehouseHolidayStartdate?.Date.ToString("d", cultureInfo),
                                            EndDate = h.WarehouseHolidayEndDate?.Date.ToString("d", cultureInfo),
                                            Type = h.Holidaytype
                                        }).ToList();

                                        // var holidays = WarehousePurchaseOrder1.Select(h => new { StartDate = h.WarehouseHolidayStartdate?.Date, EndDate = h.WarehouseHolidayEndDate?.Date, Type = h.Holidaytype }).ToList();
                                        if (holidays.Count == 1)
                                        {
                                            var holiday = holidays.First();
                                            concatenatedValues = $"<tr style=\"margin-top:5px\">" +
                                                                $"<td colspan=\"2\" style=\"background: white; font-weight: 700; border-top: 4px solid grey; Padding:5px\">" +
                                                                $"</tr>" +
                                                                $"<tr style=\"margin-top:5px\">" +
                                                                $"<td colspan=\"2\" style=\"background: #d1d8db; color: black; font-weight: 700; border-top: 4px solid grey; Padding:20px\">";
                                            if (warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower() == "es")
                                            {
                                                concatenatedValues += $"Tenga en cuenta que el almacén({WarehousePurchaseOrder1.FirstOrDefault()?.Name}) estará cerrado el ";
                                                if (holiday.StartDate == holiday.EndDate)
                                                {
                                                    concatenatedValues += $"{holiday.StartDate} debido a un día festivo \"{holiday.Type}\"";
                                                }
                                                else
                                                {
                                                    concatenatedValues += $"{holiday.StartDate},{holiday.EndDate} debido a un día festivo \"{holiday.Type}\"";
                                                }
                                            }
                                            else
                                            {
                                                concatenatedValues += $"Please be Informed that warehouse({WarehousePurchaseOrder1.FirstOrDefault()?.Name}) will be closed on ";

                                                if (holiday.StartDate == holiday.EndDate)
                                                {
                                                    concatenatedValues += $"{holiday.StartDate} due to \"{holiday.Type}\" holiday";
                                                }
                                                else
                                                {
                                                    concatenatedValues += $"{holiday.StartDate},{holiday.EndDate} due to \"{holiday.Type}\" holiday";
                                                }
                                            }

                                            concatenatedValues += $"</td></tr>";

                                        }
                                        else
                                        {

                                            //var groupesHolidays = holidays.GroupBy(h => h.Type).Select(g => new {
                                            //    Type = g.Key,
                                            //    Dates = g.Select(h =>
                                            //    {
                                            //        if (h.StartDate == h.EndDate)
                                            //        {
                                            //            return h.StartDate?.ToShortDateString();
                                            //        }
                                            //        else if(
                                            //        {
                                            //            return $"{h.StartDate?.ToShortDateString()} , {h.EndDate?.ToShortDateString()}";
                                            //        }
                                            //    }).ToList()
                                            //});

                                            var groupesHolidays = holidays.GroupBy(h => h.Type).Select(g => new
                                            {
                                                Type = g.Key,
                                                Dates = g.Select(h =>
                                                {
                                                    if (h.StartDate == h.EndDate)
                                                    {
                                                        return h.StartDate;
                                                    }
                                                    else if (h.StartDate != null && h.EndDate != null)
                                                    {
                                                        return $"{h.StartDate} , {h.EndDate}";
                                                    }
                                                    else if (h.StartDate != null)
                                                    {
                                                        return h.StartDate;
                                                    }
                                                    else if (h.EndDate != null)
                                                    {
                                                        return h.EndDate;
                                                    }
                                                    else
                                                    {
                                                        return ""; // Handle case where both StartDate and EndDate are null
                                                    }
                                                }).ToList()
                                            });


                                            concatenatedValues = $"<tr style=\"margin-top:5px\">" +
                                             $"<td colspan=\"2\" style=\"background: white; font-weight: 700; border-top: 4px solid grey; Padding:5px\">";
                                            int groupCount = groupesHolidays.Count();
                                            if (groupCount > 0)
                                            {
                                                if (warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower() == "es")
                                                {
                                                    concatenatedValues += $"Tenga en cuenta que el almacén({WarehousePurchaseOrder1.FirstOrDefault()?.Name}) estará cerrado ";
                                                }
                                                else
                                                {
                                                    concatenatedValues += $"Please be Informed that warehouse({WarehousePurchaseOrder1.FirstOrDefault()?.Name}) will be closed  ";
                                                }
                                            }

                                            int currentIndex = 0;

                                            foreach (var group in groupesHolidays)
                                            {

                                                if (warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower() == "es")
                                                {
                                                    concatenatedValues += $" en  {string.Join(", ", group.Dates)} debido a un día festivo  \"{group.Type}\"";
                                                    if (currentIndex < groupCount - 1)
                                                    {
                                                        concatenatedValues += " Y ";
                                                    }
                                                }
                                                else
                                                {
                                                    concatenatedValues += $" on  {string.Join(", ", group.Dates)} due to \"{group.Type}\" holiday";
                                                    if (currentIndex < groupCount - 1)
                                                    {
                                                        concatenatedValues += (currentIndex % 2 == 0) ? ", " : " and ";
                                                    }
                                                }
                                                currentIndex++;
                                            }


                                            concatenatedValues += $"</td></tr>";

                                        }
                                        text = text.Replace("[footerdata]", concatenatedValues);
                                    }
                                    #endregion
                                    #region GEOS-5376
                                    else
                                    {

                                        #region CustomMessageFooter

                                        List<Warehouses> customHoliday = GetCustomMessageforHoliday_PORequestMail_V2500(connectionString, warehousePurchaseOrder.IdWarehouse);
                                        if (customHoliday != null && customHoliday.Count > 0)
                                        {
                                            var customMessages = string.Join(", ", customHoliday.Select(h => h.CustomMessage));
                                            var customStartDate = string.Join(", ", customHoliday.Select(h => h.ImportantNoticeStartDate?.Date.ToShortDateString()));
                                            var customEndDate = string.Join(", ", customHoliday.Select(h => h.ImportantNoticeEndDate?.Date.ToShortDateString()));

                                            CultureInfo cultureInfo = CultureInfo.CurrentCulture;
                                            customStartDate = customStartDate.ToString(cultureInfo);
                                            customEndDate = customEndDate.ToString(cultureInfo);


                                            if (!string.IsNullOrEmpty(customStartDate) && string.IsNullOrEmpty(customEndDate))
                                            {
                                                concatenatedValues = $"<tr style=\"margin-top:5px\">" +
                                                                      $"<td colspan=\"2\" style=\"background: white;  font-weight: 700; border-top: 4px solid grey;Padding:5px \">" +
                                                                      $"</tr>" +
                                                                      $"<tr style=\"margin-top:5px\">" +
                                                                      $"<td colspan=\"2\" style=\"background: #d1d8db; color: black; font-weight: 700; border-top: 4px solid grey;Padding:20px \">" +
                                                                      $"{customMessages} from " +
                                                                      $"\"{customStartDate}\"" + "</td>" +
                                                                      $"</tr>";
                                            }
                                            else if (string.IsNullOrEmpty(customStartDate) && !string.IsNullOrEmpty(customEndDate))
                                            {
                                                concatenatedValues = $"<tr style=\"margin-top:5px\">" +
                                                                      $"<td colspan=\"2\" style=\"background: white;  font-weight: 700; border-top: 4px solid grey;Padding:5px \">" +
                                                                      $"</tr>" +
                                                                      $"<tr style=\"margin-top:5px\">" +
                                                                      $"<td colspan=\"2\" style=\"background: #d1d8db; color: black; font-weight: 700; border-top: 4px solid grey;Padding:20px \">" +
                                                                      $"{customMessages} " +
                                                                      $" till " +
                                                                      $"\"{customEndDate}\"" + "</td>" +
                                                                      $"</tr>";
                                            }
                                            else if (!string.IsNullOrEmpty(customStartDate) && !string.IsNullOrEmpty(customEndDate))
                                            {
                                                concatenatedValues = $"<tr style=\"margin-top:5px\">" +
                                                                      $"<td colspan=\"2\" style=\"background: white;  font-weight: 700; border-top: 4px solid grey;Padding:5px \">" +
                                                                      $"</tr>" +
                                                                      $"<tr style=\"margin-top:5px\">" +
                                                                      $"<td colspan=\"2\" style=\"background: #d1d8db; color: black; font-weight: 700; border-top: 4px solid grey;Padding:20px \">" +
                                                                      $"{customMessages} from " +
                                                                      $"\"{customStartDate}\"" + " to " +
                                                                      $"\"{customEndDate}\"" + "</td>" +
                                                                      $"</tr>";
                                            }

                                            else
                                            {
                                                concatenatedValues = $"<tr style=\"margin-top:5px\">" +
                                                                     $"<td colspan=\"2\" style=\"background: white;  font-weight: 700; border-top: 4px solid grey;Padding:5px \">" +
                                                                     $"</tr>" +
                                                                     $"<tr style=\"margin-top:5px\">" +
                                                                     $"<td colspan=\"2\" style=\"background: #d1d8db; color: black; font-weight: 700; border-top: 4px solid grey;Padding:20px \">" +
                                                                     $"{customMessages}</td>" +
                                                                     $"</tr>";
                                            }

                                        }
                                        else
                                        {
                                            concatenatedValues = string.Empty;
                                        }
                                        text = text.Replace("[footerdata]", concatenatedValues);
                                        #endregion
                                    }
                                    #endregion

                                    #endregion
                                    emailbody.Append(text);

                                    warehousePurchaseOrder.EmailBody = emailbody.ToString();
                                }

                                warehousePurchaseOrder.AttachPdf = warehousePurchaseOrder.CreatedIn.Year + @"\" + warehousePurchaseOrder.Code + @"\01 Purchase Order\PO_" + warehousePurchaseOrder.Code + ".pdf";

                                warehousePurchaseOrder.AttachmentBytes = GetPurchaseOrderPdf(purchaseOrdersPath, warehousePurchaseOrder.AttachPdf);
                                warehousePurchaseOrderList.Add(warehousePurchaseOrder);

                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error SendPOMailForSelectedPO_V2520(idWarehousePurchaseOrder-{0}), ErrorMessage- {1} ", item.IdWarehousePurchaseOrder, ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }

                        }
                    }
                }
            }

            return warehousePurchaseOrderList;
        }
        public List<WarehousePurchaseOrder> GetWarehouseHolidays_V2520(string connectionString, DateTime? deliverydate, long? idWarehouse, long IdWarehousePurchaseOrder)
        {
            WarehousePurchaseOrder warehousePurchaseOrder = null;
            List<WarehousePurchaseOrder> warehouseHolidays = new List<WarehousePurchaseOrder>();
            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetPORequestMailWarehouseHolidays_V2520", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("Deliverydate", deliverydate.Value.Date);
                mySqlCommand.Parameters.AddWithValue("_IdWarehouse", idWarehouse);
                mySqlCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", IdWarehousePurchaseOrder);

                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    while (mySqlDataReader.Read())
                    {
                        try
                        {
                            warehousePurchaseOrder = new WarehousePurchaseOrder();

                            warehousePurchaseOrder.IdWarehouse = idWarehouse;

                            if (mySqlDataReader["IdWarehouse"] != DBNull.Value)
                                warehousePurchaseOrder.IdWarehouse = Convert.ToInt32(mySqlDataReader["IdWarehouse"]);

                            if (mySqlDataReader["DeliveryDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["deliveryDate"]) != DateTime.MinValue)
                            {
                                warehousePurchaseOrder.DeliveryDate = Convert.ToDateTime(mySqlDataReader["deliveryDate"]);
                            }
                            if (mySqlDataReader["WarehouseHolidayStartdate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["WarehouseHolidayStartdate"]) != DateTime.MinValue)
                            {
                                warehousePurchaseOrder.WarehouseHolidayStartdate = Convert.ToDateTime(mySqlDataReader["WarehouseHolidayStartdate"]);
                            }
                            if (mySqlDataReader["WarehouseHolidayEndDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["WarehouseHolidayEndDate"]) != DateTime.MinValue)
                            {
                                warehousePurchaseOrder.WarehouseHolidayEndDate = Convert.ToDateTime(mySqlDataReader["WarehouseHolidayEndDate"]);
                            }

                            if (mySqlDataReader["Value"] != DBNull.Value)
                                warehousePurchaseOrder.Holidaytype = Convert.ToString(mySqlDataReader["Value"]);

                            if (mySqlDataReader["Code"] != DBNull.Value)
                                warehousePurchaseOrder.Code = Convert.ToString(mySqlDataReader["Code"]);
                            if (mySqlDataReader["Name"] != DBNull.Value)
                                warehousePurchaseOrder.Name = Convert.ToString(mySqlDataReader["Name"]);
                            warehouseHolidays.Add(warehousePurchaseOrder);

                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetWarehouseHolidays_V2520(idWarehousePurchaseOrder-{0}), ErrorMessage- {1} ", idWarehouse, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            Log4NetLogger.Logger.Log("Executed GetWarehouseHolidays_V2520().", category: Category.Info, priority: Priority.Low);
            return warehouseHolidays;
        }
        public WarehousePurchaseOrder GetPendingPOByIdWarehousePurchaseOrder_V2520(string connectionString, Int64 idWarehousePurchaseOrder, string idShippingAddress, string purchaseOrdersPath, string emailTemplatePath, string countryIconFilePath)
        {
            WarehousePurchaseOrder warehousePurchaseOrder = null;

            Country country = new Country();
            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();
                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetPendingPOByIdWarehousePurchaseOrder_V2420", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", idWarehousePurchaseOrder);

                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    if (mySqlDataReader.Read())
                    {
                        try
                        {

                            warehousePurchaseOrder = new WarehousePurchaseOrder();
                            List<WarehouseShippingAddress> warehouseShippingAddresses = new List<WarehouseShippingAddress>();


                            warehousePurchaseOrder.IdWarehousePurchaseOrder = idWarehousePurchaseOrder;

                            if (mySqlDataReader["Code"] != DBNull.Value)
                                warehousePurchaseOrder.Code = Convert.ToString(mySqlDataReader["Code"]);

                            if (mySqlDataReader["IdArticleSupplier"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                                ArticleSupplier articleSupplier = new ArticleSupplier();
                                articleSupplier.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                                if (mySqlDataReader["Supplier"] != DBNull.Value)
                                    articleSupplier.Name = Convert.ToString(mySqlDataReader["Supplier"]);

                                if (mySqlDataReader["SupplierContactPerson"] != DBNull.Value)
                                    articleSupplier.ContactPerson = Convert.ToString(mySqlDataReader["SupplierContactPerson"]);

                                if (mySqlDataReader["SupplierContactEmail"] != DBNull.Value)
                                    articleSupplier.ContactEmail = Convert.ToString(mySqlDataReader["SupplierContactEmail"]);

                                if (mySqlDataReader["Serie"] != DBNull.Value)
                                    articleSupplier.Serie = Convert.ToChar(mySqlDataReader["Serie"]);

                                if (mySqlDataReader["DeliveryDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["DeliveryDate"]) != DateTime.MinValue)
                                {
                                    warehousePurchaseOrder.DeliveryDate = Convert.ToDateTime(mySqlDataReader["DeliveryDate"]);
                                }
                                if (mySqlDataReader["IdCountry"] != DBNull.Value)
                                {
                                    articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["IdCountry"]);

                                    articleSupplier.Country = new Country();
                                    articleSupplier.Country.IdCountry = (byte)articleSupplier.IdCountry;
                                    articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);

                                    if (mySqlDataReader["SupplierCountryISO"] != DBNull.Value)
                                    {
                                        articleSupplier.Country.Iso = Convert.ToString(mySqlDataReader["SupplierCountryISO"]);
                                        byte[] bytes = null;
                                        bytes = GetCountryIconFileInBytes(articleSupplier.Country.Iso, countryIconFilePath);
                                        articleSupplier.Country.CountryIconBytes = bytes;
                                    }

                                    if (mySqlDataReader["IdCountryGroup"] != DBNull.Value)
                                        articleSupplier.Country.IdCountryGroup = Convert.ToInt64(mySqlDataReader["IdCountryGroup"]);
                                }

                                if (mySqlDataReader["IdArticleSupplierType"] != DBNull.Value)
                                {
                                    articleSupplier.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["IdArticleSupplierType"]);

                                    articleSupplier.ArticleSupplierType = new ArticleSupplierType();
                                    articleSupplier.ArticleSupplierType.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["IdArticleSupplierType"]);
                                    articleSupplier.ArticleSupplierType.Name = Convert.ToString(mySqlDataReader["ArticleSupplierType"]);
                                    articleSupplier.ArticleSupplierType.HtmlColor = Convert.ToString(mySqlDataReader["HtmlColor"]);
                                }

                                warehousePurchaseOrder.ArticleSupplier = articleSupplier;
                            }
                            //[rdixit][GEOS2-4455][28.06.2023] 
                            //if (mySqlDataReader["DeliveryDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["deliveryDate"]) != DateTime.MinValue)
                            //{
                            //    warehousePurchaseOrder.DeliveryDate = Convert.ToDateTime(mySqlDataReader["deliveryDate"]);
                            //}

                            if (mySqlDataReader["AttachedPO"] != DBNull.Value)
                                warehousePurchaseOrder.AttachedPO = Convert.ToByte(mySqlDataReader["AttachedPO"]);

                            if (mySqlDataReader["IdPaymentType"] != DBNull.Value)
                                warehousePurchaseOrder.IdPaymentType = Convert.ToInt64(mySqlDataReader["IdPaymentType"]);

                            if (mySqlDataReader["ReminderEmailDate"] != DBNull.Value)
                                warehousePurchaseOrder.ReminderEmailDate = Convert.ToDateTime(mySqlDataReader["ReminderEmailDate"]);

                            if (mySqlDataReader["CreatedIn"] != DBNull.Value)
                                warehousePurchaseOrder.CreatedIn = Convert.ToDateTime(mySqlDataReader["CreatedIn"]);

                            if (mySqlDataReader["ModifiedIn"] != DBNull.Value)
                                warehousePurchaseOrder.ModifiedIn = Convert.ToDateTime(mySqlDataReader["ModifiedIn"]);

                            if (mySqlDataReader["Comments"] != DBNull.Value)
                                warehousePurchaseOrder.Comments = Convert.ToString(mySqlDataReader["Comments"]);

                            //[pramod.misal][GEOS2-4449][04-06-2023]warehouseShippingAddress
                            if (mySqlDataReader["Observations"] != DBNull.Value)
                                warehousePurchaseOrder.SupplierComments = Convert.ToString(mySqlDataReader["Observations"]);

                            if (mySqlDataReader["IsClosed"] != DBNull.Value)
                                warehousePurchaseOrder.IsClosed = Convert.ToByte(mySqlDataReader["IsClosed"]);

                            if (mySqlDataReader["CreatedBy"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.CreatedBy = Convert.ToInt64(mySqlDataReader["CreatedBy"]);
                                warehousePurchaseOrder.Creator = new People();
                                warehousePurchaseOrder.Creator.IdPerson = Convert.ToInt32(mySqlDataReader["CreatedBy"].ToString());
                                warehousePurchaseOrder.Creator.Name = mySqlDataReader["CreatorName"].ToString();
                                warehousePurchaseOrder.Creator.Surname = mySqlDataReader["CreatorSurname"].ToString();
                            }

                            if (mySqlDataReader["ModifiedBy"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.ModifiedBy = Convert.ToInt64(mySqlDataReader["ModifiedBy"]);
                                warehousePurchaseOrder.Modifier = new People();
                                warehousePurchaseOrder.Modifier.IdPerson = Convert.ToInt32(mySqlDataReader["ModifiedBy"].ToString());
                                warehousePurchaseOrder.Modifier.Name = mySqlDataReader["ModifierName"].ToString();
                                warehousePurchaseOrder.Modifier.Surname = mySqlDataReader["ModifierSurname"].ToString();
                            }

                            if (mySqlDataReader["ReasonClosed"] != DBNull.Value)
                                warehousePurchaseOrder.ReasonClosed = Convert.ToString(mySqlDataReader["ReasonClosed"]);

                            if (mySqlDataReader["IdWarehouse"] != DBNull.Value)
                                warehousePurchaseOrder.IdWarehouse = Convert.ToInt64(mySqlDataReader["IdWarehouse"]);

                            if (mySqlDataReader["IdShippingAddress"] != DBNull.Value)
                                warehousePurchaseOrder.IdShippingAddress = Convert.ToInt64(mySqlDataReader["IdShippingAddress"]);

                            if (mySqlDataReader["IdCurrency"] != DBNull.Value)
                                warehousePurchaseOrder.IdCurrency = Convert.ToByte(mySqlDataReader["IdCurrency"]);

                            if (mySqlDataReader["IdWorkflowStatus"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                warehousePurchaseOrder.WorkflowStatus = new WorkflowStatus();
                                warehousePurchaseOrder.WorkflowStatus.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                warehousePurchaseOrder.WorkflowStatus.Name = Convert.ToString(mySqlDataReader["Status"]);
                                warehousePurchaseOrder.WorkflowStatus.HtmlColor = Convert.ToString(mySqlDataReader["StatusHtmlColor"]);
                            }

                            if (mySqlDataReader["IdAssignee"] != DBNull.Value)
                                warehousePurchaseOrder.IdAssignee = Convert.ToUInt32(mySqlDataReader["IdAssignee"]);

                            if (mySqlDataReader["IdApprover"] != DBNull.Value)
                                warehousePurchaseOrder.IdApprover = Convert.ToUInt32(mySqlDataReader["IdApprover"]);

                            if (mySqlDataReader["AssigneeEmail"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.AssigneeEmail = Convert.ToString(mySqlDataReader["AssigneeEmail"]);
                            }
                            if (mySqlDataReader["CreatorEmail"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.CreatorEmail = Convert.ToString(mySqlDataReader["CreatorEmail"]);
                            }

                            string HTMLFileName = null;
                            if (File.Exists(string.Format("{0}{1}SupplierPurchaseOrderRequestMailFormat_{2}-{3}.html", emailTemplatePath, @"\", warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower(), warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToUpper())))
                            {
                                HTMLFileName = string.Format("SupplierPurchaseOrderRequestMailFormat_{0}-{1}.html", warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower(), warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToUpper());
                            }
                            else if (File.Exists(string.Format("{0}{1}SupplierPurchaseOrderRequestMailFormat.html", emailTemplatePath, @"\")))
                            {
                                HTMLFileName = "SupplierPurchaseOrderRequestMailFormat.html";
                            }
                            if (HTMLFileName != null)
                            {
                                StringBuilder emailbody = new StringBuilder();
                                string text = ReadMailTemplate(HTMLFileName, emailTemplatePath);

                                if (string.IsNullOrEmpty(warehousePurchaseOrder.ArticleSupplier.ContactPerson))
                                {
                                    text = text.Replace("[Supplier_Name]", "Supplier");
                                }
                                else
                                {
                                    text = text.Replace("[Supplier_Name]", warehousePurchaseOrder.ArticleSupplier.ContactPerson);
                                }
                                text = text.Replace("[PO_Code]", warehousePurchaseOrder.Code);

                                #region 2 rajashri GEOS2-5375 && GEOS2-5376
                                #region  rajashri GEOS2-5375    
                                string concatenatedValues = string.Empty;
                                List<WarehousePurchaseOrder> WarehousePurchaseOrder1;
                                if (warehousePurchaseOrder.DeliveryDate != null)
                                {
                                    WarehousePurchaseOrder1 = GetWarehouseHolidays_V2520(connectionString, warehousePurchaseOrder.DeliveryDate, warehousePurchaseOrder.IdWarehouse, warehousePurchaseOrder.IdWarehousePurchaseOrder);
                                }
                                else
                                {
                                    WarehousePurchaseOrder1 = new List<WarehousePurchaseOrder>();
                                }
                                if (WarehousePurchaseOrder1 != null && WarehousePurchaseOrder1.Count > 0)
                                {
                                    CultureInfo cultureInfo = CultureInfo.CurrentCulture;

                                    var holidays = WarehousePurchaseOrder1.Select(h => new
                                    {
                                        StartDate = h.WarehouseHolidayStartdate?.Date.ToString("d", cultureInfo),
                                        EndDate = h.WarehouseHolidayEndDate?.Date.ToString("d", cultureInfo),
                                        Type = h.Holidaytype
                                    }).ToList();

                                    // var holidays = WarehousePurchaseOrder1.Select(h => new { StartDate = h.WarehouseHolidayStartdate?.Date, EndDate = h.WarehouseHolidayEndDate?.Date, Type = h.Holidaytype }).ToList();
                                    if (holidays.Count == 1)
                                    {
                                        var holiday = holidays.First();
                                        concatenatedValues = $"<tr style=\"margin-top:5px\">" +
                                                            $"<td colspan=\"2\" style=\"background: white; font-weight: 700; border-top: 4px solid grey; Padding:5px\">" +
                                                            $"</tr>" +
                                                            $"<tr style=\"margin-top:5px\">" +
                                                            $"<td colspan=\"2\" style=\"background: #d1d8db; color: black; font-weight: 700; border-top: 4px solid grey; Padding:20px\">";
                                        if (warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower() == "es")
                                        {
                                            concatenatedValues += $"Tenga en cuenta que el almacén({WarehousePurchaseOrder1.FirstOrDefault()?.Name}) estará cerrado el ";
                                            if (holiday.StartDate == holiday.EndDate)
                                            {
                                                concatenatedValues += $"{holiday.StartDate} debido a un día festivo \"{holiday.Type}\"";
                                            }
                                            else
                                            {
                                                concatenatedValues += $"{holiday.StartDate},{holiday.EndDate} debido a un día festivo \"{holiday.Type}\"";
                                            }
                                        }
                                        else
                                        {
                                            concatenatedValues += $"Please be Informed that warehouse({WarehousePurchaseOrder1.FirstOrDefault()?.Name}) will be closed on ";

                                            if (holiday.StartDate == holiday.EndDate)
                                            {
                                                concatenatedValues += $"{holiday.StartDate} due to \"{holiday.Type}\" holiday";
                                            }
                                            else
                                            {
                                                concatenatedValues += $"{holiday.StartDate},{holiday.EndDate} due to \"{holiday.Type}\" holiday";
                                            }
                                        }

                                        concatenatedValues += $"</td></tr>";

                                    }
                                    else
                                    {

                                        //var groupesHolidays = holidays.GroupBy(h => h.Type).Select(g => new {
                                        //    Type = g.Key,
                                        //    Dates = g.Select(h =>
                                        //    {
                                        //        if (h.StartDate == h.EndDate)
                                        //        {
                                        //            return h.StartDate?.ToShortDateString();
                                        //        }
                                        //        else if(
                                        //        {
                                        //            return $"{h.StartDate?.ToShortDateString()} , {h.EndDate?.ToShortDateString()}";
                                        //        }
                                        //    }).ToList()
                                        //});

                                        var groupesHolidays = holidays.GroupBy(h => h.Type).Select(g => new
                                        {
                                            Type = g.Key,
                                            Dates = g.Select(h =>
                                            {
                                                if (h.StartDate == h.EndDate)
                                                {
                                                    return h.StartDate;
                                                }
                                                else if (h.StartDate != null && h.EndDate != null)
                                                {
                                                    return $"{h.StartDate} , {h.EndDate}";
                                                }
                                                else if (h.StartDate != null)
                                                {
                                                    return h.StartDate;
                                                }
                                                else if (h.EndDate != null)
                                                {
                                                    return h.EndDate;
                                                }
                                                else
                                                {
                                                    return ""; // Handle case where both StartDate and EndDate are null
                                                }
                                            }).ToList()
                                        });


                                        concatenatedValues = $"<tr style=\"margin-top:5px\">" +
                                         $"<td colspan=\"2\" style=\"background: white; font-weight: 700; border-top: 4px solid grey; Padding:5px\">";
                                        int groupCount = groupesHolidays.Count();
                                        if (groupCount > 0)
                                        {
                                            if (warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower() == "es")
                                            {
                                                concatenatedValues += $"Tenga en cuenta que el almacén({WarehousePurchaseOrder1.FirstOrDefault()?.Name}) estará cerrado ";
                                            }
                                            else
                                            {
                                                concatenatedValues += $"Please be Informed that warehouse({WarehousePurchaseOrder1.FirstOrDefault()?.Name}) will be closed  ";
                                            }
                                        }

                                        int currentIndex = 0;

                                        foreach (var group in groupesHolidays)
                                        {

                                            if (warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower() == "es")
                                            {
                                                concatenatedValues += $" en  {string.Join(", ", group.Dates)} debido a un día festivo  \"{group.Type}\"";
                                                if (currentIndex < groupCount - 1)
                                                {
                                                    concatenatedValues += " Y ";
                                                }
                                            }
                                            else
                                            {
                                                concatenatedValues += $" on  {string.Join(", ", group.Dates)} due to \"{group.Type}\" holiday";
                                                if (currentIndex < groupCount - 1)
                                                {
                                                    concatenatedValues += (currentIndex % 2 == 0) ? ", " : " and ";
                                                }
                                            }
                                            currentIndex++;
                                        }


                                        concatenatedValues += $"</td></tr>";

                                    }
                                    text = text.Replace("[footerdata]", concatenatedValues);
                                }
                                #endregion
                                #region GEOS-5376
                                else
                                {

                                    #region CustomMessageFooter

                                    List<Warehouses> customHoliday = GetCustomMessageforHoliday_PORequestMail_V2500(connectionString, warehousePurchaseOrder.IdWarehouse);
                                    if (customHoliday != null && customHoliday.Count > 0)
                                    {
                                        var customMessages = string.Join(", ", customHoliday.Select(h => h.CustomMessage));
                                        var customStartDate = string.Join(", ", customHoliday.Select(h => h.ImportantNoticeStartDate?.Date.ToShortDateString()));
                                        var customEndDate = string.Join(", ", customHoliday.Select(h => h.ImportantNoticeEndDate?.Date.ToShortDateString()));

                                        CultureInfo cultureInfo = CultureInfo.CurrentCulture;
                                        customStartDate = customStartDate.ToString(cultureInfo);
                                        customEndDate = customEndDate.ToString(cultureInfo);


                                        if (!string.IsNullOrEmpty(customStartDate) && string.IsNullOrEmpty(customEndDate))
                                        {
                                            concatenatedValues = $"<tr style=\"margin-top:5px\">" +
                                                                  $"<td colspan=\"2\" style=\"background: white;  font-weight: 700; border-top: 4px solid grey;Padding:5px \">" +
                                                                  $"</tr>" +
                                                                  $"<tr style=\"margin-top:5px\">" +
                                                                  $"<td colspan=\"2\" style=\"background: #d1d8db; color: black; font-weight: 700; border-top: 4px solid grey;Padding:20px \">" +
                                                                  $"{customMessages} from " +
                                                                  $"\"{customStartDate}\"" + "</td>" +
                                                                  $"</tr>";
                                        }
                                        else if (string.IsNullOrEmpty(customStartDate) && !string.IsNullOrEmpty(customEndDate))
                                        {
                                            concatenatedValues = $"<tr style=\"margin-top:5px\">" +
                                                                  $"<td colspan=\"2\" style=\"background: white;  font-weight: 700; border-top: 4px solid grey;Padding:5px \">" +
                                                                  $"</tr>" +
                                                                  $"<tr style=\"margin-top:5px\">" +
                                                                  $"<td colspan=\"2\" style=\"background: #d1d8db; color: black; font-weight: 700; border-top: 4px solid grey;Padding:20px \">" +
                                                                  $"{customMessages} " +
                                                                  $" till " +
                                                                  $"\"{customEndDate}\"" + "</td>" +
                                                                  $"</tr>";
                                        }
                                        else if (!string.IsNullOrEmpty(customStartDate) && !string.IsNullOrEmpty(customEndDate))
                                        {
                                            concatenatedValues = $"<tr style=\"margin-top:5px\">" +
                                                                  $"<td colspan=\"2\" style=\"background: white;  font-weight: 700; border-top: 4px solid grey;Padding:5px \">" +
                                                                  $"</tr>" +
                                                                  $"<tr style=\"margin-top:5px\">" +
                                                                  $"<td colspan=\"2\" style=\"background: #d1d8db; color: black; font-weight: 700; border-top: 4px solid grey;Padding:20px \">" +
                                                                  $"{customMessages} from " +
                                                                  $"\"{customStartDate}\"" + " to " +
                                                                  $"\"{customEndDate}\"" + "</td>" +
                                                                  $"</tr>";
                                        }

                                        else
                                        {
                                            concatenatedValues = $"<tr style=\"margin-top:5px\">" +
                                                                 $"<td colspan=\"2\" style=\"background: white;  font-weight: 700; border-top: 4px solid grey;Padding:5px \">" +
                                                                 $"</tr>" +
                                                                 $"<tr style=\"margin-top:5px\">" +
                                                                 $"<td colspan=\"2\" style=\"background: #d1d8db; color: black; font-weight: 700; border-top: 4px solid grey;Padding:20px \">" +
                                                                 $"{customMessages}</td>" +
                                                                 $"</tr>";
                                        }

                                    }
                                    else
                                    {
                                        concatenatedValues = string.Empty;
                                    }
                                    text = text.Replace("[footerdata]", concatenatedValues);
                                    #endregion
                                }
                                #endregion

                                #endregion
                                emailbody.Append(text);

                                warehousePurchaseOrder.EmailBody = emailbody.ToString();
                            }
                            warehousePurchaseOrder.AttachPdf = warehousePurchaseOrder.CreatedIn.Year + @"\" + warehousePurchaseOrder.Code + @"\01 Purchase Order\PO_" + warehousePurchaseOrder.Code + ".pdf";

                            warehousePurchaseOrder.AttachmentBytes = GetPurchaseOrderPdf(purchaseOrdersPath, warehousePurchaseOrder.AttachPdf);
                            warehousePurchaseOrder.WarehouseDeliveryNotes = GetDeliveryNotesByIdWarehousePurchaseOrder(connectionString, warehousePurchaseOrder, purchaseOrdersPath);


                            // [pramod.misal][GEOS2-4951][05-07-2023]

                            warehousePurchaseOrder.WarehouseShippingAddress = GetShippingAddressByIdShippingAddress_V2420(connectionString, warehousePurchaseOrder, idShippingAddress);
                            // [rdixit][GEOS2-4822][13-09-2023]
                            // [rdixit][GEOS2-4589][09-10-2023]
                            warehousePurchaseOrder.WarehousePurchaseOrderItemWithComments = GetArticlesByIdWarehousePurchaseOrder_V2460(connectionString, warehousePurchaseOrder.IdWarehousePurchaseOrder);
                            //warehousePurchaseOrder.WarehousePOComments = GetlogEntriesByWarehousePO_V2400(idWarehousePurchaseOrder, 252, connectionString);
                            //warehousePurchaseOrder.WarehousePOLogEntries = GetlogEntriesByWarehousePO_V2400(idWarehousePurchaseOrder, 253, connectionString);
                            //[pramod.misal][GEOS2-4451][08-08-2023]  logEntriesByWarehousePO.IdEntryType
                            warehousePurchaseOrder.WarehousePOComments = GetlogEntriesByWarehousePO_V2420(idWarehousePurchaseOrder, 257, connectionString);
                            warehousePurchaseOrder.WarehousePOLogEntries = GetlogEntriesByWarehousePO_V2420(idWarehousePurchaseOrder, 258, connectionString);



                            //[rdixit][GEOS2-4455][28.06.2023] 
                            List<DateTime> ItemDates = new List<DateTime>();
                            if (warehousePurchaseOrder.WarehousePurchaseOrderItemWithComments != null)
                            {
                                if (warehousePurchaseOrder.WarehousePurchaseOrderItemWithComments.Where(i => i.Status < 100) != null)
                                {
                                    if (warehousePurchaseOrder.WarehousePurchaseOrderItemWithComments.Where(i => i.Status < 100).ToList().Count > 0)
                                        foreach (var item in warehousePurchaseOrder.WarehousePurchaseOrderItemWithComments.Where(i => i.Status < 100))
                                        {
                                            if (item.WarehousePurchaseOrderExpectedItems != null)
                                            {
                                                if (item.WarehousePurchaseOrderExpectedItems.Count > 0)
                                                    ItemDates.Add(item.WarehousePurchaseOrderExpectedItems.FirstOrDefault().Date);
                                            }
                                        }
                                }
                            }
                            if (ItemDates.Count > 0)
                                warehousePurchaseOrder.DeliveryDate = ItemDates.Min(d => d.Date).Date;
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetPendingPOByIdWarehousePurchaseOrder_V2440(idWarehousePurchaseOrder-{0}), ErrorMessage- {1} ", idWarehousePurchaseOrder, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            return warehousePurchaseOrder;
        }

        //[rushikesh.gaikwad]
        public bool AddDeleteArticleSupplierOrder_V2520(string connectionString, List<Contacts> contactList, long idWarehouse)
        {
            bool status = false;
            try
            {
                if (contactList != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                    {
                        mySqlConnection.Open();

                        foreach (Contacts item in contactList)
                        {
                            if (item.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("SRM_DeleteArticleSupplierOrdersContact_V2520", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdArticleSupplierPoReceiver", item.IdArticleSupplierPOReceiver);
                                mySqlCommand.ExecuteNonQuery();
                            }
                            else if (item.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("SRM_InsertArticleSupplierOrder_V2520", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdArticleSupplier", item.IdArticleSupplier);
                                mySqlCommand.Parameters.AddWithValue("_IdWarehouse", idWarehouse);
                                mySqlCommand.Parameters.AddWithValue("_IdType", item.IdType);
                                mySqlCommand.Parameters.AddWithValue("_IdContact", item.IdContact);
                                mySqlCommand.ExecuteNonQuery();
                            }
                        }
                        mySqlConnection.Close();
                        status = true;
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddDeleteArticleSupplierOrder_V2520(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return status;
        }

        //[rushikesh.gaikwad]
        public List<Contacts> GetArticleSuppliersOrders_V2520(string connectionString, Int32 idArticleSupplier, long idWarehouse)
        {
            List<Contacts> contactsList = new List<Contacts>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();

                MySqlCommand activitiesCommand = new MySqlCommand("SRM_GetSuppliersOrders_V2520", mySqlConnection);
                activitiesCommand.CommandType = CommandType.StoredProcedure;
                activitiesCommand.Parameters.AddWithValue("_IdArticleSupplier", idArticleSupplier);
                activitiesCommand.Parameters.AddWithValue("_IdWarehouse", idWarehouse);


                using (MySqlDataReader poReader = activitiesCommand.ExecuteReader())
                {
                    while (poReader.Read())
                    {
                        try
                        {
                            Contacts contacts = new Contacts();

                            if (poReader["IdArticleSupplierPoReceiver"] != DBNull.Value)
                                contacts.IdArticleSupplierPOReceiver = Convert.ToUInt32(poReader["IdArticleSupplierPoReceiver"]);

                            if (poReader["IdType"] != DBNull.Value)
                                contacts.IdType = Convert.ToUInt32(poReader["IdType"]);

                            if (poReader["IdContact"] != DBNull.Value)
                                contacts.IdContact = Convert.ToInt32(poReader["IdContact"]);

                            if (poReader["Firstname"] != DBNull.Value)
                                contacts.Firstname = Convert.ToString(poReader["Firstname"]);

                            if (poReader["Lastname"] != DBNull.Value)
                                contacts.Lastname = Convert.ToString(poReader["Lastname"]);

                            if (poReader["Image"] != DBNull.Value)
                                contacts.ImageText = Convert.ToString(poReader["Image"]);

                            if (poReader["IdGender"] != DBNull.Value)
                                contacts.IdGender = Convert.ToByte(poReader["IdGender"]);

                            if (poReader["Email"] != DBNull.Value)
                                contacts.Email = Convert.ToString(poReader["Email"]);

                            if (poReader["IsMainContact"] != DBNull.Value)
                                contacts.IsMainContact = Convert.ToBoolean(poReader["IsMainContact"]);

                            contactsList.Add(contacts);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetArticleSuppliersOrders_V2520(idArticleSupplier-{0}). ErrorMessage- {1}", idArticleSupplier, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            Log4NetLogger.Logger.Log("Executed GetArticleSuppliersOrders_V2520().", category: Category.Info, priority: Priority.Low);

            return contactsList;
        }

        //[Sudhir.Jangra][GEOS2-5827]
        public bool AddArticleSupplier_V2530(string connectionString, ArticleSupplier articleSupplier, List<Contacts> contactsList, List<Warehouses> warehouses)
        {
            bool isAdded = false;
            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("SRM_Add_Supplier_V2440", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        if (articleSupplier.IdEnterpriseGroup == 0)
                        {
                            mySqlCommand.Parameters.AddWithValue("_IdEnterpriseGroup", null);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_IdEnterpriseGroup", articleSupplier.IdEnterpriseGroup);
                        }

                        mySqlCommand.Parameters.AddWithValue("_Name", articleSupplier.Name);
                        mySqlCommand.Parameters.AddWithValue("_Cif", articleSupplier.Cif);
                        mySqlCommand.Parameters.AddWithValue("_idArticleSupplierType", articleSupplier.IdArticleSupplierType);
                        mySqlCommand.Parameters.AddWithValue("_Observations", articleSupplier.Observations);
                        mySqlCommand.Parameters.AddWithValue("_IdPaymentType", articleSupplier.IdPaymentType);
                        mySqlCommand.Parameters.AddWithValue("_OrdersReceptionMethod", articleSupplier.IdOrderReceptionLookup);
                        mySqlCommand.Parameters.AddWithValue("_deliveryDays", articleSupplier.DeliveryDays);
                        mySqlCommand.Parameters.AddWithValue("_IdCarriageMethod", (articleSupplier.IdCarriageMethod == 0 ? (int?)null : articleSupplier.IdCarriageMethod));
                        mySqlCommand.Parameters.AddWithValue("_IsStillActive", articleSupplier.IsStillActive);
                        mySqlCommand.Parameters.AddWithValue("_CreatedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.Parameters.AddWithValue("_Phone1", articleSupplier.Phone1);
                        mySqlCommand.Parameters.AddWithValue("_Phone2", articleSupplier.Phone2);
                        mySqlCommand.Parameters.AddWithValue("_Email", articleSupplier.Email);
                        mySqlCommand.Parameters.AddWithValue("_Fax", articleSupplier.Fax);
                        mySqlCommand.Parameters.AddWithValue("_Web", articleSupplier.Web);
                        mySqlCommand.Parameters.AddWithValue("_Address", articleSupplier.Address);
                        mySqlCommand.Parameters.AddWithValue("_City", articleSupplier.City);
                        mySqlCommand.Parameters.AddWithValue("_Region", articleSupplier.Region);
                        mySqlCommand.Parameters.AddWithValue("_PostCode", articleSupplier.PostCode);
                        mySqlCommand.Parameters.AddWithValue("_IdCountry", articleSupplier.IdCountry);
                        mySqlCommand.Parameters.AddWithValue("_idSite", null);


                        articleSupplier.IdArticleSupplier = Convert.ToInt64(mySqlCommand.ExecuteScalar());

                        mySqlConnection.Close();
                        if (articleSupplier.IdArticleSupplier > 0)
                        {
                            if (contactsList != null && contactsList.Count > 0)
                            {
                                foreach (Contacts item in contactsList)
                                {
                                    //ArticleSupplierContacts_Insert(connectionString, item.IdContact, articleSupplier.IdArticleSupplier);
                                    //[pramod.misal][GEOS2-5136][22.01.2024]
                                    ArticleSupplierContacts_Insert_V2480(connectionString, item.IdContact, articleSupplier.IdArticleSupplier);
                                }
                            }
                            if (warehouses != null && warehouses.Count > 0)
                            {
                                foreach (var item in warehouses.GroupBy(i => i.IdSite))
                                {
                                    AddSRMSupplierBySite_V2440(connectionString, articleSupplier.IdArticleSupplier, item.Key, articleSupplier.IdPaymentType);
                                }
                            }
                            if (articleSupplier.LogEntriesByArticleSuppliers != null && articleSupplier.LogEntriesByArticleSuppliers.Count > 0)
                            {
                                AddCommentsOrLogEntriesByArticleSuppliers_V2530(connectionString, articleSupplier.LogEntriesByArticleSuppliers, articleSupplier.IdArticleSupplier);
                            }
                        }
                        transactionScope.Complete();
                        transactionScope.Dispose();
                        isAdded = true;

                    }
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddArticleSupplier_V2530(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();
                    throw;
                }
            }

            return isAdded;
        }


        //[Sudhir.Jangra][GEOS2-5287]
        public void AddCommentsOrLogEntriesByArticleSuppliers_V2530(string MainServerConnectionString, List<LogEntriesByArticleSuppliers> AddLogEntries, long idArticleSupplier)
        {
            try
            {
                if (AddLogEntries != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (LogEntriesByArticleSuppliers logEntriesByitem in AddLogEntries)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("SRM_AddLogEntriesByActionItem", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_idArticleSupplier", idArticleSupplier);
                            mySqlCommand.Parameters.AddWithValue("_IdUser", logEntriesByitem.IdUser);
                            mySqlCommand.Parameters.AddWithValue("_CreationDate", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                            mySqlCommand.Parameters.AddWithValue("_Comments", logEntriesByitem.Comments);
                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddCommentsOrLogEntriesByArticleSuppliers(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        //[pramod.misal][GEOS2-5495][16.08.2024]
        public bool UpdateWorkflowStatusInPO_V2530(string MainServerConnectionString, uint IdWarehousePurchaseOrder, UInt32 IdWorkflowStatus, int IdUser, List<LogEntriesByWarehousePO> LogEntriesByWarehousePOList, UInt32 IdAssignee, UInt32 IdApprover, string comment)
        {
            bool status;

            using (TransactionScope transactionScope = new TransactionScope())
            {
                try
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();
                        MySqlCommand mySqlCommand = new MySqlCommand("SRM_warehousepurchaseorders_UpdateWorkflowStatus_V2530", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", IdWarehousePurchaseOrder);
                        mySqlCommand.Parameters.AddWithValue("_IdWorkflowStatus", IdWorkflowStatus);
                        mySqlCommand.Parameters.AddWithValue("_comment", comment);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdUser);
                        mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                        status = true;
                    }

                    //varchar(500)

                    AddCommentsOrLogEntriesByPO_V2420(MainServerConnectionString, LogEntriesByWarehousePOList);
                    transactionScope.Complete();
                    transactionScope.Dispose();
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error UpdateWorkflowStatusInPO_V2530(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);

                    if (Transaction.Current != null)
                        Transaction.Current.Rollback();

                    if (transactionScope != null)
                        transactionScope.Dispose();

                    throw;
                }
            }

            return status;
        }
        //  [nsatpute][12-06-2024] GEOS2-5463
        public List<WarehouseCategory> GetWarehouseCategories(string connectionString)
        {
            try
            {
                List<ArticleCategory> articleCategories = GetArticleCategories(connectionString);

                List<WarehouseCategory> warehouseCategories = new List<WarehouseCategory>();

                foreach (ArticleCategory articleCategory in articleCategories)
                {
                    WarehouseCategory wc = new WarehouseCategory();

                    wc.IdKey = articleCategory.IdArticleCategory;
                    wc.BaseName = articleCategory.Name;
                    wc.IdParent = articleCategory.Parent;
                    wc.IdArticleCategory = articleCategory.IdArticleCategory;
                    warehouseCategories.Add(wc);
                }
                return warehouseCategories;
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetWarehouseCategories(connectionString). ErrorMessage- {1}", connectionString, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return null;
        }
        //  [nsatpute][12-06-2024] GEOS2-5463
        private List<ArticleCategory> GetArticleCategories(string connectionstring)
        {

            List<ArticleCategory> articleCategories = new List<ArticleCategory>();

            using (MySqlConnection conCountry = new MySqlConnection(connectionstring))
            {
                conCountry.Open();

                MySqlCommand conCountrycommand = new MySqlCommand("crm_GetArticleCategories", conCountry);
                conCountrycommand.CommandType = CommandType.StoredProcedure;

                using (MySqlDataReader reader = conCountrycommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        ArticleCategory articleCategory = new ArticleCategory();
                        articleCategory.IdArticleCategory = Convert.ToInt64(reader["IdArticleCategory"]);

                        if (reader["Name"] != DBNull.Value)
                            articleCategory.Name = Convert.ToString(reader["Name"]);

                        if (reader["Parent"] != DBNull.Value)
                            articleCategory.Parent = Convert.ToInt64(reader["Parent"]);

                        if (reader["IsLeaf"] != DBNull.Value)
                            articleCategory.IsLeaf = Convert.ToByte(reader["IsLeaf"]);

                        if (reader["Position"] != DBNull.Value)
                            articleCategory.Position = Convert.ToInt64(reader["Position"]);

                        if (reader["TaricCode"] != DBNull.Value)
                            articleCategory.TaricCode = Convert.ToString(reader["TaricCode"]);

                        if (reader["NCM_Code"] != DBNull.Value)
                            articleCategory.NCM_Code = Convert.ToString(reader["NCM_Code"]);

                        if (reader["HS_Code"] != DBNull.Value)
                            articleCategory.HS_Code = Convert.ToString(reader["HS_Code"]);

                        articleCategories.Add(articleCategory);
                    }
                }
            }

            return articleCategories;
        }
        //  [nsatpute][12-06-2024] GEOS2-5463
        public List<ArticleSupplier> GetArticleSuppliersByWarehouseForCatalogue(long idWarehouse, string connectionString, string countryIconFilePath)
        {
            //string connectionString = warehouse.Company.ConnectPlantConstr;
            List<ArticleSupplier> articleSuppliers = new List<ArticleSupplier>();
            List<string> countryISOs = new List<string>();
            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetArticleSuppliersByWarehouseForCatalogue", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdWarehouse", idWarehouse);

                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    while (mySqlDataReader.Read())
                    {
                        try
                        {
                            ArticleSupplier articleSupplier = new ArticleSupplier();

                            articleSupplier.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                            if (mySqlDataReader["name"] != DBNull.Value)
                                articleSupplier.Name = Convert.ToString(mySqlDataReader["name"]);

                            if (mySqlDataReader["IdCountry"] != DBNull.Value)
                            {
                                articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["IdCountry"]);

                                articleSupplier.Country = new Country();
                                articleSupplier.Country.IdCountry = Convert.ToByte(mySqlDataReader["IdCountry"]);
                                articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);
                                articleSupplier.Country.Iso = Convert.ToString(mySqlDataReader["Iso"]);

                                if (!countryISOs.Any(co => co.ToString() == articleSupplier.Country.Iso))
                                {
                                    countryISOs.Add(articleSupplier.Country.Iso);
                                }
                            }
                            if (mySqlDataReader["Cif"] != DBNull.Value)
                                articleSupplier.Cif = Convert.ToString(mySqlDataReader["Cif"]);

                            if (mySqlDataReader["City"] != DBNull.Value)
                                articleSupplier.City = Convert.ToString(mySqlDataReader["City"]);

                            if (mySqlDataReader["PostCode"] != DBNull.Value)
                                articleSupplier.PostCode = Convert.ToString(mySqlDataReader["PostCode"]);

                            if (mySqlDataReader["Address"] != DBNull.Value)
                                articleSupplier.Address = Convert.ToString(mySqlDataReader["Address"]);

                            if (mySqlDataReader["Email"] != DBNull.Value)
                                articleSupplier.Email = Convert.ToString(mySqlDataReader["Email"]);

                            if (mySqlDataReader["Web"] != DBNull.Value)
                                articleSupplier.Web = Convert.ToString(mySqlDataReader["Web"]);

                            if (mySqlDataReader["Phone1"] != DBNull.Value)
                                articleSupplier.Phone1 = Convert.ToString(mySqlDataReader["Phone1"]);

                            if (mySqlDataReader["Phone2"] != DBNull.Value)
                                articleSupplier.Phone2 = Convert.ToString(mySqlDataReader["Phone2"]);

                            if (mySqlDataReader["serie"] != DBNull.Value)
                                articleSupplier.Serie = Convert.ToChar(mySqlDataReader["serie"]);

                            if (mySqlDataReader["CreatedIn"] != DBNull.Value)
                                articleSupplier.CreatedIn = Convert.ToDateTime(mySqlDataReader["CreatedIn"].ToString());

                            if (mySqlDataReader["EnterpriseGroup"] != DBNull.Value)
                                articleSupplier.Group = Convert.ToString(mySqlDataReader["EnterpriseGroup"].ToString());

                            if (mySqlDataReader["IsStillActive"] != DBNull.Value)
                            {
                                articleSupplier.IsStillActive = Convert.ToSByte(mySqlDataReader["IsStillActive"]);
                                if (articleSupplier.IsStillActive == 1)
                                {
                                    articleSupplier.IsActive = "Yes";
                                }
                                else
                                {
                                    articleSupplier.IsActive = "No";
                                }
                            }
                            if (mySqlDataReader["TradeName"] != DBNull.Value)
                            {
                                articleSupplier.TradeName = Convert.ToString(mySqlDataReader["TradeName"]);
                            }
                            if (mySqlDataReader["ModifiedIn"] != DBNull.Value)
                            {
                                articleSupplier.ModifiedIn = Convert.ToDateTime(mySqlDataReader["ModifiedIn"]);
                                articleSupplier.ModificationDate = Convert.ToDateTime(mySqlDataReader["ModifiedIn"]);
                            }
                            if (mySqlDataReader["State"] != DBNull.Value)
                            {
                                articleSupplier.State = Convert.ToString(mySqlDataReader["State"]);
                            }
                            if (mySqlDataReader["ContactCount"] != DBNull.Value)
                            {
                                articleSupplier.ContactCount = Convert.ToString(mySqlDataReader["ContactCount"]);
                            }

                            articleSuppliers.Add(articleSupplier);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetArticleSuppliersByWarehouseForCatalogue(). ErrorMessage-" + ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }
            foreach (string item in countryISOs)
            {
                byte[] bytes = null;
                bytes = GetCountryIconFileInBytes(item, countryIconFilePath);
                articleSuppliers.Where(ars => ars.Country.Iso == item).ToList().ForEach(oi => oi.Country.CountryIconBytes = bytes);
            }
            return articleSuppliers;
        }
        //  [nsatpute][12-06-2024] GEOS2-5463
        public List<Catalogue> GetCatalogue(string connectionString, string articleVisualAidsPath, string reference, string articleSupplierIds, string idCategories, string conditionalOperator, string stockValue, long idWarehouse, Currency currency)
        {
            List<Catalogue> cataloguelist = new List<Catalogue>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                using (MySqlCommand cmd = new MySqlCommand())
                {
                    cmd.Connection = mySqlConnection;
                    cmd.CommandType = CommandType.StoredProcedure;
                    cmd.CommandText = "SRM_CatalogueSupplierArticles";
                    cmd.Parameters.AddWithValue("_Reference", reference.Trim());
                    cmd.Parameters.AddWithValue("_ArticleSupplierIds", articleSupplierIds.Trim());
                    cmd.Parameters.AddWithValue("_IdCategories", idCategories.Trim());
                    cmd.Parameters.AddWithValue("_ConditionalOperator", conditionalOperator.Trim());
                    cmd.Parameters.AddWithValue("_StockValue", stockValue.Trim());
                    cmd.Parameters.AddWithValue("_IdWarehouse", idWarehouse);
                    cmd.Parameters.AddWithValue("_IdCurrency", currency.IdCurrency);
                    mySqlConnection.Open();
                    using (MySqlDataReader rdr = cmd.ExecuteReader())
                    {
                        while (rdr.Read())
                        {
                            try
                            {
                                Catalogue catalogue = new Catalogue();

                                if (rdr["Reference"] != DBNull.Value)
                                    catalogue.Reference = Convert.ToString(rdr["Reference"]);

                                if (rdr["SupplierReference"] != DBNull.Value)
                                    catalogue.SupplierReference = Convert.ToString(rdr["SupplierReference"]);

                                if (rdr["SupplierName"] != DBNull.Value)
                                    catalogue.SupplierName = Convert.ToString(rdr["SupplierName"]);

                                if (rdr["Image"] != DBNull.Value && Convert.ToString(rdr["Image"]).Trim() != string.Empty)
                                {
                                    //catalogue.ImagePath = Convert.ToString(rdr["Image"]);
                                    catalogue.ImagePath = "https://api.emdep.com/GEOS/Images.aspx?FilePath=/ARTICLE%20VISUAL%20AIDS/" + Convert.ToString(rdr["Image"]);
                                }

                                if (rdr["Description"] != DBNull.Value)
                                    catalogue.Description = Convert.ToString(rdr["Description"]);

                                if (rdr["Category"] != DBNull.Value)
                                    catalogue.Category = Convert.ToString(rdr["Category"]);

                                if (rdr["Location"] != DBNull.Value)
                                    catalogue.Location = Convert.ToString(rdr["Location"]);

                                if (rdr["Weight"] != DBNull.Value)
                                    catalogue.Weight = Convert.ToDecimal(rdr["Weight"]);

                                if (rdr["Length"] != DBNull.Value)
                                    catalogue.Length = (float)(rdr["Length"]);

                                if (rdr["Width"] != DBNull.Value)
                                    catalogue.Width = (float)(rdr["Width"]);

                                if (rdr["Height"] != DBNull.Value)
                                    catalogue.Height = (float)(rdr["Height"]);


                                if (rdr["Stock"] != DBNull.Value)
                                    catalogue.Stock = Convert.ToInt32(rdr["Stock"]);

                                if (rdr["Value"] != DBNull.Value)
                                    catalogue.Value = Convert.ToDecimal(rdr["Value"]);

                                if (rdr["CostPrice"] != DBNull.Value)
                                    catalogue.CostPrice = Convert.ToDecimal(rdr["CostPrice"]);

                                if (rdr["CostPrice"] != DBNull.Value)
                                    catalogue.CostCurrency = Convert.ToString(rdr["CostCurrency"]);

                                if (rdr["LatestDeliveryDate"] != DBNull.Value && Convert.ToDateTime(rdr["LatestDeliveryDate"]) != DateTime.MinValue)
                                    catalogue.LatestDeliveryDate = Convert.ToDateTime(rdr["LatestDeliveryDate"]);

                                if (rdr["MinimumStock"] != DBNull.Value)
                                    catalogue.MinimumStock = Convert.ToInt32(rdr["MinimumStock"]);


                                if (rdr["MaximumStock"] != DBNull.Value)
                                    catalogue.MaximumStock = Convert.ToInt32(rdr["MaximumStock"]);

                                if (rdr["IsObsolete"] != DBNull.Value)
                                {
                                    if (Convert.ToBoolean(rdr["IsObsolete"]))
                                        catalogue.IsObsolete = "Yes";
                                    else
                                        catalogue.IsObsolete = "No";
                                }

                                if (rdr["RegisterSerialNumber"] != DBNull.Value)
                                {
                                    if (Convert.ToBoolean(rdr["RegisterSerialNumber"]))
                                        catalogue.RegisterSerialNumber = "Yes";
                                    else
                                        catalogue.RegisterSerialNumber = "No";
                                }

                                //if (!string.IsNullOrEmpty(catalogue.ImagePath))
                                //    catalogue.ArticleImageInBytes = GetArticleImageInBytes(articleVisualAidsPath, catalogue.ImagePath);


                                cataloguelist.Add(catalogue);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetCatalogue(idArticleSupplier-{0}). ErrorMessage- {1}", articleSupplierIds, ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }

                        }
                    }
                }
            }

            Log4NetLogger.Logger.Log("Executed GetCatalogue().", category: Category.Info, priority: Priority.Low);

            return cataloguelist;
        }
        //  [nsatpute][12-06-2024] GEOS2-5463
        public byte[] GetArticleImageInBytes(string ArticleVisualAidsPath, string articleImagePath)
        {
            if (!Directory.Exists(ArticleVisualAidsPath))
            {
                return null;
            }

            string fileUploadPath = ArticleVisualAidsPath + articleImagePath;

            if (!File.Exists(fileUploadPath))
            {
                return null;
            }

            if (articleImagePath != null && !string.IsNullOrEmpty(articleImagePath))
            {

                byte[] bytes = null;

                try
                {
                    using (System.IO.FileStream stream = new System.IO.FileStream(fileUploadPath, System.IO.FileMode.Open, System.IO.FileAccess.Read))
                    {
                        bytes = new byte[stream.Length];
                        int numBytesToRead = (int)stream.Length;
                        int numBytesRead = 0;

                        while (numBytesToRead > 0)
                        {
                            // Read may return anything from 0 to numBytesToRead.
                            int n = stream.Read(bytes, numBytesRead, numBytesToRead);

                            // Break when the end of the file is reached.
                            if (n == 0)
                                break;

                            numBytesRead += n;
                            numBytesToRead -= n;
                        }
                    }

                    return bytes;
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error GetDeliveryNotePdf() article ImagePath-{0}. ErrorMessage- {1}", articleImagePath, ex.Message), category: Category.Exception, priority: Priority.Low);
                    //throw;
                }
            }

            return null;
        }
        // [Rahul.Gadhave][17-06-2024] [GEOS2-2530]
        public bool DeleteContacts_V2530(string connectionString, int idContact)
        {
            bool status;
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("SRM_Delete_contacts_V2530", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_idContact", idContact);
                    mySqlCommand.ExecuteNonQuery();
                    mySqlConnection.Close();
                    status = true;
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error DeleteContacts_V2530(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return status;
        }

        //[Sudhir.Jangra][GEOS2-5634]
        public List<SRMWarehouseBulkArticle> GetWarehouseBulkArticle(Warehouses warehouse)
        {
            string connectionString = warehouse.Company.ConnectPlantConstr;
            // string connectionString = "Data Source = 10.13.10.13; Database = geos; User ID = GeosUsr; Password = GEOS; Convert Zero Datetime = True";
            List<SRMWarehouseBulkArticle> warehouseBulkArticleList = new List<SRMWarehouseBulkArticle>();
            using (MySqlConnection connOtItem = new MySqlConnection(connectionString))
            {
                connOtItem.Open();

                MySqlCommand Command = new MySqlCommand("SRM_GetWarehouseBulkArticle", connOtItem);
                Command.CommandType = CommandType.StoredProcedure;
                Command.Parameters.AddWithValue("_IdWarehouse", warehouse.IdWarehouse);
                Command.CommandTimeout = 4000;

                using (MySqlDataReader Reader = Command.ExecuteReader())
                {
                    while (Reader.Read())
                    {
                        try
                        {
                            SRMWarehouseBulkArticle warehouseBulkArticle = new SRMWarehouseBulkArticle();

                            if (Reader["IdWarehouseBulkArticle"] != DBNull.Value)
                                warehouseBulkArticle.IdWarehouseBulkArticle = Convert.ToInt64(Reader["IdWarehouseBulkArticle"]);

                            if (Reader["IdWarehouse"] != DBNull.Value)
                                warehouseBulkArticle.IdWarehouse = Convert.ToInt64(Reader["IdWarehouse"]);

                            if (Reader["IdArticle"] != DBNull.Value)
                                warehouseBulkArticle.IdArticle = Convert.ToInt32(Reader["IdArticle"]);

                            if (Reader["IdParent"] != DBNull.Value)
                                warehouseBulkArticle.IdParent = Convert.ToInt32(Reader["IdParent"]);

                            if (Reader["IdArticle"] != DBNull.Value)
                            {
                                warehouseBulkArticle.Article = new Article();
                                warehouseBulkArticle.Article.IdArticle = Convert.ToInt32(Reader["IdArticle"]);
                                warehouseBulkArticle.Article.Reference = Convert.ToString(Reader["Reference"]);
                            }

                            if (Reader["IdParent"] != DBNull.Value)
                            {
                                warehouseBulkArticle.ParentArticle = new Article();
                                warehouseBulkArticle.ParentArticle.IdArticle = Convert.ToInt32(Reader["IdParent"]);
                                warehouseBulkArticle.ParentArticle.Reference = Convert.ToString(Reader["ParentReference"]);
                            }



                            warehouseBulkArticleList.Add(warehouseBulkArticle);

                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetWarehouseBulkArticle (ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }

                }
            }

            return warehouseBulkArticleList;
        }

        #region GEOS2-5634
        //[Sudhir.Jangra][GEOS2-5634]
        public List<Ots> GetPendingReviewByWarehouse_V2540(Warehouses warehouse, string countryIconFilePath)
        {
            List<SRMWarehouseBulkArticle> LstWarehouseList = GetWarehouseBulkArticle(warehouse);
            string connectionString = warehouse.Company.ConnectPlantConstr;
            List<Ots> ots = new List<Ots>();
            List<string> countryISOs = new List<string>();
            using (MySqlConnection connOts = new MySqlConnection(connectionString))
            {
                connOts.Open();

                MySqlCommand otsCommand = new MySqlCommand("SRM_GetPendingReviewByWarehouse_V2540", connOts);
                // MySqlCommand otsCommand = new MySqlCommand("SRM_GetPendingReviewByWarehouse_V2540_Test_Sudhir", connOts);

                otsCommand.CommandType = CommandType.StoredProcedure;
                otsCommand.Parameters.AddWithValue("_IdWarehouse", warehouse.IdWarehouse);
                otsCommand.CommandTimeout = 8000;

                using (MySqlDataReader otReader = otsCommand.ExecuteReader())
                {
                    if (otReader.HasRows)
                    {
                        while (otReader.Read())
                        {
                            try
                            {
                                Ots ot = new Ots();
                                ot.IdOT = Convert.ToInt64(otReader["IdOT"]);
                                ot.NumOT = Convert.ToByte(otReader["NumOT"]);

                                if (otReader["OtCode"] != DBNull.Value)
                                {
                                    ot.Code = Convert.ToString(otReader["OtCode"]);
                                    ot.MergeCode = Convert.ToString(otReader["MergeCode"]);
                                }

                                if (otReader["DeliveryDate"] != DBNull.Value)
                                {
                                    ot.DeliveryDate = Convert.ToDateTime(otReader["DeliveryDate"]);
                                    ot.Delay = (int)(ot.DeliveryDate.Value.Date - DateTime.Now.Date).TotalDays;
                                }

                                ot.Quotation = new Quotation();

                                if (otReader["IdQuotation"] != DBNull.Value)
                                {
                                    ot.IdQuotation = Convert.ToInt64(otReader["IdQuotation"]);
                                    ot.Quotation.IdQuotation = Convert.ToInt64(otReader["IdQuotation"]);
                                    ot.Quotation.Code = Convert.ToString(otReader["QuotationCode"]);
                                }

                                if (otReader["IdTemplate"] != DBNull.Value)
                                {
                                    ot.Quotation.IdDetectionsTemplate = Convert.ToByte(otReader["IdTemplate"]);

                                    ot.Quotation.Template = new Template();
                                    ot.Quotation.Template.IdTemplate = ot.Quotation.IdDetectionsTemplate;
                                    ot.Quotation.Template.Name = Convert.ToString(otReader["Template"]);
                                    ot.Quotation.Template.IdTemplate = Convert.ToByte(otReader["TemplateType"]);
                                }

                                if (otReader["IdOffer"] != DBNull.Value)
                                {
                                    ot.Quotation.IdOffer = Convert.ToInt64(otReader["IdOffer"]);
                                    ot.Quotation.Offer = new Offer();
                                    ot.Quotation.Offer.IdOffer = ot.Quotation.IdOffer;

                                    if (otReader["IsCritical"] != DBNull.Value)
                                        ot.Quotation.Offer.IsCritical = Convert.ToByte(otReader["IsCritical"]);



                                    ot.Quotation.Offer.Code = Convert.ToString(otReader["OfferCode"]);



                                    if (otReader["IdOfferType"] != DBNull.Value)
                                    {
                                        ot.Quotation.Offer.IdOfferType = Convert.ToByte(otReader["IdOfferType"]);

                                        ot.Quotation.Offer.OfferType = new OfferType();
                                        ot.Quotation.Offer.OfferType.IdOfferType = Convert.ToByte(ot.Quotation.Offer.IdOfferType);
                                        ot.Quotation.Offer.OfferType.Name = Convert.ToString(otReader["OfferType"]);
                                    }

                                    if (otReader["IdCarriageMethod"] != DBNull.Value)
                                    {
                                        ot.Quotation.Offer.IdCarriageMethod = Convert.ToByte(otReader["IdCarriageMethod"]);
                                        ot.Quotation.Offer.CarriageMethod = new LookupValue();
                                        ot.Quotation.Offer.CarriageMethod.IdLookupValue = Convert.ToByte(ot.Quotation.Offer.IdCarriageMethod);
                                        ot.Quotation.Offer.CarriageMethod.Value = Convert.ToString(otReader["CarriageMethod"]);

                                        if (otReader["CarriageImage"] != DBNull.Value)
                                            ot.Quotation.Offer.CarriageMethod.IdImage = Convert.ToInt64(otReader["CarriageImage"]);
                                    }
                                }

                                if (otReader["IdWarehouse"] != DBNull.Value)
                                {
                                    ot.Quotation.IdWarehouse = Convert.ToInt64(otReader["IdWarehouse"]);
                                }

                                if (otReader["IdSite"] != DBNull.Value)
                                {
                                    ot.Quotation.IdCustomer = Convert.ToInt32(otReader["IdSite"]);
                                    ot.Quotation.Site = new Company();
                                    ot.Quotation.Site.IdCompany = ot.Quotation.IdCustomer;
                                    ot.Quotation.Site.SiteNameWithoutCountry = Convert.ToString(otReader["SiteName"]);

                                    if (otReader["ShortName"] != DBNull.Value && !string.IsNullOrEmpty(Convert.ToString(otReader["ShortName"])))
                                    {
                                        ot.Quotation.Site.ShortName = Convert.ToString(otReader["ShortName"]);
                                        ot.Quotation.Site.Name = ot.Quotation.Site.ShortName;
                                    }
                                    else
                                    {
                                        ot.Quotation.Site.ShortName = null;
                                        ot.Quotation.Site.Name = Convert.ToString(otReader["SiteName"]);
                                    }

                                    ot.Quotation.Site.Customer = new Customer();
                                    ot.Quotation.Site.Customer.IdCustomer = Convert.ToInt32(otReader["IdCustomer"]);
                                    ot.Quotation.Site.Customer.CustomerName = Convert.ToString(otReader["CustomerName"]);

                                    if (otReader["IdCountry"] != DBNull.Value)
                                    {
                                        ot.Quotation.Site.IdCountry = Convert.ToByte(otReader["IdCountry"]);
                                        ot.Quotation.Site.Country = new Country();
                                        ot.Quotation.Site.Country.IdCountry = Convert.ToByte(otReader["IdCountry"]);
                                        ot.Quotation.Site.Country.Name = Convert.ToString(otReader["CountryName"]);
                                        if (otReader["CountryISO"] != DBNull.Value)
                                        {
                                            ot.Quotation.Site.Country.Iso = Convert.ToString(otReader["CountryISO"]);

                                            if (!countryISOs.Any(co => co.ToString() == ot.Quotation.Site.Country.Iso))
                                            {
                                                countryISOs.Add(ot.Quotation.Site.Country.Iso);
                                            }
                                        }

                                    }
                                }

                                if (otReader["ActualQty"] != DBNull.Value)
                                    ot.ActualQuantity = Convert.ToInt64(otReader["ActualQty"]);

                                if (otReader["DownloadedQty"] != DBNull.Value)
                                    ot.DownloadedQuantity = Convert.ToInt64(otReader["DownloadedQty"]);

                                if (otReader["PODate"] != DBNull.Value)
                                    ot.PoDate = Convert.ToDateTime(otReader["PODate"]);

                                if (otReader["ProducerCountryGroupName"] != DBNull.Value)
                                {
                                    ot.CountryGroup = new CountryGroup();
                                    ot.CountryGroup.Name = otReader["ProducerCountryGroupName"].ToString();
                                    if (otReader["ProducerCountryGroupHTMLColor"] != DBNull.Value)
                                        ot.CountryGroup.HtmlColor = otReader["ProducerCountryGroupHTMLColor"].ToString();
                                }



                                if (otReader["CreationDate"] != DBNull.Value)
                                {
                                    ot.CreationDate = Convert.ToDateTime(otReader["CreationDate"]);
                                }

                                if (otReader["Validated"] != DBNull.Value)
                                {
                                    int validate = Convert.ToInt32(otReader["Validated"]);
                                    if (validate == 1)
                                    {
                                        ot.IsReviewValidated = true;
                                        ot.ValidatedCount = 1;
                                    }
                                }

                                Int32 NotValidatedCount = 0;
                                if (otReader["Count_Validated"] != DBNull.Value)
                                {
                                    ot.Reviewed = Convert.ToInt32(otReader["Count_Validated"]);
                                }
                                if (otReader["Count_NotValidated"] != DBNull.Value)
                                {
                                    NotValidatedCount = Convert.ToInt32(otReader["Count_NotValidated"]);
                                }
                                ot.OtItemCount = ot.Reviewed + NotValidatedCount;

                                if (otReader["Progress"] != DBNull.Value)
                                {
                                    ot.SRMProgress = Convert.ToInt32(otReader["Progress"]);
                                }

                                if (otReader["Quantity"] != DBNull.Value)
                                {
                                    ot.Quantity = Convert.ToDouble(otReader["Quantity"]);
                                }


                                ot.OtItems = new List<OtItem>();
                                ots.Add(ot);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetPendingReviewByWarehouse_V2540() 1. ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                    }

                    if (otReader.NextResult())
                    {
                        while (otReader.Read())
                        {
                            try
                            {
                                Ots ot = ots.FirstOrDefault(x => x.IdOT == Convert.ToInt64(otReader["IdOT"]));
                                if (ot != null)
                                {
                                    OtItem otItem = new OtItem();
                                    if (otReader["IdOT"] != DBNull.Value)
                                        otItem.IdOT = Convert.ToInt64(otReader["IdOT"]);
                                    if (otReader["IdOtItem"] != DBNull.Value)
                                        otItem.IdOTItem = Convert.ToInt64(otReader["IdOtItem"]);
                                    if (otReader["IdRevisionItem"] != DBNull.Value)
                                    {
                                        otItem.IdRevisionItem = Convert.ToInt64(otReader["IdRevisionItem"]);
                                        otItem.RevisionItem = new RevisionItem();
                                        otItem.RevisionItem.IdRevisionItem = Convert.ToInt64(otReader["IdRevisionItem"]);
                                        otItem.RevisionItem.Quantity = Convert.ToDecimal(otReader["Quantity"]);
                                        if (otReader["DownloadedQty"] != DBNull.Value)
                                            otItem.RevisionItem.DownloadedQuantity = Convert.ToInt64(otReader["DownloadedQty"]);

                                        if (otReader["RemainingQty"] != DBNull.Value)
                                            otItem.RevisionItem.RemainingQuantity = Convert.ToInt64(otReader["RemainingQty"]);


                                        if (otReader["IdArticle"] != DBNull.Value)
                                        {
                                            otItem.RevisionItem.WarehouseProduct = new WarehouseProduct();

                                            otItem.RevisionItem.WarehouseProduct.Article = new Article();
                                            otItem.RevisionItem.WarehouseProduct.Article.IdArticle = Convert.ToInt32(otReader["IdArticle"]);
                                            otItem.RevisionItem.WarehouseProduct.Article.Reference = Convert.ToString(otReader["Reference"]);
                                            if (otReader["IdArticleType"] != DBNull.Value)
                                            {
                                                otItem.RevisionItem.WarehouseProduct.Article.IdArticleType = Convert.ToInt64(otReader["IdArticleType"]);
                                            }
                                            if (otReader["ArticleCurrentStock"] != DBNull.Value)
                                                otItem.RevisionItem.WarehouseProduct.Article.ArticleCurrentStock = Convert.ToInt64(otReader["ArticleCurrentStock"]);

                                            if (otReader["ArticleWarehouseLocationIdArticle"] != DBNull.Value)
                                            {
                                                otItem.RevisionItem.WarehouseProduct.Article.ArticleWarehouseLocation = new ArticleWarehouseLocations();
                                                otItem.RevisionItem.WarehouseProduct.Article.ArticleWarehouseLocation.IdArticle = Convert.ToInt32(otReader["ArticleWarehouseLocationIdArticle"]);

                                            }
                                        }
                                        if (otReader["Validated"] != DBNull.Value)
                                        {
                                            int validate = Convert.ToInt32(otReader["Validated"]);
                                            if (validate == 1)
                                            {
                                                otItem.IsReviewValidated = true;
                                                otItem.ValidatedCount = 1;
                                            }
                                        }
                                    }
                                    otItem.ArticleDecomposedList = new List<OtItem>();
                                    ot.OtItems.Add(otItem);
                                }
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetPendingReviewByWarehouse_V2540() 2. ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                    }


                }
            }



            foreach (string item in countryISOs)
            {
                byte[] bytes = null;
                bytes = GetCountryIconFileInBytes(item, countryIconFilePath);
                ots.Where(ot => ot.Quotation.Site.Country.Iso == item).ToList().ForEach(ot => ot.Quotation.Site.Country.CountryIconBytes = bytes);
            }

            Log4NetLogger.Logger.Log("Executed GetPendingReviewByWarehouse_V2540().", category: Category.Info, priority: Priority.Low);
            return ots;
        }

        //[Sudhir.Jangra][GEOS2-5634]
        public List<Template> GetTemplatesByIdTemplateType(string connectionString, Int64 idTemplateType)
        {
            List<Template> templates = new List<Template>();

            using (MySqlConnection connTemplates = new MySqlConnection(connectionString))
            {
                connTemplates.Open();

                MySqlCommand templatesCommand = new MySqlCommand("templates_GetTemplatesByIdTemplateType", connTemplates);
                templatesCommand.CommandType = CommandType.StoredProcedure;
                templatesCommand.Parameters.AddWithValue("_IdTemplateType", idTemplateType);

                using (MySqlDataReader poReader = templatesCommand.ExecuteReader())
                {
                    while (poReader.Read())
                    {
                        try
                        {
                            Template template = new Template();

                            template.IdTemplate = Convert.ToByte(poReader["IdTemplate"]);
                            template.Name = Convert.ToString(poReader["Name"]);
                            template.Name_es = Convert.ToString(poReader["Name_es"]);
                            template.Name_fr = Convert.ToString(poReader["Name_fr"]);

                            if (poReader["Suffix"] != DBNull.Value)
                                template.Suffix = Convert.ToString(poReader["Suffix"]);

                            template.Type = Convert.ToInt64(poReader["Type"]);
                            template.Name_ro = Convert.ToString(poReader["Name_ro"]);
                            template.Name_zh = Convert.ToString(poReader["Name_zh"]);
                            template.Name_pt = Convert.ToString(poReader["Name_pt"]);
                            template.Name_ru = Convert.ToString(poReader["Name_ru"]);

                            if (poReader["HtmlColor"] != DBNull.Value)
                                template.HtmlColor = Convert.ToString(poReader["HtmlColor"]);

                            templates.Add(template);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Executed GetTemplatesByIdTemplateType(idTemplateType-{0}). ErrorMessage- {1}", idTemplateType, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            Log4NetLogger.Logger.Log("Executed GetTemplatesByIdTemplateType().", category: Category.Info, priority: Priority.Low);
            return templates;
        }

        //[Sudhir.Jangra][GEOS2-5634]
        public Ots GetPendingReviewByIdOt_V2540(Int64 idOt, Warehouses warehouse)
        {
            List<SRMWarehouseBulkArticle> LstWarehouseList = GetWarehouseBulkArticle(warehouse);
            string connectionString = warehouse.Company.ConnectPlantConstr;
            Ots ot = null;

            using (MySqlConnection connOT = new MySqlConnection(connectionString))
            {
                connOT.Open();

                MySqlCommand otCommand = new MySqlCommand("SRM_GetMaterialOtInformationByIdOt_V2540", connOT);
                otCommand.CommandType = CommandType.StoredProcedure;
                otCommand.Parameters.AddWithValue("_IdOt", idOt);
                otCommand.CommandTimeout = 8000;
                using (MySqlDataReader otReader = otCommand.ExecuteReader())
                {
                    if (otReader.Read())
                    {
                        try
                        {
                            ot = new Ots();
                            ot.IdOT = idOt;

                            if (otReader["Code"] != DBNull.Value)
                                ot.OfferCode = Convert.ToString(otReader["Code"]);

                            if (otReader["OtCode"] != DBNull.Value)
                                ot.Code = Convert.ToString(otReader["OtCode"]);

                            ot.NumOT = Convert.ToByte(otReader["NumOT"]);

                            if (otReader["Comments"] != DBNull.Value)
                                ot.Comments = Convert.ToString(otReader["Comments"]);

                            if (otReader["CreatedBy"] != DBNull.Value)
                            {
                                ot.CreatedBy = Convert.ToInt32(otReader["CreatedBy"]);

                                ot.CreatedByPerson = new People();
                                ot.CreatedByPerson.IdPerson = ot.CreatedBy;
                                ot.CreatedByPerson.Name = Convert.ToString(otReader["CreatedByName"]);
                                ot.CreatedByPerson.Surname = Convert.ToString(otReader["CreatedBySurname"]);
                            }

                            ot.ReviewedBy = Convert.ToInt32(otReader["ReviewedBy"]);

                            //CreatedBy
                            if (otReader["CreatedBy"] != DBNull.Value)
                            {
                                ot.CreatedBy = Convert.ToInt32(otReader["CreatedBy"]);

                                ot.CreatedByPerson = new People();
                                ot.CreatedByPerson.IdPerson = ot.CreatedBy;
                                ot.CreatedByPerson.Name = Convert.ToString(otReader["CreatedByName"]);
                                ot.CreatedByPerson.Surname = Convert.ToString(otReader["CreatedBySurname"]);
                            }

                            if (otReader["CreationDate"] != DBNull.Value)
                                ot.CreationDate = Convert.ToDateTime(otReader["CreationDate"]);

                            //ModifiedBy
                            if (otReader["ModifiedBy"] != DBNull.Value)
                            {
                                ot.ModifiedBy = Convert.ToInt32(otReader["ModifiedBy"]);

                                ot.ModifiedByPerson = new People();
                                ot.ModifiedByPerson.IdPerson = ot.ModifiedBy;
                                ot.ModifiedByPerson.Name = Convert.ToString(otReader["ModifiedByName"]);
                                ot.ModifiedByPerson.Surname = Convert.ToString(otReader["ModifiedBySurname"]);
                            }

                            if (otReader["ModifiedIn"] != DBNull.Value)
                                ot.ModifiedIn = Convert.ToDateTime(otReader["ModifiedIn"]);

                            if (otReader["DeliveryDate"] != DBNull.Value)
                                ot.DeliveryDate = Convert.ToDateTime(otReader["DeliveryDate"]);

                            if (otReader["WareHouseLockSession"] != DBNull.Value)
                                ot.WareHouseLockSession = Convert.ToString(otReader["WareHouseLockSession"]);

                            if (otReader["AttachedFiles"] != DBNull.Value)
                                ot.AttachedFiles = Convert.ToString(otReader["AttachedFiles"]);

                            if (otReader["IdShippingAddress"] != DBNull.Value)
                                ot.IdShippingAddress = Convert.ToInt64(otReader["IdShippingAddress"]);

                            ot.IdQuotation = Convert.ToInt64(otReader["IdQuotation"]);
                            ot.Quotation = new Quotation();
                            ot.Quotation.Code = Convert.ToString(otReader["QuotationCode"]);

                            if (otReader["Year"] != DBNull.Value)
                                ot.Quotation.Year = Convert.ToInt32(otReader["Year"]);

                            if (otReader["Description"] != DBNull.Value)
                                ot.Quotation.Description = Convert.ToString(otReader["Description"]);

                            if (otReader["ProjectName"] != DBNull.Value)
                                ot.Quotation.ProjectName = Convert.ToString(otReader["ProjectName"]);


                            if (otReader["ProjectName"] != DBNull.Value)
                                ot.Quotation.ProjectName = Convert.ToString(otReader["ProjectName"]);

                            //Customer
                            if (otReader["IdSite"] != DBNull.Value)
                            {
                                ot.Quotation.Site = new Company();
                                ot.Quotation.Site.IdCompany = Convert.ToInt32(otReader["IdSite"]);
                                ot.Quotation.Site.SiteNameWithoutCountry = Convert.ToString(otReader["SiteName"]);

                                if (otReader["ShortName"] != DBNull.Value && !string.IsNullOrEmpty(Convert.ToString(otReader["ShortName"])))
                                {
                                    ot.Quotation.Site.Name = Convert.ToString(otReader["ShortName"]);
                                }
                                else
                                {
                                    ot.Quotation.Site.Name = Convert.ToString(otReader["Customer"]);
                                }

                                if (otReader["idCountry"] != DBNull.Value)
                                {
                                    ot.Quotation.Site.IdCountry = Convert.ToByte(otReader["idCountry"]);
                                    ot.Quotation.Site.Country = new Country();
                                    ot.Quotation.Site.Country.IdCountry = Convert.ToByte(otReader["idCountry"]);
                                    ot.Quotation.Site.Country.Name = otReader["CountryName"].ToString();
                                    ot.Quotation.Site.Country.Iso = otReader["iso"].ToString();

                                    if (otReader["EuroZone"] != DBNull.Value)
                                    {
                                        ot.Quotation.Site.Country.EuroZone = Convert.ToSByte(otReader["EuroZone"]);
                                    }

                                    if (otReader["IdCountryGroup"] != DBNull.Value)
                                    {
                                        ot.Quotation.Site.CountryGroup = new CountryGroup();
                                        ot.Quotation.Site.CountryGroup.IdCountryGroup = Convert.ToInt64(otReader["IdCountryGroup"]);

                                        if (otReader["CountryGroup"] != DBNull.Value)
                                            ot.Quotation.Site.CountryGroup.Name = Convert.ToString(otReader["CountryGroup"]);

                                        if (otReader["IsFreeTrade"] != DBNull.Value)
                                            ot.Quotation.Site.CountryGroup.IsFreeTrade = Convert.ToByte(otReader["IsFreeTrade"]);
                                    }
                                }

                                ot.Quotation.Site.Customer = new Customer();
                                ot.Quotation.Site.Customer.IdCustomer = Convert.ToInt32(otReader["IdCustomer"]);
                                ot.Quotation.Site.Customer.CustomerName = Convert.ToString(otReader["CustomerName"]);
                            }

                            //Detections Template
                            if (otReader["IdTemplate"] != DBNull.Value)
                            {
                                ot.Quotation.Template = new Template();
                                ot.Quotation.Template.IdTemplate = Convert.ToByte(otReader["IdTemplate"]);
                                ot.Quotation.Template.Name = Convert.ToString(otReader["Template"]);
                                ot.Quotation.Template.Type = Convert.ToInt64(otReader["IdTemplateType"]);
                            }

                            if (otReader["IdOffer"] != DBNull.Value)
                            {
                                ot.Quotation.IdOffer = Convert.ToInt32(otReader["IdOffer"]);

                                ot.Quotation.Offer = new Offer();
                                ot.Quotation.Offer.Description = Convert.ToString(otReader["Description"]);

                                if (otReader["IdCarriageMethod"] != DBNull.Value)
                                {
                                    ot.Quotation.Offer.IdCarriageMethod = Convert.ToByte(otReader["IdCarriageMethod"]);
                                    LookupValue carriage = new LookupValue();
                                    carriage.IdLookupValue = Convert.ToInt32(ot.Quotation.Offer.IdCarriageMethod);
                                    carriage.Value = Convert.ToString(otReader["CarriageValue"]);
                                    carriage.IdImage = Convert.ToInt64(otReader["CarriageImage"]);

                                    ot.Quotation.Offer.CarriageMethod = carriage;
                                }

                                if (otReader["PODate"] != DBNull.Value)
                                    ot.Quotation.Offer.POReceivedInDate = Convert.ToDateTime(otReader["PODate"]);

                                if (otReader["IdWorkflowStatus"] != DBNull.Value)
                                    ot.IdWorkflowStatus = Convert.ToByte(otReader["IdWorkflowStatus"]);

                                if (otReader["ProducerIdCountryGroup"] != DBNull.Value)
                                {
                                    ot.ProducerIdCountryGroup = Convert.ToInt64(otReader["ProducerIdCountryGroup"]);
                                    ot.CountryGroup = new CountryGroup();
                                    ot.CountryGroup.IdCountryGroup = Convert.ToInt64(otReader["ProducerIdCountryGroup"]);
                                    ot.CountryGroup.Name = Convert.ToString(otReader["ProducerCountryGroup"]);
                                    ot.CountryGroup.HtmlColor = Convert.ToString(otReader["ProducerCountryGroupColor"]);
                                }

                                if (otReader["PoNumberForReport"] != DBNull.Value)
                                {
                                    ot.PoCode = Convert.ToString(otReader["PoNumberForReport"]);
                                }

                                if (otReader["PoDateForReport"] != DBNull.Value)
                                {
                                    ot.PoDate = Convert.ToDateTime(otReader["PoDateForReport"]);
                                }

                                if (otReader["OfferOwner"] != DBNull.Value)
                                {
                                    ot.OfferOwner = Convert.ToString(otReader["OfferOwner"]);
                                }

                                if (otReader["CustomerNameForReport"] != DBNull.Value)
                                {
                                    ot.CustomerNameForReport = Convert.ToString(otReader["CustomerNameForReport"]);
                                }
                                if (otReader["idCurrency"] != DBNull.Value)
                                {
                                    ot.IdCurrency = Convert.ToByte(otReader["idCurrency"]);
                                    ot.Currency = new Currency();
                                    ot.Currency.IdCurrency = Convert.ToByte(otReader["idCurrency"]);
                                    ot.Currency.Name = Convert.ToString(otReader["CurrencyName"]);
                                    ot.Currency.Symbol = Convert.ToString(otReader["CurrencySymbol"]);
                                }
                            }
                            ot.OtItems = GetOtItemsByIdOt_V2540(connectionString, idOt, warehouse.IdWarehouse, LstWarehouseList);
                            ot.ArticleStocks = GetStockHistoryByIdOT_V2540(connectionString, idOt, warehouse.IdWarehouse);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetPendingReviewByIdOt_V2540(idOt-{0}, idWarehouse-{1}). ErrorMessage- {2} ", idOt, warehouse.IdWarehouse, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }
            return ot;
        }


        //[Sudhir.Jangra][GEOS2-5634]

        public List<OtItem> GetOtItemsByIdOt_V2540(string connectionString, Int64 idOt, Int64 idWarehouse, List<SRMWarehouseBulkArticle> LstWarehouseList)
        {
            List<OtItem> statusUpdateOtItems = new List<OtItem>();
            List<OtItem> otItems = new List<OtItem>();
            List<int> articleIds = new List<int>();
            //string idArticleList = string.Empty;
            string mainArticle = string.Empty;
            List<ArticleForecast> forecastList = new List<ArticleForecast>();
            using (MySqlConnection connOtItem = new MySqlConnection(connectionString))
            {
                connOtItem.Open();

                MySqlCommand otItemCommand = new MySqlCommand("SRM_GetOtItemsByIdOt_V2540", connOtItem);
                otItemCommand.CommandType = CommandType.StoredProcedure;
                otItemCommand.Parameters.AddWithValue("_IdOt", idOt);
                otItemCommand.Parameters.AddWithValue("_IdWarehouse", idWarehouse);
                otItemCommand.CommandTimeout = 8000;
                using (MySqlDataReader otItemReader = otItemCommand.ExecuteReader())
                {
                    int keyId = 0;

                    while (otItemReader.Read())
                    {
                        try
                        {
                            OtItem otItem = new OtItem();
                            otItem.KeyId = keyId;
                            otItem.ParentId = -1;

                            otItem.IdOT = idOt;

                            otItem.IdOTItem = Convert.ToInt64(otItemReader["IdOtItem"]);
                            otItem.IsBatch = Convert.ToByte(otItemReader["IsBatch"]);

                            if (otItemReader["AttachedFiles"] != DBNull.Value)
                                otItem.AttachedFiles = Convert.ToString(otItemReader["AttachedFiles"]);

                            otItem.Rework = Convert.ToByte(otItemReader["Rework"]);

                            if (otItemReader["IdRevisionItem"] != DBNull.Value)
                            {
                                otItem.IdRevisionItem = Convert.ToInt64(otItemReader["IdRevisionItem"]);

                                otItem.RevisionItem = new RevisionItem();
                                otItem.RevisionItem.IdRevisionItem = otItem.IdRevisionItem;
                                otItem.RevisionItem.NumItem = Convert.ToString(otItemReader["NumItem"]);
                                otItem.RevisionItem.Quantity = Convert.ToDecimal(otItemReader["Quantity"]);
                                otItem.RevisionItem.UnitPrice = Convert.ToDecimal(otItemReader["UnitPrice"]);
                                //if (otItem.RevisionItem.UnitPrice!=0 && otItem.RevisionItem.Quantity != 0)
                                //{
                                //    otItem.RevisionItem.TotalPrice = Convert.ToDouble(otItem.RevisionItem.UnitPrice* otItem.RevisionItem.Quantity).ToString("n4", CultureInfo.CurrentCulture);
                                //}
                                //else if (otItem.RevisionItem.UnitPrice == 0 && otItem.RevisionItem.Quantity != 0)
                                //{
                                //    otItem.RevisionItem.TotalPrice = Convert.ToDouble(0 * otItem.RevisionItem.Quantity).ToString("n4", CultureInfo.CurrentCulture);
                                //}
                                //else if (otItem.RevisionItem.UnitPrice == 0 && otItem.RevisionItem.Quantity == 0)
                                //{
                                //    otItem.RevisionItem.TotalPrice = Convert.ToDouble(0 * 0).ToString("n4", CultureInfo.CurrentCulture);
                                //}
                                //else if (otItem.RevisionItem.UnitPrice != 0 && otItem.RevisionItem.Quantity == 0)
                                //{
                                //    otItem.RevisionItem.TotalPrice = Convert.ToDouble(otItem.RevisionItem.UnitPrice * 0).ToString("n4", CultureInfo.CurrentCulture);
                                //}
                                //else
                                //{
                                //    otItem.RevisionItem.TotalPrice = "---";
                                //}




                                if (otItemReader["CustomerComment"] != DBNull.Value)
                                    otItem.RevisionItem.ItemRemarks = Convert.ToString(otItemReader["CustomerComment"]);

                                if (otItemReader["CustomerCommentOT"] != DBNull.Value)
                                    otItem.RevisionItem.InternalComment = Convert.ToString(otItemReader["CustomerCommentOT"]);

                                if (otItemReader["CustomerCommentRevision"] != DBNull.Value)
                                    otItem.RevisionItem.CustomerComment = Convert.ToString(otItemReader["CustomerCommentRevision"]);

                                otItem.RevisionItem.WarehouseProduct = new WarehouseProduct();
                                otItem.RevisionItem.WarehouseProduct.IdWarehouseProduct = Convert.ToInt64(otItemReader["IdWarehouseproduct"]);

                                if (otItemReader["WpDescription"] != DBNull.Value)
                                    otItem.RevisionItem.WarehouseProduct.Description = Convert.ToString(otItemReader["WpDescription"]);

                                if (otItemReader["IdArticle"] != DBNull.Value)
                                {
                                    otItem.RevisionItem.WarehouseProduct.IdArticle = Convert.ToInt32(otItemReader["IdArticle"]);

                                    Article article = new Article();
                                    article.IdArticle = Convert.ToInt32(otItemReader["IdArticle"]);
                                    article.IsGeneric = Convert.ToSByte(otItemReader["IsGeneric"]);
                                    article.Reference = Convert.ToString(otItemReader["Reference"]);
                                    article.IsObsolete = Convert.ToSByte(otItemReader["IsObsolete"]);

                                    if (otItemReader["ArticleDescription"] != DBNull.Value)
                                        article.Description = Convert.ToString(otItemReader["ArticleDescription"]);

                                    if (otItemReader["Description_es"] != DBNull.Value)
                                        article.Description_es = Convert.ToString(otItemReader["Description_es"]);

                                    if (otItemReader["Description_fr"] != DBNull.Value)
                                        article.Description_fr = Convert.ToString(otItemReader["Description_fr"]);

                                    article.ImagePath = Convert.ToString(otItemReader["ImagePath"]);
                                    article.RegisterSerialNumber = Convert.ToByte(otItemReader["RegisterSerialNumber"]);

                                    if (otItemReader["Location"] != DBNull.Value)
                                        article.Location = Convert.ToString(otItemReader["Location"]);

                                    if (otItemReader["Weight"] != DBNull.Value)
                                        article.Weight = Convert.ToDecimal(otItemReader["Weight"]);

                                    if (otItemReader["IdArticleType"] != DBNull.Value)
                                        article.IdArticleType = Convert.ToInt64(otItemReader["IdArticleType"]);

                                    otItem.RevisionItem.WarehouseProduct.Article = article;
                                }

                                if (otItemReader["Iditemotstatus"] != DBNull.Value)
                                {
                                    otItem.IdItemOtStatus = Convert.ToByte(otItemReader["Iditemotstatus"]);

                                    otItem.Status = new ItemOTStatusType();
                                    otItem.Status.IdItemOtStatus = otItem.IdItemOtStatus;
                                    otItem.Status.Name = Convert.ToString(otItemReader["Status"]);
                                    otItem.Status.HtmlColor = Convert.ToString(otItemReader["statusColor"]);
                                }

                                if (otItemReader["AssignedTo"] != DBNull.Value)
                                {
                                    otItem.AssignedTo = Convert.ToInt32(otItemReader["AssignedTo"]);

                                    otItem.AssignedToUser = new People();
                                    otItem.AssignedToUser.Name = Convert.ToString(otItemReader["AssignedName"]);
                                    otItem.AssignedToUser.Surname = Convert.ToString(otItemReader["AssignedSurname"]);
                                }

                                if (otItemReader["DownloadedQty"] != DBNull.Value)
                                    otItem.RevisionItem.DownloadedQuantity = Convert.ToInt64(otItemReader["DownloadedQty"]);

                                if (otItemReader["RemainingQty"] != DBNull.Value)
                                {
                                    //if (LstWarehouseList != null && LstWarehouseList.Any(i => i.IdArticle == otItem.RevisionItem.WarehouseProduct.IdArticle && (i.IdParent == null || i.IdParent == 0)))
                                    //{
                                    //    otItem.RevisionItem.RemainingQuantity = 0;
                                    //}
                                    //else
                                    //{
                                    //   otItem.RevisionItem.RemainingQuantity = (Int64)(otItem.RevisionItem.Quantity- Math.Abs(otItem.RevisionItem.DownloadedQuantity));
                                    // }
                                }

                                if (otItemReader["Validated"] != DBNull.Value)
                                {
                                    int validate = Convert.ToInt32(otItemReader["Validated"]);
                                    if (validate == 1)
                                    {
                                        otItem.IsReviewValidated = true;
                                        otItem.ValidatedCount = 1;
                                    }
                                }

                                //if ((Int64)otItem.RevisionItem.Quantity > 0)
                                //{
                                //    if (LstWarehouseList != null && LstWarehouseList.Any(i => i.IdArticle == otItem.RevisionItem.WarehouseProduct.IdArticle && (i.IdParent == null || i.IdParent == 0)))
                                //    {
                                //        otItem.RevisionItem.Status = 100;
                                //    }
                                //    else
                                //    {
                                //        otItem.RevisionItem.Status = (Int64)((Math.Abs((double)otItem.RevisionItem.DownloadedQuantity) / (double)otItem.RevisionItem.Quantity) * 100);
                                //    }
                                //}
                            }


                            //List<OtItem> decomposedOtItems = GetArticlesForDecomposition_V2430(connectionString, idOt, idWarehouse, otItem, ref keyId, LstWarehouseList);
                            List<OtItem> decomposedOtItems = GetArticlesForDecomposition_V2540(connectionString, idOt, idWarehouse, otItem, ref keyId, LstWarehouseList);

                            var temp = GetOtItemStatusList_V2540(connectionString);

                            if (decomposedOtItems != null && decomposedOtItems.Count > 0)
                            {

                                if (otItem.RevisionItem.WarehouseProduct.Article.IdArticleType != 2)
                                {
                                    if (LstWarehouseList != null && LstWarehouseList.Any(i => i.IdArticle == otItem.RevisionItem.WarehouseProduct.IdArticle && (i.IdParent == null || i.IdParent == 0)))
                                    {
                                        otItem.RevisionItem.Status = 100;
                                    }
                                    else
                                    {
                                        otItem.RevisionItem.Status = (Int64)((Math.Abs((double)decomposedOtItems.Sum(y => y.RevisionItem.DownloadedQuantity)) / (double)decomposedOtItems.Sum(y => y.RevisionItem.Quantity)) * 100);
                                    }
                                }
                                otItems.Add(otItem);
                                otItems.AddRange(decomposedOtItems);

                            }
                            else
                            {
                                otItems.Add(otItem);

                            }
                            keyId++;
                            if (otItem.Status.IdItemOtStatus == 1 || otItem.Status.IdItemOtStatus == 2 || otItem.Status.IdItemOtStatus == 12)
                            {
                                var text = otItem.RevisionItem.WarehouseProduct.Article.Reference;
                                List<int> desiredIds = new List<int> { 1, 2, 12 };
                                otItem.StatusList = new List<ItemOTStatusType>();
                                otItem.StatusList = temp.Where(x => desiredIds.Contains(x.IdItemOtStatus)).ToList();
                            }
                            else
                            {
                                otItem.StatusList = new List<ItemOTStatusType>();
                                otItem.StatusList = temp.Where(x => x.IdItemOtStatus == otItem.Status.IdItemOtStatus).ToList();
                            }
                            if (otItem.StatusList?.Count > 1)
                                otItem.ShowCombobox = true;
                            else
                                otItem.ShowCombobox = false;
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetOtItemsByIdOt_V2540(idOt-{0}, idWarehouse-{1}). ErrorMessage- {2}", idOt, idWarehouse, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }

                    if (otItemReader.NextResult())
                    {
                        while (otItemReader.Read())
                        {
                            try
                            {
                                if (otItemReader["IdArticle"] != DBNull.Value)
                                {
                                    foreach (var itemotItem in otItems.Where(ot => ot.RevisionItem.WarehouseProduct.IdArticle == Convert.ToInt64(otItemReader["IdArticle"])))
                                    {
                                        if (otItemReader["ArticleStock"] != DBNull.Value)
                                            itemotItem.ArticleStock = Convert.ToInt64(otItemReader["ArticleStock"]);

                                        if (otItemReader["ArticleMinimumStock"] != DBNull.Value)
                                            itemotItem.ArticleMinimumStock = Convert.ToInt64(otItemReader["ArticleMinimumStock"]);

                                        if (otItemReader["ArticleMaximumStock"] != DBNull.Value)
                                            itemotItem.ArticleMaximumStock = Convert.ToInt64(otItemReader["ArticleMaximumStock"]);
                                    }
                                }
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetOtItemsByIdOt_V2540(idOt-{0}, idWarehouse-{1}). ErrorMessage- {2}", idOt, idWarehouse, ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }

                    }



                }
            }


            List<int> idList = otItems.Select(item => item.RevisionItem.WarehouseProduct.IdArticle).ToList();

            string idArticleList = string.Join(",", idList);
            forecastList = GetArticleForecastOfTypeOT_V2540(connectionString, idArticleList, idWarehouse);

            foreach (var itemotItem in otItems)
            {
                //itemotItem.ExpectedStock = itemotItem.ArticleStock - forecastList
                //    .Where(x => x.IdArticle == itemotItem.RevisionItem.WarehouseProduct.IdArticle)
                //    ?.Sum(x => x.Quantity) ?? 0;
                itemotItem.ArticleIncoming = forecastList
                  .Where(x => x.Type == "PO" && x.IdArticle == itemotItem.RevisionItem.WarehouseProduct.IdArticle)
                  ?.Sum(x => x.Quantity) ?? 0;
                itemotItem.ArticleOutcoming = forecastList
                  .Where(x => x.Type == "OT" && x.IdArticle == itemotItem.RevisionItem.WarehouseProduct.IdArticle)
                  ?.Sum(x => x.Quantity) ?? 0;
                itemotItem.ExpectedStock = itemotItem.ArticleStock + itemotItem.ArticleIncoming - itemotItem.ArticleOutcoming;//[Sudhir.Jangra][GEOS2-6049]

            }



            //var AllStatusList = GetOtItemStatusList_V2540(connectionString);
            //foreach (var otitem in otItems.Where(i => i.ParentId != -1).GroupBy(i => i.ParentId))
            //{
            //    if (otItems.ToList().Any(i => i.KeyId == otitem.ToList().FirstOrDefault().ParentId))
            //        if (otItems.ToList().Where(i => i.KeyId == otitem.ToList().FirstOrDefault().ParentId).FirstOrDefault().RevisionItem.WarehouseProduct.Article.IdArticleType == 4)
            //        {
            //            if (!otitem.ToList().Any(i => i.RevisionItem.Status != 100))
            //            {
            //                OtItem MainOtItem = otItems.Where(i => i.KeyId == otitem.ToList().FirstOrDefault().ParentId).FirstOrDefault();
            //                MainOtItem.RevisionItem.RemainingQuantity = 0;
            //                MainOtItem.RevisionItem.Status = 100;
            //                //Shubham[skadam] GEOS2-5222 Error pecking on Geos Workbench 12 01 2024
            //                if (MainOtItem.Status != null)
            //                {
            //                    if (MainOtItem.Status.IdItemOtStatus == 1)//Check its current status is Ready(1)     
            //                    {
            //                        MainOtItem.Status = AllStatusList.FirstOrDefault(j => j.IdItemOtStatus == 8);
            //                        MainOtItem.IsFinish = true;
            //                    }
            //                }
            //            }
            //        }
            //}
            return otItems;
        }



        public List<OtItem> GetArticlesForDecomposition_V2540(string connectionString, Int64 idOt, Int64 idWarehouse, OtItem parentOtItem, ref int keyId, List<SRMWarehouseBulkArticle> LstWarehouseList)
        {
            List<OtItem> otItems = new List<OtItem>();
            using (MySqlConnection connOtItem = new MySqlConnection(connectionString))
            {
                connOtItem.Open();

                MySqlCommand otItemCommand = new MySqlCommand("SRM_GetArticlesForDecomposition_V2540", connOtItem);
                otItemCommand.CommandType = CommandType.StoredProcedure;
                otItemCommand.Parameters.AddWithValue("_IdOTitem", parentOtItem.IdOTItem);
                otItemCommand.Parameters.AddWithValue("_IdWarehouse", idWarehouse);
                otItemCommand.CommandTimeout = 8000;

                using (MySqlDataReader otItemReader = otItemCommand.ExecuteReader())
                {
                    while (otItemReader.Read())
                    {
                        try
                        {
                            keyId++;


                            OtItem otItem = new OtItem();
                            otItem.IdOT = idOt;
                            otItem.IdOTItem = Convert.ToInt64(otItemReader["IdOtItem"]);

                            if (otItemReader["IdItemOtStatus"] != DBNull.Value)
                                otItem.IdItemOtStatus = Convert.ToByte(otItemReader["IdItemOtStatus"]);


                            otItem.Rework = Convert.ToByte(otItemReader["Rework"]);

                            if (otItemReader["IdRevisionItem"] != DBNull.Value)
                            {
                                otItem.IdRevisionItem = Convert.ToInt64(otItemReader["IdRevisionItem"]);

                                otItem.RevisionItem = new RevisionItem();
                                otItem.RevisionItem.IdRevisionItem = otItem.IdRevisionItem;
                                otItem.RevisionItem.NumItem = Convert.ToString(otItemReader["NumItem"]);



                                otItem.RevisionItem.WarehouseProduct = new WarehouseProduct();
                                otItem.RevisionItem.WarehouseProduct.IdWarehouseProduct = Convert.ToInt64(otItemReader["IdWarehouseproduct"]);

                                if (otItemReader["IdComponent"] != DBNull.Value)
                                {
                                    otItem.RevisionItem.WarehouseProduct.IdComponent = Convert.ToInt64(otItemReader["IdComponent"]);
                                }


                                otItem.KeyId = keyId;

                                if (otItemReader["parentArticleType"] != DBNull.Value)
                                {
                                    otItem.ParentArticleType = Convert.ToInt64(otItemReader["parentArticleType"]);
                                }

                                if (otItemReader["idParent"] != DBNull.Value)
                                {
                                    otItem.ParentId = Convert.ToInt32(otItemReader["idParent"]);
                                }

                                if (otItem.ParentId == -1)
                                {
                                    otItem.ParentId = parentOtItem.KeyId;
                                    otItem.RevisionItem.Quantity = parentOtItem.RevisionItem.Quantity * Convert.ToDecimal(otItemReader["Quantity"]);
                                    otItem.RevisionItem.RemainingQuantityDecimal = parentOtItem.RevisionItem.Quantity * Convert.ToDecimal(otItemReader["RemainingQty"]);
                                }
                                else
                                {
                                    decimal qty = otItems.First(x => x.RevisionItem.WarehouseProduct.IdComponent == otItem.ParentId).RevisionItem.Quantity;
                                    otItem.RevisionItem.Quantity = qty * Convert.ToDecimal(otItemReader["Quantity"]);
                                    otItem.RevisionItem.RemainingQuantityDecimal = qty * Convert.ToDecimal(otItemReader["RemainingQty"]);
                                    otItem.ParentId = otItems.First(x => x.RevisionItem.WarehouseProduct.IdComponent == otItem.ParentId).KeyId;
                                }



                                if (otItemReader["IdArticle"] != DBNull.Value)
                                {
                                    otItem.RevisionItem.WarehouseProduct.IdArticle = Convert.ToInt32(otItemReader["IdArticle"]);
                                    Article article = new Article();
                                    article.IdArticle = Convert.ToInt32(otItemReader["IdArticle"]);
                                    article.IsGeneric = Convert.ToSByte(otItemReader["IsGeneric"]);
                                    article.Reference = Convert.ToString(otItemReader["Reference"]);
                                    article.IsObsolete = Convert.ToSByte(otItemReader["IsObsolete"]);

                                    if (otItemReader["Description"] != DBNull.Value)
                                        article.Description = Convert.ToString(otItemReader["Description"]);

                                    if (otItemReader["Description_es"] != DBNull.Value)
                                        article.Description_es = Convert.ToString(otItemReader["Description_es"]);

                                    if (otItemReader["Description_fr"] != DBNull.Value)
                                        article.Description_fr = Convert.ToString(otItemReader["Description_fr"]);

                                    article.ImagePath = Convert.ToString(otItemReader["ImagePath"]);
                                    article.RegisterSerialNumber = Convert.ToByte(otItemReader["RegisterSerialNumber"]);

                                    if (otItemReader["Weight"] != DBNull.Value)
                                        article.Weight = Convert.ToDecimal(otItemReader["Weight"]);

                                    if (otItemReader["Location"] != DBNull.Value)
                                        article.Location = Convert.ToString(otItemReader["Location"]);

                                    if (otItemReader["IdArticleType"] != DBNull.Value)
                                        article.IdArticleType = Convert.ToInt64(otItemReader["IdArticleType"]);

                                    otItem.RevisionItem.WarehouseProduct.Article = article;
                                }

                                if (otItemReader["Iditemotstatus"] != DBNull.Value)
                                {
                                    otItem.IdItemOtStatus = Convert.ToByte(otItemReader["Iditemotstatus"]);

                                }
                                Int32? parentidArticle = null;
                                if (otItemReader["parentidArticle"] != DBNull.Value)
                                {
                                    parentidArticle = Convert.ToInt32(otItemReader["parentidArticle"]);
                                }
                                Int32 mainParentIdArticle = 0;
                                if (otItemReader["mainParentIdArticle"] != DBNull.Value)
                                {
                                    mainParentIdArticle = Convert.ToInt32(otItemReader["mainParentIdArticle"]);
                                }

                                //if (parentOtItem.RevisionItem.WarehouseProduct.Article.IdArticleType != 2 && otItem.ParentArticleType != 2)
                                //{
                                int downloaded = GetOtItemDownloadedQuantity_V2540(connectionString, otItem.RevisionItem.WarehouseProduct.Article.IdArticle, otItem.IdOTItem, otItem.RevisionItem.WarehouseProduct.IdComponent, idWarehouse);


                                otItem.RevisionItem.DownloadedQuantity = downloaded;

                                //if (LstWarehouseList != null && LstWarehouseList.Where(i => i.IdParent > 0).Count() > 0 && LstWarehouseList.Where(i => i.IdParent > 0).ToList().Any(i => (i.IdArticle == otItem.RevisionItem.WarehouseProduct.IdArticle && i.IdParent == ((parentidArticle == null || parentidArticle == 0 || parentidArticle == -1) ? mainParentIdArticle : parentidArticle))))
                                //{
                                //    otItem.RevisionItem.RemainingQuantity = 0;



                                //    otItem.RevisionItem.Status = 100;
                                //}
                                //else
                                //{
                                otItem.RevisionItem.RemainingQuantity = ((Int64)otItem.RevisionItem.Quantity - downloaded);
                                //if ((Int64)otItem.RevisionItem.RemainingQuantityDecimal > 0)
                                //    otItem.RevisionItem.Status = (Math.Abs(otItem.RevisionItem.DownloadedQuantity) / (Int64)otItem.RevisionItem.RemainingQuantityDecimal) * 100;
                                //}
                                //}
                                //else
                                //{
                                //    if (LstWarehouseList != null && LstWarehouseList.Where(i => i.IdParent > 0).Count() > 0 && LstWarehouseList.Where(i => i.IdParent > 0).ToList().Any(i => (i.IdArticle == otItem.RevisionItem.WarehouseProduct.IdArticle && i.IdParent == ((parentidArticle == null || parentidArticle == 0 || parentidArticle == -1) ? mainParentIdArticle : parentidArticle))))
                                //    {
                                //        otItem.RevisionItem.RemainingQuantity = 0;

                                //        otItem.RevisionItem.Status = 100;
                                //    }
                                //    else
                                //    {
                                //        otItem.RevisionItem.RemainingQuantity = (Int64)otItem.RevisionItem.RemainingQuantityDecimal;
                                //    }
                                //}

                            }
                            otItems.Add(otItem);

                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetArticlesForDecomposition_V2540(idOt-{0}, idWarehouse-{1}). ErrorMessage- {2}", idOt, idWarehouse, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                    if (otItemReader.NextResult())
                    {

                        while (otItemReader.Read())
                        {
                            try
                            {
                                if (otItemReader["IdArticle"] != DBNull.Value)
                                {
                                    foreach (var itemotItem in otItems.Where(ot => ot.RevisionItem.WarehouseProduct.IdArticle == Convert.ToInt64(otItemReader["IdArticle"])))
                                    {
                                        if (otItemReader["ArticleStock"] != DBNull.Value)
                                            itemotItem.ArticleStock = Convert.ToInt64(otItemReader["ArticleStock"]);

                                        if (otItemReader["ArticleMinimumStock"] != DBNull.Value)
                                            itemotItem.ArticleMinimumStock = Convert.ToInt64(otItemReader["ArticleMinimumStock"]);
                                        if (otItemReader["ArticleMaximumStock"] != DBNull.Value)
                                            itemotItem.ArticleMaximumStock = Convert.ToInt64(otItemReader["ArticleMaximumStock"]);

                                    }
                                }

                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetOtItemsByIdOt_V2540(idOt-{0}, idWarehouse-{1}). ErrorMessage- {2}", idOt, idWarehouse, ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                    }



                }
            }

            //foreach (var otitem in otItems.Where(i => i.ParentId != -1 && i.ParentId > 0).GroupBy(i => i.ParentId))
            //{
            //    if (otItems.ToList().Any(i => i.KeyId == otitem.ToList().FirstOrDefault().ParentId))
            //        if (otItems.ToList().Where(i => i.KeyId == otitem.ToList().FirstOrDefault().ParentId).FirstOrDefault().RevisionItem.WarehouseProduct.Article.IdArticleType == 4)
            //        {
            //            if (!otitem.ToList().Any(i => i.RevisionItem.Status != 100))
            //            {
            //                OtItem MainOtItem = otItems.Where(i => i.KeyId == otitem.ToList().FirstOrDefault().ParentId).FirstOrDefault();
            //                MainOtItem.RevisionItem.RemainingQuantity = 0;
            //                MainOtItem.RevisionItem.Status = 100;
            //            }
            //        }
            //}

            return otItems;
        }

        //[Sudhir.JAngra][GEOS2-5634]
        public List<ItemOTStatusType> GetOtItemStatusList_V2540(string connectionstring)
        {
            List<ItemOTStatusType> statusList = new List<ItemOTStatusType>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionstring))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetSituationStatusDetailsById_V2540", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader rdr = mySqlCommand.ExecuteReader())
                    {
                        while (rdr.Read())
                        {
                            ItemOTStatusType status = new ItemOTStatusType();
                            if (rdr["Name"] != DBNull.Value)
                            {
                                status.Name = Convert.ToString(rdr["Name"]);
                            }
                            if (rdr["IdItemOtStatus"] != DBNull.Value)
                            {
                                status.IdItemOtStatus = Convert.ToInt16(rdr["IdItemOtStatus"]);
                            }
                            if (rdr["HtmlColor"] != DBNull.Value)
                            {
                                status.HtmlColor = Convert.ToString(rdr["HtmlColor"]);
                            }
                            if (rdr["Sequence"] != DBNull.Value)
                            {
                                status.Sequence = Convert.ToInt16(rdr["Sequence"]);
                            }
                            statusList.Add(status);
                        }
                    }
                    mySqlConnection.Close();

                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetOtItemStatusList_V2540().  ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return statusList;
        }


        //[Sudhir.Jangra][GEOS2-2540]
        public List<ArticleForecast> GetArticleForecastOfTypeOT_V2540(string connectionString, string idArticle, Int64 idWarehouse)
        {
            List<ArticleForecast> articleForecasts = new List<ArticleForecast>();

            using (MySqlConnection conn = new MySqlConnection(connectionString))
            {
                conn.Open();

                // MySqlCommand command = new MySqlCommand("SRM_GetArticleForecast_V2540_Sudhir", conn);
                MySqlCommand command = new MySqlCommand("SRM_GetArticleForecastForTypeOT_V2540", conn);
                command.CommandType = CommandType.StoredProcedure;
                command.Parameters.AddWithValue("_ArticleIds", idArticle);
                command.Parameters.AddWithValue("_IdWarehouse", idWarehouse);
                command.CommandTimeout = 8000;
                using (MySqlDataReader reader = command.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        try
                        {
                            ArticleForecast articleForecast = new ArticleForecast();

                            articleForecast.Type = "OT";
                            if (reader["IdOT"] != DBNull.Value)
                                articleForecast.Id = Convert.ToInt64(reader["IdOT"]);

                            if (reader["Customer"] != DBNull.Value)
                                articleForecast.CustomerORSupplier = Convert.ToString(reader["Customer"]);
                            if (reader["OTCode"] != DBNull.Value)
                                articleForecast.Code = Convert.ToString(reader["OTCode"]);
                            if (reader["DeliveryDate"] != DBNull.Value)
                                articleForecast.DeliveryDate = Convert.ToDateTime(reader["DeliveryDate"]);
                            if (reader["RemainingQty"] != DBNull.Value)
                                articleForecast.Quantity = Convert.ToInt64(reader["RemainingQty"]);
                            if (reader["idArticle"] != DBNull.Value)
                                articleForecast.IdArticle = Convert.ToInt64(reader["idArticle"]);

                            articleForecasts.Add(articleForecast);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetArticleForecastOfTypeOT_V2540(idArticle-{0}). ErrorMessage- {1}", idArticle, ex.Message), category: Category.Exception, priority: Priority.Low);
                        }
                    }
                    if (reader.NextResult())
                    {
                        while (reader.Read())
                        {
                            try
                            {
                                ArticleForecast articleForecast = new ArticleForecast();
                                articleForecast.Type = "PO";

                                if (reader["IdWarehousePurchaseOrder"] != DBNull.Value)
                                    articleForecast.Id = Convert.ToInt64(reader["IdWarehousePurchaseOrder"]);

                                if (reader["Supplier"] != DBNull.Value)
                                    articleForecast.CustomerORSupplier = Convert.ToString(reader["Supplier"]);
                                if (reader["POCode"] != DBNull.Value)
                                    articleForecast.Code = Convert.ToString(reader["POCode"]);
                                if (reader["DeliveryDate"] != DBNull.Value)
                                    articleForecast.DeliveryDate = Convert.ToDateTime(reader["DeliveryDate"]);
                                if (reader["RemainingQty"] != DBNull.Value)
                                    articleForecast.Quantity = Convert.ToInt64(reader["RemainingQty"]);

                                if (reader["idArticle"] != DBNull.Value)
                                    articleForecast.IdArticle = Convert.ToInt64(reader["idArticle"]);

                                articleForecasts.Add(articleForecast);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetArticleForecastOfTypeOT_V2540(idArticle-{0}). ErrorMessage- {1}", idArticle, ex.Message), category: Category.Exception, priority: Priority.Low);
                            }
                        }
                    }
                }
            }


            return articleForecasts.OrderBy(i => i.DeliveryDate).ToList();
        }

        //[Sudhir.JAngra][GEOS2-5634]

        public List<ArticlesStock> GetStockHistoryByIdOT_V2540(string connectionString, Int64 idOT, Int64 idWarehouse)
        {
            List<ArticlesStock> articlesStocks = new List<ArticlesStock>();


            using (MySqlConnection conn = new MySqlConnection(connectionString))
            {
                conn.Open();

                MySqlCommand command = new MySqlCommand("SRM_articlesstock_GetStockHistoryByIdot_V2540", conn);
                command.CommandType = CommandType.StoredProcedure;
                command.Parameters.AddWithValue("_idOT", idOT);
                command.Parameters.AddWithValue("_IdWarehouse", idWarehouse);
                command.CommandTimeout = 8000;
                using (MySqlDataReader reader = command.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        try
                        {
                            ArticlesStock articlesStock = new ArticlesStock();

                            if (reader["IdArticleStock"] != DBNull.Value)
                                articlesStock.IdArticleStock = Convert.ToUInt64(reader["IdArticleStock"]);
                            if (reader["quantity"] != DBNull.Value)
                                articlesStock.Quantity = Convert.ToInt64(reader["quantity"]);
                            if (reader["price"] != DBNull.Value)
                                articlesStock.Price = Convert.ToDouble(reader["price"]);
                            if (reader["uploadedIn"] != DBNull.Value)
                                articlesStock.UploadedIn = Convert.ToDateTime(reader["uploadedIn"]);
                            if (reader["comments"] != DBNull.Value)
                                articlesStock.Comments = Convert.ToString(reader["comments"]);
                            if (reader["isDamaged"] != DBNull.Value)
                                articlesStock.IsDamaged = Convert.ToByte(reader["isDamaged"]);
                            articlesStock.PeopleModifiedBy = new People();
                            if (reader["FirstName"] != DBNull.Value)
                                articlesStock.PeopleModifiedBy.Name = Convert.ToString(reader["FirstName"]);
                            if (reader["LastName"] != DBNull.Value)
                                articlesStock.PeopleModifiedBy.Surname = Convert.ToString(reader["LastName"]);

                            if (reader["IdWarehouseLocation"] != DBNull.Value)
                            {
                                articlesStock.WarehouseLocation = new WarehouseLocation();
                                articlesStock.WarehouseLocation.IdWarehouseLocation = Convert.ToInt64(reader["IdWarehouseLocation"]);
                                articlesStock.WarehouseLocation.FullName = Convert.ToString(reader["Location"]);
                            }
                            if (reader["IdWareHouseDeliveryNoteItem"] != DBNull.Value)
                            {
                                articlesStock.IdWarehouseDeliveryNoteItem = Convert.ToUInt64(reader["IdWarehouseDeliveryNoteItem"]);
                                articlesStock.WarehouseDeliveryNoteItem = new WarehouseDeliveryNoteItem();
                                articlesStock.WarehouseDeliveryNoteItem.IdWarehouseDeliveryNoteItem = Convert.ToInt64(reader["IdWarehouseDeliveryNoteItem"]);
                                if (reader["idWarehouseDeliveryNote"] != DBNull.Value)
                                {
                                    articlesStock.WarehouseDeliveryNoteItem.IdWarehouseDeliveryNote = Convert.ToInt64(reader["idWarehouseDeliveryNote"]);
                                    articlesStock.WarehouseDeliveryNoteItem.WarehouseDeliveryNote = new WarehouseDeliveryNote();
                                    articlesStock.WarehouseDeliveryNoteItem.WarehouseDeliveryNote.IdWarehouseDeliveryNote = Convert.ToInt64(reader["idWarehouseDeliveryNote"]);
                                    articlesStock.WarehouseDeliveryNoteItem.WarehouseDeliveryNote.Code = Convert.ToString(reader["DeliveryNote"]);
                                }

                            }


                            articlesStocks.Add(articlesStock);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetStockHistoryByIdOT_V2540(idOT-{0}). ErrorMessage- {1}", idOT, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            return articlesStocks;
        }

        //[Sudhir.Jangra][GEOS2-5634]

        internal int GetOtItemDownloadedQuantity_V2540(string connectionString, int idArticle, long idOtItem, long idWarehouseProductComponent, long idWarehouse)
        {

            using (MySqlConnection connOtItem = new MySqlConnection(connectionString))
            {
                connOtItem.Open();

                MySqlCommand otItemCommand = new MySqlCommand("SRM_GetOtItemDownloadedQuantity_V2540", connOtItem);
                otItemCommand.CommandType = CommandType.StoredProcedure;

                int dwnd = 0;

                otItemCommand.Parameters.AddWithValue("_Downloaded", dwnd);
                otItemCommand.Parameters.AddWithValue("_IdArticle", idArticle);
                otItemCommand.Parameters.AddWithValue("_IdOTItem", idOtItem);
                otItemCommand.Parameters.AddWithValue("_IdWarehouseProductComponent", idWarehouseProductComponent);
                otItemCommand.Parameters["@_Downloaded"].Direction = ParameterDirection.Output;

                otItemCommand.ExecuteNonQuery();

                dwnd = Convert.ToInt32(otItemCommand.Parameters["@_Downloaded"].Value);

                return Math.Abs(dwnd);
            }
        }


        //[Sudhir.Jangra][GEOS2-5634]
        public List<OTWorkingTime> GetOTWorkingTimeDetails_V2540(Int64 idOT, Warehouses warehouse, String userProfileImageFilePath)
        {
            List<OTWorkingTime> LstOTWorkingTime = new List<OTWorkingTime>();
            List<UserShortDetail> UserShortDetailForbytes = new List<UserShortDetail>();
            string connectionString = warehouse.Company.ConnectPlantConstr;
            using (MySqlConnection connWarehouse = new MySqlConnection(connectionString))
            {
                connWarehouse.Open();

                MySqlCommand warehouseCommand = new MySqlCommand("SRM_GetOTWorkingTimeDetails_V2540", connWarehouse);
                warehouseCommand.CommandType = CommandType.StoredProcedure;
                warehouseCommand.Parameters.AddWithValue("_IdOT", idOT);
                warehouseCommand.Parameters.AddWithValue("_IdWarehouse", warehouse.IdWarehouse);

                using (MySqlDataReader warehouseReader = warehouseCommand.ExecuteReader())
                {
                    while (warehouseReader.Read())
                    {
                        try
                        {
                            OTWorkingTime otWorkingTime = new OTWorkingTime();

                            if (warehouseReader["IdOTWorkingTime"] != DBNull.Value)
                                otWorkingTime.IdOTWorkingTime = Convert.ToInt64(warehouseReader["IdOTWorkingTime"]);

                            if (warehouseReader["IdOT"] != DBNull.Value)
                                otWorkingTime.IdOT = Convert.ToInt64(warehouseReader["IdOT"]);

                            if (warehouseReader["IdStage"] != DBNull.Value)
                                otWorkingTime.IdStage = Convert.ToByte(warehouseReader["IdStage"]);

                            if (warehouseReader["StartDate"] != DBNull.Value)
                                otWorkingTime.StartTime = Convert.ToDateTime(warehouseReader["StartDate"]);

                            //if (warehouseReader["StartTime"] != DBNull.Value)
                            //    otWorkingTime.StartTimeInHoursAndMinutes = warehouseReader["StartTime"].ToString();

                            if (warehouseReader["EndDate"] != DBNull.Value)
                                otWorkingTime.EndTime = Convert.ToDateTime(warehouseReader["EndDate"]);

                            if (warehouseReader["TotalTime"] != DBNull.Value)
                            {
                                otWorkingTime.TotalTime = (TimeSpan)warehouseReader["TotalTime"];
                                otWorkingTime.TotalTime = new TimeSpan(otWorkingTime.TotalTime.Days, otWorkingTime.TotalTime.Hours, otWorkingTime.TotalTime.Minutes, 00);
                            }

                            //if (warehouseReader["EndTime"] != DBNull.Value)
                            //    otWorkingTime.EndTimeInHoursAndMinutes =warehouseReader["EndTime"].ToString();

                            if (warehouseReader["IdOperator"] != DBNull.Value)
                            {
                                otWorkingTime.IdOperator = Convert.ToInt32(warehouseReader["IdOperator"]);

                                otWorkingTime.UserShortDetail = new UserShortDetail();
                                otWorkingTime.UserShortDetail.IdUser = Convert.ToInt32(warehouseReader["IdOperator"]);
                                otWorkingTime.UserShortDetail.Login = Convert.ToString(warehouseReader["Login"]);
                                otWorkingTime.UserShortDetail.UserName = Convert.ToString(warehouseReader["UserName"]);

                                if (warehouseReader["IdUserGender"] != DBNull.Value)
                                    otWorkingTime.UserShortDetail.IdUserGender = Convert.ToByte(warehouseReader["IdUserGender"]);

                                if (UserShortDetailForbytes.Any(usd => usd.Login == otWorkingTime.UserShortDetail.Login))
                                {
                                    otWorkingTime.UserShortDetail.UserImageInBytes = UserShortDetailForbytes.Where(usd => usd.Login == otWorkingTime.UserShortDetail.Login).FirstOrDefault().UserImageInBytes;
                                }
                                else
                                {
                                    otWorkingTime.UserShortDetail.UserImageInBytes = GetUserProfileImageInBytes(otWorkingTime.UserShortDetail.Login, userProfileImageFilePath);
                                    UserShortDetail userShortDetail = new UserShortDetail();
                                    userShortDetail.IdUser = otWorkingTime.UserShortDetail.IdUser;
                                    userShortDetail.IdUserGender = otWorkingTime.UserShortDetail.IdUserGender;
                                    userShortDetail.Login = otWorkingTime.UserShortDetail.Login;
                                    userShortDetail.UserName = otWorkingTime.UserShortDetail.UserName;

                                    userShortDetail.UserImageInBytes = otWorkingTime.UserShortDetail.UserImageInBytes;
                                    UserShortDetailForbytes.Add(userShortDetail);
                                }
                            }


                            LstOTWorkingTime.Add(otWorkingTime);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetOTWorkingTimeDetails_V2540(). ErrorMessage-" + ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }



            return LstOTWorkingTime;
        }


        //[Sudhir.Jangra][GEOS2-5634]
        private byte[] GetUserProfileImageInBytes(string LoginName, string filePath)
        {
            byte[] bytes = null;
            string fileUploadPath = "";

            if (File.Exists(filePath + LoginName + ".png"))
            {
                fileUploadPath = filePath + LoginName + ".png";
            }
            else
            {
                fileUploadPath = filePath + LoginName + ".jpg";
            }
            if (File.Exists(fileUploadPath))
            {
                using (System.IO.FileStream stream = new System.IO.FileStream(fileUploadPath, System.IO.FileMode.Open, System.IO.FileAccess.Read))
                {
                    bytes = new byte[stream.Length];
                    int numBytesToRead = (int)stream.Length;
                    int numBytesRead = 0;
                    while (numBytesToRead > 0)
                    {
                        // Read may return anything from 0 to numBytesToRead.
                        int n = stream.Read(bytes, numBytesRead, numBytesToRead);

                        // Break when the end of the file is reached.
                        if (n == 0)
                            break;

                        numBytesRead += n;
                        numBytesToRead -= n;
                    }
                }

                return bytes;
            }
            else
            {
                return null;
            }

        }


        //[Sudhir.Jangra][GEOS2-5634]

        public List<WorkflowTransition> GetAllWorkflowTransitions_V2540(string connectionString)
        {

            List<WorkflowTransition> workflowTransitionList = new List<WorkflowTransition>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("SRM_Get_workflow_transitions_V2540", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                    {
                        while (mySqlDataReader.Read())
                        {
                            WorkflowTransition workflowTransition = new WorkflowTransition();

                            workflowTransition.IdWorkflowTransition = Convert.ToUInt32(mySqlDataReader["IdWorkflowTransition"]);

                            if (mySqlDataReader["IdWorkflow"] != DBNull.Value)
                                workflowTransition.IdWorkflow = Convert.ToUInt32(mySqlDataReader["IdWorkflow"]);

                            if (mySqlDataReader["Name"] != DBNull.Value)
                                workflowTransition.Name = mySqlDataReader["Name"].ToString();

                            if (mySqlDataReader["IdWorkflowStatusFrom"] != DBNull.Value)
                                workflowTransition.IdWorkflowStatusFrom = Convert.ToByte(mySqlDataReader["IdWorkflowStatusFrom"]);

                            if (mySqlDataReader["IdWorkflowStatusTo"] != DBNull.Value)
                                workflowTransition.IdWorkflowStatusTo = Convert.ToByte(mySqlDataReader["IdWorkflowStatusTo"]);

                            if (mySqlDataReader["IsCommentRequired"] != DBNull.Value)
                                workflowTransition.IsCommentRequired = Convert.ToByte(mySqlDataReader["IsCommentRequired"]);

                            if (mySqlDataReader["IdWorkflowScope"] != DBNull.Value)
                                workflowTransition.IdWorkflowScope = Convert.ToUInt32(mySqlDataReader["IdWorkflowScope"]);

                            workflowTransitionList.Add(workflowTransition);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllWorkflowTransitions_V2540(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return workflowTransitionList;
        }

        //[Sudhir.Jangra][GEOS2-5634]

        public List<WorkflowStatus> GetAllWorkflowStatus_V2540(string connectionString)
        {

            List<WorkflowStatus> workflowStatusList = new List<WorkflowStatus>();
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetAllWorkflowStatus_V2540", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;

                    using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                    {
                        while (mySqlDataReader.Read())
                        {
                            WorkflowStatus workflowStatus = new WorkflowStatus();

                            workflowStatus.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);

                            if (mySqlDataReader["IdWorkflow"] != DBNull.Value)
                                workflowStatus.IdWorkflow = Convert.ToUInt32(mySqlDataReader["IdWorkflow"].ToString());

                            if (mySqlDataReader["Name"] != DBNull.Value)
                                workflowStatus.Name = mySqlDataReader["Name"].ToString();

                            if (mySqlDataReader["HtmlColor"] != DBNull.Value)
                                workflowStatus.HtmlColor = mySqlDataReader["HtmlColor"].ToString();

                            if (mySqlDataReader["IdWorkflowScope"] != DBNull.Value)
                                workflowStatus.IdWorkflowScope = Convert.ToUInt32(mySqlDataReader["IdWorkflowScope"].ToString());

                            workflowStatusList.Add(workflowStatus);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetAllWorkflowStatus_V2540(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return workflowStatusList;
        }


        //[Sudhir.Jangra][GEOS2-5635]
        public Article GetArticleDetails_V2540(Int32 idArticle, string articleVisualAidsPath, string connectionString)
        {
            Article article = new Article();

            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetArticleDetails_V2540", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_idArticle", idArticle);


                using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                {
                    if (reader.Read())
                    {
                        try
                        {
                            if (reader["idArticle"] != DBNull.Value)
                                article.IdArticle = Convert.ToInt32(reader["idArticle"]);


                            if (reader["ImagePath"] != DBNull.Value)
                            {
                                article.ImagePath = Convert.ToString(reader["ImagePath"]);

                                if (!string.IsNullOrEmpty(article.ImagePath))
                                    article.ArticleImageInBytes = GetArticleImageInBytes_V2540(articleVisualAidsPath, article);
                            }

                            if (reader["Reference"] != DBNull.Value)
                                article.Reference = reader["Reference"].ToString();


                            if (reader["Description"] != DBNull.Value)
                                article.Description = Convert.ToString(reader["Description"]);

                            if (reader["idArticleSupplier"] != DBNull.Value)
                            {
                                if (article.ArticleBySupplier == null)
                                {
                                    article.ArticleBySupplier = new ArticleBySupplier();
                                }
                                article.ArticleBySupplier.IdArticleSupplier = Convert.ToInt64(reader["idArticleSupplier"]);
                                article.ArticleBySupplier.Reference = Convert.ToString(reader["FavoriteSupplierName"]);
                            }
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetArticleDetails_V2540(). IdArticle-{0} ErrorMessage- {1}", article.IdArticle, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }


            }

            return article;
        }


        public byte[] GetArticleImageInBytes_V2540(string ArticleVisualAidsPath, Article article)
        {
            if (!Directory.Exists(ArticleVisualAidsPath))
            {
                return null;
            }

            string fileUploadPath = ArticleVisualAidsPath + article.ImagePath;

            if (!File.Exists(fileUploadPath))
            {
                return null;
            }

            if (article != null && !string.IsNullOrEmpty(article.ImagePath))
            {

                byte[] bytes = null;

                try
                {
                    using (System.IO.FileStream stream = new System.IO.FileStream(fileUploadPath, System.IO.FileMode.Open, System.IO.FileAccess.Read))
                    {
                        bytes = new byte[stream.Length];
                        int numBytesToRead = (int)stream.Length;
                        int numBytesRead = 0;

                        while (numBytesToRead > 0)
                        {
                            // Read may return anything from 0 to numBytesToRead.
                            int n = stream.Read(bytes, numBytesRead, numBytesToRead);

                            // Break when the end of the file is reached.
                            if (n == 0)
                                break;

                            numBytesRead += n;
                            numBytesToRead -= n;
                        }
                    }

                    return bytes;
                }

                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error GetArticleImageInBytes_V2540() article ImagePath-{0}. ErrorMessage- {1}", article.ImagePath, ex.Message), category: Category.Exception, priority: Priority.Low);
                    //throw;
                }
            }

            return null;
        }


        //[Sudhir.Jangra][GEOS2-5635]
        public WarehouseDeliveryNote GetWarehouseDeliveryNoteById_V2540(string connectionString, string articleVisualAidsPath, string purchaseOrdersPath, Int64 idWarehouseDeliveryNote)
        {
            //string connectionString = warehouse.Company.ConnectPlantConstr;

            WarehouseDeliveryNote warehouseDeliveryNote = null;

            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();
                //Shubham[skadam] GEOS2-5226 NO SE PUEDE DESBLOQUEAR UN ALBARÁN DE LA REFERENCIA 02MOTTRONIC 12 01 2024
                //MySqlCommand poCommand = new MySqlCommand("warehouse_GetWarehouseDeliveryNote", mySqlConnection);
                MySqlCommand poCommand = new MySqlCommand("SRM_GetWarehouseDeliveryNote_V2540", mySqlConnection);
                poCommand.CommandType = CommandType.StoredProcedure;
                poCommand.Parameters.AddWithValue("_IdWarehouseDeliveryNote", idWarehouseDeliveryNote);

                using (MySqlDataReader reader = poCommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        try
                        {
                            warehouseDeliveryNote = new WarehouseDeliveryNote();

                            if (reader["IdWarehouseDeliveryNote"] != DBNull.Value)
                                warehouseDeliveryNote.IdWarehouseDeliveryNote = Convert.ToInt64(reader["IdWarehouseDeliveryNote"]);

                            if (reader["WdnCode"] != DBNull.Value)
                                warehouseDeliveryNote.Code = Convert.ToString(reader["WdnCode"]);

                            if (reader["IdCurrencyImportExpenses"] != DBNull.Value)
                                warehouseDeliveryNote.IdCurrencyImportExpenses = Convert.ToInt64(reader["IdCurrencyImportExpenses"]);

                            if (reader["ImportExpenses"] != DBNull.Value)
                                warehouseDeliveryNote.ImportExpenses = Convert.ToDouble(reader["ImportExpenses"]);

                            if (reader["AttachedDeliveryNotes"] != DBNull.Value)
                                warehouseDeliveryNote.AttachedDeliveryNotes = Convert.ToByte(reader["AttachedDeliveryNotes"]);

                            if (reader["DeliveryDate"] != DBNull.Value)
                                warehouseDeliveryNote.DeliveryDate = Convert.ToDateTime(reader["DeliveryDate"]);

                            if (reader["WdnCreatedIn"] != DBNull.Value)
                                warehouseDeliveryNote.CreatedIn = Convert.ToDateTime(reader["WdnCreatedIn"]);

                            if (reader["ModifiedIn"] != DBNull.Value)
                                warehouseDeliveryNote.ModifiedIn = Convert.ToDateTime(reader["ModifiedIn"]);

                            if (reader["SupplierCode"] != DBNull.Value)
                                warehouseDeliveryNote.SupplierCode = Convert.ToString(reader["SupplierCode"]);

                            if (reader["LocalIdCurrency"] != DBNull.Value)
                                warehouseDeliveryNote.IdCurrency = Convert.ToByte(reader["LocalIdCurrency"]);

                            if (reader["ExchangeRate"] != DBNull.Value)
                                warehouseDeliveryNote.ExchangeRate = Convert.ToDouble(reader["ExchangeRate"]);

                            if (reader["ZF01"] != DBNull.Value)
                                warehouseDeliveryNote.ZF01 = Convert.ToString(reader["ZF01"]);

                            if (reader["CurrentlyAccessedBy"] != DBNull.Value)
                                warehouseDeliveryNote.CurrentlyAccessedBy = Convert.ToInt32(reader["CurrentlyAccessedBy"]);

                            if (reader["IdWarehousePurchaseOrder"] != DBNull.Value)
                            {
                                warehouseDeliveryNote.IdWarehousePurchaseOrder = Convert.ToInt64(reader["IdWarehousePurchaseOrder"]);

                                warehouseDeliveryNote.WarehousePurchaseOrder = new WarehousePurchaseOrder();
                                warehouseDeliveryNote.WarehousePurchaseOrder.IdWarehousePurchaseOrder = warehouseDeliveryNote.IdWarehousePurchaseOrder;

                                if (reader["WpoCode"] != DBNull.Value)
                                    warehouseDeliveryNote.WarehousePurchaseOrder.Code = Convert.ToString(reader["WpoCode"]);

                                if (reader["Idcurrency"] != DBNull.Value)
                                    warehouseDeliveryNote.WarehousePurchaseOrder.IdCurrency = Convert.ToByte(reader["Idcurrency"]);

                                if (reader["IdWarehouse"] != DBNull.Value)
                                    warehouseDeliveryNote.WarehousePurchaseOrder.IdWarehouse = Convert.ToInt64(reader["IdWarehouse"]);


                                if (reader["WpoCreatedIn"] != DBNull.Value)
                                {
                                    warehouseDeliveryNote.WarehousePurchaseOrder.CreatedIn = Convert.ToDateTime(reader["WpoCreatedIn"]);

                                    warehouseDeliveryNote.PdfFilePath = purchaseOrdersPath + @"\" + warehouseDeliveryNote.WarehousePurchaseOrder.CreatedIn.Year + @"\" + warehouseDeliveryNote.WarehousePurchaseOrder.Code + @"\02 Delivery Notes\DN_" + warehouseDeliveryNote.Code + ".pdf"; ;
                                }

                                if (reader["IdArticleSupplier"] != DBNull.Value)
                                {
                                    warehouseDeliveryNote.WarehousePurchaseOrder.IdArticleSupplier = Convert.ToInt64(reader["IdArticleSupplier"]);

                                    warehouseDeliveryNote.WarehousePurchaseOrder.ArticleSupplier = new ArticleSupplier();
                                    warehouseDeliveryNote.WarehousePurchaseOrder.ArticleSupplier.IdArticleSupplier = warehouseDeliveryNote.WarehousePurchaseOrder.IdArticleSupplier;

                                    if (reader["Supplier"] != DBNull.Value)
                                        warehouseDeliveryNote.WarehousePurchaseOrder.ArticleSupplier.Name = Convert.ToString(reader["Supplier"]);

                                    if (reader["IdCountry"] != DBNull.Value)
                                    {
                                        warehouseDeliveryNote.WarehousePurchaseOrder.ArticleSupplier.IdCountry = Convert.ToInt64(reader["IdCountry"]);

                                        if (reader["IdCountryGroup"] != DBNull.Value)
                                        {
                                            warehouseDeliveryNote.WarehousePurchaseOrder.ArticleSupplier.Country = new Country();
                                            warehouseDeliveryNote.WarehousePurchaseOrder.ArticleSupplier.Country.IdCountryGroup = Convert.ToInt64(reader["IdCountryGroup"]);
                                        }
                                    }

                                    if (reader["IdArticleSupplierType"] != DBNull.Value)
                                    {
                                        warehouseDeliveryNote.WarehousePurchaseOrder.ArticleSupplier.IdArticleSupplierType = Convert.ToInt32(reader["IdArticleSupplierType"]);

                                        ArticleSupplierType articleSupplierType = new ArticleSupplierType();
                                        articleSupplierType.IdArticleSupplierType = warehouseDeliveryNote.WarehousePurchaseOrder.ArticleSupplier.IdArticleSupplierType;
                                        articleSupplierType.Name = Convert.ToString(reader["ArticleSupplierType"]);
                                        articleSupplierType.HtmlColor = Convert.ToString(reader["HtmlColor"]);

                                        warehouseDeliveryNote.WarehousePurchaseOrder.ArticleSupplier.ArticleSupplierType = articleSupplierType;
                                    }
                                }
                            }
                            //[Sudhir.jangra][GEOS2-5457]
                            warehouseDeliveryNote.WarehouseDeliveryNoteItems = GetWarehouseDeliveryNoteItemsByIdWDN_V2540(connectionString, articleVisualAidsPath, idWarehouseDeliveryNote, warehouseDeliveryNote.WarehousePurchaseOrder);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetWarehouseDeliveryNoteById_V2540(idWarehouseDeliveryNote-{0}). ErrorMessage-{1}", idWarehouseDeliveryNote, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            return warehouseDeliveryNote;
        }


        //[Sudhir.jangra][GEOS2-5635]
        public List<WarehouseDeliveryNoteItem> GetWarehouseDeliveryNoteItemsByIdWDN_V2540(string connectionString, string articleVisualAidsPath, Int64 idWarehouseDeliveryNote, WarehousePurchaseOrder warehousePurchaseOrder)
        {
            //string connectionString = warehouse.Company.ConnectPlantConstr;

            List<WarehouseDeliveryNoteItem> warehouseDeliveryNoteItems = new List<WarehouseDeliveryNoteItem>();

            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();

                MySqlCommand poCommand = new MySqlCommand("SRM_GetWarehouseDeliveryNoteItems_V2540", mySqlConnection);
                poCommand.CommandType = CommandType.StoredProcedure;
                poCommand.Parameters.AddWithValue("_IdWarehouseDeliveryNote", idWarehouseDeliveryNote);

                using (MySqlDataReader reader = poCommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        try
                        {
                            WarehouseDeliveryNoteItem warehouseDeliveryNoteItem = new WarehouseDeliveryNoteItem();

                            if (reader["IdWarehouseDeliveryNoteItem"] != DBNull.Value)
                                warehouseDeliveryNoteItem.IdWarehouseDeliveryNoteItem = Convert.ToInt64(reader["IdWarehouseDeliveryNoteItem"]);

                            if (reader["IdWarehousePurchaseOrderItem"] != DBNull.Value)
                            {
                                warehouseDeliveryNoteItem.IdWarehousePurchaseOrderItem = Convert.ToInt64(reader["IdWarehousePurchaseOrderItem"]);

                                warehouseDeliveryNoteItem.WarehousePurchaseOrderItem = new WarehousePurchaseOrderItem();
                                warehouseDeliveryNoteItem.WarehousePurchaseOrderItem.IdWarehousePurchaseOrderItem = warehouseDeliveryNoteItem.IdWarehousePurchaseOrderItem;

                                if (reader["IdWarehousePurchaseOrder"] != DBNull.Value)
                                    warehouseDeliveryNoteItem.WarehousePurchaseOrderItem.IdWarehousePurchaseOrder = Convert.ToInt64(reader["IdWarehousePurchaseOrder"]);

                                if (reader["Description"] != DBNull.Value)
                                    warehouseDeliveryNoteItem.WarehousePurchaseOrderItem.Description = Convert.ToString(reader["Description"]);

                                if (reader["TotalQuantity"] != DBNull.Value)
                                    warehouseDeliveryNoteItem.WarehousePurchaseOrderItem.Quantity = Convert.ToDouble(reader["TotalQuantity"]);

                                if (reader["UnitPrice"] != DBNull.Value)
                                    warehouseDeliveryNoteItem.WarehousePurchaseOrderItem.UnitPrice = Convert.ToDouble(reader["UnitPrice"]);

                                if (reader["Discount"] != DBNull.Value)
                                    warehouseDeliveryNoteItem.WarehousePurchaseOrderItem.Discount = Convert.ToDouble(reader["Discount"]);

                                if (reader["Iva"] != DBNull.Value)
                                    warehouseDeliveryNoteItem.WarehousePurchaseOrderItem.IVA = Convert.ToInt64(reader["Iva"]);
                            }

                            if (reader["Quantity"] != DBNull.Value)
                                warehouseDeliveryNoteItem.Quantity = Convert.ToInt32(reader["Quantity"]);

                            if (reader["Uploaded"] != DBNull.Value)
                                warehouseDeliveryNoteItem.Uploaded = Convert.ToByte(reader["Uploaded"]);

                            if (reader["CustomsDuty"] != DBNull.Value)
                                warehouseDeliveryNoteItem.CustomsDuty = Convert.ToDouble(reader["CustomsDuty"]);

                            if (reader["IdManufacturerByArticle"] != DBNull.Value)
                                warehouseDeliveryNoteItem.IdManufacturerByArticle = Convert.ToInt64(reader["IdManufacturerByArticle"]);

                            if (reader["IdArticle"] != DBNull.Value)
                            {
                                Article article = new Article();
                                article.IdArticle = Convert.ToInt32(reader["IdArticle"]);
                                warehouseDeliveryNoteItem.WarehousePurchaseOrderItem.IdArticle = article.IdArticle;

                                if (reader["Reference"] != DBNull.Value)
                                    article.Reference = Convert.ToString(reader["Reference"]);

                                if (reader["ArticleDescription"] != DBNull.Value)
                                    article.Description = Convert.ToString(reader["ArticleDescription"]);

                                if (reader["RegisterSerialNumber"] != DBNull.Value)
                                    article.RegisterSerialNumber = Convert.ToByte(reader["RegisterSerialNumber"]);

                                article.IsGeneric = Convert.ToSByte(reader["IsGeneric"]);

                                if (reader["ImagePath"] != DBNull.Value)
                                {
                                    article.ImagePath = Convert.ToString(reader["ImagePath"]);

                                    if (!string.IsNullOrEmpty(article.ImagePath))
                                        article.ArticleImageInBytes = GetArticleImageInBytes_V2540(articleVisualAidsPath, article);
                                }

                                article.MyWarehouse = new MyWarehouse();

                                if (reader["CurrentStock"] != DBNull.Value)
                                    article.MyWarehouse.CurrentStock = Convert.ToInt64(reader["CurrentStock"]);

                                if (reader["MinimumStock"] != DBNull.Value)
                                    article.MyWarehouse.MinimumStock = Convert.ToInt64(reader["MinimumStock"]);

                                if (reader["MaximumStock"] != DBNull.Value)
                                    article.MyWarehouse.MaximumStock = Convert.ToInt64(reader["MaximumStock"]);

                                if (reader["IdWarehouse"] != DBNull.Value)
                                    article.MyWarehouse.IdWarehouse = Convert.ToInt64(reader["IdWarehouse"]);



                                warehouseDeliveryNoteItem.WarehousePurchaseOrderItem.Article = article;
                                warehouseDeliveryNoteItem.ManufacturersByArticle = GetManufacturersByIdArticle_V2540(connectionString, article.IdArticle, warehousePurchaseOrder);
                            }
                            if (reader["LockedForOrderPicking"] != DBNull.Value)
                            {
                                Int16 islock = Convert.ToInt16(reader["LockedForOrderPicking"]);
                                if (islock == 1)
                                {
                                    warehouseDeliveryNoteItem.IsLocked = true;
                                }
                                else
                                {
                                    warehouseDeliveryNoteItem.IsLocked = false;
                                }

                            }
                            if (reader["IdLockedReason"] != DBNull.Value)
                            {
                                warehouseDeliveryNoteItem.IdLockedReason = Convert.ToUInt32(reader["IdLockedReason"]);
                                warehouseDeliveryNoteItem.ReasonComment = Convert.ToString(reader["LockedComments"]);
                            }

                            warehouseDeliveryNoteItems.Add(warehouseDeliveryNoteItem);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetWarehouseDeliveryNoteItemsByIdWDN_V2540(idWarehouseDeliveryNote-{0}). ErrorMessage-{1}", idWarehouseDeliveryNote, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            return warehouseDeliveryNoteItems;
        }


        //[Sudhir.jangra][GEOS2-5635]
        public List<ManufacturersByArticle> GetManufacturersByIdArticle_V2540(string connectionString, Int32 idArticle, WarehousePurchaseOrder wpo)
        {
            List<ManufacturersByArticle> manufacturersByArticles = new List<ManufacturersByArticle>();

            ManufacturersByArticle manufacturersByArticleDefault = new ManufacturersByArticle();
            manufacturersByArticleDefault.Manufacturer = new Manufacturer();
            manufacturersByArticleDefault.Manufacturer.Name = "---";
            manufacturersByArticleDefault.ManufacturerWithCountry = "---";
            manufacturersByArticleDefault.IsSameCountryGroup = true;
            manufacturersByArticles.Add(manufacturersByArticleDefault);

            using (MySqlConnection connWarehousePurchaseOrderItem = new MySqlConnection(connectionString))
            {
                connWarehousePurchaseOrderItem.Open();

                MySqlCommand dNItemsCommand = new MySqlCommand("SRM_GetManufacturersByIdArticle_V2540", connWarehousePurchaseOrderItem);
                dNItemsCommand.CommandType = CommandType.StoredProcedure;
                dNItemsCommand.Parameters.AddWithValue("_IdArticle", idArticle);

                using (MySqlDataReader dNReader = dNItemsCommand.ExecuteReader())
                {
                    while (dNReader.Read())
                    {
                        try
                        {
                            ManufacturersByArticle manufacturersByArticle = new ManufacturersByArticle();

                            manufacturersByArticle.IdArticle = idArticle;

                            if (dNReader["IdManufacturerByArticle"] != DBNull.Value)
                                manufacturersByArticle.IdManufacturerByArticle = Convert.ToInt64(dNReader["IdManufacturerByArticle"]);

                            if (dNReader["IdManufacturer"] != DBNull.Value)
                            {
                                manufacturersByArticle.IdManufacturer = Convert.ToInt64(dNReader["IdManufacturer"]);
                                manufacturersByArticle.Manufacturer = new Manufacturer();
                                manufacturersByArticle.Manufacturer.IdManufacturer = manufacturersByArticle.IdManufacturer;
                                manufacturersByArticle.Manufacturer.Name = Convert.ToString(dNReader["ManufacturerName"]);
                            }

                            if (dNReader["idCountry"] != DBNull.Value)
                            {
                                manufacturersByArticle.IdCountry = Convert.ToInt64(dNReader["idCountry"]);

                                manufacturersByArticle.Country = new Country();
                                manufacturersByArticle.Country.IdCountry = Convert.ToByte(manufacturersByArticle.IdCountry);
                                manufacturersByArticle.Country.Name = Convert.ToString(dNReader["CountryName"]);
                                manufacturersByArticle.Country.Iso = Convert.ToString(dNReader["Iso"]);

                                if (dNReader["EuroZone"] != DBNull.Value)
                                    manufacturersByArticle.Country.EuroZone = Convert.ToSByte(dNReader["EuroZone"]);

                                if (dNReader["IdCountryGroup"] != DBNull.Value)
                                {
                                    manufacturersByArticle.CountryGroup = new CountryGroup();
                                    manufacturersByArticle.CountryGroup.IdCountryGroup = Convert.ToInt64(dNReader["IdCountryGroup"]);

                                    if (wpo != null && wpo.ArticleSupplier != null && wpo.ArticleSupplier.Country != null
                                        && wpo.ArticleSupplier.Country.IdCountryGroup != 0
                                        && wpo.ArticleSupplier.Country.IdCountryGroup == manufacturersByArticle.CountryGroup.IdCountryGroup)
                                    {
                                        manufacturersByArticle.IsSameCountryGroup = true;
                                    }

                                    if (dNReader["CountryGroup"] != DBNull.Value)
                                        manufacturersByArticle.CountryGroup.Name = Convert.ToString(dNReader["CountryGroup"]);

                                    manufacturersByArticle.CountryGroup.IsFreeTrade = Convert.ToByte(dNReader["IsFreeTrade"]);
                                }
                            }

                            if (manufacturersByArticle.Manufacturer != null && manufacturersByArticle.Country != null)
                                manufacturersByArticle.ManufacturerWithCountry = manufacturersByArticle.Manufacturer.Name + " | " + manufacturersByArticle.Country.Name;

                            manufacturersByArticles.Add(manufacturersByArticle);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetManufacturersByIdArticle(idArticle-{0}). ErrorMessage- {1}", idArticle, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            return manufacturersByArticles;
        }


        //[Sudhir.jangra][GEOS2-5635]
        public bool UpdateWorkLog_V2540(Company company, OTWorkingTime otWorkingTime)
        {
            bool isUpdated = false;
            string connectionString = company.ConnectPlantConstr;
            TransactionScope transactionScope = null;
            try
            {
                using (transactionScope = new TransactionScope())
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                    {
                        mySqlConnection.Open();
                        MySqlCommand mySqlCommand = new MySqlCommand("SRM_OTWorkingTimeUpdate_V2540", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdOTWorkingTime", otWorkingTime.IdOTWorkingTime);
                        mySqlCommand.Parameters.AddWithValue("_IdOperator", otWorkingTime.IdOperator);
                        mySqlCommand.Parameters.AddWithValue("_StartTime", otWorkingTime.StartTime);
                        mySqlCommand.Parameters.AddWithValue("_EndTime", otWorkingTime.EndTime);
                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }


                    transactionScope.Complete();
                    isUpdated = true;
                }
            }
            catch (Exception ex)
            {

                if (Transaction.Current != null)
                    Transaction.Current.Rollback();

                if (transactionScope != null)
                    transactionScope.Dispose();

                isUpdated = false;
                throw;
            }
            return isUpdated;
        }


        //[Sudhir.Jangra][GEOS2-5635]
        public bool UpdateEditWorkOrderOTItems_V2540(string connectionString, string mainServerConnectionString, List<OtItem> ots, List<SRMOtItemsComment> changeLog)
        {
            bool isUpdated = false;
            try
            {
                if (ots != null)
                {

                    using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                    {
                        mySqlConnection.Open();
                        foreach (OtItem item in ots.Distinct())
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("SRM_updateRevisionItemValidate_V2540", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdRevisionItem", item.IdRevisionItem);
                            if (item.IsReviewValidated == true)
                            {
                                mySqlCommand.Parameters.AddWithValue("_Validated", 1);
                            }
                            else
                            {
                                mySqlCommand.Parameters.AddWithValue("_Validated", 0);
                            }


                            mySqlCommand.ExecuteNonQuery();
                        }



                        mySqlConnection.Close();

                    }
                    if (changeLog.Count > 0 && changeLog != null)
                    {
                        AddChangeLogForOtItemValidated_V2540(connectionString, changeLog);
                    }

                    isUpdated = true;
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error UpdateEditWorkOrderOTItems().  ErrorMessage- {1}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return isUpdated;
        }





        //[sudhir.jangra][GEOS2-5635]
        public List<OTAssignedUser> GetOTAssignedUsers_V2540(Company company, Int64 idOT, string userProfileImageFilePath)
        {
            string connectionString = company.ConnectPlantConstr;
            List<OTAssignedUser> otAssignedUsers = new List<OTAssignedUser>();
            List<UserShortDetail> userShortDetails = new List<UserShortDetail>();
            try
            {

                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetOTAssignedUsers_V2540", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_idOT", idOT);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            OTAssignedUser otAssignedUser = new OTAssignedUser();

                            if (reader["IdOTAssignedUser"] != DBNull.Value)
                                otAssignedUser.IdOTAssignedUser = Convert.ToInt64(reader["IdOTAssignedUser"]);

                            if (reader["IdOT"] != DBNull.Value)
                                otAssignedUser.IdOT = Convert.ToInt64(reader["IdOT"]);

                            if (reader["IdStage"] != DBNull.Value)
                            {
                                otAssignedUser.IdStage = Convert.ToByte(reader["IdStage"]);
                            }

                            if (reader["IdOperator"] != DBNull.Value)
                            {
                                otAssignedUser.IdUser = Convert.ToInt32(reader["IdOperator"]);

                                otAssignedUser.UserShortDetail = new UserShortDetail();
                                otAssignedUser.UserShortDetail.IdUser = Convert.ToInt32(reader["IdOperator"]);
                                if (reader["IdUserGender"] != DBNull.Value)
                                    otAssignedUser.UserShortDetail.IdUserGender = Convert.ToByte(reader["IdUserGender"]);

                                if (reader["Phone"] != DBNull.Value)
                                    otAssignedUser.UserShortDetail.PhoneNo = Convert.ToString(reader["Phone"]);

                                otAssignedUser.UserShortDetail.Login = Convert.ToString(reader["Login"]);
                                otAssignedUser.UserShortDetail.UserName = Convert.ToString(reader["UserName"]);
                                if (reader["CompanyEmail"] != DBNull.Value)
                                    otAssignedUser.UserShortDetail.CompanyEmail = Convert.ToString(reader["CompanyEmail"]);

                                if (!userShortDetails.Any(usd => usd.IdUser == otAssignedUser.IdUser))
                                {
                                    userShortDetails.Add(otAssignedUser.UserShortDetail);
                                }
                            }

                            otAssignedUsers.Add(otAssignedUser);
                        }

                    }
                    mySqlConnection.Close();
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetOTAssignedUsers_V2540( IdOT-{0}). ErrorMessage- {1}", idOT, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            foreach (UserShortDetail itemUSD in userShortDetails)
            {
                byte[] UserImageInBytes = GetUserProfileImageInBytes(itemUSD.Login, userProfileImageFilePath);
                otAssignedUsers.Where(owt => owt.IdUser == itemUSD.IdUser).ToList().ForEach(x => x.UserShortDetail.UserImageInBytes = UserImageInBytes);
            }

            return otAssignedUsers;
        }

        //[Sudhir.Jangra][GEOS2-5635]
        public void AddChangeLogForOtItemValidated_V2540(string connectionString, List<SRMOtItemsComment> changeLog)
        {
            try
            {
                if (changeLog != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                    {
                        mySqlConnection.Open();

                        foreach (SRMOtItemsComment logEntries in changeLog)
                        {
                            MySqlCommand mySqlCommand = new MySqlCommand("SRM_Add_OTItem_Validated_Comment_V2540", mySqlConnection);
                            mySqlCommand.CommandType = CommandType.StoredProcedure;

                            mySqlCommand.Parameters.AddWithValue("_IdRevisionItem", logEntries.Idrevisionitem);
                            mySqlCommand.Parameters.AddWithValue("_IdUser", logEntries.IdUser);
                            mySqlCommand.Parameters.AddWithValue("_CreationDate", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                            mySqlCommand.Parameters.AddWithValue("_Comment", logEntries.Comments);

                            mySqlCommand.ExecuteNonQuery();
                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddChangeLogForOtItemValidated_V2540(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        //[Sudhir.Jangra][GEOS2-5636]
        public List<Ots> GetPendingReviewListForArticle_V2540(Int64 idOT, Int32 idArticle, Warehouses warehouse)
        {
            string connectionString = warehouse.Company.ConnectPlantConstr;
            List<Ots> pendingReviewList = new List<Ots>();

            try
            {

                using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                {
                    mySqlConnection.Open();

                    MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetPendingReviewForArticle_V2540", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdOt", idOT);
                    mySqlCommand.Parameters.AddWithValue("_IdArticle", idArticle);

                    using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            Ots ot = new Ots();

                            if (reader["idot"] != DBNull.Value)
                            {
                                ot.IdOT = Convert.ToInt64(reader["idot"]);
                            }
                            if (reader["MergeCode"] != DBNull.Value)
                            {
                                ot.MergeCode = Convert.ToString(reader["MergeCode"]);
                            }
                            if (reader["OtNum"] != DBNull.Value)
                            {
                                // ot.OtItemCount = Convert.ToInt64(reader["OtNum"]);
                            }
                            if (reader["Customer"] != DBNull.Value)
                            {
                                ot.Quotation = new Quotation();
                                ot.Quotation.Site = new Company();
                                ot.Quotation.Site.Customer = new Customer();
                                string name = Convert.ToString(reader["Customer"]);
                                string siteName = Convert.ToString(reader["SiteName"]);
                                ot.Quotation.Site.Customer.CustomerName = name + " " + "OT" + " " + siteName;
                            }
                            if (reader["Item"] != DBNull.Value)
                            {
                                ot.OtItemCount = Convert.ToInt64(reader["Item"]);
                            }
                            if (reader["Quantity"] != DBNull.Value)
                            {
                                ot.Quantity = Convert.ToDouble(reader["Quantity"]);
                            }
                            if (reader["IdRevisionItem"] != DBNull.Value)
                            {
                                ot.IdRevisionItem = Convert.ToInt64(reader["IdRevisionItem"]);
                            }
                            if (reader["Validated"] != DBNull.Value)
                            {
                                int validate = Convert.ToInt32(reader["Validated"]);
                                if (validate == 1)
                                {
                                    ot.IsReviewValidated = true;
                                    ot.ValidatedCount = 1;
                                }
                            }


                            pendingReviewList.Add(ot);
                        }

                    }
                    mySqlConnection.Close();
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetPendingReviewListForArticle_V2540( IdOT-{0}). ErrorMessage- {1}", idOT, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }



            return pendingReviewList;
        }

        //[Sudhir.Jangra][GEOS2-5636]
        public bool UpdateEditWorkOrderOTItemsForArticles_V2540(string connectionString, string mainServerConnectionString, Ots ots, List<SRMOtItemsComment> changeLog)
        {
            bool isUpdated = false;
            try
            {
                if (ots != null)
                {

                    using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("SRM_updateRevisionItemValidate_V2540", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;

                        mySqlCommand.Parameters.AddWithValue("_IdRevisionItem", ots.IdRevisionItem);
                        if (ots.IsReviewValidated == true)
                        {
                            mySqlCommand.Parameters.AddWithValue("_Validated", 1);
                        }
                        else
                        {
                            mySqlCommand.Parameters.AddWithValue("_Validated", 0);
                        }


                        mySqlCommand.ExecuteNonQuery();




                        mySqlConnection.Close();

                    }
                    if (changeLog.Count > 0 && changeLog != null)
                    {
                        AddChangeLogForOtItemValidated_V2540(connectionString, changeLog);
                    }

                    isUpdated = true;
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error UpdateEditWorkOrderOTItemsForArticles_V2540().  ErrorMessage- {1}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return isUpdated;
        }

        #endregion


        //[Sudhir.jangra][GEOS2-6049]
        public Ots GetPendingReviewByIdOt_V2550(Int64 idOt, Warehouses warehouse)
        {
            List<SRMWarehouseBulkArticle> LstWarehouseList = GetWarehouseBulkArticle(warehouse);
            string connectionString = warehouse.Company.ConnectPlantConstr;
            Ots ot = null;

            using (MySqlConnection connOT = new MySqlConnection(connectionString))
            {
                connOT.Open();

                MySqlCommand otCommand = new MySqlCommand("SRM_GetMaterialOtInformationByIdOt_V2550", connOT);
                otCommand.CommandType = CommandType.StoredProcedure;
                otCommand.Parameters.AddWithValue("_IdOt", idOt);
                otCommand.CommandTimeout = 8000;
                using (MySqlDataReader otReader = otCommand.ExecuteReader())
                {
                    if (otReader.Read())
                    {
                        try
                        {
                            ot = new Ots();
                            ot.IdOT = idOt;

                            if (otReader["Code"] != DBNull.Value)
                                ot.OfferCode = Convert.ToString(otReader["Code"]);

                            if (otReader["OtCode"] != DBNull.Value)
                                ot.Code = Convert.ToString(otReader["OtCode"]);

                            ot.NumOT = Convert.ToByte(otReader["NumOT"]);

                            if (otReader["Comments"] != DBNull.Value)
                                ot.Comments = Convert.ToString(otReader["Comments"]);

                            if (otReader["CreatedBy"] != DBNull.Value)
                            {
                                ot.CreatedBy = Convert.ToInt32(otReader["CreatedBy"]);

                                ot.CreatedByPerson = new People();
                                ot.CreatedByPerson.IdPerson = ot.CreatedBy;
                                ot.CreatedByPerson.Name = Convert.ToString(otReader["CreatedByName"]);
                                ot.CreatedByPerson.Surname = Convert.ToString(otReader["CreatedBySurname"]);
                            }

                            ot.ReviewedBy = Convert.ToInt32(otReader["ReviewedBy"]);

                            //CreatedBy
                            if (otReader["CreatedBy"] != DBNull.Value)
                            {
                                ot.CreatedBy = Convert.ToInt32(otReader["CreatedBy"]);

                                ot.CreatedByPerson = new People();
                                ot.CreatedByPerson.IdPerson = ot.CreatedBy;
                                ot.CreatedByPerson.Name = Convert.ToString(otReader["CreatedByName"]);
                                ot.CreatedByPerson.Surname = Convert.ToString(otReader["CreatedBySurname"]);
                            }

                            if (otReader["CreationDate"] != DBNull.Value)
                                ot.CreationDate = Convert.ToDateTime(otReader["CreationDate"]);

                            //ModifiedBy
                            if (otReader["ModifiedBy"] != DBNull.Value)
                            {
                                ot.ModifiedBy = Convert.ToInt32(otReader["ModifiedBy"]);

                                ot.ModifiedByPerson = new People();
                                ot.ModifiedByPerson.IdPerson = ot.ModifiedBy;
                                ot.ModifiedByPerson.Name = Convert.ToString(otReader["ModifiedByName"]);
                                ot.ModifiedByPerson.Surname = Convert.ToString(otReader["ModifiedBySurname"]);
                            }

                            if (otReader["ModifiedIn"] != DBNull.Value)
                                ot.ModifiedIn = Convert.ToDateTime(otReader["ModifiedIn"]);

                            if (otReader["DeliveryDate"] != DBNull.Value)
                                ot.DeliveryDate = Convert.ToDateTime(otReader["DeliveryDate"]);

                            if (otReader["WareHouseLockSession"] != DBNull.Value)
                                ot.WareHouseLockSession = Convert.ToString(otReader["WareHouseLockSession"]);

                            if (otReader["AttachedFiles"] != DBNull.Value)
                                ot.AttachedFiles = Convert.ToString(otReader["AttachedFiles"]);

                            if (otReader["IdShippingAddress"] != DBNull.Value)
                                ot.IdShippingAddress = Convert.ToInt64(otReader["IdShippingAddress"]);

                            ot.IdQuotation = Convert.ToInt64(otReader["IdQuotation"]);
                            ot.Quotation = new Quotation();
                            ot.Quotation.Code = Convert.ToString(otReader["QuotationCode"]);

                            if (otReader["Year"] != DBNull.Value)
                                ot.Quotation.Year = Convert.ToInt32(otReader["Year"]);

                            if (otReader["Description"] != DBNull.Value)
                                ot.Quotation.Description = Convert.ToString(otReader["Description"]);

                            if (otReader["ProjectName"] != DBNull.Value)
                                ot.Quotation.ProjectName = Convert.ToString(otReader["ProjectName"]);


                            if (otReader["ProjectName"] != DBNull.Value)
                                ot.Quotation.ProjectName = Convert.ToString(otReader["ProjectName"]);

                            //Customer
                            if (otReader["IdSite"] != DBNull.Value)
                            {
                                ot.Quotation.Site = new Company();
                                ot.Quotation.Site.IdCompany = Convert.ToInt32(otReader["IdSite"]);
                                ot.Quotation.Site.SiteNameWithoutCountry = Convert.ToString(otReader["SiteName"]);

                                if (otReader["ShortName"] != DBNull.Value && !string.IsNullOrEmpty(Convert.ToString(otReader["ShortName"])))
                                {
                                    ot.Quotation.Site.Name = Convert.ToString(otReader["ShortName"]);
                                }
                                else
                                {
                                    ot.Quotation.Site.Name = Convert.ToString(otReader["Customer"]);
                                }

                                if (otReader["idCountry"] != DBNull.Value)
                                {
                                    ot.Quotation.Site.IdCountry = Convert.ToByte(otReader["idCountry"]);
                                    ot.Quotation.Site.Country = new Country();
                                    ot.Quotation.Site.Country.IdCountry = Convert.ToByte(otReader["idCountry"]);
                                    ot.Quotation.Site.Country.Name = otReader["CountryName"].ToString();
                                    ot.Quotation.Site.Country.Iso = otReader["iso"].ToString();

                                    if (otReader["EuroZone"] != DBNull.Value)
                                    {
                                        ot.Quotation.Site.Country.EuroZone = Convert.ToSByte(otReader["EuroZone"]);
                                    }

                                    if (otReader["IdCountryGroup"] != DBNull.Value)
                                    {
                                        ot.Quotation.Site.CountryGroup = new CountryGroup();
                                        ot.Quotation.Site.CountryGroup.IdCountryGroup = Convert.ToInt64(otReader["IdCountryGroup"]);

                                        if (otReader["CountryGroup"] != DBNull.Value)
                                            ot.Quotation.Site.CountryGroup.Name = Convert.ToString(otReader["CountryGroup"]);

                                        if (otReader["IsFreeTrade"] != DBNull.Value)
                                            ot.Quotation.Site.CountryGroup.IsFreeTrade = Convert.ToByte(otReader["IsFreeTrade"]);
                                    }
                                }

                                ot.Quotation.Site.Customer = new Customer();
                                ot.Quotation.Site.Customer.IdCustomer = Convert.ToInt32(otReader["IdCustomer"]);
                                ot.Quotation.Site.Customer.CustomerName = Convert.ToString(otReader["CustomerName"]);
                            }

                            //Detections Template
                            if (otReader["IdTemplate"] != DBNull.Value)
                            {
                                ot.Quotation.Template = new Template();
                                ot.Quotation.Template.IdTemplate = Convert.ToByte(otReader["IdTemplate"]);
                                ot.Quotation.Template.Name = Convert.ToString(otReader["Template"]);
                                ot.Quotation.Template.Type = Convert.ToInt64(otReader["IdTemplateType"]);
                            }

                            if (otReader["IdOffer"] != DBNull.Value)
                            {
                                ot.Quotation.IdOffer = Convert.ToInt32(otReader["IdOffer"]);

                                ot.Quotation.Offer = new Offer();
                                ot.Quotation.Offer.Description = Convert.ToString(otReader["Description"]);

                                if (otReader["IdCarriageMethod"] != DBNull.Value)
                                {
                                    ot.Quotation.Offer.IdCarriageMethod = Convert.ToByte(otReader["IdCarriageMethod"]);
                                    LookupValue carriage = new LookupValue();
                                    carriage.IdLookupValue = Convert.ToInt32(ot.Quotation.Offer.IdCarriageMethod);
                                    carriage.Value = Convert.ToString(otReader["CarriageValue"]);
                                    carriage.IdImage = Convert.ToInt64(otReader["CarriageImage"]);

                                    ot.Quotation.Offer.CarriageMethod = carriage;
                                }

                                if (otReader["PODate"] != DBNull.Value)
                                    ot.Quotation.Offer.POReceivedInDate = Convert.ToDateTime(otReader["PODate"]);

                                if (otReader["IdWorkflowStatus"] != DBNull.Value)
                                    ot.IdWorkflowStatus = Convert.ToByte(otReader["IdWorkflowStatus"]);

                                if (otReader["ProducerIdCountryGroup"] != DBNull.Value)
                                {
                                    ot.ProducerIdCountryGroup = Convert.ToInt64(otReader["ProducerIdCountryGroup"]);
                                    ot.CountryGroup = new CountryGroup();
                                    ot.CountryGroup.IdCountryGroup = Convert.ToInt64(otReader["ProducerIdCountryGroup"]);
                                    ot.CountryGroup.Name = Convert.ToString(otReader["ProducerCountryGroup"]);
                                    ot.CountryGroup.HtmlColor = Convert.ToString(otReader["ProducerCountryGroupColor"]);
                                }

                                if (otReader["PoNumberForReport"] != DBNull.Value)
                                {
                                    ot.PoCode = Convert.ToString(otReader["PoNumberForReport"]);
                                }

                                if (otReader["PoDateForReport"] != DBNull.Value)
                                {
                                    ot.PoDate = Convert.ToDateTime(otReader["PoDateForReport"]);
                                }

                                if (otReader["OfferOwner"] != DBNull.Value)
                                {
                                    ot.OfferOwner = Convert.ToString(otReader["OfferOwner"]);
                                }

                                if (otReader["CustomerNameForReport"] != DBNull.Value)
                                {
                                    ot.CustomerNameForReport = Convert.ToString(otReader["CustomerNameForReport"]);
                                }
                                if (otReader["idCurrency"] != DBNull.Value)
                                {
                                    ot.IdCurrency = Convert.ToByte(otReader["idCurrency"]);
                                    ot.Currency = new Currency();
                                    ot.Currency.IdCurrency = Convert.ToByte(otReader["idCurrency"]);
                                    ot.Currency.Name = Convert.ToString(otReader["CurrencyName"]);
                                    ot.Currency.Symbol = Convert.ToString(otReader["CurrencySymbol"]);
                                }
                            }
                            ot.OtItems = GetOtItemsByIdOt_V2550(connectionString, idOt, warehouse.IdWarehouse, LstWarehouseList);//[Sudhir.jangra][GEOS2-6049]
                            ot.ArticleStocks = GetStockHistoryByIdOT_V2540(connectionString, idOt, warehouse.IdWarehouse);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetPendingReviewByIdOt_V2550(idOt-{0}, idWarehouse-{1}). ErrorMessage- {2} ", idOt, warehouse.IdWarehouse, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }
            return ot;
        }


        //[Sudhir.jangra][GEOS2-6049]
        public List<OtItem> GetOtItemsByIdOt_V2550(string connectionString, Int64 idOt, Int64 idWarehouse, List<SRMWarehouseBulkArticle> LstWarehouseList)
        {
            List<OtItem> statusUpdateOtItems = new List<OtItem>();
            List<OtItem> otItems = new List<OtItem>();
            List<int> articleIds = new List<int>();
            //string idArticleList = string.Empty;
            string mainArticle = string.Empty;
            List<ArticleForecast> forecastList = new List<ArticleForecast>();
            using (MySqlConnection connOtItem = new MySqlConnection(connectionString))
            {
                connOtItem.Open();

                MySqlCommand otItemCommand = new MySqlCommand("SRM_GetOtItemsByIdOt_V2540", connOtItem);
                otItemCommand.CommandType = CommandType.StoredProcedure;
                otItemCommand.Parameters.AddWithValue("_IdOt", idOt);
                otItemCommand.Parameters.AddWithValue("_IdWarehouse", idWarehouse);
                otItemCommand.CommandTimeout = 8000;
                using (MySqlDataReader otItemReader = otItemCommand.ExecuteReader())
                {
                    int keyId = 0;

                    while (otItemReader.Read())
                    {
                        try
                        {
                            OtItem otItem = new OtItem();
                            otItem.KeyId = keyId;
                            otItem.ParentId = -1;

                            otItem.IdOT = idOt;

                            otItem.IdOTItem = Convert.ToInt64(otItemReader["IdOtItem"]);
                            otItem.IsBatch = Convert.ToByte(otItemReader["IsBatch"]);

                            if (otItemReader["AttachedFiles"] != DBNull.Value)
                                otItem.AttachedFiles = Convert.ToString(otItemReader["AttachedFiles"]);

                            otItem.Rework = Convert.ToByte(otItemReader["Rework"]);

                            if (otItemReader["IdRevisionItem"] != DBNull.Value)
                            {
                                otItem.IdRevisionItem = Convert.ToInt64(otItemReader["IdRevisionItem"]);

                                otItem.RevisionItem = new RevisionItem();
                                otItem.RevisionItem.IdRevisionItem = otItem.IdRevisionItem;
                                otItem.RevisionItem.NumItem = Convert.ToString(otItemReader["NumItem"]);
                                otItem.RevisionItem.Quantity = Convert.ToDecimal(otItemReader["Quantity"]);
                                otItem.RevisionItem.UnitPrice = Convert.ToDecimal(otItemReader["UnitPrice"]);



                                if (otItemReader["CustomerComment"] != DBNull.Value)
                                    otItem.RevisionItem.ItemRemarks = Convert.ToString(otItemReader["CustomerComment"]);

                                if (otItemReader["CustomerCommentOT"] != DBNull.Value)
                                    otItem.RevisionItem.InternalComment = Convert.ToString(otItemReader["CustomerCommentOT"]);

                                if (otItemReader["CustomerCommentRevision"] != DBNull.Value)
                                    otItem.RevisionItem.CustomerComment = Convert.ToString(otItemReader["CustomerCommentRevision"]);

                                otItem.RevisionItem.WarehouseProduct = new WarehouseProduct();
                                otItem.RevisionItem.WarehouseProduct.IdWarehouseProduct = Convert.ToInt64(otItemReader["IdWarehouseproduct"]);

                                if (otItemReader["WpDescription"] != DBNull.Value)
                                    otItem.RevisionItem.WarehouseProduct.Description = Convert.ToString(otItemReader["WpDescription"]);

                                if (otItemReader["IdArticle"] != DBNull.Value)
                                {
                                    otItem.RevisionItem.WarehouseProduct.IdArticle = Convert.ToInt32(otItemReader["IdArticle"]);

                                    Article article = new Article();
                                    article.IdArticle = Convert.ToInt32(otItemReader["IdArticle"]);
                                    article.IsGeneric = Convert.ToSByte(otItemReader["IsGeneric"]);
                                    article.Reference = Convert.ToString(otItemReader["Reference"]);
                                    article.IsObsolete = Convert.ToSByte(otItemReader["IsObsolete"]);

                                    if (otItemReader["ArticleDescription"] != DBNull.Value)
                                        article.Description = Convert.ToString(otItemReader["ArticleDescription"]);

                                    if (otItemReader["Description_es"] != DBNull.Value)
                                        article.Description_es = Convert.ToString(otItemReader["Description_es"]);

                                    if (otItemReader["Description_fr"] != DBNull.Value)
                                        article.Description_fr = Convert.ToString(otItemReader["Description_fr"]);

                                    article.ImagePath = Convert.ToString(otItemReader["ImagePath"]);
                                    article.RegisterSerialNumber = Convert.ToByte(otItemReader["RegisterSerialNumber"]);

                                    if (otItemReader["Location"] != DBNull.Value)
                                        article.Location = Convert.ToString(otItemReader["Location"]);

                                    if (otItemReader["Weight"] != DBNull.Value)
                                        article.Weight = Convert.ToDecimal(otItemReader["Weight"]);

                                    if (otItemReader["IdArticleType"] != DBNull.Value)
                                        article.IdArticleType = Convert.ToInt64(otItemReader["IdArticleType"]);

                                    otItem.RevisionItem.WarehouseProduct.Article = article;
                                }

                                if (otItemReader["Iditemotstatus"] != DBNull.Value)
                                {
                                    otItem.IdItemOtStatus = Convert.ToByte(otItemReader["Iditemotstatus"]);

                                    otItem.Status = new ItemOTStatusType();
                                    otItem.Status.IdItemOtStatus = otItem.IdItemOtStatus;
                                    otItem.Status.Name = Convert.ToString(otItemReader["Status"]);
                                    otItem.Status.HtmlColor = Convert.ToString(otItemReader["statusColor"]);
                                }

                                if (otItemReader["AssignedTo"] != DBNull.Value)
                                {
                                    otItem.AssignedTo = Convert.ToInt32(otItemReader["AssignedTo"]);

                                    otItem.AssignedToUser = new People();
                                    otItem.AssignedToUser.Name = Convert.ToString(otItemReader["AssignedName"]);
                                    otItem.AssignedToUser.Surname = Convert.ToString(otItemReader["AssignedSurname"]);
                                }

                                if (otItemReader["DownloadedQty"] != DBNull.Value)
                                    otItem.RevisionItem.DownloadedQuantity = Convert.ToInt64(otItemReader["DownloadedQty"]);



                                if (otItemReader["Validated"] != DBNull.Value)
                                {
                                    int validate = Convert.ToInt32(otItemReader["Validated"]);
                                    if (validate == 1)
                                    {
                                        otItem.IsReviewValidated = true;
                                        otItem.ValidatedCount = 1;
                                    }
                                }


                            }


                            List<OtItem> decomposedOtItems = GetArticlesForDecomposition_V2540(connectionString, idOt, idWarehouse, otItem, ref keyId, LstWarehouseList);

                            var temp = GetOtItemStatusList_V2540(connectionString);

                            if (decomposedOtItems != null && decomposedOtItems.Count > 0)
                            {

                                if (otItem.RevisionItem.WarehouseProduct.Article.IdArticleType != 2)
                                {
                                    if (LstWarehouseList != null && LstWarehouseList.Any(i => i.IdArticle == otItem.RevisionItem.WarehouseProduct.IdArticle && (i.IdParent == null || i.IdParent == 0)))
                                    {
                                        otItem.RevisionItem.Status = 100;
                                    }
                                    else
                                    {
                                        otItem.RevisionItem.Status = (Int64)((Math.Abs((double)decomposedOtItems.Sum(y => y.RevisionItem.DownloadedQuantity)) / (double)decomposedOtItems.Sum(y => y.RevisionItem.Quantity)) * 100);
                                    }
                                }
                                otItems.Add(otItem);
                                otItems.AddRange(decomposedOtItems);

                            }
                            else
                            {
                                otItems.Add(otItem);

                            }
                            keyId++;
                            if (otItem.Status.IdItemOtStatus == 1 || otItem.Status.IdItemOtStatus == 2 || otItem.Status.IdItemOtStatus == 12)
                            {
                                var text = otItem.RevisionItem.WarehouseProduct.Article.Reference;
                                List<int> desiredIds = new List<int> { 1, 2, 12 };
                                otItem.StatusList = new List<ItemOTStatusType>();
                                otItem.StatusList = temp.Where(x => desiredIds.Contains(x.IdItemOtStatus)).ToList();
                            }
                            else
                            {
                                otItem.StatusList = new List<ItemOTStatusType>();
                                otItem.StatusList = temp.Where(x => x.IdItemOtStatus == otItem.Status.IdItemOtStatus).ToList();
                            }
                            if (otItem.StatusList?.Count > 1)
                                otItem.ShowCombobox = true;
                            else
                                otItem.ShowCombobox = false;
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetOtItemsByIdOt_V2540(idOt-{0}, idWarehouse-{1}). ErrorMessage- {2}", idOt, idWarehouse, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }

                    if (otItemReader.NextResult())
                    {
                        while (otItemReader.Read())
                        {
                            try
                            {
                                if (otItemReader["IdArticle"] != DBNull.Value)
                                {
                                    foreach (var itemotItem in otItems.Where(ot => ot.RevisionItem.WarehouseProduct.IdArticle == Convert.ToInt64(otItemReader["IdArticle"])))
                                    {
                                        if (otItemReader["ArticleStock"] != DBNull.Value)
                                            itemotItem.ArticleStock = Convert.ToInt64(otItemReader["ArticleStock"]);

                                        if (otItemReader["ArticleMinimumStock"] != DBNull.Value)
                                            itemotItem.ArticleMinimumStock = Convert.ToInt64(otItemReader["ArticleMinimumStock"]);

                                        if (otItemReader["ArticleMaximumStock"] != DBNull.Value)
                                            itemotItem.ArticleMaximumStock = Convert.ToInt64(otItemReader["ArticleMaximumStock"]);
                                    }
                                }
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetOtItemsByIdOt_V2540(idOt-{0}, idWarehouse-{1}). ErrorMessage- {2}", idOt, idWarehouse, ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }

                    }



                }
            }


            List<int> idList = otItems.Select(item => item.RevisionItem.WarehouseProduct.IdArticle).ToList();

            string idArticleList = string.Join(",", idList);
            forecastList = GetArticleForecastOfTypeOT_V2540(connectionString, idArticleList, idWarehouse);

            foreach (var itemotItem in otItems)
            {
                //itemotItem.ExpectedStock = itemotItem.ArticleStock - forecastList
                //    .Where(x => x.IdArticle == itemotItem.RevisionItem.WarehouseProduct.IdArticle)
                //    ?.Sum(x => x.Quantity) ?? 0;
                itemotItem.ArticleIncoming = forecastList
                  .Where(x => x.Type == "PO" && x.IdArticle == itemotItem.RevisionItem.WarehouseProduct.IdArticle)
                  ?.Sum(x => x.Quantity) ?? 0;
                itemotItem.ArticleOutcoming = forecastList
                  .Where(x => x.Type == "OT" && x.IdArticle == itemotItem.RevisionItem.WarehouseProduct.IdArticle)
                  ?.Sum(x => x.Quantity) ?? 0;
                itemotItem.ExpectedStock = itemotItem.ArticleStock + itemotItem.ArticleIncoming - itemotItem.ArticleOutcoming;//[Sudhir.Jangra][GEOS2-6049]

            }



            return otItems;
        }


        //[Sudhir.Jangra][GEOS2-6049]
        public List<Ots> GetPendingReviewByWarehouse_V2550(Warehouses warehouse, string countryIconFilePath)
        {
            Log4NetLogger.Logger.Log(string.Format("GetPendingReviewByWarehouse_V2550()"), category: Category.Info, priority: Priority.Low);
            List<SRMWarehouseBulkArticle> LstWarehouseList = GetWarehouseBulkArticle(warehouse);
            string connectionString = warehouse.Company.ConnectPlantConstr;
            List<Ots> ots = new List<Ots>();
            List<string> countryISOs = new List<string>();
            using (MySqlConnection connOts = new MySqlConnection(connectionString))
            {
                connOts.Open();

                MySqlCommand otsCommand = new MySqlCommand("SRM_GetPendingReviewByWarehouse_V2550", connOts);
                // MySqlCommand otsCommand = new MySqlCommand("SRM_GetPendingReviewByWarehouse_V2540_Test_Sudhir", connOts);

                otsCommand.CommandType = CommandType.StoredProcedure;
                otsCommand.Parameters.AddWithValue("_IdWarehouse", warehouse.IdWarehouse);
                otsCommand.CommandTimeout = 8000;

                using (MySqlDataReader otReader = otsCommand.ExecuteReader())
                {
                    if (otReader.HasRows)
                    {
                        while (otReader.Read())
                        {
                            try
                            {
                                Ots ot = new Ots();
                                ot.IdOT = Convert.ToInt64(otReader["IdOT"]);
                                ot.NumOT = Convert.ToByte(otReader["NumOT"]);

                                if (otReader["OtCode"] != DBNull.Value)
                                {
                                    ot.Code = Convert.ToString(otReader["OtCode"]);
                                    ot.MergeCode = Convert.ToString(otReader["MergeCode"]);
                                }

                                if (otReader["DeliveryDate"] != DBNull.Value)
                                {
                                    ot.DeliveryDate = Convert.ToDateTime(otReader["DeliveryDate"]);
                                    ot.Delay = (int)(ot.DeliveryDate.Value.Date - DateTime.Now.Date).TotalDays;
                                }

                                ot.Quotation = new Quotation();

                                if (otReader["IdQuotation"] != DBNull.Value)
                                {
                                    ot.IdQuotation = Convert.ToInt64(otReader["IdQuotation"]);
                                    ot.Quotation.IdQuotation = Convert.ToInt64(otReader["IdQuotation"]);
                                    ot.Quotation.Code = Convert.ToString(otReader["QuotationCode"]);
                                }

                                if (otReader["IdTemplate"] != DBNull.Value)
                                {
                                    ot.Quotation.IdDetectionsTemplate = Convert.ToByte(otReader["IdTemplate"]);

                                    ot.Quotation.Template = new Template();
                                    ot.Quotation.Template.IdTemplate = ot.Quotation.IdDetectionsTemplate;
                                    ot.Quotation.Template.Name = Convert.ToString(otReader["Template"]);
                                    ot.Quotation.Template.IdTemplate = Convert.ToByte(otReader["TemplateType"]);
                                }

                                if (otReader["IdOffer"] != DBNull.Value)
                                {
                                    ot.Quotation.IdOffer = Convert.ToInt64(otReader["IdOffer"]);
                                    ot.Quotation.Offer = new Offer();
                                    ot.Quotation.Offer.IdOffer = ot.Quotation.IdOffer;

                                    if (otReader["IsCritical"] != DBNull.Value)
                                        ot.Quotation.Offer.IsCritical = Convert.ToByte(otReader["IsCritical"]);



                                    ot.Quotation.Offer.Code = Convert.ToString(otReader["OfferCode"]);



                                    if (otReader["IdOfferType"] != DBNull.Value)
                                    {
                                        ot.Quotation.Offer.IdOfferType = Convert.ToByte(otReader["IdOfferType"]);

                                        ot.Quotation.Offer.OfferType = new OfferType();
                                        ot.Quotation.Offer.OfferType.IdOfferType = Convert.ToByte(ot.Quotation.Offer.IdOfferType);
                                        ot.Quotation.Offer.OfferType.Name = Convert.ToString(otReader["OfferType"]);
                                    }

                                    if (otReader["IdCarriageMethod"] != DBNull.Value)
                                    {
                                        ot.Quotation.Offer.IdCarriageMethod = Convert.ToByte(otReader["IdCarriageMethod"]);
                                        ot.Quotation.Offer.CarriageMethod = new LookupValue();
                                        ot.Quotation.Offer.CarriageMethod.IdLookupValue = Convert.ToByte(ot.Quotation.Offer.IdCarriageMethod);
                                        ot.Quotation.Offer.CarriageMethod.Value = Convert.ToString(otReader["CarriageMethod"]);

                                        if (otReader["CarriageImage"] != DBNull.Value)
                                            ot.Quotation.Offer.CarriageMethod.IdImage = Convert.ToInt64(otReader["CarriageImage"]);
                                    }
                                }

                                if (otReader["IdWarehouse"] != DBNull.Value)
                                {
                                    ot.Quotation.IdWarehouse = Convert.ToInt64(otReader["IdWarehouse"]);
                                }

                                if (otReader["IdSite"] != DBNull.Value)
                                {
                                    ot.Quotation.IdCustomer = Convert.ToInt32(otReader["IdSite"]);
                                    ot.Quotation.Site = new Company();
                                    ot.Quotation.Site.IdCompany = ot.Quotation.IdCustomer;
                                    ot.Quotation.Site.SiteNameWithoutCountry = Convert.ToString(otReader["SiteName"]);

                                    if (otReader["ShortName"] != DBNull.Value && !string.IsNullOrEmpty(Convert.ToString(otReader["ShortName"])))
                                    {
                                        ot.Quotation.Site.ShortName = Convert.ToString(otReader["ShortName"]);
                                        ot.Quotation.Site.Name = ot.Quotation.Site.ShortName;
                                    }
                                    else
                                    {
                                        ot.Quotation.Site.ShortName = null;
                                        ot.Quotation.Site.Name = Convert.ToString(otReader["SiteName"]);
                                    }

                                    ot.Quotation.Site.Customer = new Customer();
                                    ot.Quotation.Site.Customer.IdCustomer = Convert.ToInt32(otReader["IdCustomer"]);
                                    ot.Quotation.Site.Customer.CustomerName = Convert.ToString(otReader["CustomerName"]);

                                    if (otReader["IdCountry"] != DBNull.Value)
                                    {
                                        ot.Quotation.Site.IdCountry = Convert.ToByte(otReader["IdCountry"]);
                                        ot.Quotation.Site.Country = new Country();
                                        ot.Quotation.Site.Country.IdCountry = Convert.ToByte(otReader["IdCountry"]);
                                        ot.Quotation.Site.Country.Name = Convert.ToString(otReader["CountryName"]);
                                        if (otReader["CountryISO"] != DBNull.Value)
                                        {
                                            ot.Quotation.Site.Country.Iso = Convert.ToString(otReader["CountryISO"]);

                                            if (!countryISOs.Any(co => co.ToString() == ot.Quotation.Site.Country.Iso))
                                            {
                                                countryISOs.Add(ot.Quotation.Site.Country.Iso);
                                            }
                                        }

                                    }
                                }

                                if (otReader["ActualQty"] != DBNull.Value)
                                    ot.ActualQuantity = Convert.ToInt64(otReader["ActualQty"]);

                                if (otReader["DownloadedQty"] != DBNull.Value)
                                    ot.DownloadedQuantity = Convert.ToInt64(otReader["DownloadedQty"]);

                                if (otReader["PODate"] != DBNull.Value)
                                    ot.PoDate = Convert.ToDateTime(otReader["PODate"]);

                                if (otReader["ProducerCountryGroupName"] != DBNull.Value)
                                {
                                    ot.CountryGroup = new CountryGroup();
                                    ot.CountryGroup.Name = otReader["ProducerCountryGroupName"].ToString();
                                    if (otReader["ProducerCountryGroupHTMLColor"] != DBNull.Value)
                                        ot.CountryGroup.HtmlColor = otReader["ProducerCountryGroupHTMLColor"].ToString();
                                }



                                if (otReader["CreationDate"] != DBNull.Value)
                                {
                                    ot.CreationDate = Convert.ToDateTime(otReader["CreationDate"]);
                                }

                                if (otReader["Validated"] != DBNull.Value)
                                {
                                    int validate = Convert.ToInt32(otReader["Validated"]);
                                    if (validate == 1)
                                    {
                                        ot.IsReviewValidated = true;
                                        ot.ValidatedCount = 1;
                                    }
                                }

                                Int32 NotValidatedCount = 0;
                                if (otReader["Count_Validated"] != DBNull.Value)
                                {
                                    ot.Reviewed = Convert.ToInt32(otReader["Count_Validated"]);
                                }
                                if (otReader["Count_NotValidated"] != DBNull.Value)
                                {
                                    NotValidatedCount = Convert.ToInt32(otReader["Count_NotValidated"]);
                                }
                                ot.OtItemCount = ot.Reviewed + NotValidatedCount;

                                if (otReader["Progress"] != DBNull.Value)
                                {
                                    ot.SRMProgress = Convert.ToInt32(otReader["Progress"]);
                                }

                                if (otReader["Quantity"] != DBNull.Value)
                                {
                                    ot.Quantity = Convert.ToDouble(otReader["Quantity"]);
                                }


                                ot.OtItems = new List<OtItem>();
                                ots.Add(ot);
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetPendingReviewByWarehouse_V2550() 1. ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                    }

                    if (otReader.NextResult())
                    {
                        while (otReader.Read())
                        {
                            try
                            {
                                Ots ot = ots.FirstOrDefault(x => x.IdOT == Convert.ToInt64(otReader["IdOT"]));
                                if (ot != null)
                                {
                                    OtItem otItem = new OtItem();
                                    if (otReader["IdOT"] != DBNull.Value)
                                        otItem.IdOT = Convert.ToInt64(otReader["IdOT"]);
                                    if (otReader["IdOtItem"] != DBNull.Value)
                                        otItem.IdOTItem = Convert.ToInt64(otReader["IdOtItem"]);
                                    if (otReader["IdRevisionItem"] != DBNull.Value)
                                    {
                                        otItem.IdRevisionItem = Convert.ToInt64(otReader["IdRevisionItem"]);
                                        otItem.RevisionItem = new RevisionItem();
                                        otItem.RevisionItem.IdRevisionItem = Convert.ToInt64(otReader["IdRevisionItem"]);
                                        otItem.RevisionItem.Quantity = Convert.ToDecimal(otReader["Quantity"]);
                                        if (otReader["DownloadedQty"] != DBNull.Value)
                                            otItem.RevisionItem.DownloadedQuantity = Convert.ToInt64(otReader["DownloadedQty"]);

                                        if (otReader["RemainingQty"] != DBNull.Value)
                                            otItem.RevisionItem.RemainingQuantity = Convert.ToInt64(otReader["RemainingQty"]);


                                        if (otReader["IdArticle"] != DBNull.Value)
                                        {
                                            otItem.RevisionItem.WarehouseProduct = new WarehouseProduct();

                                            otItem.RevisionItem.WarehouseProduct.Article = new Article();
                                            otItem.RevisionItem.WarehouseProduct.Article.IdArticle = Convert.ToInt32(otReader["IdArticle"]);
                                            otItem.RevisionItem.WarehouseProduct.Article.Reference = Convert.ToString(otReader["Reference"]);
                                            if (otReader["IdArticleType"] != DBNull.Value)
                                            {
                                                otItem.RevisionItem.WarehouseProduct.Article.IdArticleType = Convert.ToInt64(otReader["IdArticleType"]);
                                            }
                                            if (otReader["ArticleCurrentStock"] != DBNull.Value)
                                                otItem.RevisionItem.WarehouseProduct.Article.ArticleCurrentStock = Convert.ToInt64(otReader["ArticleCurrentStock"]);

                                            if (otReader["ArticleWarehouseLocationIdArticle"] != DBNull.Value)
                                            {
                                                otItem.RevisionItem.WarehouseProduct.Article.ArticleWarehouseLocation = new ArticleWarehouseLocations();
                                                otItem.RevisionItem.WarehouseProduct.Article.ArticleWarehouseLocation.IdArticle = Convert.ToInt32(otReader["ArticleWarehouseLocationIdArticle"]);

                                            }
                                        }
                                        if (otReader["Validated"] != DBNull.Value)
                                        {
                                            int validate = Convert.ToInt32(otReader["Validated"]);
                                            if (validate == 1)
                                            {
                                                otItem.IsReviewValidated = true;
                                                otItem.ValidatedCount = 1;
                                            }
                                        }
                                    }
                                    otItem.ArticleDecomposedList = new List<OtItem>();
                                    ot.OtItems.Add(otItem);
                                }
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetPendingReviewByWarehouse_V2540() 2. ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                    }


                }
            }



            foreach (string item in countryISOs)
            {
                byte[] bytes = null;
                bytes = GetCountryIconFileInBytes(item, countryIconFilePath);
                ots.Where(ot => ot.Quotation.Site.Country.Iso == item).ToList().ForEach(ot => ot.Quotation.Site.Country.CountryIconBytes = bytes);
            }

            Log4NetLogger.Logger.Log("Executed GetPendingReviewByWarehouse_V2550().", category: Category.Info, priority: Priority.Low);
            return ots;
        }

        //[Sudhir.Jangra][GEOS2-5636]
        public Article GetArticleDetails_V2550(Int32 idArticle, Int64 IdSite, string articleVisualAidsPath, string connectionString)
        {
            Article article = new Article();

            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetArticleDetails_V2550", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_idArticle", idArticle);
                mySqlCommand.Parameters.AddWithValue("_IdSite", IdSite);


                using (MySqlDataReader reader = mySqlCommand.ExecuteReader())
                {
                    if (reader.Read())
                    {
                        try
                        {
                            if (reader["idArticle"] != DBNull.Value)
                                article.IdArticle = Convert.ToInt32(reader["idArticle"]);


                            if (reader["ImagePath"] != DBNull.Value)
                            {
                                article.ImagePath = Convert.ToString(reader["ImagePath"]);

                                if (!string.IsNullOrEmpty(article.ImagePath))
                                    article.ArticleImageInBytes = GetArticleImageInBytes_V2540(articleVisualAidsPath, article);
                            }

                            if (reader["Reference"] != DBNull.Value)
                                article.Reference = reader["Reference"].ToString();


                            if (reader["Description"] != DBNull.Value)
                                article.Description = Convert.ToString(reader["Description"]);

                            if (reader["idArticleSupplier"] != DBNull.Value)
                            {
                                if (article.ArticleBySupplier == null)
                                {
                                    article.ArticleBySupplier = new ArticleBySupplier();
                                }
                                article.ArticleBySupplier.IdArticleSupplier = Convert.ToInt64(reader["idArticleSupplier"]);
                                article.ArticleBySupplier.Reference = Convert.ToString(reader["FavoriteSupplierName"]);
                            }
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetArticleDetails_V2550(). IdArticle-{0} ErrorMessage- {1}", article.IdArticle, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }


            }

            return article;
        }

        //[rdixit][02.09.2024][GEOS2-6383]
        public bool PurchasingOrderNotificationSend_V2560(POEmailNotification PurchasingOrder, string emailTemplate, string mailFrom,
        string mailServerName, string mailServerPort, string emailTemplatePath)
        {
            bool isSend = false;
            try
            {
                #region isSend
                List<System.Net.Mail.LinkedResource> ImgResourceList = new List<System.Net.Mail.LinkedResource>();
                List<string> Images = new List<string>();
                //emailTemplate = "";
                //emailTemplate =  File.ReadAllText(@"C:\Temp\geos$\Workbench\Templates\" + "SupplierPurchaseOrderStatusChangeMailFormat.html"); ;
                emailTemplate = emailTemplate.Replace("[PO_CODE]", PurchasingOrder.Code);

                if (PurchasingOrder.Comments != "" && PurchasingOrder.Comments != null && PurchasingOrder.Comments != string.Empty)
                {
                    emailTemplate = emailTemplate.Replace("[COMMENTS]", "<br><b>REASON=</b><i>\"" + PurchasingOrder.Comments + "\"</i>");
                }
                else
                {
                    emailTemplate = emailTemplate.Replace("[COMMENTS]", "");
                }
                emailTemplate = emailTemplate.Replace("[StatusStyle]", PurchasingOrder.StatusHtmlColor);
                emailTemplate = emailTemplate.Replace("[Status]", PurchasingOrder.Status);
                emailTemplate = emailTemplate.Replace("[NotifyUserEmail]", PurchasingOrder.CreatorEmail);

                #region Take Images From URL
                System.Text.RegularExpressions.Regex regexImg = new System.Text.RegularExpressions.Regex("<img.+?src=[\"'](.+?)[\"'].*?>", System.Text.RegularExpressions.RegexOptions.IgnoreCase);
                System.Text.RegularExpressions.MatchCollection matchesImg = regexImg.Matches(emailTemplate);
                string mailecos = "SRM";
                System.Net.Mail.MailAddress emailFrom = new System.Net.Mail.MailAddress(mailFrom, mailecos);
                using (System.Net.Mail.MailMessage mail = new System.Net.Mail.MailMessage())
                {
                    mail.From = emailFrom;
                    //if (!string.IsNullOrEmpty(PurchasingOrder.SupplierContactEmail))
                    //{
                    //    mail.To.Add(PurchasingOrder.SupplierContactEmail);
                    //}
                    if (!string.IsNullOrEmpty(PurchasingOrder.CreatedByEmail))
                        mail.Bcc.Add(PurchasingOrder.CreatedByEmail);
                    if (!string.IsNullOrEmpty(PurchasingOrder.ApproverCompEmail))
                        mail.Bcc.Add(PurchasingOrder.ApproverCompEmail);
                    if (!string.IsNullOrEmpty(PurchasingOrder.AssineeCompEmail))
                        mail.Bcc.Add(PurchasingOrder.AssineeCompEmail);
                    string MailCredentials = string.Empty;

                    System.Net.ServicePointManager.SecurityProtocol = System.Net.SecurityProtocolType.Tls12;
                    ImgResourceList.Clear();

                    #region Commented
                    /*
                     /foreach (System.Text.RegularExpressions.Match matchImg in matchesImg)
                    {
                        Images.Add(matchImg.Groups[1].Value);
                    }
                    foreach (var item in Images)
                    {
                        if (item.Contains("logo-geos.png"))
                        {
                            emailTemplate = emailTemplate.Replace(item, "cid:EmbeddedContent_1");

                            // Download the image from the URL
                            using (System.Net.WebClient webClient = new System.Net.WebClient())
                            {
                                byte[] imageBytes = webClient.DownloadData(item);
                                MemoryStream imgGeosLogo = new MemoryStream(imageBytes);
                                System.Net.Mail.LinkedResource LRGeosLogo = new System.Net.Mail.LinkedResource(imgGeosLogo);
                                LRGeosLogo.ContentId = "EmbeddedContent_1";
                                LRGeosLogo.ContentLink = new Uri("cid:" + LRGeosLogo.ContentId);
                                ImgResourceList.Add(LRGeosLogo);
                            }
                        }

                        if (item.Contains("logo-emdep.png"))
                        {
                            emailTemplate = emailTemplate.Replace(item, "cid:EmbeddedContent_2");

                            // Download the image from the URL
                            using (System.Net.WebClient webClient = new System.Net.WebClient())
                            {
                                byte[] imageBytes = webClient.DownloadData(item);
                                MemoryStream imgEmdepLogo = new MemoryStream(imageBytes);
                                System.Net.Mail.LinkedResource LREmdepLogo = new System.Net.Mail.LinkedResource(imgEmdepLogo);
                                LREmdepLogo.ContentId = "EmbeddedContent_2";
                                LREmdepLogo.ContentLink = new Uri("cid:" + LREmdepLogo.ContentId);
                                ImgResourceList.Add(LREmdepLogo);
                            }
                        }

                        if (item.Contains("linkedin_sm.png"))
                        {
                            emailTemplate = emailTemplate.Replace(item, "cid:EmbeddedContent_3");

                            // Download the image from the URL
                            using (System.Net.WebClient webClient = new System.Net.WebClient())
                            {
                                byte[] imageBytes = webClient.DownloadData(item);
                                MemoryStream imglinkedin = new MemoryStream(imageBytes);
                                System.Net.Mail.LinkedResource LRlinkedin = new System.Net.Mail.LinkedResource(imglinkedin);
                                LRlinkedin.ContentId = "EmbeddedContent_3";
                                LRlinkedin.ContentLink = new Uri("cid:" + LRlinkedin.ContentId);
                                ImgResourceList.Add(LRlinkedin);
                            }
                        }
                    }
                    */
                    #endregion

                    #region [rdixit][18.04.2024][GEOS2-6383]
                    Images.Add("MailLogo.png");
                    Images.Add("Geos_logo.png");
                    Images.Add("linkedin_sm.png");
                    ImgResourceList.Clear();
                    try
                    {
                        for (int i = 0; i < 3; i++)
                        {
                            string filename = Images[i];
                            if (i == 2)
                                filename = Path.Combine(emailTemplatePath, "Images\\social\\", filename);
                            else
                                filename = Path.Combine(emailTemplatePath, "Images\\", filename);

                            byte[] bytes = null;
                            FileInfo fileinfo = new FileInfo(filename);
                            string ext = fileinfo.Extension;
                            if (ext.ToLower() == ".jpg" || ext.ToLower() == ".jpeg" || ext.ToLower() == ".png" || ext.ToLower() == ".bmp")
                            {
                                if (File.Exists(filename))
                                {
                                    using (System.IO.FileStream stream = new System.IO.FileStream(filename, System.IO.FileMode.Open, System.IO.FileAccess.Read))
                                    {
                                        bytes = new byte[stream.Length];
                                        int numBytesToRead = (int)stream.Length;
                                        int numBytesRead = 0;
                                        while (numBytesToRead > 0)
                                        {
                                            // Read may return anything from 0 to numBytesToRead.	
                                            int n = stream.Read(bytes, numBytesRead, numBytesToRead);
                                            // Break when the end of the file is reached.	
                                            if (n == 0)
                                                break;
                                            numBytesRead += n;
                                            numBytesToRead -= n;
                                        }
                                    }
                                }
                            }
                            if (i == 0 && bytes != null)
                            {
                                MemoryStream imgEmdepLogo = new MemoryStream(bytes);
                                System.Net.Mail.LinkedResource LREmdepLogo = new System.Net.Mail.LinkedResource(imgEmdepLogo);
                                LREmdepLogo.ContentId = "EmbeddedContent_2";
                                LREmdepLogo.ContentLink = new Uri("cid:" + LREmdepLogo.ContentId);
                                ImgResourceList.Add(LREmdepLogo);
                            }
                            else if (i == 1 && bytes != null)
                            {
                                MemoryStream imgGeosLogo = new MemoryStream(bytes);
                                System.Net.Mail.LinkedResource LRGeosLogo = new System.Net.Mail.LinkedResource(imgGeosLogo);
                                LRGeosLogo.ContentId = "EmbeddedContent_1";
                                LRGeosLogo.ContentLink = new Uri("cid:" + LRGeosLogo.ContentId);
                                ImgResourceList.Add(LRGeosLogo);
                            }
                            else if (i == 2 && bytes != null)
                            {
                                MemoryStream imglinkedin = new MemoryStream(bytes);
                                System.Net.Mail.LinkedResource LRlinkedin = new System.Net.Mail.LinkedResource(imglinkedin);
                                LRlinkedin.ContentId = "EmbeddedContent_3";
                                LRlinkedin.ContentLink = new Uri("cid:" + LRlinkedin.ContentId);
                                ImgResourceList.Add(LRlinkedin);
                            }
                        }
                    }
                    catch (Exception ex)
                    {
                        Log4NetLogger.Logger.Log(string.Format("Error PurchasingOrderNotificationSend_V2560(). {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                    }
                    #endregion
                    System.Net.Mail.AlternateView htmlView = System.Net.Mail.AlternateView.CreateAlternateViewFromString(emailTemplate.ToString(), null, "text/html");

                    foreach (System.Net.Mail.LinkedResource linkedResource in ImgResourceList)
                    {
                        htmlView.LinkedResources.Add(linkedResource);
                    }
                    using (System.Net.Mail.SmtpClient smtp = new System.Net.Mail.SmtpClient(mailServerName, Convert.ToInt32(mailServerPort)))
                    {
                        mail.AlternateViews.Add(htmlView);
                        mail.Subject = "[SRM] New Status change in Purchase Order " + PurchasingOrder.Code;
                        mail.IsBodyHtml = true;
                        mail.Body = string.Empty;
                        smtp.UseDefaultCredentials = false;
                        smtp.EnableSsl = false;
                        try
                        {
                            smtp.Send(mail);
                            isSend = true;
                        }
                        catch (Exception ex)
                        {
                            isSend = false;
                        }
                    }
                }
                #endregion
                #endregion
            }
            catch (Exception ex)
            {
                isSend = false;
            }
            return isSend;
        }

        //Shubham[skadam] GEOS2-5903 REQUEST IMPROVEMENTS 21 09 2024
        public List<ArticleSupplier> GetArticleSupplierContactsByIdContact_V2560(Warehouses warehouse, Int32 IdContact)
        {
            string connectionString = warehouse.Company.ConnectPlantConstr;
            List<ArticleSupplier> articleSuppliers = new List<ArticleSupplier>();
            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();
                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetArticleSupplierContactsByIdContact_V2560", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdContact", IdContact);
                mySqlCommand.Parameters.AddWithValue("_IdSite", warehouse.IdSite);
                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    while (mySqlDataReader.Read())
                    {
                        try
                        {
                            ArticleSupplier articleSupplier = new ArticleSupplier();

                            articleSupplier.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                            articleSupplier.Code = "SUPL" + articleSupplier.IdArticleSupplier.ToString().PadLeft(6, '0');

                            if (mySqlDataReader["name"] != DBNull.Value)
                                articleSupplier.Name = Convert.ToString(mySqlDataReader["name"]);

                            if (mySqlDataReader["Cif"] != DBNull.Value)
                                articleSupplier.Cif = Convert.ToString(mySqlDataReader["Cif"]);

                            if (mySqlDataReader["serie"] != DBNull.Value)
                                articleSupplier.Serie = Convert.ToChar(mySqlDataReader["serie"]);

                            if (mySqlDataReader["Observations"] != DBNull.Value)
                                articleSupplier.Observations = Convert.ToString(mySqlDataReader["Observations"]);

                            if (mySqlDataReader["Phone1"] != DBNull.Value)
                                articleSupplier.Phone1 = Convert.ToString(mySqlDataReader["Phone1"]);

                            if (mySqlDataReader["Phone2"] != DBNull.Value)
                                articleSupplier.Phone2 = Convert.ToString(mySqlDataReader["Phone2"]);

                            if (mySqlDataReader["Email"] != DBNull.Value)
                                articleSupplier.Email = Convert.ToString(mySqlDataReader["Email"]);

                            if (mySqlDataReader["fax"] != DBNull.Value)
                                articleSupplier.Fax = Convert.ToString(mySqlDataReader["fax"]);

                            if (mySqlDataReader["Web"] != DBNull.Value)
                                articleSupplier.Web = Convert.ToString(mySqlDataReader["Web"]);

                            if (mySqlDataReader["Address"] != DBNull.Value)
                                articleSupplier.Address = Convert.ToString(mySqlDataReader["Address"]);

                            if (mySqlDataReader["City"] != DBNull.Value)
                                articleSupplier.City = Convert.ToString(mySqlDataReader["City"]);

                            if (mySqlDataReader["PostCode"] != DBNull.Value)
                                articleSupplier.PostCode = Convert.ToString(mySqlDataReader["PostCode"]);

                            if (mySqlDataReader["State"] != DBNull.Value)
                                articleSupplier.Region = Convert.ToString(mySqlDataReader["State"]);

                            if (mySqlDataReader["idcountry"] != DBNull.Value)
                            {
                                articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["idcountry"]);
                                articleSupplier.Country = new Country();
                                articleSupplier.Country.IdCountry = Convert.ToByte(mySqlDataReader["idcountry"]);

                                if (mySqlDataReader["CountryName"] != DBNull.Value)
                                {
                                    articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);
                                }
                            }
                            articleSuppliers.Add(articleSupplier);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetArticleSupplierContactsByIdContact_V2560 ErrorMessage- {0} ", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            return articleSuppliers;
        }


        //Shubham[skadam] GEOS2-5903 REQUEST IMPROVEMENTS 21 09 2024
        public Contacts AddContact_V2560(string mainServerConnectionString, Contacts contacts, List<LogEntriesByArticleSuppliers> ArticleSuppliersChangeLogList)
        {
            TransactionScope transactionScope = null;
            try
            {
                using (transactionScope = new TransactionScope())
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("SRM_Contacts_Insert_Update_V2450", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_Idcontact", contacts.IdContact);
                        mySqlCommand.Parameters.AddWithValue("_Firstname", contacts.Firstname);
                        mySqlCommand.Parameters.AddWithValue("_Lastname", contacts.Lastname);
                        mySqlCommand.Parameters.AddWithValue("_IdGender", contacts.IdGender);
                        mySqlCommand.Parameters.AddWithValue("_Email", contacts.Email);
                        mySqlCommand.Parameters.AddWithValue("_Phone", contacts.Phone);
                        mySqlCommand.Parameters.AddWithValue("_Phone2", contacts.Phone2);
                        mySqlCommand.Parameters.AddWithValue("_IdDepartment", contacts.IdDepartment);
                        mySqlCommand.Parameters.AddWithValue("_JobTitle", contacts.JobTitle);
                        mySqlCommand.Parameters.AddWithValue("_Image", contacts.ImageText);
                        mySqlCommand.Parameters.AddWithValue("_Remarks", contacts.Remarks);

                        contacts.IdContact = Convert.ToInt32(mySqlCommand.ExecuteScalar());
                        mySqlConnection.Close();
                    }

                    transactionScope.Complete();
                }
                if (contacts.ArticleSuppliersComments != null)
                {
                    AddUpdateDeleteCommentsByContacts_V2450(mainServerConnectionString, contacts.IdContact, contacts.ArticleSuppliersComments);
                }
                if (ArticleSuppliersChangeLogList != null && ArticleSuppliersChangeLogList.Count > 0)
                {
                    AddCommentsOrLogEntriesByContacts_V2450(mainServerConnectionString, contacts.IdContact, ArticleSuppliersChangeLogList);
                }
                try
                {
                    if (contacts.ArticleSupplierContacts != null && contacts.ArticleSupplierContacts.Count > 0)
                    {
                        AddUpdateDeleteArticleSupplierContacts_V2560(mainServerConnectionString, contacts.IdContact, contacts.ArticleSupplierContacts);
                    }
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error AddContact_V2560(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                }
            }
            catch (Exception ex)
            {
                if (Transaction.Current != null)
                    Transaction.Current.Rollback();

                if (transactionScope != null)
                    transactionScope.Dispose();

                Log4NetLogger.Logger.Log(string.Format("Error AddContact_V2560(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return contacts;
        }
        public bool AddUpdateDeleteArticleSupplierContacts_V2560(string MainServerConnectionString, int idcontact, List<Article_Supplier_Contacts> ArticleSupplierContacts)
        {
            try
            {
                if (ArticleSupplierContacts != null)
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        foreach (Article_Supplier_Contacts articleSupplierContacts in ArticleSupplierContacts)
                        {

                            if (articleSupplierContacts.TransactionOperation == ModelBase.TransactionOperations.Add)
                            {

                                MySqlCommand mySqlCommand = new MySqlCommand("SRM_AddUpdateArticleSupplierContacts_V2560", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdContact", idcontact);
                                mySqlCommand.Parameters.AddWithValue("_idArticleSupplier", articleSupplierContacts.IdArticleSupplier);
                                mySqlCommand.ExecuteNonQuery();
                            }

                            else if (articleSupplierContacts.TransactionOperation == ModelBase.TransactionOperations.Delete)
                            {

                                MySqlCommand mySqlCommand = new MySqlCommand("SRM_DeleteArticleSupplierContacts_V2560", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdContact", idcontact);
                                mySqlCommand.Parameters.AddWithValue("_idArticleSupplier", articleSupplierContacts.IdArticleSupplier);
                                mySqlCommand.ExecuteNonQuery();
                            }


                            else if (articleSupplierContacts.TransactionOperation == ModelBase.TransactionOperations.Update)
                            {
                                MySqlCommand mySqlCommand = new MySqlCommand("SRM_AddUpdateArticleSupplierContacts_V2560", mySqlConnection);
                                mySqlCommand.CommandType = CommandType.StoredProcedure;
                                mySqlCommand.Parameters.AddWithValue("_IdContact", idcontact);
                                mySqlCommand.Parameters.AddWithValue("_idArticleSupplier", articleSupplierContacts.IdArticleSupplier);
                                mySqlCommand.ExecuteNonQuery();
                            }

                        }
                        mySqlConnection.Close();
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error AddUpdateDeleteArticleSupplierContacts_V2560(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                return false;
            }
            return true;
        }

        //[pramod.misal][GEOS2-5136][22.01.2024]
        //Shubham[skadam] GEOS2-5903 REQUEST IMPROVEMENTS 21 09 2024
        public void ArticleSupplierContacts_Insert_V2560(string connectionString, int idContact, Int64 idArticleSupplier)
        {
            TransactionScope transactionScope = null;
            try
            {
                using (transactionScope = new TransactionScope())
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("SRM_AddUpdateArticleSupplierContacts_V2560;", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdArticleSupplier", idArticleSupplier);
                        mySqlCommand.Parameters.AddWithValue("_IdContact", idContact);
                        mySqlCommand.Parameters.AddWithValue("_IsMainContact", 0);

                        mySqlCommand.ExecuteNonQuery();
                        mySqlConnection.Close();
                    }

                    transactionScope.Complete();
                }
            }
            catch (Exception ex)
            {
                if (Transaction.Current != null)
                    Transaction.Current.Rollback();

                if (transactionScope != null)
                    transactionScope.Dispose();

                Log4NetLogger.Logger.Log(string.Format("Error ArticleSuppliercontacts_Insert(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

        }

        // [nsatpute][13-01-2025][GEOS2-6443]
        public Ots GetPendingReviewByIdOt_V2600(Int64 idOt, Warehouses warehouse, string CurrenciesImages)
        {
            List<SRMWarehouseBulkArticle> LstWarehouseList = GetWarehouseBulkArticle(warehouse);
            string connectionString = warehouse.Company.ConnectPlantConstr;
            Ots ot = null;

            using (MySqlConnection connOT = new MySqlConnection(connectionString))
            {
                connOT.Open();

                MySqlCommand otCommand = new MySqlCommand("SRM_GetMaterialOtInformationByIdOt_V2600", connOT);
                otCommand.CommandType = CommandType.StoredProcedure;
                otCommand.Parameters.AddWithValue("_IdOt", idOt);
                otCommand.CommandTimeout = 8000;
                using (MySqlDataReader otReader = otCommand.ExecuteReader())
                {
                    if (otReader.Read())
                    {
                        try
                        {
                            ot = new Ots();
                            ot.IdOT = idOt;

                            if (otReader["Code"] != DBNull.Value)
                                ot.OfferCode = Convert.ToString(otReader["Code"]);

                            if (otReader["OtCode"] != DBNull.Value)
                                ot.Code = Convert.ToString(otReader["OtCode"]);

                            ot.NumOT = Convert.ToByte(otReader["NumOT"]);

                            if (otReader["Comments"] != DBNull.Value)
                                ot.Comments = Convert.ToString(otReader["Comments"]);

                            if (otReader["CreatedBy"] != DBNull.Value)
                            {
                                ot.CreatedBy = Convert.ToInt32(otReader["CreatedBy"]);

                                ot.CreatedByPerson = new People();
                                ot.CreatedByPerson.IdPerson = ot.CreatedBy;
                                ot.CreatedByPerson.Name = Convert.ToString(otReader["CreatedByName"]);
                                ot.CreatedByPerson.Surname = Convert.ToString(otReader["CreatedBySurname"]);
                            }

                            ot.ReviewedBy = Convert.ToInt32(otReader["ReviewedBy"]);

                            //CreatedBy
                            if (otReader["CreatedBy"] != DBNull.Value)
                            {
                                ot.CreatedBy = Convert.ToInt32(otReader["CreatedBy"]);

                                ot.CreatedByPerson = new People();
                                ot.CreatedByPerson.IdPerson = ot.CreatedBy;
                                ot.CreatedByPerson.Name = Convert.ToString(otReader["CreatedByName"]);
                                ot.CreatedByPerson.Surname = Convert.ToString(otReader["CreatedBySurname"]);
                            }

                            if (otReader["CreationDate"] != DBNull.Value)
                                ot.CreationDate = Convert.ToDateTime(otReader["CreationDate"]);

                            //ModifiedBy
                            if (otReader["ModifiedBy"] != DBNull.Value)
                            {
                                ot.ModifiedBy = Convert.ToInt32(otReader["ModifiedBy"]);

                                ot.ModifiedByPerson = new People();
                                ot.ModifiedByPerson.IdPerson = ot.ModifiedBy;
                                ot.ModifiedByPerson.Name = Convert.ToString(otReader["ModifiedByName"]);
                                ot.ModifiedByPerson.Surname = Convert.ToString(otReader["ModifiedBySurname"]);
                            }

                            if (otReader["ModifiedIn"] != DBNull.Value)
                                ot.ModifiedIn = Convert.ToDateTime(otReader["ModifiedIn"]);

                            if (otReader["DeliveryDate"] != DBNull.Value)
                                ot.DeliveryDate = Convert.ToDateTime(otReader["DeliveryDate"]);

                            if (otReader["WareHouseLockSession"] != DBNull.Value)
                                ot.WareHouseLockSession = Convert.ToString(otReader["WareHouseLockSession"]);

                            if (otReader["AttachedFiles"] != DBNull.Value)
                                ot.AttachedFiles = Convert.ToString(otReader["AttachedFiles"]);

                            if (otReader["IdShippingAddress"] != DBNull.Value)
                                ot.IdShippingAddress = Convert.ToInt64(otReader["IdShippingAddress"]);

                            ot.IdQuotation = Convert.ToInt64(otReader["IdQuotation"]);
                            ot.Quotation = new Quotation();
                            ot.Quotation.Code = Convert.ToString(otReader["QuotationCode"]);

                            if (otReader["Year"] != DBNull.Value)
                                ot.Quotation.Year = Convert.ToInt32(otReader["Year"]);

                            if (otReader["Description"] != DBNull.Value)
                                ot.Quotation.Description = Convert.ToString(otReader["Description"]);

                            if (otReader["ProjectName"] != DBNull.Value)
                                ot.Quotation.ProjectName = Convert.ToString(otReader["ProjectName"]);


                            if (otReader["ProjectName"] != DBNull.Value)
                                ot.Quotation.ProjectName = Convert.ToString(otReader["ProjectName"]);

                            //Customer
                            if (otReader["IdSite"] != DBNull.Value)
                            {
                                ot.Quotation.Site = new Company();
                                ot.Quotation.Site.IdCompany = Convert.ToInt32(otReader["IdSite"]);
                                ot.Quotation.Site.SiteNameWithoutCountry = Convert.ToString(otReader["SiteName"]);

                                if (otReader["ShortName"] != DBNull.Value && !string.IsNullOrEmpty(Convert.ToString(otReader["ShortName"])))
                                {
                                    ot.Quotation.Site.Name = Convert.ToString(otReader["ShortName"]);
                                }
                                else
                                {
                                    ot.Quotation.Site.Name = Convert.ToString(otReader["Customer"]);
                                }

                                if (otReader["idCountry"] != DBNull.Value)
                                {
                                    ot.Quotation.Site.IdCountry = Convert.ToByte(otReader["idCountry"]);
                                    ot.Quotation.Site.Country = new Country();
                                    ot.Quotation.Site.Country.IdCountry = Convert.ToByte(otReader["idCountry"]);
                                    ot.Quotation.Site.Country.Name = otReader["CountryName"].ToString();
                                    ot.Quotation.Site.Country.Iso = otReader["iso"].ToString();

                                    if (otReader["EuroZone"] != DBNull.Value)
                                    {
                                        ot.Quotation.Site.Country.EuroZone = Convert.ToSByte(otReader["EuroZone"]);
                                    }

                                    if (otReader["IdCountryGroup"] != DBNull.Value)
                                    {
                                        ot.Quotation.Site.CountryGroup = new CountryGroup();
                                        ot.Quotation.Site.CountryGroup.IdCountryGroup = Convert.ToInt64(otReader["IdCountryGroup"]);

                                        if (otReader["CountryGroup"] != DBNull.Value)
                                            ot.Quotation.Site.CountryGroup.Name = Convert.ToString(otReader["CountryGroup"]);

                                        if (otReader["IsFreeTrade"] != DBNull.Value)
                                            ot.Quotation.Site.CountryGroup.IsFreeTrade = Convert.ToByte(otReader["IsFreeTrade"]);
                                    }
                                }

                                ot.Quotation.Site.Customer = new Customer();
                                ot.Quotation.Site.Customer.IdCustomer = Convert.ToInt32(otReader["IdCustomer"]);
                                ot.Quotation.Site.Customer.CustomerName = Convert.ToString(otReader["CustomerName"]);
                            }
                            if (otReader["IdTemplate"] != DBNull.Value)
                            {
                                ot.Quotation.Template = new Template();
                                ot.Quotation.Template.IdTemplate = Convert.ToByte(otReader["IdTemplate"]);
                                ot.Quotation.Template.Name = Convert.ToString(otReader["Template"]);
                                ot.Quotation.Template.Type = Convert.ToInt64(otReader["IdTemplateType"]);
                            }

                            if (otReader["IdOffer"] != DBNull.Value)
                            {
                                ot.Quotation.IdOffer = Convert.ToInt32(otReader["IdOffer"]);

                                ot.Quotation.Offer = new Offer();
                                ot.Quotation.Offer.Description = Convert.ToString(otReader["Description"]);

                                if (otReader["IdOfferType"] != DBNull.Value)
                                {
                                    ot.Quotation.Offer.IdOfferType = Convert.ToByte(otReader["IdOfferType"]);

                                    ot.Quotation.Offer.OfferType = new OfferType();
                                    ot.Quotation.Offer.OfferType.IdOfferType = Convert.ToByte(ot.Quotation.Offer.IdOfferType);
                                    ot.Quotation.Offer.OfferType.Name = Convert.ToString(otReader["OfferType"]);
                                }


                                if (otReader["IdCarriageMethod"] != DBNull.Value)
                                {
                                    ot.Quotation.Offer.IdCarriageMethod = Convert.ToByte(otReader["IdCarriageMethod"]);
                                    LookupValue carriage = new LookupValue();
                                    carriage.IdLookupValue = Convert.ToInt32(ot.Quotation.Offer.IdCarriageMethod);
                                    carriage.Value = Convert.ToString(otReader["CarriageValue"]);
                                    carriage.IdImage = Convert.ToInt64(otReader["CarriageImage"]);

                                    ot.Quotation.Offer.CarriageMethod = carriage;
                                }

                                if (otReader["PODate"] != DBNull.Value)
                                    ot.Quotation.Offer.POReceivedInDate = Convert.ToDateTime(otReader["PODate"]);

                                if (otReader["IdWorkflowStatus"] != DBNull.Value)
                                    ot.IdWorkflowStatus = Convert.ToByte(otReader["IdWorkflowStatus"]);

                                if (otReader["ProducerIdCountryGroup"] != DBNull.Value)
                                {
                                    ot.ProducerIdCountryGroup = Convert.ToInt64(otReader["ProducerIdCountryGroup"]);
                                    ot.CountryGroup = new CountryGroup();
                                    ot.CountryGroup.IdCountryGroup = Convert.ToInt64(otReader["ProducerIdCountryGroup"]);
                                    ot.CountryGroup.Name = Convert.ToString(otReader["ProducerCountryGroup"]);
                                    ot.CountryGroup.HtmlColor = Convert.ToString(otReader["ProducerCountryGroupColor"]);
                                }

                                if (otReader["PoNumberForReport"] != DBNull.Value)
                                {
                                    ot.PoCode = Convert.ToString(otReader["PoNumberForReport"]);
                                }

                                if (otReader["PoDateForReport"] != DBNull.Value)
                                {
                                    ot.PoDate = Convert.ToDateTime(otReader["PoDateForReport"]);
                                }

                                if (otReader["OfferOwner"] != DBNull.Value)
                                {
                                    ot.OfferOwner = Convert.ToString(otReader["OfferOwner"]);
                                }

                                if (otReader["CustomerNameForReport"] != DBNull.Value)
                                {
                                    ot.CustomerNameForReport = Convert.ToString(otReader["CustomerNameForReport"]);
                                }
                                if (otReader["idCurrency"] != DBNull.Value)
                                {
                                    ot.IdCurrency = Convert.ToByte(otReader["idCurrency"]);
                                    ot.Currency = new Currency();
                                    ot.Currency.IdCurrency = Convert.ToByte(otReader["idCurrency"]);
                                    ot.Currency.Symbol = Convert.ToString(otReader["CurrencySymbol"]);
                                }
                            }
                            ot.OtItems = GetOtItemsByIdOt_V2600(connectionString, idOt, warehouse.IdWarehouse, LstWarehouseList, CurrenciesImages);// [nsatpute][13-01-2025][GEOS2-6443]             
                            // [nsatpute][13-01-2025][GEOS2-6443]
                            ot.ArticleStocks = new List<ArticlesStock>();
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetPendingReviewByIdOt_V2600(idOt-{0}, idWarehouse-{1}). ErrorMessage- {2} ", idOt, warehouse.IdWarehouse, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }
            return ot;
        }
        // [nsatpute][13-01-2025][GEOS2-6443]
        private List<OtItem> GetOtItemsByIdOt_V2600(string connectionString, Int64 idOt, Int64 idWarehouse, List<SRMWarehouseBulkArticle> LstWarehouseList, string currencyPath)
        {
            List<OtItem> statusUpdateOtItems = new List<OtItem>();
            List<OtItem> otItems = new List<OtItem>();
            List<int> articleIds = new List<int>();
            //string idArticleList = string.Empty;
            string mainArticle = string.Empty;
            List<ArticleForecast> forecastList = new List<ArticleForecast>();
            var temp = GetOtItemStatusList_V2540(connectionString);
            using (MySqlConnection connOtItem = new MySqlConnection(connectionString))
            {
                connOtItem.Open();

                MySqlCommand otItemCommand = new MySqlCommand("SRM_GetOtItemsByIdOt_V2600", connOtItem);
                otItemCommand.CommandType = CommandType.StoredProcedure;
                otItemCommand.Parameters.AddWithValue("_IdOt", idOt);
                otItemCommand.Parameters.AddWithValue("_IdWarehouse", idWarehouse);
                otItemCommand.CommandTimeout = 8000;
                using (MySqlDataReader otItemReader = otItemCommand.ExecuteReader())
                {
                    int keyId = 0;

                    while (otItemReader.Read())
                    {
                        try
                        {
                            OtItem otItem = new OtItem();
                            otItem.KeyId = keyId;
                            otItem.ParentId = -1;

                            otItem.IdOT = idOt;

                            otItem.IdOTItem = Convert.ToInt64(otItemReader["IdOtItem"]);

                            otItem.IsBatch = Convert.ToByte(otItemReader["IsBatch"]);

                            if (otItemReader["AttachedFiles"] != DBNull.Value)
                                otItem.AttachedFiles = Convert.ToString(otItemReader["AttachedFiles"]);

                            otItem.Rework = Convert.ToByte(otItemReader["Rework"]);

                            if (otItemReader["IdRevisionItem"] != DBNull.Value)
                            {
                                otItem.IdRevisionItem = Convert.ToInt64(otItemReader["IdRevisionItem"]);

                                otItem.RevisionItem = new RevisionItem();
                                otItem.RevisionItem.IdRevisionItem = otItem.IdRevisionItem;
                                otItem.RevisionItem.NumItem = Convert.ToString(otItemReader["NumItem"]);
                                otItem.RevisionItem.Quantity = Convert.ToDecimal(otItemReader["Quantity"]);
                                otItem.RevisionItem.UnitPrice = Convert.ToDecimal(otItemReader["UnitPrice"]);



                                if (otItemReader["CustomerComment"] != DBNull.Value)
                                    otItem.RevisionItem.ItemRemarks = Convert.ToString(otItemReader["CustomerComment"]);

                                if (otItemReader["CustomerCommentOT"] != DBNull.Value)
                                    otItem.RevisionItem.InternalComment = Convert.ToString(otItemReader["CustomerCommentOT"]);

                                if (otItemReader["CustomerCommentRevision"] != DBNull.Value)
                                    otItem.RevisionItem.CustomerComment = Convert.ToString(otItemReader["CustomerCommentRevision"]);

                                otItem.RevisionItem.WarehouseProduct = new WarehouseProduct();
                                otItem.RevisionItem.WarehouseProduct.IdWarehouseProduct = Convert.ToInt64(otItemReader["IdWarehouseproduct"]);

                                if (otItemReader["WpDescription"] != DBNull.Value)
                                    otItem.RevisionItem.WarehouseProduct.Description = Convert.ToString(otItemReader["WpDescription"]);

                                if (otItemReader["IdArticle"] != DBNull.Value)
                                {
                                    otItem.RevisionItem.WarehouseProduct.IdArticle = Convert.ToInt32(otItemReader["IdArticle"]);

                                    Article article = new Article();
                                    article.IdArticle = Convert.ToInt32(otItemReader["IdArticle"]);
                                    article.IsGeneric = Convert.ToSByte(otItemReader["IsGeneric"]);
                                    article.Reference = Convert.ToString(otItemReader["Reference"]);
                                    article.IsObsolete = Convert.ToSByte(otItemReader["IsObsolete"]);


                                    if (otItemReader["ArticleDescription"] != DBNull.Value)
                                        article.Description = Convert.ToString(otItemReader["ArticleDescription"]);

                                    if (otItemReader["Description_es"] != DBNull.Value)
                                        article.Description_es = Convert.ToString(otItemReader["Description_es"]);

                                    if (otItemReader["Description_fr"] != DBNull.Value)
                                        article.Description_fr = Convert.ToString(otItemReader["Description_fr"]);

                                    article.ImagePath = Convert.ToString(otItemReader["ImagePath"]);
                                    article.RegisterSerialNumber = Convert.ToByte(otItemReader["RegisterSerialNumber"]);

                                    if (otItemReader["Location"] != DBNull.Value)
                                        article.Location = Convert.ToString(otItemReader["Location"]);

                                    if (otItemReader["Weight"] != DBNull.Value)
                                        article.Weight = Convert.ToDecimal(otItemReader["Weight"]);

                                    if (otItemReader["IdArticleType"] != DBNull.Value)
                                        article.IdArticleType = Convert.ToInt64(otItemReader["IdArticleType"]);

                                    otItem.RevisionItem.WarehouseProduct.Article = article;
                                }

                                if (otItemReader["Iditemotstatus"] != DBNull.Value)
                                {
                                    otItem.IdItemOtStatus = Convert.ToByte(otItemReader["Iditemotstatus"]);

                                    otItem.Status = new ItemOTStatusType();
                                    otItem.Status.IdItemOtStatus = otItem.IdItemOtStatus;
                                    otItem.Status.Name = Convert.ToString(otItemReader["Status"]);
                                    otItem.Status.HtmlColor = Convert.ToString(otItemReader["statusColor"]);
                                }

                                if (otItemReader["AssignedTo"] != DBNull.Value)
                                {
                                    otItem.AssignedTo = Convert.ToInt32(otItemReader["AssignedTo"]);

                                    otItem.AssignedToUser = new People();
                                    otItem.AssignedToUser.Name = Convert.ToString(otItemReader["AssignedName"]);
                                    otItem.AssignedToUser.Surname = Convert.ToString(otItemReader["AssignedSurname"]);
                                }

                                if (otItemReader["DownloadedQty"] != DBNull.Value)
                                    otItem.RevisionItem.DownloadedQuantity = Convert.ToInt64(otItemReader["DownloadedQty"]);


                                otItem.InternalNotes = Convert.ToString(otItemReader["InternalNotes"]);
                                if (otItemReader["CostPrice"] != DBNull.Value)
                                    otItem.CostPrice = Convert.ToDouble(otItemReader["CostPrice"]);
                                if (otItemReader["PurchaseQty"] != DBNull.Value)
                                    otItem.PurchaseQuantity = Convert.ToInt64(otItemReader["PurchaseQty"]);
                                if (otItemReader["ForcePurchaseQty"] != DBNull.Value)
                                    otItem.ForcePurchaseQuantity = Convert.ToBoolean(otItemReader["ForcePurchaseQty"]);
                                otItem.Currency = new Currency();
                                if (otItemReader["IdCurrency"] != DBNull.Value)
                                    otItem.Currency.IdCurrency = Convert.ToByte(otItemReader["IdCurrency"]);
                                otItem.Currency.Name = Convert.ToString(otItemReader["CurrencyName"]);
                                if (otItemReader["PackingSize"] != DBNull.Value)
                                    otItem.PackingSize = Convert.ToInt32(otItemReader["PackingSize"]);
                                otItem.CurrencyIconBytes = GetCountryIconFileInBytes(Convert.ToString(otItemReader["CurrencyName"]), currencyPath);

                                if (otItemReader["Validated"] != DBNull.Value)
                                {
                                    int validate = Convert.ToInt32(otItemReader["Validated"]);
                                    if (validate == 1)
                                    {
                                        otItem.IsReviewValidated = true;
                                        otItem.ValidatedCount = 1;
                                    }
                                }
                            }

                            List<OtItem> decomposedOtItems = GetArticlesForDecomposition_V2600(connectionString, idOt, idWarehouse, otItem, ref keyId, LstWarehouseList);

                            if (decomposedOtItems != null && decomposedOtItems.Count > 0)
                            {

                                if (otItem.RevisionItem.WarehouseProduct.Article.IdArticleType != 2)
                                {
                                    if (LstWarehouseList != null && LstWarehouseList.Any(i => i.IdArticle == otItem.RevisionItem.WarehouseProduct.IdArticle && (i.IdParent == null || i.IdParent == 0)))
                                    {
                                        otItem.RevisionItem.Status = 100;
                                    }
                                    else
                                    {
                                        otItem.RevisionItem.Status = (Int64)((Math.Abs((double)decomposedOtItems.Sum(y => y.RevisionItem.DownloadedQuantity)) / (double)decomposedOtItems.Sum(y => y.RevisionItem.Quantity)) * 100);
                                    }
                                }
                                otItems.Add(otItem);
                                otItems.AddRange(decomposedOtItems);
                            }
                            else
                            {
                                otItems.Add(otItem);
                            }
                            keyId++;
                            if (otItem.Status.IdItemOtStatus == 1 || otItem.Status.IdItemOtStatus == 2 || otItem.Status.IdItemOtStatus == 12)
                            {
                                var text = otItem.RevisionItem.WarehouseProduct.Article.Reference;
                                List<int> desiredIds = new List<int> { 1, 2, 12 };
                                otItem.StatusList = new List<ItemOTStatusType>();
                                otItem.StatusList = temp.Where(x => desiredIds.Contains(x.IdItemOtStatus)).ToList();
                            }
                            else
                            {
                                otItem.StatusList = new List<ItemOTStatusType>();
                                otItem.StatusList = temp.Where(x => x.IdItemOtStatus == otItem.Status.IdItemOtStatus).ToList();
                            }
                            if (otItem.StatusList?.Count > 1)
                                otItem.ShowCombobox = true;
                            else
                                otItem.ShowCombobox = false;
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetOtItemsByIdOt_V2540(idOt-{0}, idWarehouse-{1}). ErrorMessage- {2}", idOt, idWarehouse, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }

                    if (otItemReader.NextResult())
                    {
                        while (otItemReader.Read())
                        {
                            try
                            {
                                if (otItemReader["IdArticle"] != DBNull.Value)
                                {
                                    foreach (var itemotItem in otItems.Where(ot => ot.RevisionItem.WarehouseProduct.IdArticle == Convert.ToInt64(otItemReader["IdArticle"])))
                                    {
                                        if (otItemReader["ArticleStock"] != DBNull.Value)
                                            itemotItem.ArticleStock = Convert.ToInt64(otItemReader["ArticleStock"]);

                                        if (otItemReader["ArticleMinimumStock"] != DBNull.Value)
                                            itemotItem.ArticleMinimumStock = Convert.ToInt64(otItemReader["ArticleMinimumStock"]);

                                        if (otItemReader["ArticleMaximumStock"] != DBNull.Value)
                                            itemotItem.ArticleMaximumStock = Convert.ToInt64(otItemReader["ArticleMaximumStock"]);
                                    }
                                }
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetOtItemsByIdOt_V2540(idOt-{0}, idWarehouse-{1}). ErrorMessage- {2}", idOt, idWarehouse, ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }

                    }
                }
            }

            List<int> idList = otItems.Select(item => item.RevisionItem.WarehouseProduct.IdArticle).ToList();
            string idArticleList = string.Join(",", idList);
            forecastList = GetArticleForecastOfTypeOT_V2540(connectionString, idArticleList, idWarehouse);
            foreach (var itemotItem in otItems)
            {
                //itemotItem.ExpectedStock = itemotItem.ArticleStock - forecastList
                //    .Where(x => x.IdArticle == itemotItem.RevisionItem.WarehouseProduct.IdArticle)
                //    ?.Sum(x => x.Quantity) ?? 0;
                itemotItem.ArticleIncoming = forecastList
                  .Where(x => x.Type == "PO" && x.IdArticle == itemotItem.RevisionItem.WarehouseProduct.IdArticle)
                  ?.Sum(x => x.Quantity) ?? 0;
                itemotItem.ArticleOutcoming = forecastList
                  .Where(x => x.Type == "OT" && x.IdArticle == itemotItem.RevisionItem.WarehouseProduct.IdArticle)
                  ?.Sum(x => x.Quantity) ?? 0;
                itemotItem.ExpectedStock = itemotItem.ArticleStock + itemotItem.ArticleIncoming - itemotItem.ArticleOutcoming;//[Sudhir.Jangra][GEOS2-6049]
            }
            return otItems;
        }
        // [nsatpute][13-01-2025][GEOS2-6443]
        private List<OtItem> GetArticlesForDecomposition_V2600(string connectionString, Int64 idOt, Int64 idWarehouse, OtItem parentOtItem, ref int keyId, List<SRMWarehouseBulkArticle> LstWarehouseList)
        {
            List<OtItem> otItems = new List<OtItem>();
            using (MySqlConnection connOtItem = new MySqlConnection(connectionString))
            {
                connOtItem.Open();

                MySqlCommand otItemCommand = new MySqlCommand("SRM_GetArticlesForDecomposition_V2540", connOtItem);
                otItemCommand.CommandType = CommandType.StoredProcedure;
                otItemCommand.Parameters.AddWithValue("_IdOTitem", parentOtItem.IdOTItem);
                otItemCommand.Parameters.AddWithValue("_IdWarehouse", idWarehouse);
                otItemCommand.CommandTimeout = 8000;

                using (MySqlDataReader otItemReader = otItemCommand.ExecuteReader())
                {
                    while (otItemReader.Read())
                    {
                        try
                        {
                            keyId++;
                            OtItem otItem = new OtItem();
                            otItem.IdOT = idOt;
                            otItem.IdOTItem = Convert.ToInt64(otItemReader["IdOtItem"]);

                            if (otItemReader["IdItemOtStatus"] != DBNull.Value)
                                otItem.IdItemOtStatus = Convert.ToByte(otItemReader["IdItemOtStatus"]);


                            otItem.Rework = Convert.ToByte(otItemReader["Rework"]);

                            if (otItemReader["IdRevisionItem"] != DBNull.Value)
                            {
                                otItem.IdRevisionItem = Convert.ToInt64(otItemReader["IdRevisionItem"]);

                                otItem.RevisionItem = new RevisionItem();
                                otItem.RevisionItem.IdRevisionItem = otItem.IdRevisionItem;
                                otItem.RevisionItem.NumItem = Convert.ToString(otItemReader["NumItem"]);

                                otItem.RevisionItem.WarehouseProduct = new WarehouseProduct();
                                otItem.RevisionItem.WarehouseProduct.IdWarehouseProduct = Convert.ToInt64(otItemReader["IdWarehouseproduct"]);

                                if (otItemReader["IdComponent"] != DBNull.Value)
                                {
                                    otItem.RevisionItem.WarehouseProduct.IdComponent = Convert.ToInt64(otItemReader["IdComponent"]);
                                }
                                otItem.KeyId = keyId;

                                if (otItemReader["parentArticleType"] != DBNull.Value)
                                {
                                    otItem.ParentArticleType = Convert.ToInt64(otItemReader["parentArticleType"]);
                                }

                                if (otItemReader["idParent"] != DBNull.Value)
                                {
                                    otItem.ParentId = Convert.ToInt32(otItemReader["idParent"]);
                                }

                                if (otItem.ParentId == -1)
                                {
                                    otItem.ParentId = parentOtItem.KeyId;
                                    otItem.RevisionItem.Quantity = parentOtItem.RevisionItem.Quantity * Convert.ToDecimal(otItemReader["Quantity"]);
                                    otItem.RevisionItem.RemainingQuantityDecimal = parentOtItem.RevisionItem.Quantity * Convert.ToDecimal(otItemReader["RemainingQty"]);
                                }
                                else
                                {
                                    decimal qty = otItems.First(x => x.RevisionItem.WarehouseProduct.IdComponent == otItem.ParentId).RevisionItem.Quantity;
                                    otItem.RevisionItem.Quantity = qty * Convert.ToDecimal(otItemReader["Quantity"]);
                                    otItem.RevisionItem.RemainingQuantityDecimal = qty * Convert.ToDecimal(otItemReader["RemainingQty"]);
                                    otItem.ParentId = otItems.First(x => x.RevisionItem.WarehouseProduct.IdComponent == otItem.ParentId).KeyId;
                                }
                                if (otItemReader["IdArticle"] != DBNull.Value)
                                {
                                    otItem.RevisionItem.WarehouseProduct.IdArticle = Convert.ToInt32(otItemReader["IdArticle"]);
                                    Article article = new Article();
                                    article.IdArticle = Convert.ToInt32(otItemReader["IdArticle"]);
                                    article.IsGeneric = Convert.ToSByte(otItemReader["IsGeneric"]);
                                    article.Reference = Convert.ToString(otItemReader["Reference"]);
                                    article.IsObsolete = Convert.ToSByte(otItemReader["IsObsolete"]);

                                    if (otItemReader["Description"] != DBNull.Value)
                                        article.Description = Convert.ToString(otItemReader["Description"]);

                                    if (otItemReader["Description_es"] != DBNull.Value)
                                        article.Description_es = Convert.ToString(otItemReader["Description_es"]);

                                    if (otItemReader["Description_fr"] != DBNull.Value)
                                        article.Description_fr = Convert.ToString(otItemReader["Description_fr"]);

                                    article.ImagePath = Convert.ToString(otItemReader["ImagePath"]);
                                    article.RegisterSerialNumber = Convert.ToByte(otItemReader["RegisterSerialNumber"]);

                                    if (otItemReader["Weight"] != DBNull.Value)
                                        article.Weight = Convert.ToDecimal(otItemReader["Weight"]);

                                    if (otItemReader["Location"] != DBNull.Value)
                                        article.Location = Convert.ToString(otItemReader["Location"]);

                                    if (otItemReader["IdArticleType"] != DBNull.Value)
                                        article.IdArticleType = Convert.ToInt64(otItemReader["IdArticleType"]);

                                    otItem.RevisionItem.WarehouseProduct.Article = article;
                                }

                                if (otItemReader["Iditemotstatus"] != DBNull.Value)
                                {
                                    otItem.IdItemOtStatus = Convert.ToByte(otItemReader["Iditemotstatus"]);

                                }
                                Int32? parentidArticle = null;
                                if (otItemReader["parentidArticle"] != DBNull.Value)
                                {
                                    parentidArticle = Convert.ToInt32(otItemReader["parentidArticle"]);
                                }
                                Int32 mainParentIdArticle = 0;
                                if (otItemReader["mainParentIdArticle"] != DBNull.Value)
                                {
                                    mainParentIdArticle = Convert.ToInt32(otItemReader["mainParentIdArticle"]);
                                }
                                int downloaded = GetOtItemDownloadedQuantity_V2540(connectionString, otItem.RevisionItem.WarehouseProduct.Article.IdArticle, otItem.IdOTItem, otItem.RevisionItem.WarehouseProduct.IdComponent, idWarehouse);

                                otItem.RevisionItem.DownloadedQuantity = downloaded;

                                otItem.RevisionItem.RemainingQuantity = ((Int64)otItem.RevisionItem.Quantity - downloaded);

                            }
                            otItems.Add(otItem);

                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetArticlesForDecomposition_V2540(idOt-{0}, idWarehouse-{1}). ErrorMessage- {2}", idOt, idWarehouse, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                    if (otItemReader.NextResult())
                    {

                        while (otItemReader.Read())
                        {
                            try
                            {
                                if (otItemReader["IdArticle"] != DBNull.Value)
                                {
                                    foreach (var itemotItem in otItems.Where(ot => ot.RevisionItem.WarehouseProduct.IdArticle == Convert.ToInt64(otItemReader["IdArticle"])))
                                    {
                                        if (otItemReader["ArticleStock"] != DBNull.Value)
                                            itemotItem.ArticleStock = Convert.ToInt64(otItemReader["ArticleStock"]);

                                        if (otItemReader["ArticleMinimumStock"] != DBNull.Value)
                                            itemotItem.ArticleMinimumStock = Convert.ToInt64(otItemReader["ArticleMinimumStock"]);
                                        if (otItemReader["ArticleMaximumStock"] != DBNull.Value)
                                            itemotItem.ArticleMaximumStock = Convert.ToInt64(otItemReader["ArticleMaximumStock"]);

                                    }
                                }

                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetOtItemsByIdOt_V2540(idOt-{0}, idWarehouse-{1}). ErrorMessage- {2}", idOt, idWarehouse, ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                    }
                }
            }
            return otItems;
        }

        // [nsatpute][21-01-2025][GEOS2-5725]
        public List<Article> GetAllArticles(string connectionString)
        {
            List<Article> articles = new List<Article>();

            using (MySqlConnection conCountry = new MySqlConnection(connectionString))
            {
                conCountry.Open();

                MySqlCommand conCountrycommand = new MySqlCommand("SRM_GetAllArticles_V2600", conCountry);
                conCountrycommand.CommandType = CommandType.StoredProcedure;

                using (MySqlDataReader reader = conCountrycommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        Article article = new Article();

                        article.IdArticle = Convert.ToInt32(reader["IdArticle"]);

                        if (reader["Reference"] != DBNull.Value)
                            article.Reference = Convert.ToString(reader["Reference"]);

                        if (reader["IdArticleCategory"] != DBNull.Value)
                            article.IdArticleCategory = Convert.ToInt32(reader["IdArticleCategory"]);

                        articles.Add(article);
                    }
                }
            }

            return articles;
        }
        // [nsatpute][21-01-2025][GEOS2-5725]
        public List<ArticleSupplier> GetAllSuppliersForPurchasingReport(string connectionString)
        {
            List<ArticleSupplier> lstSuppliers = new List<ArticleSupplier>();

            using (MySqlConnection conCountry = new MySqlConnection(connectionString))
            {
                conCountry.Open();

                MySqlCommand conCountrycommand = new MySqlCommand("SRM_GetSuppliersForPurchasingReport_V2600", conCountry);
                conCountrycommand.CommandType = CommandType.StoredProcedure;

                using (MySqlDataReader reader = conCountrycommand.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        ArticleSupplier supplier = new ArticleSupplier();
                        supplier.IdArticleSupplier = Convert.ToInt32(reader["Id"]);
                        supplier.Name = Convert.ToString(reader["Name"]);
                        supplier.TradeName = Convert.ToString(reader["TradeName"]);
                        if (!reader.IsDBNull(reader.GetOrdinal("idpaymenttype")))
                            supplier.IdPaymentType = Convert.ToInt32(reader["idpaymenttype"]);
                        if (!reader.IsDBNull(reader.GetOrdinal("deliverydays")))
                            supplier.DeliveryDays = Convert.ToInt32(reader["deliverydays"]);
                        if (!reader.IsDBNull(reader.GetOrdinal("serie")))
                            supplier.Serie = Convert.ToChar(reader["serie"]);
                        if (!reader.IsDBNull(reader.GetOrdinal("idSite")))
                        {
                            supplier.Site = new Site();
                            supplier.Site.IdSite = Convert.ToUInt32(reader["idSite"]);
                            supplier.Site.Name = reader["siteName"].ToString();
                            supplier.Site.Customer = new Customer();
                            supplier.Site.Customer.IdCustomer = Convert.ToInt32(reader["idcustomer"]);
                            supplier.Site.Customer.CustomerName = reader["cusName"].ToString();
                        }

                        supplier.IdCurrency = Convert.ToByte(reader["idcurrency"]);
                        lstSuppliers.Add(supplier);
                    }
                }
            }
            return lstSuppliers;
        }
        // [nsatpute][21-01-2025][GEOS2-5725]
        public List<ArticlePurchasing> GetPurchasingReport(DateTime fromDate, DateTime toDate, long idArticleSupplier, int idArticle, long idWarehouse, string connectionString)
        {
            List<ArticlePurchasing> lstPurchasingReport = new List<ArticlePurchasing>();

            using (MySqlConnection conCountry = new MySqlConnection(connectionString))
            {
                conCountry.Open();

                MySqlCommand cmd = new MySqlCommand("SRM_GeneratePurchasingReport_V2600", conCountry);
                cmd.CommandType = CommandType.StoredProcedure;
                cmd.Parameters.AddWithValue("_FromDate", fromDate.ToString("yyyy/MM/dd HH:mm:ss"));
                cmd.Parameters.AddWithValue("_ToDate", toDate.ToString("yyyy/MM/dd 23:59:59"));
                cmd.Parameters.AddWithValue("_IdArticleSupplier", idArticleSupplier);
                cmd.Parameters.AddWithValue("_IdArticle", idArticle);
                cmd.Parameters.AddWithValue("_IdWarehouse", idWarehouse);
                using (MySqlDataReader reader = cmd.ExecuteReader())
                {
                    while (reader.Read())
                    {
                        ArticlePurchasing record = new ArticlePurchasing();
                        record.Date = Convert.ToDateTime(reader["Date"]);
                        record.IdOrder = Convert.ToInt32(reader["IdOrder"]);
                        record.Order = reader["Order"].ToString();
                        record.Article = reader["Article"].ToString();
                        record.Supplier = reader["Supplier"].ToString();
                        record.TradeName = reader["TradeName"].ToString();
                        record.SupplierReference = reader["SupplierReference"].ToString();
                        record.PoQuantity = Convert.ToInt32(reader["PoQuantity"]);
                        record.Quantity = Convert.ToInt32(reader["Quantity"]);
                        record.Price = Convert.ToDouble(reader["Value"]);
                        record.PoValue = Convert.ToDouble(reader["PoValue"]);
                        record.WarehouseDeliveryNoteCode = reader["WarehouseDeliveryNoteCode"].ToString();
                        record.IdCurrency = Convert.ToInt32(reader["IdCurrency"]);
                        record.NameCurrPO = reader["NameCurrPO"].ToString();
                        record.NameCurrSelected = reader["NameCurrSelected"].ToString();
                        record.ExchangeRate11 = Convert.ToDouble(reader["ExchangeRate11"]);
                        record.PoWarehouse = reader["PoWarehouse"].ToString();
                        record.IdWarehouse = Convert.ToInt32(reader["IdWarehouse"]);
                        record.UnitPrice = Convert.ToDouble(reader["UnitPrice"]);
                        record.Discount = Convert.ToDouble(reader["Discount"]);
                        record.ExchangeRate = Convert.ToDouble(reader["ExchangeRate"]);
                        record.TransportCost = Convert.ToDouble(reader["TransportCost"]);
                        record.ImportClearanceCost = Convert.ToDouble(reader["ImportClearanceCost"]);
                        record.DutiesPercentage = Convert.ToDouble(reader["DutiesPercentage"]);
                        record.Duties = Convert.ToDouble(reader["Duties"]);
                        record.TotalPriceWithNewCost = Convert.ToDouble(reader["TotalPriceWithNewCost"]);
                        record.WarehouseItemDescription = Convert.ToString(reader["WarehouseItemDescription"]);
                        record.Status = Convert.ToString(reader["Status"]);
                        record.CurSymbol = Convert.ToString(reader["Symbol"]);
                        // Calculation part
                        record.Price = record.Quantity * (record.UnitPrice * ((100 - record.Discount) / 100)) * (record.ExchangeRate == 0 ? 1 : record.ExchangeRate);
                        record.PoValue = record.PoQuantity * (record.UnitPrice * ((100 - record.Discount) / 100)) * (record.ExchangeRate == 0 ? 1 : record.ExchangeRate);
                        record.TotalPriceWithNewCost = (record.PoValue + record.TransportCost + record.ImportClearanceCost + record.Duties);
                        lstPurchasingReport.Add(record);
                    }
                }
            }
            return lstPurchasingReport;
        }
		//[nsatpute][26-02-2025][GEOS2-7034]
        private List<OtItem> GetOtItemsByIdOt_V2620(string connectionString, Int64 idOt, Int64 idWarehouse, List<SRMWarehouseBulkArticle> LstWarehouseList, string currencyPath)
        {
            List<OtItem> statusUpdateOtItems = new List<OtItem>();
            List<OtItem> otItems = new List<OtItem>();
            List<int> articleIds = new List<int>();
            //string idArticleList = string.Empty;
            string mainArticle = string.Empty;
            List<ArticleForecast> forecastList = new List<ArticleForecast>();
            var temp = GetOtItemStatusList_V2540(connectionString);
            using (MySqlConnection connOtItem = new MySqlConnection(connectionString))
            {
                connOtItem.Open();

                MySqlCommand otItemCommand = new MySqlCommand("SRM_GetOtItemsByIdOt_V2600", connOtItem);
                otItemCommand.CommandType = CommandType.StoredProcedure;
                otItemCommand.Parameters.AddWithValue("_IdOt", idOt);
                otItemCommand.Parameters.AddWithValue("_IdWarehouse", idWarehouse);
                otItemCommand.CommandTimeout = 8000;
                using (MySqlDataReader otItemReader = otItemCommand.ExecuteReader())
                {
                    int keyId = 0;

                    while (otItemReader.Read())
                    {
                        try
                        {
                            OtItem otItem = new OtItem();
                            otItem.KeyId = keyId;
                            otItem.ParentId = -1;

                            otItem.IdOT = idOt;

                            otItem.IdOTItem = Convert.ToInt64(otItemReader["IdOtItem"]);

                            otItem.IsBatch = Convert.ToByte(otItemReader["IsBatch"]);

                            if (otItemReader["AttachedFiles"] != DBNull.Value)
                                otItem.AttachedFiles = Convert.ToString(otItemReader["AttachedFiles"]);

                            otItem.Rework = Convert.ToByte(otItemReader["Rework"]);

                            if (otItemReader["IdRevisionItem"] != DBNull.Value)
                            {
                                otItem.IdRevisionItem = Convert.ToInt64(otItemReader["IdRevisionItem"]);

                                otItem.RevisionItem = new RevisionItem();
                                otItem.RevisionItem.IdRevisionItem = otItem.IdRevisionItem;
                                otItem.RevisionItem.NumItem = Convert.ToString(otItemReader["NumItem"]);
                                otItem.RevisionItem.Quantity = Convert.ToDecimal(otItemReader["Quantity"]);
                                otItem.RevisionItem.UnitPrice = Convert.ToDecimal(otItemReader["UnitPrice"]);



                                if (otItemReader["CustomerComment"] != DBNull.Value)
                                    otItem.RevisionItem.ItemRemarks = Convert.ToString(otItemReader["CustomerComment"]);

                                if (otItemReader["CustomerCommentOT"] != DBNull.Value)
                                    otItem.RevisionItem.InternalComment = Convert.ToString(otItemReader["CustomerCommentOT"]);

                                if (otItemReader["CustomerCommentRevision"] != DBNull.Value)
                                    otItem.RevisionItem.CustomerComment = Convert.ToString(otItemReader["CustomerCommentRevision"]);

                                otItem.RevisionItem.WarehouseProduct = new WarehouseProduct();
                                otItem.RevisionItem.WarehouseProduct.IdWarehouseProduct = Convert.ToInt64(otItemReader["IdWarehouseproduct"]);

                                if (otItemReader["WpDescription"] != DBNull.Value)
                                    otItem.RevisionItem.WarehouseProduct.Description = Convert.ToString(otItemReader["WpDescription"]);

                                if (otItemReader["IdArticle"] != DBNull.Value)
                                {
                                    otItem.RevisionItem.WarehouseProduct.IdArticle = Convert.ToInt32(otItemReader["IdArticle"]);

                                    Article article = new Article();
                                    article.IdArticle = Convert.ToInt32(otItemReader["IdArticle"]);
                                    article.IsGeneric = Convert.ToSByte(otItemReader["IsGeneric"]);
                                    article.Reference = Convert.ToString(otItemReader["Reference"]);
                                    article.IsObsolete = Convert.ToSByte(otItemReader["IsObsolete"]);


                                    if (otItemReader["ArticleDescription"] != DBNull.Value)
                                        article.Description = Convert.ToString(otItemReader["ArticleDescription"]);

                                    if (otItemReader["Description_es"] != DBNull.Value)
                                        article.Description_es = Convert.ToString(otItemReader["Description_es"]);

                                    if (otItemReader["Description_fr"] != DBNull.Value)
                                        article.Description_fr = Convert.ToString(otItemReader["Description_fr"]);

                                    article.ImagePath = Convert.ToString(otItemReader["ImagePath"]);
                                    article.RegisterSerialNumber = Convert.ToByte(otItemReader["RegisterSerialNumber"]);

                                    if (otItemReader["Location"] != DBNull.Value)
                                        article.Location = Convert.ToString(otItemReader["Location"]);

                                    if (otItemReader["Weight"] != DBNull.Value)
                                        article.Weight = Convert.ToDecimal(otItemReader["Weight"]);

                                    if (otItemReader["IdArticleType"] != DBNull.Value)
                                        article.IdArticleType = Convert.ToInt64(otItemReader["IdArticleType"]);

                                    otItem.RevisionItem.WarehouseProduct.Article = article;
                                }

                                if (otItemReader["Iditemotstatus"] != DBNull.Value)
                                {
                                    otItem.IdItemOtStatus = Convert.ToByte(otItemReader["Iditemotstatus"]);

                                    otItem.Status = new ItemOTStatusType();
                                    otItem.Status.IdItemOtStatus = otItem.IdItemOtStatus;
                                    otItem.Status.Name = Convert.ToString(otItemReader["Status"]);
                                    otItem.Status.HtmlColor = Convert.ToString(otItemReader["statusColor"]);
                                }

                                if (otItemReader["AssignedTo"] != DBNull.Value)
                                {
                                    otItem.AssignedTo = Convert.ToInt32(otItemReader["AssignedTo"]);

                                    otItem.AssignedToUser = new People();
                                    otItem.AssignedToUser.Name = Convert.ToString(otItemReader["AssignedName"]);
                                    otItem.AssignedToUser.Surname = Convert.ToString(otItemReader["AssignedSurname"]);
                                }

                                if (otItemReader["DownloadedQty"] != DBNull.Value)
                                    otItem.RevisionItem.DownloadedQuantity = Convert.ToInt64(otItemReader["DownloadedQty"]);


                                otItem.InternalNotes = Convert.ToString(otItemReader["InternalNotes"]);
                                if (otItemReader["CostPrice"] != DBNull.Value)
                                    otItem.CostPrice = Convert.ToDouble(otItemReader["CostPrice"]);
                                if (otItemReader["PurchaseQty"] != DBNull.Value)
                                    otItem.PurchaseQuantity = Convert.ToInt64(otItemReader["PurchaseQty"]);
                                if (otItemReader["ForcePurchaseQty"] != DBNull.Value)
                                    otItem.ForcePurchaseQuantity = Convert.ToBoolean(otItemReader["ForcePurchaseQty"]);
                                otItem.Currency = new Currency();
                                if (otItemReader["IdCurrency"] != DBNull.Value)
                                    otItem.Currency.IdCurrency = Convert.ToByte(otItemReader["IdCurrency"]);
                                otItem.Currency.Name = Convert.ToString(otItemReader["CurrencyName"]);
                                if (otItemReader["PackingSize"] != DBNull.Value)
                                    otItem.PackingSize = Convert.ToInt32(otItemReader["PackingSize"]);
                                otItem.CurrencyIconBytes = GetCountryIconFileInBytes(Convert.ToString(otItemReader["CurrencyName"]), currencyPath);

                                if (otItemReader["Validated"] != DBNull.Value)
                                {
                                    int validate = Convert.ToInt32(otItemReader["Validated"]);
                                    if (validate == 1)
                                    {
                                        otItem.IsReviewValidated = true;
                                        otItem.ValidatedCount = 1;
                                    }
                                }
                            }

                            List<OtItem> decomposedOtItems = GetArticlesForDecomposition_V2620(connectionString, idOt, idWarehouse, otItem, currencyPath, ref keyId, LstWarehouseList);

                            if (decomposedOtItems != null && decomposedOtItems.Count > 0)
                            {

                                if (otItem.RevisionItem.WarehouseProduct.Article.IdArticleType != 2)
                                {
                                    if (LstWarehouseList != null && LstWarehouseList.Any(i => i.IdArticle == otItem.RevisionItem.WarehouseProduct.IdArticle && (i.IdParent == null || i.IdParent == 0)))
                                    {
                                        otItem.RevisionItem.Status = 100;
                                    }
                                    else
                                    {
                                        otItem.RevisionItem.Status = (Int64)((Math.Abs((double)decomposedOtItems.Sum(y => y.RevisionItem.DownloadedQuantity)) / (double)decomposedOtItems.Sum(y => y.RevisionItem.Quantity)) * 100);
                                    }
                                }
                                otItems.Add(otItem);
                                otItems.AddRange(decomposedOtItems);
                            }
                            else
                            {
                                otItems.Add(otItem);
                            }
                            keyId++;
                            if (otItem.Status.IdItemOtStatus == 1 || otItem.Status.IdItemOtStatus == 2 || otItem.Status.IdItemOtStatus == 12)
                            {
                                var text = otItem.RevisionItem.WarehouseProduct.Article.Reference;
                                List<int> desiredIds = new List<int> { 1, 2, 12 };
                                otItem.StatusList = new List<ItemOTStatusType>();
                                otItem.StatusList = temp.Where(x => desiredIds.Contains(x.IdItemOtStatus)).ToList();
                            }
                            else
                            {
                                otItem.StatusList = new List<ItemOTStatusType>();
                                otItem.StatusList = temp.Where(x => x.IdItemOtStatus == otItem.Status.IdItemOtStatus).ToList();
                            }
                            if (otItem.StatusList?.Count > 1)
                                otItem.ShowCombobox = true;
                            else
                                otItem.ShowCombobox = false;
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetOtItemsByIdOt_V2540(idOt-{0}, idWarehouse-{1}). ErrorMessage- {2}", idOt, idWarehouse, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }

                    if (otItemReader.NextResult())
                    {
                        while (otItemReader.Read())
                        {
                            try
                            {
                                if (otItemReader["IdArticle"] != DBNull.Value)
                                {
                                    foreach (var itemotItem in otItems.Where(ot => ot.RevisionItem.WarehouseProduct.IdArticle == Convert.ToInt64(otItemReader["IdArticle"])))
                                    {
                                        if (otItemReader["ArticleStock"] != DBNull.Value)
                                            itemotItem.ArticleStock = Convert.ToInt64(otItemReader["ArticleStock"]);

                                        if (otItemReader["ArticleMinimumStock"] != DBNull.Value)
                                            itemotItem.ArticleMinimumStock = Convert.ToInt64(otItemReader["ArticleMinimumStock"]);

                                        if (otItemReader["ArticleMaximumStock"] != DBNull.Value)
                                            itemotItem.ArticleMaximumStock = Convert.ToInt64(otItemReader["ArticleMaximumStock"]);
                                    }
                                }
                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetOtItemsByIdOt_V2540(idOt-{0}, idWarehouse-{1}). ErrorMessage- {2}", idOt, idWarehouse, ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }

                    }
                }
            }

            List<int> idList = otItems.Select(item => item.RevisionItem.WarehouseProduct.IdArticle).ToList();
            string idArticleList = string.Join(",", idList);
            forecastList = GetArticleForecastOfTypeOT_V2540(connectionString, idArticleList, idWarehouse);
            foreach (var itemotItem in otItems)
            {
                //itemotItem.ExpectedStock = itemotItem.ArticleStock - forecastList
                //    .Where(x => x.IdArticle == itemotItem.RevisionItem.WarehouseProduct.IdArticle)
                //    ?.Sum(x => x.Quantity) ?? 0;
                itemotItem.ArticleIncoming = forecastList
                  .Where(x => x.Type == "PO" && x.IdArticle == itemotItem.RevisionItem.WarehouseProduct.IdArticle)
                  ?.Sum(x => x.Quantity) ?? 0;
                itemotItem.ArticleOutcoming = forecastList
                  .Where(x => x.Type == "OT" && x.IdArticle == itemotItem.RevisionItem.WarehouseProduct.IdArticle)
                  ?.Sum(x => x.Quantity) ?? 0;
                itemotItem.ExpectedStock = itemotItem.ArticleStock + itemotItem.ArticleIncoming - itemotItem.ArticleOutcoming;//[Sudhir.Jangra][GEOS2-6049]
            }
            return otItems;
        }
		//[nsatpute][26-02-2025][GEOS2-7034]
        private List<OtItem> GetArticlesForDecomposition_V2620(string connectionString, Int64 idOt, Int64 idWarehouse, OtItem parentOtItem, string currencyPath, ref int keyId, List<SRMWarehouseBulkArticle> LstWarehouseList)
        {
            List<OtItem> otItems = new List<OtItem>();
            using (MySqlConnection connOtItem = new MySqlConnection(connectionString))
            {
                connOtItem.Open();

                MySqlCommand otItemCommand = new MySqlCommand("SRM_GetArticlesForDecomposition_V2620", connOtItem);
                otItemCommand.CommandType = CommandType.StoredProcedure;
                otItemCommand.Parameters.AddWithValue("_IdOTitem", parentOtItem.IdOTItem);
                otItemCommand.Parameters.AddWithValue("_IdWarehouse", idWarehouse);
                otItemCommand.CommandTimeout = 8000;

                using (MySqlDataReader otItemReader = otItemCommand.ExecuteReader())
                {
                    while (otItemReader.Read())
                    {
                        try
                        {
                            keyId++;
                            OtItem otItem = new OtItem();
                            otItem.IdOT = idOt;
                            otItem.IdOTItem = Convert.ToInt64(otItemReader["IdOtItem"]);

                            if (otItemReader["IdItemOtStatus"] != DBNull.Value)
                                otItem.IdItemOtStatus = Convert.ToByte(otItemReader["IdItemOtStatus"]);


                            otItem.Rework = Convert.ToByte(otItemReader["Rework"]);

                            if (otItemReader["IdRevisionItem"] != DBNull.Value)
                            {
                                otItem.IdRevisionItem = Convert.ToInt64(otItemReader["IdRevisionItem"]);

                                otItem.RevisionItem = new RevisionItem();
                                otItem.RevisionItem.IdRevisionItem = otItem.IdRevisionItem;
                                otItem.RevisionItem.NumItem = Convert.ToString(otItemReader["NumItem"]);

                                otItem.RevisionItem.WarehouseProduct = new WarehouseProduct();
                                otItem.RevisionItem.WarehouseProduct.IdWarehouseProduct = Convert.ToInt64(otItemReader["IdWarehouseproduct"]);

                                if (otItemReader["IdComponent"] != DBNull.Value)
                                {
                                    otItem.RevisionItem.WarehouseProduct.IdComponent = Convert.ToInt64(otItemReader["IdComponent"]);
                                }
                                otItem.KeyId = keyId;

                                if (otItemReader["parentArticleType"] != DBNull.Value)
                                {
                                    otItem.ParentArticleType = Convert.ToInt64(otItemReader["parentArticleType"]);
                                }

                                if (otItemReader["idParent"] != DBNull.Value)
                                {
                                    otItem.ParentId = Convert.ToInt32(otItemReader["idParent"]);
                                }

                                if (otItem.ParentId == -1)
                                {
                                    otItem.ParentId = parentOtItem.KeyId;
                                    otItem.RevisionItem.Quantity = parentOtItem.RevisionItem.Quantity * Convert.ToDecimal(otItemReader["Quantity"]);
                                    otItem.RevisionItem.RemainingQuantityDecimal = parentOtItem.RevisionItem.Quantity * Convert.ToDecimal(otItemReader["RemainingQty"]);
                                }
                                else
                                {
                                    decimal qty = otItems.First(x => x.RevisionItem.WarehouseProduct.IdComponent == otItem.ParentId).RevisionItem.Quantity;
                                    otItem.RevisionItem.Quantity = qty * Convert.ToDecimal(otItemReader["Quantity"]);
                                    otItem.RevisionItem.RemainingQuantityDecimal = qty * Convert.ToDecimal(otItemReader["RemainingQty"]);
                                    otItem.ParentId = otItems.First(x => x.RevisionItem.WarehouseProduct.IdComponent == otItem.ParentId).KeyId;
                                }
                                if (otItemReader["IdArticle"] != DBNull.Value)
                                {
                                    otItem.RevisionItem.WarehouseProduct.IdArticle = Convert.ToInt32(otItemReader["IdArticle"]);
                                    Article article = new Article();
                                    article.IdArticle = Convert.ToInt32(otItemReader["IdArticle"]);
                                    article.IsGeneric = Convert.ToSByte(otItemReader["IsGeneric"]);
                                    article.Reference = Convert.ToString(otItemReader["Reference"]);
                                    article.IsObsolete = Convert.ToSByte(otItemReader["IsObsolete"]);

                                    if (otItemReader["Description"] != DBNull.Value)
                                        article.Description = Convert.ToString(otItemReader["Description"]);

                                    if (otItemReader["Description_es"] != DBNull.Value)
                                        article.Description_es = Convert.ToString(otItemReader["Description_es"]);

                                    if (otItemReader["Description_fr"] != DBNull.Value)
                                        article.Description_fr = Convert.ToString(otItemReader["Description_fr"]);

                                    article.ImagePath = Convert.ToString(otItemReader["ImagePath"]);
                                    article.RegisterSerialNumber = Convert.ToByte(otItemReader["RegisterSerialNumber"]);

                                    if (otItemReader["Weight"] != DBNull.Value)
                                        article.Weight = Convert.ToDecimal(otItemReader["Weight"]);

                                    if (otItemReader["Location"] != DBNull.Value)
                                        article.Location = Convert.ToString(otItemReader["Location"]);

                                    if (otItemReader["IdArticleType"] != DBNull.Value)
                                        article.IdArticleType = Convert.ToInt64(otItemReader["IdArticleType"]);

                                    otItem.RevisionItem.WarehouseProduct.Article = article;
                                }

                                if (otItemReader["Iditemotstatus"] != DBNull.Value)
                                {
                                    otItem.IdItemOtStatus = Convert.ToByte(otItemReader["Iditemotstatus"]);

                                }
                                Int32? parentidArticle = null;
                                if (otItemReader["parentidArticle"] != DBNull.Value)
                                {
                                    parentidArticle = Convert.ToInt32(otItemReader["parentidArticle"]);
                                }
                                Int32 mainParentIdArticle = 0;
                                if (otItemReader["mainParentIdArticle"] != DBNull.Value)
                                {
                                    mainParentIdArticle = Convert.ToInt32(otItemReader["mainParentIdArticle"]);
                                }

                                int downloaded = GetOtItemDownloadedQuantity_V2540(connectionString, otItem.RevisionItem.WarehouseProduct.Article.IdArticle, otItem.IdOTItem, otItem.RevisionItem.WarehouseProduct.IdComponent, idWarehouse);

                                otItem.RevisionItem.DownloadedQuantity = downloaded;

                                otItem.RevisionItem.RemainingQuantity = ((Int64)otItem.RevisionItem.Quantity - downloaded);

                            }
                            otItems.Add(otItem);

                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetArticlesForDecomposition_V2540(idOt-{0}, idWarehouse-{1}). ErrorMessage- {2}", idOt, idWarehouse, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                    if (otItemReader.NextResult())
                    {

                        while (otItemReader.Read())
                        {
                            try
                            {
                                if (otItemReader["IdArticle"] != DBNull.Value)
                                {
                                    foreach (var itemotItem in otItems.Where(ot => ot.RevisionItem.WarehouseProduct.IdArticle == Convert.ToInt64(otItemReader["IdArticle"])))
                                    {
                                        if (otItemReader["ArticleStock"] != DBNull.Value)
                                            itemotItem.ArticleStock = Convert.ToInt64(otItemReader["ArticleStock"]);

                                        if (otItemReader["ArticleMinimumStock"] != DBNull.Value)
                                            itemotItem.ArticleMinimumStock = Convert.ToInt64(otItemReader["ArticleMinimumStock"]);
                                        if (otItemReader["ArticleMaximumStock"] != DBNull.Value)
                                            itemotItem.ArticleMaximumStock = Convert.ToInt64(otItemReader["ArticleMaximumStock"]);

                                        itemotItem.InternalNotes = Convert.ToString(otItemReader["InternalNotes"]);
                                        if (otItemReader["CostPrice"] != DBNull.Value)
                                            itemotItem.CostPrice = Convert.ToDouble(otItemReader["CostPrice"]);
                                        if (otItemReader["PurchaseQty"] != DBNull.Value)
                                            itemotItem.PurchaseQuantity = Convert.ToInt64(otItemReader["PurchaseQty"]);
                                        if (otItemReader["ForcePurchaseQty"] != DBNull.Value)
                                            itemotItem.ForcePurchaseQuantity = Convert.ToBoolean(otItemReader["ForcePurchaseQty"]);
                                        itemotItem.Currency = new Currency();
                                        if (otItemReader["IdCurrency"] != DBNull.Value)
                                            itemotItem.Currency.IdCurrency = Convert.ToByte(otItemReader["IdCurrency"]);
                                        itemotItem.Currency.Name = Convert.ToString(otItemReader["CurrencyName"]);
                                        if (otItemReader["PackingSize"] != DBNull.Value)
                                            itemotItem.PackingSize = Convert.ToInt32(otItemReader["PackingSize"]);
                                        itemotItem.CurrencyIconBytes = GetCountryIconFileInBytes(Convert.ToString(otItemReader["CurrencyName"]), currencyPath);

                                    }
                                }

                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error GetOtItemsByIdOt_V2540(idOt-{0}, idWarehouse-{1}). ErrorMessage- {2}", idOt, idWarehouse, ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }
                        }
                    }
                }
            }
            return otItems;
        }
		//[nsatpute][26-02-2025][GEOS2-7034]
        public Ots GetPendingReviewByIdOt_V2620(Int64 idOt, Warehouses warehouse, string CurrenciesImages)
        {
            List<SRMWarehouseBulkArticle> LstWarehouseList = GetWarehouseBulkArticle(warehouse);
            string connectionString = warehouse.Company.ConnectPlantConstr;
            Ots ot = null;

            using (MySqlConnection connOT = new MySqlConnection(connectionString))
            {
                connOT.Open();

                MySqlCommand otCommand = new MySqlCommand("SRM_GetMaterialOtInformationByIdOt_V2600", connOT);
                otCommand.CommandType = CommandType.StoredProcedure;
                otCommand.Parameters.AddWithValue("_IdOt", idOt);
                otCommand.CommandTimeout = 8000;
                using (MySqlDataReader otReader = otCommand.ExecuteReader())
                {
                    if (otReader.Read())
                    {
                        try
                        {
                            ot = new Ots();
                            ot.IdOT = idOt;

                            if (otReader["Code"] != DBNull.Value)
                                ot.OfferCode = Convert.ToString(otReader["Code"]);

                            if (otReader["OtCode"] != DBNull.Value)
                                ot.Code = Convert.ToString(otReader["OtCode"]);

                            ot.NumOT = Convert.ToByte(otReader["NumOT"]);

                            if (otReader["Comments"] != DBNull.Value)
                                ot.Comments = Convert.ToString(otReader["Comments"]);

                            if (otReader["CreatedBy"] != DBNull.Value)
                            {
                                ot.CreatedBy = Convert.ToInt32(otReader["CreatedBy"]);

                                ot.CreatedByPerson = new People();
                                ot.CreatedByPerson.IdPerson = ot.CreatedBy;
                                ot.CreatedByPerson.Name = Convert.ToString(otReader["CreatedByName"]);
                                ot.CreatedByPerson.Surname = Convert.ToString(otReader["CreatedBySurname"]);
                            }

                            ot.ReviewedBy = Convert.ToInt32(otReader["ReviewedBy"]);

                            //CreatedBy
                            if (otReader["CreatedBy"] != DBNull.Value)
                            {
                                ot.CreatedBy = Convert.ToInt32(otReader["CreatedBy"]);

                                ot.CreatedByPerson = new People();
                                ot.CreatedByPerson.IdPerson = ot.CreatedBy;
                                ot.CreatedByPerson.Name = Convert.ToString(otReader["CreatedByName"]);
                                ot.CreatedByPerson.Surname = Convert.ToString(otReader["CreatedBySurname"]);
                            }

                            if (otReader["CreationDate"] != DBNull.Value)
                                ot.CreationDate = Convert.ToDateTime(otReader["CreationDate"]);

                            //ModifiedBy
                            if (otReader["ModifiedBy"] != DBNull.Value)
                            {
                                ot.ModifiedBy = Convert.ToInt32(otReader["ModifiedBy"]);

                                ot.ModifiedByPerson = new People();
                                ot.ModifiedByPerson.IdPerson = ot.ModifiedBy;
                                ot.ModifiedByPerson.Name = Convert.ToString(otReader["ModifiedByName"]);
                                ot.ModifiedByPerson.Surname = Convert.ToString(otReader["ModifiedBySurname"]);
                            }

                            if (otReader["ModifiedIn"] != DBNull.Value)
                                ot.ModifiedIn = Convert.ToDateTime(otReader["ModifiedIn"]);

                            if (otReader["DeliveryDate"] != DBNull.Value)
                                ot.DeliveryDate = Convert.ToDateTime(otReader["DeliveryDate"]);

                            if (otReader["WareHouseLockSession"] != DBNull.Value)
                                ot.WareHouseLockSession = Convert.ToString(otReader["WareHouseLockSession"]);

                            if (otReader["AttachedFiles"] != DBNull.Value)
                                ot.AttachedFiles = Convert.ToString(otReader["AttachedFiles"]);

                            if (otReader["IdShippingAddress"] != DBNull.Value)
                                ot.IdShippingAddress = Convert.ToInt64(otReader["IdShippingAddress"]);

                            ot.IdQuotation = Convert.ToInt64(otReader["IdQuotation"]);
                            ot.Quotation = new Quotation();
                            ot.Quotation.Code = Convert.ToString(otReader["QuotationCode"]);

                            if (otReader["Year"] != DBNull.Value)
                                ot.Quotation.Year = Convert.ToInt32(otReader["Year"]);

                            if (otReader["Description"] != DBNull.Value)
                                ot.Quotation.Description = Convert.ToString(otReader["Description"]);

                            if (otReader["ProjectName"] != DBNull.Value)
                                ot.Quotation.ProjectName = Convert.ToString(otReader["ProjectName"]);


                            if (otReader["ProjectName"] != DBNull.Value)
                                ot.Quotation.ProjectName = Convert.ToString(otReader["ProjectName"]);

                            //Customer
                            if (otReader["IdSite"] != DBNull.Value)
                            {
                                ot.Quotation.Site = new Company();
                                ot.Quotation.Site.IdCompany = Convert.ToInt32(otReader["IdSite"]);
                                ot.Quotation.Site.SiteNameWithoutCountry = Convert.ToString(otReader["SiteName"]);

                                if (otReader["ShortName"] != DBNull.Value && !string.IsNullOrEmpty(Convert.ToString(otReader["ShortName"])))
                                {
                                    ot.Quotation.Site.Name = Convert.ToString(otReader["ShortName"]);
                                }
                                else
                                {
                                    ot.Quotation.Site.Name = Convert.ToString(otReader["Customer"]);
                                }

                                if (otReader["idCountry"] != DBNull.Value)
                                {
                                    ot.Quotation.Site.IdCountry = Convert.ToByte(otReader["idCountry"]);
                                    ot.Quotation.Site.Country = new Country();
                                    ot.Quotation.Site.Country.IdCountry = Convert.ToByte(otReader["idCountry"]);
                                    ot.Quotation.Site.Country.Name = otReader["CountryName"].ToString();
                                    ot.Quotation.Site.Country.Iso = otReader["iso"].ToString();

                                    if (otReader["EuroZone"] != DBNull.Value)
                                    {
                                        ot.Quotation.Site.Country.EuroZone = Convert.ToSByte(otReader["EuroZone"]);
                                    }

                                    if (otReader["IdCountryGroup"] != DBNull.Value)
                                    {
                                        ot.Quotation.Site.CountryGroup = new CountryGroup();
                                        ot.Quotation.Site.CountryGroup.IdCountryGroup = Convert.ToInt64(otReader["IdCountryGroup"]);

                                        if (otReader["CountryGroup"] != DBNull.Value)
                                            ot.Quotation.Site.CountryGroup.Name = Convert.ToString(otReader["CountryGroup"]);

                                        if (otReader["IsFreeTrade"] != DBNull.Value)
                                            ot.Quotation.Site.CountryGroup.IsFreeTrade = Convert.ToByte(otReader["IsFreeTrade"]);
                                    }
                                }

                                ot.Quotation.Site.Customer = new Customer();
                                ot.Quotation.Site.Customer.IdCustomer = Convert.ToInt32(otReader["IdCustomer"]);
                                ot.Quotation.Site.Customer.CustomerName = Convert.ToString(otReader["CustomerName"]);
                            }
                            if (otReader["IdTemplate"] != DBNull.Value)
                            {
                                ot.Quotation.Template = new Template();
                                ot.Quotation.Template.IdTemplate = Convert.ToByte(otReader["IdTemplate"]);
                                ot.Quotation.Template.Name = Convert.ToString(otReader["Template"]);
                                ot.Quotation.Template.Type = Convert.ToInt64(otReader["IdTemplateType"]);
                            }

                            if (otReader["IdOffer"] != DBNull.Value)
                            {
                                ot.Quotation.IdOffer = Convert.ToInt32(otReader["IdOffer"]);

                                ot.Quotation.Offer = new Offer();
                                ot.Quotation.Offer.Description = Convert.ToString(otReader["Description"]);

                                if (otReader["IdOfferType"] != DBNull.Value)
                                {
                                    ot.Quotation.Offer.IdOfferType = Convert.ToByte(otReader["IdOfferType"]);

                                    ot.Quotation.Offer.OfferType = new OfferType();
                                    ot.Quotation.Offer.OfferType.IdOfferType = Convert.ToByte(ot.Quotation.Offer.IdOfferType);
                                    ot.Quotation.Offer.OfferType.Name = Convert.ToString(otReader["OfferType"]);
                                }


                                if (otReader["IdCarriageMethod"] != DBNull.Value)
                                {
                                    ot.Quotation.Offer.IdCarriageMethod = Convert.ToByte(otReader["IdCarriageMethod"]);
                                    LookupValue carriage = new LookupValue();
                                    carriage.IdLookupValue = Convert.ToInt32(ot.Quotation.Offer.IdCarriageMethod);
                                    carriage.Value = Convert.ToString(otReader["CarriageValue"]);
                                    carriage.IdImage = Convert.ToInt64(otReader["CarriageImage"]);

                                    ot.Quotation.Offer.CarriageMethod = carriage;
                                }

                                if (otReader["PODate"] != DBNull.Value)
                                    ot.Quotation.Offer.POReceivedInDate = Convert.ToDateTime(otReader["PODate"]);

                                if (otReader["IdWorkflowStatus"] != DBNull.Value)
                                    ot.IdWorkflowStatus = Convert.ToByte(otReader["IdWorkflowStatus"]);

                                if (otReader["ProducerIdCountryGroup"] != DBNull.Value)
                                {
                                    ot.ProducerIdCountryGroup = Convert.ToInt64(otReader["ProducerIdCountryGroup"]);
                                    ot.CountryGroup = new CountryGroup();
                                    ot.CountryGroup.IdCountryGroup = Convert.ToInt64(otReader["ProducerIdCountryGroup"]);
                                    ot.CountryGroup.Name = Convert.ToString(otReader["ProducerCountryGroup"]);
                                    ot.CountryGroup.HtmlColor = Convert.ToString(otReader["ProducerCountryGroupColor"]);
                                }

                                if (otReader["PoNumberForReport"] != DBNull.Value)
                                {
                                    ot.PoCode = Convert.ToString(otReader["PoNumberForReport"]);
                                }

                                if (otReader["PoDateForReport"] != DBNull.Value)
                                {
                                    ot.PoDate = Convert.ToDateTime(otReader["PoDateForReport"]);
                                }

                                if (otReader["OfferOwner"] != DBNull.Value)
                                {
                                    ot.OfferOwner = Convert.ToString(otReader["OfferOwner"]);
                                }

                                if (otReader["CustomerNameForReport"] != DBNull.Value)
                                {
                                    ot.CustomerNameForReport = Convert.ToString(otReader["CustomerNameForReport"]);
                                }
                                if (otReader["idCurrency"] != DBNull.Value)
                                {
                                    ot.IdCurrency = Convert.ToByte(otReader["idCurrency"]);
                                    ot.Currency = new Currency();
                                    ot.Currency.IdCurrency = Convert.ToByte(otReader["idCurrency"]);
                                    ot.Currency.Symbol = Convert.ToString(otReader["CurrencySymbol"]);
                                }
                            }
                            ot.OtItems = GetOtItemsByIdOt_V2620(connectionString, idOt, warehouse.IdWarehouse, LstWarehouseList, CurrenciesImages);// [nsatpute][13-01-2025][GEOS2-6443]             
                            // [nsatpute][13-01-2025][GEOS2-6443]
                            ot.ArticleStocks = new List<ArticlesStock>();
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetPendingReviewByIdOt_V2600(idOt-{0}, idWarehouse-{1}). ErrorMessage- {2} ", idOt, warehouse.IdWarehouse, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }
            return ot;
        }

        // [pallavi.kale][04-03-2025][GEOS2-7012]
        public List<WarehousePurchaseOrder> GetPendingPurchaseOrdersByWarehouse_V2620(long idWarehouse, string connectionstring, string countryIconFilePath, string currenciesIconFilePath, string connectionStringWorkbench)
        {
            // string connectionString = warehouse.Company.ConnectPlantConstr;
            List<WarehousePurchaseOrder> warehousePurchaseOrders = new List<WarehousePurchaseOrder>();
            List<string> countryISOs = new List<string>();
            List<string> currencyISOs = new List<string>();
            List<long> orderid = new List<long>();
            Dictionary<string, List<long>> SupplierEmailId = new Dictionary<string, List<long>>();
            List<string> Suppliername = new List<string>();

            List<WorkflowStatus> LstWorkflowStatus = GetAllWorkflowStatus_V2301(connectionStringWorkbench);
            List<WorkflowTransition> LstWorkflowStatusTransitions = GetAllWorkflowTransitions_V2301(connectionStringWorkbench);
            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionstring))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetPendingPurchaseOrdersByWarehouse_V2510", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdWarehouse", idWarehouse);
                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    double totalQuantity = 0;
                    double receivedQuantity = 0;
                    while (mySqlDataReader.Read())
                    {
                        try
                        {
                            totalQuantity = 0;
                            receivedQuantity = 0;
                            WarehousePurchaseOrder warehousePurchaseOrder = new WarehousePurchaseOrder();
                            try
                            {
                                warehousePurchaseOrder.IdWarehousePurchaseOrder = Convert.ToInt64(mySqlDataReader["idWarehousepurchaseorder"]);
                                if (mySqlDataReader["Code"] != DBNull.Value)
                                    warehousePurchaseOrder.Code = Convert.ToString(mySqlDataReader["Code"]);
                                if (mySqlDataReader["IdArticleSupplier"] != DBNull.Value)
                                {
                                    ArticleSupplier articleSupplier = new ArticleSupplier();
                                    articleSupplier.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);
                                    if (mySqlDataReader["Supplier"] != DBNull.Value)
                                        articleSupplier.Name = Convert.ToString(mySqlDataReader["Supplier"]);
                                    if (mySqlDataReader["IdCountry"] != DBNull.Value)
                                    {
                                        articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["IdCountry"]);
                                        articleSupplier.Country = new Country();
                                        articleSupplier.Country.IdCountry = Convert.ToByte(mySqlDataReader["IdCountry"]);
                                        articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);
                                        if (mySqlDataReader["CountryISO"] != DBNull.Value)
                                        {
                                            articleSupplier.Country.Iso = Convert.ToString(mySqlDataReader["CountryISO"]);
                                            articleSupplier.Country.CountryIconUrl = "https://api.emdep.com/GEOS/Images?FilePath=/Images/Countries/" + articleSupplier.Country.Iso + ".png";
                                            //if (!countryISOs.Any(co => co.ToString() == articleSupplier.Country.Iso))
                                            //{
                                            //    countryISOs.Add(articleSupplier.Country.Iso);
                                            //}
                                        }
                                    }
                                    if (mySqlDataReader["SupplierContactPerson"] != DBNull.Value)
                                        articleSupplier.ContactPerson = Convert.ToString(mySqlDataReader["SupplierContactPerson"]);
                                    if (mySqlDataReader["SupplierContactEmail"] != DBNull.Value)
                                        articleSupplier.ContactEmail = Convert.ToString(mySqlDataReader["SupplierContactEmail"]);
                                    warehousePurchaseOrder.ArticleSupplier = articleSupplier;
                                }
                                //[rdixit][GEOS2-4455][19.06.2023]
                                //if (mySqlDataReader["DeliveryDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["deliveryDate"]) != DateTime.MinValue)
                                //{
                                //warehousePurchaseOrder.DeliveryDate = Convert.ToDateTime(mySqlDataReader["deliveryDate"]);
                                //warehousePurchaseOrder.Delay = (int)(warehousePurchaseOrder.DeliveryDate.Value.Date - DateTime.Now.Date).TotalDays;
                                //}

                                //Shubham[skadam]  GEOS2-4713 Missing Delivery Dates 31 07 2023 
                                if (mySqlDataReader["PODeliveryDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["PODeliveryDate"]) != DateTime.MinValue)
                                {
                                    warehousePurchaseOrder.PODeliveryDate = Convert.ToDateTime(mySqlDataReader["PODeliveryDate"]);
                                }
                                if (mySqlDataReader["AttachedPO"] != DBNull.Value)
                                    warehousePurchaseOrder.AttachedPO = Convert.ToByte(mySqlDataReader["AttachedPO"]);
                                if (mySqlDataReader["Deliveries"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.Deliveries = Convert.ToInt32(mySqlDataReader["Deliveries"]);
                                    if (warehousePurchaseOrder.Deliveries > 0)
                                    {
                                        warehousePurchaseOrder.IsPartialPending = true;
                                    }
                                }
                                if (mySqlDataReader["LatestDeliveryDate"] != DBNull.Value)
                                    warehousePurchaseOrder.LatestDeliveryDate = Convert.ToDateTime(mySqlDataReader["LatestDeliveryDate"]);
                                if (mySqlDataReader["IdWarehouse"] != DBNull.Value)
                                    warehousePurchaseOrder.IdWarehouse = Convert.ToInt64(mySqlDataReader["IdWarehouse"]);
                                if (mySqlDataReader["OrderQty"] != DBNull.Value)
                                    totalQuantity = Convert.ToDouble(mySqlDataReader["OrderQty"]);
                                if (mySqlDataReader["ReceivedQuantity"] != DBNull.Value)
                                    receivedQuantity = Convert.ToDouble(mySqlDataReader["ReceivedQuantity"]);
                                if (totalQuantity > 0)
                                    warehousePurchaseOrder.Status = (Int16)((receivedQuantity / totalQuantity) * 100);
                                if (mySqlDataReader["TotalAmount"] != DBNull.Value)
                                    warehousePurchaseOrder.TotalAmount = Convert.ToDecimal(mySqlDataReader["TotalAmount"]);
                                if (mySqlDataReader["CreatedIn"] != DBNull.Value)
                                    warehousePurchaseOrder.CreatedIn = Convert.ToDateTime(mySqlDataReader["CreatedIn"]);
                                if (mySqlDataReader["AttachPdf"] != DBNull.Value)
                                    warehousePurchaseOrder.AttachPdf = Convert.ToString(mySqlDataReader["AttachPdf"]);
                                if (mySqlDataReader["idCurrency"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.IdCurrency = Convert.ToByte(mySqlDataReader["idCurrency"]);
                                    warehousePurchaseOrder.Currency = new Currency();
                                    warehousePurchaseOrder.Currency.IdCurrency = Convert.ToByte(mySqlDataReader["idCurrency"]);
                                    warehousePurchaseOrder.Currency.Name = Convert.ToString(mySqlDataReader["CurrencyName"]);
                                    warehousePurchaseOrder.Currency.Symbol = Convert.ToString(mySqlDataReader["CurrencySymbol"]);
                                    // [pallavi.kale][04-03-2025][GEOS2-7012]
                                    if (warehousePurchaseOrder.Currency.Name != null)
                                    {
                                        if (!currencyISOs.Any(co => co.ToString() == warehousePurchaseOrder.Currency.Name))
                                        {
                                            currencyISOs.Add(warehousePurchaseOrder.Currency.Name);
                                        }
                                    }

                                }
                               
                                if (mySqlDataReader["IdWorkflowStatus"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                    warehousePurchaseOrder.WorkflowStatus = new WorkflowStatus();
                                    warehousePurchaseOrder.WorkflowStatus.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                    warehousePurchaseOrder.WorkflowStatus.Name = Convert.ToString(mySqlDataReader["Status"]);
                                    warehousePurchaseOrder.WorkflowStatus.HtmlColor = Convert.ToString(mySqlDataReader["HtmlColor"]);


                                    //[pramod.misal][GEOS2-4448][06-07-2023]
                                    if (mySqlDataReader["SortOrder"] != DBNull.Value)
                                    {
                                        warehousePurchaseOrder.WorkflowStatus.SortOrder = Convert.ToInt32(mySqlDataReader["SortOrder"]);
                                    }

                                }
                                if (mySqlDataReader["AssigneeEmail"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.AssigneeEmail = Convert.ToString(mySqlDataReader["AssigneeEmail"]);
                                }
                                if (mySqlDataReader["CreatorEmail"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.CreatorEmail = Convert.ToString(mySqlDataReader["CreatorEmail"]);
                                }

                                if (mySqlDataReader["ReminderEmailDate"] != DBNull.Value)
                                    warehousePurchaseOrder.ReminderEmailDate = Convert.ToDateTime(mySqlDataReader["ReminderEmailDate"]);

                                if (mySqlDataReader["WarehouseName"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.WarehouseName = Convert.ToString(mySqlDataReader["WarehouseName"]);
                                }


                                warehousePurchaseOrder.LstWorkflowStatus = LstWorkflowStatus;
                                List<byte> GetCurrentButtons = LstWorkflowStatusTransitions.Where(a => a.IdWorkflowStatusFrom == warehousePurchaseOrder.IdWorkflowStatus).Select(a => a.IdWorkflowStatusTo).Distinct().ToList();
                                warehousePurchaseOrder.LstWorkflowStatusTransition = new List<WorkflowStatus>();
                                warehousePurchaseOrder.LstWorkflowStatusTransition.Add(warehousePurchaseOrder.LstWorkflowStatus.FirstOrDefault(a => a.IdWorkflowStatus == warehousePurchaseOrder.IdWorkflowStatus));
                                foreach (byte statusbutton in GetCurrentButtons)
                                {
                                    warehousePurchaseOrder.LstWorkflowStatusTransition.Add(warehousePurchaseOrder.LstWorkflowStatus.FirstOrDefault(a => a.IdWorkflowStatus == statusbutton));
                                }
                            }
                            catch (Exception ex)
                            {
                            }
                            warehousePurchaseOrder.LstAllWorkflowStatusTransitions = LstWorkflowStatusTransitions;
                            warehousePurchaseOrders.Add(warehousePurchaseOrder);

                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetPendingPurchaseOrdersByWarehouse_V2620(). ErrorMessage-" + ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                    #region 2nd ResultSet [rdixit][GEOS2-4455][19.06.2023] 
                    if (mySqlDataReader.NextResult())
                    {
                        while (mySqlDataReader.Read())
                        {
                            if (mySqlDataReader["idWarehousePurchaseOrder"] != DBNull.Value)
                            {
                                WarehousePurchaseOrderItem OrderItem = new WarehousePurchaseOrderItem();

                                WarehousePurchaseOrder Order = warehousePurchaseOrders.FirstOrDefault(i => i.IdWarehousePurchaseOrder == Convert.ToInt64(mySqlDataReader["idWarehousePurchaseOrder"]));

                                if (Order != null)
                                {
                                    if (Order.WarehousePurchaseOrderItems == null)
                                    {
                                        Order.WarehousePurchaseOrderItems = new List<WarehousePurchaseOrderItem>();
                                    }
                                    if (mySqlDataReader["idWarehousePurchaseOrder"] != DBNull.Value)
                                        OrderItem.IdWarehousePurchaseOrder = Convert.ToInt64(mySqlDataReader["idWarehousePurchaseOrder"]);
                                    if (mySqlDataReader["IdWarehousePurchaseOrderItem"] != DBNull.Value)
                                        OrderItem.IdWarehousePurchaseOrderItem = Convert.ToInt64(mySqlDataReader["IdWarehousePurchaseOrderItem"]);
                                    if (mySqlDataReader["Quantity"] != DBNull.Value)
                                        OrderItem.Quantity = Convert.ToDouble(mySqlDataReader["Quantity"]);
                                    if (mySqlDataReader["AlbaranQty"] != DBNull.Value)
                                        OrderItem.ReceivedQuantity = Convert.ToDouble(mySqlDataReader["AlbaranQty"]);
                                    if (OrderItem.Quantity > 0)
                                        OrderItem.Status = (Int32)(OrderItem.ReceivedQuantity / OrderItem.Quantity * 100);
                                    Order.WarehousePurchaseOrderItems.Add(OrderItem);
                                }
                            }
                        }
                    }
                    #endregion
                    #region 3nd ResultSet [rdixit][GEOS2-4455][19.06.2023] 
                    if (mySqlDataReader.NextResult())
                    {
                        while (mySqlDataReader.Read())
                        {
                            if (mySqlDataReader["IdWarehousePurchaseOrderItem"] != DBNull.Value)
                            {
                                WarehousePurchaseOrderExpectedItem OrderExpectedItem = new WarehousePurchaseOrderExpectedItem();

                                WarehousePurchaseOrderItem OrderItem = warehousePurchaseOrders.Where(o => o.WarehousePurchaseOrderItems != null)
                                                                        .SelectMany(order => order.WarehousePurchaseOrderItems)
                                                                        .FirstOrDefault(item => item.IdWarehousePurchaseOrderItem == Convert.ToInt64(mySqlDataReader["IdWarehousePurchaseOrderItem"]));
                                if (OrderItem != null)
                                {
                                    if (OrderItem.WarehousePurchaseOrderExpectedItems == null)
                                    {
                                        OrderItem.WarehousePurchaseOrderExpectedItems = new List<WarehousePurchaseOrderExpectedItem>();
                                    }
                                    if (mySqlDataReader["IdWarehousePurchaseOrderItem"] != DBNull.Value)
                                        OrderExpectedItem.IdWarehousePurchaseOrderItem = Convert.ToInt64(mySqlDataReader["IdWarehousePurchaseOrderItem"]);
                                    if (mySqlDataReader["Quantity"] != DBNull.Value)
                                        OrderExpectedItem.Quantity = (long)Convert.ToDouble(mySqlDataReader["Quantity"]);
                                    if (mySqlDataReader["Date"] != DBNull.Value)
                                        OrderExpectedItem.Date = Convert.ToDateTime(mySqlDataReader["Date"]);

                                    OrderItem.WarehousePurchaseOrderExpectedItems.Add(OrderExpectedItem);
                                }
                            }
                        }
                    }
                    #endregion
                }
            }
            #region 2nd ResultSet [rdixit][GEOS2-4455][19.06.2023] 
            foreach (WarehousePurchaseOrder Order in warehousePurchaseOrders)
            {
                List<DateTime> ItemDates = new List<DateTime>();
                if (Order.WarehousePurchaseOrderItems != null)
                {
                    if (Order.WarehousePurchaseOrderItems.Where(i => i.Status < 100) != null)
                    {
                        if (Order.WarehousePurchaseOrderItems.Where(i => i.Status < 100).ToList().Count > 0)
                        {
                            foreach (WarehousePurchaseOrderItem OrderItem in Order.WarehousePurchaseOrderItems.Where(i => i.Status != 100))
                            {
                                if (OrderItem.WarehousePurchaseOrderExpectedItems != null)
                                {
                                    if (OrderItem.WarehousePurchaseOrderExpectedItems.Count > 0)
                                        ItemDates.Add(OrderItem.WarehousePurchaseOrderExpectedItems.FirstOrDefault().Date);
                                }
                            }
                        }
                    }
                }
                //if (Order.Code== "N24080531")
                //{
                //}
                //if (Order.Code == "N25000047")
                //{
                //}
                try
                {
                    //Shubham[skadam] GEOS2-7998 PO reminder Mail not send  09 05 2025
                    if (ItemDates.Count != 0)
                    {
                        Order.PODeliveryDate = ItemDates.Min(d => d.Date).Date;
                    }
                    if (Order.PODeliveryDate != null)
                    {
                        Order.Delay = (int)(Order.PODeliveryDate.Value.Date - DateTime.Now.Date).TotalDays;
                        if (!string.IsNullOrEmpty(Order.ArticleSupplier.ContactEmail))
                        {
                            if (Order.ReminderEmailDate == DateTime.MinValue || Order.ReminderEmailDate == null)
                            {
                                Order.ReminderEmailDate = Order.PODeliveryDate.Value.AddDays(1);
                            }
                            DateTime dtRm = new DateTime(Order.ReminderEmailDate.Value.Year, Order.ReminderEmailDate.Value.Month, Order.ReminderEmailDate.Value.Day);
                            DateTime dtNow = new DateTime(DateTime.Now.Year, DateTime.Now.Month, DateTime.Now.Day);
                            if (dtRm <= dtNow)
                            {
                                orderid = new List<long>();
                                orderid.Add(Order.IdWarehousePurchaseOrder);
                                if (!SupplierEmailId.ContainsKey(Order.ArticleSupplier.ContactEmail))
                                {
                                    SupplierEmailId.Add(Order.ArticleSupplier.ContactEmail, orderid);
                                }
                                else
                                {
                                    SupplierEmailId[Order.ArticleSupplier.ContactEmail].Add(Order.IdWarehousePurchaseOrder);
                                }
                            }
                        }
                        else
                        {
                            if (!Suppliername.Contains(Order.ArticleSupplier.Name))
                            {
                                Suppliername.Add(Order.ArticleSupplier.Name);
                            }
                        }
                    }
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error GetPendingPurchaseOrdersByWarehouse_V2620, ErrorMessage- {0} ", ex.Message), category: Category.Exception, priority: Priority.Low);
                }
                //}
            }
            #endregion
            #region GEOS2-4713
            //Shubham[skadam]  GEOS2-4713 Missing Delivery Dates 31 07 2023 
            foreach (var item in warehousePurchaseOrders.Where(w => w.DeliveryDate == null || w.DeliveryDate == DateTime.MinValue))
            {
                if (!string.IsNullOrEmpty(item.PODeliveryDate.ToString()))
                {
                    item.DeliveryDate = item.PODeliveryDate;
                    item.Delay = (int)(item.DeliveryDate.Value.Date - DateTime.Now.Date).TotalDays;
                }
            }
            #endregion
            //foreach (string item in countryISOs)
            //{
            //    byte[] bytes = null;
            //    bytes = GetCountryIconFileInBytes(item, countryIconFilePath);
            //    warehousePurchaseOrders.Where(wp => wp.ArticleSupplier.Country.Iso == item).ToList().ForEach(wp => wp.ArticleSupplier.Country.CountryIconBytes = bytes);
            //}
            if (warehousePurchaseOrders.Count > 0)
            {
                warehousePurchaseOrders.FirstOrDefault().SupplierEmailId = SupplierEmailId;
                warehousePurchaseOrders.FirstOrDefault().Suppliername = Suppliername;
            }
            // [pallavi.kale][04-03-2025][GEOS2-7012]
            foreach (string item in currencyISOs)
            {
                byte[] bytes = null;
                bytes = GetCountryIconFileInBytes(item, currenciesIconFilePath);
                warehousePurchaseOrders.Where(wp => wp.Currency.Name == item).ToList().ForEach(wp => wp.Currency.CurrencyIconbytes = bytes);
            }
            return warehousePurchaseOrders;
        }


        // [pallavi.kale][04-03-2025][GEOS2-7012]
        //Shubham[skadam] GEOS2-8262 PO reminder Mail send to whom 29 05 2025
        public List<WarehousePurchaseOrder> GetPendingPurchaseOrdersByWarehouse_V2650(long idWarehouse, string connectionstring, string countryIconFilePath, string currenciesIconFilePath, string connectionStringWorkbench)
        {
            // string connectionString = warehouse.Company.ConnectPlantConstr;
            List<WarehousePurchaseOrder> warehousePurchaseOrders = new List<WarehousePurchaseOrder>();
            List<string> countryISOs = new List<string>();
            List<string> currencyISOs = new List<string>();
            List<long> orderid = new List<long>();
            Dictionary<string, List<long>> SupplierEmailId = new Dictionary<string, List<long>>();
            List<string> Suppliername = new List<string>();

            List<WorkflowStatus> LstWorkflowStatus = GetAllWorkflowStatus_V2301(connectionStringWorkbench);
            List<WorkflowTransition> LstWorkflowStatusTransitions = GetAllWorkflowTransitions_V2301(connectionStringWorkbench);
            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionstring))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetPendingPurchaseOrdersByWarehouse_V2650", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdWarehouse", idWarehouse);
                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    double totalQuantity = 0;
                    double receivedQuantity = 0;
                    while (mySqlDataReader.Read())
                    {
                        try
                        {
                            totalQuantity = 0;
                            receivedQuantity = 0;
                            WarehousePurchaseOrder warehousePurchaseOrder = new WarehousePurchaseOrder();
                            try
                            {
                                warehousePurchaseOrder.IdWarehousePurchaseOrder = Convert.ToInt64(mySqlDataReader["idWarehousepurchaseorder"]);
                                if (mySqlDataReader["Code"] != DBNull.Value)
                                    warehousePurchaseOrder.Code = Convert.ToString(mySqlDataReader["Code"]);
                                if (mySqlDataReader["IdArticleSupplier"] != DBNull.Value)
                                {
                                    ArticleSupplier articleSupplier = new ArticleSupplier();
                                    articleSupplier.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);
                                    if (mySqlDataReader["Supplier"] != DBNull.Value)
                                        articleSupplier.Name = Convert.ToString(mySqlDataReader["Supplier"]);
                                    if (mySqlDataReader["IdCountry"] != DBNull.Value)
                                    {
                                        articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["IdCountry"]);
                                        articleSupplier.Country = new Country();
                                        articleSupplier.Country.IdCountry = Convert.ToByte(mySqlDataReader["IdCountry"]);
                                        articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);
                                        if (mySqlDataReader["CountryISO"] != DBNull.Value)
                                        {
                                            articleSupplier.Country.Iso = Convert.ToString(mySqlDataReader["CountryISO"]);
                                            articleSupplier.Country.CountryIconUrl = "https://api.emdep.com/GEOS/Images?FilePath=/Images/Countries/" + articleSupplier.Country.Iso + ".png";
                                            //if (!countryISOs.Any(co => co.ToString() == articleSupplier.Country.Iso))
                                            //{
                                            //    countryISOs.Add(articleSupplier.Country.Iso);
                                            //}
                                        }
                                    }
                                    if (warehousePurchaseOrder.IdWarehousePurchaseOrder == 58742)
                                    {

                                    }
                                    if (mySqlDataReader["SupplierContactPerson"] != DBNull.Value)
                                        articleSupplier.ContactPerson = Convert.ToString(mySqlDataReader["SupplierContactPerson"]);
                                    if (mySqlDataReader["SupplierContactEmail"] != DBNull.Value)
                                        articleSupplier.ContactEmail = Convert.ToString(mySqlDataReader["SupplierContactEmail"]);
                                    warehousePurchaseOrder.ArticleSupplier = articleSupplier;
                                }
                                //[rdixit][GEOS2-4455][19.06.2023]
                                //if (mySqlDataReader["DeliveryDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["deliveryDate"]) != DateTime.MinValue)
                                //{
                                //warehousePurchaseOrder.DeliveryDate = Convert.ToDateTime(mySqlDataReader["deliveryDate"]);
                                //warehousePurchaseOrder.Delay = (int)(warehousePurchaseOrder.DeliveryDate.Value.Date - DateTime.Now.Date).TotalDays;
                                //}

                                //Shubham[skadam]  GEOS2-4713 Missing Delivery Dates 31 07 2023 
                                if (mySqlDataReader["PODeliveryDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["PODeliveryDate"]) != DateTime.MinValue)
                                {
                                    warehousePurchaseOrder.PODeliveryDate = Convert.ToDateTime(mySqlDataReader["PODeliveryDate"]);
                                }
                                if (mySqlDataReader["AttachedPO"] != DBNull.Value)
                                    warehousePurchaseOrder.AttachedPO = Convert.ToByte(mySqlDataReader["AttachedPO"]);
                                if (mySqlDataReader["Deliveries"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.Deliveries = Convert.ToInt32(mySqlDataReader["Deliveries"]);
                                    if (warehousePurchaseOrder.Deliveries > 0)
                                    {
                                        warehousePurchaseOrder.IsPartialPending = true;
                                    }
                                }
                                if (mySqlDataReader["LatestDeliveryDate"] != DBNull.Value)
                                    warehousePurchaseOrder.LatestDeliveryDate = Convert.ToDateTime(mySqlDataReader["LatestDeliveryDate"]);
                                if (mySqlDataReader["IdWarehouse"] != DBNull.Value)
                                    warehousePurchaseOrder.IdWarehouse = Convert.ToInt64(mySqlDataReader["IdWarehouse"]);
                                if (mySqlDataReader["OrderQty"] != DBNull.Value)
                                    totalQuantity = Convert.ToDouble(mySqlDataReader["OrderQty"]);
                                if (mySqlDataReader["ReceivedQuantity"] != DBNull.Value)
                                    receivedQuantity = Convert.ToDouble(mySqlDataReader["ReceivedQuantity"]);
                                if (totalQuantity > 0)
                                    warehousePurchaseOrder.Status = (Int16)((receivedQuantity / totalQuantity) * 100);
                                if (mySqlDataReader["TotalAmount"] != DBNull.Value)
                                    warehousePurchaseOrder.TotalAmount = Convert.ToDecimal(mySqlDataReader["TotalAmount"]);
                                if (mySqlDataReader["CreatedIn"] != DBNull.Value)
                                    warehousePurchaseOrder.CreatedIn = Convert.ToDateTime(mySqlDataReader["CreatedIn"]);
                                if (mySqlDataReader["AttachPdf"] != DBNull.Value)
                                    warehousePurchaseOrder.AttachPdf = Convert.ToString(mySqlDataReader["AttachPdf"]);
                                if (mySqlDataReader["idCurrency"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.IdCurrency = Convert.ToByte(mySqlDataReader["idCurrency"]);
                                    warehousePurchaseOrder.Currency = new Currency();
                                    warehousePurchaseOrder.Currency.IdCurrency = Convert.ToByte(mySqlDataReader["idCurrency"]);
                                    warehousePurchaseOrder.Currency.Name = Convert.ToString(mySqlDataReader["CurrencyName"]);
                                    warehousePurchaseOrder.Currency.Symbol = Convert.ToString(mySqlDataReader["CurrencySymbol"]);
                                    // [pallavi.kale][04-03-2025][GEOS2-7012]
                                    if (warehousePurchaseOrder.Currency.Name != null)
                                    {
                                        if (!currencyISOs.Any(co => co.ToString() == warehousePurchaseOrder.Currency.Name))
                                        {
                                            currencyISOs.Add(warehousePurchaseOrder.Currency.Name);
                                        }
                                    }

                                }

                                if (mySqlDataReader["IdWorkflowStatus"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                    warehousePurchaseOrder.WorkflowStatus = new WorkflowStatus();
                                    warehousePurchaseOrder.WorkflowStatus.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                    warehousePurchaseOrder.WorkflowStatus.Name = Convert.ToString(mySqlDataReader["Status"]);
                                    warehousePurchaseOrder.WorkflowStatus.HtmlColor = Convert.ToString(mySqlDataReader["HtmlColor"]);


                                    //[pramod.misal][GEOS2-4448][06-07-2023]
                                    if (mySqlDataReader["SortOrder"] != DBNull.Value)
                                    {
                                        warehousePurchaseOrder.WorkflowStatus.SortOrder = Convert.ToInt32(mySqlDataReader["SortOrder"]);
                                    }

                                }
                                if (mySqlDataReader["AssigneeEmail"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.AssigneeEmail = Convert.ToString(mySqlDataReader["AssigneeEmail"]);
                                }
                                if (mySqlDataReader["CreatorEmail"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.CreatorEmail = Convert.ToString(mySqlDataReader["CreatorEmail"]);
                                }

                                if (mySqlDataReader["ReminderEmailDate"] != DBNull.Value)
                                    warehousePurchaseOrder.ReminderEmailDate = Convert.ToDateTime(mySqlDataReader["ReminderEmailDate"]);

                                if (mySqlDataReader["WarehouseName"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.WarehouseName = Convert.ToString(mySqlDataReader["WarehouseName"]);
                                }


                                warehousePurchaseOrder.LstWorkflowStatus = LstWorkflowStatus;
                                List<byte> GetCurrentButtons = LstWorkflowStatusTransitions.Where(a => a.IdWorkflowStatusFrom == warehousePurchaseOrder.IdWorkflowStatus).Select(a => a.IdWorkflowStatusTo).Distinct().ToList();
                                warehousePurchaseOrder.LstWorkflowStatusTransition = new List<WorkflowStatus>();
                                warehousePurchaseOrder.LstWorkflowStatusTransition.Add(warehousePurchaseOrder.LstWorkflowStatus.FirstOrDefault(a => a.IdWorkflowStatus == warehousePurchaseOrder.IdWorkflowStatus));
                                foreach (byte statusbutton in GetCurrentButtons)
                                {
                                    warehousePurchaseOrder.LstWorkflowStatusTransition.Add(warehousePurchaseOrder.LstWorkflowStatus.FirstOrDefault(a => a.IdWorkflowStatus == statusbutton));
                                }
                            }
                            catch (Exception ex)
                            {
                            }
                            warehousePurchaseOrder.LstAllWorkflowStatusTransitions = LstWorkflowStatusTransitions;
                            warehousePurchaseOrders.Add(warehousePurchaseOrder);

                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetPendingPurchaseOrdersByWarehouse_V2620(). ErrorMessage-" + ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                    #region 2nd ResultSet [rdixit][GEOS2-4455][19.06.2023] 
                    if (mySqlDataReader.NextResult())
                    {
                        while (mySqlDataReader.Read())
                        {
                            if (mySqlDataReader["idWarehousePurchaseOrder"] != DBNull.Value)
                            {
                                WarehousePurchaseOrderItem OrderItem = new WarehousePurchaseOrderItem();

                                WarehousePurchaseOrder Order = warehousePurchaseOrders.FirstOrDefault(i => i.IdWarehousePurchaseOrder == Convert.ToInt64(mySqlDataReader["idWarehousePurchaseOrder"]));

                                if (Order != null)
                                {
                                    if (Order.WarehousePurchaseOrderItems == null)
                                    {
                                        Order.WarehousePurchaseOrderItems = new List<WarehousePurchaseOrderItem>();
                                    }
                                    if (mySqlDataReader["idWarehousePurchaseOrder"] != DBNull.Value)
                                        OrderItem.IdWarehousePurchaseOrder = Convert.ToInt64(mySqlDataReader["idWarehousePurchaseOrder"]);
                                    if (mySqlDataReader["IdWarehousePurchaseOrderItem"] != DBNull.Value)
                                        OrderItem.IdWarehousePurchaseOrderItem = Convert.ToInt64(mySqlDataReader["IdWarehousePurchaseOrderItem"]);
                                    if (mySqlDataReader["Quantity"] != DBNull.Value)
                                        OrderItem.Quantity = Convert.ToDouble(mySqlDataReader["Quantity"]);
                                    if (mySqlDataReader["AlbaranQty"] != DBNull.Value)
                                        OrderItem.ReceivedQuantity = Convert.ToDouble(mySqlDataReader["AlbaranQty"]);
                                    if (OrderItem.Quantity > 0)
                                        OrderItem.Status = (Int32)(OrderItem.ReceivedQuantity / OrderItem.Quantity * 100);
                                    Order.WarehousePurchaseOrderItems.Add(OrderItem);
                                }
                            }
                        }
                    }
                    #endregion
                    #region 3nd ResultSet [rdixit][GEOS2-4455][19.06.2023] 
                    if (mySqlDataReader.NextResult())
                    {
                        while (mySqlDataReader.Read())
                        {
                            if (mySqlDataReader["IdWarehousePurchaseOrderItem"] != DBNull.Value)
                            {
                                WarehousePurchaseOrderExpectedItem OrderExpectedItem = new WarehousePurchaseOrderExpectedItem();

                                WarehousePurchaseOrderItem OrderItem = warehousePurchaseOrders.Where(o => o.WarehousePurchaseOrderItems != null)
                                                                        .SelectMany(order => order.WarehousePurchaseOrderItems)
                                                                        .FirstOrDefault(item => item.IdWarehousePurchaseOrderItem == Convert.ToInt64(mySqlDataReader["IdWarehousePurchaseOrderItem"]));
                                if (OrderItem != null)
                                {
                                    if (OrderItem.WarehousePurchaseOrderExpectedItems == null)
                                    {
                                        OrderItem.WarehousePurchaseOrderExpectedItems = new List<WarehousePurchaseOrderExpectedItem>();
                                    }
                                    if (mySqlDataReader["IdWarehousePurchaseOrderItem"] != DBNull.Value)
                                        OrderExpectedItem.IdWarehousePurchaseOrderItem = Convert.ToInt64(mySqlDataReader["IdWarehousePurchaseOrderItem"]);
                                    if (mySqlDataReader["Quantity"] != DBNull.Value)
                                        OrderExpectedItem.Quantity = (long)Convert.ToDouble(mySqlDataReader["Quantity"]);
                                    if (mySqlDataReader["Date"] != DBNull.Value)
                                        OrderExpectedItem.Date = Convert.ToDateTime(mySqlDataReader["Date"]);

                                    OrderItem.WarehousePurchaseOrderExpectedItems.Add(OrderExpectedItem);
                                }
                            }
                        }
                    }
                    #endregion
                }
            }
            #region 2nd ResultSet [rdixit][GEOS2-4455][19.06.2023] 
            foreach (WarehousePurchaseOrder Order in warehousePurchaseOrders)
            {
                List<DateTime> ItemDates = new List<DateTime>();
                if (Order.WarehousePurchaseOrderItems != null)
                {
                    if (Order.WarehousePurchaseOrderItems.Where(i => i.Status < 100) != null)
                    {
                        if (Order.WarehousePurchaseOrderItems.Where(i => i.Status < 100).ToList().Count > 0)
                        {
                            foreach (WarehousePurchaseOrderItem OrderItem in Order.WarehousePurchaseOrderItems.Where(i => i.Status != 100))
                            {
                                if (OrderItem.WarehousePurchaseOrderExpectedItems != null)
                                {
                                    if (OrderItem.WarehousePurchaseOrderExpectedItems.Count > 0)
                                        ItemDates.Add(OrderItem.WarehousePurchaseOrderExpectedItems.FirstOrDefault().Date);
                                }
                            }
                        }
                    }
                }
                //if (Order.Code== "N24080531")
                //{
                //}
                if (Order.Code == "N25000047")
                {

                }
                if (Order.Code == "E25000016")
                {

                }
                if (Order.Code == "N25000389")
                {

                }
                if (Order.Code == "N25000383")
                {

                }
                try
                {
                    //Shubham[skadam] GEOS2-7998 PO reminder Mail not send  09 05 2025
                    if (ItemDates.Count != 0)
                    {
                        Order.PODeliveryDate = ItemDates.Min(d => d.Date).Date;
                    }
                    if (Order.PODeliveryDate != null)
                    {
                        Order.Delay = (int)(Order.PODeliveryDate.Value.Date - DateTime.Now.Date).TotalDays;
                        if (!string.IsNullOrEmpty(Order.ArticleSupplier.ContactEmail))
                        {
                            if (Order.ReminderEmailDate == DateTime.MinValue || Order.ReminderEmailDate == null)
                            {
                                Order.ReminderEmailDate = Order.PODeliveryDate.Value.AddDays(1);
                            }
                            DateTime dtRm = new DateTime(Order.ReminderEmailDate.Value.Year, Order.ReminderEmailDate.Value.Month, Order.ReminderEmailDate.Value.Day);
                            DateTime dtNow = new DateTime(DateTime.Now.Year, DateTime.Now.Month, DateTime.Now.Day);
                            if (dtRm <= dtNow)
                            {
                                orderid = new List<long>();
                                orderid.Add(Order.IdWarehousePurchaseOrder);
                                if (!SupplierEmailId.ContainsKey(Order.ArticleSupplier.ContactEmail))
                                {
                                    SupplierEmailId.Add(Order.ArticleSupplier.ContactEmail, orderid);
                                }
                                else
                                {
                                    SupplierEmailId[Order.ArticleSupplier.ContactEmail].Add(Order.IdWarehousePurchaseOrder);
                                }
                            }
                        }
                        else
                        {
                            if (!Suppliername.Contains(Order.ArticleSupplier.Name))
                            {
                                Suppliername.Add(Order.ArticleSupplier.Name);
                            }
                        }
                    }
                }
                catch (Exception ex)
                {
                    Log4NetLogger.Logger.Log(string.Format("Error GetPendingPurchaseOrdersByWarehouse_V2620, ErrorMessage- {0} ", ex.Message), category: Category.Exception, priority: Priority.Low);
                }
                //}
            }
            #endregion
            #region GEOS2-4713
            //Shubham[skadam]  GEOS2-4713 Missing Delivery Dates 31 07 2023 
            foreach (var item in warehousePurchaseOrders.Where(w => w.DeliveryDate == null || w.DeliveryDate == DateTime.MinValue))
            {
                if (!string.IsNullOrEmpty(item.PODeliveryDate.ToString()))
                {
                    item.DeliveryDate = item.PODeliveryDate;
                    item.Delay = (int)(item.DeliveryDate.Value.Date - DateTime.Now.Date).TotalDays;
                }
            }
            #endregion
            //foreach (string item in countryISOs)
            //{
            //    byte[] bytes = null;
            //    bytes = GetCountryIconFileInBytes(item, countryIconFilePath);
            //    warehousePurchaseOrders.Where(wp => wp.ArticleSupplier.Country.Iso == item).ToList().ForEach(wp => wp.ArticleSupplier.Country.CountryIconBytes = bytes);
            //}
            if (warehousePurchaseOrders.Count > 0)
            {
                warehousePurchaseOrders.FirstOrDefault().SupplierEmailId = SupplierEmailId;
                warehousePurchaseOrders.FirstOrDefault().Suppliername = Suppliername;
            }
            // [pallavi.kale][04-03-2025][GEOS2-7012]
            foreach (string item in currencyISOs)
            {
                byte[] bytes = null;
                bytes = GetCountryIconFileInBytes(item, currenciesIconFilePath);
                warehousePurchaseOrders.Where(wp => wp.Currency.Name == item).ToList().ForEach(wp => wp.Currency.CurrencyIconbytes = bytes);
            }
            return warehousePurchaseOrders;
        }


        // [pallavi.kale][04-03-2025][GEOS2-7013]
        public WarehousePurchaseOrder GetPendingPOByIdWarehousePurchaseOrder_V2620(string connectionString, Int64 idWarehousePurchaseOrder, string idShippingAddress, string purchaseOrdersPath, string emailTemplatePath, string countryIconFilePath,string currencyIconFilePath)
        {
            WarehousePurchaseOrder warehousePurchaseOrder = null;

            Country country = new Country();
            Currency currency = new Currency();
            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();
                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetPendingPOByIdWarehousePurchaseOrder_V2620", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", idWarehousePurchaseOrder);

                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    if (mySqlDataReader.Read())
                    {
                        try
                        {

                            warehousePurchaseOrder = new WarehousePurchaseOrder();
                            List<WarehouseShippingAddress> warehouseShippingAddresses = new List<WarehouseShippingAddress>();


                            warehousePurchaseOrder.IdWarehousePurchaseOrder = idWarehousePurchaseOrder;

                            if (mySqlDataReader["Code"] != DBNull.Value)
                                warehousePurchaseOrder.Code = Convert.ToString(mySqlDataReader["Code"]);

                            if (mySqlDataReader["IdArticleSupplier"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                                ArticleSupplier articleSupplier = new ArticleSupplier();
                                articleSupplier.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                                if (mySqlDataReader["Supplier"] != DBNull.Value)
                                    articleSupplier.Name = Convert.ToString(mySqlDataReader["Supplier"]);

                                if (mySqlDataReader["SupplierContactPerson"] != DBNull.Value)
                                    articleSupplier.ContactPerson = Convert.ToString(mySqlDataReader["SupplierContactPerson"]);

                                if (mySqlDataReader["SupplierContactEmail"] != DBNull.Value)
                                    articleSupplier.ContactEmail = Convert.ToString(mySqlDataReader["SupplierContactEmail"]);

                                if (mySqlDataReader["Serie"] != DBNull.Value)
                                    articleSupplier.Serie = Convert.ToChar(mySqlDataReader["Serie"]);

                                if (mySqlDataReader["DeliveryDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["DeliveryDate"]) != DateTime.MinValue)
                                {
                                    warehousePurchaseOrder.DeliveryDate = Convert.ToDateTime(mySqlDataReader["DeliveryDate"]);
                                }
                                if (mySqlDataReader["IdCountry"] != DBNull.Value)
                                {
                                    articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["IdCountry"]);

                                    articleSupplier.Country = new Country();
                                    articleSupplier.Country.IdCountry = (byte)articleSupplier.IdCountry;
                                    articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);

                                    if (mySqlDataReader["SupplierCountryISO"] != DBNull.Value)
                                    {
                                        articleSupplier.Country.Iso = Convert.ToString(mySqlDataReader["SupplierCountryISO"]);
                                        byte[] bytes = null;
                                        bytes = GetCountryIconFileInBytes(articleSupplier.Country.Iso, countryIconFilePath);
                                        articleSupplier.Country.CountryIconBytes = bytes;
                                    }

                                    if (mySqlDataReader["IdCountryGroup"] != DBNull.Value)
                                        articleSupplier.Country.IdCountryGroup = Convert.ToInt64(mySqlDataReader["IdCountryGroup"]);
                                }

                                if (mySqlDataReader["IdArticleSupplierType"] != DBNull.Value)
                                {
                                    articleSupplier.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["IdArticleSupplierType"]);

                                    articleSupplier.ArticleSupplierType = new ArticleSupplierType();
                                    articleSupplier.ArticleSupplierType.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["IdArticleSupplierType"]);
                                    articleSupplier.ArticleSupplierType.Name = Convert.ToString(mySqlDataReader["ArticleSupplierType"]);
                                    articleSupplier.ArticleSupplierType.HtmlColor = Convert.ToString(mySqlDataReader["HtmlColor"]);
                                }

                                warehousePurchaseOrder.ArticleSupplier = articleSupplier;
                            }
                            //[rdixit][GEOS2-4455][28.06.2023] 
                            //if (mySqlDataReader["DeliveryDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["deliveryDate"]) != DateTime.MinValue)
                            //{
                            //    warehousePurchaseOrder.DeliveryDate = Convert.ToDateTime(mySqlDataReader["deliveryDate"]);
                            //}

                            if (mySqlDataReader["AttachedPO"] != DBNull.Value)
                                warehousePurchaseOrder.AttachedPO = Convert.ToByte(mySqlDataReader["AttachedPO"]);

                            if (mySqlDataReader["IdPaymentType"] != DBNull.Value)
                                warehousePurchaseOrder.IdPaymentType = Convert.ToInt64(mySqlDataReader["IdPaymentType"]);

                            if (mySqlDataReader["ReminderEmailDate"] != DBNull.Value)
                                warehousePurchaseOrder.ReminderEmailDate = Convert.ToDateTime(mySqlDataReader["ReminderEmailDate"]);

                            if (mySqlDataReader["CreatedIn"] != DBNull.Value)
                                warehousePurchaseOrder.CreatedIn = Convert.ToDateTime(mySqlDataReader["CreatedIn"]);

                            if (mySqlDataReader["ModifiedIn"] != DBNull.Value)
                                warehousePurchaseOrder.ModifiedIn = Convert.ToDateTime(mySqlDataReader["ModifiedIn"]);

                            if (mySqlDataReader["Comments"] != DBNull.Value)
                                warehousePurchaseOrder.Comments = Convert.ToString(mySqlDataReader["Comments"]);

                            //[pramod.misal][GEOS2-4449][04-06-2023]warehouseShippingAddress
                            if (mySqlDataReader["Observations"] != DBNull.Value)
                                warehousePurchaseOrder.SupplierComments = Convert.ToString(mySqlDataReader["Observations"]);

                            if (mySqlDataReader["IsClosed"] != DBNull.Value)
                                warehousePurchaseOrder.IsClosed = Convert.ToByte(mySqlDataReader["IsClosed"]);

                            if (mySqlDataReader["CreatedBy"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.CreatedBy = Convert.ToInt64(mySqlDataReader["CreatedBy"]);
                                warehousePurchaseOrder.Creator = new People();
                                warehousePurchaseOrder.Creator.IdPerson = Convert.ToInt32(mySqlDataReader["CreatedBy"].ToString());
                                warehousePurchaseOrder.Creator.Name = mySqlDataReader["CreatorName"].ToString();
                                warehousePurchaseOrder.Creator.Surname = mySqlDataReader["CreatorSurname"].ToString();
                            }

                            if (mySqlDataReader["ModifiedBy"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.ModifiedBy = Convert.ToInt64(mySqlDataReader["ModifiedBy"]);
                                warehousePurchaseOrder.Modifier = new People();
                                warehousePurchaseOrder.Modifier.IdPerson = Convert.ToInt32(mySqlDataReader["ModifiedBy"].ToString());
                                warehousePurchaseOrder.Modifier.Name = mySqlDataReader["ModifierName"].ToString();
                                warehousePurchaseOrder.Modifier.Surname = mySqlDataReader["ModifierSurname"].ToString();
                            }

                            if (mySqlDataReader["ReasonClosed"] != DBNull.Value)
                                warehousePurchaseOrder.ReasonClosed = Convert.ToString(mySqlDataReader["ReasonClosed"]);

                            if (mySqlDataReader["IdWarehouse"] != DBNull.Value)
                                warehousePurchaseOrder.IdWarehouse = Convert.ToInt64(mySqlDataReader["IdWarehouse"]);

                            if (mySqlDataReader["IdShippingAddress"] != DBNull.Value)
                                warehousePurchaseOrder.IdShippingAddress = Convert.ToInt64(mySqlDataReader["IdShippingAddress"]);
                           
                            // [pallavi.kale][04-03-2025][GEOS2-7013]
                            if (mySqlDataReader["IdCurrency"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.IdCurrency = Convert.ToByte(mySqlDataReader["IdCurrency"]);
                                warehousePurchaseOrder.Currency = new Currency();
                                warehousePurchaseOrder.Currency.Name = Convert.ToString(mySqlDataReader["CurrencyName"]);
                                if (warehousePurchaseOrder.Currency.Name != null)
                                {
                                    byte[] bytes = null;
                                    bytes = GetCountryIconFileInBytes(warehousePurchaseOrder.Currency.Name, currencyIconFilePath);
                                    warehousePurchaseOrder.Currency.CurrencyIconbytes = bytes;
                                }
                                
                            }

                            if (mySqlDataReader["IdWorkflowStatus"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                warehousePurchaseOrder.WorkflowStatus = new WorkflowStatus();
                                warehousePurchaseOrder.WorkflowStatus.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                warehousePurchaseOrder.WorkflowStatus.Name = Convert.ToString(mySqlDataReader["Status"]);
                                warehousePurchaseOrder.WorkflowStatus.HtmlColor = Convert.ToString(mySqlDataReader["StatusHtmlColor"]);
                            }

                            if (mySqlDataReader["IdAssignee"] != DBNull.Value)
                                warehousePurchaseOrder.IdAssignee = Convert.ToUInt32(mySqlDataReader["IdAssignee"]);

                            if (mySqlDataReader["IdApprover"] != DBNull.Value)
                                warehousePurchaseOrder.IdApprover = Convert.ToUInt32(mySqlDataReader["IdApprover"]);

                            if (mySqlDataReader["AssigneeEmail"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.AssigneeEmail = Convert.ToString(mySqlDataReader["AssigneeEmail"]);
                            }
                            if (mySqlDataReader["CreatorEmail"] != DBNull.Value)
                            {
                                warehousePurchaseOrder.CreatorEmail = Convert.ToString(mySqlDataReader["CreatorEmail"]);
                            }

                            string HTMLFileName = null;
                            if (File.Exists(string.Format("{0}{1}SupplierPurchaseOrderRequestMailFormat_{2}-{3}.html", emailTemplatePath, @"\", warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower(), warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToUpper())))
                            {
                                HTMLFileName = string.Format("SupplierPurchaseOrderRequestMailFormat_{0}-{1}.html", warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower(), warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToUpper());
                            }
                            else if (File.Exists(string.Format("{0}{1}SupplierPurchaseOrderRequestMailFormat.html", emailTemplatePath, @"\")))
                            {
                                HTMLFileName = "SupplierPurchaseOrderRequestMailFormat.html";
                            }
                            if (HTMLFileName != null)
                            {
                                StringBuilder emailbody = new StringBuilder();
                                string text = ReadMailTemplate(HTMLFileName, emailTemplatePath);

                                if (string.IsNullOrEmpty(warehousePurchaseOrder.ArticleSupplier.ContactPerson))
                                {
                                    text = text.Replace("[Supplier_Name]", "Supplier");
                                }
                                else
                                {
                                    text = text.Replace("[Supplier_Name]", warehousePurchaseOrder.ArticleSupplier.ContactPerson);
                                }
                                text = text.Replace("[PO_Code]", warehousePurchaseOrder.Code);

                                #region 2 rajashri GEOS2-5375 && GEOS2-5376
                                #region  rajashri GEOS2-5375    
                                string concatenatedValues = string.Empty;
                                List<WarehousePurchaseOrder> WarehousePurchaseOrder1;
                                if (warehousePurchaseOrder.DeliveryDate != null)
                                {
                                    WarehousePurchaseOrder1 = GetWarehouseHolidays_V2520(connectionString, warehousePurchaseOrder.DeliveryDate, warehousePurchaseOrder.IdWarehouse, warehousePurchaseOrder.IdWarehousePurchaseOrder);
                                }
                                else
                                {
                                    WarehousePurchaseOrder1 = new List<WarehousePurchaseOrder>();
                                }
                                if (WarehousePurchaseOrder1 != null && WarehousePurchaseOrder1.Count > 0)
                                {
                                    CultureInfo cultureInfo = CultureInfo.CurrentCulture;

                                    var holidays = WarehousePurchaseOrder1.Select(h => new
                                    {
                                        StartDate = h.WarehouseHolidayStartdate?.Date.ToString("d", cultureInfo),
                                        EndDate = h.WarehouseHolidayEndDate?.Date.ToString("d", cultureInfo),
                                        Type = h.Holidaytype
                                    }).ToList();

                                    // var holidays = WarehousePurchaseOrder1.Select(h => new { StartDate = h.WarehouseHolidayStartdate?.Date, EndDate = h.WarehouseHolidayEndDate?.Date, Type = h.Holidaytype }).ToList();
                                    if (holidays.Count == 1)
                                    {
                                        var holiday = holidays.First();
                                        concatenatedValues = $"<tr style=\"margin-top:5px\">" +
                                                            $"<td colspan=\"2\" style=\"background: white; font-weight: 700; border-top: 4px solid grey; Padding:5px\">" +
                                                            $"</tr>" +
                                                            $"<tr style=\"margin-top:5px\">" +
                                                            $"<td colspan=\"2\" style=\"background: #d1d8db; color: black; font-weight: 700; border-top: 4px solid grey; Padding:20px\">";
                                        if (warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower() == "es")
                                        {
                                            concatenatedValues += $"Tenga en cuenta que el almacén({WarehousePurchaseOrder1.FirstOrDefault()?.Name}) estará cerrado el ";
                                            if (holiday.StartDate == holiday.EndDate)
                                            {
                                                concatenatedValues += $"{holiday.StartDate} debido a un día festivo \"{holiday.Type}\"";
                                            }
                                            else
                                            {
                                                concatenatedValues += $"{holiday.StartDate},{holiday.EndDate} debido a un día festivo \"{holiday.Type}\"";
                                            }
                                        }
                                        else
                                        {
                                            concatenatedValues += $"Please be Informed that warehouse({WarehousePurchaseOrder1.FirstOrDefault()?.Name}) will be closed on ";

                                            if (holiday.StartDate == holiday.EndDate)
                                            {
                                                concatenatedValues += $"{holiday.StartDate} due to \"{holiday.Type}\" holiday";
                                            }
                                            else
                                            {
                                                concatenatedValues += $"{holiday.StartDate},{holiday.EndDate} due to \"{holiday.Type}\" holiday";
                                            }
                                        }

                                        concatenatedValues += $"</td></tr>";

                                    }
                                    else
                                    {

                                        //var groupesHolidays = holidays.GroupBy(h => h.Type).Select(g => new {
                                        //    Type = g.Key,
                                        //    Dates = g.Select(h =>
                                        //    {
                                        //        if (h.StartDate == h.EndDate)
                                        //        {
                                        //            return h.StartDate?.ToShortDateString();
                                        //        }
                                        //        else if(
                                        //        {
                                        //            return $"{h.StartDate?.ToShortDateString()} , {h.EndDate?.ToShortDateString()}";
                                        //        }
                                        //    }).ToList()
                                        //});

                                        var groupesHolidays = holidays.GroupBy(h => h.Type).Select(g => new
                                        {
                                            Type = g.Key,
                                            Dates = g.Select(h =>
                                            {
                                                if (h.StartDate == h.EndDate)
                                                {
                                                    return h.StartDate;
                                                }
                                                else if (h.StartDate != null && h.EndDate != null)
                                                {
                                                    return $"{h.StartDate} , {h.EndDate}";
                                                }
                                                else if (h.StartDate != null)
                                                {
                                                    return h.StartDate;
                                                }
                                                else if (h.EndDate != null)
                                                {
                                                    return h.EndDate;
                                                }
                                                else
                                                {
                                                    return ""; // Handle case where both StartDate and EndDate are null
                                                }
                                            }).ToList()
                                        });


                                        concatenatedValues = $"<tr style=\"margin-top:5px\">" +
                                         $"<td colspan=\"2\" style=\"background: white; font-weight: 700; border-top: 4px solid grey; Padding:5px\">";
                                        int groupCount = groupesHolidays.Count();
                                        if (groupCount > 0)
                                        {
                                            if (warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower() == "es")
                                            {
                                                concatenatedValues += $"Tenga en cuenta que el almacén({WarehousePurchaseOrder1.FirstOrDefault()?.Name}) estará cerrado ";
                                            }
                                            else
                                            {
                                                concatenatedValues += $"Please be Informed that warehouse({WarehousePurchaseOrder1.FirstOrDefault()?.Name}) will be closed  ";
                                            }
                                        }

                                        int currentIndex = 0;

                                        foreach (var group in groupesHolidays)
                                        {

                                            if (warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower() == "es")
                                            {
                                                concatenatedValues += $" en  {string.Join(", ", group.Dates)} debido a un día festivo  \"{group.Type}\"";
                                                if (currentIndex < groupCount - 1)
                                                {
                                                    concatenatedValues += " Y ";
                                                }
                                            }
                                            else
                                            {
                                                concatenatedValues += $" on  {string.Join(", ", group.Dates)} due to \"{group.Type}\" holiday";
                                                if (currentIndex < groupCount - 1)
                                                {
                                                    concatenatedValues += (currentIndex % 2 == 0) ? ", " : " and ";
                                                }
                                            }
                                            currentIndex++;
                                        }


                                        concatenatedValues += $"</td></tr>";

                                    }
                                    text = text.Replace("[footerdata]", concatenatedValues);
                                }
                                #endregion
                                #region GEOS-5376
                                else
                                {

                                    #region CustomMessageFooter

                                    List<Warehouses> customHoliday = GetCustomMessageforHoliday_PORequestMail_V2500(connectionString, warehousePurchaseOrder.IdWarehouse);
                                    if (customHoliday != null && customHoliday.Count > 0)
                                    {
                                        var customMessages = string.Join(", ", customHoliday.Select(h => h.CustomMessage));
                                        var customStartDate = string.Join(", ", customHoliday.Select(h => h.ImportantNoticeStartDate?.Date.ToShortDateString()));
                                        var customEndDate = string.Join(", ", customHoliday.Select(h => h.ImportantNoticeEndDate?.Date.ToShortDateString()));

                                        CultureInfo cultureInfo = CultureInfo.CurrentCulture;
                                        customStartDate = customStartDate.ToString(cultureInfo);
                                        customEndDate = customEndDate.ToString(cultureInfo);


                                        if (!string.IsNullOrEmpty(customStartDate) && string.IsNullOrEmpty(customEndDate))
                                        {
                                            concatenatedValues = $"<tr style=\"margin-top:5px\">" +
                                                                  $"<td colspan=\"2\" style=\"background: white;  font-weight: 700; border-top: 4px solid grey;Padding:5px \">" +
                                                                  $"</tr>" +
                                                                  $"<tr style=\"margin-top:5px\">" +
                                                                  $"<td colspan=\"2\" style=\"background: #d1d8db; color: black; font-weight: 700; border-top: 4px solid grey;Padding:20px \">" +
                                                                  $"{customMessages} from " +
                                                                  $"\"{customStartDate}\"" + "</td>" +
                                                                  $"</tr>";
                                        }
                                        else if (string.IsNullOrEmpty(customStartDate) && !string.IsNullOrEmpty(customEndDate))
                                        {
                                            concatenatedValues = $"<tr style=\"margin-top:5px\">" +
                                                                  $"<td colspan=\"2\" style=\"background: white;  font-weight: 700; border-top: 4px solid grey;Padding:5px \">" +
                                                                  $"</tr>" +
                                                                  $"<tr style=\"margin-top:5px\">" +
                                                                  $"<td colspan=\"2\" style=\"background: #d1d8db; color: black; font-weight: 700; border-top: 4px solid grey;Padding:20px \">" +
                                                                  $"{customMessages} " +
                                                                  $" till " +
                                                                  $"\"{customEndDate}\"" + "</td>" +
                                                                  $"</tr>";
                                        }
                                        else if (!string.IsNullOrEmpty(customStartDate) && !string.IsNullOrEmpty(customEndDate))
                                        {
                                            concatenatedValues = $"<tr style=\"margin-top:5px\">" +
                                                                  $"<td colspan=\"2\" style=\"background: white;  font-weight: 700; border-top: 4px solid grey;Padding:5px \">" +
                                                                  $"</tr>" +
                                                                  $"<tr style=\"margin-top:5px\">" +
                                                                  $"<td colspan=\"2\" style=\"background: #d1d8db; color: black; font-weight: 700; border-top: 4px solid grey;Padding:20px \">" +
                                                                  $"{customMessages} from " +
                                                                  $"\"{customStartDate}\"" + " to " +
                                                                  $"\"{customEndDate}\"" + "</td>" +
                                                                  $"</tr>";
                                        }

                                        else
                                        {
                                            concatenatedValues = $"<tr style=\"margin-top:5px\">" +
                                                                 $"<td colspan=\"2\" style=\"background: white;  font-weight: 700; border-top: 4px solid grey;Padding:5px \">" +
                                                                 $"</tr>" +
                                                                 $"<tr style=\"margin-top:5px\">" +
                                                                 $"<td colspan=\"2\" style=\"background: #d1d8db; color: black; font-weight: 700; border-top: 4px solid grey;Padding:20px \">" +
                                                                 $"{customMessages}</td>" +
                                                                 $"</tr>";
                                        }

                                    }
                                    else
                                    {
                                        concatenatedValues = string.Empty;
                                    }
                                    text = text.Replace("[footerdata]", concatenatedValues);
                                    #endregion
                                }
                                #endregion

                                #endregion
                                emailbody.Append(text);

                                warehousePurchaseOrder.EmailBody = emailbody.ToString();
                            }
                            warehousePurchaseOrder.AttachPdf = warehousePurchaseOrder.CreatedIn.Year + @"\" + warehousePurchaseOrder.Code + @"\01 Purchase Order\PO_" + warehousePurchaseOrder.Code + ".pdf";

                            warehousePurchaseOrder.AttachmentBytes = GetPurchaseOrderPdf(purchaseOrdersPath, warehousePurchaseOrder.AttachPdf);
                            warehousePurchaseOrder.WarehouseDeliveryNotes = GetDeliveryNotesByIdWarehousePurchaseOrder(connectionString, warehousePurchaseOrder, purchaseOrdersPath);


                            // [pramod.misal][GEOS2-4951][05-07-2023]

                            warehousePurchaseOrder.WarehouseShippingAddress = GetShippingAddressByIdShippingAddress_V2420(connectionString, warehousePurchaseOrder, idShippingAddress);
                            // [rdixit][GEOS2-4822][13-09-2023]
                            // [rdixit][GEOS2-4589][09-10-2023]
                            warehousePurchaseOrder.WarehousePurchaseOrderItemWithComments = GetArticlesByIdWarehousePurchaseOrder_V2460(connectionString, warehousePurchaseOrder.IdWarehousePurchaseOrder);
                            //warehousePurchaseOrder.WarehousePOComments = GetlogEntriesByWarehousePO_V2400(idWarehousePurchaseOrder, 252, connectionString);
                            //warehousePurchaseOrder.WarehousePOLogEntries = GetlogEntriesByWarehousePO_V2400(idWarehousePurchaseOrder, 253, connectionString);
                            //[pramod.misal][GEOS2-4451][08-08-2023]  logEntriesByWarehousePO.IdEntryType
                            warehousePurchaseOrder.WarehousePOComments = GetlogEntriesByWarehousePO_V2420(idWarehousePurchaseOrder, 257, connectionString);
                            warehousePurchaseOrder.WarehousePOLogEntries = GetlogEntriesByWarehousePO_V2420(idWarehousePurchaseOrder, 258, connectionString);



                            //[rdixit][GEOS2-4455][28.06.2023] 
                            List<DateTime> ItemDates = new List<DateTime>();
                            if (warehousePurchaseOrder.WarehousePurchaseOrderItemWithComments != null)
                            {
                                if (warehousePurchaseOrder.WarehousePurchaseOrderItemWithComments.Where(i => i.Status < 100) != null)
                                {
                                    if (warehousePurchaseOrder.WarehousePurchaseOrderItemWithComments.Where(i => i.Status < 100).ToList().Count > 0)
                                        foreach (var item in warehousePurchaseOrder.WarehousePurchaseOrderItemWithComments.Where(i => i.Status < 100))
                                        {
                                            if (item.WarehousePurchaseOrderExpectedItems != null)
                                            {
                                                if (item.WarehousePurchaseOrderExpectedItems.Count > 0)
                                                    ItemDates.Add(item.WarehousePurchaseOrderExpectedItems.FirstOrDefault().Date);
                                            }
                                        }
                                }
                            }
                            if (ItemDates.Count > 0)
                                warehousePurchaseOrder.DeliveryDate = ItemDates.Min(d => d.Date).Date;
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetPendingPOByIdWarehousePurchaseOrder_V2620(idWarehousePurchaseOrder-{0}), ErrorMessage- {1} ", idWarehousePurchaseOrder, ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            return warehousePurchaseOrder;
        }
      
        // [pallavi.kale][04-03-2025][GEOS2-7012]
        public List<WarehousePurchaseOrder> GetCompletedPurchaseOrdersByWarehouse_V2620(DateTime startDate, DateTime endDate, long idWarehouse, string connectionstring, string countryIconFilePath, string currenciesIconFilePath, string connectionStringWorkbench)
        {
            List<WarehousePurchaseOrder> warehousePurchaseOrders = new List<WarehousePurchaseOrder>();
            List<string> countryISOs = new List<string>();
            List<string> currencyISO = new List<string>();
            List<long> orderid = new List<long>();
            Dictionary<string, List<long>> SupplierEmailId = new Dictionary<string, List<long>>();
            List<string> Suppliername = new List<string>();

            List<WorkflowStatus> LstWorkflowStatus = GetAllWorkflowStatus_V2301(connectionStringWorkbench);
            List<WorkflowTransition> LstWorkflowStatusTransitions = GetAllWorkflowTransitions_V2301(connectionStringWorkbench);
            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionstring))
            {
                mySqlConnection.Open();

                MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetCompletedOrdersByWarehouse_V2520", mySqlConnection);
                mySqlCommand.CommandType = CommandType.StoredProcedure;
                mySqlCommand.Parameters.AddWithValue("_StartDate", startDate);
                mySqlCommand.Parameters.AddWithValue("_EndDate", endDate);
                mySqlCommand.Parameters.AddWithValue("_IdWarehouse", idWarehouse);
                using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                {
                    double totalQuantity = 0;
                    double receivedQuantity = 0;
                    while (mySqlDataReader.Read())
                    {
                        try
                        {
                            totalQuantity = 0;
                            receivedQuantity = 0;
                            WarehousePurchaseOrder warehousePurchaseOrder = new WarehousePurchaseOrder();
                            try
                            {
                                warehousePurchaseOrder.IdWarehousePurchaseOrder = Convert.ToInt64(mySqlDataReader["idWarehousepurchaseorder"]);
                                if (mySqlDataReader["Code"] != DBNull.Value)
                                    warehousePurchaseOrder.Code = Convert.ToString(mySqlDataReader["Code"]);
                                if (mySqlDataReader["Incoterms"] != DBNull.Value)
                                    warehousePurchaseOrder.Incoterms = Convert.ToString(mySqlDataReader["Incoterms"]);
                                if (mySqlDataReader["Comments"] != DBNull.Value)
                                    warehousePurchaseOrder.Comments = Convert.ToString(mySqlDataReader["Comments"]);
                                //if (mySqlDataReader["Observations"] != DBNull.Value)
                                //    warehousePurchaseOrder.Observations = Convert.ToString(mySqlDataReader["Observations"]);
                                if (mySqlDataReader["IdArticleSupplier"] != DBNull.Value)
                                {
                                    ArticleSupplier articleSupplier = new ArticleSupplier();
                                    articleSupplier.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);
                                    if (mySqlDataReader["Supplier"] != DBNull.Value)
                                        articleSupplier.Name = Convert.ToString(mySqlDataReader["Supplier"]);
                                    if (mySqlDataReader["IdCountry"] != DBNull.Value)
                                    {
                                        articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["IdCountry"]);
                                        articleSupplier.Country = new Country();
                                        articleSupplier.Country.IdCountry = Convert.ToByte(mySqlDataReader["IdCountry"]);
                                        articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);
                                        if (mySqlDataReader["CountryISO"] != DBNull.Value)
                                        {
                                            articleSupplier.Country.Iso = Convert.ToString(mySqlDataReader["CountryISO"]);
                                            articleSupplier.Country.CountryIconUrl = "https://api.emdep.com/GEOS/Images?FilePath=/Images/Countries/" + articleSupplier.Country.Iso + ".png";
                                            //if (!countryISOs.Any(co => co.ToString() == articleSupplier.Country.Iso))
                                            //{
                                            //    countryISOs.Add(articleSupplier.Country.Iso);
                                            //}
                                        }
                                    }
                                    if (mySqlDataReader["SupplierContactPerson"] != DBNull.Value)
                                        articleSupplier.ContactPerson = Convert.ToString(mySqlDataReader["SupplierContactPerson"]);
                                    if (mySqlDataReader["SupplierContactEmail"] != DBNull.Value)
                                        articleSupplier.ContactEmail = Convert.ToString(mySqlDataReader["SupplierContactEmail"]);
                                    warehousePurchaseOrder.ArticleSupplier = articleSupplier;
                                }

                                //Shubham[skadam]  GEOS2-4713 Missing Delivery Dates 31 07 2023 
                                if (mySqlDataReader["PODeliveryDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["PODeliveryDate"]) != DateTime.MinValue)
                                {
                                    warehousePurchaseOrder.PODeliveryDate = Convert.ToDateTime(mySqlDataReader["PODeliveryDate"]);
                                }
                                if (mySqlDataReader["AttachedPO"] != DBNull.Value)
                                    warehousePurchaseOrder.AttachedPO = Convert.ToByte(mySqlDataReader["AttachedPO"]);
                                if (mySqlDataReader["Deliveries"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.Deliveries = Convert.ToInt32(mySqlDataReader["Deliveries"]);
                                    if (warehousePurchaseOrder.Deliveries > 0)
                                    {
                                        warehousePurchaseOrder.IsPartialPending = true;
                                    }
                                }
                                if (mySqlDataReader["LatestDeliveryDate"] != DBNull.Value)
                                    warehousePurchaseOrder.LatestDeliveryDate = Convert.ToDateTime(mySqlDataReader["LatestDeliveryDate"]);
                                if (mySqlDataReader["FirstDeliveryDate"] != DBNull.Value)
                                    warehousePurchaseOrder.FirstDeliveryDate = Convert.ToDateTime(mySqlDataReader["FirstDeliveryDate"]);
                                if (mySqlDataReader["IdWarehouse"] != DBNull.Value)
                                    warehousePurchaseOrder.IdWarehouse = Convert.ToInt64(mySqlDataReader["IdWarehouse"]);
                                if (mySqlDataReader["OrderQty"] != DBNull.Value)
                                    totalQuantity = Convert.ToDouble(mySqlDataReader["OrderQty"]);
                                if (mySqlDataReader["ReceivedQuantity"] != DBNull.Value)
                                    receivedQuantity = Convert.ToDouble(mySqlDataReader["ReceivedQuantity"]);
                                if (totalQuantity > 0)
                                    warehousePurchaseOrder.Status = (Int16)((receivedQuantity / totalQuantity) * 100);
                                if (mySqlDataReader["TotalAmount"] != DBNull.Value)
                                    warehousePurchaseOrder.TotalAmount = Convert.ToDecimal(mySqlDataReader["TotalAmount"]);
                                if (mySqlDataReader["CreatedIn"] != DBNull.Value)
                                    warehousePurchaseOrder.CreatedIn = Convert.ToDateTime(mySqlDataReader["CreatedIn"]);
                                if (mySqlDataReader["AttachPdf"] != DBNull.Value)
                                    warehousePurchaseOrder.AttachPdf = Convert.ToString(mySqlDataReader["AttachPdf"]);//[GEOS2-10127][ganesh.chaudhari][07 11 2025]


                                if (mySqlDataReader["idCurrency"] != DBNull.Value)
                                {
                                        warehousePurchaseOrder.IdCurrency = Convert.ToByte(mySqlDataReader["idCurrency"]);
                                        warehousePurchaseOrder.Currency = new Currency();
                                        warehousePurchaseOrder.Currency.IdCurrency = Convert.ToByte(mySqlDataReader["idCurrency"]);
                                        warehousePurchaseOrder.Currency.Name = Convert.ToString(mySqlDataReader["CurrencyName"]);
                                        warehousePurchaseOrder.Currency.Symbol = Convert.ToString(mySqlDataReader["CurrencySymbol"]);
                                        if (warehousePurchaseOrder.Currency.Name != null)
                                        {
                                            if (!currencyISO.Any(co => co.ToString() == warehousePurchaseOrder.Currency.Name))
                                            {
                                                currencyISO.Add(warehousePurchaseOrder.Currency.Name);
                                            }
                                        }

                                }


                                if (mySqlDataReader["IdWorkflowStatus"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                    warehousePurchaseOrder.WorkflowStatus = new WorkflowStatus();
                                    warehousePurchaseOrder.WorkflowStatus.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                    warehousePurchaseOrder.WorkflowStatus.Name = Convert.ToString(mySqlDataReader["Status"]);
                                    warehousePurchaseOrder.WorkflowStatus.HtmlColor = Convert.ToString(mySqlDataReader["HtmlColor"]);


                                    //[pramod.misal][GEOS2-4448][06-07-2023]
                                    if (mySqlDataReader["SortOrder"] != DBNull.Value)
                                    {
                                        warehousePurchaseOrder.WorkflowStatus.SortOrder = Convert.ToInt32(mySqlDataReader["SortOrder"]);
                                    }

                                }
                                if (mySqlDataReader["AssigneeEmail"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.AssigneeEmail = Convert.ToString(mySqlDataReader["AssigneeEmail"]);
                                }
                                if (mySqlDataReader["CreatorEmail"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.CreatorEmail = Convert.ToString(mySqlDataReader["CreatorEmail"]);
                                }

                                if (mySqlDataReader["ReminderEmailDate"] != DBNull.Value)
                                    warehousePurchaseOrder.ReminderEmailDate = Convert.ToDateTime(mySqlDataReader["ReminderEmailDate"]);

                                if (mySqlDataReader["WarehouseName"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.WarehouseName = Convert.ToString(mySqlDataReader["WarehouseName"]);
                                }


                                warehousePurchaseOrder.LstWorkflowStatus = LstWorkflowStatus;
                                List<byte> GetCurrentButtons = LstWorkflowStatusTransitions.Where(a => a.IdWorkflowStatusFrom == warehousePurchaseOrder.IdWorkflowStatus).Select(a => a.IdWorkflowStatusTo).Distinct().ToList();
                                warehousePurchaseOrder.LstWorkflowStatusTransition = new List<WorkflowStatus>();
                                warehousePurchaseOrder.LstWorkflowStatusTransition.Add(warehousePurchaseOrder.LstWorkflowStatus.FirstOrDefault(a => a.IdWorkflowStatus == warehousePurchaseOrder.IdWorkflowStatus));
                                foreach (byte statusbutton in GetCurrentButtons)
                                {
                                    warehousePurchaseOrder.LstWorkflowStatusTransition.Add(warehousePurchaseOrder.LstWorkflowStatus.FirstOrDefault(a => a.IdWorkflowStatus == statusbutton));
                                }
                            }
                            catch (Exception ex)
                            {
                            }
                            warehousePurchaseOrder.LstAllWorkflowStatusTransitions = LstWorkflowStatusTransitions;
                            warehousePurchaseOrders.Add(warehousePurchaseOrder);
                            // warehousePurchaseOrder.WarehousePurchaseOrderItemWithComments = GetArticlesByIdWarehousePurchaseOrder_V2460(connectionstring, warehousePurchaseOrder.IdWarehousePurchaseOrder);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetCompletedPurchaseOrdersByWarehouse_V2620(). ErrorMessage-" + ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                    #region 2nd ResultSet [rdixit][GEOS2-4455][19.06.2023] 
                    if (mySqlDataReader.NextResult())
                    {
                        Dictionary<long, int> orderItemCounts = new Dictionary<long, int>();
                        while (mySqlDataReader.Read())
                        {
                            if (mySqlDataReader["idWarehousePurchaseOrder"] != DBNull.Value)
                            {
                                WarehousePurchaseOrderItem OrderItem = new WarehousePurchaseOrderItem();

                                WarehousePurchaseOrder Order = warehousePurchaseOrders.FirstOrDefault(i => i.IdWarehousePurchaseOrder == Convert.ToInt64(mySqlDataReader["idWarehousePurchaseOrder"]));

                                if (Order != null)
                                {
                                    if (Order.WarehousePurchaseOrderItems == null)
                                    {
                                        Order.WarehousePurchaseOrderItems = new List<WarehousePurchaseOrderItem>();
                                    }
                                    if (mySqlDataReader["idWarehousePurchaseOrder"] != DBNull.Value)
                                        OrderItem.IdWarehousePurchaseOrder = Convert.ToInt64(mySqlDataReader["idWarehousePurchaseOrder"]);
                                    if (mySqlDataReader["IdWarehousePurchaseOrderItem"] != DBNull.Value)
                                        OrderItem.IdWarehousePurchaseOrderItem = Convert.ToInt64(mySqlDataReader["IdWarehousePurchaseOrderItem"]);
                                    if (mySqlDataReader["Quantity"] != DBNull.Value)
                                        OrderItem.Quantity = Convert.ToDouble(mySqlDataReader["Quantity"]);
                                    if (mySqlDataReader["AlbaranQty"] != DBNull.Value)
                                        OrderItem.ReceivedQuantity = Convert.ToDouble(mySqlDataReader["AlbaranQty"]);

                                    if (OrderItem.Article == null)
                                    {
                                        OrderItem.Article = new Article();
                                    }
                                    if (mySqlDataReader["Reference"] != DBNull.Value)
                                        OrderItem.Article.Reference = Convert.ToString(mySqlDataReader["Reference"]);

                                    if (OrderItem.Quantity > 0)
                                        OrderItem.Status = (Int32)(OrderItem.ReceivedQuantity / OrderItem.Quantity * 100);

                                    Order.WarehousePurchaseOrderItems.Add(OrderItem);

                                    Order.ItemCount = Order.WarehousePurchaseOrderItems.Count(i => i.Article.Reference != "");


                                }
                            }
                        }
                    }

                    #endregion
                    #region 3nd ResultSet [rdixit][GEOS2-4455][19.06.2023] 

                    if (mySqlDataReader.NextResult())
                    {
                        while (mySqlDataReader.Read())
                        {
                            if (mySqlDataReader["IdWarehousePurchaseOrderItem"] != DBNull.Value)
                            {
                                WarehousePurchaseOrderExpectedItem OrderExpectedItem = new WarehousePurchaseOrderExpectedItem();

                                WarehousePurchaseOrderItem OrderItem = warehousePurchaseOrders.Where(o => o.WarehousePurchaseOrderItems != null)
                                                                        .SelectMany(order => order.WarehousePurchaseOrderItems)
                                                                        .FirstOrDefault(item => item.IdWarehousePurchaseOrderItem == Convert.ToInt64(mySqlDataReader["IdWarehousePurchaseOrderItem"]));
                                if (OrderItem != null)
                                {
                                    if (OrderItem.WarehousePurchaseOrderExpectedItems == null)
                                    {
                                        OrderItem.WarehousePurchaseOrderExpectedItems = new List<WarehousePurchaseOrderExpectedItem>();
                                    }
                                    if (mySqlDataReader["IdWarehousePurchaseOrderItem"] != DBNull.Value)
                                        OrderExpectedItem.IdWarehousePurchaseOrderItem = Convert.ToInt64(mySqlDataReader["IdWarehousePurchaseOrderItem"]);
                                    if (mySqlDataReader["Quantity"] != DBNull.Value)
                                        OrderExpectedItem.Quantity = (long)Convert.ToDouble(mySqlDataReader["Quantity"]);
                                    if (mySqlDataReader["Date"] != DBNull.Value)
                                        OrderExpectedItem.Date = Convert.ToDateTime(mySqlDataReader["Date"]);

                                    OrderItem.WarehousePurchaseOrderExpectedItems.Add(OrderExpectedItem);

                                }
                            }
                        }
                    }
                    #endregion
                }
            }
            #region 2nd ResultSet [rdixit][GEOS2-4455][19.06.2023] 
            foreach (WarehousePurchaseOrder Order in warehousePurchaseOrders)
            {
                List<DateTime> ItemDates = new List<DateTime>();
                if (Order.WarehousePurchaseOrderItems != null)
                {
                    if (Order.WarehousePurchaseOrderItems.Where(i => i.Status < 100) != null)
                    {
                        if (Order.WarehousePurchaseOrderItems.Where(i => i.Status < 100).ToList().Count > 0)
                        {
                            foreach (WarehousePurchaseOrderItem OrderItem in Order.WarehousePurchaseOrderItems.Where(i => i.Status != 100))
                            {
                                if (OrderItem.WarehousePurchaseOrderExpectedItems != null)
                                {
                                    if (OrderItem.WarehousePurchaseOrderExpectedItems.Count > 0)
                                        ItemDates.Add(OrderItem.WarehousePurchaseOrderExpectedItems.FirstOrDefault().Date);
                                }
                            }
                        }
                    }
                }
                if (ItemDates.Count != 0)
                {
                    Order.DeliveryDate = ItemDates.Min(d => d.Date).Date;
                    Order.Delay = (int)(Order.DeliveryDate.Value.Date - DateTime.Now.Date).TotalDays;

                    if (!string.IsNullOrEmpty(Order.ArticleSupplier.ContactEmail))
                    {
                        if (Order.ReminderEmailDate == DateTime.MinValue || Order.ReminderEmailDate == null)
                        {
                            Order.ReminderEmailDate = Order.DeliveryDate.Value.AddDays(1);
                        }
                        DateTime dtRm = new DateTime(Order.ReminderEmailDate.Value.Year, Order.ReminderEmailDate.Value.Month, Order.ReminderEmailDate.Value.Day);
                        DateTime dtNow = new DateTime(DateTime.Now.Year, DateTime.Now.Month, DateTime.Now.Day);
                        if (dtRm <= dtNow)
                        {
                            orderid = new List<long>();
                            orderid.Add(Order.IdWarehousePurchaseOrder);
                            if (!SupplierEmailId.ContainsKey(Order.ArticleSupplier.ContactEmail))
                            {
                                SupplierEmailId.Add(Order.ArticleSupplier.ContactEmail, orderid);
                            }
                            else
                            {
                                SupplierEmailId[Order.ArticleSupplier.ContactEmail].Add(Order.IdWarehousePurchaseOrder);
                            }
                        }
                    }
                    else
                    {
                        if (!Suppliername.Contains(Order.ArticleSupplier.Name))
                        {
                            Suppliername.Add(Order.ArticleSupplier.Name);
                        }
                    }
                }
            }
            #endregion
            #region GEOS2-4713
            //Shubham[skadam]  GEOS2-4713 Missing Delivery Dates 31 07 2023 
            foreach (var item in warehousePurchaseOrders.Where(w => w.DeliveryDate == null || w.DeliveryDate == DateTime.MinValue))
            {
                if (!string.IsNullOrEmpty(item.PODeliveryDate.ToString()))
                {
                    item.DeliveryDate = item.PODeliveryDate;
                    item.Delay = (int)(item.DeliveryDate.Value.Date - DateTime.Now.Date).TotalDays;
                }
            }
            #endregion

            if (warehousePurchaseOrders.Count > 0)
            {
                warehousePurchaseOrders.FirstOrDefault().SupplierEmailId = SupplierEmailId;
                warehousePurchaseOrders.FirstOrDefault().Suppliername = Suppliername;
            }
            // [pallavi.kale][04-03-2025][GEOS2-7012]
            foreach (string item in currencyISO)
            {
                byte[] bytes = null;
                bytes = GetCountryIconFileInBytes(item, currenciesIconFilePath);
                warehousePurchaseOrders.Where(wp => wp.Currency.Name == item).ToList().ForEach(wp => wp.Currency.CurrencyIconbytes = bytes);
            }

            return warehousePurchaseOrders;
        }

        
        //[GEOS2-7979][rdixit][16.07.2025][All connected tasks]
        public List<PreOrder> GetAllPreOrder_V2660(string connectionString, Warehouses warehouse, DateTime fromDate, DateTime toDate)
        {           
            List<PreOrder> ReOrderList = new List<PreOrder>();
            using (MySqlConnection connOtItem = new MySqlConnection(connectionString))
            {
                connOtItem.Open();
                MySqlCommand ArticlesCommand = new MySqlCommand("SRM_GetWarehousePreOrders_V2660", connOtItem);
                ArticlesCommand.CommandType = CommandType.StoredProcedure;
                ArticlesCommand.Parameters.AddWithValue("_IdWarehouse", warehouse.IdWarehouse);
                ArticlesCommand.Parameters.AddWithValue("_fromDate", fromDate);
                ArticlesCommand.Parameters.AddWithValue("_toDate", toDate);
                ArticlesCommand.CommandTimeout = 4000;

                using (MySqlDataReader Reader = ArticlesCommand.ExecuteReader())
                {
                    while (Reader.Read())
                    {
                        try
                        {
                            PreOrder reOrder = new PreOrder();

                            if (Reader["IdWarehousePreOrder"] != DBNull.Value)
                                reOrder.IdWarehouseReOrder = Convert.ToInt32(Reader["IdWarehousePreOrder"]);

                            if (Reader["Code"] != DBNull.Value)
                                reOrder.Code = Convert.ToString(Reader["Code"]);

                            if (Reader["CalculationDate"] != DBNull.Value)
                                reOrder.CalculationDate = Convert.ToDateTime(Reader["CalculationDate"]);

                            if (Reader["CreatedBy"] != DBNull.Value)
                                reOrder.CreatedId = Convert.ToInt32(Reader["CreatedBy"]);

                            if (Reader["CreatedUsr"] != DBNull.Value)
                                reOrder.CreatedBy = Convert.ToString(Reader["CreatedUsr"]);

                            if (Reader["CreationDate"] != DBNull.Value)
                                reOrder.CreationDate = Convert.ToDateTime(Reader["CreationDate"]);

                            if (Reader["IdWarehouse"] != DBNull.Value)
                            {
                                reOrder.Warehouse = new Warehouses();
                                if (Reader["CountryISO"] != DBNull.Value)
                                {
                                    reOrder.Warehouse.Iso = Convert.ToString(Reader["CountryISO"]);
                                    reOrder.Warehouse.CountryIconUrl = "https://api.emdep.com/GEOS/Images?FilePath=/Images/Countries/" + reOrder.Warehouse.Iso + ".png";
                                }

                                if (Reader["IdWarehouse"] != DBNull.Value)
                                    reOrder.Warehouse.IdWarehouse = Convert.ToInt32(Reader["IdWarehouse"]);

                                if (Reader["WarehouseName"] != DBNull.Value)
                                    reOrder.Warehouse.Name = Convert.ToString(Reader["WarehouseName"]);
                            }

                            if (Reader["TotalReOrder"] != DBNull.Value)
                                reOrder.TotalReOrder = Convert.ToInt32(Reader["TotalReOrder"]);

                            if (Reader["TotalValue"] != DBNull.Value)
                                reOrder.TotalValue = Convert.ToDouble(Reader["TotalValue"]);


                            if (Reader["IdCurrency"] != DBNull.Value)
                            {
                                reOrder.Currency = new Currency();
                                reOrder.Currency.IdCurrency = Convert.ToByte(Reader["IdCurrency"]);
                                reOrder.Currency.Name = Convert.ToString(Reader["CurrencyName"]);
                            }

                            if (Reader["IdWorkflow"] != DBNull.Value)
                            {
                                reOrder.Status = new WorkflowStatus();
                                reOrder.Status.IdWorkflowStatus = Convert.ToByte(Reader["IdWorkflowStatus"]);
                                reOrder.Status.Name = Convert.ToString(Reader["WorkflowStatus"]);
                            }

                            if (Reader["Code"] != DBNull.Value)
                                reOrder.Code = Reader["Code"].ToString();

                            if (Reader["LogisticId"] != DBNull.Value)
                            {
                                reOrder.Logistic = new LookupValue();
                                reOrder.Logistic.IdLookupValue = Convert.ToInt32(Reader["LogisticId"]);
                                reOrder.Logistic.Value = Convert.ToString(Reader["LogisticName"]);
                                if (Reader["LogisticColor"] != DBNull.Value)
                                    reOrder.Logistic.HtmlColor = Convert.ToString(Reader["LogisticColor"]);
                            }
                            if (Reader["POList"] != DBNull.Value)
                            {
                                if (reOrder.PoList == null)
                                    reOrder.PoList = new List<WarehousePurchaseOrder>();
                                List<string> POList = Convert.ToString(Reader["POList"]).Split(',').ToList<string>();
                                reOrder.PO = string.Join("\n", POList);
                                foreach (var item in POList)
                                {
                                    var po = new WarehousePurchaseOrder();
                                    po.Code = item;
                                    po.IdWarehouse = warehouse.IdWarehouse;
                                    reOrder.PoList.Add(po);
                                }
                            }
                            ReOrderList.Add(reOrder);

                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetAllPreOrder_V2660(ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }

                }
            }
            return ReOrderList;
        }


        //[GEOS2-7979][rdixit][16.07.2025][All connected tasks]
        public int GetPOIdByCode(string connectionString,Warehouses warehouse, string code)
        {
           
            int idPo = 0;
            using (MySqlConnection connOtItem = new MySqlConnection(connectionString))
            {
                connOtItem.Open();
                MySqlCommand ArticlesCommand = new MySqlCommand("SRM_GetPOIdByCode_V2660", connOtItem);
                ArticlesCommand.CommandType = CommandType.StoredProcedure;
                ArticlesCommand.Parameters.AddWithValue("_IdWarehouse", warehouse.IdWarehouse);
                ArticlesCommand.Parameters.AddWithValue("_code", code);                
                ArticlesCommand.CommandTimeout = 4000;

                using (MySqlDataReader Reader = ArticlesCommand.ExecuteReader())
                {
                    while (Reader.Read())
                    {
                        try
                        {
                           
                            if (Reader["IdWarehousePurchaseOrder"] != DBNull.Value)
                                idPo = Convert.ToInt32(Reader["IdWarehousePurchaseOrder"]);                            
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetPOIdByCode(ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }

                }
            }
            return idPo;
        }

        //[Rahul.gadhave][GEOS2-7243][Date:17-07-2025]
        public List<WarehousePurchaseOrder> SendPOMailForSelectedPO_V2660(string connectionString, List<WarehousePurchaseOrder> ListPurchaseOrder_Checked, string purchaseOrdersPath, string emailTemplatePath)
        {
            List<WarehousePurchaseOrder> warehousePurchaseOrderList = new List<WarehousePurchaseOrder>();
            using (MySqlConnection mySqlConnection = new MySqlConnection(connectionString))
            {
                mySqlConnection.Open();
                foreach (var item in ListPurchaseOrder_Checked)
                {
                    MySqlCommand mySqlCommand = new MySqlCommand("SRM_GetPendingPOByIdWarehousePurchaseOrder_V2660", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdWarehousePurchaseOrder", item.IdWarehousePurchaseOrder);//9695
                    using (MySqlDataReader mySqlDataReader = mySqlCommand.ExecuteReader())
                    {
                        if (mySqlDataReader.Read())
                        {
                            try
                            {
                                WarehousePurchaseOrder warehousePurchaseOrder = new WarehousePurchaseOrder();

                                warehousePurchaseOrder.IdWarehousePurchaseOrder = item.IdWarehousePurchaseOrder;

                                if (mySqlDataReader["Code"] != DBNull.Value)
                                    warehousePurchaseOrder.Code = Convert.ToString(mySqlDataReader["Code"]);

                                if (mySqlDataReader["IdArticleSupplier"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                                    ArticleSupplier articleSupplier = new ArticleSupplier();
                                    articleSupplier.IdArticleSupplier = Convert.ToInt64(mySqlDataReader["IdArticleSupplier"]);

                                    if (mySqlDataReader["Supplier"] != DBNull.Value)
                                        articleSupplier.Name = Convert.ToString(mySqlDataReader["Supplier"]);

                                    if (mySqlDataReader["SupplierContactPerson"] != DBNull.Value)
                                        articleSupplier.ContactPerson = Convert.ToString(mySqlDataReader["SupplierContactPerson"]);

                                    if (mySqlDataReader["SupplierContactEmail"] != DBNull.Value)
                                        articleSupplier.ContactEmail = Convert.ToString(mySqlDataReader["SupplierContactEmail"]);

                                    if (mySqlDataReader["Serie"] != DBNull.Value)
                                        articleSupplier.Serie = Convert.ToChar(mySqlDataReader["Serie"]);

                                    if (mySqlDataReader["IdCountry"] != DBNull.Value)
                                    {
                                        articleSupplier.IdCountry = Convert.ToInt64(mySqlDataReader["IdCountry"]);

                                        articleSupplier.Country = new Country();
                                        articleSupplier.Country.IdCountry = (byte)articleSupplier.IdCountry;
                                        articleSupplier.Country.Name = Convert.ToString(mySqlDataReader["CountryName"]);

                                        if (mySqlDataReader["IdCountryGroup"] != DBNull.Value)
                                            articleSupplier.Country.IdCountryGroup = Convert.ToInt64(mySqlDataReader["IdCountryGroup"]);

                                        if (mySqlDataReader["SupplierCountryISO"] != DBNull.Value)
                                            articleSupplier.Country.Iso = Convert.ToString(mySqlDataReader["SupplierCountryISO"]);

                                    }

                                    if (mySqlDataReader["IdArticleSupplierType"] != DBNull.Value)
                                    {
                                        articleSupplier.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["IdArticleSupplierType"]);

                                        articleSupplier.ArticleSupplierType = new ArticleSupplierType();
                                        articleSupplier.ArticleSupplierType.IdArticleSupplierType = Convert.ToInt32(mySqlDataReader["IdArticleSupplierType"]);
                                        articleSupplier.ArticleSupplierType.Name = Convert.ToString(mySqlDataReader["ArticleSupplierType"]);
                                        articleSupplier.ArticleSupplierType.HtmlColor = Convert.ToString(mySqlDataReader["HtmlColor"]);
                                    }

                                    warehousePurchaseOrder.ArticleSupplier = articleSupplier;
                                }

                                if (mySqlDataReader["DeliveryDate"] != DBNull.Value && Convert.ToDateTime(mySqlDataReader["deliveryDate"]) != DateTime.MinValue)
                                {
                                    warehousePurchaseOrder.DeliveryDate = Convert.ToDateTime(mySqlDataReader["deliveryDate"]);
                                }

                                if (mySqlDataReader["AttachedPO"] != DBNull.Value)
                                    warehousePurchaseOrder.AttachedPO = Convert.ToByte(mySqlDataReader["AttachedPO"]);

                                if (mySqlDataReader["IdPaymentType"] != DBNull.Value)
                                    warehousePurchaseOrder.IdPaymentType = Convert.ToInt64(mySqlDataReader["IdPaymentType"]);

                                if (mySqlDataReader["ReminderEmailDate"] != DBNull.Value)
                                    warehousePurchaseOrder.ReminderEmailDate = Convert.ToDateTime(mySqlDataReader["ReminderEmailDate"]);

                                if (mySqlDataReader["CreatedIn"] != DBNull.Value)
                                    warehousePurchaseOrder.CreatedIn = Convert.ToDateTime(mySqlDataReader["CreatedIn"]);

                                if (mySqlDataReader["ModifiedIn"] != DBNull.Value)
                                    warehousePurchaseOrder.ModifiedIn = Convert.ToDateTime(mySqlDataReader["ModifiedIn"]);

                                if (mySqlDataReader["Comments"] != DBNull.Value)
                                    warehousePurchaseOrder.Comments = Convert.ToString(mySqlDataReader["Comments"]);

                                if (mySqlDataReader["IsClosed"] != DBNull.Value)
                                    warehousePurchaseOrder.IsClosed = Convert.ToByte(mySqlDataReader["IsClosed"]);

                                if (mySqlDataReader["CreatedBy"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.CreatedBy = Convert.ToInt64(mySqlDataReader["CreatedBy"]);
                                    warehousePurchaseOrder.Creator = new People();
                                    warehousePurchaseOrder.Creator.IdPerson = Convert.ToInt32(mySqlDataReader["CreatedBy"].ToString());
                                    warehousePurchaseOrder.Creator.Name = mySqlDataReader["CreatorName"].ToString();
                                    warehousePurchaseOrder.Creator.Surname = mySqlDataReader["CreatorSurname"].ToString();
                                }

                                if (mySqlDataReader["ModifiedBy"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.ModifiedBy = Convert.ToInt64(mySqlDataReader["ModifiedBy"]);
                                    warehousePurchaseOrder.Modifier = new People();
                                    warehousePurchaseOrder.Modifier.IdPerson = Convert.ToInt32(mySqlDataReader["ModifiedBy"].ToString());
                                    warehousePurchaseOrder.Modifier.Name = mySqlDataReader["ModifierName"].ToString();
                                    warehousePurchaseOrder.Modifier.Surname = mySqlDataReader["ModifierSurname"].ToString();
                                }

                                if (mySqlDataReader["ReasonClosed"] != DBNull.Value)
                                    warehousePurchaseOrder.ReasonClosed = Convert.ToString(mySqlDataReader["ReasonClosed"]);

                                if (mySqlDataReader["IdWarehouse"] != DBNull.Value)
                                    warehousePurchaseOrder.IdWarehouse = Convert.ToInt64(mySqlDataReader["IdWarehouse"]);

                                if (mySqlDataReader["IdCurrency"] != DBNull.Value)
                                    warehousePurchaseOrder.IdCurrency = Convert.ToByte(mySqlDataReader["IdCurrency"]);

                                if (mySqlDataReader["IdWorkflowStatus"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                    warehousePurchaseOrder.WorkflowStatus = new WorkflowStatus();
                                    warehousePurchaseOrder.WorkflowStatus.IdWorkflowStatus = Convert.ToByte(mySqlDataReader["IdWorkflowStatus"]);
                                    warehousePurchaseOrder.WorkflowStatus.Name = Convert.ToString(mySqlDataReader["Status"]);
                                    warehousePurchaseOrder.WorkflowStatus.HtmlColor = Convert.ToString(mySqlDataReader["StatusHtmlColor"]);
                                }

                                if (mySqlDataReader["IdAssignee"] != DBNull.Value)
                                    warehousePurchaseOrder.IdAssignee = Convert.ToUInt32(mySqlDataReader["IdAssignee"]);

                                if (mySqlDataReader["IdApprover"] != DBNull.Value)
                                    warehousePurchaseOrder.IdApprover = Convert.ToUInt32(mySqlDataReader["IdApprover"]);

                                if (mySqlDataReader["AssigneeEmail"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.AssigneeEmail = Convert.ToString(mySqlDataReader["AssigneeEmail"]);
                                }
                                if (mySqlDataReader["CreatorEmail"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.CreatorEmail = Convert.ToString(mySqlDataReader["CreatorEmail"]);
                                }
                                //[Rahul.gadhave][GEOS2-7243][Date:17-07-2025]
                                if (mySqlDataReader["Warehouse"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.WarehouseName = Convert.ToString(mySqlDataReader["Warehouse"]);
                                }
                                if (mySqlDataReader["DEAddress"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.DEAddress = Convert.ToString(mySqlDataReader["DEAddress"]);
                                }
                                if (mySqlDataReader["DEPostCode"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.DEPostCode = Convert.ToString(mySqlDataReader["DEPostCode"]);
                                }
                                if (mySqlDataReader["DETelephone"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.DETelephone = Convert.ToString(mySqlDataReader["DETelephone"]);
                                }
                                if (mySqlDataReader["DECity"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.DECity = Convert.ToString(mySqlDataReader["DECity"]);
                                }
                                if (mySqlDataReader["DeliveryAddressCountry"] != DBNull.Value)
                                {
                                    warehousePurchaseOrder.DeliveryAddressCountry = Convert.ToString(mySqlDataReader["DeliveryAddressCountry"]);
                                }
                                //warehousePurchaseOrder.DeliveryAddressFormatted = string.Format(
                                //                             "{0}<br/>{1}<br/>{2} {3}<br/>{4}<br/>Phone: {5}",
                                //                             warehousePurchaseOrder.WarehouseName,            // EAES
                                //                             warehousePurchaseOrder.DEAddress,                // Polígono Industrial Entar. s/n
                                //                             warehousePurchaseOrder.DEPostCode,               // 43813
                                //                             warehousePurchaseOrder.DECity,                   // Alió (Tarragona)
                                //                             warehousePurchaseOrder.DeliveryAddressCountry,   // SPAIN
                                //                             warehousePurchaseOrder.DETelephone               // (+34)977605204
                                //                         );

                                string HTMLFileName = null;
                                if (File.Exists(string.Format("{0}{1}SupplierPurchaseOrderRequestMailFormat_{2}-{3}.html", emailTemplatePath, @"\", warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower(), warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToUpper())))
                                {
                                    warehousePurchaseOrder.DeliveryAddressFormatted = string.Format(
                                                        "<div style='margin-left:20px'>{0}</div>" +
                                                        "<div style='margin-left:20px'>{1}</div>" +
                                                        "<div style='margin-left:20px'>{2} {3}</div>" +
                                                        "<div style='margin-left:20px'>{4}</div>" +
                                                        "<div style='margin-left:20px'>Phone: {5}</div>",
                                                        warehousePurchaseOrder.WarehouseName,
                                                        warehousePurchaseOrder.DEAddress,
                                                        warehousePurchaseOrder.DEPostCode,
                                                        warehousePurchaseOrder.DECity,
                                                        warehousePurchaseOrder.DeliveryAddressCountry,
                                                        warehousePurchaseOrder.DETelephone
                                                   );
                                    HTMLFileName = string.Format("SupplierPurchaseOrderRequestMailFormat_{0}-{1}.html", warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower(), warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToUpper());
                                }
                                else if (File.Exists(string.Format("{0}{1}SupplierPurchaseOrderRequestMailFormat.html", emailTemplatePath, @"\")))
                                {
                                    warehousePurchaseOrder.DeliveryAddressFormatted = string.Format(
                                                        "<div style='margin-left:20px'>{0}</div>" +
                                                        "<div style='margin-left:20px'>{1}</div>" +
                                                        "<div style='margin-left:20px'>{2} {3}</div>" +
                                                        "<div style='margin-left:20px'>{4}</div>" +
                                                        "<div style='margin-left:20px'>Phone: {5}</div>",
                                                        warehousePurchaseOrder.WarehouseName,
                                                        warehousePurchaseOrder.DEAddress,
                                                        warehousePurchaseOrder.DEPostCode,
                                                        warehousePurchaseOrder.DECity,
                                                        warehousePurchaseOrder.DeliveryAddressCountry,
                                                        warehousePurchaseOrder.DETelephone
                                                   );

                                    HTMLFileName = "SupplierPurchaseOrderRequestMailFormat.html";

                                }
                                if (HTMLFileName != null)
                                {
                                    StringBuilder emailbody = new StringBuilder();
                                    string text = ReadMailTemplate(HTMLFileName, emailTemplatePath);

                                    if (string.IsNullOrEmpty(warehousePurchaseOrder.ArticleSupplier.ContactPerson))
                                    {
                                        text = text.Replace("[Supplier_Name]", "Supplier");
                                    }
                                    else
                                    {
                                        text = text.Replace("[Supplier_Name]", warehousePurchaseOrder.ArticleSupplier.ContactPerson);
                                    }
                                    text = text.Replace("[PO_Code]", warehousePurchaseOrder.Code);
                                    text = text.Replace("[Delivery_Address]", warehousePurchaseOrder.DeliveryAddressFormatted);

                                    #region 1 rajashri GEOS2-5375 && GEOS2-5376
                                    #region  rajashri GEOS2-5375    
                                    string concatenatedValues = string.Empty;
                                    List<WarehousePurchaseOrder> WarehousePurchaseOrder1;
                                    if (warehousePurchaseOrder.DeliveryDate != null)
                                    {
                                        WarehousePurchaseOrder1 = GetWarehouseHolidays_V2520(connectionString, warehousePurchaseOrder.DeliveryDate, warehousePurchaseOrder.IdWarehouse, warehousePurchaseOrder.IdWarehousePurchaseOrder);
                                    }
                                    else
                                    {
                                        WarehousePurchaseOrder1 = new List<WarehousePurchaseOrder>();
                                    }
                                    if (WarehousePurchaseOrder1 != null && WarehousePurchaseOrder1.Count > 0)
                                    {
                                        CultureInfo cultureInfo = CultureInfo.CurrentCulture;

                                        var holidays = WarehousePurchaseOrder1.Select(h => new
                                        {
                                            StartDate = h.WarehouseHolidayStartdate?.Date.ToString("d", cultureInfo),
                                            EndDate = h.WarehouseHolidayEndDate?.Date.ToString("d", cultureInfo),
                                            Type = h.Holidaytype
                                        }).ToList();

                                        // var holidays = WarehousePurchaseOrder1.Select(h => new { StartDate = h.WarehouseHolidayStartdate?.Date, EndDate = h.WarehouseHolidayEndDate?.Date, Type = h.Holidaytype }).ToList();
                                        if (holidays.Count == 1)
                                        {
                                            var holiday = holidays.First();
                                            concatenatedValues = $"<tr style=\"margin-top:5px\">" +
                                                                $"<td colspan=\"2\" style=\"background: white; font-weight: 700; border-top: 4px solid grey; Padding:5px\">" +
                                                                $"</tr>" +
                                                                $"<tr style=\"margin-top:5px\">" +
                                                                $"<td colspan=\"2\" style=\"background: #d1d8db; color: black; font-weight: 700; border-top: 4px solid grey; Padding:20px\">";
                                            if (warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower() == "es")
                                            {
                                                concatenatedValues += $"Tenga en cuenta que el almacén({WarehousePurchaseOrder1.FirstOrDefault()?.Name}) estará cerrado el ";
                                                if (holiday.StartDate == holiday.EndDate)
                                                {
                                                    concatenatedValues += $"{holiday.StartDate} debido a un día festivo \"{holiday.Type}\"";
                                                }
                                                else
                                                {
                                                    concatenatedValues += $"{holiday.StartDate},{holiday.EndDate} debido a un día festivo \"{holiday.Type}\"";
                                                }
                                            }
                                            else
                                            {
                                                concatenatedValues += $"Please be Informed that warehouse({WarehousePurchaseOrder1.FirstOrDefault()?.Name}) will be closed on ";

                                                if (holiday.StartDate == holiday.EndDate)
                                                {
                                                    concatenatedValues += $"{holiday.StartDate} due to \"{holiday.Type}\" holiday";
                                                }
                                                else
                                                {
                                                    concatenatedValues += $"{holiday.StartDate},{holiday.EndDate} due to \"{holiday.Type}\" holiday";
                                                }
                                            }

                                            concatenatedValues += $"</td></tr>";

                                        }
                                        else
                                        {

                                            //var groupesHolidays = holidays.GroupBy(h => h.Type).Select(g => new {
                                            //    Type = g.Key,
                                            //    Dates = g.Select(h =>
                                            //    {
                                            //        if (h.StartDate == h.EndDate)
                                            //        {
                                            //            return h.StartDate?.ToShortDateString();
                                            //        }
                                            //        else if(
                                            //        {
                                            //            return $"{h.StartDate?.ToShortDateString()} , {h.EndDate?.ToShortDateString()}";
                                            //        }
                                            //    }).ToList()
                                            //});

                                            var groupesHolidays = holidays.GroupBy(h => h.Type).Select(g => new
                                            {
                                                Type = g.Key,
                                                Dates = g.Select(h =>
                                                {
                                                    if (h.StartDate == h.EndDate)
                                                    {
                                                        return h.StartDate;
                                                    }
                                                    else if (h.StartDate != null && h.EndDate != null)
                                                    {
                                                        return $"{h.StartDate} , {h.EndDate}";
                                                    }
                                                    else if (h.StartDate != null)
                                                    {
                                                        return h.StartDate;
                                                    }
                                                    else if (h.EndDate != null)
                                                    {
                                                        return h.EndDate;
                                                    }
                                                    else
                                                    {
                                                        return ""; // Handle case where both StartDate and EndDate are null
                                                    }
                                                }).ToList()
                                            });


                                            concatenatedValues = $"<tr style=\"margin-top:5px\">" +
                                             $"<td colspan=\"2\" style=\"background: white; font-weight: 700; border-top: 4px solid grey; Padding:5px\">";
                                            int groupCount = groupesHolidays.Count();
                                            if (groupCount > 0)
                                            {
                                                if (warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower() == "es")
                                                {
                                                    concatenatedValues += $"Tenga en cuenta que el almacén({WarehousePurchaseOrder1.FirstOrDefault()?.Name}) estará cerrado ";
                                                }
                                                else
                                                {
                                                    concatenatedValues += $"Please be Informed that warehouse({WarehousePurchaseOrder1.FirstOrDefault()?.Name}) will be closed  ";
                                                }
                                            }

                                            int currentIndex = 0;

                                            foreach (var group in groupesHolidays)
                                            {

                                                if (warehousePurchaseOrder.ArticleSupplier.Country.Iso.ToLower() == "es")
                                                {
                                                    concatenatedValues += $" en  {string.Join(", ", group.Dates)} debido a un día festivo  \"{group.Type}\"";
                                                    if (currentIndex < groupCount - 1)
                                                    {
                                                        concatenatedValues += " Y ";
                                                    }
                                                }
                                                else
                                                {
                                                    concatenatedValues += $" on  {string.Join(", ", group.Dates)} due to \"{group.Type}\" holiday";
                                                    if (currentIndex < groupCount - 1)
                                                    {
                                                        concatenatedValues += (currentIndex % 2 == 0) ? ", " : " and ";
                                                    }
                                                }
                                                currentIndex++;
                                            }


                                            concatenatedValues += $"</td></tr>";

                                        }
                                        text = text.Replace("[footerdata]", concatenatedValues);
                                    }
                                    #endregion
                                    #region GEOS-5376
                                    else
                                    {

                                        #region CustomMessageFooter

                                        List<Warehouses> customHoliday = GetCustomMessageforHoliday_PORequestMail_V2500(connectionString, warehousePurchaseOrder.IdWarehouse);
                                        if (customHoliday != null && customHoliday.Count > 0)
                                        {
                                            var customMessages = string.Join(", ", customHoliday.Select(h => h.CustomMessage));
                                            var customStartDate = string.Join(", ", customHoliday.Select(h => h.ImportantNoticeStartDate?.Date.ToShortDateString()));
                                            var customEndDate = string.Join(", ", customHoliday.Select(h => h.ImportantNoticeEndDate?.Date.ToShortDateString()));

                                            CultureInfo cultureInfo = CultureInfo.CurrentCulture;
                                            customStartDate = customStartDate.ToString(cultureInfo);
                                            customEndDate = customEndDate.ToString(cultureInfo);


                                            if (!string.IsNullOrEmpty(customStartDate) && string.IsNullOrEmpty(customEndDate))
                                            {
                                                concatenatedValues = $"<tr style=\"margin-top:5px\">" +
                                                                      $"<td colspan=\"2\" style=\"background: white;  font-weight: 700; border-top: 4px solid grey;Padding:5px \">" +
                                                                      $"</tr>" +
                                                                      $"<tr style=\"margin-top:5px\">" +
                                                                      $"<td colspan=\"2\" style=\"background: #d1d8db; color: black; font-weight: 700; border-top: 4px solid grey;Padding:20px \">" +
                                                                      $"{customMessages} from " +
                                                                      $"\"{customStartDate}\"" + "</td>" +
                                                                      $"</tr>";
                                            }
                                            else if (string.IsNullOrEmpty(customStartDate) && !string.IsNullOrEmpty(customEndDate))
                                            {
                                                concatenatedValues = $"<tr style=\"margin-top:5px\">" +
                                                                      $"<td colspan=\"2\" style=\"background: white;  font-weight: 700; border-top: 4px solid grey;Padding:5px \">" +
                                                                      $"</tr>" +
                                                                      $"<tr style=\"margin-top:5px\">" +
                                                                      $"<td colspan=\"2\" style=\"background: #d1d8db; color: black; font-weight: 700; border-top: 4px solid grey;Padding:20px \">" +
                                                                      $"{customMessages} " +
                                                                      $" till " +
                                                                      $"\"{customEndDate}\"" + "</td>" +
                                                                      $"</tr>";
                                            }
                                            else if (!string.IsNullOrEmpty(customStartDate) && !string.IsNullOrEmpty(customEndDate))
                                            {
                                                concatenatedValues = $"<tr style=\"margin-top:5px\">" +
                                                                      $"<td colspan=\"2\" style=\"background: white;  font-weight: 700; border-top: 4px solid grey;Padding:5px \">" +
                                                                      $"</tr>" +
                                                                      $"<tr style=\"margin-top:5px\">" +
                                                                      $"<td colspan=\"2\" style=\"background: #d1d8db; color: black; font-weight: 700; border-top: 4px solid grey;Padding:20px \">" +
                                                                      $"{customMessages} " +
                                                                      $"</tr>";
                                            }

                                            else
                                            {
                                                concatenatedValues = $"<tr style=\"margin-top:5px\">" +
                                                                     $"<td colspan=\"2\" style=\"background: white;  font-weight: 700; border-top: 4px solid grey;Padding:5px \">" +
                                                                     $"</tr>" +
                                                                     $"<tr style=\"margin-top:5px\">" +
                                                                     $"<td colspan=\"2\" style=\"background: #d1d8db; color: black; font-weight: 700; border-top: 4px solid grey;Padding:20px \">" +
                                                                     $"{customMessages}</td>" +
                                                                     $"</tr>";
                                            }

                                        }
                                        else
                                        {
                                            concatenatedValues = string.Empty;
                                        }
                                        text = text.Replace("[footerdata]", concatenatedValues);
                                        #endregion
                                    }
                                    #endregion

                                    #endregion
                                    emailbody.Append(text);

                                    warehousePurchaseOrder.EmailBody = emailbody.ToString();
                                }

                                warehousePurchaseOrder.AttachPdf = warehousePurchaseOrder.CreatedIn.Year + @"\" + warehousePurchaseOrder.Code + @"\01 Purchase Order\PO_" + warehousePurchaseOrder.Code + ".pdf";

                                warehousePurchaseOrder.AttachmentBytes = GetPurchaseOrderPdf(purchaseOrdersPath, warehousePurchaseOrder.AttachPdf);
                                warehousePurchaseOrderList.Add(warehousePurchaseOrder);

                            }
                            catch (Exception ex)
                            {
                                Log4NetLogger.Logger.Log(string.Format("Error SendPOMailForSelectedPO_V2660(idWarehousePurchaseOrder-{0}), ErrorMessage- {1} ", item.IdWarehousePurchaseOrder, ex.Message), category: Category.Exception, priority: Priority.Low);
                                throw;
                            }

                        }
                    }
                }
            }

            return warehousePurchaseOrderList;
        }

        //[rdixit][GEOS2-8252][16.10.2025]
        public PreOrder AddPreOrder_V2680(string mainServerConnectionString, PreOrder preOrder)
        {
            TransactionScope transactionScope = null;
            try
            {
                using (transactionScope = new TransactionScope())
                {
                    using (MySqlConnection mySqlConnection = new MySqlConnection(mainServerConnectionString))
                    {
                        mySqlConnection.Open();

                        MySqlCommand mySqlCommand = new MySqlCommand("SRM_InsertPreOrder_V2680", mySqlConnection);
                        mySqlCommand.CommandType = CommandType.StoredProcedure;
                        mySqlCommand.Parameters.AddWithValue("_IdWarehouse", preOrder.Warehouse?.IdWarehouse);
                        mySqlCommand.Parameters.AddWithValue("_Code", preOrder.Code);
                        mySqlCommand.Parameters.AddWithValue("_IdCurrency", preOrder.Currency?.IdCurrency);
                        mySqlCommand.Parameters.AddWithValue("_IdLogistic", preOrder.Logistic?.IdLookupValue);
                        mySqlCommand.Parameters.AddWithValue("_Observations", preOrder.Observation);
                        mySqlCommand.Parameters.AddWithValue("_CreationDate", preOrder.CreationDate);
                        mySqlCommand.Parameters.AddWithValue("_CreatedBy", preOrder.CreatedId);
                        preOrder.IdWarehouseReOrder = Convert.ToInt32(mySqlCommand.ExecuteScalar());
                        mySqlConnection.Close();
                    }
                    transactionScope.Complete();
                }
            }
            catch (Exception ex)
            {
                if (Transaction.Current != null)
                    Transaction.Current.Rollback();

                if (transactionScope != null)
                    transactionScope.Dispose();

                Log4NetLogger.Logger.Log(string.Format("Error AddPreOrder_V2680(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }

            return preOrder;
        }

        //[rdixit][GEOS2-8252][16.10.2025]
        public List<string> GetExistingPreOrderCodes_V2680(string connectionString, string code)
        {

            List<string> preOderCode = new List<string>();
            using (MySqlConnection connOtItem = new MySqlConnection(connectionString))
            {
                connOtItem.Open();
                MySqlCommand ArticlesCommand = new MySqlCommand("SRM_GetExistingPreOrderCodes_V2680", connOtItem);
                ArticlesCommand.CommandType = CommandType.StoredProcedure;
                ArticlesCommand.Parameters.AddWithValue("_code", code);
                ArticlesCommand.CommandTimeout = 4000;

                using (MySqlDataReader Reader = ArticlesCommand.ExecuteReader())
                {
                    while (Reader.Read())
                    {
                        try
                        {

                            if (Reader["Code"] != DBNull.Value)
                                preOderCode.Add(Convert.ToString(Reader["Code"]));
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetExistingPreOrderCodes_V2680(ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }

                }
            }
            return preOderCode;
        }

        //[rdixit][GEOS2-8252][16.10.2025]
        public List<Warehouses> GetAllWarehousesByUserPermissionInSRM_V2680(string connectionString, Int32 idActiveUser)
        {
            List<Warehouses> warehouses = new List<Warehouses>();
            // Parse the connection string
            MySqlConnectionStringBuilder builder = new MySqlConnectionStringBuilder(connectionString);

            // Extract components
            string ConnecteddataSource = builder.Server;
            string database = builder.Database;
            string userId = builder.UserID;
            string password = builder.Password;
            string connectedPlantName = GetConnectedPlantNameFromDataSource(ConnecteddataSource.ToUpper(), connectionString);
            string dataSource = "";
            using (MySqlConnection connWarehouse = new MySqlConnection(connectionString))
            {
                connWarehouse.Open();

                MySqlCommand warehouseCommand = new MySqlCommand("SRM_GetAllWarehousesByUserPermission_V2680", connWarehouse);
                warehouseCommand.CommandType = CommandType.StoredProcedure;
                warehouseCommand.Parameters.AddWithValue("_idUser", idActiveUser);

                using (MySqlDataReader warehouseReader = warehouseCommand.ExecuteReader())
                {
                    while (warehouseReader.Read())
                    {
                        try
                        {
                            Warehouses warehouse = new Warehouses();

                            if (warehouseReader["IdWarehouse"] != DBNull.Value)
                                warehouse.IdWarehouse = Convert.ToInt32(warehouseReader["IdWarehouse"]);

                            if (warehouseReader["Name"] != DBNull.Value)
                                warehouse.Name = Convert.ToString(warehouseReader["Name"]);

                            if (warehouseReader["IdTransitLocation"] != DBNull.Value)
                                warehouse.IdTransitLocation = Convert.ToInt64(warehouseReader["IdTransitLocation"]);

                            if (warehouseReader["IdSite"] != DBNull.Value)
                            {
                                if (string.IsNullOrEmpty(connectedPlantName))
                                {
                                    dataSource = ConnecteddataSource.Replace(ConnecteddataSource, warehouseReader["DatabaseIP"].ToString());
                                }
                                else
                                {
                                    dataSource = ConnecteddataSource.Replace(connectedPlantName, warehouseReader["ShortName"].ToString());
                                }
                                string connstr = connectionString.Replace(ConnecteddataSource, dataSource);

                                warehouse.IdSite = Convert.ToInt32(warehouseReader["IdSite"]);

                                Company company = new Company();
                                company.IdCompany = Convert.ToInt32(warehouseReader["IdSite"]);
                                company.ConnectPlantConstr = connstr;
                                company.ConnectPlantId = Convert.ToString(company.IdCompany);

                                if (warehouseReader["SiteName"] != DBNull.Value)
                                    company.Name = Convert.ToString(warehouseReader["SiteName"]);

                                if (warehouseReader["ShortName"] != DBNull.Value)
                                {
                                    company.ShortName = Convert.ToString(warehouseReader["ShortName"]);
                                    company.Alias = company.ShortName;
                                }

                                warehouse.Company = company;
                            }
                            if (warehouseReader["InUse"] != DBNull.Value)
                            {
                                warehouse.IsInUse = Convert.ToBoolean(warehouseReader["InUse"]);
                            }
                            if (warehouseReader["CurName"] != DBNull.Value)
                            {
                                warehouse.Currency = new Currency();
                                if (warehouseReader["CurName"] != DBNull.Value)
                                {
                                    warehouse.Currency.Name = Convert.ToString(warehouseReader["CurName"]);
                                }
                                if (warehouseReader["IdCurrency"] != DBNull.Value)
                                {
                                    warehouse.Currency.IdCurrency = Convert.ToByte(warehouseReader["IdCurrency"]);
                                }
                                if (warehouseReader["Symbol"] != DBNull.Value)
                                {
                                    warehouse.Currency.Symbol = Convert.ToString(warehouseReader["Symbol"]);
                                }
                            }
                            warehouses.Add(warehouse);
                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetAllWarehousesByUserPermissionInSRM_V2680(). ErrorMessage-" + ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }
                }
            }

            return warehouses;
        }

        //[rdixit][GEOS2-8252][16.10.2025]
        private string GetConnectedPlantNameFromDataSource(string datasource, string connectionString)
        {
            string connectedPlantName = "";
            using (MySqlConnection conn = new MySqlConnection(connectionString))
            {
                conn.Open();

                MySqlCommand command = new MySqlCommand("CRM_GetAllPlantNameToCheckDataSource", conn);
                command.CommandType = CommandType.StoredProcedure;

                using (MySqlDataReader itemRow = command.ExecuteReader())
                {
                    if (itemRow.HasRows)
                    {
                        while (itemRow.Read())
                        {
                            string plantShortName = itemRow["ShortName"].ToString();
                            if (datasource.Contains(plantShortName.ToUpper()))
                            {
                                connectedPlantName = plantShortName.ToUpper();
                            }

                        }
                    }
                }
            }

            return connectedPlantName;
        }

        //[rdixit][GEOS2-8252][16.10.2025]
        public List<PreOrder> GetAllPreOrder_V2680(string connectionString, Warehouses warehouse, DateTime fromDate, DateTime toDate, string currenciesImages)
        {
            List<PreOrder> ReOrderList = new List<PreOrder>();
            Dictionary<string, byte[]> DictCurrencies = new Dictionary<string, byte[]>();
            using (MySqlConnection connOtItem = new MySqlConnection(connectionString))
            {
                connOtItem.Open();
                MySqlCommand ArticlesCommand = new MySqlCommand("SRM_GetWarehousePreOrders_V2680", connOtItem);
                ArticlesCommand.CommandType = CommandType.StoredProcedure;
                ArticlesCommand.Parameters.AddWithValue("_IdWarehouse", warehouse.IdWarehouse);
                ArticlesCommand.Parameters.AddWithValue("_fromDate", fromDate);
                ArticlesCommand.Parameters.AddWithValue("_toDate", toDate);
                ArticlesCommand.CommandTimeout = 4000;

                using (MySqlDataReader Reader = ArticlesCommand.ExecuteReader())
                {
                    while (Reader.Read())
                    {
                        try
                        {
                            PreOrder reOrder = new PreOrder();

                            if (Reader["IdWarehousePreOrder"] != DBNull.Value)
                                reOrder.IdWarehouseReOrder = Convert.ToInt32(Reader["IdWarehousePreOrder"]);

                            if (Reader["Code"] != DBNull.Value)
                                reOrder.Code = Convert.ToString(Reader["Code"]);

                            if (Reader["CalculationDate"] != DBNull.Value)
                                reOrder.CalculationDate = Convert.ToDateTime(Reader["CalculationDate"]);

                            if (Reader["CreatedBy"] != DBNull.Value)
                                reOrder.CreatedId = Convert.ToInt32(Reader["CreatedBy"]);

                            if (Reader["CreatedUsr"] != DBNull.Value)
                                reOrder.CreatedBy = Convert.ToString(Reader["CreatedUsr"]);

                            if (Reader["CreationDate"] != DBNull.Value)
                                reOrder.CreationDate = Convert.ToDateTime(Reader["CreationDate"]);

                            if (Reader["IdWarehouse"] != DBNull.Value)
                            {
                                reOrder.Warehouse = new Warehouses();

                                if (Reader["IdWarehouse"] != DBNull.Value)
                                    reOrder.Warehouse.IdWarehouse = Convert.ToInt32(Reader["IdWarehouse"]);

                                if (Reader["WarehouseName"] != DBNull.Value)
                                    reOrder.Warehouse.Name = Convert.ToString(Reader["WarehouseName"]);

                                if (Reader["iso"] != DBNull.Value)
                                {
                                    string countryISO = Convert.ToString(Reader["iso"]);
                                    reOrder.Warehouse.CountryIconUrl = "https://api.emdep.com/GEOS/Images?FilePath=/Images/Countries/" + countryISO + ".png";
                                }
                            }
                           
                            if (Reader["TotalReOrder"] != DBNull.Value)
                                reOrder.TotalReOrder = Convert.ToInt32(Reader["TotalReOrder"]);

                            if (Reader["TotalValue"] != DBNull.Value)
                                reOrder.TotalValue = Convert.ToDouble(Reader["TotalValue"]);


                            if (Reader["IdCurrency"] != DBNull.Value)
                            {
                                reOrder.Currency = new Currency();
                                reOrder.Currency.IdCurrency = Convert.ToByte(Reader["IdCurrency"]);
                                reOrder.Currency.Name = Convert.ToString(Reader["CurrencyName"]);
                                reOrder.Currency.ISOCode = Convert.ToString(Reader["iso"]);
                            }

                            if (Reader["IdWorkflow"] != DBNull.Value)
                            {
                                reOrder.Status = new WorkflowStatus();
                                reOrder.Status.IdWorkflowStatus = Convert.ToByte(Reader["IdWorkflowStatus"]);
                                reOrder.Status.Name = Convert.ToString(Reader["WorkflowStatus"]);
                            }

                            if (Reader["Code"] != DBNull.Value)
                                reOrder.Code = Reader["Code"].ToString();

                            if (Reader["LogisticId"] != DBNull.Value)
                            {
                                reOrder.Logistic = new LookupValue();
                                reOrder.Logistic.IdLookupValue = Convert.ToInt32(Reader["LogisticId"]);
                                reOrder.Logistic.Value = Convert.ToString(Reader["LogisticName"]);
                                if (Reader["LogisticColor"] != DBNull.Value)
                                    reOrder.Logistic.HtmlColor = Convert.ToString(Reader["LogisticColor"]);
                            }
                            if (Reader["POList"] != DBNull.Value)
                            {
                                if (reOrder.PoList == null)
                                    reOrder.PoList = new List<WarehousePurchaseOrder>();
                                List<string> POList = Convert.ToString(Reader["POList"]).Split(',').ToList<string>();
                                reOrder.PO = string.Join("\n", POList);
                                foreach (var item in POList)
                                {
                                    var po = new WarehousePurchaseOrder();
                                    po.Code = item;
                                    po.IdWarehouse = warehouse.IdWarehouse;
                                    reOrder.PoList.Add(po);
                                }
                            }
                            ReOrderList.Add(reOrder);

                        }
                        catch (Exception ex)
                        {
                            Log4NetLogger.Logger.Log(string.Format("Error GetAllPreOrder_V2680(ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                            throw;
                        }
                    }

                }
            }

            foreach (var item in ReOrderList)
            {
                if (!string.IsNullOrEmpty(item.Currency.Name))
                {
                    if (DictCurrencies.Any(i => i.Key == item.Currency.Name))
                    {
                        item.Currency.CurrencyIconbytes = DictCurrencies.Where(i => i.Key == item.Currency.Name).FirstOrDefault().Value;
                    }
                    else
                    {
                        item.Currency.CurrencyIconbytes = GetCurrencyIconFileInBytes(item.Currency.Name, currenciesImages);
                        DictCurrencies.Add(item.Currency.Name, item.Currency.CurrencyIconbytes);
                    }
                }
            }
            return ReOrderList;
        }

        //[rdixit][GEOS2-8252][16.10.2025]
        public byte[] GetCurrencyIconFileInBytes(string currencyName, string filepath)
        {
            byte[] bytes = null;
            try
            {
                string filenamepng = currencyName + ".png";
                string filenamejpg = currencyName + ".jpg";
                string filepathjpg = Path.Combine(filepath, filenamejpg);
                string filepathpng = Path.Combine(filepath, filenamepng);
                if (File.Exists(filepathjpg))
                {
                    using (System.IO.FileStream stream = new System.IO.FileStream(filepathjpg, System.IO.FileMode.Open, System.IO.FileAccess.Read))
                    {
                        bytes = new byte[stream.Length];
                        int numBytesToRead = (int)stream.Length;
                        int numBytesRead = 0;
                        while (numBytesToRead > 0)
                        {
                            // Read may return anything from 0 to numBytesToRead.
                            int n = stream.Read(bytes, numBytesRead, numBytesToRead);
                            // Break when the end of the file is reached.
                            if (n == 0)
                                break;
                            numBytesRead += n;
                            numBytesToRead -= n;
                        }
                    }
                }
                else if (File.Exists(filepathpng))
                {
                    using (System.IO.FileStream stream = new System.IO.FileStream(filepathpng, System.IO.FileMode.Open, System.IO.FileAccess.Read))
                    {
                        bytes = new byte[stream.Length];
                        int numBytesToRead = (int)stream.Length;
                        int numBytesRead = 0;
                        while (numBytesToRead > 0)
                        {
                            // Read may return anything from 0 to numBytesToRead.
                            int n = stream.Read(bytes, numBytesRead, numBytesToRead);
                            // Break when the end of the file is reached.
                            if (n == 0)
                                break;
                            numBytesRead += n;
                            numBytesToRead -= n;
                        }
                    }
                }
                return bytes;
            }
            catch (FileNotFoundException ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCurrencyIconFileInBytes() ISO-{0}. ErrorMessage- {1}", currencyName, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            catch (DirectoryNotFoundException ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCurrencyIconFileInBytes() ISO-{0}. ErrorMessage- {1}", currencyName, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetCurrencyIconFileInBytes() ISO-{0}. ErrorMessage- {1}", currencyName, ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
        }

        //[pallavi.kale][GEOS2-9558][17.10.2025]
        public List<ArticlePurchasing> GetPurchasingReport_V2680(DateTime fromDate, DateTime toDate, long idArticleSupplier, int idArticle, long idWarehouse, string connectionString)
        {
            List<ArticlePurchasing> lstPurchasingReport = new List<ArticlePurchasing>();
            try
            {
                using (MySqlConnection conCountry = new MySqlConnection(connectionString))
                {
                    conCountry.Open();

                    MySqlCommand cmd = new MySqlCommand("SRM_GeneratePurchasingReport_V2680", conCountry);
                    cmd.CommandType = CommandType.StoredProcedure;
                    cmd.Parameters.AddWithValue("_FromDate", fromDate.ToString("yyyy/MM/dd HH:mm:ss"));
                    cmd.Parameters.AddWithValue("_ToDate", toDate.ToString("yyyy/MM/dd 23:59:59"));
                    cmd.Parameters.AddWithValue("_IdArticleSupplier", idArticleSupplier);
                    cmd.Parameters.AddWithValue("_IdArticle", idArticle);
                    cmd.Parameters.AddWithValue("_IdWarehouse", idWarehouse);
                    using (MySqlDataReader reader = cmd.ExecuteReader())
                    {
                        while (reader.Read())
                        {
                            ArticlePurchasing record = new ArticlePurchasing();
                            if (reader["Date"] != DBNull.Value)
                            {
                                record.Date = Convert.ToDateTime((reader["Date"]).ToString());
                            }
                            record.IdOrder = Convert.ToInt32(reader["IdOrder"]);
                            record.Order = reader["Order"].ToString();
                            record.Article = reader["Article"].ToString();
                            record.Supplier = reader["Supplier"].ToString();
                            record.TradeName = reader["TradeName"].ToString();
                            record.SupplierReference = reader["SupplierReference"].ToString();
                            record.PoQuantity = Convert.ToInt32(reader["PoQuantity"]);
                            record.Quantity = Convert.ToInt32(reader["Quantity"]);
                            record.Price = Convert.ToDouble(reader["Value"]);
                            record.PoValue = Convert.ToDouble(reader["PoValue"]);
                            record.WarehouseDeliveryNoteCode = reader["WarehouseDeliveryNoteCode"].ToString();
                            record.IdCurrency = Convert.ToInt32(reader["IdCurrency"]);
                            record.NameCurrPO = reader["NameCurrPO"].ToString();
                            record.NameCurrSelected = reader["NameCurrSelected"].ToString();
                            record.ExchangeRate11 = Convert.ToDouble(reader["ExchangeRate11"]);
                            record.PoWarehouse = reader["PoWarehouse"].ToString();
                            record.IdWarehouse = Convert.ToInt32(reader["IdWarehouse"]);
                            record.UnitPrice = Convert.ToDouble(reader["UnitPrice"]);
                            record.Discount = Convert.ToDouble(reader["Discount"]);
                            record.ExchangeRate = Convert.ToDouble(reader["ExchangeRate"]);
                            record.TransportCost = Convert.ToDouble(reader["TransportCost"]);
                            record.ImportClearanceCost = Convert.ToDouble(reader["ImportClearanceCost"]);
                            record.DutiesPercentage = Convert.ToDouble(reader["DutiesPercentage"]);
                            record.Duties = Convert.ToDouble(reader["Duties"]);
                            record.TotalPriceWithNewCost = Convert.ToDouble(reader["TotalPriceWithNewCost"]);
                            record.WarehouseItemDescription = Convert.ToString(reader["WarehouseItemDescription"]);
                            record.Status = Convert.ToString(reader["Status"]);
                            record.CurSymbol = Convert.ToString(reader["Symbol"]);
                            record.CurSymbolPlant = Convert.ToString(reader["CurSymbolPlant"]);
                            // Calculation part
                            record.Price = record.Quantity * (record.UnitPrice * ((100 - record.Discount) / 100)) * (record.ExchangeRate == 0 ? 1 : record.ExchangeRate);
                            record.PoValue = record.PoQuantity * (record.UnitPrice * ((100 - record.Discount) / 100)) * (record.ExchangeRate == 0 ? 1 : record.ExchangeRate);
                            record.TotalPriceWithNewCost = (record.PoValue + record.TransportCost + record.ImportClearanceCost + record.Duties);
                            lstPurchasingReport.Add(record);
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error GetPurchasingReport_V2680(ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;

            }

            return lstPurchasingReport;
        }

        //[pallavi.kale][GEOS2-9806][24.11.2025]
        public bool DeleteArticleSupplier_V2690(string MainServerConnectionString, Int64 idArticleSupplier, int IdUser)
        {
            bool status;
            try
            {
                using (MySqlConnection mySqlConnection = new MySqlConnection(MainServerConnectionString))
                {
                    mySqlConnection.Open();
                    MySqlCommand mySqlCommand = new MySqlCommand("SRM_ArticleSupplier_Delete", mySqlConnection);
                    mySqlCommand.CommandType = CommandType.StoredProcedure;
                    mySqlCommand.Parameters.AddWithValue("_IdArticleSupplier", idArticleSupplier);
                    mySqlCommand.Parameters.AddWithValue("_ModifiedBy", IdUser);
                    mySqlCommand.Parameters.AddWithValue("_ModifiedIn", DateTime.Now.ToString("yyyy/MM/dd HH:mm:ss"));
                    mySqlCommand.ExecuteNonQuery();
                    mySqlConnection.Close();
                    status = true;
                }
            }
            catch (Exception ex)
            {
                Log4NetLogger.Logger.Log(string.Format("Error DeleteArticleSupplier_V2690(). ErrorMessage- {0}", ex.Message), category: Category.Exception, priority: Priority.Low);
                throw;
            }
            return status;
        }
    }
}